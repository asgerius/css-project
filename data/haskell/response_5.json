[{"tags": ["haskell", "garbage-collection", "ghc", "ffi"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423694146, "post_id": 28465113, "comment_id": 45257425, "body": "If you&#39;re worried about a specific foreign export or exports you could add a <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/System-Mem.html#v:performGC\" rel=\"nofollow noreferrer\"><code>performGC</code></a> before returning the <code>Addr</code>."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423695183, "post_id": 28465113, "comment_id": 45257889, "body": "@Cirdec What <code>Addr</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 5, "creation_date": 1423697546, "post_id": 28465113, "comment_id": 45258825, "body": "IIRC, garbage collection gets a chance to run every time Haskell code allocates something. If your program frequently calls into Haskell, this should be enough. Otherwise, if you worry about Haskell retaining memory for too much time, you can trigger a GC calling <code>performGC</code> from C."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423704583, "post_id": 28465113, "comment_id": 45260951, "body": "@chi If you confirm that &quot;IIRC&quot; then this is the answer!"}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1423713411, "post_id": 28465113, "comment_id": 45263150, "body": "I second what chi says about the GC, I&#39;ve learned the same, however I&#39;m not sure how it answers the GC&#39;s ability to predict anything. How would the runtime know that a value will not be needed again from the C side?"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 2, "creation_date": 1423718170, "post_id": 28465113, "comment_id": 45264491, "body": "@MasterMastic The same way it knows when it&#39;s no longer needed from the Haskell side, when there are no more GC roots from which it is reachable. The two most interesting <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch8.html#x15-1560008.4.2\" rel=\"nofollow noreferrer\">basic foreign types</a> are <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Foreign-Ptr.html#t:FunPtr\" rel=\"nofollow noreferrer\"><code>FunPtr</code></a> and <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Foreign-StablePtr.html#t:StablePtr\" rel=\"nofollow noreferrer\"><code>StablePtr</code></a>. When you make a <code>StablePtr</code> or <code>FunPtr</code> new GC roots are created that exist until they are freed."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 1, "creation_date": 1423732682, "post_id": 28465113, "comment_id": 45270805, "body": "@MasterMastic Roughly, when you pass something from Haskell to C, you have to &quot;pin&quot; that data so that it will not be freed by GC. After you know C no longer needs it, you can unpin it. It&#39;s manual and not so convenient, but in C we are used to manual memory management after all, so it&#39;s not so terrible if we also have to do that at the boundary of the two languages."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423734037, "post_id": 28465113, "comment_id": 45271654, "body": "@3noch I&#39;m not confident enough to write an actual answer. I read something in the far past about the GHC runtime, but I&#39;m not an expert about it."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 0, "creation_date": 1426604104, "post_id": 28465113, "comment_id": 46434682, "body": "A downvote? I&#39;m all ears for how to improve my question."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1458368341, "post_id": 36097451, "comment_id": 59840782, "body": "You seem to be on an &quot;answer old questions&quot; kick. Any particular reason, or are you just in the mood?"}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1458368699, "post_id": 36097451, "comment_id": 59840829, "body": "@dfeuer insomnia and an occasional compulsion that overtakes me to try to drive down our unanswered questions ratio."}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 0, "creation_date": 1458600460, "post_id": 36097451, "comment_id": 59924074, "body": "@sclv I&#39;m almost ready to accept this answer, but the meat of my question still remains: when doe the GC actually run? Is it just &quot;when there are allocations&quot; on the Haskell side or something?"}, {"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 0, "creation_date": 1458607768, "post_id": 36097451, "comment_id": 59926418, "body": "@sclv Great! Thank you."}], "tags": [], "owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "is_accepted": true, "score": 3, "last_activity_date": 1458605439, "last_edit_date": 1458605439, "creation_date": 1458357893, "answer_id": 36097451, "question_id": 28465113, "link": "https://stackoverflow.com/questions/28465113/when-does-the-garbage-collector-run-when-calling-haskell-exports-from-c/36097451#36097451", "title": "When does the garbage collector run when calling Haskell exports from C?", "body": "<p>When you initialize the <code>ghc</code> runtime, you can pass rts flags to it via argc and argv <a href=\"https://downloads.haskell.org/~ghc/7.8.4/docs/html/users_guide/ffi-ghc.html#using-own-main\" rel=\"nofollow\">like so</a>:</p>\n\n<pre><code>  RtsConfig conf = defaultRtsConfig;\n  conf.rts_opts_enabled = RtsOptsAll;\n  hs_init_ghc(&amp;argc, &amp;argv, conf);\n</code></pre>\n\n<p>This lets you <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/runtime-control.html#rts-options-gc\" rel=\"nofollow\">set options</a> to, for example fix a smaller maximum heap size or use a compaction algorithm on the nursery to further reduce allocation. Further, note there is an idle GC whose interval can be set (or disabled), and if you link the threaded runtime, that should run whether or not you ever yield back to a Haskell call.</p>\n\n<p><strong>Edit</strong>: I haven't actually performed experimentation to verify the following, but if we look at the <a href=\"http://git.haskell.org/ghc.git/blob/685398ebc5c8377597714cd8c3e97439d32e3a02:/rts/RtsStartup.c#l99\" rel=\"nofollow\">source of hs_init_ghc</a> we see that it initializes signal handlers, which should include the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Commentary/Rts/Signals\" rel=\"nofollow\">timer handlers</a> that respond on <code>SIGVTALRM</code> and indeed it also starts the time, which calls (on POSIX) <a href=\"http://man7.org/linux/man-pages/man2/timer_create.2.html\" rel=\"nofollow\"><code>timer_create</code></a> that should throw those signals on regular intervals. In turn, this periodically should \"wake up\" the RTS whether or not anything is happening, which in turn should mean that it will run idle GC whether or not the system yields back to Haskell from C. But again, I have only read the code and commentary, not tested this myself.</p>\n"}], "owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 487, "favorite_count": 1, "accepted_answer_id": 36097451, "answer_count": 1, "score": 10, "last_activity_date": 1458605439, "creation_date": 1423691088, "question_id": 28465113, "link": "https://stackoverflow.com/questions/28465113/when-does-the-garbage-collector-run-when-calling-haskell-exports-from-c", "title": "When does the garbage collector run when calling Haskell exports from C?", "body": "<p>When exporting a Haskell function to be called from C, when does Haskell's garbage get collected? If C owns <code>main</code> then there is no way to predict the next call in to Haskell. This question is especially pertinent when running single-threaded Haskell or without parallel GC.</p>\n"}, {"tags": ["haskell", "tail-recursion"], "comments": [{"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1423695133, "post_id": 28465034, "comment_id": 45257856, "body": "I&#39;m not even sure there is a way to make this strictly tail recursive."}, {"owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1423695379, "post_id": 28465034, "comment_id": 45257975, "body": "@LouisWasserman It seems to me that it should be possible to get elements of any sequence that you can generate with a loop tail recursively."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1423695429, "post_id": 28465034, "comment_id": 45258005, "body": "Right.  You have to change the algorithm entirely, though, it&#39;s not just a simple transformation."}, {"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 2, "creation_date": 1423695642, "post_id": 28465034, "comment_id": 45258098, "body": "You can always do &quot;tail recursion&quot; the question is whether you are doing tail recursion with a manual stack (which defeats the purpose)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1423697904, "post_id": 28465034, "comment_id": 45258968, "body": "Looking at the original code, and barring the possibility of a mathematical closed form for that, I would try to apply memoization (to achieve dynamic programming) rather than using tail recursion."}], "answers": [{"comments": [{"owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "edited": false, "score": 0, "creation_date": 1423695713, "post_id": 28466118, "comment_id": 45258128, "body": "Isn&#39;t <code>**</code> exponentiation of <code>Floating</code>?"}, {"owner": {"reputation": 666, "user_id": 2942659, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/1460272084/picture?type=large", "display_name": "Aistis Taraskevicius", "link": "https://stackoverflow.com/users/2942659/aistis-taraskevicius"}, "edited": false, "score": 0, "creation_date": 1423696162, "post_id": 28466118, "comment_id": 45258297, "body": "Yep, noticed that integer limits overflows very fast, but this is an assignment and thus I cannot change declarations and have to use Int, even though we are told to run alg (20) and 50 and compare, when it dies on 12 and is incredibly slow on higher numbers while returning zero.."}], "tags": [], "owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "is_accepted": false, "score": 0, "last_activity_date": 1423695642, "last_edit_date": 1423695642, "creation_date": 1423695159, "answer_id": 28466118, "question_id": 28465034, "link": "https://stackoverflow.com/questions/28465034/haskell-tail-recusion-for-multi-call-function/28466118#28466118", "title": "Haskell tail recusion for multi call function", "body": "<p>I think I have a solution, but it's not very elegant or pretty.</p>\n\n<pre><code>alg :: Int -&gt; Int\nalg n | n &lt; 7     -&gt; n\n      | otherwise -&gt; alg' n (repeat 0)\n\nalg' :: Int -&gt; [Int] -&gt; Int\nalg' n [] = error \"something has gone horribly wrong\"\nalg' n l@(x:y)\n  | n &lt; 5     -&gt; error \"something else has gone horribly wrong\"\n  | n == 6    -&gt; product $ zipWith (^) [6,5..1] l\n  | otherwise -&gt; alg' (n-1) $ zipWith (+) [x,x,0,x,0,x] (y ++ [0])\n</code></pre>\n\n<p>The idea is that you can keep track of how many times you're supposed to be multiplying each thing without actually doing any of the calculations until the very end. At any given time, you have information about how many times you've needed any of the next 6 values, and once you're below 7, you just raise 1-6 to the proper powers and take their product.</p>\n\n<p>(I haven't actually tested this, but it seems right. And even if it's not I'm pretty sure the idea behind it is sound)</p>\n\n<p>P.S. As @Guvante says, <code>Int</code> isn't a good choice here as it will quickly overflow. As a general rule I use <code>Integer</code> by default and only switch if I have a good reason.</p>\n"}, {"tags": [], "owner": {"reputation": 17641, "user_id": 16800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1de76c4c343fc844135e18da8a80f1?s=128&d=identicon&r=PG", "display_name": "Guvante", "link": "https://stackoverflow.com/users/16800/guvante"}, "is_accepted": false, "score": 3, "last_activity_date": 1423697420, "last_edit_date": 1423697420, "creation_date": 1423695489, "answer_id": 28466198, "question_id": 28465034, "link": "https://stackoverflow.com/questions/28465034/haskell-tail-recusion-for-multi-call-function/28466198#28466198", "title": "Haskell tail recusion for multi call function", "body": "<p>Have you looked into Fibonacci in Haskell? It is a similar type of function. BTW tail recursion isn't quite the right term in Haskell, as multi-recursion functions can't really be done recursively but Haskell's lazy nature makes a similar but more powerful trick possible. Here is the standard one given:</p>\n\n<pre><code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n</code></pre>\n\n<p>Using the same trick on yours gives EDIT: As a function</p>\n\n<pre><code>alg :: Int -&gt; Int\nalg n = alg' !! (n - 1)\n    where alg' = 1 : 2 : 3 : 4 : 5 : 6 : zipWith4 (\\a b c d -&gt; a * b * c * d) (drop 5 alg') (drop 4 alg') (drop 2 alg') alg'\n</code></pre>\n\n<p>Note that you shouldn't use <code>Int</code> here, that isn't open ended and the 11th term will loop in an <code>Int</code>.</p>\n\n<p>EDIT: Actually <code>Int</code> is even worse than I thought. Once you hit 32 2's in your result you will start returning 0 since every answer is 0 mod 2^32.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2512323"}, "is_accepted": true, "score": 2, "last_activity_date": 1423696278, "creation_date": 1423696278, "answer_id": 28466364, "question_id": 28465034, "link": "https://stackoverflow.com/questions/28465034/haskell-tail-recusion-for-multi-call-function/28466364#28466364", "title": "Haskell tail recusion for multi call function", "body": "<p>From your question it's not entirely clear what is the purpose of making your function tail-recusrive. If you are trying to reduce cpu/memory usage, then you should use memoization (mentioned in the Guvante's answer).</p>\n\n<p>Meanwhile, there is a way to make almost any function tail-recursive, known as <a href=\"http://en.wikipedia.org/wiki/Continuation-passing_style\" rel=\"nofollow\">continuation-passing style</a>. Your example written in the CPS looks like this:</p>\n\n<pre><code>alg_cps :: Integer -&gt; (Integer-&gt;a) -&gt; a\nalg_cps n cont = \n    if n &lt; 7 \n    then cont n \n    else alg_cps (n - 1) \n        (\\x1 -&gt; alg_cps (n - 2) \n            (\\x2 -&gt; alg_cps (n - 4) \n                (\\x3 -&gt; alg_cps (n - 6)\n                    (\\x4 -&gt; cont (x1*x2*x3*x4)))))\n</code></pre>\n\n<p>And to directly get the result you can call it with <code>id</code> as continuation:</p>\n\n<pre><code>alg_cps 20 id\n</code></pre>\n\n<p>Notice that this does not reduce algorithm complexity or memory usage compared to naive non-tail recursive implementation.</p>\n"}, {"comments": [{"owner": {"reputation": 666, "user_id": 2942659, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/1460272084/picture?type=large", "display_name": "Aistis Taraskevicius", "link": "https://stackoverflow.com/users/2942659/aistis-taraskevicius"}, "edited": false, "score": 0, "creation_date": 1423778415, "post_id": 28466524, "comment_id": 45298863, "body": "How would one use this solution, I am having hard time wrapping my head around it"}], "tags": [], "owner": {"reputation": 3632, "user_id": 856079, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/79f1d8ae198abbfd00068fd36cde5eda?s=128&d=identicon&r=PG", "display_name": "rafalio", "link": "https://stackoverflow.com/users/856079/rafalio"}, "is_accepted": false, "score": 0, "last_activity_date": 1423697274, "last_edit_date": 1423697274, "creation_date": 1423696931, "answer_id": 28466524, "question_id": 28465034, "link": "https://stackoverflow.com/questions/28465034/haskell-tail-recusion-for-multi-call-function/28466524#28466524", "title": "Haskell tail recusion for multi call function", "body": "<p>Here is a possible solution.</p>\n\n<pre><code>let f = [1..6] ++ foldr1 (zipWith (*)) [f, drop 2 f, drop 4 f, drop 5 f]\n</code></pre>\n\n<p>or even:</p>\n\n<pre><code>let f = [1..6] ++ foldr1 (zipWith (*)) (map (flip drop $ f) [0,2,4,5])\n</code></pre>\n"}], "owner": {"reputation": 666, "user_id": 2942659, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/1460272084/picture?type=large", "display_name": "Aistis Taraskevicius", "link": "https://stackoverflow.com/users/2942659/aistis-taraskevicius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 1, "accepted_answer_id": 28466364, "answer_count": 4, "score": 2, "last_activity_date": 1423697420, "creation_date": 1423690829, "last_edit_date": 1423693882, "question_id": 28465034, "link": "https://stackoverflow.com/questions/28465034/haskell-tail-recusion-for-multi-call-function", "title": "Haskell tail recusion for multi call function", "body": "<p>Here is non tail recursive function</p>\n\n<pre><code>alg :: Int -&gt; Int\nalg n = if n&lt;7 then n else alg(n-1) * alg(n-2) * alg(n-4) * alg(n-6)\n</code></pre>\n\n<p>I've been stuck on this for a while, I get the basic idea of tail recursion, and how to do it for single call recursive function, but no clue how to do it for multi call one.</p>\n\n<p>Even came up with this abomination </p>\n\n<pre><code>algT :: Int -&gt; Int\nalgT n = tail1 n 0 where tail1 i r = tail1(i-1) r *\n         tail2 n 0 where tail2 i r = tail2(i-2) r *\n         tail3 n 0 where tail3 i r = tail3(i-4) r *\n         tail4 n 0 where tail4 i r = tail4(i-6) r\n</code></pre>\n\n<p>It doesnt work and obviously not how recursive function should look, had few other attempts, but all of them ended in infinite 100% cpu load loop...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1423690959, "post_id": 28464973, "comment_id": 45255797, "body": "I think you want <code>Int -&gt; IO (IO Bool)</code> instead?"}, {"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423699778, "post_id": 28464973, "comment_id": 45259618, "body": "No.  In (perhaps) my na&#239;vet&#233;, I want something akin to <code>getLine</code>, which is an <code>IO String</code>, not an <code>IO (IO String)</code>.  If the <code>Int</code> parameter complicates things, then what about a simple <code>trueThenFalse :: IO Bool</code> which produces one <code>True</code>, then <code>False</code>s forever after?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1423749983, "post_id": 28464973, "comment_id": 45281397, "body": "That is possible with a global state, but you will get only one counter (as <code>getLine</code> has only one input stream). More to the point <code>do let x = trueThenFalse 2 ; a1 &lt;- x ; a2 &lt;- x ; print (a1,a2)</code> must be equivalent to <code>do let x= trueThenFalse 2 ; y = trueThenFalse 2 ; a1 &lt;- x ; a2 &lt;- y ; print (a1,a2)</code>. You can not distinguish between <code>x</code> and <code>y</code> since they are defined in exactly the same way."}], "answers": [{"comments": [{"owner": {"reputation": 483, "user_id": 1864375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b37e4610ebedf3ed6b54a22d3978e53?s=128&d=identicon&r=PG", "display_name": "Itai Zukerman", "link": "https://stackoverflow.com/users/1864375/itai-zukerman"}, "edited": false, "score": 0, "creation_date": 1423692717, "post_id": 28465099, "comment_id": 45256722, "body": "Could always use unsafePerformIO to create the MVar."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "reply_to_user": {"reputation": 483, "user_id": 1864375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b37e4610ebedf3ed6b54a22d3978e53?s=128&d=identicon&r=PG", "display_name": "Itai Zukerman", "link": "https://stackoverflow.com/users/1864375/itai-zukerman"}, "edited": false, "score": 6, "creation_date": 1423692774, "post_id": 28465099, "comment_id": 45256750, "body": "Sure, but then you have to worry about how every time you use unsafePerformIO, a kitten dies, and eventually the ASPCA shows up at your door and everything&#39;s terrible."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 4, "creation_date": 1423696338, "post_id": 28465099, "comment_id": 45258373, "body": "Nested <code>IO</code> is incredibly important. It drives home why <code>IO</code> is a real type, not just some sort of impurity flag."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1423697271, "post_id": 28465099, "comment_id": 45258732, "body": "The state variable hasn&#39;t to be an <code>MVar</code>, an <code>IORef</code> should do unless you plan to use <code>trueThenFalse</code> in multiple threads."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 483, "user_id": 1864375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b37e4610ebedf3ed6b54a22d3978e53?s=128&d=identicon&r=PG", "display_name": "Itai Zukerman", "link": "https://stackoverflow.com/users/1864375/itai-zukerman"}, "edited": false, "score": 0, "creation_date": 1423698291, "post_id": 28465099, "comment_id": 45259105, "body": "@ItaiZukerman, using <code>unsafePerformIO</code> will also make it very very difficult to make sure you have the number of <code>MVar</code>s (or <code>IORef</code>s) that you think you do. The headaches may never end."}, {"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1423700423, "post_id": 28465099, "comment_id": 45259808, "body": "I&#39;ve conceptualized <code>IO a</code> simply as a computation that produces a (probably) different <code>a</code> each time it&#39;s bound to a function.  It&#39;s not clear to me why such a thing cannot be written &quot;directly&quot; (like <code>getLine</code>, an <code>IO String</code> rather than an <code>IO (IO String)</code>) without bringing in what amounts to a mutable variable, something otherwise rarely needed in functional programming, as far as I&#39;ve seen."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1423700519, "post_id": 28465099, "comment_id": 45259831, "body": "You need to setup state, essentially, unless you want all occurrences of this method to use the same counter.  Two calls to trueThenFalse must refer to different counters."}, {"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1423701176, "post_id": 28465099, "comment_id": 45260016, "body": "Okay, but why can&#39;t such state simply reside in a bare <code>IO Bool</code>?  If I&#39;ve conceptualized <code>IO Bool</code> correctly as &quot;a computation that produces a different <code>Bool</code> each time it&#39;s bound to a function,&quot; then why can&#39;t the state just be part of the opaque &quot;computation&quot;?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1423701245, "post_id": 28465099, "comment_id": 45260041, "body": "If you call tTF 3 once, and tTF 3 again, those must use independent counts. Those must return two different IO actions which modify different counters. This requires another IO wrapping.  In your phrasing, it must be a different computation each time."}, {"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1423701620, "post_id": 28465099, "comment_id": 45260121, "body": "Why can&#39;t a function returning an <code>IO Bool</code> return a different computation each time?  A function returning an <code>Int</code> can obviously return a different <code>Int</code> each time."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1423701666, "post_id": 28465099, "comment_id": 45260134, "body": "That second statement is false; Haskell functions must return the same value on the same input each time.  Understand that, and you&#39;ll understand the answer to your question."}, {"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1423702011, "post_id": 28465099, "comment_id": 45260218, "body": "I can&#39;t see how.  As perhaps the most obvious counterexample, <code>id 1 == 1</code>, <code>id 2 == 2</code>, etc.  Different return values, depending on its parameter.  I specifically referred to a &quot;function returning an <code>IO Bool</code>&quot;, which clearly implies that the return value could depend on the parameter."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1423702192, "post_id": 28465099, "comment_id": 45260268, "body": "On the same input, you must always return the same result. As I understand it, tTF n must return different results for the same n, where the results are themselves computations."}, {"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "edited": false, "score": 0, "creation_date": 1423702381, "post_id": 28465099, "comment_id": 45260325, "body": "Not as I understand it.  <code>trueThenFalse 3</code> would return a computation that produces <code>True</code> three times, then <code>False</code>s.  Calling it again would return a computation that also produces <code>True</code> three times, then <code>False</code>s.  Isn&#39;t this the same return value?"}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1423702442, "post_id": 28465099, "comment_id": 45260343, "body": "No, it&#39;s not, it&#39;s an independent counter. The same return value would only return true three times for the life of the program.  There could only ever be one IO Bool, which could only be used three times ever."}, {"owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1423703810, "post_id": 28465099, "comment_id": 45260717, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/70748/discussion-between-sean-and-louis-wasserman\">continue this discussion in chat</a>."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 0, "creation_date": 1423707925, "post_id": 28465099, "comment_id": 45261830, "body": "Each call to tTF n must yield an operation with state independent of each other call, and you can&#39;t do that without IO.  This is not true of e.g. readLine."}], "tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": true, "score": 6, "last_activity_date": 1423691040, "creation_date": 1423691040, "answer_id": 28465099, "question_id": 28464973, "link": "https://stackoverflow.com/questions/28464973/how-would-i-create-an-io-bool-that-returns-true-for-a-while-then-false-thereaft/28465099#28465099", "title": "How would I create an IO Bool that returns True for a while, then False thereafter?", "body": "<p>It might make more sense as an <code>IO (IO Bool)</code>, because you have to set up some state first:</p>\n\n<pre><code>trueThenFalse n = do\n  holder &lt;- newMVar n\n  return (modifyMVar holder (\\ k -&gt; return (k - 1, k &gt; 0)))\n</code></pre>\n\n<p>That creates a mutable holder to store the count of how many Trues are \"left,\" and returns another <code>IO</code> operation which can be run multiple times, modifying the count and returning <code>True</code> if the count was > 0.</p>\n"}], "owner": {"reputation": 27022, "user_id": 182693, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7e4422dd860fce9b9f3c024c8655c7d2?s=128&d=identicon&r=PG&f=1", "display_name": "Sean", "link": "https://stackoverflow.com/users/182693/sean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "accepted_answer_id": 28465099, "answer_count": 1, "score": 2, "last_activity_date": 1423691040, "creation_date": 1423690571, "question_id": 28464973, "link": "https://stackoverflow.com/questions/28464973/how-would-i-create-an-io-bool-that-returns-true-for-a-while-then-false-thereaft", "title": "How would I create an IO Bool that returns True for a while, then False thereafter?", "body": "<p>Today I was trying to deepen my understanding of the IO monad, and I tried to write a function that take an <code>Int</code> <code>n</code> and returns an <code>IO Bool</code> than produces <code>True</code> <code>n</code> times, then <code>False</code> forever afterwards.</p>\n\n<pre><code>trueThenFalse :: Int -&gt; IO Bool\n</code></pre>\n\n<p>Normally I'd address something like this with recursion, but here there seems to be nothing to recurse into.</p>\n\n<p>How would I go about implementing this function?  Is it possible and/or advisable to do so?</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 251, "user_id": 1564106, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35d895ec931b2609c500431c4730adae?s=128&d=identicon&r=PG", "display_name": "bpaterni", "link": "https://stackoverflow.com/users/1564106/bpaterni"}, "edited": false, "score": 0, "creation_date": 1423695820, "post_id": 28463991, "comment_id": 45258173, "body": "Thanks Sibi. Both examples seem to work. Though there is one small issue with the second, in that compiling Main depends on SimpleJSON&#39;s interface file. Simply swapping the order does the trick for me. Thanks to chi as well. <code>--make</code> looks to be a pretty powerful tool provided by ghc!"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 5, "last_activity_date": 1423779129, "last_edit_date": 1423779129, "creation_date": 1423686942, "answer_id": 28463991, "question_id": 28463916, "link": "https://stackoverflow.com/questions/28463916/real-world-haskell-chapter-5-simplejson-compile-error/28463991#28463991", "title": "Real World Haskell, Chapter 5, SimpleJSON compile error", "body": "<p>This should work:</p>\n\n<pre><code>ghc -o simple Main.hs SimpleJSON.hs\n</code></pre>\n\n<p>Or even something like this should work:</p>\n\n<pre><code>ghc -c SimpleJSON.hs\nghc -c Main.hs\nghc -o simple Main.o SimpleJSON.o\n</code></pre>\n\n<p>Or as @chi points out, you can use this:</p>\n\n<pre><code>ghc --make SimpleJSON.hs Main.hs\n</code></pre>\n"}], "owner": {"reputation": 251, "user_id": 1564106, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35d895ec931b2609c500431c4730adae?s=128&d=identicon&r=PG", "display_name": "bpaterni", "link": "https://stackoverflow.com/users/1564106/bpaterni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 28463991, "answer_count": 1, "score": 2, "last_activity_date": 1439510468, "creation_date": 1423686694, "last_edit_date": 1495541172, "question_id": 28463916, "link": "https://stackoverflow.com/questions/28463916/real-world-haskell-chapter-5-simplejson-compile-error", "title": "Real World Haskell, Chapter 5, SimpleJSON compile error", "body": "<p>According to <a href=\"https://stackoverflow.com/questions/23727768/which-part-of-real-world-haskell-is-now-obsolete-or-considered-bad-practise\">another question</a>, parts of Real World Haskell are now obsolete. I'm only on Chapter 5, but I'm having problems compiling a simple example to an executable binary.</p>\n\n<p>Two modules are given:</p>\n\n<pre><code>module SimpleJSON\n    (\n      JValue(..)\n    , getString\n    , getInt\n    , getDouble\n    , getBool\n    , getObject\n    , getArray\n    , isNull\n    ) where\n\ndata JValue = JString String\n            | JNumber Double\n            | JBool   Bool\n            | JNull\n            | JObject [ (String, JValue) ]\n            | JArray [ JValue ]\n              deriving (Eq, Ord, Show)\n\ngetString :: JValue -&gt; Maybe String\ngetString (JString s) = Just s\ngetString _           = Nothing\n\ngetInt (JNumber n)    = Just (truncate n)\ngetInt _              = Nothing\n\ngetDouble (JNumber n) = Just n\ngetDouble _           = Nothing\n\ngetBool (JBool b)     = Just b\ngetBool _             = Nothing\n\ngetObject (JObject o) = Just o\ngetObject _           = Nothing\n\ngetArray (JArray a)   = Just a\ngetArray _            = Nothing\n\nisNull v              = v == JNull\n</code></pre>\n\n<p>and</p>\n\n<pre><code>module Main () where\n\nimport SimpleJSON\n\nmain = print (JObject [ (\"foo\", JNumber 1), (\"bar\", JBool False ) ])\n</code></pre>\n\n<p>with instructions to compile a SimpleJSON object file first:</p>\n\n<pre><code>$ ghc -c SimpleJSON.hs\n</code></pre>\n\n<p>followed by linking the executable:</p>\n\n<pre><code>$ ghc -o simple Main.hs SimpleJSON.o\n</code></pre>\n\n<p>which results in an error stating that 'main' is not exported:</p>\n\n<pre><code>[2 of 2] Compiling Main             ( Main.hs, Main.o )\n\nMain.hs:1:1:\n    The main function `main' is not exported by module `Main'\n</code></pre>\n\n<p>However, if I add <code>main</code> to the export list or omit the empty export list, I see lots of multiple definition errors during the linking phase:</p>\n\n<pre><code>Linking simple ...\nSimpleJSON.o:(.data+0x0): multiple definition of `__stginit_SimpleJSON'\n./SimpleJSON.o:(.data+0x0): first defined here\nSimpleJSON.o:(.data+0x0): multiple definition of `SimpleJSON_getArray_closure'\n./SimpleJSON.o:(.data+0x0): first defined here\n....\n(.text+0x2d40): multiple definition of `SimpleJSON_JObject_static_info'\n./SimpleJSON.o:(.text+0x2d40): first defined here\nSimpleJSON.o: In function `SimpleJSON_JArray_info':\n(.text+0x2d80): multiple definition of `SimpleJSON_JArray_static_info'\n./SimpleJSON.o:(.text+0x2d80): first defined here\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>Assuming this error is the result of obsolete code or obsolete ghc interface presented by the text, what would be the proper way to compile this SimpleJSON example?</p>\n"}, {"tags": ["haskell", "functional-programming"], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 7, "last_activity_date": 1423668061, "last_edit_date": 1423668061, "creation_date": 1423667575, "answer_id": 28457751, "question_id": 28457537, "link": "https://stackoverflow.com/questions/28457537/why-doesnt-f-need-a-type-annotation/28457751#28457751", "title": "Why doesn&#39;t f=(+) need a type annotation?", "body": "<blockquote>\n  <p>I mean, why don't I need to declare <code>f</code> as <code>(+) :: (Num a) =&gt; a \u2013&gt; a \u2013&gt; a</code>?</p>\n</blockquote>\n\n<p>You do need to do that, if you declare the signature of <code>f</code> at all. But if you don't, the compiler will &ldquo;guess&rdquo; the signature itself &ndash; in this case this isn't all to remarkable since it can basically just copy&amp;paste the signature of <code>(+)</code>. And that's precisely what it will do.</p>\n\n<p>...or at least what it should do. It does, provided you have the <code>-XNoMonomorphism</code> flag on. Otherwise, well, the <a href=\"https://wiki.haskell.org/Monomorphism_restriction\" rel=\"noreferrer\">dreaded monomorphism restriction</a> steps in because <code>f</code>'s definition is of the shape <a href=\"https://wiki.haskell.org/CAF\" rel=\"noreferrer\"><em>ConstantApplicativeForm = Value</em></a>; that makes the compiler dumb down the signature to the next best <em>non-polymorphic</em> type it can find, namely <code>Integer -&gt; Integer -&gt; Integer</code>. To prevent this, you should in fact supply the right signature by hand, for all top-level functions. That also prevents a lot of confusion, and many errors become way less confusing.</p>\n\n<p>The monomorphism restriction is the reason</p>\n\n<pre><code>f = succ\n</code></pre>\n\n<p>won't work on its own: because it also has this CAF shape, the compiler does not try to infer the correct polymorphic type, but tries to find some concrete instantiation to make a monomorphic signature. But unlike <code>Num</code>, the <code>Enum</code> class does not offer a default instance.</p>\n\n<p>Possible solutions, ordered by preference:</p>\n\n<ol>\n<li><em>Always add signatures.</em> You really should.</li>\n<li>Enable <code>-XNoMonomorphismRestriction</code>.</li>\n<li>Write your function definitions in the form <code>f a = succ a</code>, <code>f a b = a+b</code>. Because there are explicitly mentioned arguments, these don't qualify as CAF, so the monomorphism restriction won't kick in.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 725, "user_id": 496426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d66dddc305fb73168919883b985ab794?s=128&d=identicon&r=PG", "display_name": "Kris", "link": "https://stackoverflow.com/users/496426/kris"}, "is_accepted": false, "score": 0, "last_activity_date": 1423667626, "creation_date": 1423667626, "answer_id": 28457769, "question_id": 28457537, "link": "https://stackoverflow.com/questions/28457537/why-doesnt-f-need-a-type-annotation/28457769#28457769", "title": "Why doesn&#39;t f=(+) need a type annotation?", "body": "<p>Haskell defaults <code>Num</code> constraints to <code>Int</code> or <code>Integer</code>, I forget which.</p>\n"}, {"comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1423695583, "post_id": 28457777, "comment_id": 45258073, "body": "When exactly does this reduction happen? <code>f = (+)</code> in ghci is not restricted."}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 1, "creation_date": 1423698773, "post_id": 28457777, "comment_id": 45259257, "body": "@Bergi - the answer is here: <a href=\"http://stackoverflow.com/questions/28336108/why-is-22-0-double-in-a-hs-file-but-fractional-a-a-in-ghci/28336620#28336620\" title=\"why is 22 0 double in a hs file but fractional a a in ghci\">stackoverflow.com/questions/28336108/&hellip;</a>"}], "tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": true, "score": 14, "last_activity_date": 1423667652, "creation_date": 1423667652, "answer_id": 28457777, "question_id": 28457537, "link": "https://stackoverflow.com/questions/28457537/why-doesnt-f-need-a-type-annotation/28457777#28457777", "title": "Why doesn&#39;t f=(+) need a type annotation?", "body": "<p>Because of defaulting.  <code>Num</code> is a 'defaultable' type class, meaning that if you leave it un-constrained, the compiler will make a few intelligent guesses as to which type you meant to use it as.  Try putting that definition in a module, then running</p>\n\n<pre><code>:t f\n</code></pre>\n\n<p>in <code>ghci</code>; it should tell you (IIRC) <code>f :: Integer -&gt; Integer -&gt; Integer</code>.  The compiler didn't know which <code>a</code> you wanted to use, so it guessed <code>Integer</code>; and since that worked, it went with that guess.</p>\n\n<p>Why didn't it infer a polymorphic type for <code>f</code>?  Because of the dreaded[1] monomorphism restriction.  When the compiler sees</p>\n\n<pre><code>f = (+)\n</code></pre>\n\n<p>it thinks '<code>f</code> is a value', which means it needs a single (monomorphic) type.  Eta-expand the definition to</p>\n\n<pre><code>f x = (+) x\n</code></pre>\n\n<p>and you will get the polymorphic type</p>\n\n<pre><code>f :: Num a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>and similarly if you eta-expand your first definition</p>\n\n<pre><code>f x = succ x\n</code></pre>\n\n<p>you don't need a type signature any more.</p>\n\n<p>[1] Actual name from the GHC documentation!</p>\n"}], "owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 28457777, "answer_count": 3, "score": 10, "last_activity_date": 1423671862, "creation_date": 1423666966, "last_edit_date": 1423671862, "question_id": 28457537, "link": "https://stackoverflow.com/questions/28457537/why-doesnt-f-need-a-type-annotation", "title": "Why doesn&#39;t f=(+) need a type annotation?", "body": "<p>I mean, for example,</p>\n\n<pre><code>f :: (Enum a) =&gt; a -&gt; a --without this line, there would be an error\nf = succ\n</code></pre>\n\n<p>It's because <code>succ</code> needs its parameter to be enumerable (<code>succ :: (Enum a) =&gt; a -&gt; a</code>)</p>\n\n<p>but for <code>(+)</code></p>\n\n<pre><code>f = (+) --ok\n</code></pre>\n\n<p>Though <code>(+)</code>'s declaration is <code>(+) :: (Num a) =&gt; a \u2013&gt; a \u2013&gt; a</code>.</p>\n\n<p>I mean, why don't I need to declare <code>f</code> as <code>f :: (Num a) =&gt; a \u2013&gt; a \u2013&gt; a</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1423666376, "post_id": 28457098, "comment_id": 45241087, "body": "Note that such <code>Show</code> and <code>Read</code> instances are shunned in Haskell: <code>show</code> should produce valid Haskell code, so <code>&quot;?&quot;</code> won&#39;t do as a result. If what you&#39;re trying to do is just pretty printing, e.g. for ghci, then you should stay with the <code>Maybe</code> container and just <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/interactive-evaluation.html#ghci-interactive-print\" rel=\"nofollow noreferrer\">use a suitable pretty-printing function</a>."}, {"owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1423666827, "post_id": 28457098, "comment_id": 45241393, "body": "It&#39;s maybe not a good idea for me to use the standard <code>Maybe</code> container because I made the <code>Eq</code> instance of <code>Defined</code> type with differing behaviour"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1423667115, "post_id": 28457098, "comment_id": 45241588, "body": "An <code>Eq</code> instance with differing behaviour? I wager that&#39;s an even worse idea (but if you properly hide the <code>Undefined</code> constructor, it might be ok). At any rate, you shouldn&#39;t let the <code>show (Is a)</code> print out <i>only</i> the <code>a</code> value, without ever mentioning it was wrapped in a <code>Defined</code>."}, {"owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1423667958, "post_id": 28457098, "comment_id": 45242177, "body": "<code>(Nothing == Nothing)</code> is <code>True</code> in the implementation of <code>Eq</code> for <code>Maybe</code> that&#39;s not I want for <code>Defined</code> type, so I have to create my own type or overload <code>Eq</code> for <code>Maybe</code> that&#39;s even worse."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1423668355, "post_id": 28457098, "comment_id": 45242448, "body": "Well, but you should not want <code>Undefined == Undefined</code> to be false! At least not unless <code>Undefined</code> is really some kind of exceptional value that wouldn&#39;t ever appear in applications. (Yes, I know that analogously, for floating-point numbers IEEE754 specifies <code>NaN == NaN</code> to be false, but that&#39;s truely a horrible hack that has caused lots of problems of its own.)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423677001, "post_id": 28457098, "comment_id": 45247986, "body": "The right way to deal with equality is to make your type an instance of <code>Applicative</code> (just like <code>Maybe</code>), and then use <code>definedEqual :: Eq e =&gt; Defined e -&gt; Defined e -&gt; Defined Bool</code>, defined as <code>definedEqual a b = (==) &lt;$&gt; a &lt;*&gt; b</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1423689627, "post_id": 28457098, "comment_id": 45255088, "body": "Some food for thought: is <code>read &quot;?&quot; :: Defined (Defined Bool)</code> equal to <code>Is Undefined</code> or <code>Undefined</code>? How would you get the other one out of <code>read</code>? Can you distinguish between them with your definition of <code>show</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1423666561, "last_edit_date": 1423666561, "creation_date": 1423666150, "answer_id": 28457241, "question_id": 28457098, "link": "https://stackoverflow.com/questions/28457098/read-instance-in-haskell/28457241#28457241", "title": "Read instance in Haskell", "body": "<blockquote>\n  <p><code>readsPrec 0 s</code> try to read the same string such as in input, isn't it?</p>\n</blockquote>\n\n<p>Yes it is, but it's not the same <code>readsPrec</code>! Let me add a few type annotations:</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n\ninstance Read a =&gt; Read (Defined a) where\n  readsPrec _ = readsDefined\n\nreadsDefined :: forall a . Read a =&gt; String -&gt; ReadS (Defined a)\nreadsDefined s = case (take 1 s) of\n                    \"?\" -&gt; [(Undefined,tail s)]\n                    otherwise -&gt; map (\\(a,b) -&gt; (Is a,b)) $ readsContent s\n where readsContent :: String -&gt; ReadS a\n       readsContent = readsPrec 0\n</code></pre>\n\n<p>Note that I can not replace <code>readsContent</code> with <code>readsDefined</code> here, they're two different functions with incompatible type signature. That's the same situation as in your code, only, there <code>readsDefined</code> and <code>readsContent</code> are both (different) instantiations of the <code>readsPrec</code> method, i.e. they share the same <em>name</em> but still have different implementations.</p>\n"}], "owner": {"reputation": 1131, "user_id": 2615160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6c82d2b99325ea24eedae70d7ea24bc8?s=128&d=identicon&r=PG", "display_name": "Sergey Sosnin", "link": "https://stackoverflow.com/users/2615160/sergey-sosnin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 0, "accepted_answer_id": 28457241, "answer_count": 1, "score": 4, "last_activity_date": 1423666561, "creation_date": 1423665802, "question_id": 28457098, "link": "https://stackoverflow.com/questions/28457098/read-instance-in-haskell", "title": "Read instance in Haskell", "body": "<p>I have created a type similar to <code>Maybe</code></p>\n\n<p><code>data Defined a = Is a | Undefined</code></p>\n\n<p>I made the <code>Show</code> instnance</p>\n\n<pre><code>instance Show a =&gt; Show (Defined a) where\n    show (Is a) = show a\n    show Undefined = \"?\"\n</code></pre>\n\n<p>So, I try to implement the instance <code>Read</code> </p>\n\n<pre><code>instance Read a =&gt; Read (Defined a) where\n    readsPrec _ s = case (take 1 s) of\n                    \"?\" -&gt; [(Undefined,tail s)]\n                    otherwise -&gt; map (\\(a,b) -&gt; (Is a,b)) $ readsPrec 0 s\n</code></pre>\n\n<p>That's work, but I can't understand why. Why there is no infinite loop here:</p>\n\n<pre><code>otherwise -&gt; map (\\(a,b) -&gt; (Is a,b)) $ readsPrec 0 s\n</code></pre>\n\n<p><code>readsPrec 0 s</code> try to read the same string such as in input, isn't it? So it have to go to <code>otherwise</code> block yet and form an infinite loop. But the code is really works. </p>\n"}, {"tags": ["haskell", "pattern-matching", "pattern-guards"], "answers": [{"comments": [{"owner": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "edited": false, "score": 0, "creation_date": 1423659860, "post_id": 28455075, "comment_id": 45236815, "body": "I guess this explains things :)"}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 26, "last_activity_date": 1451510288, "last_edit_date": 1451510288, "creation_date": 1423659745, "answer_id": 28455075, "question_id": 28454860, "link": "https://stackoverflow.com/questions/28454860/warning-that-pattern-guard-is-non-exhaustive-even-though-it-is/28455075#28455075", "title": "Warning that pattern guard is non-exhaustive even though it is", "body": "<p>There is a long 10 year old <a href=\"https://ghc.haskell.org/trac/ghc/ticket/595\" rel=\"nofollow\">ticket</a> about that. Basically: exhaustive checking in ghc is waiting for the hero.</p>\n\n<p><strong>Added:</strong> The issue was closed today. I just checked, the code doesn't produce non-exhaustive warning any more. Hopefully it will be part of <code>ghc-8.0</code>.</p>\n"}], "owner": {"reputation": 2527, "user_id": 1396134, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/85ae7e9104d0484386cbb4ac7791ad8f?s=128&d=identicon&r=PG", "display_name": "raichoo", "link": "https://stackoverflow.com/users/1396134/raichoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 610, "favorite_count": 0, "accepted_answer_id": 28455075, "answer_count": 1, "score": 21, "last_activity_date": 1451510288, "creation_date": 1423659112, "question_id": 28454860, "link": "https://stackoverflow.com/questions/28454860/warning-that-pattern-guard-is-non-exhaustive-even-though-it-is", "title": "Warning that pattern guard is non-exhaustive even though it is", "body": "<p>I'm observing an interesting behavior when using pattern matching with pattern guards and all warnings turned on</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\nmodule Mood where\n\ndata Mood = Happy\n          | Indifferent\n          | Sad\n          deriving Show\n\nflipMood :: Mood -&gt; Mood\nflipMood Happy       = Sad\nflipMood Indifferent = Indifferent\nflipMood Sad         = Happy\n\nflipMood' :: Mood -&gt; Mood\nflipMood' mood\n  | Happy       &lt;- mood = Sad\n  | Indifferent &lt;- mood = Indifferent\n  | Sad         &lt;- mood = Happy\n</code></pre>\n\n<p>Even though <code>flipMood</code> and <code>flipMood'</code> are pretty much doing the same thing I get the following error message:</p>\n\n<pre><code>Mood.hs:15:1: Warning:\n    Pattern match(es) are non-exhaustive\n    In an equation for \u2018flipMood'\u2019: Patterns not matched: _\nOk, modules loaded: Mood.\n</code></pre>\n\n<p>and therefore need to add a catch all case like</p>\n\n<pre><code>| otherwise = mood\n</code></pre>\n\n<p>to satisfy the exhaustiveness checker.</p>\n\n<p>Core seems to be just fine with these two functions behaving the same:</p>\n\n<pre><code>flipMood =\n  \\ ds_dTh -&gt;\n    case ds_dTh of _ {\n      Happy -&gt; Sad;\n      Indifferent -&gt; Indifferent;\n      Sad -&gt; Happy\n    }\n\nflipMood' = flipMood\n</code></pre>\n\n<p>With optimizations turned off I get the following Core output which seems to explain this behavior:</p>\n\n<pre><code>flipMood' =\n  \\ mood_axV -&gt;\n    case mood_axV of wild_X9 {\n      __DEFAULT -&gt;\n        case wild_X9 of _ {\n          Indifferent -&gt; Indifferent;\n          Sad -&gt; Happy\n        };\n      Happy -&gt; Sad\n    }\n</code></pre>\n\n<p>Why is it behaving this way? Am I missing something?</p>\n\n<p>Kind regards,\nraichoo</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 680, "user_id": 839803, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c1b931b7aa0917cffb80ad4449f04461?s=128&d=identicon&r=PG", "display_name": "Julio", "link": "https://stackoverflow.com/users/839803/julio"}, "edited": false, "score": 3, "creation_date": 1423655957, "post_id": 28453195, "comment_id": 45234561, "body": "@Julio Using the <code>-Wall</code> GHC flag would have triggered a warning for the shadowing of the global <code>max</code>, pointing to the problem."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": true, "score": 3, "last_activity_date": 1423654111, "creation_date": 1423654111, "answer_id": 28453195, "question_id": 28453149, "link": "https://stackoverflow.com/questions/28453149/strange-compile-error-in-haskell/28453195#28453195", "title": "Strange compile error in Haskell", "body": "<p>Your error is in</p>\n\n<pre><code>lastProdAndMax (prod, max) i = (nextProd, max prod nextProd) \n                      ^^^\n</code></pre>\n\n<p>in that scope, <code>max</code> is a <code>Int</code> (overloading the <code>max</code> function).</p>\n"}], "owner": {"reputation": 680, "user_id": 839803, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c1b931b7aa0917cffb80ad4449f04461?s=128&d=identicon&r=PG", "display_name": "Julio", "link": "https://stackoverflow.com/users/839803/julio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 28453195, "answer_count": 1, "score": 0, "last_activity_date": 1423654111, "creation_date": 1423653946, "question_id": 28453149, "link": "https://stackoverflow.com/questions/28453149/strange-compile-error-in-haskell", "title": "Strange compile error in Haskell", "body": "<p>Why does the type of <code>max prod nextProd</code> get inferred as <code>Int-&gt;Int-&gt;Int</code> instead of just Int in the below function?</p>\n\n<pre><code>import qualified Data.Vector as DV\n\nlargestProduct::DV.Vector Int-&gt;(Int, Int)\nlargestProduct digits = foldl lastProdAndMax (0,0) [1..((DV.length digits) - 13)] where\n    lastProdAndMax _ 1 = (first, first) where first = DV.foldl (*) 1 $ DV.take 13 digits\n    lastProdAndMax (prod, max) i = (nextProd, max prod nextProd)\n        where nextProd = (prod `div` ((DV.!) digits (i-13))) * ((DV.!) digits i)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 7, "creation_date": 1423652911, "post_id": 28452203, "comment_id": 45232691, "body": "In general for performance-related questions (as <a href=\"http://stackoverflow.com/tags/haskell/info\">said in the Haskell tag FAQ</a>!), please make sure you&#39;ve actually used meaningful test cases, and considered optimisation options. You should tell us exactly what you&#39;ve tested, and what timings you got. Your two approaches are so different (they do not even give the same results!) that I find it hard to understand how you even tried to compare them."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1423673616, "post_id": 28452203, "comment_id": 45245941, "body": "@leftaroundabout There&#39;s an off-by-one error, but otherwise they give the same results."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423675870, "post_id": 28452762, "comment_id": 45247296, "body": "If you compile with <code>-O2</code> and use the type signature indicated by the OP, GHC figures out the strictness on its own. I think &#216;rjan Johansen got this one."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 5, "last_activity_date": 1423653224, "last_edit_date": 1423653224, "creation_date": 1423652712, "answer_id": 28452762, "question_id": 28452203, "link": "https://stackoverflow.com/questions/28452203/why-haskell-list-comprehension-is-faster-than-loop/28452762#28452762", "title": "Why Haskell list comprehension is faster than loop", "body": "<p>First some style advice:</p>\n\n<pre><code>lg s e a\n  | s &gt;= e     = a\n  | even s     = lg (s+1) e (a+1)\n  | otherwise  = lg (s+1) e (a*2)\n</code></pre>\n\n<p>Regarding your question: <code>lg</code> is not really a loop. It's a tail-recursive function, but that alone doesn't say much in Haskell. The main thing that gets in the way is lazyness: if the accumulators are only accumulated in the thunk-dimension, rather than their values, lazyness merely builds up an enourmous amount of overhead without any usability gain.</p>\n\n<p>A simple way to prevent this is to evaluate arguments strictly, with</p>\n\n<pre><code>{-# LANGUAGE BangPatterns     #-}\n\nlg' s e !a\n  | s &gt;= e     = a\n  | even s     = lg' (s+1) e (a+1)\n  | otherwise  = lg' (s+1) e (a*2)\n</code></pre>\n\n<p>However, because of such issues but also because of conciseness/modularity/..., it is rather preferred not to write tail-recursive functions at all but use higher level-tools &ndash; list comprehensions themselves are often <em>not</em> that great performance-wise, but if you express your algorithms in terms of generic folds etc. you can utilise much more performant data structures such as unboxed vectors with little changes to your code.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423675985, "post_id": 28460060, "comment_id": 45247372, "body": "You might want to mention that the algorithm is called &quot;fast exponentiation&quot;, or &quot;exponentiation by squaring&quot;."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1423683992, "post_id": 28460060, "comment_id": 45252086, "body": "+1, this does indeed much better adress the specific code the OP posted than my answer. \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 \u2014 Oh, right, I still can&#39;t start comments with &quot;+1&quot;, but wasn&#39;t it possible to disable this by adding enough text? Hm, I think I read that in <a href=\"http://meta.stackoverflow.com/questions/283874/remove-the-limitation-that-stops-comments-from-starting-with-1-or-1/283953#283953\">this post on meta</a>... oh my, it&#39;s such a useless restriction... (Sorry for the spam.)"}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 4, "last_activity_date": 1423697840, "last_edit_date": 1423697840, "creation_date": 1423674000, "answer_id": 28460060, "question_id": 28452203, "link": "https://stackoverflow.com/questions/28452203/why-haskell-list-comprehension-is-faster-than-loop/28460060#28460060", "title": "Why Haskell list comprehension is faster than loop", "body": "<p>Apart from the more complicated thunk issues @leftaroundabout mentions, I can think of two <em>algorithmic</em> reasons why the list comprehension could be more efficient than you think:</p>\n\n<ul>\n<li>Because of laziness, only <em>one</em> of the list elements is actually evaluated. So only one exponentiation is performed.</li>\n<li>Haskell's <code>^</code> is more clever than simply multiplying in a loop: It uses division by 2 internally to greatly reduce the number of multiplications needed. E.g. <code>x^8</code> becomes \"essentially\" <code>let x2 = x*x; x4 = x2*x2 in x4*x4</code>. (EDIT: As @dfeuer points out, this is known as \"fast exponentiation\" or \"exponentiation by squaring\".)</li>\n</ul>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 0, "accepted_answer_id": 28452762, "answer_count": 2, "score": 1, "last_activity_date": 1423697840, "creation_date": 1423651249, "question_id": 28452203, "link": "https://stackoverflow.com/questions/28452203/why-haskell-list-comprehension-is-faster-than-loop", "title": "Why Haskell list comprehension is faster than loop", "body": "<p>I'm a Haskell noob. And while experimenting with loops and list comprehensions I have discovered that list comprehension is faster than a loop. Lisp comprehension uses exponentiation and is still faster. Why?</p>\n\n<pre><code>lg :: Int -&gt; Int -&gt; Int -&gt; Int\nlg s e a =\n  if s &lt; e\n  then\n  if even s\n  then\n    lg (s+1) e (a+1)\n  else\n    lg (s+1) e (a*2)\n  else\n    a\n\nloopGrowth :: Int -&gt; Int\nloopGrowth x = lg 0 x 0\n\ncalcGrowth :: Int -&gt; Int\ncalcGrowth y =\n  last (take (y+1) (tail (join [ [2 ^ x - 2 ,2 ^ x - 1] | x &lt;- [1..50] ])))\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1423647631, "post_id": 28450918, "comment_id": 45229635, "body": "Use <code>if w `member` d then putStrLn d else return ()</code> (the else is mandatory) or  use <code>when</code> instead."}, {"owner": {"reputation": 71, "user_id": 2017558, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/dedcb5b48f5ff301177b2a1d31da1e82?s=128&d=identicon&r=PG", "display_name": "anujuhi01", "link": "https://stackoverflow.com/users/2017558/anujuhi01"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423647958, "post_id": 28450918, "comment_id": 45229824, "body": "I did     <code>spell d w = when (w </code>member` d) (putStrLn w) `  ,still its gives no output."}, {"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "edited": false, "score": 0, "creation_date": 1423648970, "post_id": 28450918, "comment_id": 45230426, "body": "Check the type of dict in ghci. I suspect you&#39;re not generating the map as you expect"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1423649006, "post_id": 28450918, "comment_id": 45230454, "body": "It would be easy for other to read your code if you could also add your import statements. From where exactly <code>member</code> and <code>fromList</code> is coming ?"}, {"owner": {"reputation": 71, "user_id": 2017558, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/dedcb5b48f5ff301177b2a1d31da1e82?s=128&d=identicon&r=PG", "display_name": "anujuhi01", "link": "https://stackoverflow.com/users/2017558/anujuhi01"}, "edited": false, "score": 0, "creation_date": 1423649661, "post_id": 28450918, "comment_id": 45230834, "body": "<code>member</code> and <code>fromList</code> belong to Data.set"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1423649899, "post_id": 28450918, "comment_id": 45230968, "body": "Does &quot;abbreviations.txt&quot; still contain lines that say &quot;ix=index&quot;? In which case, your dictionary contains not &quot;ix&quot; or &quot;index&quot; but &quot;ix=index&quot;?"}, {"owner": {"reputation": 71, "user_id": 2017558, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/dedcb5b48f5ff301177b2a1d31da1e82?s=128&d=identicon&r=PG", "display_name": "anujuhi01", "link": "https://stackoverflow.com/users/2017558/anujuhi01"}, "edited": false, "score": 0, "creation_date": 1423650068, "post_id": 28450918, "comment_id": 45231059, "body": "Yes,true.It contains the abbreviated words and their actual meaning in the given format."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 2017558, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/dedcb5b48f5ff301177b2a1d31da1e82?s=128&d=identicon&r=PG", "display_name": "anujuhi01", "link": "https://stackoverflow.com/users/2017558/anujuhi01"}, "edited": false, "score": 0, "creation_date": 1423806174, "post_id": 28451827, "comment_id": 45306788, "body": "Instead of the upper code,I tried reading a file using <code>hgetLine</code> then converting it into list of words using <code>words</code>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 3, "last_activity_date": 1423650090, "creation_date": 1423650090, "answer_id": 28451827, "question_id": 28450918, "link": "https://stackoverflow.com/questions/28450918/expanding-the-abbreviated-words-from-a-file-in-haskell/28451827#28451827", "title": "Expanding the abbreviated words from a file in Haskell", "body": "<p>First, there is a problem with your spell function. It should also have an else clause with it:</p>\n\n<pre><code>spell :: (Show a, Ord a) =&gt; Set a -&gt; a -&gt; IO ()\nspell d w = if (w `member` d) \n            then print d\n            else return ()\n</code></pre>\n\n<p>Also, note that I have changed your <code>putStrLn</code> to <code>print</code> and added a type signature to your code.</p>\n\n<blockquote>\n  <p>On executing the code it is giving no output.</p>\n</blockquote>\n\n<p>That's because, it's always going to the else clause in your <code>spell</code> function. If you try to trace up the execution of your program, then you will note that, your <code>dict</code> variable will actually contain this Set: <code>[\"ctr=counter\",\"ix=index\",\"tbl=table\"]</code> and it doesn't contains the words of the file <code>main.c</code>. I hope this will be sufficient to get you started.</p>\n"}], "owner": {"reputation": 71, "user_id": 2017558, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/dedcb5b48f5ff301177b2a1d31da1e82?s=128&d=identicon&r=PG", "display_name": "anujuhi01", "link": "https://stackoverflow.com/users/2017558/anujuhi01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1423806440, "creation_date": 1423647445, "last_edit_date": 1423806440, "question_id": 28450918, "link": "https://stackoverflow.com/questions/28450918/expanding-the-abbreviated-words-from-a-file-in-haskell", "title": "Expanding the abbreviated words from a file in Haskell", "body": "<p>I am new at working with files in haskell.I wrote a code to check for occurence of words in a <code>.c</code> file. words are listed in a <code>.txt</code> file .</p>\n\n<p>for example:</p>\n\n<pre><code>abbreviations.txt\nix=index\nctr=counter\ntbl=table\n</code></pre>\n\n<p>Another file is:</p>\n\n<pre><code> main.c\n main ()\n {\nix = 1\nfor (ctr =1; ctr &lt; 10; ctr++)\n{ \n   tbl[ctr] = ix\n}\n}\n</code></pre>\n\n<p>on encountering <code>ix</code> it should be expanded to <code>index</code> and same for <code>ctr</code> and <code>tbl</code>.</p>\n\n<p>This is the code I wrote to check for occurrences(not yet to replace the encountered words)</p>\n\n<pre><code>import System.Environment\nimport System.IO\nimport Data.Char\nimport Control.Monad\nimport Data.Set\n\nmain = do\n    s &lt;- getLine\n    f &lt;- readFile \"abbreviations.txt\"\n    g &lt;- readFile s\n    let dict = fromList (lines f)\n    mapM_ (spell dict) (words g)\n\nspell d w =  when (w `member` d) (putStrLn w)\n</code></pre>\n\n<p>On executing the code it is giving no output.</p>\n\n<p>Instead of the upper code,I tried reading a file using <code>hgetLine</code> then converting it into list of words using <code>words</code></p>\n\n<pre><code>        getLines' h = do\n           isEOF &lt;- hIsEOF h\n           if isEOF then\n            return ()\n           else\n            do\n             line &lt;- hGetLine h\n             list&lt;-remove (return (words line))\n             getLines' h\n           --  print  list\n   main = do\n       inH &lt;- openFile \"abbreviations.txt\" ReadMode\n       getLines' inH\n       hClose inH\n\n\n   remove [] =  []\n    remove (x:xs)| x == \"=\" = remove xs\n                       | otherwise = x:remove (xs)\n</code></pre>\n\n<p>But its giving me errors relating to IO() ,is there any other way in which I could do the following.</p>\n\n<p>Where am I going wrong?</p>\n\n<p>Thank you for any help.</p>\n"}, {"tags": ["haskell", "syntax", "indentation", "let", "do-notation"], "comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 3, "creation_date": 1423641199, "post_id": 28448931, "comment_id": 45226373, "body": "By the way, this is equivalent to <code>runTests = mapM_ (print . testLispExpr) testLispText</code>"}], "answers": [{"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 5, "creation_date": 1423640935, "post_id": 28449043, "comment_id": 45226246, "body": "A third option is to skip the <code>do</code>, since there&#39;s only one statement."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1555403980, "post_id": 28449043, "comment_id": 98088852, "body": "started small (skip/omit), ended up with a pretty verbose edit... sorry for that. :)"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1555404077, "last_edit_date": 1555404077, "creation_date": 1423640714, "answer_id": 28449043, "question_id": 28448931, "link": "https://stackoverflow.com/questions/28448931/what-is-wrong-with-this-haskell-let-in-indentation/28449043#28449043", "title": "What is wrong with this Haskell let-in indentation?", "body": "<p><code>let</code> syntax in <code>do</code> blocks is a little funny. If you want to use <code>in</code>, you have to indent it to the right of the <code>let</code>. Alternatively, you can omit the <code>in</code> altogether, and the <code>let</code> bindings will be visible for the rest of the <code>do</code> block:</p>\n\n<pre><code>           do\n             let ....\n                 ....\n             putSeq resultStrings\n         --  ..... (more `do` statements)\n         --  ^^ must all start on the same column\n</code></pre>\n\n<h3>Edit</h3>\n\n<p>As \u00d8rjan Johansen notes, the <code>do</code> isn't actually necessary at all in this case, since there's only one statement after <code>let</code>. So the other option is to omit the <code>do</code> while keeping the <code>in</code> keyword. And they also note that you can also write it as</p>\n\n<pre><code>runTests = mapM (print . testListExpr) testLispText\n</code></pre>\n\n<p>and really make things clean.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1920703"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1555404077, "creation_date": 1423640303, "last_edit_date": 1555403124, "question_id": 28448931, "link": "https://stackoverflow.com/questions/28448931/what-is-wrong-with-this-haskell-let-in-indentation", "title": "What is wrong with this Haskell let-in indentation?", "body": "<p>In the below Haskell code, I get an error \"parse error on input 'in'\". From what I've read, the indentation I've used should be fine. I in fact use 'let' and 'in' with similar indentation ('let' aligned with 'in') successfully elsewhere in my code. What rule have I broken that causes this 'in' to be a problem? If I add a space in front of 'in' (making it 1-space furthur in than 'let') it compiles fine.</p>\n\n<pre><code>runTests :: IO ()\nrunTests = do\n             let results = fmap testLispExpr testLispText\n                 resultStrings = fmap show results\n                 putSeq (x:xs) = do putStrLn x\n                                    putSeq xs\n                 putSeq [] = return ()\n             in putSeq resultStrings\n</code></pre>\n\n<p>All help is appreciated. Thanks in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1423640531, "post_id": 28448321, "comment_id": 45226093, "body": "Also <a href=\"http://stackoverflow.com/questions/14186433/interleave-list-of-lists-in-haskell\">interleave list of lists</a> is similar, yet a bit more general."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 9, "last_activity_date": 1423638533, "creation_date": 1423638533, "answer_id": 28448456, "question_id": 28448321, "link": "https://stackoverflow.com/questions/28448321/shuffle-together-two-lists-in-haskell/28448456#28448456", "title": "Shuffle together two lists in Haskell", "body": "<p>You could simply provide a pointwise definition:</p>\n\n<pre><code>shuffle :: [a] -&gt; [a] -&gt; [a]\nshuffle [] ys = ys\nshuffle xs [] = xs\nshuffle (x:xs) (y:ys) = x : y : shuffle xs ys\n</code></pre>\n\n<p>Every <code>zip*</code> method in <code>Prelude</code> or <code>Data.List</code> won't work, as they will take only the length of the shorter list.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1423640198, "creation_date": 1423640198, "answer_id": 28448902, "question_id": 28448321, "link": "https://stackoverflow.com/questions/28448321/shuffle-together-two-lists-in-haskell/28448902#28448902", "title": "Shuffle together two lists in Haskell", "body": "<p>Another, slightly shorter, way to do it pointwise, as Zeta suggested:</p>\n\n<pre><code>shuffle :: [a] -&gt; [a] -&gt; [a]\nshuffle [] ys = ys\nshuffle (x:xs) ys = x : shuffle ys xs\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 4463656, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/68a107052162c5fd5a00f072cf99bc98?s=128&d=identicon&r=PG&f=1", "display_name": "fia928", "link": "https://stackoverflow.com/users/4463656/fia928"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "closed_date": 1423647845, "accepted_answer_id": 28448456, "answer_count": 2, "score": 3, "last_activity_date": 1423640198, "creation_date": 1423637972, "question_id": 28448321, "link": "https://stackoverflow.com/questions/28448321/shuffle-together-two-lists-in-haskell", "closed_reason": "Duplicate", "title": "Shuffle together two lists in Haskell", "body": "<p>I'm just learning Haskell and I would like to make a \"shuffle\" function that shuffles together two lists, alternating until one runs out. So, <code>shuffle \"abc\" \"defgh\"</code> would return <code>\"adbecfgh\"</code>. Or <code>shuffle \"abc\" \"\"</code> returns <code>\"abc\"</code>. </p>\n\n<p>So far I have: </p>\n\n<pre><code>shuffle xs ys = concatMap (\\(x,y) -&gt; [x,y]) (zip xs ys)\n</code></pre>\n\n<p>The problem is that it's only shuffling the lists for the length of the shortest list and not including the rest of the longer list. So <code>shuffle \"abc\" \"defgh\"</code> returns <code>\"adbecf\"</code> rather than <code>\"adbecfgh\"</code>. </p>\n\n<p>Can anyone help me find a better approach to this? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2628, "user_id": 1508243, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c55ab140c6839baef28a70686f4b8bda?s=128&d=identicon&r=PG", "display_name": "Pete Baughman", "link": "https://stackoverflow.com/users/1508243/pete-baughman"}, "edited": false, "score": 4, "creation_date": 1423620517, "post_id": 28445378, "comment_id": 45220180, "body": "What does &#39;run-time&#39; type mean to you?  Can you give an example of something that would be a &#39;run-time&#39; type and something that would not be a &#39;run-time&#39; type?  Do you mean &quot;Does Haskell have run-time type information?&quot;"}, {"owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "reply_to_user": {"reputation": 2628, "user_id": 1508243, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c55ab140c6839baef28a70686f4b8bda?s=128&d=identicon&r=PG", "display_name": "Pete Baughman", "link": "https://stackoverflow.com/users/1508243/pete-baughman"}, "edited": false, "score": 0, "creation_date": 1423621722, "post_id": 28445378, "comment_id": 45220477, "body": "Run-time type = the type (in type-theoretical sense) of a variable at the time when the program is executed on a physical processor reachable/identifiable by the language compiler at language compilation time. Example: C++ with RTTI on and off. I guess you could get it down to how compiler uses run-time type information at compile time to decide if something compiles or not."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 9, "creation_date": 1423621725, "post_id": 28445378, "comment_id": 45220479, "body": "There is no information present about the types of data at run time.  Data representing an integer or tree or list is not &quot;tagged&quot; with any additional meta-data which indicates the type. All type checking is done at compile time. Because of this, unsafeCoerce and newtype wrapping/unwrapping have no runtime cost. This of course comes with the caveat that you can (explicitly) choose to store a representation of the type of data at runtime."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1423622844, "post_id": 28445378, "comment_id": 45220801, "body": "This is and implementation specific detail.  To properly answer your question the answerer needs to know (or assume) the compiler you are using."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423623481, "post_id": 28445378, "comment_id": 45220955, "body": "@GrimMeme, what you mean by &quot;run-time type&quot; remains extremely unclear."}], "answers": [{"tags": [], "owner": {"reputation": 31664, "user_id": 226975, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ad744cf47bf63187d6b406f8be7cfa3a?s=128&d=identicon&r=PG", "display_name": "Wyzard", "link": "https://stackoverflow.com/users/226975/wyzard"}, "is_accepted": false, "score": 6, "last_activity_date": 1423624721, "last_edit_date": 1423624721, "creation_date": 1423624411, "answer_id": 28445966, "question_id": 28445378, "link": "https://stackoverflow.com/questions/28445378/does-haskell-have-a-de-facto-run-time-type/28445966#28445966", "title": "Does Haskell have a &quot;de-facto&quot; run-time type?", "body": "<p>The \"run-time types\" used in <em>any</em> compiled program, regardless of source language, are the types natively supported by the target processor:  typically integers (signed and unsigned), pointers (really just a special usage of integers), and floating-point numbers (typically <a href=\"https://en.wikipedia.org/wiki/IEEE_floating_point\" rel=\"noreferrer\">IEEE754</a>).  The compiler translates all the operations in the source program into an equivalent series of operations using these basic hardware-supported types.</p>\n\n<p>More-sophisticated data types (such as Haskell's lists) are represented at run-time as data structures built from basic types.  For example, each node in a list may be represented by a pair of pointers:  one to the value held by that node (or a thunk for computing it), and one to the next node (or a thunk).  The compiler's static type-checking allows it to ensure that each of these run-time data structures is accessed only by code that will handle it properly.  For example, a region of memory that holds a pair of pointers for a list node won't be mistakenly treated as a thunk for computing an integer, because the compiler only allows the list to be passed to functions that expect a list argument.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 10, "last_activity_date": 1423639842, "creation_date": 1423639842, "answer_id": 28448799, "question_id": 28445378, "link": "https://stackoverflow.com/questions/28445378/does-haskell-have-a-de-facto-run-time-type/28448799#28448799", "title": "Does Haskell have a &quot;de-facto&quot; run-time type?", "body": "<p>Haskell's language features are designed to support <em>complete</em> type erasure. The idea is that the typing rules <em>guarantee</em> that code which passes type checking has the following two properties<sup>1</sup>:</p>\n\n<ol>\n<li>A value is of one type is never passed to an function expecting another type</li>\n<li>A function that claims to handle values in some type will handle <strong>any</strong> possible value in that type</li>\n</ol>\n\n<p>The 2nd property bears expanding on. Obviously partial functions like <code>fromJust</code> and <code>head</code> do not in fact handle any possible value; they explode At runtime if given the wrong value. But they explode in a \"well-defined\" way, after checking the assumptions they depend upon. It's not  possible to write code that attempts to access substructure in values which may not have that substructure, which might cause segmentation faults or interpret random pieces of memory as if they were a different kind of data.</p>\n\n<p>So after type checking is successful, there's no need to store any type information in the compiled program. I cab just throw the types away. I have already proven that if I generate code which blindly performs operations on data assuming that it is of the required shape that nothing will in fact go wrong.</p>\n\n<p>Example time!</p>\n\n<pre><code>data Foo = Foo Int String\ndata Bar = Bar Int String\n</code></pre>\n\n<p>Values of Foo and Bar will probably be represented in memory identically<sup>2</sup>; once you know all values are type correct, all the information needed to define these values is an <code>Int</code> and a <code>String</code> in each case. If you were to look at a memory dump of a running Haskell program, you would not be able to tell whether a given memory object containing a reference to an <code>Int</code> and a <code>String</code> was a <code>Foo</code> or a <code>Bar</code> (or indeed a <code>(Int, String)</code>, or any other single constructor type with two fields that are <code>Int</code> and <code>String</code> respectively).</p>\n\n<p>So no, Haskell types do not exist at runtime, in any form.</p>\n\n<hr>\n\n<p><sup>1</sup> You can of course break these properties using unsafe features, like <code>unsafeCoerce</code>; I'm talking about \"normal\" Haskell code here.</p>\n\n<p>2 Or they may not. Haskell-the-language makes no guarantees at all about representation at runtime, and it would be perfectly possible for it to store the fields in a different order, or do something else that could distinguish the two. But I'm going to presume that in the absence of any reason to do otherwise, it treats these two types the same.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 7, "last_activity_date": 1423682240, "last_edit_date": 1423682240, "creation_date": 1423646771, "answer_id": 28450680, "question_id": 28445378, "link": "https://stackoverflow.com/questions/28445378/does-haskell-have-a-de-facto-run-time-type/28450680#28450680", "title": "Does Haskell have a &quot;de-facto&quot; run-time type?", "body": "<p>Run-time type information is commonly found in OOP languages implementations, which carry a \"type tag\" with every object. Having such information enables one, for instance, to write code such as</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>void foo(Object o) {\n  if (o instanceof SomeClass) {\n     ...\n  }\n}\n</code></pre>\n\n<p>which is a form of run-time type checking. The \"type tag\" often comes for free, since every object needs a pointer to the Virtual Method Table and that alone identifies the run-time type of the object.</p>\n\n<p>In Haskell, though, there is no need for such a tag, or for pointers to VMTs. The language was designed without any kind of <code>instanceof</code> operator so that implementations do not have to provide any type tag at run-time. This also leads to a nicer underlying theory, since we get parametricity guarantees on code, also known as \"theorems for free!\". For instance the following function</p>\n\n<pre><code>f :: [a] -&gt; [a]\nf = .... -- whatever\n</code></pre>\n\n<p>can <em>not</em> be implemented so that <code>f [1,2] = [2,3]</code>. This is because there is, provably, no way to produce <code>3</code> for <code>f</code>. The intuition is that <code>f</code> must produce an <code>a</code>, and it can not check that <code>a=Int</code> at run-time (no type tags), so the output of <code>f</code> can only include elements found in its input. This guarantee comes only from the above typing, without even caring about how <code>f</code> is actually implemented.</p>\n\n<p>If you really want an <code>instanceof</code> equivalent, you can use <code>Typeable</code> for that:</p>\n\n<pre><code>f :: Typeable a =&gt; [a] -&gt; [a]\nf [] = []\nf (x:xs) = case cast x of\n           Just (y :: Int) -&gt; [2,3]\n           Nothing         -&gt; x:x:xs\n</code></pre>\n\n<p>This will return <code>[2,3]</code> on all nonempty lists if integers. At run-time, a type tag will be passed so that <code>a=Int</code> can be checked.</p>\n"}, {"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1423693823, "post_id": 28463139, "comment_id": 45257302, "body": "To amplify this answer slightly, this means it is possible for two variables of different types to be physically represented by the exact same value in memory. So, it does not make sense to talk about &quot;<i>the</i> type (in type-theoretical sense)&quot; of a run-time value."}], "tags": [], "owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "is_accepted": false, "score": 1, "last_activity_date": 1423683969, "creation_date": 1423683969, "answer_id": 28463139, "question_id": 28445378, "link": "https://stackoverflow.com/questions/28445378/does-haskell-have-a-de-facto-run-time-type/28463139#28463139", "title": "Does Haskell have a &quot;de-facto&quot; run-time type?", "body": "<p>No.  A fundamental property of Haskell is that <code>newtype</code> declarations, like</p>\n\n<pre><code>newtype MyInt = MyInt Int\n</code></pre>\n\n<p>have no run-time overhead, which means that the constructor <code>MyInt</code> can literally return the same argument (whatever that is) that it was passed, and the compiler will treat it like a different type.  (If you look at the compiled code, after optimization you won't see any instructions to implement the <code>MyInt</code> function call, even.)  This means that any 'de-factor' run-time type of an object in Haskell would only be defined up to the equivalence between a <code>newtype</code> and its implementation.</p>\n"}], "owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "answer_count": 4, "score": 7, "last_activity_date": 1423683969, "creation_date": 1423620352, "last_edit_date": 1423622879, "question_id": 28445378, "link": "https://stackoverflow.com/questions/28445378/does-haskell-have-a-de-facto-run-time-type", "title": "Does Haskell have a &quot;de-facto&quot; run-time type?", "body": "<p>Here's my dilemma: \nWhen Haskell program gets compiled, binary executable machine code is generated that can be executed on a physical CPU. When Haskell program gets interpreted, physical CPU performs operations on data from memory locations. Execution realistically happens in some time period whose length depends on the CPU speed.</p>\n\n<p>Since the data has been put into the memory by a compiler that guarantees that every variable is strongly typed, does this mean that Haskell effectively has a run-time type or not? </p>\n\n<p>Clarification:\nBy \"run-time type\" I mean: the type (in type-theoretical sense) of a variable at the time when the program is executed on a physical processor reachable/identifiable by the language compiler at language compilation time. </p>\n"}, {"tags": ["debugging", "haskell", "functional-programming", "wolfram-mathematica"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423614275, "post_id": 28444387, "comment_id": 45218454, "body": "For a better way of debugging pure code, see <a href=\"http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html\" rel=\"nofollow noreferrer\">You Could Have Invented Monads! (And Maybe You Already Have)</a>."}], "answers": [{"tags": [], "owner": {"reputation": 28662, "user_id": 10311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ee697b9dc2411d50fb66a4f330ba4df?s=128&d=identicon&r=PG", "display_name": "porges", "link": "https://stackoverflow.com/users/10311/porges"}, "is_accepted": true, "score": 11, "last_activity_date": 1423614270, "creation_date": 1423614270, "answer_id": 28444429, "question_id": 28444387, "link": "https://stackoverflow.com/questions/28444387/how-to-write-a-showit-function-in-haskell/28444429#28444429", "title": "How to write a showIt function in Haskell?", "body": "<p>This already exists in the <code>Debug.Trace</code> package. It's called <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/Debug-Trace.html#v:traceShowId\"><code>traceShowId</code></a>. (And it does use <code>unsafePerformIO</code> under the covers - you can see <a href=\"https://hackage.haskell.org/package/base-4.7.0.2/docs/src/Debug-Trace.html#trace\">the implementation of <code>trace</code> here</a>.)</p>\n"}], "owner": {"reputation": 293, "user_id": 4530052, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/67c7db4146b0cff401bf789ce8ed8fa5?s=128&d=identicon&r=PG&f=1", "display_name": "Oxy", "link": "https://stackoverflow.com/users/4530052/oxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 28444429, "answer_count": 1, "score": 4, "last_activity_date": 1423614270, "creation_date": 1423614066, "last_edit_date": 1495540619, "question_id": 28444387, "link": "https://stackoverflow.com/questions/28444387/how-to-write-a-showit-function-in-haskell", "title": "How to write a showIt function in Haskell?", "body": "<p>In Mathematica, <a href=\"https://stackoverflow.com/questions/6167291/how-to-debug-when-writting-small-or-big-codes-using-mathematica-workbench-mma\"><code>ShowIt</code> function</a> is commonly used for debugging. \nBasically, <code>ShowIt</code> is an identity function that prints the value of its parameter to the console. I wonder, how it is possible to write the same function for Haskell. The issue with Haskell is that since the function does IO, it cannot have the same return type as the input type. I think we have to use <strong>unsafe IO</strong> to implement <code>showIt</code>. But I have no idea how.</p>\n"}, {"tags": ["parsing", "haskell", "design-patterns"], "answers": [{"comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 4, "creation_date": 1423615066, "post_id": 28444381, "comment_id": 45218704, "body": "Note that if you need a value to refer to the entire piece being pattern matched on, precede it with a <code>name@</code>, ex: <code>move1@(Move code int1 int2)</code>. <code>move1</code> now refers to the entire Move."}], "tags": [], "owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "is_accepted": true, "score": 8, "last_activity_date": 1423614018, "creation_date": 1423614018, "answer_id": 28444381, "question_id": 28444347, "link": "https://stackoverflow.com/questions/28444347/haskell-parse-error-in-pattern-3/28444381#28444381", "title": "Haskell: parse error in pattern 3", "body": "<p><code>move1</code> isn't a data constructor (which is what you're allowed to pattern match on) and in fact it can't be since they have to start with uppercase letters. Replace it with the constructor <code>Move</code> from your data declaration and the error should go away.</p>\n\n<p>You will probably still get some warnings like \"code1 defined but not used\" you can get rid of them by changing the pattern to <code>(Move _ _ _)</code> if you really don't care about the contents.</p>\n"}], "owner": {"reputation": 41, "user_id": 4551686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f188841d1faa4ea7859e2d4c1efa389?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/4551686/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 28444381, "answer_count": 1, "score": 3, "last_activity_date": 1423614018, "creation_date": 1423613795, "question_id": 28444347, "link": "https://stackoverflow.com/questions/28444347/haskell-parse-error-in-pattern-3", "title": "Haskell: parse error in pattern 3", "body": "<pre><code>data Peg = Red | Green | Blue | Yellow | Orange | Purple\n    deriving (Show, Eq, Ord)\n\ntype Code = [Peg]\n\ndata Move = Move Code Int Int\n      deriving (Show, Eq)\n\nisConsistent :: Move -&gt; Code -&gt; Bool\nisConsistent (move1 code1 num1 num2) code2 = True --parse error here\n</code></pre>\n\n<p>Relatively new to Haskell. Wondering why I receive the following error message after attempting to load this.  </p>\n\n<pre><code>Parse error in pattern: move1\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1423611949, "post_id": 28443577, "comment_id": 45217706, "body": "<a href=\"http://hackage.haskell.org/package/vector-space-0.8.7/docs/Data-VectorSpace.html\" rel=\"nofollow noreferrer\">Here</a>&#39;s the standard implementation of the vector space class. As you&#39;ll see it uses <code>Scalar</code> as an associated type family, like &#216;rjan suggested. (The class with <code>&lt;.&gt;</code> is actually a subclass, <a href=\"http://hackage.haskell.org/package/vector-space-0.8.7/docs/Data-VectorSpace.html#t:InnerSpace\" rel=\"nofollow noreferrer\"><code>InnerSpace</code></a>: not all vector spaces permit a scalar/inner product; what they all permit is only multiplying vectors with scalars (<code>*^</code>) and adding vectors together (<code>^+^</code> from <code>AdditiveGroup</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1423610429, "last_edit_date": 1423610429, "creation_date": 1423609651, "answer_id": 28443622, "question_id": 28443577, "link": "https://stackoverflow.com/questions/28443577/not-deducible-relationship/28443622#28443622", "title": "Not deducible relationship", "body": "<pre><code>(&lt;.&gt;) :: Num b =&gt; a -&gt; a -&gt; b\n</code></pre>\n\n<p>The above means that <code>(&lt;.&gt;)</code> is able to produce <em>any</em> type of number the <em>caller</em> of that function might want.</p>\n\n<p>For instance, if <code>x,y</code> are <code>Vec2 Double</code>, then <code>x &lt;.&gt; y</code> can be called to return <code>Integer</code>. The compiler then complains that its implementation in the posted instance is not general enough, because it returns <code>Double</code>s instead of <em>any</em> type the caller might choose.</p>\n\n<p>I think this is not what that code was intended to model.</p>\n\n<p>You might want to switch to a multiparameter class (you'll need to enable a few extensions, GHC will tell you which ones):</p>\n\n<pre><code>class Vector a b where\n    (&lt;.&gt;) :: a -&gt; a -&gt; b\n\ninstance Num a =&gt; Vector (Vec2 a) a where\n    Vec2 (a, b) &lt;.&gt; Vec2 (c, d) = a * c + b * d\n</code></pre>\n\n<p>Since now the compiler can not determine the type of <code>x &lt;.&gt; y</code> from the type of <code>x,y</code>, you might want to add a functional dependency using</p>\n\n<pre><code>class Vector a b | a -&gt; b where\n    (&lt;.&gt;) :: a -&gt; a -&gt; b\n</code></pre>\n\n<p>or alternatively to use a type family</p>\n\n<pre><code>class Vector a where\n    type Scalar a\n    (&lt;.&gt;) :: a -&gt; a -&gt; Scalar a\n\ninstance Num a =&gt; Vector (Vec2 a) where\n    type Scalar (Vec a) = a\n    Vec2 (a, b) &lt;.&gt; Vec2 (c, d) = a * c + b * d\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 2, "last_activity_date": 1423610118, "creation_date": 1423610118, "answer_id": 28443724, "question_id": 28443577, "link": "https://stackoverflow.com/questions/28443577/not-deducible-relationship/28443724#28443724", "title": "Not deducible relationship", "body": "<p>As @chi's answer said, your code doesn't make <code>b</code> depend on <code>a</code>. To get what I think you want, you can use an associated type family:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\nclass Vector a where\n    type Element a\n    (&lt;.&gt;) :: a -&gt; a -&gt; Element a\n\ndata Vec2 a\n    = Vec2 (a, a)\n\n    deriving Show\n\ninstance Num a =&gt; Vector (Vec2 a) where\n    type Element (Vec2 a) = a\n    Vec2 (a, b) &lt;.&gt; Vec2 (c, d) = a * c + b * d\n</code></pre>\n\n<p>Another option is to use a multiparameter typeclass with a functional dependency, but I think that's more complicated here.</p>\n"}], "owner": {"reputation": 213, "user_id": 1277109, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e244fc546cf9fa0cd11ff754d007a5c1?s=128&d=identicon&r=PG", "display_name": "S&#225;ndor Rakonczai", "link": "https://stackoverflow.com/users/1277109/s%c3%a1ndor-rakonczai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 28443622, "answer_count": 2, "score": 1, "last_activity_date": 1423610429, "creation_date": 1423609408, "question_id": 28443577, "link": "https://stackoverflow.com/questions/28443577/not-deducible-relationship", "title": "Not deducible relationship", "body": "<p>Why the relationship between <code>a</code> and <code>b</code> is not deducible?</p>\n\n<pre><code>class Vector a where\n    (&lt;.&gt;) :: Num b =&gt; a -&gt; a -&gt; b\n\ndata Vec2 a\n    = Vec2 (a, a)\n\n    deriving Show\n\ninstance Num a =&gt; Vector (Vec2 a) where\n    Vec2 (a, b) &lt;.&gt; Vec2 (c, d) = a * c + b * d\n</code></pre>\n\n<p>I would like to have a Vec2 algebric data structure where components can be any numbers.</p>\n"}, {"tags": ["haskell", "installation", "nix", "haste"], "answers": [{"comments": [{"owner": {"reputation": 483, "user_id": 1864375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b37e4610ebedf3ed6b54a22d3978e53?s=128&d=identicon&r=PG", "display_name": "Itai Zukerman", "link": "https://stackoverflow.com/users/1864375/itai-zukerman"}, "reply_to_user": {"reputation": 13264, "user_id": 190887, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b1a747d0a7e3450408e0f07adba49111?s=128&d=identicon&r=PG", "display_name": "Inaimathi", "link": "https://stackoverflow.com/users/190887/inaimathi"}, "edited": false, "score": 0, "creation_date": 1423604446, "post_id": 28441990, "comment_id": 45214251, "body": "Try it out; see what happens."}, {"owner": {"reputation": 13264, "user_id": 190887, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b1a747d0a7e3450408e0f07adba49111?s=128&d=identicon&r=PG", "display_name": "Inaimathi", "link": "https://stackoverflow.com/users/190887/inaimathi"}, "edited": false, "score": 2, "creation_date": 1423605454, "post_id": 28441990, "comment_id": 45214775, "body": "Hm. It installs, then complains that it isn&#39;t booted, then fails with a cryptic error code when I try to boot it. That&#39;s a different problem though."}], "tags": [], "owner": {"reputation": 483, "user_id": 1864375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b37e4610ebedf3ed6b54a22d3978e53?s=128&d=identicon&r=PG", "display_name": "Itai Zukerman", "link": "https://stackoverflow.com/users/1864375/itai-zukerman"}, "is_accepted": true, "score": 3, "last_activity_date": 1423603149, "creation_date": 1423603149, "answer_id": 28441990, "question_id": 28440035, "link": "https://stackoverflow.com/questions/28440035/installing-haskell-packages-through-nix/28441990#28441990", "title": "Installing Haskell packages through Nix", "body": "<p>haste-compiler is marked \"broken\":</p>\n\n<p><a href=\"https://github.com/NixOS/nixpkgs/commit/37b1a0b79abd1d02d5618417b951cf02ef4f6a49\" rel=\"nofollow\">https://github.com/NixOS/nixpkgs/commit/37b1a0b79abd1d02d5618417b951cf02ef4f6a49</a></p>\n\n<p>To override, put this in your <code>.nixpkgs/config.nix</code>:</p>\n\n<p><code>allowBroken = true;</code></p>\n"}], "owner": {"reputation": 13264, "user_id": 190887, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b1a747d0a7e3450408e0f07adba49111?s=128&d=identicon&r=PG", "display_name": "Inaimathi", "link": "https://stackoverflow.com/users/190887/inaimathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 765, "favorite_count": 1, "accepted_answer_id": 28441990, "answer_count": 1, "score": 4, "last_activity_date": 1428416209, "creation_date": 1423595997, "last_edit_date": 1428416209, "question_id": 28440035, "link": "https://stackoverflow.com/questions/28440035/installing-haskell-packages-through-nix", "title": "Installing Haskell packages through Nix", "body": "<p>Specifically, I'm trying to install <a href=\"https://github.com/valderman/haste-compiler\" rel=\"nofollow\">Haste</a> through <a href=\"http://nixos.org/nix/\" rel=\"nofollow\"><code>nix</code></a>. </p>\n\n<p>I can see a <code>hasteCompiler</code> entry in <code>nixpkgs/pkgs/top-level/haskell-packages.nix</code>, and the appropriate <code>.nix</code> file in <code>nixpkgs/pkgs/development/libraries/haskell/haste-compiler/</code> but I'm not sure how to install it. Specifically, none of</p>\n\n<pre><code>nix-env -i haste\nnix-env -i haste-compiler\nnix-env -i haskell-haste-compiler\n</code></pre>\n\n<p>do what I want, and <code>nix-env -qa</code> doesn't list anything containing the substring <code>haste</code> as an available package.</p>\n\n<p>Any thoughts?</p>\n"}, {"tags": ["haskell", "hoogle"], "answers": [{"comments": [{"owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "edited": false, "score": 0, "creation_date": 1423902185, "post_id": 28511491, "comment_id": 45345589, "body": "Oddly now that I try at home it works well. So I suspect it&#39;s a network error on my end! I will be able to try again in three days."}], "tags": [], "owner": {"reputation": 7816, "user_id": 60422, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f1f99b071794213796dcb33e787c5772?s=128&d=identicon&r=PG", "display_name": "rakslice", "link": "https://stackoverflow.com/users/60422/rakslice"}, "is_accepted": false, "score": 1, "last_activity_date": 1423877781, "creation_date": 1423877781, "answer_id": 28511491, "question_id": 28439434, "link": "https://stackoverflow.com/questions/28439434/command-hoogle-data-fails-to-download-base-txt/28511491#28511491", "title": "Command `hoogle data` fails to download base.txt", "body": "<p><code>wget</code> exit code 4 <a href=\"https://www.gnu.org/software/wget/manual/html_node/Exit-Status.html\" rel=\"nofollow\">indicates a network error</a>. </p>\n\n<p>The url loads fine in my browser, with a redirect to HTTPS, however.</p>\n\n<p>If you run the <code>wget</code> command it's doing directly, do you get any more information?</p>\n"}], "owner": {"reputation": 7558, "user_id": 448496, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BZtrd.png?s=128&g=1", "display_name": "rubik", "link": "https://stackoverflow.com/users/448496/rubik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1423877781, "creation_date": 1423594116, "last_edit_date": 1423594538, "question_id": 28439434, "link": "https://stackoverflow.com/questions/28439434/command-hoogle-data-fails-to-download-base-txt", "title": "Command `hoogle data` fails to download base.txt", "body": "<p>This is the output of <code>hoogle data</code>:</p>\n\n<pre><code>Downloading downloads/platform.cabal\n# platform.cabal (for downloads/platform.cabal)\n2015-02-10 19:44:01 URL:http://code.galois.com/darcs/haskell-platform/haskell-platform.cabal [3334/3334] -&gt; downloads/platform.cabal [1]\nDownloaded downloads/platform.cabal\nDownloading downloads/cabal.tar.gz\n# cabal.tar.gz (for downloads/cabal.tar.gz)\n2015-02-10 19:44:09 URL:http://hackage.haskell.org/packages/index.tar.gz [8794998/8794998] -&gt; downloads/cabal.tar.gz [1]\nDownloaded downloads/cabal.tar.gz\n# cabal.tar (for downloads/cabal.tar)\nExtracting tar file downloads/cabal.index\n# cabal.tar (for downloads/cabal.index)\nFinished extracting tar file downloads/cabal.index\n# cabal.tar (for downloads/cabal.index)\nDownloading downloads/hoogle.tar.gz\n# hoogle.tar.gz (for downloads/hoogle.tar.gz)\n2015-02-10 19:44:38 URL:http://hackage.haskell.org/packages/hoogle.tar.gz [20734807/20734807] -&gt; downloads/hoogle.tar.gz [1]\nDownloaded downloads/hoogle.tar.gz\n# hoogle.tar (for downloads/hoogle.tar)\nExtracting tar file downloads/hoogle.index\n# hoogle.tar (for downloads/hoogle.index)\nFinished extracting tar file downloads/hoogle.index\n# hoogle.tar (for downloads/hoogle.index)\nDownloading downloads/base.txt\n# base.txt (for downloads/base.txt)\nhoogle: Error when running Shake build system:\n* default.hoo\n* platform.hoo\n* mtl.hoo\n* base.txt\n* downloads/base.txt.cache\n* downloads/base.txt\nuser error (Development.Shake.command, system command failed\nCommand: wget -nv --no-check-certificate http://www.haskell.org/hoogle/base.txt --output-document=downloads/base.txt\nExit code: 4\nStderr was empty)\n</code></pre>\n\n<p>Searching on Google didn't yield any useful result. The browser does not resolve <a href=\"http://www.haskell.org/hoogle/base.txt\" rel=\"nofollow\">http://www.haskell.org/hoogle/base.txt</a>, so I guess it's down? Any workaraounds?</p>\n"}, {"tags": ["haskell", "pretty-print"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423594030, "post_id": 28439182, "comment_id": 45208458, "body": "The underlying <code>Doc</code> has a <code>Union</code> constructor which tries one alternative, and, if it doesn&#39;t fit across the page, tries a second one. The only way it is exposed is via <code>group x = Union (flatten x) x</code>."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1423599597, "creation_date": 1423599597, "answer_id": 28440998, "question_id": 28439182, "link": "https://stackoverflow.com/questions/28439182/optional-spaces-and-multiple-alternatives-in-wl-pprint-extras/28440998#28440998", "title": "Optional spaces and multiple alternatives in wl-pprint-extras", "body": "<p>You can try one alternatives before another with <code>group</code> and <code>flatAlt</code>.</p>\n\n<pre><code>(&lt;|&gt;) :: Doc e -&gt; Doc e -&gt; Doc e\na &lt;|&gt; b = group $ flatAlt b a\n\ninfixl 5 &lt;|&gt;\n</code></pre>\n\n<p>We'll define your three examples.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Text.PrettyPrint.Free\nimport System.IO\n\nitems = map char ['1'..'5']\n\nwidest = brackets . hcat . punctuate \", \" $ items\nwide   = brackets . hcat . punctuate \",\"  $ items\nskinny = brackets . hcat . punctuate \",\" . map (\\x -&gt; \" \" &lt;&gt; x &lt;&gt; linebreak) $ items\n</code></pre>\n\n<p>The widest of these that fits on the screen, <code>widestFits</code>, can be defined in terms of <code>&lt;|&gt;</code> which we defined above.</p>\n\n<pre><code>widestFits = widest &lt;|&gt; wide &lt;|&gt; skinny\n</code></pre>\n\n<p>We will try pretty printing these on three documents, one wide enough to hold the <code>widest</code> example, one only wide enough to hold the <code>wide</code> example, and one that can't hold either.</p>\n\n<pre><code>main = do\n    displayIO stdout $ renderPretty 1.0 15 widestFits\n    putStrLn \"\"\n    displayIO stdout $ renderPretty 1.0 14 widestFits   \n    putStrLn \"\" \n    displayIO stdout $ renderPretty 1.0 10 widestFits\n    putStrLn \"\n</code></pre>\n\n<p>This results in the desired output.</p>\n\n<pre><code>[1, 2, 3, 4, 5]\n[1,2,3,4,5]\n[ 1\n, 2\n, 3\n, 4\n, 5\n]\n</code></pre>\n"}], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 28440998, "answer_count": 1, "score": 2, "last_activity_date": 1423599597, "creation_date": 1423593276, "question_id": 28439182, "link": "https://stackoverflow.com/questions/28439182/optional-spaces-and-multiple-alternatives-in-wl-pprint-extras", "title": "Optional spaces and multiple alternatives in wl-pprint-extras", "body": "<p>Is there a good/accepted way to get more than two alternative layouts, specifically in a way which supports optional spaces?</p>\n\n<p>In particular, I might want to print a list in one of three ways:</p>\n\n<pre><code>[1, 2, 3, 4, 5]\n\n[1,2,3,4,5]\n\n[ 1\n, 2\n, 3\n, 4\n, 5\n]\n</code></pre>\n\n<p>in that order of preference.</p>\n"}, {"tags": ["haskell", "installation", "cabal", "cabal-install", "hackage"], "answers": [{"comments": [{"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423591141, "post_id": 28438510, "comment_id": 45206867, "body": "Does it mean to set <code>LANG</code> environment variable as <code>C.UTF-8</code>? i.e. <code>$ LANG=C.UTF-8</code>"}, {"owner": {"reputation": 12965, "user_id": 2463570, "user_type": "registered", "accept_rate": 55, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rajarshi Das", "link": "https://stackoverflow.com/users/2463570/rajarshi-das"}, "reply_to_user": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423591617, "post_id": 28438510, "comment_id": 45207119, "body": "what it gives after <code>locale -a</code>"}, {"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423591669, "post_id": 28438510, "comment_id": 45207155, "body": "<code>C C.UTF-8 POSIX en_AG en_AG.utf8 en_AU.utf8 en_BW.utf8 en_CA.utf8 en_DK.utf8 en_GB.utf8 en_HK.utf8 en_IE.utf8 en_IN en_IN.utf8 en_NG en_NG.utf8 en_NZ.utf8 en_PH.utf8 en_SG.utf8 en_US.utf8 en_ZA.utf8 en_ZM en_ZM.utf8 en_ZW.utf8 </code>"}, {"owner": {"reputation": 12965, "user_id": 2463570, "user_type": "registered", "accept_rate": 55, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rajarshi Das", "link": "https://stackoverflow.com/users/2463570/rajarshi-das"}, "reply_to_user": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423591786, "post_id": 28438510, "comment_id": 45207211, "body": "where is <code>en_US.UTF8</code>"}, {"owner": {"reputation": 12965, "user_id": 2463570, "user_type": "registered", "accept_rate": 55, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rajarshi Das", "link": "https://stackoverflow.com/users/2463570/rajarshi-das"}, "reply_to_user": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423592057, "post_id": 28438510, "comment_id": 45207372, "body": "it is your locale issue not cabal"}, {"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423592160, "post_id": 28438510, "comment_id": 45207423, "body": "How should I fix it, Rajarshi?"}, {"owner": {"reputation": 12965, "user_id": 2463570, "user_type": "registered", "accept_rate": 55, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rajarshi Das", "link": "https://stackoverflow.com/users/2463570/rajarshi-das"}, "reply_to_user": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423592223, "post_id": 28438510, "comment_id": 45207458, "body": "please set it <code>LANG=en_US.UTF8</code>"}, {"owner": {"reputation": 12965, "user_id": 2463570, "user_type": "registered", "accept_rate": 55, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rajarshi Das", "link": "https://stackoverflow.com/users/2463570/rajarshi-das"}, "reply_to_user": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423592294, "post_id": 28438510, "comment_id": 45207495, "body": "string conversion required locale to translation"}, {"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423592296, "post_id": 28438510, "comment_id": 45207497, "body": "I have already tried <code>C.UTF-8</code>, <code>en_US.utf8</code> and <code>en_HK.utf8</code> but still no luck"}, {"owner": {"reputation": 12965, "user_id": 2463570, "user_type": "registered", "accept_rate": 55, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rajarshi Das", "link": "https://stackoverflow.com/users/2463570/rajarshi-das"}, "reply_to_user": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423592375, "post_id": 28438510, "comment_id": 45207540, "body": "it shoul work can you please try it? string converion installation"}, {"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423592588, "post_id": 28438510, "comment_id": 45207644, "body": "Yes, I even do <code>$ echo $LANG</code> to confirm before installation. Still the same error."}, {"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423592766, "post_id": 28438510, "comment_id": 45207749, "body": "Already tried <code>C.UTF-8</code>, <code>C</code>, <code>en_US.utf8</code>, <code>en_US.UTF8</code>, <code>en_US.UTF-8</code>, <code>en_HK.utf8</code>."}], "tags": [], "owner": {"reputation": 12965, "user_id": 2463570, "user_type": "registered", "accept_rate": 55, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rajarshi Das", "link": "https://stackoverflow.com/users/2463570/rajarshi-das"}, "is_accepted": false, "score": 0, "last_activity_date": 1423590966, "creation_date": 1423590966, "answer_id": 28438510, "question_id": 28438365, "link": "https://stackoverflow.com/questions/28438365/fail-to-install-hackage-string-conversions/28438510#28438510", "title": "Fail to install Hackage string-conversions", "body": "<p>This is a locale-related error. Check that <code>LANG</code> is set to <code>C.UTF-8</code>, <code>en_US.UTF-8</code>, or another <code>UTF-8 locale</code>. Check that locale files are available on the system.</p>\n\n<p>you have to set <code>LANG=C.UTF-8</code> (use <code>locale -a</code> to see which ones are available on your system).</p>\n\n<p>you can see more in<br>\n<a href=\"http://github.com/haskell/cabal/issues/1883\" rel=\"nofollow\">http://github.com/haskell/cabal/issues/1883</a> it will help you</p>\n"}, {"tags": [], "owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "is_accepted": true, "score": 0, "last_activity_date": 1423677384, "creation_date": 1423677384, "answer_id": 28461125, "question_id": 28438365, "link": "https://stackoverflow.com/questions/28438365/fail-to-install-hackage-string-conversions/28461125#28461125", "title": "Fail to install Hackage string-conversions", "body": "<p>I have finally figured out the solution.</p>\n\n<p>Rajarshi is right for the locale problem. However, changing the locale temporarily won't work.</p>\n\n<p>The package now correctly installed after changing the locale permanently.</p>\n\n<h1>How to check the current locale setting</h1>\n\n<ol>\n<li><p><code>$ locale</code></p></li>\n<li><p>If you notice that <code>LANG</code> is <code>C</code> or empty, probably it is not configured correctly</p></li>\n</ol>\n\n<h1>How to change the locale setting permanently (Ubuntu)</h1>\n\n<ol>\n<li><p><code>$ sudo update-locale LANG=en_US-UTF-8</code></p></li>\n<li><p>Log out and log in again</p></li>\n</ol>\n\n<h1>References</h1>\n\n<ol>\n<li><a href=\"https://help.ubuntu.com/community/Locale\" rel=\"nofollow\">Locale - Community Help Wiki</a></li>\n</ol>\n"}], "owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 28461125, "answer_count": 2, "score": 1, "last_activity_date": 1423677384, "creation_date": 1423590479, "question_id": 28438365, "link": "https://stackoverflow.com/questions/28438365/fail-to-install-hackage-string-conversions", "title": "Fail to install Hackage string-conversions", "body": "<h1>Problem</h1>\n\n<p>I was installing the Hackage <code>string-conversions</code>. However, it fails with the error below.</p>\n\n<h1>Error Log</h1>\n\n<pre><code>Configuring string-conversions-0.3.0.3...\nBuilding string-conversions-0.3.0.3...\nPreprocessing library string-conversions-0.3.0.3...\n[1 of 1] Compiling Data.String.Conversions ( Data/String/Conversions.hs, dist/build/Data/String/Conversions.o )\nIn-place registering string-conversions-0.3.0.3...\nCreating package registration file:\n/tmp/pkgConf-string-conversions-0.3.011675.3\ncabal: Error: some packages failed to install:\nstring-conversions-0.3.0.3 failed during the final install step. The exception\nwas:\n/tmp/pkgConf-string-conversions-0.3.011675.3: hGetContents: invalid argument\n(invalid byte sequence)\n</code></pre>\n\n<h1>Environment</h1>\n\n<p>Ubuntu GNOME: 14.10</p>\n\n<p>ghc: 7.6.3</p>\n\n<p>cabal: 1.20.0.2</p>\n"}, {"tags": ["haskell", "gadt", "existential-type", "phantom-types"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 7, "creation_date": 1423590047, "post_id": 28438040, "comment_id": 45206230, "body": "Maybe you toy example is a little too simplified from your actual use case, but wouldn&#39;t this be easily solvable with a simple ADT instead of a GADT?  <code>data Toy = TBool Bool | TInt Int</code>; <code>isBool (TBool _) = True; isBool _ = False</code>, <code>addOne (TInt a) = TInt $ a + 1</code>; <code>zeros = [Toy]; zeros = [TBool False, TInt 0]</code>.  Or do you really need that polymorphism there and your actual use case is more complex?"}, {"owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1423591354, "post_id": 28438040, "comment_id": 45206981, "body": "@bheklilr I have some composite data, say <code>data Sequence = Sequence (Toy Int)</code> where it doesnot apply to <code>Toy Bool</code>, and vice versa.  And also, in your reply, wouldn&#39;t your definition of <code>addOne</code> not total? .i.e. Calling <code>addOne</code> on <code>TBool b</code> would cause an error?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 1, "creation_date": 1423591640, "post_id": 28438040, "comment_id": 45207133, "body": "Sorry, meant to have <code>addOne (TInt a) = TInt $ a + 1; addOne x = x</code>."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1423633694, "post_id": 28438040, "comment_id": 45223555, "body": "@gspindles can&#39;t you have <code>newtype TInt = TInt Int</code>, <code>TBool</code> similarly and <code>data Toy = ToyInt TInt | ToyBool TBool</code>. So you can have <code>Sequence TInt</code>. I wouldn&#39;t use GADTs before they are really necessary, e.g. having constructor like <code>EqToy :: Toy a -&gt; Toy a -&gt; Toy Bool</code> or <code>MultiToy :: Toy a -&gt; Toy [a]</code>"}, {"owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "edited": false, "score": 0, "creation_date": 1423636615, "post_id": 28438040, "comment_id": 45224504, "body": "@phagej That was actually my original implementation (except I didn&#39;t think to use <code>newtype</code> instead of <code>data</code>). But untimately, I wanted to work with <code>Toy</code> as the bottom most data where everything else operarates on. Hence the need for the phantom and going out of my way to make it work in higher up composite data/function. I.e. in the <code>Sequence</code> data in reply to @bleklilr, I don&#39;t want <code>Sequence</code> to take <code>TInt</code> in your example, I want it to take a <code>Toy</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423591265, "post_id": 28438524, "comment_id": 45206936, "body": "I don&#39;t think this is necessary here (although it is a useful technique!); see the answer I&#39;m about to write."}, {"owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "edited": false, "score": 0, "creation_date": 1423592423, "post_id": 28438524, "comment_id": 45207561, "body": "@Cirdec This approach looks very interesting. I&#39;ll have to learn about datakind promotion before I can tackle the problem this way.  Thanks for the suggestion."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423593062, "post_id": 28438524, "comment_id": 45207896, "body": "@dfeuer The difference between the <code>HList1</code> indexed with types and wrapping the data in a universally quantified constructor like in your answer is the universally quantified constructor forgets all type-level knowledge about the contained type. Forgetting the type-level knowledge about the contained type can be useful since it can simplify types. The contained types can be recovered by pattern matching on the <code>Toy</code>&#39;s constructors, but can never be reintroduced at the type level."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423593210, "post_id": 28438524, "comment_id": 45207984, "body": "@Cirdec, I think <i>all</i> of these ideas demand a richer example application."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1423598854, "post_id": 28438524, "comment_id": 45211268, "body": "@Cirdec, could you give an example, which illustrates why it can be useful to remember type variables? Besides a trivial stuff like type-safe <code>head</code>. Your <code>zeros</code> is isomorophic to <code>zeros :: (Toy Bool, Toy Int); zeros = (TBool False, TInt 0)</code>. I can imagine some situtations with type-level computations via type families, but Haskell doesn&#39;t really handle dependent types properly."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1423601104, "post_id": 28438524, "comment_id": 45212486, "body": "@user3237465 The big difference between <code>HList1 Toy [Bool, Int]</code> and <code>(Toy Bool, Toy Int)</code> is that you know that <code>f</code> is the same everywhere. For example, you can apply natural transformations <code>forall a. f a -&gt; g a</code> to <code>HList1</code>s. If <a href=\"https://hackage.haskell.org/package/mmorph-1.0.0/docs/Control-Monad-Morph.html#t:MFunctor\" rel=\"nofollow noreferrer\"><code>MFunctor</code></a> were poly-kinded, I would have provided <code>hoist</code> for an <code>MFunctor</code> instance. There are other things you can do without touching <code>TypeFamilies</code>, like applying functions, zipping lists together, etc."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1423603338, "post_id": 28438524, "comment_id": 45213691, "body": "Thanks. You can apply natural transformations to existentials too. Or more generally (and probably less useful) <code>(&gt;&gt;=!) :: Exists p -&gt; (forall x. p x -&gt; Exists q) -&gt; Exists q; This x &gt;&gt;=! f = f x</code>. Applying functions is a perfect example."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 5, "last_activity_date": 1423591026, "creation_date": 1423591026, "answer_id": 28438524, "question_id": 28438040, "link": "https://stackoverflow.com/questions/28438040/haskell-heterogeneous-list-for-data-with-phantom-variable/28438524#28438524", "title": "Haskell: Heterogeneous list for data with phantom variable", "body": "<p>The ordinary heterogeneous list indexed by a list of the types of its elements is</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE GADTs #-}\n\ndata HList l where\n    HNil :: HList '[]\n    HCons :: a -&gt; HList l -&gt; HList (a ': l)\n</code></pre>\n\n<p>We can modify this to hold values inside some <code>f :: * -&gt; *</code>.</p>\n\n<pre><code>data HList1 f l where\n    HNil1 :: HList1 f '[]\n    HCons1 :: f a -&gt; HList1 f l -&gt; HList1 f (a ': l)\n</code></pre>\n\n<p>Which you can use to write <code>zeros</code> without forgetting the type variables.</p>\n\n<pre><code>zeros :: HList1 Toy [Bool, Int]  \nzeros = HCons1 (TBool False) $ HCons1 (TInt 0) $ HNil1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1423592054, "post_id": 28438643, "comment_id": 45207369, "body": "For practical use, this answer can be improved by splitting out the unwrapping by type from incrementing. <code>onInt :: (Toy Int -&gt; WrappedToy) -&gt; WrappedToy -&gt; WrappedToy; onInt f (Wrap t@(TInt _)) = f t; onInt _ w                 = w</code>. Then, with a suitable <code>mapInt f (TInt x) = TInt (f x)</code> the example <code>incIfInt</code> can be written as <code>onInt (Wrap . mapInt (+1))</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423592512, "post_id": 28438643, "comment_id": 45207605, "body": "@Cirdec, that does sound sensible."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1423592656, "post_id": 28438643, "comment_id": 45207684, "body": "The knowledge that what is held in a <code>WrappedToy</code> is a <code>Toy</code> isn&#39;t accomplishing anything. It can be written more generically as <code>data Wrapped f where Wrap :: f a -&gt; Wrapped f</code> and used as <code>Wrapped Toy</code> without losing anything."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423592795, "post_id": 28438643, "comment_id": 45207760, "body": "This is also a nice case wherein lists-of-existentials are meaningful. Typically things like <code>[Showable]</code> are frowned upon since they convey no more information than <code>[String]</code>, and unnecessarily use sophisticated types. Here, instead, it <i>is</i> possible to unwrap the existential and recover its actual type, thanks to GADTs pattern matching."}, {"owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423593177, "post_id": 28438643, "comment_id": 45207967, "body": "@dfeuer I guess I won&#39;t be able to get away without some wrapping, unwrapping, and lifting functions on <code>Toy a</code> up to <code>WrappedToy</code>.  Thanks! @Cirdec <code>onInt</code> looks very much like <code>fmap</code>, <code>(=&lt;&lt;)</code>, etc\u2026"}, {"owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "edited": false, "score": 0, "creation_date": 1423628631, "post_id": 28438643, "comment_id": 45222204, "body": "@dfeuer I got home and had a chance to try this out some more.  I was able to write <code>liftWrap :: (forall a. Toy a -&gt; b) -&gt; WrapToy -&gt; b</code> with <code>liftWrap f (Wrap t) = f t</code>; as well as <code>mapWrap :: (forall a. Toy a -&gt; b) -&gt; [WrapToy] -&gt; [b]</code> with <code>mapWrap f ws = map (liftWrap f) ws</code>. The compiler nicely warns me about doing <code>{-# LANGUAGE Rank2Types #-}</code> , after which, everything works fine.  For now, I&#39;m happy with this. Thanks!"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 11, "last_activity_date": 1423592903, "last_edit_date": 1423592903, "creation_date": 1423591419, "answer_id": 28438643, "question_id": 28438040, "link": "https://stackoverflow.com/questions/28438040/haskell-heterogeneous-list-for-data-with-phantom-variable/28438643#28438643", "title": "Haskell: Heterogeneous list for data with phantom variable", "body": "<p>Start with the <code>Toy</code> type:</p>\n\n<pre><code>data Toy a where\n  TBool :: Bool -&gt; Toy Bool\n  TInt :: Int -&gt; Toy Int\n</code></pre>\n\n<p>Now you can wrap it up in an existential <em>without</em> over-generalizing with the class system:</p>\n\n<pre><code>data WrappedToy where\n  Wrap :: Toy a -&gt; WrappedToy\n</code></pre>\n\n<p>Since the wrapper only holds <code>Toy</code>s, we can <em>unwrap</em> them and get <code>Toy</code>s back:</p>\n\n<pre><code>incIfInt :: WrappedToy -&gt; WrappedToy\nincIfInt (Wrap (TInt n)) = Wrap (TInt (n+1))\nincIfInt w = w\n</code></pre>\n\n<p>And now you can distinguish things within the list:</p>\n\n<pre><code>incIntToys :: [WrappedToy] -&gt; [WrappedToy]\nincIntToys = map incIfInt\n</code></pre>\n\n<h3>Edit</h3>\n\n<p>As Cirdec points out, the different pieces can be teased apart a bit:</p>\n\n<pre><code>onInt :: (Toy Int -&gt; WrappedToy) -&gt; WrappedToy -&gt; WrappedToy\nonInt f (Wrap t@(TInt _)) = f t\nonInt _ w = w\n\nmapInt :: (Int -&gt; Int) -&gt; Toy Int -&gt; Toy Int\nmapInt f (TInt x) = TInt (f x)\n\nincIntToys :: [WrappedToy] -&gt; [WrappedToy]\nincIntToys = map $ onInt (Wrap . mapInt (+1))\n</code></pre>\n\n<p>I should also note that nothing here so far really justifies the <code>Toy</code> GADT. bheklilr's simpler approach of using a plain algebraic datatype should work just fine.</p>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 6, "last_activity_date": 1423599173, "last_edit_date": 1495541185, "creation_date": 1423597219, "answer_id": 28440399, "question_id": 28438040, "link": "https://stackoverflow.com/questions/28438040/haskell-heterogeneous-list-for-data-with-phantom-variable/28440399#28440399", "title": "Haskell: Heterogeneous list for data with phantom variable", "body": "<p>There was a very similar <a href=\"https://stackoverflow.com/questions/28388715/list-of-any-datakind-in-gadt/\">question</a> a few days ago.</p>\n\n<p>In your case it would be</p>\n\n<pre><code>{-# LANGUAGE GADTs, PolyKinds, Rank2Types #-}\n\ndata Exists :: (k -&gt; *) -&gt; * where\n  This :: p x -&gt; Exists p\n\ntype Toys = [Exists Toy]\n\nzeros :: Toys\nzeros = [This (TBool False), This (TInt 0)]\n</code></pre>\n\n<p>It's easy to eliminate an existential:</p>\n\n<pre><code>recEx :: (forall x. p x -&gt; c) -&gt; Exists p -&gt; c\nrecEx f (This x) = f x\n</code></pre>\n\n<p>Then if you have a recursor for the <code>Toy</code> datatype</p>\n\n<pre><code>recToy :: (Toy Bool -&gt; c) -&gt; (Toy Int -&gt; c) -&gt; Toy a -&gt; c\nrecToy f g x@(TBool _) = f x\nrecToy f g x@(TInt  _) = g x\n</code></pre>\n\n<p>you can map a wrapped <code>toy</code>:</p>\n\n<pre><code>mapToyEx :: (Toy Bool -&gt; p x) -&gt; (Toy Int -&gt; p y) -&gt; Exists Toy -&gt; Exists p\nmapToyEx f g = recEx (recToy (This . f) (This . g))\n</code></pre>\n\n<p>For example</p>\n\n<pre><code>non_zeros :: Toys\nnon_zeros = map (mapToyEx (const (TBool True)) addOne) zeros\n</code></pre>\n\n<p>This approach is similar to one in @dfeuer's answer, but it's less ad hoc.</p>\n"}, {"comments": [{"owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "edited": false, "score": 0, "creation_date": 1423610119, "post_id": 28443497, "comment_id": 45216978, "body": "I have not looked into <code>Data.Typable</code>.  I&#39;ll come back to your example once I looked into it.  There are just too many topics to get into and learn.  It&#39;s rather nice, but I&#39;m a long way off from most of the advanced stuff."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "edited": false, "score": 0, "creation_date": 1423688577, "post_id": 28443497, "comment_id": 45254562, "body": "If you&#39;re using <code>GADTs</code> and <code>ExistentialQuantification</code> you&#39;re already pretty advanced.  But yeah, nothing wrong with pacing yourself."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 2, "last_activity_date": 1423609018, "creation_date": 1423609018, "answer_id": 28443497, "question_id": 28438040, "link": "https://stackoverflow.com/questions/28438040/haskell-heterogeneous-list-for-data-with-phantom-variable/28443497#28443497", "title": "Haskell: Heterogeneous list for data with phantom variable", "body": "<p>Have you played with <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-Typeable.html\" rel=\"nofollow\"><code>Data.Typeable</code></a>?  A <code>Typeable</code> constraint allows you to make guesses at the type hidden by the existential, and cast to that type when you guess right.</p>\n\n<p>Not your example, but some example code I have lying around:</p>\n\n<pre><code>{-# LANGUAGE GADTs, ScopedTypeVariables, TypeOperators #-}\n\nimport Data.Typeable\n\ndata Showable where\n    -- Note that this is an existential defined in GADT form\n    Showable :: (Typeable a, Show a) =&gt; a -&gt; Showable\n\ninstance Show Showable where\n    show (Showable value) = \"Showable \" ++ show value\n\n-- Example of casting Showable to Integer\ncastToInteger :: Showable -&gt; Maybe Integer\ncastToInteger (Showable (value :: a)) = \n    case eqT :: Maybe (a :~: Integer) of\n      Just Refl -&gt; Just value\n      Nothing -&gt; Nothing\n\nexample1 = [Showable \"foo\", Showable 5]\nexample2 = map castToInteger example1\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 2, "accepted_answer_id": 28438643, "answer_count": 4, "score": 10, "last_activity_date": 1423609018, "creation_date": 1423589407, "question_id": 28438040, "link": "https://stackoverflow.com/questions/28438040/haskell-heterogeneous-list-for-data-with-phantom-variable", "title": "Haskell: Heterogeneous list for data with phantom variable", "body": "<p>I'm learning about existential quantification, phantom types, and GADTs at the moment.  How do I go about creating a heterogeneous list of a data type with a phantom variable?  For example:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE ExistentialQuantification #-}\n\ndata Toy a where\n  TBool :: Bool -&gt; Toy Bool\n  TInt  :: Int  -&gt; Toy Int\n\ninstance Show (Toy a) where\n  show (TBool b) = \"TBool \" ++ show b\n  show (TInt  i) = \"TInt \"  ++ show i\n\nbools :: [Toy Bool]\nbools = [TBool False, TBool True]\n\nints  :: [Toy Int]\nints  = map TInt [0..9]\n</code></pre>\n\n<p>Having functions like below are OK:</p>\n\n<pre><code>isBool :: Toy a -&gt; Bool\nisBool (TBool _) = True\nisBool (TInt  _) = False\n\naddOne :: Toy Int -&gt; Toy Int\naddOne (TInt a) = TInt $ a + 1\n</code></pre>\n\n<p>However, I would like to be able to declare a heterogeneous list like so:</p>\n\n<pre><code>zeros :: [Toy a]\nzeros =  [TBool False, TInt 0]\n</code></pre>\n\n<p>I tried using an empty type class to restrict the type on <code>a</code> by:</p>\n\n<pre><code>class Unify a\ninstance Unify Bool\ninstance Unify Int\n\nzeros :: Unify a =&gt; [Toy a]\nzeros =  [TBool False, TInt 0]\n</code></pre>\n\n<p>But the above would fail to compile.  I was able to use existential quantification to do get the following:</p>\n\n<pre><code>data T = forall a. (Forget a, Show a) =&gt; T a\n\ninstance Show T where\n  show (T a) = show a\n\nclass (Show a) =&gt; Forget a\ninstance Forget (Toy a)\ninstance Forget T\n\nzeros :: [T]\nzeros = [T (TBool False), T (TInt 0)]\n</code></pre>\n\n<p>But this way, I cannot apply a function that was based on the specific type of <code>a</code> in <code>Toy a</code> to <code>T</code> e.g. <code>addOne</code> above.</p>\n\n<p>In conclusion, what are some ways I can create a heterogeneous list without forgetting/losing the phantom variable?</p>\n"}, {"tags": ["list", "haskell", "pattern-matching", "empty-list"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 2, "creation_date": 1423587881, "post_id": 28437469, "comment_id": 45204923, "body": "The answer to this kind of strangeness is usually &quot;laziness&quot;, but it seems that the cons operator would be eval&#39;d when pattern matching against the empty list constructor, so I&#39;m not sure why you&#39;d need it in the second pattern..."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1423591708, "post_id": 28437469, "comment_id": 45207172, "body": "I think the answer is simple: The principle of least surprise. It&#39;s simply <i>clearer</i> if you write it as <code>(_,_)</code> rather than having to infer it yourself."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1423592295, "post_id": 28437469, "comment_id": 45207496, "body": "I think it&#39;s just a matter of personal preference. For instance, I wouldn&#39;t define <code>not True = False ; not _ = True</code>, preferring to specify the last case explicitly. Whichever is the style, the generated code should be exactly the same, so it does not affect performance."}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 1, "creation_date": 1423605340, "post_id": 28437469, "comment_id": 45214717, "body": "Whether or not to use the wildcard pattern match is more of an issue for types that are in flux (i.e. that might add constructors later).  If you use the wildcard match as your last branch then the compiler won&#39;t warn you if you add new constructors to your type, whereas an explicit pattern match for all branches would generate a compiler warning if you added new unmatched constructors."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1423605998, "post_id": 28437469, "comment_id": 45215061, "body": "@GabrielGonzalez Thanks; that makes a lot of sense. That said, the list type can hardly said to be a &quot;in flux&quot;, at this stage."}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1423676473, "post_id": 28437469, "comment_id": 45247663, "body": "@Jubobs Right.  For stable types like list it boils down to personal preference"}], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "closed_date": 1423589777, "answer_count": 0, "score": 1, "last_activity_date": 1423587671, "creation_date": 1423587671, "question_id": 28437469, "link": "https://stackoverflow.com/questions/28437469/why-use-the-pattern-instead-of-a-simple-wildcard-in-this-case", "closed_reason": "Duplicate", "title": "Why use the pattern (_:_) instead of a simple wildcard, in this case?", "body": "<p>As I was scanning through <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/src/GHC-List.html\" rel=\"nofollow\"><code>GHC.List.hs</code></a>, I came across the following <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/src/GHC-List.html#null\" rel=\"nofollow\">definition for <code>null</code></a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- | Test whether a list is empty.\nnull                    :: [a] -&gt; Bool\nnull []                 =  True\nnull (_:_)              =  False\n</code></pre>\n\n<p>I'm surprised that the second equation isn't simply</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>null _                  =  False\n</code></pre>\n\n<p>This alternative equation is syntactically valid and would not change the semantics of <code>null</code>: because the first pattern is the empty list, the second pattern would only be used if the argument is a nonempty list. Moreover, in my opinion, this alternative equation is simpler and more readable. Which begs the question:</p>\n\n<p><strong>Is there a particular reason why the pattern <code>(_:_)</code> is used instead of a wildcard, here?</strong></p>\n\n<p>(If this is a form of optimization, please elaborate.)</p>\n"}, {"tags": ["haskell", "pretty-print"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 2, "creation_date": 1423585951, "post_id": 28436633, "comment_id": 45203564, "body": "What&#39;s your code? You can add line breaks with <code>linebreak</code> or <code>hardline</code>, and increase indentation with <code>nest</code>."}], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 120, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1423592045, "creation_date": 1423585496, "last_edit_date": 1423592045, "question_id": 28436633, "link": "https://stackoverflow.com/questions/28436633/how-to-get-the-wadler-leijen-pretty-printer-to-render-braces-on-separate-lines", "title": "How to get the Wadler/Leijen pretty printer to render braces on separate lines", "body": "<p>I'm using the <a href=\"https://hackage.haskell.org/package/wl-pprint-extras\" rel=\"nofollow\">wl-pprint-extras</a> package. I'm trying to pretty-print LaTeX, improving on <a href=\"https://hackage.haskell.org/package/HaTeX-3.16.0.0/docs/Text-LaTeX-Base-Pretty.html\" rel=\"nofollow\">HaTeX</a>, or at least tweaking it to my needs.</p>\n\n<p>An example of the output I'm looking for is:</p>\n\n<pre><code>\\foo{bar}{\n    \\baz{\\quux}\n}{\n    \\fizz\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>\\foo{\n    bar\n}{\n    \\baz{\\quux}\n}{\n    \\fizz\n}\n</code></pre>\n\n<p>I would prefer to avoid, when possible,</p>\n\n<pre><code>\\foo{\n    bar\n}{\\baz{\\quux}}{\n    \\fizz\n}\n</code></pre>\n\n<p>The output that's driving me up a wall is</p>\n\n<pre><code>\\foo{\n    bar\n}{\\baz{\n        \\quux\n}}{\n    \\fizz\n}\n</code></pre>\n\n<p>The data I have to work with is <code>TeXComm String [TeXArg]</code>.</p>\n\n<p>Does anyone have any idea how to get the first and the second while completely avoiding the fourth?</p>\n\n<p>EDIT:</p>\n\n<p>A <a href=\"https://gist.github.com/rpglover64/6d854500b1f66038dafe\" rel=\"nofollow\">gist</a> of what I have so far; the two files are the modified pretty printer and some sample LaTeX I'm trying to pretty print.</p>\n"}, {"tags": ["regex", "haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423580696, "post_id": 28434895, "comment_id": 45199879, "body": "Don&#39;t you mean <code>Regex -&gt; Regex -&gt; Regex</code>?"}, {"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423581009, "post_id": 28434895, "comment_id": 45200118, "body": "@Zeta Yes, thank you :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423581382, "post_id": 28434895, "comment_id": 45200429, "body": "You&#39;re not really trying to use a regex for HTML/XML, are you? Because no."}, {"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423581443, "post_id": 28434895, "comment_id": 45200480, "body": "@dfeuer Nope, just as an example"}], "answers": [{"comments": [{"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "edited": false, "score": 0, "creation_date": 1423582401, "post_id": 28435237, "comment_id": 45201164, "body": "It is really sad. Thanks for your quick response @phadej."}], "tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": true, "score": 8, "last_activity_date": 1423581439, "creation_date": 1423581439, "answer_id": 28435237, "question_id": 28434895, "link": "https://stackoverflow.com/questions/28434895/how-to-merge-regex/28435237#28435237", "title": "How to merge Regex?", "body": "<p><code>Regex</code> type in the <code>Text.Regex</code> is essentially a C pointer:</p>\n\n<pre><code>data Regex = Regex (ForeignPtr CRegex) CompOption ExecOption\n</code></pre>\n\n<p>AFAIK there is no way to recover the string representation of the posix regex, after it has been compiled. <a href=\"http://linux.die.net/man/3/regcomp\">regcomp 3 man page</a>.</p>\n\n<p>If you\u2019d like to operate on regular expression algebraically, wrap then in your own type to postpone the compiling or use for example <a href=\"https://hackage.haskell.org/package/regex-applicative\">regex-applicative</a>. </p>\n"}], "owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "accepted_answer_id": 28435237, "answer_count": 1, "score": 1, "last_activity_date": 1423584640, "creation_date": 1423580516, "last_edit_date": 1423584640, "question_id": 28434895, "link": "https://stackoverflow.com/questions/28434895/how-to-merge-regex", "title": "How to merge Regex?", "body": "<h1>Background</h1>\n\n<p>Let say I have several <code>Regex</code> here.</p>\n\n<pre><code>import Text.Regex\n\nopenTag = mkRegex \"&lt;([A-Z][A-Z0-9]*)\\\\b[^&gt;]*&gt;\"\ncloseTag = mkRegex \"&lt;/\\\\1&gt;\"\nany = mkRegex \"(.*?)\"\n</code></pre>\n\n<h1>Problem</h1>\n\n<p><code>openTag ++ any ++ closeTag</code> &lt;-- Just for illustration purpose</p>\n\n<p>How can I merge them? To be specific, a <code>Regex -&gt; Regex -&gt; Regex</code> function. Alternatively, convert a <code>Regex</code> back to <code>String</code> would be good.</p>\n\n<p><code>openTag ++ \"hello\" ++ closeTag</code> &lt;-- Just for illustration purpose</p>\n\n<p>Thus, I can create my own <code>Regex -&gt; String -&gt; Regex</code> function ultimately.</p>\n\n<h1>Workaround</h1>\n\n<p>Manipulate the string literals.</p>\n\n<pre><code>import Text.Regex\n\nopenTag = \"&lt;([A-Z][A-Z0-9]*)\\\\b[^&gt;]*&gt;\"\ncloseTag = \"&lt;/\\\\1&gt;\"\nany = \"(.*?)\"\n\ntagWithAny = mkRegex $ openTag ++ any ++ closeTag\n\ntagWith :: String -&gt; Regex\ntagWith s = mkRegex $ openTag ++ s ++ closeTag\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "ghci"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1423589528, "post_id": 28431162, "comment_id": 45205944, "body": "I think this is really looking at natural numbers and using <code>Int</code> for convenience. Bringing in <code>abs</code> probably doesn&#39;t make sense. Better would be to use Peano naturals: <code>data Nat = Zero | Succ Nat</code>, then <code>even Zero = True; even (Succ n) = odd n; odd Zero = False; odd (Succ n) = even n</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423617076, "post_id": 28431162, "comment_id": 45219265, "body": "@dfeuer Why doesn&#39;t that make sense though? A negative integer is even if it is divisible by 2 and odd otherwise. Although, the implementation you give, with its pattern matching, does fit the original from the question more closely."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1423623388, "post_id": 28431162, "comment_id": 45220936, "body": "@DavidYoung, I take that back. If you&#39;re using a representation of integers as natural numbers with a sign, then absolute value is a perfectly reasonable way to do that. But <i>none</i> of this makes sense for <code>Int</code>, which is 2&#39;s complement binary!"}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 21, "last_activity_date": 1423571224, "last_edit_date": 1495535279, "creation_date": 1423569723, "answer_id": 28431162, "question_id": 28431125, "link": "https://stackoverflow.com/questions/28431125/mutual-recursion-in-odd-even-functions-in-haskell/28431162#28431162", "title": "Mutual recursion in odd/even functions in haskell", "body": "<p><a href=\"https://stackoverflow.com/questions/3748592/what-are-nk-patterns-and-why-are-they-banned-from-haskell-2010\">n + k patterns have been removed</a> from Haskell and are no longer available. Write it like this instead:</p>\n\n<pre><code>even :: Int -&gt; Bool\neven 0 = True\neven n = odd (n - 1)\n\nodd :: Int -&gt; Bool\nodd 0 = False\nodd n = even (n - 1)\n</code></pre>\n\n<p>Note that this function fails horribly for negative inputs, so you probably want to augment it with <code>abs</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 0, "last_activity_date": 1523971607, "creation_date": 1523971607, "answer_id": 49879408, "question_id": 28431125, "link": "https://stackoverflow.com/questions/28431125/mutual-recursion-in-odd-even-functions-in-haskell/49879408#49879408", "title": "Mutual recursion in odd/even functions in haskell", "body": "<p>Our own language is quite powerful. I was having difficulty with limits when teaching myself calculus until I read one sentence in one paragraph of Newton. It was, of course, in English.</p>\n\n<p>First off, you are correct about the indexing not being used or needed. </p>\n\n<p>Secondly, the code does not know the difference between even or odd and you are again right to question it.</p>\n\n<p>Finally, I modified these slightly to work properly on my implementation.</p>\n\n<pre><code>     evens [x] = [x];    evens (x:xs) = x:odds xs\n     odds  [x] = [];      odds (_:xs) =  evens xs\n</code></pre>\n\n<p>How they work is <code>evens</code> does the work. It builds the output list. It takes the first item of a list fed it and makes it the first or next item of the output list. It calls <code>odds</code> with the remainder of the list. <code>odds</code> simply returns the tail of what it received back to <code>evens</code>.</p>\n\n<p>Like tail, it discards the first item of what it receives.</p>\n\n<p><code>evens</code> produces a list with about half of the items discarded. <code>odds</code> produces nothing but does the critical discarding.</p>\n\n<p>If you give <code>evens</code> the list [0,1,2,3,4] it returns every other item starting with 0, that is, [0,2,4]. If you give evens the list [1,2,3,4] it returns [1,3] because the list started with and odd number. Wherever <code>evens</code> starts, that's what it produces.</p>\n\n<p>Try either with [1,1,1,1,1] or \"bcdefg\"</p>\n\n<p>The modifications made to the functions reflect what each does respectively with the remaining element. odds discards it, evens attaches it to the end of the output list.</p>\n\n<p>Both functions only work properly if given a list starting with an even number. If given a list with an odd number they work in reverse.</p>\n\n<p>Here is a function that will produce an even or odd list depending on a specified starting number and ending in the specified ending number.</p>\n\n<pre><code>eo s e = [s,s+2..e]\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 3046279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cecc282085af8538cbc778fdbe09303?s=128&d=identicon&r=PG&f=1", "display_name": "zurab", "link": "https://stackoverflow.com/users/3046279/zurab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3199, "favorite_count": 0, "accepted_answer_id": 28431162, "answer_count": 2, "score": 11, "last_activity_date": 1523971607, "creation_date": 1423569624, "question_id": 28431125, "link": "https://stackoverflow.com/questions/28431125/mutual-recursion-in-odd-even-functions-in-haskell", "title": "Mutual recursion in odd/even functions in haskell", "body": "<p>In chapter 6 of <b>\"Programming in Haskell\"</b> by Graham Hutton there is a section called \"6.5 Mutual recursion\", that contains the following example:</p>\n\n<pre><code>even :: Int -&gt; Bool\neven 0       = True\neven (n + 1) = odd n\n\nodd :: Int -&gt; Bool\nodd 0       = False\nodd (n + 1) = even n\n</code></pre>\n\n<p>I wanted to try it out. I put the code in Hof.hs file, ran <b>ghci</b>(version 7.8.3), typed</p>\n\n<pre><code>:l Hof.hs\n</code></pre>\n\n<p>and got the following error message</p>\n\n<pre>\nHof.hs:3:7: Parse error in pattern: n + 1\nFailed, modules loaded: none.\n</pre>\n\n<p>Why am I getting this message? Is the code syntactically out of date or something?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5665, "user_id": 982084, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mLw2v.jpg?s=128&g=1", "display_name": "WilQu", "link": "https://stackoverflow.com/users/982084/wilqu"}, "edited": false, "score": 2, "creation_date": 1423563064, "post_id": 28428778, "comment_id": 45189176, "body": "I think this function is wrong, even if you try to get an element in the range of the list. For example, <code>elementAt 0 [1, 2, 3]</code> will return <code>3</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423563641, "post_id": 28428778, "comment_id": 45189484, "body": "I believe explicit recursion is easier to use in this case than folds."}, {"owner": {"reputation": 1794, "user_id": 1135950, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b1cf007709e46bbd037f204a43c51fa4?s=128&d=identicon&r=PG", "display_name": "yonutix", "link": "https://stackoverflow.com/users/1135950/yonutix"}, "edited": false, "score": 0, "creation_date": 1423567032, "post_id": 28428778, "comment_id": 45191359, "body": "1 is considered the index element I forgot to mention thus 0 is considered out of bounds either"}], "answers": [{"comments": [{"owner": {"reputation": 1794, "user_id": 1135950, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b1cf007709e46bbd037f204a43c51fa4?s=128&d=identicon&r=PG", "display_name": "yonutix", "link": "https://stackoverflow.com/users/1135950/yonutix"}, "edited": false, "score": 0, "creation_date": 1423567115, "post_id": 28429401, "comment_id": 45191409, "body": "Seems a good answer, I tought there is a shorter method of doing this, thanks!"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 1794, "user_id": 1135950, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b1cf007709e46bbd037f204a43c51fa4?s=128&d=identicon&r=PG", "display_name": "yonutix", "link": "https://stackoverflow.com/users/1135950/yonutix"}, "edited": false, "score": 0, "creation_date": 1423567190, "post_id": 28429401, "comment_id": 45191443, "body": "@CosminMihai There is a shorter method of doing this but I can promise you that it is not nearly as easy to implement/read."}, {"owner": {"reputation": 1794, "user_id": 1135950, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b1cf007709e46bbd037f204a43c51fa4?s=128&d=identicon&r=PG", "display_name": "yonutix", "link": "https://stackoverflow.com/users/1135950/yonutix"}, "edited": false, "score": 0, "creation_date": 1423567332, "post_id": 28429401, "comment_id": 45191506, "body": "It does not matter, that was the purpose of the question, to find a shorter way of doing this, if you know a better way, share it please"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1423577453, "post_id": 28429401, "comment_id": 45197491, "body": "<code>elementAt n xs = xs!!n</code>  -- for 0 based index, decrement n by one for 1 based index."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1423577566, "post_id": 28429401, "comment_id": 45197556, "body": "@karakfa Sure, but the question implied that an own implementation had to be written IMO"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423590436, "post_id": 28429401, "comment_id": 45206451, "body": "That last implementation can be greatly improved by using <code>. zip [0 .. n-1]</code>. But also I see the OP now wants 1-indexed lists, so some other things need to change if you care."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 6, "last_activity_date": 1423598082, "last_edit_date": 1423598082, "creation_date": 1423564192, "answer_id": 28429401, "question_id": 28428778, "link": "https://stackoverflow.com/questions/28428778/haskell-list-index-out-of-bounds/28429401#28429401", "title": "Haskell list index out of bounds", "body": "<p>Using a fold to find the n-th element in a list is a pretty difficult way. I want to present you an easier way using explicit recursion:</p>\n\n<p>You have to look at this problem differently:</p>\n\n<ol>\n<li>What is my base case?</li>\n<li>How should the recursive call look like?</li>\n<li>(Optional) What about errors?</li>\n</ol>\n\n<p>The method's type signature is given:</p>\n\n<pre><code>elementAt :: Int -&gt; [Int] -&gt; Int\n</code></pre>\n\n<p>Only worrying about the first point, we know that if the index is <code>0</code>, we want to return that element:</p>\n\n<pre><code>elementAt 1 (x:_) = x\n</code></pre>\n\n<p>Now what if our number is greater than <code>1</code>? In this case we want to decrement our index end test the predicate for the next item:</p>\n\n<pre><code>elementAt n (x:xs) = elementAt (n-1) xs\n</code></pre>\n\n<p>Now we are almost done! If we want to throw an error if the element in the specified position is not found, we can simply use <code>error</code>:</p>\n\n<pre><code>elementAt _ _ = error \"Element not found!\"\n</code></pre>\n\n<p>But this is not how the idiomatic Haskell way works. One possible solution is to use a <code>Maybe</code> to wrap the result in. For this we have to change the type signature a little bit:</p>\n\n<pre><code>elementAt :: Int -&gt; [Int] -&gt; Maybe Int\n</code></pre>\n\n<p>Now the function is able to return <code>Just</code> the element at the specified position if it exists and <code>Nothing</code> otherwise:</p>\n\n<pre><code>elementAt 1 (x:_)  = Just x\nelementAt n (x:xs) = elementAt (n-1) xs\nelementAt _ _      = Nothing\n</code></pre>\n\n<hr>\n\n<p>For the sake of completeness, here one possible way to achieve this though a fold:</p>\n\n<pre><code>elementAt n = foldl (\\acc x -&gt; if fst x == n then snd x else acc) n . zip [1..n]\n</code></pre>\n"}], "owner": {"reputation": 1794, "user_id": 1135950, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/b1cf007709e46bbd037f204a43c51fa4?s=128&d=identicon&r=PG", "display_name": "yonutix", "link": "https://stackoverflow.com/users/1135950/yonutix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1070, "favorite_count": 0, "accepted_answer_id": 28429401, "answer_count": 1, "score": 0, "last_activity_date": 1423598082, "creation_date": 1423562391, "last_edit_date": 1423567044, "question_id": 28428778, "link": "https://stackoverflow.com/questions/28428778/haskell-list-index-out-of-bounds", "title": "Haskell list index out of bounds", "body": "<p>How can I modify the below function such that the case when the list is shorter than the index searched  will result in an error.</p>\n\n<pre><code>elementAt::Int -&gt; [Int] -&gt; Int\nelementAt = Data.Foldable.foldl (\\x y -&gt; if x == 0 then y else x-1)\n</code></pre>\n\n<p>1 is the index of the first element</p>\n"}, {"tags": ["haskell", "haskell-lens", "lenses"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423596845, "post_id": 28427769, "comment_id": 45210061, "body": "Ick, non-law-abiding things are icky. Can you wrap this <code>Map</code> up in some fashion to express the invariant you later rely on?"}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423598120, "post_id": 28427769, "comment_id": 45210837, "body": "@dfeuer, yes in the real app the implementation is hidden. Yet for example <a href=\"http://hackage.haskell.org/package/lens-4.7/docs/Control-Lens-Iso.html#v:non\" rel=\"nofollow noreferrer\"><code>non</code></a> is stretching the reality too :)"}], "answers": [{"tags": [], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "is_accepted": false, "score": 1, "last_activity_date": 1423602186, "last_edit_date": 1423602186, "creation_date": 1423572507, "answer_id": 28432107, "question_id": 28427769, "link": "https://stackoverflow.com/questions/28427769/how-to-define-lens-into-sum-type-inside-map-like-container/28432107#28432107", "title": "How to define lens into sum-type inside Map-like container?", "body": "<p>For now I go with:</p>\n\n<pre><code>prismToLens :: Prism' a b -&gt; Lens' (Maybe a) (Maybe b)\nprismToLens p = lens getter setter\n  where getter s = s &gt;&gt;= (^? p)\n        setter _ b = (p#) &lt;$&gt; b\n</code></pre>\n\n<p>so I can define <code>ll</code> like:</p>\n\n<pre><code>ll' :: Key -&gt; Lens' Foo (Maybe Val)\nll' k = at k . prismToLens _Left\n</code></pre>\n\n<p>Controrary to the \"lens\" defined in the question, for this one 2nd law doesn't hold:</p>\n\n<pre><code>-- 2) Putting back what you got doesn't change anything:\n-- Doesn't hold\n-- &gt;&gt;&gt; quickCheck $ lensLaw2' (Map.fromList [(True,Right False)]) True\n-- fromList [] /= fromList [(True,Right False)]\nlensLaw2' :: Foo -&gt; Key -&gt; Property\nlensLaw2' s k = set (ll' k) (view (ll' k) s) s === s\n</code></pre>\n\n<p>But with original the third law didn't hold:</p>\n\n<pre><code>-- 3) Setting twice is the same as setting once:\n-- Doesn't hold\n-- &gt;&gt;&gt; quickCheck $ lensLaw3 (Map.fromList [(False, Right False)]) False (Just 0) Nothing\n-- fromList [] /= fromList [(True,Right False)]\nlensLaw3 :: Foo -&gt; Key -&gt; Maybe Val -&gt; Maybe Val -&gt; Property\nlensLaw3 s k v v' = set (ll k) v' (set (ll k) v s) === set (ll k) v' s\n</code></pre>\n\n<hr>\n\n<p>As said in the question as I have dependend map, this is ok. When accessing some key <code>k</code>, there shouldn't ever be <code>Right</code> value, if I expect there to be <code>Left</code>. Taking this into the account, using <code>prismToLens</code> is actually better. Still searching for a better name though.</p>\n\n<hr>\n\n<p>After remembering <a href=\"http://hackage.haskell.org/package/lens-4.7/docs/Control-Lens-Iso.html#v:non\" rel=\"nofollow\"><code>non</code></a>, I altered the answer to use:</p>\n\n<pre><code>prismToIso :: Prism' a b -&gt; Iso' (Maybe a) (Maybe b)\nprismToIso p = iso t f\n  where t a = a &gt;&gt;=  (^? p)\n        f b = (p#) &lt;$&gt; b -- no unused param as in `prismToLens`!\n</code></pre>\n\n<p>Which resembles <a href=\"http://hackage.haskell.org/package/lens-4.7/docs/Control-Lens-Iso.html#v:mapping\" rel=\"nofollow\"><code>mapping</code></a>. The law properties behaved the same as with <code>prismToLens</code>. This gives rise to the new questio:  which one is better or worse, <code>prismToIso</code> or <code>prismToLens</code>. And why?</p>\n\n<hr>\n\n<p>The full runnable example:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nmodule Lens where\n\nimport Control.Applicative\nimport Control.Lens\nimport Data.Map as Map\nimport Test.QuickCheck\n\ntype Key = Bool\ntype Val = Int\ntype Foo  = Map Key (Either Val Bool)\n\nll :: Key -&gt; Lens' Foo (Maybe Val)\nll k f m = f mv &lt;&amp;&gt; \\r -&gt; case r of\n  Nothing -&gt; maybe m (const (Map.delete k m)) mv\n  Just v' -&gt; Map.insert k (Left v') m\n  where mv = Map.lookup k m &gt;&gt;= maybeLeft\n        maybeLeft (Left v') = Just v'\n        maybeLeft (Right _) = Nothing\n\nprismToLens :: Prism' a b -&gt; Lens' (Maybe a) (Maybe b)\nprismToLens p = lens getter setter\n  where getter s = s &gt;&gt;= (^? p)\n        setter _ b = (p#) &lt;$&gt; b\n\nll' :: Key -&gt; Lens' Foo (Maybe Val)\nll' k = at k . prismToLens _Left\n\nx, y :: Foo\nx = Map.empty\ny = Map.fromList [(True, Right True)]\n\n{-\n&gt;&gt;&gt; x ^. ll \"foo\"\nNothing\n\n&gt;&gt;&gt; x &amp; ll \"foo\" ?~ 1\nfromList [(\"foo\",Left 1)]\n\n&gt;&gt;&gt; (x &amp; ll \"foo\" ?~ 1) ^. ll \"foo\"\nJust 1\n\n&gt;&gt;&gt; (x &amp; ll \"foo\" ?~ 1) ^. ll \"bar\"\nNothing\n\n&gt;&gt;&gt; x &amp; ll \"foo\" ?~ 1 &amp; ll \"foo\" .~ Nothing\nfromList []\n\n&gt;&gt;&gt; y ^. ll \"foo\"\nNothing\n\n&gt;&gt;&gt; y &amp; ll \"foo\" ?~ 1\nfromList [(\"foo\",Left 1)]\n\n&gt;&gt;&gt; y &amp; ll \"foo\" .~ Nothing\nfromList [(\"foo\",Right True)]\n-}\n\n-- Orphan instance is ok-ish in this case :)\ninstance (Ord k, Arbitrary k, Arbitrary v) =&gt; Arbitrary (Map k v) where\n  arbitrary = Map.fromList &lt;$&gt; arbitrary\n  shrink = Prelude.map Map.fromList . shrink . Map.toList\n\n-- 1) You get back what you put in:\nlensLaw1 :: Foo -&gt; Key -&gt; Maybe Val -&gt; Property\nlensLaw1 s k v = view (ll k) (set (ll k) v s) === v\n\n-- 2) Putting back what you got doesn't change anything:\nlensLaw2 :: Foo -&gt; Key -&gt; Property\nlensLaw2 s k = set (ll k) (view (ll k) s) s === s\n\n-- 3) Setting twice is the same as setting once:\n-- Doesn't hold\n-- &gt;&gt;&gt; quickCheck $ lensLaw3 (Map.fromList [(False, Right False)]) False (Just 0) Nothing\n-- fromList [] /= fromList [(True,Right False)]\nlensLaw3 :: Foo -&gt; Key -&gt; Maybe Val -&gt; Maybe Val -&gt; Property\nlensLaw3 s k v v' = set (ll k) v' (set (ll k) v s) === set (ll k) v' s\n\n-- Using prismToLens defined \"lens\"\n\n-- 1) You get back what you put in:\nlensLaw1' :: Foo -&gt; Key -&gt; Maybe Val -&gt; Property\nlensLaw1' s k v = view (ll' k) (set (ll' k) v s) === v\n\n-- 2) Putting back what you got doesn't change anything:\n-- Doesn't hold\n-- &gt;&gt;&gt; quickCheck $ lensLaw2' (Map.fromList [(True,Right False)]) True\n-- fromList [] /= fromList [(True,Right False)]\nlensLaw2' :: Foo -&gt; Key -&gt; Property\nlensLaw2' s k = set (ll' k) (view (ll' k) s) s === s\n\n-- 3) Setting twice is the same as setting once:\nlensLaw3' :: Foo -&gt; Key -&gt; Maybe Val -&gt; Maybe Val -&gt; Property\nlensLaw3' s k v v' = set (ll' k) v' (set (ll' k) v s) === set (ll' k) v' s\n</code></pre>\n"}], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1423602186, "creation_date": 1423559370, "last_edit_date": 1423561030, "question_id": 28427769, "link": "https://stackoverflow.com/questions/28427769/how-to-define-lens-into-sum-type-inside-map-like-container", "title": "How to define lens into sum-type inside Map-like container?", "body": "<p>I can define the needed <code>Lens'</code> manually:</p>\n\n<pre><code>type Key = String\ntype Val = Int\ntype Foo  = Map Key (Either Val Bool)\n\nll :: String -&gt; Lens' Foo (Maybe Int)\nll k f m = f mv &lt;&amp;&gt; \\r -&gt; case r of\n  Nothing -&gt; maybe m (const (Map.delete k m)) mv\n  Just v' -&gt; Map.insert k (Left v') m\n  where mv = Map.lookup k m &gt;&gt;= maybeLeft\n        maybeLeft (Left v') = Just v'\n        maybeLeft (Right _) = Nothing\n</code></pre>\n\n<p>And it works like:</p>\n\n<pre><code>x, y :: Foo\nx = Map.empty\ny = Map.fromList [(\"foo\", Right True)]\n\n&gt;&gt;&gt; x ^. ll \"foo\"\nNothing\n\n&gt;&gt;&gt; x &amp; ll \"foo\" ?~ 1\nfromList [(\"foo\",Left 1)]\n\n&gt;&gt;&gt; (x &amp; ll \"foo\" ?~ 1) ^. ll \"foo\"\nJust 1\n\n&gt;&gt;&gt; (x &amp; ll \"foo\" ?~ 1) ^. ll \"bar\"\nNothing\n\n&gt;&gt;&gt; x &amp; ll \"foo\" ?~ 1 &amp; ll \"foo\" .~ Nothing\nfromList []\n\n&gt;&gt;&gt; y ^. ll \"foo\"\nNothing\n\n&gt;&gt;&gt; y &amp; ll \"foo\" ?~ 1\nfromList [(\"foo\",Left 1)]\n\n&gt;&gt;&gt; y &amp; ll \"foo\" .~ Nothing\nfromList [(\"foo\",Right True)]\n</code></pre>\n\n<p>I verified that definition is lawful:</p>\n\n<pre><code>-- Orphan instance is ok-ish in this case :)\ninstance (Ord k, Arbitrary k, Arbitrary v) =&gt; Arbitrary (Map k v) where\n  arbitrary = Map.fromList &lt;$&gt; arbitrary\n\n-- 1) You get back what you put in:\nlensLaw1 :: Foo -&gt; Key -&gt; Maybe Val -&gt; Property\nlensLaw1 s k v = view (ll k) (set (ll k) v s) === v\n\n-- 2) Putting back what you got doesn't change anything:\nlensLaw2 :: Foo -&gt; Key -&gt; Property\nlensLaw2 s k = set (ll k) (view (ll k) s) s === s\n\n-- 3) Setting twice is the same as setting once:\nlensLaw3 :: Foo -&gt; Key -&gt; Maybe Val -&gt; Maybe Val -&gt; Property\nlensLaw3 s k v v' = set (ll k) v' (set (ll k) v s) === set (ll k) v' s\n</code></pre>\n\n<p><strong>So the question</strong>: <em>can the <code>ll</code> be defined using <a href=\"https://hackage.haskell.org/package/lens-4.7/docs/Control-Lens-At.html#v:at\" rel=\"nofollow\"><code>at</code></a> and <a href=\"https://hackage.haskell.org/package/lens-4.7/docs/Control-Lens-Prism.html#v:_Left\" rel=\"nofollow\"><code>_Left</code></a>?</em></p>\n\n<p>Maybe with some kind of <code>prismToLens :: Prism' a b -&gt; Lens' (Maybe a) (Maybe b)</code>, you can do <code>at k . prismToLens _Left</code>. Yet I'm not sure if <code>prismToLens</code> makes sense? Hoogle isn't that helpful with <code>lens</code> :(</p>\n\n<p><em>EDIT</em> seems that third law doesn't hold always. Easy to find counter-example if you change <code>Key</code> to be <code>Bool</code>. Yet in my application the <code>Map</code> is actually dependent, i.e. the sum branch depends on the key, so the <code>Lens</code> law should hold (if I access <code>foo</code>, I know it should be <code>Left</code> or not exist at all).</p>\n"}, {"tags": ["haskell", "fold"], "comments": [{"owner": {"reputation": 86, "user_id": 1440103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7ec8efa1f77ec791d541cce6ce091a?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/1440103/simon"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1423567138, "post_id": 28427524, "comment_id": 45191424, "body": "google (without much luck) with folds looking something like the best bet."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423630509, "post_id": 28427524, "comment_id": 45222718, "body": "These inputs look kind of strange. Where are they coming from?"}, {"owner": {"reputation": 86, "user_id": 1440103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7ec8efa1f77ec791d541cce6ce091a?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/1440103/simon"}, "edited": false, "score": 0, "creation_date": 1423653310, "post_id": 28427524, "comment_id": 45232936, "body": "the input is a (simplified for this question) version of csv export of customer orders from ebay. each line in the csv represents an order item. on orders with multiple items, some of the fields are left blank for the subsequent items. (very mundane I&#39;m afraid :) )"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423677542, "post_id": 28427524, "comment_id": 45248292, "body": "@Simon, if I were dealing with this sort of thing, the very first thing I would do would be to <code>map</code> over the fields and change the fields that are allowed to be <i>missing</i> from <code>String</code> to <code>Maybe String</code>. This separates the syntactic expression of missingness from its semantic model. Afterwards, you can deal with the <i>interpretation</i> of missingness as a direction to fill in the blank in a certain way."}, {"owner": {"reputation": 86, "user_id": 1440103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7ec8efa1f77ec791d541cce6ce091a?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/1440103/simon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423732451, "post_id": 28427524, "comment_id": 45270665, "body": "@dfeuer - that&#39;s a very interesting idea, thanks."}], "answers": [{"comments": [{"owner": {"reputation": 86, "user_id": 1440103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7ec8efa1f77ec791d541cce6ce091a?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/1440103/simon"}, "edited": false, "score": 0, "creation_date": 1423567716, "post_id": 28427889, "comment_id": 45191683, "body": "That&#39;s brilliant, thank you :).  Now I just need to think through <i>why</i> it works :)"}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 2, "last_activity_date": 1423560300, "last_edit_date": 1423560300, "creation_date": 1423559749, "answer_id": 28427889, "question_id": 28427524, "link": "https://stackoverflow.com/questions/28427524/how-to-process-summarise-a-list-into-a-different-list/28427889#28427889", "title": "How to process / summarise a list into a &quot;different&quot; list", "body": "<p>Pattern matching is useful here</p>\n\n<pre><code>groupData = foldl acc []\n            where acc ((r, rs):rss) (\"\":xs)   = (r, rs ++ xs): rss\n                  acc rss           (x:xs)    = (x, xs): rss\n                  acc _             _         = error \"Bad input data\"\n</code></pre>\n\n<p>resultant groups are in reverse order, use <code>reverse</code> if you need.</p>\n\n<p><em>What if I wanted a slightly different structure?</em></p>\n\n<p>Simply transform one into other, you can do inside <code>groupData</code> or as separated function.</p>\n\n<p>If you admit initial groups without <code>fst</code> element</p>\n\n<pre><code>groupData = foldr acc []\n            where acc (x:xs)   []             = [(x, xs)]\n                  acc (\"\":xs)  ((\"\", rs):rss) = (\"\", rs ++ xs): rss\n                  acc (x:xs)   ((\"\", rs):rss) = (x, rs ++ xs): rss\n                  acc (x:xs)   rss            = (x, xs): rss\n</code></pre>\n\n<p>then</p>\n\n<pre><code>let xs = [[\"\", \"item8\"],[\"\", \"item9\"],[\"order1\", \"item1\"],[\"\", \"item2\"],[\"\",\"item3\"],[\"order2\",\"item4\"]]\nprint $ groupData xs\n</code></pre>\n\n<p>is</p>\n\n<pre><code>[(\"\",[\"item9\",\"item8\"])\n,(\"order1\",[\"item3\",\"item2\",\"item1\"])\n,(\"order2\",[\"item4\"])]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 86, "user_id": 1440103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7ec8efa1f77ec791d541cce6ce091a?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/1440103/simon"}, "edited": false, "score": 0, "creation_date": 1423748041, "post_id": 28444609, "comment_id": 45280122, "body": "Frustratingly, this works perfectly if I cut/paste straight into ghci but almost identical code fails to compile if I try to incorporate it into a simple test program. (I&#39;ve added my test code to the bottom of my original question)"}, {"owner": {"reputation": 86, "user_id": 1440103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7ec8efa1f77ec791d541cce6ce091a?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/1440103/simon"}, "edited": false, "score": 0, "creation_date": 1423753469, "post_id": 28444609, "comment_id": 45283919, "body": "OK, I&#39;ve realised my mistake. The type signature of testGroupBy should be <code>[[String]] -&gt; [(String, [String])]</code>"}], "tags": [], "owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "is_accepted": false, "score": 1, "last_activity_date": 1423615222, "creation_date": 1423615222, "answer_id": 28444609, "question_id": 28427524, "link": "https://stackoverflow.com/questions/28427524/how-to-process-summarise-a-list-into-a-different-list/28444609#28444609", "title": "How to process / summarise a list into a &quot;different&quot; list", "body": "<p>Instead of looking for a <code>fold</code>-based solution, I'd first try to see whether you can define a function as a composition of higher-level functions (such as <code>map</code>). Let me fire up a <code>ghci</code> session and play abit:</p>\n\n<pre><code>\u03bb: let x = [[\"order1\", \"item1\"],[\"\", \"item2\"],[\"\",\"item3\"],[\"order2\",\"item4\"]]\n</code></pre>\n\n<p>Your \"group by\" operation actually has an existing name: <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/Data-List.html#v:groupBy\" rel=\"nofollow\"><code>Data.List.groupBy</code></a> -- this almost gets us what we need:</p>\n\n<pre><code>\u03bb: import Data.List\n\u03bb: let x' = groupBy (\\(x:xs) (y:ys) -&gt; x == y || null y) x\n\u03bb: x'\n[[[\"order1\",\"item1\"],[\"\",\"item2\"],[\"\",\"item3\"]],[[\"order2\",\"item4\"]]]\n</code></pre>\n\n<p>This <code>groupBy</code> application puts all elements in <code>x</code> into one group (i.e. list) whose first element is equal, or if the second element is empty. This can then get massaged into your desired format (in this case, the second one you proposed with a <code>map</code>):</p>\n\n<pre><code>\u03bb: let x'' = map (\\x -&gt; (head (head x), map (!! 1) x)) x'\n\u03bb: x''\n[(\"order1\",[\"item1\",\"item2\",\"item3\"]),(\"order2\",[\"item4\"])]\n</code></pre>\n\n<p>Putting it all together:</p>\n\n<pre><code>groupData :: [[String]] -&gt; [(String, [String])]\ngroupData = map (\\x -&gt; (head (head x), map (!! 1) x))\n          . groupBy (\\(x:xs) (y:ys) -&gt; x == y || y == \"\")\n</code></pre>\n\n<p>I suppose that with this, building a proper data structure (i.e. something more typesafe than nested lists) should be straightforward.</p>\n"}], "owner": {"reputation": 86, "user_id": 1440103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7ec8efa1f77ec791d541cce6ce091a?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/1440103/simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1423753553, "creation_date": 1423558629, "last_edit_date": 1423753553, "question_id": 28427524, "link": "https://stackoverflow.com/questions/28427524/how-to-process-summarise-a-list-into-a-different-list", "title": "How to process / summarise a list into a &quot;different&quot; list", "body": "<p>I think I need something like a fold or maybe a foldt but the examples I've seen, seem to only compress the list into a simple scalar value. </p>\n\n<p>What I need would need to remember and re-use values from previous lines in the list (essentially a \"group by\" operation) </p>\n\n<p>If my input data looks like:\n    <code>[[\"order1\", \"item1\"],[\"\", \"item2\"],[\"\",\"item3\"],[\"order2\",\"item4\"]]</code></p>\n\n<p>What is the correct approach to end up with something like:</p>\n\n<p><code>[[\"order1\",[\"item1\",\"item2\",\"item3\"]],[\"order2\",[\"item4\"]]</code></p>\n\n<p>ie <code>data Order = Order { id :: Text, items :: [OrderItem]}</code></p>\n\n<p>What if I wanted a slightly different structure?</p>\n\n<p><code>[(\"order1\",[\"item1\",\"item2\",\"item3\"]),(\"order\",[\"item4\"])]</code></p>\n\n<p>ie <code>data OrderTuple = OrderTuple { order :: Order, items :: [OrderItem]}</code></p>\n\n<p>What if I also wanted to keep a running total of some numeric value from the OrderItem? </p>\n\n<p>edit: Here's the code I'm trying to get working based on Frerich's answer</p>\n\n<pre><code>--testGroupBy :: [[String]] -&gt; [[String]]\ntestGroupBy :: [[String]] -&gt; [(String, [String])]\ntestGroupBy z = \n  --groupBy (\\(x:xs) (y:ys) -&gt; x == y || null y) z\n  groupBy testFunc z\n\ntestFunc :: [String] -&gt; [String] -&gt; Bool\ntestFunc (x:xs) (y:ys) = x == y || null y\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2389, "user_id": 2345370, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7f2ad519f77a20c173a0b5174a900c2d?s=128&d=identicon&r=PG", "display_name": "Not an ID", "link": "https://stackoverflow.com/users/2345370/not-an-id"}, "edited": false, "score": 0, "creation_date": 1423556003, "post_id": 28424621, "comment_id": 45185472, "body": "Not exactly duplicate with <a href=\"http://stackoverflow.com/questions/5926826/what-does-double-colon-stand-for-in-haskell\">What does :: (double colon) stand for in Haskell</a>, that one is about :: in type signature, this one is about :: in expression."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1423557810, "post_id": 28424621, "comment_id": 45186282, "body": "Actually, your question is &quot;why do I need to use <code>::</code> in with <code>read</code>?&quot;, isn&#39;t it?"}, {"owner": {"reputation": 2389, "user_id": 2345370, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7f2ad519f77a20c173a0b5174a900c2d?s=128&d=identicon&r=PG", "display_name": "Not an ID", "link": "https://stackoverflow.com/users/2345370/not-an-id"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423558072, "post_id": 28424621, "comment_id": 45186406, "body": "@Zeta I kind of know that why do I need it, because <code>read &quot;7&quot;</code> can have different meanings (7 the int or 7 the double), just want a formal definition of ::, is it a operator? is it a hint to compiler? something like that."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1423558485, "post_id": 28424621, "comment_id": 45186621, "body": "See chapter 3 of the Haskell2010 report. It&#39;s an <i>expression type signature</i>. It&#39;s not an operator, it&#39;s a language construct."}], "owner": {"reputation": 2389, "user_id": 2345370, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7f2ad519f77a20c173a0b5174a900c2d?s=128&d=identicon&r=PG", "display_name": "Not an ID", "link": "https://stackoverflow.com/users/2345370/not-an-id"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 454, "favorite_count": 0, "closed_date": 1423547968, "answer_count": 0, "score": 0, "last_activity_date": 1423558125, "creation_date": 1423545504, "last_edit_date": 1423558125, "question_id": 28424621, "link": "https://stackoverflow.com/questions/28424621/what-is-double-colon-in-haskell", "closed_reason": "Duplicate", "title": "What is double colon (::) in Haskell?", "body": "<p>The <code>::</code> in <code>read \"7\" :: Int</code>, what does it mean? <code>:info (::)</code> in GHCi gives me <code>\"parse error on input \u2018::\u2019\"</code>. Help would be appreciated.</p>\n"}, {"tags": ["haskell", "variable-assignment"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1423534298, "post_id": 28422817, "comment_id": 45178802, "body": "<code>do</code> notation is not as easy as it looks like: <a href=\"http://en.wikibooks.org/wiki/Haskell/do_notation\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/do_notation</a> + <a href=\"http://book.realworldhaskell.org/read/io.html#io.bind\" rel=\"nofollow noreferrer\">book.realworldhaskell.org/read/io.html#io.bind</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423549152, "post_id": 28422882, "comment_id": 45182923, "body": "The top level <code>where</code> is so special I hate to even compare it to regular <code>where</code> clauses. There&#39;s also a <code>where</code> in a class declaration and a <code>where</code> in a GADT or closed type family declaration."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": false, "score": 8, "last_activity_date": 1423534340, "last_edit_date": 1423534340, "creation_date": 1423533771, "answer_id": 28422882, "question_id": 28422817, "link": "https://stackoverflow.com/questions/28422817/the-usage-of-let-in-haskell/28422882#28422882", "title": "The usage of let in Haskell", "body": "<p>Haskell has two ways to introduce names: <code>let</code> and <code>where</code>. </p>\n\n<p>You use <code>let</code> whenever you could have a normal expression. This can come up in two places: if you're defining a normal value and if you're inside do-notation. In the first case, you would use <code>let ... in</code> to introduce a name just within a single expression:</p>\n\n<pre><code>myFoo = let x = 10 ^ 10 in x + x\n</code></pre>\n\n<p>Inside do-notation, you do not need an <code>in</code>; instead, the <code>let</code> takes up a line just like a normal \"statement\" in do-notation. This is what your first example has:</p>\n\n<pre><code>main = do\n  let x = something\n  ...\n</code></pre>\n\n<p>The other way to introduce names is with <code>where</code> clauses, which go <em>outside</em> of expression. The top-level of your program\u2014where you define all the globally visible names in your module\u2014is in a <code>where</code> block, which is why you just write <code>name = expression</code> without a <code>let</code>. This happens because your module implicitly has </p>\n\n<pre><code>module Main where\n</code></pre>\n\n<p>on top even if you didn't write it yourself.</p>\n\n<p>You can also write <code>where</code> blocks of your own in different scopes, which also let you define names without <code>let</code>:</p>\n\n<pre><code>foo x = ...\n  where helperA = something\n        helperB = something\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 10, "last_activity_date": 1423534200, "creation_date": 1423534200, "answer_id": 28422941, "question_id": 28422817, "link": "https://stackoverflow.com/questions/28422817/the-usage-of-let-in-haskell/28422941#28422941", "title": "The usage of let in Haskell", "body": "<p>Declarations/equations need to be inside either a <code>let</code> or a <code>where</code> block. The reason you don't need <code>let</code> at the top level of a module, is that it counts as a <code>where</code> block all by itself, started by its <code>module</code> declaration.  A module which doesn't contain an explicit <code>module</code> header gets an implicit</p>\n\n<pre><code>module Main (main) where\n</code></pre>\n\n<p>at the beginning.</p>\n\n<p>By the way, an indented <code>let</code> block can contain more than one declaration: you don't need the second <code>let</code> in your code as long as the equations line up vertically.</p>\n"}, {"tags": [], "owner": {"reputation": 325, "user_id": 2841309, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dd89b9b62cd483082b3f1a20acff659?s=128&d=identicon&r=PG&f=1", "display_name": "coffeequant", "link": "https://stackoverflow.com/users/2841309/coffeequant"}, "is_accepted": false, "score": -1, "last_activity_date": 1423534959, "creation_date": 1423534959, "answer_id": 28423022, "question_id": 28422817, "link": "https://stackoverflow.com/questions/28422817/the-usage-of-let-in-haskell/28423022#28423022", "title": "The usage of let in Haskell", "body": "<pre><code>do notation is for monads. I am guessing you are unclear about monads.\n</code></pre>\n\n<p>let used inside do notation is basically binding. the do notation translates to this form</p>\n\n<pre><code>do {let x = expression; restofit} ==&gt; let x = expression in do {restofit}\n</code></pre>\n\n<p>For instance this </p>\n\n<pre><code>do \n line1 &lt;- getLine            -- executes an action\n line2 &lt;- getLine            -- executes an action\n let joined = line1 ++ line2 -- pure calculation; no action is executed\n return joined\n</code></pre>\n\n<p>This translates to </p>\n\n<pre><code>let joined = line1 ++ line2 in line1 &lt;-getLine &gt;&gt; line2 &lt;- getLine \n</code></pre>\n"}], "owner": {"reputation": 154069, "user_id": 260127, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/74758c702067a3490094451e475e28c5?s=128&d=identicon&r=PG", "display_name": "prosseek", "link": "https://stackoverflow.com/users/260127/prosseek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1260, "favorite_count": 0, "accepted_answer_id": 28422941, "answer_count": 3, "score": 4, "last_activity_date": 1423534959, "creation_date": 1423533404, "question_id": 28422817, "link": "https://stackoverflow.com/questions/28422817/the-usage-of-let-in-haskell", "title": "The usage of let in Haskell", "body": "<p>I have this code in Haskell.</p>\n\n<pre><code>import Data.List\n\nmain = do\n    putStrLn $ \"\\nVerify if Exists in a String\"\n    let wordlist = [\"monad\", \"monoid\", \"Galois\", \"ghc\", \"SPJ\"]\n    let tweet = \"This is an example tweet talking about SPJ interviewing with Galois\"\n    print $ map (flip isInfixOf tweet) wordlist\n</code></pre>\n\n<p>Without the <code>let</code>, I have this error message: <code>10_things.hs:16:14: parse error on input \u2018=\u2019</code>.</p>\n\n<p>This is another code that works fine.</p>\n\n<pre><code>import Data.List\n\nwordlist = [\"monad\", \"monoid\", \"Galois\", \"ghc\", \"SPJ\"]\ntweet = \"This is an example tweet talking about SPJ interviewing with Galois\"      \nmain = do\n    putStrLn $ \"\\nVerify if Exists in a String\"\n    print $ map (flip isInfixOf tweet) wordlist\n</code></pre>\n\n<p>In this case, I have error <code>parse error (possibly incorrect indentation or mismatched brackets)</code> with let. \nMy question is when and when not to use <code>let</code> in Haskell? </p>\n"}, {"tags": ["haskell", "haskell-turtle"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1423525489, "post_id": 28421469, "comment_id": 45176385, "body": "I&#39;m not sure a <code>haskell-turtle</code> tag is really warranted, so I wouldn&#39;t worry about creating it."}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 1, "creation_date": 1423528653, "post_id": 28421469, "comment_id": 45177303, "body": "Actually, the <code>turtle</code> documentation specifically requested this tag at <a href=\"https://hackage.haskell.org/package/turtle-1.0.1/docs/Turtle-Tutorial.html#g:16\" rel=\"nofollow noreferrer\">the very end</a>, but I can remove that request if you think the <code>haskell</code> tag is appropriate enough"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1423532384, "post_id": 28421469, "comment_id": 45178332, "body": "@GabrielGonzalez, I think it&#39;s probably better to wait for the download numbers to creep up just a bit first."}], "answers": [{"comments": [{"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 2, "creation_date": 1423542419, "post_id": 28422201, "comment_id": 45180958, "body": "Do you think its worth adding the <code>import Data.IORef</code> to the snippet? I know that Turtle is partly aimed at beginners so I thought it might be worthwhile."}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "reply_to_user": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1423547529, "post_id": 28422201, "comment_id": 45182385, "body": "Fixed.  I added necessary imports"}, {"owner": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "edited": false, "score": 0, "creation_date": 1423569282, "post_id": 28422201, "comment_id": 45192442, "body": "That solves it. That&#39;s quite a &quot;low level&quot; solution, I wouldn&#39;t have come up with it for sure. Might be worth adding it to the library. Btw, in  similar way, is it possible to collapse every n lines into one line and pass the resulting lines to the output file in a streaming fashion ? thanks"}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1423594380, "post_id": 28422201, "comment_id": 45208655, "body": "The main reason it&#39;s low level is the need to get exception safety correct.  If not for that then I could replace <code>Shell</code> with a simpler abstraction like <code>ListT IO</code>."}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1423594787, "post_id": 28422201, "comment_id": 45208884, "body": "For your second question, I&#39;d just take the time to understand how <code>Shell</code> works.  There are some more general ways to do this but they would not be highly reusable."}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 1, "creation_date": 1452508914, "post_id": 28422201, "comment_id": 57184649, "body": "I just want to cast a vote to include this into Prelude.Turtle! By the way, you need to add a &quot;import Prelude hiding (drop)&quot; at the top of the code. Otherwise it works."}], "tags": [], "owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "is_accepted": true, "score": 5, "last_activity_date": 1423547517, "last_edit_date": 1423547517, "creation_date": 1423528939, "answer_id": 28422201, "question_id": 28421469, "link": "https://stackoverflow.com/questions/28421469/how-to-drop-lines-when-streaming-from-a-file-using-haskell-and-the-turtle-librar/28422201#28422201", "title": "how to drop lines when streaming from a file using Haskell and the turtle library", "body": "<p>I think this is the correct code:</p>\n\n<pre><code>import Data.IORef\nimport Turtle\n\ndrop :: Int -&gt; Shell a -&gt; Shell a\ndrop n s = Shell (\\(FoldM step begin done) -&gt; do\n    ref &lt;- newIORef 0\n    let step' x a = do\n            n' &lt;- readIORef ref\n            writeIORef ref (n' + 1)\n            if n' &lt; n then return x else step x a\n    foldIO s (FoldM step' begin done) )\n</code></pre>\n\n<p>... except I'd probably call it something other than <code>drop</code> to avoid clashing with the Prelude.</p>\n\n<p>It's almost identical to <code>Turtle.Prelude.limit</code> (See <a href=\"https://github.com/Gabriel439/Haskell-Turtle-Library/blob/master/src/Turtle/Prelude.hs#L675\" rel=\"nofollow\">source code</a> for comparison).  The only difference is that I've reversed the <code>then</code> and <code>else</code> clause of the <code>if</code> statement.</p>\n\n<p>If that solves your problem then I'll add it to <code>Turtle.Prelude</code>.</p>\n"}], "owner": {"reputation": 939, "user_id": 743528, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/527d3750f03157ce31f599d7e883c906?s=128&d=identicon&r=PG", "display_name": "miguel.negrao", "link": "https://stackoverflow.com/users/743528/miguel-negrao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 0, "accepted_answer_id": 28422201, "answer_count": 1, "score": 3, "last_activity_date": 1452274414, "creation_date": 1423524568, "last_edit_date": 1452274414, "question_id": 28421469, "link": "https://stackoverflow.com/questions/28421469/how-to-drop-lines-when-streaming-from-a-file-using-haskell-and-the-turtle-librar", "title": "how to drop lines when streaming from a file using Haskell and the turtle library", "body": "<p>Let's say I want to stream from one file to another file but I want to skip the first n lines of the input file. How do I do this without first collapsing the whole first file using 'fold' ?</p>\n\n<pre><code>import Turtle\nmain = output \"/tmp/b.txt\" (f (input \"/tmp/a.txt\"))\n</code></pre>\n\n<p>What should 'f' be here to accomplish this ?</p>\n\n<p>ps: I don't have enough reputation to create the 'haskell-turtle' tag.</p>\n"}, {"tags": ["scala", "haskell", "automata"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 7, "last_activity_date": 1423527058, "creation_date": 1423527058, "answer_id": 28421892, "question_id": 28420945, "link": "https://stackoverflow.com/questions/28420945/is-there-any-particular-reason-this-type-is-not-a-generalized-dfa-and-if-so-wh/28421892#28421892", "title": "Is there any particular reason this type is not a generalized DFA? And if so, what is it really?", "body": "<p>This type does not represent a DFA because it is too general. Specifically, the <code>I</code> type may be able to take on infinitely many values. If you make <code>I</code> a sequence of some kind (or, better, two of them) paired with something representing finite state, you can easily simulate a Turing machine directly.</p>\n"}], "owner": {"reputation": 814, "user_id": 3574875, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/bubBW.jpg?s=128&g=1", "display_name": "Mzk Levi", "link": "https://stackoverflow.com/users/3574875/mzk-levi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1423534181, "creation_date": 1423521996, "last_edit_date": 1423534181, "question_id": 28420945, "link": "https://stackoverflow.com/questions/28420945/is-there-any-particular-reason-this-type-is-not-a-generalized-dfa-and-if-so-wh", "title": "Is there any particular reason this type is not a generalized DFA? And if so, what is it really?", "body": "<p>I'm putting together a library of fundamental structures in Scala for use in either production or for personal study.  I'm focusing on clear descriptions of said structures in either type theory, cat theory, set theory. One of the types,</p>\n\n<pre><code>abstract case class Fold[A, B]() {\n  type I\n  def trans: I =&gt; A =&gt; I\n  def start: I\n  def output: I =&gt; B\n\n  def cojoin: Fold[A, Fold[A, B]] \n  def copoint: B    \n  def dimap[Z, C](f: Z =&gt; A, g: B =&gt; C): Fold[Z, C]\n }\n</code></pre>\n\n<p>which is (I'm fairly certain) isomorphic to,<br>\n(credit: <a href=\"http://www.haskellforall.com/2013/08/composable-streaming-folds.html\" rel=\"nofollow\">http://www.haskellforall.com/2013/08/composable-streaming-folds.html</a>)</p>\n\n<pre><code>abstract case class Fold'[A, B]() {\n  type W\n  def MonW: Monoid[W]\n  def tally: A =&gt; W\n  def summerize: W =&gt; B\n}\n</code></pre>\n\n<p>One of the types to me greatly resembles a DFA, and in <a href=\"https://www.fpcomplete.com/user/edwardk/cellular-automata/part-2\" rel=\"nofollow\">https://www.fpcomplete.com/user/edwardk/cellular-automata/part-2</a>\nMr. Kmett essentially says as much.  My question is what is this type if <em>not</em> a DFA?</p>\n"}, {"tags": ["haskell", "network-programming", "binary-data"], "comments": [{"owner": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "edited": false, "score": 2, "creation_date": 1423519446, "post_id": 28419427, "comment_id": 45173696, "body": "I cannot answer all of your questions, but I believe conduit and pipes will help you to avoid lazy I/O: check out <a href=\"https://hackage.haskell.org/package/conduit-0.4.0/docs/Data-Conduit-Binary.html\" rel=\"nofollow noreferrer\">Data.Conduit.Binary</a> and <a href=\"https://hackage.haskell.org/package/pipes-bytestring-2.1.1/docs/Pipes-ByteString.html\" rel=\"nofollow noreferrer\">Pipes.ByteString</a>"}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1423519768, "post_id": 28419427, "comment_id": 45173879, "body": "I don&#39;t have my old benchmarks lying around, but I remember that it was more efficient to directly <code>hPut</code> and <code>hGet</code> your numbers directly to the socket than to build up a large <code>ByteString</code> and send that.  The difference in speed can be as much as 5-fold faster for <code>hPut</code>/<code>hGet</code>.  This is how, for example, how all the <code>blaze-*</code> packages get their speed improvements."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1423520474, "post_id": 28419427, "comment_id": 45174247, "body": "@GabrielGonzalez, is that because <code>hPut</code> and <code>hGet</code> use functions that already do their own buffering?"}, {"owner": {"reputation": 34015, "user_id": 1026598, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e4cf2da845e7862bd0b0e4edd405f77d?s=128&d=identicon&r=PG", "display_name": "Gabriel Gonzalez", "link": "https://stackoverflow.com/users/1026598/gabriel-gonzalez"}, "edited": false, "score": 0, "creation_date": 1423521159, "post_id": 28419427, "comment_id": 45174571, "body": "Oh sorry, I misunderstood the question a little bit.  I was describing eliminating the <code>ByteString</code> intermediate entirely (such as when writing to a handle or socket), but on closer reading I see that&#39;s not what you meant."}], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1423523136, "last_edit_date": 1495541785, "creation_date": 1423522252, "answer_id": 28420994, "question_id": 28419427, "link": "https://stackoverflow.com/questions/28419427/efficient-binary-i-o-over-a-network/28420994#28420994", "title": "Efficient binary I/O over a network", "body": "<p>Re question 1...</p>\n\n<p>If the handle is configured with <code>NoBuffering</code> each <code>hPutStr</code> call will generate a write system call. This will incur a huge performance penalty for a large number of small writes. See, e.g., this SO answer for some benchmarking: <a href=\"https://stackoverflow.com/a/28146677/866915\">https://stackoverflow.com/a/28146677/866915</a></p>\n\n<p>On the other hand, if the handle has buffering enabled you will need to explicitly flush the handle to ensure that the buffered data is sent.</p>\n\n<p>I'm assuming you're using a streaming protocol like TCP. With UDP you obviously have to form and send each message as an atomic unit.</p>\n\n<p>Re question #2...</p>\n\n<p>Reading the code it appears that <code>hGet</code> for lazy bytestrings will read from the handle in chunks of <code>defaultChunkSize</code> which is about 32k.</p>\n\n<p>Update: It appears that hGet does <em>not</em> perform lazy IO in this case. Here is some code to test this. \nfeed:</p>\n\n<pre><code>#!/usr/bin/env perl\n$| = 1;\nmy $c = 0;\nmy $k = \"1\" x 1024;\nwhile (1) {\n  syswrite(STDOUT, $k);\n  $c++;\n  print STDERR \"wrote 1k count = $c\\n\";\n}\n</code></pre>\n\n<p>Test.hs:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as LBS\nimport System.IO\n\nmain = do\n  s &lt;- LBS.hGet stdin 320000\n  let s2 = LBS.take 10 s\n  print $ (\"Length s2 = \", s2)\n</code></pre>\n\n<p>Running <code>perl feed | runhaskell Test.hs</code>\nit is clear that the Haskell program demands all 320k from the perl program even though it only uses the first 10 bytes.</p>\n"}, {"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 4, "last_activity_date": 1423543493, "last_edit_date": 1423543493, "creation_date": 1423528556, "answer_id": 28422134, "question_id": 28419427, "link": "https://stackoverflow.com/questions/28419427/efficient-binary-i-o-over-a-network/28422134#28422134", "title": "Efficient binary I/O over a network", "body": "<p>TCP requires that the application provide its own message boundary markers. A simple protocol to mark message boundaries is to send the length of a chunk of data, the chunk of data, and whether there are remaining chunks that are part of the same message. The optimal size for the header that holds the message boundary information depends on the distribution of message sizes.</p>\n\n<p>Developing our own little message protocol, we'll use two bytes for our headers. The most significant bit from the bytes (treated as a <code>Word16</code>) will hold whether or not there are remaining chunks in the message. The remaining 15 bits will hold the length of the message in bytes. This will allow chunk sizes up to 32k, larger than typical TCP packets. A two byte header will be less-than-optimal if messages are typically very small, especially if they are smaller than 127 bytes.</p>\n\n<p>We're going to use <a href=\"https://hackage.haskell.org/package/network-simple\" rel=\"nofollow\">network-simple</a> for the networking portion of our code. We'll serialize or deserialize messages with the <a href=\"https://hackage.haskell.org/package/binary\" rel=\"nofollow\">binary</a> package which <code>encode</code>s and <code>decode</code>s to and from lazy <code>ByteString</code>s.</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as L\nimport qualified Data.ByteString as B\n\nimport Network.Simple.TCP \nimport Data.Bits\nimport Data.Binary\nimport Data.Functor\nimport Control.Monad.IO.Class\n</code></pre>\n\n<p>The first utility we will need is the ability to write <code>Word16</code> headers into strict <code>ByteString</code>s and read them back out again. We'll write them in big-endian order. Alternatively, these could be written in terms of the <code>Binary</code> instance for <code>Word16</code>.</p>\n\n<pre><code>writeBE :: Word16 -&gt; B.ByteString\nwriteBE x = B.pack . map fromIntegral $ [(x .&amp;. 0xFF00) `shiftR` 8, x .&amp;. 0xFF]\n\nreadBE :: B.ByteString -&gt; Maybe Word16\nreadBE s =\n    case map fromIntegral . B.unpack $ s of\n        [w1, w0] -&gt; Just $ w1 `shiftL` 8 .|. w0\n        _        -&gt; Nothing\n</code></pre>\n\n<p>The main challenge will be to send and recieve the lazy <code>ByteString</code>s forced on us by the binary package. Since we will only be able to send up to 32k bytes at a time, we need to be able to <code>rechunk</code> a lazy bytestring into chunks with a total known length no more than our maximum. A single chunk might already be more than the maximum; any chunk that doesn't fit into our new chunks is split across multiple chunks.</p>\n\n<pre><code>rechunk :: Int -&gt; [B.ByteString] -&gt; [(Int, [B.ByteString])]\nrechunk n = go [] 0 . filter (not . B.null)\n    where\n        go acc l []     = [(l, reverse acc)]\n        go acc l (x:xs) =\n            let\n                lx = B.length x\n                l' = lx + l\n            in\n                if l' &lt;= n\n                then go (x:acc) l' xs\n                else\n                    let (x0, x1) = B.splitAt (n-l) x\n                    in (n, reverse (x0:acc)) : go [] 0 (x1:xs)\n</code></pre>\n\n<p><code>recvExactly</code> will loop until all of the bytes we requested have been received.</p>\n\n<pre><code>recvExactly :: MonadIO m =&gt; Socket -&gt; Int -&gt; m (Maybe [B.ByteString])\nrecvExactly s toRead = go [] toRead\n    where\n        go acc toRead = do\n            body &lt;- recv s toRead\n            maybe (return Nothing) (go' acc toRead) body\n        go' acc toRead body =\n            if B.length body &lt; toRead\n            then go (body:acc) (toRead - B.length body)\n            else return . Just . reverse $ acc\n</code></pre>\n\n<p>Sending a lazy <code>ByteString</code> consists of breaking it into chunks of a size we know we can send and sending each chunk along with the header holding the size and whether there are any more chunks.</p>\n\n<pre><code>sendLazyBS :: (MonadIO m) =&gt; Socket -&gt; L.ByteString -&gt; m ()\nsendLazyBS s = go . rechunk maxChunk . L.toChunks\n    where\n        maxChunk = 0x7FFF\n        go [] = return ()\n        go ((li, ss):xs) = do\n            let l = fromIntegral li\n            let h = writeBE $ if null xs then l else l .|. 0x8000\n            sendMany s (h:ss)\n            go xs\n</code></pre>\n\n<p>Receiving a lazy <code>ByteString</code> consists of reading the two byte header, reading a chunk of the size indicated by the header, and continuing to read as long as the header indicated there are more chunks.</p>\n\n<pre><code>recvLazyBS :: (MonadIO m, Functor m) =&gt; Socket -&gt; m (Maybe L.ByteString)\nrecvLazyBS s = fmap L.fromChunks &lt;$&gt; go [] \n    where\n        go acc = do\n            header &lt;- recvExactly s 2\n            maybe (return Nothing) (go' acc) (header &gt;&gt;= readBE . B.concat)\n        go' acc h = do\n            body &lt;- recvExactly s . fromIntegral $ h .&amp;. 0x7FFF\n            let next = if h .&amp;. 0x8000 /= 0\n                       then go\n                       else return . Just . concat . reverse\n            maybe (return Nothing) (next . (:acc) ) body     \n</code></pre>\n\n<p>Sending or receiving a message that has a <code>Binary</code> instance is just sending an <code>encode</code>d lazy <code>ByteString</code> or receiving the lazy <code>ByteString</code> and <code>decode</code>ing it.</p>\n\n<pre><code>sendBinary :: (MonadIO m, Binary a) =&gt; Socket -&gt; a -&gt; m ()\nsendBinary s = sendLazyBS s . encode\n\nrecvBinary :: (MonadIO m, Binary a, Functor m) =&gt; Socket -&gt; m (Maybe a)\nrecvBinary s = d . fmap decodeOrFail &lt;$&gt; recvLazyBS s\n    where\n        d (Just (Right (_, _, x))) = Just x\n        d _                        = Nothing\n</code></pre>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 481, "favorite_count": 4, "accepted_answer_id": 28420994, "answer_count": 2, "score": 11, "last_activity_date": 1423543493, "creation_date": 1423516188, "question_id": 28419427, "link": "https://stackoverflow.com/questions/28419427/efficient-binary-i-o-over-a-network", "title": "Efficient binary I/O over a network", "body": "<p>I'm trying to write a small Haskell program that talks a binary network protocol, and I'm having a surprising amount of difficulty.</p>\n\n<p>It seems clear that the binary data should be stored as <code>ByteString</code>.</p>\n\n<p>Question: Should I just <code>hGet</code> / <code>hPut</code> individual multi-byte integers, or is it more performant to build a big <code>ByteString</code> of the whole thing and use that?</p>\n\n<p>It seems like the <code>binary</code> package should be useful here. However, <code>binary</code> deals only with <em>lazy</em> <code>ByteString</code> values.</p>\n\n<p>Question: Does <code>hGet</code> on a <em>lazy</em> <code>ByteString</code> actually read the specified number of bytes strictly? Or does it try to do some kind of lazy I/O? (I do <em>not</em> want lazy I/O!)</p>\n\n<p>Question: Why does the documentation not specify this?</p>\n\n<p>The code looks like it's going to contain a lot of \"get the next integer, compare it to this value, if no then throw an error, otherwise continue to the next step...\" I'm not sure how to cleanly structure that without writing spaghetti code.</p>\n\n<p>In summary, what I'm trying to do is quite simple, but I seem to be struggling for a way to make the code <em>look</em> simple. Maybe I'm just over-thinking this and missing something obvious...</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1423513877, "creation_date": 1423513877, "answer_id": 28418774, "question_id": 28418682, "link": "https://stackoverflow.com/questions/28418682/infinite-loop-in-recursive-haskell-function/28418774#28418774", "title": "Infinite loop in recursive Haskell function", "body": "<p>It appears that the main problem is that you define a local version of <code>div</code>:</p>\n\n<pre><code>div x y\n  | x `mod` y == 0 = x `div` y\n  | otherwise = x\n</code></pre>\n\n<p>Since bindings in <code>where</code> clauses (as well as in <code>let</code>) are recursive, the <code>div</code> on the right hand side of the first case refers to the same <code>div</code> you're defining! You can fix this by using a different name, like <code>div'</code>:</p>\n\n<pre><code>div' x y\n  | x `mod` y == 0 = x `div` y\n  | otherwise = x\n</code></pre>\n"}], "owner": {"reputation": 680, "user_id": 839803, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c1b931b7aa0917cffb80ad4449f04461?s=128&d=identicon&r=PG", "display_name": "Julio", "link": "https://stackoverflow.com/users/839803/julio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 28418774, "answer_count": 1, "score": 0, "last_activity_date": 1423513877, "creation_date": 1423513566, "question_id": 28418682, "link": "https://stackoverflow.com/questions/28418682/infinite-loop-in-recursive-haskell-function", "title": "Infinite loop in recursive Haskell function", "body": "<p>Hmm... why does this function ends in an infinite loop when evaluating for any integer > 3?</p>\n\n<pre><code>smallestMultiple n = factors [2..n] where\nfactors [] = []\nfactors (h:xs) = h:(factors $ filter ((&lt;)1) [div x h|x&lt;-xs])\n    where\n      div x y\n          |x `mod` y ==0 = x `div` y\n          |otherwise = x\n</code></pre>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1423507487, "post_id": 28416827, "comment_id": 45167101, "body": "Are you using <code>--enable-coverage</code>? If you don&#39;t, then you probably should. If you do, then you don&#39;t need <code>-fhpc</code>."}, {"owner": {"reputation": 8813, "user_id": 389119, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05241abffd72dcdcd1dc9d6833706ba9?s=128&d=identicon&r=PG", "display_name": "antoyo", "link": "https://stackoverflow.com/users/389119/antoyo"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1423508138, "post_id": 28416827, "comment_id": 45167419, "body": "No, I don&#39;t use it. I&#39;ve just tried to use it but I get the following error: <code>cabal: unrecognized &#39;test&#39; option --enable-coverage</code> when running <code>cabal test --enable-coverage</code>. The Cabal User Guide does not seem to indicate how to use it. Can you explain me how to use it, please? Thanks."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 1, "creation_date": 1423509146, "post_id": 28416827, "comment_id": 45167978, "body": "You should enable the flag when configuring: <code>cabal configure --enable-converage</code>. Then run tests as usual."}, {"owner": {"reputation": 8813, "user_id": 389119, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05241abffd72dcdcd1dc9d6833706ba9?s=128&d=identicon&r=PG", "display_name": "antoyo", "link": "https://stackoverflow.com/users/389119/antoyo"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1423509336, "post_id": 28416827, "comment_id": 45168094, "body": "Thanks. This is exactly what is was looking for. If you put that as an answer, I&#39;ll accept it."}, {"owner": {"reputation": 6725, "user_id": 251630, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c354f01e76454d03fffd7a3cebe24d9a?s=128&d=identicon&r=PG", "display_name": "Luke Hoersten", "link": "https://stackoverflow.com/users/251630/luke-hoersten"}, "edited": false, "score": 0, "creation_date": 1428504492, "post_id": 28416827, "comment_id": 47191109, "body": "What&#39;s the effective difference between --enable-coverage and -fhpc? I was using both. Is that a problem?"}], "answers": [{"comments": [{"owner": {"reputation": 8813, "user_id": 389119, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05241abffd72dcdcd1dc9d6833706ba9?s=128&d=identicon&r=PG", "display_name": "antoyo", "link": "https://stackoverflow.com/users/389119/antoyo"}, "edited": false, "score": 0, "creation_date": 1424016725, "post_id": 28417626, "comment_id": 45371542, "body": "How should I run my application to get the *.tix file in the dist directory? I tried <code>cabal run</code> but the *.tix file is created in the current directory."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 8813, "user_id": 389119, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05241abffd72dcdcd1dc9d6833706ba9?s=128&d=identicon&r=PG", "display_name": "antoyo", "link": "https://stackoverflow.com/users/389119/antoyo"}, "edited": false, "score": 1, "creation_date": 1424017695, "post_id": 28417626, "comment_id": 45371828, "body": "@antoyo try <code>HPCTIXFILE</code> environment variable. Try <code>cabal test -v3</code> to see how <code>cabal</code> uses it."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 4, "last_activity_date": 1435756959, "last_edit_date": 1435756959, "creation_date": 1423509784, "answer_id": 28417626, "question_id": 28416827, "link": "https://stackoverflow.com/questions/28416827/cabal-and-hpc-and-errors-when-running-tests-with-code-coverage/28417626#28417626", "title": "Cabal and HPC and Errors when Running Tests with Code Coverage", "body": "<p>To make <code>cabal</code> generate code coverage report, you can enable that when configuring your package:</p>\n\n\n\n<pre class=\"lang-none prettyprint-override\"><code>cabal configure --enable-coverage\n</code></pre>\n\n<p>Then run tests as usual:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cabal test\n</code></pre>\n\n<p>Note that you may need <code>--enable-library-coverage</code> with older <code>cabal</code>. Also IIRC <code>hpc</code> integration in cabal was broken for <code>ghc-7.6</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 121, "user_id": 1781815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab0b878bcf73c8f016480de339a88154?s=128&d=identicon&r=PG", "display_name": "danplubell", "link": "https://stackoverflow.com/users/1781815/danplubell"}, "is_accepted": false, "score": 1, "last_activity_date": 1423682060, "creation_date": 1423682060, "answer_id": 28462570, "question_id": 28416827, "link": "https://stackoverflow.com/questions/28416827/cabal-and-hpc-and-errors-when-running-tests-with-code-coverage/28462570#28462570", "title": "Cabal and HPC and Errors when Running Tests with Code Coverage", "body": "<p>I'm using GHC 7.8.3 and Cabal 1.22.0.0</p>\n\n<p>You can set the file path of the .tix files in a couple of ways.</p>\n\n<ol>\n<li><p>Set the HPCTIXDIR environment variable. The tix file will be created in the provided directory.  The name will be formatted as -.tix\nIf the directory doesn't exist it will be created.</p></li>\n<li><p>Set the HPCTIXFILE environment variable.  The tix file will be created with the file name you provided in the current working directory.  You can specify a file path.  But, the directory won't be created.</p></li>\n</ol>\n"}], "owner": {"reputation": 8813, "user_id": 389119, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/05241abffd72dcdcd1dc9d6833706ba9?s=128&d=identicon&r=PG", "display_name": "antoyo", "link": "https://stackoverflow.com/users/389119/antoyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 555, "favorite_count": 1, "accepted_answer_id": 28417626, "answer_count": 2, "score": 4, "last_activity_date": 1435756959, "creation_date": 1423506866, "question_id": 28416827, "link": "https://stackoverflow.com/questions/28416827/cabal-and-hpc-and-errors-when-running-tests-with-code-coverage", "title": "Cabal and HPC and Errors when Running Tests with Code Coverage", "body": "<p>I use Cabal to run my tests.</p>\n\n<p>Here is how it is configured in the <code>.cabal</code> file:</p>\n\n<pre><code>test-suite test\n    type:           exitcode-stdio-1.0\n    main-is:        Test.hs\n    build-depends:  base &gt;= 4.7 &amp;&amp; &lt; 4.8, containers &gt;=0.5 &amp;&amp; &lt;0.6, ghc, test-framework &gt;=0.8 &amp;&amp; &lt;0.9, QuickCheck &gt;=2.7 &amp;&amp; &lt;2.8, HUnit &gt;=1.2 &amp;&amp; &lt;1.3, test-framework-hunit, test-framework-quickcheck2\n    default-language:    Haskell2010\n    ghc-options:    -Wall -fhpc\n</code></pre>\n\n<p>When I run the test the first time, everything is OK.</p>\n\n<p>However, if I change the tests and run them again, I get the following error:</p>\n\n<pre><code>Hpc failure: module mismatch with .tix/.mix file hash number\n(perhaps remove test.tix file?)\n</code></pre>\n\n<p>So, I need to manually remove the <code>.tix</code> file.</p>\n\n<p>Is there a way to get rid of this problem?</p>\n\n<p>By the way, is there a way to have this <code>.tix</code> file generated in the <code>dist</code> directory instead of at the root directory?</p>\n\n<p>How can I configure my Cabal file to work nicely with HPC (i.e. having the generated HTML files in the <code>dist</code> directory)?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423519674, "post_id": 28414549, "comment_id": 45173826, "body": "If Project.Preprocessor is part of the library, I don&#39;t think cabal can use it to build the library itself. You may have to hack this together yourself (or perhaps there is some other tool). If it isn&#39;t in the library, it is not inconceivable that it should just be in the root directory (or the code inside Setup.hs). In general, I believe that <code>hs-source-dirs: src</code> indicates to look in &#39;src&#39; for source files. By default, it only looks in the project root."}, {"owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423521591, "post_id": 28414549, "comment_id": 45174762, "body": "Yeah, <code>hs-source-dirs</code> doesn&#39;t seem to include stuff for <code>Setup.hs</code>, which makes sense. I can re-root it, I just wondered if <code>cabal</code> had a knob to address this."}], "owner": {"reputation": 2336, "user_id": 799829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/736cd516c29ee2f6cdc2c8f454a36bb9?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/799829/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1423501443, "creation_date": 1423499459, "last_edit_date": 1423501443, "question_id": 28414549, "link": "https://stackoverflow.com/questions/28414549/cabal-custom-build-include-dir", "title": "cabal custom build include dir", "body": "<p>I have a cabal file with a custom build to (calls <code>Setup.hs</code> to perform some preprocessing).  But <code>Setup.hs</code> imports <code>Project.Preprocessor</code>, which is under <code>src</code> as show below.</p>\n\n<pre><code>project.cabal\nSetup.hs\nsrc/Project/Preprocessor.hs\nsrc/Project/OtherFiles...\n</code></pre>\n\n<p>This fails since <code>src</code> is not included (as in <code>runghc -isrc Setup.hs build</code>).</p>\n\n<pre><code>dist\\setup\\setup.hs:3:18:\n  Could not find module Project.Preprocessor\n  ...\n</code></pre>\n\n<p><em>Is there any way to include an extra source directory for build process?</em></p>\n\n<p>I.e. like <code>runghci -isrc Setup.hs</code> (but from <code>cabal build</code>).</p>\n\n<p>EDIT: I did verify that <code>runghc -isrc Setup.hs build</code> executes. :-)</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "newtype"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1423499194, "post_id": 28414074, "comment_id": 45162155, "body": "What does &quot;normal object model semantics&quot; mean?"}, {"owner": {"reputation": 2917, "user_id": 486167, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f043204ff888375a2657ec3bc149c53c?s=128&d=identicon&r=PG", "display_name": "Asad Iqbal", "link": "https://stackoverflow.com/users/486167/asad-iqbal"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423500937, "post_id": 28414074, "comment_id": 45163350, "body": "I agree &#39;normal&#39; is controversial word. But I couldn&#39;t find any better way to express my confusion."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1423501167, "post_id": 28414074, "comment_id": 45163515, "body": "My point is that it&#39;s much better to try to come up with plain language expressing your point than to use fancy words like &quot;object model semantics&quot;. Haskell doesn&#39;t even have objects, so such descriptions are much more likely to confuse than to communicate."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423501908, "post_id": 28414368, "comment_id": 45163984, "body": "May I suggest using the terms &quot;type constructor&quot; and &quot;data constructor&quot;?"}, {"owner": {"reputation": 6500, "user_id": 57879, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/419a88bdf20aeaa3fb2de53ca0f4d836?s=128&d=identicon&r=PG", "display_name": "yatima2975", "link": "https://stackoverflow.com/users/57879/yatima2975"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423651121, "post_id": 28414368, "comment_id": 45231697, "body": "I would actually prefer to de-overload the word &quot;constructor&quot; and let constructors work on the value level (i.e. they do something &quot;on the heap&quot; at runtime), and call <code>STRType</code> a type-former or something."}], "tags": [], "owner": {"reputation": 6500, "user_id": 57879, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/419a88bdf20aeaa3fb2de53ca0f4d836?s=128&d=identicon&r=PG", "display_name": "yatima2975", "link": "https://stackoverflow.com/users/57879/yatima2975"}, "is_accepted": true, "score": 9, "last_activity_date": 1423498919, "creation_date": 1423498919, "answer_id": 28414368, "question_id": 28414074, "link": "https://stackoverflow.com/questions/28414074/haskell-newtype-definition/28414368#28414368", "title": "Haskell newtype definition", "body": "<p>The <code>newtype</code> definition is a bit confusing, because the symbol <code>STR</code> is used in two different meanings: namely that of type name (the first occurrence) and that of constructor (the second). Renaming both to something different leads to the equivalent</p>\n\n<pre><code>newtype STRType a = STRConstructor (Store -&gt; (Result a, Store))\n</code></pre>\n\n<p>In other words, this introduces a type <code>STRType a</code> which is structurally the same as <code>Store -&gt; (Result a, Store)</code> (but needs to be wrapped in a <code>STRConstructor</code>)</p>\n\n<p>I hope your course/book already went into the differences between <code>type</code>, <code>data</code> and <code>newtype</code>; otherwise this is going to remain rather mysterious, I'm afraid...</p>\n"}, {"tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 3, "last_activity_date": 1423501985, "creation_date": 1423501985, "answer_id": 28415376, "question_id": 28414074, "link": "https://stackoverflow.com/questions/28414074/haskell-newtype-definition/28415376#28415376", "title": "Haskell newtype definition", "body": "<p>So for data/newtype definitions the left-hand-side holds a <em>type definition</em> including a name and some type variables, while the right hand side holds a <em>constructor list</em> usually also including names and types. An example is:</p>\n\n<pre><code>data List x = Nil | Cons x (List x)\n</code></pre>\n\n<p>Notice that <code>Nil</code> and <code>Cons</code> are your constructors, <code>x</code> and <code>List x</code> are types of arguments to the <code>Cons</code> constructor, while <code>List</code> is the name of the type (which has kind <code>* -&gt; *</code>; it requires a type argument ___ to \"fill it in\" before it can describe a list of ___s).</p>\n\n<p>Sometimes we want to alias a type. There are two ways to do that. First, <code>type</code>, which leaves the types commensurate -- so if you write <code>type DirectoryPath = [String]</code> then when you have a <code>DirectoryPath</code> you can manipulate it like a list of strings; in particular you might use <code>:</code> or <code>++</code> to append to it; so <code>\"apps\" : base_directory</code> would be perfectly legal Haskell.</p>\n\n<p>Sometimes, you just want to clobber these functions with a big warning sign, \"don't use this if you don't know what you're doing.\" For that, you might helpfully write <code>data FilePath = FilePath [String]</code>. Notice that we are abusing notation a little bit, naming the <em>type</em> the same as the <em>only constructor for that type</em>. Now to do the same thing you would have to write:</p>\n\n<pre><code>case base_directory of FilePath bd -&gt; FilePath $ \"apps\" : bd\n</code></pre>\n\n<p>Why might you do this? Well, first off, in the above syntax the directory structure is growing from right-to-left whereas most people write directories left-to-right. Second, you might want appending a <code>.</code> to be a no-op (i.e. <code>bd ++ []</code>) and <code>..</code> to be a parent-pointer (i.e. <code>tail bd</code>). You might also have some bizarre conventions (e.g. if the list begins with \"\" then it's an absolute directory, otherwise it's relative to the present directory) which need to be maintained. Finally, you might want to later shift the code to be <code>Maybe [String]</code> so that a <code>Nothing</code> value could represent paths which do crazy things, like <code>/../..</code> (absolute path two parents above the root).</p>\n\n<p>All of this becomes easier if you can just say:</p>\n\n<pre><code>FilePath xs ./ x\n    | x == \".\"  = FilePath xs\n    | x == \"..\" = FilePath (tail xs)\n    | otherwise = ...\n</code></pre>\n\n<p>and then enforce that everywhere else people write <code>base_directory ./ \"apps\"</code>. </p>\n\n<p>Another example is <code>newtype SanitizedString = Sanitized String</code>. Since we didn't use <code>type</code> we get a compile time label which traces through our code making sure that user-provided strings are properly escaped before, say, they head into the database insert statements or user interface or wherever.</p>\n\n<p>What you're probably using it for here is that you can write a <code>Monad</code> instance for that type and thereby use it with <code>do</code>-notation.</p>\n\n<p>IF your code only wraps one existing type, <code>newtype</code> avoids introducing additional laziness worries and data constructor delays and so forth. Otherwise it is just like <code>data</code>. So in your code:</p>\n\n<pre><code>newtype STR a = STR (Store -&gt; (Result a, Store))\n</code></pre>\n\n<p>this is not a <code>type</code> synonym but more like a <code>data</code> constructor which ultimately disappears after compilation. A <code>STR a</code> is an alias for a <code>Store -&gt; (Result a, Store)</code> which was wrapped in a <code>STR</code> constructor (so it can't be used as a function directly without a destructuring assignment).</p>\n"}], "owner": {"reputation": 2917, "user_id": 486167, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f043204ff888375a2657ec3bc149c53c?s=128&d=identicon&r=PG", "display_name": "Asad Iqbal", "link": "https://stackoverflow.com/users/486167/asad-iqbal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 28414368, "answer_count": 2, "score": 0, "last_activity_date": 1423504311, "creation_date": 1423498144, "last_edit_date": 1423504311, "question_id": 28414074, "link": "https://stackoverflow.com/questions/28414074/haskell-newtype-definition", "title": "Haskell newtype definition", "body": "<p>I read this statement in the code provided for a homework:-</p>\n\n<pre><code>newtype STR a = STR (Store -&gt; (Result a, Store))\n</code></pre>\n\n<p>The above link makes it seem like:</p>\n\n<pre><code>a === (Store -&gt; (Result a, Store))\n</code></pre>\n\n<p>How can this be a valid statement? Does it mean that <code>a</code> is a function which takes Store as argument and returns <code>('the same function wrapped in Result', Store)</code> ?</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "edited": false, "score": 0, "creation_date": 1423489943, "post_id": 28410232, "comment_id": 45156097, "body": "There does not seem to be a way. The answer to this question (<a href=\"http://stackoverflow.com/questions/10163604/how-to-reduce-duplication-in-the-build-depends-fields-of-a-cabal-file\" title=\"how to reduce duplication in the build depends fields of a cabal file\">stackoverflow.com/questions/10163604/&hellip;</a>) might help you move in the right direction, though."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "edited": false, "score": 0, "creation_date": 1423494255, "post_id": 28410232, "comment_id": 45158844, "body": "@madjar Actually, looking at the top answer to that question I rather like the style of separating the lib, executable(s), and tests into separate source trees.  It helps separate concerns and would enforce better modularity."}], "owner": {"reputation": 3333, "user_id": 3859566, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a7c4c1c9ad9bd41f49004d32884bc680?s=128&d=identicon&r=PG&f=1", "display_name": "yong", "link": "https://stackoverflow.com/users/3859566/yong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 1, "closed_date": 1423494083, "answer_count": 0, "score": 1, "last_activity_date": 1423486161, "creation_date": 1423486161, "question_id": 28410232, "link": "https://stackoverflow.com/questions/28410232/shared-cabal-build-depends-haskell", "closed_reason": "Duplicate", "title": "Shared cabal &quot;build-depends&quot; (Haskell)", "body": "<p>In my cabal project, I define a <code>library</code>, an <code>executable</code>, and a <code>test-suite</code>. They share many <code>build-depends</code> entries and it is tedious to keep them all in sync. How do I define a common set of dependencies which they can share?</p>\n"}, {"tags": ["haskell", "dictionary", "io", "functional-programming", "purely-functional"], "answers": [{"comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1423482155, "post_id": 28408384, "comment_id": 45151600, "body": "It should work  to write <code>\\((x, y), c) -&gt; drawMirror c (Position y)</code>"}, {"owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1423486479, "post_id": 28408384, "comment_id": 45154005, "body": "My mistake, I think I just forgot a comma. Thanks, I&#39;ll fix my answer."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1423502920, "post_id": 28408384, "comment_id": 45164590, "body": "You might also like <a href=\"http://hackage.haskell.org/package/keys-3.10.1/docs/Data-Key.html#v:mapWithKeyM_\" rel=\"nofollow noreferrer\">mapWithKeyM_</a>."}], "tags": [], "owner": {"reputation": 11293, "user_id": 981855, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/44e220c5150326866af030a7c9d944b3?s=128&d=identicon&r=PG", "display_name": "madjar", "link": "https://stackoverflow.com/users/981855/madjar"}, "is_accepted": true, "score": 5, "last_activity_date": 1423486545, "last_edit_date": 1423486545, "creation_date": 1423480327, "answer_id": 28408384, "question_id": 28407789, "link": "https://stackoverflow.com/questions/28407789/haskell-for-each-k-v-in-map-do-io-with-k-and-v/28408384#28408384", "title": "Haskell: for each (k,v) in Map, do IO() with k and v", "body": "<p>Your lambda, <code>\\(x,y) c -&gt; drawMirror c (Position x y)</code>, takes two arguments. However, it is called with a single argument of the form <code>(key, value)</code> (in your case <code>((x, y), c)</code>.</p>\n\n<pre><code>(\\((x,y), c) -&gt; drawMirror c (Position x y))\n</code></pre>\n\n<p>Moreover, <code>mapM_</code> (which I believe in your case is from <code>Data.Foldable</code>) only iterate over the keys, so you might want to call <a href=\"https://hackage.haskell.org/package/containers-0.5.6.3\" rel=\"noreferrer\"><code>SM.toList</code></a> to have a list of <code>(key, value)</code>.</p>\n\n<p>The final result is :</p>\n\n<pre><code>drawMirrors :: SM.Map (Int,Int) Char -&gt; IO()\ndrawMirrors mirrors = do\n    mapM_ (\\((x,y), c) -&gt; drawMirror c (Position x y)) $ SM.toList mirrors\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 0, "last_activity_date": 1423519110, "creation_date": 1423519110, "answer_id": 28420206, "question_id": 28407789, "link": "https://stackoverflow.com/questions/28407789/haskell-for-each-k-v-in-map-do-io-with-k-and-v/28420206#28420206", "title": "Haskell: for each (k,v) in Map, do IO() with k and v", "body": "<p>I've been playing around with this, and have found one way to use <code>mapM_</code> instead of <code>mapWithKeyM_</code>. Specifically,</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n{-# LANGUAGE FlexibleInstances #-}\n\ndata UnCurry :: (* -&gt; * -&gt; *) -&gt; * -&gt; * where\n  UnCurry :: f k v -&gt; UnCurry f (k, v)\n\ninstance Foldable (UnCurry Map) where\n  foldr c n (UnCurry m) = M.foldrWithKey go n m\n    where\n      go k a b = c (k, a) b\n</code></pre>\n\n<p>Now you can use <code>mapM_ f (UnCurry m)</code> to perform an action for each key-value pair in a <code>Map</code>.</p>\n"}], "owner": {"reputation": 1414, "user_id": 2156925, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ee041d4510b80b51b16002867ba30663?s=128&d=identicon&r=PG", "display_name": "Mickael Bergeron N&#233;ron", "link": "https://stackoverflow.com/users/2156925/mickael-bergeron-n%c3%a9ron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 28408384, "answer_count": 2, "score": 2, "last_activity_date": 1425211728, "creation_date": 1423478263, "last_edit_date": 1425211728, "question_id": 28407789, "link": "https://stackoverflow.com/questions/28407789/haskell-for-each-k-v-in-map-do-io-with-k-and-v", "title": "Haskell: for each (k,v) in Map, do IO() with k and v", "body": "<p>I have a <code>Map (Int,Int) Char</code>and I'm trying to draw each <code>Char</code>s in it at the position contained in the key. My functions are:</p>\n\n<pre><code>import qualified Data.Map.Strict as SM\ndata Position = Position !GLint !GLint\n\ndrawMirrors :: SM.Map (Int,Int) Char -&gt; IO()\ndrawMirrors mirrors = do\n    mapM_ (\\(x,y) c -&gt; drawMirror c (Position x y)) mirrors\n\ndrawMirror :: Char -&gt; Position -&gt; IO()\ndrawMirror orientation (Position x y) = do\n    -- Some irrelevant stuff\n</code></pre>\n\n<p>At the <code>drawMirrors mirrors = do mapM_ (\\(x,y) c -&gt; drawMirror c (Position x y)) mirrors</code> line, I'm getting the error:</p>\n\n<blockquote>\n<pre><code>src\\Main.hs:200:33:\n\nCouldn't match expected type `Char -&gt; IO ()'\n            with actual type `IO b0'\nThe lambda expression `\\ (x, y) c -&gt; drawMirror c (Position y)'\nhas two arguments,\nbut its type `(t0, GLint) -&gt; IO b0' has only one\nIn the first argument of `mapM_', namely\n  `(\\ (x, y) c -&gt; drawMirror c (Position y))'\nIn a stmt of a 'do' block:\n  mapM_ (\\ (x, y) c -&gt; drawMirror c (Position y)) mirrors\n</code></pre>\n</blockquote>\n\n<p>How can I, in <code>drawMirrors</code>, get all the keys and values in the dictionary and apply the <code>drawMirror</code> function with these keys and values?</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 1, "creation_date": 1423477714, "post_id": 28406951, "comment_id": 45149212, "body": "Have you looked at the actual implementation? <a href=\"http://haddocks.fpcomplete.com/fp/7.8/20140916-162/base/src/GHC-List.html#span\" rel=\"nofollow noreferrer\">haddocks.fpcomplete.com/fp/7.8/20140916-162/base/src/&hellip;</a>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1423477957, "post_id": 28406951, "comment_id": 45149347, "body": "Hm. Isn&#39;t your real question how to write <code>addToFirstInList :: a -&gt; [[a]] -&gt; [[a]]</code>? After all, your talking about &quot;lists of lists&quot;, whereas <code>span</code> returns a <i>pair</i> of lists."}, {"owner": {"reputation": 2007, "user_id": 348495, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d954017a8642b12a38b9deed7fc21d9?s=128&d=identicon&r=PG", "display_name": "joozek", "link": "https://stackoverflow.com/users/348495/joozek"}, "edited": false, "score": 2, "creation_date": 1423478015, "post_id": 28406951, "comment_id": 45149391, "body": "If your question is about adding an element to first list of lists then to be honest I think you should read up on lists (recommend Real World Haskell / Learn You A Haskell). If it&#39;s really about <code>span</code> then you should edit it to better indicate your intent"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423483238, "post_id": 28406951, "comment_id": 45152205, "body": "Can you write a function that adds 10 to the first element of a list of ints? Given <code>[5,6,7]</code> it would return <code>[15,6,7]</code>. Then, adding an element to the first list of a list of lists is done in the same way."}, {"owner": {"reputation": 23, "user_id": 3387560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b7f60f2b077503d9bb4858b9fe728ab?s=128&d=identicon&r=PG&f=1", "display_name": "Prince", "link": "https://stackoverflow.com/users/3387560/prince"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423503484, "post_id": 28406951, "comment_id": 45164929, "body": "@TomEllis thanks for the link to the actual implementation! It didn&#39;t come up in any of my searches!"}, {"owner": {"reputation": 23, "user_id": 3387560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b7f60f2b077503d9bb4858b9fe728ab?s=128&d=identicon&r=PG&f=1", "display_name": "Prince", "link": "https://stackoverflow.com/users/3387560/prince"}, "reply_to_user": {"reputation": 2007, "user_id": 348495, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4d954017a8642b12a38b9deed7fc21d9?s=128&d=identicon&r=PG", "display_name": "joozek", "link": "https://stackoverflow.com/users/348495/joozek"}, "edited": false, "score": 0, "creation_date": 1423503654, "post_id": 28406951, "comment_id": 45165013, "body": "@joozek the question was really more to do with list of lists of lists of tuples and how one could possibly return them in a function. Sorry that that wasn&#39;t clear. I&#39;ve been reading both those books but so far (I haven&#39;t finished them) haven&#39;t come across something explaining my misunderstanding. What&#39;s worse is that I feel there are excercises where it would help to know this"}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423519083, "post_id": 28406951, "comment_id": 45173506, "body": "@user3387560: Here&#39;s how I found it: <a href=\"https://www.fpcomplete.com/hoogle?q=span\" rel=\"nofollow noreferrer\">fpcomplete.com/hoogle?q=span</a>"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 3387560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b7f60f2b077503d9bb4858b9fe728ab?s=128&d=identicon&r=PG&f=1", "display_name": "Prince", "link": "https://stackoverflow.com/users/3387560/prince"}, "edited": false, "score": 0, "creation_date": 1423503448, "post_id": 28409330, "comment_id": 45164911, "body": "Oh I see! I think I get it now! I normally wouldn&#39;t ask a question as simple as this on StackOverflow but I couldn&#39;t find any help online... I think it will also become clearer as I go further into the book &quot;Real World Haskell&quot;. Thank you!"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 1, "last_activity_date": 1423483394, "creation_date": 1423483394, "answer_id": 28409330, "question_id": 28406951, "link": "https://stackoverflow.com/questions/28406951/haskells-span-function/28409330#28409330", "title": "Haskell&#39;s span function", "body": "<p>So I <em>think</em> what you're saying is that you know how to recursively append to a list by doing something like</p>\n\n<pre><code>foobar :: [x] -&gt; [y]\nfoobar (  []) = []\nfoobar (x:xs) = {- ...stuff... -} : foobar xs\n</code></pre>\n\n<p>but you have no idea how to do that with <em>two</em> lists:</p>\n\n<pre><code>foobar :: [x] -&gt; ([y], [z])\nfoobar (x:xs) = ???\n</code></pre>\n\n<p>In general, when the result isn't a list, but something that contains a list, you end up doing something like this:</p>\n\n<pre><code>foobar :: [x] -&gt; ([y], [z])\nfoobar (x:xs) =\n  let\n    y = {- whatever -}\n    z = {- whatever -}\n    (ys, zs) = foobar xs   -- The recursive call\n  in  (y:ys, z:zs)\n</code></pre>\n\n<p>The same applies if, say, the result is a monadic action</p>\n\n<pre><code>foobar :: [x] -&gt; IO [y]\nfoobar (x:xs) = do\n  y  &lt;- {- whatever -}\n  ys &lt;- foobar xs\n  return (y:ys)\n</code></pre>\n\n<p>Note that this forces the function to not be lazy.</p>\n"}, {"tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 0, "last_activity_date": 1423528486, "last_edit_date": 1423528486, "creation_date": 1423527464, "answer_id": 28421964, "question_id": 28406951, "link": "https://stackoverflow.com/questions/28406951/haskells-span-function/28421964#28421964", "title": "Haskell&#39;s span function", "body": "<p>The general pattern I think you'll want to use here is the following:</p>\n\n<pre><code>span :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])\nspan pred [] = ([], [])\nspan pred (x:xs) = if pred x then _ else _  -- fill in the blanks\n    where (prefix', suffix') = span pred xs\n</code></pre>\n\n<p>There are two non-obvious things there.  First, note the pattern match in the <code>where</code> condition.  This means that we're:</p>\n\n<ol>\n<li>Calling <code>span pred xs</code>, which produces a pair of lists;</li>\n<li>Pattern matching on this pair;</li>\n<li>Naming the first and second element of the pair <code>prefix'</code> and <code>suffix'</code> respectively.</li>\n</ol>\n\n<p>I suspect that step #2, the pattern match on the result of the recursive call, is something you might not have understood.</p>\n\n<p>The second non-obvious thing is <em>recursion</em>.  It's a tricky thing because, counterintutively, to solve a problem with recursion you need to assume that you've already solved it, but for the \"wrong\" argument--a tough step to picture yourself taking if you haven't solved it yet!  But the trick is this:</p>\n\n<ul>\n<li>Imagine you've actually already solved the problem, but for the <strong>tail</strong> of the list.  That's what the <code>prefix'</code> and <code>suffix'</code> variables contain: a correct solution but for the wrong list--the tail of the one you're actually trying to solve for.</li>\n<li>Given that (non)solution, how could you reuse it to arrive at a correct solution for <em>your</em> problem?</li>\n</ul>\n"}], "owner": {"reputation": 23, "user_id": 3387560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b7f60f2b077503d9bb4858b9fe728ab?s=128&d=identicon&r=PG&f=1", "display_name": "Prince", "link": "https://stackoverflow.com/users/3387560/prince"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2522, "favorite_count": 0, "accepted_answer_id": 28409330, "answer_count": 2, "score": 1, "last_activity_date": 1439510529, "creation_date": 1423475629, "last_edit_date": 1439510529, "question_id": 28406951, "link": "https://stackoverflow.com/questions/28406951/haskells-span-function", "title": "Haskell&#39;s span function", "body": "<p>I'm relatively new to Haskell and I'm struggling to figure out a way to implement Haskell's <code>span</code> function. However, my problem is more general than that in that I don't know how to make a function return a list of lists or list of tuples containing the elements I want. My problem with a list of lists such as: </p>\n\n<pre><code>[[1],[2]]\n</code></pre>\n\n<p>is that I can't make the function add an element to the first list in the list of lists. I only know how to append another list to the list of lists.</p>\n\n<p>In short, if you explain to me how to implement the <code>span</code> function, this all should hopefully come clear to me. </p>\n"}, {"tags": ["haskell", "functional-programming", "complexity-theory", "algebraic-data-types"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 5, "creation_date": 1423474436, "post_id": 28406512, "comment_id": 45147316, "body": "Because you need to make a copy of the left-hand argument (because lists are immutable in Haskell)."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1423474681, "post_id": 28406512, "comment_id": 45147449, "body": "@OliverCharlesworth no, lists are linked."}, {"owner": {"reputation": 3055, "user_id": 728023, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/u0I91.jpg?s=128&g=1", "display_name": "Radu Stoenescu", "link": "https://stackoverflow.com/users/728023/radu-stoenescu"}, "edited": false, "score": 0, "creation_date": 1423474730, "post_id": 28406512, "comment_id": 45147471, "body": "Based on this argument, inserting an element at the beginning of the list would also take O(n), since this would also imply duplicating the list."}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "reply_to_user": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1423474738, "post_id": 28406512, "comment_id": 45147476, "body": "@josejuan: Indeed, but that doesn&#39;t avoid the need to copy.  If I do <code>a + b</code> (sorry, I forget Haskell syntax), then I can&#39;t modify <code>a</code>, so I can&#39;t link it to <code>b</code>.  Instead, I need to create a copy of <code>a</code>, and link <i>that</i> to <code>b</code>."}, {"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1423474773, "post_id": 28406512, "comment_id": 45147495, "body": "@RaduStoenescu: Consider the graph that gets created; you only need to copy the left-hand argument."}, {"owner": {"reputation": 3055, "user_id": 728023, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/u0I91.jpg?s=128&g=1", "display_name": "Radu Stoenescu", "link": "https://stackoverflow.com/users/728023/radu-stoenescu"}, "edited": false, "score": 0, "creation_date": 1423475072, "post_id": 28406512, "comment_id": 45147681, "body": "Yes, I understand that lists in Haskell, as well as in other functional languages, are not only immutable, but also persistent data structures. I would like some guidance towards a more &#39;formal&#39; argument."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1423494463, "post_id": 28406748, "comment_id": 45158983, "body": "Whether we have to &quot;create a copy of <code>xs</code>&quot; or not is an operational detail. The algorithm is O(n) because we must traverse all <code>n</code> elements of the left-hand list."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1423593352, "post_id": 28406748, "comment_id": 45208060, "body": "@jberryman, that becomes less of an operational detail if you represent a list using something like <code>data List a = List {theListItself::[a], theLastCons::[a]}</code>."}], "tags": [], "owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "is_accepted": false, "score": 0, "last_activity_date": 1423475467, "last_edit_date": 1423475467, "creation_date": 1423475102, "answer_id": 28406748, "question_id": 28406512, "link": "https://stackoverflow.com/questions/28406512/why-does-concatenation-of-lists-take-on/28406748#28406748", "title": "Why does concatenation of lists take O(n)?", "body": "<p>In order to concatenate two lists (call them <code>xs</code> and <code>ys</code>), we need to modify the final node in <code>xs</code> in order to link it to (i.e. point at) the first node of <code>ys</code>.</p>\n\n<p>But Haskell lists are immutable, so we have to create a copy of <code>xs</code> first.  This operation is <code>O(n)</code> (where <code>n</code> is the length of <code>xs</code>).</p>\n\n<p>Example:</p>\n\n<pre><code>xs\n|\nv\n1 -&gt; 2 -&gt; 3\n\n1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5 -&gt; 6 -&gt; 7\n^              ^\n|              |\nxs ++ ys       ys\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 3, "creation_date": 1423480981, "post_id": 28406942, "comment_id": 45150987, "body": "Although it only needs to copy the <i>list cells themselves</i>. The items stored in the list are typically pointers to other data structures, which can be perfectly well shared between the original and new list."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1423602621, "post_id": 28406942, "comment_id": 45213264, "body": "What I&#39;d really like to see, personally, is a clear explanation of why lazy-spined lists are incompatible with <code>o(n)</code> append."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 6, "last_activity_date": 1423593161, "last_edit_date": 1423593161, "creation_date": 1423475611, "answer_id": 28406942, "question_id": 28406512, "link": "https://stackoverflow.com/questions/28406512/why-does-concatenation-of-lists-take-on/28406942#28406942", "title": "Why does concatenation of lists take O(n)?", "body": "<p>Operationally, an Haskell list is typically represented by a pointer to the first cell of a single-linked list (roughly). In this way, <code>tail</code> just returns the pointer to the next cell (it does not have to copy anything), and consing <code>x :</code> in front of the list allocates a new cell, makes it point to the old list, and returns the new pointer. The list accessed by the old pointer is unchanged, so there's no need to copy it.</p>\n\n<p>If you instead append a value with <code>++ [x]</code>, then you can not modify the original liked list by changing its last pointer unless you know that the original list will never be accessed. More concretely, consider</p>\n\n<pre><code>x = [1..5]\nn = length (x ++ [6]) + length x\n</code></pre>\n\n<p>If you modify <code>x</code> when doing <code>x++[6]</code>, the value of <code>n</code> would turn up to be 12, which is wrong. The last <code>x</code> refer to the unchanged list which has length <code>5</code>, so the result of <code>n</code> must be 11.</p>\n\n<p>Practically, you can't expect the compiler to optimize this, even in those cases in which <code>x</code> is no longer used and it could, theoretically, be updated in place (a \"linear\" use). What happens is that the evaluation of <code>x++[6]</code> must be ready for the worst-case in which <code>x</code> is reused afterwards, and so it must copy the whole list <code>x</code>.</p>\n\n<p>As @Ben notes, saying \"the list is copied\" is imprecise. What actually happens is that the cells with the pointers are copied (the so-called \"spine\" on the list), but the elements are not. For instance,</p>\n\n<pre><code>x = [[1,2],[2,3]]\ny = x ++ [[3,4]]\n</code></pre>\n\n<p>requires only to allocate <code>[1,2],[2,3],[3,4]</code> <em>once</em>. The lists of lists <code>x,y</code> will share pointers to the lists of integers, which do not have to be duplicated.</p>\n"}, {"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1432868607, "post_id": 28408652, "comment_id": 49115315, "body": "A lot of algorithms that typically require a queue can still be implemented in a straightforward way in Haskell thanks to tying the knot."}], "tags": [], "owner": {"reputation": 1435, "user_id": 3792504, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e1e342dc9ed03c2039e7cde0dab4214e?s=128&d=identicon&r=PG&f=1", "display_name": "TheCriticalImperitive", "link": "https://stackoverflow.com/users/3792504/thecriticalimperitive"}, "is_accepted": true, "score": 3, "last_activity_date": 1423481591, "last_edit_date": 1423481591, "creation_date": 1423481223, "answer_id": 28408652, "question_id": 28406512, "link": "https://stackoverflow.com/questions/28406512/why-does-concatenation-of-lists-take-on/28408652#28408652", "title": "Why does concatenation of lists take O(n)?", "body": "<p>It's because of immutable state. A list is an object + a pointer, so if we imagined a list as a Tuple it might look like this:</p>\n\n<pre><code>let tupleList = (\"a\", (\"b\", (\"c\", [])))\n</code></pre>\n\n<p>Now let's get the first item in this \"list\" with a \"head\" function. This head function takes O(1) time because we can use fst:</p>\n\n<pre><code>&gt; fst tupleList\n</code></pre>\n\n<p>If we want to swap out the first item in the list with a different one we could do this:</p>\n\n<pre><code>let tupleList2 = (\"x\",snd tupleList)\n</code></pre>\n\n<p>Which can also be done in O(1). Why? Because absolutely no other element in the list stores a reference to the first entry. Because of immutable state, we now have two lists, <code>tupleList</code> and <code>tupleList2</code>. When we made <code>tupleList2</code> we didn't copy the <strong>whole</strong> list. Because the original pointers are immutable we can continue to reference them but use something else at the start of our list.</p>\n\n<p>Now let's try to get the last element of our 3 item list:</p>\n\n<pre><code>&gt; snd . snd $ fst tupleList\n</code></pre>\n\n<p>That happened in O(3), which is equal to the length of our list i.e. O(n).</p>\n\n<p>But couldn't we store a pointer to the last element in the list and access that in O(1)? To do that we would need an array, not a list. An array allows O(1) lookup time of any element as it is a primitive data structure implemented on a register level.</p>\n\n<p>(ASIDE: If you're unsure of why we would use a Linked List instead of an Array then you should do some more reading about data structures, algorithms on data structures and Big-O time complexity of various operations like get, poll, insert, delete, sort, etc).</p>\n\n<p>Now that we've established that, let's look at concatenation. Let's concat <code>tupleList</code> with a new list, <code>(\"e\", (\"f\", []))</code>. To do this we have to traverse the whole list just like getting the last element:</p>\n\n<pre><code>tupleList3 = (fst tupleList, (snd $ fst tupleList, (snd . snd $ fst tupleList, (\"e\", (\"f\", [])))\n</code></pre>\n\n<p>The above operation is actually <strong>worse</strong> than O(n) time, because for each element in the list we have to re-read the list up to that index. But if we ignore that for a moment and focus on the key aspect: in order to get to the last element in the list, we must traverse the entire structure.</p>\n\n<p>You may be asking, why don't we just store in memory what the last list item is? That way appending to the end of the list would be done in O(1). But not so fast, we can't change the last list item without changing the entire list. Why?</p>\n\n<p>Let's take a stab at how that might look:</p>\n\n<pre><code>data Queue a = Queue { last :: Queue a, head :: a, next :: Queue a} | Empty\nappendEnd :: a -&gt; Queue a -&gt; Queue a\nappendEnd a2 (Queue l, h, n) = ????\n</code></pre>\n\n<p>IF I modify \"last\", which is an immutable variable, I won't actually be modifying the pointer for the last item in the queue. I will be creating a copy of the last item. Everything else that referenced that original item, will continue referencing the original item.</p>\n\n<p>So in order to update the last item in the queue, I have to update everything that has a reference to it. Which can only be done in optimally O(n) time.</p>\n\n<p>So in our traditional list, we have our final item:</p>\n\n<pre><code>List a []\n</code></pre>\n\n<p>But if we want to change it, we make a copy of it. Now the second last item has a reference to an old version. So we need to update that item.</p>\n\n<pre><code>List a (List a [])\n</code></pre>\n\n<p>But if we update the second last item we make a copy of it. Now the third last item has an old reference. So we need to update that. Repeat until we get to the head of the list. And we come full circle. Nothing keeps a reference to the head of the list so editing that takes O(1).</p>\n\n<p>This is the reason that Haskell doesn't have Doubly Linked Lists. It's also why a \"Queue\" (or at least a FIFO queue) can't be implemented in a traditional way. Making a Queue in Haskell involves some serious re-thinking of traditional data structures.</p>\n\n<p>If you become even more curious about how all of this works, consider getting the book <a href=\"https://rads.stackoverflow.com/amzn/click/com/0521663504\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">Purely Funtional Data Structures</a>. </p>\n\n<p>EDIT: If you've ever seen this: <a href=\"http://visualgo.net/list.html\" rel=\"nofollow noreferrer\">http://visualgo.net/list.html</a> you might notice that in the visualization \"Insert Tail\" happens in O(1). But in order to do that we need to modify the final entry in the list to give it a new pointer. Updating a pointer mutates state which is not allowed in a purely functional language. Hopefully that was made clear with the rest of my post.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423522787, "post_id": 28410165, "comment_id": 45175334, "body": "Yasuhiko Minamide&#39;s data structures with holes seem somewhat similar in spirit to Huet&#39;s <a href=\"https://www.st.cs.uni-saarland.de/edu/seminare/2005/advanced-fp/docs/huet-zipper.pdf\" rel=\"nofollow noreferrer\">zippers</a> (JFP 97), but the zippers are purely functional, while the structures with holes seem more useful for doing, in a call-by-value language, things that are very natural in a call-by-need language."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423523518, "post_id": 28410165, "comment_id": 45175623, "body": "Difference lists are functions <code>[a] -&gt; [a]</code> built up by composing values of <code>\\x -&gt; (x:)</code>. Such functions can be represented as simple unbalanced leaf trees, as shown in <a href=\"http://cstheory.stackexchange.com/a/2442\">an old post</a> on cstheory.SE."}, {"owner": {"reputation": 41, "user_id": 4546294, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/aca2ec121ec399a6f1cfd19997c970a5?s=128&d=identicon&r=PG", "display_name": "Rob Simmons", "link": "https://stackoverflow.com/users/4546294/rob-simmons"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423860787, "post_id": 28410165, "comment_id": 45336115, "body": "They are, in fact, similar, but Yasuhiko Minamide&#39;s structures have different asymptotic complexity, as that CSTheory post (which was an answer to a question I asked :)) describes."}], "tags": [], "owner": {"reputation": 41, "user_id": 4546294, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/aca2ec121ec399a6f1cfd19997c970a5?s=128&d=identicon&r=PG", "display_name": "Rob Simmons", "link": "https://stackoverflow.com/users/4546294/rob-simmons"}, "is_accepted": false, "score": 4, "last_activity_date": 1423485952, "last_edit_date": 1492086747, "creation_date": 1423485952, "answer_id": 28410165, "question_id": 28406512, "link": "https://stackoverflow.com/questions/28406512/why-does-concatenation-of-lists-take-on/28410165#28410165", "title": "Why does concatenation of lists take O(n)?", "body": "<p>What you're asking for is related to a question I wrote for TCS Stackexchange some time back: the data structure that supports constant-time concatenation of functional lists is a <a href=\"https://cstheory.stackexchange.com/questions/2432/difference-lists-in-functional-programming\">difference list</a>.</p>\n\n<p>A way of handling such lists in a functional programming language was worked out by <a href=\"http://www.score.cs.tsukuba.ac.jp/~minamide/papers/hole.popl98.pdf\" rel=\"nofollow noreferrer\">Yasuhiko Minamide in the 90s</a>; I effectively <a href=\"http://requestforlogic.blogspot.com/search/label/holey%20data\" rel=\"nofollow noreferrer\">rediscovered it</a> a while back. However, the good run-time guarantees require language-level support that's not available in Haskell.</p>\n"}], "owner": {"reputation": 3055, "user_id": 728023, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/u0I91.jpg?s=128&g=1", "display_name": "Radu Stoenescu", "link": "https://stackoverflow.com/users/728023/radu-stoenescu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 889, "favorite_count": 3, "accepted_answer_id": 28408652, "answer_count": 4, "score": 6, "last_activity_date": 1423593161, "creation_date": 1423474330, "question_id": 28406512, "link": "https://stackoverflow.com/questions/28406512/why-does-concatenation-of-lists-take-on", "title": "Why does concatenation of lists take O(n)?", "body": "<p>According to the theory of ADTs (Algebraic Data Types) the concatenation of two lists has to take <code>O(n)</code> where <code>n</code> is the length of the first list. You, basically, have to recursively iterate through the first list until you find the end.</p>\n\n<p>From a different point of view, one can argue that the second list can simply be linked to the last element of the first. This would take constant time, if the end of the first list is known.</p>\n\n<p>What am I missing here ? </p>\n"}, {"tags": ["haskell", "indentation"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1423473015, "post_id": 28406127, "comment_id": 45146594, "body": "If this is in a source file at the top level, get rid of the <code>let</code>. That&#39;s only for ghci and local bindings."}, {"owner": {"reputation": 865, "user_id": 664470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53821b46f4e74cdc9a01ef4263af98aa?s=128&d=identicon&r=PG", "display_name": "J&#233;r&#244;me Mahuet", "link": "https://stackoverflow.com/users/664470/j%c3%a9r%c3%b4me-mahuet"}, "edited": false, "score": 3, "creation_date": 1423473164, "post_id": 28406127, "comment_id": 45146677, "body": "This is working great here. (In GHCI be sure to set multi-line) <code>:set +m</code>"}, {"owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1423473849, "post_id": 28406127, "comment_id": 45147007, "body": "Thanks. I am new to Haskell and working in a source file. I have get rid of the <code>let</code> as suggested by @luqui. The error is somehow misleading. LOL"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1423506229, "post_id": 28406127, "comment_id": 45166402, "body": "@Gavin, yeah that one misleads people often.  That&#39;s just the message for syntax error, reminding you that indentation is part of the syntax in Haskell.  <code>foo) =# 4tr` $ $</code> would give the same error"}, {"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1423815472, "post_id": 28406127, "comment_id": 45310173, "body": "I usually use the indentation style on lines 42-45 of <a href=\"https://github.com/quickdudley/varroa/blob/33b7c51992b590dc4e11a53164a4a0eb1d31f5fb/study.hs\" rel=\"nofollow noreferrer\">github.com/quickdudley/varroa/blob/&hellip;</a> for multi-line lists."}], "owner": {"reputation": 3618, "user_id": 2621216, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/51uHg.jpg?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/2621216/gavin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 239, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1423472932, "creation_date": 1423472932, "question_id": 28406127, "link": "https://stackoverflow.com/questions/28406127/indentation-of-hard-coded-long-list", "title": "Indentation of hard coded long list", "body": "<h1>Background</h1>\n\n<p>I have a long hard coded list. I wish to have it spanned across several lines.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let partition = [1,1,2,3,5,7,11,15,22,30,42,56,77,101,135,176,231,\n                 297,385,490,627,792,1002,1255,1575,1958,2436,3010,\n                 3718,4565,5604,6842,8349,10143,12310,14883,17977,\n                 21637,26015,31185,37338,44583,53174,63261,75175,\n                 89134,105558,124754,147273,173525]\n</code></pre>\n\n<h1>Problem</h1>\n\n<p>No matter what indentation I try, the error persisted.</p>\n\n<p><code>parse error (possibly incorrect indentation or mismatched brackets)</code></p>\n"}, {"tags": ["haskell", "delay", "arrows"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423465826, "post_id": 28402932, "comment_id": 45143423, "body": "To understand either of those you really need to understand <code>ArrowChoice</code> and specifically the <code>ArrowChoice SF</code> instance, which you didn&#39;t include in the code. <code>mapA</code> is defined only for arrows that have an <code>ArrowChoice</code> instance, <code>mapA :: ArrowChoice a =&gt; a b c -&gt; a [b] [c]</code>. The <code>|||</code> in <code>diag</code> is the <code>ArrowChoice</code> analog of <code>&amp;&amp;&amp;</code> for <code>Arrow</code>s."}, {"owner": {"reputation": 305, "user_id": 2960803, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/7bf8a3853a1f669bedf0ef45c78f58aa?s=128&d=identicon&r=PG&f=1", "display_name": "Song Zhang", "link": "https://stackoverflow.com/users/2960803/song-zhang"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423528500, "post_id": 28402932, "comment_id": 45177265, "body": "Sorry for neglecting ArrowChoice, I have added it. It is helpful to your comment. Thanks~"}], "answers": [{"comments": [{"owner": {"reputation": 305, "user_id": 2960803, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/7bf8a3853a1f669bedf0ef45c78f58aa?s=128&d=identicon&r=PG&f=1", "display_name": "Song Zhang", "link": "https://stackoverflow.com/users/2960803/song-zhang"}, "edited": false, "score": 0, "creation_date": 1423529805, "post_id": 28418229, "comment_id": 45177662, "body": "Your answer is very helpful. I will look into the definitions of type classes again!  Many thanks"}], "tags": [], "owner": {"reputation": 8676, "user_id": 1113881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sBc0F.jpg?s=128&g=1", "display_name": "CR Drost", "link": "https://stackoverflow.com/users/1113881/cr-drost"}, "is_accepted": false, "score": 5, "last_activity_date": 1423511964, "creation_date": 1423511964, "answer_id": 28418229, "question_id": 28402932, "link": "https://stackoverflow.com/questions/28402932/haskell-arrow-delay-function/28418229#28418229", "title": "Haskell Arrow delay function", "body": "<p>One way to think about arrows is as some sort of factory diagram. You would be right if your <code>SF</code> were just <code>(-&gt;)</code>. Go ahead and try it; you should get:</p>\n\n<pre><code>Prelude Control.Arrow&gt; mapA (0 :) [[1,2,3],[4,5],[6],[7,8],[9,10,11],[12,13,14,15]]\n[[0,1,2,3],[0,4,5],[0,6],[0,7,8],[0,9,10,11],[0,12,13,14,15]]\n</code></pre>\n\n<p>However, machines at the factory can do things more complicated than simply sending on their transformed input, the way <code>-&gt;</code> works. Your <code>SF</code> machines \"take in\" an <code>a</code> and \"put out\" a <code>b</code>, but they're backed by a function <code>[a] -&gt; [b]</code> which lets you feed them a stream of <code>a</code>s and then they can do something more sophisticated than <code>-&gt;</code> does. </p>\n\n<p>So the <code>delay 0</code> machine takes a stream of numbers and prepends 0 to it, easy peasy, \"lagging\" the original stream by one \"time step\" if you want to think of it that way. </p>\n\n<p>Similarly the <code>a1 &amp;&amp;&amp; a2</code> machine will have to feed its input stream to both of the sub-machines, and when they both have values, it can \"zip\" those together. It uses its sub-machines <code>[b] -&gt; [c]</code> and <code>[b] -&gt; [d]</code> to produces <code>[b] -&gt; [(c, d)]</code>, after all.</p>\n\n<p>The <code>a1 ||| a2</code> machine is trickier: it takes similar sub-machines <code>[b] -&gt; [d]</code> and <code>[c] -&gt; [d]</code> and uses them to form <code>[Either b c] -&gt; [d]</code>. If that looked completely self-explanatory, look again! We didn't have <code>Either [b] [c]</code>, which would have been totally straightforward (and which is what <code>-&gt;</code> deals with above), but rather <code>[Either b c]</code>. The obvious solution for what to do here is:</p>\n\n<ol>\n<li>Grab the left-sub-list, provide it to the left machine</li>\n<li>Grab the right-sub-list, provide it to the right machine</li>\n<li>Return the resulting <code>[d]</code>s in some complicated interleaved order.</li>\n</ol>\n\n<p>What order? The easiest way is to go back through the original list and, whenever you see a Left, yield a <code>d</code> from the left machine's list; whenever you see a Right, yield a <code>d</code> from the right list.</p>\n\n<p>With all of this background, we come to <code>mapA</code>:</p>\n\n<pre><code>mapA f = arr listcase &gt;&gt;&gt; arr (const []) ||| (f *** mapA f &gt;&gt;&gt; arr (uncurry (:)))\n</code></pre>\n\n<p>For <code>SF</code>, the <code>listcase</code> will take the incoming stream of lists and produce a stream of <code>Either () (x, [x])</code>, depending on whether that stream is empty. In the first pass through the list, none of the entries in your <code>runSF</code> are empty, so each list is a <code>Right</code> branch emitting one right value. </p>\n\n<p>So we have<code>[Right (1, [2,3]),  Right (4, [5]), Right (6, []), ...]</code> which gets flattened and split into two lists: <code>[1, 4, 6, ...]</code> and <code>[[2,3], [5], [], ...]</code>.</p>\n\n<p>That first list gets fed into the delay function, so it gets prepended with <code>0</code>. The second list gets fed recursively into <code>mapA f</code>, so then the [2, 5] prefixes also get delayed; and so on.</p>\n\n<p>At the end when you join them together you find that each level of nesting in the lists has gotten delayed, so that the first emitted list is [0, 0, 0] and the second is [1, 2]. </p>\n"}], "owner": {"reputation": 305, "user_id": 2960803, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/7bf8a3853a1f669bedf0ef45c78f58aa?s=128&d=identicon&r=PG&f=1", "display_name": "Song Zhang", "link": "https://stackoverflow.com/users/2960803/song-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 3, "answer_count": 1, "score": 7, "last_activity_date": 1423554626, "creation_date": 1423456999, "last_edit_date": 1423554626, "question_id": 28402932, "link": "https://stackoverflow.com/questions/28402932/haskell-arrow-delay-function", "title": "Haskell Arrow delay function", "body": "<p>I am reading John Hughes's <em>Programing with Arrows</em>. There is a piece of code that I really cannot understand. The code is following:</p>\n\n<pre><code>import Control.Arrow.Operations \nimport Control.Arrow\nimport Control.Category\nimport Prelude hiding ((.),id)\n\nnewtype SF a b = SF {runSF :: [a] -&gt; [b]}\n\ninstance Category SF where\n         id = SF id\n         (.) (SF f) (SF g) = SF $ \\x -&gt; f (g x)\n\n(.*.) :: (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a,c) -&gt; (b,d)\n(.*.) f g (a,c) = (f a, g c)\n\n\ninstance Arrow SF where\n         arr f = SF (map f)\n         first (SF f) = SF  (uncurry zip . (f .*. id) . unzip)\n\ninstance ArrowLoop SF where\n         loop (SF f) = SF $ \\as -&gt; let (bs,cs) = unzip (f (zip as (stream cs))) in bs\n                                       where stream ~(x:xs) = x:stream xs\ninstance ArrowChoice SF where\n     left (SF f) = SF (\\xs -&gt; combine xs (f [y | Left y &lt;- xs]))\n          where combine (Left y: xs) (z:zs) = Left z : combine xs zs\n                combine (Right y :xs) zs = Right y : combine xs zs\n                combine [] zs = [] \n\ninstance ArrowCircuit SF where\n         delay x = SF (x:)\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>mapA :: ArrowChoice arr =&gt; arr a b -&gt; arr [a] [b]\n\nlistcase []     = Left ()\nlistcase (x:xs) = Right (x,xs)\n\nmapA f = arr listcase &gt;&gt;&gt;\n         arr (const []) ||| (f *** mapA f &gt;&gt;&gt; arr (uncurry (:)))\n</code></pre>\n\n<p>What I cannot understand is that </p>\n\n<pre><code>&gt; runSF (mapA (delay 0)) [[1,2,3],[4,5],[6],[7,8],[9,10,11],[12,13,14,15]]\n[[0,0,0],[1,2],[4],[6,5],[7,8,3],[9,10,11,0]]\n</code></pre>\n\n<p>I thought that the result should be just adding a <code>0</code> at the head of each list since <code>delay 0</code> is defined as <code>SF (0:)</code>.</p>\n\n<p>And even more strange, </p>\n\n<pre><code>diag :: (ArrowCircuit a , ArrowChoice a) =&gt; a [b] [b]\ndiag = arr listcase &gt;&gt;&gt; \n       arr (const []) ||| (arr id *** (diag &gt;&gt;&gt; delay []) &gt;&gt;&gt; arr (uncurry (:)))\n\nrunSF diag [[1,2,3],[4,5,6],[7,8,9],[10,11,12]]\n[[1],[4,2],[7,5,3],[10,8,6]]\n</code></pre>\n\n<p>I can see what are <code>diag</code> and <code>mapA (delay 0)</code> doing, but I cannot quite understand the computation process with using <code>delay</code>. Can someone just help? Thanks.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1423467910, "post_id": 28402913, "comment_id": 45144241, "body": "cf. <a href=\"https://en.wikipedia.org/wiki/Curry_%28programming_language%29#Functional_Patterns\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a>."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1423457751, "creation_date": 1423457751, "answer_id": 28403038, "question_id": 28402913, "link": "https://stackoverflow.com/questions/28402913/haskell-why-cant-i-pattern-match-against-function/28403038#28403038", "title": "Haskell: Why can&#39;t I pattern match against function?", "body": "<p>One of the key concepts in functional programming, and especially pure functional programming, is equational reasoning. The <code>=</code> in Haskell is actual equality (leaving aside order of pattern matching and such). So when we write</p>\n\n<pre><code>f 3 = 12\n</code></pre>\n\n<p>that means <code>f 3</code> and <code>12</code> are actually the same thing\u2014completely indistinguishable. Since <code>extract 12</code> doesn't make any sense, neither does <code>extract (f 3)</code>.</p>\n\n<p>To come at it from another direction, at run-time, there is no way to tell that a certain value was formed by applying a certain function to a certain other value. Making such information available would generally be very expensive, and would not often be useful.</p>\n"}, {"tags": [], "owner": {"reputation": 3632, "user_id": 856079, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/79f1d8ae198abbfd00068fd36cde5eda?s=128&d=identicon&r=PG", "display_name": "rafalio", "link": "https://stackoverflow.com/users/856079/rafalio"}, "is_accepted": false, "score": 1, "last_activity_date": 1423459429, "creation_date": 1423459429, "answer_id": 28403311, "question_id": 28402913, "link": "https://stackoverflow.com/questions/28402913/haskell-why-cant-i-pattern-match-against-function/28403311#28403311", "title": "Haskell: Why can&#39;t I pattern match against function?", "body": "<p>You definitely can pattern match against the structure of your data with a data constructor, like your example, <code>Just</code>. What you need is to wrap it in parentheses, <code>(Just 4)</code>, otherwise your <code>extract</code> function looks like it would be taking a data constructor, and not a constructed value.</p>\n\n<p>In your case, you would want:</p>\n\n<pre><code>extract (Just x) = x\n</code></pre>\n\n<p>That's, in fact, part of the <code>fromJust</code> function.</p>\n\n<p>The other answer explains why you can't match against function application. To that, I'll add that it would be kind of like a magic way to get an inverse function. If there was an <code>extract (f x) = x</code>, it would be like magically having a <code>g</code> such that <code>g . f = id</code>. In your case, you defined a function <code>succ</code> which I presume would be</p>\n\n<p><code>succ x = x+1</code></p>\n\n<p>Now, if <code>extract (succ x) = x</code> was possible, because of equational reasoning, <code>extract</code> would of type <code>Integer -&gt; Integer</code> and you would magically have constructed the inverse of <code>succ</code>, <code>x-1</code>.</p>\n\n<p>What is possible though, like I showed above, is matching against the structure of data.</p>\n\n<p>You can define, instead of a function <code>succ</code> working on <code>Integer</code>s, a new datatype:</p>\n\n<pre><code>data Nat = Zero | Succ Nat\n</code></pre>\n\n<p>And then easily have an extract function:</p>\n\n<pre><code>extra Zero = Zero\nextract (Succ x) = x\n</code></pre>\n\n<p>Just remember that you <em>can</em>, and are in fact encouraged to, to pattern match against things like <code>(Just x)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1423474706, "creation_date": 1423474706, "answer_id": 28406636, "question_id": 28402913, "link": "https://stackoverflow.com/questions/28402913/haskell-why-cant-i-pattern-match-against-function/28406636#28406636", "title": "Haskell: Why can&#39;t I pattern match against function?", "body": "<p>The \"extracting the argument from a function\" would require to invert said function, which is possible only if the function is <em>injective</em>. More to the point, assume</p>\n\n<pre><code>square x = x*x\n</code></pre>\n\n<p>and</p>\n\n<pre><code>root (square x) = x   -- assume it works, somehow\n</code></pre>\n\n<p>We should have</p>\n\n<pre><code>root (square 2)    = 2\nroot (square (-2)) = -2\nroot 4             = ???\n</code></pre>\n\n<p>The last <code>4</code> is both the square of <code>2</code> and <code>-2</code>, and there's no single result we can associate to it. The <code>square</code> function is not injective, so its inverse is not even a function.</p>\n\n<p>Worse, since <code>4</code> is equal to both the squares above, referential transparency mandates that the two lines above return the same result. This can not be the case, though.</p>\n"}], "owner": {"reputation": 1332, "user_id": 3262785, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XqvLk.jpg?s=128&g=1", "display_name": "sqd", "link": "https://stackoverflow.com/users/3262785/sqd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 28403038, "answer_count": 3, "score": 1, "last_activity_date": 1423474706, "creation_date": 1423456897, "question_id": 28402913, "link": "https://stackoverflow.com/questions/28402913/haskell-why-cant-i-pattern-match-against-function", "title": "Haskell: Why can&#39;t I pattern match against function?", "body": "<p>Such as:</p>\n\n<pre><code>extract (f x) = x\n</code></pre>\n\n<p>What I want to do is to extract the parameter from a function or a type constructor, such as</p>\n\n<pre><code>extract succ 4 = 4\nextract Just 4 = 4\n</code></pre>\n\n<p>ps. extract (f x) = f doesn't work either.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1423440176, "post_id": 28400880, "comment_id": 45137280, "body": "When would this not be better that the explicit-recursion alternative? It&#39;s more elegant, more concise, more general, probably more optimisation-friendly, can be defined anywhere ad-hoc inline..."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 9, "last_activity_date": 1423440466, "last_edit_date": 1423440466, "creation_date": 1423440100, "answer_id": 28400880, "question_id": 28400825, "link": "https://stackoverflow.com/questions/28400825/applying-a-list-of-functions-in-haskell/28400880#28400880", "title": "Applying a list of functions in Haskell", "body": "<p>You could use:</p>\n\n<pre><code> applyAll l v = fmap ($ v) l\n</code></pre>\n\n<p><code>fmap</code> lifts a function over the input list (actually any Functor). <code>$</code> has type <code>(a -&gt; b) -&gt; a -&gt; b</code> so it applies a function to a given value. <code>($ v)</code> is a <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"noreferrer\">section</a> which applies the given function to <code>v</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423457943, "post_id": 28400928, "comment_id": 45141194, "body": "This particular equivalence really helped me think about something a few months ago."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1423440428, "creation_date": 1423440428, "answer_id": 28400928, "question_id": 28400825, "link": "https://stackoverflow.com/questions/28400825/applying-a-list-of-functions-in-haskell/28400928#28400928", "title": "Applying a list of functions in Haskell", "body": "<p>Lee's solution is what I'd recommend, but this reads perhaps even nicer:</p>\n\n<pre><code>import Control.Applicative\n\napplyAll' fs v = fs &lt;*&gt; pure v\n</code></pre>\n\n<p>or</p>\n\n<pre><code>applyAll'' fs v = fs &lt;*&gt; [v]\n</code></pre>\n\n<p>This sort of makes stuff more complicated than necessary, though: we really only need the <code>Functor</code> instance of lists, whereas <code>applyAll'</code> injects and immediately extracts from the <code>Applicative</code> instance.</p>\n"}, {"comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 4, "creation_date": 1423443779, "post_id": 28400942, "comment_id": 45138111, "body": "It&#39;s probably worth pointing out that <code>[f b] -&gt; f [b]</code> unifies with <code>[a -&gt; b] -&gt; (a -&gt; [b])</code> when you take <code>f</code> to be <code>(a -&gt;)</code>. (Nevermind that it isn&#39;t valid syntax, it gets the point across best.)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1423452746, "post_id": 28400942, "comment_id": 45139956, "body": "@Carl, I have never understood why that is not valid syntax."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423452890, "post_id": 28400942, "comment_id": 45139996, "body": "Lee&#39;s less brain-twisty solution is likely to be more efficient in some contexts, but this one gets a point for being a library function already."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423696537, "post_id": 28400942, "comment_id": 45258441, "body": "@dfeuer: I think I saw, somewhere, that one reason might be because the usual section rules don&#39;t apply; for instance, <code>(-&gt; b)</code> isn&#39;t valid in Haskell.  I agree that I still wish the irregular section syntax were available, though!  But at least there&#39;s some explanation."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 18, "last_activity_date": 1423440578, "creation_date": 1423440578, "answer_id": 28400942, "question_id": 28400825, "link": "https://stackoverflow.com/questions/28400825/applying-a-list-of-functions-in-haskell/28400942#28400942", "title": "Applying a list of functions in Haskell", "body": "<p>This function actually already exists as a special case of a monadic function:</p>\n\n<pre><code>applyAll :: [a -&gt; b] -&gt; a -&gt; [b]\napplyAll = sequence\n</code></pre>\n"}], "owner": {"reputation": 1003, "user_id": 314336, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/8a8cecff04050c24b2d6315b8efa758a?s=128&d=identicon&r=PG", "display_name": "xyzt", "link": "https://stackoverflow.com/users/314336/xyzt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3326, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1423440578, "creation_date": 1423439722, "question_id": 28400825, "link": "https://stackoverflow.com/questions/28400825/applying-a-list-of-functions-in-haskell", "title": "Applying a list of functions in Haskell", "body": "<p>I wrote a function that applies a list of functions to an item.  </p>\n\n<pre><code>applyAll :: [a -&gt; b] -&gt; a -&gt; [b]\napplyAll [] _ = []\napplyAll (f:fs) x = (f x) : (applyAll fs x)\n</code></pre>\n\n<p>Is there a better way to do it?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1423436210, "post_id": 28400197, "comment_id": 45136329, "body": "Yes. Just let the compiler infer the most general type for each function. If you do that, <code>funIO&#39;</code> compiles. Or even <code>funNoIO :: Monad m =&gt; ReaderT Configuration m String</code> will work - since you never manipulate the inner monad, it makes sense that it could be anything. Then a sensible type for <code>funIO&#39;</code> is <code>MonadIO m =&gt; ReaderT Configuration m String</code> - the MonadIO constraint would come from any uses of <code>liftIO</code> inside the definition."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1423444485, "post_id": 28400197, "comment_id": 45138253, "body": "You can keep funNoIO as plain Reader if, when you come to mix it with <code>IO</code>-dependent things you use the <code>mmorph</code> approach <a href=\"https://hackage.haskell.org/package/mmorph-1.0.4\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/mmorph-1.0.4</a> , writing <code>hoist generalize funNoIO</code> . The example in the documents uses a <code>State&#47;StateT</code> example that is exactly parallel to yours. <code>hoist</code> has many other applications."}], "answers": [{"comments": [{"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 1, "creation_date": 1423445422, "post_id": 28400348, "comment_id": 45138444, "body": "You can also make their type signature <code>MonadReader Configuration m =&gt; m String</code>"}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 2, "last_activity_date": 1423436501, "last_edit_date": 1423436501, "creation_date": 1423436154, "answer_id": 28400348, "question_id": 28400197, "link": "https://stackoverflow.com/questions/28400197/how-to-get-reader-and-readert-to-work-together/28400348#28400348", "title": "How to get Reader and ReaderT to work together", "body": "<p>You can change the type of <code>funNoIO</code> and <code>funIO</code> to be parameterised over the monad type since they aren't used:</p>\n\n<pre><code>funNoIO :: Monad m =&gt; ReaderT Configuration m String\nfunIO' :: Monad m =&gt; ReaderT Configuration m String\n</code></pre>\n\n<p>to fix the compiler error, then you can change <code>main</code> to:</p>\n\n<pre><code>main = do\n    c &lt;- runReaderT funIO' \"configuration\"\n    print c\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": false, "score": 3, "last_activity_date": 1423438176, "creation_date": 1423438176, "answer_id": 28400640, "question_id": 28400197, "link": "https://stackoverflow.com/questions/28400197/how-to-get-reader-and-readert-to-work-together/28400640#28400640", "title": "How to get Reader and ReaderT to work together", "body": "<p>Another way is to use the <code>reader</code> method of <code>MonadReader</code> together with <code>runReader</code>:</p>\n\n<pre><code>funIO = reader $ runReader funNoIO\n</code></pre>\n\n<p><code>reader . runReader</code> converts from the pure <code>Reader</code> monad to a more general <code>MonadReader</code> instance.</p>\n"}], "owner": {"reputation": 313, "user_id": 2619957, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5899034c83ba305893d68f94c9e206e7?s=128&d=identicon&r=PG", "display_name": "synapski", "link": "https://stackoverflow.com/users/2619957/synapski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "accepted_answer_id": 28400348, "answer_count": 2, "score": 3, "last_activity_date": 1423438318, "creation_date": 1423435089, "last_edit_date": 1423438318, "question_id": 28400197, "link": "https://stackoverflow.com/questions/28400197/how-to-get-reader-and-readert-to-work-together", "title": "How to get Reader and ReaderT to work together", "body": "<p>I'm using the ReaderT Monad transformer to propagate my configuration data from my main function through several functions performing IO. The ultimate function that will need the data doesn't perform any IO. I have this working solution :</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Monad.Reader\n\ntype Configuration = String\n\nfunNoIO :: Reader Configuration String\nfunNoIO = do\n    config &lt;- ask\n    return $ config ++ \"!\"\n\nfunIO :: ReaderT Configuration IO String\nfunIO = do\n    config &lt;- ask\n    return $ runReader funNoIO config\n\nmain :: IO ()\nmain = do\n    c &lt;- runReaderT funIO \"configuration\"\n    print c\n</code></pre>\n\n<p>But it forces me to retrieve the configuration in the <code>funIO</code> function where I don't need it.</p>\n\n<p>I modified it like this :</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>funIO' :: ReaderT Configuration IO String\nfunIO' = do\n    v &lt;- funNoIO\n    return v\n</code></pre>\n\n<p>but it doesn't compile and I'm getting this error :</p>\n\n<pre><code>Couldn't match type \u2018ReaderT Configuration Identity String\u2019\n              with \u2018Identity (ReaderT Configuration IO String)\u2019\nExpected type: Identity (ReaderT Configuration IO String)\n  Actual type: Reader Configuration String\nIn the first argument of \u2018runIdentity\u2019, namely \u2018funNoIO\u2019\nIn a stmt of a 'do' block: v &lt;- runIdentity funNoIO\n</code></pre>\n\n<p>Is it possible to propagate my configuration data to a pure function without retrieving it in the intermediary IO functions?</p>\n\n<p>EDIT</p>\n\n<p>I parameterised my functions but I still can't perform an IO action in the <code>funIO'</code> function. For example :</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getMessage :: IO String\ngetMessage = do\n    return \"message\"\n\nfunIO' :: MonadIO m =&gt; ReaderT Configuration m String\nfunIO' = do\n    m &lt;- getMessage\n    v &lt;- funNoIO\n    return $ v ++ m\n</code></pre>\n\n<p>is giving me the following error :</p>\n\n<pre><code>Couldn't match type \u2018IO\u2019 with \u2018ReaderT Configuration m\u2019\nExpected type: ReaderT Configuration m String\nActual type: IO String\n</code></pre>\n\n<p>EDIT 2</p>\n\n<p>I got it, I just needed to use <code>liftIO</code> :</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>getMessage :: IO String\ngetMessage = do\n    return \"message\"\n\nfunIO' :: MonadIO m =&gt; ReaderT Configuration m String\nfunIO' = do\n    m &lt;- liftIO getMessage\n    v &lt;- funNoIO\n    return $ v ++ m\n</code></pre>\n"}, {"tags": ["linux", "eclipse", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423435407, "post_id": 28399634, "comment_id": 45136128, "body": "&quot;cannot satisfy -package Cabal-1.22.0.0&quot; - do you have this version of Cabal?"}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423436408, "post_id": 28399634, "comment_id": 45136392, "body": "yes.. I do have this locally, but globally I have 1.18. And I am really confused with this stuff. ghc-pkg list /usr/lib/ghc-7.8.4/package.conf.d Cabal-1.18.1.5  /home/mikhail/.ghc/x86_64-linux-7.8.4/package.conf.d    Cabal-1.22.0.0"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423519197, "post_id": 28399634, "comment_id": 45173563, "body": "If you have two different versions of Cabal, you probably have two different versions of cabal-install. This may be a problem with using the wrong cabal-install. Make sure that the newest version is first on the path (the cabal-install which comes with the Haskell Platform is not overwritten when you do <code>cabal install cabal-install</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "is_accepted": false, "score": 1, "last_activity_date": 1423558093, "last_edit_date": 1423558093, "creation_date": 1423556050, "answer_id": 28426911, "question_id": 28399634, "link": "https://stackoverflow.com/questions/28399634/haskell-eclipse-linux-and-buildwrapper/28426911#28426911", "title": "Haskell Eclipse Linux and Buildwrapper", "body": "<p>I do not know if it qualify for answer, I hope so.</p>\n\n<p>The problem was that when I install GHC from standard ubuntu and arch repository, it installs <strong>Cabal-1.18.1.5</strong> and <strong>Cabal-Install-1.22.0.0</strong> system wide. And this causing EclipseFP plugin to install buidwrapper version which was supposed to work with 1.22 Cabal, while I actually had 1.18. Eclipse setting for Haskell said I had Cabal 1.22 (which was wrong). </p>\n\n<p>What I did is added ArchHaskell repository, and installed everything from there, which got me 1.18 combo of Cabal and Cabal-install. EclipseFP worked it OK, finally. </p>\n\n<p>I think there was a way to move local install up in hierarchy so EclipseFP would pick it up. But I understood it may be too late.</p>\n"}], "owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1423558093, "creation_date": 1423431298, "question_id": 28399634, "link": "https://stackoverflow.com/questions/28399634/haskell-eclipse-linux-and-buildwrapper", "title": "Haskell Eclipse Linux and Buildwrapper", "body": "<p>I am kind of new Eclipse user, and Haskell too. I keep trying  to understand what is wrong and what to do, as my Eclipse after I installed Haskell platform keeps me saying following</p>\n\n<pre><code>Configuring Test1-0.1...\nbuildwrapper: Left over temporary directory not removed: /tmp/dynamic-cabal.23\n&lt;command line&gt;: cannot satisfy -package Cabal-1.22.0.0\n</code></pre>\n\n<p>I tried it on Ubuntu and Archlinux. Same behaviour. I have also read a lot of forums, and there is kind of information about GHC versions, cabal versions, and buildwrapper versions issues, but I could not figure how to fix that thing... \nFor example like here <a href=\"https://github.com/JPMoresmau/BuildWrapper/issues/18\" rel=\"nofollow\">https://github.com/JPMoresmau/BuildWrapper/issues/18</a>\nI tried cabal install cabal-install Eclipse started to behave a little different, cycling this over and over and over... </p>\n\n<pre><code>configuring because setup_config not present\nResolving dependencies...\nConfiguring Test1-0.1... \n</code></pre>\n\n<p>Any help please... </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1423432161, "last_edit_date": 1423432161, "creation_date": 1423431808, "answer_id": 28399702, "question_id": 28399155, "link": "https://stackoverflow.com/questions/28399155/finding-the-inverse-function-on-a-ltree/28399702#28399702", "title": "Finding the inverse function on a LTree", "body": "<p>Here's some hints. </p>\n\n<p>First hint: write an auxiliary function which, given a level, \"consumes\" pairs from a list and builds a subtree for that level. It returns both the subtree and the rest of the list (the pairs which have not been consumed). This has type</p>\n\n<pre><code>aux :: Int -&gt; [(a, Int)] -&gt; (Tree a, [(a, Int)])\n</code></pre>\n\n<p>Examples:</p>\n\n<pre><code>aux 1 [('a', 2), ('b', 2)]\n  -- a subtree at level 1 which has leaves at level 2\n  = (Fork (Leaf 'a') (Leaf 'b'), [])\naux 0 [('a', 2), ('b', 2), ('c', 1)]\n  -- no leaf remains\n  = (Fork (Fork (Leaf 'a') (Leaf 'b')) (Leaf 'c'), [])\naux 1 [('a', 2), ('b', 2), ('c', 1)]\n  -- a leaf remains\n  = (Fork (Leaf 'a') (Leaf 'b'), [('c', 1)])\naux 2 [('a', 2), ('b', 2), ('c', 1)]\n  = (Leaf 'a', [('b', 2), ('c', 1)])\naux 0 [('a', 0)]\n  = (Leaf 'a', [])\n</code></pre>\n\n<p>Second hint: to implement <code>aux</code>, start by comparing the level to the level in the first pair in the list. </p>\n\n<p>After <code>aux</code> is implemented, it is easy to derive the <code>build</code> function from it. (How?)</p>\n"}], "owner": {"reputation": 689, "user_id": 1558130, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/f67cb4e5a581697e1eadf7ad76b1e917?s=128&d=identicon&r=PG", "display_name": "Jos&#233; Ricardo Ribeiro", "link": "https://stackoverflow.com/users/1558130/jos%c3%a9-ricardo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 28399702, "answer_count": 1, "score": 0, "last_activity_date": 1423432161, "creation_date": 1423428190, "question_id": 28399155, "link": "https://stackoverflow.com/questions/28399155/finding-the-inverse-function-on-a-ltree", "title": "Finding the inverse function on a LTree", "body": "<p>In a LTree defined as:</p>\n\n<pre><code>data LTree a = Leaf a | Fork (LTree a) (LTree a)\n</code></pre>\n\n<p>I creates a list with all the leafs and the respective level like this:</p>\n\n<pre><code>cross :: LTree a -&gt; [(a,Int)]\ncross (Leaf x) = [(x,0)]\ncross (Fork e d) = map (\\(x,n) -&gt; (x,n+1)) (cross e ++ cross d)\n</code></pre>\n\n<p>Now I want to create the inverse function:</p>\n\n<pre><code>build :: [(a,Int)] -&gt; LTree a\n</code></pre>\n\n<p>So that build (cross a) = a for every LTree a</p>\n\n<p>Thank you very much in advance!</p>\n"}, {"tags": ["haskell", "lambda", "logic"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1423421440, "post_id": 28397863, "comment_id": 45131645, "body": "This is a complex problem. The intuitionistic sequent calculus LJ and its related results play key roles in its &quot;standard&quot; solution. The Djinn tool is a &quot;famous&quot; implementation of a proof search in this system (roughly), and the Curry-Howard isomorphism allows to present these proofs as lambda terms."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1423421809, "post_id": 28397863, "comment_id": 45131784, "body": "Further, there&#39;s no such a thing as &quot;converting&quot; a formula into a lambda expression. That would amount to &quot;converting&quot; theorems into their proofs, which is nonsense -- theorems admits many distinct proofs, in general. At best, you can do proof search, where you look for one such proof."}, {"owner": {"reputation": 97, "user_id": 3234977, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/de9b23d05d48101602dcb2543e56d907?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Leontev", "link": "https://stackoverflow.com/users/3234977/peter-leontev"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1423426143, "post_id": 28397863, "comment_id": 45133259, "body": "Thank you for clarification. I really glad to so much useful information in short time."}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 3234977, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/de9b23d05d48101602dcb2543e56d907?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Leontev", "link": "https://stackoverflow.com/users/3234977/peter-leontev"}, "edited": false, "score": 0, "creation_date": 1423425991, "post_id": 28398143, "comment_id": 45133216, "body": "Wow! That is really best and quickest answer I&#39;ve ever seen here. Thank you a lot. I&#39;ve installed Coq and have tried to used it but I can&#39;t read the output. It is too complicated :("}, {"owner": {"reputation": 97, "user_id": 3234977, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/de9b23d05d48101602dcb2543e56d907?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Leontev", "link": "https://stackoverflow.com/users/3234977/peter-leontev"}, "edited": false, "score": 0, "creation_date": 1423426093, "post_id": 28398143, "comment_id": 45133245, "body": "I will try to use Agda following your advice. It is strange that we do not consider such applications and did all the things by hands even without mentioned rules! Thank you a lot."}, {"owner": {"reputation": 97, "user_id": 3234977, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/de9b23d05d48101602dcb2543e56d907?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Leontev", "link": "https://stackoverflow.com/users/3234977/peter-leontev"}, "edited": false, "score": 0, "creation_date": 1423427019, "post_id": 28398143, "comment_id": 45133528, "body": "Ehm, if I understood you right the answer can be rewritten in the following way:   x(lambda y -&gt; y(\\lambda z -&gt; x (z))) ?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 97, "user_id": 3234977, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/de9b23d05d48101602dcb2543e56d907?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Leontev", "link": "https://stackoverflow.com/users/3234977/peter-leontev"}, "edited": false, "score": 2, "creation_date": 1423430087, "post_id": 28398143, "comment_id": 45134535, "body": "Not quite.  We don&#39;t apply <code>z</code> to <code>x</code>, but rather the function which ignores its argument and returns <code>z</code>.  In haskell this is written <code>const z</code> or <code>\\_ -&gt; z</code>, or <code>lambda q -&gt; z</code> in your notation where <code>q</code> is any unused variable."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 10, "last_activity_date": 1423422598, "creation_date": 1423422598, "answer_id": 28398143, "question_id": 28397863, "link": "https://stackoverflow.com/questions/28397863/haskell-lambda-expressions-and-simple-logic-formulas/28398143#28398143", "title": "Haskell lambda expressions and simple logic formulas", "body": "<p>This is a great time to use <a href=\"http://wiki.portal.chalmers.se/agda/pmwiki.php\">Agda</a>'s interactive mode.  It's like a game.  You can also do it manually but it's more work.  Here's what I did:</p>\n\n<pre><code>f : {A B : Set} -&gt; ((((A -&gt; B) -&gt; A) -&gt; A) -&gt; B) -&gt; B\nf x = ?\n\nGoal: B\nx : (((A -&gt; B) -&gt; A) -&gt; A) -&gt; B\n</code></pre>\n\n<p>Basically the only move we have is to apply <code>x</code>, so let's try that.</p>\n\n<pre><code>f : {A B : Set} -&gt; ((((A -&gt; B) -&gt; A) -&gt; A) -&gt; B) -&gt; B\nf x = x ?\n\nGoal: ((A -&gt; B) -&gt; A) -&gt; A \nx : (((A -&gt; B) -&gt; A) -&gt; A) -&gt; B\n</code></pre>\n\n<p>Now our goal is a function type, so let's try a lambda.</p>\n\n<pre><code>f : {A B : Set} -&gt; ((((A -&gt; B) -&gt; A) -&gt; A) -&gt; B) -&gt; B\nf x = x (\\y -&gt; ?)\n\nGoal: A \nx : (((A -&gt; B) -&gt; A) -&gt; A) -&gt; B\ny : (A -&gt; B) -&gt; A\n</code></pre>\n\n<p>We need an <code>A</code>, and <code>y</code> can give it to us if we provide it with the right argument.  Not sure what that is yet, but <code>y</code> is our best bet:</p>\n\n<pre><code>f : {A B : Set} -&gt; ((((A -&gt; B) -&gt; A) -&gt; A) -&gt; B) -&gt; B\nf x = x (\\y -&gt; y ?)\n\nGoal: A -&gt; B\nx : (((A -&gt; B) -&gt; A) -&gt; A) -&gt; B\ny : (A -&gt; B) -&gt; A\n</code></pre>\n\n<p>Our goal is a function type so let's use a lambda.</p>\n\n<pre><code>f : {A B : Set} -&gt; ((((A -&gt; B) -&gt; A) -&gt; A) -&gt; B) -&gt; B\nf x = x (\\y -&gt; y (\\z -&gt; ?))\n\nGoal: B\nx : (((A -&gt; B) -&gt; A) -&gt; A) -&gt; B\ny : (A -&gt; B) -&gt; A\nz : A\n</code></pre>\n\n<p>Now we need a <code>B</code>, and the only thing that can give us a <code>B</code> is <code>x</code>, so let's try that again.</p>\n\n<pre><code>f : {A B : Set} -&gt; ((((A -&gt; B) -&gt; A) -&gt; A) -&gt; B) -&gt; B\nf x = x (\\y -&gt; y (\\z -&gt; x ?))\n\nGoal: ((A -&gt; B) -&gt; A) -&gt; A\nx : (((A -&gt; B) -&gt; A) -&gt; A) -&gt; B\ny : (A -&gt; B) -&gt; A\nz : A\n</code></pre>\n\n<p>Now our goal is a function type returning <code>A</code>, but we have <code>z</code> which is an <code>A</code> so we don't need to use the argument.  We'll just ignore it and return <code>z</code>.</p>\n\n<pre><code>f : {A B : Set} -&gt; ((((A -&gt; B) -&gt; A) -&gt; A) -&gt; B) -&gt; B\nf x = x (\\y -&gt; y (\\z -&gt; x (\\_ -&gt; z)))\n</code></pre>\n\n<p>And there you go!</p>\n"}], "owner": {"reputation": 97, "user_id": 3234977, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/de9b23d05d48101602dcb2543e56d907?s=128&d=identicon&r=PG&f=1", "display_name": "Peter Leontev", "link": "https://stackoverflow.com/users/3234977/peter-leontev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 1, "accepted_answer_id": 28398143, "answer_count": 1, "score": 5, "last_activity_date": 1423422598, "creation_date": 1423420976, "question_id": 28397863, "link": "https://stackoverflow.com/questions/28397863/haskell-lambda-expressions-and-simple-logic-formulas", "title": "Haskell lambda expressions and simple logic formulas", "body": "<p>I have a misunderstanding while converting simple logic formula to lambda expression (proof of that formula).</p>\n\n<p>So, I have the following formula:\n((((A->B)->A)->A)->B)->B where -> means implication logical operator.</p>\n\n<p>How can I write some lambda expression in any functional language (Haskell, preferably) corresponding to it?</p>\n\n<p>I have some \"results\" but I am really not sure that it is correct way to do this:</p>\n\n<ul>\n<li>(((lambda F -> lambda A) -> A) -> lambda B) -> B    </li>\n<li>((((lambda A -> lambda B) -> A) -> A) -> B) -> B.</li>\n</ul>\n\n<p>How can it be possible to tranform the formula into lambda expression? It will be very helpful if you know some material refers to this issue.</p>\n\n<p>Thanks    </p>\n"}, {"tags": ["haskell", "emacs", "haskell-mode"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1423420886, "post_id": 28396635, "comment_id": 45131453, "body": "Are you sure that you have enabled interactive-haskell-mode hook ? It seems you are using inferior-haskell-mode."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1423421807, "post_id": 28396635, "comment_id": 45131783, "body": "This github issue for haskell-mode might be helpful: <a href=\"https://github.com/haskell/haskell-mode/issues/253\" rel=\"nofollow noreferrer\">github.com/haskell/haskell-mode/issues/253</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "edited": false, "score": 0, "creation_date": 1423429441, "post_id": 28398185, "comment_id": 45134311, "body": "I have interactive-haskell-mode enabled and haskell-process-type is set to ghci. Any tips on how I can proceed to find the error?"}, {"owner": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "edited": false, "score": 0, "creation_date": 1423430530, "post_id": 28398185, "comment_id": 45134677, "body": "So when i did set haskell-process-type to cabal-repl it fixed most of the problems. However flycheck is still underlining the text in the buffer saying that it is unable to locate the file. Any ice how to get flycheck to work? Also setting haskell-process-type to auto does not work."}, {"owner": {"reputation": 118, "user_id": 2067226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LTAy5.jpg?s=128&g=1", "display_name": "Michael Beidler", "link": "https://stackoverflow.com/users/2067226/michael-beidler"}, "reply_to_user": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "edited": false, "score": 0, "creation_date": 1423431490, "post_id": 28398185, "comment_id": 45134953, "body": "I think this link should help: <a href=\"https://github.com/flycheck/flycheck/issues/293#issuecomment-31580700\" rel=\"nofollow noreferrer\">github.com/flycheck/flycheck/issues/293#issuecomment-3158070&zwnj;&#8203;0</a>."}], "tags": [], "owner": {"reputation": 118, "user_id": 2067226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LTAy5.jpg?s=128&g=1", "display_name": "Michael Beidler", "link": "https://stackoverflow.com/users/2067226/michael-beidler"}, "is_accepted": false, "score": 1, "last_activity_date": 1423431724, "last_edit_date": 1423431724, "creation_date": 1423422800, "answer_id": 28398185, "question_id": 28396635, "link": "https://stackoverflow.com/questions/28396635/haskell-mode-with-sandboxes/28398185#28398185", "title": "haskell-mode with sandboxes", "body": "<p>Make sure you have:</p>\n\n<pre><code>(add-hook 'haskell-mode-hook 'interactive-haskell-mode)\n</code></pre>\n\n<p>in your emacs init file.</p>\n\n<p>There are different <a href=\"https://github.com/haskell/haskell-mode/wiki/Haskell-Interactive-Mode-Setup#user-content-ghci-process-type\" rel=\"nofollow\">GHCi process types</a> supported by haskell-mode. You need one that uses cabal.</p>\n\n<p>To find out what process type is currently applied, use <code>M-x describe-variable</code> and enter <code>haskell-process-type</code>. </p>\n\n<p>I think the haskell-mode documentation is out of date; because, looking at the source code, the default is <code>auto</code>, which will use <code>cabal-repl</code> if it is able to locate a <em>.cabal-sandbox</em> directory. Otherwise, it will use <code>ghci</code>.</p>\n\n<p>So, if your <code>haskell-process-type</code> is set to <code>ghci</code> or <code>auto</code> and it's unable to locate your cabal sandbox, you will see the error you posted. If it's currently set to <code>ghci</code>, change the <code>haskell-process-type</code> to <code>cabal-repl</code> by adding:</p>\n\n<pre><code>(custom-set-variables\n  '(haskell-process-type 'cabal-repl))\n</code></pre>\n\n<p>to your emacs init file and restarting the emacs process.</p>\n\n<p>Also, you can always confirm that the problem is specific to emacs by opening a command line, navigating to the directory containing your .cabal file and entering <code>cabal repl</code>. If that works, then your cabal setup is fine.</p>\n"}], "owner": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1423431724, "creation_date": 1423414388, "question_id": 28396635, "link": "https://stackoverflow.com/questions/28396635/haskell-mode-with-sandboxes", "title": "haskell-mode with sandboxes", "body": "<p>I have tried the following:</p>\n\n<pre><code>cabal sandbox init\n</code></pre>\n\n<p>Then making the following cabal file.</p>\n\n<pre><code>-- Initial hsource.cabal generated by cabal init.  For further \n-- documentation, see http://haskell.org/cabal/users-guide/\n\nname:                hsource\nversion:             0.1.0.0\n-- synopsis:            \n-- description:         \n-- license:             \nlicense-file:        LICENSE\nauthor:              abc\nmaintainer:          abc\n-- copyright:           \n-- category:            \nbuild-type:          Simple\n-- extra-source-files:  \ncabal-version:       &gt;=1.10\n\nexecutable hsource\n  main-is:             main.hs\n  other-modules:       \n  -- other-extensions:    \n  build-depends:       base &gt;=4.7 &amp;&amp; &lt;4.8, csv\n  hs-source-dirs:      src\n  default-language:    Haskell2010\n</code></pre>\n\n<p>Now I install the CSV package with:</p>\n\n<pre><code>cabal install --only-dependencies\n</code></pre>\n\n<p>Now when I try <code>import Text.CSV</code> then then <code>C-c C-l</code> I get the following error:</p>\n\n<pre><code>Util/RandomTree.hs:7:8-15: Could not find module \u2018Text.CSV\u2019 \u2026\n    Use -v to see a list of the files searched for.\nCompilation failed.\n</code></pre>\n\n<p>So my question is if sandboxes are not supported in haskell-mode or am I missing some steps to get them to work?</p>\n"}, {"tags": ["haskell", "haskell-platform"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1423415332, "post_id": 28396572, "comment_id": 45129449, "body": "In the future, please add the whole error message when you run into a problem like this. \u201c<code>Eq</code> error\u201d could be a lot of completely different things."}, {"owner": {"reputation": 3, "user_id": 4185815, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000150753736/picture?type=large", "display_name": "Alexandre Mirra", "link": "https://stackoverflow.com/users/4185815/alexandre-mirra"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1423417976, "post_id": 28396572, "comment_id": 45130364, "body": "Thanks for the tip. My first Question though. Sorry."}], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 3, "user_id": 4185815, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000150753736/picture?type=large", "display_name": "Alexandre Mirra", "link": "https://stackoverflow.com/users/4185815/alexandre-mirra"}, "edited": false, "score": 1, "creation_date": 1423421234, "post_id": 28396742, "comment_id": 45131575, "body": "@AlexandreMirra If this answer solved your problem, don&#39;t forget to accept it by clicking on the tickmark below the vote count. Once you\u2019ve gathered 15 reputation points on this site, you will also be able to upvote answers."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1423424927, "post_id": 28396742, "comment_id": 45132919, "body": "Simpler, I think, to write <code>(case r of TE -&gt; 1; _ -&gt; 0) + ...</code>."}], "tags": [], "owner": {"reputation": 4972, "user_id": 1964342, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ce48e3381ac19802f017e34b80e0536c?s=128&d=identicon&r=PG", "display_name": "tohava", "link": "https://stackoverflow.com/users/1964342/tohava"}, "is_accepted": true, "score": 6, "last_activity_date": 1423414978, "creation_date": 1423414978, "answer_id": 28396742, "question_id": 28396572, "link": "https://stackoverflow.com/questions/28396572/how-i-can-compare-a-variable-with-a-data-type-in-haskell/28396742#28396742", "title": "How i can compare a variable with a data type in Haskell?", "body": "<p>There are two solutions:</p>\n\n<p>1) Allow Eq</p>\n\n<pre><code>data Regime = ORD | TE | MEL  deriving (Show,Eq)\n</code></pre>\n\n<p>2) Use pattern-matching instead:</p>\n\n<pre><code>case r of\n  TE -&gt; 1 + (numeroT e + numeroT d)\n  _ -&gt; numeroT e + numeroT d\n</code></pre>\n\n<p>A shorter version of (2) is</p>\n\n<pre><code>(case r of \n  TE -&gt; (+1)\n  _ -&gt; id) $ numeroT e + numeroT d\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 4185815, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000150753736/picture?type=large", "display_name": "Alexandre Mirra", "link": "https://stackoverflow.com/users/4185815/alexandre-mirra"}, "edited": false, "score": 0, "creation_date": 1423415898, "post_id": 28396777, "comment_id": 45129635, "body": "Thank you very much. I just used:       instance Eq Regime where:  And my function just worked ;) . Thank you"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1423415251, "creation_date": 1423415251, "answer_id": 28396777, "question_id": 28396572, "link": "https://stackoverflow.com/questions/28396572/how-i-can-compare-a-variable-with-a-data-type-in-haskell/28396777#28396777", "title": "How i can compare a variable with a data type in Haskell?", "body": "<p>Haskell does not automatically assume that newly-defined data types allow equality-comparison. For some types this just isn't possible: for instance, you can in general not decide whether two functions are equal.</p>\n\n<p>For simple ADTs like <code>Regime</code> however, it is certainly possible. In doubt, you could define the <code>Eq</code> instance yourself:</p>\n\n<pre><code>instance Eq Regime where\n  ORD==ORD = True\n  TE==TE   = True\n  MEL==MEL = True\n  _ == _   = False\n</code></pre>\n\n<p>but to such a simple data type GHC can actually figure out alone how to do it: just add <code>Eq</code> to the <code>deriving</code> list.</p>\n\n<pre><code>data Regime = ORD | TE | MEL  deriving (Show, Eq)\n</code></pre>\n\n<p><strong>However</strong>, in Haskell, equality comparison is generally avoided: it tends to be clumsy and sometimes inefficient. Much more elegant is when you can pattern-match on constructors as Tohava showed: this lets you deconstruct a data structure and simultaneously decide what to do with the contents.</p>\n"}, {"tags": [], "owner": {"reputation": 93, "user_id": 1478437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3da92ff7b49a88181d924c17223bc389?s=128&d=identicon&r=PG", "display_name": "sverien", "link": "https://stackoverflow.com/users/1478437/sverien"}, "is_accepted": false, "score": 0, "last_activity_date": 1423423570, "creation_date": 1423423570, "answer_id": 28398319, "question_id": 28396572, "link": "https://stackoverflow.com/questions/28396572/how-i-can-compare-a-variable-with-a-data-type-in-haskell/28398319#28398319", "title": "How i can compare a variable with a data type in Haskell?", "body": "<p>If you use the <a href=\"http://en.wikibooks.org/wiki/Haskell/Pattern_matching\" rel=\"nofollow\">pattern matching</a> of Haskell you can create:</p>\n\n<pre><code>numeroT :: Turma -&gt; Int\nnumeroT Empty = 0\nnumeroT (Node (x,_,TE,_) e d) = (numeroT e) + (numeroT d) + 1\nnumeroT (Node (x,_,_,_) e d)  = (numeroT e) + (numeroT d)\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 4185815, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000150753736/picture?type=large", "display_name": "Alexandre Mirra", "link": "https://stackoverflow.com/users/4185815/alexandre-mirra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1425, "favorite_count": 0, "accepted_answer_id": 28396742, "answer_count": 3, "score": 0, "last_activity_date": 1423423570, "creation_date": 1423414020, "last_edit_date": 1423414742, "question_id": 28396572, "link": "https://stackoverflow.com/questions/28396572/how-i-can-compare-a-variable-with-a-data-type-in-haskell", "title": "How i can compare a variable with a data type in Haskell?", "body": "<pre><code>data BTree a = Empty | Node a (BTree a) (BTree a) deriving Show\n\ntype Aluno = (Numero,Nome,Regime,Classificacao)\ntype Numero = Int\ntype Nome = String\ndata Regime = ORD | TE | MEL  deriving Show\ndata Classificacao = Aprov Int| Rep| Faltou deriving Show\ntype Turma = BTree Aluno \n</code></pre>\n\n<p>I have this functions that counts how many \"Alunos\" have Regime TE.</p>\n\n<p>My code:</p>\n\n<pre><code>numeroT :: Eq  =&gt; Turma -&gt; Int\nnumeroT Empty = 0\nnumeroT (Node (x,_,r,_) e d) = if (r==TE) then 1+((numeroT e)+(numeroT d))\n                                      else (numeroT e)+(numeroT d)\n</code></pre>\n\n<p>Can I not compare <code>r</code> with TE? Getting <code>Eq</code> error.</p>\n"}, {"tags": ["haskell", "binary-tree"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1423423238, "creation_date": 1423423238, "answer_id": 28398253, "question_id": 28396434, "link": "https://stackoverflow.com/questions/28396434/show-different-paths-on-instance/28398253#28398253", "title": "Show different paths on instance", "body": "<p>You want a function to generate all paths. A possible approach would be:</p>\n\n<pre><code>paths :: Questionario -&gt; [String]\npaths (Answer x) = [\"ANSWER \" ++ x]\npaths (Question q l r) = [q ++ \"? No  \" ++ s | s &lt;- paths l] ++\n                         [q ++ \"? Yes \" ++ s | s &lt;- paths r]\n</code></pre>\n\n<p>There's only one path for the <code>Answer</code>. Instead the paths for a <code>Question</code> are the union of: </p>\n\n<ol>\n<li>those related to a negative answer, prepended with the question and \"No\", and </li>\n<li>those related to a positive answer, prepended with the question  and \"Yes\".</li>\n</ol>\n\n<p>You may want to use <code>map</code> instead of list comprehensions -- this is just a matter of personal taste.</p>\n"}], "owner": {"reputation": 37, "user_id": 4358044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6750d27fba55e9bd2348df47510c8a13?s=128&d=identicon&r=PG&f=1", "display_name": "spacecows", "link": "https://stackoverflow.com/users/4358044/spacecows"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1423423238, "creation_date": 1423413292, "question_id": 28396434, "link": "https://stackoverflow.com/questions/28396434/show-different-paths-on-instance", "title": "Show different paths on instance", "body": "<p>I have the following tree:</p>\n\n<pre><code>data Questionario = Answer String\n                  | Question String Questionario Questionario\n</code></pre>\n\n<p>Being the sub-tree on the left a Negative answer and the sub-tree on the right a positive answer.</p>\n\n<p>And i want to define Questionario as an instance, showing all possible paths. For example:</p>\n\n<pre><code>q = Question \"a &gt;= b\"\n      (Question \"a &gt;= c\"\n         (Question \"b &gt;= c\"\n              (Answer \"a b c\")\n              (Answer \"a c b\"))\n         (Answer \"c a b\"))\n      (Question \"a &gt;= c\"\n         (Answer \"b a c\")\n         (Question \"b &gt;= c\"\n             (Answer \"b c a\")\n             (Answer \"c b a\")))\n</code></pre>\n\n<p>must appear as :</p>\n\n<pre><code>*Main&gt; q\na &gt;= b? No a &gt;= c? No b &gt;= c? No ANSWER: a b c\na &gt;= b? No a &gt;= c? No b &gt;= c? Yes ANSWER: a c b\na &gt;= b? No a &gt;= c? Yes ANSWER: c a b\na &gt;= b? Yes a &gt;= c? No ANSWER: b a c\na &gt;= b? Yes a &gt;= c? Yes b &gt;= c? No ANSWER: b c a\na &gt;= b? Yes a &gt;= c? Yes b &gt;= c? Yes ANSWER: c b a\n</code></pre>\n\n<p>I've already wrote this:</p>\n\n<pre><code>instance Show Questionario where\n    show (Answer x) = \"ANSWER \" ++ x\n    show (Question q r l) = q ++ \"? \"\n</code></pre>\n\n<p>But i'm not sure how to make it show every possible path. How do i do it? Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1423422700, "post_id": 28396076, "comment_id": 45132090, "body": "You are not asking for this, but the approach used in <code>parseInteger</code> is weird -- I would say even morally wrong. This is because it breaks the <code>Parser</code> abstraction with <code>runParser</code>, and the result is not a <code>Parser</code> so it is not composable with anything else. A more natural approach would be to provide a <code>Functor Parser</code> instance, and then define <code>integer :: Parser Integer</code> as <code>fmap read $ oneOrMore (satisfy isNumber)</code>. In this way you keep everything &quot;inside&quot; the parser functor, and the result is a parser which can then be reused compositionally."}, {"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423425420, "post_id": 28396076, "comment_id": 45133046, "body": "Thank you for setting me straight, chi"}], "answers": [{"comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1423415237, "post_id": 28396155, "comment_id": 45129423, "body": "@KevinMeredith - <code>$</code> is used to apply arguments to functions while <code>(.)</code> is used to compose them - you will usually use <code>(.)</code> in point-free style."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 3, "last_activity_date": 1423415165, "last_edit_date": 1423415165, "creation_date": 1423411729, "answer_id": 28396155, "question_id": 28396076, "link": "https://stackoverflow.com/questions/28396076/writing-parser-for-integer-type-error/28396155#28396155", "title": "Writing Parser for Integer - Type Error", "body": "<p>You need to use <code>(.)</code> instead of <code>$</code>:</p>\n\n<pre><code>fmap (read . fst) . runParser (oneOrMore (satisfy isNumber))\n</code></pre>\n\n<p>alternatively you need to supply the string to <code>runParser</code>:</p>\n\n<pre><code>parseInteger s = fmap (read . fst) $ runParser (oneOrMore (satisfy isNumber)) s\n</code></pre>\n\n<p><code>fmap (read . fst)</code> in this case has type <code>Maybe (String, a) -&gt; Maybe Integer</code> and <code>runParser (oneOrMore (satisfy isNumber))</code> has type <code>String -&gt; Maybe (String, String)</code>. These two functions can be composed with <code>(.)</code>, but <code>($)</code> has type <code>(a -&gt; b) -&gt; a -&gt; b</code> - here <code>a</code> is <code>Maybe (String, a)</code> while you are supplying the function inside the <code>Parser</code>.</p>\n\n<p>If you apply the string to this function instead, you can get the <code>Maybe (String, a)</code> required by <code>($)</code>.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 28396155, "answer_count": 1, "score": 0, "last_activity_date": 1423415165, "creation_date": 1423411262, "question_id": 28396076, "link": "https://stackoverflow.com/questions/28396076/writing-parser-for-integer-type-error", "title": "Writing Parser for Integer - Type Error", "body": "<p>Given the following <code>Parser</code> definitions (from Prof. Brent Yorgey's U of Penn <a href=\"http://www.cis.upenn.edu/~cis194/spring13/\" rel=\"nofollow\">class</a>):</p>\n\n<pre><code>newtype Parser a = Parser { runParser :: String -&gt; Maybe (a, String) }\n\nsatisfy :: (Char -&gt; Bool) -&gt; Parser Char\nsatisfy p = Parser f\n  where\n    f [] = Nothing    -- fail on the empty input\n    f (x:xs)          -- check if x satisfies the predicate\n                        -- if so, return x along with the remainder\n                        -- of the input (that is, xs)\n        | p x       = Just (x, xs)\n        | otherwise = Nothing  -- otherwise, fail\n</code></pre>\n\n<p>Given the following parser for <code>one or more of 'a'</code>:</p>\n\n<pre><code>oneOrMore :: Parser a -&gt; Parser [a]\noneOrMore p = (:) &lt;$&gt; p &lt;*&gt; (zeroOrMore p)\n</code></pre>\n\n<p>And, now I'd like to extract an <code>Integer</code> or nothing:</p>\n\n<pre><code>parseInteger :: String -&gt; Maybe Integer\nparseInteger = fmap (read . fst) $ runParser (oneOrMore (satisfy isNumber))\n</code></pre>\n\n<p>But I'm getting this compile-time error:</p>\n\n<pre><code>JsonParser.hs:42:36:\n    Couldn't match type \u2018(String, b0)\u2019 with \u2018Maybe ([Char], String)\u2019\n    Expected type: String -&gt; (String, b0)\n      Actual type: String -&gt; Maybe ([Char], String)\n    In the second argument of \u2018($)\u2019, namely\n      \u2018runParser (oneOrMore (satisfy isNumber))\u2019\n    In the expression:\n      fmap (read . fst) $ runParser (oneOrMore (satisfy isNumber))\nFailed, modules loaded: SExpr, Model, AParser.\n*SExpr Data.Char&gt; :t runParser \nrunParser :: Parser a -&gt; String -&gt; Maybe (a, String)\n</code></pre>\n\n<p>I'm confused since <code>runParser</code> has a type of <code>String -&gt; Maybe (a, String)</code>. </p>\n\n<p>Calling <code>fmap</code> on <code>Maybe (a, String)</code> should apply <code>fmap</code>'s function to the <code>(a, String)</code> type.</p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1423415264, "post_id": 28395565, "comment_id": 45129438, "body": "All you have to do is replace all instances of <code>[cards]</code> with simply <code>cards</code>. Then you&#39;re done."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 1, "last_activity_date": 1423408572, "creation_date": 1423408572, "answer_id": 28395590, "question_id": 28395565, "link": "https://stackoverflow.com/questions/28395565/how-to-delete-element-from-list/28395590#28395590", "title": "How to delete element from list", "body": "<p>Import <code>Data.List</code>. And use <a href=\"https://www.fpcomplete.com/hoogle?q=delete&amp;env=ghc-7.8-stable-14.09\" rel=\"nofollow\">Hoogle</a>.</p>\n"}], "owner": {"reputation": 49, "user_id": 3849382, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/536351a30f9c13cea12500f83a39b43c?s=128&d=identicon&r=PG&f=1", "display_name": "Achref", "link": "https://stackoverflow.com/users/3849382/achref"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 651, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1423411064, "creation_date": 1423408462, "last_edit_date": 1423411064, "question_id": 28395565, "link": "https://stackoverflow.com/questions/28395565/how-to-delete-element-from-list", "title": "How to delete element from list", "body": "<p>i'm trying to learn haskell. i want to delete an element from list.</p>\n\n<p>This is my code :</p>\n\n<pre><code>import Data.List\ndata IllegalMove = IllegalMove deriving (Show, Eq)\ndata Suit = Clubs | Diamonds | Hearts | Spades deriving (Show, Eq)\ndata Rank = Jack | Queen | King | Ace | Num Int deriving (Show, Eq)\ntype Card = (Suit, Rank)\nremoveCard :: [Card] -&gt; Card -&gt; Either IllegalMove [Card]\nremoveCard [] card = Left IllegalMove\nremoveCard [cards] card \n      | card `elem` [cards] = Right (delete card [cards])\n      | otherwise = Left IllegalMove\n</code></pre>\n\n<p>so when i try to compile this example i got an error : </p>\n\n<pre><code>*Main&gt; removeCard [(Clubs,King),(Diamonds,Queen)] (Clubs,Queen )\n*** Exception: Assignment13.hs:(7,1)-(10,38): Non-exhaustive patterns in function removeCard\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1423407890, "post_id": 28395339, "comment_id": 45127080, "body": "I&#39;m guessing it satisfies the laws, but is it useful? (I don&#39;t have much hadkell knowledge - so it&#39;s a question, not a comment)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1423408633, "post_id": 28395339, "comment_id": 45127357, "body": "@KevinMeredith, barely. It&#39;s possible you might want such a thing as the base case of some sort of recursion. This is pretty much what the <code>Functor</code> instances for <code>Data.Proxy.Proxy</code> and <code>Data.Functor.Constant.Constant</code> look like."}, {"owner": {"reputation": 64094, "user_id": 476408, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2bc1bffafe7aa29ef900b98d1fd1e94e?s=128&d=identicon&r=PG", "display_name": "J. Abrahamson", "link": "https://stackoverflow.com/users/476408/j-abrahamson"}, "edited": false, "score": 0, "creation_date": 1423489505, "post_id": 28395339, "comment_id": 45155822, "body": "It can be very useful! It allows you to pass a <code>Functor</code>-like thing in where people expect a genuine <code>Functor</code>. You can use this to collect their <code>fmap</code>&#39;d functions for later, or to sneak values through a computation without the user knowing."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 4, "last_activity_date": 1423407328, "creation_date": 1423407328, "answer_id": 28395339, "question_id": 28395296, "link": "https://stackoverflow.com/questions/28395296/attempting-to-implement-functor-on-phantom-type/28395339#28395339", "title": "Attempting to Implement Functor on Phantom Type", "body": "<p>Since <code>a</code> is a phantom type, you can't apply <code>f</code> at all, but you can do:</p>\n\n<pre><code>instance Functor Foo where\n    fmap _ (Bar x) = Bar x\n    fmap _ (Baz x) = Baz x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423477333, "post_id": 28396021, "comment_id": 45149020, "body": "Could you write something about how this relates to the question?  I must admit that I am stumped."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423478480, "post_id": 28396021, "comment_id": 45149613, "body": "@Tom Ellis, it shows (a) how to implement a functor instance for a phantom type and (b) why one might choose to do so. In particular it was prompted by the OP&#39;s comment on Lee&#39;s answer, &quot;I&#39;m guessing it satisfies the laws, but is it useful?&quot;."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 7, "last_activity_date": 1423410958, "creation_date": 1423410958, "answer_id": 28396021, "question_id": 28395296, "link": "https://stackoverflow.com/questions/28395296/attempting-to-implement-functor-on-phantom-type/28396021#28396021", "title": "Attempting to Implement Functor on Phantom Type", "body": "<p>A crucial skill in functional programming is grasping, in a given situation, the right way to do nothing. Classic errors arise, e.g., from giving <code>[]</code> meaning \"no solutions\" as the base case of a recursive search, when <code>[[]]</code> meaning \"one trivial solution\" is needed. Thus also <code>Functor</code> instances for phantom types, i.e. constant functors, are useful as the apparently trivial base case of a larger pattern.</p>\n\n<p>I can present the general toolkit for building container-like structures as follows:</p>\n\n<pre><code>newtype K a x = K a deriving Functor             -- K for konstant\n{- fmap _ (K a) = K a -}\n\nnewtype I x = I x deriving Functor               -- I for identity\n{- fmap k (I x) = I (k x) -}\n\nnewtype P f g x = P (f x, g x) deriving Functor  -- P for product\n{- will give (Functor f, Functor g) =&gt; Functor (P f g), such that\n   fmap k (P (fx, gx)) = P (fmap k fx, fmap k gx) -}\n\nnewtype S f g x = S (Either (f x) (g x))         -- S for sum\ninstance (Functor f, Functor g) =&gt; Functor (S f g) where\n  fmap k (S (Left  fx))  = S (Left  (fmap k fx))\n  fmap k (S (Right gx))  = S (Right (fmap k gx))\n</code></pre>\n\n<p>Now, any recursive data structure can be presented as a top node which acts as a container for substructures.</p>\n\n<pre><code>data Data f = Node (f (Data f))\n</code></pre>\n\n<p>For example, if I want to make binary trees with numbers at the leaves, I can\nwrite</p>\n\n<pre><code>type Tree = S (K Int) (P I I)\n</code></pre>\n\n<p>to indicate that the node structure for a tree is either a leaf with an <code>Int</code> and <em>no subtrees</em> or a fork with a pair of subtrees. I need <code>K</code> to point out the <em>absence</em> of recursive substructures. The type of trees is then <code>Data Tree</code>.</p>\n\n<p>The usual recursion scheme for these things is</p>\n\n<pre><code>fold :: Functor f =&gt; (f t -&gt; t) -&gt; Data f -&gt; t\nfold k (Node fd) = k (fmap (fold k) fd)\n</code></pre>\n\n<p>We don't need to do any work to instantiate that for trees, because <code>Tree</code> is already a <code>Functor</code>, as it was built from functorial components. The trivial <code>fmap</code> for <code>K Int</code> amounts to saying that the recursion stops when you reach a leaf.</p>\n\n<p>Of course, these \"encoded\" data types make it harder to see what you're doing when you write ordinary programs by pattern matching. That's where the <code>PatternSynonyms</code> extension comes to your rescue. You can say</p>\n\n<pre><code>pattern Leaf i    = Node (S (Left (K i)))\npattern Fork l r  = Node (S (Right (P (I l, I r))))\n</code></pre>\n\n<p>to recover the usual interface. I recommend leaving off the outer <code>Node</code>, to fit with the way <code>fold</code> strips <code>Node</code> for you.</p>\n\n<pre><code>pattern Leaf i = S (Left (K i))\npattern Fork l r = S (Right (P (I l, I r)))\n\nadd :: Data Tree -&gt; Int\nadd = fold $ \\ t -&gt; case t of\n  Leaf i   -&gt; i\n  Fork x y -&gt; x + y\n</code></pre>\n\n<p>I've barely scratched the surface of the kinds of generic functionality you can roll out to lots of data types whenever you can develop them just for <code>K</code>, <code>I</code>, <code>P</code> and <code>S</code>. The <code>K</code> cases are always trivial, but they have to be there.</p>\n\n<p>Similar considerations apply to the <code>Void</code> data type (in <code>Data.Void</code>). Why on earth would we bother to introduce a data type with no elements worth speaking of? To model the impossible cases of a larger scheme.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1423410958, "creation_date": 1423407116, "question_id": 28395296, "link": "https://stackoverflow.com/questions/28395296/attempting-to-implement-functor-on-phantom-type", "title": "Attempting to Implement Functor on Phantom Type", "body": "<p>Given the following algebraic data type:</p>\n\n<p><code>data Foo = Bar Int | Baz Bool deriving Show</code></p>\n\n<p>I tried to implement a Functor instance.</p>\n\n<pre><code>instance Functor Foo where\n    fmap f (Bar x) = Bar (f x)\n    fmap f (Baz x) = Baz (f x)\n</code></pre>\n\n<p>But I got this compile-time error:</p>\n\n<pre><code>ghci&gt; :l explore/FunctorExplore.hs \n[1 of 1] Compiling Main             ( explore/FunctorExplore.hs, interpreted )\n\nexplore/FunctorExplore.hs:3:18:\n    The first argument of \u2018Functor\u2019 should have kind \u2018* -&gt; *\u2019,\n      but \u2018Foo\u2019 has kind \u2018*\u2019\n    In the instance declaration for \u2018Functor Foo\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>So, then I added an <code>a</code> in order to attempt to satisfy the compiler:</p>\n\n<p><code>data Foo a = Bar Int | Baz Bool deriving Show</code></p>\n\n<p>But then I got two errors that, as I understand, basically mean that an <code>(a -&gt; b)</code> function can't be applied to an <code>Int</code> or <code>Bool</code>. <code>a</code> is a generic type, whereas the other two are specific.</p>\n\n<pre><code>ghci&gt; :l explore/FunctorExplore.hs \n[1 of 1] Compiling Main             ( explore/FunctorExplore.hs, interpreted )\n\nexplore/FunctorExplore.hs:4:31:\n    Couldn't match expected type \u2018Int\u2019 with actual type \u2018b\u2019\n      \u2018b\u2019 is a rigid type variable bound by\n          the type signature for fmap :: (a -&gt; b) -&gt; Foo a -&gt; Foo b\n          at explore/FunctorExplore.hs:4:9\n    Relevant bindings include\n      f :: a -&gt; b (bound at explore/FunctorExplore.hs:4:14)\n      fmap :: (a -&gt; b) -&gt; Foo a -&gt; Foo b\n        (bound at explore/FunctorExplore.hs:4:9)\n    In the first argument of \u2018Bar\u2019, namely \u2018(f x)\u2019\n    In the expression: Bar (f x)\n\nexplore/FunctorExplore.hs:4:33:\n    Couldn't match expected type \u2018a\u2019 with actual type \u2018Int\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for fmap :: (a -&gt; b) -&gt; Foo a -&gt; Foo b\n          at explore/FunctorExplore.hs:4:9\n    Relevant bindings include\n      f :: a -&gt; b (bound at explore/FunctorExplore.hs:4:14)\n      fmap :: (a -&gt; b) -&gt; Foo a -&gt; Foo b\n        (bound at explore/FunctorExplore.hs:4:9)\n    In the first argument of \u2018f\u2019, namely \u2018x\u2019\n    In the first argument of \u2018Bar\u2019, namely \u2018(f x)\u2019\nFailed, modules loaded: none.\n</code></pre>\n\n<p>In this situation, it appears to me that a Functor can't be created. Is there more to my question, i.e. what am I missing?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1423415729, "post_id": 28395214, "comment_id": 45129576, "body": "The  problem with derived functor instances is they might not work in the way you expect. When in doubt, write it yourself!"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1423437324, "post_id": 28395214, "comment_id": 45136634, "body": "@AJFarmar At least extensionally and avoiding undefined, parametricity guarantees that there is most one fmap. Performancewise, of course, some corners may remain uncut by the automatics."}, {"owner": {"reputation": 5707, "user_id": 1186208, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e601af8314cff7e7cca5647125e5a5ed?s=128&d=identicon&r=PG", "display_name": "Christian Conkle", "link": "https://stackoverflow.com/users/1186208/christian-conkle"}, "reply_to_user": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1425073581, "post_id": 28395214, "comment_id": 45827966, "body": "@pigworker&#39;s comment boils down (well, waters down, actually) to this: Under normal circumstances (for a specific value of &quot;normal&quot;), there is only <i>one</i> valid instance <code>Functor T</code> for any given <code>T</code>, and <code>DeriveFunctor</code> will produce that instance. Writing the instances by hand is an excellent way to understand them, though. I&#39;ve learned a lot by studying the hand-written instances in <code>base</code>, <code>free</code>, <code>folds</code>, and many other libraries."}], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 1, "creation_date": 1423407223, "post_id": 28395306, "comment_id": 45126891, "body": "Thanks. Out of curiosity, is using this compiler directive considered good, bad, or simply style?"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1423407522, "post_id": 28395306, "comment_id": 45126979, "body": "Using it means that you are using compiler-specific extension. So, in theory, this makes your code less portable."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 4, "creation_date": 1423408526, "post_id": 28395306, "comment_id": 45127311, "body": "@KevinMeredith, the &quot;in theory&quot; is because at the present time there&#39;s only one practically relevant Haskell implementation; it also seems fairly likely that a future practically relevant implementation would also support <code>DeriveFunctor</code>\u2014it&#39;s proven itself sufficiently useful and sufficiently well-behaved."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 4, "last_activity_date": 1423407502, "last_edit_date": 1423407502, "creation_date": 1423407174, "answer_id": 28395306, "question_id": 28395214, "link": "https://stackoverflow.com/questions/28395214/automatic-functor-instance/28395306#28395306", "title": "Automatic Functor Instance", "body": "<p>Sure it can, add <code>deriving Functor</code> to your data declaration and <code>{-# LANGUAGE DeriveFunctor #-}</code> at the top of file.</p>\n"}, {"comments": [{"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423440090, "post_id": 28395365, "comment_id": 45137258, "body": "I&#39;ve noticed that <code>Either</code> case before (hm, wasn&#39;t it in one of your other answers?), it seems to me that for such things to work properly, GHC would need to learn about bi- and more generally multi-functors."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": true, "score": 10, "last_activity_date": 1423407881, "last_edit_date": 1423407881, "creation_date": 1423407452, "answer_id": 28395365, "question_id": 28395214, "link": "https://stackoverflow.com/questions/28395214/automatic-functor-instance/28395365#28395365", "title": "Automatic Functor Instance", "body": "<p>Working in ghci, if you make the incantation</p>\n\n<pre><code>Prelude&gt; :set -XDeriveFunctor\n</code></pre>\n\n<p>then the compiler will become as clever as you are hoping for, if not quite as enthusiastic. You will need to invoke the functionality, thus,</p>\n\n<pre><code>Prelude&gt; data Foo a = Foo a deriving (Show, Functor)\n</code></pre>\n\n<p>(the <code>Show</code> is just for printing the output, below) and then you will be able to do stuff like</p>\n\n<pre><code>Prelude&gt; fmap (++\"bar\") (Foo \"foo\")\nFoo \"foobar\"\n</code></pre>\n\n<p>In a module, you achieve the same by adding the pragma</p>\n\n<pre><code>{-# LANGUAGE DeriveFunctor #-}\n</code></pre>\n\n<p>before the <code>module</code> declaration. It's good for at least the more straightforward <code>Functor</code> instances, but you can fool it into a false negative.</p>\n\n<pre><code>Prelude&gt; data Boo a = Boo (Either a Bool) deriving Functor\n\n&lt;interactive&gt;:9:43:\n    Can't make a derived instance of \u2018Functor Boo\u2019:\n      Constructor \u2018Boo\u2019 must use the type variable only as the\n        last argument of a data type\n      In the data declaration for \u2018Boo\u2019\n</code></pre>\n\n<p>Meanwhile</p>\n\n<pre><code>data Goo a = Goo (Either Bool a) deriving Functor\n</code></pre>\n\n<p>is ok, and the machinery has clearly been hacked to work with pairing, as</p>\n\n<pre><code>data Woo a = Woo (a, Bool) deriving Functor\n</code></pre>\n\n<p>is permitted.</p>\n\n<p>So it's not as clever as it could be, but it's better than a poke in the eye.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 28395365, "answer_count": 2, "score": 3, "last_activity_date": 1423407881, "creation_date": 1423406650, "question_id": 28395214, "link": "https://stackoverflow.com/questions/28395214/automatic-functor-instance", "title": "Automatic Functor Instance", "body": "<p>Given the following algebraic type:</p>\n\n<pre><code>ghci&gt; data Foo a = Foo a\n</code></pre>\n\n<p>Then I instantiate one of them.</p>\n\n<pre><code>ghci&gt; let f = Foo \"foo\"\n</code></pre>\n\n<p>Lastly, I'd like to call <code>fmap</code> to apply a function as, <code>(a -&gt; b) -&gt; Foo a -&gt; Foo b</code>.</p>\n\n<pre><code>ghci&gt; fmap (++ \"bar\") f\n\n&lt;interactive&gt;:78:1:\n    No instance for (Functor Foo) arising from a use of \u2018fmap\u2019\n    In the expression: fmap (++ \"bar\") f\n    In an equation for \u2018it\u2019: it = fmap (++ \"bar\") f\n</code></pre>\n\n<p>But, since I didn't implement a <code>Functor</code> instance of <code>Foo</code>, I can't use <code>fmap</code>.</p>\n\n<p>Is there a way to get <code>Functor</code> instances for free? I have zero knowledge of Haskell's compiler, but perhaps it's clever enough to know that <code>fmap</code> on <code>Foo a</code> is simply apply <code>(a -&gt; b)</code> to <code>Foo</code>'s <code>a</code>?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "edited": false, "score": 4, "creation_date": 1423392247, "post_id": 28392947, "comment_id": 45122774, "body": "Why do you want to do this? What is your use case? This seems like an <a href=\"http://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">xy problem</a> to me."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1423393133, "post_id": 28392947, "comment_id": 45122984, "body": "Do you want to do OOP with classes in Haskell, or do you want to represent in Haskell classes from some other language?"}, {"owner": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "edited": false, "score": 0, "creation_date": 1423393957, "post_id": 28392947, "comment_id": 45123209, "body": "No I do not want to do OOP in haskell. Imaging that the class type I&#39;m trying to make will be a node in a graph."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423395091, "post_id": 28392947, "comment_id": 45123512, "body": "It depends on what you want to do with this type. Do you want to represent just the syntax of another language, which happens to be OO? Or are you trying to write an interpreter for such language, and you need to represent objects (not just classes) in that language?"}], "answers": [{"tags": [], "owner": {"reputation": 704, "user_id": 939572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aadfb25285dc4e9a3caf81e2277d77b?s=128&d=identicon&r=PG", "display_name": "GarethR", "link": "https://stackoverflow.com/users/939572/garethr"}, "is_accepted": false, "score": 2, "last_activity_date": 1423397628, "creation_date": 1423397628, "answer_id": 28393792, "question_id": 28392947, "link": "https://stackoverflow.com/questions/28392947/generic-type-for-oo-classes-in-haskell/28393792#28393792", "title": "Generic type for OO classes in Haskell", "body": "<p>I think you want to represent your class diagrams entirely as values rather than a mix of values and types. Instead of <code>Attr Int</code>, for example, you might use something like <code>Attr { name=\"Int\", kind=PrimitiveInt }</code>. I've introduced an <code>OopType</code> type below.</p>\n\n<pre><code>data Attr   = Attr { name :: String\n                   , kind :: OopType}\n              deriving (Show)\n\ndata Action = Action { name1 :: String\n                     , params :: [Attr]}\n              deriving (Show)\n\ndata Class   = NewC { name2 :: String\n                    , attrs :: [Attr]\n                    , actions :: [Action]}\n            deriving (Show)\n\ndata OopType = ClassType Class\n             | InterfaceType Class   -- TODO make a dedicated interface type\n             | Enum                  -- TODO make a dedicated enum type\n             | PrimitiveString\n             | PrimitiveInt\n</code></pre>\n\n<p>Note that this representation doesn't model 'generics' (that is, classes that are parameterised by types). To do that, you'd add another field to the Class type.</p>\n"}], "owner": {"reputation": 5360, "user_id": 3139545, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4a158119260b6a27a6bab276cac749?s=128&d=identicon&r=PG&f=1", "display_name": "user3139545", "link": "https://stackoverflow.com/users/3139545/user3139545"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1423397628, "creation_date": 1423391578, "last_edit_date": 1423394012, "question_id": 28392947, "link": "https://stackoverflow.com/questions/28392947/generic-type-for-oo-classes-in-haskell", "title": "Generic type for OO classes in Haskell", "body": "<p>I want to have a generic type that can represent any class in a simple class diagram. In this case a class contains:</p>\n\n<ol>\n<li>A name</li>\n<li>Any number of arguments of any type</li>\n<li>Any number of functions that takes any number of arguments of any type</li>\n</ol>\n\n<p>I have only used simple ADT declarations which is not working in this case, for example this is what I have been stuck with but it gives me no where near the type of flexibility I'm after:</p>\n\n<pre><code>data Attr a = Attr { name :: String\n                   , kind :: a}\n              deriving (Show)\n\ndata Action = Action { name1 :: String\n                     , params :: [Attr Int]}\n              deriving (Show)\n\ndata Class a = NewC { name2 :: String\n                    , attrs :: [Attr Int]\n                    , actions :: [Action]}\n            deriving (Show)\n</code></pre>\n\n<p>So my question is now how would I go about representing any arbitrary class in Haskell?</p>\n\n<p>I do not want to do OOP in haskell. Imaging that the class type I'm trying to make will be a node in a graph. However each node in the graph will be a different class.</p>\n"}, {"tags": ["haskell", "compiler-construction", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1423378979, "post_id": 28390434, "comment_id": 45120076, "body": "Unfortunately GHC does not expose a nice API for this.  You might get some milage from <a href=\"http://hackage.haskell.org/package/haskell-type-exts\" rel=\"nofollow noreferrer\">haskell-type-exts</a>."}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "is_accepted": false, "score": 1, "last_activity_date": 1423430858, "creation_date": 1423430858, "answer_id": 28399554, "question_id": 28390434, "link": "https://stackoverflow.com/questions/28390434/traverse-typed-abstract-syntax-tree-in-haskell-compiler/28399554#28399554", "title": "Traverse typed abstract syntax tree in Haskell Compiler", "body": "<p><a href=\"https://wiki.haskell.org/GHC/As_a_library\" rel=\"nofollow\">GHC-as-a-library</a> gives you a <code>TypecheckedModule</code>, and <code>getNamesInScope</code>, which includes the type of each name.</p>\n"}], "owner": {"reputation": 175, "user_id": 3261577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcd1f48c36b1a8c89016b8dadf35cfd7?s=128&d=identicon&r=PG&f=1", "display_name": "Wei Chen", "link": "https://stackoverflow.com/users/3261577/wei-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1423430858, "creation_date": 1423368235, "last_edit_date": 1495540170, "question_id": 28390434, "link": "https://stackoverflow.com/questions/28390434/traverse-typed-abstract-syntax-tree-in-haskell-compiler", "title": "Traverse typed abstract syntax tree in Haskell Compiler", "body": "<p>I'm trying to dump type information of all identifiers in an Haskell project, basically it's the same as traversing the typed abstract syntax tree. </p>\n\n<p>From <a href=\"https://stackoverflow.com/questions/28389568/how-to-traverse-typed-abstract-syntax-tree-in-ocaml-compiler\">another question</a>, OCaml exposes its internal APIs through a library called <code>compiler-libs</code>. I'm wondering how is Haskell's support for similar task?  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1423368828, "post_id": 28389859, "comment_id": 45118344, "body": "I happen to know there are heaps to be found in L.C. Paulson&#39;s <i>ML for the Working Programmer</i>, including a version of the binary heaps you&#39;re talking about. If you want to learn more about heaps in functional programming, I suggest you read <i>Purely Functional Data Structures</i>, by Chris Okasaki. He covers leftist heaps, splay heaps, binomial heaps, skew binomial heaps, and bootstrapped heaps (Brodal-Okasaki heaps)."}], "answers": [{"comments": [{"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 0, "creation_date": 1423364229, "post_id": 28390015, "comment_id": 45117534, "body": "I am trying to build the function, if you could provide some hints to guide me i would appreciate very much !"}], "tags": [], "owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "is_accepted": false, "score": 1, "last_activity_date": 1423363421, "creation_date": 1423363421, "answer_id": 28390015, "question_id": 28389859, "link": "https://stackoverflow.com/questions/28389859/remove-root-element-from-a-heap-tree/28390015#28390015", "title": "Remove root element from a heap tree", "body": "<p>You should build an appropriate function to build new tree, but don't worry- it will not perform poorly. GHC can optimize such use cases and this operation could be just as fast as you want (including large, even infinite (recursive) data structures).</p>\n\n<p>I understand you are able to create such auxiliary function by yourself? It is straightforward - anyway, in case of troubles I can write it later.</p>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 4, "last_activity_date": 1423366193, "last_edit_date": 1423366193, "creation_date": 1423365404, "answer_id": 28390192, "question_id": 28389859, "link": "https://stackoverflow.com/questions/28389859/remove-root-element-from-a-heap-tree/28390192#28390192", "title": "Remove root element from a heap tree", "body": "<p>Your type, as written, raises some questions:</p>\n\n<ul>\n<li><p>Q: What's the output from <code>removeMin Empty</code>? </p>\n\n<p>A: You can't produce an <code>a</code> from nothing, so the result should be wrapped in <code>Maybe</code>.</p></li>\n<li><p>Q: If I've put <code>(+)</code>, <code>(-)</code> and <code>(*)</code> in a <code>Heap (Int -&gt; Int -&gt; Int)</code>, which one should be returned by <code>removeMin</code>? </p>\n\n<p>A: Not all data types have an ordering (notably, functions lack one), so it makes sense to require that the data type have an <code>Ord</code> instance.</p></li>\n</ul>\n\n<p>So the updated type becomes:</p>\n\n<pre><code>removeMin :: Ord a =&gt; Heap a -&gt; Maybe (a, Heap a)\n</code></pre>\n\n<p>Now consider it case by case:</p>\n\n<ol>\n<li><p><code>Empty</code> has no min element:</p>\n\n<pre><code>removeMin Empty = Nothing\n</code></pre></li>\n<li><p>If one branch is empty, the remaining heap is the other branch</p>\n\n<pre><code>removeMin (Node a Empty r) = Just (a, r)\nremoveMin (Node a l Empty) = Just (a, l)\n</code></pre>\n\n<p>Convince yourself that this works for <code>Node a Empty Empty</code>.</p></li>\n<li><p>If neither branch is empty, then the new smallest min element must be the root of one of the branches. </p>\n\n<p>The branches in the resulting <code>Heap</code> are just the branch of the larger element, and the branch of the smaller element, with its minimum removed.</p>\n\n<p>Fortunately, we already have a helper to remove the minimum from a <code>Heap</code>!</p>\n\n<pre><code>removeMin (Node a l@(Node la _ _) r@(Node ra _ _)) = Just (a, Node mina maxN minN')\n  where (minN, maxN) = if la &lt;= ra then (l,r) else (r,l)\n        Just (mina, minN') = removeMin minN\n</code></pre></li>\n</ol>\n\n<p>Now, while this produces a valid heap, it's not necessarily the best algorithm because it's not guaranteed to produce a <em>balanced</em> heap.  A poorly balanced heap is no better than a linked list, giving you <code>O(n)</code> insertion and deletion times where a balanced heap can give you <code>O(log n)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 1, "last_activity_date": 1423389392, "creation_date": 1423389392, "answer_id": 28392653, "question_id": 28389859, "link": "https://stackoverflow.com/questions/28389859/remove-root-element-from-a-heap-tree/28392653#28392653", "title": "Remove root element from a heap tree", "body": "<p>Think of it this way: After removing the top node, you're left with two heaps. So you need to implement (recursive) <em>merging</em> of two heaps, something like </p>\n\n<pre><code>merge :: (Ord a) =&gt; Heap a -&gt; Heap a -&gt; Heap a\n</code></pre>\n\n<p>You could also implement a monoid instance for <code>Heap</code></p>\n\n<pre><code>instance (Ord a) =&gt; Monoid (Heap a) where\n    mempty = Empty\n    mappend = -- the merging function\n</code></pre>\n"}], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1423389392, "creation_date": 1423361852, "last_edit_date": 1423362944, "question_id": 28389859, "link": "https://stackoverflow.com/questions/28389859/remove-root-element-from-a-heap-tree", "title": "Remove root element from a heap tree", "body": "<p>How do I remove the smallest element of an heap tree?</p>\n\n<p>This element is at the root of the tree. If I remove that, I'm left with two independent subtrees.</p>\n\n<pre><code>data Heap a = Empty\n            | Node a (Heap a) (Heap a)\n</code></pre>\n\n<p>The type of the function is:</p>\n\n<pre><code>removeMin :: Heap a -&gt; (a, Heap a)\n</code></pre>\n\n<p>It should return the tree and the minimum removed. </p>\n\n<p>Should I make an auxiliary function to build a new tree, or is there a faster way to do this?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423389285, "post_id": 28389560, "comment_id": 45122012, "body": "Do you mean <code>rules :: [Rule]</code>, rather than <code>=</code>?"}, {"owner": {"reputation": 9174, "user_id": 64923, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bfab0edbc971a92ada9c0d74bf93cc42?s=128&d=identicon&r=PG", "display_name": "James Davies", "link": "https://stackoverflow.com/users/64923/james-davies"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423393973, "post_id": 28389560, "comment_id": 45123214, "body": "Nope. I meant <code>rules = [rule1, rule2, rule3]</code>. I see my typo - will amend."}], "answers": [{"comments": [{"owner": {"reputation": 9174, "user_id": 64923, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bfab0edbc971a92ada9c0d74bf93cc42?s=128&d=identicon&r=PG", "display_name": "James Davies", "link": "https://stackoverflow.com/users/64923/james-davies"}, "edited": false, "score": 0, "creation_date": 1423563180, "post_id": 28393312, "comment_id": 45189222, "body": "Thanks. I think your assertion is correct - the problem is framed too much based on an existing OO solution. I&#39;m keen to figure a more natural way, so I might pare it back to the underlying problem and see if something more appropriate pops out."}], "tags": [], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "is_accepted": true, "score": 3, "last_activity_date": 1423394319, "creation_date": 1423394319, "answer_id": 28393312, "question_id": 28389560, "link": "https://stackoverflow.com/questions/28389560/pattern-matching-against-typeclass-instances-in-haskell-function/28393312#28393312", "title": "Pattern matching against typeclass instances in Haskell function", "body": "<p>You can do the same thing in Haskell with <code>Data.Typeable</code>.  This is not particularly natural Haskell code, suggesting you might have a very deep <a href=\"http://www.perlmonks.org/?node=XY+Problem\" rel=\"nofollow\">XY Problem</a> in disguise[1], but it is a close translation of your Scala code.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.Typeable (Typeable, gcast)\nimport Control.Applicative ((&lt;|&gt;), empty, Alternative)\nimport Data.Maybe (fromMaybe)\n\n-- The Schema typeclass doesn't require any functionality above and\n-- beyond Typeable, but we probably want users to be required to\n-- implement for explicitness.\nclass Typeable a =&gt; Schema a where\n\n-- A changeset contains an existentially quantified list, i.e. a [t]\n-- for some t in the Schema typeclass\ndata Changeset = forall t. Schema t =&gt; Insert [t]\n               | forall t. Schema t =&gt; Update [t]\n               | forall t. Schema t =&gt; Delete [t]\n\ndata Contact = Contact  { firstName :: String\n                        , lastName  :: String }\n               deriving Typeable\ninstance Schema Contact where\n\ndata Account = Account { name :: String }\n               deriving Typeable\ninstance Schema Account where\n\n-- We somehow have to let the type inferer know the type of the match,\n-- either with an explicit type signature (which here requires\n-- ScopedTypeVariables) or by using the value of the match in a way\n-- which fixes the type.\n--\n-- You can fill your desired body here.\nupdateContactCount :: Changeset -&gt; IO ()\nupdateContactCount c = choiceIO $ case c of\n  Insert xs -&gt; [ match xs (\\(_ :: [Contact]) -&gt;\n                                putStrLn \"It was an insert contacts\")\n               , match xs (\\(_ :: [Account]) -&gt;\n                                putStrLn \"It was an insert accounts\") ]\n  Delete xs -&gt; [ match xs (\\(_ :: [Contact]) -&gt;\n                                putStrLn \"It was a delete contacts\") ]\n  _         -&gt; []\n\nmain :: IO ()\nmain = mapM_ updateContactCount [ Insert [Contact \"Foo\" \"Bar\"]\n                                , Insert [Account \"Baz\"]\n                                , Delete [Contact \"Quux\" \"Norf\"]\n                                , Delete [Account \"This one ignored\"]\n                                ]\n</code></pre>\n\n<p>It requires these helper combinators.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>choice :: Alternative f =&gt; [f a] -&gt; f a\nchoice = foldr (&lt;|&gt;) empty\n\nmaybeIO :: Maybe (IO ()) -&gt; IO ()\nmaybeIO = fromMaybe (return ()) \n\nchoiceIO :: [Maybe (IO ())] -&gt; IO ()\nchoiceIO = maybeIO . choice\n\nmatch :: (Typeable a1, Typeable a) =&gt; [a1] -&gt; ([a] -&gt; b) -&gt; Maybe b\nmatch xs = flip fmap (gcast xs)\n</code></pre>\n\n<p>The result is</p>\n\n<pre><code>ghci&gt; main\nIt was an insert contacts\nIt was an insert accounts\nIt was a delete contacts\n</code></pre>\n\n<p>[1] This is me being opinionated.  I don't like the Scala approach of \"open types\" here, largely because types are not first class.  This is just an attempt to twist them to become more first class.</p>\n"}], "owner": {"reputation": 9174, "user_id": 64923, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bfab0edbc971a92ada9c0d74bf93cc42?s=128&d=identicon&r=PG", "display_name": "James Davies", "link": "https://stackoverflow.com/users/64923/james-davies"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "accepted_answer_id": 28393312, "answer_count": 1, "score": 4, "last_activity_date": 1423394319, "creation_date": 1423358731, "last_edit_date": 1423393995, "question_id": 28389560, "link": "https://stackoverflow.com/questions/28389560/pattern-matching-against-typeclass-instances-in-haskell-function", "title": "Pattern matching against typeclass instances in Haskell function", "body": "<p>I'm attempting to write a data-processing module in Haskell that accepts <code>changesets</code> relating to different schemas, and passes these through a series of rules that optionally perform actions based on the data. (This is mostly an academic exercise to get a better understanding of Haskell) </p>\n\n<p>To better explain what I'm doing, here's a working example in Scala</p>\n\n<pre class=\"lang-scala prettyprint-override\"><code>// We have an open type allowing us to define arbitrary 'Schemas' \n// in other packages.\ntrait Schema[T]\n\n// Represents a changeset in response to user action - i.e. inserting some records into a database.\nsealed trait Changeset[T]\ncase class Insert[T]( schema:Schema[T], records:Seq[T]) extends Changeset[T]\ncase class Update[T]( schema:Schema[T], records:Seq[T]) extends Changeset[T]\ncase class Delete[T]( schema:Schema[T], records:Seq[T]) extends Changeset[T]\n\n\n// Define a 'contacts' module containing a custom schema. \npackage contacts {\n    object Contacts extends Schema[Contact]\n    case class Contact( firstName:String, lastName:String )   \n}\n\n// And an 'accounts' module\npackage accounts {\n    object Accounts extends Schema[Account]\n    case class Account( name:String )\n}\n\n\n// We now define an arbitrary number of rules that each\n// changeset will be checked against\ntrait Rule {\n    def process( changeset: Changeset[_] ):Unit\n}\n\n// As a contrived example, this rule keeps track of the \n// number of contacts on an account\nobject UpdateContactCount extends Rule {\n    // To keep it simple let's pretend we're doing IO directly here\n    def process( changeset: Changeset[_] ):Unit = changeset match {\n\n        // Type inference correctly infers the type of `xs` here.\n        case Insert( Contacts, xs ) =&gt; ??? // Increment the count\n        case Delete( Contacts, xs ) =&gt; ??? // Decrement the count\n        case Insert( Accounts, xs ) =&gt; ??? // Initialize to zero\n        case _ =&gt; () // Don't worry about other cases \n    }\n}\n\nval rules = [UpdateContactCount, AnotherRule, SomethingElse]\n</code></pre>\n\n<p>The important thing is that both 'Schema' and 'Rule' are open for extension, and this part specifically is throwing a bit of a curveball in my attempt at doing this in Haskell. </p>\n\n<p>What I have so far in Haskell is</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs #-}\n\n-- In this example, Schema is not open for extension.\n-- I'd like it to be    \ndata Schema t where\n    Accounts :: Schema Account\n    Contacts :: Schema Contact\n\ndata Account = Account { name :: String } deriving Show\ndata Contact = Contact { firstName :: String, lastName :: String } deriving Show\n\ndata Changeset t = Insert (Schema t) [t]                             \n                 | Update (Schema t) [t]\n                 | Delete (Schema t) [t]\n\n\n\n-- Whenever a contact is inserted or deleted, update the counter\n-- on the account. (Or, for new accounts, set to zero)\n-- For simplicity let's pretend we're doing IO directly here.\nupdateContactCount :: Changeset t -&gt; IO ()\nupdateContactCount (Insert Contacts contacts) = ???\nupdateContactCount (Delete Contacts contacts) = ???\nupdateContactCount (Insert Accounts accounts) = ???\nupdateContactCount other = return ()\n</code></pre>\n\n<p>This example works fine - but I'd like to expand on this such that both <code>Schema</code> can be an open type (i.e. I don't know all the possibilities ahead of time), while also doing the same thing for the rules. i.e. I don't know about the <code>updateContactCount</code> function head of time, I'm simply passed a list of type <code>[Rule]</code>. i.e. something like.</p>\n\n<pre><code>type Rule = Changeset -&gt; IO ()\nrules = [rule1, rule2, rule3]\n</code></pre>\n\n<p>My first attempt was by creating a <code>Schema</code> typeclass instead, however Haskell still insists on locking down the function to a single type. Data kinds appears to have the same restriction.</p>\n\n<p>From this, I really have two specific questions.</p>\n\n<ol>\n<li><p>Is it possible to create a function that can pattern match against an open type, like we can in Scala?</p></li>\n<li><p>Is there a more elegant idiomatic way of handling the above scenario in Haskell?</p></li>\n</ol>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423358905, "post_id": 28389327, "comment_id": 45116601, "body": "Read the two lines (see any tutorial for this), then <code>map read (words secondLine) :: [Int]</code> should do (if you want better error handling on invalid input than crashing the program, switch to <code>reads</code> or other total functions instead)."}], "answers": [{"tags": [], "owner": {"reputation": 2169, "user_id": 629191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2927ca5ec0a0a4f21bdbc911d88dc146?s=128&d=identicon&r=PG", "display_name": "Rafael Almeida", "link": "https://stackoverflow.com/users/629191/rafael-almeida"}, "is_accepted": true, "score": 2, "last_activity_date": 1423360170, "creation_date": 1423360170, "answer_id": 28389690, "question_id": 28389327, "link": "https://stackoverflow.com/questions/28389327/how-do-i-extract-data-from-a-file-in-haskell/28389690#28389690", "title": "How do I extract data from a file in haskell", "body": "<p>Due to laziness, you usually do not worry about reading line by line, getContents is fine. Though, in your case, maybe calling getLine twice is not that bad.</p>\n\n<p>Your code is good (although it doesn't take only X numbers from the list), it's just your type which is not right. This line should get you going:</p>\n\n<pre><code>print (map read (words val2) :: [Int])\n</code></pre>\n\n<p>You will probably want to use val1 as well, like so:</p>\n\n<pre><code>print $ take (read val1) (map read (words val2) :: [Int])\n</code></pre>\n"}], "owner": {"reputation": 1059, "user_id": 1395810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/434085debcc69044679269ce84d5dad1?s=128&d=identicon&r=PG", "display_name": "ruby_object", "link": "https://stackoverflow.com/users/1395810/ruby-object"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 28389690, "answer_count": 1, "score": 1, "last_activity_date": 1423366865, "creation_date": 1423356664, "last_edit_date": 1423366865, "question_id": 28389327, "link": "https://stackoverflow.com/questions/28389327/how-do-i-extract-data-from-a-file-in-haskell", "title": "How do I extract data from a file in haskell", "body": "<p>I need to open a file, read the first line, convert the number to an Integer X, and read an array of X integers from the second line. Can it be done in Haskell?</p>\n\n<p>The following code:</p>\n\n<pre><code>main = do\n  val1 &lt;- getLine\n  val2 &lt;- getLine\n  print val1\n  print map read (words val2) :: Int\n</code></pre>\n\n<p>Gives this error:</p>\n\n<pre><code>Couldn't match expected type `(String -&gt; a1) -&gt; [String] -&gt; Int'\n            with actual type `IO ()'\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423356067, "post_id": 28389016, "comment_id": 45116026, "body": "This seems a bit unclear to me. Are you trying to traverse the whole tree to find someone&#39;s name, so you can then find their grandfathers?"}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423356337, "post_id": 28389016, "comment_id": 45116074, "body": "I need to find the grandfathers of a given name, for now, i think i can find one of the grandfathers. i know that the grandfather is always 2 levels above, that is why i use the Int 0, to search bellow that level."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1423356467, "post_id": 28389016, "comment_id": 45116106, "body": "I highly recommend that you write two completely separate functions: one to find the node in the tree corresponding to a specific name and one to find the grandfathers of a certain node. Then put the two of them together later to find the grandfathers of the person with a certain name."}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423360094, "post_id": 28389016, "comment_id": 45116811, "body": "Thanks for the insight man ;)"}], "answers": [{"tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": false, "score": 1, "last_activity_date": 1423469633, "last_edit_date": 1423469633, "creation_date": 1423404674, "answer_id": 28394874, "question_id": 28389016, "link": "https://stackoverflow.com/questions/28389016/how-to-go-up-on-a-tree-in-haskell/28394874#28394874", "title": "How to go up on a tree in haskell?", "body": "<p>A good way to go about solving this problem is to decompose it into two functions. One of the functions will search the tree for zero or more matches against a name and return zero or more trees, starting from the place where the match occurred; the root of each tree will be the person that matches the name. The other function will simply take a tree and return zero, one, two, three or four names corresponding to the grandparents of the person at the root of the tree.</p>\n\n<p>The types of the first function is easy:</p>\n\n<pre><code>searchPerson :: Name -&gt; GT -&gt; [GT]\n</code></pre>\n\n<p>The type of the second function is also straightforward</p>\n\n<pre><code>getGrandparents :: GT -&gt; [Name]\n</code></pre>\n\n<p>Now, since the first function returns a list of <code>GT</code>, rather than a single <code>GT</code>, the second function should be mapped over the results of the first function (or, said other way, lifted to operate on lists of <code>GT</code>):</p>\n\n<pre><code>map getGrandparents (searchPerson x myGenTree)\n</code></pre>\n\n<p>Writing the second function (<code>getGrandParents</code>) is trivial and can be achieved with pattern matching, deconstructing the GT type up to the second level of nesting, but you would probably like to save yourself some typing and create a helper function to operate on each parent and return their parents.</p>\n\n<p>The first function (<code>searchPerson</code>) is also trivial, and can be done in a couple of ways. One way is to simply use recursion looking for a match on a name and returning a list of all the subtrees that had a match. The other option is to simply return a list of every possible subtree in that tree, starting from any possible offset, and to use a filter to only keep those subtrees whose root is a match. The second option is more \"wholesome\" and equivalent to addressing a similar problem in lists (the function that returns all sublists is tails) so would probably appeal to some people more. You may think that the second approach is wasteful, but Haskell immutability and lazyness should make it pretty efficient too.</p>\n\n<p>I quickly put together the code in my fpcomplete account and will gladly post the URL in a comment below if you ask, but I don't want to spoil the fun of coming up with the solution on your own.</p>\n"}], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1423469633, "creation_date": 1423354025, "last_edit_date": 1592644375, "question_id": 28389016, "link": "https://stackoverflow.com/questions/28389016/how-to-go-up-on-a-tree-in-haskell", "title": "How to go up on a tree in haskell?", "body": "<p>Maybe the question is not suiting the topic i am going to approach</p>\n<p>But i will try to explain the best i can:</p>\n<p>I have a genealogical tree that has this structure:</p>\n<pre><code>data GT = Person Name Father Mother\n        | unknown\n     type Father  = GT\n     type Mother  = GT\n     type Name    = String\n</code></pre>\n<p>I need to find out the grandfathers of a given name:</p>\n<p>grandfathers :: Name -&gt; GT -&gt; [Name]</p>\n<p>this is the best i could do:</p>\n<pre><code>grandfathers :: Name -&gt; GT -&gt; [Name]\ngrandfathers s (Person x f m) = if (searchgrandson s f 0) then [x] else (grandfathers s f)\n                    where\n                       searchgrandson s unknown k = False\n                       searchgrandson s (Person x f m) k = if s==x &amp;&amp; k&lt;2 then True\n                                                                       else searchgrandson s f (k+1)\n</code></pre>\n<p>of course that for this tree it works, because my code goes all the way through the left side, ignoring the mother side, and giving only the grandfather, and not the grandmother right?</p>\n<blockquote>\n<p>$grandfathers &quot;grandson&quot; (Person &quot;grandpa&quot; (Person &quot;son&quot; (Person &quot;grandson&quot; unknown unknown ) unknown ) unknown )</p>\n<p>[&quot;grandpa&quot;]</p>\n</blockquote>\n<p>EDIT:</p>\n<p>after following the dfeuer advice:</p>\n<pre><code>avos_ :: Nome -&gt; AG -&gt; Int\navos_ s Desconhecida = 0\navos_ s l@(Pessoa x p m) = encontraneto s l 0\n                       where\n                        encontraneto s Desconhecida k = 0\n                        encontraneto s (Pessoa x p m) k = if s==x then k\n                                                                  else encontraneto s p (k+1) + encontraneto s m (k+1)\n</code></pre>\n<p>This gives me the depth of the tree where the grandson is, searching both sides. After this would be simple...</p>\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "non-exhaustive-patterns"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 2, "creation_date": 1423354360, "post_id": 28389008, "comment_id": 45115681, "body": "Look at the comparisons carefully. Which branch should it go down when it gets called with <code>[2, 1]</code>?"}, {"owner": {"reputation": 199, "user_id": 2923447, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/baaf431fa05a9bd2346799f3fc910a75?s=128&d=identicon&r=PG&f=1", "display_name": "deadfire19", "link": "https://stackoverflow.com/users/2923447/deadfire19"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1423354690, "post_id": 28389008, "comment_id": 45115750, "body": "@David I would have thought it would go down ascending [x, y] with x = 2 and y = 1..... And then it clicked.... I feel like an idiot. Well now I know that &#39;non-exhaustive&#39; also includes guards. Thanks!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423358730, "post_id": 28389008, "comment_id": 45116555, "body": "GHC should warn about this statically, if you enable warnings. Very roughly, if the last guard is not <code>otherwise</code>  or <code>True</code>, then the case branch is considered not exhaustive, and unless there&#39;s another branch below catching the potentially non-matched terms, it will trigger the warning. IMO, I&#39;d like this to be a compile-time error (as in Agda, etc.) so to force the programmer to write all the cases, even if some of them are simply <code>undefined</code>."}], "answers": [{"comments": [{"owner": {"reputation": 199, "user_id": 2923447, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/baaf431fa05a9bd2346799f3fc910a75?s=128&d=identicon&r=PG&f=1", "display_name": "deadfire19", "link": "https://stackoverflow.com/users/2923447/deadfire19"}, "edited": false, "score": 1, "creation_date": 1423356475, "post_id": 28389187, "comment_id": 45116111, "body": "A very comprehensive answer. Thank you."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 199, "user_id": 2923447, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/baaf431fa05a9bd2346799f3fc910a75?s=128&d=identicon&r=PG&f=1", "display_name": "deadfire19", "link": "https://stackoverflow.com/users/2923447/deadfire19"}, "edited": false, "score": 2, "creation_date": 1423369918, "post_id": 28389187, "comment_id": 45118537, "body": "@deadfire19, finally finally, an empty list is <a href=\"https://en.wikipedia.org/wiki/Vacuous_truth\" rel=\"nofollow noreferrer\">vacuously</a> ascending, so there&#39;s no need to make that case an error. <code>ascending [] = True</code> will do just fine. Or you can move the last case to the beginning and then make a second case <code>ascending _ = True</code>."}], "tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 4, "last_activity_date": 1423411132, "last_edit_date": 1495541571, "creation_date": 1423355683, "answer_id": 28389187, "question_id": 28389008, "link": "https://stackoverflow.com/questions/28389008/haskell-non-exhaustive-pattern-checking-if-list-is-ascending/28389187#28389187", "title": "Haskell: Non-exhaustive pattern - Checking if list is ascending", "body": "<p>Have a closer look at the guards for your <code>[x,y]</code> pattern:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ascending [x,y] | y&gt;=x = True\n                | x&lt;y  = False\n</code></pre>\n\n<p>When applied to <code>[2,1]</code>, the first guard is checked and evaluates to <code>False</code> (because 2 >= 1); then, the second guard is checked, but it also evaluates to <code>False</code> (because 1 &lt; 2). Therefore, the next pattern is used (because <code>[2,1]</code> also matched <code>(x:y:ys)</code>), but exactly the same thing happens.  Because this was the last pattern, GHC rightfully screams at you.</p>\n\n<p><strong>The inequalities in your guards are not complementary</strong>. Your third pattern should read</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ascending [x,y] | x &lt;= y = True\n                | x &gt;  y = False\n</code></pre>\n\n<p>or, to leave less room for error,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ascending [x,y] | x &lt;= y    = True\n                | otherwise = False\n</code></pre>\n\n<p>However, there is still much room for improvement. In particular:</p>\n\n<ul>\n<li>The third pattern overlaps with the fourth one.</li>\n<li>Because your function returns a <code>Bool</code>, using guards only to explicitly return a Boolean value is redundant.</li>\n<li>Because, by convention (see <a href=\"https://stackoverflow.com/questions/28389008/haskell-non-exhaustive-pattern-checking-if-list-is-ascending/28389187#comment45118537_28389187\">dfeuer's comment</a>), the empty list is considered to be ascending, you don't need to throw an error upon encountering it (unless you're following your own whimsical convention).</li>\n</ul>\n\n<p>Taking all this into account, you could have simply written</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ascending :: [Int] -&gt; Bool\nascending (x:y:xs) = x &lt;= y &amp;&amp; ascending (y:xs)\nascending _        = True\n</code></pre>\n\n<p>Finally, you can condense the code some more with a combination of <code>and</code> and <code>zipWith</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ascending :: [Int] -&gt; Bool\nascending xs = and $ zipWith (&lt;=) xs (tail xs)\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 2923447, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/baaf431fa05a9bd2346799f3fc910a75?s=128&d=identicon&r=PG&f=1", "display_name": "deadfire19", "link": "https://stackoverflow.com/users/2923447/deadfire19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 871, "favorite_count": 0, "accepted_answer_id": 28389187, "answer_count": 1, "score": 1, "last_activity_date": 1423411132, "creation_date": 1423353902, "question_id": 28389008, "link": "https://stackoverflow.com/questions/28389008/haskell-non-exhaustive-pattern-checking-if-list-is-ascending", "title": "Haskell: Non-exhaustive pattern - Checking if list is ascending", "body": "<p>I have no idea why my function doesn't work. I have gone through all the posts about non-exhaustive functions but my functions fulfills all possible options as far as I can see.</p>\n\n<pre><code>ascending :: [Int] -&gt; Bool\nascending []                = error \"Empty list given\"\nascending [x]               = True\nascending [x,y]     | y&gt;=x  = True\n                    | x&lt;y   = False\nascending (x:y:xs)  | y&gt;=x  = (ascending (y:xs))\n                    | x&lt;y   = False\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>*Main&gt; ascending []\n*** Exception: Empty list given\n*Main&gt; ascending [1]\nTrue\n*Main&gt; ascending [1, 2]\nTrue\n*Main&gt; ascending [2, 1]\n*** Exception: test01.hs:(51,1)-(56,55): Non-exhaustive patterns in function ascending\n</code></pre>\n\n<p>It works for one pair, but not if the pair is not ascending. When I follow my code it should be just returning False.</p>\n"}, {"tags": ["haskell", "types", "deriving", "data-kinds"], "answers": [{"comments": [{"owner": {"reputation": 2052, "user_id": 3949424, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb2f4d411841f6c34bdee2d0769ef96e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramith Jayatilleka", "link": "https://stackoverflow.com/users/3949424/ramith-jayatilleka"}, "edited": false, "score": 1, "creation_date": 1423353802, "post_id": 28388923, "comment_id": 45115553, "body": "Thanks. Are there any docs on AutoDeriveTypeable, besides this (<a href=\"http://hauptwerk.blogspot.com/2012/11/coming-soon-in-ghc-head-poly-kinded.html\" rel=\"nofollow noreferrer\">hauptwerk.blogspot.com/2012/11/&hellip;</a>)? It does fix the boilerplate issue (though for some reason I still need the Typeable derivation on <code>Money</code>).  As for putting the Typeable constraint on <code>Money</code>, I tried that myself earlier and now, and it doesn&#39;t let findRate infer that. Does it work for you?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 2052, "user_id": 3949424, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb2f4d411841f6c34bdee2d0769ef96e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramith Jayatilleka", "link": "https://stackoverflow.com/users/3949424/ramith-jayatilleka"}, "edited": false, "score": 1, "creation_date": 1423354677, "post_id": 28388923, "comment_id": 45115747, "body": "@RamithJayatilleka The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/deriving.html#auto-derive-typeable\" rel=\"nofollow noreferrer\">official GHC docs</a> are there, but that is just one paragraph. Oh, I <i>don&#39;t</i> need the <code>derive Typeable</code> on <code>Money</code>, this with GHC 7.8.3. Note how I changed the code of <code>findRate</code> slightly; the pattern match with <code>Money _</code> is what brings the <code>Typeable</code> instance into scope."}, {"owner": {"reputation": 2052, "user_id": 3949424, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb2f4d411841f6c34bdee2d0769ef96e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramith Jayatilleka", "link": "https://stackoverflow.com/users/3949424/ramith-jayatilleka"}, "edited": false, "score": 0, "creation_date": 1423355725, "post_id": 28388923, "comment_id": 45115950, "body": "Oh I see. That makes more sense. Unfortunately, that end&#39;s up worse for me because I can&#39;t do <code>undefined :: Money a</code> like that. I&#39;d have to do <code>Money (undefined :: a)</code> instead (or would that even work?), and I&#39;d rather just put the Typeable constraint on. I think."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 2052, "user_id": 3949424, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb2f4d411841f6c34bdee2d0769ef96e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramith Jayatilleka", "link": "https://stackoverflow.com/users/3949424/ramith-jayatilleka"}, "edited": false, "score": 1, "creation_date": 1423355881, "post_id": 28388923, "comment_id": 45115974, "body": "@RamithJayatilleka I think <code>Money undefined :: Money a</code> would work, but you&#39;re right it&#39;s not any better than putting on <code>Typeable</code> at that point."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1423356376, "post_id": 28388923, "comment_id": 45116086, "body": "Adding that <code>Typeable</code> context to the GADT will also add a dictionary to each <code>Money</code>, which has a performance cost."}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 4, "last_activity_date": 1423354830, "last_edit_date": 1423354830, "creation_date": 1423353125, "answer_id": 28388923, "question_id": 28388747, "link": "https://stackoverflow.com/questions/28388747/how-can-i-automatically-derive-typeable-instance-for-datakinds-derived-types/28388923#28388923", "title": "How can I automatically derive Typeable instance for DataKinds derived types?", "body": "<p>Yes, you can use the <code>AutoDeriveTypeable</code> extension.</p>\n\n<p>For the other part, the closest thing I could think of was to put <code>Typeable c =&gt;</code> inside the GADT definition as follows:</p>\n\n<pre><code>{-# LANGUAGE AutoDeriveTypeable #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n\nimport Data.Typeable\nimport qualified Data.Map as M\n\ntype Rates = M.Map TypeRep Double\n\ndata Currency = USD | EUR\n              deriving (Show, Typeable)\n\ndata Money :: Currency -&gt; * where\n  Money :: Typeable c =&gt; Int -&gt; Money c\n\ninstance Show (Money c) where\n    show (Money n) = \"Money \" ++ show n\n\nfindRate :: Money a -&gt; Rates -&gt; Maybe Double\nfindRate a@(Money _) = M.lookup (typeOf a)\n</code></pre>\n\n<p>Note though:</p>\n\n<ul>\n<li>By the nature of GADTs, this requires actually evaluating <code>a</code> to get the <code>Typeable</code> context out of it, which <code>typeOf</code> itself doesn't.</li>\n<li>This seems to ruin the ability to derive <code>Show</code> automatically for the GADT.</li>\n</ul>\n"}], "owner": {"reputation": 2052, "user_id": 3949424, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb2f4d411841f6c34bdee2d0769ef96e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramith Jayatilleka", "link": "https://stackoverflow.com/users/3949424/ramith-jayatilleka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "accepted_answer_id": 28388923, "answer_count": 1, "score": 3, "last_activity_date": 1423354830, "creation_date": 1423351752, "last_edit_date": 1423352404, "question_id": 28388747, "link": "https://stackoverflow.com/questions/28388747/how-can-i-automatically-derive-typeable-instance-for-datakinds-derived-types", "title": "How can I automatically derive Typeable instance for DataKinds derived types?", "body": "<p>I had some types like this:</p>\n\n<pre><code>data Currency = USD | EUR\n              deriving (Show, Typeable)\n\ndata Money :: Currency -&gt; * where\n  Money :: Int -&gt; Money c\n  deriving (Show, Typeable)\n</code></pre>\n\n<p>And I wanted to use <code>typeOf</code> with them in this function:</p>\n\n<pre><code>findRate :: Money a -&gt; Rates -&gt; Maybe Double\nfindRate a = M.lookup (typeOf a)\n</code></pre>\n\n<p>That didn't work, because the type <code>a</code> in findRate didn't have a <code>Typeable</code> instance. So I fixed it by doing this:</p>\n\n<pre><code>deriving instance Typeable USD\nderiving instance Typeable EUR\nfindRate :: (Typeable a) =&gt; Money a -&gt; Rates -&gt; Maybe Double\n</code></pre>\n\n<p>However, that becomes a lot of boilerplate when the number of currencies increase. Is there a way to specify that all types of kind <code>Currency</code> should derive a <code>Typeable</code> instance?</p>\n\n<p>EDIT: Also, a way to make it infer that in <code>Money a</code> the <code>a</code> is <code>Typeable</code> would be nice, so then I don't need to add <code>(Typeable a) =&gt;</code> everywhere. That's minor though.</p>\n"}, {"tags": ["haskell", "gadt", "data-kinds"], "answers": [{"comments": [{"owner": {"reputation": 875, "user_id": 1782119, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/47e848efc84cd8e00e1e334f963374c9?s=128&d=identicon&r=PG", "display_name": "akst", "link": "https://stackoverflow.com/users/1782119/akst"}, "edited": false, "score": 0, "creation_date": 1423353631, "post_id": 28388940, "comment_id": 45115509, "body": "I guess this is a bit better than a multiple constructors for a wrapper types. On a side note would you be able to explain how the PolyKinds extension work or link to a good explanation, I&#39;ve been figure that out as well."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 875, "user_id": 1782119, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/47e848efc84cd8e00e1e334f963374c9?s=128&d=identicon&r=PG", "display_name": "akst", "link": "https://stackoverflow.com/users/1782119/akst"}, "edited": false, "score": 1, "creation_date": 1423354389, "post_id": 28388940, "comment_id": 45115687, "body": "@ABot, the <code>PolyKinds</code> extension just allows you to treat certain types as kinds. You can read <a href=\"http://dreixel.net/research/pdf/ghp.pdf\" rel=\"nofollow noreferrer\">the original paper</a> for details."}, {"owner": {"reputation": 875, "user_id": 1782119, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/47e848efc84cd8e00e1e334f963374c9?s=128&d=identicon&r=PG", "display_name": "akst", "link": "https://stackoverflow.com/users/1782119/akst"}, "edited": false, "score": 0, "creation_date": 1423360137, "post_id": 28388940, "comment_id": 45116820, "body": "Thanks by the way, but unfortunately it&#39;s not exactly what I&#39;m looking for (mentioned at the bottom of my question), but it&#39;s somewhat nicer than what I was thinking, if no one posts an answer with exactly what I&#39;m after in the next few days, I&#39;ll mark this as the answer to my problem."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 875, "user_id": 1782119, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/47e848efc84cd8e00e1e334f963374c9?s=128&d=identicon&r=PG", "display_name": "akst", "link": "https://stackoverflow.com/users/1782119/akst"}, "edited": false, "score": 0, "creation_date": 1423388532, "post_id": 28388940, "comment_id": 45121851, "body": "@ABot, I don&#39;t think there is a better solution. Even in Agda you would use dependent pairs, which represent the same existential quantification. It would be a bit nicer with coercive subtyping, but that&#39;s far away from Haskell. Have you really tried your solution in Idris? If it works, it&#39;s a mystery for me. BTW, I updated the answer a bit."}, {"owner": {"reputation": 875, "user_id": 1782119, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/47e848efc84cd8e00e1e334f963374c9?s=128&d=identicon&r=PG", "display_name": "akst", "link": "https://stackoverflow.com/users/1782119/akst"}, "edited": false, "score": 0, "creation_date": 1423391416, "post_id": 28388940, "comment_id": 45122551, "body": "Well the compiler didn&#39;t complain about the type definition, however I never used the type. I just tried it just then, and it turns out <code>_</code> is just an anonymous type parameter. Looks like you&#39;re right."}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 6, "last_activity_date": 1423380783, "last_edit_date": 1423380783, "creation_date": 1423353279, "answer_id": 28388940, "question_id": 28388715, "link": "https://stackoverflow.com/questions/28388715/list-of-any-datakind-in-gadt/28388940#28388940", "title": "List of any `DataKind` in GADT", "body": "<p>You can use existentials:</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, PolyKinds #-}\n\ndata Exists :: (k -&gt; *) -&gt; * where\n  This :: p x -&gt; Exists p\n\ndata JSExp :: Bool -&gt; * where\n  ...\n  JSArray :: [Exists JSExp] -&gt; JSExp False\n\ntest = let aref = JSReference \"a\"\n       in  JSArray [This aref, This (JSNumber 2), This (JSBool True), This (JSProperty aref \"b\")]\n</code></pre>\n\n<p>Or with some sugar:</p>\n\n<pre><code>infixr 5 !:\n(!:) :: p x -&gt; [Exists p] -&gt; [Exists p]\nx !: xs = This x : xs\n\ntest = let aref = JSReference \"a\"\n       in  JSArray $ aref !: JSNumber 2 !: JSBool True !: JSProperty aref \"b\" !: []\n</code></pre>\n"}], "owner": {"reputation": 875, "user_id": 1782119, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/47e848efc84cd8e00e1e334f963374c9?s=128&d=identicon&r=PG", "display_name": "akst", "link": "https://stackoverflow.com/users/1782119/akst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 1, "accepted_answer_id": 28388940, "answer_count": 1, "score": 1, "last_activity_date": 1423380783, "creation_date": 1423351551, "last_edit_date": 1423354214, "question_id": 28388715, "link": "https://stackoverflow.com/questions/28388715/list-of-any-datakind-in-gadt", "title": "List of any `DataKind` in GADT", "body": "<h2>Disclaimer</h2>\n\n<p>GADTs &amp; DataKinds are unexplored territory for me, so some of the limitations and capabilities of them are unknown to me.</p>\n\n<h1>The Question</h1>\n\n<p>So I'm writing an AST for a JavaScript code emitter, and I've identified one edge case between expressions and that is that they can either be a reference or not. So I've used GADTS and datakinds to type this aspect of JavaScript expression semantics. The ast looks something like this.</p>\n\n<h2>Subset of the expression AST</h2>\n\n<pre><code>-- at the moment I'm just using a bool to identify if the expression \n-- behaves as an reference, but I'll probably change it due to the fact\n-- a bool is pretty vague\n\ndata JSExp :: Bool -&gt; * where\n\n  JSNumber :: Double -&gt; JSExp False\n  JSBool :: Bool -&gt; JSExp False\n\n  JSReference :: Text -&gt; JSExp True\n  JSProperty :: JSExp a -&gt; Text -&gt; JSExp True\n  JSAssign :: JSExp True -&gt; JSExp b -&gt; JSExp b\n</code></pre>\n\n<p>This looks all fine and dandy, because an assignment expression requires the first expression to be a reference like a property expression (<code>\"test\".shadyProperty</code>) or a reference/identifier.</p>\n\n<h2>The problem</h2>\n\n<p>Now I want to add an array literal expression, in JavaScript it shouldn't matter what is in this list so lists like this are legal</p>\n\n<pre><code>[a, 1, true, a.b]\n</code></pre>\n\n<p>In my AST however this is not legal because there are multiple types in the list</p>\n\n<pre><code>data JSExp :: Bool -&gt; * where\n\n  -- ...\n\n  JSArray :: [JSExp ???] -&gt; JSExp False\n\nlet aref = JSReference \"a\"\nin  JSArray [aref, JSNumber 2, JSBool True, JSProp aref \"b\"] \n</code></pre>\n\n<p>What goes in the place of <code>???</code> for the type? A similar problem occurs when I want to build out a constructor for JSObject's and JSFunctionCall's, as these are also expressions.</p>\n\n<h2>Idris's soultion</h2>\n\n<p>In Idris <code>???</code> would look something like this.</p>\n\n<pre><code>data JSExp : Bool -&gt; Type where\n\n  JSArray : List (JSExp _) -&gt; JSExp False\n  JSNumber : Float -&gt; JSExp False\n  JSBool : Bool -&gt; JSExp False\n\n  -- ...\n</code></pre>\n\n<h2>Potenial soultions</h2>\n\n<h3>Wrapping type</h3>\n\n<p>One soultion that isn't like the Idris one, would to have a wrapper type like this</p>\n\n<pre><code>data JSExpWrap = Refs (JSExp True) | NoRef (JSExp False)\n</code></pre>\n\n<p>This would make the api of my library gross and it's not what I'm looking for.</p>\n\n<h1>In Summary</h1>\n\n<p>I'm looking for the equivalent that's found in Idris, and an explanation of the implications of the solution. If there's no equivalent, a solution of the next best thing is what I'm looking for.</p>\n"}, {"tags": ["algorithm", "list", "haskell", "time-complexity"], "comments": [{"owner": {"reputation": 51837, "user_id": 2144669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e7393f439028063515255b63ed94cfd?s=128&d=identicon&r=PG", "display_name": "David Eisenstat", "link": "https://stackoverflow.com/users/2144669/david-eisenstat"}, "edited": false, "score": 5, "creation_date": 1423342030, "post_id": 28387156, "comment_id": 45111888, "body": "A <a href=\"https://www.haskell.org/hoogle/?hoogle=%28a-%3EBool%29-%3E%5Ba%5D-%3E%28%5Ba%5D%2C%5Ba%5D%29\" rel=\"nofollow noreferrer\">hoogle search</a> shows that this function is called <code>partition</code>."}, {"owner": {"reputation": 788, "user_id": 559103, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/861480630ebcb6626912c9f4818d7d5b?s=128&d=identicon&r=PG", "display_name": "j.i.h.", "link": "https://stackoverflow.com/users/559103/j-i-h"}, "reply_to_user": {"reputation": 51837, "user_id": 2144669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e7393f439028063515255b63ed94cfd?s=128&d=identicon&r=PG", "display_name": "David Eisenstat", "link": "https://stackoverflow.com/users/2144669/david-eisenstat"}, "edited": false, "score": 0, "creation_date": 1423342175, "post_id": 28387156, "comment_id": 45111939, "body": "Thanks for the tip, going to find the source and see if it keeps them in order without increasing complexity.  I&#39;m new to Haskell and not used to looking in places except the prelude."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 2, "creation_date": 1423353376, "post_id": 28387156, "comment_id": 45115440, "body": "study <a href=\"http://hackage.haskell.org/package/base-4.7.0.2/docs/src/Data-List.html#partition\" rel=\"nofollow noreferrer\">the source code for <code>partition</code></a>: it effectively adds elements to the end of a list as it is being built (the both of them).  Lazy pattern (the <code>~</code>) allows for infinite list as an input (e.g. <code>take 10 $ fst $ partition odd [1..]</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1423401800, "post_id": 28389375, "comment_id": 45125279, "body": "you could use <code>(yes,no)</code> pattern in your last version, with <code>where</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1423402921, "post_id": 28389375, "comment_id": 45125602, "body": "@WillNess, this is true, although changing the second version to match might be a bit awkward."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 3, "last_activity_date": 1423357037, "creation_date": 1423357037, "answer_id": 28389375, "question_id": 28387156, "link": "https://stackoverflow.com/questions/28387156/reverse-list-order-without-increasing-complexity/28389375#28389375", "title": "Reverse list order without increasing complexity", "body": "<p>As others have said, the function is called <code>partition</code>, and it works something like this</p>\n\n<pre><code>partition :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])\npartition f = foldr (\\x ~(yes,no) -&gt;\n                         if f x\n                         then (x:yes,no)\n                         else (yes,x:no))\n                    ([], [])\n</code></pre>\n\n<p>except that the real version adds an explicit <code>xs</code> parameter, perhaps to help fusion rules work properly. If that funky lazy pattern match makes you nervous, you can write it like this instead:</p>\n\n<pre><code>partition f = foldr (\\x r -&gt;\n                         if f x\n                         then (x:fst r,snd r)\n                         else (fst r,x:snd r))\n                    ([], [])\n</code></pre>\n\n<p>If the <code>foldr</code> seems mysterious to you, you can do it like this:</p>\n\n<pre><code>partition f [] = ([], [])\npartition f (x:xs)\n  | f x       = (x:fst r, snd r)\n  | otherwise = (fst r, x:snd r)\n  where r = partition f xs\n</code></pre>\n"}], "owner": {"reputation": 788, "user_id": 559103, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/861480630ebcb6626912c9f4818d7d5b?s=128&d=identicon&r=PG", "display_name": "j.i.h.", "link": "https://stackoverflow.com/users/559103/j-i-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 28389375, "answer_count": 1, "score": 1, "last_activity_date": 1423357037, "creation_date": 1423341894, "question_id": 28387156, "link": "https://stackoverflow.com/questions/28387156/reverse-list-order-without-increasing-complexity", "title": "Reverse list order without increasing complexity", "body": "<p>I wanted an alternative to <code>filter</code> that would, instead of discarding the false cases, keep them in a separate place.  I came up with the below, but unfortunately it reverses the list.  </p>\n\n<p>Obviously I could append x to ys or zs instead of cons, but this would dramatically increase complexity.</p>\n\n<p>Is there a way to keep it in order without increasing complexity?</p>\n\n<pre><code>splitBy :: (a -&gt; Bool) -&gt; [a] -&gt; ([a],[a])\nsplitBy f xs = splitBy' f xs ([],[])\n            where\n                splitBy' :: (a -&gt; Bool) -&gt; [a] -&gt; ([a],[a]) -&gt; ([a],[a])\n                splitBy' _   []   result  = result\n                splitBy' f (x:xs) (ys,zs) = if f x then splitBy' f xs (x:ys,zs)\n                                                   else splitBy' f xs (ys,x:zs)\n</code></pre>\n"}, {"tags": ["haskell", "emacs", "ghc", "theorem-proving", "ghc-mod"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1423339877, "post_id": 28386749, "comment_id": 45111279, "body": "I&#39;m not sure what the answer is, but I feel like that would have pretty limited utility. In fact, the code you gave is a good example of where Djinn would likely not be very useful (there&#39;s a <i>huge</i> number of inhabitants of that type. For a 64-bit <code>Int</code> size, I believe it would have <code>((2^64)^2)^(2^64)</code> inhabitants if I did my math right). It would mostly be useful for polymorphic types but it doesn&#39;t support type classes and I don&#39;t think it&#39;s been updated in a while."}, {"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1423340163, "post_id": 28386749, "comment_id": 45111367, "body": "Yeah, the example I gave wasn&#39;t meant to be practical, more just a syntactic example."}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 2, "last_activity_date": 1423341410, "creation_date": 1423341410, "answer_id": 28387071, "question_id": 28386749, "link": "https://stackoverflow.com/questions/28386749/is-there-a-way-to-use-djinn-to-auto-generate-haskell-code-in-emacs/28387071#28387071", "title": "Is there a way to use Djinn to auto-generate Haskell code in Emacs?", "body": "<p>Quoting the relevant part of Serras <a href=\"https://github.com/serras/emacs-haskell-tutorial/blob/master/tutorial.md#working-with-holes\" rel=\"nofollow\">emacs guide</a>:</p>\n\n<blockquote>\n  <p>This is nice, but in some cases ghc-mod can do even more for you: it\n  can write your whole expression! It does so by leveraging the power of\n  Djinn. For example, let's go back to the definition of maybeMap after\n  splitting:</p>\n  \n  <p>maybeMap Nothing  f = _maybeMap_body </p>\n  \n  <p>maybeMap (Just x) f = _maybeMap_body</p>\n  \n  <p>If you press C-c C-a in each of the holes, several options for the\n  code to be written there will be shown, including Nothing in the first\n  case, and Nothing and Just x in the second case. You just need to\n  select the code you want to include from a list, and it will be\n  automatically completed. Note that this functionality becomes very\n  handy when you need to work with expressions involving currying and\n  tupling, because it takes care of obtaining a correctly-typed\n  expression for you.</p>\n</blockquote>\n\n<p>So, yes using Djinn you can write whole expressions in some cases. I haven't personally used them but it seems to be possible in Emacs.</p>\n"}], "owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 28387071, "answer_count": 1, "score": 4, "last_activity_date": 1423341410, "creation_date": 1423339478, "question_id": 28386749, "link": "https://stackoverflow.com/questions/28386749/is-there-a-way-to-use-djinn-to-auto-generate-haskell-code-in-emacs", "title": "Is there a way to use Djinn to auto-generate Haskell code in Emacs?", "body": "<p>Title pretty much says it all. I'm looking for something like this:</p>\n\n<pre><code>f :: Int -&gt; Bool -&gt; Int\nf = _body\n</code></pre>\n\n<p>Djinn can use theorem proving to generate code for such a function by proving that the type is inhabited.</p>\n\n<p>I'm wondering, is there an existing way to get this functionality from within Emacs? So instead of writing TemplateHaskell in my code, I just run a command on my code and it inserts the generated code? </p>\n\n<p>I have ghc-mod installed, but I'm not very familiar with it.</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 1008, "user_id": 1470114, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/0c64f5404b8787a038e8f6fa9522224d?s=128&d=identicon&r=PG", "display_name": "katychuang", "link": "https://stackoverflow.com/users/1470114/katychuang"}, "is_accepted": false, "score": 1, "last_activity_date": 1425075140, "last_edit_date": 1425075140, "creation_date": 1423337504, "answer_id": 28386420, "question_id": 28386419, "link": "https://stackoverflow.com/questions/28386419/cabal-build-error-sh-inappropriate-type-ghc7-8-3-cabal-1-22-osx10-10-yosemite/28386420#28386420", "title": "Cabal build error sh: &#39;inappropriate type&#39; ghc7.8.3 Cabal-1.22 OSX10.10 Yosemite", "body": "<p>Double check your <code>$PATH</code> settings. Removing ghc at the end of GHC_HOME worked for me. Here's what I ended up with. </p>\n\n<pre><code>export GHC_HOME=/usr/local/bin\nexport CABAL_HOME=$HOME/.cabal/\nexport PATH=$GHC_HOME:$CABAL_HOME/bin:${PATH}\n</code></pre>\n\n<p>Note: you may have to explicitly write out the path for <code>$HOME</code>, i.e. <code>CABAL_HOME=/Users/yourname/.cabal/</code> In case you were wondering about quotes - they're only required if your directory has a space.</p>\n\n<p>Reference: network <a href=\"https://github.com/haskell/network/issues/146\" rel=\"nofollow\">#146</a>, ghcjs <a href=\"https://github.com/ghcjs/ghcjs/issues/143#issuecomment-55239767\" rel=\"nofollow\">#143</a></p>\n"}], "owner": {"reputation": 1008, "user_id": 1470114, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/0c64f5404b8787a038e8f6fa9522224d?s=128&d=identicon&r=PG", "display_name": "katychuang", "link": "https://stackoverflow.com/users/1470114/katychuang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1425075140, "creation_date": 1423337504, "question_id": 28386419, "link": "https://stackoverflow.com/questions/28386419/cabal-build-error-sh-inappropriate-type-ghc7-8-3-cabal-1-22-osx10-10-yosemite", "title": "Cabal build error sh: &#39;inappropriate type&#39; ghc7.8.3 Cabal-1.22 OSX10.10 Yosemite", "body": "<p>Cannot install network-2.6.0.2, and the log says it's an inappropriate type error.</p>\n\n<p><code>cabal install network</code></p>\n\n<pre><code>setup-Configure-Cabal-1.22.0.0-x86_64-linux-ghc-7.8.3: sh: inappropriate type\n</code></pre>\n\n<p>Version Info: <em>GHC 7.8.3, Cabal 1.22, OSX 10.10</em></p>\n\n<p>My dotfile settings:</p>\n\n<pre><code>export GHC_HOME=/usr/local/bin/ghc\nexport CABAL_HOME=$HOME/.cabal/\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 2444986, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/191fe5f186d853b1ba0470035ae19129?s=128&d=identicon&r=PG", "display_name": "Blezz", "link": "https://stackoverflow.com/users/2444986/blezz"}, "edited": false, "score": 0, "creation_date": 1423339226, "post_id": 28386455, "comment_id": 45111075, "body": "Thx! I was looking for something like that, but I got another problem:  bList :: P.Parser BEncode function doesn&#39;t compile:                        Couldn&#39;t match expected type <code>BEncode&#39; with actual type </code>BStringT&#39;     Expected type: attoparsec-0.11.1.0:Data.Attoparsec.Internal.Types.Parser                      BC.ByteString BEncode       Actual type: Parser BStringT     In the second argument of <code>(&lt;|&gt;)&#39;, namely </code>bString&#39;     In the first argument of <code>(&lt;|&gt;)&#39;, namely </code>bInt &lt;|&gt; bString&#39;, I don&#39;t understand why..."}, {"owner": {"reputation": 303, "user_id": 2444986, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/191fe5f186d853b1ba0470035ae19129?s=128&d=identicon&r=PG", "display_name": "Blezz", "link": "https://stackoverflow.com/users/2444986/blezz"}, "edited": false, "score": 0, "creation_date": 1423339720, "post_id": 28386455, "comment_id": 45111242, "body": "Its the &lt;|&gt; function, it seems bInt&lt;|&gt;bString doesn&#39;t work anymore (inside bList, the same for bencodeParser function)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1423347205, "post_id": 28386455, "comment_id": 45113598, "body": "The first case of <code>BEncode</code> lacks a constructor.  It should be e.g. <code>data BEncode = BString BStringT | ...</code>"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 2, "last_activity_date": 1423337679, "creation_date": 1423337679, "answer_id": 28386455, "question_id": 28386276, "link": "https://stackoverflow.com/questions/28386276/simple-parser-in-haskell/28386455#28386455", "title": "Simple parser in haskell", "body": "<blockquote>\n  <p>BDic data constructor takes (BEncode &lt;- this is key, BEncode ,&lt;- this\n  is value) list. It's too general I would like to limit keys to be only\n  BStrings, is there a way to do this?</p>\n</blockquote>\n\n<p>One way to achieve this is by changing the structure:</p>\n\n<pre><code>data BStringT = BString BC.ByteString deriving (Eq, Show)\n\ndata BEncode =  BStringT\n             | BInt Integer\n             | BList [BEncode]\n             | BDic [(BStringT, BEncode)]  \n               deriving (Eq,Show)\n</code></pre>\n\n<p>This way you can enforce that it will be <code>BStringT</code> in it's first parameter.</p>\n"}], "owner": {"reputation": 303, "user_id": 2444986, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/191fe5f186d853b1ba0470035ae19129?s=128&d=identicon&r=PG", "display_name": "Blezz", "link": "https://stackoverflow.com/users/2444986/blezz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1423337679, "creation_date": 1423336598, "question_id": 28386276, "link": "https://stackoverflow.com/questions/28386276/simple-parser-in-haskell", "title": "Simple parser in haskell", "body": "<p>I try to parse benncoded torrent file (part of my toy project to learn Haskell) into a dedicated structure in Haskell:</p>\n\n<pre><code>import qualified Data.ByteString.Char8 as BC\n\ndata BEncode =  BString BC.ByteString\n         | BInt Integer\n         | BList [BEncode]\n         | BDic [(BEncode, BEncode)]  &lt;-- here is the problem I want to make it BDic [(BString, BEncode)]\n         deriving (Eq,Show) \n</code></pre>\n\n<p>Everything works fine but I would like to make small improvement.<br>\nBDic data constructor takes (BEncode &lt;- this is key, BEncode ,&lt;- this is value) list. It's too general I would like to limit keys to be only BStrings, is there a way to do this?</p>\n\n<p>Here is rest of the parser:</p>\n\n<pre><code>num::P.Parser String             \nnum = many1 digit\n\nbInt::P.Parser BEncode\nbInt = (BInt . read) &lt;$&gt; (char 'i' *&gt; num &lt;* char 'e') \n\nbString :: P.Parser BEncode\nbString = do n &lt;- num\n         _ &lt;- char ':'\n         BString &lt;$&gt; (P.take (read n))\n\nbList :: P.Parser BEncode\nbList = (BList) &lt;$&gt; (char 'l' *&gt; (many1 (bInt &lt;|&gt; bString &lt;|&gt; bList)) &lt;* char 'e')                  \n\n\ndicEntry :: P.Parser (BEncode, BEncode)\ndicEntry = ((,)&lt;$&gt;bString &lt;*&gt; bencodeParser)\n\nbDic :: P.Parser BEncode\nbDic = BDic&lt;$&gt;((char 'd' *&gt; many1 dicEntry &lt;* char 'e'))               \n\nbencodeParser :: P.Parser BEncode\nbencodeParser = bInt &lt;|&gt; bString &lt;|&gt; bList &lt;|&gt; bDic\n</code></pre>\n"}, {"tags": ["haskell", "emacs", "key-bindings", "xmonad", "keyboard-layout"], "comments": [{"owner": {"reputation": 695, "user_id": 3550459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce58ce9306ba75b9d9ade1ce3e01221a?s=128&d=identicon&r=PG&f=1", "display_name": "deshtop", "link": "https://stackoverflow.com/users/3550459/deshtop"}, "edited": false, "score": 0, "creation_date": 1423413553, "post_id": 28386117, "comment_id": 45128887, "body": "Just a short remark: <code>-- bla</code> is for single line comments, <code>{- bla -}</code> for multiline comments."}, {"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "reply_to_user": {"reputation": 695, "user_id": 3550459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce58ce9306ba75b9d9ade1ce3e01221a?s=128&d=identicon&r=PG&f=1", "display_name": "deshtop", "link": "https://stackoverflow.com/users/3550459/deshtop"}, "edited": false, "score": 0, "creation_date": 1423415870, "post_id": 28386117, "comment_id": 45129626, "body": "(: surely, I rarely use multiline comments personally, and here is I&#39;ve tried to force SO frontend to render comment as comment (I&#39;ve expected light gray colour), but it is very stubborn. <code>-- blah</code> is rendered in black color, this brings ambiguity, do you see it (<code>++ ++ -- ++</code>)? fixed now (;"}, {"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "reply_to_user": {"reputation": 695, "user_id": 3550459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce58ce9306ba75b9d9ade1ce3e01221a?s=128&d=identicon&r=PG&f=1", "display_name": "deshtop", "link": "https://stackoverflow.com/users/3550459/deshtop"}, "edited": false, "score": 0, "creation_date": 1423417113, "post_id": 28386117, "comment_id": 45130055, "body": "@deshtop, by the way thank you and <code>mhwombat</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423842064, "post_id": 28386117, "comment_id": 45325458, "body": "You should cut and paste your solution from the question into an answer, in my opinion."}, {"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423937259, "post_id": 28386117, "comment_id": 45354160, "body": "@dfeuer, I&#39;ve never seen that I could edit an answer! Good idea. By the way, there is one caveat in this solution: both <code>rWin</code> and <code>Win+Space</code> key sequences triggers layout change. If you <i>(accidently)</i> pressed <code>rWin</code>, the layout changes; then if you press <code>Win+Space</code> and layout changes again, but XMonad&#39;s bindings (I use Win key as XMonad modifier) does not work, you have to press <code>rWin</code> again to be able use XMonad keys. I&#39;m still trying to figure out what is the best method to change layout. Maybe Xkb plugin should be the solution."}, {"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "edited": false, "score": 0, "creation_date": 1423937738, "post_id": 28386117, "comment_id": 45354322, "body": "Also I&#39;m trying to find almost identical configuration for my keys on macbook and linux machine, so I suppose to change XMonad mod\u2014key to left Ctrl. Idealy I want to know the way to trigger keyboard layout (input method) change only by specified key combination (e.g. Win+Space). It seems there is no such option avail for XkbOption, in this case I prefer not to have any keybinding at Xkb side at all (e.g. configure key binding in XMonad config only)."}], "answers": [{"comments": [{"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "edited": false, "score": 0, "creation_date": 1423342862, "post_id": 28387105, "comment_id": 45112180, "body": "@destop, I&#39;m aware of functions you mentioned above, and I&#39;ve actually come to solution you offering, though was not able to implement it. The piece I&#39;ve  missing is command to spawn, i.e. I don&#39;t know exact command to switch layout in Linux. I&#39;ve tried to spawn <code>setkbdmap</code>, but this is not what I need. Can you point me such command?"}, {"owner": {"reputation": 7575, "user_id": 663299, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f3a117b27e019d6d19b46698a21c8a11?s=128&d=identicon&r=PG", "display_name": "mhwombat", "link": "https://stackoverflow.com/users/663299/mhwombat"}, "edited": false, "score": 0, "creation_date": 1423367032, "post_id": 28387105, "comment_id": 45118030, "body": "I think the command you need is <code>setxkbmap</code>. Check the man pages and experiment at the command line to verify the exact command you want, and then add the spawn command to your xmonad.hs."}, {"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "edited": false, "score": 0, "creation_date": 1423413716, "post_id": 28387105, "comment_id": 45128945, "body": "I&#39;ve added my solution to question body, though it&#39;s work as expected I&#39;ve  found that having single right <code>Win</code> as layout switcher is quite good alternative to any <code>Win</code>+<code>Space</code> combination. Cheers!"}], "tags": [], "owner": {"reputation": 695, "user_id": 3550459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce58ce9306ba75b9d9ade1ce3e01221a?s=128&d=identicon&r=PG&f=1", "display_name": "deshtop", "link": "https://stackoverflow.com/users/3550459/deshtop"}, "is_accepted": true, "score": 1, "last_activity_date": 1423341585, "creation_date": 1423341585, "answer_id": 28387105, "question_id": 28386117, "link": "https://stackoverflow.com/questions/28386117/xmonad-how-to-bind-super-win-key-space-to-keyboard-layout-switch/28387105#28387105", "title": "XMonad: how to bind Super (Win key) + Space to keyboard layout switch?", "body": "<p>All you've got to do is unbind <code>Win-Space</code> (using <code>removeKeys</code>), and create bindings for xmonad-layout switching and keyboard-layout switching (using <code>additionalKeys</code> or <code>additionalKeysP</code>). \n<a href=\"http://xmonad.org/xmonad-docs/xmonad-contrib/XMonad-Util-EZConfig.html\" rel=\"nofollow\">Details and examples in the documentation</a>.\nThe keyboard-layout switching command can be launched by using <code>spawn</code> from the Core library.</p>\n"}, {"tags": [], "owner": {"reputation": 3050, "user_id": 1054423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/fAvA1.jpg?s=128&g=1", "display_name": "bschlueter", "link": "https://stackoverflow.com/users/1054423/bschlueter"}, "is_accepted": false, "score": 2, "last_activity_date": 1516596530, "last_edit_date": 1516596530, "creation_date": 1514186577, "answer_id": 47966573, "question_id": 28386117, "link": "https://stackoverflow.com/questions/28386117/xmonad-how-to-bind-super-win-key-space-to-keyboard-layout-switch/47966573#47966573", "title": "XMonad: how to bind Super (Win key) + Space to keyboard layout switch?", "body": "<p>I was able to accomplish this with a shell (zsh) script saved on my path as <em>cycle-keyboard-layout</em>:</p>\n\n<pre><code>#!/usr/bin/env zsh\n\ntotal_layouts=\"${#@}\"\ncurrent_layout=$(setxkbmap -query | awk '/layout:/{ print $2 }')\ncurrent_index=\"${@[(i)$current_layout]}\"\nnext_index=\"$((current_index % total_layouts + 1))\"\nnext_layout=\"${@[$next_index]}\"\n\nsetxkbmap \"$next_layout\"\n</code></pre>\n\n<p>Then, in my <em>xmonad.hs</em> I include:</p>\n\n<pre><code>import XMonad.Util.CustomKeys (customKeys)\n\naltMask = mod1Mask\n\nmain =\n  xmonad $ defaultConfig\n    { keys = customKeys delkeys inskeys\n    , modMask = mod4Mask\n    }\n\ninskeys :: XConfig l -&gt; [((KeyMask, KeySym), X ())]\ninskeys conf@XConfig {modMask = modMask} =\n  [ -- modMask + alt + space\n  , ((modMask .|. altMask, xK_space),\n        spawn \"cycle-keyboard-layout dvorak us\")\n  ]\n\ndelkeys :: XConfig l -&gt; [(KeyMask, KeySym)]\ndelkeys XConfig {} = []\n</code></pre>\n\n<p>And now <kbd>\u2318</kbd>+<kbd>alt</kbd>+<kbd>spacebar</kbd> (I use <kbd>\u2318</kbd>+<kbd>spacebar</kbd> for other things) switches my layout between dvorak and us qwerty. To use other layouts, just replace <code>dvorak us</code> with a space separated list of layouts which can be set with <code>setxkbmap layout</code>. </p>\n\n<p>My full bare bones <em>xmonad.hs</em> is at <a href=\"https://github.com/schlueter/xmonad-config/blob/master/xmonad.hs\" rel=\"nofollow noreferrer\">https://github.com/schlueter/xmonad-config/blob/master/xmonad.hs</a>.</p>\n"}], "owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2800, "favorite_count": 1, "accepted_answer_id": 28387105, "answer_count": 2, "score": 2, "last_activity_date": 1516596530, "creation_date": 1423335686, "last_edit_date": 1424015354, "question_id": 28386117, "link": "https://stackoverflow.com/questions/28386117/xmonad-how-to-bind-super-win-key-space-to-keyboard-layout-switch", "title": "XMonad: how to bind Super (Win key) + Space to keyboard layout switch?", "body": "<p>I used to switch keyboard layout pressing <kbd>\u2756 win</kbd>+<kbd>spacebar</kbd> on Windows 8, and <kbd>\u2318</kbd>+<kbd>spacebar</kbd> on OS X.  </p>\n\n<p>However, on Linux I have <kbd>\u2756 win</kbd> key dedicated to XMonad as modificator key. So, to switch between layouts I have to use <kbd>alt</kbd>+<kbd>\u21e7 shift</kbd>.  </p>\n\n<p>This was not a problem until I've installed Emacs. Now I'm able to use all <kbd>meta</kbd>+<kbd>shift</kbd> key combinations, because I have <kbd>alt</kbd> as <kbd>meta</kbd> <em>(<kbd>\u238b escape</kbd> could help, but it's very unhandy)</em>.  </p>\n\n<p>I think the easiest workaround for this case is to configure <kbd>\u2756 win</kbd>+<kbd>space</kbd> to layout switch combination. Though XMonad by default use this combination to switching layouts, I rarely cycle layouts in both direction, so I will happy to have <kbd>\u2756 win</kbd>+<kbd>space</kbd> for switching keyboard layout, and <kbd>\u2756 win</kbd>+<kbd>shift</kbd>+<kbd>space</kbd> to switch XMonad layout. If I could make such configuration I will be able to use <kbd>alt</kbd> key as <kbd>meta</kbd> in Emacs.</p>\n\n<p>However, I don't know how to make XMonad to use <kbd>\u2756 win</kbd>+<kbd>space</kbd> as keyboard switch combination, being more preciese I don't know is it even possible.</p>\n"}, {"tags": ["exception", "haskell", "error-handling", "yesod"], "comments": [{"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 1, "creation_date": 1423360848, "post_id": 28385944, "comment_id": 45116958, "body": "I haven&#39;t used it before, but the <a href=\"http://www.yesodweb.com/book/yesod-typeclass#yesod-typeclass_custom_error_pages\" rel=\"nofollow noreferrer\"><code>errorHandler</code></a> function of the Yesod typeclass sounds appropriate, with the <a href=\"https://github.com/yesodweb/yesod/blob/df304d6393a419b308f3f9cde6eb791e6b4a5415/yesod-core/Yesod/Core/Class/Yesod.hs#L475\" rel=\"nofollow noreferrer\"><code>defaultErrorHandler</code></a> providing an example."}], "answers": [{"tags": [], "owner": {"reputation": 894, "user_id": 994643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6a3e2fbf6abc8e31d4ac4223631c425c?s=128&d=identicon&r=PG", "display_name": "chreekat", "link": "https://stackoverflow.com/users/994643/chreekat"}, "is_accepted": false, "score": 0, "last_activity_date": 1469018993, "creation_date": 1469018993, "answer_id": 38481819, "question_id": 28385944, "link": "https://stackoverflow.com/questions/28385944/how-can-i-globally-handle-exceptions-from-all-handlers-in-yesod/38481819#38481819", "title": "How can I globally handle exceptions from all Handlers in Yesod?", "body": "<p>It's likely you can do this by writing custom <code>Middleware</code> and chaining it into your instantiation of <code>yesodMiddleware</code>.</p>\n"}], "owner": {"reputation": 79487, "user_id": 72583, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/16a5eec5eca4550033c0e19dba3b32b8?s=128&d=identicon&r=PG", "display_name": "Jakub Arnold", "link": "https://stackoverflow.com/users/72583/jakub-arnold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1469018993, "creation_date": 1423334632, "last_edit_date": 1423335111, "question_id": 28385944, "link": "https://stackoverflow.com/questions/28385944/how-can-i-globally-handle-exceptions-from-all-handlers-in-yesod", "title": "How can I globally handle exceptions from all Handlers in Yesod?", "body": "<p>I have some shared logic in the <code>defaultLayout</code> which can randomly fail and raise an exception, and I'd like to handle that in a single place, no matter what handler is currently being executed.</p>\n\n<p>Is there a place where any request-related exception could be handled, and possibly still respond back to the user? (a redirect or an error page or something else)</p>\n\n<p><strong>edit</strong>: If at all possible I want to be able to distinguish different exceptions with this, and choose to only handle some and ignore others.</p>\n"}, {"tags": ["haskell", "cabal"], "answers": [{"tags": [], "owner": {"reputation": 1008, "user_id": 1470114, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/0c64f5404b8787a038e8f6fa9522224d?s=128&d=identicon&r=PG", "display_name": "katychuang", "link": "https://stackoverflow.com/users/1470114/katychuang"}, "is_accepted": false, "score": 1, "last_activity_date": 1423334499, "last_edit_date": 1495540230, "creation_date": 1423334499, "answer_id": 28385924, "question_id": 28385923, "link": "https://stackoverflow.com/questions/28385923/cabal-install-error-hmatrix-0-15-2-1-on-osx-10-10-yosemite-ghc-7-8-cabal-1-22/28385924#28385924", "title": "Cabal install error hmatrix-0.15.2.1 on OSX 10.10 Yosemite + GHC 7.8 Cabal-1.22", "body": "<p>I referenced this question <a href=\"https://stackoverflow.com/questions/9541500/cant-install-hmatrix-on-my-ubuntu-linux-machine\">Can't Install hmatrix on my Ubuntu Linux machine</a> for clues on required dependencies. </p>\n\n<p>You can get GSL for OSX via <code>brew install gsl</code></p>\n\n<p>Other libraries you may potentially need from brew:</p>\n\n<pre><code>brew install liblas\nbrew install lapack\n</code></pre>\n"}], "owner": {"reputation": 1008, "user_id": 1470114, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/0c64f5404b8787a038e8f6fa9522224d?s=128&d=identicon&r=PG", "display_name": "katychuang", "link": "https://stackoverflow.com/users/1470114/katychuang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1423337742, "creation_date": 1423334499, "last_edit_date": 1423337742, "question_id": 28385923, "link": "https://stackoverflow.com/questions/28385923/cabal-install-error-hmatrix-0-15-2-1-on-osx-10-10-yosemite-ghc-7-8-cabal-1-22", "title": "Cabal install error hmatrix-0.15.2.1 on OSX 10.10 Yosemite + GHC 7.8 Cabal-1.22", "body": "<p>I'm trying to install hmatrix-0.15.2.1 on OSX 10.10 Yosemite with GHC 7.8.3 and Cabal 1.22. The log gives this error message about the failure:</p>\n\n<pre><code>Checking foreign libraries... FAIL\n   *** Sorry, I can't link GSL.\n   *** Please make sure that the appropriate -dev packages are installed.\n   *** You can also specify the required libraries using\n   *** cabal install hmatrix --configure-option=link:lib1,lib2,lib3,etc.\n</code></pre>\n\n<p>What dependencies are required?</p>\n"}, {"tags": ["haskell", "infinite-loop", "lazy-evaluation", "ghc", "expression-evaluation"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1423329666, "post_id": 28385025, "comment_id": 45107822, "body": "If you get stuck in an infinite evaluation, why would it matter where that happens?"}, {"owner": {"reputation": 69792, "user_id": 493122, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/1f90ae01c2e24801c2df9189179b0ccd?s=128&d=identicon&r=PG", "display_name": "Shoe", "link": "https://stackoverflow.com/users/493122/shoe"}, "edited": false, "score": 1, "creation_date": 1423329745, "post_id": 28385025, "comment_id": 45107851, "body": "I&#39;m not sure I understand the problem. <code>l1</code> and <code>l2</code> and not evaluated lazily in that context."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1423329880, "post_id": 28385025, "comment_id": 45107900, "body": "I&#39;m not sure, I understand your question. Are you saying you have a function that causes an infinite loop and you want to prevent that by changing the evaluation order? If so, that&#39;s not possible. The default evaluation order is already strongly normalizing. If a given piece of code (that doesn&#39;t change the evaluation order using <code>seq</code> or similar constructs) causes an infinite loop, there simply is no evaluation order that would make that code terminate. For example the code in your question can&#39;t possibly terminate."}, {"owner": {"reputation": 1393, "user_id": 2340939, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d9a710d823e382cc7be0a0208f3f126e?s=128&d=identicon&r=PG", "display_name": "user2340939", "link": "https://stackoverflow.com/users/2340939/user2340939"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423330135, "post_id": 28385025, "comment_id": 45107973, "body": "@chi because if I call my function with some specific parameters, eg. bar x y, it works, but if I call it with bar y x I get *** Exception: &lt;&lt;loop&gt;&gt;"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1423330671, "post_id": 28385025, "comment_id": 45108150, "body": "@user2340939 Maybe you should show your function <code>bar</code> then because that&#39;s definitely not true of your function <code>foo</code> - <code>foo</code> will loop no matter what arguments you call it with."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423331363, "post_id": 28385025, "comment_id": 45108433, "body": "@user2340939 In that case, it&#39;s not a matter of evaluation order, but of having something evaluated in one case and not evaluated in another."}, {"owner": {"reputation": 1393, "user_id": 2340939, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d9a710d823e382cc7be0a0208f3f126e?s=128&d=identicon&r=PG", "display_name": "user2340939", "link": "https://stackoverflow.com/users/2340939/user2340939"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423332187, "post_id": 28385025, "comment_id": 45108708, "body": "@chi correct, and I want to evalute l1, then on the next foo call l2, then l1, l2, l1 etc."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423332908, "post_id": 28385025, "comment_id": 45108959, "body": "@user2340939 You can add a boolean parameter to your function and then use <code>if b then doSomethingWith l1 else doSomethingElseWith l2</code>. In each branch you can perform recursive calls toggling the boolean, so to alternate <code>l1</code> with <code>l2</code>."}, {"owner": {"reputation": 1393, "user_id": 2340939, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d9a710d823e382cc7be0a0208f3f126e?s=128&d=identicon&r=PG", "display_name": "user2340939", "link": "https://stackoverflow.com/users/2340939/user2340939"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423333055, "post_id": 28385025, "comment_id": 45109011, "body": "@chi Yea Im trying similar solution right now, but I want to find &quot;a nice/general solution.&quot;."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1423334233, "post_id": 28385025, "comment_id": 45109388, "body": "Voting to close because the code posted and problem asserted do not line up.  Code exists that exhibits your bug (<code>bar</code>) but it is not made available nor does it correlate with <code>foo</code> like you seem to think."}, {"owner": {"reputation": 1483, "user_id": 1308994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0c47efb3b6f309f253b6e8bd038076?s=128&d=identicon&r=PG&f=1", "display_name": "cassandracomar", "link": "https://stackoverflow.com/users/1308994/cassandracomar"}, "edited": false, "score": 1, "creation_date": 1423336879, "post_id": 28385025, "comment_id": 45110302, "body": "There&#39;s something wrong with this question as currently posed. It no longer references a <code>bar</code> as described in previous comments, but instead does some kind of weird recursive call to <code>foo</code>. The problem is <code>foo :: Num a =&gt; [a] -&gt; [a] -&gt; a</code> but <code>l1</code> and <code>l2</code> is call <code>foo</code> with only a single parameter. It&#39;s not at all clear what this question is trying to ask."}], "answers": [{"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423343927, "post_id": 28386158, "comment_id": 45112524, "body": "I don&#39;t have time to develop this all the way into <a href=\"https://hackage.haskell.org/package/logict\" rel=\"nofollow noreferrer\">one of the general solutions</a> this weekend."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 1, "last_activity_date": 1423336886, "last_edit_date": 1423336886, "creation_date": 1423335932, "answer_id": 28386158, "question_id": 28385025, "link": "https://stackoverflow.com/questions/28385025/changing-order-of-expression-evaluation-on-each-function-call-in-haskell/28386158#28386158", "title": "Changing order of expression evaluation on each function call in Haskell", "body": "<h3>The Problem</h3>\n\n<p>For a good answer, we first need a specific question. Consider that natural numbers that are either zero <code>Z</code> or the successor <code>S n</code> of another natural number <code>n</code>.</p>\n\n<pre><code>data Nat = Z | S Nat\n\nzero = Z\none  = S Z\ntwo  = S $ S Z\n</code></pre>\n\n<p>In Haskell we can also write infinite recusive data structures like</p>\n\n<pre><code>infinity = S infinity\n</code></pre>\n\n<p>As long as a single <code>Nat</code> number isn't <code>infinity</code> we can determine if it is even or odd.</p>\n\n<pre><code>even :: Nat -&gt; Bool\neven  Z    = True\neven (S n) = odd n\n\nodd :: Nat -&gt; Bool\nodd  Z    = False\nodd (S n) = even n\n</code></pre>\n\n<p>For finite <code>Nat</code>s, <code>even</code> is either <code>True</code> or <code>False</code> and <code>even infinity</code> is <code>undefined</code>. This is ok, but what if we wanted to check if either of two numbers is <code>even</code>? We can write a na\u00efve implementation: </p>\n\n<pre><code>eitherEven :: Nat -&gt; Nat -&gt; Bool\neitherEven x y = even x || even y\n</code></pre>\n\n<p>This does quite well whenever the first argument is finite. In the following, <code>even</code> is any even number and <code>odd</code> is any odd number.</p>\n\n<pre><code>eitherEven even even     == True\neitherEven even odd      == True\neitherEven even infinity == True\neitherEven odd  even     == True\neitherEven odd  odd      == False\neitherEven odd  infinity == undefined\n</code></pre>\n\n<p>But when the first argument is infinite, it doesn't return <code>True</code> even when the second argument is <code>Even</code></p>\n\n<pre><code>eitherEven infinity even     == undefined -- this should be True\neitherEven infinity odd      == undefined\neitherEven infinity infinity == undefined\n</code></pre>\n\n<h3>A simple solution</h3>\n\n<p>A simple solution to the problem is to alternate between testing the first argument and testing the second argument. When we call the function recursively, we swap the arguments to alternate which of the two arguments is being tested.</p>\n\n<pre><code>eitherEven :: Nat -&gt; Nat -&gt; Bool\neitherEven Z         _ = True\neitherEven (S Z)     y = even y \neitherEven (S (S x)) y = eitherEven y x\n</code></pre>\n\n<p>This has the desired output even when the first argument isn't finite.</p>\n\n<pre><code>&gt; eitherEven infinity two\nTrue\n</code></pre>\n\n<p>For more complicated problems where the arguments aren't treated symmetrically, you can pass a <code>Bool</code> flag and flip it on each step. In general you can use any state machine to keep track of where you are working.</p>\n\n<p>This solution isn't very satisfying because it doesn't immediately solve what to do when we want to test if any of three numbers is even. To do so we need to write a new function.</p>\n\n<pre><code>anyEven3 :: Nat -&gt; Nat -&gt; Nat -&gt; Bool\nanyEven3 Z         _ _ = True\nanyEven3 (S Z)     y z = eitherEven y z\nanyEven3 (S (S x)) y z = anyEven3 y z x\n</code></pre>\n\n<p>We put <code>x</code> at the end because we want to try both <code>y</code> and <code>z</code> before trying <code>x</code> again. We're making a queue. If we can prove that the first thing in the queue produces a result, <code>True</code>, we are done. If we can prove the first thing in the queue doesn't produce a result, we remove it from the queue and use a version that works on a smaller set of inputs. If we can't decide the result for the first thing in the queue, we put it at the end. The same pattern can be seen in <code>eitherEven</code> which takes two arguments and even in <code>even</code> which takes only one argument.</p>\n\n<pre><code>anyEven :: [Nat] -&gt; Bool\nanyEven = go []\n    where\n        go [] [] = False\n        go r  [] = go [] (reverse r)\n        go r (      Z  :_ ) = True\n        go r (    S Z  :ns) = go r     ns\n        go r ((S (S x)):ns) = go (x:r) ns\n</code></pre>\n"}], "owner": {"reputation": 1393, "user_id": 2340939, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/d9a710d823e382cc7be0a0208f3f126e?s=128&d=identicon&r=PG", "display_name": "user2340939", "link": "https://stackoverflow.com/users/2340939/user2340939"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1423337989, "creation_date": 1423329384, "last_edit_date": 1423337989, "question_id": 28385025, "link": "https://stackoverflow.com/questions/28385025/changing-order-of-expression-evaluation-on-each-function-call-in-haskell", "title": "Changing order of expression evaluation on each function call in Haskell", "body": "<p>Suppose I have a following program:</p>\n\n<pre><code>foo x y = let l1 = foo 0 x\n              l2 = foo 0 y\n          in l1 + l2\n</code></pre>\n\n<p>This is just a simple example, but I think is enough for demonstration purposes. How could I, with each new (recursive) call to <strong><em>foo</em></strong>, change the evaluation ordering of the expression in <strong><em>l1</em></strong> and <strong><em>l2</em></strong>? I know they are evaluated lazy inside the expression (in this case expression inside in operator) and not when they are declared, but I need a way of doing as stated, because there may be cases, where the program enters infinite loop. If this infinite recursion occurs on the secondly evaluated argument, <strong><em>l2</em></strong>, there is no problem, as <strong><em>l1</em></strong> always gets evaluated before <strong>*l2</strong>, but if it is the other way around, that is, infinitely evaluating the <strong><em>l1</em></strong> expression, the <strong>*l2***doesn't get a chance to evaluate. So if I could juggle between ***l1*</strong> and <strong><em>l2</em></strong> expression evaluation on each new <strong><em>foo</em></strong> function call, the problem would be solved. Looking for a nice/general solution.</p>\n\n<p>EDIT: Forgot to mantion that <strong><em>x</em></strong> or <strong><em>y</em></strong> or both might be an infinite structures (lists), and thats where the problem is.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 1147, "user_id": 3523379, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d63603cea5cf4e45808eedab6cafae?s=128&d=identicon&r=PG&f=1", "display_name": "stackoverflowuser", "link": "https://stackoverflow.com/users/3523379/stackoverflowuser"}, "edited": false, "score": 0, "creation_date": 1423334596, "post_id": 28384727, "comment_id": 45109502, "body": "You write: &quot;So if we have a Num like 1, it could either be a Fractional (because some Nums are Fractionals) or it could not be.&quot; Okay, but the question is, how do you know that 1 can be a Fractional? This is a legitimate quesiton because you told me that 1 could either be or not be a Fractional. Is what&#39;s going on here some particular magic about Num that Haskell has a special treatment for, or is this something more general about type classes and functions? Please elaborate."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 1147, "user_id": 3523379, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d63603cea5cf4e45808eedab6cafae?s=128&d=identicon&r=PG&f=1", "display_name": "stackoverflowuser", "link": "https://stackoverflow.com/users/3523379/stackoverflowuser"}, "edited": false, "score": 1, "creation_date": 1423335385, "post_id": 28384727, "comment_id": 45109786, "body": "@stackoverflowuser That follows directly from the statement &quot;Every Fractional is a Num&quot;, which we know because <code>Fractional</code> is defined as <code>class Num a =&gt; Fractional a where ...</code>."}, {"owner": {"reputation": 1147, "user_id": 3523379, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d63603cea5cf4e45808eedab6cafae?s=128&d=identicon&r=PG&f=1", "display_name": "stackoverflowuser", "link": "https://stackoverflow.com/users/3523379/stackoverflowuser"}, "edited": false, "score": 0, "creation_date": 1423340799, "post_id": 28384727, "comment_id": 45111551, "body": "That makes no sense to me. &quot;Every Fractional is a Num&quot; tells you that every Fractional is a Num, not that every Num is a Fractional. 1 is Num. I&#39;m really confused now. To put it differently: Suppose I create my own type that is an instance of Num. How could a value of this type become Fractional? By magic? Maybe Haskell is doing some special magic in the case of 1 that wouldn&#39;t apply for a value of my own Num type?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 1147, "user_id": 3523379, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d63603cea5cf4e45808eedab6cafae?s=128&d=identicon&r=PG&f=1", "display_name": "stackoverflowuser", "link": "https://stackoverflow.com/users/3523379/stackoverflowuser"}, "edited": false, "score": 1, "creation_date": 1423341101, "post_id": 28384727, "comment_id": 45111637, "body": "@stackoverflowuser There&#39;s no special magic. And you&#39;re right, not every Num is a fractional. For example if you wrote <code>1 :: Integer</code>, it would not be a Fractional and writing <code>(1 :: Integer) + 1.0</code> would be an error. But since you didn&#39;t specify which type you want <code>1</code> to be, Haskell knows that it can choose whichever type works (as long as the type implements <code>Num</code> of course), which is why <code>1 + 1.0</code> works. I&#39;ll edit my answer to add an example that only involves user-defined type classes, so you can see that no num-specific magic is involved."}, {"owner": {"reputation": 5359, "user_id": 582917, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/98a347823cd1db90af884b227a29c29e?s=128&d=identicon&r=PG", "display_name": "CMCDragonkai", "link": "https://stackoverflow.com/users/582917/cmcdragonkai"}, "edited": false, "score": 0, "creation_date": 1446287870, "post_id": 28384727, "comment_id": 54688153, "body": "When this conversion occurs, is there a change the memory size? Is this conversion hidden in the compiler, or can it seen as haskell code?"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": false, "score": 9, "last_activity_date": 1446288622, "last_edit_date": 1446288622, "creation_date": 1423327640, "answer_id": 28384727, "question_id": 28384685, "link": "https://stackoverflow.com/questions/28384685/why-does-1-1-0-have-the-type-fractional-a-a-and-not-num-a-a/28384727#28384727", "title": "Why does &quot;(1 + 1.0)&quot; have the type &quot;Fractional a =&gt; a&quot; and not &quot;Num a =&gt; a&quot;?", "body": "<p>Every Fractional is a <code>Num</code>, but not every <code>Num</code> is a <code>Fractional</code>. So if we have a <code>Num</code> like <code>1</code>, it could either be a <code>Fractional</code> (because some <code>Num</code>s are <code>Fractional</code>s) or it could not be. However <code>1.0</code> can only be a <code>Fractional</code>, it definitely can't be some other <code>Num</code> like <code>Integer</code>.</p>\n\n<p>So when the compiler sees that you add 1 to a <code>Fractional</code>, it realizes that <code>1</code> must be a <code>Fractional</code> as well in this case - otherwise you'd not be allowed to add it to a <code>Fractional</code>.</p>\n\n<hr>\n\n<p>Here's an example of a similar example that only involves user-defined type classes instead of <code>Num</code>s. Maybe this makes things clearer for you:</p>\n\n<pre><code>class Foo a where\n  foo :: a\n\nclass Foo a =&gt; Bar a where\n  bar :: a\n  combine :: a -&gt; a -&gt; a\n</code></pre>\n\n<p>Through the above type classes we now have the following methods:</p>\n\n<pre><code>foo :: Foo a =&gt; a\nbar :: Bar a =&gt; a\ncombine :: Bar a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>So now let's try to combine <code>foo</code> and <code>bar</code> like this:</p>\n\n<pre><code>combine foo bar\n</code></pre>\n\n<p>This is roughly equivalent to you trying to add <code>1</code> (of type <code>Num a =&gt; a</code>) and <code>1.0</code> (of type <code>Fractional a =&gt; a</code>) in your example. And just like your example, this works fine and has the type <code>Bar a =&gt; a</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1483, "user_id": 1308994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0c47efb3b6f309f253b6e8bd038076?s=128&d=identicon&r=PG&f=1", "display_name": "cassandracomar", "link": "https://stackoverflow.com/users/1308994/cassandracomar"}, "edited": false, "score": 0, "creation_date": 1423337123, "post_id": 28384995, "comment_id": 45110372, "body": "<code>1 :: Num a =&gt; a</code>, so there&#39;s no implicit call to <code>fromInteger 1</code>. The compiler refines the type of <code>1</code> at the call site to <code>Fractional a =&gt; a</code> since <code>(+ 1.0) :: Fractional a =&gt; a -&gt; a</code>."}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 1483, "user_id": 1308994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0c47efb3b6f309f253b6e8bd038076?s=128&d=identicon&r=PG&f=1", "display_name": "cassandracomar", "link": "https://stackoverflow.com/users/1308994/cassandracomar"}, "edited": false, "score": 2, "creation_date": 1423340866, "post_id": 28384995, "comment_id": 45111570, "body": "@acomar There is an implicit call to <code>fromInteger</code>, which is why <code>1</code> can have the type <code>Num a =&gt; a</code>."}, {"owner": {"reputation": 1483, "user_id": 1308994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0c47efb3b6f309f253b6e8bd038076?s=128&d=identicon&r=PG&f=1", "display_name": "cassandracomar", "link": "https://stackoverflow.com/users/1308994/cassandracomar"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1423341699, "post_id": 28384995, "comment_id": 45111798, "body": "@sepp2k: That would imply <code>1 :: Integer</code> or something like it in order to be converted up to a <code>Num a =&gt; a</code>. How would you observe such a thing?"}, {"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "reply_to_user": {"reputation": 1483, "user_id": 1308994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0c47efb3b6f309f253b6e8bd038076?s=128&d=identicon&r=PG&f=1", "display_name": "cassandracomar", "link": "https://stackoverflow.com/users/1308994/cassandracomar"}, "edited": false, "score": 0, "creation_date": 1423342177, "post_id": 28384995, "comment_id": 45111941, "body": "@acomar I didn&#39;t understand what you meant by &quot;something like it&quot; in your first sentence, but you observe <code>fromInteger</code> being called by defining your own type <code>MyNum</code> that implements <code>Num</code>, defining <code>fromInteger</code> is non-sensical way (and/or using Debug.Trace.trace in your <code>fromInteger</code> implementation) and then observing that writing <code>1 :: MyInt</code> does indeed invoke your <code>fromInteger</code> function."}, {"owner": {"reputation": 1483, "user_id": 1308994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0c47efb3b6f309f253b6e8bd038076?s=128&d=identicon&r=PG&f=1", "display_name": "cassandracomar", "link": "https://stackoverflow.com/users/1308994/cassandracomar"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1423342806, "post_id": 28384995, "comment_id": 45112160, "body": "@sepp2k: I meant that <code>1</code> would need to be passed to <code>fromInteger</code> monomorphically at some type. <code>Integer</code> is only one candidate. And thanks for clearing that up."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1483, "user_id": 1308994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0c47efb3b6f309f253b6e8bd038076?s=128&d=identicon&r=PG&f=1", "display_name": "cassandracomar", "link": "https://stackoverflow.com/users/1308994/cassandracomar"}, "edited": false, "score": 0, "creation_date": 1423344574, "post_id": 28384995, "comment_id": 45112734, "body": "@acomar Quoting the Haskell report - 6.4.1: &quot;An integer literal represents the application of the function fromInteger to the appropriate value of type Integer.&quot; This is how the report makes integer literals polymorphic."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1483, "user_id": 1308994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af0c47efb3b6f309f253b6e8bd038076?s=128&d=identicon&r=PG&f=1", "display_name": "cassandracomar", "link": "https://stackoverflow.com/users/1308994/cassandracomar"}, "edited": false, "score": 2, "creation_date": 1423350521, "post_id": 28384995, "comment_id": 45114674, "body": "@acomar: a more correct statement might have been \u201c<code>1</code> technically stands for <code>fromInteger literal1</code>, where <code>literal1 :: Integer</code> has value 1\u201d, instead of \u201c<code>1</code> stands for <code>fromInteger 1</code>\u201d."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1423358138, "last_edit_date": 1423358138, "creation_date": 1423329172, "answer_id": 28384995, "question_id": 28384685, "link": "https://stackoverflow.com/questions/28384685/why-does-1-1-0-have-the-type-fractional-a-a-and-not-num-a-a/28384995#28384995", "title": "Why does &quot;(1 + 1.0)&quot; have the type &quot;Fractional a =&gt; a&quot; and not &quot;Num a =&gt; a&quot;?", "body": "<ul>\n<li>Number <code>1</code> (which technically stands for <code>fromInteger</code> applied to the <code>Integer</code> value <code>1</code>) belongs to all the types in class <code>Num</code>.</li>\n<li>All the types in class <code>Fractional</code> belong to class <code>Num</code> as well. </li>\n</ul>\n\n<p>Ergo,</p>\n\n<p>Number <code>1</code> belongs to all the types in class <code>Fractional</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 3, "last_activity_date": 1423351935, "creation_date": 1423351935, "answer_id": 28388782, "question_id": 28384685, "link": "https://stackoverflow.com/questions/28384685/why-does-1-1-0-have-the-type-fractional-a-a-and-not-num-a-a/28388782#28388782", "title": "Why does &quot;(1 + 1.0)&quot; have the type &quot;Fractional a =&gt; a&quot; and not &quot;Num a =&gt; a&quot;?", "body": "<p>Type classes are very much <strong>not</strong> like OO classes, this can't be overemphasized.</p>\n\n<p>In particular, &ldquo;if <code>1.0</code> turned into <code>Num</code>&rdquo; doesn't make any sense. <code>Num</code> is a type class, not a type, so nothing can ever &ldquo;turn into a <code>Num</code>&rdquo;. In fact, nothing ever turns into something else at all in Haskell &ndash; everything has a concrete type, that is fixed.</p>\n\n<p>Now you ask, how do polymorphic functions work then? Well, it's called <em>parametric</em> polymorphism for a reason: what seems to be an &ldquo;arbitrary type <code>a</code>&rdquo; is really a <em>type parameter</em>. Like a function parameter, these aren't variables in the sense that they can ever change their value after the fact, but they are variable in the sense that the caller of the function is allowed to choose any particular &ldquo;type value&rdquo; for <code>a</code> &ndash; provided it fulfills the type-class constraint.</p>\n\n<p>So in a sense, the literal <code>1</code> is a function: it accepts a <em>type argument</em> <code>a</code>, and returns a value <code>1 :: a</code>. What it requires is that <code>a</code> is in class <code>Num</code>.</p>\n\n<p>Then we have <code>(+)</code> and <code>1.0</code>, both of which also need that same <code>a</code> argument. <code>(+)</code> again requires <code>Num</code>, nothing new; but <code>1.0</code> requires <code>Fractional a</code>. So all in all, <code>1 + 1.0</code> is a function that accepts &ldquo;three copies of&rdquo; the type argument <code>a</code>, and requires</p>\n\n<ul>\n<li><code>Num a</code></li>\n<li><code>Num a</code></li>\n<li><code>Fractional a</code> &ndash; which also requires <code>Num a</code> because <code>Num</code> is superclass of <code>Fractional</code>.</li>\n</ul>\n\n<p>It would be pretty awkward if we actually had to write the type out as</p>\n\n<pre><code>(1 + 1.0) :: (Num a, Num a, Fractional a, Num a) =&gt; a\n</code></pre>\n\n<p>so it is allowed to leave out the redundant constraints, only leaving <code>Fractional a</code>, which implies all the rest. What we can't do is only leave one of the <code>Num</code> constraints, because that would not imply <code>Fractional</code>.</p>\n"}], "owner": {"reputation": 1147, "user_id": 3523379, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d63603cea5cf4e45808eedab6cafae?s=128&d=identicon&r=PG&f=1", "display_name": "stackoverflowuser", "link": "https://stackoverflow.com/users/3523379/stackoverflowuser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 28388782, "answer_count": 3, "score": 1, "last_activity_date": 1446288622, "creation_date": 1423327406, "question_id": 28384685, "link": "https://stackoverflow.com/questions/28384685/why-does-1-1-0-have-the-type-fractional-a-a-and-not-num-a-a", "title": "Why does &quot;(1 + 1.0)&quot; have the type &quot;Fractional a =&gt; a&quot; and not &quot;Num a =&gt; a&quot;?", "body": "<p><code>1</code> has the type <code>Num a =&gt; a</code></p>\n\n<p><code>1.0</code> has the type <code>Fractional a =&gt; a</code></p>\n\n<p>Why does <code>1+1.0</code> have the type <code>Fractional a =&gt; a</code></p>\n\n<p>This seems strange to me because <code>1</code> is not fractional. Only <code>1.0</code> is fractional. So how did <code>1</code> turn into fractional and get combined with <code>1.0</code> to form a fractional?</p>\n\n<p>Since only <code>Num</code> has the + operator, it would seem more natural to me if <code>1.0</code> turned into <code>Num</code>, got combined with <code>1</code> to produce a final <code>Num</code> (although that would be strange too because we would lose information going from <code>1.0</code> to <code>1</code>).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1423318820, "post_id": 28383116, "comment_id": 45104607, "body": "<i>Please</i> read a <a href=\"http://stackoverflow.com/a/1016986/925978\">Haskell tutorial</a>. You cannot put a type signature in a <code>let</code> statement."}, {"owner": {"reputation": 1, "user_id": 4540714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a8c666ff0c451672240d8881eaffdb?s=128&d=identicon&r=PG&f=1", "display_name": "quackAttack", "link": "https://stackoverflow.com/users/4540714/quackattack"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1423318958, "post_id": 28383116, "comment_id": 45104642, "body": "Thanks, I fixed that but I still get the same error..."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 4540714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a8c666ff0c451672240d8881eaffdb?s=128&d=identicon&r=PG&f=1", "display_name": "quackAttack", "link": "https://stackoverflow.com/users/4540714/quackattack"}, "edited": false, "score": 0, "creation_date": 1423320423, "post_id": 28383395, "comment_id": 45105009, "body": "Thanks! However it is still doesn&#39;t work. I still have to call newExtent with <code>newExtent TopLeft extent rectangle</code>, isn&#39;t there a way to fix it so <code>newExtent TopLeft</code>?"}, {"owner": {"reputation": 701, "user_id": 3877993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbce6b7e90ceede184992bfefb3b5f85?s=128&d=identicon&r=PG", "display_name": "cocreature", "link": "https://stackoverflow.com/users/3877993/cocreature"}, "reply_to_user": {"reputation": 1, "user_id": 4540714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a8c666ff0c451672240d8881eaffdb?s=128&d=identicon&r=PG&f=1", "display_name": "quackAttack", "link": "https://stackoverflow.com/users/4540714/quackattack"}, "edited": false, "score": 0, "creation_date": 1423320710, "post_id": 28383395, "comment_id": 45105087, "body": "Sorry, I somehow missed that part from your question, updated my answer."}, {"owner": {"reputation": 701, "user_id": 3877993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbce6b7e90ceede184992bfefb3b5f85?s=128&d=identicon&r=PG", "display_name": "cocreature", "link": "https://stackoverflow.com/users/3877993/cocreature"}, "reply_to_user": {"reputation": 1, "user_id": 4540714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a8c666ff0c451672240d8881eaffdb?s=128&d=identicon&r=PG&f=1", "display_name": "quackAttack", "link": "https://stackoverflow.com/users/4540714/quackattack"}, "edited": false, "score": 0, "creation_date": 1423320763, "post_id": 28383395, "comment_id": 45105104, "body": "Instead of pattern matching on extent in the where clause you could also just pattern match in the main function definition directly."}], "tags": [], "owner": {"reputation": 701, "user_id": 3877993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbce6b7e90ceede184992bfefb3b5f85?s=128&d=identicon&r=PG", "display_name": "cocreature", "link": "https://stackoverflow.com/users/3877993/cocreature"}, "is_accepted": false, "score": 1, "last_activity_date": 1423320673, "last_edit_date": 1423320673, "creation_date": 1423319821, "answer_id": 28383395, "question_id": 28383116, "link": "https://stackoverflow.com/questions/28383116/parse-error-on-input-let/28383395#28383395", "title": "Parse error on input &#39;let&#39;", "body": "<ol>\n<li>Don't indent the type signature of insert</li>\n<li><p>You don't define functions in the expression after <code>in</code>. A let\nstatement allows you do define things you can then use in the\nexpression after <code>in</code> and only there. In this case a <code>where</code> statement would probably be easier. In constrast to the let statement here you define things after the definition of a function and you can use them in the function which seems like what you are trying to do. So try replacing your let block by</p>\n\n<pre><code>where (Rect eL eT eR eB) = extent\n      newExtent part\n          | part == TopLeft = insert (emptyQtree (Rect eL eT ((eL + eR) `div` 2) ((eT + eB) `div` 2))) rectangle\n          | part == TopRight = insert (emptyQtree (Rect ((eL + eR) `div` 2) eT eR ((eT + eB) `div` 2))) rectangle\n          | part == BottomLeft = insert (emptyQtree (Rect eL ((eT + eB) `div` 2) ((eL + eR) `div` 2) eB)) rectangle\n          | part == BottomRight = insert (emptyQtree (Rect ((eL + eR) `div` 2) ((eT + eB) `div` 2) eR eB)) rectangle\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 4540714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a8c666ff0c451672240d8881eaffdb?s=128&d=identicon&r=PG&f=1", "display_name": "quackAttack", "link": "https://stackoverflow.com/users/4540714/quackattack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 761, "favorite_count": 0, "closed_date": 1423387706, "answer_count": 1, "score": -3, "last_activity_date": 1425072892, "creation_date": 1423318282, "last_edit_date": 1425072892, "question_id": 28383116, "link": "https://stackoverflow.com/questions/28383116/parse-error-on-input-let", "closed_reason": "Not suitable for this site", "title": "Parse error on input &#39;let&#39;", "body": "<p>The code takes a quadtree and inserts a rectangle. However I get a parse error on the let statment. I want to call the function newExtent without having to add all the arguments. So <code>newExtent TopLeft</code> instead of having to call <code>newExtent TopLeft extent rectangle</code>. How do I make it work?</p>\n\n<pre><code>    insert :: QuadTree -&gt; Rectangle -&gt; QuadTree\ninsert (Qt extent horizontal vertical qTL qTR qBL qBR) rectangle    \n  | quadPart extent rectangle == VerLine = Qt extent horizontal (rectangle:vertical) qTL qTR qBL qBR\n  | quadPart extent rectangle == HorLine = Qt extent (rectangle:horizontal) vertical qTL qTR qBL qBR\n  | quadPart extent rectangle == TopLeft &amp;&amp; qTL == EmptyQuadTree = Qt extent horizontal vertical (newExtent TopLeft) qTR qBL qBR\n  | quadPart extent rectangle == TopLeft = Qt extent horizontal vertical (insert qTL rectangle) qTR qBL qBR \n  | quadPart extent rectangle == TopRight &amp;&amp; qTR == EmptyQuadTree = Qt extent horizontal vertical qTL (newExtent TopRight) qBL qBR \n  | quadPart extent rectangle == TopRight = Qt extent horizontal vertical qTL (insert qTR rectangle) qBL qBR\n  | quadPart extent rectangle == BottomLeft &amp;&amp; qBL == EmptyQuadTree = Qt extent horizontal vertical qTL qTR (newExtent BottomLeft) qBR\n  | quadPart extent rectangle == BottomLeft = Qt extent horizontal vertical qTL qTR (insert qBL rectangle) qBR\n  | quadPart extent rectangle == BottomRight &amp;&amp; qBR == EmptyQuadTree = Qt extent horizontal vertical qTL qTR qBL (newExtent BottomRight)\n  | otherwise = Qt extent horizontal vertical qTL qTR qBL (insert qBR rectangle)\n\n  let (Rect eL eT eR eB) = extent\n\n  in  newExtent :: TreeParts -&gt; Rectangle -&gt; Rectangle -&gt; QuadTree\n      newExtent part (Rect eL eT eR eB) rectangle\n            | part == TopLeft = insert (emptyQtree (Rect eL eT ((eL + eR) `div` 2) ((eT + eB) `div` 2))) rectangle\n            | part == TopRight = insert (emptyQtree (Rect ((eL + eR) `div` 2) eT eR ((eT + eB) `div` 2))) rectangle\n            | part == BottomLeft = insert (emptyQtree (Rect eL ((eT + eB) `div` 2) ((eL + eR) `div` 2) eB)) rectangle\n            | part == BottomRight = insert (emptyQtree (Rect ((eL + eR) `div` 2) ((eT + eB) `div` 2) eR eB)) rectangle\n</code></pre>\n"}, {"tags": ["list", "haskell", "tuples"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1423336817, "post_id": 28382932, "comment_id": 45110282, "body": "The type of <code>sortBy</code> says nothing at all about tuples."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1423317334, "creation_date": 1423317334, "answer_id": 28382979, "question_id": 28382932, "link": "https://stackoverflow.com/questions/28382932/sorting-tuples-in-haskell-lists/28382979#28382979", "title": "Sorting tuples in haskell lists", "body": "<blockquote>\n  <p>But the type of sortBy will not work on tuples with length greater\n  than two</p>\n</blockquote>\n\n<p>No, it actually works for any list. For instance, if you want to sort on <code>c</code>, just do:</p>\n\n<pre><code>mySort xmyList = sortBy (compare `on` (\\(a,b,c,d,e) -&gt; c)) x\n</code></pre>\n\n<p>or</p>\n\n<pre><code>mySort xmyList = sortBy (comparing thirdOf5) x\n   where thirdOf5 (_,_,c,_,_) = c\n</code></pre>\n"}], "owner": {"reputation": 919, "user_id": 1819186, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/71b04413070a897f1c5c7055ae281f02?s=128&d=identicon&r=PG", "display_name": "Anthony W", "link": "https://stackoverflow.com/users/1819186/anthony-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1188, "favorite_count": 0, "accepted_answer_id": 28382979, "answer_count": 1, "score": 0, "last_activity_date": 1423317334, "creation_date": 1423317082, "question_id": 28382932, "link": "https://stackoverflow.com/questions/28382932/sorting-tuples-in-haskell-lists", "title": "Sorting tuples in haskell lists", "body": "<p>I'd like to sort a list of tuples by the third or fourth element (say c or d) in the list of type:</p>\n\n<pre><code>myList = [(a,b,c,d,e)]\n</code></pre>\n\n<p>I know if the tuple is of type <code>(a,b)</code> I can use the following approach:</p>\n\n<pre><code>mySort xmyList = sortBy (compare `on` snd) x\n</code></pre>\n\n<p>But the type of sortBy will not work on tuples with length greater than two (so obviously  there is no point writing an accessor function for <code>thd</code> or <code>fth</code>) :</p>\n\n<pre><code>(a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1423305632, "post_id": 28381055, "comment_id": 45101184, "body": "You have <code>Ace</code> twice and aren&#39;t handling <code>King</code> or <code>Queen</code> - it looks like <code>Ace</code> should have value 13 then <code>King</code>, <code>Queen</code>, <code>Jack</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1423305510, "post_id": 28381111, "comment_id": 45101145, "body": "<code>Num</code> in the <code>otherwise</code> clause is not an <code>Int</code> so this won&#39;t compile."}, {"owner": {"reputation": 6093, "user_id": 4293020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/352ea26cb808b26c421ab55184231322?s=128&d=identicon&r=PG", "display_name": "Simon Gibbons", "link": "https://stackoverflow.com/users/4293020/simon-gibbons"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1423305779, "post_id": 28381111, "comment_id": 45101208, "body": "Thanks @Lee I&#39;ve changed that now."}], "tags": [], "owner": {"reputation": 6093, "user_id": 4293020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/352ea26cb808b26c421ab55184231322?s=128&d=identicon&r=PG", "display_name": "Simon Gibbons", "link": "https://stackoverflow.com/users/4293020/simon-gibbons"}, "is_accepted": false, "score": 12, "last_activity_date": 1423363639, "last_edit_date": 1423363639, "creation_date": 1423305449, "answer_id": 28381111, "question_id": 28381055, "link": "https://stackoverflow.com/questions/28381055/not-in-scope-data-constructor/28381111#28381111", "title": "Not in scope: data constructor?", "body": "<p>In haskell variable names must start with a lowercase letter. Anything that is uppercase is interpreted by the compiler as a <a href=\"https://wiki.haskell.org/Constructor\" rel=\"noreferrer\">Data Constructor</a> which is why you are getting that error.</p>\n\n<p>When you define <code>cardRank</code> the variables <code>(suit, rank)</code> must start with lowercase letters for your code to compile.</p>\n\n<p>This should work</p>\n\n<pre><code>data Suit = Clubs | Diamonds | Hearts | Spades deriving (Show, Eq)\ndata Rank = Jack | Queen | King | Ace | Num Int deriving (Show, Eq)\ntype Card = (Suit, Rank)\n\ncardValue :: Card -&gt; Int\ncardValue (suit, rank)\n     | rank == Ace = 11\n     | rank == Ace = 11\n     | rank == Jack = 10\ncardValue (suit, Num x) = x\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 3849382, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/536351a30f9c13cea12500f83a39b43c?s=128&d=identicon&r=PG&f=1", "display_name": "Achref", "link": "https://stackoverflow.com/users/3849382/achref"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17940, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1423363639, "creation_date": 1423304985, "question_id": 28381055, "link": "https://stackoverflow.com/questions/28381055/not-in-scope-data-constructor", "title": "Not in scope: data constructor?", "body": "<p>I am new to haskell. I am getting this problem :</p>\n\n<p>Assignment12.hs:5:12: Not in scope: data constructor `Suit'</p>\n\n<p>Assignment12.hs:5:18: Not in scope: data constructor `Rank'</p>\n\n<p>Assignment12.hs:6:11: Not in scope: data constructor `Rank'</p>\n\n<p>Assignment12.hs:7:11: Not in scope: data constructor `Rank'</p>\n\n<p>Assignment12.hs:8:11: Not in scope: data constructor `Otherwise'\nFailed, modules loaded: none.</p>\n\n<p>This is my code :</p>\n\n<pre><code>data Suit = Clubs | Diamonds | Hearts | Spades deriving (Show, Eq)\ndata Rank = Jack | Queen | King | Ace | Num Int deriving (Show, Eq)\ntype Card = (Suit, Rank)\ncardValue :: Card -&gt; Int\ncardValue (Suit, Rank)\n     | Rank == Ace = 11\n     | Rank == Ace = 11\n     | Rank == Jack = 10\n     | Otherwise = Num\n</code></pre>\n\n<p>I really appreciate your help. Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 2, "creation_date": 1423293210, "post_id": 28379552, "comment_id": 45098619, "body": "You may want to have a look Hindler-Milney type inference or <a href=\"https://en.wikipedia.org/wiki/Type_inference\" rel=\"nofollow noreferrer\">type inference in general</a>"}, {"owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1423308685, "post_id": 28379552, "comment_id": 45101910, "body": "What about type inference? The haskell compiler produces executable code, haskell interpreter is also a program running in cpu memory. So at some point in time, there is a running program in your computer that has a memory object of the same type of as the compile time type. So if that information is available at runtime, it could also in theory be implemented as a native function and potentially retrieved. Haskell as a formal system is pure in theory, but the runtime is a machine that is executed and is not pure in practice..."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1423310104, "post_id": 28379552, "comment_id": 45102255, "body": "If Haskell were completely pure, you could not use IO or Randomness in any way, so a little bit of impurity is neccessary. Also: memory consists of bytes, which can be interpreted as any type."}, {"owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "reply_to_user": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1423310743, "post_id": 28379552, "comment_id": 45102440, "body": "Are you then saying that this information (about the run-time type) is not known at the compile time and therefore it is not possible to construct such a type in Haskell type system? Or this is possible? I don&#39;t get your point."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1423314554, "post_id": 28379552, "comment_id": 45103408, "body": "What you try to do does not make sense. 1. There are no &quot;types&quot; in memory. There are only bytes. 2. It would need a program to check the registers constantly if any register contains the correct bytes. This is WAY more work than storing the information in a new register. Also, how would you do that if your program depends on user input? You would have to predict what the user will enter, which is impossible (at least nowadays)."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 1, "creation_date": 1423327349, "post_id": 28379552, "comment_id": 45107081, "body": "I think your question is based on some misconceptions about how Haskell works and therefore is attracting a lot of downvotes (too many IMO). I think there <i>is</i> a good question hiding in there, though, which I&#39;ve tried to answer. Perhaps you could reformulate a bit?"}, {"owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "edited": false, "score": 0, "creation_date": 1423331046, "post_id": 28379552, "comment_id": 45108313, "body": "You answered my question, thanks! I have tried to reformulate into something more PC..."}, {"owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "edited": false, "score": 0, "creation_date": 1423441573, "post_id": 28379552, "comment_id": 45137631, "body": "I gave reformulation another go after it was put on hold."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423446453, "post_id": 28379552, "comment_id": 45138660, "body": "It&#39;s still very hard to understand what the question is asking. What does the phrase &quot;interrogate the run-time type about specific properties&quot; mean?"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423608288, "post_id": 28379552, "comment_id": 45216256, "body": "As pointed out in the comment to my answer, the current formulation of the question is even more confusing than the original one. It seems to me like you are switching runtime and compile-time. I don&#39;t think you have the right picture about runtime... in a sense, GHC Haskell doesn&#39;t really <i>have</i> runtime types, other than unboxing/boxing and memory layout information for the garbage collector."}, {"owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "edited": false, "score": 0, "creation_date": 1423619205, "post_id": 28379552, "comment_id": 45219856, "body": "Well, if Haskell gets compiled into an executable, and that executable runs    on a physical CPU, then Haskell arguably has a run-time :) The other example of a run-time type is when you do :t for a variable in the interpreter. It boils down to how do you define a run-time type. For me, it is the type of the variable at run-time of the program."}, {"owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "edited": false, "score": 0, "creation_date": 1423619733, "post_id": 28379552, "comment_id": 45219966, "body": "As a matter of fact, I think the whole discussion is interesting (at least for me), so I will ask a separate new question whether Haskell has a run-time type or not :)"}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "edited": false, "score": 0, "creation_date": 1423620806, "post_id": 28379552, "comment_id": 45220260, "body": "The <code>:t</code> case is a little deceptive: GHCi is not just providing a Haskell runtime, but also an interface to the (bytecode) compiler. And it does need to use the compiler to resolve a <code>:t</code> command! On the other hand you can probably say that GHCi keeps more of the compiler&#39;s type representation than a standalone compiled executable does."}], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 1, "last_activity_date": 1423325253, "creation_date": 1423325253, "answer_id": 28384305, "question_id": 28379552, "link": "https://stackoverflow.com/questions/28379552/how-do-you-access-information-about-the-values-run-time-type-at-compile-time/28384305#28384305", "title": "How do you access information about the value&#39;s run-time type at compile time?", "body": "<p>You are probably mixing concepts of type system and RTTI/reflection. There is no need for Haskell to have something like <code>typeid()</code>, <code>dynamic_cast()</code> or <code>is</code> operator, because you can't pass an argument of a different type than the function expects (well, you can, but it's done via type-level cheating and unsafe).</p>\n"}, {"comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1423596407, "post_id": 28384469, "comment_id": 45209789, "body": "Your answer is about &quot;get[ting] compile-time information about a value&#39;s type at runtime&quot;, but the question is about the (rather more baffling) &quot;access[ing] information about the value&#39;s run-time type at compile time&quot;."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1423607927, "post_id": 28384469, "comment_id": 45216105, "body": "@ReidBarton It fit the original version of the question better, although that wasn&#39;t very clear either. It&#39;s what the OP wanted to know, anyhow."}, {"owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "edited": false, "score": 0, "creation_date": 1423619376, "post_id": 28384469, "comment_id": 45219892, "body": "I am sorry that I caused so much confusion. How about you give me the formulation of the question that makes more sense for you and I will add it  to my question? Thanks again for your answer."}, {"owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "reply_to_user": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "edited": false, "score": 0, "creation_date": 1423620329, "post_id": 28384469, "comment_id": 45220117, "body": "@GrimMeme &quot;How do you access information about the value&#39;s compile-time type at run-time? For example, if you want to interrogate at run-time about specific properties or use dynamic typing.&quot;"}], "tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 2, "last_activity_date": 1423326303, "creation_date": 1423326303, "answer_id": 28384469, "question_id": 28379552, "link": "https://stackoverflow.com/questions/28379552/how-do-you-access-information-about-the-values-run-time-type-at-compile-time/28384469#28384469", "title": "How do you access information about the value&#39;s run-time type at compile time?", "body": "<p>Because Haskell is strongly statically typed, the code to which a value is passed normally knows, without looking at the value, all it needs to know about what type it is.</p>\n\n<p>Therefore at least in the GHC compiler, Haskell is implemented via \"type erasure\". This means that the runtime representation of a value of a type doesn't normally contain information about its type.  This allows representations to be more efficient and compact.</p>\n\n<p>Also in some cases, especially when using <code>newtype</code>s, it allows converting between two types with absolutely no overhead - because the runtime representation of the two types is <em>exactly</em> the same, the value can be shared between two pieces of code that treats it as different types.</p>\n\n<p>This doesn't mean that you <em>cannot</em> get compile-time information about a value's type at runtime. But you have to ask for it to be included in the runtime information, and the way to do that in (GHC) Haskell is via the typeclass <code>Typeable</code> from the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.7.0.2/Data-Typeable.html\" rel=\"nofollow\"><code>Data.Typeable</code> module</a>.</p>\n\n<ul>\n<li>This typeclass gives you the name, module name and package name of the datatype constructor as well as any type arguments.</li>\n<li>If you have two values that are not compile-time known to be the same type, but which both have <code>Typeable</code> constraints, you can check at runtime whether their types are equal.</li>\n<li>With <code>cast</code>, you can also convert values between two such types if they happen to be equal.</li>\n<li>Note however that all the types involved must be <em>monomorphic</em>. You cannot \nuse this to compare the types of polymorphic functions/values without first specializing them to a concrete monomorphic type.</li>\n</ul>\n\n<p>There is also the type <code>Dynamic</code> (in <code>Data.Dynamic</code>) which allows you to encapsulate and pass along values of unknown, but <code>Typeable</code> types.</p>\n"}], "owner": {"reputation": 117, "user_id": 711599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oig0a.png?s=128&g=1", "display_name": "markolaban", "link": "https://stackoverflow.com/users/711599/markolaban"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "closed_date": 1423384662, "accepted_answer_id": 28384469, "answer_count": 2, "score": -5, "last_activity_date": 1423620868, "creation_date": 1423292664, "last_edit_date": 1423620868, "question_id": 28379552, "link": "https://stackoverflow.com/questions/28379552/how-do-you-access-information-about-the-values-run-time-type-at-compile-time", "closed_reason": "Needs details or clarity", "title": "How do you access information about the value&#39;s run-time type at compile time?", "body": "<p>How do you access information about the value's run-time type at compile time? </p>\n\n<p>For example, if you want to interrogate the run-time type about specific properties or use dynamic typing.</p>\n\n<p>4th edit: An alternative phrasing of this question can be: \"\"How do you access information about the value's compile-time type at run-time? For example, if you want to interrogate at run-time about specific properties or use dynamic typing.\"</p>\n\n<p>For me, these two formulations are equivalent because as I understand in a pure functional language all information about types is known at compile time. This was probably the cause of confusion - I was thinking about \"run-time information accessible at compile time\" while most people thought about \"compile-time information acessible at run-time\" :)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423279659, "post_id": 28378056, "comment_id": 45096380, "body": "Is this a homework question?"}, {"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "reply_to_user": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423279948, "post_id": 28378056, "comment_id": 45096431, "body": "not quite, i am studying to the final exam."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1423279969, "post_id": 28378056, "comment_id": 45096434, "body": "<code>semmin</code> has <a href=\"http://stackoverflow.com/a/28016867/414413\">non-exhaustive patterns</a>."}], "answers": [{"comments": [{"owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 0, "creation_date": 1423281835, "post_id": 28378270, "comment_id": 45096754, "body": "well.. does this count as one traverse? check original post please* Thank you very much for all the help you&#39;ve been providing cirdec!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "edited": false, "score": 1, "creation_date": 1423289555, "post_id": 28378270, "comment_id": 45098005, "body": "@skills, I don&#39;t know quite what you mean, but this is the best you can do. It will rebuild one path through the tree, and because it&#39;s lazy, that happens in one &quot;pass&quot;."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 3, "last_activity_date": 1423280219, "creation_date": 1423280219, "answer_id": 28378270, "question_id": 28378056, "link": "https://stackoverflow.com/questions/28378056/retrieve-minimum-from-tree-and-the-tree-itself-haskell/28378270#28378270", "title": "Retrieve minimum from tree and the tree itself - haskell", "body": "<p>Here's a hint: If you are at a <code>Node x l r</code> and you already knew that the left tree's <code>mimSmim l</code> was <code>(a, l')</code>, then the <code>Node</code>'s <code>mimSmim (Node x l r)</code> would be <code>(a, Node x l' r)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1774, "user_id": 2755759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9c7a38438d26b07e62c8ba358c3dd69?s=128&d=identicon&r=PG", "display_name": "Andrew Monshizadeh", "link": "https://stackoverflow.com/users/2755759/andrew-monshizadeh"}, "is_accepted": false, "score": 0, "last_activity_date": 1423281950, "creation_date": 1423281950, "answer_id": 28378422, "question_id": 28378056, "link": "https://stackoverflow.com/questions/28378056/retrieve-minimum-from-tree-and-the-tree-itself-haskell/28378422#28378422", "title": "Retrieve minimum from tree and the tree itself - haskell", "body": "<p>You are looking for a <code>zipper</code>. A <code>[zipper][1]</code> is a representation of another data structure that lets you focus one section of the entire structure without losing the rest. Please see the last chapter of <a href=\"http://learnyouahaskell.com/zippers\" rel=\"nofollow\">Learn You A Haskell</a> for an intuitive approach to developing the <code>zipper</code> data type and functions to use on it. </p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1423302588, "creation_date": 1423302588, "answer_id": 28380677, "question_id": 28378056, "link": "https://stackoverflow.com/questions/28378056/retrieve-minimum-from-tree-and-the-tree-itself-haskell/28380677#28380677", "title": "Retrieve minimum from tree and the tree itself - haskell", "body": "<p>The posted code is on the right track, even if not completely correct:</p>\n\n<pre><code>semmin :: BTree a -&gt; (a,BTree a)\nsemmin (Node x Empty Empty) = (x,Empty)\nsemmin (Node x l r) = let i= (semmin l)\n                       in (fst(i),(Node x (snd(i)) r))\n</code></pre>\n\n<p>As a hint for improving your code, not that the following crashes:</p>\n\n<pre><code>semmin (Node 1 Empty (Node 2 Empty Empty))\n</code></pre>\n\n<p>Also, to improve readability a bit, I would suggest:</p>\n\n<pre><code>semmin :: BTree a -&gt; (a,BTree a)\nsemmin (Node x Empty Empty) = (x,Empty)\nsemmin (Node x l r) = let (minValue, minTree) = semmin l\n                       in (minValue, Node x minTree r)\n</code></pre>\n\n<p>Finally, this looks as if it's returning the whole tree back, instead of the tree at which the minimum is found. Check if that's the case, and if that's what you want.</p>\n"}], "owner": {"reputation": 285, "user_id": 1536010, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f56535dbaa6cec5a3bc7df07b08c84be?s=128&d=identicon&r=PG", "display_name": "skills", "link": "https://stackoverflow.com/users/1536010/skills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 338, "favorite_count": 0, "accepted_answer_id": 28378270, "answer_count": 3, "score": 0, "last_activity_date": 1423302588, "creation_date": 1423277854, "last_edit_date": 1423282904, "question_id": 28378056, "link": "https://stackoverflow.com/questions/28378056/retrieve-minimum-from-tree-and-the-tree-itself-haskell", "title": "Retrieve minimum from tree and the tree itself - haskell", "body": "<p>With this function, i can remove the minimum in a binary search tree:</p>\n\n<pre><code>data BTree a = Empty\n             | Node a (BTree a) (BTree a)\n\nsemmin :: BTree a -&gt; BTree a\nsemmin (Node x Empty Empty) = Empty\nsemmin (Node x l r) = Node x (semmin l) r\n</code></pre>\n\n<p>I want to retrieve the minimum value and the tree without this minimum, the trick is, i can traverse it only once.</p>\n\n<pre><code>The type is mimSmim :: BTree a -&gt; (a,BTree a)\n</code></pre>\n\n<p>how should i do it?</p>\n\n<p>EDIT:\nDoes this count as one traverse?</p>\n\n<pre><code>semmin :: BTree a -&gt; (a,BTree a)\nsemmin (Node x Empty Empty) = (x,Empty)\nsemmin (Node x l r) = let i= (semmin l)\n                       in (fst(i),(Node x (snd(i)) r))\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 1, "last_activity_date": 1423256023, "creation_date": 1423256023, "answer_id": 28374608, "question_id": 28374551, "link": "https://stackoverflow.com/questions/28374551/matching-polymorphic-data-in-haskell/28374608#28374608", "title": "Matching polymorphic data in Haskell", "body": "<p>You really can't. The best you can do is to write something like this:</p>\n\n<pre><code>toInt :: Stuff -&gt; Int\ntoInt (Stuff1 x) = x\ntoInt (Stuff2 x) = x\ntoInt (Stuff3 x) = x\n\nsumStuff :: [Stuff] -&gt; Int\nsumStuff [] = 0\nsumStuff (x:xs) = toInt x + sumStuff xs\n</code></pre>\n\n<p>Essentially you're hiding the pattern matching behind the <code>toInt</code> function.</p>\n"}, {"tags": [], "owner": {"reputation": 1089, "user_id": 3681109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d676ca6572e75e842ca0fa3e9e82d1bb?s=128&d=identicon&r=PG&f=1", "display_name": "genisage", "link": "https://stackoverflow.com/users/3681109/genisage"}, "is_accepted": false, "score": 4, "last_activity_date": 1423256951, "last_edit_date": 1423256951, "creation_date": 1423256072, "answer_id": 28374619, "question_id": 28374551, "link": "https://stackoverflow.com/questions/28374551/matching-polymorphic-data-in-haskell/28374619#28374619", "title": "Matching polymorphic data in Haskell", "body": "<p>I think you're looking for <a href=\"https://github.com/ekmett/lens/blob/master/README.markdown\" rel=\"nofollow\">Lenses</a> They allow you to look into data types and view or change the contained value(s), and in cases such as this, they can simplify pattern matching. <a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/a-little-lens-starter-tutorial\" rel=\"nofollow\">This</a> Is a good place to start learning about them.</p>\n\n<p>writing this with Lenses could look something like:</p>\n\n<pre><code>data Stuff = Stuff1 { _stuff :: Int } |\n             Stuff2 { _stuff :: Int } |\n             Stuff3 { _stuff :: Int }\nmakeLenses ''Stuff\n\nsumStuff []     = 0\nsumStuff (x:xs) = x ^. stuff + sumStuff xs\n</code></pre>\n\n<p>In this case Lenses might be overkill since you could just use record syntax. i.e.</p>\n\n<pre><code>data Stuff = Stuff1 {stuff :: Int } |\n             Stuff2 {stuff :: Int } |\n             Stuff3 {stuff :: Int }\n\nsumStuff []     = 0\nsumStuff (x:xs) = stuff x + sumStuff xs\n</code></pre>\n\n<p>or <code>sumStuff = foldr ((+) . stuff) 0</code></p>\n\n<p>Hope this helps.</p>\n"}, {"comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423263507, "post_id": 28374812, "comment_id": 45092680, "body": "This is lazier than the other answers. If every <code>Stuff</code> holds <code>exactStuff</code>, you don&#39;t need to determine if it&#39;s <code>Stuff1</code>, <code>Stuff2</code>, or <code>Stuff3</code> before using the <code>exactStuff</code>."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 14, "last_activity_date": 1423259640, "last_edit_date": 1423259640, "creation_date": 1423256809, "answer_id": 28374812, "question_id": 28374551, "link": "https://stackoverflow.com/questions/28374551/matching-polymorphic-data-in-haskell/28374812#28374812", "title": "Matching polymorphic data in Haskell", "body": "<p>You could take a different approach with your data structure if it's as homogenous as your example:</p>\n\n<pre><code>data StuffType = Stuff1 | Stuff2 | Stuff3 deriving (Eq, Show)\n\ndata Stuff a = Stuff StuffType a deriving (Eq, Show)\n\nextractStuff :: Stuff a -&gt; a\nextractStuff (Stuff _ a) = a\n\nsumStuff :: Stuff Int -&gt; Int\nsumStuff = sum . map extractStuff\n</code></pre>\n\n<p>I've even made the value contained in <code>Stuff</code> polymorphic, in case you wanted to store <code>String</code>s or even more <code>Stuff</code>s in them.  This approach allows you to pattern match on the <code>StuffType</code> when you need it, but stick with a single pattern case when you don't.</p>\n\n<p>You could also define this using records to avoid pattern matches altogether:</p>\n\n<pre><code>data Stuff a = Stuff { stuffType :: StuffType, extractStuff :: a } deriving (Eq, Show)\n</code></pre>\n\n<p>and <code>sumStuff</code> would have the same definition, but you wouldn't need to define <code>extractStuff</code> manually.</p>\n"}], "owner": {"reputation": 689, "user_id": 1558130, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/f67cb4e5a581697e1eadf7ad76b1e917?s=128&d=identicon&r=PG", "display_name": "Jos&#233; Ricardo Ribeiro", "link": "https://stackoverflow.com/users/1558130/jos%c3%a9-ricardo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 28374812, "answer_count": 3, "score": 4, "last_activity_date": 1423259640, "creation_date": 1423255806, "question_id": 28374551, "link": "https://stackoverflow.com/questions/28374551/matching-polymorphic-data-in-haskell", "title": "Matching polymorphic data in Haskell", "body": "<p>Lets say we have a data defined named Stuff:</p>\n\n<pre><code>data Stuff = Stuff1 Int\n           | Stuff2 Int\n           | Stuff3 Int\n\nsumStuff :: [Stuff] -&gt; Int\nsumStuff [] = 0\nsumStuff ((Stuff1 x):xs) = x + sumStuff xs\nsumStuff ((Stuff2 x):xs) = x + sumStuff xs\nsumStuff ((Stuff3 x):xs) = x + sumStuff xs\n\nsumStuff' :: [Stuff] -&gt; Int\nsumStuff' [] = 0\nsumStuff' ((_ x):xs) = x+sumStuff xs\n</code></pre>\n\n<p>How can I match all types without pattern matching like in the wrong definition in sumStuff' ?</p>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["haskell", "indentation"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1423249757, "post_id": 28372447, "comment_id": 45086405, "body": "It&#39;s highly recommended to switch to spaces.  It just works better with Haskell.  I know people like their tabs, and it&#39;s possible to use them in Haskell if you&#39;re careful, but most people just default to spaces."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1423253356, "post_id": 28372447, "comment_id": 45088266, "body": "The use of tabs is not <i>officially</i> deprecated, but GHC 7.10 turns on <code>-fwarn-tabs</code> by default. Using tabs forces you to either use an editor that shows tabs as having 8 spaces or to make sure every &quot;block&quot; starts on a new line. Other people editing your code are likely to first wonder what&#39;s going on and then redo it all with spaces. So just don&#39;t do it."}], "answers": [{"tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": true, "score": 1, "last_activity_date": 1423248399, "creation_date": 1423248399, "answer_id": 28372677, "question_id": 28372447, "link": "https://stackoverflow.com/questions/28372447/whats-the-indentation-error-in-this-example-program/28372677#28372677", "title": "Whats the indentation error in this example program?", "body": "<p>If your code looks exactly the same as it does here, then the problem is that <code>case</code> does not line up with <code>c &lt;- getContents</code> above it; you need to dedent it by one space.  Also, you will need to indent <code>print e</code> by one space to line it up with <code>putStrLn \"Error parsing input:\"</code>.</p>\n"}], "owner": {"reputation": 6278, "user_id": 1417926, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/ff9a7b0f024192d98d32a008c0c95077?s=128&d=identicon&r=PG", "display_name": "shuji", "link": "https://stackoverflow.com/users/1417926/shuji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "closed_date": 1423257939, "accepted_answer_id": 28372677, "answer_count": 1, "score": 0, "last_activity_date": 1423260205, "creation_date": 1423247558, "last_edit_date": 1592644375, "question_id": 28372447, "link": "https://stackoverflow.com/questions/28372447/whats-the-indentation-error-in-this-example-program", "closed_reason": "Not suitable for this site", "title": "Whats the indentation error in this example program?", "body": "<p>I cannot see why there is an indentation error</p>\n<blockquote>\n<p>[1 of 1] Compiling Main             ( main.hs, main.o )</p>\n<p>main.hs:19:17: parse error on input `case'</p>\n</blockquote>\n<p>Every indentation is set with tabs</p>\n<p>Do I need to use spaces instead of tabs?</p>\n<pre><code>import Text.ParserCombinators.Parsec\n\ncsvFile = endBy line eol\nline = sepBy cell (char ',')\ncell = many (noneOf &quot;,\\n\\r&quot;)\n\neol =   try (string &quot;\\n\\r&quot;)\n    &lt;|&gt; try (string &quot;\\r\\n&quot;)\n    &lt;|&gt; string &quot;\\n&quot;\n    &lt;|&gt; string &quot;\\r&quot;\n    &lt;|&gt; fail &quot;Couldn't find EOL&quot;\n\nparseCSV :: String -&gt; Either ParseError [[String]]\nparseCSV input = parse csvFile &quot;(unknown)&quot; input\n\n\nmain =\n    do c &lt;- getContents\n        case parse csvFile &quot;(stdin)&quot; c of\n            Left e -&gt; do putStrLn &quot;Error parsing input:&quot;\n                        print e\n            Right r -&gt; mapM_ print r\n</code></pre>\n"}, {"tags": ["haskell", "infinity"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 8, "creation_date": 1423258214, "post_id": 28372424, "comment_id": 45090625, "body": "This is actually rather more reasonable than many other consequences of IEEE754&#39;s non-real-number values."}], "answers": [{"comments": [{"owner": {"reputation": 1324, "user_id": 2884483, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o2j2D.jpg?s=128&g=1", "display_name": "Slade", "link": "https://stackoverflow.com/users/2884483/slade"}, "edited": false, "score": 0, "creation_date": 1423295476, "post_id": 28372467, "comment_id": 45099041, "body": "Sorry about the accidental downvote\u2014I&#39;ll remove it as soon as it&#39;s no longer locked in."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 1324, "user_id": 2884483, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o2j2D.jpg?s=128&g=1", "display_name": "Slade", "link": "https://stackoverflow.com/users/2884483/slade"}, "edited": false, "score": 0, "creation_date": 1423358295, "post_id": 28372467, "comment_id": 45116464, "body": "@Slade: Ah, no problem. I added a link to some further reading, so your vote shouldn&#39;t be locked in any more."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 31, "last_activity_date": 1423358275, "last_edit_date": 1423358275, "creation_date": 1423247634, "answer_id": 28372467, "question_id": 28372424, "link": "https://stackoverflow.com/questions/28372424/if-i-enter-1-0-1-0-on-ghci-i-am-getting-infinite-infinity-why/28372467#28372467", "title": "If I enter [1/0..1/0] on GHCI I am getting Infinite Infinity. Why?", "body": "<p>Haskell's <code>Double</code> (the default you get when using <code>/</code>) follows the <a href=\"http://steve.hollasch.net/cgindex/coding/ieeefloat.html\" rel=\"nofollow noreferrer\">IEEE 754 standard</a> for floating point numbers, which defines how <code>Infinity</code> behaves. This is why <code>1/0</code> is <code>Infinity</code>. </p>\n\n<p>By this standard (and, to be fair, by logic), <code>Infinity + 1 == Infinity</code>, and the <code>Enum</code> instance for <code>Double</code> just adds <code>1</code> each time. </p>\n\n<p>This is another sign that the <code>Enum</code> instance for <code>Double</code> is not entirely well-formed and does not conform to the expectations we usually have for <code>Enum</code> instances. So, as a rule of thumb, you should probably avoid using <code>..</code> for floating point numbers: even if <em>you</em> understand how it works, it will be confusing for others reading your code. As another example of confusing behavior, consider:</p>\n\n<pre><code>Prelude&gt; [0.1..1]\n[0.1,1.1]\n</code></pre>\n\n<p>If you want to get into <em>a lot</em> more details about the <code>Enum</code> instance for <code>Double</code>, you can read through this <a href=\"https://www.haskell.org/pipermail/haskell-cafe/2011-September/095431.html\" rel=\"nofollow noreferrer\">pretty lengthy Haskell-cafe thread</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": false, "score": 3, "last_activity_date": 1423247645, "creation_date": 1423247645, "answer_id": 28372469, "question_id": 28372424, "link": "https://stackoverflow.com/questions/28372424/if-i-enter-1-0-1-0-on-ghci-i-am-getting-infinite-infinity-why/28372469#28372469", "title": "If I enter [1/0..1/0] on GHCI I am getting Infinite Infinity. Why?", "body": "<p>I believe the implementation of <code>[a..b]</code> continues incrementing <code>a</code> by one until it is greater than <code>b</code>.  This is never going to happen with infinity, so it goes forever.</p>\n\n<p>I believe your code will probably default to <code>Double</code> the way you've written it, which has well-defined semantics for infinity.  IIRC, Haskell follows <a href=\"http://en.wikipedia.org/wiki/IEEE_floating_point\" rel=\"nofollow\">http://en.wikipedia.org/wiki/IEEE_floating_point</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1423358626, "post_id": 28372876, "comment_id": 45116531, "body": "succ. This is exactly the reason there is no <code>Enum Double</code> or <code>Enum Float</code> in Frege."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 13, "last_activity_date": 1423249146, "creation_date": 1423249146, "answer_id": 28372876, "question_id": 28372424, "link": "https://stackoverflow.com/questions/28372424/if-i-enter-1-0-1-0-on-ghci-i-am-getting-infinite-infinity-why/28372876#28372876", "title": "If I enter [1/0..1/0] on GHCI I am getting Infinite Infinity. Why?", "body": "<p>As Luis Wasserman and Tikhon Jelvis have indicated, the basic problem is that the <code>Num</code> and <code>Enum</code> instances for <code>Float</code> and <code>Double</code> are <em>weird</em>, and really should not exist at all. In fact, the <code>Enum</code> class itself is pretty weird, as it attempts to serve several different purposes at once, none of them well\u2014it is probably best considered a historical accident and a convenience rather than a good example of what a typeclass should look like. The same is true, to a significant extent, of the <code>Num</code> and <code>Integral</code> classes. When using any of these classes, you must pay close attention to the specific types you are operating on.</p>\n\n<p>The <code>enumFromTo</code> methods for floating point are based on the following function:</p>\n\n<pre><code>numericEnumFromTo :: (Ord a, Fractional a) =&gt; a -&gt; a -&gt; [a]\nnumericEnumFromTo n m = takeWhile (&lt;= m + 1/2) (numericEnumFrom n)\n</code></pre>\n\n<p>So <code>2 &lt;= 1+1/2</code> is <em>false</em>, but because of the weirdness of floating point, <code>infinity &lt;= infinity + 1/2</code> is <em>true</em>.</p>\n\n<p>As Tikhon Jelvis indicates, it's generally best not to use any <code>Enum</code> methods, including numeric ranges, with floating point.</p>\n"}], "owner": {"reputation": 1497, "user_id": 2148851, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b7558f5365a89314a0d569edba74dbcc?s=128&d=identicon&r=PG&f=1", "display_name": "k4vin", "link": "https://stackoverflow.com/users/2148851/k4vin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1009, "favorite_count": 1, "accepted_answer_id": 28372467, "answer_count": 3, "score": 19, "last_activity_date": 1433833099, "creation_date": 1423247450, "last_edit_date": 1433833099, "question_id": 28372424, "link": "https://stackoverflow.com/questions/28372424/if-i-enter-1-0-1-0-on-ghci-i-am-getting-infinite-infinity-why", "title": "If I enter [1/0..1/0] on GHCI I am getting Infinite Infinity. Why?", "body": "<p>I can't understand the following behavior of ranges in Haskell. Enumerating 1 to 1 gives me a list contain only 1, and 2 to 2 gives me a list contain only 2 as given below.</p>\n\n<pre><code>Prelude&gt; [1..1]\n[1]\nPrelude&gt; [2..2]\n[2]\n</code></pre>\n\n<p>But enumerating infinity to infinity gives me a list which is infinite in length and all the elements are infinity, as shown below.</p>\n\n<pre><code>Prelude&gt; [1/0..1/0]\n[Infinity,Infinity,Infinity,Infinity,Infinity,Infinity,Interrupted.\n</code></pre>\n\n<p>I am aware that Infinity is a concept not to be treated as a number, but what justifies that behavior ?</p>\n"}, {"tags": ["haskell", "treeview", "gtk", "signals", "gtk2hs"], "comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1423285157, "post_id": 28371459, "comment_id": 45097297, "body": "Can you post a minimal example of your whole code (incl. the creation of the <code>TreeView</code> columns etc.)?"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1423243890, "creation_date": 1423243890, "question_id": 28371459, "link": "https://stackoverflow.com/questions/28371459/gtk-connecting-spinbutton-signal-in-cellrenderer", "title": "gtk : connecting spinbutton signal in cellrenderer", "body": "<p>I'am making a GUI with a treeview using Gtk.</p>\n\n<p>I want to connect the update signal of a <code>CellRendererSpin</code> to make some actions (update a drawing) at each modification of the spinbutton (before being validated with 'enter').</p>\n\n<p>I tryed to get the widget spinbutton with <code>editingStarted</code> and connect the signal <code>onValueSpinned</code> of the spinbutton to make the update.</p>\n\n<pre><code>on renderspin editingStarted  $ \\wid iter -&gt; do\n                                 let widcast = castToSpinButton wid\n                                 onValueSpinned widcast $ do\n                                                          update_the_drawing\n                                                          ....\n</code></pre>\n\n<p>When I click on spinbutton to increase or decrease, the update is done but things are <strong>running away</strong> ... updatings are made sequentially very fast and doesn't stop.</p>\n\n<p>I tryed to replace <code>onValueSpinned widcast</code> by <code>onValueChanged adj</code> on the adjustement of the spinbutton</p>\n\n<pre><code>on renderspin editingStarted  $ \\wid iter -&gt; do\n                                 let widcast = castToSpinButton wid\n                                 adj &lt;- spinButtonGetAdjustment  widcast\n                                 onValueChanged adj $ do\n                                                      update_the_drawing\n                                                      ....\n</code></pre>\n\n<p>I tryed to replace <code>onValueSpinned</code> by <code>onValueSpinned</code> and <code>onValueChanged</code> by <code>afterValueChanged</code> and it still running away.</p>\n\n<p>I have several questions : </p>\n\n<ol>\n<li>Is <code>on renderspin editingStarted</code> the correct method to access the spinbutton widget in a treeview? Is there an alternative method?</li>\n<li>Is there a specific signal/function to make the update once?</li>\n<li>Is my method to obtain the expected result globally correct or am I totally wrong?</li>\n<li>Do you have an example in any language (C, Python, Haskell, ...) ? </li>\n</ol>\n"}, {"tags": ["haskell", "plugins", "emacs", "key-bindings"], "answers": [{"comments": [{"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "edited": false, "score": 0, "creation_date": 1423250015, "post_id": 28372768, "comment_id": 45086521, "body": "Thank you, I&#39;ve tried <code>M-s</code> within strings, expressions surrounded by parentheses, and square brackets, and every time I had nothing but error message <code>&quot;Unsupported node type for splicing&quot;</code>. It&#39;s pity, cause I&#39;ve already delighted (: suppose I have to report issue."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "edited": false, "score": 0, "creation_date": 1423250478, "post_id": 28372768, "comment_id": 45086738, "body": "@Geradlus_RU: The fact that it doesn&#39;t work for anything but parentheses is noted in its documentation. The fact that it also doesn&#39;t work for complex expressions in parentheses is probably a bug though."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1423337467, "post_id": 28372768, "comment_id": 45110503, "body": "It does work for complex expressions in parenthesis but you have to expand the selection first with <code>M-a</code>. For example, given <code>(f| a b)</code> with point at <code>|</code>, <code>M-a</code> will expand the selection and then <code>M-s</code> will remove the surrounding parens, giving <code>|f a b</code>. It&#39;s helpful to set the face for the selection to something easy to see but not too distracting."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1423357364, "post_id": 28372768, "comment_id": 45116272, "body": "@ReinHenrichs: Oh, I did not realize this. The selection is invisible with my default settings, and I just expected it to work like <code>paredit</code>. I&#39;ll add a note to my answer about it."}, {"owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1423372130, "post_id": 28372768, "comment_id": 45118881, "body": "@ReinHenrichs, tried it out, can confirm this works! Thanks a lot! Still have to find mentioned face customization."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 3, "last_activity_date": 1423357450, "last_edit_date": 1423357450, "creation_date": 1423248712, "answer_id": 28372768, "question_id": 28369920, "link": "https://stackoverflow.com/questions/28369920/structured-haskell-mode-shm-how-to-delete-single-bracket-or-string-quote-by/28372768#28372768", "title": "Structured Haskell Mode [SHM]: How to delete single bracket or string quote by &lt;backspace&gt; or &lt;del&gt;?", "body": "<p><code>structured-haskell-mode</code> is very heavily influenced by <code>paredit</code>, which is where it gets the basic movement and editing bindings from. You can see what commands <code>paredit</code> provides either by looking it up in the Emacs help system (easiest way: open up a lisp buffer, enable paredit, <code>C-h m</code>) or using this <a href=\"http://pub.gajendra.net/src/paredit-refcard.pdf\" rel=\"nofollow\">handy cheatsheet</a> (which looks reasonable but I haven't read).</p>\n\n<p>Also, this <a href=\"http://emacsrocks.com/e14.html\" rel=\"nofollow\">video introduction</a> to <code>paredit</code> for Lisp is probably worth watching.</p>\n\n<p>For your specific question: <code>M-s</code> deletes the current level of nesting. In <code>paredit</code> this works for parentheses, brackets or quotes, but it looks like shm only supports parentheses at the moment. You can invoke it anywhere inside an expression:</p>\n\n<pre><code>((a |b c) d e f)\nM-s\n(a b c d e f)\n</code></pre>\n\n<p>EDIT: As @ReinHenrichs pointed out, you have to expand the selection to the whole node using <code>M-a</code> before using <code>M-s</code> to delete the surrounding parentheses, which is why it wasn't working for me earlier.</p>\n\n<p>In the meantime, a decent workaround would be to rebind <code>DEL</code> to something like <code>haskell-indentation-delete-backward-char</code> (or whatever is appropriate for your setup) so that you can delete structural characters as before. From a bit of experimenation, <code>shm</code> seems to gracefully degrade for code that doesn't parse properly, so this isn't too inconvenient.</p>\n"}, {"tags": [], "owner": {"reputation": 121, "user_id": 2924117, "user_type": "registered", "profile_image": "https://graph.facebook.com/821112709/picture?type=large", "display_name": "Arthur Welf", "link": "https://stackoverflow.com/users/2924117/arthur-welf"}, "is_accepted": false, "score": 1, "last_activity_date": 1427720492, "last_edit_date": 1427720492, "creation_date": 1427666455, "answer_id": 29335416, "question_id": 28369920, "link": "https://stackoverflow.com/questions/28369920/structured-haskell-mode-shm-how-to-delete-single-bracket-or-string-quote-by/29335416#29335416", "title": "Structured Haskell Mode [SHM]: How to delete single bracket or string quote by &lt;backspace&gt; or &lt;del&gt;?", "body": "<p>Put this keybinding into your <code>emacs</code> configuration file: </p>\n\n<p><code>(global-set-key (kbd \"C-c C-d\") 'delete-pair)</code></p>\n\n<p>Now you can place the point before the opening part of the pair (parentheses, square brackets, quotes etc.) or use <code>M-a</code> in SHM to go to the next outer pair and press <code>C-c C-d</code> to delete the pair. </p>\n"}], "owner": {"reputation": 1327, "user_id": 1749901, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/06876c39fc89c5abe3d891e36fe29504?s=128&d=identicon&r=PG", "display_name": "Geradlus_RU", "link": "https://stackoverflow.com/users/1749901/geradlus-ru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "accepted_answer_id": 28372768, "answer_count": 2, "score": 3, "last_activity_date": 1427720492, "creation_date": 1423238856, "last_edit_date": 1423240825, "question_id": 28369920, "link": "https://stackoverflow.com/questions/28369920/structured-haskell-mode-shm-how-to-delete-single-bracket-or-string-quote-by", "title": "Structured Haskell Mode [SHM]: How to delete single bracket or string quote by &lt;backspace&gt; or &lt;del&gt;?", "body": "<p>Suppose I want to remove parentheses around some expression, e.g. I want to unwrap <code>(not True)</code>.</p>\n\n<ul>\n<li>Pressing <code>&lt;backspace&gt;</code> with the cursor standing right after closing parenthesis does not delete it, but the cursor jumps inside the parentheses (runs <code>shm/del</code>).</li>\n<li>Pressing <code>&lt;delete&gt;</code> when the cursor is placed over opening parenthesis deletes everything inside, including the parentheses themselves (runs <code>delete-char</code>).</li>\n</ul>\n\n<p>The same goes with string double quote delimiters, curly brackets, square brackets, and I believe something else.</p>\n\n<p>Is there some predefined function to unwrap expression in <strong>SHM</strong>? Or should I override this behaviour with some manual key bindings/actions?</p>\n"}, {"tags": ["opengl", "haskell", "juicy-pixels"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 1, "creation_date": 1423238537, "post_id": 28369375, "comment_id": 45080273, "body": "To whoever closed this as &quot;without the clear problem statement/missing code&quot; - the code is linked as Gist, because the Q is too long already, and the parts in the gist aren&#39;t relevant to the problem at hand; they&#39;re presented merely for convenience. As for the statement, I think it&#39;s pretty obvious I&#39;m not loading a PNG with just teal colour in it, huh."}, {"owner": {"reputation": 39713, "user_id": 2423205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EX7y2.png?s=128&g=1", "display_name": "Andon M. Coleman", "link": "https://stackoverflow.com/users/2423205/andon-m-coleman"}, "edited": false, "score": 2, "creation_date": 1423246146, "post_id": 28369375, "comment_id": 45084486, "body": "Since when is <code>N&#47;A</code> a sensible value for <code>GL_TEXTURE_MIN_FILTER</code> on a regular 2D texture? Are you sure this isn&#39;t just gDEBugger being stupid? Or maybe it put <code>N&#47;A</code> there because your minification filter includes mipmapping, but your number of texture LODs is wrong?"}, {"owner": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 0, "creation_date": 1423276949, "post_id": 28369375, "comment_id": 45095944, "body": "Have you tried looking at the output of glGetError?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 2567, "user_id": 994206, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/699bacad8f85a069dda312cc29e03baa?s=128&d=identicon&r=PG", "display_name": "Mokosha", "link": "https://stackoverflow.com/users/994206/mokosha"}, "edited": false, "score": 0, "creation_date": 1423331234, "post_id": 28369375, "comment_id": 45108385, "body": "@Mokosha I always set gDebugger to break on errors."}], "answers": [{"comments": [{"owner": {"reputation": 38487, "user_id": 2327517, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0Bulc.jpg?s=128&g=1", "display_name": "derhass", "link": "https://stackoverflow.com/users/2327517/derhass"}, "edited": false, "score": 1, "creation_date": 1423327606, "post_id": 28379281, "comment_id": 45107167, "body": "Well. The default filters are well-defined. It is mipmapping for minification, making the texture not <i>mipmapping-complete</i>. However, the texture object itself is till valid, can be read back, or be accessed with <code>texelFetch</code>. That gdebugger output is totally misleading, as there is no way to get some <code>N&#47;A</code> state there. I don&#39;t say that setting those filters is a bad idea, but that won&#39;t fix the issue here."}, {"owner": {"reputation": 13278, "user_id": 688624, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b0714eded10b5ccee614c7134360974b?s=128&d=identicon&r=PG", "display_name": "imallett", "link": "https://stackoverflow.com/users/688624/imallett"}, "reply_to_user": {"reputation": 38487, "user_id": 2327517, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0Bulc.jpg?s=128&g=1", "display_name": "derhass", "link": "https://stackoverflow.com/users/2327517/derhass"}, "edited": false, "score": 0, "creation_date": 1423329641, "post_id": 28379281, "comment_id": 45107815, "body": "@derhass hmmmm, you&#39;re right. See edit; I have clarified my intention."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1423564742, "post_id": 28379281, "comment_id": 45190123, "body": "As expected, adding the proper filter settings didn&#39;t change gDebugger output."}], "tags": [], "owner": {"reputation": 13278, "user_id": 688624, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b0714eded10b5ccee614c7134360974b?s=128&d=identicon&r=PG", "display_name": "imallett", "link": "https://stackoverflow.com/users/688624/imallett"}, "is_accepted": false, "score": 0, "last_activity_date": 1423329575, "last_edit_date": 1423329575, "creation_date": 1423290205, "answer_id": 28379281, "question_id": 28369375, "link": "https://stackoverflow.com/questions/28369375/opengl-texture-contains-bad-data-whats-going-on/28379281#28379281", "title": "OpenGL texture contains bad data - what&#39;s going on?", "body": "<p>Combining the highly functional Haskell with OpenGL, the poster child of messy state, is tenebrific at best, and therefore I confess to being a little over my head with this exact scenario.</p>\n\n<p>However, it is well-known that OpenGL textures are incomplete without both a minification filter and a magnification filter that match the data (see <a href=\"https://www.opengl.org/wiki/Common_Mistakes#Creating_a_complete_texture\" rel=\"nofollow\">here</a>).  I didn't see such in the code, so your texture is incomplete.  In C, you would add something like:</p>\n\n<pre><code>glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);\nglTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);\n</code></pre>\n\n<p>As pointed out in the comments, this probably shouldn't be causing gDEBugger to give bogus output; skimming the documentation, I didn't see anything that requires textures to be complete to be read from (and gDEBugger works by intercepting GL calls anyway).  Still, reading from a texture with mismatched sampling filters feels wrong to me; I wouldn't be surprised if it's an edge case.</p>\n"}, {"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 1, "last_activity_date": 1423590281, "creation_date": 1423590281, "answer_id": 28438310, "question_id": 28369375, "link": "https://stackoverflow.com/questions/28369375/opengl-texture-contains-bad-data-whats-going-on/28438310#28438310", "title": "OpenGL texture contains bad data - what&#39;s going on?", "body": "<p>This is most probably the bug in gDEBugger. After some manipulations and actually drawing the texture, I've verified that it indeed contains the right data.</p>\n"}], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 28438310, "answer_count": 2, "score": 1, "last_activity_date": 1423590281, "creation_date": 1423237285, "last_edit_date": 1423239480, "question_id": 28369375, "link": "https://stackoverflow.com/questions/28369375/opengl-texture-contains-bad-data-whats-going-on", "title": "OpenGL texture contains bad data - what&#39;s going on?", "body": "<p>I am trying to load an image into OpenGL texture.</p>\n\n<p>I created a window and GL 4.4 Core Forward-Compatible context:</p>\n\n<p><img src=\"https://i.stack.imgur.com/Q71LE.png\" alt=\"context\"></p>\n\n<p>Here's the code I'm using to load the image and create the texture:</p>\n\n<pre><code>load :: IO ()\nload = do\n    image &lt;- JP.readImage \"image.png\"\n    case image of\n        (Left err) -&gt; do print err\n                         exitWith (ExitFailure 1)\n        (Right imgData) -&gt; do \n            a &lt;- malloc\n            glGenTextures 1 a\n            texId &lt;- peek a\n            free a\n            loadImgIntoTexture texId imgData\n\nloadImgIntoTexture texId (JP.ImageRGBA8 (JP.Image width height dat)) = do\n    glBindTexture GL_TEXTURE_2D texId\n    unsafeWith dat $ glTexImage2D GL_TEXTURE_2D 0 GL_RGBA (fromIntegral width) (fromIntegral height) 0 GL_RGBA GL_UNSIGNED_BYTE . castPtr\n    --p &lt;- mallocBytes $ (fromIntegral width) * (fromIntegral height) * 4\n    --glTexImage2D GL_TEXTURE_2D 0 GL_RGBA (fromIntegral width) (fromIntegral height) 0 GL_RGBA GL_UNSIGNED_BYTE (castPtr p)\n    print \"everything ok\"\n</code></pre>\n\n<p>The commented out line is another attempt to put anything meaningful into that texture.</p>\n\n<p>Here's what gDebugger reports for the texture information:</p>\n\n<p><img src=\"https://i.stack.imgur.com/EfFDs.png\" alt=\"texture information\"></p>\n\n<p>And here's what it shows for the texture contents:</p>\n\n<p><img src=\"https://i.stack.imgur.com/3rWtk.png\" alt=\"texture contents\"></p>\n\n<p>When I print out the structure returned by JuicyPixels, it prints out distinct byte sequences that most certainly don't produce a flat image.</p>\n\n<p>In this example I'm not rendering the texture, and I'm using raw binding generated by the <code>gl</code> package. I had exactly the same behaviour (with the same shade of teal) when using <code>OpenGL</code> package. It unsurprisingly rendered as a flat rectangle on the screen.</p>\n\n<p>I have tried with different images, sized 128x128 and NPOT (100x100 as in the screenshots).</p>\n\n<h3>What could be causing that behaviour?</h3>\n\n<p><a href=\"https://gist.github.com/bananu7/9a7ab2e0f9404f087ccc\" rel=\"nofollow noreferrer\">Full source</a>.</p>\n"}, {"tags": ["haskell", "monads", "composition", "parsec", "aeson"], "answers": [{"comments": [{"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1423239266, "post_id": 28369563, "comment_id": 45080720, "body": "This seems to be a reasonable solution for the actual problem. However, it would be even greater to see some mind-blowing generic combinator. If no one would suggest such, in the reasonable time, I&#39;ll mark your answer."}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1423239324, "post_id": 28369563, "comment_id": 45080750, "body": "Also, see my update above. About more proper solution that I took."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1423239552, "post_id": 28369563, "comment_id": 45080909, "body": "@zudov obviously using a nested data structure eliminates this problem, but I certainly have instances where this isn&#39;t as practical. For the case where you need to traverse a tree that may or may not be there an operator like the one above is very useful. There may be some combinator available from a lens library for aeson that could be of use here too."}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1423240027, "post_id": 28369563, "comment_id": 45081197, "body": "I see, it can be aplicable in such case, but for parsing a tree it might be better to simply take a HashMap and convert it to desired representation. aeson-lens indeed solves the problem, but unfortunately I wasn&#39;t able to use lenses for my problem. You can see a code-sample here <a href=\"http://forum.ruhaskell.org/t/kompozicziya-vlozhennyh-opczionalnyh-json-parserov-aes/79/2?u=zudov\" rel=\"nofollow noreferrer\">forum.ruhaskell.org/t/&hellip;</a>"}, {"owner": {"reputation": 2323, "user_id": 590667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8423373132517bd8634ac62a28a5876e?s=128&d=identicon&r=PG", "display_name": "Aleksei astynax Pirogov", "link": "https://stackoverflow.com/users/590667/aleksei-astynax-pirogov"}, "edited": false, "score": 0, "creation_date": 1423241537, "post_id": 28369563, "comment_id": 45082137, "body": "<code>fmap Test $ o .: &quot;foo&quot; &gt;&gt;= (.: &quot;bar&quot;) &gt;&gt;= (.: &quot;baz&quot;) &gt;&gt;= (.: &quot;qux&quot;)</code> works &quot;out of the box&quot;, special combinator is not needed!"}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1423242986, "post_id": 28369563, "comment_id": 45082883, "body": "But it would fail, wouldn&#39;t it?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1423243836, "post_id": 28369563, "comment_id": 45083342, "body": "@zudov It should fail with <code>mzero</code>, meaning your JSON will decode to <code>Nothing :: Maybe User</code>."}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1423260029, "post_id": 28369563, "comment_id": 45091394, "body": "Well, in the real case User would have many other fields, and I don&#39;t want the User be Nothing just because the &quot;foo&quot; field failed to decode."}, {"owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "edited": false, "score": 0, "creation_date": 1423332534, "post_id": 28369563, "comment_id": 45108820, "body": "@bheklilr Take a look at my solution"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": false, "score": 2, "last_activity_date": 1423237849, "creation_date": 1423237849, "answer_id": 28369563, "question_id": 28368980, "link": "https://stackoverflow.com/questions/28368980/composing-optional-aeson-parsers/28369563#28369563", "title": "Composing optional Aeson parsers", "body": "<p>I was able to make a relatively simple combinator based off your <code>&gt;&gt;= maybe (return Nothing) (.:? key)</code> pattern that should greatly simplify what you want to do:</p>\n\n<pre><code>(/?) :: FromJSON a =&gt; Parser (Maybe Object) -&gt; Text -&gt; Parser (Maybe a)\nmaybeParser /? key = maybeParser &gt;&gt;= maybe (return Nothing) (.:? key)\n</code></pre>\n\n<p>This can be used to chain together an arbitrary number of levels through a JSON document:</p>\n\n<pre><code>instance FromJSON User where\n    parseJSON (Object o) = User &lt;$&gt; o .:? \"image\" /? \"url\"\n    parseJSON _ = mzero\n\n&gt; decode \"{\\\"image\\\": {\\\"url\\\": \\\"foobarbaz\\\"}}\" :: Maybe User\nJust (User {imgUrl = Just \"foobarbaz\"})\n</code></pre>\n\n<p>Another example:</p>\n\n<pre><code>data Test = Test (Maybe Int) deriving (Eq, Show)\n\ninstance FromJSON Test where\n    parseJSON (Object o) = Test &lt;$&gt; o .:? \"foo\" /? \"bar\" /? \"baz\" /? \"qux\"\n    parseJSON _ = mzero\n\n&gt; decode \"{\\\"foo\\\": {\\\"bar\\\": {\\\"baz\\\": {\\\"qux\\\": 123}}}}\" :: Maybe Test\nJust (Test (Just 123))\n</code></pre>\n\n<p>This might not be exactly what you're looking for, but I think it solves your immediate problem.  Considering it's a 1 line function with very low complexity it seem pretty idiomatic to me.  I don't think higher levels of abstraction are really needed in this instance.</p>\n"}, {"tags": [], "owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "is_accepted": true, "score": 3, "last_activity_date": 1423332495, "creation_date": 1423332495, "answer_id": 28385593, "question_id": 28368980, "link": "https://stackoverflow.com/questions/28368980/composing-optional-aeson-parsers/28385593#28385593", "title": "Composing optional Aeson parsers", "body": "<p>I was pointed to a nice solution</p>\n\n<p>To start with, here is how we can do it.</p>\n\n<pre><code>parseJSON (Object o) = User . join &lt;$&gt; (traverse (.:? \"url\") =&lt;&lt; (o .:? \"image\"))\n</code></pre>\n\n<p>Here, we get <code>Parser (Maybe Object)</code> and pass it to the next monadic action, which works with <code>Maybe Object</code>. With the help of <code>traverse</code> we perform the action if it was Just. In the result we get <code>Parser (Maybe (Maybe Object)). What's left is to</code>join<code>that result and get</code>Parser (Maybe Object)`.</p>\n\n<p>However it would be nice to make it simpler to use. I would take this operator from @bheklilr's answer and will adopt it to this solution. </p>\n\n<pre><code>-- The type can be much more generic, but for simplicity I would keep it in domain of the problem\n(.:?&gt;) :: FromJSON a =&gt; Parser (Maybe Object) -&gt; Text -&gt; Parser (Maybe a)\nmaybeParser .:?&gt; key = fmap join . traverse (.:? key) =&lt;&lt; maybeParser\n</code></pre>\n\n<p>And after that we can use that operator to parse long chains of optional fields.</p>\n\n<pre><code>getImgUrl :: A.Object -&gt; Parser (Maybe Text)\ngetImgUrl o = o .:? \"image\" .:?&gt; \"url\" .:?&gt; \"foo\" .:?&gt; \"bar\"\n</code></pre>\n\n<p>From practical point of view, this solution is not much more useful than @bheklilr's solution and my initial 'naive' code sample. However, I like it much more because instead of matching on <code>Just/Nothing</code> it can transform many other types (e.g. <code>Either</code>) </p>\n"}], "owner": {"reputation": 1066, "user_id": 2081046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04a2d3a5da814dd0e29b233d40e37b5d?s=128&d=identicon&r=PG&f=1", "display_name": "zudov", "link": "https://stackoverflow.com/users/2081046/zudov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 1, "accepted_answer_id": 28385593, "answer_count": 2, "score": 2, "last_activity_date": 1423332495, "creation_date": 1423235998, "last_edit_date": 1423239001, "question_id": 28368980, "link": "https://stackoverflow.com/questions/28368980/composing-optional-aeson-parsers", "title": "Composing optional Aeson parsers", "body": "<p>Here is a part of JSON object which represents the user:</p>\n\n<pre><code>{ \"image\": { \"url\": \"http://example.com\" } }\n</code></pre>\n\n<p>I need to parse it into a <code>User</code> type:</p>\n\n<pre><code>data User = User { imgUrl :: Maybe Text }\n</code></pre>\n\n<p>The naive solution:</p>\n\n<pre><code>parseJSON (Object o) = User &lt;$&gt; getImgUrl o\n    where getImgUrl o = (o .:? \"image\") &gt;&gt;= maybe (return Nothing) (.:? \"url\")\n</code></pre>\n\n<p>But that's not much better than these chains:</p>\n\n<pre><code>case f m1 of\n    Nothing -&gt; Nothing\n    Just m2 -&gt; case f2 m2 of\n        Nothing -&gt; Nothing\n        Just m3 -&gt; case f3 m3 ....\n</code></pre>\n\n<p>that are often demonstrated in 'Why do you need a Monad' explanations</p>\n\n<p>Thus, I need to compose parsers which look like <code>(.:? \"url\") :: Parser (Maybe a)</code></p>\n\n<p>I've tried to describe that composition with <code>comp</code> function:</p>\n\n<pre><code>getImgUrl :: Object -&gt; Parser (Maybe Text)\ngetImgUrl o = o .:? \"image\" &gt;&gt;= comp (o .:? \"url\")\n\ncomp :: (Monad m) =&gt; (a -&gt; m (Maybe b)) -&gt; Maybe a -&gt; m (Maybe b)\ncomp p Nothing = return Nothing\ncomp p (Just o) = p o\n</code></pre>\n\n<p>Smells like a Functor, but <code>fmap</code> didn't help me.</p>\n\n<p>Then I decided, that composition must go on:</p>\n\n<pre><code>getImgUrl :: Object -&gt; Parser (Maybe Text)\ngetImgUrl = comp2 (.:? \"image\") (.:? \"url\") o\n\n-- Maybe should be changed to a matching typeclass\ncomp2 :: (Monad m) =&gt; (a -&gt; m (Maybe b)) -&gt; (b -&gt; m (Maybe c)) -&gt; a -&gt; m (Maybe c)\ncomp2 = undefined\n</code></pre>\n\n<p>Hoogle search didn't help me, but skimming through <code>Control.Monad</code> docs gave me Kliesli composition, which I am not experienced with. I see some similarity:</p>\n\n<pre><code>(&gt;=&gt;) :: Monad m =&gt; (a -&gt; m    b)  -&gt; (b -&gt; m c)     -&gt; a -&gt; m    c\ncomp2 :: Monad m =&gt; (a -&gt; m (f b)) -&gt; (b -&gt; m (f c)) -&gt; a -&gt; m (f c)\n</code></pre>\n\n<p>The difference is that during the composition <code>Maybe</code> should be 'unwrapped'.</p>\n\n<p>It seems that I am close to the solution, but still can't find it. Please give me some insight.</p>\n\n<p><strong>[Update]:</strong>\nI've decided that the best solution to the actual problem, would be to preserve the original JSON structure and to have a nested User type:</p>\n\n<pre><code>data User = User { image :: Maybe Image }\ndata Image = Image { url :: Text }\n</code></pre>\n\n<p>This completely eliminates my problem, and makes API more compatible with the original source.</p>\n\n<p>However, just for theoretical purposes, it would be great to see how the original problem could be solved. </p>\n"}, {"tags": ["haskell", "pcap", "bytestring"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1423232315, "post_id": 28367558, "comment_id": 45076420, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/12576817/couldnt-match-expected-type-with-actual-type-error-when-using-codec-bmp\">&quot;Couldn&#39;t match expected type with actual type&quot; error when using Codec.BMP</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 509, "user_id": 4492495, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/541d097065e9a9c44c7e0836046cc771?s=128&d=identicon&r=PG&f=1", "display_name": "mastro", "link": "https://stackoverflow.com/users/4492495/mastro"}, "edited": false, "score": 0, "creation_date": 1423232761, "post_id": 28367718, "comment_id": 45076692, "body": "@Filippo you probably should cabalize your code to prevent such issues. For example see <a href=\"https://wiki.haskell.org/How_to_write_a_Haskell_program\" rel=\"nofollow noreferrer\">wiki.haskell.org/How_to_write_a_Haskell_program</a>"}, {"owner": {"reputation": 509, "user_id": 4492495, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/541d097065e9a9c44c7e0836046cc771?s=128&d=identicon&r=PG&f=1", "display_name": "mastro", "link": "https://stackoverflow.com/users/4492495/mastro"}, "edited": false, "score": 0, "creation_date": 1423233074, "post_id": 28367718, "comment_id": 45076871, "body": "If now I use the Lazy version of ByteStrings (<code>import qualified Data.ByteString.Lazy as B   </code>)it does not work anymore and I get a similar error as before: <code>Couldn&#39;t match type \u2018B.ByteString\u2019                   with \u2018Data.ByteString.Internal.ByteString\u2019     NB: \u2018B.ByteString\u2019 is defined in \u2018Data.ByteString.Lazy.Internal\u2019         \u2018Data.ByteString.Internal.ByteString\u2019           is defined in \u2018Data.ByteString.Internal\u2019</code>"}, {"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 0, "creation_date": 1423233829, "post_id": 28367718, "comment_id": 45077341, "body": "That&#39;s a different error. It&#39;s because lazy and strict bytestrings aren&#39;t the same type. You need to convert between them. I wrote a <a href=\"https://www.fpcomplete.com/user/tekul/bytestring-bits-and-pieces\" rel=\"nofollow noreferrer\">tutorial on bytestrings</a> a while back which you might want to take a look at."}, {"owner": {"reputation": 509, "user_id": 4492495, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/541d097065e9a9c44c7e0836046cc771?s=128&d=identicon&r=PG&f=1", "display_name": "mastro", "link": "https://stackoverflow.com/users/4492495/mastro"}, "edited": false, "score": 0, "creation_date": 1423238433, "post_id": 28367718, "comment_id": 45080205, "body": "Thank you very much, that was really helpful. Cannot believe FPComplete people are answering my stupid question. Many thanks again."}, {"owner": {"reputation": 20980, "user_id": 241990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/265f1d52e6e484c9abe60b4da20fb8ee?s=128&d=identicon&r=PG", "display_name": "Shaun the Sheep", "link": "https://stackoverflow.com/users/241990/shaun-the-sheep"}, "edited": false, "score": 0, "creation_date": 1423450413, "post_id": 28367718, "comment_id": 45139424, "body": "You&#39;re welcome. I&#39;m not an FPComplete person though :). Anyone can create an account and post content. You can also run the code in-place by clicking the little play icon in the top right corner, which is nice."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": true, "score": 2, "last_activity_date": 1423232122, "last_edit_date": 1495535610, "creation_date": 1423232122, "answer_id": 28367718, "question_id": 28367558, "link": "https://stackoverflow.com/questions/28367558/haskell-bytestring-type-error/28367718#28367718", "title": "Haskell ByteString type error", "body": "<p>Compiler is trying to tell you that you are using two different <code>bytestring</code> packages. For the details and a solution see here: <a href=\"https://stackoverflow.com/questions/12576817/couldnt-match-expected-type-with-actual-type-error-when-using-codec-bmp/12577025#12577025\">&quot;Couldn&#39;t match expected type with actual type&quot; error when using Codec.BMP</a></p>\n"}], "owner": {"reputation": 509, "user_id": 4492495, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/541d097065e9a9c44c7e0836046cc771?s=128&d=identicon&r=PG&f=1", "display_name": "mastro", "link": "https://stackoverflow.com/users/4492495/mastro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "accepted_answer_id": 28367718, "answer_count": 1, "score": 0, "last_activity_date": 1423232122, "creation_date": 1423231609, "question_id": 28367558, "link": "https://stackoverflow.com/questions/28367558/haskell-bytestring-type-error", "title": "Haskell ByteString type error", "body": "<p>It is the first time I use ByteStrings and the first time I ever see a <em>pcap</em> file.\nI am basically trying to <em>efficiently</em> read the pcap file with ByteStrings and print its content on screen.\nI am using the <a href=\"http://hackage.haskell.org/package/pcap-0.2/docs/Network-Pcap.html#t%3ACallback\" rel=\"nofollow\">Network.Pcap library</a> to read the file. The <em>ByteString variant</em> can be found here: <a href=\"https://hackage.haskell.org/package/pcap-0.4.5/docs/Network-Pcap.html#1\" rel=\"nofollow\">Network.Pcap ByteString</a>. To make things easy I want just to print the <em>first</em> line of the file so my code looks like this:</p>\n\n<pre><code>1 import qualified Data.ByteString as B\n\n2 printIt :: PktHdr -&gt; B.ByteString -&gt; IO ()\n3 printIt ph bytep = do\n4    print $ hdrCaptureLength ph  -- not important\n5    print $ bytep\n\n6 main = do\n7    f &lt;- openOffline \"file.pcap\"\n8    dispatchBS f (1) printIt\n</code></pre>\n\n<p>where <code>printIt</code> is the <em>callbackBS</em> function that operates on the body of the file.</p>\n\n<p>The compiler complains with this message:</p>\n\n<pre><code>Couldn't match type \u2018B.ByteString\u2019\n              with \u2018bytestring-0.10.4.0:Data.ByteString.Internal.ByteString\u2019\nNB: \u2018B.ByteString\u2019\n      is defined in \u2018Data.ByteString.Internal\u2019\n          in package \u2018bytestring-0.10.4.1\u2019\n    \u2018bytestring-0.10.4.0:Data.ByteString.Internal.ByteString\u2019\n      is defined in \u2018Data.ByteString.Internal\u2019\n          in package \u2018bytestring-0.10.4.0\u2019\nExpected type: CallbackBS\n  Actual type: PktHdr -&gt; B.ByteString -&gt; IO ()\nIn the third argument of \u2018dispatchBS\u2019, namely \u2018printIt\u2019\nIn a stmt of a 'do' block: dispatchBS f (1) printIt\n</code></pre>\n\n<p>What I understand is that for the compiler, the callbackBS function must have type: <code>PktHdr -&gt; ByteString -&gt; IO ()</code>, while at line <strong>2</strong> the types is <code>PktHdr -&gt;</code><strong>B.</strong><code>ByteString -&gt; IO ()</code>.\nHowever I can not simply use the type ByteString because then I would incur in conflicts with functions defined in the prelude for normal lists.\nDo you have any idea?</p>\n"}, {"tags": ["haskell", "cloud", "distributed-computing", "cloud-haskell"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1423253311, "post_id": 28366736, "comment_id": 45088238, "body": "Can you please post the code for the working <code>expect</code> version of <code>Server.hs</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1423336419, "post_id": 28385705, "comment_id": 45110138, "body": "You are right! It works - not completely, but the timeout works. Thank you for the hint with <code>runProcess</code>! The only thing that I don&#39;t get is why it does NOT compute anything (I&#39;m always getting <code>Nothing</code> from the timeout call and when we try to do <code>r &lt;- call sid (Server.Add 5 6) :: Process Double</code> the process hangs forever without getting any response. Would you be so nice and tell me why and how can I inspect such  behaviours in the future?"}, {"owner": {"reputation": 1200, "user_id": 62657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e30ea2f4bfda89a9a915dd18247d05?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/62657/jeremy"}, "reply_to_user": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1423340444, "post_id": 28385705, "comment_id": 45111452, "body": "Sorry, I didn&#39;t notice that as we weren&#39;t even printing output in the client. The problem is you were registering the pid of the main thread as though it were the server; you do a spawnLocal of your server and return this as &quot;mid&quot; - so register &quot;serverPID&quot; mid will fix that and then I do see the correct result in the client."}, {"owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1423341885, "post_id": 28385705, "comment_id": 45111849, "body": "Jeremy oh right! heh, such stupid error, thank you very very much! One last question to you - do you know why this does not work on Windows? A friend of mine was trying to execute it, but he was rejected with <code>getAddrInfo: does not exist (error 10093)</code>, which according to Windows docs means: ` 10093 - Successful WSAStartup not yet performed.` when executing <code>createTransport &quot;127.0.0.1&quot; </code> ? He was trying several adresses with the same error occuring."}, {"owner": {"reputation": 1200, "user_id": 62657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e30ea2f4bfda89a9a915dd18247d05?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/62657/jeremy"}, "reply_to_user": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "edited": false, "score": 0, "creation_date": 1423344703, "post_id": 28385705, "comment_id": 45112781, "body": "I have not used Haskell on Windows but network-transport-tcp is just using the &quot;network&quot; package under the hood, so you will find references to it. You need to use the withSocketsDo function - there is an example here: <a href=\"https://github.com/mmizzi/learnhs/blob/master/distributed/dist2.hs\" rel=\"nofollow noreferrer\">github.com/mmizzi/learnhs/blob/master/distributed/dist2.hs</a>"}, {"owner": {"reputation": 141, "user_id": 1856617, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/696de188d5a6a3dc31b31d1b79f61fc8?s=128&d=identicon&r=PG", "display_name": "hyperthunk", "link": "https://stackoverflow.com/users/1856617/hyperthunk"}, "edited": false, "score": 0, "creation_date": 1423821389, "post_id": 28385705, "comment_id": 45313126, "body": "We really should make TimeInterval support fromInteger I know, just haven&#39;t got around to it!"}], "tags": [], "owner": {"reputation": 1200, "user_id": 62657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24e30ea2f4bfda89a9a915dd18247d05?s=128&d=identicon&r=PG", "display_name": "Jeremy", "link": "https://stackoverflow.com/users/62657/jeremy"}, "is_accepted": true, "score": 2, "last_activity_date": 1423341760, "last_edit_date": 1423341760, "creation_date": 1423333219, "answer_id": 28385705, "question_id": 28366736, "link": "https://stackoverflow.com/questions/28366736/cloud-haskell-hanging-forever-when-sending-messages-to-managedprocess/28385705#28385705", "title": "Cloud Haskell hanging forever when sending messages to ManagedProcess", "body": "<p>Your client is getting an exception, which you are not able to observe easily because you are running your client in a forkProcess. If you want to do that it is fine but then you need to monitor or link to that process. In this case, simply using runProcess would be much simpler. If you do that, you will see you get this exception:</p>\n\n<pre><code>Worker.hs: trying to call fromInteger for a TimeInterval. Cannot guess units\n</code></pre>\n\n<p>callTimeout does not take an Integer, it takes a TimeInterval which are constructed with the functions in the Time module. This is a pseudo-Num - it does not actually support fromInteger it seems. I would consider that a bug or at least bad form (in Haskell) but in any case the way to fix your code is simply</p>\n\n<pre><code>r &lt;- callTimeout sid (Server.Add 5 6) (milliSeconds 100) :: Process (Maybe Double)\n</code></pre>\n\n<p>To fix the problem with the client calling into the server, you need to register the pid of the server process you spawned rather than the main process you spawn it from - i.e. change</p>\n\n<pre><code>self &lt;- getSelfPid\nregister \"serverPID\" self\n\nliftIO $ putStrLn \"x\"\nmid &lt;- launchServer\nliftIO $ putStrLn \"y\"\n</code></pre>\n\n<p>to</p>\n\n<pre><code>mid &lt;- launchServer\nregister \"serverPID\" mid\nliftIO $ putStrLn \"y\"\n</code></pre>\n"}], "owner": {"reputation": 10726, "user_id": 889902, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/ops76.png?s=128&g=1", "display_name": "Wojciech Danilo", "link": "https://stackoverflow.com/users/889902/wojciech-danilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 458, "favorite_count": 3, "accepted_answer_id": 28385705, "answer_count": 1, "score": 11, "last_activity_date": 1423341760, "creation_date": 1423228791, "question_id": 28366736, "link": "https://stackoverflow.com/questions/28366736/cloud-haskell-hanging-forever-when-sending-messages-to-managedprocess", "title": "Cloud Haskell hanging forever when sending messages to ManagedProcess", "body": "<p><strong>The Problem</strong></p>\n\n<p>Hello! I'm writing in Cloud Haskell a simple Server - Worker program. The problem is, that when I try to create <code>ManagedProcess</code>, after the server disovery step, my example hangs forever even while using <code>callTimeout</code> (which should break after 100 ms). The code is very simple, but I cannot find anything wrong with it. </p>\n\n<p>I've posted the question on the mailing list also, but as far as I know the SO community, I canget the answer a lot faster here. If I get the answer from mailing list, I will postit here also.</p>\n\n<p><strong>Source Code</strong></p>\n\n<p>The <code>Worker.hs</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable        #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE DeriveGeneric             #-}\n{-# LANGUAGE TemplateHaskell           #-}\n\nmodule Main where\n\nimport Network.Transport     (EndPointAddress(EndPointAddress))\nimport Control.Distributed.Process hiding (call)\nimport Control.Distributed.Process.Platform hiding (__remoteTable)\nimport Control.Distributed.Process.Platform.Async\nimport Control.Distributed.Process.Platform.ManagedProcess\nimport Control.Distributed.Process.Platform.Time\nimport Control.Distributed.Process.Platform.Timer (sleep)\nimport Control.Distributed.Process.Closure (mkClosure, remotable)\nimport Network.Transport.TCP (createTransport, defaultTCPParameters)\nimport Control.Distributed.Process.Node hiding (call)\nimport Control.Concurrent (threadDelay)\nimport GHC.Generics (Generic)\nimport Data.Binary (Binary) \nimport Data.Typeable (Typeable)\nimport Data.ByteString.Char8 (pack)\nimport System.Environment    (getArgs)\n\nimport qualified Server as Server\n\nmain = do\n  [host, port, serverAddr] &lt;- getArgs\n\n  Right transport &lt;- createTransport host port defaultTCPParameters\n  node &lt;- newLocalNode transport initRemoteTable\n\n  let addr = EndPointAddress (pack serverAddr)\n      srvID = NodeId addr\n\n  _ &lt;- forkProcess node $ do\n    sid &lt;- discoverServer srvID\n    liftIO $ putStrLn \"x\"\n    liftIO $ print sid\n    r &lt;- callTimeout sid (Server.Add 5 6) 100 :: Process (Maybe Double)\n    liftIO $ putStrLn \"x\"\n    liftIO $ threadDelay (10 * 1000 * 1000)\n\n\n  threadDelay (10 * 1000 * 1000)\n  return ()\n\n\ndiscoverServer srvID = do\n  whereisRemoteAsync srvID \"serverPID\"\n  reply &lt;- expectTimeout 100 :: Process (Maybe WhereIsReply)\n  case reply of\n    Just (WhereIsReply _ msid) -&gt; case msid of\n      Just sid -&gt; return sid\n      Nothing  -&gt; discoverServer srvID\n    Nothing                    -&gt; discoverServer srvID\n</code></pre>\n\n<p>The <code>Server.hs</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable        #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE DeriveGeneric             #-}\n{-# LANGUAGE TemplateHaskell           #-}\n\nmodule Server where\n\nimport Control.Distributed.Process hiding (call)\nimport Control.Distributed.Process.Platform hiding (__remoteTable)\nimport Control.Distributed.Process.Platform.Async\nimport Control.Distributed.Process.Platform.ManagedProcess\nimport Control.Distributed.Process.Platform.Time\nimport Control.Distributed.Process.Platform.Timer (sleep)\nimport Control.Distributed.Process.Closure (mkClosure, remotable)\nimport Network.Transport.TCP (createTransport, defaultTCPParameters)\nimport Control.Distributed.Process.Node hiding (call)\nimport Control.Concurrent (threadDelay)\nimport GHC.Generics (Generic)\nimport Data.Binary (Binary) \nimport Data.Typeable (Typeable)\n\n\ndata Add = Add Double Double\n  deriving (Typeable, Generic)\ninstance Binary Add\n\nlaunchServer :: Process ProcessId\nlaunchServer = spawnLocal $ serve () (statelessInit Infinity) server &gt;&gt; return () where\n  server = statelessProcess { apiHandlers            = [ handleCall_ (\\(Add x y) -&gt; liftIO (putStrLn \"!\") &gt;&gt; return (x + y)) ]\n                            , unhandledMessagePolicy = Drop\n                            }\n\n\nmain = do\n  Right transport &lt;- createTransport \"127.0.0.1\" \"8080\" defaultTCPParameters\n  node &lt;- newLocalNode transport initRemoteTable\n  _ &lt;- forkProcess node $ do\n    self &lt;- getSelfPid\n    register \"serverPID\" self\n\n    liftIO $ putStrLn \"x\"\n    mid &lt;- launchServer\n    liftIO $ putStrLn \"y\"\n    r &lt;- call mid (Add 5 6) :: Process Double\n    liftIO $ print r\n    liftIO $ putStrLn \"z\"\n    liftIO $ threadDelay (10 * 1000 * 1000)\n    liftIO $ putStrLn \"z2\"\n\n  threadDelay (10 * 1000 * 1000)\n  return ()\n</code></pre>\n\n<p>We can run them as follow:</p>\n\n<pre><code>runhaskell Server.hs\nrunhaskell Worker.hs 127.0.0.2 8080 127.0.0.1:8080:0\n</code></pre>\n\n<p><strong>The Results</strong></p>\n\n<p>When we run the programs, we got following results:</p>\n\n<p>from Server:</p>\n\n<pre><code>x\ny\n!\n11.0 -- this one shows that inside the same process we were able to use the \"call\" function\nz\n-- waiting - all the output above were tests from inside the server now it waits for external messages\n</code></pre>\n\n<p>from Worker:</p>\n\n<pre><code>x\npid://127.0.0.1:8080:0:10 -- this is the process id of the server optained with whereisRemoteAsync \n-- waiting forever on the \"callTimeout sid (Server.Add 5 6) 100\" code!\n</code></pre>\n\n<p>As a sidenote - I've found out that, when sending messages with <code>send</code> (from <code>Control.Distributed.Process</code>) and reciving them with <code>expect</code> works. But sending them with <code>call</code> (from <code>Control.Distributed.Process.Platform</code>) and trying to recive them with <code>ManagedProcess</code> api handlers - hangs the <code>call</code> forever (even using <code>callTimeout</code>!)</p>\n"}, {"tags": ["haskell", "monad-transformers", "scotty"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423214037, "post_id": 28361505, "comment_id": 45066475, "body": "Interesting. I have no idea about how to do this in a generic way -- it is possible that this requires to tear apart the <code>ActionT</code> and rebuild it. However, that type is opaque, so we can not..."}, {"owner": {"reputation": 2167, "user_id": 459877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QdrXY.jpg?s=128&g=1", "display_name": "beta", "link": "https://stackoverflow.com/users/459877/beta"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423217091, "post_id": 28361505, "comment_id": 45068068, "body": "Oh. Hmm. Maybe you&#39;re right. I could of course explicitly pass the config to the handlers and from there on to the functions they call, but I had this vague idea that whenever one does that, <code>Reader</code> can be used instead."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1423218932, "post_id": 28361505, "comment_id": 45069158, "body": "The issue seems to be turning <code>t1 (t2 m) a</code> into <code>t1 m a</code>, where <code>t1,t2</code> are monad transformers. Or, more generically, <code>t m1 a</code> into <code>t m2 a</code> where <code>m1,m2</code> are monads. This looks as a functor-ish requirement on <code>t</code>: given <code>f :: forall b. m1 b -&gt; m2 b</code> you would like to have <code>fmapT f :: t m1 a -&gt; t m2 a</code>. Maybe not all transformers would allow <code>fmapT</code> but this could be a typeclass on its own. Or maybe there&#39;s some way to craft it with standard tools I am not seeing right now :-/"}], "answers": [{"comments": [{"owner": {"reputation": 2167, "user_id": 459877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QdrXY.jpg?s=128&g=1", "display_name": "beta", "link": "https://stackoverflow.com/users/459877/beta"}, "edited": false, "score": 0, "creation_date": 1423247802, "post_id": 28367915, "comment_id": 45085384, "body": "Right. I guess that&#39;s the way to do it. I would prefer to avoid <code>lift</code>s for <code>ActionM</code> operations, since there will be far, far fewer <code>Reader</code> operations, but perhaps that&#39;s unavoidable."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 5, "last_activity_date": 1423232772, "creation_date": 1423232772, "answer_id": 28367915, "question_id": 28361505, "link": "https://stackoverflow.com/questions/28361505/scotty-monad-transformer-for-per-handler-reader/28367915#28367915", "title": "Scotty monad transformer for per-handler Reader", "body": "<p>If you want to run each action in a separate reader, you don't need the more complex <code>Scotty.Trans</code> interface at all. You can just build you monad stack the other way around, with <code>ReaderT</code> on top.</p>\n\n<pre><code>import qualified Data.Text.Lazy as T\nimport           Control.Monad.Reader\nimport           Web.Scotty\n\ntype ActionD = ReaderT String ActionM\n\nmain :: IO ()\nmain = do\n  scotty 3000 app\n\n-- Application\napp ::  ScottyM ()\napp = do\n  get \"/foo\" $ do\n    runReaderT handler \"foo\"\n\n-- Route action handler\nhandler ::  ActionD ()\nhandler = do\n  config &lt;- ask\n  lift $ html $ T.pack $ show config\n</code></pre>\n"}], "owner": {"reputation": 2167, "user_id": 459877, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/QdrXY.jpg?s=128&g=1", "display_name": "beta", "link": "https://stackoverflow.com/users/459877/beta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 1, "accepted_answer_id": 28367915, "answer_count": 1, "score": 5, "last_activity_date": 1423232772, "creation_date": 1423211321, "last_edit_date": 1495541858, "question_id": 28361505, "link": "https://stackoverflow.com/questions/28361505/scotty-monad-transformer-for-per-handler-reader", "title": "Scotty monad transformer for per-handler Reader", "body": "<p>In the question <a href=\"https://stackoverflow.com/questions/22703289/web-scotty-connection-pool-as-monad-reader\">Web, Scotty: connection pool as monad reader</a> it is shown how to use <code>ScottyT</code> to embed a <code>Reader</code> monad in the stack to access a static configuration (in that case, a connection pool).</p>\n\n<p>I have a similar question, but simpler \u2013 or at least I thought so\u2026</p>\n\n<p>I want to add a <code>Reader</code> to a single handler (i.e. a <code>ActionT</code>), not the whole app.</p>\n\n<p>I started modifying the program from the question above, but I cannot figure out how to turn an <code>ActionT Text (ReaderT String IO)</code> into the <code>ActionT Text IO</code> the handler needs to be. After fumbling around and trying to use typed holes hoping to see how to construct this I have to give up for now and ask for help. I really feel this should be simple, but cannot figure out how to do this.</p>\n\n<p>Here's the program, with the lines where I'm stuck highlighted:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport qualified Data.Text.Lazy as T\nimport           Data.Text.Lazy (Text)\nimport           Control.Monad.Reader\nimport           Web.Scotty.Trans\n\ntype ActionD = ActionT Text (ReaderT String IO)\n\nmain :: IO ()\nmain = do\n  scottyT 3000 id id app\n\n-- Application\napp ::  ScottyT Text IO ()\napp = do\n  get \"/foo\" $ do\n    h &lt;- handler              -- ?\n    runReaderT h \"foo\"        -- ?\n--get \"/bar\" $ do\n--  h &lt;- handler\n--  runReaderT h \"bar\"\n\n-- Route action handler\nhandler ::  ActionD ()\nhandler = do\n  config &lt;- lift ask\n  html $ T.pack $ show config\n</code></pre>\n"}, {"tags": ["haskell", "rethinkdb"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423202281, "post_id": 28359014, "comment_id": 45061697, "body": "Looks like there is a function <code>run :: (Expr query, Result r) =&gt; RethinkDBHandle -&gt; query -&gt; IO r</code>, which can be instantiate with <code>Bool</code>. Alternatively, you can pattern match on the result of <code>run&#39;</code> (<code>Datum</code>) which has a constructor <code>Bool  :: Bool -&gt; Datum</code>."}], "answers": [{"tags": [], "owner": {"reputation": 5636, "user_id": 243581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d196ce09c988b9e2782f5a04a987aa?s=128&d=identicon&r=PG", "display_name": "AtnNn", "link": "https://stackoverflow.com/users/243581/atnnn"}, "is_accepted": false, "score": 1, "last_activity_date": 1423215019, "creation_date": 1423215019, "answer_id": 28362521, "question_id": 28359014, "link": "https://stackoverflow.com/questions/28359014/filter-documents-by-sub-strings-in-a-field/28362521#28362521", "title": "Filter documents by sub strings in a field", "body": "<p>I believe you are using <code>filter</code> from the Prelude.</p>\n\n<p>You should be using <code>filter</code> from the <code>Database.RethinkDB</code> module. If you import the module qualified:</p>\n\n<pre><code>import qualified Database.RethinkDB as R\n</code></pre>\n\n<p>You can then use <code>R.filter</code>:</p>\n\n<pre><code>run' h' $ table \"posts\" # R.filter (\\doc -&gt; match \"Blah\" (doc ! \"message\"))\n</code></pre>\n"}], "owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1423215019, "creation_date": 1423199745, "question_id": 28359014, "link": "https://stackoverflow.com/questions/28359014/filter-documents-by-sub-strings-in-a-field", "title": "Filter documents by sub strings in a field", "body": "<p>This is taken from API examples.</p>\n\n<pre><code>r.table('posts').filter(function(doc){\n    return doc('message').match(\"Blah\")\n}).run(conn, callback)\n</code></pre>\n\n<p>How can I do exact simple thing with the Haskell driver?</p>\n\n<p>Doing something like this</p>\n\n<pre><code>run' h' $ table \"posts\" # filter (\\doc -&gt; match \"Blah\" (doc ! \"message\"))\n</code></pre>\n\n<p>...does not make any sense as match returns ReQL, not Bool.\nAny way to use match inside filter like the above JavaScript example?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["unit-testing", "haskell", "quickcheck"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1423198665, "post_id": 28358575, "comment_id": 45060678, "body": "For what it&#39;s worth, when I try, I get a warning, too: &quot;Name prop_test found in source file but was not in scope&quot; (with a line number pointing at the call to <code>quickCheckAll</code>). Very mysterious."}], "answers": [{"tags": [], "owner": {"reputation": 17809, "user_id": 1088108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63781cd38e91aa346a3849bc3ef3e550?s=128&d=identicon&r=PG&f=1", "display_name": "&#216;rjan Johansen", "link": "https://stackoverflow.com/users/1088108/%c3%98rjan-johansen"}, "is_accepted": true, "score": 11, "last_activity_date": 1423198939, "last_edit_date": 1592644375, "creation_date": 1423198939, "answer_id": 28358874, "question_id": 28358575, "link": "https://stackoverflow.com/questions/28358575/quickcheckall-always-return-true/28358874#28358874", "title": "quickCheckAll always return &quot;True&quot;", "body": "<p>From the <a href=\"https://hackage.haskell.org/package/QuickCheck-2.7.6/docs/Test-QuickCheck-All.html\" rel=\"noreferrer\"><code>Test.QuickCheck.All</code></a> docs:</p>\n<blockquote>\n<p>To use <code>quickCheckAll</code>, add a definition to your module along the lines of</p>\n<pre><code>return []\nrunTests = $quickCheckAll\n</code></pre>\n<p>and then execute <code>runTests</code>.</p>\n<p>Note: the bizarre <code>return []</code> in the example above is needed on GHC 7.8; without it, <code>quickCheckAll</code> will not be able to find any of the properties.</p>\n</blockquote>\n<p>Adding <code>return []</code> before your <code>check</code> makes it work for me.</p>\n"}, {"tags": [], "owner": {"reputation": 76, "user_id": 7402514, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da962ad19225f6fa9b7e6539c9319a30?s=128&d=identicon&r=PG&f=1", "display_name": "Joseph Boyd", "link": "https://stackoverflow.com/users/7402514/joseph-boyd"}, "is_accepted": false, "score": 0, "last_activity_date": 1484444939, "creation_date": 1484444939, "answer_id": 41657009, "question_id": 28358575, "link": "https://stackoverflow.com/questions/28358575/quickcheckall-always-return-true/41657009#41657009", "title": "quickCheckAll always return &quot;True&quot;", "body": "<p>To use quickCheckAll, you need a function which reads: </p>\n\n<p><code>return []\nrunTests = $quickCheckAll</code></p>\n\n<p>The other comment mentions this, but doesn't point out that it will still always return true unless the function is located below all of your quickCheck functions!</p>\n"}], "owner": {"reputation": 83, "user_id": 4533286, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bXWgi2G7Bew/AAAAAAAAAAI/AAAAAAAAACk/98EZvcsCFcU/photo.jpg?sz=128", "display_name": "Ervine", "link": "https://stackoverflow.com/users/4533286/ervine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 495, "favorite_count": 1, "accepted_answer_id": 28358874, "answer_count": 2, "score": 8, "last_activity_date": 1484444939, "creation_date": 1423196747, "last_edit_date": 1592644375, "question_id": 28358575, "link": "https://stackoverflow.com/questions/28358575/quickcheckall-always-return-true", "title": "quickCheckAll always return &quot;True&quot;", "body": "<p>I'm trying to use QuickCheck following <a href=\"https://stackoverflow.com/a/5684078/4533286\">another answer</a>.\nI test like this:</p>\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\nimport Test.QuickCheck\nimport Test.QuickCheck.All\n\n\nlast' :: [a] -&gt; a\nlast' [x] = x\nlast' (_:xs) = last' xs\n\nprop_test x = last' x == last x\n\ncheck = do\n        putStrLn &quot;quickCheck&quot;\n        quickCheck (prop_test :: [Char]-&gt; Bool)\n\ncheck2 = do\n        putStrLn &quot;quickCheckAll&quot;\n        $quickCheckAll\n</code></pre>\n<p>Then I load it in winGHCI and call <code>check</code> and <code>check2</code>. I get</p>\n<pre><code>quickCheck\n*** Failed! (after 1 test): \nException:\n  list.hs:(7,1)-(8,23): Non-exhaustive patterns in function last'\n&quot;&quot;\n</code></pre>\n<p>which I think it's reasonable. However, I get this from <code>check2</code></p>\n<pre><code>quickCheckAll\nTrue\n</code></pre>\n<p>I'm confused because no matter how I change the <code>last'</code> function, even wrong, <code>quickCheckAll</code> always return True.</p>\n<p>What's wrong with my code? How can I fix this?</p>\n"}, {"tags": ["haskell", "sdl-2", "ghcjs", "kubernetes-helm"], "comments": [{"owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "edited": false, "score": 3, "creation_date": 1423179859, "post_id": 28356167, "comment_id": 45055785, "body": "It would be awesome."}, {"owner": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "edited": false, "score": 1, "creation_date": 1423181821, "post_id": 28356167, "comment_id": 45056371, "body": "You should try it and publish your results! I&#39;d be interested to know."}, {"owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "reply_to_user": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "edited": false, "score": 0, "creation_date": 1423190813, "post_id": 28356167, "comment_id": 45058709, "body": "I might. I guess my first step will be to learn Netwire. If I do something cool, I will share. For now, I think that maybe the WebKit binding could be the way to go."}, {"owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "reply_to_user": {"reputation": 866, "user_id": 2872507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49ebde219395d677c399d8e950f5a48c?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Vieth", "link": "https://stackoverflow.com/users/2872507/alexander-vieth"}, "edited": false, "score": 0, "creation_date": 1423257008, "post_id": 28356167, "comment_id": 45090046, "body": "@AlexanderVieth I found someone who didn&#39;t use WebKit but WebGl. See my own answer below."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 8, "creation_date": 1423188269, "post_id": 28356960, "comment_id": 45058069, "body": "But note that Elm is very much <i>not</i> Haskell (in my opinion, it is a vastly inferior <i>language</i> with a very nice <i>framework</i>)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1423196703, "post_id": 28356960, "comment_id": 45060223, "body": "@Cactus, Elm&#39;s compiler is <i>written</i> in Haskell, so clearly the Elmers have a more positive view of Haskell than you do of Elm."}, {"owner": {"reputation": 3893, "user_id": 126128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/65a7e11b6458430a621588e449b8f36a?s=128&d=identicon&r=PG", "display_name": "Kris Jenkins", "link": "https://stackoverflow.com/users/126128/kris-jenkins"}, "edited": false, "score": 1, "creation_date": 1434644510, "post_id": 28356960, "comment_id": 49878501, "body": "I would agree that Elm is inferior to Haskell, but I would save the phrase &#39;vastly inferior&#39; for describing JavaScript. :-D"}], "tags": [], "owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "is_accepted": false, "score": 7, "last_activity_date": 1423185739, "last_edit_date": 1423185739, "creation_date": 1423184905, "answer_id": 28356960, "question_id": 28356167, "link": "https://stackoverflow.com/questions/28356167/is-it-possible-to-run-a-game-written-in-haskell-in-the-browser-through-ghcjs-m/28356960#28356960", "title": "Is it possible to run a game written in Haskell in the browser? (Through GHCJS maybe?)", "body": "<p>Here's <a href=\"http://elm-lang.org/edit/examples/Intermediate/Pong.elm\" rel=\"noreferrer\">Pong</a> in Elm.</p>\n\n<p>And not a full game, but \n  a <a href=\"http://elm-lang.org/edit/examples/Intermediate/Turtle.elm\" rel=\"noreferrer\">turtle swimming</a></p>\n\n<p><a href=\"http://elm-lang.org/edit/examples/Intermediate/Mario.elm\" rel=\"noreferrer\">Mario walking</a> around and jumping.</p>\n\n<p>Here's a recent <a href=\"http://blog.jenkster.com/2015/02/a-brief-and-partial-review-of-haskell-in-the-browser.html\" rel=\"noreferrer\">\"Brief and Partial Review of Haskell in the Browser\"</a></p>\n"}, {"comments": [{"owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "edited": false, "score": 0, "creation_date": 1423257808, "post_id": 28374843, "comment_id": 45090429, "body": "Still, I plan to write my own little game in Haskell + GHCJS + Netwire. When done, I&#39;ll publish the src."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1429610073, "post_id": 28374843, "comment_id": 47668213, "body": "Very helpful! The blog seems useful."}], "tags": [], "owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "is_accepted": true, "score": 3, "last_activity_date": 1423256956, "creation_date": 1423256956, "answer_id": 28374843, "question_id": 28356167, "link": "https://stackoverflow.com/questions/28356167/is-it-possible-to-run-a-game-written-in-haskell-in-the-browser-through-ghcjs-m/28374843#28374843", "title": "Is it possible to run a game written in Haskell in the browser? (Through GHCJS maybe?)", "body": "<p>Well, I found this:\n<a href=\"http://www.reddit.com/r/haskell/comments/1qy8sk/online_freecell_game_in_haskellfrpghcjs_with/\" rel=\"nofollow\">A game in Haskell with Sodium FRP &amp; GHCJS</a></p>\n"}], "owner": {"reputation": 2765, "user_id": 1120410, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/667389841c856a06cbb6d2821f130056?s=128&d=identicon&r=PG", "display_name": "Lay Gonz&#225;lez", "link": "https://stackoverflow.com/users/1120410/lay-gonz%c3%a1lez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1031, "favorite_count": 3, "accepted_answer_id": 28374843, "answer_count": 2, "score": 10, "last_activity_date": 1423256956, "creation_date": 1423179847, "last_edit_date": 1592644375, "question_id": 28356167, "link": "https://stackoverflow.com/questions/28356167/is-it-possible-to-run-a-game-written-in-haskell-in-the-browser-through-ghcjs-m", "title": "Is it possible to run a game written in Haskell in the browser? (Through GHCJS maybe?)", "body": "<p>I wonder if it is currently possible to write games in Haskell with <a href=\"http://helm-engine.org\" rel=\"noreferrer\">Helm</a> or any other engine that run on the browser through GHCJS?</p>\n"}, {"tags": ["sql", "database", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 369, "user_id": 1104112, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/be5c6a75ce5ce4af54c411b488f43ca3?s=128&d=identicon&r=PG", "display_name": "MalucoMarinero", "link": "https://stackoverflow.com/users/1104112/malucomarinero"}, "is_accepted": false, "score": 1, "last_activity_date": 1423357973, "creation_date": 1423357973, "answer_id": 28389471, "question_id": 28355709, "link": "https://stackoverflow.com/questions/28355709/what-is-the-ideal-way-to-select-rows-by-projected-keys-in-groundhog-haskell/28389471#28389471", "title": "What is the ideal way to select rows by projected keys in Groundhog Haskell", "body": "<p>I'm quite certain there are more efficient ways to go about this (there's going to be a bunch of underlying queries with this approach), but this does at at least get the job done for now.</p>\n\n<pre><code>getBarsForFoo fooID = do\n    barKeys &lt;- project \n        (FooToBarRowBarField)\n        (FooToBarRowFooField ==. (Foo_FooKey fooID))\n    q &lt;- mapM (getBy) barKeys\n    return (catMaybes q :: [BarRow])\n</code></pre>\n"}], "owner": {"reputation": 369, "user_id": 1104112, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/be5c6a75ce5ce4af54c411b488f43ca3?s=128&d=identicon&r=PG", "display_name": "MalucoMarinero", "link": "https://stackoverflow.com/users/1104112/malucomarinero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1423357973, "creation_date": 1423177319, "question_id": 28355709, "link": "https://stackoverflow.com/questions/28355709/what-is-the-ideal-way-to-select-rows-by-projected-keys-in-groundhog-haskell", "title": "What is the ideal way to select rows by projected keys in Groundhog Haskell", "body": "<p>I'm trying to create a many to many table using Groundhog in Haskell, which basically looks like this if I cut away all the other logic I have:</p>\n\n<pre><code>data FooRow = FooRow {\n  fooRowUUID :: UUID\n}\nderiving instance Show FooRow\n\ndata BarRow = BarRow {\n  barRowUUID :: UUID\n}\nderiving instance Show BarRow\n\ndata FooToBarRow = FooToBarRow {\n  fooToBarRowUUID :: UUID,\n  fooToBarRowFoo :: DefaultKey FooRow,\n  fooToBarRowBar :: DefaultKey BarRow\n}\nderiving instance Show FooToBarRow\n</code></pre>\n\n<p>Now, trying to define operations, I can get and insert all of these records just fine, however I'm not sure how to go from having a FooRow, with it's ID, and then get all the related BarRows by way of the many to many table. Right now I've played with something like this:</p>\n\n<pre><code>getBarsForFoo fooID = do\n  barKeys &lt;- project \n    (FooToBarRowBarField)\n    (FooToBarRowFooField ==. (Foo_FooKey fooID))\n  select $ (BarRowUUIDField `in_` barKeys)\n</code></pre>\n\n<p>However this doesn't typecheck, with the error:</p>\n\n<pre><code>Couldn't match type 'UUID' with 'BarRow'\n</code></pre>\n\n<p>Inspecting just the results of the project with putStrLn, I can see that the type of <code>barKeys</code> is:</p>\n\n<pre><code>[Bar_BarKey UUID]\n</code></pre>\n\n<p>but I don't quite understand how to make use of that within my query. I don't see any examples like this in the Groundhog documentation, so I'm hoping someone will be able to put me on the right path here.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1423183813, "post_id": 28355534, "comment_id": 45056951, "body": "Is this a sandbox in a project directory (ie, same folder as a .cabal file)? If so, then an IDE which integrates with cabal <i>should</i> use it automatically (since cabal does so) when building the project. If you are using the sandbox just to keep your global/user package db&#39;s clean, then just alias <code>ghc</code> to <code>ghc -package-db=...</code> - this is what I do. This may not work, for example if your IDE calls ghc with an absolute path - so it would be helpful to know exactly what command your particular IDE calls."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1423188856, "post_id": 28355534, "comment_id": 45058230, "body": "You can use <code>cabal repl</code> to start GHCi with the packages from the sandbox available."}, {"owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "edited": false, "score": 0, "creation_date": 1423193150, "post_id": 28355534, "comment_id": 45059340, "body": "No, not a local sandbox, one global one in home directory (c:/users/name/.cabal-sandbox...). Windows doesn&#39;t have the concept of alias&#39;es - I would have to fiddle with the Haskell-platform installation, and that might break things. I thin all IDEs use direct path resolution of GHC.exe by default. Somehow the automatic use of sandboxes and previous uses of GHC do not seem perfectly integrated (yet?)."}], "answers": [{"comments": [{"owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "edited": false, "score": 0, "creation_date": 1423688415, "post_id": 28458002, "comment_id": 45254473, "body": "Thanks. But this would (will, does) also mean that this use of sandboxes is not backwards compatible with existing tools. Is there a .ghc option which could hide and yet also globalize inclusion of a standard set of installed sandbox packages?"}, {"owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "reply_to_user": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "edited": false, "score": 0, "creation_date": 1423751685, "post_id": 28458002, "comment_id": 45282621, "body": "I agree about the lack of backwards compatibility.  I wish there were more documentation of how to make various Haskell tools work together.  I don&#39;t know the answer to your question, though."}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 1, "last_activity_date": 1423668210, "creation_date": 1423668210, "answer_id": 28458002, "question_id": 28355534, "link": "https://stackoverflow.com/questions/28355534/haskell-share-modules-across-sandboxes/28458002#28458002", "title": "haskell: share modules across sandbox(es)?", "body": "<p>In general, IDEs and other tools which call cabal / GHC need to be aware of sandboxes, and behave a bit differently depending on whether or not there is a sandbox.  I can't speak to Leksah, but for emacs, knowing the CLI way makes setting up the IDE easier.</p>\n\n<p>The sandbox-aware equivalent of <code>ghci</code> is <code>cabal repl</code>.</p>\n\n<p>The sandbox-aware equivalent of <code>ghc-pkg</code> is <code>cabal sandbox hc-pkg</code>.</p>\n\n<p>It may be worth cabalizing the Diagram that you want to build.  I know this seems overkill for a single Haskell file that only depends on <code>diagrams-lib</code>.  I find it takes less time to create a <code>.cabal</code> file (or add an executable section to a common <code>my-diagrams.cabal</code>) than to figure out how to make all the tools (emacs haskell-mode, ghc-mod, hslint, GHC) pick up packages from a sandbox while building a non-cabalized file.</p>\n"}], "owner": {"reputation": 4173, "user_id": 593975, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9550b19b4c3f1dc5b72ae7c4123d817?s=128&d=identicon&r=PG", "display_name": "guthrie", "link": "https://stackoverflow.com/users/593975/guthrie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 28458002, "answer_count": 1, "score": 2, "last_activity_date": 1423668210, "creation_date": 1423176537, "last_edit_date": 1423177897, "question_id": 28355534, "link": "https://stackoverflow.com/questions/28355534/haskell-share-modules-across-sandboxes", "title": "haskell: share modules across sandbox(es)?", "body": "<p>I did an install of Diagrams, and all seemed fine.</p>\n\n<pre><code>&gt;cabal install diagrams\nResolving dependencies...\nAll the requested packages are already installed: diagrams-1.2\nUse --reinstall if you want to reinstall anyway.\n</code></pre>\n\n<p>But if I try to use it:  import Diagrams.Prelude</p>\n\n<pre><code> Could not find module `Diagrams.Prelude'\n  Use -v to see a list of the files searched for. \n</code></pre>\n\n<p>And:</p>\n\n<pre><code>&gt;ghc-pkg list diagrams\nWARNING: there are broken packages.\nRun 'ghc-pkg check' for more details.\ne:/Plang/Haskell Platform\\lib\\package.conf.d:\n    (no packages)\nC:\\Users\\guthrie\\AppData\\Roaming\\ghc\\i386-mingw32-7.8.3\\package.conf.d:\n    (no packages)\n</code></pre>\n\n<p>(The broken packages are all old versions of things that have a good newer version installed.)</p>\n\n<p>It seems to be installed in .cabal-sandbox, but that is not reported by ghc-pkg (?):</p>\n\n<p><code>C:\\Users\\guthrie\\.cabal-sandbox\\i386-windows-ghc-7.8.3-packages.conf.d</code>\\Diagrams...</p>\n\n<p>I understand that instead of GHCi I could use \u201ccabal repl\u201d which would add additional package library references to this to the path, but I want to use these installed libraries from other Haskell IDEs (Heat, Leksah).</p>\n\n<p>I am not sure if this sandbox is a remnant for a previous cabal-install that would not work otherwise, or if the new cabal version (1.22) uses them automatically, or\u2026</p>\n\n<p>I found that using \u201ccabal exec ghc\u201d might solve this, but I tried it, and although putting in the explicit path myself worked, I didn't find the right usage for this:</p>\n\n<pre><code>-- Good:\nghc --make Program.hs -package-db=c:\\users\\name\\.cabal-sandbox\\i386-windows-ghc-7.8.3-packages.conf.d\\\n-- Fails:\ncabal ghc --make Program.hs\n</code></pre>\n\n<p>Also current IDEs don\u2019t have this option.  Do I have to then add a command line option pointing to this directory ( <em>-package-db=</em> ) to all other tools that use GHC? and is this the right approach?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1423174136, "post_id": 28354999, "comment_id": 45053577, "body": "&quot;However, in ghc it gives me an error&quot; - What error would that be?"}, {"owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1423174183, "post_id": 28354999, "comment_id": 45053600, "body": "@bheklilr &quot; No instance for (Num [a0]) arising from a use of \u2018it\u2019     In a stmt of an interactive GHCi command: print it&quot;"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1423174217, "post_id": 28354999, "comment_id": 45053607, "body": "Looks like you meant <code>foldr</code> instead of <code>foldl</code>.  If I make that change then it works for me."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 4, "creation_date": 1423174346, "post_id": 28354999, "comment_id": 45053677, "body": "You could also have done this without <code>fold</code>s as <code>verifyList f xs = concatMap (\\x -&gt; [x, x]) $ filter f xs</code>, which I would say more clearly indicates your intent.  First filter the list to find all that satisfy <code>f</code>, then duplicate each element."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1423174692, "post_id": 28354999, "comment_id": 45053838, "body": "... or the single list comprehension <code>[y | y&lt;-[x,x], x&lt;-xs, f x]</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1423181599, "post_id": 28354999, "comment_id": 45056302, "body": "@leftaroundabout, that&#39;s a really pretty way of putting it, but there is a bit of an error there. You need <code>x</code> to be in scope before you use it. Also, you should move the <code>f x</code> earlier so it doesn&#39;t check it twice for each. <code>[y | x &lt;- xs, f x, y &lt;- [x,x]]</code> should do it."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1423182468, "last_edit_date": 1592644375, "creation_date": 1423182110, "answer_id": 28356540, "question_id": 28354999, "link": "https://stackoverflow.com/questions/28354999/having-trouble-with-function-in-haskell/28356540#28356540", "title": "Having trouble with function in Haskell", "body": "<blockquote>\n<p>Looks like you meant <code>foldr</code> instead of <code>foldl</code>. If I make that change then it works for me.</p>\n<p>You could also have done this without folds as</p>\n<pre><code>verifyList f xs = concatMap (\\x -&gt; [x, x]) $ filter f xs\n</code></pre>\n<p>which I would say more clearly indicates your intent. First filter the list to find all that satisfy <code>f</code>, then duplicate each element.</p>\n</blockquote>\n<p>\u2013  bheklilr</p>\n<p>Another option based on a comment by leftaroundabout:</p>\n<pre><code>verifyList f xs = [y | x &lt;- xs, f x, y &lt;- [x, x]]\n</code></pre>\n<p>My own spin on bheklilr's approach, because I feel like it:</p>\n<pre><code>verifyList f xs = filter f xs &lt;**&gt; [id, id]\n</code></pre>\n"}], "owner": {"reputation": 407, "user_id": 4461782, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/8acec654041feaf9adda1db7b11f1d72?s=128&d=identicon&r=PG&f=1", "display_name": "laker001", "link": "https://stackoverflow.com/users/4461782/laker001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1423182468, "creation_date": 1423174041, "question_id": 28354999, "link": "https://stackoverflow.com/questions/28354999/having-trouble-with-function-in-haskell", "title": "Having trouble with function in Haskell", "body": "<p>I wrote a function to check if a list matches a condition, and if it does, it prints that value twice. However, in ghc it gives me an error, and i don't understand why...</p>\n\n<pre><code>verifyList f xs = foldl(\\x acc -&gt; if f x then x:x:acc else acc) [] xs\n</code></pre>\n\n<p>Any Help?</p>\n"}, {"tags": ["haskell", "io", "monads"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1423167723, "post_id": 28353159, "comment_id": 45050296, "body": "You&#39;d be better of using <a href=\"http://hackage.haskell.org/package/base-4.7.0.1/docs/System-IO.html#v:isEOF\" rel=\"nofollow noreferrer\"><code>isEOF</code></a>, <code>getContents</code> lazily returns the contents, which means if your processing is also lazy you&#39;ll get chunks of input as it&#39;s available.  Also, I think you mean <code>NoBuffering</code>, not <code>NoneBuffering</code>."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 3, "creation_date": 1423167810, "post_id": 28353159, "comment_id": 45050344, "body": "This won&#39;t solve your problem, but I think you meant to set buffering for <code>stdin</code>, not <code>stdout</code>."}], "answers": [{"tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 11, "last_activity_date": 1423171241, "creation_date": 1423171241, "answer_id": 28354227, "question_id": 28353159, "link": "https://stackoverflow.com/questions/28353159/haskell-getcontents-wait-for-eof/28354227#28354227", "title": "Haskell getContents wait for EOF", "body": "<p>The fundamental problem is that <code>getContents</code> is an instances of <strong>Lazy IO</strong>. This means that <code>getContents</code> produces a thunk that can be evaluated like a normal Haskell value, and only does the relevant IO <em>when it's forced</em>.</p>\n\n<p><code>contents</code> is a lazy list that <code>putStr</code> tries to print, which forces the list and causes <code>getContents</code> to read as much as it can. <code>putStr</code> then prints everything that's forced, and continues trying to force the rest of the list until it hits <code>[]</code>. As <code>getContents</code> can read more and more of the stream\u2014the exact behavior depends on buffering\u2014<code>putStr</code> can print more and more of it immediately, giving you the behavior you see.</p>\n\n<p>While this behavior is useful for very simple scripts, it ties in Haskell's evaluation order into <em>observable</em> effects\u2014something it was never meant to do. This means that controlling exactly when parts of <code>contents</code> get printed is awkward because you have to break the normal Haskell abstraction and understand exactly how things are getting evaluated.</p>\n\n<p>This leads to some potentially unintuitive behavior. For example, if you try to get the length of the input\u2014and actually <em>use</em> it\u2014the list is forced before you get to printing it, giving you the behavior you want:</p>\n\n<pre><code>main = do\n  contents &lt;- getContents\n  let n = length contents\n  print n\n  putStr contents\n</code></pre>\n\n<p>but if you move the <code>print n</code> after the <code>putStr</code>, you go back to the original behavior because <code>n</code> does not get forced until <em>after</em> printing the input (even though <code>n</code> still got <em>defined</em> before <code>putStr</code> was used):</p>\n\n<pre><code>main = do\n  contents &lt;- getContents\n  let n = length contents\n  putStr contents\n  print n\n</code></pre>\n\n<p>Normally, this sort of thing is not a problem because it won't change the <em>behavior</em> of your code (although it can affect performance). Lazy IO just brings it into the realm of correctness by piercing the abstraction layer.</p>\n\n<p>This also gives us a hint on how we can fix your issue: we need some way of forcing <code>contents</code> before printing it. As we saw, we can do this with <code>length</code> because <code>length</code> needs to traverse the whole list before computing its result. Instead of printing it, we can use <code>seq</code> which forces the lefthand expression to be evaluated at the same time as the righthand one, but throws away the actual value:</p>\n\n<pre><code>main = do\n  contents &lt;- getContents\n  let n = length contents\n  n `seq` putStr contents\n</code></pre>\n\n<p>At the same time, this is still a bit ugly because we're using <code>length</code> just to traverse the list, not because we actually care about it. What we would really like is a function that <em>just</em> traverses the list enough to evaluate it, without doing anything else. Happily, this is exactly what <code>deepseq</code> does (for many data structures, not just lists):</p>\n\n<pre><code>import Control.DeepSeq\nimport System.IO\n\nmain = do\n  contents &lt;- getContents\n  contents `deepseq` putStr contents\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1423172225, "post_id": 28354234, "comment_id": 45052618, "body": "Tikhon&#39;s answer is far more complete than mine, it should be accepted. I&#39;ll leave mine in place since it gives what I think is a more canonical solution to the problem (using strict ByteStrings instead of forcing a lazy thunk)."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 6, "last_activity_date": 1423171256, "creation_date": 1423171256, "answer_id": 28354234, "question_id": 28353159, "link": "https://stackoverflow.com/questions/28353159/haskell-getcontents-wait-for-eof/28354234#28354234", "title": "Haskell getContents wait for EOF", "body": "<p>This is a problem of lazy I/O. One simple solution is to use strict I/O, such as via ByteStrings:</p>\n\n<pre><code>import qualified Data.ByteString as S\n\nmain :: IO ()\nmain = S.getContents &gt;&gt;= S.putStr\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": false, "score": 4, "last_activity_date": 1423171803, "last_edit_date": 1495535190, "creation_date": 1423171803, "answer_id": 28354409, "question_id": 28353159, "link": "https://stackoverflow.com/questions/28353159/haskell-getcontents-wait-for-eof/28354409#28354409", "title": "Haskell getContents wait for EOF", "body": "<p>You can use the replacement functions from the <code>strict</code> package <a href=\"https://hackage.haskell.org/package/strict-0.3.2/docs/System-IO-Strict.html\" rel=\"nofollow noreferrer\">(link)</a>:</p>\n\n<pre><code>import qualified System.IO.Strict as S\n\nmain = do\n  contents &lt;- S.getContents\n  putStrLn contents\n</code></pre>\n\n<p>Note that for reading there isn't a need to set buffering. Buffering really only helps when writing to files. See this answer <a href=\"https://stackoverflow.com/a/28146677/866915\">(link)</a> for more details.</p>\n\n<p>The definition of the strict version of <code>hGetContents</code> in System.IO.Strict is pretty simple:</p>\n\n<pre><code>hGetContents    :: IO.Handle -&gt; IO.IO String\nhGetContents h  = IO.hGetContents h &gt;&gt;= \\s -&gt; length s `seq` return s\n</code></pre>\n\n<p>I.e., it forces everything to read into memory by calling <code>length</code> on the string returned by the standard/lazy version of <code>hGetContents</code>.</p>\n"}], "owner": {"reputation": 1345, "user_id": 539617, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/dcf4d3b1c553fd613b717191a5642749?s=128&d=identicon&r=PG", "display_name": "Kirill Dubovikov", "link": "https://stackoverflow.com/users/539617/kirill-dubovikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2038, "favorite_count": 1, "accepted_answer_id": 28354227, "answer_count": 3, "score": 3, "last_activity_date": 1423190051, "creation_date": 1423167173, "last_edit_date": 1423190051, "question_id": 28353159, "link": "https://stackoverflow.com/questions/28353159/haskell-getcontents-wait-for-eof", "title": "Haskell getContents wait for EOF", "body": "<p>I want to wait until user input terminates with EOF and then output it all whole. Isn't that what <code>getContents</code> supposed to do? The following code outputs each time user hits enter, what am I doing wrong?</p>\n\n<pre><code>import System.IO\n\nmain = do\n  hSetBuffering stdin NoBuffering\n  contents &lt;- getContents\n  putStrLn contents\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1423149976, "post_id": 28345806, "comment_id": 45039615, "body": "You should probably add your expected result, as some might know Yesod but not Rails (e.g. <code>&lt;a href=&quot;bar&quot; rel=&quot;nofollow&quot; data-method=&quot;post&quot;&gt;foo&lt;&#47;a&gt;</code>)."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423175909, "post_id": 28345806, "comment_id": 45054308, "body": "@Zeta This also assumes that Yesod does anything with this. <code>data-method</code> by itself doesn&#39;t do anything."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1423190332, "post_id": 28345806, "comment_id": 45058596, "body": "Note that links with non-<code>GET</code> methods require Javascript on the client side, see e.g. <a href=\"http://apidock.com/rails/ActionView/Helpers/UrlHelper/link_to\" rel=\"nofollow noreferrer\">apidock.com/rails/ActionView/Helpers/UrlHelper/link_to</a> &quot;Note that if the user has JavaScript disabled, the request will fall back to using <code>GET</code>.&quot;"}, {"owner": {"reputation": 79487, "user_id": 72583, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/16a5eec5eca4550033c0e19dba3b32b8?s=128&d=identicon&r=PG", "display_name": "Jakub Arnold", "link": "https://stackoverflow.com/users/72583/jakub-arnold"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423237705, "post_id": 28345806, "comment_id": 45079725, "body": "@Zeta Thanks, I&#39;ve updated the question."}], "answers": [{"tags": [], "owner": {"reputation": 151, "user_id": 2033931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2be502055b6c21ff470730beead2a998?s=128&d=identicon&r=PG", "display_name": "pbrisbin", "link": "https://stackoverflow.com/users/2033931/pbrisbin"}, "is_accepted": false, "score": 5, "last_activity_date": 1423240267, "creation_date": 1423240267, "answer_id": 28370384, "question_id": 28345806, "link": "https://stackoverflow.com/questions/28345806/is-there-a-yesod-alternative-to-the-rails-link-to-foo-bar-method-delete/28370384#28370384", "title": "Is there a Yesod alternative to the Rails&#39; `link_to foo, bar, method: &quot;delete&quot;?", "body": "<blockquote>\n  <p>Is there a simple way to generate a link that uses a different method than GET in Yesod</p>\n</blockquote>\n\n<p>Not that I'm aware of.</p>\n\n<blockquote>\n  <p>an existing mechanism for creating POST links in Yesod</p>\n</blockquote>\n\n<p>To generate <code>POST</code> links specifically, you could render a form styled to look like a link. You could probably wrap this up in a <code>postLink :: Route -&gt; Widget</code> helper.</p>\n"}, {"comments": [{"owner": {"reputation": 79487, "user_id": 72583, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/16a5eec5eca4550033c0e19dba3b32b8?s=128&d=identicon&r=PG", "display_name": "Jakub Arnold", "link": "https://stackoverflow.com/users/72583/jakub-arnold"}, "edited": false, "score": 0, "creation_date": 1424009705, "post_id": 28379873, "comment_id": 45369502, "body": "Thanks for this! Just one note though, the JavaScript has to send the <code>_method</code> param in the query string, not in the body, otherwise the Wai middleware won&#39;t pick it up."}], "tags": [], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "is_accepted": true, "score": 4, "last_activity_date": 1458618112, "last_edit_date": 1458618112, "creation_date": 1423295788, "answer_id": 28379873, "question_id": 28345806, "link": "https://stackoverflow.com/questions/28345806/is-there-a-yesod-alternative-to-the-rails-link-to-foo-bar-method-delete/28379873#28379873", "title": "Is there a Yesod alternative to the Rails&#39; `link_to foo, bar, method: &quot;delete&quot;?", "body": "<p>Here's an implementation of roughly what Rails is doing. This involves several parts: generating the link, using Javascript to implement the method changing functionality, and extra code for CSRF protection on the backend. Here's the linking aspect:</p>\n\n<pre><code>linkToPost :: Route App -&gt; [(Text,Text)] -&gt; Text -&gt; Widget\nlinkToPost = linkToMethod \"POST\"\n\nlinkToMethod :: Text -&gt; Route App -&gt; [(Text,Text)] -&gt; Text -&gt; Widget\nlinkToMethod method url attributes content = \n    toWidget [hamlet|\n    $newline never\n    &lt;a href=\"@{url}\" rel=\"nofollow\" data-method=\"#{method}\" *{attributes}&gt;#{content}&lt;/a&gt;\n    |]\n</code></pre>\n\n<p>Which you can use like so:</p>\n\n<pre><code>^{linkToPost CommentR [] \"Create comment\"}\n</code></pre>\n\n<p>At this point, Javascript is required to handle the <code>data-method</code> attribute. You can actually just include <a href=\"https://github.com/rails/jquery-ujs/blob/master/src/rails.js\" rel=\"nofollow\"><code>rails.js</code></a> and the above code will work fine. At the cost of considerable pain to myself and many runtime errors, I've extracted the relevant Javascript:</p>\n\n<pre><code>$(document).ready(function() {\n\n  $(document).on(\"click\", \"a[data-method]\", function() {\n    var link = $(this);\n    var method = link.data('method');\n\n    handleMethod(link);\n    return false;\n  });\n});\n\nfunction handleMethod(link) {\n  var href = link.attr('href'),\n    method = link.data('method'),\n    csrfToken = $('meta[name=csrf-token]').attr('content'),\n    form = $('&lt;form method=\"POST\" action=\"' + href + '\"&gt;&lt;/form&gt;'),\n    metadataInput = '&lt;input name=\"_method\" value=\"' + method + '\" type=\"hidden\" /&gt;';\n\n  if (csrfToken !== undefined) {\n    metadataInput += '&lt;input name=\"_token\" value=\"' + csrfToken + '\" type=\"hidden\" /&gt;';\n  }\n\n  form.hide().append(metadataInput).appendTo('body');\n\n  form.submit();\n}\n</code></pre>\n\n<p>Note that if the form has a method of type POST and a <code>_method</code> parameter, Yesod's default <a href=\"https://github.com/yesodweb/wai/blob/07688c086ad26ea91b1009bb58cdb5cbae7c8e9b/wai-extra/Network/Wai/Middleware/MethodOverridePost.hs\" rel=\"nofollow\">middleware</a> will override the method to the value of <code>_method</code>, just like Rails. The above Javascript is assuming this is enabled.</p>\n\n<p>To take advantage of the CSRF protection that Rails.js is using, we need to embed the CSRF token into our page's <code>&lt;head&gt;</code>. First, I grab the CSRF token in the <code>defaultLayout</code> function:</p>\n\n<pre><code>mCsrfToken &lt;- fmap reqToken getRequest\n</code></pre>\n\n<p>Then embed it into the page header inside <code>default-layout-wrapper.hamlet</code>:</p>\n\n<pre><code>$maybe token &lt;- mCsrfToken\n  &lt;meta name=\"csrf-token\" content=#{token}&gt;\n</code></pre>\n\n<p>At this point, the normal CSRF protection used for forms can be applied. It's getting late for me, but I came up with this as a way for simple requests (like DELETE /users/1) to check the CSRF token, there might be a better way than this:</p>\n\n<pre><code>checkCsrf :: Handler ()\ncheckCsrf = do\n    ((res, _), _) &lt;- runFormPost (renderDivs (mempty :: AForm Handler () ))\n    case res of\n        FormSuccess _ -&gt; return ()\n        _ -&gt; permissionDenied \"CSRF failure\"\n</code></pre>\n\n<p>This was a long answer + I'm getting tired, so code review on the above is welcome.</p>\n\n<h2>Update</h2>\n\n<p>Now that Yesod has support for <a href=\"http://haddock.stackage.org/lts-5.9/yesod-core-1.4.19/Yesod-Core-Handler.html#g:28\" rel=\"nofollow\">embedding CSRF tokens in cookies</a>, and validating them in request headers, you probably want to use that rather than embed the token in the HTML and making your request a form. Reasoning: </p>\n\n<ul>\n<li>Looking up a value from a cookie is simpler and better supported than an HTML query.</li>\n<li>Adding a request header is compatible with POSTing JSON/binary data, etc. It seems far less hacky to me.</li>\n<li>All this is explicitly supported by tested by Yesod</li>\n</ul>\n"}], "owner": {"reputation": 79487, "user_id": 72583, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/16a5eec5eca4550033c0e19dba3b32b8?s=128&d=identicon&r=PG", "display_name": "Jakub Arnold", "link": "https://stackoverflow.com/users/72583/jakub-arnold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 1, "accepted_answer_id": 28379873, "answer_count": 2, "score": 4, "last_activity_date": 1458618112, "creation_date": 1423144601, "last_edit_date": 1423237693, "question_id": 28345806, "link": "https://stackoverflow.com/questions/28345806/is-there-a-yesod-alternative-to-the-rails-link-to-foo-bar-method-delete", "title": "Is there a Yesod alternative to the Rails&#39; `link_to foo, bar, method: &quot;delete&quot;?", "body": "<p>Is there a simple way to generate a link that uses a different method than <code>GET</code> in Yesod, such as in Ruby on Rails, where one can do <code>link_to foo, bar, method: \"post\"</code>, which would submit the link via JavaScript?</p>\n\n<p><strong>update:</strong> What Ruby on Rails does is that it generates a <code>data-method</code> attribute, which is then handled by its own JavaScript library. I'm not necessarily looking for exactly the same solution, but rather if there is an existing mechanism for creating <code>POST</code> links in Yesod.</p>\n"}, {"tags": ["c#", "linq", "list", "haskell", "f#"], "comments": [{"owner": {"reputation": 2364, "user_id": 3967289, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/78b45aa13a80357e212ca1ec4e015f54?s=128&d=identicon&r=PG&f=1", "display_name": "H W", "link": "https://stackoverflow.com/users/3967289/h-w"}, "edited": false, "score": 1, "creation_date": 1423143841, "post_id": 28345434, "comment_id": 45035173, "body": "do you always want to extend the last element of p to match it with all remaining elements of v? What if v has less elements than p?"}, {"owner": {"reputation": 567, "user_id": 781870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9405aa5856b9fdb9244f99b55dfeeaa4?s=128&d=identicon&r=PG", "display_name": "Dave Dawkins", "link": "https://stackoverflow.com/users/781870/dave-dawkins"}, "reply_to_user": {"reputation": 2364, "user_id": 3967289, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/78b45aa13a80357e212ca1ec4e015f54?s=128&d=identicon&r=PG&f=1", "display_name": "H W", "link": "https://stackoverflow.com/users/3967289/h-w"}, "edited": false, "score": 0, "creation_date": 1423144547, "post_id": 28345434, "comment_id": 45035729, "body": "@HW Good question. Strictly speaking, I&#39;ve handled that case separately. It&#39;s an error condition. The full monty solution would always be at least as long as p, with default values supplied for missing v elements. That would be brilliant to see that done as well. I ought to try and figure that out myself, but would be happy to see pointers. Thank you!"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 2, "creation_date": 1423145649, "post_id": 28345434, "comment_id": 45036512, "body": "You can also avoid creating the extended list by defining your own zip function.  E.g.  <code>zlr (x:xs) [y] = (x,y) : zlr xs [y]  ; zlr (x:xs) (y:ys) = (x,y) : zlr xs ys  ; zlr [] _ = []</code>"}, {"owner": {"reputation": 567, "user_id": 781870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9405aa5856b9fdb9244f99b55dfeeaa4?s=128&d=identicon&r=PG", "display_name": "Dave Dawkins", "link": "https://stackoverflow.com/users/781870/dave-dawkins"}, "edited": false, "score": 1, "creation_date": 1423148789, "post_id": 28345434, "comment_id": 45038773, "body": "Is anyone able to explain the downvote? Did I not do enough research?"}], "answers": [{"comments": [{"owner": {"reputation": 567, "user_id": 781870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9405aa5856b9fdb9244f99b55dfeeaa4?s=128&d=identicon&r=PG", "display_name": "Dave Dawkins", "link": "https://stackoverflow.com/users/781870/dave-dawkins"}, "edited": false, "score": 0, "creation_date": 1423145843, "post_id": 28345914, "comment_id": 45036663, "body": "Thank you. I was looking for reuse of existing functions, but your code has shown me how to avoid using yield break, which I&#39;m very happy about. If v needs to be extended, it is extended using f(p_elem) when p_elem is the corresponding item from p. I neglected to mention this."}, {"owner": {"reputation": 567, "user_id": 781870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9405aa5856b9fdb9244f99b55dfeeaa4?s=128&d=identicon&r=PG", "display_name": "Dave Dawkins", "link": "https://stackoverflow.com/users/781870/dave-dawkins"}, "edited": false, "score": 0, "creation_date": 1423146115, "post_id": 28345914, "comment_id": 45036850, "body": "I&#39;ve just seen the Haskell part to your reply (was it an edit?) - that is also very neat. Thank you."}], "tags": [], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "is_accepted": false, "score": 1, "last_activity_date": 1423145401, "last_edit_date": 1423145401, "creation_date": 1423144869, "answer_id": 28345914, "question_id": 28345434, "link": "https://stackoverflow.com/questions/28345434/extend-a-list-using-last-element-to-match-longer-list-in-linq-zip/28345914#28345914", "title": "Extend a list using last element to match longer list in LINQ zip", "body": "<p>In Haskell (<em>ghci</em>)</p>\n\n<pre><code>&gt; let p = [\"A\", \"B\", \"C\"]\n&gt; let v = [1..]\n&gt; let zipExtending a = zip (a ++ repeat (last a))\n</code></pre>\n\n<p>then </p>\n\n<pre><code>&gt; mapM_ print $ take 5 $ zipExtending p v\n(\"A\",1)\n(\"B\",2)\n(\"C\",3)\n(\"C\",4)\n(\"C\",5)\n&gt;\n</code></pre>\n\n<p>Using Linq you could create extensions</p>\n\n<pre><code>public static class Extensions {\n    public static IEnumerable&lt;A&gt; extend&lt;A&gt;(this IEnumerable&lt;A&gt; a, int count) {\n        return a.Concat(Enumerable.Range(0, Math.Max(0, count - a.Count())).Select(_ =&gt; a.Last()));\n    }\n    public static IEnumerable&lt;Tuple&lt;A, B&gt;&gt; zipExtendingBoth&lt;A, B&gt;(this IEnumerable&lt;A&gt; a, IEnumerable&lt;B&gt; b) {\n        if(!a.Any() || !b.Any())\n            return new Tuple&lt;A, B&gt; [] { };\n        return a.extend(b.Count()).Zip(b.extend(a.Count()), Tuple.Create);\n    }\n}\n</code></pre>\n\n<p>then</p>\n\n<pre><code>var p = new string [] { \"A\", \"B\", \"C\" };\nvar v = Enumerable.Range(1, 5);\nforeach(var e in p.zipExtendingBoth(v))\n    Console.Write(\"{0}, {1}\\n\", e.Item1, e.Item2);\n</code></pre>\n\n<p>with result</p>\n\n<pre><code>A, 1\nB, 2\nC, 3\nC, 4\nC, 5\n</code></pre>\n\n<p>if your \"right\" list is infinite (first can't be) then</p>\n\n<pre><code>public static class Extensions {\n    public static IEnumerable&lt;Tuple&lt;A, B&gt;&gt; zipWithInfinite&lt;A, B&gt;(this IEnumerable&lt;A&gt; a, IEnumerable&lt;B&gt; b) {\n        if(!a.Any() || !b.Any())\n            return new Tuple&lt;A, B&gt; [] { };\n        var max_a_index = a.Count() - 1;\n        return b.Select((x, i) =&gt; Tuple.Create(a.ElementAt(Math.Min(i, max_a_index)), x));\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 567, "user_id": 781870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9405aa5856b9fdb9244f99b55dfeeaa4?s=128&d=identicon&r=PG", "display_name": "Dave Dawkins", "link": "https://stackoverflow.com/users/781870/dave-dawkins"}, "edited": false, "score": 0, "creation_date": 1423145911, "post_id": 28345919, "comment_id": 45036713, "body": "Thank you, this gives me a place to go exploring in Haskell."}], "tags": [], "owner": {"reputation": 977, "user_id": 4213872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f7014478edd5344573de2b5639a3f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Lielacher", "link": "https://stackoverflow.com/users/4213872/thomas-lielacher"}, "is_accepted": false, "score": 2, "last_activity_date": 1423144879, "creation_date": 1423144879, "answer_id": 28345919, "question_id": 28345434, "link": "https://stackoverflow.com/questions/28345434/extend-a-list-using-last-element-to-match-longer-list-in-linq-zip/28345919#28345919", "title": "Extend a list using last element to match longer list in LINQ zip", "body": "<p>The function <code>repeat</code> you have mentioned could be implemented as follows:</p>\n\n<pre><code>let repeat item = \n    Seq.initInfinite (fun _ -&gt; item)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 567, "user_id": 781870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9405aa5856b9fdb9244f99b55dfeeaa4?s=128&d=identicon&r=PG", "display_name": "Dave Dawkins", "link": "https://stackoverflow.com/users/781870/dave-dawkins"}, "edited": false, "score": 0, "creation_date": 1423145419, "post_id": 28345925, "comment_id": 45036346, "body": "almostInfinite meets requirements, thank you! We have similar implementations of extend, though I return nothing if source is empty.  Thank you for the reference to morelinq."}], "tags": [], "owner": {"reputation": 91141, "user_id": 142637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9SiZh.png?s=128&g=1", "display_name": "sloth", "link": "https://stackoverflow.com/users/142637/sloth"}, "is_accepted": true, "score": 3, "last_activity_date": 1423144892, "creation_date": 1423144892, "answer_id": 28345925, "question_id": 28345434, "link": "https://stackoverflow.com/questions/28345434/extend-a-list-using-last-element-to-match-longer-list-in-linq-zip/28345925#28345925", "title": "Extend a list using last element to match longer list in LINQ zip", "body": "<p>Staying in the .Net/C# world:</p>\n\n<p>You could use something like:</p>\n\n<pre><code>var almostInfinite = items.Concat(Enumerable.Repeat(items.Last(), Int32.MaxValue));\n</code></pre>\n\n<p>but it will not yield a really infinite sequence.</p>\n\n<p>Writting your own <code>Extend</code> method isn't hard, either:</p>\n\n<pre><code>IEnumerable&lt;T&gt; Extend&lt;T&gt;(IEnumerable&lt;T&gt; source)\n{\n    // error checking omitted \n    var e = source.GetEnumerator();\n    T last = default(T);\n    while(e.MoveNext())\n        yield return last = e.Current;\n    while(true)\n        yield return last;\n}\n</code></pre>\n\n<p>You could also create another version of <code>Zip</code>. Take a look at morelinq's <a href=\"https://code.google.com/p/morelinq/source/browse/MoreLinq/Zip.cs?r=03799046f7e508c90c3733212bf6da57e55191ad\" rel=\"nofollow\"><code>Zip</code></a>, which handles source sequences of different sizes.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1423151744, "creation_date": 1423151744, "answer_id": 28348393, "question_id": 28345434, "link": "https://stackoverflow.com/questions/28345434/extend-a-list-using-last-element-to-match-longer-list-in-linq-zip/28348393#28348393", "title": "Extend a list using last element to match longer list in LINQ zip", "body": "<p>A solution in Haskell:</p>\n\n<pre><code>&gt; let extend = foldr (\\x xs -&gt; x : if null xs then repeat x else xs) [] \n</code></pre>\n\n<p>A few tests:</p>\n\n<pre><code>&gt; extend []\n[]\n&gt; take 10 $ extend [1]\n[1,1,1,1,1,1,1,1,1,1]\n&gt; take 10 $ extend [1,2,3]\n[1,2,3,3,3,3,3,3,3,3]\n</code></pre>\n\n<p>The above does not use <code>last</code>, so that we do not hold a reference to the whole input list to <code>extend</code> -- in this way it can be garbage collected.</p>\n\n<p>Of course, explicit recursion would also work:</p>\n\n<pre><code>extend :: [a] -&gt; [a]\nextend []     = []\nextend [x]    = repeat x\nextend (x:xs) = x : extend xs\n</code></pre>\n"}], "owner": {"reputation": 567, "user_id": 781870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9405aa5856b9fdb9244f99b55dfeeaa4?s=128&d=identicon&r=PG", "display_name": "Dave Dawkins", "link": "https://stackoverflow.com/users/781870/dave-dawkins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 0, "accepted_answer_id": 28345925, "answer_count": 4, "score": 4, "last_activity_date": 1423151744, "creation_date": 1423143629, "last_edit_date": 1423144254, "question_id": 28345434, "link": "https://stackoverflow.com/questions/28345434/extend-a-list-using-last-element-to-match-longer-list-in-linq-zip", "title": "Extend a list using last element to match longer list in LINQ zip", "body": "<p>I have two collections: </p>\n\n<pre><code>p = [ a, b ]\nv = [ 1, 2, 3, 4, 5 ]\n</code></pre>\n\n<p>I want to process the following tuples:</p>\n\n<pre><code>[ [a,1], [b,2], [b,3], [b,4], [b,5] ]\n</code></pre>\n\n<p>My current code is:</p>\n\n<pre><code>p.zip(v, (x,y) =&gt; { ... })\n</code></pre>\n\n<p>But of course I only end up processing:</p>\n\n<pre><code>[ [a,1], [b,2] ]\n</code></pre>\n\n<p>It feels like I want to create an infinite list of last(p), overlayed by p, which we then zip with v. Something like:</p>\n\n<pre><code>extend(p).zip( v, ... )\n</code></pre>\n\n<p>Where extend(IEnumerable list) returns</p>\n\n<pre><code>[ a, b, b, b, ..., b ] // Infinite/generated sequence\n</code></pre>\n\n<p>I think I can write extend() as an enumerator on list that when exhausted, keeps returning the last element, ad infinitum.</p>\n\n<p>What I'm interested in knowing is if there's a functional way of creating extend, by composing existing functions. I'd be happy to see it expressed in Haskell/F#, even if those functions don't exist in LINQ. I'm encouraging myself to think functionally. </p>\n\n<p>I have looked through <a href=\"https://hackage.haskell.org/package/base-4.2.0.1/docs/Data-List.html\" rel=\"nofollow\">https://hackage.haskell.org/package/base-4.2.0.1/docs/Data-List.html</a> for likely atoms but don't see anything that might create what I need.</p>\n\n<p>Thank you!</p>\n\n<p>Edit:</p>\n\n<p>I've reduced the problem further:</p>\n\n<pre><code>extend(list) = list.Concat( repeat(list.Last()) )\n\nwhere repeat(T item) returns [ item, item, ..., item ]\n</code></pre>\n\n<p>I am now searching LINQ and Haskell for existing implementations of something like \"repeat\".</p>\n"}, {"tags": ["haskell", "localization", "gtk", "gtk2hs"], "answers": [{"tags": [], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "is_accepted": true, "score": 0, "last_activity_date": 1424966999, "creation_date": 1424966999, "answer_id": 28747254, "question_id": 28344479, "link": "https://stackoverflow.com/questions/28344479/gtk2hs-set-local-format-in-a-program-or-a-widget/28747254#28747254", "title": "Gtk2Hs set local format in a program or a widget", "body": "<p>I find a way to have the correct format in the spinbutton entry by setting the text with the <code>entrySetText</code> function : </p>\n\n<pre><code>onValueSpinned spin $  do\n    val &lt;- spinButtonGetValue spin\n    entrySetText spin $ printf \"%6.2f\" val\n    return ()\n</code></pre>\n\n<p>The entry text is modified each time the value of the spinbutton is changed. The decimal mark used by <code>printf</code> is a dot <code>.</code> and is correct now.</p>\n\n<p>The following code snippet work too :</p>\n\n<pre><code>onOutput spin $  do\n    val &lt;- spinButtonGetValue spin\n    entrySetText spin $ printf \"%6.2f\" val\n    return True\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 28747254, "answer_count": 1, "score": 0, "last_activity_date": 1424966999, "creation_date": 1423140738, "last_edit_date": 1423189349, "question_id": 28344479, "link": "https://stackoverflow.com/questions/28344479/gtk2hs-set-local-format-in-a-program-or-a-widget", "title": "Gtk2Hs set local format in a program or a widget", "body": "<p>I'm trying to set the locale format of a spin button. The decimal mark on my system is a comma <code>,</code> and I would like it to become a dot <code>.</code>.</p>\n\n<p>Is there a function in GTK or Glib to set the locale formatting globally or locally on a widget.</p>\n\n<p>I looked in hackage functions named <code>local</code>, <code>format</code>, <code>decimal</code>, ... in GTK and Glib but I didn't find the appropriate function.</p>\n\n<p>I have read it is possible to set the output manually with the function <code>entrySetText</code> but I'm looking for a global setting.</p>\n\n<p>Do you know how to change locale format globally in a Gtk program? The correct function?</p>\n"}, {"tags": ["haskell", "polymorphism", "scotty"], "comments": [{"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1423133141, "post_id": 28341784, "comment_id": 45028409, "body": "Try to add type signature to <code>app</code> with explicit <code>forall</code> and most likely you&#39;d see what is wrong."}, {"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "reply_to_user": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "edited": false, "score": 0, "creation_date": 1423133335, "post_id": 28341784, "comment_id": 45028520, "body": "@Yuras I think part of this problem is that I currently have a very poor understanding of explicit <code>forall</code>, but I shall endeavor to do so."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423133671, "post_id": 28341784, "comment_id": 45028719, "body": "I guess it should be <code>app :: (forall a. DBRunner ActionM a) -&gt; ScottyM ()</code>."}, {"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423133748, "post_id": 28341784, "comment_id": 45028759, "body": "@TomEllis should I have any particular extension enabled for that? It still gives me the same error.  EDIT: okay, apologies - I had my handlers in separate functions. After adding type signatures there, and enabling more extensions (<code>RankNTypes</code> and <code>FlexibleContexts</code>) as required I&#39;m starting to see new errors. Will report back."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423133826, "post_id": 28341784, "comment_id": 45028814, "body": "Can you post your complete code?  I&#39;d like to try things out but I don&#39;t want to guess what your imports are, etc.."}, {"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423133923, "post_id": 28341784, "comment_id": 45028866, "body": "@TomEllis I&#39;m working on <a href=\"https://github.com/coursestitch/coursestitch-api/blob/master/src/Main.hs#L21-L33\" rel=\"nofollow noreferrer\">this</a>, but the <code>runDB</code> stuff hasn&#39;t been pushed because obviously it isn&#39;t working :P. I can try to make a minimal example if you&#39;d like."}, {"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423134112, "post_id": 28341784, "comment_id": 45028992, "body": "@TomEllis it appears to be working now! I&#39;ll edit my question with current code. I&#39;m still fairly mystified."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423134209, "post_id": 28341784, "comment_id": 45029046, "body": "I would also suggest getting rid of the <code>type</code> and just using <code>app :: MonadIO m =&gt; (forall a. SqlPersistT IO a -&gt; m a) -&gt; ScottyM ()</code>.  I don&#39;t think the constraint has to be inside the <code>forall</code>."}, {"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423134380, "post_id": 28341784, "comment_id": 45029145, "body": "@TomEllis I prefer having some sort of typedef to keep things brief and readable, especially since it will appear in the type of every handler (of which there are many :P). I&#39;m going to see if I can stick the <code>forall</code> in the typedef too..."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423134955, "post_id": 28341784, "comment_id": 45029477, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/3071136/what-does-the-forall-keyword-in-haskell-ghc-do\" title=\"what does the forall keyword in haskell ghc do\">stackoverflow.com/questions/3071136/&hellip;</a>? But to keep things in place: your first <code>runDB</code> call in <code>app</code> set the type variable <code>a</code> in <code>DBRunner m a</code> to <code>Entity People</code>. Therefore, the type checker assumes <code>runDB :: DBRunner ActionM (Entity People)</code>. However, your second use of <code>runDB</code> implies <code>runDB :: DBRunner ActionM (Entity Food)</code>! Oh noez! You have to tell GHC that <code>runDB</code> should take <i>any a</i>. And that&#39;s done with <code>(forall a . DBRunner ActionM a) -&gt;</code>. Note the parentheses, the <code>forall</code> may not float out."}, {"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423135246, "post_id": 28341784, "comment_id": 45029653, "body": "@Zeta that question looks very familiar from back when I was reading about <code>forall</code> in connection with <code>ST</code>. Seems it didn&#39;t sink in - but I&#39;m still confused why <code>runDB</code> needs <code>forall</code> but <code>runSqlPool</code> doesn&#39;t."}, {"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1423136213, "post_id": 28341784, "comment_id": 45030272, "body": "Because <code>runSqlPool</code> comes from the top level.  If you try to pass it in as an argument you will experience the same problem.  Alternatively if you write <code>runDB = runDB&#39; pool</code> and <code>app</code> both inside a <code>where</code> clause in the body of the <code>main</code> then you will not need <code>Rank2Types</code>."}, {"owner": {"reputation": 11930, "user_id": 492203, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/9f10a004d1907eece7f0e90623e682f4?s=128&d=identicon&r=PG", "display_name": "nyuszika7h", "link": "https://stackoverflow.com/users/492203/nyuszika7h"}, "edited": false, "score": 0, "creation_date": 1423148276, "post_id": 28341784, "comment_id": 45038409, "body": "&quot;SQlite&quot;? :( That should be either &quot;Sqlite&quot; or &quot;SQLite&quot;."}, {"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "reply_to_user": {"reputation": 11930, "user_id": 492203, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/9f10a004d1907eece7f0e90623e682f4?s=128&d=identicon&r=PG", "display_name": "nyuszika7h", "link": "https://stackoverflow.com/users/492203/nyuszika7h"}, "edited": false, "score": 0, "creation_date": 1423176575, "post_id": 28341784, "comment_id": 45054602, "body": "@nyuszika7h: fixed :)."}], "answers": [{"comments": [{"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "edited": false, "score": 0, "creation_date": 1423135077, "post_id": 28342325, "comment_id": 45029545, "body": "Thanks, this is the sort of logic I&#39;m trying to go through in my head. I&#39;ll look up <code>RankNTypes</code> to see if I can make sense of it."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 7, "last_activity_date": 1423134314, "creation_date": 1423134314, "answer_id": 28342325, "question_id": 28341784, "link": "https://stackoverflow.com/questions/28341784/when-is-a-generic-function-not-generic/28342325#28342325", "title": "When is a generic function not generic?", "body": "<p>Lets play the game:</p>\n\n<pre><code>Prelude&gt; let f str = (read str, read str)\nPrelude&gt; f \"1\" :: (Int, Float)\n(1,1.0)\n</code></pre>\n\n<p>Works as expected.</p>\n\n<pre><code>Prelude&gt; let f str = (read1 str, read1 str) where read1 = read\nPrelude&gt; f \"1\" :: (Int, Float)\n(1,1.0)\n</code></pre>\n\n<p>Works too.</p>\n\n<pre><code>Prelude&gt; let f read1 str = (read1 str, read1 str)\nPrelude&gt; f read \"1\" :: (Int, Float)\n\n&lt;interactive&gt;:21:1:\n    Couldn't match type \u2018Int\u2019 with \u2018Float\u2019\n    Expected type: (Int, Float)\n      Actual type: (Int, Int)\n    In the expression: f read \"1\" :: (Int, Float)\n    In an equation for \u2018it\u2019: it = f read \"1\" :: (Int, Float)\n</code></pre>\n\n<p>But this doesn't. What the difference?</p>\n\n<p>The last <code>f</code> has the next type:</p>\n\n<pre><code>Prelude&gt; :t f\nf :: (t1 -&gt; t) -&gt; t1 -&gt; (t, t)\n</code></pre>\n\n<p>So it doesn't work for clear reason, both elements of the tuple should have the same type.</p>\n\n<p>The fix is like that:</p>\n\n<pre><code>Prelude&gt; :set -XRankNTypes \nPrelude&gt; let f read1 str = (read1 str, read1 str); f :: (Read a1, Read a2) =&gt; (forall a . Read a =&gt; str -&gt; a) -&gt; str -&gt; (a1, a2)\nPrelude&gt; f read \"1\" :: (Int, Float)\n(1,1.0)\n</code></pre>\n\n<p>Unlikely I can come with good explanation of <code>RankNTypes</code>, so I'd not even try. There is enough resources in web.</p>\n"}, {"comments": [{"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "edited": false, "score": 0, "creation_date": 1423134909, "post_id": 28342450, "comment_id": 45029450, "body": "But how does that interact with the intuitive way that having a generic function can act on multiple types? Why can <code>runSqlPool</code> return different types? Is there a <code>forall</code> somewhere in <code>persistent</code>&#39;s bowels that I just can&#39;t see?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "edited": false, "score": 0, "creation_date": 1423135193, "post_id": 28342450, "comment_id": 45029618, "body": "@DanielBuckmaster: Nah. <code>runSqlPool</code> works for the same reason <code>f = head [&quot;Hi&quot;] ++ (show $ head [1..5])</code> works. However, if you were to use <code>runSqlPool</code> as a parameter in order to get different <code>a</code>, you would encounter the same issue - the <code>a</code> gets fixed at the first encounter."}, {"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1423135337, "post_id": 28342450, "comment_id": 45029697, "body": "@Zeta I see, so passing it as a parameter fixes its type. That makes sense, and I <i>have</i> to pass <code>runDB</code> because it relies on a pool that is constructed at runtime. I could not define <code>runDB</code> (with no <code>&#39;</code>) as a library function, only <code>runDB&#39;</code>. That&#39;s the difference with <code>runSqlPool</code>, I guess."}], "tags": [], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "is_accepted": true, "score": 20, "last_activity_date": 1423136067, "last_edit_date": 1423136067, "creation_date": 1423134740, "answer_id": 28342450, "question_id": 28341784, "link": "https://stackoverflow.com/questions/28341784/when-is-a-generic-function-not-generic/28342450#28342450", "title": "When is a generic function not generic?", "body": "<blockquote>\n  <p>It seems like GHC is saying that in fact the type of runDB becomes specialised somehow.</p>\n</blockquote>\n\n<p>Your guess is right.  Your original type was <code>app :: (MonadIO m) =&gt; (SqlPersistT IO a -&gt; m a) -&gt; ScottyM ()</code>.  This means that your <code>runDB</code> argument of type <code>SqlPersistT IO a -&gt; m a</code> can be used at any <em>one</em> type <code>a</code>.  However, the body of <code>app</code> wants to use the <code>runDB</code> argument at two different types (<code>Person</code> and <code>Food</code>) so instead we need to pass an argument that can work for any number of different types in the body.  Thus <code>app</code> needs the type</p>\n\n<pre><code>app :: MonadIO m =&gt; (forall a. SqlPersistT IO a -&gt; m a) -&gt; ScottyM ()\n</code></pre>\n\n<p>(I would suggest keeping the <code>MonadIO</code> constraint outside the <code>forall</code> but you can also put it inside.)</p>\n\n<p><em>EDIT:</em></p>\n\n<p>What's going on behind the scenes is the following:</p>\n\n<p><code>(F a -&gt; G a) -&gt; X</code> means <code>forall a. (F a -&gt; G a) -&gt; X</code>, which means <code>/\\a -&gt; (F a -&gt; G a) -&gt; X</code>.  <code>/\\</code> is the type-level lambda.  That is, the caller gets to pass in a single type <code>a</code> and a function of type <code>F a -&gt; G a</code> for that <em>particular</em> choice of <code>a</code>.</p>\n\n<p><code>(forall a. F a -&gt; G a) -&gt; X</code> means <code>(/\\a -&gt; F a -&gt; G a) -&gt; X</code> and the caller has to pass in a function which the <em>callee</em> can specialise to <em>many</em> choices of <code>a</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "edited": false, "score": 0, "creation_date": 1423137697, "post_id": 28343296, "comment_id": 45031222, "body": "This, combined with Tom Ellis&#39;s explanation of <code>forall</code> as introducing a type-level lambda, has really helped me. Thanks for going to the trouble!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 6, "last_activity_date": 1423137586, "last_edit_date": 1423137586, "creation_date": 1423137238, "answer_id": 28343296, "question_id": 28341784, "link": "https://stackoverflow.com/questions/28341784/when-is-a-generic-function-not-generic/28343296#28343296", "title": "When is a generic function not generic?", "body": "<p>To really answer the title question that apparently continues to mystify you: Haskell always chooses the most generic rank-1 type for a function, when you don't supply an explicit signature. So for <code>app</code> in the expression <code>app (runDB' pool)</code>, GHC would attempt to have type</p>\n\n<pre><code>app :: DBRunner ActionM a -&gt; ScottyM ()\n</code></pre>\n\n<p>which is in fact shorthand for</p>\n\n<pre><code>app :: forall a. ( DBRunner ActionM a -&gt; ScottyM () )\n</code></pre>\n\n<p>This is rank-1 polymorphic, because all type variables are introduced outside of the signature (there is no quantification going on in the signature itself; the argument <code>DBRunner ActionM a</code> is in fact monomorphic since <code>a</code> is fixed at that point). Actually, it is the most generic type possible: it can work with a polymorphic argument like <code>(runDB' pool)</code>, but would also be ok with monomorphic arguments.</p>\n\n<p>But it turns out the implementation of <code>app</code> can't offer that generality: it <em>needs</em> a polymorphic action, otherwise it can't feed two different types of <code>a</code> values to that action. Therefore you need to manually request the more specific type</p>\n\n<pre><code>app :: (forall a. DBRunner ActionM a) -&gt; ScottyM ()\n</code></pre>\n\n<p>which is rank-2, because it has a signature which contains a rank-1 polymorphic argument. GHC can't really know this is the type you want &ndash; there's no well defined &ldquo;most general possible rank-n type&rdquo; for an expression, since you can always push in extra quantifiers. So you must manually specify the rank-2 type.</p>\n"}], "owner": {"reputation": 6423, "user_id": 945863, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3fc8dc67b90083ba270eec63629bdd98?s=128&d=identicon&r=PG", "display_name": "Daniel Buckmaster", "link": "https://stackoverflow.com/users/945863/daniel-buckmaster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 971, "favorite_count": 1, "accepted_answer_id": 28342450, "answer_count": 3, "score": 16, "last_activity_date": 1423265417, "creation_date": 1423132815, "last_edit_date": 1423265417, "question_id": 28341784, "link": "https://stackoverflow.com/questions/28341784/when-is-a-generic-function-not-generic", "title": "When is a generic function not generic?", "body": "<p>I'm working on a Haskell server using <code>scotty</code> and <code>persistent</code>. Many handlers need access to the database connection pool, so I've taken to passing the pool around throughout the app, in this sort of fashion:</p>\n\n\n\n<pre><code>main = do\n    runNoLoggingT $ withSqlitePool \":memory:\" 10 $ \\pool -&gt;\n        liftIO $ scotty 7000 (app pool)\n\napp pool = do\n    get \"/people\" $ do\n        people &lt;- liftIO $ runSqlPool getPeople pool\n        renderPeople people\n    get \"/foods\" $ do\n        food &lt;- liftIO $ runSqlPool getFoods pool\n        renderFoods food\n</code></pre>\n\n<p>where <code>getPeople</code> and <code>getFoods</code> are appropriate <code>persistent</code> database actions that return <code>[Person]</code> and <code>[Food]</code> respectively.</p>\n\n<p>The pattern of calling <code>liftIO</code> and <code>runSqlPool</code> on a pool becomes tiresome after a while - wouldn't it be great if I could refactor them into a single function, like Yesod's <code>runDB</code>, which would just take the query and return the appropriate type. My attempt at writing something like this is:</p>\n\n\n\n<pre><code>runDB' :: (MonadIO m) =&gt; ConnectionPool -&gt; SqlPersistT IO a -&gt; m a\nrunDB' pool q = liftIO $ runSqlPool q pool\n</code></pre>\n\n<p>Now, I can write this:</p>\n\n\n\n<pre><code>main = do\n    runNoLoggingT $ withSqlitePool \":memory:\" 10 $ \\pool -&gt;\n        liftIO $ scotty 7000 $ app (runDB' pool)\n\napp runDB = do\n    get \"/people\" $ do\n        people &lt;- runDB getPeople\n        renderPeople people\n    get \"/foods\" $ do\n        food &lt;- runDB getFoods\n        renderFoods food\n</code></pre>\n\n<p>Except that GHC complains:</p>\n\n<pre><code>Couldn't match type `Food' with `Person'\nExpected type: persistent-2.1.1.4:Database.Persist.Sql.Types.SqlPersistT\n                 IO\n                 [persistent-2.1.1.4:Database.Persist.Class.PersistEntity.Entity\n                    Person]\n  Actual type: persistent-2.1.1.4:Database.Persist.Sql.Types.SqlPersistT\n                 IO\n                 [persistent-2.1.1.4:Database.Persist.Class.PersistEntity.Entity\n                    Food]\nIn the first argument of `runDB', namely `getFoods'\n</code></pre>\n\n<p>It seems like GHC is saying that in fact the type of <code>runDB</code> becomes specialised somehow. But then how are functions like <code>runSqlPool</code> defined? Its type signature looks similar to mine:</p>\n\n\n\n<pre><code>runSqlPool :: MonadBaseControl IO m =&gt; SqlPersistT m a -&gt; Pool Connection -&gt; m a\n</code></pre>\n\n<p>but it can be used with database queries that return many different types, as I was doing originally. I think there's something fundamental I'm misunderstanding about types here, but I have no idea how to find out what it is! Any help would be greatly appreciated.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>at Yuras' suggestion, I've added this:</p>\n\n\n\n<pre><code>type DBRunner m a = (MonadIO m) =&gt; SqlPersistT IO a -&gt; m a\nrunDB' :: ConnectionPool -&gt; DBRunner m a\napp :: forall a. DBRunner ActionM a -&gt; ScottyM ()\n</code></pre>\n\n<p>which required <code>-XRankNTypes</code> for the typedef. However, the compiler error is still identical.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Victory to the commentors. This allows the code to compile:</p>\n\n<pre><code>app :: (forall a. DBRunner ActionM a) -&gt; ScottyM ()\n</code></pre>\n\n<p>For which I'm grateful, but still mystified!</p>\n\n<p>The code is currently looking like <a href=\"https://github.com/coursestitch/coursestitch-api/blob/dcf7bbb43f312b717f0e3170551ab88ab062fa43/src/Model/RunDB.hs\" rel=\"nofollow\">this</a> and <a href=\"https://github.com/coursestitch/coursestitch-api/blob/dcf7bbb43f312b717f0e3170551ab88ab062fa43/src/Handlers/User.hs#L15-L18\" rel=\"nofollow\">this</a>.</p>\n"}]