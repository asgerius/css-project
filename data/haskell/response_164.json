[{"tags": ["haskell", "lambda", "rust", "closures"], "comments": [{"owner": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1519843958, "post_id": 49036486, "comment_id": 85078078, "body": "Does Haskell monomorphize their closures? I know there&#39;s some aspects around stream fusion..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8370684"}, "reply_to_user": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1519844532, "post_id": 49036486, "comment_id": 85078408, "body": "@Shepmaster I am not an expert in Haskell, and only a beginner in Rust, which is why I&#39;d like to know."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1519846658, "post_id": 49036486, "comment_id": 85079555, "body": "@Shepmaster No, Haskell closures are no more monomorphic than they need to be (with one occasionally annoying exception for top-level definitions, the monomorphism restriction, and even that can be turned off with a compiler flag)."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1519901123, "post_id": 49037129, "comment_id": 85100172, "body": "FTR, Haskell lambdas can very often be inlined too. It just usually requires that the higher-order function you <i>pass</i> the lambda to is inlined first, which can be a bit of a code bloat (but this is actually quite similar to what C++ and Rust do when instantiating templates over a lambda&#39;s type)."}], "tags": [], "owner": {"reputation": 99643, "user_id": 445517, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/57e2ba76e6290c4e9e19821a068bc8c1?s=128&d=identicon&r=PG", "display_name": "CodesInChaos", "link": "https://stackoverflow.com/users/445517/codesinchaos"}, "is_accepted": true, "score": 12, "last_activity_date": 1519845977, "creation_date": 1519845977, "answer_id": 49037129, "question_id": 49036486, "link": "https://stackoverflow.com/questions/49036486/what-is-the-difference-between-a-rust-closure-and-a-haskell-lambda/49037129#49037129", "title": "What is the difference between a Rust closure and a Haskell lambda?", "body": "<p>Rust's choice of using distinct types has two performance benefits:</p>\n\n<ul>\n<li>The compiler can stack allocate the data you close over (or embed it into the containing data structure)</li>\n<li>Since it knows which function the closure references at compile time it can statically dispatch the call and even inline the call.</li>\n</ul>\n\n<p>You can also choose to use <code>Box&lt;Fn&gt;</code> instead. That costs a heap allocation and results in an indirect call, but in exchange there is only one type per signature.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8370684"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 1, "closed_date": 1519919544, "accepted_answer_id": 49037129, "answer_count": 1, "score": 14, "last_activity_date": 1519845977, "creation_date": 1519843505, "question_id": 49036486, "link": "https://stackoverflow.com/questions/49036486/what-is-the-difference-between-a-rust-closure-and-a-haskell-lambda", "closed_reason": "Needs more focus", "title": "What is the difference between a Rust closure and a Haskell lambda?", "body": "<p>Recently I <a href=\"https://stackoverflow.com/questions/49012277/how-to-create-a-vector-of-boxed-closures-in-rust\">asked</a> about how to put a bunch of closures with the same signature into a vector in Rust. Coming from a Haskell background, it seemed a bit complicated, with Rust closures each having their own unique types and needing a trait to represent them. In Haskell, a lambda is typed by its signature and if the signature is the same, the type is the same. </p>\n\n<p>Is there a semantic difference between a Rust closure and a Haskell lambda function that makes for these differences?</p>\n"}, {"tags": ["haskell", "types", "syntax", "signature"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1519843454, "post_id": 49036437, "comment_id": 85077830, "body": "<code>t</code> is a &quot;foldable&quot;. Most collections are foldable, for example <code>Foldable []</code>, so you can perform this on a list, but usually also on <code>Tree</code>s, etc."}, {"owner": {"reputation": 803, "user_id": 2254402, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/503d598e07c6d9dae1ac961736daa0af?s=128&d=identicon&r=PG", "display_name": "heapOverflow", "link": "https://stackoverflow.com/users/2254402/heapoverflow"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1519843618, "post_id": 49036437, "comment_id": 85077901, "body": "Thanks. I think I understand what <code>Foldable</code> is. What I don&#39;t get is the syntax here and how to use Foldable for my custom functions."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1519845972, "post_id": 49036437, "comment_id": 85079209, "body": "The &quot;empty Foldable&quot; isn&#39;t defined for all <code>Foldable</code>s; each type with a <code>Foldable</code> instance defines its own."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1519851712, "post_id": 49036437, "comment_id": 85082149, "body": "... and some instances of <code>Foldable</code> don&#39;t even admit empty values (cf. <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List-NonEmpty.html\" rel=\"nofollow noreferrer\"><code>Data.List.NonEmpty</code></a>)."}], "answers": [{"tags": [], "owner": {"reputation": 1413, "user_id": 235170, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/008e1a809d4bfff794790c7cf51bcbba?s=128&d=identicon&r=PG", "display_name": "Andreas Vinter-Hviid", "link": "https://stackoverflow.com/users/235170/andreas-vinter-hviid"}, "is_accepted": false, "score": 2, "last_activity_date": 1519845595, "creation_date": 1519845595, "answer_id": 49037027, "question_id": 49036437, "link": "https://stackoverflow.com/questions/49036437/im-not-sure-i-understand-the-type-definition-of-the-foldl-function-in-haskell/49037027#49037027", "title": "I&#39;m not sure I understand the type definition of the foldl function in haskell", "body": "<p>In the context <code>(Foldable t) =&gt; ...</code> the <code>t</code> is the foldable type. An example of this could be the list  type <code>[]</code>.</p>\n\n<p>Some more concrete types for <code>foldl</code> would be</p>\n\n<pre><code>foldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldl :: (b -&gt; a -&gt; b) -&gt; b -&gt; Tree a -&gt; b\n</code></pre>\n\n<p><code>Foldable t =&gt; ...</code> can be read as <code>t</code> is required to be a <code>Foldable</code>. It is not the type constructor <code>Foldable</code> applied to the type <code>t</code>! Therefore <code>Foldable t</code> is not even a type and you can't ever use it on the right hand side of a <code>=&gt;</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 789, "user_id": 8120642, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OX8-_3nAbeE/AAAAAAAAAAI/AAAAAAAAAAA/of7PUZBmbk4/photo.jpg?sz=128", "display_name": "hegel5000", "link": "https://stackoverflow.com/users/8120642/hegel5000"}, "edited": false, "score": 0, "creation_date": 1519845835, "post_id": 49037040, "comment_id": 85079138, "body": "Also note that in Haskell, you can&#39;t put different types implementing the same typeclass into the same collection!  This is another big difference from Java which really tripped me up."}], "tags": [], "owner": {"reputation": 789, "user_id": 8120642, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OX8-_3nAbeE/AAAAAAAAAAI/AAAAAAAAAAA/of7PUZBmbk4/photo.jpg?sz=128", "display_name": "hegel5000", "link": "https://stackoverflow.com/users/8120642/hegel5000"}, "is_accepted": true, "score": 6, "last_activity_date": 1519846418, "last_edit_date": 1519846418, "creation_date": 1519845642, "answer_id": 49037040, "question_id": 49036437, "link": "https://stackoverflow.com/questions/49036437/im-not-sure-i-understand-the-type-definition-of-the-foldl-function-in-haskell/49037040#49037040", "title": "I&#39;m not sure I understand the type definition of the foldl function in haskell", "body": "<p><code>Foldable</code> is something called a \"typeclass\".  Saying <code>Foldable t =&gt;</code> declares that <code>t</code> must implement the requirements of <code>Foldable</code>.  However, <code>t</code> remains <code>t</code>, and doesn't get collapsed into a reference to a <code>Foldable</code> interface like it might in Java.  That's why you can't just have <code>Foldable a</code>.</p>\n\n<p>Definitely check out <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Foldable.html\" rel=\"noreferrer\">https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Foldable.html</a> for an explanation of the requirements of <code>Foldable</code> and what methods that gets you.</p>\n\n<p>Anyways, if you want to use one of <code>Foldable</code>'s methods, then either use a known <code>Foldable</code> type like <code>Set</code>:</p>\n\n<pre><code>import qualified Data.Set as S\nimport Data.Foldable\n\nsumSet :: (Num n) =&gt; S.Set n -&gt; n\nsumSet ns = foldl' (\\ n acc -&gt; n + acc ) 0 ns --make this pointfree if you want\n</code></pre>\n\n<p>Or you can take a type parameter and constrain it to be foldable: </p>\n\n<pre><code>sumFld :: (Num n, Foldable f) =&gt; f n -&gt; n --different signature\nsumFld ns = foldl' (\\ n acc -&gt; n + acc ) 0 ns --same implementation!\n</code></pre>\n\n<p>The following prints 6, twice:</p>\n\n<pre><code>main :: IO ()\nmain = print (sumSet $ S.fromList [1, 2, 3]) &gt;&gt; print (sumFld $ S.fromList [1, 2, 3])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1519852671, "last_edit_date": 1519852671, "creation_date": 1519850645, "answer_id": 49038215, "question_id": 49036437, "link": "https://stackoverflow.com/questions/49036437/im-not-sure-i-understand-the-type-definition-of-the-foldl-function-in-haskell/49038215#49038215", "title": "I&#39;m not sure I understand the type definition of the foldl function in haskell", "body": "<p>I like the other answers, which discuss briefly the distinction between types and classes and so answer the first half of the question in that way. To keep this answer complete, I'll reiterate this very briefly; but see the other answers for longer explanations, since I want to spend the bulk of my time on the second half of the question.</p>\n\n<p>So: <code>Foldable</code> is a typeclass (a collection of types). The <code>t</code> in the type of <code>foldl</code> rangers over types, not collections of types, and this explains why it can't be replaced by <code>Foldable</code>.</p>\n\n<p>But I think this is also a very interesting question that the other answers didn't address:</p>\n\n<blockquote>\n  <p>If I had to define <code>foldl</code> myself, I would start with the base case</p>\n\n<pre><code>foldl f b [] = []\n</code></pre>\n  \n  <p>But if the base case takes a list, than it would not make much sense to accept a <code>Foldable</code>.</p>\n</blockquote>\n\n<p>If you were to define <code>foldl</code> yourself, you would be creating an instance of <code>Foldable</code> for a <em>specific type</em>. Because in the instance you know which specific type is involved, you can write base cases for <em>that</em> type and need not know about any other instances of <code>Foldable</code>. In the <code>Foldable</code> instance for lists:</p>\n\n<pre><code>instance Foldable [] where\n    foldl f b [] = b\n</code></pre>\n\n<p>...is perfectly well-typed, because we know <code>t ~ []</code>. On the other hand, in the instance for another type, we would of course have to use a different base case. For example:</p>\n\n<pre><code>import qualified Data.Set as S\ninstance Foldable S.Set where\n    foldl f b s | S.null s = b\n</code></pre>\n\n<p>Again, this is okay <em>inside the <code>instance</code> block</em> because then we have <code>t ~ S.Set</code>. We can (and generally have to) write things that only work on <code>S.Set</code>s and would not work well with other <code>Foldable</code> instances.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1519857092, "last_edit_date": 1519857092, "creation_date": 1519851570, "answer_id": 49038443, "question_id": 49036437, "link": "https://stackoverflow.com/questions/49036437/im-not-sure-i-understand-the-type-definition-of-the-foldl-function-in-haskell/49038443#49038443", "title": "I&#39;m not sure I understand the type definition of the foldl function in haskell", "body": "<blockquote>\n<pre><code>foldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n  \n  <p>In this case, what is <code>t a</code>?</p>\n  \n  <p>I guess it means that the function is using a <code>Foldable</code> parametrized with <code>a</code> [...]</p>\n</blockquote>\n\n<p>That's exactly right. Note, however, that it is \"<strong>a</strong> <code>Foldable</code> parameterized with <code>a</code>\", and not \"<code>Foldable</code> parametrized with <code>a</code>\". As <a href=\"https://stackoverflow.com/a/49037040/2751851\">hegel5000's answer</a> explains, when you write <code>Foldable t</code> to the left of <code>=&gt;</code>, you are saying something <em>about</em> the type (constructor) <code>t</code>. Replacing <code>t a</code> with <code>Foldable a</code> would be a little like putting an adjective where a noun should be.</p>\n\n<p>Moving on to your bonus question: <code>foldl</code> happens to be a method of the <code>Foldable</code> class. That means you are able to, when writing an instance of <code>Foldable</code> for a type, to supply an appropriate definition of <code>foldl</code> in which you can make use of the specific features of the type (e.g. that <code>[]</code> is a constructor of lists -- see also <a href=\"https://stackoverflow.com/a/49038215/2751851\">Daniel Wagner's answer</a>).</p>\n\n<p>If <code>foldl</code> weren't a method of <code>Foldable</code>, though, the only things you would be able to use to deal with the <code>t a</code> argument when implementing it would be the (other) methods of <code>Foldable</code> (<code>foldr</code>, <code>foldMap</code>, etc.), as you don't know anything else about <code>t</code> other than the fact that it has a <code>Foldable</code> instance. (Perhaps surprisingly, it is possible to implement <code>foldl</code> in such a way. Such an implementation is provided as a default for the <code>foldl</code> method in the <code>Foldable</code> class, so that you don't have to implement it yourself when writing an instance if you don't consider it necessary.)</p>\n"}], "owner": {"reputation": 803, "user_id": 2254402, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/503d598e07c6d9dae1ac961736daa0af?s=128&d=identicon&r=PG", "display_name": "heapOverflow", "link": "https://stackoverflow.com/users/2254402/heapoverflow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 49037040, "answer_count": 4, "score": 3, "last_activity_date": 1519857092, "creation_date": 1519843309, "last_edit_date": 1519843522, "question_id": 49036437, "link": "https://stackoverflow.com/questions/49036437/im-not-sure-i-understand-the-type-definition-of-the-foldl-function-in-haskell", "title": "I&#39;m not sure I understand the type definition of the foldl function in haskell", "body": "<p>When I ask about the foldl type, what I see is this:</p>\n\n<pre><code>*Main&gt; :t foldl\nfoldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>In this case, what is <code>t a</code>? </p>\n\n<p>I guess it means that the function is using a <code>Foldable</code> parametrized with <code>a</code> but I'm not even really sure about the syntax. For instance, why can't I substitute <code>t a</code> with <code>Foldable a</code>?</p>\n\n<p>And, bonus question, if I had to define <code>foldl</code> myself, I would start with the base case</p>\n\n<pre><code>foldl f b [] = []\n</code></pre>\n\n<p>But if the base case takes a list, than it would not make much sense to accept a <code>Foldable</code>. What is the \"empty Foldable\" that I could use as the base case?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1519833693, "post_id": 49033681, "comment_id": 85072136, "body": "Due to operator precedence compared with the <code>.</code>"}], "answers": [{"comments": [{"owner": {"reputation": 377, "user_id": 8140404, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f1c26015079511b622e275f01e7e105a?s=128&d=identicon&r=PG&f=1", "display_name": "plx", "link": "https://stackoverflow.com/users/8140404/plx"}, "edited": false, "score": 0, "creation_date": 1519834598, "post_id": 49033816, "comment_id": 85072687, "body": "I don&#39;t understand why it&#39;s parsed as <code>((map read) . words) &lt;$&gt; getLine</code>. For example I read <code>f . g</code> as &quot;f after g&quot;. So in your example why does <code>map read</code> go first?"}, {"owner": {"reputation": 377, "user_id": 8140404, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f1c26015079511b622e275f01e7e105a?s=128&d=identicon&r=PG&f=1", "display_name": "plx", "link": "https://stackoverflow.com/users/8140404/plx"}, "edited": false, "score": 0, "creation_date": 1519835043, "post_id": 49033816, "comment_id": 85072993, "body": "oh forget about it. function application has higher precedence as you just said."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 377, "user_id": 8140404, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f1c26015079511b622e275f01e7e105a?s=128&d=identicon&r=PG&f=1", "display_name": "plx", "link": "https://stackoverflow.com/users/8140404/plx"}, "edited": false, "score": 1, "creation_date": 1520031343, "post_id": 49033816, "comment_id": 85163277, "body": "@plx: By the way, you can find the precedence of an operator easily using the <code>:info</code>/<code>:i</code> command in GHCi. For example, <code>:i .</code> shows <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c -- Defined in \u2018GHC.Base\u2019</code> <code>infixr 9 .</code>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 12, "last_activity_date": 1519833975, "creation_date": 1519833975, "answer_id": 49033816, "question_id": 49033681, "link": "https://stackoverflow.com/questions/49033681/fmap-versus/49033816#49033816", "title": "fmap versus &lt;$&gt;", "body": "<p>Precedence of operators is expressed as an integer between 0 and 9, while function application effectively has precedence 10 (higher than any operator).</p>\n\n<p><code>(.)</code> has very high precedence (9), while <code>(&lt;$&gt;)</code> has lower precedence (4), resulting in your first expression being parsed as</p>\n\n<pre><code>((map read) . words) &lt;$&gt; getLine\n</code></pre>\n\n<p>while your second expression is parsed as</p>\n\n<pre><code>(map read) . (fmap words getLine) \n</code></pre>\n\n<p>resulting in an attempt to compose an <code>IO [String]</code> value with a function of type <code>[String] -&gt; [a]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 6, "last_activity_date": 1519834053, "creation_date": 1519834053, "answer_id": 49033848, "question_id": 49033681, "link": "https://stackoverflow.com/questions/49033681/fmap-versus/49033848#49033848", "title": "fmap versus &lt;$&gt;", "body": "<p>This is due to <em>operator precedence</em>. If we look at the source code, we see that:</p>\n\n<pre><code><a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.Functor.html#%3C%24%3E\" rel=\"noreferrer\">infixl 4 &lt;$&gt;</a>\n<a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Base.html#.\" rel=\"noreferrer\">infixr 9  .</a></code></pre>\n\n<p>So that means that if you write:</p>\n\n<pre><code>  map read . words  &lt;$&gt; getLine\n</code></pre>\n\n<p>Haskell sees this as:</p>\n\n<pre><code>(map read . words) &lt;$&gt; getLine\n</code></pre>\n\n<p>But if you write:</p>\n\n<pre><code> map read  .  fmap words getLine \n</code></pre>\n\n<p>Haskell sees this as:</p>\n\n<pre><code>(map read) . (fmap words getLine)\n</code></pre>\n\n<p>So the arguments of <code>fmap</code> are different.</p>\n\n<p>If we however <em>add brackets</em>, the two will be equivalent:</p>\n\n<pre><code>import Control.Applicative\n\nmain :: IO ()\nmain = do\n  [x, y] &lt;- map read . <b>(</b>words &lt;$&gt; getLine<b>)</b>\n  putStrLn $ show (x + y)</code></pre>\n"}], "owner": {"reputation": 377, "user_id": 8140404, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f1c26015079511b622e275f01e7e105a?s=128&d=identicon&r=PG&f=1", "display_name": "plx", "link": "https://stackoverflow.com/users/8140404/plx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 578, "favorite_count": 1, "accepted_answer_id": 49033816, "answer_count": 2, "score": 2, "last_activity_date": 1546706389, "creation_date": 1519833543, "last_edit_date": 1546706389, "question_id": 49033681, "link": "https://stackoverflow.com/questions/49033681/fmap-versus", "title": "fmap versus &lt;$&gt;", "body": "<p>According to the documentation <code>&lt;$&gt;</code> is an synonym for <code>fmap</code> and they have the following types:</p>\n\n<pre><code>(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nfmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>So it seems to me, from the signatures above, that they take the arguments in the same order, the only difference being that one is infix and the other is not. I have two pieces of code, one using <code>fmap</code>, and the other using <code>&lt;$&gt;</code>. Why is it that only the former runs correctly?</p>\n\n<pre><code>import Control.Applicative\nmain :: IO ()\nmain = do\n  [x, y] &lt;- map read . words &lt;$&gt; getLine\n  putStrLn $ show (x + y)\n</code></pre>\n\n<p>This one won't compile:</p>\n\n<pre><code>import Control.Applicative\nmain :: IO ()\nmain = do\n  [x, y] &lt;- map read . fmap words getLine\n  putStrLn $ show (x + y)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 6, "creation_date": 1519802628, "post_id": 49023622, "comment_id": 85052711, "body": "<i>&quot;readFile returns a string&quot;</i>. No, <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:readFile\" rel=\"nofollow noreferrer\">it doesn&#39;t</a>."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1519815660, "post_id": 49023622, "comment_id": 85060197, "body": "@MarkSeemann Well, the <i>function</i> doesn&#39;t return a string, but it &quot;returns&quot; a string in the <code>IO</code> metaphor sense."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1519819675, "post_id": 49023622, "comment_id": 85062568, "body": "You don&#39;t seem to understand the way monads and <code>do</code>-notation works.  Might I suggest reading <a href=\"http://learnyouahaskell.com/a-fistful-of-monads\" rel=\"nofollow noreferrer\">the relevent LYAH chapter?</a>"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1519834045, "post_id": 49023622, "comment_id": 85072371, "body": "@AJFarmar They claim this is their first day of Haskell. I&#39;d be shocked if they knew how Monads and the do notation work."}, {"owner": {"reputation": 15126, "user_id": 1953800, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4173076e5187c82e74379de9aeb00aa4?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1953800/alex"}, "edited": false, "score": 1, "creation_date": 1519836312, "post_id": 49023622, "comment_id": 85073825, "body": "The <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">LYAH IO chapter</a> might be more useful."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519858375, "post_id": 49023622, "comment_id": 85085297, "body": "@Cubic you&#39;re right, I didn&#39;t see that at first. It would be best simply to read LYAH from the start."}, {"owner": {"reputation": 129, "user_id": 9422370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8dc0cbca85c313f2bba8a7519e41cb6?s=128&d=identicon&r=PG&f=1", "display_name": "Arii", "link": "https://stackoverflow.com/users/9422370/arii"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1519923796, "post_id": 49023622, "comment_id": 85114531, "body": "@AJFarmar Oh, I have. Almost twice at the time of this writing. I&#39;m hopelessly lost with monads, but I&#39;m getting there. It all just sounds pretty complicated."}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 1, "creation_date": 1519859750, "post_id": 49026702, "comment_id": 85085780, "body": "Worth pointing out that this syntax is <i>only</i> valid in <code>do</code> blocks (and ghci) - everywhere else it is <code>let x = ... in</code>"}, {"owner": {"reputation": 129, "user_id": 9422370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8dc0cbca85c313f2bba8a7519e41cb6?s=128&d=identicon&r=PG&f=1", "display_name": "Arii", "link": "https://stackoverflow.com/users/9422370/arii"}, "edited": false, "score": 0, "creation_date": 1519923856, "post_id": 49026702, "comment_id": 85114571, "body": "Heeey, there it is. Thank you. I suppose I never made the connection with the do-block."}], "tags": [], "owner": {"reputation": 2139, "user_id": 465100, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/debe4d3217980e495cf1f15e7e4b4c9f?s=128&d=identicon&r=PG", "display_name": "Artem Pelenitsyn", "link": "https://stackoverflow.com/users/465100/artem-pelenitsyn"}, "is_accepted": true, "score": 6, "last_activity_date": 1519904255, "last_edit_date": 1519904255, "creation_date": 1519812049, "answer_id": 49026702, "question_id": 49023622, "link": "https://stackoverflow.com/questions/49023622/haskell-file-i-o-return-types-not-matching/49026702#49026702", "title": "Haskell file I/O return types not matching?", "body": "<p>Here is the working example</p>\n\n<pre><code>parse :: String -&gt; String\nparse = id -- don't do anything to input\n\nmain = do\n    input &lt;- readFile \"input.txt\"\n    let output = unlines $ map parse $ lines input\n    print output\n</code></pre>\n\n<p>In your example everything is fine except for <code>output &lt;-</code> which should be replaced with the <code>let output =</code> for a reason you probably don't get yet, judging on your wording: <code>readFile</code> returns a string. As it was pointed in the comments, it is not. It returns <code>IO String</code> which means an IO-action you may fire up and get a string (or not\u2026 if, say, a file does not exist). The <code>&lt;-</code> operation lets you inspect positive outcome of this action: it says that when the action is successful, you get a string (which you called <code>input</code>). And then you can play with it.</p>\n\n<p>So why is <code>&lt;-</code> not appropriate in the second line (with <code>lines</code>, <code>map</code> and stuff)? Simply because there is no action in it. You are applying <em>pure functions</em> in there. Binding a result of pure computations is done via <code>let smth =</code>.</p>\n\n<p>Also, please, be aware that <code>&lt;-</code> as well as <code>let X =</code> belong to do-blocks, syntactic constructs designed to write a sequence of steps to process actions. In contrast, inside pure functions you can find <code>let X = \u2026 in</code> (note <code>in</code>) or <code>where X =</code> to bind intermediate results.</p>\n"}], "owner": {"reputation": 129, "user_id": 9422370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8dc0cbca85c313f2bba8a7519e41cb6?s=128&d=identicon&r=PG&f=1", "display_name": "Arii", "link": "https://stackoverflow.com/users/9422370/arii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 49026702, "answer_count": 1, "score": 1, "last_activity_date": 1519904255, "creation_date": 1519801000, "question_id": 49023622, "link": "https://stackoverflow.com/questions/49023622/haskell-file-i-o-return-types-not-matching", "title": "Haskell file I/O return types not matching?", "body": "<p>Forward notice, this is my first day of Haskell.</p>\n\n<p>So I have a function <code>parse :: String -&gt; String</code>, I'm attempting to pass a file to it as such, either through the standard,</p>\n\n<pre><code>input &lt;- readFile \"input.txt\"\n</code></pre>\n\n<p>or the other standard,</p>\n\n<pre><code>handle &lt;- openFile \"input.txt\" ReadMode\ninput &lt;- hGetContents handle\n</code></pre>\n\n<p>To which I want to perform,</p>\n\n<pre><code>output &lt;- unlines $ map parse $ lines input\n</code></pre>\n\n<p>(Or however that should be canonically formatted)<br>\nNow as I understand it, readFile returns a string, lines takes a string and returns a list of strings, and map should map over a list of strings. If this is true, then why is <code>lines input</code> telling me that got a [String] instead of a String, while omitting <code>lines</code> and just having <code>map parse input</code> tells me it got a String instead of a [String]?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "is_accepted": true, "score": 0, "last_activity_date": 1519803266, "creation_date": 1519803266, "answer_id": 49024187, "question_id": 49023620, "link": "https://stackoverflow.com/questions/49023620/string-extract-from-publickey-of-crypto-pubkey-ed25519/49024187#49024187", "title": "String Extract from PublicKey of Crypto.PubKey.Ed25519", "body": "<pre><code>(Data.ByteArray.convert  pk)::ByteString \n</code></pre>\n\n<p>This extracts ByteString (<code>\"\\134M\\130F\\142\\CAN\\190\\v,\\228\\190\\232v\\171\\243]5\\CAN\\t\\211\\151\\DC1]\\188\\t\\206\\233k\\190\\237\\218&gt;\"</code>) from <code>PublicKey \"\\134M\\130F\\142\\CAN\\190\\v,\\228\\190\\232v\\171\\243]5\\CAN\\t\\211\\151\\DC1]\\188\\t\\206\\233k\\190\\237\\218&gt;\"</code></p>\n"}], "owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "accepted_answer_id": 49024187, "answer_count": 1, "score": 1, "last_activity_date": 1519803266, "creation_date": 1519800997, "question_id": 49023620, "link": "https://stackoverflow.com/questions/49023620/string-extract-from-publickey-of-crypto-pubkey-ed25519", "title": "String Extract from PublicKey of Crypto.PubKey.Ed25519", "body": "<p>This is my code, was trying in GHCI</p>\n\n<pre><code>import Crypto.PubKey.Ed25519\nimport Crypto.Error\nimport Data.ByteString.Char8\n\nstr :: String;str = \"hellohellohellohello\u01f0ello%$*/.\u00f5\u01b2\"\n\ngetSecretKey seedString = throwCryptoError (secretKey (pack seedString))\n\ngetPublicKey secretKey = toPublic secretKey\n\nsk = getSecretKey str\n\npk = getPublicKey sk\n</code></pre>\n\n<hr>\n\n<p>here pk's value is <code>PublicKey \"\\134M\\130F\\142\\CAN\\190\\v,\\228\\190\\232v\\171\\243]5\\CAN\\t\\211\\151\\DC1]\\188\\t\\206\\233k\\190\\237\\218&gt;\"</code></p>\n\n<p>I want to extract the string part <code>\"\\134M\\130F\\142\\CAN\\190\\v,\\228\\190\\232v\\171\\243]5\\CAN\\t\\211\\151\\DC1]\\188\\t\\206\\233k\\190\\237\\218&gt;\"</code>, how can I do it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1519811690, "post_id": 49023208, "comment_id": 85057716, "body": "Although this is not an answer, there are a number of people that actually do not like the idea of <i>operator overloading</i> (and related concepts) at all. Since code becomes rather cryptic. If you read <code>f &lt;$&gt; xs</code> then it is hard to understand what that means, but <code>fmap f xs</code> already gives you a hint what you are doing. Personally I agree to some extend: if one writes <code>&lt;u, v&gt;</code> i need some additional knowledge what is going on, whereas <code>inner u v</code> actually gives a hint what it is dooing."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1519822347, "post_id": 49023208, "comment_id": 85064284, "body": "In principle, you could write your own QuasiQuoter, which allows you to define new syntax with almost total freedom, but that would require to code your own parser. I would advise against that."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1519827629, "post_id": 49023208, "comment_id": 85067941, "body": "Nitpick: there is no overloading involved in the <code>&lt;&amp;&gt;</code> example. That is just a function definition, in which the name of the function happens to be <code>&lt;&amp;&gt;</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1519836484, "post_id": 49023208, "comment_id": 85073959, "body": "Also, you can&#39;t &quot;decompose&quot; <code>&lt;&amp;&gt;</code> and interpret it as <code>&lt;...&gt;</code> somehow operating on <code>&amp;</code>. It&#39;s just a 3-character operator name, with the brackets having no more meaning than any other characters you might use in an operator name."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 8, "last_activity_date": 1519800586, "creation_date": 1519800586, "answer_id": 49023536, "question_id": 49023208, "link": "https://stackoverflow.com/questions/49023208/overload-angle-brackets-in-haskell-as-inner-product-operator/49023536#49023536", "title": "Overload angle brackets in Haskell as inner product operator", "body": "<p>No, you can't really do this. Haskell isn't Agda. Haskell recognizes <code>()</code>, <code>[]</code>, and <code>{}</code> brackets only. <code>()</code> are used only for tuple types and grouping. <code>{}</code> are used for various syntactic purposes, none of which you have any control over. <code>[]</code> are generally used for lists. You can use <code>OverloadedLists</code> and/or <code>MonadComprehensions</code> to affect the way list syntax is interpreted, but only in limited ways that don't relate to what you request. There is no way to convince Haskell that <code>&lt;</code> or <code>&gt;</code> are brackets. The only think you could probably do would be to process your own syntax with Template Haskell, but that will add additional syntactic overhead of its own.</p>\n"}], "owner": {"reputation": 437, "user_id": 5775622, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/64YBh.png?s=128&g=1", "display_name": "1234", "link": "https://stackoverflow.com/users/5775622/1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 49023536, "answer_count": 1, "score": 0, "last_activity_date": 1519800586, "creation_date": 1519799122, "question_id": 49023208, "link": "https://stackoverflow.com/questions/49023208/overload-angle-brackets-in-haskell-as-inner-product-operator", "title": "Overload angle brackets in Haskell as inner product operator", "body": "<p>I'm wondering whether I can overload angle brackets '&lt;' and '>' something like:</p>\n\n<pre><code>data Vec a = Vec [Integer] deriving Show\nlet u = Vec [1, 2, 3]\nlet v = Vec [2, 4, 5]\n\n&lt;u, v&gt; = inner product of u and v \n</code></pre>\n\n<p>I know I can overload '&lt;&amp;>' as operator like:</p>\n\n<pre><code>Vec u &lt;&amp;&gt; Vec v = Vec $ zipWith(\\x y -&gt; x*y) u v\n</code></pre>\n"}, {"tags": ["haskell", "combinators", "tacit-programming"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519826870, "post_id": 49022781, "comment_id": 85067376, "body": "For &quot;a general algorithm to make these&quot;, see <a href=\"https://stackoverflow.com/a/29596461/2751851\">luqui&#39;s answer to <i>Point Free problems in Haskell</i></a>."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1519801607, "post_id": 49023020, "comment_id": 85052213, "body": "<code>flip ((.) . (.))</code> ?"}, {"owner": {"reputation": 7284, "user_id": 1757964, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GGs4H.jpg?s=128&g=1", "display_name": "APerson", "link": "https://stackoverflow.com/users/1757964/aperson"}, "edited": false, "score": 0, "creation_date": 1519802718, "post_id": 49023020, "comment_id": 85052755, "body": "<code>flip ((.) . (.) . flip)</code>. (I eventually went with <code>(f .) . g</code> for a modicum of readability.) Thanks for the extensive answer!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 7284, "user_id": 1757964, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GGs4H.jpg?s=128&g=1", "display_name": "APerson", "link": "https://stackoverflow.com/users/1757964/aperson"}, "edited": false, "score": 1, "creation_date": 1519804697, "post_id": 49023020, "comment_id": 85053689, "body": "@APerson, from a practical standpoint, <code>(f .) . g</code> is pretty informative. You can write it <code>rmap f . g</code>, where <code>rmap</code> is from <code>Data.Profunctor</code> and <code>(.)</code> is from <code>Control.Category</code>. This generalizes the type somewhat more. You can even use <code>o</code> from <code>Data.Semigroupoid</code> instead of <code>(.)</code> for another little generality boost."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519807038, "post_id": 49023020, "comment_id": 85054901, "body": "Er... I think I got that a little confused. I shouldn&#39;t write when sleepy. I&#39;ll check the details in the morning."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 7, "last_activity_date": 1519801277, "last_edit_date": 1519801277, "creation_date": 1519798241, "answer_id": 49023020, "question_id": 49022781, "link": "https://stackoverflow.com/questions/49022781/how-can-i-make-a-combinator-with-this-type-signature/49023020#49023020", "title": "How can I make a combinator with this type signature?", "body": "<p>Our definition will start like this:</p>\n\n<pre><code>foo :: (a -&gt; b -&gt; c) -&gt; (c -&gt; d -&gt; e) -&gt; a -&gt; b -&gt; d -&gt; e\nfoo abc cde a b d = e\n</code></pre>\n\n<p>Now let's fill in the missing bits.</p>\n\n<p>We need an <code>e</code>; the only way to get that is by applying the second function to a <code>c</code> and <code>d</code>.</p>\n\n<pre><code>e = cde c d\n</code></pre>\n\n<p>We are already given a <code>d</code>, but we need a <code>c</code>. How do we get a <code>c</code>? By applying the first function to an <code>a</code> and a <code>b</code>.</p>\n\n<pre><code>c = abc a b\n</code></pre>\n\n<p>We are given both of these, so we're done.</p>\n\n<pre><code>foo :: (a -&gt; b -&gt; c) -&gt; (c -&gt; d -&gt; e) -&gt; a -&gt; b -&gt; d -&gt; e\nfoo abc cde a b d = e\n  where\n    e = cde c d\n    c = abc a b\n</code></pre>\n\n<p><strong>We might stop here.</strong> This is a perfectly good definition.</p>\n\n<hr>\n\n<p>But if we want to try to make it more terse, let's start by substituting the definition of <code>e</code></p>\n\n<pre><code>foo abc cde a b d = cde c d\n  where\n    c = abc a b\n</code></pre>\n\n<p>and then of <code>c</code></p>\n\n<pre><code>foo abc cde a b d = cde (abc a b) d\n</code></pre>\n\n<p>We immediately see that we can eta reduce to remove the <code>d</code>.</p>\n\n<pre><code>foo abc cde a b = cde (abc a b)\n</code></pre>\n\n<p><strong>The type is now slightly more general.</strong> <code>d -&gt; e</code> has collapsed into one type variable, since it can actually be anything.</p>\n\n<pre><code>foo :: (a -&gt; b -&gt; c) -&gt; (c -&gt; de) -&gt; a -&gt; b -&gt; de\n</code></pre>\n\n<p>We can now see in the aviary that our combinator is actually the blackbird, flipped.</p>\n\n<pre><code>blackbird :: (c -&gt; d) -&gt; (a -&gt; b -&gt; c) -&gt; a -&gt; b -&gt; d\n\nfoo :: (a -&gt; b -&gt; c) -&gt; (c -&gt; de) -&gt; a -&gt; b -&gt; de\nfoo = flip blackbird\n</code></pre>\n\n<p>And indeed if we look at the source for the blackbird, it looks much like what we have written.</p>\n\n<pre><code>-- | B1 combinator - blackbird - specs 'oo'.\nblackbird :: (c -&gt; d) -&gt; (a -&gt; b -&gt; c) -&gt; a -&gt; b -&gt; d\nblackbird f g x y = f (g x y)\n</code></pre>\n\n<hr>\n\n<p><strong>Can we go more point-free?</strong> We might consider uncurrying <code>abc</code></p>\n\n<pre><code>foo abc cde a b = cde (uncurry abc (a, b))\n</code></pre>\n\n<p>rewriting this nesting with function composition</p>\n\n<pre><code>foo abc cde a b = (cde . uncurry abc) (a, b)\n</code></pre>\n\n<p>and currying back again</p>\n\n<pre><code>foo abc cde a b = curry (cde . uncurry abc) a b\n</code></pre>\n\n<p>And now we can chop off two more parameters.</p>\n\n<pre><code>foo abc cde = curry (cde . uncurry abc)\n</code></pre>\n\n<p><strong>We should definitely stop here.</strong> But what if we now flip the arguments</p>\n\n<pre><code>foo = flip $ \\cde abc -&gt; curry (cde . uncurry abc)\n</code></pre>\n\n<p>rewrite the right half to make it point-free</p>\n\n<pre><code>foo = flip $ \\cde abc -&gt; (curry . ((cde .) . uncurry)) abc\n</code></pre>\n\n<p>and eta reduce once more</p>\n\n<pre><code>foo = flip $ \\cde -&gt; curry . ((cde .) . uncurry)\n</code></pre>\n\n<p>and take one final ridiculous step</p>\n\n<pre><code>foo = flip $ (curry .) . (. uncurry) . (.)\n</code></pre>\n\n<p>We are now point-free!</p>\n"}, {"comments": [{"owner": {"reputation": 7284, "user_id": 1757964, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GGs4H.jpg?s=128&g=1", "display_name": "APerson", "link": "https://stackoverflow.com/users/1757964/aperson"}, "edited": false, "score": 0, "creation_date": 1519802749, "post_id": 49023793, "comment_id": 85052772, "body": "Thanks! Didn&#39;t know about that tool!"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 6, "last_activity_date": 1519801627, "creation_date": 1519801627, "answer_id": 49023793, "question_id": 49022781, "link": "https://stackoverflow.com/questions/49022781/how-can-i-make-a-combinator-with-this-type-signature/49023793#49023793", "title": "How can I make a combinator with this type signature?", "body": "<p>There's a really easy way: cheat. Let's start by finding out what function we want. For this, we go to <a href=\"http://www.hedonisticlearning.com/djinn/\" rel=\"noreferrer\">Djinn</a>. Type in</p>\n\n<pre><code>f :: (a -&gt; b -&gt; c) -&gt; (c -&gt; d -&gt; e) -&gt; a -&gt; b -&gt; d -&gt; e\n</code></pre>\n\n<p>and it comes back with</p>\n\n<pre><code>f a b c d = b (a c d)\n</code></pre>\n\n<p>Nice. Now head over to <a href=\"http://pointfree.io\" rel=\"noreferrer\">pointfree.io</a>. Paste in the definition from Djinn, and it says</p>\n\n<pre><code>f = flip ((.) . (.))\n</code></pre>\n\n<p>Done.</p>\n"}], "owner": {"reputation": 7284, "user_id": 1757964, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GGs4H.jpg?s=128&g=1", "display_name": "APerson", "link": "https://stackoverflow.com/users/1757964/aperson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 49023020, "answer_count": 2, "score": 0, "last_activity_date": 1519801627, "creation_date": 1519797042, "last_edit_date": 1519800345, "question_id": 49022781, "link": "https://stackoverflow.com/questions/49022781/how-can-i-make-a-combinator-with-this-type-signature", "title": "How can I make a combinator with this type signature?", "body": "<p>I've been trying to make a combinator with this type signature:</p>\n\n<pre><code>(a -&gt; b -&gt; c) -&gt; (c -&gt; d -&gt; e) -&gt; a -&gt; b -&gt; d -&gt; e\n</code></pre>\n\n<p>I've been through <a href=\"https://hackage.haskell.org/package/data-aviary\" rel=\"nofollow noreferrer\">Data.Aviary.Birds</a> and all the tacit programming help sites that I can find, but to no avail. Also, if there's a general algorithm to make these, it would be greatly appreciated but not necessary.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1519769299, "post_id": 49018688, "comment_id": 85042685, "body": "team definition is like this team:: Int -&gt; Team Int(4), It take a int and return a Team like so : Team(Map.fromList [(1, [ ]),  (2, []), (3, []), (4, [])]). My code is very long sorry."}, {"owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "edited": false, "score": 0, "creation_date": 1519769317, "post_id": 49018688, "comment_id": 85042695, "body": "I&#39;ll try this one"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1519773147, "post_id": 49018688, "comment_id": 85044112, "body": "<code>pmap = Stk &lt;$ tmap</code> (at which point you can maybe skip having a <code>where</code> block at all)?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1519768972, "creation_date": 1519768972, "answer_id": 49018688, "question_id": 49018371, "link": "https://stackoverflow.com/questions/49018371/haskell-manipulate-data-type-of-a-defined-class/49018688#49018688", "title": "Haskell: manipulate data type of a defined class", "body": "<p>I think you probably want:</p>\n\n<pre><code>initPlan :: Ord p =&gt; Team p -&gt; Plan p\ninitPlan team@(Team tmap) = Plan pmap team\n  where pmap = Map.fromList $ map (\\plyr -&gt; (plyr, Stk)) plyrs\n        plyrs = Map.keys tmap\n</code></pre>\n\n<p>Given a <code>Team</code>, this gets the complete list of players (<code>plyrs</code>) from the keys in the underlying map.  Then we can construct, as a list, the pairs: <code>(1,Stk)</code>, <code>(2,Stk)</code> and so on that assign each player to the striker position, and then build the Map from that list.</p>\n\n<p>You didn't provide a definition of the <code>team</code> function, so I don't know what <code>team 4</code> is supposed to look like, but using the <code>ykTeam</code> definition above seems to work:</p>\n\n<pre><code>&gt; initPlan ykTeam\nPlan(defender={}, midlefield={}, stiker={1,2,3,4})\n&gt;\n</code></pre>\n"}], "owner": {"reputation": 447, "user_id": 4612411, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/rCwOk.jpg?s=128&g=1", "display_name": "David Edgar", "link": "https://stackoverflow.com/users/4612411/david-edgar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 49018688, "answer_count": 1, "score": 0, "last_activity_date": 1519768972, "creation_date": 1519767559, "last_edit_date": 1519768436, "question_id": 49018371, "link": "https://stackoverflow.com/questions/49018371/haskell-manipulate-data-type-of-a-defined-class", "title": "Haskell: manipulate data type of a defined class", "body": "<p>I tried to comment everything to make my code very clear to everyone.  Please read the comment to better understand.</p>\n\n<p>What I have so far, is a <code>Team</code> made up of players, and those players will eventually get a position: defender, middlefield, or striker.  For example, in:</p>\n\n<pre><code>let ykTeam = Team(Map.fromList [(1, [ 2, 3]),  (2, [1]), (3, [1, 4]), (4, [3])])\n</code></pre>\n\n<p>the item <code>(1, [ 2, 3])</code> means that player 1 can also play 2 or 3 (not so important right now).</p>\n\n<p><strong>Question</strong> : From the code shown below, I want to write the <code>initPlan</code> function, but I'm struggling to manipulate the <code>Plan</code> attribute <code>planMap :: Map.Map p Position</code>.</p>\n\n<p><strong>Expected result:</strong> When I try:</p>\n\n<pre><code>&gt; initPlan $ team 4\n</code></pre>\n\n<p>I need to get:</p>\n\n<pre><code>Plan(def={}, mid={}, stk={1,2,3,4})\n</code></pre>\n\n<p><strong>Remark:</strong> I'm used to <code>Map.Map v k</code> but not to <code>Map.Map v Position</code> ??? </p>\n\n<p>Any indications, ideas or hints are welcomed.</p>\n\n<p>My code is:</p>\n\n<pre><code>import Data.List (intercalate)\nimport qualified Data.Map as Map\n\n-- | The possible position of players on the field:\n--\n-- * `def`: the player is a defender in the team;\n-- * `mid`: the player is a midlefield in the team;\n-- * `stk`: the player is a stiker in the team;\ndata Position = Def | Mid | Stk\n    deriving (Eq, Show)\n\ndata Team t = Team (Map.Map t [t])\n\n-- | A Plan for enumerating team position.\ndata Plan p = Plan {\n    planMap   :: Map.Map p Position,\n    planTeam  :: Team p\n}\n\ninstance (Show p, Ord p) =&gt; Show (Plan p) where\n    show p@(Plan playerToPosition _) = \"Plan(\"\n        ++ \"defender={\" ++ (showByPosition Def) ++ \"}, \"\n        ++ \"midlefield={\" ++ (showByPosition Mid) ++ \"}, \"\n        ++ \"stiker={\" ++ (showByPosition Stk) ++ \"})\"\n        where showByPosition a = intercalate \",\" $ \n                map show $ playersByPosition a p\n\nplayersByPosition :: Ord p =&gt; Position -&gt; Plan p -&gt; [p]\nplayersByPosition position = Map.keys . Map.filter (== position) . planMap\n</code></pre>\n\n<p>My signature for <code>initPlan</code> is:</p>\n\n<pre><code>-- | It returns the plan of a given team\n--\n-- At the begenning, all players have position Stk.\n--\n-- &gt;&gt;&gt; initPlan $ team 4\n-- Plan(def={}, mid={}, stk={1,2,3,4})\ninitPlan :: Ord p =&gt; Team p -&gt; Plan p\ninitPlan = ???\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 2, "creation_date": 1519761606, "post_id": 49016962, "comment_id": 85038932, "body": "What do you mean by &quot;because these are data types&quot;?"}, {"owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "reply_to_user": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1519761654, "post_id": 49016962, "comment_id": 85038963, "body": "i do know how to create data types, but add some money to some accounts sounds for me really complex. i do not really know can i do that"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519761841, "post_id": 49016962, "comment_id": 85039060, "body": "Well instead of starting with writing complex functions, you perhaps first should start writing more simple ones. For instance try to fetch the balance of a given <code>ID</code> from a given bank."}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "edited": false, "score": 0, "creation_date": 1519762590, "post_id": 49017136, "comment_id": 85039426, "body": "ty very much sir. explained it really clearly"}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 5, "last_activity_date": 1519765234, "last_edit_date": 1519765234, "creation_date": 1519762227, "answer_id": 49017136, "question_id": 49016962, "link": "https://stackoverflow.com/questions/49016962/how-to-make-a-change-within-nested-data-types-in-haskell/49017136#49017136", "title": "How to make a change within nested data types in Haskell", "body": "<p>Since you defined <code>Account</code> using record syntax, we're going to use record syntax again to make a change to an account.</p>\n\n<p>How to modify an <code>Account</code> to add money to it:</p>\n\n<pre><code>creditAccount :: Int -&gt; Account -&gt; Account\ncreditAccount amount acct = acct { balance = balance acct + amount }\n</code></pre>\n\n<p>To modify a <code>Bank</code>, we're going to destructure it using a pattern match to get at the underlying list of <code>accounts</code>, then use the <code>Bank</code> constructor to lift the resulting list back into the <code>Bank</code> type.</p>\n\n<p>How to modify a <code>Bank</code> by making a modification to a particular account:</p>\n\n<pre><code>modifyAccount :: ID -&gt; (Account -&gt; Account) -&gt; Bank -&gt; Bank\nmodifyAccount i f (Bank accounts) = Bank (map g accounts)\n  where \n    g (i', acct) = (i', if i == i' then f acct else acct)\n</code></pre>\n\n<p>Putting it together, how to modify a <code>Bank</code> by crediting a particular account:</p>\n\n<pre><code>credit :: Int -&gt; ID -&gt; Bank -&gt; Bank\ncredit amount i = modifyAccount i (creditAccount amount)\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 9181581, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/81524f81f40f222f0294f539bbcfa436?s=128&d=identicon&r=PG&f=1", "display_name": "GermanNab", "link": "https://stackoverflow.com/users/9181581/germannab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "closed_date": 1519843155, "accepted_answer_id": 49017136, "answer_count": 1, "score": -2, "last_activity_date": 1519765234, "creation_date": 1519761551, "last_edit_date": 1519762647, "question_id": 49016962, "link": "https://stackoverflow.com/questions/49016962/how-to-make-a-change-within-nested-data-types-in-haskell", "closed_reason": "Needs details or clarity", "title": "How to make a change within nested data types in Haskell", "body": "<p>I got this:</p>\n\n<pre><code>type ID = Int\n\ndata Bank = Bank [(ID, Account)] deriving Show\n\ndata Account = Account\n  { balance :: Int\n  , owner :: Client\n  } deriving Show\n\ndata Client = Client\n  { name :: String\n  , surname :: String\n  , address :: String\n  } deriving Show\n</code></pre>\n\n<p>my task is, to write a function <code>credit :: Int -&gt; ID -&gt; Bank -&gt; Bank</code>\nthat Adds the specified amount of Money to the specified amount\nAccount.\nI do not know how can i actually do that, because these are data types..</p>\n"}, {"tags": ["haskell", "lazy-evaluation", "bytestring"], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 6499890, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xMnx3.png?s=128&g=1", "display_name": "Nicolas S.", "link": "https://stackoverflow.com/users/6499890/nicolas-s"}, "edited": false, "score": 0, "creation_date": 1519760947, "post_id": 49016161, "comment_id": 85038583, "body": "Thanks, you couldn&#39;t be more helpful! That&#39;s exactly what I needed"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 4, "last_activity_date": 1519758273, "creation_date": 1519758273, "answer_id": 49016161, "question_id": 49015418, "link": "https://stackoverflow.com/questions/49015418/haskell-reading-entire-lazy-bytestring/49016161#49016161", "title": "Haskell - Reading entire Lazy ByteString", "body": "<p>Note that the way a lazy bytestring works, the contents of the file won't be read until they are \"used\", but once they are read, they will remain in memory for any subsequent operations.  The only way they will be removed from memory is if they are garbage collected because your program no longer has any way to access them.</p>\n\n<p>For example, if you run the following program on a large file:</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BL  \nmain = do\n  bigFile &lt;- BL.readFile \"ubuntu-14.04-desktop-amd64.iso\"\n  print $ BL.length $ BL.filter (==0) bigFile     -- takes a while\n  print $ BL.length $ BL.filter (==255) bigFile   -- runs fast\n</code></pre>\n\n<p>the first computation will actually read the entire file into memory and it will be kept there for the second computation.</p>\n\n<p>I guess this by itself isn't too convincing, since the operating system will also cache the file into memory, and it ends up being hard to tell the difference in timing between Haskell reading the file from the operating system cache for each computation and keeping it in memory across all computations.  But, if you ran some heap profiling on this code, you'd discover that the first operation loads up the entire file into \"pinned\" bytestrings and that allocation stays constant through subsequent operations.</p>\n\n<p>If your concern is that you want the complete file to be read at the start, even if the first operation doesn't need to read it all, so that there are no subsequent delays as additional parts of the file are read, then your <code>seq</code>-based solution is probably fine.  Alternatively, you can read the entire file as a strict bytestring and then convert it using <code>fromStrict</code> -- this operation is instantaneous and doesn't copy any data.  (In contrast to <code>toStrict</code>, which is expensive and <em>does</em> copy data.)  So this will work:</p>\n\n<pre><code>import qualified Data.ByteString as BS\nimport qualified Data.ByteString.Lazy as BL\n\nmain = do\n  -- read strict\n  bigFile &lt;- BS.readFile \"whatever.mov\"\n  -- do strict and lazy operations\n  print $ strictOp bigFile\n  print $ lazyOp (BL.fromStrict bigFile)\n</code></pre>\n"}], "owner": {"reputation": 7, "user_id": 6499890, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xMnx3.png?s=128&g=1", "display_name": "Nicolas S.", "link": "https://stackoverflow.com/users/6499890/nicolas-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 49016161, "answer_count": 1, "score": 0, "last_activity_date": 1519758273, "creation_date": 1519755598, "last_edit_date": 1519756247, "question_id": 49015418, "link": "https://stackoverflow.com/questions/49015418/haskell-reading-entire-lazy-bytestring", "title": "Haskell - Reading entire Lazy ByteString", "body": "<p><strong>Context:</strong> I have a function defined in a library called <code>toXlsx :: ByteString -&gt; Xlsx</code> (that ByteString is from Data.ByteString.Lazy)</p>\n\n<p>Now to do certain operations I've defined certain functions that operate on the same file, thus I would like to open, read and convert to Xlsx the file once and keep it in memory to operate with it.</p>\n\n<p>Right now I'm reading the file as <code>bs &lt;- Data.ByteString.Lazy.readfile file</code> and at the end doing <code>Data.ByteString.Lazy.length bs 'seq' return value</code>.</p>\n\n<p>Is there any way to use this function and keep the file in memory as a whole to reuse it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1519744094, "post_id": 49011837, "comment_id": 85028222, "body": "What do you want to do if any of the strings aren&#39;t length 1?"}, {"owner": {"reputation": 516, "user_id": 4175580, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2366046a47437b36ba4d4ad3b85f19ca?s=128&d=identicon&r=PG&f=1", "display_name": "nocturne", "link": "https://stackoverflow.com/users/4175580/nocturne"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1519744494, "post_id": 49011837, "comment_id": 85028532, "body": "It will not happen, because of my exact input to splitOn"}, {"owner": {"reputation": 4242, "user_id": 367180, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e356e3a921bedb73efd7594ff7f37b73?s=128&d=identicon&r=PG", "display_name": "matthias krull", "link": "https://stackoverflow.com/users/367180/matthias-krull"}, "edited": false, "score": 2, "creation_date": 1519757534, "post_id": 49011837, "comment_id": 85036670, "body": "You might also want to use <a href=\"https://www.haskell.org/hoogle/?hoogle=%5B%5BChar%5D%5D+-%3E+%5BChar%5D\" rel=\"nofollow noreferrer\">hoogle</a> for those kind of questions. Given signatures it usually spits out some useful pointers."}, {"owner": {"reputation": 516, "user_id": 4175580, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2366046a47437b36ba4d4ad3b85f19ca?s=128&d=identicon&r=PG&f=1", "display_name": "nocturne", "link": "https://stackoverflow.com/users/4175580/nocturne"}, "edited": false, "score": 0, "creation_date": 1519757669, "post_id": 49011837, "comment_id": 85036747, "body": "I tried it, only thing with this signatures found was <code>unlines</code> and <code>unwords</code>. Which does not work for me. But thanks for your point."}, {"owner": {"reputation": 15126, "user_id": 1953800, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4173076e5187c82e74379de9aeb00aa4?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1953800/alex"}, "edited": false, "score": 1, "creation_date": 1519796249, "post_id": 49011837, "comment_id": 85050205, "body": "@nocturne <code>concat</code> is the fourth result"}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 4, "last_activity_date": 1519744106, "creation_date": 1519744106, "answer_id": 49011884, "question_id": 49011837, "link": "https://stackoverflow.com/questions/49011837/list-of-strings-to-list-of-chars-char-to-char-haskell/49011884#49011884", "title": "List of strings to list of chars - [[Char]] to [Char] haskell", "body": "<p><code>concat [\"a\", \"b\", \"c\"]</code> will give you the string <code>\"abc\"</code> which is the same as <code>['a', 'b', 'c']</code></p>\n"}, {"comments": [{"owner": {"reputation": 516, "user_id": 4175580, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2366046a47437b36ba4d4ad3b85f19ca?s=128&d=identicon&r=PG&f=1", "display_name": "nocturne", "link": "https://stackoverflow.com/users/4175580/nocturne"}, "edited": false, "score": 0, "creation_date": 1519744242, "post_id": 49011886, "comment_id": 85028334, "body": "It worked thanks! I will mark this as right answer later."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1519744113, "creation_date": 1519744113, "answer_id": 49011886, "question_id": 49011837, "link": "https://stackoverflow.com/questions/49011837/list-of-strings-to-list-of-chars-char-to-char-haskell/49011886#49011886", "title": "List of strings to list of chars - [[Char]] to [Char] haskell", "body": "<p>Yes, you can use <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#v:concat\" rel=\"nofollow noreferrer\"><strong><code>concat :: [[a]] -&gt; [a]</code></strong></a>:</p>\n\n<pre><code>Prelude&gt; concat [\"a\",\"b\",\"c\"]\n\"abc\"\n</code></pre>\n\n<p>Since a <code>String</code> is a type alias for <code>[Char]</code>, so <code>\"abc\"</code> is short for <code>['a', 'b', 'c']</code>:</p>\n\n<pre><code>Prelude&gt; concat [\"a\",\"b\",\"c\"] == ['a', 'b', 'c']\nTrue\n</code></pre>\n"}], "owner": {"reputation": 516, "user_id": 4175580, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2366046a47437b36ba4d4ad3b85f19ca?s=128&d=identicon&r=PG&f=1", "display_name": "nocturne", "link": "https://stackoverflow.com/users/4175580/nocturne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1519, "favorite_count": 0, "accepted_answer_id": 49011886, "answer_count": 2, "score": 1, "last_activity_date": 1519744113, "creation_date": 1519743979, "question_id": 49011837, "link": "https://stackoverflow.com/questions/49011837/list-of-strings-to-list-of-chars-char-to-char-haskell", "title": "List of strings to list of chars - [[Char]] to [Char] haskell", "body": "<p>I need to convert list like this <code>[\"a\",\"b\",\"c\"]</code> to this <code>['a','b','c']</code>. The thing is i used </p>\n\n<pre><code>splitOn\n</code></pre>\n\n<p>function which gave me <code>[[Char]]</code> from <code>[Char]</code>. Is there a way to convert this list of string to list of char? Assuming strings are length of 1 of course. </p>\n"}, {"tags": ["multithreading", "sockets", "haskell", "tcp"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 2, "creation_date": 1519744047, "post_id": 49010740, "comment_id": 85028177, "body": "It is allowed in C, why shouldn&#39;t this be allowed in Haskell? In Haskell all values are immutable, even."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519747344, "post_id": 49010740, "comment_id": 85030568, "body": "What have you tried? As far as I know there shouldn&#39;t be any issue with that, you should just be able to do a normal <code>forkIO</code> and proceed as usual."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 5, "creation_date": 1519763807, "post_id": 49010740, "comment_id": 85040065, "body": "It may be worth noting that there are more sophisticated ways of communicating between Haskell threads than sending messages over a socket.  Depending on the application, simply using the <code>par</code> function or working with MVars or software transactional memory will generally be <i>much</i> more effective than some horrible, hand-crafted socket protocol.  I think the only case where you&#39;d actually want this kind of socket-based design was if you were trying to simulate a network protocol."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 2, "last_activity_date": 1519749582, "last_edit_date": 1519749582, "creation_date": 1519744719, "answer_id": 49012128, "question_id": 49010740, "link": "https://stackoverflow.com/questions/49010740/multi-threading-using-a-share-socket-in-haskell/49012128#49012128", "title": "Multi-threading using a share socket in Haskell", "body": "<p>Yes, this is allowed. &nbsp;&nbsp;</p>\n"}], "owner": {"reputation": 550, "user_id": 2665006, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f5fc5207efb9ca551f6c5f3e4804beca?s=128&d=identicon&r=PG", "display_name": "phage", "link": "https://stackoverflow.com/users/2665006/phage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1519749582, "creation_date": 1519740820, "question_id": 49010740, "link": "https://stackoverflow.com/questions/49010740/multi-threading-using-a-share-socket-in-haskell", "title": "Multi-threading using a share socket in Haskell", "body": "<p>In Haskell, can the same socket be shared between two threads?  Essentially, what I am trying to do is create a thread to write to a socket and another to read from the socket.</p>\n\n<p>The read thread would be a loop that constantly wait, monitor and pick up any messages generated by the socket.</p>\n\n<p>Another thread (the write thread) would send code to the socket.</p>\n\n<p>Please advise.</p>\n"}, {"tags": ["list", "haskell", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 11, "user_id": 9418278, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KhXio-uL8TA/AAAAAAAAAAI/AAAAAAAAAD4/kdg4p6LRqjI/photo.jpg?sz=128", "display_name": "PunchineloPow", "link": "https://stackoverflow.com/users/9418278/punchinelopow"}, "edited": false, "score": 0, "creation_date": 1519737228, "post_id": 49009548, "comment_id": 85023418, "body": "Not sure why but my underscores have not shown in front of :xs, :ys etc.."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1519737396, "post_id": 49009548, "comment_id": 85023538, "body": "They show for me. It might just be your browser."}, {"owner": {"reputation": 11, "user_id": 9418278, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KhXio-uL8TA/AAAAAAAAAAI/AAAAAAAAAD4/kdg4p6LRqjI/photo.jpg?sz=128", "display_name": "PunchineloPow", "link": "https://stackoverflow.com/users/9418278/punchinelopow"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1519737786, "post_id": 49009548, "comment_id": 85023792, "body": "I guess I thought getting rid of the head it wouldn&#39;t get in the way when comparing although looking at it i suppose it doesn&#39;t matter as i&#39;m not using the head in the comparison. I am getting an error, Ambiguous Occurrence wit that last piece of code."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9418278, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KhXio-uL8TA/AAAAAAAAAAI/AAAAAAAAAD4/kdg4p6LRqjI/photo.jpg?sz=128", "display_name": "PunchineloPow", "link": "https://stackoverflow.com/users/9418278/punchinelopow"}, "edited": false, "score": 0, "creation_date": 1519738543, "post_id": 49009701, "comment_id": 85024288, "body": "Thanks a lot for your help, that makes a lot of sense. I haven&#39;t used any of the import modules yet but I will start to look at them."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519738633, "post_id": 49009701, "comment_id": 85024348, "body": "Explicitly matching on those particular two relevant elements works well in this particular problem, but in general, I&#39;d prefer using <code>drop</code> and <code>take</code> to avoid having to unwrap and re-wrap many individual variables."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519740277, "post_id": 49009701, "comment_id": 85025506, "body": "@leftaroundabout: I agree: only in case the number of elements is low (and constant) this works well. Otherwise it is indeed better to use <code>drop</code>, <code>take</code>, etc. :)"}, {"owner": {"reputation": 11, "user_id": 9418278, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KhXio-uL8TA/AAAAAAAAAAI/AAAAAAAAAD4/kdg4p6LRqjI/photo.jpg?sz=128", "display_name": "PunchineloPow", "link": "https://stackoverflow.com/users/9418278/punchinelopow"}, "edited": false, "score": 0, "creation_date": 1519745373, "post_id": 49009701, "comment_id": 85029137, "body": "The only thing I still don&#39;t understand, with my first code segment I&#39;m trying to evaluate the elements to output a Boolean result.  If I input that into the prelude it works."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1519737685, "creation_date": 1519737685, "answer_id": 49009701, "question_id": 49009548, "link": "https://stackoverflow.com/questions/49009548/compare-certain-elements-of-two-lists-haskell/49009701#49009701", "title": "Compare certain elements of two lists, Haskell", "body": "<p>We can make it more elegant, by performing the equality checks already in the <em>pattern matching</em> part. Furthermore your function is missing the case where for instance the digits are <em>not</em> equal, or when I pass an invalid string.</p>\n\n<p>For instance for the year <code>\"16\"</code> case, we can use:</p>\n\n<pre><code>-- only works for the year 16\ncompare (_:'1':'6':_) (_:'1':'6':_) = \"Same year\"\ncompare _ _ = \"Different year\"\n</code></pre>\n\n<p>So the first line checks whether the second and third element of the lists are <code>'1'</code> and <code>'6'</code> respectively. Only in that case we return <code>\"Same year\"</code>. In all other cases (the second line) we return <code>\"Different year\"</code>. The last line will thus fire in case one of the strings has less than three characters, or when both strings have at least three characters, but the second and third character are not <code>'1</code>' and/or <code>'6'</code> respectively.</p>\n\n<p>Now in case we want to generalize this for <em>any</em> year, we can use variables:</p>\n\n<pre><code>compare (_:x1:x2:_) (_:y1:y2:_) = ...\ncompare _ _ = \"Different year\"\n</code></pre>\n\n<p>So here <code>x1</code> is the second character of the first string, <code>x2</code> is the third character of the same string. <code>y1</code> is the second character of the second string, and <code>y2</code> is the third character of the second string.</p>\n\n<p>We probably want to ensure that these are all digits, so we can check:</p>\n\n<pre><code>import Data.Char(isDigit)\n\ncompare (_:x1:x2:_) (_:y1:y2:_) | all isDigit [x1, x2, y1, y2] = ...\ncompare _ _ = \"Different year\"\n</code></pre>\n\n<p>So now we have guarantees that if the guard \"fires\" that all these characters are digits (in the <code>0</code> to <code>9</code> range). But of course we still need to determine that these have the same value.</p>\n\n<p>I leave what you have to fill in for the ellipse (<code>...</code>) as an exercise, it is basically a generalization of the code in the question.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 9418278, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KhXio-uL8TA/AAAAAAAAAAI/AAAAAAAAAD4/kdg4p6LRqjI/photo.jpg?sz=128", "display_name": "PunchineloPow", "link": "https://stackoverflow.com/users/9418278/punchinelopow"}, "is_accepted": false, "score": 0, "last_activity_date": 1520287448, "creation_date": 1520287448, "answer_id": 49120261, "question_id": 49009548, "link": "https://stackoverflow.com/questions/49009548/compare-certain-elements-of-two-lists-haskell/49120261#49120261", "title": "Compare certain elements of two lists, Haskell", "body": "<p>Thanks again for all the advice, it is greatly appreciated.\nSo I found out why my code wasn't working and it was because I was using the Haskell built in function \"compare\" as my function name. So as soon as I re named them they all check out.</p>\n\n<p>Just to clarify my question was,\nTo compare the second &amp; third element of a id number eg P16201348. These elements indicate if two numbers are from the same year, 16, 17 etc..</p>\n\n<p>The code I have gone with is this,</p>\n\n<p>pnum :: Eq a => [a] -> [a] -> Bool</p>\n\n<p>pnum (<em>:xs)(</em>:ys) = xs !! 1 == ys !! 1 &amp;&amp; xs !! 2 == ys !! 2</p>\n\n<p>So, I use underscore on the head of each list as this element isn't important. I then compare the elements that I need and check them for equality.</p>\n\n<p>I mean this may not be the best and most efficient way to do this so please do let me know if you think not.</p>\n\n<p>Thanks</p>\n"}], "owner": {"reputation": 11, "user_id": 9418278, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KhXio-uL8TA/AAAAAAAAAAI/AAAAAAAAAD4/kdg4p6LRqjI/photo.jpg?sz=128", "display_name": "PunchineloPow", "link": "https://stackoverflow.com/users/9418278/punchinelopow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 832, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1520287448, "creation_date": 1519737149, "last_edit_date": 1519737191, "question_id": 49009548, "link": "https://stackoverflow.com/questions/49009548/compare-certain-elements-of-two-lists-haskell", "title": "Compare certain elements of two lists, Haskell", "body": "<p>Just a quick disclaimer I have been learning Haskell for about a month and have been reading, watching and searching the web but I just cant get my head around this.</p>\n\n<p>So my question is, I want to compare two strings say \"p16201348\" &amp; \"p16202068\" and basically check that the first two numbers after the p are from the year 2016 so 16.\nIn my first example below i'm just using the same lists to compare. When I input this into ghci then it evaluates to true as you would expect. My problem is actually writing this as a callable function.</p>\n\n<pre><code>\"p16201348\" !! 1 == '1' &amp;&amp; \"p16201348\" !! 1 == '1' &amp;&amp; \"p16201348\" !! 2 == '6' &amp;&amp; \"p16201348\" !! 2 == '6'\n</code></pre>\n\n<p>My first attempt at writing the function is below, as I said the p is irrelevant so from what I understand I split the list into x:xs butt disregard the head which ends up being _:xs and _:ys. When I try and call this I get the ambiguous occurrence.</p>\n\n<pre><code>compare (_:xs) (_:ys) = xs !! 1 == '1' &amp;&amp; ys !! 1 == '1' &amp;&amp; xs !! 2 == '6' &amp;&amp; ys !! 2 == '6'\n</code></pre>\n\n<p>My final function (protptype) is using a guarded equation, although im not even sue if it is possible to split a list and then evaluate certain elements within it</p>\n\n<pre><code>compare (_:xs)(_:ys)\n    | xs !! 1  == '1' &amp;&amp; ys !! 1 == '1' &amp;&amp;  xs !! 2  == '6' &amp;&amp;  ys !! 2 == '2' = \"Same Year\"\n    | otherwise = \"Different year\"\n</code></pre>\n\n<p>Thanks in advance for any help.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1519737757, "post_id": 49009492, "comment_id": 85023775, "body": "The expected output is <i>not</i> possible in Haskell. In Haskell, lists are <i>homogenous</i>: all elements have the <i>same</i> type."}], "answers": [{"comments": [{"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 0, "creation_date": 1519758649, "post_id": 49009608, "comment_id": 85037340, "body": "I think he wants to group only 1s and leave the others ungrouped, so <code>groupBy (\\a b -&gt; a == 1 &amp;&amp; b ==1) [...]</code> should work."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 15126, "user_id": 1953800, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4173076e5187c82e74379de9aeb00aa4?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1953800/alex"}, "edited": false, "score": 0, "creation_date": 1519841380, "post_id": 49009608, "comment_id": 85076796, "body": "@Alex -- The posted answer groups non-1s together (<code>...,[2,3,4,2],...</code>).  My proposed answer keeps them as singletons (<code>...,[2],[3],[4],[2],...</code>)."}], "tags": [], "owner": {"reputation": 3969, "user_id": 187261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/994de0373c6a35a5f7108b274d0b1cb9?s=128&d=identicon&r=PG", "display_name": "Nazarii Bardiuk", "link": "https://stackoverflow.com/users/187261/nazarii-bardiuk"}, "is_accepted": true, "score": 6, "last_activity_date": 1519741337, "last_edit_date": 1519741337, "creation_date": 1519737364, "answer_id": 49009608, "question_id": 49009492, "link": "https://stackoverflow.com/questions/49009492/group-consecutive-elements-of-specific-value-in-haskell/49009608#49009608", "title": "Group consecutive elements of specific value in Haskell", "body": "<p>You need a <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:group\" rel=\"nofollow noreferrer\">group</a> function</p>\n\n<pre><code>&gt;&gt; import Data.List\n&gt;&gt; group [1,2,3,1,1,1,2,3,4,2,1]\n&gt;&gt; [[1],[2],[3],[1,1,1],[2],[3],[4],[2],[1]]\n</code></pre>\n\n<p>note that every item is a list because values in list should have the same type. Thats why your example <code>[[1], 2, ..]</code> is impossible in Haskell</p>\n\n<hr>\n\n<p>If you want to form groups of <strong>1s</strong> and the rest then you could use <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-List.html#v:groupBy\" rel=\"nofollow noreferrer\">groupBy</a></p>\n\n<pre><code>&gt;&gt; import Data.List\n&gt;&gt; groupBy (\\a -&gt; \\b -&gt; a == b &amp;&amp; a == 1 || a /= 1 &amp;&amp; b /= 1) [1,2,3,1,1,1,2,3,4,2,1]\n&gt;&gt; [[1],[2,3],[1,1,1],[2,3,4,2],[1]]\n</code></pre>\n"}], "owner": {"reputation": 5585, "user_id": 520494, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/gUhjm.png?s=128&g=1", "display_name": "gsach", "link": "https://stackoverflow.com/users/520494/gsach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "accepted_answer_id": 49009608, "answer_count": 1, "score": 0, "last_activity_date": 1519741337, "creation_date": 1519736917, "question_id": 49009492, "link": "https://stackoverflow.com/questions/49009492/group-consecutive-elements-of-specific-value-in-haskell", "title": "Group consecutive elements of specific value in Haskell", "body": "<p>I have a list of numbers in haskell and I want to perform the following transformation:</p>\n\n<ul>\n<li>When an element is not equal to 1, just <strong>append this element</strong> on the new list</li>\n<li>When an element is equal to 1 append to the list <strong>a sublist which contains all the consecutive 1s</strong> and then proceed with the next character that is not equal to 1</li>\n</ul>\n\n<p>To make the requirement clear I am posting an <strong>example</strong>:</p>\n\n<pre><code>Input: [1,2,3,1,1,1,2,3,4,2,1]\n\nExpected Output: [[1] , 2 , 3 , [1,1,1] , 2 , 3 , 4 , 2 , [1]]\n</code></pre>\n\n<p>Important Notice: The elements that are not equal to 1 are not added in a sublist</p>\n\n<p>I have found some workarounds to make it work, but I need to find an elegant solution that does not traverse the elements of the list more than once. </p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["haskell", "types", "ghc"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1519733455, "post_id": 49008201, "comment_id": 85021161, "body": "<code>1 ~~ 2</code> can be interpreted as both <code>(1 :: Double) ~~ (2 :: Double)</code> and <code>(1 :: Int) ~~ (2 :: Int)</code> (numeric literals are overloaded), what do you expect that to do? It&#39;s difficult to tell what you are trying to do here."}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1519733805, "post_id": 49008201, "comment_id": 85021378, "body": "I want that 1 ~~ 2 will be interpreted as (1 :: Int) ~~ (2 :: Int). But I think it is problem of runtime, not of compilation."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 2, "creation_date": 1519739008, "post_id": 49008201, "comment_id": 85024612, "body": "This illustrates a subtle point about typeclass instance resolution: <code>instance (C a) =&gt; D a</code> does <i>not</i> mean \u201cif <code>a</code> has an instance of <code>C</code> then <code>a</code> also has an instance of <code>D</code>\u201d; it means \u201c<i>all types</i> have an instance of <code>D</code>, which imposes the constraint <code>C a</code> on the context where it\u2019s used\u201d."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519772514, "post_id": 49008201, "comment_id": 85043935, "body": "Why is <code>(~~)</code> defined specially for integral types? What is it actually supposed to <i>mean</i>? If you can&#39;t express what a class&#39;s methods mean, you probably shouldn&#39;t have that class."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519773251, "post_id": 49008201, "comment_id": 85044152, "body": "If you&#39;re doing this to try to learn about defining type classes, then I suggest you don&#39;t. Most Haskell programmers <i>very rarely</i> define type classes. We define types by the bushel; I wouldn&#39;t hesitate to define several types just so I could use them internally in a function implementation. But classes are much rarer. Classes are sometimes used for a sort of metaprogramming, or to create first class constraints for fancy type programming, but most often classes express meaningful concepts. I doubt your <code>Neighbors</code> class meets that standard."}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1520060627, "post_id": 49008201, "comment_id": 85168627, "body": "@Jon Prudy, could you possible to say the second part of your comment ( it means &quot;all types have an instance of <code>D</code>, which imposes the constraint <code>C a</code> on the context where it\u2019s used&quot;)  in other words? My English isn&#39;t good enough. But first part of your comment brings light on my error in understanding, how typeclass instances work."}, {"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1520062243, "post_id": 49008201, "comment_id": 85168976, "body": "@dfeuer, sometimes we need different behavior of some operations for different sets of values (e.g. &quot;plus&quot; for Int, for Double, for Strings, for Vectors -- sample perhaps not correct in Haskell), of course, I mean overloading. But I had an idea that I could write instances of classes for classes like instances of classes for types. And I&#39;ve written a small example, which even partially worked."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1520075707, "post_id": 49008201, "comment_id": 85172178, "body": "@Vladimir: When you write <code>instance (Constraints) =&gt; Class typeExpression</code>, the compiler <i>only</i> uses <code>typeExpression</code> to decide which instance of <code>Class</code> to choose. <i>After</i> selecting an instance, the compiler checks that <code>Constraints</code> are satisfied. So when you say <code>instance (C1 a) =&gt; D a</code> and <code>instance (C2 a) =&gt; D a</code>, you\u2019re giving the compiler two different instances that both match the same types\u2014in this case, any type <code>a</code>\u2014so it doesn\u2019t know which instance to choose. It\u2019s basically the same as if you wrote <code>instance D Int</code> twice."}], "answers": [{"comments": [{"owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1520061394, "post_id": 49011285, "comment_id": 85168791, "body": "Daniel, thank you for answer, I understand than I must make the instances for every type I use. Before it, I thought I could work with instances like in my example above. But maybe, I could work in such manner with Type Families or Type Functional Dependency? And why did you use the instances with <code>Identity</code> and <code>Const</code> (they are Monads?) I don&#39;t understand how it work and why?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "edited": false, "score": 0, "creation_date": 1520080801, "post_id": 49011285, "comment_id": 85173659, "body": "@Vladimir &quot;Maybe I could work in such manner with {- ... -}?&quot; Sorry, nope. &quot;Why did you use the instances with <code>Identity</code> and <code>Const</code>?&quot; I just looked at the <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Prelude.html#t:RealFloat\" rel=\"nofollow noreferrer\">list of <code>RealFloat</code> instances in the documentation for <code>base</code></a> and gave an instance of <code>Neighbors</code> for each."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1519742462, "creation_date": 1519742462, "answer_id": 49011285, "question_id": 49008201, "link": "https://stackoverflow.com/questions/49008201/how-to-make-the-different-instances-of-class-depending-on-context/49011285#49011285", "title": "How to make the different instances of class, depending on context?", "body": "<p>You may do it in one file like this:</p>\n\n<pre><code>instance Neighbors Int     where x ~~ y = abs (x-y) == 1\ninstance Neighbors Double  where x ~~ y = abs (x-y) &lt; 1\ninstance Neighbors Float   where x ~~ y = abs (x-y) &lt; 1\ninstance Neighbors CDouble where x ~~ y = abs (x-y) &lt; 1\ninstance Neighbors CFloat  where x ~~ y = abs (x-y) &lt; 1\ninstance RealFloat a =&gt; Neighbors (Identity a) where x ~~ y = abs (x-y) &lt; 1\ninstance RealFloat a =&gt; Neighbors (Const a b)  where x ~~ y = abs (x-y) &lt; 1\n</code></pre>\n\n<p>I know you don't like having to write one instance per type constructor; but this is the correct answer to the question as asked nevertheless, as type constructors are the way that Haskell typeclasses do dispatch.</p>\n\n<p>You can reduce some of the repetition by defining</p>\n\n<pre><code>neighborsDef :: (Num a, Ord a) =&gt; a -&gt; a -&gt; Bool\nneighborsDef x y = abs (x-y) &lt; 1\n</code></pre>\n\n<p>and giving <code>(~~) = neighborsDef</code> in the instances.</p>\n\n<p>In fact, stepping slightly to the side of the question as asked, I suspect you do not want a new typeclass at all. Perhaps one of the following two definitions is suitable for you instead:</p>\n\n<pre><code>(~~) :: (Num a, Ord a) =&gt; a -&gt; a -&gt; Bool\nx ~~ y = abs (x-y) &lt;= 1 -- if the Int definition was slightly off, OR\nx ~~ y = x /= y &amp;&amp; abs (x-y) &lt;= 1 -- if the RealFloat definition was slightly off\n</code></pre>\n"}], "owner": {"reputation": 549, "user_id": 7826146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95fdc5b2dadeccfd1047ab1dc58c8b5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir", "link": "https://stackoverflow.com/users/7826146/vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 49011285, "answer_count": 1, "score": 2, "last_activity_date": 1519742462, "creation_date": 1519732807, "question_id": 49008201, "link": "https://stackoverflow.com/questions/49008201/how-to-make-the-different-instances-of-class-depending-on-context", "title": "How to make the different instances of class, depending on context?", "body": "<p>I have some simple class and some instances for various data types and context. This is a partially working case:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances, IncoherentInstances  #-}\n\nclass Neighbors a where\n     (~~) :: a -&gt; a -&gt; Bool\n\ninstance Neighbors Int where\n  x ~~ y = (abs (x-y) == 1)\n\ninstance (RealFloat a) =&gt; Neighbors a where\n  x ~~ y = (abs(x-y) &lt; 1.0)\n</code></pre>\n\n<p>There is a disadvantage that is I had to use type restriction for <code>Int</code>:</p>\n\n<pre><code>*Main&gt; (1::Int) ~~ (2::Int)\nTrue\n</code></pre>\n\n<p>But, if I want use only contexts, my second script isn\u2019t working at all:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecidableInstances, IncoherentInstances  #-}\n\nclass Neighbors a where\n     (~~) :: a -&gt; a -&gt; Bool\n\ninstance (Integral a) =&gt; Neighbors a where\n  x ~~ y = (abs(x-y) == 1)\n\ninstance (RealFloat a) =&gt; Neighbors a where\n  x ~~ y = (abs(x-y) &lt; 1.0)\n</code></pre>\n\n<p>Error is:</p>\n\n<pre><code>Neighborhood.hs:7:10: error:\n    Duplicate instance declarations:\n      instance [incoherent] Integral a =&gt; Neighbors a\n        -- Defined at Neighborhood.hs:7:10\n      instance [incoherent] RealFloat a =&gt; Neighbors a\n        -- Defined at Neighborhood.hs:10:10\nFailed, modules loaded: none.\n</code></pre>\n\n<p>But I want to define different instances just for these different contexts: Integral and RealFloat. How to do it in one file?</p>\n"}, {"tags": ["haskell", "parse-error"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1519732426, "post_id": 49007988, "comment_id": 85020556, "body": "Show the full error, and the full function."}, {"owner": {"reputation": 1, "user_id": 9385719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HankySpanky", "link": "https://stackoverflow.com/users/9385719/hankyspanky"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1519732626, "post_id": 49007988, "comment_id": 85020663, "body": "The full error is here: Q3.hs:1:45: error:     parse error (possibly incorrect indentation or mismatched brackets)               The full code/ function is the one i placed above"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519732940, "post_id": 49007988, "comment_id": 85020874, "body": "It is missing the <code>in</code> clause I guess, but you should provide the full code sample such that we can debug it."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1519733758, "post_id": 49007988, "comment_id": 85021347, "body": "@HankySpanky That&#39;s definitely not the whole code, as <code>let</code> on top-level yields a parser error in Haskell 98 or 2010."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1519734227, "post_id": 49007988, "comment_id": 85021614, "body": "This code would work in ghci but not in a file due to small differences.  Try removing the <code>let</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 0, "last_activity_date": 1519756706, "creation_date": 1519756706, "answer_id": 49015719, "question_id": 49007988, "link": "https://stackoverflow.com/questions/49007988/parse-error-at-end-of-let-in-haskell-file/49015719#49015719", "title": "Parse error at end of &quot;let&quot; in Haskell file", "body": "<p>If you are compiling a Haskell source file, like <code>Q3.hs</code>, the definitions of functions at the \"top level\" of the program need to have a syntax that looks like this:</p>\n\n<pre><code>idPnumber a1 b2= take 3 a1 == take 3 b2\n</code></pre>\n\n<p>without any <code>let</code>.  Instead, <code>let</code> is used <em>within</em> functions to give a name to an expression, like this:</p>\n\n<pre><code>idPnumber a1 b2 = let threeA1 = take 3 a1\n                      threeB2 = take 3 b2\n                  in  threeA1 == threeB2\n</code></pre>\n\n<p>and -- in this case -- must be followed by an <code>in</code> clause.  (There are also some other ways that <code>let</code> can be used that don't require <code>in</code>, but those don't apply here.)</p>\n\n<p>Because the <code>in</code> keyword is missing in your file, GHC has gotten hopelessly confused and has given you an error message that doesn't make much sense.  (If you added an <code>in</code> clause, you'd still get an error message, but it would explain that GHC was looking for a \"top-level declaration\", which is a definition like the one above without any <code>let</code> keyword.</p>\n\n<p>Note that you <em>can</em> use <code>let</code> like this at the GHCi interactive prompt, but that's because the interactive prompt behaves differently than compiling a program in a file. </p>\n"}], "owner": {"reputation": 1, "user_id": 9385719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HankySpanky", "link": "https://stackoverflow.com/users/9385719/hankyspanky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 289, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1519756706, "creation_date": 1519732161, "last_edit_date": 1519756189, "question_id": 49007988, "link": "https://stackoverflow.com/questions/49007988/parse-error-at-end-of-let-in-haskell-file", "title": "Parse error at end of &quot;let&quot; in Haskell file", "body": "<p>In this Haskell code, what error can you see at the end of \"b2\"? I believe there is no error, but this code in the file Q3.hs:</p>\n\n<pre><code>let idPnumber a1 b2= take 3 a1 == take 3 b2\n</code></pre>\n\n<p>gives the error:</p>\n\n<pre><code>Q3.hs:1:45: error:\n    parse error (possibly incorrect indentation or mismatched brackets)\n  |\n1 | let idPnumber a1 b2= take 3 a1 == take 3 b2 \n  |                                             ^\n</code></pre>\n"}, {"tags": ["list", "function", "haskell", "element", "ghci"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1519732105, "post_id": 49007617, "comment_id": 85020373, "body": "Why do you write <code>[]</code> in <code>qsort [] = nub []</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 1, "last_activity_date": 1519732097, "creation_date": 1519732097, "answer_id": 49007970, "question_id": 49007617, "link": "https://stackoverflow.com/questions/49007617/how-to-remove-a-duplicated-element-in-a-function-with-a-list/49007970#49007970", "title": "How to remove a duplicated element in a function with a list?", "body": "<p>Your example shows you only using <code>nub</code> on the empty list (<code>nub []</code>), which doesn't actually do anything. You have to apply it to the result of the main body of <code>qsort</code>:</p>\n\n<pre><code>qsort :: [Int] -&gt; [Int]\nqsort [] = []\nqsort (x:xs) = \n     nub $ qsort smaller ++ [x] ++ qsort larger\n     where \n          smaller = [a | a &lt;- xs, a &lt;= x] \n          larger = [b | b &lt;- xs, b &gt; x]\n</code></pre>\n\n<p>This, however, is unnecessarily expensive because it runs <code>nub</code> on every branch of the function. Further optimization is left to you.</p>\n"}, {"tags": [], "owner": {"reputation": 22954, "user_id": 5238915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fncqh.jpg?s=128&g=1", "display_name": "RoadRunner", "link": "https://stackoverflow.com/users/5238915/roadrunner"}, "is_accepted": false, "score": 1, "last_activity_date": 1519735704, "last_edit_date": 1519735704, "creation_date": 1519735186, "answer_id": 49008943, "question_id": 49007617, "link": "https://stackoverflow.com/questions/49007617/how-to-remove-a-duplicated-element-in-a-function-with-a-list/49008943#49008943", "title": "How to remove a duplicated element in a function with a list?", "body": "<p>As pointed out in <a href=\"https://stackoverflow.com/questions/49007617/how-to-remove-a-duplicated-element-in-a-function-with-a-list/49007970#49007970\">@Chad Gilbert's</a> answer, you need to apply <code>nub</code> on the final sorted list. Unfortunately this function is <code>O(n^2)</code>, and would be pretty innefficient if the list gets long. </p>\n\n<p>You can improve the overall complexity to <code>O(nlogn)</code>(cost of sorting), if you group identical elements together and just take the first item, which is just an <code>O(n)</code> operation.  You can accomplish this with the <code>map</code>, <code>group</code> and <code>head</code> functions. </p>\n\n<p>With these suggestions, here is another way of writing your function:</p>\n\n<pre><code>import Data.List\n\nqsort :: (Ord a) =&gt; [a] -&gt; [a]\nqsort [] = []\nqsort (pivot:others) = map head $ group $ qsort lowers ++ [pivot] ++ qsort highers\n    where lowers = filter (&lt;pivot) others\n          highers = filter (&gt;=pivot) others\n</code></pre>\n\n<p>Which works as follows:</p>\n\n<pre><code>*Main&gt; qsort [2, 6, 3, 3]\n[2,3,6]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 0, "last_activity_date": 1519906755, "creation_date": 1519906755, "answer_id": 49049610, "question_id": 49007617, "link": "https://stackoverflow.com/questions/49007617/how-to-remove-a-duplicated-element-in-a-function-with-a-list/49049610#49049610", "title": "How to remove a duplicated element in a function with a list?", "body": "<p>See the <code>unique</code> function in the (Unique)[<a href=\"https://hackage.haskell.org/package/Unique-0.4.7.2/docs/Data-List-Unique.html]\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/Unique-0.4.7.2/docs/Data-List-Unique.html]</a> package.</p>\n\n<pre><code>unique [2,3,6,6,3]\n[2,3,6]\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 7023122, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4fc771105a47761221bba39fd522effe?s=128&d=identicon&r=PG&f=1", "display_name": "James Johnson", "link": "https://stackoverflow.com/users/7023122/james-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1519906755, "creation_date": 1519730899, "question_id": 49007617, "link": "https://stackoverflow.com/questions/49007617/how-to-remove-a-duplicated-element-in-a-function-with-a-list", "title": "How to remove a duplicated element in a function with a list?", "body": "<p>I'm a newbie when it comes to Haskell and I'm confused with a few things. I'm trying to remove duplicated elements in this functions list:</p>\n\n<pre><code>qsort :: [Int] -&gt; [Int]\nqsort [] = []\nqsort (x:xs) = \n     qsort smaller ++ [x] ++ qsort larger\n     where \n          smaller = [a | a &lt;- xs, a &lt;= x] \n          larger = [b | b &lt;- xs, b &gt; x]\n</code></pre>\n\n<p>I attempted to do this by importing Data.List and using the nub [] function:</p>\n\n<pre><code>qsort :: [Int] -&gt; [Int]\nqsort [] = nub[]\n</code></pre>\n\n<p>But, if I do qsort [2, 6, 3, 3], it still returns with [2, 3, 3, 6].</p>\n\n<p>Am I using the nub function wrong or is there something else I am missing?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 6, "creation_date": 1519720420, "post_id": 49003424, "comment_id": 85012965, "body": "I&#39;d suggest <code>any . elem</code> instead of <code>elem x . join</code>. The former works for any <code>(Eq a, Foldable outer, Foldable inner) =&gt; outer (inner a)</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1519730507, "post_id": 49003424, "comment_id": 85019358, "body": "This is a nice answer (+1) but I fear it is way over the current skill level of the OP. I mean, if the OP can not figure out how to test membership in a list-of-lists, they probably will not understand foldables, applicative, monads. Pointfree notation does not help, either."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 5, "last_activity_date": 1519716942, "creation_date": 1519716942, "answer_id": 49003424, "question_id": 49002862, "link": "https://stackoverflow.com/questions/49002862/is-it-possible-to-expand-elem-to-support-a-a-bool/49003424#49003424", "title": "Is it possible to expand elem to support a -&gt; [[a]] -&gt; Bool?", "body": "<p>You can get a function with that signature easily by composing other functions, but there's more than one way to do it, with different behaviour, so which one will be useful to you depends on the behaviour you wish it to have.</p>\n\n<p>One way to go about it is to elevate <code>elem</code>. If you look at the type of <code>elem</code>, it has this type:</p>\n\n<pre><code>Prelude&gt; :t elem\nelem :: (Eq a, Foldable t) =&gt; a -&gt; t a -&gt; Bool\n</code></pre>\n\n<p>So, one thing you can do is to elevate the first value, of type <code>a</code>, to a <code>Functor</code>, like this:</p>\n\n<pre><code>pelem :: (Applicative f, Eq (f a), Foldable t) =&gt; a -&gt; t (f a) -&gt; Bool\npelem = elem . pure\n</code></pre>\n\n<p>It may not do what you want it to do, though:</p>\n\n<pre><code>*Q49002862&gt; pelem \"foo\" [[\"foo\", \"bar\"],[\"baz\"]]\nFalse\n*Q49002862&gt; pelem \"baz\" [[\"foo\", \"bar\"],[\"baz\"]]\nTrue\n</code></pre>\n\n<p>Notice that it elevates <code>\"foo\"</code> to <code>[\"foo\"]</code>, and <code>\"baz\"</code> to <code>[\"baz\"]</code>, so that only the last query returns <code>True</code>.</p>\n\n<p>This may not be what you want, so alternatively, you can pull in <code>join</code> from <code>Control.Monad</code> and define <code>jelem</code> like this:</p>\n\n<pre><code>jelem :: (Foldable t, Eq a, Monad t) =&gt; a -&gt; t (t a) -&gt; Bool\njelem x = elem x . join\n</code></pre>\n\n<p>This returns <code>True</code> as long as it finds just one element in the flattened (<em>joined</em>) foldable container:</p>\n\n<pre><code>*Q49002862&gt; jelem \"foo\" [[\"foo\", \"bar\"],[\"baz\"]]\nTrue\n*Q49002862&gt; jelem \"baz\" [[\"foo\", \"bar\"],[\"baz\"]]\nTrue\n*Q49002862&gt; jelem \"qux\" [[\"foo\", \"bar\"],[\"baz\"]]\nFalse\n</code></pre>\n\n<p>I'm sure one can think up an implementation of the latter that has fewer restrictions (e.g. doesn't require <code>t</code> to be a <code>Monad</code>),  but that's what I could think up on short notice.</p>\n\n<p>To be clear, the words <code>pelem</code> and <code>jelem</code> are some I made up right now. They don't mean anything - I just took the first letter of <code>pure</code> and <code>join</code>, respectively, and put them in front of <code>elem</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1519739308, "creation_date": 1519739308, "answer_id": 49010257, "question_id": 49002862, "link": "https://stackoverflow.com/questions/49002862/is-it-possible-to-expand-elem-to-support-a-a-bool/49010257#49010257", "title": "Is it possible to expand elem to support a -&gt; [[a]] -&gt; Bool?", "body": "<p>I will try to simplify the answer of Mark Seemann to the specific case which is being asked in the OP. The intent is to make it more accessible to beginners.</p>\n\n<p>In the libraries, we find a function</p>\n\n<pre><code>elem :: Eq a =&gt; a -&gt; [a] -&gt; Bool\n</code></pre>\n\n<p>but we want, instead</p>\n\n<pre><code>elem2 :: Eq a =&gt; a -&gt; [[a]] -&gt; Bool\n</code></pre>\n\n<p>As a silly tentative, we can try to use <code>elem</code> anyway:</p>\n\n<pre><code>elem2 :: Eq a =&gt; a -&gt; [[a]] -&gt; Bool\nelem2 x xss = elem x xss\n</code></pre>\n\n<p>This will cause a type error, since <code>xss</code> is of type <code>[[a]]</code>, while <code>elem</code> expects a <code>[a]</code> for its second argument. However we can try to \"convert\" <code>xss</code> so that is becomes something of the right type. This requires a function of type <code>[[a]] -&gt; [a]</code>.</p>\n\n<p>The libraries do provide a function <code>concat :: [[a]] -&gt; [a]</code>, which takes a list of lists and \"flattens\" their elements into a single list. In our case, this is the \"conversion\" we need: <code>x</code> belongs to the list-of-lists iff it belongs to the flattened list. Hence, we can use</p>\n\n<pre><code>elem2 :: Eq a =&gt; a -&gt; [[a]] -&gt; Bool\nelem2 x xss = elem x (concat xss)\n</code></pre>\n\n<p>which is a working solution.</p>\n\n<p>This can be further generalized, as Mark Seemann did, to general foldable monads (monadic <code>join</code> is a generalization of <code>concat</code> which only works on lists). He also wrote <code>elem2</code> using pointfree notation, making the code more compact, but the solution is the same one.</p>\n"}], "owner": {"reputation": 122, "user_id": 7143840, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30f5bc81023354870cd77338cb4c8a2?s=128&d=identicon&r=PG&f=1", "display_name": "Dartuso", "link": "https://stackoverflow.com/users/7143840/dartuso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 49003424, "answer_count": 2, "score": 2, "last_activity_date": 1519739308, "creation_date": 1519714601, "last_edit_date": 1519716971, "question_id": 49002862, "link": "https://stackoverflow.com/questions/49002862/is-it-possible-to-expand-elem-to-support-a-a-bool", "title": "Is it possible to expand elem to support a -&gt; [[a]] -&gt; Bool?", "body": "<p>I have a polyomino problem that requires placing polyominos onto a board.\nI am using the following type to support this.</p>\n\n<pre><code>type Block = (Int, Int)\ntype Polyomino = [Block]\ntype Board = [Polyomino]\n</code></pre>\n\n<p>Part of my solution is a function that checks if any blocks of a polyomino have already been placed in the board.</p>\n\n<pre><code>unPlaced :: Polyomino -&gt; Int -&gt; Int -&gt; Board -&gt; Bool\nunPlaced _ _ _ [] = True\nunPlaced ((a, b):cs) x y b = --check if in Board\n</code></pre>\n\n<p>(<code>x</code> and <code>y</code> are the offsets of the current polyomino)</p>\n\n<p>I know I can use <code>elem</code> to check in each polyomino in the board like so</p>\n\n<pre><code>unPlaced ((a, b):cs) x y b:bs = if (((a+x),(b+y)) `elem` b) \nthen False\nelse unPlaced ((a, b):cs) x y bs\n</code></pre>\n\n<p>but I\u2019m unsure how to complete this solution since I cannot \"refresh\" my board after checking through every element of it.</p>\n\n<p>I believe a function <code>a -&gt; [[a]] -&gt; Bool</code> will allow me to complete this, so any help is appreciated!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519711198, "post_id": 49002021, "comment_id": 85008816, "body": "It&#39;s a monad.  Have you tried using <code>securely</code> or, if you&#39;d like, <code>insecurely</code>.  For example, <code>securely str :: IO ByteString</code>."}, {"owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519711422, "post_id": 49002021, "comment_id": 85008898, "body": "I tried this (<code>str :: IO ByteString; str = securely $  randomByteString (42::ALIGN)</code>)  from <a href=\"https://hackage.haskell.org/package/raaz-0.2.0/docs/Raaz-Random.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/raaz-0.2.0/docs/Raaz-Random.html</a> this link, but it gives an error"}], "answers": [{"comments": [{"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "reply_to_user": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "edited": false, "score": 0, "creation_date": 1519737332, "post_id": 49002307, "comment_id": 85023494, "body": "@MaheshUligade Since this answered your question accept the answer. To accept an answer click on the hollow checkmark next to the answer.  See <a href=\"http://meta.stackoverflow.com/questions/5234/how-does-accepting-an-answer-work\">this page</a> for more detail."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 2, "last_activity_date": 1519712315, "creation_date": 1519712315, "answer_id": 49002307, "question_id": 49002021, "link": "https://stackoverflow.com/questions/49002021/type-convertion-of-randombytestring-from-raaz-crypto-library/49002307#49002307", "title": "Type Convertion of randomByteString from Raaz Crypto Library", "body": "<p>The <code>randomByteString</code> function requires a length argument, which is polymorphic, and yields a monadic result which must be ran using either <code>securely</code> or <code>insecurely</code>.  Putting these together and remembering to give explicit types so there are no ambiguities we get:</p>\n\n<pre><code>securely (randomByteString (10 :: BYTES Int) :: RandM ByteString)\n</code></pre>\n\n<p>In a full program you usually wouldn't need these extra type signatures since they'd naturally appear in function signatures, be inferable, or otherwise appear as typed fields in your program.</p>\n"}], "owner": {"reputation": 489, "user_id": 4445913, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/943fb55bd9a761c56c17d124d1cc3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh Uligade", "link": "https://stackoverflow.com/users/4445913/mahesh-uligade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 49002307, "answer_count": 1, "score": 1, "last_activity_date": 1519712315, "creation_date": 1519710898, "last_edit_date": 1519711005, "question_id": 49002021, "link": "https://stackoverflow.com/questions/49002021/type-convertion-of-randombytestring-from-raaz-crypto-library", "title": "Type Convertion of randomByteString from Raaz Crypto Library", "body": "<p>I was trying to use randomByteString from <a href=\"https://hackage.haskell.org/package/raaz-0.2.0/docs/Raaz-Random.html\" rel=\"nofollow noreferrer\">Raaz</a> Crypto Library. Facing some Issue of type convertion  in this code</p>\n\n<p><br>\n<code>str = randomByteString (42::ALIGN)</code></p>\n\n<p>here this code returns <code>str</code> of type <code>RT mem ByteString</code>, how do I convert it's type to <code>ByteString</code>?</p>\n"}, {"tags": ["haskell", "memory", "profiling", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1519716064, "post_id": 49001868, "comment_id": 85010724, "body": "This works for me: <code>stack build --ghc-options=&#39;-j +RTS -s -RTS&#39;</code>"}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1519749403, "post_id": 49001868, "comment_id": 85031934, "body": "@Sibi that fails for me with <code>ghc: unrecognised flag: -s</code>"}, {"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1519749731, "post_id": 49001868, "comment_id": 85032139, "body": "Ah got it, I had left some flags in the <code>package.yaml</code> file that was causing that error. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 0, "last_activity_date": 1520117676, "creation_date": 1520117676, "answer_id": 49090096, "question_id": 49001868, "link": "https://stackoverflow.com/questions/49001868/how-can-i-profile-how-much-memory-ghc-is-using-to-compile-my-project-using-stack/49090096#49090096", "title": "How can I profile how much memory GHC is using to compile my project using Stack?", "body": "<p>This should work:</p>\n\n<pre><code>stack build --ghc-options='-j +RTS -s -RTS'\n</code></pre>\n"}], "owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 49090096, "answer_count": 1, "score": 0, "last_activity_date": 1520117676, "creation_date": 1519710030, "last_edit_date": 1519733798, "question_id": 49001868, "link": "https://stackoverflow.com/questions/49001868/how-can-i-profile-how-much-memory-ghc-is-using-to-compile-my-project-using-stack", "title": "How can I profile how much memory GHC is using to compile my project using Stack?", "body": "<p>I have a Haskell library built using Stack and I'm trying to see how much memory is used to compile it. What arguments do I pass on the command line to see memory usage during compilation?</p>\n\n<p>I know I need some mix of <code>+RTS</code>, <code>-RTS</code>, and <code>-s</code>, but I always get them mixed up.</p>\n"}, {"tags": ["function", "haskell", "boolean", "iteration"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1519703467, "post_id": 49000640, "comment_id": 85006731, "body": "Note that your Java code contradicts your English explanation."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1519725023, "post_id": 49000640, "comment_id": 85015813, "body": "Note that learning Haskell by translating Java is one of the worst methods, which will often produce non idiomatic code. This holds for any languages, in general: learning Java by translating Haskell will also lead to weird, non idiomatic code. I recommend to read a Haskell tutorial (e.g. LYAH) instead."}], "answers": [{"tags": [], "owner": {"reputation": 9806, "user_id": 382982, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9ZaxF.jpg?s=128&g=1", "display_name": "pdoherty926", "link": "https://stackoverflow.com/users/382982/pdoherty926"}, "is_accepted": false, "score": 2, "last_activity_date": 1519735535, "last_edit_date": 1519735535, "creation_date": 1519703118, "answer_id": 49000772, "question_id": 49000640, "link": "https://stackoverflow.com/questions/49000640/haskell-equivalent-for-loop-with-if-statements/49000772#49000772", "title": "haskell equivalent for loop with if statements", "body": "<p>If you're open to using a library function, one possibility would be to use <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:any\" rel=\"nofollow noreferrer\"><code>any</code></a> to write something like the following: </p>\n\n<pre><code>anyFivesInRangeZeroTo :: (Eq a, Num a, Enum a) =&gt; a -&gt; Bool\nanyFivesInRangeZeroTo n = not $ any (5 ==) [0..n]\n</code></pre>\n\n<p>Another option, if you'd prefer a more loop-like approach, would be to use recursion:</p>\n\n<pre><code>anyFivesInRange' :: (Enum t, Ord t, Num t) =&gt; t -&gt; Bool\nanyFivesInRangeZeroTo' nn = \n  let\n    iter 5 _ = False\n    iter n nn = if n &lt; nn then iter (succ n) nn else True\n  in \n    iter 0 nn\n</code></pre>\n\n<p>This is equivalent to a for loop whose index starts at zero and is incremented by one until either it finds <code>5</code> (by pattern matching on the helper function's first argument) and returns <code>False</code> or reaches the loop boundary and returns <code>True</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 2, "last_activity_date": 1519703151, "creation_date": 1519703151, "answer_id": 49000775, "question_id": 49000640, "link": "https://stackoverflow.com/questions/49000640/haskell-equivalent-for-loop-with-if-statements/49000775#49000775", "title": "haskell equivalent for loop with if statements", "body": "<p>Generally if you're trying to iterate through a list (in this case the list <code>[0..n]</code>) you're talking about a fold. In this case, the fold is over the function:</p>\n\n<pre><code>\\n acc -&gt; n /= 5 &amp;&amp; acc\n</code></pre>\n\n<p>or, simply</p>\n\n<pre><code>(&amp;&amp;) . (/=5)\n</code></pre>\n\n<p>so your function becomes:</p>\n\n<pre><code>isFiveCount n = foldr ((&amp;&amp;) . (/=5)) True [0..n]\n</code></pre>\n\n<p>or point-free</p>\n\n<pre><code>isFiveCount = foldr ((&amp;&amp;) . (/=5)) True . enumFromTo 0\n</code></pre>\n\n<hr>\n\n<p>To write this out with explicit recursion, you'll just keep incrementing your value until you either reach <code>n</code> or <code>5</code>.</p>\n\n<pre><code>isFiveCount n = go 0\n  where\n  go 5 = False  -- base case FAIL\n  go x | x == n    = True  -- base case SUCCESS\n       | otherwise = go (x+1)\n</code></pre>\n\n<hr>\n\n<p>Though of course through simple logic you can reduce this all to</p>\n\n<pre><code>isFiveCount n = n &lt; 5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": true, "score": 2, "last_activity_date": 1519718049, "last_edit_date": 1519718049, "creation_date": 1519714315, "answer_id": 49002781, "question_id": 49000640, "link": "https://stackoverflow.com/questions/49000640/haskell-equivalent-for-loop-with-if-statements/49002781#49002781", "title": "haskell equivalent for loop with if statements", "body": "<p>There are some good answers already, and you\u2019ve already accepted one, but please allow me to go into some more detail about why some different versions are equivalent to the <code>for</code> loop.  (Warning: a bunch of untested code.)  Keep in mind that you won\u2019t normally write a functional program by starting with an imperative approach and converting it.  You\u2019d use different strategies, such as tail recursion.  In fact, strict tail recursion can do everything a <code>for</code> loop can.</p>\n\n<p>The current code sample you give does not appear to match your specification, because it always returns <code>false</code>.  It sounds as if a simple <code>return (i &gt;= 5)</code> would do it, but since this is a learning example, let\u2019s write a <code>for</code> loop:</p>\n\n<pre><code>public static boolean containsFive( int n )\n{\n  for ( int i = 0; i &lt;= n; i++ )\n    if ( i == 5 )\n      return true;\n\n  return false;\n}\n</code></pre>\n\n<p>A <code>for</code> loop is the same as a <code>while</code> loop, as so:</p>\n\n<pre><code>public static boolean containsFive( int n )\n{\n  int i = 0;\n\n  while ( i &lt;= n ) {\n    if ( i == 5 )\n      return true;\n\n    i++;\n  }\n\n  return false;\n}\n</code></pre>\n\n<p>Keeping it simple, one thing we can do is turn the <code>do</code> loop into a function call, with <code>i</code> as a parameter:</p>\n\n<pre><code>public static boolean containsFive(int n)\n{\n  return containsFive( n, 0 );\n}\n\nprivate static boolean containsFive( int n, int i )\n{\n  if (i &gt; n)\n    return false;\n  else if (i == 5)\n    return true;\n  else\n    return containsFive( n, i+1 );\n}\n</code></pre>\n\n<p>Each iteration of the loop is now replaced with a tail-recursive call.  This solution has a close translation into Haskell:</p>\n\n<pre><code>containsFive :: Integral a =&gt; a -&gt; Bool\ncontainsFive n = containsFive' 0 where\n  containsFive' i =\n    if      i &gt; n  then false\n    else if i == 5 then true\n    else                containsFive' (i+1)\n</code></pre>\n\n<p>You\u2019re more likely to see this written with pattern guards, however:</p>\n\n<pre><code>containsFive :: Integral a =&gt; a -&gt; Bool\ncontainsFive n = containsFive' 0 where\n  containsFive' i | i &gt; n     = false\n                  | i == 5    = true\n                  | otherwise = containsFive' (i+1)\n</code></pre>\n\n<p>One subtle difference is that Java will evaluate expressions, such as <code>n-1</code> or <code>i+1</code>, strictly, and Haskell by default evaluates them lazily.  However, the compiler might be able to tell that it\u2019s slightly more optimal to make the parameter strict, and if not, there are a few different ways to tell it.  We could also have passed in <code>n</code> as a second parameter, like we did in Java, but since our helper function here is nested, <code>n</code> remains in scope and passing it again is unnecessary.</p>\n\n<p>Another is that the typeclass <code>Integral</code> is more like an <code>interface</code> and covers some classes that are bigger and more complicated than an <code>Int</code>.  An <code>Integer</code> is more like a bignum.  And, if you\u2019re wondering, you could specify <code>containsFive' :: Integral a =&gt; a -&gt; a -&gt; Bool</code>, but the compiler can deduce from the expression <code>i &gt; n</code> that <code>i</code> must have the same type as <code>n</code>, which is some kind of <code>Integral</code>.  The <code>==</code> operator is from the <code>Eq</code> typeclass and <code>&gt;</code> is from the <code>Ord</code> typeclass.  Numeric constants in Haskell are defined in terms of a <code>fromInteger</code> function that every kind of <code>Num</code> implements, so in context, the constants <code>0</code>, <code>1</code> and <code>5</code> will automatically convert to the type of <code>i</code>, whatever that is.  The <code>+</code> operator is also from <code>Num</code>.  Since we specified that that type implements <code>Integral</code>, it must also implement <code>Num</code>, <code>Eq</code> and <code>Ord</code>, so we\u2019re fine.</p>\n\n<p>So let\u2019s handwave all that and assume each recursive call just passes in the value of <code>i</code> in a register, like in Java.</p>\n\n<p>First, the code runs the recursive function with <code>i</code> initially set to <code>0</code>. The code generator can already optimize away the overhead of creating a stack frame for each function call, and just re-use the same one each time\u2014we\u2019re calling the exact same function, so it has the same number of arguments of the same types and needs the same size stack.  It doesn\u2019t need to change the value of <code>n</code>, but it needs to set the register containing <code>i</code> to <code>i+1</code>.  Then, it jumps back to the beginning of the function and runs it again until the loop condition fails or the test <code>i == 5</code> passes and it terminates early.  That\u2019s exactly the same operation as our original loop!  (Well, unless it was aggressively optimized.)  </p>\n\n<p>You\u2019re even more likely to see this simplified by counting <em>down</em>, as in:</p>\n\n<pre><code>containsFive :: Integral a =&gt; a -&gt; Bool\ncontainsFive 5 = true\ncontainsFive n | n &gt; 0     = containsFive (n-1)\n               | otherwise = false\n</code></pre>\n\n<p>You could also count down in Java as well, by writing <code>for ( int i = n; i &gt; 0; i-- )</code> and some C programmers I\u2019ve talked to swear by it.</p>\n"}], "owner": {"reputation": 43, "user_id": 7746145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/36849e1fe2fad11b5d1072fc04297ed9?s=128&d=identicon&r=PG&f=1", "display_name": "megabowser56", "link": "https://stackoverflow.com/users/7746145/megabowser56"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 634, "favorite_count": 0, "accepted_answer_id": 49002781, "answer_count": 3, "score": -2, "last_activity_date": 1519735535, "creation_date": 1519702197, "question_id": 49000640, "link": "https://stackoverflow.com/questions/49000640/haskell-equivalent-for-loop-with-if-statements", "title": "haskell equivalent for loop with if statements", "body": "<p>HI noob question here but im learning Haskell</p>\n\n<p>I'm trying to understand how to iterate 0 through until n and return false if the iteration contains 5 other wise return true</p>\n\n<p>here is my method</p>\n\n<pre><code> Fivecount :: Integral a =&gt; a -&gt; Bool\n\n isfivecount z =  False\n</code></pre>\n\n<p>want something like this in JAVA</p>\n\n<pre><code>method boolean (n)\n{\nfor(int i = 2; i &lt; n; i++){\n  if(i == 5){\n    return true;\n  }\n  else{\n    return false;\n }\n}\n</code></pre>\n\n<p>Thanks in advance FRIENDS :) an explanation would be cool too, just really trying to understand Haskell.</p>\n"}, {"tags": ["haskell", "macros", "introspection", "template-haskell"], "comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1519701047, "post_id": 49000485, "comment_id": 85006149, "body": "<a href=\"https://stackoverflow.com/questions/tagged/nameof\">nameof</a> seems to be C# specific. Tag carefully please. (by looking at the tag info page) (<b>edit</b> Be careful and don&#39;t make higher-rep users busy)"}, {"owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "reply_to_user": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1519702587, "post_id": 49000485, "comment_id": 85006483, "body": "@user202729, sorry about <code>nameof</code>. I saw that it was C#, but it also seemed like a perfect fit conceptually. Didn&#39;t realize I would be wasting someone&#39;s time; I was hoping to <i>save</i> someone&#39;s time, by giving them a precise idea of what&#39;s in the post before reading it."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 1, "creation_date": 1519702641, "post_id": 49000485, "comment_id": 85006496, "body": "Someone not knowing C# may skip your question because of the tag. For that purpose you have the title."}], "answers": [{"comments": [{"owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "edited": false, "score": 0, "creation_date": 1519705310, "post_id": 49001000, "comment_id": 85007148, "body": "It&#39;s beautiful. Is there a way to avoid writing the quotation marks in <code>$(magic [&quot;x&quot;, &quot;y&quot;])</code>?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "edited": false, "score": 0, "creation_date": 1519705410, "post_id": 49001000, "comment_id": 85007180, "body": "@JeffreyBenjaminBrown it could be modified to take a list of <code>Name</code> values instead. Let me try that modification out."}, {"owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "edited": false, "score": 0, "creation_date": 1519705604, "post_id": 49001000, "comment_id": 85007216, "body": "My goal is to minimize the amount of typing involved. If it&#39;s easier for magic to take a single string containing the terms separated by spaces, I think that would be character-minimal too."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "edited": false, "score": 1, "creation_date": 1519705854, "post_id": 49001000, "comment_id": 85007301, "body": "@JeffreyBenjaminBrown Ah.  Yes, that&#39;s shorter than taking names as arguments. Each <code>name</code> still needs a single quote, and the list still needs to be comma-separated on top of that. Using a single space-separated string is just a matter of a quick change to the type and using the <code>words</code> function."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 5, "last_activity_date": 1519706126, "last_edit_date": 1519706126, "creation_date": 1519704739, "answer_id": 49001000, "question_id": 49000485, "link": "https://stackoverflow.com/questions/49000485/haskell-macro-to-create-a-map-from-their-names-to-some-expressions/49001000#49001000", "title": "Haskell macro to create a Map from their names to some expressions?", "body": "<p>Ok, here's a very quick and dirty implementation of <code>magic</code>:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Language.Haskell.TH\nimport qualified Data.Map as M\n\nmagic :: [String] -&gt; ExpQ\nmagic xs = [| M.fromList $(listE (map toPair xs)) |]\n  where\n    toPair nameStr = do\n        Just name &lt;- lookupValueName nameStr\n        [| (nameStr, $(varE name)) |]\n</code></pre>\n\n<p>Here is using it in ghci:</p>\n\n<pre><code>$ ghci -XTemplateHaskell thmagic.hs\nGHCi, version 8.2.2: http://www.haskell.org/ghc/  :? for help\n[1 of 1] Compiling Main             ( thmagic.hs, interpreted )\nOk, one module loaded.\n*Main&gt; let x = 1 ; y = 2 ; z = \"hello\"\n*Main&gt; $(magic [\"x\", \"y\"])\nfromList [(\"x\",1),(\"y\",2)]\n*Main&gt; $(magic [\"x\", \"y\", \"z\"])\n\n&lt;interactive&gt;:3:3: error:\n    \u2022 No instance for (Num [Char]) arising from a use of \u2018x\u2019\n    \u2022 In the expression: x\n      In the expression: (\"x\", x)\n      In the first argument of \u2018M.fromList\u2019, namely\n        \u2018[(\"x\", x), (\"y\", y), (\"z\", z)]\u2019\n</code></pre>\n\n<p>Note that template haskell is enabled in ghci, and the <code>$()</code> splice syntax is used to tell it to actually splice the generated expression in.  Also note the compile error in the case where not every list entry would have the same type.</p>\n\n<p>This code is quick and dirty, but the happy path is correct.  Error cases result in code that fails to splice, but not necessarily with the friendliest error messages. All in all...  it's a starting point.</p>\n\n<p>Edit - Version with minimal input keystrokes, as described in the comments below:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Language.Haskell.TH\nimport qualified Data.Map as M\n\nmagic :: String -&gt; ExpQ\nmagic names = [| M.fromList $(listE (map toPair (words names))) |]\n  where\n    toPair nameStr = do\n        Just name &lt;- lookupValueName nameStr\n        [| (nameStr, $(varE name)) |]\n</code></pre>\n"}], "owner": {"reputation": 2588, "user_id": 916142, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/cf88a560a7f987712350b7d629ed2bc7?s=128&d=identicon&r=PG", "display_name": "Jeffrey Benjamin Brown", "link": "https://stackoverflow.com/users/916142/jeffrey-benjamin-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 49001000, "answer_count": 1, "score": 2, "last_activity_date": 1519706126, "creation_date": 1519700938, "last_edit_date": 1519702797, "question_id": 49000485, "link": "https://stackoverflow.com/questions/49000485/haskell-macro-to-create-a-map-from-their-names-to-some-expressions", "title": "Haskell macro to create a Map from their names to some expressions?", "body": "<p>I have some variables <code>a</code> and <code>b</code>. I want to create the map <code>Data.Map.fromList [(\"a\",a),(\"b\",b)]</code> rapidly, by typing something like <code>magic [a,b]</code>. I want to do this live in GHCI, not from within a module. </p>\n\n<p>I spent some time learning Template Haskell for this, but I still can't even tell if it's possible. Is it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519687287, "post_id": 48998675, "comment_id": 85002755, "body": "Please make this a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. A couple of ugly/uneeded lines aren&#39;t too bad a problem if you can&#39;t easily reduce them, but if your program requires external files and/or command-line arguments, we can hardly verify it. Best give a single function invocation from GHCi as example."}, {"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 0, "creation_date": 1519689999, "post_id": 48998675, "comment_id": 85003516, "body": "Here&#39;s your debug print statement: <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Debug-Trace.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.10.1.0/docs/Debug-Trace.h&zwnj;&#8203;tml</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": true, "score": 6, "last_activity_date": 1519690503, "creation_date": 1519690503, "answer_id": 48999167, "question_id": 48998675, "link": "https://stackoverflow.com/questions/48998675/haskell-how-to-find-an-infinite-loop/48999167#48999167", "title": "Haskell How to find an infinite loop?", "body": "<p>If your list is infinite, that means <code>creerSon</code> always goes to the first case, which means <code>temps</code> is always smaller than <code>calcDuree note tempo temps</code>, which is because <code>calcDuree</code> has <code>+ temps</code> at the end.</p>\n\n<p>I noticed this by refactoring away at your code, making it shorter using library functions such as <code>map</code>, until I could read it.</p>\n\n<p>You could have noticed this by running a code coverage tool such as <code>stack test --coverage</code> on your program to see what code ever gets reached.</p>\n"}], "owner": {"reputation": 21, "user_id": 9120683, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155186797968601/picture?type=large", "display_name": "Anthony Gauthier", "link": "https://stackoverflow.com/users/9120683/anthony-gauthier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 48999167, "answer_count": 1, "score": 0, "last_activity_date": 1519690503, "creation_date": 1519687137, "question_id": 48998675, "link": "https://stackoverflow.com/questions/48998675/haskell-how-to-find-an-infinite-loop", "title": "Haskell How to find an infinite loop?", "body": "<p>I am a complete beginner at haskell and as such, I have a hard time debugging since it's so different from imperative languages. When I try to run this code, I get an infinite list of <code>Int</code> and I have no idea of why it's infinite. Now I know the code is probably very ugly and in no way efficient, but my goal is just to make it work, not make it work efficiently.</p>\n\n<pre><code>chaineVersSon :: String -&gt; Int -&gt; [Int]\nchaineVersSon chaineAInterpreter battementParMinute = integriser (concat \n(musicaliser (freqNotes (interpreter 9 4 1 5 chaineAInterpreter [])) \nbattementParMinute))\n\nintegriser :: [Double] -&gt; [Int]\nintegriser [] = []\nintegriser (note:notes) = (floor (note * 32767)):integriser notes\n\nmusicaliser :: [(Double, (Double, Double))] -&gt; Int -&gt; [[Double]]\nmusicaliser [] _ = []\nmusicaliser (note:notes) tempo = (creerSon note tempo 0):musicaliser notes tempo\n\ncreerSon :: (Double, (Double, Double)) -&gt; Int -&gt; Double -&gt; [Double]\ncreerSon note tempo temps\n    | temps &lt; (calcDuree note tempo temps) = (echantillonner note \ntemps):creerSon note tempo (temps + (1/(fromIntegral frequenceEchantillonage)))\n    | temps == (calcDuree note tempo temps) = (echantillonner note temps):[]\n\ncalcDuree :: (Double, (Double, Double)) -&gt; Int -&gt; Double -&gt; Double\ncalcDuree note tempo temps = (60 * (fst(snd note)) / (fromIntegral tempo)) / \n(1/(fromIntegral frequenceEchantillonage)) + temps\n\nechantillonner :: (Double, (Double, Double)) -&gt; Double -&gt; Double\nechantillonner note temps = ((snd (snd note)) / 10) * sin(2 * pi * (fst     note) * temps)\n\n--Fonction qui traite toutes les modifications d'\u00e9tat\ninterpreter :: Int -&gt; Int -&gt; Double -&gt; Double -&gt; String -&gt; [((Int, Int), \n(Double, Double))] -&gt; [((Int, Int), (Double, Double))]\ninterpreter _ _ _ _ [] _ = []\ninterpreter note octave duree volume (etat:chaine) pile\n    | etat == '0' = interpreter note octave duree 0 chaine pile\n    | etat == '.' = interpreter note octave (duree*1.5) volume chaine pile\n    | etat == '/' = interpreter note octave (duree/2) volume chaine pile\n    | etat == '[' = interpreter note octave duree volume chaine (((note, octave), (duree, volume)):pile)\n    | etat == ']' = interpreter (fst (fst save)) (snd (fst save)) (fst (snd save)) (snd (snd save)) chaine pile\n    | etat &gt;= 'a' &amp;&amp; etat &lt;= 'g' = interpreter (changerNote etat) octave duree volume chaine pile\n    | etat &gt;= '2' &amp;&amp; etat &lt;= '9' = interpreter note (read [etat]) duree volume chaine pile\n    | etat == '&amp;' = interpreter (fst (diminuer note octave)) (snd (diminuer note octave)) duree volume chaine pile\n    | etat == '&amp;' = interpreter (fst (augmenter note octave)) (snd (augmenter note octave)) duree volume chaine pile\n    | etat == '!' = ((note, octave), (duree, volume)):(interpreter note octave duree volume chaine pile)\n    | otherwise = interpreter note octave duree volume chaine pile\n                      where save = head pile\n\n--Fonction pour changer la note selon l'option fournie\nchangerNote :: Char -&gt; Int\nchangerNote etat\n    | etat == 'a' = 9\n    | etat == 'b' = 11\n    | etat == 'c' = 0\n    | etat == 'd' = 2\n    | etat == 'e' = 4\n    | etat == 'f' = 5\n    | etat == 'g' = 7\n\n--Fonction qui diminue la note et l'octave si possible/n\u00e9c\u00e9ssaire\ndiminuer :: Int -&gt; Int -&gt; (Int, Int)\ndiminuer note octave\n    | note &gt; 0 = (note - 1, octave)\n    | note == 0 &amp;&amp; octave == 2 = (note, octave)\n    | otherwise = (11, octave - 1)\n\n--Fonction qui augmente la note et l'octave si possible/n\u00e9c\u00e9ssaire\naugmenter :: Int -&gt; Int -&gt; (Int, Int)\naugmenter note octave\n    | note &lt; 11 = (note + 1, octave)\n    | note == 11 &amp;&amp; octave == 9 = (note, octave)\n    | otherwise = (0, octave + 1)\n\n--Fonction r\u00e9cursive pour calculer la fr\u00e9quence de chaque note \u00e0 jouer\nfreqNotes :: [((Int, Int), (Double, Double))] -&gt; [(Double, (Double, Double))]\nfreqNotes [] = []\nfreqNotes (note:notes) = ((calcFrequence (fromIntegral (fst (fst note)))     (fromIntegral (snd (fst note)))), (fst (snd note), snd (snd note))):freqNotes     notes\n\n--Fonction qui calcule la fr\u00e9quence selon la note et l'octave\ncalcFrequence :: Double -&gt; Double -&gt; Double\ncalcFrequence note octave = 440 * (2**(1/12))**((12 * octave) + note - 57)\n\nmain::IO()\nmain = do argv &lt;- getArgs\n          chaine &lt;- readFile ( argv !! 0 )\n          print \"Begin...\"\n          print ( chaineVersSon chaine ( ( read ( argv !! 1 ) ) :: Int ) )\n          print \"Done!\"\n</code></pre>\n\n<p>Normally in other languages I would just print things everywhere and see where the results get wrong but I don't know how to do that in Haskell without rewriting almost the entire code. What kind of method should I use to find where my code goes wrong?</p>\n\n<p>I've read about trace, but I can't seem to be able to actually print anything with it.</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1519692303, "post_id": 48998565, "comment_id": 85004084, "body": "There are <a href=\"https://hackage.haskell.org/package/path-0.6.1/docs/Path.html#v:parseAbsDir\" rel=\"nofollow noreferrer\">functions</a> in <code>path</code> to parse paths."}, {"owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1519843682, "post_id": 48998565, "comment_id": 85077925, "body": "I saw these functions and I use them, but I do not see how to construct a Read instance with them. Unfortunately, the readsPrec function has a different type."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1519860657, "post_id": 48998565, "comment_id": 85086061, "body": "Sure, the definition is not as trivial as <code>readsPrec = parseAbsDir</code> but it is still quite simple. If you have tried to implement <code>Read</code> with these functions but did not succeed, include your attempts and any relevant errors in your question."}], "answers": [{"tags": [], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "is_accepted": false, "score": 0, "last_activity_date": 1520189316, "creation_date": 1520189316, "answer_id": 49099064, "question_id": 48998565, "link": "https://stackoverflow.com/questions/48998565/add-a-read-instance-to-path-to-path-package/49099064#49099064", "title": "add a Read instance to Path to Path package", "body": "<p>I exploit the fact, that the show function of Path produces a String </p>\n\n<pre><code>instance Show (Path b t) where\n  show = show . toFilePath\n</code></pre>\n\n<p>Therefore, the read can first read the string and then analyze the string: </p>\n\n<pre><code>instance Read (Path Abs Dir) where\n   readsPrec i r =   \n        maybe []  (\\res -&gt; [(Path res, rem1)] ) $ Path.parseAbsDir x\n        where  [(x ::String , rem1)] = readsPrec i r\n</code></pre>\n\n<p>I do not like the approach very much and had prefered a parser for a file path not relying on the \"..\" around the value. </p>\n\n<p>Any suggestions how this can be improved? </p>\n"}], "owner": {"reputation": 1479, "user_id": 855443, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d880e98c9fffc6253f3868babc99b8c1?s=128&d=identicon&r=PG", "display_name": "user855443", "link": "https://stackoverflow.com/users/855443/user855443"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1520189316, "creation_date": 1519686530, "question_id": 48998565, "link": "https://stackoverflow.com/questions/48998565/add-a-read-instance-to-path-to-path-package", "title": "add a Read instance to Path to Path package", "body": "<p>I like the Path package and use it often. The main inconvenience for me is the lack of a Read instance for Path. It is obvious that one would require 4 different instances like</p>\n\n<pre><code>instance Read (Path Rel File) where\ninstance Read (Path Rel Dir) where\ninstance Read (Path Abs Dir) where\ninstance Read (Path Abs File) where\n</code></pre>\n\n<p>but I cannot see how to define the <code>readsPrec</code> function. It would need a parser function for filepath. \nI guess that somebody has already written a parser for file path and I understand that a lot of special cases must be considered. I cannot find such a function. Where should I look?  </p>\n"}, {"tags": ["haskell", "purescript", "recordtype", "row-polymorphism"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1519671035, "post_id": 48994927, "comment_id": 84995634, "body": "Without some advanced techniques, that kind of information just isn&#39;t available from a value. Why do you think you <i>need</i> <code>myImaginaryFunction</code>?"}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519671122, "post_id": 48994927, "comment_id": 84995672, "body": "@chepner, Because I have records and I wanna see what&#39;s common in there? I don&#39;t understand why I don&#39;t need it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519671232, "post_id": 48994927, "comment_id": 84995739, "body": "What would you do with such a list of strings?"}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519671263, "post_id": 48994927, "comment_id": 84995754, "body": "@chepner, show them on the UI. :)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519671333, "post_id": 48994927, "comment_id": 84995809, "body": "Your UI shouldn&#39;t be exposing type information. You want to store the field names as data, not static functions (which is what such field labels really are)."}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519671384, "post_id": 48994927, "comment_id": 84995835, "body": "@chepner, a field <code>name</code> <i>is</i> <code>data</code> not a type. Its <code>type</code> is type."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519671585, "post_id": 48994927, "comment_id": 84995958, "body": "<code>name</code> is a function of type <code>A -&gt; String</code> (or <code>B -&gt; String</code>; you need a language extension to even allow <code>name</code> to be used in both <code>A</code> and <code>B</code>). It&#39;s not an attribute that you can somehow query from a value of type <code>A</code> (or <code>B</code>)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519671749, "post_id": 48994927, "comment_id": 84996038, "body": "(<i>Completely</i> ignoring the fact that <code>type A = { name :: String, color :: String }</code> is not even valid Haskell.)"}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519671854, "post_id": 48994927, "comment_id": 84996092, "body": "@chepner, originally posted as a <code>PureScript</code> question but then I cheated a little to get a more views. So you&#39;re saying there is no such <a href=\"https://clojuredocs.org/clojure.core/keys\" rel=\"nofollow noreferrer\">keys</a> in Haskell?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519672064, "post_id": 48994927, "comment_id": 84996213, "body": "There is, but you need to use something like <code>newtype A = A {name :: String, color :: String}</code>. The point stands, though, that you can&#39;t (easily) introspect the list of field names from a value of type <code>A</code>."}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519672223, "post_id": 48994927, "comment_id": 84996275, "body": "@chepner, Thanks. Not values. I have defined types. But imagine I have 100 <code>A</code>, <code>B</code>, <code>C</code>, ... types. Not sure if I&#39;m asking this correctly."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1519674477, "post_id": 48994927, "comment_id": 84997312, "body": "@norbertpy You want to look at the <code>Generic</code> typeclass (I&#39;m not sure if it exists in PureScript, I hope it does). This is the standard approach for things like generating JSON serialization. It should be fairly easy to adapt this for your purposes. I&#39;d offer a Haskell answer, but it would be very tied to the particulars of <code>GHC.Generics</code> or <code>syb</code> (I don&#39;t know if PureScript has that either)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1519674700, "post_id": 48994927, "comment_id": 84997409, "body": "Please make it clear what language you&#39;re aiming a question at. If you tag it with Haskell, clarify how your question relates to it. In Haskell, this whole idea really doesn&#39;t make much sense. If you consider types as more or less dictionaries, then this can at best be dependently-typed, which Haskell doesn&#39;t do. You can not even really give multiple different record types fields with the same name. There are some ways you could trick something similar to work in modern GHC, but it&#39;s highly questionable if it&#39;s sensible. In PureScript \u2013 no idea."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1519675755, "post_id": 48994927, "comment_id": 84997897, "body": "Also, if the choice of &quot;Haskell-like&quot; language doesn&#39;t matter to you, consider looking at <a href=\"http://elm-lang.org\" rel=\"nofollow noreferrer\">elm-lang.org</a> instead.  It actually has support for the kind of record-based structural typing you seem to want to do.  (Though I think writing type-level functions to automatically find lists of common fields is still off the table.)"}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1519687100, "post_id": 48994927, "comment_id": 85002716, "body": "@K.A.Buhr PureScript also has record-based structural typing, but it&#39;s a lot less restrictive than Elm."}], "answers": [{"comments": [{"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 0, "creation_date": 1519680241, "post_id": 48997238, "comment_id": 85000043, "body": "I&#39;m more interested in type-level functions. <code>Array String</code>, doesn&#39;t enforce anything. I cannot be sure if the string value is really part of my record fields. Array of <code>name | color</code> is what I expect."}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 0, "creation_date": 1519680327, "post_id": 48997238, "comment_id": 85000094, "body": "Regarding, the cheat, I&#39;m getting familiar with type systems to see how they solve a very simplistic problem. Haskell, ELM, PureScript is irrelevant. They all seem to struggle the same way."}, {"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "reply_to_user": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 0, "creation_date": 1519681290, "post_id": 48997238, "comment_id": 85000570, "body": "How are you not interested in <code>Array String</code> when you mentioned it yourself right there in your question, as the expected return type of your function?!"}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 0, "creation_date": 1519681488, "post_id": 48997238, "comment_id": 85000640, "body": "Updated to avoid confusion. But you <i>knew</i> what I meant."}], "tags": [], "owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "is_accepted": false, "score": -2, "last_activity_date": 1519679821, "creation_date": 1519679821, "answer_id": 48997238, "question_id": 48994927, "link": "https://stackoverflow.com/questions/48994927/infer-a-type-for-common-fields-in-two-records/48997238#48997238", "title": "infer a type for common fields in two records", "body": "<p>Well, since your function really returns an array of string, then the return type should just be <code>Array String</code>.</p>\n\n<p>Types of arguments would be genetic, since you don't know types in advance. If you really want to make sure that these types are actually records, you can make your generic parameters not records themselves, but <em>type rows</em>, and then type value parameters as <code>Record a</code>.</p>\n\n<p>So:</p>\n\n<pre><code>myImaginaryFunction :: forall a b. Record a -&gt; Record b -&gt; Array String\n</code></pre>\n\n<p>This is how you <strong>type</strong> such function.</p>\n\n<p>Or was your question really about how to <strong>implement</strong> it?</p>\n\n<p>Also: have you noticed how cheating (by adding Haskell tag) didn't really bring you any help, but only some scolding? Please don't do this. Respect the community.</p>\n"}, {"comments": [{"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 0, "creation_date": 1519681239, "post_id": 48997507, "comment_id": 85000537, "body": "Hah, thanks very much for the answer. This is great."}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 0, "creation_date": 1519749500, "post_id": 48997507, "comment_id": 85031996, "body": "Seems like I need dependent-types which nor Haskell neither Elm or PureScript support."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1519681003, "creation_date": 1519681003, "answer_id": 48997507, "question_id": 48994927, "link": "https://stackoverflow.com/questions/48994927/infer-a-type-for-common-fields-in-two-records/48997507#48997507", "title": "infer a type for common fields in two records", "body": "<p>To express two record types with common fields in Haskell, you'll need a GHC extension:</p>\n\n<pre><code>{-# LANGUAGE DuplicateRecordFields #-}\n</code></pre>\n\n<p>and to introspect the names of the fields, you'll need generics based on the <code>Data</code> class:</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\nimport Data.Data ( Data, Typeable, DataRep(AlgRep), dataTypeRep\n                 , dataTypeOf, constrFields)\nimport Data.List (intersect)\nimport Data.Proxy (Proxy(..), asProxyTypeOf)\n</code></pre>\n\n<p>This will allow you to define two data types using the same field names:</p>\n\n<pre><code>data Address = Address String deriving (Typeable, Data)\ndata A = A { name :: String, color :: String }\n    deriving (Typeable, Data)\ndata B = B { name :: String, address :: Address, color :: String}\n    deriving (Typeable, Data)\n</code></pre>\n\n<p>and then you can retrieve the field names using:</p>\n\n<pre><code>fieldNames :: (Data t) =&gt; Proxy t -&gt; [String]\nfieldNames t = case dataTypeRep $ dataTypeOf $ asProxyTypeOf undefined t of\n  AlgRep [con] -&gt; constrFields con\n</code></pre>\n\n<p>and get the common fields with:</p>\n\n<pre><code>commonFields :: (Data t1, Data t2) =&gt; Proxy t1 -&gt; Proxy t2 -&gt; [String]\ncommonFields t1 t2 = intersect (fieldNames t1) (fieldNames t2)\n</code></pre>\n\n<p>After which the following will work:</p>\n\n<pre><code>ghci&gt; commonFields (Proxy :: Proxy A) (Proxy :: Proxy B)\n[\"name\", \"color\"]\nghci&gt;\n</code></pre>\n\n<p>Note that the implementation of <code>fieldNames</code> above assumes that only record types with a single constructor will be introspected.  See the documentation for <code>Data.Data</code> if you want to generalize it.</p>\n\n<p>Now, because you're a help vampire, I know that you will demand a type level function, even though you said nothing in your question about requiring a type-level function!  In fact, I can see you've already added a comment about how you're interested in somehow returning an array of <code>name | color</code> though no such thing exists in Haskell and even though you explicitly said in your question that you expected the term-level answer <code>[\"name\", \"color\"]</code>.</p>\n\n<p>Still, there may be non-vampires with a similar question, and perhaps this answer will help them instead.</p>\n"}, {"comments": [{"owner": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1519867735, "post_id": 49027160, "comment_id": 85087808, "body": "The OP said he doesn&#39;t want an array returned (or, I presume, a list), because, quote, &quot;Array doesn&#39;t enforce anything&quot;. But he failed to specify what exactly he does want."}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "reply_to_user": {"reputation": 66224, "user_id": 180286, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/tAXU2.jpg?s=128&g=1", "display_name": "Fyodor Soikin", "link": "https://stackoverflow.com/users/180286/fyodor-soikin"}, "edited": false, "score": 0, "creation_date": 1519870784, "post_id": 49027160, "comment_id": 85088550, "body": "@FyodorSoikin, I said <i>Array of String</i> doesn&#39;t enforce anything. Array of Color enforces that I will have Colors in there."}, {"owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "edited": false, "score": 0, "creation_date": 1519870929, "post_id": 49027160, "comment_id": 85088588, "body": "Still too much ceremony for such a simple task. And you Haskell-people never lose an opportunity to make snarky comment. This guy LOLed on his twitter account while you feel you were disrespected and started downvoting. Such a horrible community."}], "tags": [], "owner": {"reputation": 1168, "user_id": 1784261, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3b48c91bf6b6f0bfd0fda50625598656?s=128&d=identicon&r=PG", "display_name": "kakigoori", "link": "https://stackoverflow.com/users/1784261/kakigoori"}, "is_accepted": false, "score": 4, "last_activity_date": 1519813328, "creation_date": 1519813328, "answer_id": 49027160, "question_id": 48994927, "link": "https://stackoverflow.com/questions/48994927/infer-a-type-for-common-fields-in-two-records/49027160#49027160", "title": "infer a type for common fields in two records", "body": "<p>For Haskell, I like K.A. Buhr's answer, but personally I would not use Typeable and instead reach for GHC Generics. I think that might be preference at this point though.</p>\n\n<p>For PureScript, I wrote about this kind of problem in my blog post <a href=\"https://qiita.com/kimagure/items/ca229cb4ba76db0c24a8\" rel=\"nofollow noreferrer\">Making Diffs of differently-typed Records in PureScript</a> earlier this month. The approach is completely different from what you have with languages that don't have row types (No, Elm does not have these. You really don't get a solution there other than to use a homogeneous String Map).</p>\n\n<p>First off, if you're at all familiar with PureScript, you might want to use <a href=\"https://pursuit.purescript.org/builtins/docs/Prim#t:Union\" rel=\"nofollow noreferrer\">Union</a>, but this won't work either, as you'd want to do something like:</p>\n\n<pre><code>Union r1' r r1\n</code></pre>\n\n<p>Where <code>r1'</code> would be the complement of the shared subtype <code>r</code> between your first record <code>r1</code> and <code>r2</code>. The reason being that you have two unsolved variables here, and the functional dependencies of Union require that any two of three parameters of Union be solved for.</p>\n\n<p>So since we can't use Union directly, we'll have to craft some kind of solution. Since I can get a RowList structure that is sorted by keys, I opted to use this to walk through the two different records' RowLists and get out the intersection:</p>\n\n<pre><code>class RowListIntersection\n  (xs :: RowList)\n  (ys :: RowList)\n  (res :: RowList)\n  | xs ys -&gt; res\n\ninstance rliNilXS :: RowListIntersection Nil (Cons name ty tail) Nil\ninstance rliNilYS :: RowListIntersection (Cons name ty tail) Nil Nil\ninstance rliNilNil :: RowListIntersection Nil Nil Nil\ninstance rliConsCons ::\n  ( CompareSymbol xname yname ord\n  , Equals ord EQ isEq\n  , Equals ord LT isLt\n  , Or isEq isLt isEqOrLt\n  , If isEq xty trashty yty\n  , If isEq xty trashty2 zty\n  , If isEq (SProxy xname) trashname (SProxy zname)\n  , If isEq\n      (RLProxy (Cons zname zty res'))\n      (RLProxy res')\n      (RLProxy res)\n  , If isEqOrLt\n      (RLProxy xs)\n      (RLProxy (Cons xname xty xs))\n      (RLProxy xs')\n  , If isLt\n      (RLProxy (Cons xname yty ys))\n      (RLProxy ys)\n      (RLProxy ys')\n  , RowListIntersection xs' ys' res'\n  ) =&gt; RowListIntersection (Cons xname xty xs) (Cons yname yty ys) res\n</code></pre>\n\n<p>Then I used a short definition for getting the keys of the resulting RowList out:</p>\n\n<pre><code>class Keys (xs :: RowList) where\n  keysImpl :: RLProxy xs -&gt; List String\n\ninstance nilKeys :: Keys Nil where\n  keysImpl _ = mempty\n\ninstance consKeys ::\n  ( IsSymbol name\n  , Keys tail\n  ) =&gt; Keys (Cons name ty tail) where\n  keysImpl _ = first : rest\n    where\n      first = reflectSymbol (SProxy :: SProxy name)\n      rest = keysImpl (RLProxy :: RLProxy tail)\n</code></pre>\n\n<p>So together, I can define a function like so to get the shared labels:</p>\n\n<pre><code>getSharedLabels\n  :: forall r1 rl1 r2 rl2 rl\n  . RowToList r1 rl1\n  =&gt; RowToList r2 rl2\n  =&gt; RowListIntersection rl1 rl2 rl\n  =&gt; Keys rl\n  =&gt; Record r1\n  -&gt; Record r2\n  -&gt; List String\ngetSharedLabels _ _ = keysImpl (RLProxy :: RLProxy rl)\n</code></pre>\n\n<p>Then we can see results we expect:</p>\n\n<pre><code>main = do\n  logShow &lt;&lt;&lt; Array.fromFoldable $\n    getSharedLabels\n      { a: 123, b: \"abc\" }\n      { a: 123, b: \"abc\", c: true }\n  -- logs out [\"a\",\"b\"] as expected\n</code></pre>\n\n<p>If you're new to RowList/RowToList, you might consider reading through my <a href=\"https://speakerdeck.com/justinwoo/rowlist-fun-with-purescript-2nd-edition\" rel=\"nofollow noreferrer\">RowList Fun With PureScript 2nd Edition</a> slides.</p>\n\n<p>I put the code for this answer <a href=\"https://github.com/justinwoo/shared-labels-two-records/blob/master/src/Main.purs\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>If all this seems too involved, your other solution may be to coerce the records into a String Map and get the set union of the keys. I don't know if this is an answer in Elm though, since the runtime representation of a String Map probably does not match Record's. But for PureScript, this is one option as StrMap's runtime representation is the same as a Record.</p>\n"}, {"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1520309023, "creation_date": 1520309023, "answer_id": 49123187, "question_id": 48994927, "link": "https://stackoverflow.com/questions/48994927/infer-a-type-for-common-fields-in-two-records/49123187#49123187", "title": "infer a type for common fields in two records", "body": "<p>Actually, after giving this some more thought, I guess it <em>is</em> possible to do what you <em>actually</em> want to do in modern Haskell, if what you <em>actually</em> want to do is work with a record type with named fields at the type level, including doing things like compile-time derivation of a new record type using the common fields from two other records.</p>\n\n<p>It's a little involved and a little ugly, though some bits work surprisingly well.  Yes, of course it's \"too much ceremony for such a simple task\", but bear in mind that we're trying to implement a brand new, non-trivial, type-level feature (a sort of dependent structural typing).  The only way to make this a simple task is to bake the feature into the language and its type system from the beginning; otherwise, it's going to be complicated.</p>\n\n<p>Anyway, until we get the <code>DependentTypes</code> extension, you have to enable a small number (ha ha) of extensions explicitly: </p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes       #-}\n{-# LANGUAGE GADTs                     #-}\n{-# LANGUAGE KindSignatures            #-}\n{-# LANGUAGE ScopedTypeVariables       #-}\n{-# LANGUAGE TemplateHaskell           #-}\n{-# LANGUAGE TypeApplications          #-}\n{-# LANGUAGE TypeFamilies              #-}\n{-# LANGUAGE TypeInType                #-}\n{-# LANGUAGE TypeOperators             #-}\n{-# LANGUAGE UndecidableInstances      #-}\n{-# OPTIONS_GHC -Wincomplete-patterns  #-}\n\nmodule Records where\n</code></pre>\n\n<p>We'll make a fair bit of use of the <code>singletons</code> package and its submodules: the <code>Prelude</code> for basic type-level functions like <code>Map</code>, <code>Fst</code>, and <code>Lookup</code>; the <code>TH</code> module for generating our own singleton and promoted functions with Template Haskell splices; and <code>TypeLits</code> for working with the <code>Symbol</code> type (i.e., string literals at the type level).</p>\n\n<pre><code>import Data.Singletons.Prelude\nimport Data.Singletons.TH\nimport Data.Singletons.TypeLits\n</code></pre>\n\n<p>We'll also need some other odds and ends.  <code>Text</code> is only needed because it's the unlifted (\"demoted\") version of <code>Symbol</code>.</p>\n\n<pre><code>import Data.Function ((&amp;))\nimport Data.Kind (Type)\nimport Data.List (intersect)\nimport qualified Data.Text as Text\n</code></pre>\n\n<p>We won't be able to work with usual Haskell records.  Instead, we'll define a <code>Record</code> type constructor.  This type constructor will be indexed by a list of <code>(Symbol, Type)</code> pairs, where the <code>Symbol</code> gives the field name, and the <code>Type</code> gives the type of the value stored in that field.</p>\n\n<pre><code>data Record :: [(Symbol, Type)] -&gt; Type where\n</code></pre>\n\n<p>Already, there are several major implications to this design decision:</p>\n\n<ul>\n<li>The same field name in different record types can refer to different field value types.</li>\n<li>Fields are ordered in the record, so record types are only the same if they have the same fields, with the same types, in the same <em>order</em>.</li>\n<li>The same field can appear multiple times in a record, even though the accessor function we provide will only access one (the last added).</li>\n</ul>\n\n<p>In dependently typed programs, design decisions tend to run deep.  If, for example, the same field could not appear multiple times, we would need to find a way to reflect that in the type and then make sure that all our functions were able to supply appropriate proof that a duplicate field wasn't being added.</p>\n\n<p>Anyway, back to our <code>Record</code> type constructor.  There will be two data constructors, a <code>Record</code> constructor to create an empty record:</p>\n\n<pre><code>  Record :: Record '[]\n</code></pre>\n\n<p>and a <code>With</code> constructor to add a field to a record:</p>\n\n<pre><code>  With :: SSymbol s -&gt; t -&gt; Record fs -&gt; Record ('(s, t) : fs)\n</code></pre>\n\n<p>Note that <code>With</code> requires a runtime representative for the <code>s :: Symbol</code> in the form of a symbol singleton <code>SSymbol s</code>  The convenience function <code>with_</code> will make this singleton implicit:</p>\n\n<pre><code>with_ :: forall s t fs . (SingI s) =&gt; t -&gt; Record fs -&gt; Record ('(s, t) : fs)\nwith_ = With sing\n</code></pre>\n\n<p>with the idea that by allowing ambiguous types and using type application, we expose the following reasonably succint syntax for defining records.  The explicit type signatures are not necessary here but are included to make it clear what's being created:</p>\n\n<pre><code>rec1 :: Record '[ '(\"bar\", [Char]), '(\"foo\", Int)]\nrec1 = Record &amp; with_ @\"foo\" (10 :: Int)\n              &amp; with_ @\"bar\" \"Hello, world\"\n-- i.e., rec1 = { foo = 10, bar = \"Hello, world\" } :: { foo :: Int, bar :: String }\n\nrec2 :: Record '[ '(\"quux\", Maybe Double), '(\"foo\", Int)]\nrec2 = Record &amp; with_ @\"foo\" (20 :: Int)\n              &amp; with_ @\"quux\" (Just 1.0 :: Maybe Double)\n-- i.e., rec2 = { foo = 20, quux = Just 1.0 } :: { foo :: Int, quux :: Maybe Double }\n</code></pre>\n\n<p>To prove that this record type is useful, we'll define a type-safe field accessor.  Here's one that uses an explicit singleton to select the field:</p>\n\n<pre><code>field :: forall s t fs . (Lookup s fs ~ Just t) =&gt; SSymbol s -&gt; Record fs -&gt; t\nfield s (With s' t r)\n  = case s %:== s' of\n      STrue -&gt; t\n      SFalse -&gt; field s r\n</code></pre>\n\n<p>and a helper with an implict singleton:</p>\n\n<pre><code>field_ :: forall s t fs . (Lookup s fs ~ Just t, SingI s) =&gt; Record fs -&gt; t\nfield_ = field @s sing\n</code></pre>\n\n<p>which is intended to be used with a type application like so:</p>\n\n<pre><code>exField = field_ @\"foo\" rec1\n</code></pre>\n\n<p>Note that trying to access a nonexistent field won't type-check.  The error message isn't ideal, but at least it's a compile-time error:</p>\n\n<pre><code>-- badField = field_ @\"baz\" rec1  -- gives: Couldn't match type Nothing with Just t\n</code></pre>\n\n<p>The definition of <code>field</code> gives a hint of the power of the <code>singletons</code> library.  We're using the type-level <code>Lookup</code> function which has been automatically generated via Template Haskell from a term-level definition that looks exactly like the following (taken from the <code>singletons</code> source and renamed to avoid conflicts):</p>\n\n<pre><code>lookup'                  :: (Eq a) =&gt; a -&gt; [(a,b)] -&gt; Maybe b\nlookup' _key []          =  Nothing\nlookup'  key ((x,y):xys) = if key == x then Just y else lookup' key xys\n</code></pre>\n\n<p>Using only the context <code>Lookup s fs ~ Just t</code>, GHC is able to determine that:</p>\n\n<ol>\n<li><p>Because the context implies this field will be found in the list, the second argument of <code>field</code> can never be the empty record <code>Record</code>, so there is no warning about incomplete patterns for <code>field</code>, and in fact you'll get a type error if you try to handle this as a runtime error by adding the case: <code>field s Record = error \"ack, something went wrong!\"</code></p></li>\n<li><p>The recursive call to <code>field</code> is type-correct if we're in the <code>SFalse</code> branch.  That is, GHC has figured out that if we can successfully <code>Lookup</code> the key <code>s</code> in the list but it's not at the head, we must be able to look it up in the tail.</p></li>\n</ol>\n\n<p>(This is amazing to me, but anyway...)</p>\n\n<p>Those are the basics of our record type.  To introspect field names at either runtime or compile time, we'll introduce a helper, which we'll lift to the type level (i.e., the type-level function <code>Names</code>) using Template Haskell:</p>\n\n<pre><code>$(singletons [d|\n  names :: [(Symbol, Type)] -&gt; [Symbol]\n  names = map fst\n  |])\n</code></pre>\n\n<p>Note that the type-level function <code>Names</code> can provide compile-time access to the field names of the record, for example in the hypothetical type signature:</p>\n\n<pre><code>data SomeUIType fs = SomeUIType -- a UI for the given compile-time list of fields\nrecordUI :: Record fs -&gt; SomeUIType (Names fs)\nrecordUI _ = SomeUIType\n</code></pre>\n\n<p>More likely, though, we'll want to work with field names at runtime.  Using <code>Names</code>, we can define the following function to take a record and return its list of field names as a singleton.  Here, <code>SNil</code> and <code>SCons</code> are the singleton equivalents of the terms <code>[]</code> and <code>(:)</code>.</p>\n\n<pre><code>sFields :: Record fs -&gt; Sing (Names fs)\nsFields Record = SNil\nsFields (With s _ r) = SCons s (sFields r)\n</code></pre>\n\n<p>And here's a version that returns a <code>[Text]</code> instead of a singleton.</p>\n\n<pre><code>fields :: Record fs -&gt; [Text.Text]\nfields = fromSing . sFields\n</code></pre>\n\n<p>Now, if you just want to get a runtime list of common fields of two records, you can do:</p>\n\n<pre><code>rec12common = intersect (fields rec1) (fields rec2)\n-- value:  [\"foo\"]\n</code></pre>\n\n<p>What about creating a type with common fields at compile time?  Well, we can define the following function to get the left-biased set of fields with common names.  (It's \"left-biased\" in the sense that if matching fields in two records have different types, it'll take the type of the first record.)  Again, we use the <code>singletons</code> package and Template Haskell to lift it to a type-level <code>Common</code> function:</p>\n\n<pre><code>$(singletons [d|\n  common :: [(Symbol,Type)] -&gt; [(Symbol,Type)] -&gt; [(Symbol,Type)]\n  common [] _ = []\n  common (x@(a,b):xs) ys\n    = if elem a (map fst ys)\n      then x:common xs ys\n      else   common xs ys\n  |])\n</code></pre>\n\n<p>This allows us to define a function that takes two records and reduces the first record to the set of fields with the same name as fields in the second record:</p>\n\n<pre><code>reduce :: Record fs1 -&gt; Record fs2 -&gt; Record (Common fs1 fs2)\nreduce Record _ = Record\nreduce (With s x r1) r2\n  = case sElem s (sFields r2) of STrue  -&gt; With s x (reduce r1 r2)\n                                 SFalse -&gt; reduce r1 r2\n</code></pre>\n\n<p>Again, the singletons library is really remarkable here.  I'm using my automatically generated <code>Common</code> type-level function together with the singleton-level <code>sElem</code> function (which is automatically generated within the <code>singletons</code> package from a term-level definition of the <code>elem</code> function).  Somehow, through all this complexity, GHC can figure out that if <code>sElem</code> evaluates to <code>STrue</code>, I must include <code>s</code> in the list of common fields, while if it evaluates to <code>SFalse</code>, I must not.  Try fiddling with the case results on the right-hand side of the arrows -- you can't get them to type check if you get them wrong!</p>\n\n<p>Anyway, I can apply this function to my two example records.  Again, the type signature is not needed but is given to show what's being produced:</p>\n\n<pre><code>rec3 :: Record '[ '(\"foo\", Int)]\nrec3 = reduce rec1 rec2\n</code></pre>\n\n<p>Like any other record, I have runtime access to its field names and compile-time type-checking of field access:</p>\n\n<pre><code>-- fields rec3           gives  [\"foo\"], the common field names\n-- field_ @\"foo\" rec3    gives  10, the field value for rec1\n</code></pre>\n\n<p>Note that, in general, <code>reduce r1 r2</code> and <code>reduce r2 r1</code> will return not just different values, but different <em>types</em> if the order and/or types of the commonly names fields differ between <code>r1</code> and <code>r2</code>.  Changing this behavior would probably require revisiting those early and far-reaching design decisions I mentioned earlier.</p>\n\n<p>For convenience, here's the entire program, tested using Stack lts-10.5 (with singletons 2.3.1):</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes       #-}\n{-# LANGUAGE GADTs                     #-}\n{-# LANGUAGE KindSignatures            #-}\n{-# LANGUAGE ScopedTypeVariables       #-}\n{-# LANGUAGE TemplateHaskell           #-}\n{-# LANGUAGE TypeApplications          #-}\n{-# LANGUAGE TypeFamilies              #-}\n{-# LANGUAGE TypeInType                #-}\n{-# LANGUAGE TypeOperators             #-}\n{-# LANGUAGE UndecidableInstances      #-}\n{-# OPTIONS_GHC -Wincomplete-patterns  #-}\n\nmodule Records where\n\nimport Data.Singletons.Prelude\nimport Data.Singletons.TH\nimport Data.Singletons.TypeLits\nimport Data.Function ((&amp;))\nimport Data.Kind (Type)\nimport Data.List (intersect)\nimport qualified Data.Text as Text\n\ndata Record :: [(Symbol, Type)] -&gt; Type where\n  Record :: Record '[]\n  With :: SSymbol s -&gt; t -&gt; Record fs -&gt; Record ('(s, t) : fs)\n\nwith_ :: forall s t fs . (SingI s) =&gt; t -&gt; Record fs -&gt; Record ('(s, t) : fs)\nwith_ = With sing\n\nrec1 :: Record '[ '(\"bar\", [Char]), '(\"foo\", Int)]\nrec1 = Record &amp; with_ @\"foo\" (10 :: Int)\n              &amp; with_ @\"bar\" \"Hello, world\"\n-- i.e., rec1 = { foo = 10, bar = \"Hello, world\" } :: { foo :: Int, bar :: String }\n\nrec2 :: Record '[ '(\"quux\", Maybe Double), '(\"foo\", Int)]\nrec2 = Record &amp; with_ @\"foo\" (20 :: Int)\n              &amp; with_ @\"quux\" (Just 1.0 :: Maybe Double)\n-- i.e., rec2 = { foo = 20, quux = Just 1.0 } :: { foo :: Int, quux :: Maybe Double }\n\nfield :: forall s t fs . (Lookup s fs ~ Just t) =&gt; SSymbol s -&gt; Record fs -&gt; t\nfield s (With s' t r)\n  = case s %:== s' of\n      STrue -&gt; t\n      SFalse -&gt; field s r\n\nfield_ :: forall s t fs . (Lookup s fs ~ Just t, SingI s) =&gt; Record fs -&gt; t\nfield_ = field @s sing\n\nexField = field_ @\"foo\" rec1\n-- badField = field_ @\"baz\" rec1  -- gives: Couldn't match type Nothing with Just t\n\nlookup'                  :: (Eq a) =&gt; a -&gt; [(a,b)] -&gt; Maybe b\nlookup' _key []          =  Nothing\nlookup'  key ((x,y):xys) = if key == x then Just y else lookup' key xys\n\n$(singletons [d|\n  names :: [(Symbol, Type)] -&gt; [Symbol]\n  names = map fst\n  |])\n\ndata SomeUIType fs = SomeUIType -- a UI for the given compile-time list of fields\nrecordUI :: Record fs -&gt; SomeUIType (Names fs)\nrecordUI _ = SomeUIType\n\nsFields :: Record fs -&gt; Sing (Names fs)\nsFields Record = SNil\nsFields (With s _ r) = SCons s (sFields r)\n\nfields :: Record fs -&gt; [Text.Text]\nfields = fromSing . sFields\n\nrec12common = intersect (fields rec1) (fields rec2)\n-- value:  [\"foo\"]\n\n$(singletons [d|\n  common :: [(Symbol,Type)] -&gt; [(Symbol,Type)] -&gt; [(Symbol,Type)]\n  common [] _ = []\n  common (x@(a,b):xs) ys\n    = if elem a (map fst ys)\n      then x:common xs ys\n      else   common xs ys\n  |])\n\nreduce :: Record fs1 -&gt; Record fs2 -&gt; Record (Common fs1 fs2)\nreduce Record _ = Record\nreduce (With s x r1) r2\n  = case sElem s (sFields r2) of STrue  -&gt; With s x (reduce r1 r2)\n                                 SFalse -&gt; reduce r1 r2\n\nrec3 :: Record '[ '(\"foo\", Int)]\nrec3 = reduce rec1 rec2\n-- fields rec3           gives  [\"foo\"], the common field names\n-- field_ @\"foo\" rec3    gives  10, the field value for rec1\n</code></pre>\n"}], "owner": {"reputation": 14770, "user_id": 1693859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MdkLS.jpg?s=128&g=1", "display_name": "Sam R.", "link": "https://stackoverflow.com/users/1693859/sam-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 917, "favorite_count": 1, "accepted_answer_id": 48997507, "answer_count": 4, "score": 3, "last_activity_date": 1520309023, "creation_date": 1519670158, "last_edit_date": 1519681342, "question_id": 48994927, "link": "https://stackoverflow.com/questions/48994927/infer-a-type-for-common-fields-in-two-records", "title": "infer a type for common fields in two records", "body": "<p>Bear with me if this is a foolish question. How can I <strong>type</strong> a generic function that takes two records and returns an array of their common fields?</p>\n\n<p>Let's say I have:</p>\n\n<pre><code>type A = { name :: String, color :: String }\ntype B = { name :: String, address :: Address, color :: String }\n\nmyImaginaryFunction :: ???\n-- should return [\"name\", \"color\"] :: Array of [name color]\n</code></pre>\n\n<p>I want to write a function that takes <strong>ANY</strong> two types of records and return an array of common fields. A haskell solution would work as well.</p>\n"}, {"tags": ["haskell", "permutation", "multiway-tree"], "comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 3, "creation_date": 1519669835, "post_id": 48994732, "comment_id": 84995041, "body": "Any particular reason why Root is distinct from Fork? Usually you just would have Fork and Leaf, because Root is only the root out of convention here."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1519701938, "post_id": 48994732, "comment_id": 85006334, "body": "@HTNW It makes some sense for the OP&#39;s use case -- in their example, for instance, there should be three &quot;top&quot; nodes at the same level. In any case, the type can definitely be simplified -- with some adjustments, <code>Data.Tree</code> from <i>containers</i> would do the trick."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1519703388, "post_id": 48994732, "comment_id": 85006713, "body": "(@homior Explaining a bit better: it is possible to leave out both the <code>Leaf</code> constructor (use <code>Fork</code>s with an empty list of trees instead) and the <code>Root</code> one (make the result of <code>permute</code> a list of trees instead). Your <code>Tree</code> would then become equivalent to the one from <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Tree.html\" rel=\"nofollow noreferrer\"><code>Data.Tree</code></a>.)"}], "answers": [{"tags": [], "owner": {"reputation": 96, "user_id": 1148753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517d8d64a8a5a6fd57d0c781a3058cb3?s=128&d=identicon&r=PG", "display_name": "DTown", "link": "https://stackoverflow.com/users/1148753/dtown"}, "is_accepted": true, "score": 4, "last_activity_date": 1519761072, "last_edit_date": 1519761072, "creation_date": 1519670845, "answer_id": 48995087, "question_id": 48994732, "link": "https://stackoverflow.com/questions/48994732/flatten-a-tree-with-a-list-of-subtrees-in-haskell/48995087#48995087", "title": "flatten a tree with a list of subtrees in Haskell", "body": "<p>My approach here comes out to a depth first search.</p>\n\n<pre><code>data Tree a =  Leaf a          \n            | Fork a [Tree a]       \n            | Root [Tree a]         \n            deriving(Show)\n\ndfs :: Tree a -&gt; [[a]]\ndfs (Root ts) = concatMap dfs ts\ndfs (Fork v ts) = map (v:) (concatMap dfs ts) \ndfs (Leaf v) = [[v]]\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 7731733, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4326673ebb8b37ec113a5b7d17afce92?s=128&d=identicon&r=PG&f=1", "display_name": "homior", "link": "https://stackoverflow.com/users/7731733/homior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 1, "accepted_answer_id": 48995087, "answer_count": 1, "score": 1, "last_activity_date": 1519761072, "creation_date": 1519669320, "last_edit_date": 1519703440, "question_id": 48994732, "link": "https://stackoverflow.com/questions/48994732/flatten-a-tree-with-a-list-of-subtrees-in-haskell", "title": "flatten a tree with a list of subtrees in Haskell", "body": "<p>I would like to flatten a tree which looks like this:</p>\n\n<pre><code>&gt; data Tree a =  Leaf a\n&gt;              | Fork a [Tree a]\n&gt;              | Root [Tree a]\n</code></pre>\n\n<p>possible example:</p>\n\n<pre><code>Root [Fork 'a' [Fork 'b' [Leaf 'c'],Fork 'c' [Leaf 'b']],Fork 'b' [Fork 'a' [Leaf 'c'],Fork 'c' [Leaf 'a']],Fork 'c' [Fork 'a' [Leaf 'b'],Fork 'b' [Leaf 'a']]]\n</code></pre>\n\n<p>should become</p>\n\n<pre><code>[\"abc\",\"acb\",\"bac\",\"bca\",\"cab\",\"cba\"]\n</code></pre>\n\n<p>To explain why:\nI try to build kind of a permutation Tree. I wrote a function <code>permute :: String -&gt; Tree Char</code> to visualize all possible permutations of an string into a Tree. But I dont get how to flatten this kind of tree.\nThank you for help.</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 931, "user_id": 5847190, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4d8ba109d8b110aef7d0a9c337de3c0?s=128&d=identicon&r=PG&f=1", "display_name": "DylanSp", "link": "https://stackoverflow.com/users/5847190/dylansp"}, "edited": false, "score": 0, "creation_date": 1519670478, "post_id": 48994813, "comment_id": 84995384, "body": "That did the trick! Thanks. Why does this work, is the lexing for identifiers and operators different?"}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 931, "user_id": 5847190, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4d8ba109d8b110aef7d0a9c337de3c0?s=128&d=identicon&r=PG&f=1", "display_name": "DylanSp", "link": "https://stackoverflow.com/users/5847190/dylansp"}, "edited": false, "score": 0, "creation_date": 1519677563, "post_id": 48994813, "comment_id": 84998717, "body": "I&#39;ve made an update to the answer that should provide further clarity."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 2, "last_activity_date": 1519677544, "last_edit_date": 1519677544, "creation_date": 1519669710, "answer_id": 48994813, "question_id": 48994186, "link": "https://stackoverflow.com/questions/48994186/trouble-parsing-letters-adjacent-to-operators-with-parsec/48994813#48994813", "title": "Trouble parsing letters adjacent to operators with Parsec", "body": "<p><code>Tok.reserved</code> is for identifiers. You should be using <a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Token.html#v:reservedOp\" rel=\"nofollow noreferrer\"><code>Tok.reservedOp</code></a> when parsing operators. Consider changing the calls to <code>reserved</code> to call a similar function:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>reservedOp :: String -&gt; Parser ()\nreservedOp = Tok.reservedOp lexer\n</code></pre>\n\n<p><strong>Edit</strong></p>\n\n<p>To clarify what is happening under the hood, here is the implementation of <code>Tok.reserved</code>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>reserved name =\n    lexeme $ try $\n    do{ _ &lt;- caseString name\n      ; notFollowedBy (identLetter languageDef) &lt;?&gt; (\"end of \" ++ show name)\n      }\n</code></pre>\n\n<p>Notice that <code>reserved</code> blindly accepts <code>name</code> without validating whether it is a valid operator or identifier, but that it stops if there are further valid identifier characters (otherwise <code>reserved \"foo\"</code> would yield incorrect results on a value of <code>fooBar</code>).</p>\n\n<p>Since you specified that identifiers are any valid letters, <code>Tok.reserved</code> would halt when further letters were found, which is why <code>\"*a\"</code> failed.</p>\n\n<p><code>Tok.reservedOp</code> includes a similar restriction which short-circuits parsing when adjacent operator characters (from <code>opLetter</code>) are present. (e.g. otherwise you could mistake <code>**</code> (a common exponent expression) for <code>*</code>)</p>\n"}], "owner": {"reputation": 931, "user_id": 5847190, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f4d8ba109d8b110aef7d0a9c337de3c0?s=128&d=identicon&r=PG&f=1", "display_name": "DylanSp", "link": "https://stackoverflow.com/users/5847190/dylansp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 48994813, "answer_count": 1, "score": 1, "last_activity_date": 1519677544, "creation_date": 1519667154, "question_id": 48994186, "link": "https://stackoverflow.com/questions/48994186/trouble-parsing-letters-adjacent-to-operators-with-parsec", "title": "Trouble parsing letters adjacent to operators with Parsec", "body": "<p>I'm trying to parse a simplified expression language with Parsec in Haskell to solve the <a href=\"http://www.codewars.com/kata/tiny-three-pass-compiler/train/haskell\" rel=\"nofollow noreferrer\">Tiny Three-Pass Compiler kata</a> on CodeWars. I'm running into issues where my parser won't parse correctly if there's no whitespace between an identifier and an operator; <code>a * a</code> parses to the complete expression, but <code>a*a</code> only yields the first <code>a</code>. </p>\n\n<p>Stack script to demonstrate the problem:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-10.7 script\n\nimport Text.Parsec\nimport Text.Parsec.String (Parser)\nimport qualified Text.Parsec.Token as Tok\n\nlangDef :: Tok.LanguageDef ()\nlangDef = Tok.LanguageDef\n  { Tok.commentStart    = \"\"\n  , Tok.commentEnd      = \"\"\n  , Tok.commentLine     = \"\"\n  , Tok.nestedComments  = False\n  , Tok.identStart      = letter\n  , Tok.identLetter     = letter\n  , Tok.opStart         = oneOf \"+-*/\"\n  , Tok.opLetter        = oneOf \"+-*/\"\n  , Tok.reservedNames   = []\n  , Tok.reservedOpNames = []\n  , Tok.caseSensitive   = True\n  }\n\nlexer :: Tok.TokenParser ()\nlexer = Tok.makeTokenParser langDef\n\nidentifier :: Parser String\nidentifier = Tok.identifier lexer\n\nreserved :: String -&gt; Parser ()\nreserved = Tok.reserved lexer\n\ndata AST = Var String\n         | Add AST AST\n         | Sub AST AST\n         | Mul AST AST\n         | Div AST AST\n         deriving (Eq, Show)\n\nexpression :: Parser AST\nexpression = term `chainl1` addSubOp\n\naddSubOp :: Parser (AST -&gt; AST -&gt; AST)\naddSubOp =  (reserved \"+\" &gt;&gt; return Add)\n        &lt;|&gt; (reserved \"-\" &gt;&gt; return Sub)\n\nterm :: Parser AST\nterm = factor `chainl1` multDivOp\n\nmultDivOp :: Parser (AST -&gt; AST -&gt; AST)\nmultDivOp =  (reserved \"*\" &gt;&gt; return Mul)\n         &lt;|&gt; (reserved \"/\" &gt;&gt; return Div)\n\nfactor :: Parser AST\nfactor = variable\n\nvariable :: Parser AST\nvariable = do\n  varName &lt;- identifier\n  return $ Var varName\n\nmain = do\n  putStrLn $ show $ parse expression \"\" \"a + a\"\n  putStrLn $ show $ parse expression \"\" \"a+a\"\n  putStrLn $ show $ parse expression \"\" \"a - a\"\n  putStrLn $ show $ parse expression \"\" \"a-a\"\n  putStrLn $ show $ parse expression \"\" \"a * a\"\n  putStrLn $ show $ parse expression \"\" \"a*a\"\n  putStrLn $ show $ parse expression \"\" \"a / a\"\n  putStrLn $ show $ parse expression \"\" \"a/a\"\n</code></pre>\n\n<p>Running this outputs:</p>\n\n<pre><code>$ ./AdjacentParseIssue.hs \nRight (Add (Var \"a\") (Var \"a\"))\nRight (Var \"a\")\nRight (Sub (Var \"a\") (Var \"a\"))\nRight (Var \"a\")\nRight (Mul (Var \"a\") (Var \"a\"))\nRight (Var \"a\")\nRight (Div (Var \"a\") (Var \"a\"))\nRight (Var \"a\")\n</code></pre>\n\n<p>How can I write my parser so that both <code>a * a</code> and <code>a*a</code> parse to the same result?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1519700770, "post_id": 48992971, "comment_id": 85006077, "body": "It seems you forgot to add your code to the question, so you&#39;ll want to <a href=\"https://stackoverflow.com/posts/48992971/edit\">edit</a> in the relevant parts of Venditta.hs. Going by just what I can see from the error message, you might be missing a <code>defaultLayout</code> call in line 20. Cf. <a href=\"https://www.yesodweb.com/book/scaffolding-and-the-site-template#scaffolding-and-the-site-template_widgetfile\" rel=\"nofollow noreferrer\">this passage of the Yesod book</a>. (Note that I don&#39;t know much about Yesod myself, so I might be missing something too!)"}, {"owner": {"reputation": 73, "user_id": 9414418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p7jD4FCoE7c/AAAAAAAAAAI/AAAAAAAACkk/KPBQusRwRPk/photo.jpg?sz=128", "display_name": "Giulio De Stasio", "link": "https://stackoverflow.com/users/9414418/giulio-de-stasio"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519925316, "post_id": 48992971, "comment_id": 85115387, "body": "Yeah, I resolved the problem so actually it&#39;s works"}], "owner": {"reputation": 73, "user_id": 9414418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p7jD4FCoE7c/AAAAAAAAAAI/AAAAAAAACkk/KPBQusRwRPk/photo.jpg?sz=128", "display_name": "Giulio De Stasio", "link": "https://stackoverflow.com/users/9414418/giulio-de-stasio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1519662857, "creation_date": 1519662857, "question_id": 48992971, "link": "https://stackoverflow.com/questions/48992971/yesod-couldnt-match-type-widgett-site0-m0-with-handlert-app-io", "title": "Yesod - Couldn&#39;t match type `WidgetT site0 m0&#39; with `HandlerT App IO&#39;", "body": "<p>I Scaffolded my site in Stack and actually i'm trying to add more pages (another issue for another day), so today i opened the code and:</p>\n\n<pre><code>[13 of 14] Compiling Handler.Vendita  ( src/Handler/Vendita.hs, .stack-work/dist/x86_64-freebsd/Cabal-2.0.1.0/build/Handler/Vendita.o )\n\n/usr/home/giulio/Lavori/karmen/src/Handler/Vendita.hs:20:4: error:\n    * Couldn't match type `WidgetT site0 m0' with `HandlerT App IO'\n      Expected type: HandlerT App IO Html\n        Actual type: WidgetT site0 m0 ()\n    * In a stmt of a 'do' block:\n        (asWidgetT GHC.Base.. toWidget)\n          ((blaze-markup-0.8.2.0:Text.Blaze.Internal.preEscapedText\n              GHC.Base.. Data.Text.pack)\n             \"&lt;main&gt;&lt;h1&gt;Canonical&lt;/h1&gt;\n&lt;/main&gt;\n\")\n      In a stmt of a 'do' block:\n        (do (asWidgetT GHC.Base.. toWidget)\n              ((blaze-markup-0.8.2.0:Text.Blaze.Internal.preEscapedText\n                  GHC.Base.. Data.Text.pack)\n                 \"&lt;main&gt;&lt;h1&gt;Canonical&lt;/h1&gt;\n&lt;/main&gt;\n\"))\n      In the expression:\n        do setTitle \"Vendita\"\n           (do (asWidgetT GHC.Base.. toWidget)\n                 ((blaze-markup-0.8.2.0:Text.Blaze.Internal.preEscapedText\n                     GHC.Base.. Data.Text.pack)\n                    \"&lt;main&gt;&lt;h1&gt;Canonical&lt;/h1&gt;\n &lt;/main&gt;\n \"))\n   |\n20 |  $(widgetFile \"vendita\")\n   |    ^^^^^^^^^^^^^^^^^^^^\n\n--  While building custom Setup.hs for package karmen-0.0.0 using:\n      /usr/home/giulio/.stack/setup-exe-cache/x86_64-freebsd/Cabal-simple_mPHDZzAJ_2.0.1.0_ghc-8.2.2 --builddir=.stack-work/dist/x86_64-freebsd/Cabal-2.0.1.0 build lib:karmen --ghc-options \" -ddump-hi -ddump-to-file\"\n</code></pre>\n\n<p>The code work properly removing all the page, and changing the widget file from this to the homepage widget not resolve the problem.\nAlso copying the getHomeR code cause an error.\nI also tried to add and remove isAuthenticated part to cause differents bugs.</p>\n"}, {"tags": ["haskell", "pattern-matching", "semantics", "language-implementation"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1519680106, "post_id": 48992573, "comment_id": 84999964, "body": "In case you haven&#39;t seen it, you might like prolog"}, {"owner": {"reputation": 108, "user_id": 6476589, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-OHBMKOvbfng/AAAAAAAAAAI/AAAAAAAADjw/5ye5MX8Sbzo/photo.jpg?sz=128", "display_name": "Brendan Murphy", "link": "https://stackoverflow.com/users/6476589/brendan-murphy"}, "edited": false, "score": 1, "creation_date": 1519759149, "post_id": 48992573, "comment_id": 85037582, "body": "Curry is a neat little language where this kind of thing is possible. It&#39;s a relational programming language, which means its basic components are relations like <code>xs == ys ++ [y]</code> instead of functions like <code>case xs of y:ys -&gt; undefined; [] -&gt; undefined</code>"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1519680199, "post_id": 48992646, "comment_id": 85000023, "body": "There are <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ViewPatterns\" rel=\"nofollow noreferrer\"><code>ViewPatterns</code></a> and <a href=\"https://ghc.haskell.org/trac/ghc/wiki/PatternSynonyms\" rel=\"nofollow noreferrer\"><code>PatternSynonyms</code></a>"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1519683706, "post_id": 48992646, "comment_id": 85001577, "body": "@luqui Thanks. Not sure which I was thinking of. It&#39;s been awhile since I&#39;ve written Haskell. I&#39;ll edit those links in in a bit."}], "tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": false, "score": 6, "last_activity_date": 1519684377, "last_edit_date": 1519684377, "creation_date": 1519661763, "answer_id": 48992646, "question_id": 48992573, "link": "https://stackoverflow.com/questions/48992573/haskell-why-is-not-allowed-in-pattern-matching/48992646#48992646", "title": "Haskell: Why ++ is not allowed in pattern matching?", "body": "<p><code>++</code> isn't a constructor, it's just a plain function. You can only match on constructors.</p>\n\n<p>You can use <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ViewPatterns\" rel=\"nofollow noreferrer\"><code>ViewPatterns</code></a> or <a href=\"https://ghc.haskell.org/trac/ghc/wiki/PatternSynonyms\" rel=\"nofollow noreferrer\"><code>PatternSynonyms</code></a> to augment your ability to pattern match (thanks @luqui). </p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 9, "last_activity_date": 1519661778, "creation_date": 1519661778, "answer_id": 48992654, "question_id": 48992573, "link": "https://stackoverflow.com/questions/48992573/haskell-why-is-not-allowed-in-pattern-matching/48992654#48992654", "title": "Haskell: Why ++ is not allowed in pattern matching?", "body": "<p>You can only pattern-match on data constructors, and <code>++</code> is a function, not a data constructor.</p>\n\n<p>Data constructors are persistent; a value like <code>'c':[]</code> cannot be simplified further, because it <em>is</em> a fundamental value of type <code>[Char]</code>. An expression like <code>\"c\" ++ \"d\"</code>, however, can replaced with its equivalent <code>\"cd\"</code> at any time, and thus couldn't reliably be counted on to be present for pattern matching.</p>\n\n<p>(You might argue that <code>\"cd\"</code> could always replaced by <code>\"c\" ++ \"d\"</code>, but in general there isn't a one-to-one mapping between a list and a decomposition via <code>++</code>. Is <code>\"cde\"</code> equivalent to <code>\"c\" ++ \"de\"</code> or <code>\"cd\" ++ \"e\"</code> for pattern matching purposes?)</p>\n"}, {"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1519662574, "post_id": 48992754, "comment_id": 84990835, "body": "Op&#39;s pattern <code>(xs++[x])</code> is unambiguous though (at least I understand intuitively what it means), it&#39;s also the same idea as &quot;N Plus K patterns&quot; (and of course <code>+</code> is not injective)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1519662814, "post_id": 48992754, "comment_id": 84990989, "body": "Yeah, it&#39;s the same idea as N Plus K Patterns, which have been purged from the language due to problems which largely come down to non-injectivity. Special cases like <code>sum&#39; (xs++[x]) = x + sum&#39; xs</code> or <code>fact (x+1) = (x+1) * fact x</code> can be made to work, but it just doesn&#39;t generalise properly."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1519669046, "post_id": 48992754, "comment_id": 84994656, "body": "Right, but I&#39;d be really interested in understanding precisely what distinguishes a pattern like op&#39;s which is in fact injective, from one that&#39;s ambiguous/invalid. I think we can use induction to prove it on a case-by-case basis but I don&#39;t really know how to reason about the question in general"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 15, "last_activity_date": 1519662654, "last_edit_date": 1519662654, "creation_date": 1519662077, "answer_id": 48992754, "question_id": 48992573, "link": "https://stackoverflow.com/questions/48992573/haskell-why-is-not-allowed-in-pattern-matching/48992754#48992754", "title": "Haskell: Why ++ is not allowed in pattern matching?", "body": "<p>You can only pattern match on <em>constructors</em>, not on general functions.</p>\n\n<p>Mathematically, a constructor is an <a href=\"https://en.wikipedia.org/wiki/Injective_function\" rel=\"noreferrer\">injective</a> function: each combination of arguments gives one unique value, in this case a list. Because that value is unique, the language can <em>deconstruct it</em> again into the original arguments. I.e., when you pattern match on <code>:</code>, you essentially use the function</p>\n\n<pre><code>uncons :: [a] -&gt; Maybe (a, [a])\n</code></pre>\n\n<p>which checks if the list is of a form you could have constructed with <code>:</code> (i.e., if it is non-empty), and if yes, gives you back the head and tail.</p>\n\n<p><code>++</code> is not injective though, for example</p>\n\n<pre><code>Prelude&gt; [0,1] ++ [2]\n[0,1,2]\nPrelude&gt; [0] ++ [1,2]\n[0,1,2]\n</code></pre>\n\n<p>Neither of these representations is <em>the right one</em>, so how should the list be deconstructed again?</p>\n\n<p>What you can do however is define a new, \u201cvirtual\u201d constructor that acts like <code>:</code> in that it always seperates exactly one element from the rest of the list (if possible), but does so on the right:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms, ViewPatterns #-}\n\npattern (:&gt;) :: [a] -&gt; a -&gt; [a]\npattern (xs:&gt;\u03c9) &lt;- (unsnoc -&gt; Just (xs,\u03c9))\n where xs:&gt;\u03c9 = xs ++ [\u03c9]\n\nunsnoc :: [a] -&gt; Maybe ([a], a)\nunsnoc [] = Nothing\nunsnoc [x] = Just x\nunsnoc (_:xs) = unsnoc xs\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>sum' :: Num a =&gt; [a] -&gt; a\nsum' (xs:&gt;x) = x + sum xs\nsum' [] = 0\n</code></pre>\n\n<p>Note that this is very inefficient though, because the <code>:&gt;</code> pattern-synonym actually needs to dig through the entire list, so <code>sum'</code> has quadratic rather than linear complexity.</p>\n\n<p>A container that allows pattern matching on both the left and right end <em>efficiently</em> is <a href=\"http://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Sequence.html\" rel=\"noreferrer\"><code>Data.Sequence</code></a>, with its <code>:&lt;|</code> and <code>:|&gt;</code> pattern synonyms.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1520240375, "post_id": 49014122, "comment_id": 85218251, "body": "how about <code>lookup k [..., (k,v), ...] = Just v</code>? We could also have <code>[x, ...]</code>, <code>[x, ...xs...]</code>, <code>[_, ...xs...]</code>, etc. And as a constructor too, like, <code>sieve [p, ...xs...] = [x, ...sieve [x | x &lt;- xs, rem x p &gt; 0]...]</code>. Or <code>(++) a b = [...a..., ...b...]</code>. One advantage is, a reader doesn&#39;t have to guess the meaning of <code>:</code>, <code>::</code> (ML), <code>++</code>, etc. -  the intention is visually apparent. Hopefully. BTW I&#39;ve recently stumbled on <a href=\"https://en.wikipedia.org/wiki/Refal\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Refal</a> which seems related (a pattern-matching term-rewriting language from 1960s USSR)."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1520243709, "post_id": 49014122, "comment_id": 85220068, "body": "The thing I did in the late 80s did, in fact, steal its notation from SNOBOL: it was a pattern matching square-brackety LISP, but variables starting with $ stood for list segments, so <code>[$_ (k.v) $_]</code>. But as I said, above, it&#39;s not just about lists, so I think we need to look beyond. List-centric notation can lead to list-centric thinking."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1520254449, "post_id": 49014122, "comment_id": 85226932, "body": "as a curiosity, this notation (plus some list comprehensions) allows for a <a href=\"https://stackoverflow.com/a/34910496/849891\">very succinct - 13 LOC - reformulation</a> if the McCarthy&#39;s original paper&#39;s <code>eval</code> with all auxiliaries."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 19, "last_activity_date": 1519752421, "last_edit_date": 1519752421, "creation_date": 1519750993, "answer_id": 49014122, "question_id": 48992573, "link": "https://stackoverflow.com/questions/48992573/haskell-why-is-not-allowed-in-pattern-matching/49014122#49014122", "title": "Haskell: Why ++ is not allowed in pattern matching?", "body": "<p>This is a deserving question, and it has so far received sensible answers (mutter only constructors allowed, mutter injectivity, mutter ambiguity), but there's still time to change all that.</p>\n\n<p>We can say what the rules are, but most of the explanations for why the rules are what they are start by over-generalising the question, addressing why we can't pattern match against any old function (mutter Prolog). This is to ignore the fact that <code>++</code> isn't any old function: it's a (spatially) <em>linear</em> plugging-stuff-together function, induced by the zipper-structure of lists. Pattern matching is about taking stuff apart, and indeed, notating the process in terms of the plugger-togetherers and pattern variables standing for the components. Its motivation is clarity. So I'd like</p>\n\n<pre><code>lookup :: Eq k =&gt; k -&gt; [(k, v)] -&gt; Maybe v\nlookup k (_ ++ [(k, v)] ++ _) = Just v\nlookup _ _                    = Nothing\n</code></pre>\n\n<p>and not only because it would remind me of the fun I had thirty years ago when I implemented a functional language whose pattern matching offered exactly that.</p>\n\n<p>The objection that it's ambiguous is a legitimate one, but not a dealbreaker. Plugger-togetherers like <code>++</code> offer only finitely many decompositions of finite input (and if you're working on infinite data, that's your own lookout), so what's involved is at worst <em>search</em>, rather than <em>magic</em> (inventing arbitrary inputs that arbitrary functions might have thrown away). Search calls for some means of prioritisation, but so do our ordered matching rules. Search can also result in failure, but so, again, can matching.</p>\n\n<p>We have a sensible way to manage computations offering alternatives (failure and choice) via the <code>Alternative</code> abstraction, but we are not used to thinking of pattern matching as a form of such computation, which is why we exploit <code>Alternative</code> structure only in the <em>expression</em> language. The noble, if quixotic, exception is match-failure in <code>do</code>-notation, which calls the relevant <code>fail</code> rather than necessarily crashing out. Pattern matching is an attempt to compute an environment suitable for the evaluation of a 'right-hand side' expression; failure to compute such an environment is already handled, so why not choice?</p>\n\n<p>(<strong>Edit:</strong> I should, of course, add that you only really need search if you have more than one stretchy thing in a pattern, so the proposed <code>xs++[x]</code> pattern shouldn't trigger any choices. Of course, it takes time to find the end of a list.)</p>\n\n<p>Imagine there was some sort of funny bracket for writing <code>Alternative</code> computations, e.g., with <code>(|)</code> meaning <code>empty</code>, <code>(|a1|a2|)</code> meaning <code>(|a1|) &lt;|&gt; (|a2|)</code>, and a regular old <code>(|f s1 .. sn|)</code> meaning <code>pure f &lt;*&gt; s1 .. &lt;*&gt; sn</code>. One might very well also imagine <code>(|case a of {p1 -&gt; a1; .. pn-&gt;an}|)</code> performing a sensible translation of search-patterns (e.g. involving <code>++</code>) in terms of <code>Alternative</code> combinators. We could write</p>\n\n<pre><code>lookup :: (Eq k, Alternative a) =&gt; k -&gt; [(k, v)] -&gt; a k\nlookup k xs = (|case xs of _ ++ [(k, v)] ++ _ -&gt; pure v|)\n</code></pre>\n\n<p>We may obtain a reasonable language of search-patterns for any datatype generated by fixpoints of differentiable functors: symbolic differentiation is exactly what turns tuples of structures into choices of possible substructures. Good old <code>++</code> is just the sublists-of-lists example (which is confusing, because a list-with-a-hole-for-a-sublist looks a lot like a list, but the same is not true for other datatypes).</p>\n\n<p>Hilariously, with a spot of <code>LinearTypes</code>, we might even keep hold of holey data by their holes as well as their root, then plug away destructively in constant time. It's scandalous behaviour only if you don't notice you're doing it.</p>\n"}], "owner": {"reputation": 2500, "user_id": 3142049, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e397754f01a0c386cf59f64d86565d31?s=128&d=identicon&r=PG&f=1", "display_name": "Abhisek", "link": "https://stackoverflow.com/users/3142049/abhisek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1403, "favorite_count": 1, "accepted_answer_id": 48992754, "answer_count": 4, "score": 10, "last_activity_date": 1520239530, "creation_date": 1519661531, "last_edit_date": 1520239530, "question_id": 48992573, "link": "https://stackoverflow.com/questions/48992573/haskell-why-is-not-allowed-in-pattern-matching", "title": "Haskell: Why ++ is not allowed in pattern matching?", "body": "<p>Suppose we want to write our own <code>sum</code> function in Haskell:</p>\n\n<pre><code>sum' :: (Num a) =&gt; [a] -&gt; a\nsum' [] = 0\nsum' (x:xs) = x + sum' xs\n</code></pre>\n\n<p>Why can't we do something like:</p>\n\n<pre><code>sum' :: (Num a) =&gt; [a] -&gt; a\nsum' [] = 0\nsum' (xs++[x]) = x + sum' xs\n</code></pre>\n\n<p>In other words why can't we use <code>++</code> in pattern matching ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 3, "creation_date": 1519653640, "post_id": 48990254, "comment_id": 84985037, "body": "In Haskell, whitespace matters. Look at <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation#The_golden_rule_of_indentation\" rel=\"nofollow noreferrer\">indentation</a>."}], "answers": [{"comments": [{"owner": {"reputation": 311, "user_id": 8296096, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Bk-j61llm3Q/AAAAAAAAAAI/AAAAAAAAADY/BEKd97nLQOw/photo.jpg?sz=128", "display_name": "Sushodhan", "link": "https://stackoverflow.com/users/8296096/sushodhan"}, "edited": false, "score": 0, "creation_date": 1519654637, "post_id": 48990316, "comment_id": 84985700, "body": "Thank you very much for the answer, now its working fine. Can you explain me why here we need to write &#39;y+1&#39; instead of &#39;x+1&#39; even if the base value is in x and we are adding 1 to the base value ?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 311, "user_id": 8296096, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Bk-j61llm3Q/AAAAAAAAAAI/AAAAAAAAADY/BEKd97nLQOw/photo.jpg?sz=128", "display_name": "Sushodhan", "link": "https://stackoverflow.com/users/8296096/sushodhan"}, "edited": false, "score": 0, "creation_date": 1519656600, "post_id": 48990316, "comment_id": 84987043, "body": "@SushodhanVaishampayan <code>x</code> is the list element at hand, <code>y</code> is the length of the tail. So we want <code>y+1</code>. (Note that in <code>foldl</code>, instead, we would find the arguments in the other order -- but here we are using <code>foldr</code>)"}], "tags": [], "owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "is_accepted": false, "score": 5, "last_activity_date": 1519654135, "last_edit_date": 1519654135, "creation_date": 1519653746, "answer_id": 48990316, "question_id": 48990254, "link": "https://stackoverflow.com/questions/48990254/length-of-list-using-foldr-in-haskell/48990316#48990316", "title": "length of list using foldr in haskell", "body": "<p>In Haskell, whitespace matters - look at the <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation#The_golden_rule_of_indentation\" rel=\"nofollow noreferrer\">guide on the Haskell wiki</a>.</p>\n\n<p>Formatting your code more correctly gives:</p>\n\n<pre><code>mylength :: [Int] -&gt; Int\nmylength l = foldr f 0 l\n  where\n    f :: Int -&gt; Int -&gt; Int\n    f x y = y + 1\n</code></pre>\n\n<p>Which <a href=\"https://ideone.com/CZVd6R\" rel=\"nofollow noreferrer\">works perfectly</a> (although the argument <code>x</code> to <code>f</code> is a bit redundant, you might want to write it as <code>f _ y = y + 1</code> instead, or use a lambda expression like <code>foldr (\\_ x -&gt; x + 1) 0 l</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 311, "user_id": 8296096, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Bk-j61llm3Q/AAAAAAAAAAI/AAAAAAAAADY/BEKd97nLQOw/photo.jpg?sz=128", "display_name": "Sushodhan", "link": "https://stackoverflow.com/users/8296096/sushodhan"}, "edited": false, "score": 0, "creation_date": 1519654648, "post_id": 48990424, "comment_id": 84985706, "body": "Thank you very much for the answer, now its working fine. Can you explain me why here we need to write &#39;y+1&#39; instead of &#39;x+1&#39; even if the base value is in x and we are adding 1 to the base value ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 311, "user_id": 8296096, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Bk-j61llm3Q/AAAAAAAAAAI/AAAAAAAAADY/BEKd97nLQOw/photo.jpg?sz=128", "display_name": "Sushodhan", "link": "https://stackoverflow.com/users/8296096/sushodhan"}, "edited": false, "score": 2, "creation_date": 1519654732, "post_id": 48990424, "comment_id": 84985773, "body": "@SushodhanVaishampayan: because the signature of <code>foldr</code> is <code>(a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>, so the second parameter is the <i>accumulator</i> we update."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1519654172, "creation_date": 1519654172, "answer_id": 48990424, "question_id": 48990254, "link": "https://stackoverflow.com/questions/48990254/length-of-list-using-foldr-in-haskell/48990424#48990424", "title": "length of list using foldr in haskell", "body": "<p>This is an indentation error: you have to indent the <code>where</code> clause, since otherwise Haskell will see the definition of <code>f</code> as a separate function. So we can fix it with:</p>\n\n<pre><code>mylength :: [Int] -&gt; Int\nmylength l = foldr f 0 l\n    where f :: Int -&gt; Int -&gt; Int\n          f x y = y+1\n</code></pre>\n\n<p>Nevertheless we can still make it more generic: instead of defining it for an <code>[Int]</code> list, we can define it over an <code>[a]</code> list, with:</p>\n\n<pre><code>mylength :: [a] -&gt; Int\nmylength l = foldr f 0 l\n    where f x y = y+1\n</code></pre>\n\n<p>We can also rewrite <code>f</code> as <code>const (+1)</code>, so:</p>\n\n<pre><code>mylength :: Num n =&gt; [a] -&gt; n\nmylength = foldr (const (1+)) 0\n</code></pre>\n\n<p>Note that we can apply an <em>eta-reduction</em> here: remove <code>l</code> both in the head and the body of the <code>mylength</code> definition. Or in case we know that the number is also <em>enumerable</em>, we can use <code>succ</code> instead of <code>(1+)</code>:</p>\n\n<pre><code>mylength :: (Enum n, Num n) =&gt; [a] -&gt; n\nmylength = foldr (const succ) 0\n</code></pre>\n"}], "owner": {"reputation": 311, "user_id": 8296096, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Bk-j61llm3Q/AAAAAAAAAAI/AAAAAAAAADY/BEKd97nLQOw/photo.jpg?sz=128", "display_name": "Sushodhan", "link": "https://stackoverflow.com/users/8296096/sushodhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1732, "favorite_count": 0, "accepted_answer_id": 48990424, "answer_count": 2, "score": 1, "last_activity_date": 1519654172, "creation_date": 1519653543, "last_edit_date": 1519653598, "question_id": 48990254, "link": "https://stackoverflow.com/questions/48990254/length-of-list-using-foldr-in-haskell", "title": "length of list using foldr in haskell", "body": "<p>I wrote the following code to calculate length of a list using foldr in haskell. When I compile the code it gives me error as  \"myfoldr.hs:3:1: parse error on input `where'\". Can anyone please tell me what thing I might be missing or doing wrong in this code ?</p>\n\n<pre><code>mylength :: [Int] -&gt; Int\nmylength l = foldr f 0 l\nwhere\nf :: Int -&gt; Int -&gt; Int\nf x y = y+1\n</code></pre>\n"}, {"tags": ["windows", "haskell", "cabal", "haskell-platform"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 2, "creation_date": 1519646557, "post_id": 48986052, "comment_id": 84980640, "body": "Unless you did something strange, this is a bug with the haskell platform. You should submit a bug report to them. Meanwhile, you could try using <code>stack</code> instead of cabal-install <a href=\"https://haskell-lang.org/get-started\" rel=\"nofollow noreferrer\">haskell-lang.org/get-started</a>  Stack seems to be part of the haskell platform nowadays."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519656801, "post_id": 48986052, "comment_id": 84987164, "body": "@Cubic This might not be specific to the Platform. <a href=\"https://github.com/commercialhaskell/stack/issues/1870\" rel=\"nofollow noreferrer\">Stack issue #1870</a> seems relevant."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1519656959, "post_id": 48986052, "comment_id": 84987259, "body": "@duplode Ugh, windows and unicode :("}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519659175, "post_id": 48986052, "comment_id": 84988598, "body": "@Cubic For the sake of completeness: I recently got the same error when I had to build my Hakyll sites (installing packages in general worked fine) on a pt-BR Win 10 machine. I didn&#39;t investigate further (not yet, at least) because the <code>hSetEncoding</code> workaround in the <a href=\"https://jaspervdj.be/hakyll/tutorials/faq.html#hgetcontents-invalid-argument-or-commitbuffer-invalid-argument\" rel=\"nofollow noreferrer\">Hakyll FAQ</a> was good enough for my immediate purposes."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1519736249, "post_id": 48986052, "comment_id": 85022802, "body": "@Arsenal591 Two things you might try, taken from the discussions linked to above: (1) <a href=\"https://superuser.com/a/1199477/320921\">In the Control Panel, change &quot;Current language for non-Unicode programs&quot; to &quot;English (United States)</a>; (2) <a href=\"https://stackoverflow.com/a/27622364/2751851\">Run <code>chcp.com 65001</code> in the console</a>."}, {"owner": {"reputation": 836, "user_id": 6716078, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/bb8e45f976092762bb464afbc6b91c27?s=128&d=identicon&r=PG&f=1", "display_name": "Arsenal591", "link": "https://stackoverflow.com/users/6716078/arsenal591"}, "edited": false, "score": 0, "creation_date": 1520339607, "post_id": 48986052, "comment_id": 85266372, "body": "Turns out that works! Thanks a lot."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1521139668, "post_id": 48986052, "comment_id": 85616256, "body": "@duplode can you post your comment as an answer."}, {"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1521139698, "post_id": 48986052, "comment_id": 85616272, "body": "Also, @Cubic can you not recommend people switch from the platform to stack for every issue without first investigating, much more commonly it is something else, such as this..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1521171377, "post_id": 48986052, "comment_id": 85627304, "body": "@sclv Posted. (I didn&#39;t do that at first because I hadn&#39;t tried all of the workarounds yet -- thanks for drawing my attention back to this.)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1521171865, "post_id": 48986052, "comment_id": 85627408, "body": "@Arsenal591 Good to know; you&#39;re welcome :) I have only seen your reply now, as you hadn&#39;t @-notified me."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1521171298, "creation_date": 1521171298, "answer_id": 49312767, "question_id": 48986052, "link": "https://stackoverflow.com/questions/48986052/invalid-argument-error-on-win10-when-running-cabal/49312767#49312767", "title": "&quot;invalid argument&quot; error on win10 when running cabal", "body": "<p>This very likely is an encoding issue related to the configuration of your OS. When I got the same message on trying to run a Hakyll program on Windows, I found that <a href=\"https://stackoverflow.com/a/27622364/2751851\">running <code>chcp 65001</code> in the Windows console</a>, as suggested by <a href=\"https://jaspervdj.be/hakyll/tutorials/faq.html#hgetcontents-invalid-argument-or-commitbuffer-invalid-argument\" rel=\"nofollow noreferrer\">the Hakyll FAQ</a>, worked as a workaround.</p>\n\n<p>(Adding <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/GHC-IO-Encoding.html\" rel=\"nofollow noreferrer\"><code>setLocaleEncoding utf8</code></a> to <code>main</code>, as described there, also helped in my case; that doesn't apply to your situation, though. A reply to the similar-looking <a href=\"https://github.com/commercialhaskell/stack/issues/1870\" rel=\"nofollow noreferrer\">Stack issue #1870</a> suggests <a href=\"https://superuser.com/a/1199477/320921\">changing \"Current language for non-Unicode programs\" to \"English (United States)\" in the Windows Control Panel</a>; however, doing so made no difference in my pt-BR Win 10 Home system.)</p>\n"}], "owner": {"reputation": 836, "user_id": 6716078, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/bb8e45f976092762bb464afbc6b91c27?s=128&d=identicon&r=PG&f=1", "display_name": "Arsenal591", "link": "https://stackoverflow.com/users/6716078/arsenal591"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 544, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1521171298, "creation_date": 1519640157, "question_id": 48986052, "link": "https://stackoverflow.com/questions/48986052/invalid-argument-error-on-win10-when-running-cabal", "title": "&quot;invalid argument&quot; error on win10 when running cabal", "body": "<p>I am new to Haskell recently, but I am currently facing a very annoying problem:</p>\n\n<p>I followed instructions from <a href=\"https://www.haskell.org/platform/windows.html\" rel=\"nofollow noreferrer\">here</a>, and installed Haskell platform on Windows10 with default settings. But when I tried to run</p>\n\n<pre><code>cabal install [package name]\n</code></pre>\n\n<p>to install a haskell package, I always got the error:</p>\n\n<pre><code>C:\\Users\\[My Username]\\AppData\\Local\\Temp\\ghc20156_0\\ghc_2.rsp: commitBuffer: invalid argument (invalid character)\n</code></pre>\n\n<p>Thus, I am not able to install any Haskell packages, which annoys me a lot.</p>\n\n<p>I wanted to figure out a solution to the problem, but I failed. So how can I fix this error? I hope some of you could tell me.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519640204, "post_id": 48985917, "comment_id": 84976503, "body": "is <code>bitmap</code> an option? <a href=\"https://hackage.haskell.org/package/gloss-1.11.1.1/docs/Graphics-Gloss-Data-Picture.html#v:bitmap\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/gloss-1.11.1.1/docs/&hellip;</a>"}, {"owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519644883, "post_id": 48985917, "comment_id": 84979571, "body": "What is bitmapdata though? what is this type?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519709737, "post_id": 48985917, "comment_id": 85008363, "body": "This is why <a href=\"https://hackage.haskell.org/package/gloss-juicy\" rel=\"nofollow noreferrer\">gloss-juicy</a> exists.  Slightly OT, but since you&#39;re learning you might like my <a href=\"https://github.com/TomMD/mellow\" rel=\"nofollow noreferrer\">mellow</a> library which glues gloss, friday, and kinect together."}], "owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 271, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1519639779, "creation_date": 1519639779, "question_id": 48985917, "link": "https://stackoverflow.com/questions/48985917/using-images-in-haskell-with-gloss", "title": "Using images in haskell with gloss", "body": "<p>I'm using gloss for the graphics of a game in haskell and I want to add pictures. I'm building a snake game and I'd like the apple to be an actual apple and not just a green circle (using Gloss.circleSolid). Is there a way to add pictures and not only use builtin in gloss?</p>\n"}, {"tags": ["haskell", "monads", "indentation", "operator-precedence", "backticks"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519636608, "post_id": 48984756, "comment_id": 84974450, "body": "Finally takes (like all operators) lower precendence than functions, so it is <code>finally (onException (callProcess ...) (removeFileIfExists name)) (removeFileIfExists inputFile)</code>. <code>finally</code> is thus the main function."}], "answers": [{"comments": [{"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1519650019, "post_id": 48987515, "comment_id": 84982799, "body": "If I decrement `` <code>finally</code> ``, it&#39;s now against the entire <code>do</code> block?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1519650312, "post_id": 48987515, "comment_id": 84982978, "body": "You mean, if you decrease its indentation so it starts left of <code>download</code> and of <code>onException</code>? Yes, that would make it parse as <code>(do {...}) `finally` (...)</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1519680349, "post_id": 48987515, "comment_id": 85000105, "body": "This doesn&#39;t really address the question, which was about how an operator interacts with the <code>do</code> construct"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519681316, "post_id": 48987515, "comment_id": 85000582, "body": "Quite right, I got side-tracked. Leaving this answer here nevertheless, with a header on top refering to the other one."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 0, "last_activity_date": 1519681125, "last_edit_date": 1519681125, "creation_date": 1519644709, "answer_id": 48987515, "question_id": 48984756, "link": "https://stackoverflow.com/questions/48984756/operator-on-do-indentation/48987515#48987515", "title": "Operator on do indentation", "body": "<p><strong>The following does not actually adress the code you posted, but the question you seemed to be asking</strong>. It adresses the following code instead:</p>\n\n<pre><code>do download i inputFile\n   onException\n     (callProcess (List.head args) (List.tail args))\n     (removeFileIfExists name)\n   \u2591`finally` removeFileIfExists inputFile\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/a/48991448/745903\">chi's answer</a> adresses the actually posted code, with <code>`finally`</code> not indented any further than <code>download</code> and <code>onException</code>. I'd remark that this is bad style: when writing that, be sure to indent it <em>less</em>, i.e.</p>\n\n<pre><code>  do download i inputFile\n     onException\n       (callProcess (List.head args) (List.tail args))\n       (removeFileIfExists name)\n `finally` removeFileIfExists inputFile\n</code></pre>\n\n<hr>\n\n<p>As Willem Van Onsem commented, function applications <em>always</em> take precedence before infix applications. This is true for both &ldquo;true infix operators&rdquo; like <code>+</code> or <code>&gt;&gt;=</code>, and for backtick-infixes... if fact there is no baked in distinction between these sorts of operators as far as precedence is concerned: for all infixes the precedence is determined by a fixity declaration, such as</p>\n\n<pre><code><a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Num.html#%2B\" rel=\"nofollow noreferrer\">infixl 6 +</a>\n<a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/Data.Foldable.html#elem\" rel=\"nofollow noreferrer\">infix 4 `elem`</a>\n</code></pre>\n\n<p>The fixity is a number in the range 0..9, and fixity can be either left- right- or non-associative. If no fixity is declared (as with most named functions, whereas for symbol-infixes it's highly recommended to give a fixity declaration), the default <code>infixl 9</code> is used, i.e. basically the highest legal fixity you could manually assign.</p>\n\n<p>OTOH, function application is <em>always</em> <code>infixl 10</code> as it were, i.e. it binds tigher than any infix, no matter how it's declared. So, your example is parsed as</p>\n\n<pre><code>do (download i inputFile)\n   (  (onException\n        (callProcess (List.head args) (List.tail args))\n        (removeFileIfExists name))\n    `finally`\n      (removeFileIfExists inputFile) )\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1519657874, "last_edit_date": 1519657874, "creation_date": 1519657500, "answer_id": 48991448, "question_id": 48984756, "link": "https://stackoverflow.com/questions/48984756/operator-on-do-indentation/48991448#48991448", "title": "Operator on do indentation", "body": "<p>We can find out using GHCi: writing</p>\n\n<pre><code>Prelude&gt; let f = (&gt;&gt;)\nPrelude&gt; :{\nPrelude| do print 5\nPrelude|    print 4\nPrelude|    `f` print 3\nPrelude|    print 2\nPrelude| :}\n</code></pre>\n\n<p>causes the following type error (not a parse error!)</p>\n\n<pre><code>&lt;interactive&gt;:12:8: error:\n    \u2022 Couldn't match expected type \u2018(() -&gt; IO ()) -&gt; Integer -&gt; IO b\u2019\n                  with actual type \u2018IO ()\u2019\n    \u2022 The function \u2018print\u2019 is applied to three arguments,\n      but its type \u2018Integer -&gt; IO ()\u2019 has only one\n      In the second argument of \u2018f\u2019, namely \u2018print 3 print 2\u2019\n      In the expression:\n        do { print 5;\n             print 4 }\n        `f` print 3 print 2\n</code></pre>\n\n<p>Looking at the list lines, we discover how GHCi parsed the code, which is printed with explicit braces-and-semicolons.</p>\n\n<p>There, we see that the <code>`f`</code> part <em>closed</em> the <code>do</code> block! This makes the whole <code>do</code> block to be the first argument to <code>f</code>. Further, the next lines, no longer being in a block, now form a single expression <code>print 4 print 2</code> which is used as the second argument for <code>f</code>. This triggers a type error since it calls <code>print</code> with three arguments.</p>\n\n<p>Indeed, the brace <code>}</code> was inserted before <code>`f`</code> because of the rule mentioned by the OP: when something does not parse in a block, we add <code>}</code> and continue.</p>\n\n<p>Summarizing, if <code>`f`</code> is indented <em>more</em>, the block is parsed as</p>\n\n<pre><code>do print 5\n   print 4 `f` print 3\n   print 2\n</code></pre>\n\n<p>If <code>`f`</code> is indented <em>as</em> the previous line, or <em>less</em>, the block is parsed as</p>\n\n<pre><code>(do { print 5\n    ; print 4 }) `f` print 3 print 2\n</code></pre>\n\n<p>I would suggest to avoid indenting <code>`f`</code> exactly as the previous line: it is better to indent it less, so that the parsing becomes obvious even to a human reader.</p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 48991448, "answer_count": 2, "score": 3, "last_activity_date": 1521018339, "creation_date": 1519635826, "last_edit_date": 1521018339, "question_id": 48984756, "link": "https://stackoverflow.com/questions/48984756/operator-on-do-indentation", "title": "Operator on do indentation", "body": "<p><code>hindent</code> changed my code to:</p>\n\n<pre><code>do download i inputFile\n   onException\n     (callProcess (List.head args) (List.tail args))\n     (removeFileIfExists name)\n   `finally` removeFileIfExists inputFile\n</code></pre>\n\n<p>I can't determine if the <code>finally</code> applies to the rest of the <code>do</code> block, or just the state beginning <code>onException</code>. According to <a href=\"https://en.wikibooks.org/wiki/Haskell/Indentation#Explicit_characters_in_place_of_indentation\" rel=\"nofollow noreferrer\">this</a>, </p>\n\n<blockquote>\n  <p>If you see something unexpected in a list, like where, insert a\n  closing brace before instead of a semicolon.</p>\n</blockquote>\n\n<p>I'm unsure if that rule is applying here.</p>\n\n<p>Does the <code>`finally`</code> apply to the rest of the do, or just the last statement and why?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "edited": false, "score": 0, "creation_date": 1519611940, "post_id": 48980546, "comment_id": 84966316, "body": "but allNeighbors a [] b should be covered by : length (x:xs) &lt;= 0?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "edited": false, "score": 0, "creation_date": 1519612085, "post_id": 48980546, "comment_id": 84966347, "body": "@Phil No, because as I wrote in my answer, that case is unreachable. Your base pattern is <code>allNeighbors graph (x:xs) neighborsList</code>, and <code>(x:xs)</code> doesn&#39;t match empty lists."}, {"owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "reply_to_user": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "edited": false, "score": 0, "creation_date": 1519612413, "post_id": 48980546, "comment_id": 84966438, "body": "@Phil <code>(x:xs)</code> matches a non-empty list and binds its head to x and tail to xs."}, {"owner": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "edited": false, "score": 0, "creation_date": 1519612710, "post_id": 48980546, "comment_id": 84966494, "body": "I see so that was my error, thanks!"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "edited": false, "score": 1, "creation_date": 1519632496, "post_id": 48980546, "comment_id": 84972482, "body": "@Phil: usually I think it is a good idea to compile with <code>-Wall</code> or <code>-fwarn-incomplete-patterns</code> (the former produces more warnings than the latter). In that case the compiler will show you the patterns that are not covered yet by the functions you defined."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 4, "last_activity_date": 1519612617, "last_edit_date": 1519612617, "creation_date": 1519611219, "answer_id": 48980546, "question_id": 48980508, "link": "https://stackoverflow.com/questions/48980508/haskell-non-exhaustive-patterns/48980546#48980546", "title": "Haskell Non-exhaustive patterns", "body": "<p>Not covered: <code>allNeighbors a [] b</code>. (Try it; you should get an error.)</p>\n\n<hr>\n\n<p>The <code>length (x:xs) &lt;= 0</code> case is unreachable (a list whose first element is <code>x</code> cannot have length 0).</p>\n\n<p><code>length (x:xs) == 1</code> is better written as a pattern of the form <code>[x]</code>.</p>\n\n<p><code>length (x:xs) &gt; 1</code> is unnecessarily inefficient: It forces the program to walk through the whole list to compute the length, just to see whether there is more than one element. This could be replaced by a pattern like <code>x : xs@(_ : _)</code>.</p>\n\n<hr>\n\n<p>In fact, the whole function could be rewritten like this:</p>\n\n<pre><code>allNeighbors :: Ord v =&gt; Graph v -&gt; [v] -&gt; [v] -&gt; [v]\nallNeighbors graph list neighborsList =\n    case list of\n        []     -&gt; neighborsList\n        [x]    -&gt; neighborsList ++ neighbors x graph\n        x : xs -&gt; allNeighbors graph xs (neighborsList ++ neighbors x graph)\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "closed_date": 1519611934, "accepted_answer_id": 48980546, "answer_count": 1, "score": -3, "last_activity_date": 1519612617, "creation_date": 1519610853, "question_id": 48980508, "link": "https://stackoverflow.com/questions/48980508/haskell-non-exhaustive-patterns", "closed_reason": "Duplicate", "title": "Haskell Non-exhaustive patterns", "body": "<p>The compiler is telling me that this function has Non-exhaustive patterns, but every scenarios are covered, aren't they?  </p>\n\n<pre><code>allNeighbors :: Ord v =&gt; Graph v -&gt; [v] -&gt; [v] -&gt; [v]\nallNeighbors graph (x:xs) neighborsList\n                   | length (x:xs) &lt;= 0 = neighborsList\n                   | length (x:xs) == 1 = neighborsList ++ (neighbors x graph)\n                   | length (x:xs) &gt; 1 = allNeighbors graph xs (neighborsList ++ (neighbors x graph))\n</code></pre>\n"}, {"tags": ["haskell", "data-structures", "import", "hunit"], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 9253039, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-CgWhQCp3zl8/AAAAAAAAAAI/AAAAAAAAANI/rQTDJYKXoTs/photo.jpg?sz=128", "display_name": "Meltdown", "link": "https://stackoverflow.com/users/9253039/meltdown"}, "edited": false, "score": 0, "creation_date": 1519610484, "post_id": 48980235, "comment_id": 84965995, "body": "Thank you so much! This solved it. Im curious though, how come it worked when using my other file that imports HelpFunctions.hs?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 97, "user_id": 9253039, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-CgWhQCp3zl8/AAAAAAAAAAI/AAAAAAAAANI/rQTDJYKXoTs/photo.jpg?sz=128", "display_name": "Meltdown", "link": "https://stackoverflow.com/users/9253039/meltdown"}, "edited": false, "score": 0, "creation_date": 1519634734, "post_id": 48980235, "comment_id": 84973466, "body": "@Meltdown: well if <code>HelpFunctions</code> only export <i>functions</i>, then there is no second degree export. With <code>Suit(..)</code> you do not only export the <i>type</i>, but also the constructors, but a function (like <code>foo</code>) has no constructors."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1519608652, "last_edit_date": 1519608652, "creation_date": 1519608208, "answer_id": 48980235, "question_id": 48980196, "link": "https://stackoverflow.com/questions/48980196/why-wont-my-test-file-import-my-datastructure-haskell/48980235#48980235", "title": "Why won&#39;t my test file import my datastructure? Haskell", "body": "<p>Your problem is here:</p>\n\n<pre><code>module HelpFunctions(Suit, Value, ...\n</code></pre>\n\n<p>This line says <code>HelpFunctions</code> exports the types <code>Suit</code> and <code>Value</code>, but not their data constructors (i.e. the types are abstract).</p>\n\n<p>You want</p>\n\n<pre><code>module HelpFunctions(Suit(..), Value(..), ...\n</code></pre>\n\n<p>You could list all constructors explicitly, but the <code>..</code> shorthand notation means \"all data constructors of this type\".</p>\n\n<hr>\n\n<p>Reference: <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1000005.2\" rel=\"noreferrer\">The Haskell 2010 Language Report, <strong>5.2 Export Lists</strong></a>:</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li><p>An algebraic datatype <em>T</em> declared by a <code>data</code> or <code>newtype</code> declaration may be named in one of three ways:</p>\n  \n  <ul>\n  <li>The form <em>T</em> names the type <em>but not the constructors or field names</em>. The ability to export a type without its constructors allows the construction of abstract datatypes (see Section <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1150005.8\" rel=\"noreferrer\">5.8</a>).</li>\n  <li>The form <em>T(c<sub>1</sub>,\u2026,c<sub>n</sub>)</em>, names the type and some or all of its constructors and field names.</li>\n  <li>The abbreviated form <em>T</em><code>(..)</code> names the type and all its constructors and field names that are currently in scope (whether qualified or not).</li>\n  </ul></li>\n  </ol>\n</blockquote>\n"}], "owner": {"reputation": 97, "user_id": 9253039, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-CgWhQCp3zl8/AAAAAAAAAAI/AAAAAAAAANI/rQTDJYKXoTs/photo.jpg?sz=128", "display_name": "Meltdown", "link": "https://stackoverflow.com/users/9253039/meltdown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 48980235, "answer_count": 1, "score": 1, "last_activity_date": 1519608652, "creation_date": 1519607810, "question_id": 48980196, "link": "https://stackoverflow.com/questions/48980196/why-wont-my-test-file-import-my-datastructure-haskell", "title": "Why won&#39;t my test file import my datastructure? Haskell", "body": "<p>I am currently writing unit tests for my (very simple) blackjack game and my testfile (Tests.hs) does not seem to import my datastructures that I have declared in the file I am doing unit tests for (HelpFunctions.hs). I can acces the functions/methods in this file but not the datastructures. \nCan someone please help me find the problem? </p>\n\n<p>This is the top of my testfile: </p>\n\n<pre><code>module Tests(performTests) where\nimport Test.HUnit\nimport HelpFunctions\n\ncardList = [(Hearts, Ace)]\n(...)\n</code></pre>\n\n<p>and this is the top of the file that i am going to write tests for</p>\n\n<pre><code>module HelpFunctions(Suit, Value, blackjack, cardDeck, shuffleOne, \n                     shuffleCards, getValue, addHand, dealCard, bust, \n                     getHighest\n                    ) where\n\nimport System.Random\nimport Control.Monad(when)\n\n{- Suit is one of the four suits or color of a playing card \n   ie Hearts, Clubs, Diamonds or Spades\n   INVARIANT: Must be one of the specified.\n -}\ndata Suit = Hearts | Clubs | Diamonds | Spades deriving (Show)\n\n{- Value is the numeric value of a playing card according to the rules of blackjack. \n   INVARIANT: Must be one of the specified.\n -}\ndata Value = Two | Three | Four | Five | Six | Seven | Eight | \n             Nine | Ten | Jack | Queen | King | Ace \n             deriving (Eq, Show)\n(...)\n</code></pre>\n\n<p>And when compiling the testfile I get the error </p>\n\n<pre><code>    Tests.hs:6:14: error: Data constructor not in scope: Hearts\n  |\n6 | cardList = [(Hearts, Ace)]   |              ^^^^^^\n\nTests.hs:6:22: error: Data constructor not in scope: Ace\n  |\n6 | cardList = [(Hearts, Ace)]   |                      ^^^\n</code></pre>\n\n<p>I have another file that import HelpFunctions and the datastructures from it and that work without problems. </p>\n"}, {"tags": ["haskell", "syntax", "monads", "do-notation"], "comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 2, "creation_date": 1519596520, "post_id": 48978995, "comment_id": 84963017, "body": "replace <code>if</code> with <code>guard</code>"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1519596578, "post_id": 48978995, "comment_id": 84963033, "body": "<a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Control-Monad.html#v:guard\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.10.1.0/docs/&hellip;</a>"}, {"owner": {"reputation": 803, "user_id": 2254402, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/503d598e07c6d9dae1ac961736daa0af?s=128&d=identicon&r=PG", "display_name": "heapOverflow", "link": "https://stackoverflow.com/users/2254402/heapoverflow"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1519596659, "post_id": 48978995, "comment_id": 84963063, "body": "@HuStmpHrrr: <code>Variable not in scope: guard :: Int -&gt; Int</code> . Maybe I&#39;m doing something wrong?"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1519596660, "post_id": 48978995, "comment_id": 84963064, "body": "also you might find this helpful: <a href=\"https://wiki.haskell.org/Do_notation_considered_harmful\" rel=\"nofollow noreferrer\">wiki.haskell.org/Do_notation_considered_harmful</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 3, "creation_date": 1519597113, "post_id": 48978995, "comment_id": 84963194, "body": "@HuStmpHrrr if you want to answer a question, <i>answer</i> it, don&#39;t comment, but be sure to actually know the answer. I&#39;m not sure <code>guard</code> actually solves the problem here, and anyways any suggestion for <code>guard</code> should explain how one can imitate/implement it oneself using <code>if</code>. Also, <code>guard</code> does not require any package, only a <i>module</i> import (<code>Control.Monad</code>)."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1519597184, "post_id": 48978995, "comment_id": 84963210, "body": "@heapOverflow could you briefly explain what exactly that Scala code does, or give a simple concrete example?"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1519597711, "post_id": 48978995, "comment_id": 84963369, "body": "@sorry about the miswording. however, why do you think guard does not solve the issue?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519598076, "post_id": 48978995, "comment_id": 84963478, "body": "@leftaroundabout It&#39;s the same as <code>[x | xs &lt;- xss, x &lt;- xs, x &gt; 3]</code>"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1519601999, "post_id": 48978995, "comment_id": 84964378, "body": "@HuStmpHrrr Well in this case it is extremely unclear what the problem is.  The OP even posted showing it doesn&#39;t solve the problem because there isn&#39;t even a monad in use... that or they forgot to use paren such as <code>guard (x &gt; 3)</code>."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 3, "creation_date": 1519621029, "post_id": 48978995, "comment_id": 84968394, "body": "What should the result be if x is not &gt; 3? And FYI there isn&#39;t really a concept of &quot;before returning&quot; in Haskell. <code>return</code> means something entirely different to what you think coming from other languages."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1519633136, "post_id": 48978995, "comment_id": 84972762, "body": "I agree that naming the function <code>return</code> was probably a bad idea (not because of the name itself, but because imperative languages use it for a totally different semantical concept), but <code>return</code> actually does not <i>terminate</i> the control flow (per se), nor does it mean that it per se returns a value."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1519618038, "post_id": 48979956, "comment_id": 84967671, "body": "Or even even betterer: <code>do {xs &lt;- xss; filter (&gt; 3) xs}</code>. It&#39;s always unnecessary to write <code>x &lt;- foo; return x</code> instead of just <code>foo</code>."}], "tags": [], "owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "is_accepted": true, "score": 4, "last_activity_date": 1519642243, "last_edit_date": 1519642243, "creation_date": 1519605102, "answer_id": 48979956, "question_id": 48978995, "link": "https://stackoverflow.com/questions/48978995/is-it-possible-to-check-some-condition-before-returning-from-a-do-block-in-haske/48979956#48979956", "title": "Is it possible to check some condition before returning from a do block in Haskell?", "body": "<p>You need to import <code>Control.Monad</code> and use <code>guard</code></p>\n\n<pre><code>import Control.Monad (guard)\n\ndo\n  xs &lt;- xss\n  x &lt;- xs\n  guard (x &gt; 3)\n  return x\n</code></pre>\n\n<p>Also, as the final if statement in scala is just a filter, you can write it like this:</p>\n\n<pre><code>do\n  xs &lt;- xss\n  x &lt;- xs\n  _ &lt;- filter (&gt;3) [x]\n  return x\n</code></pre>\n\n<p>Edit, as per comment. Even better:</p>\n\n<pre><code>do\n  xs &lt;- xss\n  filter (&gt; 3) xs\n</code></pre>\n\n<p>While in Scala you are doomed to use <code>yield</code> within a for loop because it's part of a control structure, in Haskell <code>return</code> is just a function and you can avoid using it. In general, as monad rules state, <code>do {someStuff; x &lt;- xs; return x}</code> = <code>do {someStuff; xs}</code>  </p>\n"}], "owner": {"reputation": 803, "user_id": 2254402, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/503d598e07c6d9dae1ac961736daa0af?s=128&d=identicon&r=PG", "display_name": "heapOverflow", "link": "https://stackoverflow.com/users/2254402/heapoverflow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 48979956, "answer_count": 1, "score": 2, "last_activity_date": 1519642243, "creation_date": 1519596407, "question_id": 48978995, "link": "https://stackoverflow.com/questions/48978995/is-it-possible-to-check-some-condition-before-returning-from-a-do-block-in-haske", "title": "Is it possible to check some condition before returning from a do block in Haskell?", "body": "<p>I'm doing something like this</p>\n\n<pre><code>do\n  xs &lt;- xss\n  x &lt;- x\n  if x &gt; 3\n  return x\n</code></pre>\n\n<p>The line containing the if is giving me a compile error but I'm not really sure about the proper way to write the same thing.</p>\n\n<p>Just to be more clear, in Scala the equivalent of what I'm trying to achieve would be:</p>\n\n<pre><code>for {\n  xs &lt;- xss\n  x &lt;- xs\n  if x &gt; 3\n  } yield x\n</code></pre>\n"}, {"tags": ["haskell", "hdbc"], "comments": [{"owner": {"reputation": 1304, "user_id": 231299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66dff0c4f2df2394109a0b09fa59dce1?s=128&d=identicon&r=PG", "display_name": "beerboy", "link": "https://stackoverflow.com/users/231299/beerboy"}, "edited": false, "score": 0, "creation_date": 1519596240, "post_id": 48977947, "comment_id": 84962929, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/16472952/how-do-you-fill-in-the-parameters-for-an-sql-in-placeholder-with-hdbc\">How do you fill in the parameters for an SQL IN placeholder with HDBC?</a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519859683, "post_id": 48977947, "comment_id": 85085754, "body": "What is the type of <code>ids</code>, and which value you are supplying for it in your test run? (Also, going by <a href=\"https://hackage.haskell.org/package/HDBC-2.4.0.2/docs/Database-HDBC-Statement.html#v:executeMany\" rel=\"nofollow noreferrer\">its description in the docs</a> I don&#39;t think you need <code>executeMany</code> here. Clarifying what your <code>ids</code> is should also shed some light on that.)"}], "owner": {"reputation": 8964, "user_id": 584121, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3c7af62d226bc7420d49128d03a5b139?s=128&d=identicon&r=PG", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/584121/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1519604746, "creation_date": 1519589375, "last_edit_date": 1519604746, "question_id": 48977947, "link": "https://stackoverflow.com/questions/48977947/how-can-i-prepare-a-database-query-for-multiple-items-in-hdbc", "title": "How can I prepare a database query for multiple items in HDBC?", "body": "<p>I have a Sqlite table called <code>text</code> that has colums <code>id</code> and <code>text</code>. I want to get these values out for every row from a list of ids, using HDBC and Haskell. In the sqlite3 command-line program, I can run the query: <code>select id, text from text where id in (1.0,8.0);</code> and it works fine. But here's my Haskell code: </p>\n\n<pre><code>-- Takes a single string of comma-delimited ids, \n-- e.g. \"1.0,2.0,3.0\" representing texts to get. \ngetFullText conn ids = do\n  stmt &lt;- prepare conn \"select id, text from text where id in (?)\"\n  _ &lt;- execute stmt [toSql ids]\n  fetchAllRows stmt\n</code></pre>\n\n<p>And if I try <code>getFullText conn \"1.0\"</code> I can get the text for the item with id 1.0. But if I try <code>getFullText conn \"1.0,2.0\"</code> it just returns <code>[]</code>. </p>\n\n<p>I think this is because it expands my query to <code>select text from text where id in (\"1.0,8.0\")</code>, instead of <code>select text from text where id in (1.0,8.0)</code> or <code>select text from text where id in (\"1.0\",\"8.0\")</code>. What do I need to do to be able to expand <code>?</code> into multiple values? </p>\n\n<p><strong>Edit</strong>: I see that there's a very similar question <a href=\"https://stackoverflow.com/questions/16472952/how-do-you-fill-in-the-parameters-for-an-sql-in-placeholder-with-hdbc\">here</a>, but as a haskell beginner, I can't figure out what the magical <code>&lt;$&gt;</code> and <code>&lt;$</code> operators do. Heres's what I've tried: </p>\n\n<pre><code>getFullText conn ids = do\n  let query = \"select id, text from text where id in (\" ++ intersperse ',' ('?' &lt;$ ids) ++ \")\"\n  stmt &lt;- prepare conn query\n  _ &lt;- executeMany stmt ids\n  fetchAllRowsAL stmt\n</code></pre>\n\n<p>But when I try applying this function to a <code>conn</code> and a list of Sqlvalues, I get <code>*** Exception: SqlError {seState = \"\", seNativeError = -1, seErrorMsg = \"In HDBC execute, received [SqlByteString \\\"105.0\\\"] but expected 20 args.\"}</code>. But I think what I'm passing is of length 20, so that should be fine? I think the problem is I don't really understand what <code>&lt;$</code> is doing. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1519589000, "post_id": 48977455, "comment_id": 84960819, "body": "For debugging purposes, I&#39;d recommend using the <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Debug-Trace.html\" rel=\"nofollow noreferrer\">Debug.Trace</a> module, which has an API that works around this issue."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1519589519, "post_id": 48977455, "comment_id": 84960954, "body": "Just use <code>$!</code> instead of <code>$</code> after <code>return</code>. No real need for the <code>_ &lt;-</code> bit, by the way."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1519621124, "post_id": 48977455, "comment_id": 84968416, "body": "Delete the line <code>_ &lt;- return $ unsafePerformIO $ do</code> and unindent the following line. But what&#39;s your <i>real</i> use-case where you actually need unsafePerformIO?"}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1519587547, "creation_date": 1519587547, "answer_id": 48977647, "question_id": 48977455, "link": "https://stackoverflow.com/questions/48977455/how-do-i-force-evaluation-of-an-io-action-within-unsafeperformio/48977647#48977647", "title": "How do I force evaluation of an IO action within `unsafePerformIO`?", "body": "<p>Potentially there are some limitations with the below (mentioned in the comments of the referenced answer). </p>\n\n<p>More information here: <a href=\"https://stackoverflow.com/a/14163739/1663462\">https://stackoverflow.com/a/14163739/1663462</a></p>\n\n<pre><code>{-# LANGUAGE BangPatterns #-}\nimport System.IO.Unsafe\n\nmain :: IO ()\nmain = do\n  let !_ = unsafePerformIO $ do\n         print \"test2\"\n  print \"test\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1519594710, "post_id": 48978033, "comment_id": 84962489, "body": "To trace in a monad I usually trace the action rather than the value: <code>trace &quot;test2&quot; $ return ()</code>rather than <code>return $! trace &quot;test2&quot; ()</code> -- it&#39;s just clearer to me that it will definitely be evaluated when sequenced."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 8, "last_activity_date": 1519590212, "last_edit_date": 1519590212, "creation_date": 1519589910, "answer_id": 48978033, "question_id": 48977455, "link": "https://stackoverflow.com/questions/48977455/how-do-i-force-evaluation-of-an-io-action-within-unsafeperformio/48978033#48978033", "title": "How do I force evaluation of an IO action within `unsafePerformIO`?", "body": "<p>In order for the IO side-effect to be executed, the \"pure\" value created by <code>unsafePerformIO</code> needs to be forced (i.e., evaluated at least to WHNF).</p>\n\n<p>Unfortunately, your <code>main</code> function:</p>\n\n<pre><code>main = do\n  _ &lt;- return $ unsafePerformIO $ do\n    print \"test2\"\n  print \"test\"\n</code></pre>\n\n<p>desugars (as per the Haskell98 report) into:</p>\n\n<pre><code>main = let ok _ = do { print \"test\" }\n           ok _ = fail \"...\"\n       in return (unsafePerformIO (print \"test2\")) &gt;&gt;= ok\n</code></pre>\n\n<p>which is equivalent by the monad laws to:</p>\n\n<pre><code>main = let ok _ = do { print \"test\" }\n           ok _ = fail \"...\"\n       in ok (unsafePerformIO (print \"test2\"))\n</code></pre>\n\n<p>Sadly, the first part of the <code>let</code> binding:</p>\n\n<pre><code>let ok _ = do { print \"test2\" }\n</code></pre>\n\n<p>doesn't use -- and so doesn't force -- its argument when it's called, so the \"pure\" unsafe IO action is ignored.</p>\n\n<p>Since pattern matching the \"pure\" value to its constructor (namely <code>()</code>) <em>would</em> force the value and so execute the unsafe action, if you write:</p>\n\n<pre><code>main = do\n  () &lt;- return $ unsafePerformIO $ do\n    print \"test2\"\n  print \"test\"\n</code></pre>\n\n<p>then that will work fine.</p>\n\n<p>There are other ways to force the action.  You could pattern match explicitly:</p>\n\n<pre><code>main = do\n  case unsafePerformIO (print \"test2\") of\n    () -&gt; return ()\n  print \"test\"\n</code></pre>\n\n<p>or use <code>seq</code> either like so:</p>\n\n<pre><code>main = do\n  unsafePerformIO (print \"test2\") `seq` print \"test\"\n</code></pre>\n\n<p>or like so:</p>\n\n<pre><code>main = do\n  unsafePerformIO (print \"test2\") `seq` return ()\n  print \"test\"\n</code></pre>\n\n<p>or use the strict evaluation operator:</p>\n\n<pre><code>main = do\n  return $! unsafePerformIO (print \"test2\")\n  print \"test\"\n</code></pre>\n\n<p>You can also use the <code>BangPatterns</code> extension as suggested by @Chris Stryczynski.</p>\n\n<p>I'm not sure which is best, though I'd lean towards using the <code>($!)</code> operator as the most idiomatic.</p>\n\n<p>As noted by @Carl, for debugging purposes, using <code>trace</code> from <code>Debug.Trace</code> is generally more sensible than calling <code>unsafePerformIO</code> directly, both because it's the standard way of printing debugging information from pure code and because the implementation is a little more thoughtful than a simple <code>unsafePerformIO . putStrLn</code>.  However, it potentially exhibits the same issue:</p>\n\n<pre><code>import Debug.Trace\nmain = do\n  return $ trace \"test2\" ()  -- won't actually print anything\n  print \"test\"\n</code></pre>\n\n<p>Instead, you need to force it's value, perhaps by using one of the methods above:</p>\n\n<pre><code>import Debug.Trace\nmain = do\n  return $! trace \"test2\" ()  -- with ($!) this works\n  print \"test\"\n</code></pre>\n\n<p>When @Carl says that <code>trace</code> has an API that works around this issue, he means that you normally use trace in a situation like:</p>\n\n<pre><code>let value_i_actually_use = trace \"my message\" value_of_the_trace_expression\n</code></pre>\n\n<p>When you actually <em>use</em> (evaluate) the value of the <code>trace</code> expression, then the message will be displayed.</p>\n\n<p>and then </p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "accepted_answer_id": 48978033, "answer_count": 2, "score": 1, "last_activity_date": 1519590212, "creation_date": 1519586502, "question_id": 48977455, "link": "https://stackoverflow.com/questions/48977455/how-do-i-force-evaluation-of-an-io-action-within-unsafeperformio", "title": "How do I force evaluation of an IO action within `unsafePerformIO`?", "body": "<pre><code>import System.IO.Unsafe\n\nmain :: IO ()\nmain = do\n  _ &lt;- return $ unsafePerformIO $ do\n    print \"test2\"\n  print \"test\"\n</code></pre>\n\n<p>The above only outputs <code>test</code> (when run via <code>runghc</code>), I'm assuming due the lazy nature of Haskell that the first IO action does not actually get evaluated. How can I force it to evaluate and perform the action?</p>\n\n<p>The above is for debugging purposes only.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1519585278, "post_id": 48977231, "comment_id": 84959490, "body": "You can not capture that in a list, since it would mean that <code>a ~ [(b,a)]</code>. You need a <i>tree</i>-like datastructure for that."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519589292, "post_id": 48977231, "comment_id": 84960905, "body": "@WillemVanOnsem How do i do this in haskell?"}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1519760961, "post_id": 48977231, "comment_id": 85038590, "body": "how actually do you want your data to look at? you will need to define a <code>data</code> to begin with."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1519768507, "post_id": 48977231, "comment_id": 85042336, "body": "@HuStmpHrrr ideally id like to use generic types <code>a</code> and <code>b</code>."}, {"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 2, "creation_date": 1519768564, "post_id": 48977231, "comment_id": 85042366, "body": "From what your code does, b has no chance to be generic. What problem are you solving?"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 5, "last_activity_date": 1519870141, "last_edit_date": 1519870141, "creation_date": 1519833149, "answer_id": 49033544, "question_id": 48977231, "link": "https://stackoverflow.com/questions/48977231/how-can-i-use-generic-type-annotations-to-describe-a-recursive-data-type/49033544#49033544", "title": "How can I use generic type annotations to describe a recursive data type?", "body": "<p>To make the issue a bit more evident, let's substitute the definition of <code>buildEdges</code> in the final case of your definition:</p>\n\n<pre><code>comboGraph (x:xs) n =\n    (x, comboGraph xs (n-1)) : comboGraph xs n\n</code></pre>\n\n<p>The result of <code>comboGraph</code> is supposed to be a list, but one whose elements are pairs that also have a <code>comboGraph</code> result (i.e. a list of the same type) within. As the type error you got says, that doesn't work -- it's as if you wanted a list with two tails. The fix is switching to a different data structure that reflects what you are trying to do:</p>\n\n<pre><code>-- Feel free to substitute better names.\ndata Combo a = Empty | Node a (Combo a) (Combo a)\n    deriving (Eq, Ord, Show)\n</code></pre>\n\n<p><code>Empty</code> covers the base cases which used to result in an empty list, while <code>Node</code> has one appropriately-typed field for each of the things you want to combine in the recursive case. <code>comboGraph</code> then becomes:</p>\n\n<pre><code>comboGraph :: [a] -&gt; Int -&gt; Combo a\ncomboGraph _ 0 = Empty\ncomboGraph [] _ = Empty\ncomboGraph (x:xs) n = Node x (comboGraph xs (n-1)) (comboGraph xs n)\n</code></pre>\n\n<p>(Note that <code>Combo</code> is actually a binary tree with values on the nodes.)</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1519870708, "last_edit_date": 1519870708, "creation_date": 1519870370, "answer_id": 49041594, "question_id": 48977231, "link": "https://stackoverflow.com/questions/48977231/how-can-i-use-generic-type-annotations-to-describe-a-recursive-data-type/49041594#49041594", "title": "How can I use generic type annotations to describe a recursive data type?", "body": "<p>I like the other answer, and I think you should use it. But it makes some reasoning leaps that require some intuition, and it can be hard to get this intuition without doing things the mechanical way a few times. So in this answer, I will show how to start with a failing definition like the one you have, \"turn a crank\", and mechanically get a solution that does work. The technique below can be applied to any infinite type error.</p>\n\n<p>You have the following clause (paraphrased slightly):</p>\n\n<pre><code>comboGraph (x:xs) n =\n    (x, comboGraph xs (n-1)) : {- ... -}\n</code></pre>\n\n<p>Just doing some straightforward type inference reasoning, we can see that <code>comboGraph</code> takes a list of some type (from the fact that it pattern matches on <code>x:xs</code>) and a number (from the fact that it subtracts one). Let's pick a concrete (monomorphic! but not yet known) type <code>a</code> for the list elements and see what we can infer about what it returns.</p>\n\n<p>Well, it clearly returns a list with tuples inside. And the first part of the tuple is just an <code>a</code>. What about the second part? The second part of the tuple is... whatever type <code>comboGraph</code> returns. So <code>comboGraph</code> returns a type <code>t</code> satisfying the equation:</p>\n\n<pre><code>t = [(a, t)]\n</code></pre>\n\n<p>The only solution to this equation is <code>[(a, [(a, [(a, [(a, ...)])])])]</code>. Such infinite types don't exist raw in Haskell. But there is a standard trick to get quite close: use (type-level) recursion by introducing a newtype. We're solving for <code>t</code>, but Haskell types have to start with an upper-case letter, so we'll name our solution to this equation <code>T</code>.</p>\n\n<pre><code>newtype T a = T [(a, T a)] deriving Show\n</code></pre>\n\n<p>Now we don't <em>quite</em> have <code>T a ~ [(a, T a)]</code>, but we do have an isomorphism: namely, <code>\\(T xs) -&gt; xs :: T a -&gt; [(a, T a)]</code> and <code>T :: [(a, T a)] -&gt; T a</code> are inverses. So now we can write your <code>comboGraph</code> definition by exploiting this isomorphism. Let's name the other half of the isomorphism:</p>\n\n<pre><code>unT :: T a -&gt; [(a, T a)]\nunT (T xs) = xs\n</code></pre>\n\n<p>So:</p>\n\n<pre><code>comboGraph (x:xs) n =\n    T ((x, comboGraph xs (n-1)) : unT (comboGraph xs n))\n</code></pre>\n\n<p>The base cases have to get wrapped in <code>T</code>, as well, of course:</p>\n\n<pre><code>comboGraph _ 0 = T []\ncomboGraph [] _ = T []\n</code></pre>\n\n<p>Try it in ghci:</p>\n\n<pre><code>&gt; comboGraph \"abc\" 3\nT [('a',T [('b',T [('c',T [])]),('c',T [])]),('b',T [('c',T [])]),('c',T [])]\n</code></pre>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 49033544, "answer_count": 2, "score": 1, "last_activity_date": 1519870708, "creation_date": 1519585076, "question_id": 48977231, "link": "https://stackoverflow.com/questions/48977231/how-can-i-use-generic-type-annotations-to-describe-a-recursive-data-type", "title": "How can I use generic type annotations to describe a recursive data type?", "body": "<p>Here's the function:</p>\n\n<pre><code>comboGraph :: [a] -&gt; Int -&gt; [b]\ncomboGraph _ 0 = []\ncomboGraph [] _ = []\ncomboGraph (x:xs) n =\n    (buildEdges x xs) : comboGraph xs n\n    where   buildEdges h t = (h, comboGraph t (n-1))\n</code></pre>\n\n<p>Ths function takes in a list of type <code>a</code>, a number, and returns a list of type <code>b</code>. As you can see, though, type <code>b</code> is actually a recursive type -- it will be something along the lines of <code>[(a, [(a, b1)])]</code>. When I try to compile, I get this error:</p>\n\n<pre><code>\u2022 Couldn't match type \u2018b\u2019 with \u2018(a, [b0])\u2019\n  \u2018b\u2019 is a rigid type variable bound by\n    the type signature for:\n      comboGraph :: forall a b. [a] -&gt; Int -&gt; [(a, [b])]\n    at xxx.hs:15:15\n  Expected type: [(a, [b])]\n    Actual type: [(a, [(a, [b0])])]\n\u2022 In the expression: (buildEdges x xs) : comboGraph xs n\n  In an equation for \u2018comboGraph\u2019:\n      comboGraph (x : xs) n\n        = (buildEdges x xs) : comboGraph xs n\n        where\n            buildEdges h t = (h, comboGraph t (n - 1))\n</code></pre>\n\n<p>How do I properly annotate this function?</p>\n"}, {"tags": ["haskell", "terminal", "pretty-print"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 5, "last_activity_date": 1519645278, "last_edit_date": 1519645278, "creation_date": 1519595718, "answer_id": 48978879, "question_id": 48975919, "link": "https://stackoverflow.com/questions/48975919/how-can-i-refresh-the-last-line-of-output-in-terminal-if-i-want-to-use-a-pret/48978879#48978879", "title": "How can I &quot;refresh&quot; the last line of output in terminal, if I want to use a pretty-printing library to add colours?", "body": "<p><code>ansi-wl-pprint</code> depends on <code>ansi-terminal</code>, which has a <a href=\"https://hackage.haskell.org/package/ansi-terminal-0.8.0.1/docs/System-Console-ANSI.html#v:clearLine\" rel=\"nofollow noreferrer\"><code>clearLine</code></a> method and other utilities to move around and record positions in the console.</p>\n\n<p>Under the hood, <code>clearLine</code> sends a specific <em>ANSI control sequence</em> to erase the current line. There is also a control sequence to rewind the cursor to the beginning of the current line (or any line, for that matter). This is somewhat an obscure art, but you'd be surprised to see <a href=\"https://en.wikipedia.org/wiki/ANSI_escape_code#CSI_sequences\" rel=\"nofollow noreferrer\">how many control sequences</a> there are.</p>\n\n<p>You can manipulate the control sequences manually. For example, if you <code>putStr \"\\ESC[2K\\ESC[0G\"</code>, it should erase the current line and then put the cursor to the beginning of it \u2212 analogous to what your code is doing, but cleaner. But it would probably serve you best if you depend on <code>ansi-terminal</code> and use the operations <code>hClearLine</code> and <code>hSetCursorColumn</code> defined there. If ou already indirectly depend on <code>ansi-terminal</code> through <code>ansi-wl-pprint</code>, it should not incur additional build time cost.</p>\n"}], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 0, "accepted_answer_id": 48978879, "answer_count": 1, "score": 4, "last_activity_date": 1519645278, "creation_date": 1519577043, "question_id": 48975919, "link": "https://stackoverflow.com/questions/48975919/how-can-i-refresh-the-last-line-of-output-in-terminal-if-i-want-to-use-a-pret", "title": "How can I &quot;refresh&quot; the last line of output in terminal, if I want to use a pretty-printing library to add colours?", "body": "<p>There is a program that interacts with the user by repeatedly overwriting the last line of text in <code>stderr</code>. It is done as follows:</p>\n\n<ul>\n<li>There is a state monad that remembers the length of the last line printed.</li>\n<li><p>When It wants to overwrite a line <code>s</code> with another line <code>s'</code>, It pads <code>s'</code> with spaces until it is at least as long as <code>s</code> and prepends it with <em>\"carriage return\"</em> character:</p>\n\n<pre><code>n &lt;- gets lastLineLength\nlet s'Padded | 0 &lt; n     = '\\r': s' ++ replicate (n - length s') ' '\n             | otherwise = s'\nhPutStr stderr s'Padded\n</code></pre></li>\n</ul>\n\n<p>This works just fine. <em>(Though I personally have not tested it in circumstances other than the usual Linux terminal.)</em></p>\n\n<p>I set about improving this program by replacing plain <code>String</code> by a <code>Doc</code> type from <a href=\"https://hackage.haskell.org/package/ansi-wl-pprint-0.6.8.2/docs/Text-PrettyPrint-ANSI-Leijen-Internal.html\" rel=\"nofollow noreferrer\"><code>ansi-wl-pprint</code></a> so that I may paint the text in colours, in the same fashion as the recent GHC sports. A library such as this one may be overkill, as I only need to output a few lines at once, and without any indentation, but I wanted to give it a try for its abstract colouring facilities. However, I don't think this library (or any pretty printing library for that matter) would feature a function aimed at erasing previously printed <code>Doc</code>s.</p>\n\n<p>One solution I have in mind is rendering the <code>Doc</code> to a <code>String</code> and measuring its length. However, I will have to discount for colour codes; furthermore, this is overall an intrusion into the abstraction the library offers: specifically, I will have to rely on the assumption that the render I do manually will match the render implicitly done by <code>hPutDoc</code>.</p>\n\n<p>Should I forfeit the library altogether and keep dealing in <code>String</code>s, manually throwing in ANSI escape sequences and carriage returns? Is there a nicer way to overwrite previous output? I welcome any advice.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1519572690, "post_id": 48974571, "comment_id": 84955180, "body": "But you already have a state: the <code>world</code>, so you probably better alter the <code>World</code> datatype and add an extra parameter to it."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1519621269, "post_id": 48974571, "comment_id": 84968446, "body": "Isn&#39;t the score a global variable? How does the score currently work? What about the snake&#39;s coordinates, aren&#39;t those already global? If you try to use whatever you&#39;re using already, and <code>State</code> at the same time, you&#39;ll probably end up confusing yourself even more. Use one or the other."}], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 5864821, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9ROlt.png?s=128&g=1", "display_name": "SANK", "link": "https://stackoverflow.com/users/5864821/sank"}, "is_accepted": false, "score": 0, "last_activity_date": 1519660942, "creation_date": 1519660942, "answer_id": 48992400, "question_id": 48974571, "link": "https://stackoverflow.com/questions/48974571/haskell-using-monads-as-a-sort-of-a-global-variable/48992400#48992400", "title": "Haskell Using monads as a sort of a global variable", "body": "<p>You would use StateT if you would like to have access to both IO and State at the same time. State uses the exact same interface minus the extra parameter in the type constructor.</p>\n\n<pre><code>import Control.Monad.Trans.State\nimport Control.Monad.IO.Class\n</code></pre>\n\n<p>The game type is a State transformer applied to IO. This wraps State around the IO type allowing us to <code>lift</code> IO functions into the IO monad when required. Here <code>s</code> is our start state and <code>a</code> is our return state.</p>\n\n<pre><code>type Game s a = StateT s IO a\n</code></pre>\n\n<p>Game state is captured as a record type with the fields you want to update over time. This is where you store the snake, length, and other items in the global game state.</p>\n\n<pre><code>data GameState = GameState\n  { _score :: Int\n  , _length :: Int\n  } deriving (Show)\n</code></pre>\n\n<p>To modify state we use the <code>modify</code> function from <code>StateT</code> which gets the state, applies a function over it, then sets the resulting state (<code>modify fn = do s &lt;- get; put (fn s)</code>)</p>\n\n<pre><code>set :: (GameState -&gt; GameState) -&gt; Game GameState ()\nset field = modify field\n\nscore :: (Int -&gt; Int) -&gt; GameState -&gt; GameState\nscore fn (GameState s l) = GameState (fn s) l\n\nlen :: (Int -&gt; Int) -&gt; GameState -&gt; GameState\nlen fn (GameState s l) = GameState s (fn l)\n</code></pre>\n\n<p>To use <code>IO</code> we must lift the function to the IO monad using <code>liftIO</code></p>\n\n<pre><code>display :: Show a =&gt; a -&gt; Game GameState ()\ndisplay = liftIO . print\n</code></pre>\n\n<p>An example of this in use follows.</p>\n\n<pre><code>game :: Game GameState ()\ngame = do s &lt;- gets _score\n          l &lt;- gets _length\n          display \"initial values\"\n          display s\n          display l\n          set $ score (+2)\n          set $ len (+1)\n          s &lt;- gets _score\n          l &lt;- gets _length\n          display \"modified values\"\n          display s\n          display l\n</code></pre>\n\n<p>Where <code>runStateT game (GameState 0 0)</code> would print</p>\n\n<pre><code>\"initial values\"\n0\n0\n\"modified values\"\n2\n1\n((),GameState (_score = 2, _length = 1})\n</code></pre>\n\n<p>Which should fit your existing model with minor changes.</p>\n"}], "owner": {"reputation": 73, "user_id": 6751737, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6152019e8b439f285e5de0ef75c72fcb?s=128&d=identicon&r=PG&f=1", "display_name": "The_C", "link": "https://stackoverflow.com/users/6751737/the-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519660942, "creation_date": 1519568939, "last_edit_date": 1519569716, "question_id": 48974571, "link": "https://stackoverflow.com/questions/48974571/haskell-using-monads-as-a-sort-of-a-global-variable", "title": "Haskell Using monads as a sort of a global variable", "body": "<p>I'm building a snake game and I'm using gloss graphics for the game.\nI'm using G.play for initiation of the game:</p>\n\n<pre><code>main :: IO ()\nmain = do\nrand &lt;- R.randomIO\nlet world = startWorld rand\n\nG.play\n    (displayMode world)\n    backgroundColor\n    stepRate\n    world\n    drawWorld\n    handleEvent\n    handleStep\n</code></pre>\n\n<p>Now the snake is basically a list of pairs of coordinates and the score is the length of the snake. However, I've added a feature of a special apple that gives you 2 points instead of 1, and only adds 1 length to the snake. But because the score is based on the snake's length I wanted to create a global variable that will count the number of times that the snake had eaten the special apple and will add that to the score. I searched the web and couldn't figure out how to actually use Monad.State to help me with this global variable.</p>\n"}, {"tags": ["parsing", "haskell", "applicative", "alternative-functor"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519830118, "post_id": 48971650, "comment_id": 85069706, "body": "Maybe I&#39;m not understanding the problem correctly; Why not simply require there to be a <code>Default</code> instance for the error or something along those lines? No need add wrapping/unwrapping (unless you want to use it with an error type that doesn&#39;t have a default, in which case you&#39;d just do <i>both</i> the wrapping and the unwrapping on the use end)"}, {"owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1520027289, "post_id": 48971650, "comment_id": 85161738, "body": "I considered requiring a default. Decided against it because I wasn&#39;t sure I had the chops to make such a monad (I think I know how to though). Short of that, the entire thing I was trying to avoid was the unwrapping on the user end (presumably my library would need to wrap in its own error type). Although given that Megaparsec and Parsec just define their own, so it seems like this is the way to go."}], "answers": [{"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 1, "creation_date": 1519639927, "post_id": 48974004, "comment_id": 84976323, "body": "<a href=\"http://hackage.haskell.org/package/semigroupoids-5.2.2/docs/Data-Functor-Alt.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/semigroupoids-5.2.2/docs/&hellip;</a>"}, {"owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "edited": false, "score": 0, "creation_date": 1519730998, "post_id": 48974004, "comment_id": 85019675, "body": "Very interesting to see that in other worlds the more modular choice was made! Thanks for the detail! Also interesting that in lieu of an <code>empty</code> the laws are just for associativity and distributivity. I guess we can only wait for this modularization to mature over time. As a tangent, I&#39;m curious what you think about the design choice of having a wrapper error type to <code>instance Alternative</code>. Parsec as reference art didn&#39;t suggest to me whether this was a good or bad approach. Perhaps you have more experience?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "edited": false, "score": 0, "creation_date": 1519741067, "post_id": 48974004, "comment_id": 85026065, "body": "@BaileyParker Well, <code>parsec</code> is very old and you should use <code>megaparsec</code> (at least for reference): <a href=\"https://github.com/mrkkrp/megaparsec#megaparsec-vs-parsec\" rel=\"nofollow noreferrer\">github.com/mrkkrp/megaparsec#megaparsec-vs-parsec</a> As I can see from <code>megaparsec</code> sources, it also defines <code>empty</code> using special error type: <a href=\"https://hackage.haskell.org/package/megaparsec-6.4.0/docs/src/Text-Megaparsec.html#line-441\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/megaparsec-6.4.0/docs/src/&hellip;</a> I think this is a necessary workaround for current type class hierarchy."}, {"owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "edited": false, "score": 0, "creation_date": 1519763775, "post_id": 48974004, "comment_id": 85040039, "body": "Thanks for pointing me to megaparsec! It looks like fantastic reference art. And thanks for your answer :)"}], "tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 4, "last_activity_date": 1519638213, "last_edit_date": 1519638213, "creation_date": 1519565429, "answer_id": 48974004, "question_id": 48971650, "link": "https://stackoverflow.com/questions/48971650/applicative-parser-deriving-alternative-without-empty/48974004#48974004", "title": "Applicative Parser deriving Alternative without empty", "body": "<p>It's a problem of standard <code>base</code> hierarchy. It's not extremely modular. In some perfect world <code>Alternative</code> would be splitted into three type classes if we want to achieve maximum modularity.</p>\n\n<p>See <code>Alternative</code> definition in PureScript world:</p>\n\n<ul>\n<li><a href=\"https://pursuit.purescript.org/packages/purescript-control/3.3.0/docs/Control.Alternative#t:Alternative\" rel=\"nofollow noreferrer\">https://pursuit.purescript.org/packages/purescript-control/3.3.0/docs/Control.Alternative#t:Alternative</a></li>\n</ul>\n\n<p>Like this:</p>\n\n<pre><code>class Functor f &lt;= Alt f where\n  alt :: forall a. f a -&gt; f a -&gt; f a  -- alt is (&lt;|&gt;)\n\nclass Alt f &lt;= Plus f where\n  empty :: forall a. f a\n\nclass (Applicative f, Plus f) &lt;= Alternative f\n</code></pre>\n\n<p>So, if type hierarchy is modular enough you could implement <code>Alt</code> for your <code>Parser</code> type (and have all <code>&lt;|&gt;</code>-only-related functions) but not <code>Alternative</code>. If <code>Alternative</code> is <code>Monoid</code> then <code>Alt</code> is <code>Semigroup</code>: you can <em>append</em> elements but you don't have <em>empty</em> element.</p>\n\n<p>Note, that previously in GHC <code>base</code> package <code>Applicative</code> wasn't a superclass of <code>Monad</code>, <code>Semigroup</code> wasn't in <code>base</code> and only in GHC-8.4.1 <code>Semigroup</code> will be superclass of <code>Monoid</code>. So you can expect that in some future similar thing (modularization) can happen with <code>Alternative</code>.</p>\n"}], "owner": {"reputation": 14585, "user_id": 568785, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/88c6371f6a47841abde4c60dd8a2f964?s=128&d=identicon&r=PG", "display_name": "Bailey Parker", "link": "https://stackoverflow.com/users/568785/bailey-parker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 1, "accepted_answer_id": 48974004, "answer_count": 1, "score": 2, "last_activity_date": 1613795486, "creation_date": 1519547018, "last_edit_date": 1613795486, "question_id": 48971650, "link": "https://stackoverflow.com/questions/48971650/applicative-parser-deriving-alternative-without-empty", "title": "Applicative Parser deriving Alternative without empty", "body": "<p>From reading <a href=\"https://stackoverflow.com/a/13081604/568785\">this answer</a>, I understand that the inclusion of <code>empty</code> in <code>Alternative</code> was largely a design decision to make <code>Alternative</code> a monoid (and thus more powerful). It seems to me this was also because otherwise you couldn't express any laws for <code>Alternative</code>.</p>\n\n<p>But this is a pain if I have a generic applicative parser like so:</p>\n\n<pre><code>newtype Parser err src target = Parser (ExceptT err (State [src]) target)\n  deriving (Functor, Applicative, Alternative, Monad, MonadState [src], MonadError err)\n</code></pre>\n\n<p>Clearly, we can get the same behavior as <code>&lt;|&gt;</code> and <code>many</code>/<code>some</code> from <code>Control.Applicative</code> with:</p>\n\n<pre><code>option :: Parser e s t -&gt; Parser e s t -&gt; Parser e s t\noption parserA parserB = do\n  state &lt;- get\n  parserA `catchError` \\_ -&gt; put state &gt;&gt; parserB\n\nmany :: Parser e s t -&gt; Parser e s [t]\nmany parser = some parser `option` return []\n\nsome :: Parser e s t -&gt; Parser e s [t]\nsome parser = (:) &lt;$&gt; parser &lt;*&gt; many parser\n</code></pre>\n\n<p>Even though none of these use <code>empty</code>, it seems like I am forced to re-implement them instead of deriving <code>Alternative</code>, because I can't conceive a generic way to instance <code>empty</code> for it (of course, I'd still need to instance <code>&lt;|&gt;</code> to get the preservation of <code>state</code> on <code>parserA</code> error, but then I could get <code>some</code>, <code>many</code>, <code>optional</code> and friends for free).</p>\n\n<p>Digging into Parsec's source, it seems that it subverts this because it doesn't allow for custom error types (or at least, <code>Parsec</code> isn't parameterized by a custom error type):</p>\n\n<pre><code>instance Applicative.Alternative (ParsecT s u m) where\n    empty = mzero\n    (&lt;|&gt;) = mplus\n\ninstance MonadPlus (ParsecT s u m) where\n    mzero = parserZero\n    mplus p1 p2 = parserPlus p1 p2\n\n-- | @parserZero@ always fails without consuming any input. @parserZero@ is defined\n-- equal to the 'mzero' member of the 'MonadPlus' class and to the 'Control.Applicative.empty' member\n-- of the 'Control.Applicative.Alternative' class.\n\nparserZero :: ParsecT s u m a\nparserZero\n    = ParsecT $ \\s _ _ _ eerr -&gt;\n      eerr $ unknownError s\n\nunknownError :: State s u -&gt; ParseError\nunknownError state        = newErrorUnknown (statePos state)\n\nnewErrorUnknown :: SourcePos -&gt; ParseError\nnewErrorUnknown pos\n    = ParseError pos []\n</code></pre>\n\n<p>Taking inspiration from this, it seems like the only reasonable way around this is to have my generic parser wrap the user error type with something like:</p>\n\n<pre><code> data ParserError err = UserError err | UnknownError\n\n newtype Parser err src target = Parser (ExceptT (ParserError err) (State [src]) target)\n  deriving (Functor, Applicative, Alternative, Monad, MonadState [src], MonadError err)\n</code></pre>\n\n<p>And then <code>empty</code> can be:</p>\n\n<pre><code>empty = throwError UnknownError\n</code></pre>\n\n<p>This just <em>feels</em> wrong, though. This wrapping only exists to appease the requirement for an <code>empty</code> and it makes consumers of this generic parser do more work to handle errors (they also must handle <code>UnknownError</code> now and unwrap their custom errors). Is there any way to avoid this?</p>\n"}, {"tags": ["haskell", "functor"], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": false, "score": 7, "last_activity_date": 1519577705, "last_edit_date": 1519577705, "creation_date": 1519544626, "answer_id": 48971346, "question_id": 48971234, "link": "https://stackoverflow.com/questions/48971234/how-can-fmap-be-used-with-a-data-constructor/48971346#48971346", "title": "How can fmap be used with a data constructor?", "body": "<p>What happened was <code>f</code> resolved to the functor <code>(-&gt;) a</code>, and <code>f1</code> to <code>Maybe</code>, since</p>\n\n<pre><code>Just :: (-&gt;) a (Maybe a)\n</code></pre>\n\n<p>So if we write the type of <code>fmap (fmap (+1))</code> with the above bindings we get:</p>\n\n<pre><code>fmap (fmap (+1)) :: Num b =&gt; (-&gt;) a (Maybe b) -&gt; (-&gt;) a (Maybe b)\n</code></pre>\n\n<p>Rewriting <code>(-&gt;)</code> as an infix constructor we get:</p>\n\n<pre><code>fmap (fmap (+1)) :: Num b =&gt; (a -&gt; Maybe b) -&gt; (a -&gt; Maybe b)\n</code></pre>\n\n<p>Now we apply this to <code>Just :: a -&gt; Maybe a</code> so we get</p>\n\n<pre><code>fmap (fmap (+1)) Just :: Num a =&gt; a -&gt; Maybe a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3785, "user_id": 469301, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/acf4cb434e477de76ee6e162c2863dfd?s=128&d=identicon&r=PG", "display_name": "Russell", "link": "https://stackoverflow.com/users/469301/russell"}, "edited": false, "score": 0, "creation_date": 1519583470, "post_id": 48972034, "comment_id": 84958822, "body": "The part in the last code snippet, where you spelled it out that the first fmap is (.) made it so clear to me. Thanks!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1519590115, "last_edit_date": 1519590115, "creation_date": 1519550467, "answer_id": 48972034, "question_id": 48971234, "link": "https://stackoverflow.com/questions/48971234/how-can-fmap-be-used-with-a-data-constructor/48972034#48972034", "title": "How can fmap be used with a data constructor?", "body": "<p>You write <code>Just 1</code> instead of <code>(Just 1)</code> so as a result, these are two separate parameters. We can now rewrite it in a more canonical form, like:</p>\n\n<pre><code>   (fmap . fmap) (+1) Just 1\n-&gt; (\\x -&gt; fmap (fmap x)) (+1) Just 1\n-&gt; ((fmap (fmap (+1)) Just) 1\n</code></pre>\n\n<p>So now we can analyze the types:</p>\n\n<pre><code>fmap<i>1</i> :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nfmap<i>2</i> :: Functor g =&gt; (c -&gt; d) -&gt; g c -&gt; g d\n(+1) :: Num h =&gt; h -&gt; h\nJust :: i -&gt; Maybe i\n1 :: Num j =&gt; j</code></pre>\n\n<p>Where <code>fmap<i>i</i></code> is the <em>i</em>-th <code>fmap</code> in the expression (if we read it left-to-right). If we know perform some analysis, we see that since we use <code>fmap (+1)</code>, we know that <code>c ~ d ~ h</code>:</p>\n\n<pre><code>fmap<i>1</i> :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\nfmap<i>2</i> :: Functor g =&gt; (h -&gt; h) -&gt; g h -&gt; g h\n(+1) :: Num h =&gt; h -&gt; h\nJust :: i -&gt; Maybe i\n1 :: Num j =&gt; j</code></pre>\n\n<p>We then see that the first <code>fmap</code> (<code>fmap<i>1</i></code>) is called with <code>fmap (+1) :: Functor g =&gt; g h -&gt; g h</code> as first argument, and <code>Just :: i -&gt; Maybe i</code> as second argument. So if we further perform type analysis we get: <code>(a -&gt; b) ~ g h -&gt; g h</code>, so <code>a ~ b ~ g h</code>, and we know that <code>f (g h) ~ i -&gt; Maybe i</code>, so that means that <code>f (g h) ~ (-&gt;) i (Maybe i)</code> so <code>f ~ (-&gt;) i</code> and <code>g ~ Maybe</code>, <code>h ~ i</code>, furthermore <code>i ~ j</code>:</p>\n\n<pre><code>fmap<i>1</i> :: (Maybe i -&gt; Maybe i) -&gt; (->) i (Maybe i) -&gt; (->) i Maybe i\nfmap<i>2</i> :: (i -&gt; i) -&gt; Maybe i -&gt; Maybe i\n(+1) :: Num h =&gt; i -&gt; i\nJust :: i -&gt; Maybe i\n1 :: Num i =&gt; i</code></pre>\n\n<p>Now a crucial aspect here is that <code>(-&gt;) r</code> is a functor as well, indeed in the <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/src/GHC.Base.html\" rel=\"nofollow noreferrer\"><code>base-4.10.1.0</code> source code</a> we see:</p>\n\n<blockquote>\n<pre><code>instance Functor ((-&gt;) r) where\n    fmap = (.)\n</code></pre>\n</blockquote>\n\n<p>We can here see a function as a functor, and if we perform an <code>fmap</code> we \"post process\" the result. So it means that <em>after</em> we apply <code>Just</code>, we apply <code>fmap (+1)</code> to that result. So the first <code>fmap</code> is equivalent to <code>(.)</code> whereas the second one is the <code>fmap</code> over <code>Maybe</code>, so as a result we get:</p>\n\n<pre><code>   ((fmap (fmap (+1)) Just) 1\n-&gt; (((.) (fmap (+1)) Just) 1\n-&gt; ((\\x -&gt; (fmap (+1) (Just x)) 1\n-&gt; fmap (+1) (Just 1)\n-&gt; Just 2\n</code></pre>\n\n<p>So in short we use the <code>(fmap (+1))</code> as a <em>post processing</em> step, <em>after</em> we apply <code>Just</code> to <code>1</code>.</p>\n"}], "owner": {"reputation": 3785, "user_id": 469301, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/acf4cb434e477de76ee6e162c2863dfd?s=128&d=identicon&r=PG", "display_name": "Russell", "link": "https://stackoverflow.com/users/469301/russell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 48972034, "answer_count": 2, "score": 6, "last_activity_date": 1519590115, "creation_date": 1519543532, "question_id": 48971234, "link": "https://stackoverflow.com/questions/48971234/how-can-fmap-be-used-with-a-data-constructor", "title": "How can fmap be used with a data constructor?", "body": "<p>I'm trying to understand some haskell code.</p>\n\n<p>This makes sense.</p>\n\n<pre><code>Prelude&gt; fmap (+1) (Just 1)\nJust 2\n</code></pre>\n\n<p>This also makes sense.</p>\n\n<pre><code>Prelude&gt; (fmap.fmap) (+1) (Just [1])\nJust [2]\n</code></pre>\n\n<p>But I don't understand how this works.</p>\n\n<pre><code>Prelude&gt; (fmap.fmap) (+1) Just 1\nJust 2\n</code></pre>\n\n<p>I've tried working the parts out. It seems to me that this is what's happening.</p>\n\n<pre><code>(fmap (fmap (+1)) Just) 1\n</code></pre>\n\n<p>I tried typing the subexpressions.</p>\n\n<p>This makes sense.</p>\n\n<pre><code>Prelude&gt; :t fmap (+1)\nfmap (+1) :: (Functor f, Num b) =&gt; f b -&gt; f b\n</code></pre>\n\n<p>This still makes sense.</p>\n\n<pre><code>Prelude&gt; :t fmap (fmap (+1))\nfmap (fmap (+1)) :: (Functor f, Functor f1, Num b) =&gt;\n    f (f1 b) -&gt; f (f1 b)\n</code></pre>\n\n<p>But I don't understand this.</p>\n\n<pre><code>Prelude&gt; :t fmap (fmap (+1)) Just\nfmap (fmap (+1)) Just :: Num b =&gt; b -&gt; Maybe b\n</code></pre>\n\n<p>How did a function with type</p>\n\n<pre><code>(Functor f, Functor f1, Num b) =&gt; f (f1 b) -&gt; f (f1 b)\n</code></pre>\n\n<p>after applying <code>Just</code> which has type:</p>\n\n<pre><code>a -&gt; Maybe a\n</code></pre>\n\n<p>result in this type?</p>\n\n<pre><code>Num b =&gt; b -&gt; Maybe b\n</code></pre>\n\n<p>The question <a href=\"https://stackoverflow.com/questions/10294272/confused-about-function-as-instance-of-functor-in-haskell\">confused about function as instance of Functor in haskell</a> might have something to do with this, but I still am confused.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 7342409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcc1e8a6e80f994773663f4efba4c2b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arthur Champs", "link": "https://stackoverflow.com/users/7342409/arthur-champs"}, "edited": false, "score": 0, "creation_date": 1519535574, "post_id": 48970408, "comment_id": 84946266, "body": "Thank you so much for your answer @sepp2k. It is very helpful to have these small details in mind from the get go. :)"}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 10, "last_activity_date": 1519535363, "creation_date": 1519535363, "answer_id": 48970408, "question_id": 48970363, "link": "https://stackoverflow.com/questions/48970363/non-parenthesized-parameters-led-to-an-endless-recursive-call/48970408#48970408", "title": "Non parenthesized parameters led to an endless recursive call", "body": "<p>It's not ignored, it just has a different precedence than you expect. <code>f x + 1</code> is equivalent to <code>(f x) + 1</code>, so instead of adding 1 to x and applying f to that, it adds 1 to the result of <code>f x</code>. But since <code>f x</code> loops infinitely in your case, it never gets to that part.</p>\n\n<p>This isn't a property of functional programming so much as the precedence rules of Haskell (and other languages with ML-like syntax).</p>\n"}], "owner": {"reputation": 77, "user_id": 7342409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcc1e8a6e80f994773663f4efba4c2b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arthur Champs", "link": "https://stackoverflow.com/users/7342409/arthur-champs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 48970408, "answer_count": 1, "score": 1, "last_activity_date": 1519554806, "creation_date": 1519534850, "last_edit_date": 1519554806, "question_id": 48970363, "link": "https://stackoverflow.com/questions/48970363/non-parenthesized-parameters-led-to-an-endless-recursive-call", "title": "Non parenthesized parameters led to an endless recursive call", "body": "<p>I'm learning how to use Haskell and I came across a roadblock which took me a while to overcome. It had to do with a recursive call on a function that calculates the Integer square root of any given Nat. </p>\n\n<p>My question isn't about the code itself but on Haskell's behavior when it comes to taking parameters for recursive calls (or regular function calls).</p>\n\n<p>This was my original code:</p>\n\n<pre><code>raizAux2 :: Int -&gt; Int -&gt; Int\nraizAux2 n i = \n    if i^2 &gt; n \n      then i-1\n    else raizAux2 n i+1\n</code></pre>\n\n<p>Which looped forever becase Haskell ignored the i+1 call as it only took the \"i\" argument, ignoring the \"+1\" part altogether, leaving the function looping indefinitely. The solution was to parenthesize (i+1).</p>\n\n<p>[<strong>Edit</strong>: Thanks to @sepp2k's reply, now I understand nothing gets <em>ignored</em>, it just gets interpreted according to the language inherent rules of precedence.]</p>\n\n<pre><code>raizAux2 :: Int -&gt; Int -&gt; Int\nraizAux2 n i = \n    if i^2 &gt; n \n      then i-1\n    else raizAux2 n (i+1)\n</code></pre>\n\n<p>So my question is (and I know it might be really dumb to ask): Is this behavior inherent to functional programming? Why did Haskell decide to <em>ignore</em> the \"+1\" part and just take the \"i\"? And finally, what happens to the ignored parts of any given parameter. Are they disposed of immediately?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": true, "score": 6, "last_activity_date": 1519524538, "creation_date": 1519524538, "answer_id": 48969573, "question_id": 48969478, "link": "https://stackoverflow.com/questions/48969478/record-syntax-parse-error-on-input/48969573#48969573", "title": "Record syntax `parse error on input \u2018=\u2019`", "body": "<p>The advice you're getting in the compile error is mostly irrelevant, because the parser really has no idea what you're trying to do here. Record syntax uses curly braces <code>{</code> and <code>}</code>, not <code>[</code> and <code>]</code>. So it should look like:</p>\n\n<pre><code>let expectedUser = User {authorized = true, ident = \"AdminUser\", displayName = Nothing, id = 1, avatar = Nothing}\n</code></pre>\n\n<p>and I would suggest some line breaks :)</p>\n\n<pre><code>let expectedUser = User { authorized = true\n                        , ident = \"AdminUser\"\n                        , displayName = Nothing\n                        , id = 1\n                        , avatar = Nothing\n                        }\n</code></pre>\n"}], "owner": {"reputation": 3502, "user_id": 2558108, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DUiG3.jpg?s=128&g=1", "display_name": "Qwertie", "link": "https://stackoverflow.com/users/2558108/qwertie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 48969573, "answer_count": 1, "score": 0, "last_activity_date": 1519524538, "creation_date": 1519523308, "last_edit_date": 1519524250, "question_id": 48969478, "link": "https://stackoverflow.com/questions/48969478/record-syntax-parse-error-on-input", "title": "Record syntax `parse error on input \u2018=\u2019`", "body": "<p>I have a do block in my Yesod tests and I want to be test the response with an expected response.</p>\n\n<p>I attempted to create an expected response in this do block</p>\n\n<pre><code>let expectedUser = User [authorized = true, ident = \"AdminUser\", displayName = Nothing, id = 1, avatar = Nothing]\n</code></pre>\n\n<p>On this line I get the error</p>\n\n<pre><code>parse error on input \u2018=\u2019\nPerhaps you need a 'let' in a 'do' block?\n</code></pre>\n\n<p>on the = after <code>authorized</code>. How would I rewrite this line so that it would work inside a do block?</p>\n"}, {"tags": ["haskell", "typeclass", "type-kinds", "constraint-kinds"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519514666, "post_id": 48968573, "comment_id": 84942889, "body": "Closely related: <a href=\"https://stackoverflow.com/q/29509786/2751851\"><i>What is Constraint in kind signature</i></a>; <a href=\"https://stackoverflow.com/q/41121107/2751851\"><i>What does has kind &#39;Constraint&#39; mean in Haskell</i></a> (note the <a href=\"https://stackoverflow.com/a/41123141/2751851\">second answer</a> addresses your question more directly than the accepted one)."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519514782, "post_id": 48968573, "comment_id": 84942909, "body": "(I haven&#39;t closed as a duplicate myself because I&#39;m not sure about which of the three questions would make for a better duplicate target, and also because your &quot;Why can I ask for higher kinded type on typeclass?&quot; might be hinting at a somewhat more general question. That being so, I will leave it up to you and/or the other readers to decide.)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1520218074, "post_id": 48968573, "comment_id": 85210729, "body": "I went ahead and closed this question as a duplicate. Is there any part of it that you feel the linked questions do not cover?"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "closed_date": 1520217906, "answer_count": 0, "score": 0, "last_activity_date": 1519515185, "creation_date": 1519513655, "last_edit_date": 1519515185, "question_id": 48968573, "link": "https://stackoverflow.com/questions/48968573/higher-kinded-type-on-typeclass", "closed_reason": "Duplicate", "title": "Higher kinded type on typeclass?", "body": "<p>To find out, if a type is a higher kinded type ghci provide: </p>\n\n<pre><code>Prelude&gt; :k Maybe\nMaybe :: * -&gt; *\n</code></pre>\n\n<p>And tried on typeclass like:  </p>\n\n<pre><code>Prelude&gt; :k Functor\nFunctor :: (* -&gt; *) -&gt; Constraint\n</code></pre>\n\n<p>Why can I ask for higher kinded type on typeclass? What does <strong>constraint</strong> mean?</p>\n"}, {"tags": ["haskell", "command-line", "documentation", "hoogle"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1519512667, "post_id": 48966779, "comment_id": 84942458, "body": "@NeilMitchell  (does this work?)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1519516925, "post_id": 48966779, "comment_id": 84943327, "body": "@luqui Unfortunately not..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1519521355, "post_id": 48966779, "comment_id": 84944153, "body": "I have moved <a href=\"https://stackoverflow.com/a/48969298/2751851\">my answer</a> to the question I closed yours against."}], "owner": {"reputation": 918, "user_id": 656298, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ce9d3d08cd1b2486c0ed1a4fbf82dd85?s=128&d=identicon&r=PG", "display_name": "Zach", "link": "https://stackoverflow.com/users/656298/zach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "closed_date": 1519521387, "answer_count": 0, "score": 3, "last_activity_date": 1519516977, "creation_date": 1519500615, "last_edit_date": 1519516977, "question_id": 48966779, "link": "https://stackoverflow.com/questions/48966779/function-lookup-on-hoogle-cli-doesnt-show-function-descriptions", "closed_reason": "Duplicate", "title": "Function lookup on Hoogle CLI doesn&#39;t show function descriptions", "body": "<p>When I search for <code>nub</code> on haskell.org/hoogle, it returns a list of matching functions along with helpful descriptions, such as \"The nub function removes duplicate elements from a list\". Is there any way to get this functionality from the Hoogle CLI?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519501966, "post_id": 48966093, "comment_id": 84939595, "body": "Surely this could be ameliorated with an extra constraint. Import <code>Data.Constraint Forall</code>, define <code>type UnboxF a s = MArray (STUArray s) a (ST s)</code>, <code>class UnboxF a s =&gt; UnboxC a s</code>, <code>instance UnboxF a s =&gt; UnboxC a s</code>, add a constraint <code>Forall (UnboxC a)</code> to the function and use <code>inst</code> as needed."}, {"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519526558, "post_id": 48966093, "comment_id": 84944932, "body": "@dfeuer I find this comment very hard to understand. Specifically, what is this <code>inst</code> you refer to?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519528607, "post_id": 48966093, "comment_id": 84945215, "body": "See my answer for more details."}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 6, "last_activity_date": 1519496101, "creation_date": 1519496101, "answer_id": 48966093, "question_id": 48965848, "link": "https://stackoverflow.com/questions/48965848/stuarray-type-parameter-in-an-in-place-polymorphic-quicksort/48966093#48966093", "title": "STUArray type parameter in an in-place polymorphic quicksort", "body": "<p>You could make it through to the next error by enabling <code>ScopedTypeVariables</code> and <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#ghc-flag--XScopedTypeVariables\" rel=\"noreferrer\">supplying an explicit <code>forall</code></a> in the top level type signature:</p>\n\n<pre><code>quicksort :: forall a. IArray UArray a =&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>You will then discover that your <code>STUArray</code> is not an instance of <code>MArray</code>, because there is <a href=\"https://hackage.haskell.org/package/array-0.5.2.0/docs/Data-Array-ST.html#t:STUArray\" rel=\"noreferrer\">no instance</a> for arbitrary <code>a</code>. If you make it an <code>Int</code>, it will compile.</p>\n\n<p>And the reason for the conspicuous absence of such an instance is, of course, that an <em>unboxed</em> array can only contain an <em>unboxeable</em> value, which would be a value of a <em>primitive</em> type, an exhaustive roster of which you may review in <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/ghc-prim-0.5.1.1/GHC-Prim.html\" rel=\"noreferrer\">the relevant documentation</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1519760431, "last_edit_date": 1519760431, "creation_date": 1519528581, "answer_id": 48969880, "question_id": 48965848, "link": "https://stackoverflow.com/questions/48965848/stuarray-type-parameter-in-an-in-place-polymorphic-quicksort/48969880#48969880", "title": "STUArray type parameter in an in-place polymorphic quicksort", "body": "<p>You can use <code>Data.Constraint.Forall</code> to make this work for anything unboxable. It may not be the most efficient, though, because of the way that mechanism works. A more annoying but probably better way would be to write an <code>MArray</code>-like class taking a constructor that expects an <code>s</code> argument.</p>\n\n<pre><code>{-# Language MultiParamTypeClasses, ScopedTypeVariables, ConstraintKinds,\n  FlexibleInstances, FlexibleContexts, UndecidableInstances, TypeOperators #-}\nmodule QS where\n\nimport Control.Monad.ST (ST, runST)\nimport Data.Constraint (Dict (..), (:-) (..))\nimport Data.Constraint.Forall (Forall, inst)\nimport Data.Array.ST (runSTUArray, newListArray, STUArray, MArray)\nimport Data.Array.IArray (elems)\nimport Data.Array.Unboxed (UArray, IArray)\n\ntype UnboxF a s = MArray (STUArray s) a (ST s)\n\nclass UnboxF a s =&gt; UnboxC a s\ninstance UnboxF a s =&gt; UnboxC a s\n\nmarrayDict :: Forall (UnboxC a) =&gt; Dict (UnboxC a s)\nmarrayDict = case inst :: Forall (UnboxC a) :- UnboxC a s of\n               Sub x -&gt; x\n\nquicksort :: forall a. (IArray UArray a, Forall (UnboxC a)) =&gt; [a] -&gt; [a]\nquicksort l = elems $ runSTUArray\n  ( case marrayDict :: Dict (UnboxC a s) of { Dict -&gt;\n      do\n        newListArray (0,9) l\n    } :: forall s. ST s (STUArray s Int a))\n\ntest :: [Char] -&gt; [Char]\ntest = quicksort\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 7260011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58d710b193c2c9907cffc15995143dc2?s=128&d=identicon&r=PG&f=1", "display_name": "neo2500", "link": "https://stackoverflow.com/users/7260011/neo2500"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 48966093, "answer_count": 2, "score": 2, "last_activity_date": 1519760431, "creation_date": 1519494679, "last_edit_date": 1519496740, "question_id": 48965848, "link": "https://stackoverflow.com/questions/48965848/stuarray-type-parameter-in-an-in-place-polymorphic-quicksort", "title": "STUArray type parameter in an in-place polymorphic quicksort", "body": "<p>I want to implement a polymorphic quicksort. I would like to specify that\ntype a in  <code>IArray UArray a =&gt; [a] -&gt; [a]</code> and <code>ST s (STUArray s Int a)</code> are the same type. How can I do that ?</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nmodule Quicksort where\n\nimport Control.Monad.ST (ST)\nimport Data.Array.ST (runSTUArray, newListArray, STUArray)\nimport Data.Array.IArray (elems)\nimport Data.Array.Unboxed (UArray, IArray)\n\nquicksort :: IArray UArray a =&gt; [a] -&gt; [a]\nquicksort l = elems $ runSTUArray $\n  do newListArray (0, 9) l :: ST s (STUArray s Int a)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1519491987, "post_id": 48965109, "comment_id": 84936557, "body": "Why is the last thing &quot;one step further&quot;? It looks to me like a solution to the previous bits would <i>already</i> be a solution to the last thing; it is &quot;one fewer steps&quot;."}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519772538, "post_id": 48965109, "comment_id": 85043939, "body": "@DanielWagner I&#39;d think there is an isomorphism between them such that <code>fn (foo, bar) baz</code> can be rewritten to become <code>fn2 (to foo, to bar) baz</code>, and <code>fn2 (_1, _2._2) qux</code> can be rewritten to become <code>fn2 (view _1, view $ _2._2) qux</code>. I thought that maybe the version that operates on regular functions may be easier and simpler to implement than the version that operates with lens getters. Hence I considered the lens version &#39;one step further&#39;. I&#39;m interested in either variant."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1519494146, "post_id": 48965419, "comment_id": 84937227, "body": "Perhaps it could be doable with a drop of Template Haskell, or some kind of Typeable magic?"}, {"owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 0, "creation_date": 1519499592, "post_id": 48965419, "comment_id": 84938907, "body": "@DanielWagner I think I would be okay with that. I&#39;m aware that many (most? all?) packages implement n-tuple support via typeclasses. I was just wondering if what I am asking might already exist somewhere implemented. And if not I might try to take a shot at it. I also was wondering if <code>Generics</code> could help in any way by allowing the tuples to be treated as a generic product type, although to this day I have very limited experience in that direction."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "edited": false, "score": 1, "creation_date": 1519501226, "post_id": 48965419, "comment_id": 84939403, "body": "@Wizek, generics can almost certainly do the trick for fairly short tuples, but I think you&#39;ll run out of <code>Generic</code> instances at around 7-tuples. So you&#39;ll likely end up writing at least as much code to make generics work as you would to just write all the instances by hand. It&#39;s rather unfortunate, to be sure. As @IgnatInsarov suggests, Template Haskell can surely write all 63 instances, but I don&#39;t know TH myself yet."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1519492133, "creation_date": 1519492133, "answer_id": 48965419, "question_id": 48965109, "link": "https://stackoverflow.com/questions/48965109/does-anyone-know-of-a-polymorphic-haskell-function-that-can-do-fn2-1-2-2/48965419#48965419", "title": "Does anyone know of a polymorphic Haskell function that can do `fn2 (_1, _2._2) (3, (4, 5)) == (3, 5)` or similar?", "body": "<p>No, it is not really possible.</p>\n\n<p>The closest you can get is to write a typeclass and give it one instance for each size of tuple up to 63-tuples; this is practically speaking \"arbitrary length tuples\" since GHC doesn't support longer ones. Indeed, in practice, most libraries that do similar things define instances up to 7-tuples or so and call it \"practically arbitrary length tuples\" since it is so rare to use tuples longer than that anyway.</p>\n"}], "owner": {"reputation": 4538, "user_id": 499478, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/791526e67831fbd70e3d179a6c585b44?s=128&d=identicon&r=PG", "display_name": "Wizek", "link": "https://stackoverflow.com/users/499478/wizek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1519492133, "creation_date": 1519490356, "last_edit_date": 1519491331, "question_id": 48965109, "link": "https://stackoverflow.com/questions/48965109/does-anyone-know-of-a-polymorphic-haskell-function-that-can-do-fn2-1-2-2", "title": "Does anyone know of a polymorphic Haskell function that can do `fn2 (_1, _2._2) (3, (4, 5)) == (3, 5)` or similar?", "body": "<p>Does anyone know of a polymorphic function that can do the following?</p>\n\n<pre><code>fn :: (a -&gt; b, a -&gt; c)         -&gt; a -&gt; (b, c)\nfn :: (a -&gt; b, a -&gt; c, a -&gt; d) -&gt; a -&gt; (b, c, d)\n-- etc, supporting arbitrary length tuples.\n</code></pre>\n\n<p>I know I can do </p>\n\n<pre><code>((,,) &lt;$&gt; foo &lt;*&gt; bar &lt;*&gt; qux) baz\n(liftA3 (,,) foo bar qux) baz\n</code></pre>\n\n<p>And I am wondering if I could somehow also do</p>\n\n<pre><code>fn (foo, bar) baz\nfn (foo, bar, qux) baz\n</code></pre>\n\n<p>It's okay if the answer relies on the <code>lens</code> package.</p>\n\n<p>And if it does, maybe it can be taken one step further allowing the following as well:</p>\n\n<pre><code>fn2 (_1, _2._2) (3, (4, 5)) == (3, 5)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 0, "creation_date": 1519472339, "post_id": 48962321, "comment_id": 84930770, "body": "By insertion do you mean a function which mutates its arguments? If so, you aren&#39;t thinking functionality."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 4, "creation_date": 1519472463, "post_id": 48962321, "comment_id": 84930806, "body": "@JohnColeman Disagree, the function he is proposing returns a new dictionary. Seems pretty functional to me."}, {"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1519472816, "post_id": 48962321, "comment_id": 84930891, "body": "@danidiaz How do you disagree with a question? I just wanted OP to clarify their intention. The last sentence in their question about discarding the previous dictionary led me to wonder if they were hoping to modify it instead."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 0, "creation_date": 1519473659, "post_id": 48962321, "comment_id": 84931096, "body": "@JohnColeman I interpreted the last sentence to mean that the information carried by the old dictionary was being ignored when defining the new one."}, {"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1519473780, "post_id": 48962321, "comment_id": 84931132, "body": "@danidiaz I think that you interpreted them correctly. Your answer cleared things up for me."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1519524524, "post_id": 48962321, "comment_id": 84944612, "body": "This won&#39;t help directly, but I generally recommend that newcomers avoid writing type synonyms (like your <code>Dict</code>), and that experienced Haskell programmers use them in strict moderation. They tend to be more confusing and less valuable than you&#39;d expect. I suggest you instead try <code>newtype Dict a b = Dict { unDict :: a -&gt; b }</code>. This will require you to wrap and unwrap dictionaries when implementing the basic functions, but you&#39;ll be able to make <code>Dict</code> an abstract datatype by keeping the constructor private to the module, and you&#39;ll make it very clear which functions represent dictionaries."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 8, "creation_date": 1519474776, "post_id": 48962573, "comment_id": 84931405, "body": "Writing it as <code>insertDict k v dict = \\k&#39; -&gt; if k == k&#39; then Just v else dict k&#39;</code> might make it clearer."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1519490703, "post_id": 48962573, "comment_id": 84936175, "body": "Also, the reason for making the dict the last argument of the function is to allow chaining via composition: <code>insertDict &#39;b&#39; 2 . insertDict &#39;a&#39; 1 . emptyDict $ &#39;a&#39;</code>."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 17, "last_activity_date": 1519480020, "last_edit_date": 1519480020, "creation_date": 1519473393, "answer_id": 48962573, "question_id": 48962321, "link": "https://stackoverflow.com/questions/48962321/functions-as-types-in-haskell/48962573#48962573", "title": "Functions as types in haskell", "body": "<p>You can use a \"chain of responsibility\" pattern: the insert function checks if the argument to the <em>result</em> <code>Dict</code> matches with its own key, otherwise it delegates on the previous <code>Dict</code> which received as argument.</p>\n\n<pre><code>type Dict a b = a -&gt; Maybe b\n\ninsertDict :: (Eq a) =&gt; a -&gt; b -&gt; Dict a b -&gt; Dict a b\n-- Note that the k' is the argument of the result dict function\ninsertDict k v dict k' = if k == k' then Just v else dict k'\n\nemptyDict :: Dict a b\nemptyDict _ = Nothing\n</code></pre>\n\n<p>Some examples in ghci:</p>\n\n<pre><code>\u039b insertDict 'a' (1::Int) emptyDict $ 'a'\nJust 1\n\u039b insertDict 'b' 2 (insertDict 'a' (1::Int) emptyDict) $ 'a'\nJust 1\n\u039b insertDict 'b' 2 (insertDict 'a' (1::Int) emptyDict) $ 'x'\nNothing\n</code></pre>\n\n<p>Representing maps as functions is good as a first approximation, but this representation has a number of drawbacks:</p>\n\n<ul>\n<li>The complexity of searching for a value is linear in the number of keys.</li>\n<li>Functions are pretty \"opaque\", which means you can't inspect or serialize the map as you could do if you had used a <a href=\"http://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Strict.html\" rel=\"noreferrer\">data type</a>.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 11, "last_activity_date": 1519484453, "creation_date": 1519484453, "answer_id": 48964205, "question_id": 48962321, "link": "https://stackoverflow.com/questions/48962321/functions-as-types-in-haskell/48964205#48964205", "title": "Functions as types in haskell", "body": "<p>Here\u2019s one method you can use to help write such functions yourself. First, write the type signature:</p>\n\n<pre><code>insertDict :: (Eq k) =&gt; k -&gt; v -&gt; Dict k v -&gt; Dict k v\n</code></pre>\n\n<p>I\u2019ve used <code>k</code> and <code>v</code> for \u201ckey\u201d and \u201cvalue\u201d here for clarity. Next, start by writing the implementation as a <em>hole</em>:</p>\n\n<pre><code>insertDict key value dict\n  = _\n</code></pre>\n\n<p>The compiler (or GHCi) should give you a message like \u201cFound hole: <code>_ :: Dict k v</code> [\u2026] Relevant bindings include: <code>dict :: Dict k v</code>, <code>value :: v</code>, <code>key :: k</code>. So here you see that you <em>could</em> just return <code>dict</code> because the type matches, but that would ignore <code>key</code> and <code>value</code>.</p>\n\n<p>Since you know that <code>Dict k v</code> is a function type, you can make progress by adding a lambda with another hole to see what the compiler offers:</p>\n\n<pre><code>insertDict key value dict\n  = \\ key' -&gt; _\n</code></pre>\n\n<p>Now we have <code>_ :: Maybe v</code>, <code>value :: v</code>, <code>key' :: k</code>, <code>key' :: k</code>, <code>dict :: Dict k v</code>. We could always return <code>Just value</code>, but as you observed, that doesn\u2019t do what we want\u2014it represents a dictionary that always answers \u201cYes, that key is in the dictionary and its value is <code>value</code>\u201d for any key you ask about! (That is a useful thing to be able to represent, it\u2019s just not the thing we\u2019re writing.)</p>\n\n<p>So it doesn\u2019t look like we can make progress with just these\u2014but wait, we also have an <code>Eq k</code> constraint! And the only two things we can compare are <code>key</code> and <code>key'</code>, so let\u2019s expand this into an <code>if</code> using <code>==</code>:</p>\n\n<pre><code>insertDict key value dict\n  = \\ key' -&gt; if key == key' then _1 else _2\n</code></pre>\n\n<p>Now the compiler reports <code>_1 :: Maybe v</code> and <code>_2 :: Maybe v</code>. What should we return in each of these cases? Let\u2019s consider some examples of how this function is actually used\u2014if you look up a key in a dictionary after inserting a key-value pair, you should of course find the value:</p>\n\n<pre><code>(insertDict key value dict) key == Just value\n                                   ----------\n</code></pre>\n\n<p>So for <code>_1</code> we can write <code>Just value</code>:</p>\n\n<pre><code>insertDict key value dict\n  = \\ key' -&gt; if key == key' then Just value else _2\n                                  ----------\n</code></pre>\n\n<p>If you look up a <em>different</em> key than the one you just inserted, then the most recently inserted key-value pair doesn\u2019t matter; it should look up the key further on in the dictionary:</p>\n\n<pre><code>(insertDict key value dict) key' == dict key'  -- If key /= key'\n                                    ---------\n</code></pre>\n\n<p>So for <code>_2</code> we can write <code>dict key'</code>:</p>\n\n<pre><code>insertDict key value dict\n  = \\ key' -&gt; if key == key' then Just value else dict key'\n                                                  ---------\n</code></pre>\n\n<p>And we\u2019re done! :D</p>\n\n<p>This combination of <em>type-directed programming</em> and <em>equational reasoning</em> is very helpful when writing in Haskell, especially for polymorphic functions like this that have a limited number of possible (sane) implementations.</p>\n"}], "owner": {"reputation": 411, "user_id": 7235699, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/x7sjr.jpg?s=128&g=1", "display_name": "user7235699", "link": "https://stackoverflow.com/users/7235699/user7235699"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1636, "favorite_count": 0, "answer_count": 2, "score": 10, "last_activity_date": 1519484453, "creation_date": 1519471695, "last_edit_date": 1519479850, "question_id": 48962321, "link": "https://stackoverflow.com/questions/48962321/functions-as-types-in-haskell", "title": "Functions as types in haskell", "body": "<p>I have confusion using types which are functions.</p>\n\n<p>Let say I want to implement a dictionary, which when given a and b returns Maybe b.</p>\n\n<pre><code>type Dict a b = a-&gt;Maybe b\n</code></pre>\n\n<p><strong>How can I implement an insertion function for this dictionary?</strong></p>\n\n<pre><code>insertDict :: (Eq a) =&gt; a -&gt; b -&gt; (Dict a b)-&gt; (Dict a b)\n</code></pre>\n\n<p>I have come up with the following thing</p>\n\n<pre><code>insertDict x y mydict = \\a-&gt;Just y\n</code></pre>\n\n<p>but it is not correct and will discard the previous dictionary.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519477770, "post_id": 48962071, "comment_id": 84932195, "body": "And what is your question?"}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "reply_to_user": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "edited": false, "score": 1, "creation_date": 1519568757, "post_id": 48965753, "comment_id": 84953914, "body": "@AlexiaDesouza If you wish to contact me personally, there&#39;s an email in the profile. Otherwise, post a question and someone will answer."}], "tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": true, "score": 3, "last_activity_date": 1519526055, "last_edit_date": 1519526055, "creation_date": 1519494062, "answer_id": 48965753, "question_id": 48962071, "link": "https://stackoverflow.com/questions/48962071/how-to-display-the-data-from-the-list-as-tabular-form/48965753#48965753", "title": "How to display the data from the list as tabular form", "body": "<p>This is actually quite hard. You will have to solve two problems:</p>\n\n<ol>\n<li><p>How to transform the input so that duplicate fields in consecutive rows are replaced with blank\nspace.</p></li>\n<li><p>How to print the result in nice columns.</p></li>\n</ol>\n\n<p>Let us discuss these problems one by one.</p>\n\n<ol>\n<li><p>Transform the input. </p>\n\n<p>What do we have to do? If there are duplicate values in consecutive cells along any given\ncolumn, we would like to replace all of them, except the first, with blank space. So, we may do\nlike this:</p>\n\n<ol>\n<li><p>Analyze each column as a list.</p></li>\n<li><p>If there are duplicate values, keep only the first one and replace all others with blank\nspace.</p></li>\n<li><p>The tricky moment is that, if the first column's value changes, we would like to stop\nblanking cells and print at least one row in full. To ensure this, we may break the table in\nsections so that for each possible value of the first column, there is one section.</p></li>\n</ol>\n\n<p>How do we accomplish this? My take:</p>\n\n<pre><code>-- First, I'd like to define some type synonyms to make type signatures more\n-- intuitive.\n\ntype Row = [String]\n\ntype Table = [Row]\n\n-- It would be easier to deal with a row represented as a list, rather than a\n-- tuple.\n\ntupleToList :: (String, String, String, String) -&gt; Row\ntupleToList (a, b, c, d) = [a, b, c, d]\n\n-- With some handy library functions, we can convert our input to Rows and\n-- section it by teacher's name in one pass:\n\ntest' :: [Table]\ntest' = groupBy equalFirstColumn . map tupleToList $ test\n  where\n    equalFirstColumn = ((==) `on` head)\n\n-- Now, we have to blank the repeating values. If the columns were lists, we\n-- would do it like this:\n\nblankRepetitions :: [String] -&gt; [String]\nblankRepetitions (x:xs) = x: replicate (length bef) \"\" ++ blankRepetitions aft\n    where (bef, aft) = span (== x) xs\nblankRepetitions [ ] = [ ]\n\n-- Luckily, there is a library function that can turn columns to rows and vice\n-- versa. Let's use it.\n\ntest'' :: [Table]\ntest'' = map (transpose . map blankRepetitions . transpose) test'\n\n-- Now we can turn our groups back into a single table. Why not add a row with\n-- column captions as well.\n\ntest3 :: Table\ntest3 = [\"Teacher\", \"Subject\", \"Class\", \"ExtraClass\"] : concat test''\n</code></pre>\n\n<p>Take some time to study this and see if it works as expected. I have a lingering suspicion that\nthe way I deal with blanking has some flaws to it...</p></li>\n<li><p>Print the result.</p>\n\n<p>By far the simplest way to obtain a nice looking table is simply to pad every cell with spaces\nso that every cell has the same width:</p>\n\n<pre><code>pad :: Int -&gt; String -&gt; String\npad w s = \" \" ++ s ++ (replicate (w - length s) ' ')\n</code></pre>\n\n<p>But what width to choose? The width of the longest cell seems like a nice choice. So, we can go\nlike that:</p>\n\n<pre><code>columnize :: Table -&gt; String\ncolumnize xss = unlines . map concat . (map.map) (pad maxwidth) $ xss\n    where maxwidth = maximum . map length . concat $ xss\n</code></pre>\n\n<p>Notice how <code>map.map</code> processes a list of lists in the same way as a single <code>map</code> would process\na plain one.</p></li>\n</ol>\n\n<hr>\n\n<p>That's it! See how it's easy to deal with a complicated problem once you turn it into a few\nsmaller ones.</p>\n"}], "owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 48965753, "answer_count": 1, "score": -2, "last_activity_date": 1519526055, "creation_date": 1519469960, "last_edit_date": 1519485521, "question_id": 48962071, "link": "https://stackoverflow.com/questions/48962071/how-to-display-the-data-from-the-list-as-tabular-form", "title": "How to display the data from the list as tabular form", "body": "<p>--[(Teacher,subject,class,extrasub)]</p>\n\n<pre><code>test =[(\"Sam\",\"Maths\",\"Std5\",\"PE\"),\n       (\"Sam\",\"Maths\",\"Std7\",\"PE\"),\n       (\"Sam\",\"geography\",\"Std6\",\"PE\"),\n       (\"Jake\",\"English\",\"Std9\",\"Red Cross\"),\n       (\"Jake\",\"English\",\"Std9\",\"Guards\")]\n</code></pre>\n\n<p>It should look like this</p>\n\n<pre><code>    Teacher         Subject     Class   ExtraClass\n    Sam             Maths       Std5    PE\n                                Std7\n                    Geography   Std6\n    Jake            English     Std9    Red Cross\n                                        Guards\n</code></pre>\n\n<p>i want the output to be like this</p>\n\n<pre><code>[\n(\"Jake\",\"English\",\"Std9\",\"Red Cross\"),\n(\"\",\"\",\"\",\"Guards\"),\n(\"Sam\",\"Maths\",\"Std7\",\"PE\"),\n(\"\",\"\",\"Std5\",\"\"),\n(\"\",\"geography\",\"Std6\",\"PE\")]\n\n\n\ntest2 :: [([Char], [Char], [Char], [Char])]\ntest2 = test3 $ concat $ groupBy (\\(x,_,_,_) (y,_,_,_) -&gt; x==y) (sort test1)\n\ntest3 [] = []\ntest3 [x] = []\n\ntest3 ((a1,b1,c1,d1):(a2,b2,c2,d2):xs) =\n                                        if(a1==a2 &amp;&amp; b1== b2&amp;&amp; d1==d2)\n                                            then [(\"\",\"\",c1,d1)]\n                                         else if (a1==a2)\n                                            then [(\"\",\"\",c1,d1)]\n                                         else [(\"\",b1,c1,d1)]\n</code></pre>\n\n<p>i was thinking of this approach using foldl' but couldnt get it. any suggestion on how to go about on this</p>\n"}, {"tags": ["list", "haskell", "monads", "do-notation"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1519462793, "post_id": 48960899, "comment_id": 84928433, "body": "because - the list monad also has a <code>(&gt;&gt;=) = concatMap</code> bind operation which you use implicitly with <code>(&lt;-)</code>. It is best you try to de-sugar the do notation yourself and see how far you get. The gist is that you in each <code>x &lt;- a</code> you bind each <i>element</i> of the monad and not the whole list."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519464457, "post_id": 48960899, "comment_id": 84928792, "body": "Do you understand how bind works?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519464827, "post_id": 48960899, "comment_id": 84928885, "body": "Because the <code>return</code> has as argument <code>(x, y)</code>, so it produces <code>[(x,y)]</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1519490938, "post_id": 48960899, "comment_id": 84936247, "body": "<code>pairs = return</code> would provide your expected value. <code>&lt;-</code> is <i>not</i> just assignment; it&#39;s more of an <i>extraction</i> operator."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1519508363, "post_id": 48960899, "comment_id": 84941314, "body": "@chepner (you meant <code>pairs = curry return</code>.)"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1519621396, "post_id": 48960899, "comment_id": 84968493, "body": "Because <code>do</code> notation doesn&#39;t do what you think it does. It doesn&#39;t just run things in order."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1519657682, "post_id": 48960899, "comment_id": 84987724, "body": "@WillNess Apparently :)"}], "answers": [{"comments": [{"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1519540864, "post_id": 48961711, "comment_id": 84947176, "body": "Thanks for spelling it out. My confusion was that &lt;- is not just an assignment, and in fact for the List monad involves mapping over following operations. I think your answer would be improved greatly by skipping over concatMap and using concat and map directly, as that&#39;s an extra level of abstraction someone struggling with this will have to deal with."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1519467484, "creation_date": 1519467484, "answer_id": 48961711, "question_id": 48960899, "link": "https://stackoverflow.com/questions/48960899/how-does-the-list-monad-work-in-this-example/48961711#48961711", "title": "How does the List monad work in this example?", "body": "<p>Let us first analyze and rewrite the function <code>pairs</code>:</p>\n\n<pre><code>pairs a b = do { x &lt;- a; y &lt;- b; return (x, y)}\n</code></pre>\n\n<p>Here we thus have a monad. We use <code>do</code> as syntactical sugar. But the compiler rewrites this to:</p>\n\n<pre><code>pairs a b = a &gt;&gt;= (\\x -&gt; b &gt;&gt;= (\\y -&gt; return (x, y)))\n</code></pre>\n\n<p>Or in a more canonical form:</p>\n\n<pre><code>pairs a b = (&gt;&gt;=) a (\\x -&gt; (&gt;&gt;=) b (\\y -&gt; return (x, y)))\n</code></pre>\n\n<p>Now the list monad is defined as:</p>\n\n<pre><code>instance Monad [] where\n    return x = [x]\n    (&gt;&gt;=) xs f = concatMap f xs\n</code></pre>\n\n<p>So we have written:</p>\n\n<pre><code>pairs a b = concatMap (\\x -&gt; concatMap (\\y -&gt; [(x, y)]) b) a\n</code></pre>\n\n<p>So we thus take as input two lists <code>a</code> and <code>b</code>, and we perform a <code>concatMap</code> on <code>a</code> with as function <code>(\\x -&gt; concatMap (\\y -&gt; [(x, y)]) b)</code>. In that function we perform another <code>concatMap</code> on <code>b</code> with as function <code>\\y -&gt; [(x, y)]</code>.</p>\n\n<p>So if we evaluate this with <code>pairs [\"a\", \"b\"] [2,3]</code> we get:</p>\n\n<pre><code>   pairs [\"a\", \"b\"] [2,3]\n-&gt; concatMap (\\x -&gt; concatMap (\\y -&gt; [(x, y)]) [2,3]) [\"a\", \"b\"]\n-&gt; concatMap (\\y -&gt; [(\"a\", y)]) [2,3] ++ concatMap (\\y -&gt; [(\"b\", y)]) [2,3]\n-&gt; [(\"a\", 2)] ++ [(\"a\", 3)] ++ [(\"b\", 2)] ++ [(\"b\", 3)]\n-&gt; [(\"a\", 2), (\"a\", 3), (\"b\", 2), (\"b\", 3)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1520236494, "last_edit_date": 1520236494, "creation_date": 1519823813, "answer_id": 49030523, "question_id": 48960899, "link": "https://stackoverflow.com/questions/48960899/how-does-the-list-monad-work-in-this-example/49030523#49030523", "title": "How does the List monad work in this example?", "body": "<p>In general,</p>\n\n<pre><code>pairs a b = do { x &lt;- a; y &lt;- b; return (x, y) }  \n          = do { x &lt;- a;\n                    do { y &lt;- b; \n                            do { return (x, y) }}}\n</code></pre>\n\n<p>means, in pseudocode,</p>\n\n<pre><code>pairs( a, b) {  for x in a do: \n                     for y in b do: \n                                 yield( (x, y) ); \n             }\n</code></pre>\n\n<p>whatever the <code>\"for ... in ... do\"</code> and <code>\"yield\"</code> mean for the particular monad. More formally, it's</p>\n\n<pre><code>          = a  &gt;&gt;= (\\x -&gt;\n                    do { y &lt;- b;                          -- a &gt;&gt;= k  ===\n                            do { return (x, y) }})        -- join (k &lt;$&gt; a)\n          = join ( (&lt;$&gt; a)                                --  ( a       :: m a\n                   (\\x -&gt;                                 --    k       ::   a -&gt;   m b\n                    do { y &lt;- b;                          --    k &lt;$&gt; a :: m       (m b) )\n                            do { return (x, y) }}) )      --            :: m          b\n</code></pre>\n\n<p>( <code>(&lt;$&gt;)</code> is an alias for <code>fmap</code>).</p>\n\n<p>For the <code>Identity</code> monad, where <code>return a = Identity a</code> and <code>join (Identity (Identity a)) = Identity a</code>, it is indeed</p>\n\n<pre><code>pairs( {Identity, a}, {Identity, b}) {  x = a; \n                                        y = b; \n                                        yield( {Identity, {Pair, x, y}} ); \n                                     }\n</code></pre>\n\n<p>For the list monad though, <code>\"for\"</code> means <code>foreach</code>, because <code>return x = [x]</code> and  <code>join xs = concat xs</code>:</p>\n\n<pre><code>-- join :: m (m a) -&gt; m a\n-- join :: [] ([] a) -&gt; [] a\n-- join :: [[a]] -&gt; [a]\njoin = concat\n</code></pre>\n\n<p>and so,</p>\n\n<pre><code>join    [ [a1, a2, a3, ...],\n          [b1, b2, b3, ...],\n           .....\n          [z1, z2, z3, ...] ]\n=\n        [  a1, a2, a3, ... ,\n           b1, b2, b3, ... ,\n            .....\n           z1, z2, z3, ...  ]\n</code></pre>\n\n<p>Monadic bind satisfies <code>ma &gt;&gt;= k  =  join (fmap k ma)</code> where <code>ma :: m a, k :: a -&gt; m b</code> for a <code>Monad m</code>. Thus for lists, where <code>fmap = map</code>, we have <code>ma &gt;&gt;= k  =  join (fmap k ma) = concat (map k ma) = concatMap k ma</code>:</p>\n\n<pre><code>m &gt;&gt;= k  =  [ a,        = join [ k a,   = join [ [ a1, a2, ... ],  =  [  a1, a2, ... ,\n              b,                 k b,            [ b1, b2, ... ],        b1, b2, ... ,\n              c,                 k c,            [ c1, c2, ... ],        c1, c2, ... ,\n              d,                 k d,            [ d1, d2, ... ],        d1, d2, ... ,\n              e,                 k e,            [ e1, e2, ... ],        e1, e2, ... ,\n             ... ] &gt;&gt;= k         ...  ]          ...............  ]      ...........   ]\n</code></pre>\n\n<p>which is exactly what <em>nested loops</em> do. Thus</p>\n\n<pre><code>pairs [\"a\",                                   -- for x in [\"a\", \"b\"] do:\n       \"b\"] [2, 3]                            --          for y in [2, 3] do:\n=                                             --                     yield (x,y)\n      [\"a\", \n       \"b\"] &gt;&gt;= (\\x-&gt; join (fmap (\\y -&gt; return (x,y)) [2, 3]) )\n=\n      [\"a\", \n       \"b\"] &gt;&gt;= (\\x-&gt; concat (map (\\y -&gt; [ (x,y) ]) [2, 3]) )\n=\njoin [ \"a\"  &amp;   (\\x-&gt; concat ((\\y -&gt; [ (x,y) ]) `map` [2, 3]) ),      -- x &amp; f = f x\n       \"b\"  &amp;   (\\x-&gt; concat ((\\y -&gt; [ (x,y) ]) `map` [2, 3]) ) ]     \n=\njoin [              concat ((\\y -&gt; [ (\"a\",y) ]) `map` [2, 3])  ,    \n                    concat ((\\y -&gt; [ (\"b\",y) ]) `map` [2, 3])   ]     \n=\njoin [ concat [ [(\"a\", 2)], [(\"a\", 3)] ] ,    -- for y in [2, 3] do: yield (\"a\",y)\n       concat [ [(\"b\", 2)], [(\"b\", 3)] ] ]    -- for y in [2, 3] do: yield (\"b\",y)\n=\njoin [        [  (\"a\", 2) ,  (\"a\", 3)  ] ,\n              [  (\"b\", 2) ,  (\"b\", 3)  ] ]\n=\n     [           (\"a\", 2) ,  (\"a\", 3)    ,\n                 (\"b\", 2) ,  (\"b\", 3)    ]\n</code></pre>\n\n<p>Loop unrolling is what nested loops do &frasl; <em>are</em>, and <em>nested computations</em> are the essence of Monad.</p>\n\n<p>It is also interesting to notice that</p>\n\n<pre><code> join                =                      =   [a1] ++            =  [a1] ++ join\n  [ [ a1, a2, ... ],    [ a1, a2, ... ] ++          [a2, ... ] ++         [ [a2, ...],\n    [ b1, b2, ... ],    [ b1, b2, ... ] ++     [ b1, b2, ... ] ++      [ b1, b2, ...],\n    [ c1, c2, ... ],    [ c1, c2, ... ] ++     [ c1, c2, ... ] ++      [ c1, c2, ...],\n    [ d1, d2, ... ],    [ d1, d2, ... ] ++     [ d1, d2, ... ] ++      [ d1, d2, ...],\n    [ e1, e2, ... ],    [ e1, e2, ... ] ++     [ e1, e2, ... ] ++      [ e1, e2, ...],\n    ............... ]   ...............        ...............         ..............  ]\n</code></pre>\n\n<p>which goes to the heart of the \"nested loops &frasl; yield\" analogy. Monads are higher order monoids, <em>\"what's the problem?\"</em></p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 48961711, "answer_count": 2, "score": 2, "last_activity_date": 1582447687, "creation_date": 1519460926, "last_edit_date": 1582447687, "question_id": 48960899, "link": "https://stackoverflow.com/questions/48960899/how-does-the-list-monad-work-in-this-example", "title": "How does the List monad work in this example?", "body": "<p>The List monad has <code>return x = [x]</code>. So why in the following example is the result not <code>[([\"a\", \"b\"], [2, 3])]</code>?</p>\n\n<pre><code>&gt; pairs a b = do { x &lt;- a; y &lt;- b; return (x, y)}\n&gt; pairs [\"a\", \"b\"] [2,3]\n[(\"a\",2),(\"a\",3),(\"b\",2),(\"b\",3)]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1519475947, "post_id": 48959368, "comment_id": 84931714, "body": "Try using Debug.Trace to find out what your code is doing in practice. One possibility is that you are getting out of synch with your binary format at some point, and hence maybe &quot;plen&quot; winds up being a very big number which your &quot;skip&#39; (plen - 47)&quot; then tries to obey. But without more clues its very difficult to tell."}, {"owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1519527902, "post_id": 48959368, "comment_id": 84945133, "body": "@PaulJohnson thank you for the suggestion! The error occurred because one of the package lengths is 46, which is smaller than 47 and would cause arithmetic overflow."}], "answers": [{"tags": [], "owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "is_accepted": true, "score": 1, "last_activity_date": 1519528129, "creation_date": 1519528129, "answer_id": 48969843, "question_id": 48959368, "link": "https://stackoverflow.com/questions/48959368/runget-exits-prematurely/48969843#48969843", "title": "`runGet` exits prematurely", "body": "<p>I am not sure if this is the correct way to close the problem. If not please point out the right way to do it. </p>\n\n<p>The basic problem is that I am using <code>Word32</code> to represent the package length and one of the pcap packets is shorter than 47. A shorter number subtracted from 47 would result in arithmetic overflow and cause the <code>Get</code> monad to skip the biggest number of bytes that <code>Word32</code> can represent. </p>\n"}], "owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 48969843, "answer_count": 1, "score": -2, "last_activity_date": 1519528129, "creation_date": 1519446475, "question_id": 48959368, "link": "https://stackoverflow.com/questions/48959368/runget-exits-prematurely", "title": "`runGet` exits prematurely", "body": "<p>I am using Data.Binary to decode binary files and found that the <code>runGet</code> function would throw an exception \u201cnot enough bytes\u201d even though it has not consumed all the input.</p>\n\n<p>Specifically, in the loop I am repeatedly trying to parse the binary file until it has consumed all the input</p>\n\n<pre><code>parsePCAP = do \n    gHeader &lt;- parseGHeader \n    packets &lt;- parsePPackets [] \n    let packets' = catMaybes packets \n    return (Pcap gHeader packets')\n  where \n    parsePPackets xs = do \n    empty &lt;- isEmpty \n    if empty \n        then return xs \n        else do p &lt;- parseB6034 \n                parsePPackets (p:xs)\n</code></pre>\n\n<p>When I try to run this function with <code>runGet</code>, the exception \u201cData.Binary.Get.runGet at position 3293603: not enough bytes\u201d would be thrown, while the total length of input is 5864230, a number significantly larger. The function <code>parseB6034</code> consumes no more than 250 bytes in each round. In addition, the <code>parsePPackets</code> works well when fed with a small amount of data.</p>\n\n<p>Is it the problem of my code or an error with the package binary? The ByteString fed into <code>runGet</code> is lazy ByteString, as required by <code>runGet</code> function.</p>\n\n<p>Below is the complete code </p>\n\n<pre><code>module Header (\n  PGlobalHeader(..)\n, Transaction(..)\n, MarketData(..)\n, Pcap(..)\n\n, parsePCAP \n) where \n\nimport Data.Int \nimport Data.Word \nimport Control.Monad\nimport Data.Maybe \nimport Control.Monad.IO.Class\n\nimport qualified Data.ByteString as BS \nimport qualified Data.ByteString.Lazy as BL\nimport qualified Data.ByteString.Char8 as Char8\nimport Data.Binary.Get \nimport Data.Text (Text)\nimport Data.Text.Encoding \n\nimport Lib (source)\n\ndata PGlobalHeader = PGHeader { \n  magic_number  :: Word32 \n, version_major :: Word16 \n, version_minor :: Word16 \n, timezone      :: Int32  -- GMT to local correction \n, sigfigs       :: Word32 -- accuracy of timestamps \n, snaplen       :: Word32 -- max length of captured packets \n, network       :: Word32 -- data link type \n} deriving (Show, Eq)\n\ndata Transaction = Trans { \n  qty   :: Text\n, price :: Text\n} deriving (Show, Eq)\n\ndata MarketData = B6034 {\n  issCode :: Text -- issue code (ISIN code) \n, accTime :: Text -- accepted time \n, bids    :: [Transaction] -- from 1st to 5th\n, asks    :: [Transaction]\n} deriving (Show, Eq)\n\ndata Pcap = Pcap PGlobalHeader [MarketData] \nderiving Show\n\nparseGHeader :: Get PGlobalHeader \nparseGHeader = PGHeader &lt;$&gt; \n           getWord32le &lt;*&gt; \n           getWord16le &lt;*&gt; \n           getWord16le &lt;*&gt;\n           getInt32le &lt;*&gt;\n           getWord32le &lt;*&gt; \n           getWord32le &lt;*&gt; \n           getWord32le \n\nparsePPacket :: (BS.ByteString -&gt; Bool) -&gt; -- discard the packet?\n            Get a -&gt; -- packet parser \n            Get (Maybe a) \nparsePPacket f p = do \n    skip 12\n    plen &lt;- getWord32le -- length of pcap packet \n    skip 42 -- skip the IP/UDP header \n    code &lt;- getByteString 5 \n    if f code \n        then do r &lt;- p \n                return (Just r)\n        else do skip' (plen - 47)\n                return Nothing \n  where \n    skip' = skip . fromIntegral \n    getByteString' = getByteString . fromIntegral\n\nparseB6034 :: Get (Maybe MarketData)\nparseB6034 = parsePPacket (BS.isPrefixOf quote) parseB6034' \n where \n  quote :: BS.ByteString\n  quote = Char8.pack \"B6034\"\n\n  parseB6034' :: Get MarketData \n  parseB6034' = do\n      issCode &lt;- mkText 12 \n      skip 12 \n      bids &lt;- go 5  \n      skip 7\n      asks &lt;- go 5  \n      skip 50 \n      accTime &lt;- mkText 8\n      skip 1 \n      return (B6034 issCode accTime bids asks)\n    where \n      go 0 = return [] \n      go n = do price &lt;- mkText 5  \n                qty &lt;- mkText 7\n                remains &lt;- go (n-1)  \n                return $ (Trans qty price) : remains \n\nmkText :: Int -&gt; Get Text \nmkText = fmap decodeLatin1 . getByteString \n\nparsePCAP = do \n    gHeader &lt;- parseGHeader \n    packets &lt;- parsePPackets [] \n    let packets' = catMaybes packets \n    return (Pcap gHeader packets')\n  where \n    parsePPackets xs = do \n    empty &lt;- isEmpty \n    if empty \n        then return xs \n        else do p &lt;- parseB6034 \n                parsePPackets (p:xs)\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 19, "user_id": 5712822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5b0d52b89ba1707f9dd8e482e5f1105?s=128&d=identicon&r=PG&f=1", "display_name": "NoOne", "link": "https://stackoverflow.com/users/5712822/noone"}, "edited": false, "score": 0, "creation_date": 1519445646, "post_id": 48959262, "comment_id": 84925340, "body": "By the way, I&#39;m importing System.Process using &#39;import System.Process&#39;"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1519455832, "post_id": 48959262, "comment_id": 84926913, "body": "Add the <code>process</code> under <code>dependencies</code> section in either the cabal file or the <code>package.yaml</code> file if you are using recent yesod scaffolding site."}, {"owner": {"reputation": 19, "user_id": 5712822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5b0d52b89ba1707f9dd8e482e5f1105?s=128&d=identicon&r=PG&f=1", "display_name": "NoOne", "link": "https://stackoverflow.com/users/5712822/noone"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1519469996, "post_id": 48959262, "comment_id": 84930084, "body": "This is the answer! Thanks a lot, Sibi!"}], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1520151803, "creation_date": 1520151803, "answer_id": 49093432, "question_id": 48959262, "link": "https://stackoverflow.com/questions/48959262/yesod-system-process/49093432#49093432", "title": "Yesod + System.Process", "body": "<p>You need to add the  package <code>process</code> under dependencies section in either the cabal file or the <code>package.yaml</code> file if you are using recent yesod scaffolding site.</p>\n"}], "owner": {"reputation": 19, "user_id": 5712822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5b0d52b89ba1707f9dd8e482e5f1105?s=128&d=identicon&r=PG&f=1", "display_name": "NoOne", "link": "https://stackoverflow.com/users/5712822/noone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1520151803, "creation_date": 1519445190, "last_edit_date": 1519447660, "question_id": 48959262, "link": "https://stackoverflow.com/questions/48959262/yesod-system-process", "title": "Yesod + System.Process", "body": "<p>I'm trying to create an application using Yesod and I need to call a function that uses <code>System.Process</code>. </p>\n\n<p>But I'm receiving this error: </p>\n\n<blockquote>\n  <p>Could not find module <code>System.Process</code></p>\n</blockquote>\n\n<p><code>System.Process</code> is needed because I want to use <code>callCommand</code>.</p>\n"}, {"tags": ["haskell", "vim"], "comments": [{"owner": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 1, "creation_date": 1519427565, "post_id": 48957498, "comment_id": 84921981, "body": "do you install a lint or on-the-fly checker? try to open a file that compiles well and see if such problem exists."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1519427887, "post_id": 48957498, "comment_id": 84922074, "body": "Have you recently updated your system or some part of it?"}, {"owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "reply_to_user": {"reputation": 5681, "user_id": 3040064, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/02e7081757e69605a91b7f7aea47f4ae?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Hu", "link": "https://stackoverflow.com/users/3040064/jason-hu"}, "edited": false, "score": 0, "creation_date": 1519445648, "post_id": 48957498, "comment_id": 84925341, "body": "@HuStmpHrrr I am using ale and the problem seems indeed related to this tool. Following Daniel&#39;s suggestions, the vim now would underline the code for which the compiler suggests syntactic improvement."}], "answers": [{"comments": [{"owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "edited": false, "score": 0, "creation_date": 1519445404, "post_id": 48957948, "comment_id": 84925290, "body": "Turning off spell check solves part of the problem. Some have disappeared but some still linger around."}, {"owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "edited": false, "score": 0, "creation_date": 1519445790, "post_id": 48957948, "comment_id": 84925368, "body": "It seems the remaining bit of the problem is related to ale lint tool. On those lines where the lint suggests an improvement the code would be underlined, but otherwise it is pretty alright."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1519431322, "last_edit_date": 1519431322, "creation_date": 1519430967, "answer_id": 48957948, "question_id": 48957498, "link": "https://stackoverflow.com/questions/48957498/strange-line-that-suddenly-appeared/48957948#48957948", "title": "Strange line that suddenly appeared", "body": "<p>I suspect you have turned on spell check. Try</p>\n\n<pre><code>:setlocal nospell\n</code></pre>\n\n<p>to turn it off for the current buffer. You can put a line like this in <code>~/.vim/ftplugin/haskell.vim</code> to turn it off for all Haskell files.</p>\n"}], "owner": {"reputation": 139, "user_id": 6053118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/Y9Y01.jpg?s=128&g=1", "display_name": "Quentin Liu", "link": "https://stackoverflow.com/users/6053118/quentin-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1519431322, "creation_date": 1519427377, "question_id": 48957498, "link": "https://stackoverflow.com/questions/48957498/strange-line-that-suddenly-appeared", "title": "Strange line that suddenly appeared", "body": "<p>I have been using vim for like a year and never made any change pertaining to underline. But all of a sudden vim starts to underline almost every keyword in the Haskell file. </p>\n\n<p>I searched through vimrc and did not find any change specifically made for Haskell file. </p>\n\n<p>My question is, is there any way to turn off the underline? It is visually distracting and annoying. </p>\n\n<p>Below is how the file looks like right now \n<a href=\"https://i.stack.imgur.com/nH2T4.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nH2T4.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["haskell", "xmonad"], "answers": [{"comments": [{"owner": {"reputation": 884, "user_id": 982464, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/471123819064e2733f7e15d90066978c?s=128&d=identicon&r=PG", "display_name": "drumfire", "link": "https://stackoverflow.com/users/982464/drumfire"}, "edited": false, "score": 1, "creation_date": 1519424231, "post_id": 48956745, "comment_id": 84920937, "body": "Ah yes. At first it did make the window a floating window, but the size and position were not adjusted. As it turned out, this had to do with <code>placeHook simpleSmart</code> from <code>XMonad.Hooks.Place</code>. As soon as I disabled that one, your solution worked. Thank you."}, {"owner": {"reputation": 884, "user_id": 982464, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/471123819064e2733f7e15d90066978c?s=128&d=identicon&r=PG", "display_name": "drumfire", "link": "https://stackoverflow.com/users/982464/drumfire"}, "edited": false, "score": 0, "creation_date": 1519425393, "post_id": 48956745, "comment_id": 84921352, "body": "For the curious reader - I am using the <code>composeOne</code> ManageHook composer, rather than the more frequently used <code>composeAll</code>. The former stops as soon as there is a match. This explains why it didn&#39;t originally work, and instead of disabling <code>placeHook simpleSmart</code>, I have now placed it after the list of individual windows I want to be floating."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1519422734, "creation_date": 1519422734, "answer_id": 48956745, "question_id": 48956553, "link": "https://stackoverflow.com/questions/48956553/xmonad-default-size-for-a-floating-window/48956745#48956745", "title": "xmonad: default size for a floating window", "body": "<blockquote>\n  <p><code>ManageHelpers</code> does have a function called <code>doRectFloat</code> [...] But I don't know how to use this.</p>\n</blockquote>\n\n<p>The type of <code>doRectFloat</code> is...</p>\n\n<pre><code>doRectFloat :: RationalRect -&gt; ManageHook\n</code></pre>\n\n<p>... so you need to pass it a <a href=\"https://hackage.haskell.org/package/xmonad-0.13/docs/XMonad-StackSet.html#t:RationalRect\" rel=\"nofollow noreferrer\"><code>RationalRect</code></a> (following the links in the docs usually helps in figuring out such things):</p>\n\n<pre><code>doRectFloat (RationalRect (1 % 4) (1 % 4) (1 % 2) (1 % 2))\n</code></pre>\n\n<p>This should produce a centered rectangle with half of the full width and length. <code>%</code> is used to build <code>Rational</code> (a type for exact fractions) values. To use it, you will need to add <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Ratio.html\" rel=\"nofollow noreferrer\"><code>import Data.Ratio</code></a> to the imports at the top of your <code>xmonad.hs</code> file.</p>\n"}], "owner": {"reputation": 884, "user_id": 982464, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/471123819064e2733f7e15d90066978c?s=128&d=identicon&r=PG", "display_name": "drumfire", "link": "https://stackoverflow.com/users/982464/drumfire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1019, "favorite_count": 1, "accepted_answer_id": 48956745, "answer_count": 1, "score": 0, "last_activity_date": 1519422734, "creation_date": 1519421829, "last_edit_date": 1519422039, "question_id": 48956553, "link": "https://stackoverflow.com/questions/48956553/xmonad-default-size-for-a-floating-window", "title": "xmonad: default size for a floating window", "body": "<p>To have a window placed on the floating layer as soon as it appears, one can use the <code>doFloat</code> function from <code>ManageHooks</code>. In addition there are some additional functions, like <code>doCenterFloat</code> for instance, that are provided by <code>ManageHelpers</code>.</p>\n\n<p>But is there any way to specify a specific size for a window?</p>\n\n<p>Right now I have an application and it just takes the whole window space. I'd like to specify a more comfortable size.</p>\n\n<p><code>ManageHelpers</code> does have a function called <code>doRectFloat</code> which takes a <code>RationalRect</code>. In the <a href=\"https://hackage.haskell.org/package/xmonad-contrib-0.13/docs/XMonad-Hooks-ManageHelpers.html#v:doRectFloat\" rel=\"nofollow noreferrer\">description for <code>doRectFloat</code></a> it states the following:</p>\n\n<blockquote>\n  <p>The rectangle to float the window in. 0 to 1; x, y, w, h.</p>\n</blockquote>\n\n<p>But I don't know how to use this.</p>\n"}, {"tags": ["haskell", "haskell-lens", "traversable"], "comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 2, "creation_date": 1519413909, "post_id": 48954495, "comment_id": 84916438, "body": "Tangent. This reminds me of <a href=\"https://jaspervdj.be/posts/2012-10-17-wiggling-sums.html\" rel=\"nofollow noreferrer\"><code>wigglesum :: Traversable t =&gt; (a -&gt; [a]) -&gt; (t a -&gt; [t a])</code></a> that can be implemented using <a href=\"http://r6.ca/blog/20121209T182914Z.html\" rel=\"nofollow noreferrer\"><code>holesOf</code></a>: <code>wigglesum wiggle = holesOf traverse &gt;=&gt; experiment wiggle</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1519416430, "post_id": 48954495, "comment_id": 84917679, "body": "@Iceland_jack, <a href=\"http://r6.ca/blog/20121209T182914Z.html\" rel=\"nofollow noreferrer\">Russell O&#39;Connor&#39;s response</a> to that blog post is what led me into this territory. Easily nerd-sniped, I submitted a now-merged <a href=\"https://github.com/ekmett/lens/pull/789\" rel=\"nofollow noreferrer\">PR to lens</a> removing the slurping from <code>holesof</code>."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1519427279, "post_id": 48954495, "comment_id": 84921917, "body": "Interesting commit!"}], "answers": [{"comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1519692087, "post_id": 48996029, "comment_id": 85004031, "body": "<code>go (One a) = f a</code> seems to me to unify <code>b</code> with <code>u</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1519692234, "post_id": 48996029, "comment_id": 85004068, "body": "@Gurkenglas, the pattern match on <code>One</code> does that. But in other cases they won&#39;t be the same. Consider <code>Map Just (One x)</code>."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1519696070, "post_id": 48996029, "comment_id": 85004957, "body": "One suggestion to make it impossible to call <code>smash</code> incorrectly - change it to <code>smash :: (forall b. Mag a b (t b)) -&gt; t (a, a -&gt; t a); smash = \\m -&gt; go id m m</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1519696271, "post_id": 48996029, "comment_id": 85004999, "body": "@rampion, I wasn&#39;t sure what would be clearest. That&#39;s certainly a good approach."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 8, "last_activity_date": 1519689817, "last_edit_date": 1519689817, "creation_date": 1519674584, "answer_id": 48996029, "question_id": 48954495, "link": "https://stackoverflow.com/questions/48954495/is-it-possible-to-get-all-contexts-of-a-traversable-lazily/48996029#48996029", "title": "Is it possible to get all contexts of a Traversable lazily?", "body": "<p>I have not managed to find a really beautiful way to do this. That might be because I'm not clever enough, but I suspect it is an inherent limitation of the type of <code>traverse</code>. But I have found a way that's only a little bit ugly! The key indeed seems to be the extra type argument that <code>Magma</code> uses, which gives us the freedom to build a framework expecting a certain element type and then fill in the elements later.</p>\n\n<pre><code>data Mag a b t where\n  Pure :: t -&gt; Mag a b t\n  Map :: (x -&gt; t) -&gt; Mag a b x -&gt; Mag a b t\n  Ap :: Mag a b (t -&gt; u) -&gt; Mag a b t -&gt; Mag a b u\n  One :: a -&gt; Mag a b b\n\ninstance Functor (Mag a b) where\n  fmap = Map\n\ninstance Applicative (Mag a b) where\n  pure = Pure\n  (&lt;*&gt;) = Ap\n\n-- We only ever call this with id, so the extra generality\n-- may be silly.\nrunMag :: forall a b t. (a -&gt; b) -&gt; Mag a b t -&gt; t\nrunMag f = go\n  where\n    go :: forall u. Mag a b u -&gt; u\n    go (Pure t) = t\n    go (One a) = f a\n    go (Map f x) = f (go x)\n    go (Ap fs xs) = go fs (go xs)\n</code></pre>\n\n<p>We recursively descend a value of type <code>Mag x (a, a -&gt; t a) (t (a, a -&gt; t a))</code> in parallel with one of type <code>Mag a a (t a)</code> using the latter to produce the <code>a</code> and <code>a -&gt; t a</code> values and the former as a framework for building <code>t (a, a -&gt; t)</code> from those values. <code>x</code> will actually be <code>a</code>; it's left polymorphic to make the \"type tetris\" a little less confusing.</p>\n\n<pre><code>-- Precondition: the arguments should actually be the same;\n-- only their types will differ. This justifies the impossibility\n-- of non-matching constructors.\nsmash :: forall a x t u.\n         Mag x (a, a -&gt; t) u\n      -&gt; Mag a a t\n      -&gt; u\nsmash = go id\n  where\n    go :: forall r b.\n          (r -&gt; t)\n       -&gt; Mag x (a, a -&gt; t) b\n       -&gt; Mag a a r\n       -&gt; b\n    go f (Pure x) _ = x\n    go f (One x) (One y) = (y, f)\n    go f (Map g x) (Map h y) = g (go (f . h) x y)\n    go f (Ap fs xs) (Ap gs ys) =\n      (go (f . ($ runMag id ys)) fs gs)\n      (go (f . runMag id gs) xs ys)\n    go _ _ _ = error \"Impossible!\"\n</code></pre>\n\n<p>We actually produce both <code>Mag</code> values (of different types!) using a single call to <code>traverse</code>. These two values will actually be represented by a <em>single</em> structure in memory.</p>\n\n<pre><code>holes :: forall t a. Traversable t =&gt; t a -&gt; t (a, a -&gt; t a)\nholes t = smash mag mag\n  where\n    mag :: Mag a b (t b)\n    mag = traverse One t\n</code></pre>\n\n<p>Now we can play with fun values like</p>\n\n<pre><code>holes (Reverse [1..])\n</code></pre>\n\n<p>where <code>Reverse</code> is from <code>Data.Functor.Reverse</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519712133, "post_id": 49001904, "comment_id": 85009169, "body": "Very clever. I had the feeling there might be some fancy knot to be tied, but the types were already hard enough for me to navigate without trying to find that!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1519716243, "post_id": 49001904, "comment_id": 85010815, "body": "You can pretty much forget about profiling. It appears that your version gets a <i>ton</i> of sharing among the results, whereas mine does not. I don&#39;t know just how they compare in lazier circumstances, but yours can make an enormous <code>Map</code> of <code>Map</code>s without any difficulty, while mine cannot."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 13, "last_activity_date": 1519710947, "last_edit_date": 1519710947, "creation_date": 1519710237, "answer_id": 49001904, "question_id": 48954495, "link": "https://stackoverflow.com/questions/48954495/is-it-possible-to-get-all-contexts-of-a-traversable-lazily/49001904#49001904", "title": "Is it possible to get all contexts of a Traversable lazily?", "body": "<p><a href=\"https://stackoverflow.com/revisions/48996029/6\">Your existing solution</a> calls <code>runMag</code> once for every branch in the tree defined by <code>Ap</code> constructors.</p>\n\n<p>I haven't profiled anything, but as <code>runMag</code> is itself recursive, this might slow things down in a large tree.</p>\n\n<p>An alternative would be to tie the knot so you're only (in effect) calling <code>runMag</code> once for the entire tree:</p>\n\n<pre><code>data Mag a b c where\n  One :: a -&gt; Mag a b b\n  Pure :: c -&gt; Mag a b c\n  Ap :: Mag a b (c -&gt; d) -&gt; Mag a b c -&gt; Mag a b d\n\ninstance Functor (Mag a b) where\n  fmap = Ap . Pure\n\ninstance Applicative (Mag a b) where\n  pure = Pure\n  (&lt;*&gt;) = Ap\n\nholes :: forall t a. Traversable t =&gt; t a -&gt; t (a, a -&gt; t a)\nholes = \\t -&gt; \n    let m :: Mag a b (t b)\n        m = traverse One t \n    in fst $ go id m m\n  where\n    go :: (x -&gt; y)\n       -&gt; Mag a (a, a -&gt; y) z\n       -&gt; Mag a a x\n       -&gt; (z, x)\n    go f (One a)    (One _)    = ((a, f), a)\n    go _ (Pure z)   (Pure x)   = (z, x)\n    go f (Ap mg mi) (Ap mh mj) = \n      let ~(g, h) = go (f . ($j)) mg mh\n          ~(i, j) = go (f .   h ) mi mj\n      in (g i, h j)\n    go _ _ _ = error \"only called with same value twice, constructors must match\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519751831, "post_id": 49009533, "comment_id": 85033457, "body": "Does that <code>fst &lt;$&gt;</code> risk a space leak? This code is so mind-bendy I can&#39;t tell. If I pluck an <code>a -&gt; t a</code> out of the result, apply it to a value, and consume the result &quot;from the top down&quot;, will the garbage collector be able to collect the top of the structure, or will it hang on to it through never-to-be-realized <code>a -&gt; t a</code> values? Regardless, this is a beautiful construction."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519752779, "post_id": 49009533, "comment_id": 85034048, "body": "Hrmm... Also, it seems this unfortunately doesn&#39;t get the magical sharing of @rampion&#39;s solution. I fear that may be the price it pays for avoiding the ugly double pattern matching. So I think your way is the most beautiful, but probably not one I&#39;d choose in practice."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519757292, "post_id": 49009533, "comment_id": 85036552, "body": "Do you think there&#39;s a way to fix the performance problem, perhaps at the expense of just <i>some</i> of what makes this solution more theoretically nice than rampion&#39;s? This weird continuation thing breaks my brain; is there somewhere I could read about it?"}, {"owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519758631, "post_id": 49009533, "comment_id": 85037329, "body": "In my experiments, my solution runs on par or even somewhat better (faster and less memory) than rampion&#39;s. Try <code>print $ sum $ snd (holes [(0::Int)..limit] !! 1) 42</code>."}, {"owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1519760028, "post_id": 49009533, "comment_id": 85038061, "body": "As to whether you can read about it somewhere, I don&#39;t know; I just invented it, but I wouldn&#39;t be surprised if someone considered it before. I am writing a blog post about it which you&#39;ll be able to read soon though."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1519760190, "post_id": 49009533, "comment_id": 85038154, "body": "Given a big <code>Map Int Int</code> (10000 elements), take the holes and <code>Strict.map (($ 100) . snd)</code> it, evaluating to WHNF. Your solution seems to blow up badly, while rampion&#39;s completes almost immediately with only modest allocation."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519760734, "post_id": 49009533, "comment_id": 85038457, "body": "I suspect your solution works well for streamy things, but seems to be O(n^2) rather than O(n log n) for balanced trees with typical pre/post/inorder traversals."}, {"owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519762007, "post_id": 49009533, "comment_id": 85039145, "body": "Ok, now I see. The difference is not so much between list/map but between evaluating one hole or many."}, {"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1519831663, "post_id": 49009533, "comment_id": 85070761, "body": "dfeuer: You <a href=\"https://gist.github.com/rampion/bb4ad75a85c431f1c3e70ae29ce369ce\" rel=\"nofollow noreferrer\">can get rid of the intermediate <code>fmap</code>s by using a recursive newtype</a>. I still need to do some analysis to see what this does in terms of sharing work, so I&#39;m not sure it&#39;s any performance improvement."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1519860103, "post_id": 49009533, "comment_id": 85085897, "body": "@rampion, I don&#39;t <i>think</i> that gives us the sharing we want, but you should check with the <code>Map</code> test I describe above. Be sure to use the strict mapping function rather than <code>fmap</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1519881139, "post_id": 49009533, "comment_id": 85091061, "body": "Roman, I came up with an implementation of <code>holesList</code> that may or may not inspire you to find an improvement of your technique: <a href=\"https://gist.github.com/treeowl/789d43a641eff65083f724fc56d28234\" rel=\"nofollow noreferrer\">gist.github.com/treeowl/789d43a641eff65083f724fc56d28234</a> This gets sharing without a sketchy <code>Applicative</code> instance, but it&#39;s a sad listy version."}], "tags": [], "owner": {"reputation": 34861, "user_id": 110081, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/cSvwm.jpg?s=128&g=1", "display_name": "Roman Cheplyaka", "link": "https://stackoverflow.com/users/110081/roman-cheplyaka"}, "is_accepted": false, "score": 7, "last_activity_date": 1519757184, "last_edit_date": 1519757184, "creation_date": 1519737084, "answer_id": 49009533, "question_id": 48954495, "link": "https://stackoverflow.com/questions/48954495/is-it-possible-to-get-all-contexts-of-a-traversable-lazily/49009533#49009533", "title": "Is it possible to get all contexts of a Traversable lazily?", "body": "<p>Here is an implementation that is short, total (if you ignore the circularity), doesn't use any intermediate data structures, and is lazy (works on any kind of infinite traversable):</p>\n\n<pre><code>import Control.Applicative\nimport Data.Traversable\n\nholes :: Traversable t =&gt; t a -&gt; t (a, a -&gt; t a)\nholes t = flip runKA id $ for t $ \\a -&gt;\n  KA $ \\k -&gt;\n    let f a' = fst &lt;$&gt; k (a', f)\n    in (a, f)\n\nnewtype KA r a = KA { runKA :: (a -&gt; r) -&gt; a }\n\ninstance Functor (KA r) where fmap f a = pure f &lt;*&gt; a\ninstance Applicative (KA r) where\n  pure a = KA (\\_ -&gt; a)\n  liftA2 f (KA ka) (KA kb) = KA $ \\cr -&gt;\n    let\n      a = ka ar\n      b = kb br\n      ar a' = cr $ f a' b\n      br b' = cr $ f a b'\n    in f a b\n</code></pre>\n\n<p><code>KA</code> is a \"lazy continuation applicative functor\". If we replace it with the standard <code>Cont</code> monad, we also get a working solution, which is not lazy, however:</p>\n\n<pre><code>import Control.Monad.Cont\nimport Data.Traversable\n\nholes :: Traversable t =&gt; t a -&gt; t (a, a -&gt; t a)\nholes t = flip runCont id $ for t $ \\a -&gt;\n  cont $ \\k -&gt;\n    let f a' = fst &lt;$&gt; k (a', f)\n    in k (a, f)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 1, "last_activity_date": 1519898995, "last_edit_date": 1519898995, "creation_date": 1519890415, "answer_id": 49044894, "question_id": 48954495, "link": "https://stackoverflow.com/questions/48954495/is-it-possible-to-get-all-contexts-of-a-traversable-lazily/49044894#49044894", "title": "Is it possible to get all contexts of a Traversable lazily?", "body": "<p>This doesn't really answer the original question, but it shows another angle. It looks like this question is actually tied rather deeply to a <a href=\"https://stackoverflow.com/questions/48220977/traversing-with-a-biapplicative\">previous question</a> I asked. Suppose that <code>Traversable</code> had an additional method:</p>\n\n<pre><code>traverse2 :: Biapplicative f\n           =&gt; (a -&gt; f b c) -&gt; t a -&gt; f (t b) (t c)\n</code></pre>\n\n<p>Note: This method can actually be implemented legitimately for any concrete <code>Traversable</code> datatype. For oddities like</p>\n\n<pre><code>newtype T a = T (forall f b. Applicative f =&gt; (a -&gt; f b) -&gt; f (T b))\n</code></pre>\n\n<p>see the illegitimate ways in the answers to the linked question.</p>\n\n<p>With that in place, we can design a type very similar to Roman's, but with a twist from rampion's:</p>\n\n<pre><code>newtype Holes t m x = Holes { runHoles :: (x -&gt; t) -&gt; (m, x) }\n\ninstance Bifunctor (Holes t) where\n  bimap f g xs = Holes $ \\xt -&gt;\n    let\n      (qf, qv) = runHoles xs (xt . g)\n    in (f qf, g qv)\n\ninstance Biapplicative (Holes t) where\n  bipure x y = Holes $ \\_ -&gt; (x, y)\n  fs &lt;&lt;*&gt;&gt; xs = Holes $ \\xt -&gt;\n    let\n      (pf, pv) = runHoles fs (\\cd -&gt; xt (cd qv))\n      (qf, qv) = runHoles xs (\\c -&gt; xt (pv c))\n    in (pf qf, pv qv)\n</code></pre>\n\n<p>Now everything is dead simple:</p>\n\n<pre><code>holedOne :: a -&gt; Holes (t a) (a, a -&gt; t a) a\nholedOne x = Holes $ \\xt -&gt; ((x, xt), x)\n\nholed :: Traversable t =&gt; t a -&gt; t (a, a -&gt; t a)\nholed xs = fst (runHoles (traverse2 holedOne xs) id)\n</code></pre>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1303, "favorite_count": 4, "accepted_answer_id": 49001904, "answer_count": 4, "score": 20, "last_activity_date": 1519898995, "creation_date": 1519412031, "last_edit_date": 1519692550, "question_id": 48954495, "link": "https://stackoverflow.com/questions/48954495/is-it-possible-to-get-all-contexts-of-a-traversable-lazily", "title": "Is it possible to get all contexts of a Traversable lazily?", "body": "<p><code>lens</code> offers <a href=\"http://hackage.haskell.org/package/lens-4.16/docs/Control-Lens-Traversal.html#v:holesOf\" rel=\"noreferrer\"><code>holesOf</code></a>, which is a somewhat more general and powerful version of this hypothetical function:</p>\n\n<pre><code>holesList :: Traversable t\n          =&gt; t a -&gt; [(a, a -&gt; t a)]\n</code></pre>\n\n<p>Given a container, <code>holesList</code> produces a list of elements of the container along with functions for replacing those elements.</p>\n\n<p>The type of <code>holesList</code>, like that of the real <code>holesOf</code>, fails to capture the fact that the number of pairs produced will equal the number of elements of the container. A much more beautiful type, therefore, would be</p>\n\n<pre><code>holes :: Traversable t\n      =&gt; t a -&gt; t (a, a -&gt; t a)\n</code></pre>\n\n<p>We could implement <code>holes</code> by using <code>holesList</code> to make a list and then traversing in <code>State</code> to slurp the elements back in. But this is unsatisfactory for two reasons, one of which has practical consequences:</p>\n\n<ol>\n<li><p>The slurping code will have an unreachable error call to handle the case where the list runs empty before the traversal is complete. This is disgusting, but probably doesn't matter much to someone using the function.</p></li>\n<li><p>Containers that extend infinitely to the left, or that bottom out on the left, won't work at all. Containers that extend very far to the left will be very inefficient to handle.</p></li>\n</ol>\n\n<p>I'm wondering if there's any way around these problems. It's quite possible to capture the shape of the traversal using something like <a href=\"http://hackage.haskell.org/package/lens-4.16/docs/Control-Lens-Internal-Magma.html#t:Magma\" rel=\"noreferrer\"><code>Magma</code></a> in lens:</p>\n\n<pre><code>data FT a r where\n  Pure :: r -&gt; FT a r\n  Single :: a -&gt; FT a a\n  Map :: (r -&gt; s) -&gt; FT a r -&gt; FT a s\n  Ap :: FT a (r -&gt; s) -&gt; FT a r -&gt; FT a s\n\ninstance Functor (FT a) where\n  fmap = Map\ninstance Applicative (FT a) where\n  pure = Pure\n  (&lt;*&gt;) = Ap\n\nrunFT :: FT a t -&gt; t\nrunFT (Pure t) = t\nrunFT (Single a) = a\nrunFT (Map f x) = f (runFT x)\nrunFT (Ap fs xs) = runFT fs (runFT xs)\n</code></pre>\n\n<p>Now we have</p>\n\n<pre><code>runFT . traverse Single = id\n</code></pre>\n\n<p><code>traverse Single</code> makes a tree full of elements along with the function applications needed to build them into a container. If we replace an element in the tree, we can <code>runFT</code> the result to get a container with that element replaced. Unfortunately, I am stuck: I don't know what the next step might look like.</p>\n\n<hr>\n\n<p>Vague thoughts: adding another type parameter might help change element types. The <code>Magma</code> type does something like this, and it goes back at least as far as Zemyla's comment on Van Laarhoven's blog post about <code>FunList</code>.</p>\n"}, {"tags": ["haskell", "generics", "types"], "comments": [{"owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "edited": false, "score": 0, "creation_date": 1519407290, "post_id": 48953335, "comment_id": 84913399, "body": "Answer is likely related to another <a href=\"https://stackoverflow.com/questions/48951745/printing-dynamic-data\">question</a> I posted earlier"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519412825, "post_id": 48953335, "comment_id": 84915939, "body": "I don&#39;t think that code does what you think it does. <code>return . toDyn . randomRIO $ (-20, 100)</code> does not create a random <code>Int</code>, convert it to <code>Dynamic</code>, and return that value. It converts <i>the <code>IO</code> action that creates a random <code>Int</code></i> to <code>Dynamic</code>. You almost certainly want <code>toDyn &lt;$&gt; randomRIO (-20, 100)</code> instead (and similarly for the next line)."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1519423834, "post_id": 48954632, "comment_id": 84920792, "body": "It looks like there&#39;s also <code>typeRepKind :: TypeRep (a :: k) -&gt; TypeRep k</code>, so if it&#39;s <i>really</i> necessary to take a <code>SomeTypeRep</code> as the argument for some reason it looks like it should be possible with a bit of hand-wringing. Let me know if that seems useful and I can write a few comments about that."}, {"owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "edited": false, "score": 0, "creation_date": 1519445218, "post_id": 48954632, "comment_id": 84925257, "body": "Hey I&#39;m not sure why but I&#39;m getting some errors when trying to compile goo. <a href=\"https://imgur.com/a/DZNzs\" rel=\"nofollow noreferrer\">link</a> any ideas?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "edited": false, "score": 0, "creation_date": 1519448114, "post_id": 48954632, "comment_id": 84925704, "body": "@TheJohnMajor01 Whoops, that&#39;s embarrassing. Must have introduced that while trying out some alternate formattings. Should be fixed -- it was just a parenthesis that had migrated."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 3, "last_activity_date": 1519448071, "last_edit_date": 1519448071, "creation_date": 1519412680, "answer_id": 48954632, "question_id": 48953335, "link": "https://stackoverflow.com/questions/48953335/generating-dynamic-data-randomly/48954632#48954632", "title": "Generating Dynamic Data Randomly", "body": "<p>Generally when working with <code>Type.Reflection</code> you want to leave your quantification as \"late\" as possible. With that in mind, the following seems to work:</p>\n\n<pre><code>{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE GADTs #-}\nimport Control.Applicative\nimport Data.Dynamic\nimport System.Random\nimport Type.Reflection\n\ngoo :: TypeRep a -&gt; IO a\ngoo tr = case tr of\n    App (App comma a) b | Just HRefl &lt;- eqTypeRep (typeRep @(,)) comma\n        -&gt; liftA2 (,) (goo a) (goo b)\n    _ | Just HRefl &lt;- eqTypeRep (typeRep @Int) tr -&gt; randomRIO (-20, 100)\n      | Just HRefl &lt;- eqTypeRep (typeRep @Bool) tr -&gt; randomIO\n      | otherwise -&gt; fail \"dunno lol\"\n</code></pre>\n\n<p>You might object that you want to take an existing <code>Dynamic</code> and produce a new, matching, random one, and that this doesn't work:</p>\n\n<pre><code>gooBad :: Dynamic -&gt; IO Dynamic\ngooBad d = case dynTypeRep d of\n    SomeTypeRep tr -&gt; toDyn &lt;$&gt; goo tr\n</code></pre>\n\n<p>That's true: the <code>SomeTypeRep</code> type existentially quantifies over the <em>kind</em> of its <code>TypeRep</code>, which is unfortunate, since we know that it's going to be representing a type of kind <code>*</code>. Luckily, <code>Data.Dynamic</code> exports enough information to do it yourself without <code>dynTypeRep</code>:</p>\n\n<pre><code>gooDyn :: Dynamic -&gt; IO Dynamic\ngooDyn (Dynamic tr _) = Dynamic tr &lt;$&gt; goo tr\n</code></pre>\n"}], "owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519448071, "creation_date": 1519407183, "question_id": 48953335, "link": "https://stackoverflow.com/questions/48953335/generating-dynamic-data-randomly", "title": "Generating Dynamic Data Randomly", "body": "<p>I have a system in haskell that uses Data.Dynamic and Type.Reflection to perform inference and calculations. I would like to be able to generate dynamic data randomly.</p>\n\n<p>Generating dynamic data is easy when the type is known.</p>\n\n<pre><code>goo :: SomeTypeRep -&gt; IO (Dynamic)\ngoo str = case tyConName . someTypeRepTyCon $ str of\n            \"Int\"  -&gt; return . toDyn . randomRIO $ (-20, 100::Int)\n            \"Bool\" -&gt; return . toDyn . randomRIO $ (True, False)\n            _      -&gt; error \"no chance\"      \n</code></pre>\n\n<p>But having a new line for every type is impractical when handling tuples.</p>\n\n<p><strong>Is there a way to combine n dynamics into a tuple? Or is there another way to generate the tuples dynamically?</strong></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1519404893, "post_id": 48952623, "comment_id": 84912151, "body": "You may want to take a look at some more basic Haskell tutorials. For this example, maybe try looking at the &quot;I&#39;m a list comprehension&quot; section of Starting Out in LYAH: <a href=\"http://learnyouahaskell.com/starting-out\" rel=\"nofollow noreferrer\">learnyouahaskell.com/starting-out</a>"}, {"owner": {"reputation": 7577, "user_id": 5638835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fba9e7db4baba416a82c4277758d886?s=128&d=identicon&r=PG&f=1", "display_name": "puhlen", "link": "https://stackoverflow.com/users/5638835/puhlen"}, "edited": false, "score": 0, "creation_date": 1519404974, "post_id": 48952623, "comment_id": 84912197, "body": "Just to be clear on what you are looking for.  You are trying to get a list of all the elements that exist in both input lists?"}, {"owner": {"reputation": 158, "user_id": 9146085, "user_type": "registered", "profile_image": "https://graph.facebook.com/2001185663452273/picture?type=large", "display_name": "Taimoor Ali", "link": "https://stackoverflow.com/users/9146085/taimoor-ali"}, "edited": false, "score": 0, "creation_date": 1519405136, "post_id": 48952623, "comment_id": 84912277, "body": "Well yeah in this case it will give me a list but I actually need only one."}, {"owner": {"reputation": 158, "user_id": 9146085, "user_type": "registered", "profile_image": "https://graph.facebook.com/2001185663452273/picture?type=large", "display_name": "Taimoor Ali", "link": "https://stackoverflow.com/users/9146085/taimoor-ali"}, "edited": false, "score": 0, "creation_date": 1519405268, "post_id": 48952623, "comment_id": 84912370, "body": "I know I can do the task recursively, but I was just trying to do it this way."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1519405391, "post_id": 48952623, "comment_id": 84912443, "body": "You are trying to write a list comprehension, not a do block. The error message mentions do blocks because the syntax you are using for the list comprehension is wrong. I second jkeuhlen&#39;s suggestion of having a look at that section of LYAH."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1519406967, "post_id": 48952623, "comment_id": 84913241, "body": "Prolog style variable unification does not exist. If you have two different bindings for value <code>x</code> they are simply different variables with one shadowing the other. It does not mean &quot;The first and second values are equal&quot;.  For equality you should use <code>a == b</code>."}], "answers": [{"comments": [{"owner": {"reputation": 158, "user_id": 9146085, "user_type": "registered", "profile_image": "https://graph.facebook.com/2001185663452273/picture?type=large", "display_name": "Taimoor Ali", "link": "https://stackoverflow.com/users/9146085/taimoor-ali"}, "edited": false, "score": 0, "creation_date": 1519426735, "post_id": 48953506, "comment_id": 84921787, "body": "Thank you, I didn&#39;t know about  <code>elem</code>."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 3, "last_activity_date": 1519407890, "creation_date": 1519407890, "answer_id": 48953506, "question_id": 48952623, "link": "https://stackoverflow.com/questions/48952623/do-block-in-haskell/48953506#48953506", "title": "do block in Haskell", "body": "<p><code>&lt;-</code> doesn't say \"<code>x</code> is in <code>xs</code>\"; it says \"take <code>x</code> from <code>xs</code>\". It's not a boolean expression you can combine with others using <code>&amp;&amp;</code>, but part of the syntax of a list comprehension. If you want to use a list comprehension, it would be</p>\n\n<pre><code>present xs ys = [x | x &lt;- xs, x `elem` ys]\n</code></pre>\n\n<p>where you take each element from <code>xs</code>, but only use it if it is also an element of <code>ys</code>. You don't need <code>concat</code>.</p>\n\n<p>Note this takes <em>all</em> elements common to <code>xs</code> and <code>ys</code> (i.e., it's the set intersection). If you are only interested in a single arbitrary item (most easily, the first), then you don't need a list comprehension at all:</p>\n\n<pre><code>present [] _ = Nothing\npresent (x:xs) ys | x `elem` ys = Just x\n                  | otherwise = present xs ys \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 789, "user_id": 8120642, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OX8-_3nAbeE/AAAAAAAAAAI/AAAAAAAAAAA/of7PUZBmbk4/photo.jpg?sz=128", "display_name": "hegel5000", "link": "https://stackoverflow.com/users/8120642/hegel5000"}, "is_accepted": false, "score": 1, "last_activity_date": 1519413329, "last_edit_date": 1519413329, "creation_date": 1519412650, "answer_id": 48954624, "question_id": 48952623, "link": "https://stackoverflow.com/questions/48952623/do-block-in-haskell/48954624#48954624", "title": "do block in Haskell", "body": "<p>I'm guessing you're doing this for coursework and you're not allowed to use the standard library.</p>\n\n<p>But in the real world, you typically want some kind of \"set\" object, such as the Haskell standard library's Data.Set.Set.</p>\n\n<pre><code>import qualified Data.Set as S\n\ncommonElems :: (Ord a) =&gt; [a] -&gt; [a] -&gt; [a]\ncommonElems firstList = filter (\\ elem -&gt; S.member elem set)\n  where \n    set = S.fromList firstList\n\nmain :: IO ()\nmain = print $ commonElems [1, 2, 3, 55] [55, 3, 4, 5]\n--[55,3]\n</code></pre>\n\n<p>(Also if you just want the first common element then the function <code>head</code> works.)</p>\n"}], "owner": {"reputation": 158, "user_id": 9146085, "user_type": "registered", "profile_image": "https://graph.facebook.com/2001185663452273/picture?type=large", "display_name": "Taimoor Ali", "link": "https://stackoverflow.com/users/9146085/taimoor-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 48953506, "answer_count": 2, "score": 0, "last_activity_date": 1519413329, "creation_date": 1519404505, "last_edit_date": 1519405128, "question_id": 48952623, "link": "https://stackoverflow.com/questions/48952623/do-block-in-haskell", "title": "do block in Haskell", "body": "<p>I am trying to write a function in Haskell that takes two lists and returns an element common to both.<br>\nI am using the following approach but it gives a parse error and says to put <code>&lt;-</code> statements in a do block. How can I implement the condition in the do block?</p>\n\n<p>What I'm trying:</p>\n\n<pre><code>present (xs)(ys) = concat[ x | x &lt;- xs &amp;&amp; x &lt;-ys ]\n</code></pre>\n"}, {"tags": ["java", "shell", "haskell"], "comments": [{"owner": {"reputation": 2037, "user_id": 6203078, "user_type": "registered", "accept_rate": 94, "profile_image": "https://lh5.googleusercontent.com/-1kcK1F2_6WQ/AAAAAAAAAAI/AAAAAAAACqg/g1VhNXz_0qI/photo.jpg?sz=128", "display_name": "Ami Hollander", "link": "https://stackoverflow.com/users/6203078/ami-hollander"}, "edited": false, "score": 0, "creation_date": 1519402427, "post_id": 48951936, "comment_id": 84910633, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/3936023/printing-runtime-exec-outputstream-to-console\">Printing Runtime exec() OutputStream to console</a>"}, {"owner": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "reply_to_user": {"reputation": 2037, "user_id": 6203078, "user_type": "registered", "accept_rate": 94, "profile_image": "https://lh5.googleusercontent.com/-1kcK1F2_6WQ/AAAAAAAAAAI/AAAAAAAACqg/g1VhNXz_0qI/photo.jpg?sz=128", "display_name": "Ami Hollander", "link": "https://stackoverflow.com/users/6203078/ami-hollander"}, "edited": false, "score": 0, "creation_date": 1519402714, "post_id": 48951936, "comment_id": 84910811, "body": "That Answer did not solve my problem because if I read from another Thread the read() method still returns -1"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "edited": false, "score": 0, "creation_date": 1519403489, "post_id": 48952218, "comment_id": 84911289, "body": "Adding the full path resulted in an error message that it wasnt able to find the specified file. I tried typing in just &quot;ghci&quot; in cmd (that worked) and in the bash VM (that worked as well)."}, {"owner": {"reputation": 5000, "user_id": 8405835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sN3eq.png?s=128&g=1", "display_name": "Abhijit Pritam Dutta", "link": "https://stackoverflow.com/users/8405835/abhijit-pritam-dutta"}, "reply_to_user": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "edited": false, "score": 0, "creation_date": 1519403581, "post_id": 48952218, "comment_id": 84911359, "body": "what it returns in standard ouput?"}, {"owner": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "edited": false, "score": 0, "creation_date": 1519403648, "post_id": 48952218, "comment_id": 84911403, "body": "When I type the keyword &quot;ghci&quot; in my CMD I get this CMD output:  GHCi, version 8.0.1: <a href=\"http://www.haskell.org/ghc/\" rel=\"nofollow noreferrer\">haskell.org/ghc</a>  :? for help Prelude&gt;  Same for bash"}, {"owner": {"reputation": 5000, "user_id": 8405835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sN3eq.png?s=128&g=1", "display_name": "Abhijit Pritam Dutta", "link": "https://stackoverflow.com/users/8405835/abhijit-pritam-dutta"}, "reply_to_user": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "edited": false, "score": 0, "creation_date": 1519404230, "post_id": 48952218, "comment_id": 84911765, "body": "I have modified my answer. First just check with <code>ls</code> command."}, {"owner": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "edited": false, "score": 0, "creation_date": 1519404880, "post_id": 48952218, "comment_id": 84912144, "body": "Thank you for taking your time! Unfortunately my read() method still returns -1 immediately when doing as you said. When I type the ls command in cmd it outputs the appropriate list of directorys  Edit: to clarify: neither the &quot;/myPathToGHCI/ghci 2&gt;&amp;1&quot;  nor the &quot;ls 2&gt;&amp;1&quot; worked"}, {"owner": {"reputation": 5000, "user_id": 8405835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sN3eq.png?s=128&g=1", "display_name": "Abhijit Pritam Dutta", "link": "https://stackoverflow.com/users/8405835/abhijit-pritam-dutta"}, "reply_to_user": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "edited": false, "score": 0, "creation_date": 1519405269, "post_id": 48952218, "comment_id": 84912371, "body": "Check in your program what happening immediately after <code>OutputStream output = p.getOutputStream(); </code> print the whole output stream and check immediately after above line."}, {"owner": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "edited": false, "score": 0, "creation_date": 1519405650, "post_id": 48952218, "comment_id": 84912585, "body": "Did not quite understand what you meant with &quot;check whats happening&quot;. What I did is check if(output == null). Output wasnt null. I did the same with input and it wasnt null as well. When I System out print my output I get the usual object address"}, {"owner": {"reputation": 5000, "user_id": 8405835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sN3eq.png?s=128&g=1", "display_name": "Abhijit Pritam Dutta", "link": "https://stackoverflow.com/users/8405835/abhijit-pritam-dutta"}, "reply_to_user": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "edited": false, "score": 0, "creation_date": 1519406174, "post_id": 48952218, "comment_id": 84912830, "body": "I have modified my answer please see. Add <code>p.waitFor();</code>"}, {"owner": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "edited": false, "score": 0, "creation_date": 1519418433, "post_id": 48952218, "comment_id": 84918556, "body": "Sorry for the late Answer! I had to switch computers because I was in University and using one of the networked PC&#39;s, I tried my original Code on my home PC and it turns out, everything is working as intended... I guess the University prevented process to process communication somehow in this instance. Thank you very much for your time!"}], "tags": [], "owner": {"reputation": 5000, "user_id": 8405835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sN3eq.png?s=128&g=1", "display_name": "Abhijit Pritam Dutta", "link": "https://stackoverflow.com/users/8405835/abhijit-pritam-dutta"}, "is_accepted": true, "score": 2, "last_activity_date": 1519406996, "last_edit_date": 1519406996, "creation_date": 1519403012, "answer_id": 48952218, "question_id": 48951936, "link": "https://stackoverflow.com/questions/48951936/using-haskells-ghci-through-a-java-program/48952218#48952218", "title": "Using Haskell&#39;s GHCI through a Java Program", "body": "<p>It is clear that <code>Process p = r.exec(\"ghci\");</code> did not successful for which <code>read()</code> method always returns a <code>-1</code>. Provide full path and check.</p>\n\n<pre><code>Process p = r.exec(\"/fullpath/ghci  2&gt;&amp;1\");\np.waitFor();//You need to use this line of code\n</code></pre>\n\n<p>For confirmation first execute <code>ls</code> command first</p>\n\n<pre><code>Process p = r.exec(\"ls 2&gt;&amp;1\");\n</code></pre>\n\n<p>Also modify your codes like below and try:-</p>\n\n<pre><code>public static void main(String[] args) throws Exception {\n    Runtime r = Runtime.getRuntime();\n    Process p = r.exec(\"ghci\");\n            p.waitFor();\n    OutputStream output = p.getOutputStream();\n    ByteArrayOutputStream byte1=new ByteArrayOutputStream();\n    output.write(byte1.toByteArray());\n    String result=byte1.toString();\n    System.out.println(result);\n    p.destroy();  \n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8075104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cb86adc8fc1186ece0f8ca54ceee21d?s=128&d=identicon&r=PG&f=1", "display_name": "Mythos", "link": "https://stackoverflow.com/users/8075104/mythos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 48952218, "answer_count": 1, "score": 0, "last_activity_date": 1519406996, "creation_date": 1519402088, "last_edit_date": 1519402883, "question_id": 48951936, "link": "https://stackoverflow.com/questions/48951936/using-haskells-ghci-through-a-java-program", "title": "Using Haskell&#39;s GHCI through a Java Program", "body": "<p>What I would like to do is wrap my Java program around the <code>GHCI</code>.\nIn my mind it should work like this: </p>\n\n<blockquote>\n  <ol>\n  <li>Starting my Java program </li>\n  <li>Write down some Haskell function as Input for Java (i.e. reverse [1,2,3,4])  </li>\n  <li>See the appropriate Haskell Output on my Java Console</li>\n  </ol>\n</blockquote>\n\n<p>Because I did not want to mess around with any language bridges I tried the clumsy way and used the <code>Runtime.exec()</code> approach.</p>\n\n<p>This is my Code:</p>\n\n<pre><code>public static void main(String[] args) throws Exception {\nRuntime r = Runtime.getRuntime();\nProcess p = r.exec(\"ghci\");\nOutputStream output = p.getOutputStream();\noutput.write(\"let x = 5\\r\\n\".getBytes());\noutput.write(\"x\".getBytes());\n\nint tmp;\nString result = \"\";\nwhile ((tmp = p.getInputStream().read()) != -1) {\n  result += (char) tmp;\n}\n\nSystem.out.println(result);\np.destroy();  }\n</code></pre>\n\n<p>My problem here is that the read() method always returns a -1 and I cannot get the output. I dont even know if what I wrote created any Output.</p>\n\n<p>Help would be appreciated. Thanks!</p>\n"}, {"tags": ["haskell", "generics", "types"], "answers": [{"comments": [{"owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "edited": false, "score": 0, "creation_date": 1519408716, "post_id": 48953423, "comment_id": 84914081, "body": "There&#39;s a function for getting a string rep of the constructor, tyConName that I&#39;ve been using for testing constructor types. (still reading your answer)"}, {"owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "edited": false, "score": 0, "creation_date": 1519409331, "post_id": 48953423, "comment_id": 84914335, "body": "Works well thanks. I think the main issue I was having was forgetting to use withTypeable."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1519407589, "creation_date": 1519407589, "answer_id": 48953423, "question_id": 48951745, "link": "https://stackoverflow.com/questions/48951745/printing-dynamic-data/48953423#48953423", "title": "Printing Dynamic Data", "body": "<p>I could only manage to obtain this horrible solution.</p>\n\n<pre><code>{-# LANGUAGE GADTs, ScopedTypeVariables, TypeApplications #-}\n{-# OPTIONS -Wall #-}\n\nimport Type.Reflection\nimport Data.Dynamic\n</code></pre>\n\n<p>Here we define the <code>TyCon</code> for <code>(,)</code> and <code>Int</code>. (I'm pretty sure there must be an easier way.)</p>\n\n<pre><code>pairTyCon :: TyCon\npairTyCon = someTypeRepTyCon (someTypeRep [('a','b')])\n\nintTyCon :: TyCon\nintTyCon = someTypeRepTyCon (someTypeRep [42 :: Int])\n</code></pre>\n\n<p>Then we dissect the <code>Dynamic</code> type. First we check if it is an <code>Int</code>.</p>\n\n<pre><code>showDynamic :: Dynamic -&gt; String\nshowDynamic x = case x of\n   Dynamic tr@(Con k) v | k == intTyCon -&gt;\n      case eqTypeRep tr (typeRep @ Int) of\n        Just HRefl -&gt; show (v :: Int)\n        _ -&gt; error \"It really should be an int\"\n   -- to be continued\n</code></pre>\n\n<p>The above is ugly, since we first pattern match against the <code>TyCon</code> using <code>==</code> instead of pattern matching, which prevents the type refinement of <code>v</code> into an <code>Int</code>. So, we still have to resort to <code>eqTypeRep</code> to perform a second check which we already know has to succeed.</p>\n\n<p>I think it could be made pretty by checking <code>eqTypeRep</code> in advance, for instance. Or <code>fromDyn</code>. It does not matter.</p>\n\n<p>What matters is that the pair case below is even more messy, and can not be made pretty in the same way, as far as I can see.</p>\n\n<pre><code>   -- continuing from above\n   Dynamic tr@(App (App t0@(Con k :: TypeRep p)\n            (t1 :: TypeRep a1))\n            (t2 :: TypeRep a2)) v | k == pairTyCon -&gt;\n      withTypeable t0 $\n      withTypeable t1 $\n      withTypeable t2 $\n      case ( eqTypeRep tr (typeRep @(p a1 a2))\n           , eqTypeRep (typeRep @p) (typeRep @(,))) of\n        (Just HRefl, Just HRefl) -&gt;\n            \"DynamicPair(\"\n            ++ showDynamic (Dynamic t1 (fst v))\n            ++ \", \"\n            ++ showDynamic (Dynamic t2 (snd v))\n            ++ \")\"\n        _ -&gt; error \"It really should be a pair!\"\n   _ -&gt; \"Dynamic: not an int, not a pair\"\n</code></pre>\n\n<p>Above we match the <code>TypeRep</code> so that it represents something of type <code>p a1 a2</code>. We require that the representation of <code>p</code> to be <code>pairTyCon</code>.</p>\n\n<p>As before this does not trigger type refinement, since it is done with <code>==</code> instead of pattern matching. We need to perform another explicit match to force <code>p ~ (,)</code> and another for the final refinement <code>v :: (a1,a2)</code>. Sigh.</p>\n\n<p>Finally, we can take <code>fst v</code> and <code>snd v</code>, turn them into <code>Dynamic</code> once again, and pair them. Effectively, we turned the original <code>x :: Dynamic</code> into something like <code>(fst x, snd x)</code> where both components are <code>Dynamic</code>. Now we can recurse.</p>\n\n<p>I would really like to avoid the <code>error</code>s, but I can not see how to do that at the moment.</p>\n\n<p>The redeeming part is that the approach is very general, and can be easily adapted to other type constructors.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1519440290, "creation_date": 1519440290, "answer_id": 48958820, "question_id": 48951745, "link": "https://stackoverflow.com/questions/48951745/printing-dynamic-data/48958820#48958820", "title": "Printing Dynamic Data", "body": "<p>I like the main idea of the other answer, but it seems to get where it's going in a fairly roundabout way. Here's how I would style the same idea:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\n{-# LANGUAGE TypeApplications #-}\n{-# LANGUAGE GADTs #-}\nimport Type.Reflection\nimport Data.Dynamic\n\nshowDyn :: Dynamic -&gt; String\nshowDyn (Dynamic (App (App (eqTypeRep (typeRep @(,)) -&gt; Just HRefl) ta) tb) (va, vb))\n    = concat [ \"DynamicPair(\"\n             , showDyn (Dynamic ta va)\n             , \",\"\n             , showDyn (Dynamic tb vb)\n             , \")\"\n             ]\nshowDyn (Dynamic (eqTypeRep (typeRep @Integer) -&gt; Just HRefl) n) = show n\nshowDyn (Dynamic tr _) = show tr\n</code></pre>\n\n<p>That first pattern match is quite a mouthful, but after playing with a few different ways of formatting it I'm convinced that there just is no way to make that look good. You can try it in ghci:</p>\n\n<pre><code>&gt; showDyn (toDyn ((3,4), (True, \"hi\")))\n\"DynamicPair(DynamicPair(3,4),DynamicPair(Bool,[Char]))\"\n</code></pre>\n"}], "owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 1, "accepted_answer_id": 48958820, "answer_count": 2, "score": 2, "last_activity_date": 1519440290, "creation_date": 1519401426, "last_edit_date": 1519402463, "question_id": 48951745, "link": "https://stackoverflow.com/questions/48951745/printing-dynamic-data", "title": "Printing Dynamic Data", "body": "<p>I have a system in haskell that uses Data.Dynamic and Type.Reflection to perform inference and calculations. I would like to be able to print the results. </p>\n\n<p>Printing is easy when the type is supplied e.g</p>\n\n<pre><code>foo :: Dynamic -&gt; String\nfoo dyn = case tyConName . someTypeRepTyCon . dynTypeRep $ dyn of\n             \"Int\"  -&gt; show $ fromDyn dyn (0 :: Int)\n             \"Bool\" -&gt; show $ fromDyn dyn True\n             _      -&gt; \"no chance\"\n</code></pre>\n\n<p>But if I want to be able to print tuples, I would have to add a new line for each e.g (Int, Bool), (Bool, Int), (Char, Int, Banana) ....</p>\n\n<p>With the addition of more primitives and larger tuples this quickly becomes impractical. </p>\n\n<p><strong>Is there an algorithmic way to generate strings for this dynamic data, specifically for tuples and lists.</strong></p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "edited": false, "score": 0, "creation_date": 1519403283, "post_id": 48951907, "comment_id": 84911149, "body": "Thanks a lot!  your answer was complete!"}], "tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 1, "last_activity_date": 1519402000, "creation_date": 1519402000, "answer_id": 48951907, "question_id": 48951292, "link": "https://stackoverflow.com/questions/48951292/extract-keys-from-map-in-a-data-type/48951907#48951907", "title": "Extract keys from map in a data type", "body": "<p>There may be a more elegant way to express this, but here is one solution:</p>\n\n<pre><code>  verticesByStatus status (Configuration map graph) = fst &lt;$&gt; (filter ((== status) . snd) $ M.assocs map)\n</code></pre>\n\n<p>So what's happening here? First, we pattern match on the configuration parameter to extract it's two components and assign them to variables <code>map</code> and <code>graph</code>. Now let's break down the right hand side:</p>\n\n<pre><code>  fst &lt;$&gt; (filter ((== status) . snd) $ Map.assocs map)\n                                            ^-- This comes from the Data.Map package and splits a map into a list of tuples of key/value pairs. \n                            ^-- Here, we filter our new list of key/values based on the values, and find only those that match the input status \n  ^-- Last, we fmap the function fst over the whole list to extract only the keys that match your given status\n</code></pre>\n\n<p>Another way to express this function, would be to simplify it through eta-reduction. One way to do that would be to use the <code>configurationMap</code> function to extract that portion of your configuration instead of pattern matching:</p>\n\n<pre><code>  verticesByStatus status = fmap fst . filter ((== status) . snd) . Map.assocs . configurationMap\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "edited": false, "score": 0, "creation_date": 1519408105, "post_id": 48952707, "comment_id": 84913784, "body": "I like your approch, how would you deal with  updateStatus :: Ord v =&gt; v -&gt; Status -&gt; Configuration v -&gt; Configuration v"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "edited": false, "score": 0, "creation_date": 1519408682, "post_id": 48952707, "comment_id": 84914065, "body": "@Phil With <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Lazy.html#v:adjust\" rel=\"nofollow noreferrer\"><code>Map.adjust</code></a>: <code>updateStatus key status config = config { configurationMap = Map.adjust (const status) key (configurationMap config) }</code>. Here, <code>const status</code> is just a tidy way of writing <code>(\\_ -&gt; status)</code>. Note that using <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Lazy.html#v:insert\" rel=\"nofollow noreferrer\"><code>Map.insert</code></a> would be simpler, but it would insert keys in the map if they didn&#39;t exist beforehand, which is probably not what you want."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1519404815, "creation_date": 1519404815, "answer_id": 48952707, "question_id": 48951292, "link": "https://stackoverflow.com/questions/48951292/extract-keys-from-map-in-a-data-type/48952707#48952707", "title": "Extract keys from map in a data type", "body": "<p>There is a <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Lazy.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a> for maps in <code>Data.Map</code>, which can be used directly with your configuration map:</p>\n\n<pre><code>verticesByStatus :: Ord v =&gt; Status -&gt; Configuration v -&gt; [v]\nverticesByStatus status = Map.keys . Map.filter (== status) . configurationMap\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Lazy.html#v:keys\" rel=\"nofollow noreferrer\"><code>Map.keys</code></a> produces a list of the keys in the map. (If you wanted a list of values instead, you might use <code>Map.elems</code> or, equivalently, <code>toList</code> from <code>Data.Foldable</code>. Note that, somewhat confusingly, the latter isn't the same as <code>Map.toList</code>, which produces a list of key-value pairs, just like <code>Map.assocs</code> in jkeuhlen's answer.)</p>\n"}, {"comments": [{"owner": {"reputation": 96, "user_id": 1148753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517d8d64a8a5a6fd57d0c781a3058cb3?s=128&d=identicon&r=PG", "display_name": "DTown", "link": "https://stackoverflow.com/users/1148753/dtown"}, "edited": false, "score": 0, "creation_date": 1519405263, "post_id": 48952796, "comment_id": 84912364, "body": "Posted right after @duplode - I would go with their solution."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519406427, "post_id": 48952796, "comment_id": 84912954, "body": "On <code>isJust</code>/<code>fromJust</code>, indeed there almost always is a nicer solution than squeezing a <code>Maybe</code> into a boolean only to have to rely on the partial <code>fromJust</code> to ultimately handle it. Pattern matching (as in your preferred solution) is an improvement (it is worth noting how the list comprehension silently handles the <code>Nothing</code> case here); another possibility would be using the <code>maybe</code> function instead of the if-then-else in your second solution: <code>maybe False (== status) vStatus</code>"}, {"owner": {"reputation": 96, "user_id": 1148753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517d8d64a8a5a6fd57d0c781a3058cb3?s=128&d=identicon&r=PG", "display_name": "DTown", "link": "https://stackoverflow.com/users/1148753/dtown"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519406740, "post_id": 48952796, "comment_id": 84913116, "body": "Awesome @duplode! I wasn&#39;t aware of the <code>maybe</code> function."}], "tags": [], "owner": {"reputation": 96, "user_id": 1148753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517d8d64a8a5a6fd57d0c781a3058cb3?s=128&d=identicon&r=PG", "display_name": "DTown", "link": "https://stackoverflow.com/users/1148753/dtown"}, "is_accepted": false, "score": 0, "last_activity_date": 1519405144, "creation_date": 1519405144, "answer_id": 48952796, "question_id": 48951292, "link": "https://stackoverflow.com/questions/48951292/extract-keys-from-map-in-a-data-type/48952796#48952796", "title": "Extract keys from map in a data type", "body": "<pre><code>verticesByStatus :: Ord v =&gt; Status -&gt; Configuration v -&gt; [v]\nverticesByStatus status (Configuration cMap cGraph) =\n    [ v\n    | v &lt;- vertices cGraph,\n      Just(status) == (Map.lookup v cMap)]\n</code></pre>\n\n<p>A few notes:</p>\n\n<ul>\n<li><p>I would opt for avoiding <code>Map.assocs</code> because it costs an extra O(n) to run and you can get at the values in your config map without first converting it to a list of tuples (see the <a href=\"https://hackage.haskell.org/package/containers-0.5.11.0/docs/Data-Map-Strict.html%20docs\" rel=\"nofollow noreferrer\">Map docs</a>).</p></li>\n<li><p>I opted for a list comprehension instead of combining <code>map</code> and <code>filter</code> out of personal preference since I find it easier to read (something I picked up after reading <a href=\"https://blog.infinitenegativeutility.com/2017/12/some-notes-about-how-i-write-haskell\" rel=\"nofollow noreferrer\">this article</a>)</p></li>\n<li><p>We could have instead checked if the lookup returned a <code>Just</code> or a <code>Nothing</code> and then extracted the value in the case of a <code>Just</code> using <code>fromJust</code> but that would be more code and probably harder to read. It would look something like:</p>\n\n<pre><code>verticesByStatus :: Ord v =&gt; Status -&gt; Configuration v -&gt; [v]\nverticesByStatus status (Configuration cMap cGraph) =\n    [ v\n    | v &lt;- vertices cGraph,\n      let vStatus = Map.lookup v cMap,\n      if (isJust vStatus) then (status == (fromJust vStatus)) else False]\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 163, "user_id": 6823899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff350e21c6ca08039a039aac7a3c2de2?s=128&d=identicon&r=PG&f=1", "display_name": "Phil", "link": "https://stackoverflow.com/users/6823899/phil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1490, "favorite_count": 0, "accepted_answer_id": 48951907, "answer_count": 3, "score": 0, "last_activity_date": 1519405144, "creation_date": 1519399954, "last_edit_date": 1519404936, "question_id": 48951292, "link": "https://stackoverflow.com/questions/48951292/extract-keys-from-map-in-a-data-type", "title": "Extract keys from map in a data type", "body": "<p>I'm trying to return keys with a certain <code>Status</code> in a data type with many fields. I tried a few things, but nothing is even compiling! Anyone got a tip I could use?</p>\n\n<pre><code>data Configuration v = Configuration {\nconfigurationMap   :: Map.Map v Status,\nconfigurationGraph :: Graph v\n}\n\nverticesByStatus :: Ord v =&gt; Status -&gt; Configuration v -&gt; [v]\nverticesByStatus  ???\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 7297, "user_id": 1176156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89604545aa57aa3d14306af60126e193?s=128&d=identicon&r=PG", "display_name": "MaxGabriel", "link": "https://stackoverflow.com/users/1176156/maxgabriel"}, "edited": false, "score": 0, "creation_date": 1519430226, "post_id": 48950061, "comment_id": 84922650, "body": "In general, avoid using snake case (e.g. <code>json_payload</code>) in your Haskell code"}], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": false, "score": 2, "last_activity_date": 1519397891, "creation_date": 1519397891, "answer_id": 48950627, "question_id": 48950061, "link": "https://stackoverflow.com/questions/48950061/how-to-manipulate-data-from-json-in-yesod/48950627#48950627", "title": "How to manipulate data from json in Yesod?", "body": "<p><code>json_payload</code> is a <code>Person</code>, so you can just use the record update syntax.<br>\nFor instance the value <code>json_payload { age = 32 }</code> has all the fields of <code>json_payload</code> except the <code>age</code> field which is 32.  </p>\n\n<p>So you can rewrite <code>postHomeR</code> as  </p>\n\n<pre><code>postHomeR = do\n  json_payload &lt;- requireJsonBody :: Handler Person\n  let modified = json_payload { age = 32 }\n  returnJson modified\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>postHomeR = do\n  json_payload &lt;- requireJsonBody :: Handler Person\n  returnJson (json_payload { age = 32 })\n</code></pre>\n\n<p>The parentheses are not required but I think it makes it clearer, rather than having to go and check the syntax rules for the precedence.</p>\n"}], "owner": {"reputation": 1, "user_id": 6874692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1071798979607316/picture?type=large", "display_name": "Rafael Klynger", "link": "https://stackoverflow.com/users/6874692/rafael-klynger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519397891, "creation_date": 1519396065, "question_id": 48950061, "link": "https://stackoverflow.com/questions/48950061/how-to-manipulate-data-from-json-in-yesod", "title": "How to manipulate data from json in Yesod?", "body": "<p>If I have this code, how do I change the age of the JSON sent from the post request and then return it?  My experience with Haskell in general is really poor so, I don't know if my problem comes from lacking of knowledge in the Yesod framework of in the language itself.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings     #-}\n{-# LANGUAGE QuasiQuotes           #-}\n{-# LANGUAGE TemplateHaskell       #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeFamilies          #-}\n\nmodule Handler.Home where\nimport Data.Aeson\nimport Data.Text (Text)\nimport Yesod\n\n\ndata HelloWorld = HelloWorld\n\nmkYesod \"HelloWorld\" [parseRoutes|\n/ HomeR GET POST\n|]\n\ninstance Yesod HelloWorld\n\ndata Person = Person\n    { name :: Text\n    , age :: Int\n    } deriving (Eq, Show)\n\ninstance ToJSON Person where\n    toJSON (Person n a)  = object\n        [ \"name\" .= n\n        , \"age\"  .= a\n        ]\n\ninstance FromJSON Person where\n    parseJSON = withObject \"Person\" $ \\v -&gt; Person\n        &lt;$&gt; v .: \"name\"\n        &lt;*&gt; v .: \"age\"\n\ngetHomeR :: Handler Value\ngetHomeR = returnJson $ Person \"Rafael\" 21\n\n\npostHomeR :: Handler Value\npostHomeR = do\n    json_payload &lt;- requireJsonBody :: Handler Person\n    returnJson json_payload\n\nmain :: IO ()\nmain = warp 3000 HelloWorld\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1519393694, "post_id": 48949277, "comment_id": 84904773, "body": "Well in Haskell, every function has exactly <i>one</i> argument. <code>Int -&gt; Int -&gt; Int -&gt; Int</code> is short for <code>Int -&gt; (Int -&gt; (Int -&gt; Int))</code>."}, {"owner": {"reputation": 3477, "user_id": 2989952, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1212591114/picture?type=large", "display_name": "wawa", "link": "https://stackoverflow.com/users/2989952/wawa"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519395558, "post_id": 48949277, "comment_id": 84906086, "body": "I see. So there&#39;s no was to do it then. Would you like to make an answer out of your comment, then I&#39;d gladly accept it."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1519397068, "last_edit_date": 1519397068, "creation_date": 1519396701, "answer_id": 48950262, "question_id": 48949277, "link": "https://stackoverflow.com/questions/48949277/getting-all-function-arguments-in-haskel-as-list/48950262#48950262", "title": "Getting all function arguments in haskel as list", "body": "<blockquote>\n  <p>is there a general way of doing this independent of the number of arguments?</p>\n</blockquote>\n\n<p>Not really; at least it's not worth it. First off, this entire idea isn't very useful because lists are <em>homogeneous</em>: all elements must have the same type, so it only works for the rather unusual special case of functions which only take arguments of a single type.</p>\n\n<p>Even then, the problem is that &ldquo;number of arguments&rdquo; isn't really a sensible concept in Haskell, because as Willem Van Onsem commented, all functions really only have <em>one</em> argument (further arguments are actually only given to the <em>result</em> of the first application, which has again function type).</p>\n\n<p>That said, at least for a single argument- and final-result type, it is quite easy to pack any number of arguments into a list:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances         #-}\n\nclass UsingList f where\n  usingList :: ([Int] -&gt; Int) -&gt; f\n\ninstance UsingList Int where\n  usingList f = f []\n\ninstance UsingList r =&gt; UsingList (Int -&gt; r) where\n  usingList f a = usingList (f . (a:))\n\nfoo :: Int -&gt; Int -&gt; Int -&gt; Int\nfoo = usingList $ (\\[\u03b1,\u03b2,\u03b3] -&gt; \u03b1 + \u03b2 - \u03b3) . sort\n</code></pre>\n\n<p>It's also possible to make this work for any type of the arguments, using type families or a multi-param type class. What's not so simple though is to write it once and for all with variable type of the final result. The reason being, that would also have to handle a <em>function</em> as the type of final result. But then, that could also be intepreted as \u201cwe still need to add one more argument to the list\u201d!</p>\n"}, {"tags": [], "owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "is_accepted": false, "score": 2, "last_activity_date": 1519486926, "creation_date": 1519486926, "answer_id": 48964561, "question_id": 48949277, "link": "https://stackoverflow.com/questions/48949277/getting-all-function-arguments-in-haskel-as-list/48964561#48964561", "title": "Getting all function arguments in haskel as list", "body": "<p>With all respect, I would disagree with <a href=\"https://stackoverflow.com/a/48950262/2108477\">@leftaroundabout's answer above</a>. Something being\nunusual is not a reason to shun it as unworthy.</p>\n\n<p>It is correct that you would not be able to define a <em>polymorphic variadic list constructor</em>\nwithout type annotations. However, we're not usually dealing with Haskell 98, where type\nannotations were never required. With <a href=\"https://ghc.haskell.org/trac/ghc/wiki/DependentHaskell\" rel=\"nofollow noreferrer\">Dependent Haskell</a> just around the corner, some\nfamiliarity with non-trivial type annotations is becoming vital.</p>\n\n<p>So, let's take a shot at this, disregarding worthiness considerations.</p>\n\n<hr>\n\n<p>One way to define a function that does not seem to admit a single type is to make it a method of a\nsuitably constructed class. Many a trick involving type classes were devised by cunning\nHaskellers, starting at least as early as <a href=\"https://mail.haskell.org/pipermail/haskell/2003-April/011621.html\" rel=\"nofollow noreferrer\">15 years ago</a>. Even if we don't understand their\ntype wizardry in all its depth, we may still try our hand with a similar approach.</p>\n\n<p>Let us first try to obtain a method for summing any number of Integers. That means repeatedly\napplying a function like <code>(+)</code>, with a uniform type such as <code>a -&gt; a -&gt; a</code>. Here's one way to do\nit:</p>\n\n<pre><code>class Eval a where\n    eval :: Integer -&gt; a\n\ninstance (Eval a) =&gt; Eval (Integer -&gt; a) where\n    eval i = \\y -&gt; eval (i + y)\n\ninstance Eval Integer where\n    eval i = i\n</code></pre>\n\n<p>And this is the extract from repl:</p>\n\n<pre><code>\u03bb eval 1 2 3 :: Integer\n6\n</code></pre>\n\n<p>Notice that we can't do without explicit type annotation, because the very idea of our approach is\nthat an expression <code>eval x1 ... xn</code> may either be a function that waits for yet another argument,\nor a final value. </p>\n\n<p>One generalization now is to actually make a list of values. The science <a href=\"https://math.stackexchange.com/q/58553/278244\">tells us</a> that\nwe may derive any monoid from a list. Indeed, insofar as sum is a monoid, we may turn arguments to\na list, then sum it and obtain the same result as above.</p>\n\n<p>Here's how we can go about turning arguments of our method to a list:</p>\n\n<pre><code>class Eval a where\n    eval2 :: [Integer] -&gt; Integer -&gt; a\n\ninstance (Eval a) =&gt; Eval (Integer -&gt; a) where\n    eval2 is i = \\j -&gt; eval2 (i:is) j\n\ninstance Eval [Integer] where\n    eval2 is i = i:is\n</code></pre>\n\n<p>This is how it would work:</p>\n\n<pre><code>\u03bb eval2 [] 1 2 3 4 5 :: [Integer]\n[5,4,3,2,1]\n</code></pre>\n\n<p>Unfortunately, we have to make <code>eval</code> binary, rather than unary, because it now has to compose two\ndifferent things: a (possibly empty) list of values and the next value to put in. Notice how it's\nsimilar to the usual <code>foldr</code>:</p>\n\n<pre><code>\u03bb foldr (:) [] [1,2,3,4,5]\n[1,2,3,4,5]\n</code></pre>\n\n<p>The next generalization we'd like to have is allowing arbitrary types inside the list. It's a bit\ntricky, as we have to make <code>Eval</code> a 2-parameter type class:</p>\n\n<pre><code>class Eval a i where\n    eval2 :: [i] -&gt; i -&gt; a\n\ninstance (Eval a i) =&gt; Eval (i -&gt; a) i where\n    eval2 is i = \\j -&gt; eval2 (i:is) j\n\ninstance Eval [i] i where\n    eval2 is i = i:is\n</code></pre>\n\n<p>It works as the previous with <code>Integer</code>s, but it can also <em>carry</em> any other type, even a function:</p>\n\n<p><em>(I'm sorry for the messy example. I had to <code>show</code> a function somehow.)</em></p>\n\n<pre><code>\u03bb ($ 10) &lt;$&gt; (eval2 [] (+1) (subtract 2) (*3) (^4) :: [Integer -&gt; Integer])\n[10000,30,8,11]\n</code></pre>\n\n<p>So far so good: we can convert any number of arguments into a list. However, it will be hard to\ncompose this function with the one that would do useful work with the resulting list, because\ncomposition only admits unary functions \u2212 with some trickery, binary ones, but in no way the\nvariadic. Seems like we'll have to define our own way to compose functions. That's how I see it:</p>\n\n<pre><code>class Ap a i r where\n    apply :: ([i] -&gt; r) -&gt; [i] -&gt; i -&gt; a\n    apply', ($...) :: ([i] -&gt; r) -&gt; i -&gt; a\n    ($...) = apply'\n\ninstance Ap a i r =&gt; Ap (i -&gt; a) i r where\n    apply f xs x = \\y -&gt; apply f (x:xs) y\n    apply' f x = \\y -&gt; apply f [x] y\n\ninstance Ap r i r where\n    apply f xs x = f $ x:xs\n    apply' f x = f [x]\n</code></pre>\n\n<p>Now we can write our desired function as an application of a list-admitting function to any number\nof arguments:</p>\n\n<pre><code>foo' :: (Num r, Ord r, Ap a r r) =&gt; r -&gt; a\nfoo' = (g $...)\n    where f = (\\result -&gt; (result !! 0) + (result !! 1) - (result !! 2))\n          g = f . sort\n</code></pre>\n\n<p>You'll still have to type annotate it at every call site, like this:</p>\n\n<pre><code>\u03bb foo' 4 5 10 :: Integer\n-1\n</code></pre>\n\n<p>\u2212 But so far, that's the best I can do.</p>\n\n<p>&nbsp;</p>\n\n<hr>\n\n<p>The more I study Haskell, the more I am certain that nothing is impossible.</p>\n"}], "owner": {"reputation": 3477, "user_id": 2989952, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1212591114/picture?type=large", "display_name": "wawa", "link": "https://stackoverflow.com/users/2989952/wawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 0, "accepted_answer_id": 48950262, "answer_count": 2, "score": 3, "last_activity_date": 1519486926, "creation_date": 1519393594, "question_id": 48949277, "link": "https://stackoverflow.com/questions/48949277/getting-all-function-arguments-in-haskel-as-list", "title": "Getting all function arguments in haskel as list", "body": "<p>Is there a way in haskell to get all function arguments as a list.</p>\n\n<p>Let's supose we have the following program, where we want to add the two smaller numbers and then subtract the largest. Suppose, we can't change the function definition of <code>foo :: Int -&gt; Int -&gt; Int -&gt; Int</code>. Is there a way to get all function arguments as a list, other than constructing a new list and add all arguments as an element of said list? More importantly, is there a general way of doing this independent of the number of arguments?  </p>\n\n<p>Example: </p>\n\n<pre><code>module Foo where\n    import Data.List\n\n    foo :: Int -&gt; Int -&gt; Int -&gt; Int\n    foo a b c = result!!0 + result!!1 - result!!2 where result = sort ([a, b, c])\n</code></pre>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519384754, "post_id": 48939727, "comment_id": 84899606, "body": "Probably there&#39;s some interesting stuff to be said about this, but I&#39;m confused what you mean. Coyoneda takes a functor and gives you a functor (basically <i>the same functor</i>), whereas <code>Free</code> takes a <i>class</i> and gives you a new functor. What&#39;s <i>not</i> different between them?"}, {"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519399358, "post_id": 48939727, "comment_id": 84908666, "body": "Coyoneda for some structure works even if structure isn&#39;t functor unlike of Yoneda"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519399705, "post_id": 48939727, "comment_id": 84908881, "body": "it doesn&#39;t use <i>the functor instance</i>, but still the lemma is effectively about the functor-to-functor transformation. <code>Free</code> is based on no such thing."}, {"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1519403818, "post_id": 48939727, "comment_id": 84911506, "body": "Also maybe it related <a href=\"http://hackage.haskell.org/package/adjunctions-4.4/docs/Data-Functor-Adjunction.html#t:Adjunction\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/adjunctions-4.4/docs/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 1, "creation_date": 1519483977, "post_id": 48961587, "comment_id": 84934002, "body": "That nice! But also will be better some code examples for explanations. And thanks for your answer!"}], "tags": [], "owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "is_accepted": false, "score": 11, "last_activity_date": 1519466686, "creation_date": 1519466686, "answer_id": 48961587, "question_id": 48939727, "link": "https://stackoverflow.com/questions/48939727/what-is-difference-between-coyoneda-and-free-functors/48961587#48961587", "title": "What is difference between Coyoneda and free-functors", "body": "<p>The key here is to understand what it means for a type constructor <em>not</em> to be a functor. It means that it's defined on objects and not on morphisms. But we can describe it as a functor too, if we choose a different source category. For every category C, you can define a discrete category |C|, which has the same objects as C, but no morphisms other than the identity morphisms. A \"non-functor\" is just a functor from |C| to C. There is a trivial injection functor J from |C| to C that is identity on objects and morphisms (of which there are only identity morphisms). So let's see:</p>\n\n<p>Coyoneda is defined as a left Kan extension of a functor f along the identity functor. It requires f to be a functor.</p>\n\n<p>Free functor looks like Coyoneda, but it's really the left Kan extension of a functor f from |C| to C along J. Strictly speaking J is not identity, but it's close enough, hence the abuse of notation.</p>\n\n<p>The free functor from Sjoerd Visscher's library extends this idea even further. Roughly speaking, a type class in Haskell defines a subcategory of Hask. His free functor is then the left Kan extension of a functor f from that subcategory (or the discrete version of it) to Hask, along the injection of that subcategory into Hask.</p>\n"}], "owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1011, "favorite_count": 6, "answer_count": 1, "score": 5, "last_activity_date": 1519466686, "creation_date": 1519348480, "question_id": 48939727, "link": "https://stackoverflow.com/questions/48939727/what-is-difference-between-coyoneda-and-free-functors", "title": "What is difference between Coyoneda and free-functors", "body": "<p>As I know we can derive functor for free via Coyoneda.\nBut exists some haskell package <a href=\"http://hackage.haskell.org/package/free-functors\" rel=\"noreferrer\">http://hackage.haskell.org/package/free-functors</a></p>\n\n<p>And my question, what is difference between Coyoneda and <a href=\"http://hackage.haskell.org/package/free-functors-0.8.1/docs/src/Data-Functor-Free.html#Free\" rel=\"noreferrer\">http://hackage.haskell.org/package/free-functors-0.8.1/docs/src/Data-Functor-Free.html#Free</a></p>\n"}, {"tags": ["string", "list", "haskell", "grouping"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1519335141, "post_id": 48937401, "comment_id": 84882014, "body": "That is the first assignment in the book? Perhaps you could start with writing a function signature"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9398745"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519335810, "post_id": 48937401, "comment_id": 84882375, "body": "i have seen function signatures such as int-&gt;int-&gt;bool, but i dont understand how to start off writing a program using that."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519336372, "post_id": 48937401, "comment_id": 84882627, "body": "well basically a program <i>is</i> a function: it turns input into output. But I would ignore that for now, you can see Haskell first as a query language, and thus implement simply a function. What is not clear about the signatures?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9398745"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519337520, "post_id": 48937401, "comment_id": 84883094, "body": "i have been recommended to use hoogle website for haskell, lets just say we have the signature Int -&gt; Int -&gt; Bool, what signature would i use for the program i am trying to make?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1519338111, "post_id": 48937401, "comment_id": 84883327, "body": "@JoeKash: I don&#39;t follow, what do you mean with &quot;<i>lets just say we have a signature <code>Int -&gt; Int -&gt; Bool</code></i>&quot;? Do you know what a signature means?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 1, "creation_date": 1519339403, "post_id": 48937401, "comment_id": 84883796, "body": "Could you explain in a little more detail what your function should do?  Do you want it to take a string like <code>&quot;hello there!&quot;</code> and break it into, say, 3-character substrings, like <code>[&quot;hel&quot;, &quot;lo &quot;, &quot;the&quot;, &quot;re!&quot;]</code> ?  If you edited your question to add an example, it would help."}], "answers": [{"tags": [], "owner": {"reputation": 333, "user_id": 5863981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TU6uQ.jpg?s=128&g=1", "display_name": "TheJohnMajor01", "link": "https://stackoverflow.com/users/5863981/thejohnmajor01"}, "is_accepted": false, "score": 0, "last_activity_date": 1519400168, "creation_date": 1519400168, "answer_id": 48951357, "question_id": 48937401, "link": "https://stackoverflow.com/questions/48937401/grouping-a-string-into-a-list-of-substrings-of-a-certain-size/48951357#48951357", "title": "Grouping a string into a list of substrings of a certain size", "body": "<p>The question is a little vague but what it sounds like you want is a function that takes a int and a string and then returns a list of strings the length of the int.</p>\n\n<p>First work out the type of your function.</p>\n\n<pre><code>Int -&gt; String -&gt; [String]\n</code></pre>\n\n<p>Prelude has a function called splitAt that will take an int and break a list into a pair. e.g. </p>\n\n<pre><code>splitAt 3 \"123456789\" = (\"123\", \"456789\")\n</code></pre>\n\n<p>You can use this recursivley to create the function you want.</p>\n\n<pre><code>foo :: Int -&gt; String -&gt; [String]\nfoo i \"\"  = []\nfoo i str = let (x, y) = splitAt i str\n            in x : foo i y\n\nfoo 3 \"123456789\" = [\"123\", \"456\", \"789\"]\n</code></pre>\n\n<p>Note that splitAt works on any list and that a string is just a list of characters.</p>\n\n<p>Because of this you can write a more general function that'll work with any list you give it.</p>\n\n<pre><code>goo :: Int -&gt; [a] -&gt; [[a]]\ngoo i []  = []\ngoo i xs = let (x, y) = splitAt i xs\n            in x : goo i y \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 96, "user_id": 1148753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/517d8d64a8a5a6fd57d0c781a3058cb3?s=128&d=identicon&r=PG", "display_name": "DTown", "link": "https://stackoverflow.com/users/1148753/dtown"}, "is_accepted": false, "score": 0, "last_activity_date": 1519406438, "creation_date": 1519406438, "answer_id": 48953140, "question_id": 48937401, "link": "https://stackoverflow.com/questions/48937401/grouping-a-string-into-a-list-of-substrings-of-a-certain-size/48953140#48953140", "title": "Grouping a string into a list of substrings of a certain size", "body": "<p>I realize you're looking to write this function yourself. Just for reference, Haskell has a built-in function in the <code>Data.List.Split</code> package called <code>chunksOf</code> (see the docs <a href=\"https://hackage.haskell.org/package/split-0.2.3.3/docs/Data-List-Split.html#v:chunksOf\" rel=\"nofollow noreferrer\">here</a>). Let's turn to the GHCI repl to see it in practice:</p>\n\n<pre><code>&gt; Prelude &gt; import Data.List.Split\n&gt; Prelude Data.List.Split &gt; chunksOf 3 \"abcdefg\"\n     [\"abc\",\"def\",\"g\"]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9398745"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 361, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1519505600, "creation_date": 1519334494, "last_edit_date": 1519334628, "question_id": 48937401, "link": "https://stackoverflow.com/questions/48937401/grouping-a-string-into-a-list-of-substrings-of-a-certain-size", "title": "Grouping a string into a list of substrings of a certain size", "body": "<p>I have picked up a Haskell book and been writing functions, I am trying to write a function that takes a string and then creates a list of substrings and can choose how many letters you want in each substring.</p>\n\n<p>I've only just started Haskell so not really sure at all where to start.</p>\n\n<p>I have tried using the group function but the whole concept is very confusing to me. and another function called break which apparently breaks however it only creates a tuple of two lists from the original one separated at condition boundary</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "answers": [{"comments": [{"owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 1, "creation_date": 1519334384, "post_id": 48935016, "comment_id": 84881606, "body": "I&#39;m talking about <code>ghc-pkg</code> not <code>ghc</code>.  <code>-package-db</code> (with one leading <code>-</code>) <i>is</i> mentioned in <code>man ghc</code>.  <code>--package-db</code> (with two) is <i>not</i> mentioned in <code>man ghc-pkg</code>."}, {"owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "reply_to_user": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "edited": false, "score": 0, "creation_date": 1519370054, "post_id": 48935016, "comment_id": 84892416, "body": "Oh, sorry, I missed that. In that case you probably should create a ticket on their track."}], "tags": [], "owner": {"reputation": 13626, "user_id": 492865, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c69a2080e68c8606961a18aba3a08ec?s=128&d=identicon&r=PG", "display_name": "Yuras", "link": "https://stackoverflow.com/users/492865/yuras"}, "is_accepted": false, "score": 2, "last_activity_date": 1519325009, "creation_date": 1519325009, "answer_id": 48935016, "question_id": 48934259, "link": "https://stackoverflow.com/questions/48934259/undocumented-ghc-flags-fbuilding-cabal-package-and-package-db/48935016#48935016", "title": "Undocumented GHC flags -fbuilding-cabal-package and --package-db", "body": "<p><code>--package-db</code> is documented in the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/packages.html?highlight=package-db#ghc-flag--package-db%20%E2%9F%A8file%E2%9F%A9\" rel=\"nofollow noreferrer\">user guide</a>. It is indeed similar to the old <code>--package-conf</code> flag, see <a href=\"https://downloads.haskell.org/~ghc/7.0-latest/docs/html/users_guide/packages.html#package-databases\" rel=\"nofollow noreferrer\">user guide for older ghc</a>.</p>\n\n<p><code>-fbuilding-cabal-package</code> is indeed undocumented, there is a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9358\" rel=\"nofollow noreferrer\">ticket</a> about that. It is designed to be used by cabal only. It changes few <a href=\"https://github.com/ghc/ghc/blob/f63bc730c7ea42ca6882f8078eb86be8bf1cc6ad/compiler/main/GhcMake.hs#L203\" rel=\"nofollow noreferrer\">compiler messages</a> to look more clear when building package using cabal.</p>\n"}], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1519325009, "creation_date": 1519322374, "question_id": 48934259, "link": "https://stackoverflow.com/questions/48934259/undocumented-ghc-flags-fbuilding-cabal-package-and-package-db", "title": "Undocumented GHC flags -fbuilding-cabal-package and --package-db", "body": "<p>The output of <code>cabal build --verbose</code> mentions flags that are not documented in the man pages.  GHC is given a flag <code>-fbuilding-cabal-package</code>.  <code>ghc-pkg</code> is given a flag <code>--package-db</code>.  My guess is that the latter is a synonym for <code>--package-conf</code>.  Am I right?  And what is the former?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "is_accepted": true, "score": 6, "last_activity_date": 1519325089, "last_edit_date": 1519325089, "creation_date": 1519323824, "answer_id": 48934680, "question_id": 48934226, "link": "https://stackoverflow.com/questions/48934226/haskell-difficulty-with-fromlist/48934680#48934680", "title": "Haskell : difficulty with fromList", "body": "<p><code>t3 userid = DL.nub $</code> immediately says that what you receive in <code>t3</code> is a list, because its signature is <code>[A] -&gt; [A]</code>. Now look at the second line, where <code>t3</code> goes.</p>\n\n<p>Things would be much simpler if you split your large function into a few smaller, <em>descriptively named</em>  functions. At least you could <code>:t thatFunctionName</code> to check types as you go, if you don't want to write them explicitly.</p>\n"}], "owner": {"reputation": 289, "user_id": 9189009, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8867132937b784622d8bdc154e230b2?s=128&d=identicon&r=PG&f=1", "display_name": "Alexia Desouza", "link": "https://stackoverflow.com/users/9189009/alexia-desouza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 48934680, "answer_count": 1, "score": -2, "last_activity_date": 1519325089, "creation_date": 1519322243, "question_id": 48934226, "link": "https://stackoverflow.com/questions/48934226/haskell-difficulty-with-fromlist", "title": "Haskell : difficulty with fromList", "body": "<pre><code>testing4 = Map.fromList\n          (fmap (\\(userid,email)-&gt;( User {userId=userid,userEmail=email},( (t2 userid), (t3 userid)   ))) userList)\n          where\n          t2 userid= fmap (\\(_,ppid,pact,pclas,pdes)-&gt; Permission {permissionId=ppid,permissionAction=pact,permissionClass=pclas,permissionDescripton=pdes}\n                ) (DL.filter (\\(puid,_,_,_,_)-&gt; userid == puid) individualPermissions)\n\n          t3 userid =DL.nub $ fmap (\\(_,rid,_)-&gt;\n                                Map.fromList ( \n                                    fmap (\\ (_,rrid,rrname) -&gt; \n                                                    (Role {roleId=rrid,roleName=rrname},\n                                                        fmap (\\(_,_,ppid1,pact1,pclas1,pdes1)-&gt; \n                                                                    Permission{permissionId=ppid1,permissionAction=pact1,permissionClass=pclas1,permissionDescripton=pdes1})\n                                                                                    (DL.filter (\\(plUID,plRID,_,_,_,_)-&gt; plUID == userid &amp;&amp; plRID == rrid) permissionList)  )\n                                                )  (DL.filter (\\(ruid,_,_) -&gt; ruid == userid &amp;&amp; (case rid of\n                                                                                                        Just _ -&gt; True\n                                                                                                        Nothing -&gt; False)\n                                                                                                    ) roleList)\n                                            ) \n                                        ) rolePermissions\n</code></pre>\n\n<p>i want this function of type Map User ([Permission], Map Role [Permission]) but im getting it as  Map User ([Permission], [Map Role [Permission]])</p>\n\n<p>here is the code with data <a href=\"http://lpaste.net/362797\" rel=\"nofollow noreferrer\">http://lpaste.net/362797</a> </p>\n\n<p>(i had posted this earliar but then deleted and corrected it as some people suggested)</p>\n"}, {"tags": ["haskell", "pattern-matching", "template-haskell", "quasiquotes"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1519322523, "post_id": 48932034, "comment_id": 84875173, "body": "I think <code>lookupValueName</code> considers variables in scope just <i>outside</i> the splice, and not the ones which are being defined within the pattern. E.g. <code>eval (Add x [expr| ... |]) = ...</code> can see <code>x</code>. You&#39;ll have to find the variables defined <i>within</i> the pattern-sllice on your own."}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1519351130, "creation_date": 1519315643, "last_edit_date": 1519351130, "question_id": 48932034, "link": "https://stackoverflow.com/questions/48932034/non-linear-patterns-in-quasi-quotes", "title": "Non linear patterns in quasi-quotes", "body": "<p>I followed <a href=\"https://www.schoolofhaskell.com/user/marcin/quasiquotation-101\" rel=\"nofollow noreferrer\">this tutorial</a> to implement a quasi quoted DSL, and I now want to support <a href=\"https://stackoverflow.com/a/35892473/3694032\">non-linear patterns</a> in a quoted pattern. That will allow a repeated binder in a pattern to assert the equality of the matched data. For example, one can then write <code>eval [expr| $a + $a|] = 2 * eval a</code>. I modified <code>antiExprPat</code> as follows: </p>\n\n<pre><code>antiExpPat (MetaExp s) = \n  Just (do b &lt;- lookupValueName s\n           let n = mkName s\n               p0 = VarP n\n               p1 &lt;- (viewP [|(== $(varE n))|] [p|True|])\n           let res = case b of Nothing -&gt; p0\n                               _ -&gt; p1\n           return res)\nantiExpPat _ = Nothing\n</code></pre>\n\n<p>The idea is to use <a href=\"http://hackage.haskell.org/package/template-haskell-2.12.0.0/docs/Language-Haskell-TH-Syntax.html#v:lookupValueName\" rel=\"nofollow noreferrer\"><code>lookupValueName</code></a> to check if the anti-quoted name <code>s</code> is in scope. If not, then just create a binder with the same name. Otherwise, create a <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ViewPatterns\" rel=\"nofollow noreferrer\">view pattern</a> <code>(== s) -&gt; True</code> that asserts the matched data equals to the data already bound to <code>s</code>. Essentially, I want to convert the quoted pattern <code>[expr| $a + $a |]</code> to the Haskell pattern <code>(Add a ((== a) -&gt; True))</code>. </p>\n\n<p>But that didn't work. The resulting Haskell pattern is <code>Add a a</code>, which means <code>lookupValueName</code> never thinks <code>a</code> is in scope. Am I misunderstanding how <code>lookupValueName</code> works? Or is there a better way to implement non linear patterns here? </p>\n\n<p>The full code is <a href=\"https://github.com/remysucre/google/blob/master/src/JQQ.hs\" rel=\"nofollow noreferrer\">here</a> if you want to play with it. In short, I'm making a quasi quoter to match on Java source. </p>\n\n<hr>\n\n<p><strong>Update 1:</strong></p>\n\n<p>As @chi pointed out, <code>lookupValueName</code> only checks for the splice's <em>context</em>, whereas I need to check for the splice's <em>content</em>. Any idea how to proceed with that? </p>\n\n<hr>\n\n<p><strong>Update 2:</strong></p>\n\n<p>So I bit the bullet and threaded the set of in-scope names with a state monad, and traversed the parse tree with <a href=\"https://hackage.haskell.org/package/uniplate-1.6.12/docs/Data-Generics-Uniplate-DataOnly.html#v:transformM\" rel=\"nofollow noreferrer\"><code>transformM</code></a> which replaces every in-scope meta-variable <code>x</code> with <code>((== x) -&gt; True)</code>: </p>\n\n<pre><code>dataToPatQ (const Nothing `extQ` ...) (evalState (rename s) DS.empty)\n...\nrename :: Language.Java.Syntax.Stmt -&gt; State (DS.Set String) Language.Java.Syntax.Stmt\nrename p = transformM rnvar p\n  where rnvar (MetaStmt n) = do s &lt;- get\n                                let res = if DS.member n s \n                                          then (SAssertEq n) \n                                          else (MetaStmt n)\n                                put (DS.insert n s)\n                                return res\n        rnvar x = return x\n</code></pre>\n\n<p>It got the right result on the inputs I have, but I have no idea if it is correct, especially given <code>transformM</code> traverses the tree bottom-up so inner meta-variables may be added to the set first. </p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1519303665, "creation_date": 1519303665, "answer_id": 48927827, "question_id": 48927421, "link": "https://stackoverflow.com/questions/48927421/is-making-this-getindex-optic-possible/48927827#48927827", "title": "Is making this `getIndex` optic possible?", "body": "<p>The index is defined arbitrarily by the getter, so there is no universal way to create one.</p>\n\n<p><code>IndexedGetter i s i</code> is isomorphic to <code>s -&gt; (i, i)</code>, via the following bijection:</p>\n\n<pre><code>ito   :: (s -&gt; (i, a)) -&gt; IndexedGetter i s a\niview :: IndexedGetter i s a -&gt; s -&gt; (i, a)\n</code></pre>\n\n<p><code>forall s i. IndexedGetter i s i</code> (the fully quantified type of <code>getIndex</code>) would be isomorphic to <code>forall s i. s -&gt; (i, i)</code>, but that's not inhabited (it would imply <code>() -&gt; (Void, Void)</code> with <code>s ~ ()</code> and <code>i ~ Void</code>).</p>\n"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 48927827, "answer_count": 1, "score": 1, "last_activity_date": 1519303665, "creation_date": 1519302456, "question_id": 48927421, "link": "https://stackoverflow.com/questions/48927421/is-making-this-getindex-optic-possible", "title": "Is making this `getIndex` optic possible?", "body": "<p>Is it possible to make an optic with the following type:</p>\n\n<pre><code>getIndex :: Lens.IndexedGetter i a i\n</code></pre>\n\n<p>I couldn't find an existing one and in unsuccessfully trying to write one I got a feeling that it can't be done, but if that's the case I would like to know the explanation for why that is.</p>\n"}, {"tags": ["haskell", "math"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 1, "creation_date": 1519305144, "post_id": 48927396, "comment_id": 84862811, "body": "What&#39;s your question?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1519307209, "post_id": 48927396, "comment_id": 84864380, "body": "I think that it is obvious"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 4, "creation_date": 1519308118, "post_id": 48927396, "comment_id": 84865117, "body": "@aprendiendo-a-programar No, you just said what you want to achieve in the end and appended a code dump; You didn&#39;t actually say what your problem was."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1519305260, "creation_date": 1519305260, "answer_id": 48928357, "question_id": 48927396, "link": "https://stackoverflow.com/questions/48927396/obtain-lowest-power-of-two-with-a-given-leading-digit/48928357#48928357", "title": "Obtain lowest power of two with a given leading digit", "body": "<p><code>k &lt;- [0..]</code> is not something you can write in a <code>where</code> block. <code>where</code> blocks just <em>define</em> stuff, possibly depending on parameters from the enclosing scope, but they can't handle such \u201clooping constructs\u201d. Nor can you use equations as conditionals there, such as <code>(head . cifras) m = n</code>. Both of this would be more like <em>logic programming</em>, but Haskell is functional instead, i.e. it doesn't solve propositions but simply assigns functional equations. I.e. all <code>=</code> lines must be of the form</p>\n\n<pre><code>newVariableOrFunction \u3018..arguments..\u3019 = some expression that can be computed\n</code></pre>\n\n<p>You can write something looking very similar to your original code though by using a <em>list comprehension</em>, i.e. you basically quantify explicitly over all the conceivable values. Like</p>\n\n<pre><code>lowestPower n = head\n  [ (k,m)\n  | k &lt;- [0..]\n  , let m = 2^k\n  , (head . cifras) m == n\n  ]\n</code></pre>\n\n<p>Since that list comprehension is basically just a way of implementing a loop, it's somewhat more natural to just define the function by recursion though.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9183739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519305260, "creation_date": 1519302386, "last_edit_date": 1519304759, "question_id": 48927396, "link": "https://stackoverflow.com/questions/48927396/obtain-lowest-power-of-two-with-a-given-leading-digit", "title": "Obtain lowest power of two with a given leading digit", "body": "<p>I have to define <code>lowestPower</code> such that</p>\n\n<pre><code>lowestPower           :: Integer -&gt; (Integer,Integer)\n</code></pre>\n\n<p><code>lowestPower n</code> is the pair <code>(k, m)</code> where <code>m</code> is the lowest power of 2 whose decimal representation begins with the digit <code>n</code> and <code>k</code> is its exponent (i. e. <code>2^k = m</code>). For example, </p>\n\n<pre><code> lowestPower 3             ==  (5,32)\n lowestPower 7             ==  (46,70368744177664)\n fst (lowestPower 982)     ==  3973\n</code></pre>\n\n<p>I have tried this:</p>\n\n<pre><code>lowestPower :: Integer -&gt; (Integer,Integer)\nlowestPower n = (k,m)\n  where\n    k &lt;- [0..]\n    (head . cifras) m = n\n    2^k = m\n\ncifras :: Integer -&gt; [Integer]\ncifras n = [read[d] | d &lt;- show n]\n</code></pre>\n"}, {"tags": ["haskell", "type-conversion", "bytestring", "overloaded-strings"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1519289764, "post_id": 48922194, "comment_id": 84852615, "body": "In short, no automatic conversions happen in Haskell at all. All conversions are done explicitly."}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1519287155, "creation_date": 1519287155, "answer_id": 48922455, "question_id": 48922194, "link": "https://stackoverflow.com/questions/48922194/why-isnt-bytestring-converted-automatically-to-filepath/48922455#48922455", "title": "Why isn&#39;t ByteString converted automatically to FilePath?", "body": "<p>IIRC, the <code>OverloadedStrings</code> extension doesn't enable magical conversion between different types of data. What it does is that when you write a string literal like <code>\"foo\"</code>, the compiler can treat that literal as not only a <code>String</code>, but also as a <code>ByteString</code>.</p>\n\n<p>You probably need something like <code>unpack</code> to convert <code>ByteString</code> to <code>String</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1519306652, "post_id": 48923211, "comment_id": 84863954, "body": "But do note that <code>unpack</code> is simply wrong for most encodings. And of course also beware that the meaning of a <code>FilePath</code> <i>also</i> depends on an encoding setting that&#39;s hidden behind the scenes. If you are on Linux, you can avoid a lot of headaches by simply using a file API that uses <code>ByteString</code> for the name of its files in the first place."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 13, "last_activity_date": 1519298704, "last_edit_date": 1519298704, "creation_date": 1519289885, "answer_id": 48923211, "question_id": 48922194, "link": "https://stackoverflow.com/questions/48922194/why-isnt-bytestring-converted-automatically-to-filepath/48923211#48923211", "title": "Why isn&#39;t ByteString converted automatically to FilePath?", "body": "<p>The <code>{-# LANGUAGE OverloadedStrings #-}</code> pragma only works for <em>string literals</em>, like <code>\"a string\"</code>. In that case, Haskell implicitly places a <code>fromString</code> before every string literal, so it rewrites a string <em>literal</em> as <code>\"a string\"</code> to <code>fromString \"a string\"</code>. This only happens for <em>literals</em>.</p>\n\n<p>In Haskell, as far as I know, there are <em>no</em> implicit conversions. Conversions between for instance <code>Int</code> and <code>Float</code> are all explicit.</p>\n\n<p>Furthermore note that the <a href=\"http://hackage.haskell.org/package/base-4.10.1.0/docs/Data-String.html#t:IsString\" rel=\"noreferrer\"><strong><code>IsString</code></strong></a> typeclass only has a function <code>fromString :: String -&gt; a</code>. So that means it works only from a string to that instance (here <code>ByteString</code>), not the other way around.</p>\n\n<p>You can use the <a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.2/docs/Data-ByteString-Char8.html#v:unpack\" rel=\"noreferrer\"><strong><code>unpack :: ByteString -&gt; String</code></strong></a> to convert the <code>ByteString</code> to a <code>String</code>.</p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 48923211, "answer_count": 2, "score": 4, "last_activity_date": 1519298704, "creation_date": 1519286091, "question_id": 48922194, "link": "https://stackoverflow.com/questions/48922194/why-isnt-bytestring-converted-automatically-to-filepath", "title": "Why isn&#39;t ByteString converted automatically to FilePath?", "body": "<p>I'm passing a (strict) <code>ByteString</code> to something expecting a <code>System.IO.FilePath</code>, which is declared as <code>type FilePath = String</code>. I'm also using <code>{-# LANGUAGE OverloadedStrings #-}</code>. I've had conversions in some places happen automatically, but here it does not. What have I got wrong?</p>\n\n<pre><code>Main.hs:33:40: error:\n    \u2022 Couldn't match type \u2018ByteString\u2019 with \u2018[Char]\u2019\n      Expected type: FilePath\n        Actual type: ByteString\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1519303683, "post_id": 48922049, "comment_id": 84861717, "body": "About &quot;the typecheker complains&quot;: when that happens, you should always post the (full) error message. Otherwise, you force readers to perform type checking in their head trying to figure what&#39;s wrong, or trying to build a MCVE from your code -- both requiring non trivial effort. This makes it less likely that someone will answer your question."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1519305608, "post_id": 48922049, "comment_id": 84863181, "body": "Do you want something like <code>concat &lt;$&gt; mapM codegenDecl decls</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1519300292, "creation_date": 1519300292, "answer_id": 48926717, "question_id": 48922049, "link": "https://stackoverflow.com/questions/48922049/haskell-foldm-from-list-to-a-single-either/48926717#48926717", "title": "Haskell foldM from list to a single Either", "body": "<ul>\n<li><p><code>(++) :: [a] -&gt; [a] -&gt; [a]</code> appends lists</p></li>\n<li><p><code>output :: ByteString</code></p></li>\n<li><p><code>codegenDecl decl :: Either String ByteString</code></p></li>\n</ul>\n\n<p><code>output</code> doesn't match the expected type of the first argument of <code>(++)</code> (unless it was redefined somewhere, e.g., in basic-prelude), and <code>codegenDecl</code> doesn't match the expected type of the second argument of <code>(++)</code>.</p>\n\n<p>This lambda should typecheck (with <code>(&lt;&gt;)</code> from <code>Data.Monoid</code>):</p>\n\n<pre><code>\\output decl -&gt; fmap (output &lt;&gt;) (codegenDecl decl)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 0, "creation_date": 1519323787, "post_id": 48928984, "comment_id": 84875821, "body": "Awesome thanks! So just a clarification, mconcat will not actually concat in case the result array has multiple \u201cLeft errors\u201d right?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "edited": false, "score": 1, "creation_date": 1519340453, "post_id": 48928984, "comment_id": 84884208, "body": "@rausted Correct: as soon as <code>codegenDecl</code> returns a <code>Left</code> for one of the <code>decls</code>, the entire computation will immediately abort and return that <code>Left</code>."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1519307085, "creation_date": 1519307085, "answer_id": 48928984, "question_id": 48922049, "link": "https://stackoverflow.com/questions/48922049/haskell-foldm-from-list-to-a-single-either/48928984#48928984", "title": "Haskell foldM from list to a single Either", "body": "<p>This isn't really an answer to the question, since it doesn't address your questions about <code>foldM</code>... but I wouldn't even use <code>foldM</code> at all. I think it's cleaner to do all your <code>codegenDecl</code>ing, then concatenate the results separately. This will have two advantages: </p>\n\n<ol>\n<li>It will do a single <code>ByteString</code> concatenation operation, which can build an appropriately-sized buffer first then walk it once to fill it. This will be more efficient than doing repeated appends, which will have to rewalk early <code>ByteString</code>s many times and allocate many buffers.</li>\n<li>Because it uses combinators that can \"do less stuff\" -- <code>mapM</code> instead of <code>foldM</code> -- the reader can pay less attention and still come to the right conclusion about what's happening.</li>\n</ol>\n\n<p>Here's how that would look:</p>\n\n<pre><code>mconcat &lt;$&gt; mapM codegenDecl decls\n</code></pre>\n"}], "owner": {"reputation": 941, "user_id": 1364783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4eda80ff284139c0614e80a943d9c307?s=128&d=identicon&r=PG", "display_name": "rausted", "link": "https://stackoverflow.com/users/1364783/rausted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "accepted_answer_id": 48928984, "answer_count": 2, "score": 2, "last_activity_date": 1519307085, "creation_date": 1519285566, "question_id": 48922049, "link": "https://stackoverflow.com/questions/48922049/haskell-foldm-from-list-to-a-single-either", "title": "Haskell foldM from list to a single Either", "body": "<p>I'm writing an interpreter of sorts in Haskell, it's been super interesting so far. I'm in the Codegen step (take the parser result, pretty print it into code), One thing I tried to do is the following:</p>\n\n<p>I have Modules and my modules have declarations.</p>\n\n<pre><code>codegen :: Module -&gt; Either String ByteString\ncodegen Module { what = \"module\", declarations = decls } = Right $ foldM (\\output decl -&gt;\n    output ++ (codegenDecl decl)) (empty :: ByteString) decls -- generate declarations    \ncodegen Module { what = s } = Left $ \"Bad module 'what' key \" ++ s\n\ncodegenDecl :: Declaration -&gt; Either String ByteString\ncodegenDecl Declaration { what = dt, name = dn, argnames = Just al, constructors = Just lc } = Right $ \"Declaration \" ++ dn ++ \" of type \" ++ dt\n</code></pre>\n\n<p>The pattern-matched variable <code>decls</code> is <code>decls :: [Declaration]</code> and I'm using the Either monad for error tracking. What I expect from </p>\n\n<p><code>foldM (\\output decl -&gt;\n        output ++ (codegenDecl decl)) (empty :: ByteString) decls</code></p>\n\n<p>Is to concat all the ByteStrings if all the declarations are correct, or return a <code>Left $ \"Error writing a declaration\"</code></p>\n\n<p>But I think I'm missing a couple of things here as the typecheker complains. If either of the declarations fails, I want the whole Module to fail. If all of them succeed, I want to concatenate them into one ByteString.</p>\n\n<pre><code>[decls] --------&gt; Right result -------&gt; Right $ foldM (++) accumulator result                                                      |\n    |                 ^                                 |\n    |                 -----------------------------------\n    |\n    |-----------&gt; Left err ------------&gt; Left $ err\n</code></pre>\n\n<p>The bottom part seems to be what the >>= operator does for Either, so that makes me think there's a stylish, monadic way to do what I want without cases and the such. I'd be curious to find out what's the best style here.</p>\n"}, {"tags": ["haskell", "streaming", "conduit"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1519282994, "post_id": 48921393, "comment_id": 84849082, "body": "SO doesn&#39;t use GitHub flavored Markdown. Please have a look at <a href=\"https://stackoverflow.com/editing-help\">the Markdown editing help</a> for future question/answer formatting"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1519283073, "post_id": 48921393, "comment_id": 84849129, "body": "That being said, it&#39;s unclear how your files should get combined."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1519339402, "post_id": 48921393, "comment_id": 84883795, "body": "Could you give an example of the expected output?"}, {"owner": {"reputation": 153, "user_id": 1187622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c8bbd5a306197b461704991872a05b0?s=128&d=identicon&r=PG", "display_name": "michelk", "link": "https://stackoverflow.com/users/1187622/michelk"}, "edited": false, "score": 0, "creation_date": 1521020270, "post_id": 48921393, "comment_id": 85550791, "body": "Would you recommend the streaming library?"}], "owner": {"reputation": 153, "user_id": 1187622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c8bbd5a306197b461704991872a05b0?s=128&d=identicon&r=PG", "display_name": "michelk", "link": "https://stackoverflow.com/users/1187622/michelk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1521031152, "creation_date": 1519282840, "last_edit_date": 1521031152, "question_id": 48921393, "link": "https://stackoverflow.com/questions/48921393/fuse-two-input-files-with-haskell-conduit-library", "title": "Fuse two input-files with haskell conduit library", "body": "<p>I'm trying to fuse two input files with <code>conduit</code>.</p>\n\n<p>file1.dat:</p>\n\n<pre><code>META 1\nMETA 2\nMETA 3\nTS 1\n1\n2\n3\nTS 2\n3\n4\n5\n</code></pre>\n\n<p>file2.dat:</p>\n\n<pre><code>META 1\nMETA 2\nMETA 3\nTS 1\n0.1\n0.0\n0.3\nTS 2\n0.1\n0.2\n0.1\n</code></pre>\n\n<p>what I need is a function to source and fuse the input files, discard meta-data and merge on values in between <code>TS</code>-lines</p>\n\n<pre><code>sourceFiles :: FilePath -&gt; FilePath -&gt; ConduitM i (Double, Double) m ()\nsourceFiles f1 f2 = undefined\n</code></pre>\n\n<p>Combination (e.g. <code>+,-,*</code>) would then look like</p>\n\n<pre><code>combine :: (Double -&gt; Double-&gt; Double) -&gt; (Double, Double) -&gt; Double\ncombine f (x,y) = f x y\n</code></pre>\n\n<p>I would be very grateful, if someone could give me a hint how to start with <code>sourceFiles</code>.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>As an output file of 'addition-combination' I would expect:</p>\n\n<p>output.dat: </p>\n\n<pre><code>META 1 \nMETA 2\nMETA 3\nTS 1\n1.1\n2.0\n3.3\nTS 2\n3.1\n4.2\n5.1\n</code></pre>\n"}, {"tags": ["python", "sql", "haskell", "sqlite"], "answers": [{"comments": [{"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1519322685, "post_id": 48928657, "comment_id": 84875259, "body": "Yes I&#39;m fairly sure persistent switches to <code>is</code> for <code>Nothing</code> and uses <code>=</code> for <code>Just</code> / non-<code>Maybe</code> types. I was kind of worried that was the answer, I guess I&#39;ll just do some weird hacks with <code>.format</code> to insert the right operator. Thanks."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1519339108, "post_id": 48928657, "comment_id": 84883691, "body": "Not sure what your use case is, but you normally shouldn&#39;t need any switches or formatting, just use the &quot;right&quot; operator. Unless you&#39;re automatically generating the queries that is, but it didn&#39;t sound like you were doing that"}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1519346740, "post_id": 48928657, "comment_id": 84886037, "body": "Oops, I didn&#39;t properly read the part in yellow as I had assumed it was the same as what I read earlier. So it seems like I can just always use <code>is</code> and get nice behavior where <code>null</code> is considered equal to itself. Is this a sqlite specific thing? As I may end up using a different database if performance becomes an issue, and I read elsewhere that in SQL <code>is</code> can only be followed by <code>null</code> or <code>not null</code>."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "edited": false, "score": 0, "creation_date": 1519380935, "post_id": 48928657, "comment_id": 84897451, "body": "@semicolon I don&#39;t have the SQL standard on hand, but it seems like Oracle DB and Microsoft SQL Server indeed only support the <code>is [not] null</code> syntax; So this indeed seems like a nonstandard SQL extension. Note that SQLite is different in a few important ways from other mainstream Databases and those have significant differences between them too, so full portability between databases isn&#39;t something you should necessarily expect unless you restrict yourself to a very small subset of SQL."}], "tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": false, "score": 2, "last_activity_date": 1519312720, "last_edit_date": 1519312720, "creation_date": 1519306205, "answer_id": 48928657, "question_id": 48921279, "link": "https://stackoverflow.com/questions/48921279/python-sqlite3-how-do-i-check-equality-with-potentially-null-python-value/48928657#48928657", "title": "Python sqlite3 how do I check equality with potentially null python value", "body": "<p>In SQL <code>NULL = NULL</code> is indeed false (NULL actually IIRC, but that's also false). What you need in your example instead is the <code>is</code> operator <code>'select * from foo where bar is ?'</code></p>\n\n<p>I'm guessing the behavior in persistent is to choose <code>=</code> or <code>is</code> depending on whether or not the value is of type <code>Maybe a</code> or not, Python doesn't have that kind of information (at least not in the sqlite module of the standard library).</p>\n\n<blockquote>\n  <p>The IS and IS NOT operators work like = and != except when one or both of the operands are NULL. In this case, if both operands are NULL, then the IS operator evaluates to 1 (true) and the IS NOT operator evaluates to 0 (false). If one operand is NULL and the other is not, then the IS operator evaluates to 0 (false) and the IS NOT operator is 1 (true). It is not possible for an IS or IS NOT expression to evaluate to NULL. Operators IS and IS NOT have the same precedence as =.</p>\n</blockquote>\n\n<p>Source: <a href=\"https://www.sqlite.org/lang_expr.html\" rel=\"nofollow noreferrer\">https://www.sqlite.org/lang_expr.html</a></p>\n"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1519312720, "creation_date": 1519282343, "question_id": 48921279, "link": "https://stackoverflow.com/questions/48921279/python-sqlite3-how-do-i-check-equality-with-potentially-null-python-value", "title": "Python sqlite3 how do I check equality with potentially null python value", "body": "<p>It appears that in SQL <code>null = null</code> returns false. I can see this making sense in some circumstances where <code>null</code> means unknown/unspecified, but often <code>null</code> is used very intentionally to mean known and well defined absence, in those situations I would love for <code>null = null</code> to be true.</p>\n\n<p>What is the proper way to deal with this when using <code>sqlite3</code>? As currently doing anything like:</p>\n\n<pre><code>c.execute('select * from foo where bar = ?', [bar])\n</code></pre>\n\n<p>will break if <code>bar</code> is <code>None</code>, whereas I very much want it to return every row where <code>bar</code> is <code>null</code>. This all works seamlessly in Haskell's persistent which is what I am using on the other end, (<code>FooBar ==. Nothing</code>), so I was hoping for something similarly clean on the Python end.</p>\n"}, {"tags": ["haskell", "reflex", "reflex-dom"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519274728, "post_id": 48919461, "comment_id": 84845927, "body": "Does anything show up if you don&#39;t try to use <code>getDirectoryContents</code>?"}, {"owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1519275795, "post_id": 48919461, "comment_id": 84846252, "body": "yes. for example, if I hard code <code>names=[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]</code>, everything just works."}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1519296155, "post_id": 48919461, "comment_id": 84856810, "body": "For an introduction to reflex-dom, you can read <a href=\"https://github.com/hansroland/reflex-dom-inbits\" rel=\"nofollow noreferrer\">this tutorial</a>"}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1519306105, "post_id": 48921064, "comment_id": 84863547, "body": "Cf. <a href=\"https://github.com/ghcjs/shims/blob/6fb94ef2e0aa93dc862cef2fa98d440b14184a2c/pkg/directory.js\" rel=\"nofollow noreferrer\">the shim for <code>System.Directory</code></a> in GHCJS, in which functions appear (if I&#39;m interpreting that correctly) to be enabled or disabled depending on whether the code is built targeting Node or the browser."}, {"owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "edited": false, "score": 0, "creation_date": 1519313843, "post_id": 48921064, "comment_id": 84869351, "body": "So a backend like yesod or happstack is must if one wants do access local file system?"}, {"owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "edited": false, "score": 2, "creation_date": 1519351252, "post_id": 48921064, "comment_id": 84887119, "body": "You can compile reflex with ghc instead of ghcjs to produce a standalone executable that can access the local file system.  If you run your program in this mode then it shows directory contents."}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": true, "score": 3, "last_activity_date": 1519281333, "creation_date": 1519281333, "answer_id": 48921064, "question_id": 48919461, "link": "https://stackoverflow.com/questions/48919461/how-to-debug-reflex-dom-programs/48921064#48921064", "title": "how to debug reflex-dom programs-", "body": "<p>A good first step in debugging ghcjs problems is to check the browser console.  In this case you will see : <code>\"/: getDirectoryContents: failed (operation unsupported on this platform)\"</code> .  </p>\n\n<p>This makes sense.  The code is running in the browser - not on the server, or directly on the client.  So the whole file system concept does not really apply here.</p>\n"}], "owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 48921064, "answer_count": 1, "score": 3, "last_activity_date": 1519281333, "creation_date": 1519272060, "question_id": 48919461, "link": "https://stackoverflow.com/questions/48919461/how-to-debug-reflex-dom-programs", "title": "how to debug reflex-dom programs-", "body": "<p>So I just discovered this library and thought it might be awesome for building UI's. Here is a small exercise I tried to implement when learning this library. Basically it tries to open a directory on the local file system and displays all the files in this directory. It compiles with no problem but when I open the <code>index.html</code> it just shows a blank page. I have no idea how to debug the program. Here is the code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport           Reflex.Dom\nimport qualified Data.Text as T\nimport           System.Directory\nimport           System.FilePath\nimport           Control.Monad\nimport           Data.List (map)\n\n\nmain :: IO ()\nmain = do\n  files &lt;- getDirectoryContents \"/\"\n  let names = map (T.pack . show) files\n  mainWidget $ body  names\n\nbody :: MonadWidget t m =&gt; [T.Text] -&gt;  m ()\nbody files = el \"div\" $ do\n  el \"h2\" $ text \"Reflex File Test\"\n  el \"ul\" $ do\n    let lables = map text files\n    mapM_ (el \"li\")  lables\n</code></pre>\n"}, {"tags": ["haskell", "random", "io", "functional-programming", "monads"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1519263861, "post_id": 48918130, "comment_id": 84843077, "body": "The next line in the <code>do</code> block could be something like <code>print (yourFunc gen)</code>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1519290793, "post_id": 48918329, "comment_id": 84853233, "body": "How about <code>unsafePerformIO :: IO a -&gt; a</code> in this particular case? Isn&#39;t pseudo random number generation a less harmful effect, because it actually produces a return value and the calling side expects this very effect?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 8, "creation_date": 1519292437, "post_id": 48918329, "comment_id": 84854293, "body": "@ftor this is not an appropriate use of <code>unsafePerformIO</code>, and I think most of the community will agree with me.  When we&#39;re working in haskell, the <i>first</i> thing we expect of any function is referential transparency, which is what gives us that beloved freedom to equationally reason and refactor without thinking very hard.  <code>unsafePerformIO</code> is appropriate when the violation of r.t. is re-encapsulated, so that the interface remains pure."}, {"owner": {"reputation": 11496, "user_id": 5438433, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OJ1qY.png?s=128&g=1", "display_name": "TheInnerLight", "link": "https://stackoverflow.com/users/5438433/theinnerlight"}, "edited": false, "score": 3, "creation_date": 1519294879, "post_id": 48918329, "comment_id": 84855946, "body": "@ftor <code>unsafePerformIO</code> is for situations when you have a pure function but aren&#39;t capable of proving it to the type system.  A good example would be FFI when calling a function that you know is pure.  Random number generation is absolutely effectful so should done within <code>IO</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1519300495, "post_id": 48918329, "comment_id": 84859608, "body": "OK, there is no escape from mathematical rules. This is the first dogmatism I have encountered so far, which probably achieves something good :D"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1519311556, "post_id": 48918329, "comment_id": 84867676, "body": "@ftor It&#39;s not dogmatism in this case; Doing it otherwise would just straight up break the semantics of the language and lead to unpredictable results."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1519325599, "post_id": 48918329, "comment_id": 84876885, "body": "@ftor In a purely functional programming language, if <code>rand :: Integer -&gt; Integer</code>, the compiler is entitled to inline <code>let x = rand 6 in x + x</code> as <code>rand 6 + rand 6</code>. That is not a sound rewriting if <code>rand 6</code> is the result of a die: the former is never 7, for instance. Debugging this issue can easily drive one insane, since the issue is not in the code, but is introduced by the compiler. The compiler here is not at fault, since it relied on the lie <code>rand :: Integer -&gt; Integer</code> which was guaranteed by the programmer -- which is the real issue."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1519326181, "post_id": 48918329, "comment_id": 84877191, "body": "Wonderful example, @chi. The compiler itself does equational reasoning and this only works with referential transparency. I should have considered that."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 17, "last_activity_date": 1519264472, "last_edit_date": 1519264472, "creation_date": 1519263928, "answer_id": 48918329, "question_id": 48918130, "link": "https://stackoverflow.com/questions/48918130/haskell-random-io-to-int/48918329#48918329", "title": "Haskell random IO to Int", "body": "<p>Yep, there is something basic, and it's the most common thing new Haskellers struggle with.  Basically, everything you said is right, and if you want a \"function\" that returns a random int, you can't have it.</p>\n\n<p>You can do</p>\n\n<pre><code>main :: IO ()\nmain = do\n    num &lt;- getRandomR (0, 51)\n    putStrLn (\"The number is \" ++ show num)\n</code></pre>\n\n<p>You can also factor it out</p>\n\n<pre><code>getCardIndex :: IO Int\ngetCardIndex = do\n    ix &lt;- getRandomR (0,51)\n    return (ix + 1)   -- just as an example of how you can transform it\n\nmain :: IO ()\nmain = do\n    card &lt;- getCardIndex\n    putStrLn (\"The number is \" ++ show card)\n</code></pre>\n\n<p>The thing you can't do is make it a pure function/value:</p>\n\n<pre><code>pureCardIndex :: Int\npureCardIndex = ioToPure (getRandomR (0,51)) -- NOT POSSIBLE\n</code></pre>\n\n<p>because there is no (ethical) function like <code>ioToPure</code>.  A pure function must always return the same output for the same input, which is precisely <em>not</em> what you want a random number function to do.  So we have to use <code>IO</code> with it.   Once you use <code>IO</code> to generate something random, anything that depends on that random number must also be in <code>IO</code>.</p>\n\n<p>People will be quick to start explaining the theory of monads and all that, and it's good stuff, I just recommend approaching it patiently, getting used to these patterns before diving into the theoretical side.</p>\n"}], "owner": {"reputation": 97, "user_id": 9253039, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-CgWhQCp3zl8/AAAAAAAAAAI/AAAAAAAAANI/rQTDJYKXoTs/photo.jpg?sz=128", "display_name": "Meltdown", "link": "https://stackoverflow.com/users/9253039/meltdown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 928, "favorite_count": 0, "accepted_answer_id": 48918329, "answer_count": 1, "score": 4, "last_activity_date": 1519647759, "creation_date": 1519262403, "last_edit_date": 1519647759, "question_id": 48918130, "link": "https://stackoverflow.com/questions/48918130/haskell-random-io-to-int", "title": "Haskell random IO to Int", "body": "<p>I recently picked up Haskell and the syntax is really confusing to me. I am trying to get a random number between 0 and 51 using</p>\n\n<pre><code>randomRIO (0, 51)\n</code></pre>\n\n<p>But I dont know how to make this an actual Int (now its type IO a). \nI believe you are supposed to be able to do:</p>\n\n<pre><code>gen &lt;- randomRIO (0, 51)\n</code></pre>\n\n<p>and then gen is supposed to be an Int but I have to do this in a do block? How do I create the function that takes this and return an Int.\nFrom googeling I'm afraid that there is something basic that I do not understand. \nI am completely lost.  </p>\n"}]