[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 3, "creation_date": 1548285468, "post_id": 54336429, "comment_id": 95491491, "body": "What is the output for <code>[A,A,A,A]</code>?"}, {"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1548296294, "post_id": 54336429, "comment_id": 95493719, "body": "I think it&#39;s implied that the elements are unique (conceptually a set)."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1548293879, "post_id": 54336550, "comment_id": 95493239, "body": "Why <code>concat</code> when you&#39;re already in a list comprehension? <code>f&#39; xs = [(head x, y) | x &lt;- tails xs, y &lt;- x]</code>. And then the next obvious question is, why use <code>head</code> when pattern matching will do? <code>f&#39; xs = [(h, y) | x@(h:_) &lt;- tails xs, y &lt;- x]</code>."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548315634, "post_id": 54336550, "comment_id": 95498964, "body": "That would be better, agreed, although I think using <code>head</code> is fine."}], "tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 5, "last_activity_date": 1548321040, "last_edit_date": 1548321040, "creation_date": 1548281819, "answer_id": 54336550, "question_id": 54336429, "link": "https://stackoverflow.com/questions/54336429/all-non-duplicate-combinations-of-two-list-elements/54336550#54336550", "title": "All non-duplicate combinations of two list elements", "body": "<p>Solution using recursion:</p>\n\n<pre><code>f :: [a] -&gt; [(a, a)]\nf []     = []\nf (x:xs) = [(x, y) | y &lt;- (x:xs)] ++ f xs \n</code></pre>\n\n<p>Without recursion: </p>\n\n<pre><code>import Data.List (tails) \n\nf' :: [a] -&gt; [(a, a)]\nf' xs = concat [[(head x, y) | y &lt;- x] | x &lt;- tails xs]\n</code></pre>\n\n<p>Without list comprehension:</p>\n\n<pre><code>import Data.List (tails) \n\nf'' :: [a] -&gt; [(a, a)]\nf'' xs = concatMap (\\sl -&gt; zip (repeat $ head sl) sl) (tails xs)\n</code></pre>\n\n<p>Best is by Daniel Wagner, just use</p>\n\n<pre><code>[(head x, y) | x &lt;- tails xs, y &lt;- x]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 944, "user_id": 49554, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/02c8ecc24181d171df85a26458b9cd5f?s=128&d=identicon&r=PG", "display_name": "jneira", "link": "https://stackoverflow.com/users/49554/jneira"}, "is_accepted": false, "score": 0, "last_activity_date": 1548285782, "last_edit_date": 1548285782, "creation_date": 1548282859, "answer_id": 54336742, "question_id": 54336429, "link": "https://stackoverflow.com/questions/54336429/all-non-duplicate-combinations-of-two-list-elements/54336742#54336742", "title": "All non-duplicate combinations of two list elements", "body": "<p>Continuing the idea of filter <code>[(x,y) | x &lt;- xs, y &lt;- xs]</code>, you could do it using foldl instead:</p>\n\n<pre><code>f = foldl add [] \n  where add ys (a,b) | notElem (b,a) ys = (a,b):ys \n                     | otherwise = ys\n\ng xs = [(x,y) | x &lt;- xs, y &lt;- xs]\n\nfunction = f . g\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": false, "score": 1, "last_activity_date": 1548285922, "creation_date": 1548285922, "answer_id": 54337247, "question_id": 54336429, "link": "https://stackoverflow.com/questions/54336429/all-non-duplicate-combinations-of-two-list-elements/54337247#54337247", "title": "All non-duplicate combinations of two list elements", "body": "<p>You may use <code>scanr</code></p>\n\n<pre><code>f l = zip l (scanr (:) [] l) &gt;&gt;= \\(h,t) -&gt; fmap ((,) h) t\n</code></pre>\n\n<p>First you get list of (heads, tails) of <code>l</code>, map tails pairing their elements with corresponding head and finally flatten everything. </p>\n"}, {"tags": [], "owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "is_accepted": false, "score": 2, "last_activity_date": 1548348006, "creation_date": 1548348006, "answer_id": 54351451, "question_id": 54336429, "link": "https://stackoverflow.com/questions/54336429/all-non-duplicate-combinations-of-two-list-elements/54351451#54351451", "title": "All non-duplicate combinations of two list elements", "body": "<p>It's a nested loop.</p>\n\n<pre><code>import Data.List (dropWhile)\n\ncom xs = do\n  x &lt;- xs\n  y &lt;- dropWhile (/= x) xs\n  return (x, y)\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 10958331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a80ebe45363b14ee38b4c58a2d593542?s=128&d=identicon&r=PG&f=1", "display_name": "therk12", "link": "https://stackoverflow.com/users/10958331/therk12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 4, "score": 5, "last_activity_date": 1548348006, "creation_date": 1548281237, "question_id": 54336429, "link": "https://stackoverflow.com/questions/54336429/all-non-duplicate-combinations-of-two-list-elements", "title": "All non-duplicate combinations of two list elements", "body": "<p>It's easier to explain this with an example:</p>\n\n<p>I want to write a function [a] -> [(a,a)] so if I get a list </p>\n\n<pre><code>[A, B, C, D] \n</code></pre>\n\n<p>I want this list to return: </p>\n\n<pre><code>[(A, A), (A,B), (A,C), (A,D), (B,B), (B,C), (B,D), (C,C), (C,D), (D,D)]\n</code></pre>\n\n<p>I came up with this code: </p>\n\n<pre><code>function s = [(x,y) | x &lt;- s, y &lt;- s, x&lt;=y]\n</code></pre>\n\n<p>Which works correctly for a list of integers, but I want this to work for data types that are not instances of the Ord class. My data type derives Show and Eq. So is there a simple way to solve this problem? I'm thinking maybe by filtering the tuples from </p>\n\n<pre><code>function s = [(x,y) | x &lt;- s, y &lt;- s]\n</code></pre>\n\n<p>But I dont know how I can do that either.</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": true, "score": 3, "last_activity_date": 1548329032, "last_edit_date": 1548329032, "creation_date": 1548284165, "answer_id": 54336966, "question_id": 54335403, "link": "https://stackoverflow.com/questions/54335403/haskell-parsec-parsing-two-lists-of-stuff/54336966#54336966", "title": "Haskell Parsec - parsing two lists of stuff", "body": "<p>I am afraid that you cannot use <code>sepBy</code> here. </p>\n\n<p>Let's simplify it to parsing 'a' as samples and 'b' as newlines. You are going to parse strings like</p>\n\n<p><code>a b b a b b b c b c b c b</code></p>\n\n<p>So what does the parser think while traversing on such a string? Let's go through it:</p>\n\n<hr>\n\n<blockquote>\n  <p>Parsing <code>a</code> or an empty sequence</p>\n</blockquote>\n\n<p><code>[a] b b a b b b c b c b c b</code></p>\n\n<blockquote>\n  <p>Oh, an <code>a</code>. The sequence is non empty, so I will parse <code>many</code> <code>\"bb\" &gt;&gt; \"a\"</code> from now.</p>\n</blockquote>\n\n<p><code>a [b b a] b b b c b c b c b</code></p>\n\n<blockquote>\n  <p>Success! Let's get some more or finish</p>\n</blockquote>\n\n<p><code>a b b a [b b] b c b c b c b</code></p>\n\n<blockquote>\n  <p>Okay, I have found another <code>bb</code>, so the sequence continues. Parsing <code>a</code></p>\n</blockquote>\n\n<p><code>a b b a b b [b] c b c b c b</code></p>\n\n<blockquote>\n  <p>wat</p>\n</blockquote>\n\n<hr>\n\n<p>The problem is that <strong>parser won't rollback unless explicitly asked to do so</strong>.\nTo give parser rollback ability you must mark it with <code>try</code> combinator, otherwise it won't be able to \"unconsume\" consumed input. </p>\n\n<p>For now I don't see any better way than rewrite the <code>sepBy</code> combinator to make it aware that after parsing each separator it may need to return it back to the buffer if parsing <code>separator &gt;&gt; target</code> fails:</p>\n\n<pre><code>sepTry a sep = sepTry1 a sep &lt;|&gt; pure []\nsepTry1 a sep = liftA2 (:) a (many (try $ sep *&gt; a))\n</code></pre>\n\n<p>Note that parsing <code>a</code> must be included in <code>try</code> section \u2013 this is where the failure actually is triggered.</p>\n\n<p>To visualize the difference let's see same scenario but with <code>sepTry</code> instead:</p>\n\n<hr>\n\n<p>...</p>\n\n<p><code>a [b b a] b b b c b c b c b</code></p>\n\n<blockquote>\n  <p>Success! Let's <strong>try</strong> to get one more if possible</p>\n</blockquote>\n\n<p><code>a b b a ![b b] b c b c b c b</code></p>\n\n<blockquote>\n  <p>Okay, I have found another <code>bb</code>, so the sequence continues. Parsing <code>a</code></p>\n</blockquote>\n\n<p><code>a b b a !b b [b] c b c b c b</code></p>\n\n<blockquote>\n  <p>Not what I expected. Return failure and move cursor to back exclamation mark.</p>\n</blockquote>\n\n<p><code>a b b a ![]b b b c b c b c b</code></p>\n\n<blockquote>\n  <p>Failed parsing <code>bba</code>, parsing sequence finished. Parse <code>bbb</code></p>\n</blockquote>\n\n<p><code>a b b a [b b b] c b c b c b</code></p>\n\n<blockquote>\n  <p>Success!</p>\n</blockquote>\n\n<hr>\n\n<p>In your case after each <code>Sample</code> this parser will attempt to read 2 newlines with <code>Sample</code> after them, or in case of failure 3 newlines and continue to <code>MaskedOperation</code>s</p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 1, "last_activity_date": 1548315002, "creation_date": 1548315002, "answer_id": 54341401, "question_id": 54335403, "link": "https://stackoverflow.com/questions/54335403/haskell-parsec-parsing-two-lists-of-stuff/54341401#54341401", "title": "Haskell Parsec - parsing two lists of stuff", "body": "<p>What I did was run a tokenizing step first, and then use a <code>Parser String ([Sample], [Instruction])</code> instead of <code>Parser Char ([Sample], [Instruction])</code>. Having the list already tokenized made it a lot easier to ignore the whitespace and other irrelevant punctuation.</p>\n\n<pre><code>solve = parse . tokenize \n  where tokenize = concatMap words . lines . filter (not . (`elem` \",:[]\"))\n        parse = (,) &lt;$&gt; many sample &lt;*&gt; many instr\n        sample = -- ...\n        instr = -- ...\n</code></pre>\n\n<p>No backtracking is needed, because samples and instructions are distinguishable just from their first token.</p>\n"}], "owner": {"reputation": 52747, "user_id": 38055, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d7912ba2ab72397e157148de151cd9e9?s=128&d=identicon&r=PG", "display_name": "Tomas Aschan", "link": "https://stackoverflow.com/users/38055/tomas-aschan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 54336966, "answer_count": 2, "score": 2, "last_activity_date": 1548329032, "creation_date": 1548276554, "last_edit_date": 1548277033, "question_id": 54335403, "link": "https://stackoverflow.com/questions/54335403/haskell-parsec-parsing-two-lists-of-stuff", "title": "Haskell Parsec - parsing two lists of stuff", "body": "<p>I'm using <a href=\"https://adventofcode.com/2018/day/16\" rel=\"nofollow noreferrer\">Advent of Code part 16</a> as an excuse to learn how to use Parsec, but I'm stumbling on how to handle this specific case.</p>\n\n<p>The input is on the following format:</p>\n\n<pre><code>Before: [3, 2, 3, 0]\n2 3 1 1\nAfter:  [3, 2, 3, 0]\n\nBefore: [1, 0, 2, 1]\n7 0 1 1\nAfter:  [1, 1, 2, 1]\n\n...\n\nBefore: [0, 0, 2, 1]\n6 2 3 1\nAfter:  [0, 6, 2, 1]\n\n\n\n5 0 2 3\n5 1 3 1\n...\n5 3 2 2\n</code></pre>\n\n<p>In other words, first a number of groups of three lines that parse into a structure, separated by blank lines, then three blank lines, then a number of lines of four digits.</p>\n\n<p>I have working parsers for each of the structures - <code>Sample</code> and <code>MaskedOperation</code>, with parsers <code>sample</code> and <code>maskedOp</code> respectively<sup>1</sup> - but I can't figure out how to put them together to parse it into a <code>([Sample], [MaskedOperation])</code>.</p>\n\n<p>I tried the following:</p>\n\n<pre><code>parseInput :: GenParser Char st ([Sample], [MaskedOperation])\nparseInput = do\n  samples &lt;- sample `sepBy` (count 2 newline) &lt;* count 3 newline\n  operations &lt;- maskedOp `sepBy` newline\n  return (samples, operations)\n</code></pre>\n\n<p>but it fails when it reaches the three newlines, expecting another sample:</p>\n\n<pre><code>(line 3221, column 1):\nunexpected \"\\n\"\nexpecting \"Before:\"\n</code></pre>\n\n<p>How do I tell parsec that I want to take as many as it can, then consume the separator (the extra newlines), then start reading other stuff?</p>\n\n<hr>\n\n<p><sup>1</sup> Read the Advent of Code problem for context; the names are not important.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1548274079, "post_id": 54334858, "comment_id": 95487202, "body": "<code>foldr</code> means that instead of <code>(:)</code> of the list, you write <code>f</code>, and instead of <code>[]</code>, you write <code>z</code> (the initial accumulator value)."}, {"owner": {"reputation": 21, "user_id": 10519594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/342e863ba5bdda22444f7bcce6f5b58c?s=128&d=identicon&r=PG&f=1", "display_name": "luckydemon", "link": "https://stackoverflow.com/users/10519594/luckydemon"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548275367, "post_id": 54334858, "comment_id": 95487705, "body": "I saw this explanation of <code>foldr</code>, but I dont understand about <code>[ ]</code>. If <code>f</code> stands for <code>(4+)</code> and list, that we are passing to map is <code>[1,2,3]</code>, then: 1st iteration: list breaks down to x=1 and xs=[2,3], then we use f on x, getting 5 and prepend it list and getting the result [5,2,3]. Then, foldr takes 5 from this list and prepend it our empty list. And on the secind iteration x = 2, xs =[3], we repeating previous steps. Is it right?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1548275508, "post_id": 54334858, "comment_id": 95487761, "body": "<code>f</code> typically does not stand for <code>(4+)</code> since it takes as input an element, and the accumulator."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1548279617, "post_id": 54334858, "comment_id": 95489457, "body": "To answer your question directly, the purpose of the empty list here is to be the initial value of the accumulator. <code>foldr</code>, when fully applied, takes 3 arguments: a &quot;fold function&quot; <code>f</code> (which takes 2 argments), an initial value <code>z</code> (which here is the empty list), and the list you are folding. What it does is, starting from the end of the list and working backwards, apply <code>f</code> to the current list element and current accumulator, producing a new accumulator. So it goes over the list from right to left, updating the accumulator as it goes, and returns the final value. Does this make more sense?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1548279704, "post_id": 54334858, "comment_id": 95489497, "body": "I want to add (but ran out of characters in the first comment): if you know some other languages, you will likely know how <code>fold</code> works - it&#39;s a standard library function in many of them, albeit it&#39;s often called <code>reduce</code> rather than <code>fold</code>, and usually folds from the left rather than the right (like Haskell&#39;s <code>foldl</code>), but the principal is exactly the same. Javascript and Python certainly both  have such functions, and I&#39;m sure some other common languages have it as well."}, {"owner": {"reputation": 21, "user_id": 10519594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/342e863ba5bdda22444f7bcce6f5b58c?s=128&d=identicon&r=PG&f=1", "display_name": "luckydemon", "link": "https://stackoverflow.com/users/10519594/luckydemon"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1548279903, "post_id": 54334858, "comment_id": 95489585, "body": "@RobinZigmond More or less. But why we are getting in result a list, but not a single value? Because in lambda expression we prepend the result of function f to list?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1548279945, "post_id": 54334858, "comment_id": 95489600, "body": "On another note: this is two completely different questions. You would be better off asking about <code>unfoldr</code> in a separate question."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1548281229, "post_id": 54334858, "comment_id": 95490116, "body": "see <a href=\"https://www.haskell.org/onlinereport/standard-prelude.html#$vfoldr\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/standard-prelude.html#$vfoldr</a>"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1548281415, "post_id": 54334858, "comment_id": 95490174, "body": "@luckydemon a list <i>is</i> a single value - or at least can be treated as such, as it is here. The accumulator is what eventually (after repeated applications of the fold function) gives your overall value, so its type has to be the same as the type you&#39;re aiming for. If you&#39;re just summing a list of numbers, you want a number out, so you do <code>foldr (+) 0</code> - the initial value is <code>0</code>, the same type of thing as what you want at the end. In the example you&#39;re implementing <code>map</code> in terms of <code>foldr</code>, and since this must result in a list, you have to start with a list."}], "answers": [{"tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": false, "score": 0, "last_activity_date": 1548284226, "creation_date": 1548284226, "answer_id": 54336975, "question_id": 54334858, "link": "https://stackoverflow.com/questions/54334858/understanding-the-work-of-foldr-and-unfoldr/54336975#54336975", "title": "Understanding the work of foldr and unfoldr", "body": "<blockquote>\n  <p>So we are giving our function f and some list, then in lambda expression our list transforms into head \"x\" and tail \"xs\", we applying function \"f\" to x and append it to \"xs\".</p>\n</blockquote>\n\n<p>This is not the case. Look closely at the implementation:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap f = foldr (\\x xs -&gt; f x : xs) []\n</code></pre>\n\n<p>There is an implied variable here, we can add it back in:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap f ls = foldr (\\x xs -&gt; f x : xs) [] ls\n</code></pre>\n\n<p><code>map</code> takes two arguments, a function <code>f</code> and a list <code>ls</code>. It passes <code>ls</code> to <code>foldr</code> as the list to fold over, and it passes <code>[]</code> as the starting accumulator value. The lambda takes a list element <code>x</code> and an accumulator <code>xs</code> (initially <code>[]</code>), and returns a new accumulator <code>f x : xs</code>. It does not perform a <code>head</code> or <code>tail</code> anywhere; <code>x</code> and <code>xs</code> were never part of the same list.</p>\n\n<p>Let's step through the evaluation to see how this function works:</p>\n\n<pre><code>map (1+) [2, 4, 8]\n\nfoldr (\\x xs -&gt; (1+) x : xs) [] [2, 4, 8] -- x = 8, xs = []\nfoldr (\\x xs -&gt; (1+) x : xs) [9] [2, 4]   -- x = 4, xs = [9]\nfoldr (\\x xs -&gt; (1+) x : xs) [5, 9] [2]   -- x = 2, xs = [5, 9]\nfoldr (\\x xs -&gt; (1+) x : xs) [3, 5, 9] [] --        xs = [3, 5, 9]\n\nmap (1+) [2, 4, 8] == [3, 5, 9]\n</code></pre>\n\n<p>The empty list accumulates values passed through <code>f</code>, starting from the right end of the input list.</p>\n\n<hr>\n\n<blockquote>\n  <p>And function \"rangeTo\" : we are creating lambda expression, where we are checking that we are over the end of range, end if we are than we are giving Nothing, or if we are not at end, we are giving pair where first number append to resulting list, and second number used as next value for \"from\". Is it all what happens in this function, or I'm missing something?</p>\n</blockquote>\n\n<p>Yes, that's exactly what's going on. The lambda takes an accumulator, and returns the next value to put in the list and a new accumulator, or <code>Nothing</code> if the list should end. The accumulator in this case is the current value in the list. The list should end if that value is past the end of the range. Otherwise it calculates the next accumulator by adding the step.</p>\n\n<p>Again, we can step through the evaluation:</p>\n\n<pre><code>rangeTo 3 11 2 -- from = 3, to = 11, step = 2\n\nJust (3, 5)    -- from = 3\nJust (5, 7)    -- from = 3 + step = 5\nJust (7, 9)    -- from = 5 + step = 7\nJust (9, 11)   -- from = 7 + step = 9\nNothing        -- from = 9 + step = 11, 11 &gt;= to\n\nrangeTo 3 11 2 == [3, 5, 7, 9]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": false, "score": 1, "last_activity_date": 1548317929, "creation_date": 1548317929, "answer_id": 54342126, "question_id": 54334858, "link": "https://stackoverflow.com/questions/54334858/understanding-the-work-of-foldr-and-unfoldr/54342126#54342126", "title": "Understanding the work of foldr and unfoldr", "body": "<p>To understand <strong>How <code>foldr</code> operates on a list</strong>. It is better to write down the <a href=\"https://en.wikipedia.org/wiki/Fold_(higher-order_function)#Linear_folds\" rel=\"nofollow noreferrer\">definition</a> of <code>foldr</code> as </p>\n\n<pre><code>foldr step z xs \n= x1 `step` foldr step z xs1                                -- where xs = x:xs1\n= x1 `step` (x2 `step` foldr step z xs2)                    -- where xs = x1:x2:xs2\n= x1 `step` (x2 `step` ... (xn `step` foldr step z [])...)  -- where xs = x1:x2...xn:[]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>foldr step z [] = z\n</code></pre>\n\n<p>For your case:</p>\n\n<pre><code>foldr (\\x xs -&gt; f x : xs) []\n</code></pre>\n\n<p>where</p>\n\n<pre><code>step = (\\x xs -&gt; f x : xs)\nz = []\n</code></pre>\n\n<p>From the definition of <code>foldr</code>, the innermost expression </p>\n\n<pre><code>(xn `step` foldr step z []) \n</code></pre>\n\n<p>is evaluated first, that is</p>\n\n<pre><code>xn `step` foldr step z []\n= step xn (foldr step z [])\n= step xn z\n= step xn []  -- z = []\n= f xn : []   -- step = (\\x xs -&gt; f x : xs)\n= [f xn]\n</code></pre>\n\n<p>what happens next? The evaluation going on as</p>\n\n<pre><code>x(n-1) `step` (xn `step` foldr step z [])\n= step x(n-1) [f xn]\n= f x(n-1) : [f xn]\n= [f x(n-1), f xn]\n</code></pre>\n\n<p>untill:</p>\n\n<pre><code>x1 `step` (x2 ...\n= step x1 [f x2, ..., f xn]\n= [f x1, f x2, ... f xn]\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10519594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/342e863ba5bdda22444f7bcce6f5b58c?s=128&d=identicon&r=PG&f=1", "display_name": "luckydemon", "link": "https://stackoverflow.com/users/10519594/luckydemon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1548347820, "creation_date": 1548273951, "last_edit_date": 1548347820, "question_id": 54334858, "link": "https://stackoverflow.com/questions/54334858/understanding-the-work-of-foldr-and-unfoldr", "title": "Understanding the work of foldr and unfoldr", "body": "<p>I have hard time understanding how these bits of code work. </p>\n\n<p>\"Map\" function must apply the function to all elements in given list, and generate list consist of results of applying. So we are giving our function f and some list, then in lambda expression our list transforms into head \"x\" and tail \"xs\", we applying function \"f\" to x and append it to \"xs\". But what happens next? How and what exactly foldr takes for its second argument (which must be some starting value usually). And for what purpose empty list?\nAnd function \"rangeTo\" : we are creating  lambda expression, where we are checking that we are over the end of range, end if we are than we are giving Nothing, or if we are not at end, we are giving pair where first number append to resulting list, and second number used as next value for \"from\". Is it all what happens in this function, or I'm missing something? </p>\n\n<pre><code>--custom map function through foldr\nmap :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap f = foldr (\\x xs -&gt; f x : xs) []\n--function to create list with numbers from first argument till second and step \"step\"\nrangeTo :: Integer -&gt; Integer -&gt; Integer -&gt; [Integer]\nrangeTo from to step =  unfoldr (\\from -&gt; if from &gt;= to then Nothing else Just (from, from+step)) from\n</code></pre>\n"}, {"tags": ["haskell", "llvm"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1548271683, "post_id": 54333997, "comment_id": 95486211, "body": "Just to be sure -- you do have a <code>Main</code> module with a <code>main :: IO ()</code> function defined in it, right?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1548272549, "post_id": 54333997, "comment_id": 95486575, "body": "This would be an easier question to answer if we had an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>. Could you update your question to include a minimal, complete, and verifiable example?"}, {"owner": {"reputation": 71, "user_id": 8845822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79e57160de098048b3dd66e69166ef77?s=128&d=identicon&r=PG&f=1", "display_name": "Rodolpho Pueyrred&#243;n", "link": "https://stackoverflow.com/users/8845822/rodolpho-pueyrred%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1548281860, "post_id": 54333997, "comment_id": 95490330, "body": "It&#39;s difficult for me to post an MCVE. It is not a problem that occurred in any particular snippet of code. As I said all the code that the project contains is of the yesod scaffolding. When I compile with &#39;stack build&#39; and then I use &#39;stack exec - yesod devel&#39; everything works normally.  My problem is how to do a certain type of build. Has anyone ever tried to compile a yesod project to bytecode llvm and try to run as llvm JIT?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1548289430, "post_id": 54333997, "comment_id": 95492393, "body": "MCVE: Put <code>main :: IO (); main = return ()</code> in a <code>Main.hs</code>, <code>ghc -fllvm -keep-llvm-files Main.hs</code>, then <code>lli Main.ll</code>. This is a linker/compiler-level error, which means the code doesn&#39;t matter, the libraries mostly don&#39;t, and the only things that really do are the compilation steps. My guess as to the cause of this problem is that GHC simply doesn&#39;t write a <code>main</code> function. Rather, <code>main</code> might be in the RTS (which is linked in), where it can set up GC, read RTS options, etc., and eventually that calls into <code>Main.main</code>. This may be a showstopper if <code>lli</code> can&#39;t link the RTS."}, {"owner": {"reputation": 71, "user_id": 8845822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79e57160de098048b3dd66e69166ef77?s=128&d=identicon&r=PG&f=1", "display_name": "Rodolpho Pueyrred&#243;n", "link": "https://stackoverflow.com/users/8845822/rodolpho-pueyrred%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1548456342, "post_id": 54333997, "comment_id": 95561984, "body": "Thank you HTNW. Sorry I did not provide an MCVE. But when I hit my eye on it, I thought  &quot;should be a linker problem and it is a difficult problem. It&#39;s best to look for someone you&#39;ve tried and know&quot;.  I think you said it right. The main must be in the RTS. In this case I will give up doing because it will require a manual solution that will require a lot of time."}], "owner": {"reputation": 71, "user_id": 8845822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79e57160de098048b3dd66e69166ef77?s=128&d=identicon&r=PG&f=1", "display_name": "Rodolpho Pueyrred&#243;n", "link": "https://stackoverflow.com/users/8845822/rodolpho-pueyrred%c3%b3n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1548274844, "creation_date": 1548270026, "last_edit_date": 1548274844, "question_id": 54333997, "link": "https://stackoverflow.com/questions/54333997/problem-when-run-a-bytecode-llvm-bc-with-lli-jit", "title": "Problem when run a bytecode llvm (.bc) with lli (JIT)", "body": "<p>I compiled my haskell sources in <code>.ll</code> files with the GHC. Then I generated several <code>.bc</code> (bytecode), using the <code>llvm-as</code> command.</p>\n\n<p>After that I link everything in a single <code>.bc</code> using the <code>llvm-link</code> command. Then optimized with the opt command.</p>\n\n<p>The final result was trying to execute with <code>lli</code> command (JIT), but the following error occurred:</p>\n\n<blockquote>\n  <p>'main' function not found in module.</p>\n</blockquote>\n\n<p>Does anyone know how to do this?</p>\n\n<p>Good. What am I doing? I'm trying to compile a yesod project on NixOS.</p>\n\n<p>I used first:</p>\n\n<pre><code>$ stack --nix-packages llvm_39 build --ghc-options = \"-fllvm -keep-llvm-files\"\n</code></pre>\n\n<p>This generated <code>.ll</code> corresponding to the sources. So I got those <code>.ll</code> and copied in another directory. Next I used <code>llvm-as</code> to compile to bytecod each one of them:</p>\n\n<pre><code>$ llvm-as &lt;filename&gt;\n</code></pre>\n\n<p>Then I put it all together into one file. What I have in the yesod project is how you know: a main:</p>\n\n<pre><code>import Prelude (IO)\nimport Application (appMain)\n\nmain :: IO ()\nmain = appMain\n</code></pre>\n\n<p>I thought that after putting everything together in a .bc I could run with <code>lli</code> as it is possible to do when an .exe is generated. With yesod just the <code>.exe</code>, config folder and static folder in the same place and cabum!</p>\n\n<p>The yesod project was generated with the postgre template and I have not even programmed it yet. I am testing the build.</p>\n\n<p>In time.</p>\n\n<p>Files:</p>\n\n<pre><code>Application.ll\nCommon.ll\nFoundation.ll\nImport.ll\nModel.ll\nPaths_TesteYesod.ll\nSettings.ll\nComment.ll\nDevelMain.ll\nHome.ll\nmain.ll\nNoFoundation.ll\nProfile.ll\nStaticFiles.ll\n</code></pre>\n\n<p>I used llvm-link on all to get a TestYesod.bc</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1548267770, "post_id": 54331398, "comment_id": 95484473, "body": "That&#39;s the trouble with saying there&#39;s no way to do a thing... somebody might come along with something stupider than you&#39;re even willing to think of that does it."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 7, "last_activity_date": 1548259959, "creation_date": 1548259959, "answer_id": 54331398, "question_id": 54331107, "link": "https://stackoverflow.com/questions/54331107/hide-one-of-the-type-params-of-a-multi-param-typeclass-in-a-function-signature/54331398#54331398", "title": "Hide one of the type params of a multi-param typeclass in a function signature", "body": "<p>Using <code>TypeFamilies</code>, you could rewrite <code>C</code> into a single-parameter class as follows:</p>\n\n<pre><code>class B (BOf a) =&gt; C a where\n  type BOf a :: *\n  getB :: a -&gt; (T, BOf a)\n</code></pre>\n\n<p>Which gives you the better looking constraint for <code>f</code>:</p>\n\n<pre><code>f :: C a =&gt; a -&gt; c\n</code></pre>\n\n<p>There is (sadly) no way to omit parameters of a multi-parameter class to obtain a similar result.</p>\n"}, {"comments": [{"owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "edited": false, "score": 0, "creation_date": 1548297911, "post_id": 54333340, "comment_id": 95494054, "body": "Very glad to know this solution, but in this case I&#39;ll stick with the TypeFamilies method which gives me an ordinary function signature (I have to say this method leaves the user a really confusing grammar of the signature. If there would be a comment, I prefer to explain an extra <code>b</code> rather than an unfamiliar grammar). That said, maybe this answer solved my posted question better. I&#39;d say this method is really surprising, when you use a <code>forall b</code> where actually only one <code>b</code> would fit."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "reply_to_user": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "edited": false, "score": 0, "creation_date": 1548306517, "post_id": 54333340, "comment_id": 95495781, "body": "@Krantz: It may be more clear with explicit quantifiers: <code>forall a. C&#39; a (a -&gt; X)</code> expands to <code>forall a. (forall b. C a b =&gt; a -&gt; X)</code> which is exactly equivalent to omitting the quantifiers <code>C a b =&gt; a -&gt; X</code>. Even if you don\u2019t use it for this\u2014the notation is a little awkward, not looking like a constraint anymore\u2014the technique of writing type synonyms whose expansions include top-level <code>forall</code>s is handy for tidying up complex types."}, {"owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "reply_to_user": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1548307008, "post_id": 54333340, "comment_id": 95495909, "body": "@JonPurdy Yes, thanks for your explanation. They are certainly equivalent. I should have realized that there are implicit <code>forall</code>s in function signatures."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1548267408, "creation_date": 1548267408, "answer_id": 54333340, "question_id": 54331107, "link": "https://stackoverflow.com/questions/54331107/hide-one-of-the-type-params-of-a-multi-param-typeclass-in-a-function-signature/54333340#54333340", "title": "Hide one of the type params of a multi-param typeclass in a function signature", "body": "<p>If you turn on <code>RankNTypes</code> you can make a type alias that lets you elide <code>b</code> like this:</p>\n\n<pre><code>type C' a t = forall b. C a b =&gt; t\nf :: C' a (a -&gt; c)\nf = g . getB\n</code></pre>\n\n<p>You can even include further contexts, if necessary, inside the second argument:</p>\n\n<pre><code>f' :: C' a ((Num a, Ord c) =&gt; a -&gt; c)\nf' = g . getB\n</code></pre>\n\n<p>This is pretty non-standard, though. You'll want to leave an explanatory comment... and the effort of writing it might be bigger, in the end, than the effort of just including a <code>b</code> at each use of <code>C</code>.</p>\n"}], "owner": {"reputation": 616, "user_id": 8578679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CeZ5Z.png?s=128&g=1", "display_name": "Ruifeng Xie", "link": "https://stackoverflow.com/users/8578679/ruifeng-xie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 54331398, "answer_count": 2, "score": 6, "last_activity_date": 1548267408, "creation_date": 1548259083, "question_id": 54331107, "link": "https://stackoverflow.com/questions/54331107/hide-one-of-the-type-params-of-a-multi-param-typeclass-in-a-function-signature", "title": "Hide one of the type params of a multi-param typeclass in a function signature", "body": "<p>Say I have a multi-param typeclass: </p>\n\n<pre><code>class B b =&gt; C a b | a -&gt; b where\n    getB :: a -&gt; (T, b)\n</code></pre>\n\n<p>Then I want a function:</p>\n\n<pre><code>f :: C a b =&gt; a -&gt; c\nf = g . getB\n</code></pre>\n\n<p>Which uses another function <code>g :: B b =&gt; (T, b) -&gt; c</code> and <code>getB</code>, so an instance <code>C a b</code> is needed. </p>\n\n<p>(Disclaimer: the real problem is much more complicated, the above-mentioned is only a simplified version.)</p>\n\n<p>The problem is, given the functional dependency <code>C a b | a -&gt; b</code>, we know that <code>b</code> can be completely decided by <code>a</code>, so theoretically I should be possible not to mention <code>b</code> in the type of <code>f</code> (since it is not used elsewhere but in instance <code>C a b</code>), but I didn't find any way to achieve this. </p>\n\n<p>Also note that due to the existence of constraint <code>B b</code> in class <code>C</code>, I think I cannot use a TypeFamilies extension instead, for the syntax of that leaves nowhere for the type constraint <code>B b</code> to live. </p>\n\n<p>So is there any way that I can hide the implementation details (the irrelevant type parameter <code>b</code>) from the user of this function <code>f</code>? </p>\n"}, {"tags": ["haskell", "comonad"], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1548251529, "post_id": 54319763, "comment_id": 95475549, "body": "It might be worth it to also explain this metaphorically: If you want to edit every value inside of a structure-with-contexts independently with the same action (<code>fmap</code>/<code>(&lt;$&gt;)</code>), you can accomplish it by editing every value within its context (<code>extend</code>/<code>(&lt;&lt;=)</code>) and just ignoring the given context (<code>extract</code>)."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 10, "last_activity_date": 1548215726, "last_edit_date": 1548215726, "creation_date": 1548215349, "answer_id": 54319763, "question_id": 54319549, "link": "https://stackoverflow.com/questions/54319549/understanding-comonads/54319763#54319763", "title": "Understanding Comonad&#39;s &lt;$$&gt;", "body": "<p>You need the <code>extract</code> method of <code>Comonad</code>; <code>Extend</code> isn't enough to get away without <code>fmap</code>.</p>\n\n<pre><code>(&lt;$$&gt;)\n  :: Comonad f\n  =&gt; (a -&gt; b)\n  -&gt; f a\n  -&gt; f b\nf &lt;$$&gt; w = f . extract &lt;&lt;= w\n</code></pre>\n\n<p>This is basically how <code>liftW</code> is implemented in <code>Control.Comonad</code>.</p>\n\n<p>Note also that you need <code>&lt;&lt;=</code> (or <code>extend</code>); <code>extract</code> and <code>duplicate</code> aren't sufficient. The situation is similar to that of <code>Bind</code> and <code>Monad</code>; you can implement <code>fmap</code> using <code>&gt;&gt;=</code> and <code>pure</code>, but not using <code>&gt;&gt;=</code> alone and not using <code>join</code> and <code>pure</code>.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 54319763, "answer_count": 1, "score": 7, "last_activity_date": 1548215726, "creation_date": 1548213465, "question_id": 54319549, "link": "https://stackoverflow.com/questions/54319549/understanding-comonads", "title": "Understanding Comonad&#39;s &lt;$$&gt;", "body": "<p>Given the following from <a href=\"https://github.com/data61/fp-course\" rel=\"noreferrer\">fp-course</a>:</p>\n\n<pre><code>class Functor f where\n  (&lt;$&gt;) ::\n    (a -&gt; b)\n    -&gt; f a\n    -&gt; f b\n\nclass Functor f =&gt; Extend f where\n  (&lt;&lt;=) ::\n    (f a -&gt; b)\n    -&gt; f a\n    -&gt; f b\n</code></pre>\n\n<p>I defined <code>&lt;$$&gt;</code> as so:</p>\n\n<pre><code>(&lt;$$&gt;) ::\n  Comonad f =&gt;\n  (a -&gt; b)\n  -&gt; f a\n  -&gt; f b\n(&lt;$$&gt;) f fa = f &lt;$&gt; fa\n</code></pre>\n\n<p>However, I'm interested to know if there's another way to implement <code>&lt;$$&gt;</code> without using <code>&lt;$&gt;</code>. Is there? If so, please show it!</p>\n"}, {"tags": ["list", "haskell", "infinite"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1548201543, "post_id": 54318114, "comment_id": 95456165, "body": "I&#39;m not sure what you&#39;re expecting, but if you follow through how this will evaluate, the recursion only ends when <code>n &gt;= 0</code>, yet you are subtracting 1 from it each time. Hence, infinite recursion. [You are building up an infinite list in <code>xs</code> as you do this, but the evaluation never stops for GHC to &quot;see&quot; this. So this is different from an &quot;actual&quot; infinite list like <code>[1..]</code> where you can quite happily do operations with some elements.]"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548251619, "post_id": 54318114, "comment_id": 95475594, "body": "Ordinary function application occurs immediately; the evaluation of the recursive call isn&#39;t delayed until some later time."}], "answers": [{"tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": false, "score": 10, "last_activity_date": 1548203589, "creation_date": 1548203589, "answer_id": 54318417, "question_id": 54318114, "link": "https://stackoverflow.com/questions/54318114/lazy-evaluation-in-infinte-list/54318417#54318417", "title": "lazy evaluation in infinte list", "body": "<p>Let's step through the evaluation:</p>\n\n<pre><code>f (-3) []\nf (-4) [-3]\nf (-5) [-4, -3]\nf (-6) [-5, -4, -3]\nf (-7) [-6, -5, -4, -3]\n...\n</code></pre>\n\n<p>Considering this, what do you expect <code>f (-3) [] !! 1</code> to be? The value in the index <code>1</code> changes each iteration, so there's no way Haskell can know what it is until it reaches the non-recursive case at <code>n &gt;= 0</code>, which never happens.</p>\n\n<p>If you build the list in the other direction, it will work as you expect:</p>\n\n<pre><code>let f n = if n &lt; 0 then n : f (n - 1) else []\n\n&gt; f (-3) !! 1\n-4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 2, "last_activity_date": 1548206967, "last_edit_date": 1548206967, "creation_date": 1548204911, "answer_id": 54318556, "question_id": 54318114, "link": "https://stackoverflow.com/questions/54318114/lazy-evaluation-in-infinte-list/54318556#54318556", "title": "lazy evaluation in infinte list", "body": "<p>So here's a pretend integer type:</p>\n\n<pre><code>data Int2 = ... -- 2 bit signed integers [-2, -1, 0, 1]\n  deriving (Num, Ord, Eq, ...)\n</code></pre>\n\n<p>Let's imagine that your function was defined on <code>Int2</code> values:</p>\n\n<pre><code>f :: Int2 -&gt; [Int2] -&gt; [Int2]\nf n (xs) = if n &lt; 0 then f (n-1) (n:xs) else xs\n</code></pre>\n\n<p>This makes it fairly easy to work out what one evaluation step looks like for <code>f n xs</code>:</p>\n\n<pre><code>f 1 xs = xs\nf 0 xs = xs\nf (-1) xs = f (-2) (-1 : xs)\nf (-2) xs = f 1 (-2 : xs) -- because finite signed arithmetic wraps around\n</code></pre>\n\n<p>and from there we can work out the full value of <code>f n []</code>:</p>\n\n<pre><code>f 1 [] = []\nf 0 [] = []\nf (-1) [] = f (-2) [-1] = f 1 [-2, -1] = [-2, -1]\nf (-2) [] = f 1 [-2] = [-2]\n</code></pre>\n\n<p>Each computed a value, but note how it took 3 evaluation steps before we got a list out of <code>f (-1) []</code>.</p>\n\n<p>Now see if you can work out how many steps it would take to compute <code>f (-1) []</code> if it were defined on 4-bit numbers. 8-bit? 32-bit? 64-bit? What if it were using <code>Integer</code> which <em>has</em> no lower bound?</p>\n\n<p>At no point does laziness help you because there's no partial result, only a recursive call.  That's the difference between:</p>\n\n<pre><code>lazyReplicate 0 _ = []\nlazyReplicate n x = x : lazyReplicate (n - 1) x\n</code></pre>\n\n<p>and</p>\n\n<pre><code>strictReplicate n x = helper [] n x where\n  helper xs 0 _ = xs\n  helper xs n x = helper (x : xs) n x\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 6693361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f58900bd234776726d6dc98c5fa242c?s=128&d=identicon&r=PG&f=1", "display_name": "user6693361", "link": "https://stackoverflow.com/users/6693361/user6693361"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1548222119, "creation_date": 1548201096, "last_edit_date": 1548222119, "question_id": 54318114, "link": "https://stackoverflow.com/questions/54318114/lazy-evaluation-in-infinte-list", "title": "lazy evaluation in infinte list", "body": "<p>Hi I have the following code:</p>\n\n<pre><code>let f n (xs) = if n &lt; 0 then f (n-1) (n:xs) else xs\nf (-3) [] !! 1\n</code></pre>\n\n<p>and I expect it to print -4</p>\n\n<p>But it does not print anything and keeps calculation in background.</p>\n\n<p>What is wrong with my code?</p>\n"}, {"tags": ["haskell", "design-patterns", "monads", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 0, "creation_date": 1548259061, "post_id": 54317095, "comment_id": 95480099, "body": "How to create monadic action to get this <code>STRef</code>?  When I try to type <code>getSup = Comp $ asks supply</code> I get typechecker error"}, {"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 0, "creation_date": 1548260429, "post_id": 54317095, "comment_id": 95480927, "body": "Also, I would like to have <code>Comp Int</code> that will read this ref and put as result"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 1, "creation_date": 1548260589, "post_id": 54317095, "comment_id": 95481033, "body": "@radrow You can&#39;t return the reference with this setup, but you can <i>use</i> it. I&#39;ll add a small snippet about this."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1548260979, "last_edit_date": 1548260979, "creation_date": 1548194445, "answer_id": 54317095, "question_id": 54316935, "link": "https://stackoverflow.com/questions/54316935/carry-stref-implicitly-in-an-environment-during-computation/54317095#54317095", "title": "Carry STRef implicitly in an environment during computation", "body": "<p><code>runST</code> must be given a polymorphic argument, and you want your argument to come from <code>Comp</code>. Ergo <code>Comp</code> must contain a polymorphic thing.</p>\n\n<pre><code>newtype Env s = Env { supply :: STRef s Int }\nnewtype Comp a = Comp (forall s. ReaderT (Env s) (ST s) a)\n\nrunComp (Comp c) = runST $ do\n    s &lt;- newSTRef 0\n    runReaderT c (Env s)\n</code></pre>\n\n<p>Because <code>Comp</code> closes over <code>s</code>, you can't make an action which returns the contained <code>STRef</code>; but you can expose an action which uses the reference internally:</p>\n\n<pre><code>onRef :: (forall s. STRef s Int -&gt; ST s a) -&gt; Comp a\nonRef f = Comp $ asks supply &gt;&gt;= lift . f\n</code></pre>\n\n<p>e.g. <code>onRef readSTRef :: Comp Int</code> and <code>onRef (`modifySTRef` succ) :: Comp ()</code>. Another choice that might be more ergonomic is to make <code>Comp</code> itself monomorphic, but have <code>runComp</code> demand a polymorphic action. So:</p>\n\n<pre><code>newtype Comp s a = Comp (ReaderT (Env s) (ST s) a)\n\nrunComp :: (forall s. Comp s a) -&gt; a\nrunComp act = runST $ case act of\n    Comp c -&gt; do\n        s &lt;- newSTRef 0\n        runReaderT c (Env s)\n</code></pre>\n\n<p>Then you can write</p>\n\n<pre><code>getSup :: Comp s (STRef s Int)\ngetSup = Comp (asks supply)\n</code></pre>\n"}], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 54317095, "answer_count": 1, "score": 3, "last_activity_date": 1548260979, "creation_date": 1548193652, "question_id": 54316935, "link": "https://stackoverflow.com/questions/54316935/carry-stref-implicitly-in-an-environment-during-computation", "title": "Carry STRef implicitly in an environment during computation", "body": "<p>I am working on some bigger computation that requires use of mutable data in some critical moments. I want to avoid IO as much as I can.\nMy model used to constist of <code>ExceptT</code> over <code>ReaderT</code> over <code>State</code> datatype, and now I want to replace <code>State</code> with mentioned <code>ST</code>.</p>\n\n<p>To simplify, let's assume I would like to keep single <code>STRef</code> with an <code>Int</code> during the whole computation, and let's skip the <code>ExceptT</code> outer layer. My initial idea was to put <code>STRef s Int</code> into <code>ReaderT</code>'s environment:</p>\n\n<pre><code>{-#LANGUAGE Rank2Types#-}\n{-#LANGUAGE ExistentialQuantification#-}\n\ndata Env = Env { supply :: forall s. STRef s Int }\ndata Comp a = forall s. Comp (ReaderT Env (ST s) a)\n</code></pre>\n\n<p>And the evaluator:</p>\n\n<pre><code>runComp (Comp c) = runST $ do\n   s &lt;- newSTRef 0\n  runReaderT c (Env {supply = s})  -- this is of type `ST s a`\n</code></pre>\n\n<p>...and it fails because</p>\n\n<blockquote>\n  <p>Couldn't match type \u2018s\u2019 with \u2018s1\u2019</p>\n</blockquote>\n\n<p>Which seems to be clear, because I have mixed two separate phantom ST states. However, I have no idea how to bypass it. I have tried adding phantom <code>s</code> as <code>Comp</code> and <code>Env</code> parameter, but the result was the same and the code got uglier (but less suspicious because of lack of these <code>forall</code>s).</p>\n\n<p>The feature I am trying to achieve here is to make <code>supply</code> accessible at any time, but not passed explicitly (it does not deserve it). The most comfortable place to store it is in the environment, but I see no way in initializing it.</p>\n\n<p>I know there is such a thing like <code>STT</code> monad transformer which may help here, but it is not compatible with more ambitious data structures like hashtables (or is it?), so I don't want to use it as long as I cannot freely use classic <code>ST</code> libraries there.</p>\n\n<p>How to properly design this model? By \"properly\" I mean not only \"to typecheck\" but to \"to be nice to the rest of the code\" and \"as flexible as possible\".</p>\n"}, {"tags": ["c", "haskell", "ffi", "inline-c"], "comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1548193379, "post_id": 54315942, "comment_id": 95453635, "body": "It doesn&#39;t seem to be possible with any kind of C: inline or otherwise."}], "answers": [{"tags": [], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "is_accepted": false, "score": 0, "last_activity_date": 1548200259, "creation_date": 1548200259, "answer_id": 54318022, "question_id": 54315942, "link": "https://stackoverflow.com/questions/54315942/can-haskells-inline-c-return-a-typedef-to-a-function-pointer/54318022#54318022", "title": "Can Haskell&#39;s inline-C return a typedef to a function pointer?", "body": "<p>The code in my question works. I just forgot to include a C context.</p>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 6, "last_activity_date": 1548201427, "creation_date": 1548201427, "answer_id": 54318166, "question_id": 54315942, "link": "https://stackoverflow.com/questions/54315942/can-haskells-inline-c-return-a-typedef-to-a-function-pointer/54318166#54318166", "title": "Can Haskell&#39;s inline-C return a typedef to a function pointer?", "body": "\n\n<p>You are using contexts incorrectly.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>C.context :: Context -&gt; Q [Dec]\n</code></pre>\n\n<p>It is meant to be called as a Template Haskell top-level splice. All you've done is define</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>intializeMyCtx :: Q [Dec]\n</code></pre>\n\n<p>Which is a <code>Q</code>-action that <em>would</em> initialize your context if executed, but <em>isn't</em>. So, fix that:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type NotifyFuncT = FunPtr (Ptr C'WlListener -&gt; Ptr () -&gt; IO ())\n\nC.context $ C.baseCtx &lt;&gt; C.funCtx &lt;&gt; mempty {\n  C.ctxTypesTable = Data.Map.fromList [\n     (C.Struct \"wl_listener\", [t|C'WlListener|])\n  -- ...\n  ,  (C.TypeName \"wl_notify_func_t\", [t|NotifyFuncT|])\n  ]\n}\n</code></pre>\n\n<p>Second, <code>someHaskellFunction</code> is a tad overcomplicated. If you have a more complicated function, then <code>C.block</code> may be warranted, but right now a single <code>C.exp</code> will do everything.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>someHaskellFunction :: Ptr C'WlListener -&gt; IO NotifyFuncT\nsomeHaskellFunction ptr = [C.exp| wl_notify_func_t { $(struct wl_listener *ptr)-&gt;notify } |]\n</code></pre>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1548201427, "creation_date": 1548188712, "last_edit_date": 1548194034, "question_id": 54315942, "link": "https://stackoverflow.com/questions/54315942/can-haskells-inline-c-return-a-typedef-to-a-function-pointer", "title": "Can Haskell&#39;s inline-C return a typedef to a function pointer?", "body": "\n\n<p>I'm working with a C code base for which</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef void(* wl_notify_func_t) (struct wl_listener *listener, void *data) \n\n//...\n\nstruct wl_listener {\n  struct wl_list link;\n  wl_notify_func_t notify; //&lt;-- I'd like to return this\n};\n</code></pre>\n\n<p>and have used the Haskell code</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>type NotifyFuncT = FunPtr (Ptr C'WlListener -&gt; Ptr () -&gt; IO ())\n\ninitializeMyCtx = C.context $ C.baseCtx &lt;&gt; C.funCtx &lt;&gt; mempty {\n  C.ctxTypesTable = Data.Map.fromList [\n     (C.Struct \"wl_listener\", [t|C'WlListener|])\n  -- ...\n  ,  (C.TypeName \"wl_notify_func_t\", [t|NotifyFuncT|])\n  ]\n}\n\nsomeHaskellFunction :: Ptr C'WlListener -&gt; IO NotifyFuncT\nsomeHaskellFunction ptrToWlListener = do\n  funPtr &lt;- [C.block| wl_notify_func_t {return $(struct wl_listener * ptrToWlListener)-&gt;notify;}|]\n  return funPtr\n</code></pre>\n\n<p>Unfortunately, I get an error from the inline-C code block which essentially says:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>unexpected identifier  wl_notify_func_t\n</code></pre>\n\n<p>So is what I'm doing even possible with inline-C?</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1548185797, "post_id": 54315023, "comment_id": 95450484, "body": "Maybe a <a href=\"https://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\">sequence</a>? (There\u2019s probably something much more appropriate that I don\u2019t know about though.)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1548188465, "post_id": 54315023, "comment_id": 95451636, "body": "<code>Endo [Error]</code> is probably the most preferable here, but really a &#39;best implementation&#39; is too broad of a concept to answer in one question."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548197309, "post_id": 54315023, "comment_id": 95454963, "body": "<a href=\"https://hackage.haskell.org/package/these-0.7.5/docs/Control-Monad-Chronicle.html#t:MonadChronicle\" rel=\"nofollow noreferrer\">MonadChronicle</a>, perhaps."}, {"owner": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1548202453, "post_id": 54315023, "comment_id": 95456413, "body": "@AJFarmar why is <code>Endo [Error]</code> the most preferable? I\u2019ll narrow my question to \u201cmost efficient\u201d implementation relative to the efficiency you could get in an imperative language."}, {"owner": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548203015, "post_id": 54315023, "comment_id": 95456535, "body": "@DanielWagner at first glance <code>MonadChronicle</code> abstracts over a Semigroup. I\u2019m interested in which instance of Semigroup is most efficient for this task, or if a strategy besides a writer-esque monad is best. Am I wrong in my interpretation of <code>MonadChronicle</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "edited": false, "score": 0, "creation_date": 1548269195, "post_id": 54332565, "comment_id": 95485121, "body": "My pure code is already applicative, sorry for not making that clear."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 2, "last_activity_date": 1548264298, "creation_date": 1548264298, "answer_id": 54332565, "question_id": 54315023, "link": "https://stackoverflow.com/questions/54315023/efficient-implementation-of-an-error-log-monad/54332565#54332565", "title": "Efficient implementation of an error log monad", "body": "<p>You should base your logging monad on <code>StateT</code> <a href=\"http://hackage.haskell.org/package/containers-0.6.0.1/docs/Data-Sequence.html\" rel=\"nofollow noreferrer\"><code>Seq</code></a>. Bu using <code>StateT</code> you will have a monad transformer which can overlay your logging functionality on any other monad.</p>\n\n<blockquote>\n  <p>Some of my code is in an <code>ST</code> monad and some of my code is pure. I can use different monads for these different use cases. Should I use something different for my <code>ST</code> code than for my pure code?</p>\n</blockquote>\n\n<p>For the stuff in the <code>ST</code> monad you can use a monad transformer as described above. For pure code things are trickier: you will have to rewrite the pure code as monadic, or at least <a href=\"https://stackoverflow.com/questions/6570779/why-should-i-use-applicative-functors-in-functional-programming\">applicative</a>. At this point it is no longer pure because logging is a side effect. Its hard to advise further because I don't know what you are trying to achieve; it might make more sense to return the logging data from the pure code inside the result type.</p>\n"}], "owner": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 54332565, "answer_count": 1, "score": 4, "last_activity_date": 1548264298, "creation_date": 1548184688, "last_edit_date": 1548202654, "question_id": 54315023, "link": "https://stackoverflow.com/questions/54315023/efficient-implementation-of-an-error-log-monad", "title": "Efficient implementation of an error log monad", "body": "<p>I need a monad which will report error data types (not strings) over the course of a computation. I\u2019ve explored a couple different implementations:</p>\n\n<ul>\n<li>A <code>State [Error] a</code> monad where errors are added with cons (<code>:</code>) and at the very end I call <code>reverse</code> on the error list to get the actual order.</li>\n<li>A <code>Writer (Endo [Error]) a</code> monad where I can add errors with <code>Endo (e :)</code>. I\u2019m worried about all the useless concatenation of identity functions, though. If I never add any errors then my <code>Endo</code> will still be a large data structure comprised of many concatenated <code>id . id</code> compositions.</li>\n<li>A <code>Reader (MVector s Error) (ST s a)</code> monad where I grow the error vector when adding a new error. There isn\u2019t a pre-defined \u201cpush\u201d function in the vector package so I\u2019d have to write my own. Also, it would require me to add an <code>ST</code> monad to some of my computations.</li>\n</ul>\n\n<p>In an imperative language, I\u2019d use a vector and call the \u201cpush\u201d method or equivalent which would give me amortized O(1) appends and the resulting list would be in the correct order.</p>\n\n<p>What is the most efficient implementation of a Haskell monad (relative to the efficiency of an imperative language) for this task?</p>\n\n<p>Some of my code is in an <code>ST</code> monad and some of my code is pure. I can use different monads for these different use cases. Should I use something different for my <code>ST</code> code than for my pure code?</p>\n"}, {"tags": ["haskell", "haskell-stack", "ghci"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1548181640, "post_id": 54314210, "comment_id": 95448646, "body": "If stack supports them (?), you could use <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#sublibs\" rel=\"nofollow noreferrer\">internal libraries</a> to avoid duplicating <code>Prelude</code> without exporting it."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1548183287, "post_id": 54314210, "comment_id": 95449384, "body": "Using internal libraries seems to get further along  but I get <code>&lt;command line&gt;: cannot satisfy -package prelude</code> when doing e.g. <code>stack --nix ghci -v --ghc-options -XNoImplicitPrelude --main-is XXX:exe:XXX.exe</code> (the <code>-v</code>) didn&#39;t seem to show any more information relevant to the issue, and adding <code>-XNoImplicitPrelude</code> didn&#39;t change hte result either."}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 262, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1586377306, "creation_date": 1548180800, "last_edit_date": 1586377306, "question_id": 54314210, "link": "https://stackoverflow.com/questions/54314210/how-to-use-custom-prelude-with-stack-ghci", "title": "How to use custom prelude with stack ghci?", "body": "<p>I added a custom Prelude, which is working well for <code>stack build</code> and <code>stack test</code>. However, <code>stack ghci</code> does not like it, as it seems to be trying to load all of these at once:</p>\n\n<pre><code>$ stack --nix ghci\nXXX-0.1.0.0: initial-build-steps (lib + exe)\nThe following GHC options are incompatible with GHCi and have not been passed to it: -threaded\nConfiguring GHCi with the following packages: XXX\n\n* * * * * * * *\n\nError: Multiple files use the same module name:\n       * Prelude found at the following paths\n         * XXX/server/Prelude.hs (XXX:exe:XXX.exe)\n         * XXX/src/Prelude.hs (XXX:lib)\n         * XXX/tests/Prelude.hs (XXX:exe:tests.exe)\n* * * * * * * *\n\nNot attempting to start ghci due to these duplicate modules.\n</code></pre>\n\n<p>First, to explain the three different <code>Prelude.hs</code> files: they are identical as two of them are symbolic links to the third file; I hadn't thought of a better way to do this without possibly exposing my <code>Prelude.hs</code> to dependent libraries.</p>\n\n<p>A possible workaround would be to tell stack/ghci to only load the library code (under <code>src</code> in this case), or better yet, be able to tell it to skip particular <code>.hs</code> files on loading.</p>\n"}, {"tags": ["haskell", "monads", "reader"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1548180088, "post_id": 54313967, "comment_id": 95447948, "body": "<code>flip f = \\arg1 arg2 -&gt; f arg2 arg1</code> is all it takes to turn an <code>a -&gt; r -&gt; b</code> into an <code>r -&gt; a -&gt; b</code>. In Haskell, where functions are all one argument to one value (and the value is sometimes another function), that\u2019s also equivalent to <code>flip f arg1 arg2 = f arg2 arg1</code>."}], "answers": [{"comments": [{"owner": {"reputation": 309, "user_id": 7571000, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155043356444224/picture?type=large", "display_name": "Shane Unger", "link": "https://stackoverflow.com/users/7571000/shane-unger"}, "edited": false, "score": 0, "creation_date": 1548183533, "post_id": 54314116, "comment_id": 95449490, "body": "the fact that <code>flip</code> is only affecting <code>arb</code> and not the rest of the expression, is that because of the precedence of function application vs operators? <code>arb</code> is applied to <code>flip</code> and not <code>&lt;*&gt;</code> or <code>ra</code>, is this because applying the argument to flip is somehow taking precedence?"}, {"owner": {"reputation": 309, "user_id": 7571000, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155043356444224/picture?type=large", "display_name": "Shane Unger", "link": "https://stackoverflow.com/users/7571000/shane-unger"}, "edited": false, "score": 0, "creation_date": 1548183943, "post_id": 54314116, "comment_id": 95449663, "body": "In other words, why don&#39;t we have to write <code>(flip arb) &lt;*&gt; ra</code>?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 2, "creation_date": 1548184416, "post_id": 54314116, "comment_id": 95449858, "body": "It might be worth pointing out that Reader-like monads are the only ones that can be implemented solely in terms of the applicative operators."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 309, "user_id": 7571000, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155043356444224/picture?type=large", "display_name": "Shane Unger", "link": "https://stackoverflow.com/users/7571000/shane-unger"}, "edited": false, "score": 1, "creation_date": 1548189295, "post_id": 54314116, "comment_id": 95451979, "body": "@ShaneUnger <code>(flip arb) &lt;*&gt; ra</code> is fine, too. And yes, prefix function application binds tighter than infix function application, so even without the parentheses it means that same thing."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1548180425, "creation_date": 1548180425, "answer_id": 54314116, "question_id": 54313967, "link": "https://stackoverflow.com/questions/54313967/deriving-monad-bind-from-applicative-confusion/54314116#54314116", "title": "Deriving monad bind from applicative (&lt;*&gt;) confusion", "body": "<p>Top-level point of confusion, I think: <code>flip</code> is modifying <code>arb</code>, not modifying <code>&lt;*&gt;</code> as you seem to believe. We have \"modified\" <code>&lt;*&gt;</code> to have the \"right\" argument order just by giving <code>&lt;*&gt;</code> its arguments in the opposite order we got them!</p>\n\n<p>Now for the details. We have, as you noted:</p>\n\n<pre><code>(&gt;&gt;=) :: (r -&gt; a) -&gt; (a -&gt; r -&gt; b) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>So, since we have on the left hand side written</p>\n\n<pre><code>ra &gt;&gt;= arb = ...\n</code></pre>\n\n<p>then what we have in scope is:</p>\n\n<pre><code>ra :: r -&gt; a\narb :: a -&gt; r -&gt; b\n</code></pre>\n\n<p>(Note how the names were chosen to reflect the types!) Rewriting the type you gave for <code>flip</code>, we have</p>\n\n<pre><code>flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c -- original\nflip :: (a -&gt; r -&gt; b) -&gt; r -&gt; a -&gt; b -- rename variables\n</code></pre>\n\n<p>hence:</p>\n\n<pre><code>flip arb :: r -&gt; a -&gt; b\n</code></pre>\n\n<p>Now recall the type of <code>(&lt;*&gt;)</code> that you wrote:</p>\n\n<pre><code>(&lt;*&gt;) :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>So for the first argument to <code>(&lt;*&gt;)</code>, we want something of type <code>r -&gt; a -&gt; b</code>. Hey! <code>flip arb</code> has that type! For the second argument, we want something of type <code>r -&gt; a</code>. And we're in luck again, because <code>ra</code> has that type, so...</p>\n\n<pre><code>flip arb &lt;*&gt; ra :: r -&gt; b\n</code></pre>\n\n<p>(As usual with infix operators, this is the application of the operator <code>(&lt;*&gt;)</code> the arguments <code>flip arb</code> and <code>ra</code>.) What type were we hoping to have? Well, we go back to the type of <code>(&gt;&gt;=)</code> now:</p>\n\n<pre><code>(&gt;&gt;=) :: (r -&gt; a) -&gt; (a -&gt; r -&gt; b) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>After taking two arguments, this is supposed to return something of type <code>r -&gt; b</code>. Cool, that's what we have built.</p>\n\n<pre><code>ra &gt;&gt;= arb = flip arb &lt;*&gt; ra\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 7571000, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155043356444224/picture?type=large", "display_name": "Shane Unger", "link": "https://stackoverflow.com/users/7571000/shane-unger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 54314116, "answer_count": 1, "score": 3, "last_activity_date": 1548180425, "creation_date": 1548179872, "last_edit_date": 1548180226, "question_id": 54313967, "link": "https://stackoverflow.com/questions/54313967/deriving-monad-bind-from-applicative-confusion", "title": "Deriving monad bind from applicative (&lt;*&gt;) confusion", "body": "<p>Working through the Haskell Book and my brain is breaking on the following example. I really don't know what the <code>flip</code> function is doing on line 21</p>\n\n<pre><code>1 class Functor f where\n2   fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n3\n4 class Functor f =&gt; Applicative f where\n5   pure :: a -&gt; f a\n6   (&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n7\n8 class Applicative f =&gt; Monad f where\n9   return :: a -&gt; f a\n10   (&gt;&gt;=) :: f a -&gt; (a -&gt; f b) -&gt; f b\n11\n12 instance Functor ((-&gt;) r) where\n13   fmap = (.)\n14\n15 instance Applicative ((-&gt;) r) where\n16   pure = const\n17   f &lt;*&gt; a = \\r -&gt; f r (a r)\n18\n19 instance Monad ((-&gt;) r ) where\n20   return = pure\n21   ra &gt;&gt;= arb = flip arb &lt;*&gt; ra\n\n\n-- flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\n\n-- ra &gt;&gt;= arb = flip arb &lt;*&gt; ra\n</code></pre>\n\n<p>As I understand it, flip takes a function that takes two arguments, then two individual arguments, and returns a value. In the bind example, are we passing <code>arb</code> as the <code>(a -&gt; b -&gt; c)</code>, then <code>&lt;*&gt;</code> as the <code>b</code> in flip's signature, and finally <code>ra</code> as the <code>a</code>? I can't see it.</p>\n\n<p>I've tried making the types more specific to my actual example so you could rewrite <code>&lt;*&gt;</code> as</p>\n\n<pre><code>(&lt;*&gt;) :: (r -&gt; a -&gt; b) -&gt; (r -&gt; a) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>and I can do the same for bind</p>\n\n<pre><code>(&gt;&gt;=) :: (r -&gt; a) -&gt; (a -&gt; r -&gt; b) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>so even a dummy like myself can see that if we could swap <code>&lt;*&gt;</code> around\nwe could line then up like </p>\n\n<pre><code>(&lt;???&gt;) :: (r -&gt; a) -&gt; (r -&gt; a -&gt; b) -&gt; (r -&gt; b)\n(&gt;&gt;=) ::   (r -&gt; a) -&gt; (a -&gt; r -&gt; b) -&gt; (r -&gt; b)\n</code></pre>\n\n<p>but looking at the second arguments there, the first one wants an <code>r</code> as its first argument and bind wants an <code>a</code></p>\n\n<p>So somehow <code>flip</code> is the book's example is doing that for us, but I really don't understand how. Any help would be greatly appreciated. </p>\n\n<p>Thank you!</p>\n"}, {"tags": ["database", "haskell", "types", "io", "int"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1548174235, "post_id": 54312262, "comment_id": 95444986, "body": ".Reading from a file is inherently an I/O operation - so you will need an <code>IO</code> in the return type. Therefore either you will need the <code>id</code> field to have type <code>IO Int</code> or (probably better) <code>someRow</code> needs to have type <code>IO SomeTable</code>."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 8, "last_activity_date": 1548175568, "creation_date": 1548175568, "answer_id": 54312849, "question_id": 54312262, "link": "https://stackoverflow.com/questions/54312262/using-numeric-file-content-as-int-haskell/54312849#54312849", "title": "Using numeric file content as int (Haskell)", "body": "<p>Well <code>IO Int</code> is an action, like reading a keystroke, that results in an <code>Int</code>.  So execute the action to obtain an Int:</p>\n\n<pre><code>data SomeTable = SomeTable { id :: Int, testField :: String }\nsomeRow :: IO SomeTable\nsomeRow =\n    do i &lt;- generateNextId \"SomeTable\"\n       return (SomeTable i \"Test\")\n\nsomeRowAlternative :: IO SomeTable\nsomeRowAlternative =\n    SomeTable &lt;$&gt; generateNextId \"SomeTable\" &lt;*&gt; pure \"Test\"\n</code></pre>\n"}], "owner": {"reputation": 815, "user_id": 2999349, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6f8c06e9cd70225f8ec5af4d4225a351?s=128&d=identicon&r=PG&f=1", "display_name": "user2999349", "link": "https://stackoverflow.com/users/2999349/user2999349"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 54312849, "answer_count": 1, "score": -4, "last_activity_date": 1548175568, "creation_date": 1548173540, "question_id": 54312262, "link": "https://stackoverflow.com/questions/54312262/using-numeric-file-content-as-int-haskell", "title": "Using numeric file content as int (Haskell)", "body": "<p>Is there some way I can use the contents of a file, which contain a counter value ( increment id for a database system ) as a regular int?</p>\n\n<p>We're trying to create a little database system in Haskell, and need to keep track of the increment ids of tables. We figured the only \"easy\" way to do this is by saving them in a plain txt file. However, when retrieving them, the return type will be <code>IO Int</code>. Our database table definition requires an <code>Int</code> for the id though.</p>\n\n<p>Does anyone have an idea how to use the increment id ( or integer value in general ) from a txt file for a class instance that requires an <code>Int</code> value?</p>\n\n<p>Thanks in advance!</p>\n\n<p>EDIT: An example of code illustrating the problem:</p>\n\n<pre><code>data SomeTable = SomeTable { id :: Int, testField :: String }\nsomeRow = SomeTable (generateNextId \"SomeTable\") \"Test\"\n</code></pre>\n\n<p>Where <code>generateNextId</code> reads the current increment id from a file ( and therefore has type <code>IO Int</code> and not <code>Int</code> ).</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 1, "creation_date": 1548165478, "post_id": 54309255, "comment_id": 95439368, "body": "Try to write a version without recursion. Hint: use <code>zipWith</code> and <code>sum</code>."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9691862, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "liu fish", "link": "https://stackoverflow.com/users/9691862/liu-fish"}, "edited": false, "score": 0, "creation_date": 1548163873, "post_id": 54309362, "comment_id": 95438313, "body": "ok, i understand , thank u"}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "reply_to_user": {"reputation": 11, "user_id": 9691862, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "liu fish", "link": "https://stackoverflow.com/users/9691862/liu-fish"}, "edited": false, "score": 0, "creation_date": 1548163910, "post_id": 54309362, "comment_id": 95438334, "body": "don&#39;t forget to mark as solved ;)"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1548163925, "post_id": 54309362, "comment_id": 95438343, "body": "You&#39;ve neglected two cases: when only one of the two lists are empty. This will continue to produce an error in some cases."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1548164228, "post_id": 54309362, "comment_id": 95438545, "body": "@AJFarmar yep! forgot it actually. Already edited, thanks ;)"}], "tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": true, "score": 6, "last_activity_date": 1548169066, "last_edit_date": 1548169066, "creation_date": 1548163669, "answer_id": 54309362, "question_id": 54309255, "link": "https://stackoverflow.com/questions/54309255/non-exhaustive-patterns-in-function-scalarnew/54309362#54309362", "title": "Non-exhaustive patterns in function scalarNew", "body": "<p>You have to add the base case when using recursion. In this situation, the base case is when both are empty lists.</p>\n\n<pre><code>scalarNew :: [Integer] -&gt; [Integer] -&gt; Integer\nscalarNew []     []        = 0\nscalarNew []     (y:ys)    = error \"error\"\nscalarNew (x:xs)    []     = error \"error\"\nscalarNew (x:xs) (y:ys) \n  | length xs == length ys = x * y + scalarNew xs ys\n  | otherwise = error \"error\"\n</code></pre>\n\n<p>edit: handle only-one-empty-list case</p>\n"}], "owner": {"reputation": 11, "user_id": 9691862, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "liu fish", "link": "https://stackoverflow.com/users/9691862/liu-fish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "closed_date": 1548167877, "accepted_answer_id": 54309362, "answer_count": 1, "score": 0, "last_activity_date": 1548169066, "creation_date": 1548163287, "last_edit_date": 1548166832, "question_id": 54309255, "link": "https://stackoverflow.com/questions/54309255/non-exhaustive-patterns-in-function-scalarnew", "closed_reason": "Duplicate", "title": "Non-exhaustive patterns in function scalarNew", "body": "<p>What does <em>\"Non-exhaustive patterns in function scalarNew\"</em> mean in this context?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>scalarNew :: [Integer]-&gt;[Integer]-&gt;Integer\nscalarNew (x:xs) (y:ys) \n     | (length xs == length ys) = x * y + scalarNew xs ys\n     | otherwise = error \"error\"\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1548158549, "creation_date": 1548158549, "answer_id": 54307916, "question_id": 54307203, "link": "https://stackoverflow.com/questions/54307203/how-can-i-find-a-stack-resolver-that-contains-my-package/54307916#54307916", "title": "How can i find a stack resolver that contains my package?", "body": "<p>It does not seem to be very well advertised on stackage, but one can obtain the list of all the snapshots a package appears in using an URL like the following one.</p>\n\n<p><a href=\"https://www.stackage.org/package/hip/snapshots\" rel=\"nofollow noreferrer\">https://www.stackage.org/package/hip/snapshots</a></p>\n\n<p>How did I find that URL? I browsed an old enough LTS which contained <code>hip</code>. Then I browsed the <code>hip</code> package page within that snapshot. There, I found a link named \"<a href=\"https://www.stackage.org/package/hip/snapshots\" rel=\"nofollow noreferrer\">See all snapshots <code>hip</code> appears in</a>\".</p>\n"}, {"tags": [], "owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "is_accepted": false, "score": 1, "last_activity_date": 1548159933, "creation_date": 1548159933, "answer_id": 54308287, "question_id": 54307203, "link": "https://stackoverflow.com/questions/54307203/how-can-i-find-a-stack-resolver-that-contains-my-package/54308287#54308287", "title": "How can i find a stack resolver that contains my package?", "body": "<p>I answered this in your previous question, <code>https://www.stackage.org/package/THE_PACKAGE_NAME</code></p>\n"}], "owner": {"reputation": 152, "user_id": 3832741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b2d9a1d01a90d056c75963e0c06fba?s=128&d=identicon&r=PG&f=1", "display_name": "Agilix", "link": "https://stackoverflow.com/users/3832741/agilix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1548159933, "creation_date": 1548156204, "question_id": 54307203, "link": "https://stackoverflow.com/questions/54307203/how-can-i-find-a-stack-resolver-that-contains-my-package", "title": "How can i find a stack resolver that contains my package?", "body": "<p>Trying to install hip with the newest stack resolver (lts-13.4) does not work (see my question <a href=\"https://stackoverflow.com/questions/54296951/stack-does-not-resolve-dependencies-when-installing-hip/\">here</a>), because dependencies are not in hackage. However, installing with resolver lts-7.5 does work. How can i find out which resolver can install a specific package?</p>\n"}, {"tags": ["haskell", "servant"], "comments": [{"owner": {"reputation": 188, "user_id": 5772563, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DVfEl50m8KI/AAAAAAAAAAI/AAAAAAAAADk/gmX7V01d4u8/photo.jpg?sz=128", "display_name": "Adrian Legaspi", "link": "https://stackoverflow.com/users/5772563/adrian-legaspi"}, "edited": false, "score": 0, "creation_date": 1548166203, "post_id": 54301058, "comment_id": 95439803, "body": "As the error says, it seems that TLS is not supported, can you try downgrading your connection to <code>Http</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 0, "creation_date": 1548171892, "post_id": 54311725, "comment_id": 95443586, "body": "The above code is based on the Cookbook code: <a href=\"https://haskell-servant.readthedocs.io/en/v0.15/cookbook/using-free-client/UsingFreeClient.html\" rel=\"nofollow noreferrer\">haskell-servant.readthedocs.io/en/v0.15/cookbook/&hellip;</a>"}, {"owner": {"reputation": 309, "user_id": 4740467, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e653edf458dc50848e813cf0dfde6a10?s=128&d=identicon&r=PG&f=1", "display_name": "Conor Quinn", "link": "https://stackoverflow.com/users/4740467/conor-quinn"}, "edited": false, "score": 0, "creation_date": 1548387358, "post_id": 54311725, "comment_id": 95531728, "body": "Thanks a lot. I was able to fixed the api_key but didn&#39;t know to use parseBaseUrl. Do you know why the BaseUrl type constructor wasnt working here?"}], "tags": [], "owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "is_accepted": true, "score": 0, "last_activity_date": 1548171665, "creation_date": 1548171665, "answer_id": 54311725, "question_id": 54301058, "link": "https://stackoverflow.com/questions/54301058/making-client-bindings-in-haskell-servant-connectionerror/54311725#54311725", "title": "Making client bindings in Haskell servant - ConnectionError", "body": "<p>It is a combination of two things:</p>\n\n<ol>\n<li><code>api_key</code> should be <code>apiKey</code></li>\n<li><p>Rely on <code>parseBaseUrl</code> </p>\n\n<pre><code>burl  &lt;- parseBaseUrl \"http://newsapi.org/v2\"\n</code></pre></li>\n</ol>\n\n<p>This worked for me in the sample project I set up.</p>\n\n<pre><code>{-# LANGUAGE DataKinds     #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule Main where\n\nimport           Control.Monad.Free\nimport           Servant.Client.Free\n\nimport qualified Network.HTTP.Client                as HTTP\nimport qualified Servant.Client.Internal.HttpClient as I\n\nimport           Network.Wai.Handler.Warp           (run)\nimport           Servant\nimport           System.Environment                 (getArgs)\n\ntype NewsAPI = \"top-headlines\" :&gt; QueryParam \"country\" String :&gt; QueryParam \"apiKey\" String :&gt; Get '[JSON] String\n\n\ntopheadlines :: Maybe String -&gt; Maybe String -&gt; Free ClientF String\ntopheadlines = client api\n\n\napi :: Proxy NewsAPI\napi = Proxy\n\n\nmain :: IO ()\nmain = do\n  test\n\n\ntest :: IO ()\ntest = case topheadlines (Just \"us\") (Just \"API_KEY\") of\n    Pure n -&gt;\n        putStrLn $ \"ERROR: got pure result: \" ++ show n\n\n    Free (Throw err) -&gt;\n        putStrLn $ \"ERROR: got error right away: \" ++ show err\n\n    Free (StreamingRequest _req _k) -&gt;\n        putStrLn $ \"ERROR: need to do streaming request\" \n    Free (RunRequest req k) -&gt; do\n        burl  &lt;- parseBaseUrl \"http://newsapi.org/v2\"\n        mgr   &lt;- HTTP.newManager HTTP.defaultManagerSettings\n\n        let req' = I.requestToClientRequest burl req\n        putStrLn $ \"Making request: \" ++ show req'\n\n        res' &lt;- HTTP.httpLbs req' mgr\n        putStrLn $ \"Got response: \" ++ show res'\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 4740467, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e653edf458dc50848e813cf0dfde6a10?s=128&d=identicon&r=PG&f=1", "display_name": "Conor Quinn", "link": "https://stackoverflow.com/users/4740467/conor-quinn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 54311725, "answer_count": 1, "score": 2, "last_activity_date": 1548387267, "creation_date": 1548129503, "last_edit_date": 1548387267, "question_id": 54301058, "link": "https://stackoverflow.com/questions/54301058/making-client-bindings-in-haskell-servant-connectionerror", "title": "Making client bindings in Haskell servant - ConnectionError", "body": "<p>I am trying to make client bindings for the News api provided by newsapi.org using the Haskell servant library. I have created the following endpoint:</p>\n\n<pre><code>type NewsAPI = \"top-headlines\" :&gt; QueryParam \"country\" String :&gt; QueryParam \"apiKey\" String :&gt; Get '[JSON] TopHeadlines\n</code></pre>\n\n<p>And attempted to call it as follows:</p>\n\n<pre><code>topheadlines :: Maybe String -&gt; Maybe String -&gt; ClientM TopHeadlines\n\napi :: Proxy NewsAPI\napi = Proxy\n\ntopheadlines = client api\n\nquery = topheadlines (Just \"us\") (Just \"&lt;api key&gt;\")\n\nrun3 :: IO ()\nrun3 = do\n  manager' &lt;- newManager defaultManagerSettings\n  users &lt;- runClientM query (mkClientEnv manager' (BaseUrl Https \"newsapi.org/v2\" 443 \"\"))\n  print users\n</code></pre>\n\n<p>I keep getting a connection error that I don't entirely understand how to reason about: </p>\n\n<p><code>Left (ConnectionError \"HttpExceptionRequest Request {\\n  host                 = \\\"newsapi.org/v2\\\"\\n  port                 = 443\\n  secure               = True\\n  requestHeaders       = [(\\\"Accept\\\",\\\"application/json;charset=utf-8,application/json\\\")]\\n  path                 = \\\"/top-headlines\\\"\\n  queryString          = \\\"?country=us&amp;api_key=90a38fab85c440fa88521e0789248f83\\\"\\n  method               = \\\"GET\\\"\\n  proxy                = Nothing\\n  rawBody              = False\\n  redirectCount        = 10\\n  responseTimeout      = ResponseTimeoutDefault\\n  requestVersion       = HTTP/1.1\\n}\\n TlsNotSupported\")</code></p>\n\n<p>Not sure why there is no connection. Another set of client bindings I have is working fine.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 4, "creation_date": 1548123055, "post_id": 54300271, "comment_id": 95420891, "body": "What do you mean by <i>&quot;it does not work&quot;</i>? What error did you get? Did you actually define <code>second</code> before trying to find its type? Please edit your question to add this information."}, {"owner": {"reputation": 1, "user_id": 9213307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86053b484b6fde69031cc3556c663332?s=128&d=identicon&r=PG&f=1", "display_name": "optimus", "link": "https://stackoverflow.com/users/9213307/optimus"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1548123363, "post_id": 54300271, "comment_id": 95420953, "body": "*Main&gt; :type second second :: [a] -&gt; a"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1548124221, "post_id": 54300271, "comment_id": 95421107, "body": "You have not explained anything with this comment. Again, please <a href=\"https://stackoverflow.com/posts/54300271/edit\">edit your question</a> to add relevant information such as what errors or problems arise, and the full code you typed in to GHCi."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1548200130, "post_id": 54300271, "comment_id": 95455784, "body": "&quot;is this the function type?&quot; Yes.  It&#39;s the function type."}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548175892, "post_id": 54300576, "comment_id": 95445942, "body": "For completeness, note that the type variable <code>a</code> represents any single type, without any constraints on what that type might be. The return type, however, must be the same as whatever type of list you started with. (Given <code>[Int]</code>, you&#39;ll get back an <code>Int</code>; given <code>[Char]</code>, you&#39;ll get back a <code>Char</code>, etc.)"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548192338, "post_id": 54300576, "comment_id": 95453242, "body": "Yes, that&#39;s a very good point. Can I edit it in for completeness?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548192732, "post_id": 54300576, "comment_id": 95453409, "body": "By all means, please do"}], "tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 3, "last_activity_date": 1548193238, "last_edit_date": 1548193238, "creation_date": 1548125158, "answer_id": 54300576, "question_id": 54300271, "link": "https://stackoverflow.com/questions/54300271/what-are-the-function-types/54300576#54300576", "title": "What are the Function types", "body": "<p>As you already know, you can use GHCi to find the type of a Haskell identifier by using the <code>:type</code> command (or its shorter version <code>:t</code>). In this case, GHCi gives you the answer <code>second :: [a] -&gt; a</code>. The <code>::</code> symbol means 'type-of', so this answer is just GHCi's way of telling you that 'the type of <code>second</code> is <code>[a] -&gt; a</code>'.</p>\n\n<p>But there's still another question here: what does this type mean? Well, let's pull it apart:</p>\n\n<ul>\n<li>Any type of the form <code>x -&gt; y</code> is the type of a function which takes as input one parameter of type <code>x</code>, and returns a value of type <code>y</code>.</li>\n<li>In this case, we have a type <code>[a] -&gt; a</code>, so the input type is <code>[a]</code> (i.e. a list of values of type <code>a</code>), and the output type is <code>a</code> (i.e. a single value of type <code>a</code>).</li>\n<li>Thus, the statement <code>second :: [a] -&gt; a</code> means that <code>second</code> is a function which takes as input a list of <code>a</code>s, and gives as output a single value of the same type <code>a</code>. This ties in with what we know of the function: given a list, it returns a single value from that list.</li>\n</ul>\n\n<p><strong>EDIT:</strong> As @chepner pointed out in the comments, it is important to realise that <code>a</code> is a stand-in for <em>any</em> type. The only constraint is that, if the input is a list of <code>a</code>s, then - no matter what <code>a</code> is - the return type must also be of type <code>a</code>. (This sort of indeterminate type is called a <em>type variable</em>.)</p>\n"}], "owner": {"reputation": 1, "user_id": 9213307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86053b484b6fde69031cc3556c663332?s=128&d=identicon&r=PG&f=1", "display_name": "optimus", "link": "https://stackoverflow.com/users/9213307/optimus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1548193238, "creation_date": 1548122831, "last_edit_date": 1548131087, "question_id": 54300271, "link": "https://stackoverflow.com/questions/54300271/what-are-the-function-types", "title": "What are the Function types", "body": "<p>The question is to determine function type of this : second xs = head (tail xs)</p>\n\n<p>I tried everything </p>\n\n<p>:t second gives me:</p>\n\n<pre><code>*Main&gt; :type second\nsecond :: [a] -&gt; a --- is this the function type?\n</code></pre>\n\n<p>,then I tried :type second; :type \"second xs = head (tail xs)\".</p>\n\n<p>It still does not work. How to determine Function type using Haskell</p>\n"}, {"tags": ["haskell", "type-families", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1548182887, "post_id": 54305226, "comment_id": 95449211, "body": "I phrased my  question badly: right now I&#39;m only interested the performance of compile-time computation, and more on the &quot;how many times&quot; than on the &quot;when&quot;. I\u2019m working on a small extensible records library, and the compile times are quite long for big records. After tinkering a little, I noticed that I can sometimes avoid &quot;duplicate computation&quot; by using auxiliary type families, and that actually improved things. But I still don&#39;t have a good mental model for how compilation proceeds, what to avoid, and what other means exist for making things fast. Thanks for the OutsideIn(X) pointer."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1548224832, "post_id": 54305226, "comment_id": 95461347, "body": "As some very oblique evidence that GHC doesn&#39;t currently try to detect two type expressions are the same, see Trac #16070, and the linked discussion on github PR #158. On why even asking the question &quot;when&quot;: OutsideIn(X) has something equivalent to (but not as indeterminate as) Robinson&#39;s unification algorithm used by Hindley-Milner; if it successfully unifies variable <code>alpha</code> with <code>beta</code>, does that count as solving once or twice? Necessarily they&#39;re duplicates (in a sense)."}], "tags": [], "owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "is_accepted": false, "score": 2, "last_activity_date": 1548150232, "last_edit_date": 1548150232, "creation_date": 1548149823, "answer_id": 54305226, "question_id": 54298813, "link": "https://stackoverflow.com/questions/54298813/when-does-type-level-computation-happen-with-type-families/54305226#54305226", "title": "When does type-level computation &quot;happen&quot; with type families?", "body": "<p>Haskell has \"type erasure semantics\". That is, assuming the compiler can resolve all types, then type inference \"happens\" at compile time; there is no computational effect at run time.</p>\n\n<p>The compiler may not be able to 'resolve all types' under separate compilation: that is, it needs to postpone inference for this module until compiling some other module into which this is imported. At a worst case this might need postponing to execution time; and what's then getting executed is dictionary-passing/dictionary lookups.</p>\n\n<p>The paper that explains type inference in modern GHC, including for type families, is OutsideIn(X). Your answer will be in there.</p>\n\n<p>But seriously, why are you bothered about the performance internals of type \"computation\"? It is what it is. And your whole question has a nasty smell of expecting a procedural algorithm; whereas type solving behaves more like logic programming. Asking \"when\" it's executed is even less appropriate than asking \"when\" an expression is evaluated in a lazy language.</p>\n"}], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1548150232, "creation_date": 1548110805, "question_id": 54298813, "link": "https://stackoverflow.com/questions/54298813/when-does-type-level-computation-happen-with-type-families", "title": "When does type-level computation &quot;happen&quot; with type families?", "body": "<p>I'm trying to form an intuition about when (and how many times) type-level computation with type families \"happens\" in Haskell. For a concrete example, consider this typeclass for indexing into an <a href=\"http://hackage.haskell.org/package/sop-core-0.4.0.0/docs/Data-SOP-NP.html\" rel=\"noreferrer\">n-ary product</a> using a type-level natural:</p>\n\n<pre><code>{-# LANGUAGE DataKinds, TypeOperators, KindSignatures, TypeFamilies, MultiParamTypeClasses,\n             ScopedTypeVariables, TypeApplications, AllowAmbiguousTypes\n#-}\nimport Data.Kind (Type)\nimport Data.SOP (I(..),NP(..)) -- identity functor and n-ary product from \"sop-core\"\n\ndata N = Zero | Succ N -- to be used as a kind\n\nclass Key (i :: N) (ts :: [Type]) where\n    type Value i ts :: Type\n    getValue  :: NP I ts -&gt; Value i ts\n\ninstance Key Zero (t:ts) where\n    type Value Zero (t:ts) = t\n    getValue (I v :* _) = v\n\ninstance Key n ts =&gt; Key (Succ n) (t : ts) where\n    type Value (Succ n) (t:ts) = Value n ts\n    getValue (_ :* rest) = getValue @n rest\n\ngetValue' :: forall n ts. Key n ts =&gt; NP I ts -&gt; Value n ts\ngetValue' = getValue @n @ts\n\ngetTwoValues :: forall n ts. Key n ts =&gt; NP I ts -&gt; NP I ts -&gt; (Value n ts, Value n ts)\ngetTwoValues np1 np2 = let getty = getValue @n @ts in (getty np1, getty np2)\n\nmain :: IO ()\nmain = do let np = I True :* I 'c' :* Nil\n          print $ getValue     @(Succ Zero) np\n          print $ getValue'    @(Succ Zero) np\n          print $ getTwoValues @(Succ Zero) np np\n</code></pre>\n\n<p>My intuition is that typechecking that occurrence of <code>getValue</code> in <code>main</code> triggers the \"traversal\" of the type-level list at compile-time in search of the corresponding value type <code>Value (Succ Zero) '[Bool,Char]</code>. This traversal can be costly for large lists.</p>\n\n<p>But what about <code>getValue'</code>? Does it trigger the \"traversal\" of the type level list one time, as before, or <em>two</em> times, one to check <code>getValue'</code> itself and another to check the <code>getValue</code> on which it depends?</p>\n\n<p>And what about <code>getTwoValues</code>? In its signature there are two type family invocations <code>Value n ts</code>, even if they correspond to the exact same type. Do they get computed independently\u2014slowing compilation\u2014or is the computation \"shared\" at the type level?</p>\n"}, {"tags": ["haskell", "polymorphism", "record"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1548110859, "last_edit_date": 1548110859, "creation_date": 1548106818, "answer_id": 54298121, "question_id": 54297226, "link": "https://stackoverflow.com/questions/54297226/unexpected-caching-behavior-using-polymorphic-records-in-haskell/54298121#54298121", "title": "Unexpected caching behavior using polymorphic records in Haskell", "body": "<p>Hold my beer.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE ConstraintKinds #-}\nimport Debug.Trace\n\ndata Dict c where Dict :: c =&gt; Dict c\n\n-- An isomorphism between explicit dictionary-passing style (Dict c -&gt; a)\n-- and typeclass constraints (c =&gt; a) exists:\nfrom :: (c =&gt; a) -&gt; (Dict c -&gt; a)\nfrom v Dict = v\n\nto :: (Dict c -&gt; a) -&gt; (c =&gt; a)\nto f = f Dict\n\ndata Translation = Trans { m :: forall a . Floating a =&gt; a }\n\nf1, f2 :: Dict (Floating a) -&gt; a -&gt; a\nf1 = trace \"hello\" $ \\Dict x -&gt; x - 2.0\nf2 = \\Dict -&gt; trace \"hello\" $ \\x -&gt; x - 2.0\n\nmain = do\n    let trans1 = Trans { m = to (flip f1 1.5) }\n        trans2 = Trans { m = to (flip f2 1.5) }\n    putStrLn \"trans1\"\n    print (m trans1)\n    print (m trans1)\n    putStrLn \"trans2\"\n    print (m trans2)\n    print (m trans2)\n</code></pre>\n\n<p>Take a second to predict what this will output before you run it. Then go ask your GHC if she agrees with your guess.</p>\n\n<p>Clear as mud?</p>\n\n<p>The basic distinction you need to draw here is right here in this significantly simplified example:</p>\n\n<pre><code>&gt; g = trace \"a\" $ \\() -&gt; trace \"b\" ()\n&gt; g ()\na\nb\n()\n&gt; g ()\nb\n()\n</code></pre>\n\n<p>There is a separate notion of caching a <em>function</em> and caching its <em>output</em>. The latter is, simply, never done in GHC (though see discussion of what's going on with your optimized version below). The former may sound dumb, but it in fact is not so dumb as you might think; you could imagine writing a function which is, say, <code>id</code> if the collatz conjecture is true and <code>not</code> otherwise. In such a situation, it makes complete sense to only test the collatz conjecture once, and then cache whether we should behave as <code>id</code> or <code>not</code> forever afterwards.</p>\n\n<p>Once you understand this basic fact, the next leap you must believe is that in GHC, typeclass constraints are compiled to functions. (The arguments to the function are typeclass dictionaries telling how each of the typeclass' methods behave.) GHC itself manages constructing and passing these dictionaries around for you, and in most cases it's quite transparent to the user.</p>\n\n<p>But the upshot of this compilation strategy is this: a <em>polymorphic</em> but typeclass-constrained type is a function <em>even if it doesn't appear to have function arrows in it</em>. That is,</p>\n\n<pre><code>f 1.5 :: Floating a =&gt; a\n</code></pre>\n\n<p>looks like a plain old value; but in fact it is a <em>function</em> which takes a <code>Floating a</code> dictionary and produces a value of type <code>a</code>. So any computations that go into computing the value <code>a</code> are <em>redone</em> afresh each time this function is applied (read: used at a specific monomorphic type) because, after all, the precise value chosen depends critically on how the typeclass' methods behave.</p>\n\n<p>This leaves only the question of why optimizations changed things in your situation. There I believe what happened is called \"specialization\", in which the compiler will try to notice when polymorphic things get used at a statically-known monomorphic type and make a binding for that. It goes something like this:</p>\n\n<pre><code>-- starting point\nmain = do\n    let trans = \\dict -&gt; trace \"hello\" $ minus dict (fromRational dict (3%2)) (fromRational dict (2%1))\n    print (trans dictForDouble)\n    print (trans dictForDouble)\n\n-- specialization\nmain = do\n    let trans = \\dict -&gt; trace \"hello\" $ minus dict (fromRational dict (3%2)) (fromRational dict (2%1))\n    let transForDouble = trans dictForDouble\n    print transForDouble\n    print transForDouble\n\n-- inlining\nmain = do\n    let transForDouble = trace \"hello\" $ minus dictForDouble (fromRational dict (3%2)) (fromRational dictForDouble (2%1))\n    print transForDouble\n    print transForDouble\n</code></pre>\n\n<p>In this last one the function-ness is gone; it is \"as if\" GHC has cached the output of <code>trans</code> when applied to the dictionary <code>dictForDouble</code>. (If you compile with optimizations and <code>-ddump-simpl</code> you will see it goes even further, doing constant-propagation to turn the <code>minus ...</code> stuff into just <code>D# -0.5##</code>. Whew!)</p>\n"}, {"tags": [], "owner": {"reputation": 321, "user_id": 10205083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1889fbfa86aa1d996e51f465b5f6ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/10205083/steve"}, "is_accepted": false, "score": 1, "last_activity_date": 1548109657, "last_edit_date": 1548109657, "creation_date": 1548107635, "answer_id": 54298270, "question_id": 54297226, "link": "https://stackoverflow.com/questions/54297226/unexpected-caching-behavior-using-polymorphic-records-in-haskell/54298270#54298270", "title": "Unexpected caching behavior using polymorphic records in Haskell", "body": "<pre><code>{-# LANGUAGE RankNTypes #-}\n\nimport Debug.Trace\n\n--Does not get cached\ndata Translation = Trans { m :: forall a. Floating a =&gt; a }\n\nf :: Floating a =&gt; a -&gt; a\nf x = trace \"f\" $ x - 2.0\n</code></pre>\n\n<p>Since <code>a</code> is a rigid type variable bound by a type expected by the context\n<code>forall a. Floating a =&gt; a</code> you would have to cache the context as well</p>\n\n<pre><code>--Does get cached\ndata Translation' = Trans' { m' :: Float }\n\nf' :: Float -&gt; Float\nf' x = trace \"f'\" $ x - 2.0\n</code></pre>\n\n<p>Since this is a value of type <code>Float</code> it can be computed once and cached afterwards.</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let\n        trans = Trans { m = f 1.5 }\n        trans' = Trans' { m' = f' 1.5}\n\n    putStrLn $ show $ (m trans :: Double)\n    putStrLn $ show $ (m trans :: Float)\n    -- ^ you can evaluate it with 2 different contexts\n\n    putStrLn $ show $ (m' trans' :: Float)\n    putStrLn $ show $ (m' trans' :: Float)\n    -- ^ context fixed\n</code></pre>\n\n<p>Note that the former one does not get cached whether compiler optimization is turned on or off. </p>\n\n<p>When they are both <code>Float</code> and you turn on optimization the problem is gone. </p>\n\n<p>If you compile the larger system with optimization and it is to inefficient on some metric I would suspect that the problem lies somewhere else.</p>\n"}], "owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 2, "accepted_answer_id": 54298121, "answer_count": 2, "score": 8, "last_activity_date": 1548110859, "creation_date": 1548101887, "question_id": 54297226, "link": "https://stackoverflow.com/questions/54297226/unexpected-caching-behavior-using-polymorphic-records-in-haskell", "title": "Unexpected caching behavior using polymorphic records in Haskell", "body": "<p>I've run into some unexpected behavior using polymorphic records in Haskell, where some values are not cached when I expect them to be cached.</p>\n\n<p>Here is a minimal example:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\nimport Debug.Trace\n\n-- Prints out two \"hello\"s\ndata Translation = Trans { m :: forall a . Floating a =&gt; a }\n\ng :: Floating a =&gt; a -&gt; a\ng x = x + 1\n\nf :: Floating a =&gt; a -&gt; a\nf x = trace \"hello\" $ x - 2.0\n\n-- Only one \"hello\"\n-- data Translation = Trans { m :: Float }\n--\n-- f :: Float -&gt; Float\n-- f x = trace \"hello\" $ x - 2.0\n\nmain :: IO ()\nmain = do\n    let trans = Trans { m = f 1.5 }\n    putStrLn $ show $ m trans\n    putStrLn $ show $ m trans\n</code></pre>\n\n<p>In the example, I thought if the value <code>f 1.5</code> was computed and stored in the field <code>m</code>, on the next time it is accessed, it would not be computed again. However, it seems to be recomputed on every access to the record field, as shown by the fact that \"hello\" is printed twice. </p>\n\n<p>On the other hand, if we remove the polymorphism from the field, the value is cached as expected, and \"hello\" is only printed once.</p>\n\n<p>I suspect this is due to the interaction of typeclasses (being treated as records) preventing memoization. However, I don't fully understand why. </p>\n\n<p>I realized that compiling with -O2 makes the problem go away, however, this behavior occurs in a much larger system where compiling with -O2 does not seem to have any effect, therefore I'd like to understand the root cause of the problem, so I can fix the performance issues in the larger system.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 152, "user_id": 3832741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b2d9a1d01a90d056c75963e0c06fba?s=128&d=identicon&r=PG&f=1", "display_name": "Agilix", "link": "https://stackoverflow.com/users/3832741/agilix"}, "edited": false, "score": 0, "creation_date": 1548101974, "post_id": 54297065, "comment_id": 95414802, "body": "These packages are present in hackage, so it should work without adding to <code>extra-deps</code> in my understanding. Also adding these leads the same error, and the recommendation is <code>Recommended action: try adding the following to your extra-deps     in &#47;home&#47;jarek&#47;Desktop&#47;lolol&#47;stack.yaml:  SVGFonts-1.6.0.3@sha256:... containers-0.5.11.0@sha256:... diagrams-postscript-1.4.1@sha256:... lens-4.16.1@sha256:...</code>"}], "tags": [], "owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "is_accepted": false, "score": 0, "last_activity_date": 1548102617, "last_edit_date": 1548102617, "creation_date": 1548101108, "answer_id": 54297065, "question_id": 54296951, "link": "https://stackoverflow.com/questions/54296951/stack-does-not-resolve-dependencies-when-installing-hip/54297065#54297065", "title": "stack does not resolve dependencies when installing hip", "body": "<p>Why not do what <code>stack</code> recommended?</p>\n\n<pre><code>Recommended action: try adding the following to your extra-deps\nin /home/jarek/Desktop/test/stack.yaml:\n\nChart-1.9@sha256:f41568b6b3704f66c2ec163295b430ab7d798f91de426c2d5aba747d1135cd9b\nChart-diagrams-1.9@sha256:cdd0c22d730e507f9644e690833096ee127302b5ff5e1571f6def419160a\n</code></pre>\n\n<p>It's the easiest way to accomplish your goal.</p>\n\n<p><strong>Update:</strong> <code>lts-10.10</code> is the most recent resolver to include hip.  If you update your <code>stack.yaml</code> to use <code>lts-10.10</code> and add <code>hip</code> in your <code>.cabal</code> file, you should be good to go.</p>\n"}, {"comments": [{"owner": {"reputation": 152, "user_id": 3832741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b2d9a1d01a90d056c75963e0c06fba?s=128&d=identicon&r=PG&f=1", "display_name": "Agilix", "link": "https://stackoverflow.com/users/3832741/agilix"}, "edited": false, "score": 0, "creation_date": 1548102138, "post_id": 54297264, "comment_id": 95414874, "body": "This leads to another question: how can i find the newest resolver, which includes a certain package i want to install?"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1548103633, "post_id": 54297264, "comment_id": 95415466, "body": "One question at a time please. Post follow-up questions separately."}], "tags": [], "owner": {"reputation": 152, "user_id": 3832741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b2d9a1d01a90d056c75963e0c06fba?s=128&d=identicon&r=PG&f=1", "display_name": "Agilix", "link": "https://stackoverflow.com/users/3832741/agilix"}, "is_accepted": false, "score": 0, "last_activity_date": 1548102099, "creation_date": 1548102099, "answer_id": 54297264, "question_id": 54296951, "link": "https://stackoverflow.com/questions/54296951/stack-does-not-resolve-dependencies-when-installing-hip/54297264#54297264", "title": "stack does not resolve dependencies when installing hip", "body": "<p>Installing with the resolver <code>lts-7.5</code> works.</p>\n"}], "owner": {"reputation": 152, "user_id": 3832741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b2d9a1d01a90d056c75963e0c06fba?s=128&d=identicon&r=PG&f=1", "display_name": "Agilix", "link": "https://stackoverflow.com/users/3832741/agilix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 160, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1548102617, "creation_date": 1548100560, "question_id": 54296951, "link": "https://stackoverflow.com/questions/54296951/stack-does-not-resolve-dependencies-when-installing-hip", "title": "stack does not resolve dependencies when installing hip", "body": "<p>I want to install the Haskell libary hip from <a href=\"https://hackage.haskell.org/package/hip\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/hip</a> by using stack. This does not work, because stack seems to not being able to install dependencies. </p>\n\n<p>I have stack freshly installed by <code>curl -sSL https://get.haskellstack.org/ | sh</code>, and <code>stack --version</code> gives me </p>\n\n<p><code>Version 1.9.3, Git revision 40cf7b37526b86d1676da82167ea8758a854953b (6211 commits) x86_64 hpack-0.31.1</code></p>\n\n<p>I have tried several things like another resolver, reinstalling different versions of stack, ghc or cabal.</p>\n\n<p>I have tried <code>stack new test</code>, and inside the <code>test</code> folder, i wrote <code>stack install hip</code>. </p>\n\n<p>I got the following error:</p>\n\n<pre><code>Error: While constructing the build plan, the following exceptions were\nencountered:\n\nIn the dependencies for hip-1.5.3.0:\n    Chart must match &gt;=1.5, but the stack configuration has no specified\n          version  (latest matching version is 1.9)\n    Chart-diagrams must match &gt;=1.5, but the stack configuration has no\n                   specified version  (latest matching version is 1.9)\nneeded since hip is a build target.\n\nSome different approaches to resolving this:\n\n  * Consider trying 'stack solver', which uses the cabal-install solver to\n    attempt to find some working build configuration. This can be convenient\n    when dealing with many complicated constraint errors, but results may be\n    unpredictable.\n\n  * Recommended action: try adding the following to your extra-deps\n    in /home/jarek/Desktop/test/stack.yaml:\n\nChart-1.9@sha256:f41568b6b3704f66c2ec163295b430ab7d798f91de426c2d5aba747d1135cd9b\nChart-diagrams-1.9@sha256:cdd0c22d730e507f9644e690833096ee127302b5ff5e1571f6def419160a2642\n\nPlan construction failed.\n</code></pre>\n\n<p>I expect something like:</p>\n\n<pre><code>Building dependencies...\nInstalling Chart-1.9\n...\n...\n...\nhip successfully installed.\n</code></pre>\n\n<p>Please tell me if i did not provide all infos necessary for you to help me with my problem.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1548106189, "post_id": 54296253, "comment_id": 95416454, "body": "note that <code>f</code> here is (almost) exactly the same as the standard function <code>length</code>, which is defined in Prelude and therefore available to all programs with no import required. (The only difference in that the Prelude function yields an <code>Int</code> not an <code>Integer</code>, but that only matters if you&#39;re calculating the length of lists greater than around 2^32, which I really hope you&#39;re not. And even in that case you can use <code>genericLength</code> from <code>Data.List</code>.) So there&#39;s no need to define this yourself. (Unless it&#39;s a homework question to implement it, but then it&#39;s strange to have to put it in a <code>let</code>.)"}, {"owner": {"reputation": 437, "user_id": 5775622, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/64YBh.png?s=128&g=1", "display_name": "1234", "link": "https://stackoverflow.com/users/5775622/1234"}, "edited": false, "score": 0, "creation_date": 1548195550, "post_id": 54296253, "comment_id": 95454420, "body": "Thanks for notifying me there is function called &#39;length&#39; in Haskell. My question has nothing to do with the function. My question is &quot;how to define a function inside the main with pattern matching&quot; @melpomene understands my question, and gave out the right answer."}, {"owner": {"reputation": 437, "user_id": 5775622, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/64YBh.png?s=128&g=1", "display_name": "1234", "link": "https://stackoverflow.com/users/5775622/1234"}, "edited": false, "score": 0, "creation_date": 1548196187, "post_id": 54296253, "comment_id": 95454597, "body": "@melpomene  gave out good answer because he/she know what he/she are talking about. he/she also mentioned the indentation of in Haskell because Haskell indentation is tricky for beginner"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1548275577, "post_id": 54296253, "comment_id": 95487784, "body": "@1234 Do you understand the difference between an attempt and a working solution?"}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1548098862, "creation_date": 1548098862, "answer_id": 54296607, "question_id": 54296253, "link": "https://stackoverflow.com/questions/54296253/define-haskell-function-with-let-fun-x-x-1-form/54296607#54296607", "title": "Define Haskell function with let fun x = x + 1 form", "body": "<p>You can still do it the same way:</p>\n\n<pre><code>main =\n    let f  [] = 0\n        f (x:cx) = 1 + (f cx)\n    in\n    print (f \"abc\")\n</code></pre>\n\n<p>or</p>\n\n<pre><code>main =\n    let\n        f  [] = 0\n        f (x:cx) = 1 + (f cx)\n    in\n    print (f \"abc\")\n</code></pre>\n\n<p>The crucial part is that the <code>f</code>s in the two equations must line up and be indented more than <code>let</code>.</p>\n"}], "owner": {"reputation": 437, "user_id": 5775622, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/64YBh.png?s=128&g=1", "display_name": "1234", "link": "https://stackoverflow.com/users/5775622/1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "accepted_answer_id": 54296607, "answer_count": 1, "score": -2, "last_activity_date": 1548098862, "creation_date": 1548096970, "question_id": 54296253, "link": "https://stackoverflow.com/questions/54296253/define-haskell-function-with-let-fun-x-x-1-form", "title": "Define Haskell function with let fun x = x + 1 form", "body": "<p>If I have a function as following:</p>\n\n<pre><code>f::[a]-&gt;Integer\nf  [] = 0\nf (x:cx) = 1 + (f cx)\n</code></pre>\n\n<p>how can I define the function inside the main with 'let'?</p>\n\n<p>I know I can define a function inside main: e.g. </p>\n\n<pre><code>let f x = x + 1\n</code></pre>\n\n<p>but how I'm pattern-matching for <code>\"f [] = 0\"</code>?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 8741818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1a231ae28ba14d88a59e9367bc7a7ae?s=128&d=identicon&r=PG&f=1", "display_name": "DisplayName", "link": "https://stackoverflow.com/users/8741818/displayname"}, "edited": false, "score": 0, "creation_date": 1548095000, "post_id": 54295761, "comment_id": 95411921, "body": "Yes! That&#39;s right! Can you explain why I must write constructor&#39;s name?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1548095000, "post_id": 54295761, "comment_id": 95411922, "body": "Short and sweet for explaining how to fix the problem. The other half of the question is &quot;how does the error I got correspond to the code I typed?&quot;. There the answer is that <code>5 (Null) (Null)</code> is an expression that tries to apply the function <code>5</code> to the arguments <code>(Null)</code> and <code>(Null)</code> -- but <code>5</code> is not a function."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 319, "user_id": 8741818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1a231ae28ba14d88a59e9367bc7a7ae?s=128&d=identicon&r=PG&f=1", "display_name": "DisplayName", "link": "https://stackoverflow.com/users/8741818/displayname"}, "edited": false, "score": 6, "creation_date": 1548095046, "post_id": 54295761, "comment_id": 95411940, "body": "@AyratArifullin Try asking yourself that same question for the empty tree case. If you didn&#39;t type the constructor&#39;s name, namely, <code>Null</code>, what do you think you would type instead? (There are other good reasons, too, but that one should get you started thinking in the right direction.)"}, {"owner": {"reputation": 11826, "user_id": 480674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fad9d486ce723011505e86c2136937ca?s=128&d=identicon&r=PG", "display_name": "pedrofurla", "link": "https://stackoverflow.com/users/480674/pedrofurla"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548177488, "post_id": 54295761, "comment_id": 95446758, "body": "Adding to @DanielWagner, imagine you have another structure composed of two BinTree, <code>data Bleh a = Bleh a (BinTree a) (BinTree a)</code>."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 12, "last_activity_date": 1548094881, "creation_date": 1548094881, "answer_id": 54295761, "question_id": 54295744, "link": "https://stackoverflow.com/questions/54295744/what-is-the-resolution-to-this-no-instance-error/54295761#54295761", "title": "What is the resolution to this &quot;No Instance&quot; error?", "body": "<p>You forgot the value constructor's name</p>\n\n<pre><code>treehandle (Num 5 (Null) (Null))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 321, "user_id": 10205083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1889fbfa86aa1d996e51f465b5f6ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/10205083/steve"}, "is_accepted": false, "score": 7, "last_activity_date": 1548096374, "last_edit_date": 1548096374, "creation_date": 1548095645, "answer_id": 54295942, "question_id": 54295744, "link": "https://stackoverflow.com/questions/54295744/what-is-the-resolution-to-this-no-instance-error/54295942#54295942", "title": "What is the resolution to this &quot;No Instance&quot; error?", "body": "<p>I would find a different naming for the data constructors if I was you. <code>Num</code> is also the name of a type class, this can be very confusing when looking at error messages.</p>\n\n<p>Also <code>deriving Show</code> is not correctly indented, and you forgot the data constructor in <code>treehandle (5 (Null) (Null))</code>. Here is a working version.</p>\n\n<pre><code>data BinTree a = Leaf | Node a (BinTree a) (BinTree a) deriving Show\n\ntreehandle :: BinTree a -&gt; Bool\ntreehandle _ = True\n\ntest = treehandle $ Node 5 Leaf Leaf\n</code></pre>\n\n<p><code>treehandle</code> wants a value of type <code>BinTree a</code> and all you gave it was an <code>Int</code> and two empty <code>BinTree's</code>, it actually tried to apply the <code>Int</code> with the two empty <code>BinTree's</code> and failed. You have to make a <code>Node</code> to get a single <code>BinTree a</code> which you can pass to <code>treehandle</code></p>\n"}, {"comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1548177058, "post_id": 54298323, "comment_id": 95446546, "body": "The feature you&#39;re describing here is pattern matching. It does indeed resemble unification at times and is immensely useful in defining simple, readable functions."}], "tags": [], "owner": {"reputation": 319, "user_id": 8741818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1a231ae28ba14d88a59e9367bc7a7ae?s=128&d=identicon&r=PG&f=1", "display_name": "DisplayName", "link": "https://stackoverflow.com/users/8741818/displayname"}, "is_accepted": false, "score": 0, "last_activity_date": 1548107909, "creation_date": 1548107909, "answer_id": 54298323, "question_id": 54295744, "link": "https://stackoverflow.com/questions/54295744/what-is-the-resolution-to-this-no-instance-error/54298323#54298323", "title": "What is the resolution to this &quot;No Instance&quot; error?", "body": "<p>I thank for your replies. I appreciate it. Haskell is \"wild\" language being mix of Lisp and Prolog. Gradually I begin to get used to it. I would share with my results. So, that's <strong>BinTree</strong> declaration:</p>\n\n<pre><code>data BinTree a = Leaf | Val a (BinTree a) (BinTree a)\n deriving (Show)\n</code></pre>\n\n<p>It resembles on Prolog <em>unification algorithm</em> - I mean about definition of \"reverse\" as below:</p>\n\n<pre><code>reverse :: BinTree a -&gt; BinTree a\nreverse (Val a1 (a2) (a3)) = (Val a1 (reverse a3) (reverse a2))\nreverse Leaf = Leaf\n</code></pre>\n\n<p>It works! </p>\n"}], "owner": {"reputation": 319, "user_id": 8741818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1a231ae28ba14d88a59e9367bc7a7ae?s=128&d=identicon&r=PG&f=1", "display_name": "DisplayName", "link": "https://stackoverflow.com/users/8741818/displayname"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 54295761, "answer_count": 3, "score": 2, "last_activity_date": 1548115836, "creation_date": 1548094803, "last_edit_date": 1548115836, "question_id": 54295744, "link": "https://stackoverflow.com/questions/54295744/what-is-the-resolution-to-this-no-instance-error", "title": "What is the resolution to this &quot;No Instance&quot; error?", "body": "<p>I have created new type describing Binary Tree</p>\n\n<pre><code>data BinTree a = Null | Num a (BinTree a) (BinTree a)\nderiving (Show)\n</code></pre>\n\n<p>And have created the following function:</p>\n\n<pre><code>treehandle :: BinTree a -&gt; Bool\ntreehandle a = True\n</code></pre>\n\n<p>to check at least inputing values.</p>\n\n<p>When I input value Null, program outputs result successfully, but I can't input binary tree. I try thus: </p>\n\n<pre><code>treehandle (5 (Null) (Null))\n</code></pre>\n\n<p>but obtain:</p>\n\n<pre><code>&lt;interactive&gt;:66:13:\nNo instance for (Num (BinTree a1 -&gt; BinTree a2 -&gt; BinTree a0))\n  (maybe you haven't applied enough arguments to a function?)\n  arising from the literal \u20185\u2019\nIn the expression: 5\nIn the first argument of \u2018treehandle\u2019, namely \u2018(5 (Null) (Null))\u2019\nIn the expression: treehandle (5 (Null) (Null))\n</code></pre>\n\n<p>Why?</p>\n"}, {"tags": ["haskell", "ghc", "code-formatting"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1548094754, "post_id": 54294951, "comment_id": 95411832, "body": "You might like <a href=\"http://hackage.haskell.org/package/dump-core\" rel=\"nofollow noreferrer\">dump-core</a>."}], "answers": [{"comments": [{"owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "edited": false, "score": 0, "creation_date": 1548141249, "post_id": 54298837, "comment_id": 95425788, "body": "Thanks! I&#39;ve now used <code>-dsuppress-coercions -dsuppress-idinfo -dsuppress-module-prefixes -dppr-case-as-let -dppr-cols=1000</code> and the output is much more useful!"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 2, "last_activity_date": 1548111034, "creation_date": 1548111034, "answer_id": 54298837, "question_id": 54294951, "link": "https://stackoverflow.com/questions/54294951/formatting-ghc-core/54298837#54298837", "title": "Formatting GHC core?", "body": "<p>You are looking for <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/debugging.html#suppressing-unwanted-information\" rel=\"nofollow noreferrer\">these options</a>. Specifically, you need <code>-dsuppress-coercions</code>, which should shrink that huge <code>`cast` ...</code> into something like <code>`cast` &lt;Co:5&gt;</code>.</p>\n"}], "owner": {"reputation": 20870, "user_id": 40916, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24ac39488e9c4f2833d087a1343707dc?s=128&d=identicon&r=PG", "display_name": "yairchu", "link": "https://stackoverflow.com/users/40916/yairchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 54298837, "answer_count": 1, "score": 2, "last_activity_date": 1548111034, "creation_date": 1548091326, "question_id": 54294951, "link": "https://stackoverflow.com/questions/54294951/formatting-ghc-core", "title": "Formatting GHC core?", "body": "<p>When running GHC with <code>-ddump-simpl</code>, I get <code>.dump-simpl</code> files which are formatted in a way that's pretty hard to read.</p>\n\n<p>Example snippet:</p>\n\n<pre><code>            { (# ipv_aAYC, ipv1_aAYD #) -&gt;\n            (# ipv_aAYC\n                `cast` ((GHC.Prim.State#\n                            (Lamdu.Calc.Infer.R:WorldSTInfer[0]\n                                &lt;GHC.Prim.RealWorld&gt;_N ; (Control.Monad.ST.Class.D:R:Worldt[0]\n                                                            &lt;ReaderT\n                                                                (InferEnv\n                                                                    (STVar GHC.Prim.RealWorld),\n                                                                STRef\n                                                                    GHC.Prim.RealWorld\n                                                                    Lamdu.Calc.Infer.QVarGen)&gt;_N\n                                                            &lt;MaybeT\n                                                                (GHC.ST.ST\n                                                                    GHC.Prim.RealWorld)&gt;_N ; (Control.Monad.ST.Class.D:R:Worldt[0]\n                                                                                                &lt;MaybeT&gt;_N\n                                                                                                &lt;GHC.ST.ST\n                                                                                                    GHC.Prim.RealWorld&gt;_N ; Control.Monad.ST.Class.D:R:WorldST[0]\n                                                                                                                                (Nth:0\n                                                                                                                                    (Nth:2\n                                                                                                                                            (Nth:3\n                                                                                                                                                (Nth:3\n                                                                                                                                                    (&lt;(InferEnv\n                                                                                                                                                        (STVar\n                                                                                                                                                            GHC.Prim.RealWorld),\n                                                                                                                                                        STRef\n                                                                                                                                                        GHC.Prim.RealWorld\n                                                                                                                                                        Lamdu.Calc.Infer.QVarGen)&gt;_R\n                                                                                                                                                    -&gt;_R Sym (GHC.ST.N:ST[0]\n                                                                                                                                                                    &lt;GHC.Prim.RealWorld&gt;_N\n                                                                                                                                                                    &lt;Maybe\n                                                                                                                                                                        (STVar\n                                                                                                                                                                        (World\n                                                                                                                                                                            (STInfer\n                                                                                                                                                                                GHC.Prim.RealWorld))\n                                                                                                                                                                        ('Knot\n                                                                                                                                                                            T.Type))&gt;_R) ; Sym (Control.Monad.Trans.Maybe.N:MaybeT[0]\n                                                                                                                                                                                                    &lt;GHC.ST.ST\n                                                                                                                                                                                                        GHC.Prim.RealWorld&gt;_R\n                                                                                                                                                                                                    (Lamdu.Calc.Infer.D:R:UVarSTInfer[0]\n                                                                                                                                                                                                        (Sym (Control.Monad.ST.Class.D:R:WorldST[0]\n                                                                                                                                                                                                                    &lt;GHC.Prim.RealWorld&gt;_N) ; (Sym (Control.Monad.ST.Class.D:R:Worldt[0]\n                                                                                                                                                                                                                                                        &lt;MaybeT&gt;_N\n                                                                                                                                                                                                                                                        &lt;GHC.ST.ST\n                                                                                                                                                                                                                                                            GHC.Prim.RealWorld&gt;_N) ; (Sym (Control.Monad.ST.Class.D:R:Worldt[0]\n                                                                                                                                                                                                                                                                                            &lt;ReaderT\n                                                                                                                                                                                                                                                                                                (InferEnv\n                                                                                                                                                                                                                                                                                                    (STVar\n                                                                                                                                                                                                                                                                                                        GHC.Prim.RealWorld),\n                                                                                                                                                                                                                                                                                                STRef\n                                                                                                                                                                                                                                                                                                    GHC.Prim.RealWorld\n                                                                                                                                                                                                                                                                                                    Lamdu.Calc.Infer.QVarGen)&gt;_N\n                                                                                                                                                                                                                                                                                            &lt;MaybeT\n                                                                                                                                                                                                                                                                                                (GHC.ST.ST\n                                                                                                                                                                                                                                                                                                    GHC.Prim.RealWorld)&gt;_N) ; Sym (Lamdu.Calc.Infer.R:WorldSTInfer[0]\n                                                                                                                                                                                                                                                                                                                                        &lt;GHC.Prim.RealWorld&gt;_N)))) &lt;'Knot\n                                                                                                                                                                                                                                                                                                                                                                    T.Type&gt;_N))) ; (Control.Monad.Trans.Maybe.N:MaybeT[0]\n                                                                                                                                                                                                                                                                                                                                                                                        &lt;GHC.ST.ST\n                                                                                                                                                                                                                                                                                                                                                                                            GHC.Prim.RealWorld&gt;_R\n                                                                                                                                                                                                                                                                                                                                                                                        &lt;Tree\n                                                                                                                                                                                                                                                                                                                                                                                            (UVar\n                                                                                                                                                                                                                                                                                                                                                                                                (STInfer\n                                                                                                                                                                                                                                                                                                                                                                                                GHC.Prim.RealWorld))\n                                                                                                                                                                                                                                                                                                                                                                                            T.Type&gt;_N ; GHC.ST.N:ST[0]\n                                                                                                                                                                                                                                                                                                                                                                                                            &lt;GHC.Prim.RealWorld&gt;_N\n                                                                                                                                                                                                                                                                                                                                                                                                            &lt;Maybe\n                                                                                                                                                                                                                                                                                                                                                                                                                (Tree\n                                                                                                                                                                                                                                                                                                                                                                                                                (UVar\n                                                                                                                                                                                                                                                                                                                                                                                                                    (STInfer\n                                                                                                                                                                                                                                                                                                                                                                                                                        GHC.Prim.RealWorld))\n                                                                                                                                                                                                                                                                                                                                                                                                                T.Type)&gt;_R)))))))))_R\n                        :: GHC.Prim.State# (World (STInfer GHC.Prim.RealWorld))\n                            ~R# GHC.Prim.State# GHC.Prim.RealWorld),\n</code></pre>\n\n<p>Where is the code? Mostly requires scrolling a lot to the right to see, and it is mostly type annotations with one word per line. Quite difficult to follow and I wonder if things could be better.</p>\n\n<p>I tried using <code>hindent</code>, <code>brittany</code>, and <code>stylish-haskell</code> to format the file (it's basically a variant of Haskell, isn't it?) but none of those support it..</p>\n\n<p>I also saw the <a href=\"http://hackage.haskell.org/package/ghc-core\" rel=\"nofollow noreferrer\"><code>ghc-core</code></a> tool which should produce readable output but I've failed to figure out how to use it in a stack-based project (it wraps the system GHC?).</p>\n\n<p>Any advice for how to make the core more readable?</p>\n"}, {"tags": ["haskell", "rank-n-types"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1548094324, "post_id": 54294086, "comment_id": 95411660, "body": "It&#39;s not a bug, but rather explicitly called out in the documentation (see my answer for a link and a quote). Now, <i>why</i> it&#39;s designed that way is another question -- I suspect it is a mix of ease of implementation and the desire to catch typos in type variable names which, with implicit generalization on, would be very difficult to spot and lead to errors that pointed far away from the pattern signature."}], "tags": [], "owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "is_accepted": false, "score": 1, "last_activity_date": 1548088078, "creation_date": 1548088078, "answer_id": 54294086, "question_id": 54293485, "link": "https://stackoverflow.com/questions/54293485/ghc-fails-to-bind-polymorphic-function-without-monomorphising-it/54294086#54294086", "title": "GHC fails to bind polymorphic function without monomorphising it", "body": "<p>as @Lears on freenode pointed out, putting the type declaration <strong>above</strong> the declaration fixes it so it's likely some kind of bug in GHC. i.e.</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmain = do\n    let a :: forall t. Functor t =&gt; t () = undefined\n    let g :: forall u. Functor u =&gt; u () = a\n    putStrLn \"success\"\n</code></pre>\n\n<p>fails</p>\n\n<p>but</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmain = do\n    let a :: forall t. Functor t =&gt; t () = undefined\n    let g :: forall u. Functor u =&gt; u ()\n        g = a\n    putStrLn \"success\"\n</code></pre>\n\n<p>succeeds.</p>\n"}, {"comments": [{"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 1, "creation_date": 1548088508, "post_id": 54294168, "comment_id": 95408877, "body": "see my answer - it seems to be possible"}, {"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 1, "creation_date": 1548088885, "post_id": 54294168, "comment_id": 95409049, "body": "ok I tried on a newer version of GHC and I get errors similar to yours even with the code that is supposed to work"}, {"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "reply_to_user": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548092671, "post_id": 54294168, "comment_id": 95410924, "body": "I&#39;m a bit out of my depth here, so I can&#39;t help anymore without researching a bunch more.  I hope someone more educated can help."}], "tags": [], "owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "is_accepted": false, "score": -1, "last_activity_date": 1548088394, "creation_date": 1548088394, "answer_id": 54294168, "question_id": 54293485, "link": "https://stackoverflow.com/questions/54293485/ghc-fails-to-bind-polymorphic-function-without-monomorphising-it/54294168#54294168", "title": "GHC fails to bind polymorphic function without monomorphising it", "body": "<p>If I put a typed hole in, <code>GHC</code> gives me this: </p>\n\n<pre><code>foo.hs:11:45: error:\n    \u2022 Cannot instantiate unification variable \u2018t0\u2019\n      with a type involving foralls:\n        forall (b :: * -&gt; *). Monad' b =&gt; b Int\n        GHC doesn't yet support impredicative polymorphism\n    \u2022 In the expression: _\n      In a pattern binding:\n        a :: forall (b :: * -&gt; *). Monad' b =&gt; b Int = _\n      In the expression:\n        do let a :: forall b. Monad' b =&gt; b Int = _\n           a\n   |\n11 |     let a :: forall b . Monad' b =&gt; b Int = _\n   |          \n</code></pre>\n\n<p>Given the comment <code>GHC doesn't yet support impredicative polymorphism</code> maybe what you're attempting is not possible yet.</p>\n"}, {"comments": [{"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548099831, "post_id": 54295539, "comment_id": 95413912, "body": "could you comment on why in <a href=\"https://prime.haskell.org/wiki/MonomorphicPatternBindings\" rel=\"nofollow noreferrer\">prime.haskell.org/wiki/MonomorphicPatternBindings</a> SPJ states that &quot;x     = e    -- NOT a pattern binding&quot;, has it just been changed with time ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548102167, "post_id": 54295539, "comment_id": 95414890, "body": "@fghibellini There&#39;s no conflict here -- &quot;pattern binding&quot; and &quot;pattern type signature&quot; are just two different terms with two different meanings. (Indeed, they apply to two completely different syntactic classes: the former to bindings and the latter to type signatures!) The term &quot;pattern binding&quot; doesn&#39;t apply to bindings whose pattern is just a variable; but the term &quot;pattern type signature&quot; does apply to type signatures attached to a pattern that is just a variable."}, {"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548102402, "post_id": 54295539, "comment_id": 95414974, "body": "Do you have a source?  cause I would understand it as &quot;binding to something that is a pattern&quot; and &quot;type signature on something that is a pattern&quot;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 1, "creation_date": 1548102560, "post_id": 54295539, "comment_id": 95415038, "body": "@fghibellini Your link serves as a source for the definition of &quot;pattern binding&quot;. (Relevant quote: &quot;We need to be precise about what a &#39;pattern binding&#39; is. Definition: <b>a pattern binding has the form pat=rhs, where pat is not simply a variable.</b>&quot;) The link in the answer serves as a source for the definition of &quot;pattern type signature&quot;. (Relevant quote: &quot;A type signature may occur in any pattern; this is a <i>pattern type signature</i>.&quot;) In both cases, the emphasis is from the source being quoted, not inserted by me."}, {"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548103477, "post_id": 54295539, "comment_id": 95415406, "body": "&quot;...pattern type signatures are not implicitly generalised.&quot;  Doesn&#39;t that suggest that they can be explicitly generalised (with a forall)?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548103787, "post_id": 54295539, "comment_id": 95415525, "body": "@fghibellini It might imply that to me, except that the beginning of the sentence makes it much more clear that the difference being called out there is between pattern type signatures and non-pattern type signatures, not between explicit and implicit generalization."}, {"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548161853, "post_id": 54295539, "comment_id": 95437112, "body": "also note that in my answer the difference between the working and nonworking code is only in the second binding - thus the first binding actually works and the forall indeed introduces the type variable"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548162925, "post_id": 54295539, "comment_id": 95437741, "body": "@fghibellini Huh. If that&#39;s true, that <i>does</i> seem like a GHC bug to me. But at least here it&#39;s not true: the snippet you claim succeeds gives an error for me in GHC 8.2.2 and 8.4.3."}, {"owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548163052, "post_id": 54295539, "comment_id": 95437814, "body": "<a href=\"https://ghc.haskell.org/trac/ghc/ticket/16209\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/16209</a> I reported the issue yesterday and I also noticed that new versions of GHC reject it completely"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "edited": false, "score": 0, "creation_date": 1548163649, "post_id": 54295539, "comment_id": 95438161, "body": "@fghibellini Okay. I find it hard to get too upset about a bug in a 3-year-old release of GHC that has since been fixed. I would expect your ticket to get closed with a similar comment."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1548093790, "creation_date": 1548093790, "answer_id": 54295539, "question_id": 54293485, "link": "https://stackoverflow.com/questions/54293485/ghc-fails-to-bind-polymorphic-function-without-monomorphising-it/54295539#54295539", "title": "GHC fails to bind polymorphic function without monomorphising it", "body": "<p>The relevant bit of the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#pattern-type-signatures\" rel=\"nofollow noreferrer\">documentation on pattern type signatures</a> is this:</p>\n\n<blockquote>\n  <p>Unlike expression and declaration type signatures, pattern type signatures are not implicitly generalised.</p>\n</blockquote>\n\n<p>So pattern signatures, like what you wrote, are a special case where generalization (which is the process of turning a monomorphic type <code>t</code> that mentions an out-of-scope type variable <code>a</code> into the polymorphic type <code>forall a. t</code>) is not done. You can recover the process of generalization by using any other form of type signature; e.g. instead of</p>\n\n<pre><code>let foo :: forall a. a = undefined\n</code></pre>\n\n<p>try:</p>\n\n<pre><code>let foo :: forall a. a\n    foo = undefined\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 1, "last_activity_date": 1548110599, "creation_date": 1548110599, "answer_id": 54298781, "question_id": 54293485, "link": "https://stackoverflow.com/questions/54293485/ghc-fails-to-bind-polymorphic-function-without-monomorphising-it/54298781#54298781", "title": "GHC fails to bind polymorphic function without monomorphising it", "body": "<h1>Part 1</h1>\n\n<h2>The Good</h2>\n\n<p>What happens when you write</p>\n\n<pre><code>a :: forall f. Functor f =&gt; f ()\na = _\n</code></pre>\n\n<p>? Specifically, what type of expression is GHC looking for to fill the hole (<code>_</code>)? You might think it's looking for a <code>forall f. Functor f =&gt; f ()</code>, but that's not quite right. Instead, <code>a</code> is actually a bit more like a function, and GHC implicitly inserts two arguments: one type argument named <code>f</code> with kind <code>* -&gt; *</code>, and one instance of the constraint <code>Functor f</code> (which is unnamed, like all instances).</p>\n\n<pre><code>a :: forall f. Functor f =&gt; f ()\na @f {Functor f} = _\n-- @-syntax is a currently proposed extension, {}-syntax is fake\n</code></pre>\n\n<p>GHC is looking for, <em>in the context of</em> <code>type f :: * -&gt; *; instance Functor f</code>, a <code>f ()</code>. This is the same difference as between looking for a <code>(A -&gt; B) -&gt; C -&gt; D</code> and looking for a <code>D</code> <em>in the context of</em> <code>f :: A -&gt; B; c :: C</code>. If I directly have <code>solution :: (A -&gt; B) -&gt; C -&gt; D</code>, in the first case I can just write <code>solution</code>, but, in the second case, I must write out <code>solution f c</code>.</p>\n\n<h2>The Bad</h2>\n\n<p>This is not what happens when you write</p>\n\n<pre><code>a :: forall f. Functor f =&gt; f () = _\n</code></pre>\n\n<p>Because you've used a pattern type signature, not a normal one, GHC no longer implicitly binds the type variable and the instance for you. GHC now, honestly and truly, wants you to fill that <code>_</code> with a <code>forall f. Functor f =&gt; f ()</code>. This is hard, as we'll see soon...</p>\n\n<p>(I really don't think the thing Daniel Wagner has quoted is relevant here. I believe it's just referring to the difference (when <code>ScopedTypeVariables</code> is on and <code>type a</code> is not in scope) between the way that <code>5 :: Num a =&gt; a</code> implicitly means <code>5 :: forall a. Num a =&gt; a</code> and the way <code>g :: a -&gt; a = id</code> <em>doesn't</em> mean <code>g :: forall a. a -&gt; a = id</code>.)</p>\n\n<h1>Part 2</h1>\n\n<p>What happens when you write</p>\n\n<pre><code>undefined\n</code></pre>\n\n<p>? Specifically, what is its type? You might think it's <code>forall a. a</code>, but that's not quite right. Yes, it's true that, <em>all by itself</em>, <code>undefined</code> has the type <code>forall a. a</code>, but GHC doesn't let you write <code>undefined</code> all by itself. Instead, every occurrence of <code>undefined</code> in an expression is always applied to a type argument. The above is implicitly rewritten to</p>\n\n<pre><code>undefined @_a0\n</code></pre>\n\n<p>and a new unification variable (which doesn't really have a name) <code>_a0</code> is created. This expression has type <code>_a0</code>. If I use this expression in a context that requires an <code>Int</code>, then <code>_a0</code> must be equal to <code>Int</code>, and GHC sets <code>_a0 := Int</code>, rewriting the expression to</p>\n\n<pre><code>undefined @Int\n</code></pre>\n\n<p>(Because <code>_a0</code> can be <em>set</em> to something, it's called a unification variable. It's under \"our\", internal control. Above, <code>f</code> <em>couldn't</em> be set to anything. It's a given, and its under \"their\" (the user's), external control, which makes it a skolem variable.)</p>\n\n<h1>Part 3</h1>\n\n<h2>The Good</h2>\n\n<p>Usually, the automatic binding of type variables and the automatic application of unification variables works well. E.g., both of these work out fine:</p>\n\n<pre><code>undefined :: forall a. a\n</code></pre>\n\n\n\n<pre><code>bot :: forall a. a\nbot = undefined\n</code></pre>\n\n<p>Because they respectively expand as</p>\n\n<pre><code>(\\@a -&gt; undefined @a) :: forall a. a\n</code></pre>\n\n\n\n<pre><code>bot :: forall a. a\nbot @a = undefined @a\n</code></pre>\n\n<h2>The Medium</h2>\n\n<p>When you do</p>\n\n<pre><code>a :: forall f. Functor f =&gt; f () = undefined\n</code></pre>\n\n<p>, you make something very strange happen. As I said before, a pattern type signature with a <code>forall</code> doesn't introduce anything. The <code>undefined</code> on the RHS actually needs to be a <code>forall f. Functor f =&gt; f ()</code>. The implicit application of unification variables still occurs:</p>\n\n<pre><code>a :: forall f. Functor f =&gt; f () = undefined @_a0\n</code></pre>\n\n<p><code>undefined @_a0 :: _a0</code>, so <code>_a0 ~ (forall f. Functor f =&gt; f ())</code> must hold. GHC thus has to set <code>_a0 := (forall f. Functor f =&gt; f ())</code>. Usually, this is a no-no, because this is impredicative polymorphism: setting a type variable to a type containing <code>forall</code>s. However, in sufficiently outdated GHCs, this is allowed for certain functions. That is, <code>undefined</code> is not defined with the type <code>forall (a :: *). a</code>, but <code>forall (a :: OpenKind). a</code>, where <code>OpenKind</code> allows for this impredicativity. That means your code goes through as</p>\n\n<pre><code>a :: forall f. Functor f =&gt; f () = undefined @(forall f. Functor f =&gt; f ())\n</code></pre>\n\n<p>If you write</p>\n\n<pre><code>a :: forall f. Functor f =&gt; f () = bot\n</code></pre>\n\n<p>, it won't work, as <code>bot</code> doesn't have the same magic sauce that <code>undefined</code> has. Additionally, this won't work in more recent GHCs, which have stamped out this weird kind of impredicative polymorphism. (Which I say is a very good thing).</p>\n\n<h2>The Bad</h2>\n\n<p>Your definition of <code>a</code>, even with the pattern signature, does indeed come out with the desired type <code>forall f. Functor f =&gt; f ()</code>. The issue is now in <code>g</code>:</p>\n\n<pre><code>g :: forall f. Functor f =&gt; f () = a\n</code></pre>\n\n<p><code>g</code>, again, doesn't bind <code>type f :: * -&gt; *</code> or <code>instance Functor f</code>. Meanwhile, <code>a</code> gets applied to some implicit stuff:</p>\n\n<pre><code>g :: forall f. Functor f =&gt; f () = a @_f0 {_}\n</code></pre>\n\n<p>But... the RHS now has type <code>_f0 ()</code>, and the LHS wants it to have type <code>forall f. Functor f =&gt; f ()</code>. These don't look alike. Therefore, type error.</p>\n\n<p>As you can't stop the implicit application of <code>a</code> to a type variable and just write <code>g = a</code>, you must instead allow the implicit binding of type variables in <code>g</code>:</p>\n\n<pre><code>g :: forall f. Functor f =&gt; f ()\ng = a\n</code></pre>\n\n<p>This works.</p>\n"}], "owner": {"reputation": 354, "user_id": 3343425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b9956c6595bd2f3d27bed1383f46b60?s=128&d=identicon&r=PG&f=1", "display_name": "fghibellini", "link": "https://stackoverflow.com/users/3343425/fghibellini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 2, "accepted_answer_id": 54298781, "answer_count": 4, "score": 4, "last_activity_date": 1548110599, "creation_date": 1548086033, "question_id": 54293485, "link": "https://stackoverflow.com/questions/54293485/ghc-fails-to-bind-polymorphic-function-without-monomorphising-it", "title": "GHC fails to bind polymorphic function without monomorphising it", "body": "<p>In the original code one can see that I'm just extracting an expression into a binding which is one of the basic things that haskell claims should be always possible.</p>\n\n<p><strong>Minimal case (created with the help of @dminuoso on freenode)</strong></p>\n\n<p>I'd like <code>g</code> to remain polymorphic (so that I can feed it to other functions that expect it to be):</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nmain = do\n    let a :: forall t. Functor t =&gt; t () = undefined\n    let g :: forall u. Functor u =&gt; u () = a\n    pure ()\n</code></pre>\n\n<p>error:</p>\n\n<pre><code>source_file.hs:6:44:\n    Couldn't match expected type \u2018forall (u :: * -&gt; *).\n                                  Functor u =&gt;\n                                  u ()\u2019\n                with actual type \u2018t0 ()\u2019\n    When checking that: t0 ()\n      is more polymorphic than: forall (u :: * -&gt; *). Functor u =&gt; u ()\n    In the expression: a\n</code></pre>\n\n<p><strong>Original question (motivation) posted on #haskell IRC:</strong></p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\n\nclass Monad m =&gt; Monad' m where\n\ninstance Monad' IO where\n\nf1 :: (forall m . Monad' m =&gt; m Int) -&gt; IO Int\nf1 g = do\n    let a :: forall n . Monad' n =&gt; n Int = g\n    a\n\n-- this works\n--f1 :: (forall m . Monad' m =&gt; m Int) -&gt; IO Int\n--f1 g = do\n--    g\n\nmain = print $ \"Hello, world!\"\n</code></pre>\n\n<p>but I get:</p>\n\n<pre><code>source_file.hs:12:45:\n    Couldn't match expected type \u2018forall (n :: * -&gt; *).\n                                  Monad' n =&gt;\n                                  n Int\u2019\n                with actual type \u2018m0 Int\u2019\n    When checking that: m0 Int\n      is more polymorphic than: forall (n :: * -&gt; *). Monad' n =&gt; n Int\n    In the expression: g\n</code></pre>\n\n<p>Based on <a href=\"https://ghc.haskell.org/trac/ghc/ticket/12587\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/12587</a> I tried to explicitly apply the type to help the type-checker:</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeApplications #-}\n\nclass Monad m =&gt; Monad' m where\n\ninstance Monad' IO where\n\nf1 :: (forall m . Monad' m =&gt; m Int) -&gt; IO Int\nf1 g = do\n    let a :: forall n . Monad' n =&gt; n Int = g @n\n    a\n\nmain = print $ \"Hello, world!\"\n</code></pre>\n\n<p>but then I get:</p>\n\n<pre><code>main.hs:13:48: error: Not in scope: type variable \u2018n\u2019\n</code></pre>\n"}, {"tags": ["haskell", "vim"], "comments": [{"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 3, "creation_date": 1548081625, "post_id": 54292093, "comment_id": 95405013, "body": "Doesn&#39;t <code>^M</code> stand for &quot;Control-M&quot;, which means usually &quot;Enter&quot; or &quot;New line&quot; in most shells and some editors?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 6, "creation_date": 1548082677, "post_id": 54292093, "comment_id": 95405635, "body": "Perhaps your file has some inconsistent newline separators: some lines end with CRLF (windows style) while others end with LF only (mac/unix style). Vim opens the file in unix mode, but notices additional CRs around. I&#39;d remove those ^Ms."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1548094783, "post_id": 54295484, "comment_id": 95411844, "body": "Mateen Ulhaq&#39;s comment there indicates that you need to use &quot;<code>:e ++ff=dos</code> followed by <code>:set ff=unix</code> [to] convert the endings to a sane format.&quot; The OP there indicated that that was correct."}], "tags": [], "owner": {"reputation": 321, "user_id": 10205083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1889fbfa86aa1d996e51f465b5f6ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/10205083/steve"}, "is_accepted": false, "score": 3, "last_activity_date": 1548093841, "last_edit_date": 1548093841, "creation_date": 1548093514, "answer_id": 54295484, "question_id": 54292093, "link": "https://stackoverflow.com/questions/54292093/notation-of-vim-haskell-and-functions-to-implement-ski-in-haskell/54295484#54295484", "title": "Notation of vim haskell and functions to implement SKI in Haskell", "body": "<p>You have ^M linebreaks. <a href=\"https://stackoverflow.com/questions/811193/how-to-convert-the-m-linebreak-to-normal-linebreak-in-a-file-opened-in-vim\">This answer</a> says you can fix it by doing <code>:e ++ff=dos</code> in vim. But I can't ensure you that, since I use emacs.</p>\n\n<p>What do you mean when you say <em>type notation</em>? If you mean the <em>type signature</em>, it is </p>\n\n<pre><code>eliminate :: String -&gt; Exp -&gt; Exp\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1483, "user_id": 7369280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cf9dbdc445ae6834befd10a26daee65?s=128&d=identicon&r=PG&f=1", "display_name": "Ralf", "link": "https://stackoverflow.com/users/7369280/ralf"}, "is_accepted": false, "score": 1, "last_activity_date": 1548492537, "last_edit_date": 1548492537, "creation_date": 1548135484, "answer_id": 54301863, "question_id": 54292093, "link": "https://stackoverflow.com/questions/54292093/notation-of-vim-haskell-and-functions-to-implement-ski-in-haskell/54301863#54301863", "title": "Notation of vim haskell and functions to implement SKI in Haskell", "body": "<p>As already stated in some comments some of the lines contain the DOS end-ofline <code>CRLF</code>, some are Unix end-of-line <code>LF</code>. To fix it to Unix only:</p>\n\n<pre><code>:%s/\\r$//\n</code></pre>\n\n<p>I can't say anything about Haskell.</p>\n"}], "owner": {"reputation": 175, "user_id": 10832310, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BTRsOLhbuYY/AAAAAAAAAAI/AAAAAAAAAAA/sZXLwRw5JZ0/photo.jpg?sz=128", "display_name": "Jung", "link": "https://stackoverflow.com/users/10832310/jung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1548492537, "creation_date": 1548081007, "last_edit_date": 1548121123, "question_id": 54292093, "link": "https://stackoverflow.com/questions/54292093/notation-of-vim-haskell-and-functions-to-implement-ski-in-haskell", "title": "Notation of vim haskell and functions to implement SKI in Haskell", "body": "<p>Trying to implement SKI combinators in Haskell... Im not sure what <code>^M</code> represents but i think it has something to do with the notation of vim while editing a haskell file. Also what is the type notation of the function <code>eliminate</code>? Thanks</p>\n\n<pre><code>data Exp = Var String | App Exp Exp | Lam String Exp | S | K |I ^M\ntransform (Lam x y) = (eliminate x y)\n\n\neliminate x S = App K S^M\neliminate x K = App K K^M\neliminate x I = App K I^M\neliminate x (Var y)\n                | x==y      = I\n                | otherwise = (App K (Var y))\n\neliminate x (Lam y z) = eliminate x (eliminate y z)^M\n\neliminate x (App y z) = (App (App S (eliminate x y)) (eliminate x z))^M\n</code></pre>\n"}, {"tags": ["haskell", "type-level-computation"], "comments": [{"owner": {"reputation": 7666, "user_id": 1241193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0331e5e748a0ac3860b68f6cac130ef1?s=128&d=identicon&r=PG", "display_name": "Bob Dalgleish", "link": "https://stackoverflow.com/users/1241193/bob-dalgleish"}, "edited": false, "score": 0, "creation_date": 1548096521, "post_id": 54291833, "comment_id": 95412602, "body": "<code>eval</code> can never return anything but a function that evaluates to <code>Term &#39;True</code>. In your pattern match, what happens if <code>x</code> is <code>TermList v</code>? I think you get a contradiction, preventing GHC from deducing a type."}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 0, "creation_date": 1548125007, "post_id": 54291833, "comment_id": 95421285, "body": "I can see what is wrong, but not how to fix it. To use <code>eval</code> on <code>x</code> which is of type <code>Term a</code> (the boolean <code>a</code> is existential-ish) requires an instance for <code>Eval  (Term a)</code> to be in scope. But we only have <code>Eval (Term &#39;True)</code> and <code>Eval (Term &#39;False)</code> in scope."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 3737651, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c249acf38009110ae5222ae3a1700242?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre van de Laar", "link": "https://stackoverflow.com/users/3737651/pierre-van-de-laar"}, "is_accepted": false, "score": 0, "last_activity_date": 1548152785, "creation_date": 1548152785, "answer_id": 54306164, "question_id": 54291833, "link": "https://stackoverflow.com/questions/54291833/evaluation-using-type-level-programming-in-haskell-are-composing-types-lost/54306164#54306164", "title": "Evaluation using type-level programming in Haskell: Are composing types lost?", "body": "<p>The solution to my problem seems to inform the compiler far more than I initially considered necessary.</p>\n\n<pre><code>{-# LANGUAGE DataKinds           #-}\n{-# LANGUAGE FlexibleContexts    #-}\n{-# LANGUAGE GADTs               #-}\n{-# LANGUAGE KindSignatures      #-}\n{-# LANGUAGE TypeOperators       #-}\n{-# LANGUAGE TypeFamilies        #-}\n{-# LANGUAGE FlexibleInstances   #-}\nmodule Main where\n\ndata Term (b::Bool) where\n    Const :: Int -&gt; Term 'True\n    Sum  :: -- Need to add constraints, yet they could be derived by the compiler\n            (Show (TermList v), Eval (TermList v)) =&gt; TermList v -&gt; Term 'False\n\ninstance Show (Term b) where\n    show (Const a) = \"(Const \" ++ show a ++ \")\"\n    show (Sum a) = \"(Sum \" ++ show a ++ \")\"\n\ninstance Eq (Term 'True) where\n    Const a == Const b = a==b\n\ndata TermList (xs :: [ Bool ]) where\n    TNil :: TermList '[]\n    TCons :: Term x -&gt; TermList xs -&gt; TermList (x ': xs)\n\ninstance Show (TermList '[]) where\n    show TNil = \"Nil\"\n\ninstance Show (TermList xs) =&gt; Show (TermList (x ': xs)) where\n    show (TCons a b) = \"(Cons \" ++ show a ++ \" \" ++ show b ++ \")\"\n\nclass Eval e where\n    eval :: e -&gt; Term 'True\n\ninstance Eval (Term 'True) where\n    eval = id\n\ninstance Eval (Term 'False) where\n    eval (Sum x)    = eval x\n\ninstance Eval (TermList '[]) where\n    eval TNil        = Const 0\n\n-- need to add Eval (Term x), yet Eval (Term 'True) and Eval (Term 'False) are provided!\ninstance (Eval (Term x), Eval (TermList xs)) =&gt; Eval (TermList (x ': xs)) where\n    eval (TCons x xs) = case (eval x, eval xs) of\n                             (Const v, Const vs) -&gt; Const (v + vs)\n\nmain :: IO ()\nmain = let sum1  = Sum (TCons (Const 3) (TCons (Const 4) TNil))\n           sum2  = Sum (TCons (Const 5) (TCons (Const 6) TNil))\n           sum12 = Sum (TCons sum1      (TCons sum2      TNil))\n\n           sumEval12 = Sum (TCons (eval sum1)      (TCons (eval sum2)      TNil))\n        in do\n            putStrLn (show sum1)\n            putStrLn (show sum2)\n            putStrLn (show sum12)\n\n            putStrLn (show (eval sum1))\n            putStrLn (show (eval sum2))\n            putStrLn (show (eval sum12))\n\n            putStrLn (show sumEval12)\n            putStrLn (show (eval sumEval12 == eval sum12))\n</code></pre>\n\n<p>running this programming yields the expected output of</p>\n\n<pre><code>(Sum (Cons (Const 3) (Cons (Const 4) Nil)))\n(Sum (Cons (Const 5) (Cons (Const 6) Nil)))\n(Sum (Cons (Sum (Cons (Const 3) (Cons (Const 4) Nil))) (Cons (Sum (Cons (Const 5) (Cons (Const 6) Nil))) Nil)))\n(Const 7)\n(Const 11)\n(Const 18)\n(Sum (Cons (Const 7) (Cons (Const 11) Nil)))\nTrue\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 3737651, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c249acf38009110ae5222ae3a1700242?s=128&d=identicon&r=PG&f=1", "display_name": "Pierre van de Laar", "link": "https://stackoverflow.com/users/3737651/pierre-van-de-laar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1548152785, "creation_date": 1548080129, "question_id": 54291833, "link": "https://stackoverflow.com/questions/54291833/evaluation-using-type-level-programming-in-haskell-are-composing-types-lost", "title": "Evaluation using type-level programming in Haskell: Are composing types lost?", "body": "<p>I would like to mix evaluated and unevaluated terms using type-level programming. </p>\n\n<p>I made a simple example, where Sum is unevaluated and Const is evaluated.</p>\n\n<p>The following works fine:</p>\n\n<pre><code>{-# LANGUAGE DataKinds           #-}\n{-# LANGUAGE GADTs               #-}\n{-# LANGUAGE KindSignatures      #-}\n{-# LANGUAGE TypeFamilies        #-}\n{-# LANGUAGE FlexibleInstances   #-}\nmodule Main where\n\ntype family And a b where\n    And 'True 'True = 'True\n    And _     _     = 'False\n\ndata TermList (b::Bool) where\n    Nil :: TermList 'True\n    Cons :: Term a -&gt; TermList b -&gt; TermList (And a b)\n\ninstance Show (TermList b) where\n    show Nil = \"Nil\"\n    show (Cons a b) = \"(Cons \" ++ show a ++ \" \" ++ show b ++ \")\"\n\ndata Term (b::Bool) where\n    Const :: Int -&gt; Term 'True\n    Sum  :: TermList v -&gt; Term 'False\n\ninstance Show (Term b) where\n    show (Const a) = \"(Const \" ++ show a ++ \")\"\n    show (Sum a) = \"(Sum \" ++ show a ++ \")\"\n\nclass Eval e where\n    eval :: e -&gt; Term 'True\n\ninstance Eval (Term 'True) where\n    eval = id\n\ninstance Eval (Term 'False) where\n    eval (Sum x)    = eval x\n\ninstance Eval (TermList b) where\n    eval _ = Const 0\n\n{-\ninstance Eval (TermList b) where\n    eval (Nil)       = Const 0\n    eval (Cons x xs) = case (eval x, eval xs) of\n                            (Const v, Const vs) -&gt; Const (v + vs)\n-}\n\nmain :: IO ()\nmain = \n    let sum1 = Sum (Cons (Const 3) (Cons (Const 4) Nil))\n        sum2 = Sum (Cons (Const 5) (Cons (Const 6) Nil))\n        sum3 = Sum (Cons sum1 (Cons sum2 Nil))\n    in\n        do\n            putStrLn (show sum1)\n            putStrLn (show sum2)\n            putStrLn (show sum3)\n\n            putStrLn (show (eval sum1))\n            putStrLn (show (eval sum2))\n            putStrLn (show (eval sum3))\n</code></pre>\n\n<p>However, replacing the Evaluation of TermList by the one in the comments yields:</p>\n\n<pre><code>src\\Main.hs:45:30: error:\n    * Could not deduce (Eval (Term a)) arising from a use of `eval'\n      from the context: b ~ And a b1\n        bound by a pattern with constructor:\n                   Cons :: forall (a :: Bool) (b :: Bool).\n                           Term a -&gt; TermList b -&gt; TermList (And a b),\n                 in an equation for `eval'\n        at src\\Main.hs:45:11-19\n    * In the expression: eval x\n      In the expression: (eval x, eval xs)\n      In the expression:\n        case (eval x, eval xs) of { (Const v, Const vs) -&gt; Const (v + vs) }\n   |\n45 |     eval (Cons x xs) = case (eval x, eval xs) of\n   |                              ^^^^^^\n</code></pre>\n\n<p>This really surprises me: must the types of all constituent parts be remember?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 3, "creation_date": 1548072508, "post_id": 54288280, "comment_id": 95399981, "body": "You should include the error(s) you&#39;re getting in your question \u2013 they are often very helpful."}], "answers": [{"tags": [], "owner": {"reputation": 27685, "user_id": 610979, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ku5ga.png?s=128&g=1", "display_name": "Frank Schmitt", "link": "https://stackoverflow.com/users/610979/frank-schmitt"}, "is_accepted": false, "score": 4, "last_activity_date": 1548071011, "creation_date": 1548071011, "answer_id": 54289265, "question_id": 54288280, "link": "https://stackoverflow.com/questions/54288280/how-to-fix-writing-a-list-content-in-a-file/54289265#54289265", "title": "How to fix writing a list content in a file", "body": "<p>Your code contains a couple of errors / problems:</p>\n\n<ul>\n<li><code>prompt[]</code> isn't valid (in <code>main</code>) - this should be <code>prompt</code></li>\n<li><code>hPutStrLn</code> expects a <code>String</code> as its second argument, but you provide <code>IO()</code></li>\n<li><code>getCommand</code> is not defined</li>\n</ul>\n\n<p>What you need is:</p>\n\n<ul>\n<li>a list of todos (possibly returned by a function)</li>\n<li>a function that converts this list of todos to a string</li>\n<li><code>hPutStrLn</code> to print this string to the output file</li>\n</ul>\n\n<p>Here's a simple version with a hard-coded list of todos (my Haskell isn't very advanced, so this could probably be done in a much more elegant way):</p>\n\n<pre><code>import System.IO\n\ntype Todo = (Int, String)\n\ntodoToString :: Todo -&gt; String\ntodoToString (idx, name) = (show idx) ++ \" : \" ++ name\n\ntodosToString :: [Todo] -&gt; String\ntodosToString todos = foldl (\\acc t -&gt; acc ++ \"\\n\" ++ (todoToString t)) \"\" todos \n\nallTodos :: [Todo]\nallTodos = [(1, \"Buy milk\"), (2, \"Program Haskell\")]\n\nmain = do\n  outh &lt;- openFile \"agenda.txt\" WriteMode;\n  hPutStrLn outh (todosToString allTodos);\n  hClose outh;\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 9519509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XK8Jq.jpg?s=128&g=1", "display_name": "WebDeveloper", "link": "https://stackoverflow.com/users/9519509/webdeveloper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1548071011, "creation_date": 1548067637, "last_edit_date": 1548068845, "question_id": 54288280, "link": "https://stackoverflow.com/questions/54288280/how-to-fix-writing-a-list-content-in-a-file", "title": "How to fix writing a list content in a file", "body": "<p>I have a function which contains a list. I want just to write that list content in a file from main after user input.</p>\n\n<pre><code>putTodo :: (Int, String) -&gt; IO ()\nputTodo (n, todo) = putStrLn (show n ++ \": \" ++ todo)\n\nprompt :: [String] -&gt; IO ()\nprompt todos = do\n    putStrLn \"The list contains:\"\n    mapM_ putTodo (zip [0..] todos)\n    putStrLn \" \"\n    command &lt;- getLine\n    getCommand command todos\n</code></pre>\n\n<p>What I tried:</p>\n\n<pre><code>main = do\n          outh &lt;- openFile \"agenda.txt\" WriteMode;\n          hPutStrLn outh prompt[]\n\n          -- hPutStrLn outh (show prompt[])\n          -- hPrint (show prompt[])\n          hClose outh;\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["haskell", "constructor", "constraints"], "comments": [{"owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 4, "creation_date": 1548042677, "post_id": 54283256, "comment_id": 95388130, "body": "don&#39;t reinvent the byte, try Word8 from Data.Word package."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "edited": false, "score": 0, "creation_date": 1548043092, "post_id": 54283256, "comment_id": 95388197, "body": "Neat.  That does solve my problem.    <code>Prelude Data.List Data.Word&gt; 0 :: Word8 0 Prelude Data.List Data.Word&gt; 255 :: Word8 255 Prelude Data.List Data.Word&gt; 256 :: Word8  &lt;interactive&gt;:85:1: warning: [-Woverflowed-literals]     Literal 256 is out of the Word8 range 0..255 0 </code>  Ok, but for learning in general, what&#39;s the way I&#39;d do this if I had to reinvent the constraints I had?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548044693, "post_id": 54283256, "comment_id": 95388465, "body": "And see also <a href=\"https://stackoverflow.com/q/11910143/791604\">Positive integer type</a>."}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1548190447, "post_id": 54283395, "comment_id": 95452448, "body": "&quot;Smart constructors&quot; was a very helpful term to understand what I was looking for.  Thank you!  It would be awesome to get it all compile-time, but man the stuff on Phantom Types and Peano Numbers here was a bit dense for me: <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow noreferrer\">wiki.haskell.org/Smart_constructors</a>"}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": false, "score": 3, "last_activity_date": 1548043687, "creation_date": 1548043687, "answer_id": 54283395, "question_id": 54283256, "link": "https://stackoverflow.com/questions/54283256/data-constructor-with-compile-time-constraints-in-haskell/54283395#54283395", "title": "Data constructor with compile-time constraints in haskell", "body": "<p>don't reinvent the byte, try Word8 from Data.Word package.</p>\n\n<p>alternatively, using smart constructors </p>\n\n<pre><code>mkEightbit :: Int -&gt; Eightbit Int\nmkEightbit n | n &lt; 0 || n &gt; 255 = error \"invalid value\" \n             | otherwise        = Eightbit n\n</code></pre>\n\n<p>or, use mod 256 to eliminate error state.  </p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "closed_date": 1548044670, "answer_count": 1, "score": 0, "last_activity_date": 1548190648, "creation_date": 1548042342, "last_edit_date": 1548190648, "question_id": 54283256, "link": "https://stackoverflow.com/questions/54283256/data-constructor-with-compile-time-constraints-in-haskell", "closed_reason": "Duplicate", "title": "Data constructor with compile-time constraints in haskell", "body": "<p>If I'm trying to define an RGB type constructor, I have something like this:</p>\n\n<pre><code>data RGBColor = RGBColor int int int deriving Show\n</code></pre>\n\n<p>However, I'd like to bound these in valid values between 0 and 255.  At first, it seems like maybe I can typeclass my ints </p>\n\n<pre><code>data SafeRGBColor = SafeRGBColor Eightbit Eightbit Eightbit deriving Show\n</code></pre>\n\n<p>That is, I can now just define something called Eightbit that will do the validation for me.  But that just seems to kick the can down the road. When I think about how to specify that:</p>\n\n<pre><code>type Eightbit = Int -- ...?   0 to 255?\n</code></pre>\n\n<p>Unclear!  What's the correct, idiomatic way to add constraints to my custom data type?</p>\n\n<h2>Update</h2>\n\n<p>I appreciate the tips to word8, but I was really looking for the generic answer on this, RGB colors just being one example of a kind of constraint.</p>\n\n<p>I would prefer to have more information about how to catch these constraints at compile-time versus at runtime which the example this is called a duplicate of emphasizes.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 7130, "user_id": 10239789, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YeHJm.png?s=128&g=1", "display_name": "TrebledJ", "link": "https://stackoverflow.com/users/10239789/trebledj"}, "edited": false, "score": 0, "creation_date": 1548040166, "post_id": 54283012, "comment_id": 95387729, "body": "This <i>might</i> be related: <a href=\"https://stackoverflow.com/questions/5117948/feed-elements-of-a-tuple-to-a-function-as-arguments-in-haskell\">Feed elements of a tuple to a function as arguments in Haskell</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 4, "creation_date": 1548041903, "post_id": 54283012, "comment_id": 95388016, "body": "To get between functions that take multiple curried arguments and functions that take tuples, use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:curry\" rel=\"nofollow noreferrer\"><code>curry</code></a>/<a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:uncurry\" rel=\"nofollow noreferrer\"><code>uncurry</code></a>.  It only works for pairs, though, triples and beyond you are out of luck and must use an explicit lambda."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1548044105, "creation_date": 1548044105, "answer_id": 54283435, "question_id": 54283012, "link": "https://stackoverflow.com/questions/54283012/how-to-turn-a-tuple-returned-value-into-positional-arguments-in-haskell/54283435#54283435", "title": "How to turn a tuple returned value into &quot;positional&quot; arguments in Haskell?", "body": "<p>The <a href=\"https://byorgey.wordpress.com/2010/04/03/haskell-anti-pattern-incremental-ad-hoc-parameter-abstraction/\" rel=\"noreferrer\">usual trick</a> for named arguments seems like it might be of interest.</p>\n\n<pre><code>data Formatter = Formatter { start, end, sep :: String }\n\nformatList :: Show a =&gt; [a] -&gt; Formatter -&gt; String\nformatList xs fmt = start fmt ++ intercalate (sep fmt) (map show xs) ++ end fmt\n\nwith :: Formatter\nwith = Formatter \"\" \"\" \"\"\n</code></pre>\n\n<p>Now your original calls look like this:</p>\n\n<pre><code>formatList [1..10] with { start = \"(\", end = \")\", sep = \",\" }\nformatList [1..10] with { start = \"&lt;meow&gt;\", end = \"&lt;/meow&gt;\" }\n</code></pre>\n\n<p>You can make a formatter factory this way:</p>\n\n<pre><code>xmlTag :: String -&gt; Formatter\nxmlTag t = with { start = \"&lt;\" ++ t ++ \"&gt;\", end = \"&lt;/\" ++ t ++ \"&gt;\" }\n</code></pre>\n\n<p>Usage looks like this:</p>\n\n<pre><code>formatList [1..10] (xmlTag \"div\")               -- use the default separator\nformatList [1..10] (xmlTag \"div\") { sep = \",\" } -- specify a separator\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 1, "last_activity_date": 1548179416, "creation_date": 1548179416, "answer_id": 54313849, "question_id": 54283012, "link": "https://stackoverflow.com/questions/54283012/how-to-turn-a-tuple-returned-value-into-positional-arguments-in-haskell/54313849#54313849", "title": "How to turn a tuple returned value into &quot;positional&quot; arguments in Haskell?", "body": "<p>Just uncurry <code>formatList</code> so that it takes a 2-tuple as its first argument instead of two separate arguments.</p>\n\n<pre><code>&gt; :t formatList\nformatList :: Show a =&gt; String -&gt; String -&gt; String -&gt; [a] -&gt; String\n&gt; :t uncurry formatList\nuncurry formatList :: Show a =&gt; (String, String) -&gt; String -&gt; [a] -&gt; String\n&gt; (uncurry formatList) (tagMaker \"div\") \"\" [1..10]\n\"&lt;div&gt;12345678910&lt;/div&gt;\n</code></pre>\n\n<p>However, I'd just be a little more explicit about using the return value of <code>tagMaker</code>. The above only works because <code>tagMaker</code> is supplying <em>precisely</em> the first two arguments to <code>formatList</code>.</p>\n\n<pre><code>&gt; let (b,e) = tagMaker \"div\" in formatList b e \"\" [1..10]\n\"&lt;div&gt;12345678910&lt;/div&gt;\"\n</code></pre>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 54283435, "answer_count": 2, "score": 3, "last_activity_date": 1548179416, "creation_date": 1548039821, "question_id": 54283012, "link": "https://stackoverflow.com/questions/54283012/how-to-turn-a-tuple-returned-value-into-positional-arguments-in-haskell", "title": "How to turn a tuple returned value into &quot;positional&quot; arguments in Haskell?", "body": "<p>I understand there are no \"positional\" arguments in the sense that all functions take only a single variable and return a function to operate on the remaining arguments, but here's what I mean I want to do:</p>\n\n<p>Starting with some function I'm using to format lists with a prepended item, a separator, and a closing item.</p>\n\n<pre><code>Prelude&gt; formatList start end sep xs = start ++ (intercalate . separator ( map show xs )) ++ end\n</code></pre>\n\n<p>Works like this:</p>\n\n<pre><code>Prelude Data.List&gt; formatList \"(\" \")\" \",\" [1..10]\n\"(1,2,3,4,5,6,7,8,9,10)\"\n</code></pre>\n\n<p>Cool, same idea can be used for xml tags:</p>\n\n<pre><code>Prelude Data.List&gt; formatList \"&lt;meow&gt;\" \"&lt;/meow&gt;\" \"\" [1..10]\n\"&lt;meow&gt;12345678910&lt;/meow&gt;\"\n</code></pre>\n\n<p>In the spirit of reusing functions and terseness, let's also make it so we don't have to type the redundant part of the meow tag by making a function to produce the  open and close from just the word \"tag.\"</p>\n\n<pre><code>Prelude Data.List&gt; tagger tag item = \"&lt;\" ++ tag ++ \"&gt;\" ++ item ++ \"&lt;/\" ++ tag ++ \"&gt;\"\nPrelude Data.List&gt; tagger \"div\" \"contents\"\n\"&lt;div&gt;contents&lt;/div&gt;\"\n</code></pre>\n\n<p>So now make some tag-maker that will return a start and end I can make the second argument to my formatList function:</p>\n\n<pre><code>Prelude Data.List&gt; tagMaker tag = (\"&lt;\" ++ tag ++ \"&gt;\", \"&lt;/\" ++ tag ++ \"&gt;\")\n</code></pre>\n\n<p>Looks good:</p>\n\n<pre><code>Prelude Data.List&gt; tagMaker \"div\"\n(\"&lt;div&gt;\",\"&lt;/div&gt;\")\n</code></pre>\n\n<p>Now try it.  Actual behavior:</p>\n\n<pre><code>Prelude Data.List&gt; formatList (tagMaker \"div\") \"\" [1..10]\n\n&lt;interactive&gt;:49:13: error:\n    \u2022 Couldn't match expected type \u2018[Char]\u2019\n                  with actual type \u2018([Char], [Char])\u2019\n    \u2022 In the first argument of \u2018formatList\u2019, namely \u2018(tagMaker \"div\")\u2019\n      In the expression: formatList (tagMaker \"div\") \"\" [1 .. 10]\n      In an equation for \u2018it\u2019:\n          it = formatList (tagMaker \"div\") \"\" [1 .. 10]\n</code></pre>\n\n<p>Desired behavior:</p>\n\n<pre><code>formatList (tagMaker \"div\") \"\" [1..10]\n\"&lt;div&gt;12345678910&lt;/div&gt;\n</code></pre>\n\n<p>What's the right way to make the tagMaker function be able to sub in for a function that expects to take its first value, then its second value?  If this is completely non-idiomatic, what's the right idiom?</p>\n"}, {"tags": ["performance", "haskell", "caching", "optimization", "ghc"], "comments": [{"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1548033249, "post_id": 54282045, "comment_id": 95386647, "body": "Some initial thoughts: try putting a <code>trace</code> in <code>dependentList</code> to see how many times it is evaluated. If it&#39;s evaluated multiple times, you might try specializing <code>dependentList</code> to several concrete types."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1548035179, "post_id": 54282045, "comment_id": 95386962, "body": "Good plan; Added the results to the bottom of the question"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1548036210, "post_id": 54282045, "comment_id": 95387096, "body": "Looks like it works when you use a type-class; not ideal but pretty interesting :) Still going to see if I can push the evaluation even further back; like to compile time! @crockeea"}], "answers": [{"tags": [], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "is_accepted": true, "score": 4, "last_activity_date": 1548037197, "last_edit_date": 1548037197, "creation_date": 1548036112, "answer_id": 54282687, "question_id": 54282045, "link": "https://stackoverflow.com/questions/54282045/share-or-cache-an-expression-parameterized-by-only-ambiguous-types/54282687#54282687", "title": "&#39;Share&#39; or &#39;cache&#39; an expression parameterized by only ambiguous types?", "body": "<p>As suggested by @crockeea I ran an experiment; here's an attempt using a top-level constant with a polymorphic ambiguous type variable, and also an actual constant just for fun, each one contains a 'trace'</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>dependant :: forall n . KnownNat n =&gt; Natural\ndependant = trace (\"eval: \" ++ show (natVal (Proxy @n))) (natVal (Proxy @n))\n\nconstantVal :: Natural\nconstantVal = trace \"constant val: 1\" 1\n\n\nmain :: IO ()\nmain = do\n  print (dependant @1)\n  print (dependant @1)\n  print constantVal\n  print constantVal\n</code></pre>\n\n<p>The results are unfortunate:</p>\n\n<pre><code>\u03bb&gt; main\neval: 1\n1\neval: 1\n1\nconstant val: 1\n1\n1\n</code></pre>\n\n<p>So clearly it re-evaluates the polymorphic constant each time it's used. </p>\n\n<p>But if we write the constants into a typeclass (still using Ambiguous Types) it appears that it will resolve the Dictionary values only once per instance, which makes sense when you know that GHC passes the same dict for the same class instances. It does of course re-run the code for different instances:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class DependantClass n where\n  classNat :: Natural\n\ninstance (KnownNat n) =&gt; DependantClass (n :: Nat) where\n  classNat = trace (\"dependant class: \" ++ show (natVal (Proxy @n))) (natVal (Proxy @n))\n\nmain :: IO ()\nmain = do\n  print (classNat @1)\n  print (classNat @1)\n  print (classNat @2)\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>\u03bb&gt; main\ndependant class: 1\n1\n1\ndependant class: 2\n2\n</code></pre>\n\n<p>As far as getting GHC to do these at compile-time, it looks like you'd do that with <code>lift</code> from TemplateHaskell using <a href=\"https://stackoverflow.com/a/38283495/3907685\">this technique</a>.</p>\n\n<p>Unfortunately you can't use this within the typeclass definition since TH will complain that the '@n' must be imported from a different module (yay TH) and it's not known concretely at compile time. You CAN do it wherever you USE the typeclass value, but it'll evaluate it once per lift and you have to lift EVERYWHERE you use it to get the benefits; pretty impractical.</p>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 3, "accepted_answer_id": 54282687, "answer_count": 1, "score": 8, "last_activity_date": 1548051425, "creation_date": 1548028049, "last_edit_date": 1548051425, "question_id": 54282045, "link": "https://stackoverflow.com/questions/54282045/share-or-cache-an-expression-parameterized-by-only-ambiguous-types", "title": "&#39;Share&#39; or &#39;cache&#39; an expression parameterized by only ambiguous types?", "body": "<p>I have a tricky question;</p>\n\n<p>So, I know that GHC will \u2018cache\u2019 (for lack of a better term) top level definitions and only compute them once, e.g. :</p>\n\n<pre><code>myList :: [Int]\nmyList = fmap (*10) [0..10]\n</code></pre>\n\n<p>Even if I use <code>myList</code> in several spots, GHC notices the value has no params, so it can share it and won\u2019t \u2018rebuild\u2019 the list.</p>\n\n<p>I want to do that, but with a computation which depends on a type-level context; a simplified example is:</p>\n\n<pre><code>dependentList :: forall n. (KnownNat n) =&gt; [Nat]\ndependentList = [0..natVal (Proxy @n)]\n</code></pre>\n\n<p>So the interesting thing here, is that there isn\u2019t a \u2018single\u2019 cacheable value for <code>dependentList</code>; but once a type is applied it reduces down to a constant, so in theory once the type-checker runs, GHC could recognize that several spots all depend on the \u2018same\u2019 <code>dependentList</code>; e.g. (using TypeApplications)</p>\n\n<pre><code>main = do\n  print (dependentList @5)\n  print (dependentList @10)\n  print (dependentList @5)\n</code></pre>\n\n<p>My question is, will GHC recognize that it can share both of the <code>5</code> lists? Or does it compute each one separately? Technically it would even be possible to compute those values at Compile-time rather than run-time, is it possible to get GHC to do that?</p>\n\n<p>My case is a little more complicated, but should follow the same constraints as the example, however my <code>dependentList</code>-like value is intensive to compute.</p>\n\n<p>I\u2019m not at all opposed to doing this using a typeclass if it makes things possible; does GHC cache and re-use typeclass dictionaries? Maybe I could bake it into a constant in the typeclass dict to get caching?</p>\n\n<p>Ideas anyone? Or anyone have reading for me to look at for how this works?</p>\n\n<p>I'd prefer to do this in such a way that the compiler can figure it out rather than using manual memoization, but I'm open to ideas :)</p>\n\n<p>Thanks for your time!</p>\n"}, {"tags": ["haskell", "functional-programming", "f#"], "comments": [{"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1548024493, "post_id": 54281543, "comment_id": 95385188, "body": "Do you want to count side effects or applications of <code>bind</code>? Specifically, should <code>return () &gt;&gt;= \\ () -&gt; ...</code> count for 0 or 1? And what about <code>(+) &lt;$&gt; a &lt;*&gt; b</code>? Should that count as some \u201cbinds\u201d or none as it is an applicative operation only."}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 4, "creation_date": 1548026444, "post_id": 54281715, "comment_id": 95385535, "body": "Perhaps more critically, <code>w \u2261 w&gt;&gt;=return \u2261 w&gt;&gt;=return&gt;&gt;=return \u2261 ...</code>."}, {"owner": {"reputation": 8212, "user_id": 10116, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/a47f1d509ad6ef38f226017c4b285289?s=128&d=identicon&r=PG", "display_name": "Larry OBrien", "link": "https://stackoverflow.com/users/10116/larry-obrien"}, "edited": false, "score": 0, "creation_date": 1548192722, "post_id": 54281715, "comment_id": 95453403, "body": "I wrote a tracing <code>Option</code> a few years ago that recorded where the first <code>None</code> came from and it cracked open a few tough bugs."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 16, "last_activity_date": 1548024532, "creation_date": 1548024532, "answer_id": 54281715, "question_id": 54281543, "link": "https://stackoverflow.com/questions/54281543/monad-to-also-measure-side-effects/54281715#54281715", "title": "Monad to also measure side effects", "body": "<p>You can't. One of the monad laws is</p>\n\n<pre><code>return x &gt;&gt;= f = f x\n</code></pre>\n\n<p>which has one bind on the left and none on the right, so no law-abiding monad can observe how many bindings there are.</p>\n\n<p>At best you may have an action</p>\n\n<pre><code>increment :: M ()\n</code></pre>\n\n<p>in your monad which bumps a counter. (This could be implemented, as you say, using <code>StateT</code> or similar, or in a couple other essentially isomorphic ways.)</p>\n"}], "owner": {"reputation": 4965, "user_id": 339167, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/34tLX.jpg?s=128&g=1", "display_name": "Rohit Sharma", "link": "https://stackoverflow.com/users/339167/rohit-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 54281715, "answer_count": 1, "score": 3, "last_activity_date": 1548024532, "creation_date": 1548022955, "question_id": 54281543, "link": "https://stackoverflow.com/questions/54281543/monad-to-also-measure-side-effects", "title": "Monad to also measure side effects", "body": "<p>How can I count the number of times bind is applied on a Monad - Example given a state monad, I'd like to count the number of times state changed. How can i best encapsulate this? Should this logic be part of bind operator (with side effect since it increments count) or is there a better way of doing it? </p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 5, "last_activity_date": 1548016324, "creation_date": 1548016324, "answer_id": 54280708, "question_id": 54280059, "link": "https://stackoverflow.com/questions/54280059/i-have-haslell-directions-and-how-to-make-it-ints/54280708#54280708", "title": "I have Haslell Directions and how to make it Ints?", "body": "<p>I believe I understand that you have a <strong>data type</strong> named <code>Dir</code> which has <strong>constructors</strong> of <code>North</code>, <code>South</code>, <code>East</code>, and <code>West</code>:</p>\n\n<pre><code>data Dir = North | South | East | West\n</code></pre>\n\n<p>And that you want to create a function that computes a new location on a grid using a beginning location and a list of steps in terms of many <strong>values</strong> of <strong>type</strong> <code>Dir</code>, which is where we get the list <code>[Dir]</code>.</p>\n\n<p>If that is correct then consider making two separate functions.  The first function will take one step at a time.  We can simply match each pattern (North, South, East, West) and handle each case separately:</p>\n\n<pre><code>step :: (Int, Int)    -- ^ The starting point\n     -&gt; Dir           -- ^ The direction to step\n     -&gt; (Int, Int)    -- ^ Where we end up\nstep (x,y) North = (x,y+1)\nstep (x,y) South = (x,y-1)\nstep (x,y) East  = (x+1,y)\nstep (x,y) West  = (x-1,y)\n</code></pre>\n\n<p>Now that we have the basic mapping, which defines how <code>Dir</code> relates to our grid, we can repeatedly apply that to a list of directions.   I'll leave this part up to you.  You can look around for how to use a fold - particularly <code>foldl</code> - to solve the problem or you can make your own primitive recursive function.</p>\n"}], "owner": {"reputation": 45, "user_id": 8851389, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9480107dd96a80ed52f47eddfe8d77a?s=128&d=identicon&r=PG&f=1", "display_name": "DanyJ", "link": "https://stackoverflow.com/users/8851389/danyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "closed_date": 1548072147, "accepted_answer_id": 54280708, "answer_count": 1, "score": -8, "last_activity_date": 1548016324, "creation_date": 1548011925, "question_id": 54280059, "link": "https://stackoverflow.com/questions/54280059/i-have-haslell-directions-and-how-to-make-it-ints", "closed_reason": "Needs details or clarity", "title": "I have Haslell Directions and how to make it Ints?", "body": "<p>I have Directions and I step 1 like that</p>\n\n<p>THis is the directions:</p>\n\n<pre><code> North (x,y) = (x,y+1)\n East (x,y) = (x+1,y)\nSouth (x,y) = (x, y-1)\n West (x,y) = (x-1, y)\n</code></pre>\n\n<p>How to implement like that?</p>\n\n<pre><code>   f13 :: [Dir] -&gt; (Int,Int)\n    f13 [North, North]                == (0,2)\n    f13 [North, East, South, West]    == (0,0)\n    f13 (replicate 10 East)           == (10,0)\n</code></pre>\n\n<p>My code:</p>\n\n<pre><code>a = 0\nb = 0\nf13 :: [Dir] -&gt; (Int,Int)\n--f13 xs  = (a,b+1)\nf13 xs | xs == North = (a,b+1)\n       | xs == East = (a+1,b)\n       | xs == South = (a,b-1)\n       | xs == West = (a-1,b)\n       | otherwise = (a,b)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 6, "creation_date": 1548005636, "post_id": 54279055, "comment_id": 95379984, "body": "I don&#39;t understand anything in this question. Please edit it and try to explain your problem better."}], "answers": [{"tags": [], "owner": {"reputation": 1104, "user_id": 9769772, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Koralp Catalsakal", "link": "https://stackoverflow.com/users/9769772/koralp-catalsakal"}, "is_accepted": true, "score": 1, "last_activity_date": 1548007774, "creation_date": 1548007774, "answer_id": 54279412, "question_id": 54279055, "link": "https://stackoverflow.com/questions/54279055/how-to-summarize-the-index-of-odd-numbers-in-haskell/54279412#54279412", "title": "How to summarize the index of odd numbers in haskell?", "body": "<p>From what I understood of the console output, this function can help you:</p>\n\n<pre><code>sumOdds :: [Double] -&gt; Int\nsumOdds []  = 0\nsumOdds [a] = round a\nsumOdds (x:xs) = round x + sumOdds (tail xs)\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 8851389, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9480107dd96a80ed52f47eddfe8d77a?s=128&d=identicon&r=PG&f=1", "display_name": "DanyJ", "link": "https://stackoverflow.com/users/8851389/danyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "closed_date": 1548030524, "accepted_answer_id": 54279412, "answer_count": 1, "score": -4, "last_activity_date": 1548007774, "creation_date": 1548005328, "question_id": 54279055, "link": "https://stackoverflow.com/questions/54279055/how-to-summarize-the-index-of-odd-numbers-in-haskell", "closed_reason": "Needs details or clarity", "title": "How to summarize the index of odd numbers in haskell?", "body": "<p>Amount of items with odd number \nDefine the function f4, which represents the sum of elements of a unique index in a list! Indexing is exceptional!</p>\n\n<pre><code>f4 :: [Int] -&gt; Int\nf4 [] == 0\nf4 [4] == 4\nf4 [4.2] == 4\nf4 [4,2,3] == 7\nf4 [4,2,3,5] == 7\nf4 [5,4,2,3,8,3,9,5,2] == 26\n\nf4 :: [Int] -&gt; Int\nf4 [] = 0\nf4 [x] = x\nf4 (x:xs) = odd (x:xs) \n</code></pre>\n"}, {"tags": ["haskell", "nix", "nixpkgs"], "answers": [{"tags": [], "owner": {"reputation": 115, "user_id": 6549493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2535754e54dc7fae66a4bfa9ff2372e?s=128&d=identicon&r=PG&f=1", "display_name": "ocstat", "link": "https://stackoverflow.com/users/6549493/ocstat"}, "is_accepted": false, "score": 1, "last_activity_date": 1548015814, "creation_date": 1548015814, "answer_id": 54280625, "question_id": 54278327, "link": "https://stackoverflow.com/questions/54278327/how-to-write-a-shell-nix-file-which-combines-other-nix-shell-environments/54280625#54280625", "title": "How to write a shell.nix file which combines other nix-shell environments?", "body": "<p>Managed to find a solution. Maybe there is a better way, but this works:</p>\n\n<p>Suppose you have a package.yaml, then </p>\n\n<pre><code> $ cabal2nix . &gt; app.nix\n</code></pre>\n\n<pre><code># shell.nix\nlet\n  p = import &lt;nixpkgs&gt; {};\n  app = p.haskellPackages.callPackage (./app.nix) {};\n  lib = p.haskell.lib;\nin\nlib.overrideCabal app (old: { buildTools = [p.my-nvim] ++ (old.buildTools or []); })\n</code></pre>\n\n<p>(where I've added <code>my-nvim</code> to my <code>~/.config/nixpkgs/overlays/</code>)</p>\n\n<p>Now I have access to the my-nvim package <em>and</em> ghc, etc:</p>\n\n<pre><code>$ nix-shell\n\n$ nvim # works\n$ ghc # works\n</code></pre>\n\n<p>Inspiration from <a href=\"https://github.com/p-implies-q/nix-util\" rel=\"nofollow noreferrer\">https://github.com/p-implies-q/nix-util</a></p>\n"}], "owner": {"reputation": 115, "user_id": 6549493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2535754e54dc7fae66a4bfa9ff2372e?s=128&d=identicon&r=PG&f=1", "display_name": "ocstat", "link": "https://stackoverflow.com/users/6549493/ocstat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1165, "favorite_count": 3, "answer_count": 1, "score": 1, "last_activity_date": 1548015814, "creation_date": 1548000524, "question_id": 54278327, "link": "https://stackoverflow.com/questions/54278327/how-to-write-a-shell-nix-file-which-combines-other-nix-shell-environments", "title": "How to write a shell.nix file which combines other nix-shell environments?", "body": "<p>I want to write a <code>shell.nix</code> file that will provide me a development environment which includes developer tools + haskell dependencies. I would like to keep my nix expressions separate - for now that means one file containing information about my editor, and one file containing information about my haskell project.</p>\n\n<p>I have tried to set up a really basic environment, but can't get it to work. I have two files which I can create a <code>nix-shell</code> from already:</p>\n\n<pre><code># my-haskell-shell.nix - generated by cabal2nix --shell\n\n{ nixpkgs ? import &lt;nixpkgs&gt; {}, compiler ? \"default\", doBenchmark ? false }:\n\nlet\n\n  inherit (nixpkgs) pkgs;\n\n  f = { mkDerivation, base, cabal-install, hpack, stdenv }:\n      mkDerivation {\n        pname = \"hello-world\";\n        version = \"0.1.0.0\";\n        src = ./.;\n        isLibrary = false;\n        isExecutable = true;\n        libraryToolDepends = [ hpack ];\n        executableHaskellDepends = [ base ];\n        executableToolDepends = [ cabal-install hpack ];\n        preConfigure = \"hpack\";\n        license = stdenv.lib.licenses.mit;\n      };\n\n  haskellPackages = if compiler == \"default\"\n                       then pkgs.haskellPackages\n                       else pkgs.haskell.packages.${compiler};\n\n  variant = if doBenchmark then pkgs.haskell.lib.doBenchmark else pkgs.lib.id;\n\n  drv = variant (haskellPackages.callPackage f {});\n\nin\n  if pkgs.lib.inNixShell then drv.env else drv\n</code></pre>\n\n<pre><code># my-neovim-shell.nix\n\nwith import &lt;nixpkgs&gt; {};\n\nlet\n  my-neovim = neovim.override { vimAlias = false; };\n\nin\nstdenv.mkDerivation {\n  name = \"neovim-dev-env\";\n  buildInputs = [\n    my-neovim\n  ];\n}\n</code></pre>\n\n<p>Both of these produce useful shell environments! (That is, <code>nix-shell my-haskell-env.nix</code> and <code>nix-shell my-neovim-env.nix</code> give me cabal and neovim respectively, but not both). </p>\n\n<p>My attempt at producing a <code>shell.nix</code> which will provide an environment with <em>both</em> neovim and cabal available is this:</p>\n\n<pre><code># shell.nix\nwith import &lt;nixpkgs&gt; {};\nlet\n  my-neovim-shell-env = import ./my-neovim-shell.nix;\n  my-haskell-shell-env = import ./my-haskell-shell.nix {};\nin\nstdenv.mkDerivation {\n  name = \"my-new-env\";\n  buildInputs = [\n    my-neovim-shell-env\n    my-haskell-shell-env\n  ];\n}\n</code></pre>\n\n<p>This does not work however. It seems to try to build the neovim environment:</p>\n\n<pre><code> $ nix-shell\nthese derivations will be built:\n  /nix/store/k9ygid1wl75vf2nq7jzfh32mv5f8i956-neovim-dev-env.drv\nbuilding '/nix/store/k9ygid1wl75vf2nq7jzfh32mv5f8i956-neovim-dev-env.drv'...\nunpacking sources\nvariable $src or $srcs should point to the source\nbuilder for '/nix/store/k9ygid1wl75vf2nq7jzfh32mv5f8i956-neovim-dev-env.drv' failed with exit code 1\nerror: build of '/nix/store/k9ygid1wl75vf2nq7jzfh32mv5f8i956-neovim-dev-env.drv' failed\n</code></pre>\n\n<p>I don't know how to fix this; what am I doing wrong? I suspect maybe I should not be using mkDerivation?</p>\n"}, {"tags": ["haskell", "hakyll"], "answers": [{"comments": [{"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "edited": false, "score": 0, "creation_date": 1548124974, "post_id": 54300129, "comment_id": 95421280, "body": "Ah, I see I was using an older version and it is fixed in the latest. Thank you!"}], "tags": [], "owner": {"reputation": 46, "user_id": 5787171, "user_type": "registered", "profile_image": "https://graph.facebook.com/1697033550576778/picture?type=large", "display_name": "Laurent Ren&#233; de Cotret", "link": "https://stackoverflow.com/users/5787171/laurent-ren%c3%a9-de-cotret"}, "is_accepted": true, "score": 3, "last_activity_date": 1548121591, "creation_date": 1548121591, "answer_id": 54300129, "question_id": 54274208, "link": "https://stackoverflow.com/questions/54274208/how-to-reconcile-types-between-hakyll-and-hakyll-images/54300129#54300129", "title": "How to reconcile types between `hakyll` and `hakyll-images`", "body": "<p>This behavior is a bug that made its way into the hakyll-images 0.3.1 release. It was fixed subsequently in hakyll-images 0.4 and above. Simply update to the latest version to get rid of this problem.</p>\n\n<p>This was a gross oversight and tests have been added such that this will not happen again.</p>\n\n<p>If you wanted to implement the instances yourself, you can take a look at how it is done <a href=\"https://github.com/LaurentRDC/hakyll-images/blob/master/library/Hakyll/Images/Common.hs\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 54300129, "answer_count": 1, "score": 0, "last_activity_date": 1548121591, "creation_date": 1547966540, "last_edit_date": 1547966885, "question_id": 54274208, "link": "https://stackoverflow.com/questions/54274208/how-to-reconcile-types-between-hakyll-and-hakyll-images", "title": "How to reconcile types between `hakyll` and `hakyll-images`", "body": "<p>I am trying to use <a href=\"https://hackage.haskell.org/package/hakyll\" rel=\"nofollow noreferrer\"><code>hakyll</code></a> and <a href=\"https://hackage.haskell.org/package/hakyll-images\" rel=\"nofollow noreferrer\"><code>hakyll-images</code></a> to implement an example from the <code>hakyll-images</code> Readme which performs an image scaling as I will need to do. The types do not unify for the given example and I am seeking advice on how to proceed.</p>\n\n<p>The failing example from the <a href=\"https://github.com/LaurentRDC/hakyll-images#readme\" rel=\"nofollow noreferrer\"><code>hakyll-images</code> Readme</a> is below.</p>\n\n<pre><code>import Hakyll\nimport Hakyll.Images        ( loadImage\n                            , scaleImageCompiler\n                            )\nmain = hakyll $ do\n    -- Scale images to fit within a 600x400 box\n    -- Aspect ratio will be preserved\n    match \"images/*\" $ do\n        route idRoute\n        compile $ loadImage\n            &gt;&gt;= scaleImageCompiler 600 400\n</code></pre>\n\n<p>Attempting to compile gives an error:</p>\n\n<pre><code>site.hs:12:9: error:\n    \u2022 No instance for (Writable\n                         hakyll-images-0.3.1:Hakyll.Images.Common.Image)\n        arising from a use of \u2018compile\u2019\n    \u2022 In a stmt of a 'do' block:\n        compile $ loadImage &gt;&gt;= scaleImageCompiler 600 400\n      In the second argument of \u2018($)\u2019, namely\n        \u2018do route idRoute\n            compile $ loadImage &gt;&gt;= scaleImageCompiler 600 400\u2019\n      In a stmt of a 'do' block:\n        match \"images/*\"\n          $ do route idRoute\n               compile $ loadImage &gt;&gt;= scaleImageCompiler 600 400\n   |\n12 |         compile $ loadImage &gt;&gt;= scaleImageCompiler 600 400\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>The error is because type <code>Image</code>, defined by <code>loadImage</code>, is required by <code>compile</code> to be an instance of typeclass <code>Writable</code>. The types of the functions used from <code>hakyll</code> and <code>hakyll-images</code>, copied from the hackage documentation, are shown below.</p>\n\n<pre><code>    route :: Routes -&gt; Rules ()\n    idRoute :: Routes\n    compile :: (Binary a, Typeable a, Writable a) =&gt; Compiler (Item a) -&gt; Rules ()\n    loadImage :: Compiler (Item Image)\n    scaleImageCompiler :: Width -&gt; Height -&gt; Item Image -&gt; Compiler (Item Image)\n</code></pre>\n\n<p><code>Image</code> is defined in <a href=\"https://hackage.haskell.org/package/hakyll-images-0.3.1/docs/Hakyll-Images.html#t:Image\" rel=\"nofollow noreferrer\"><code>hakyll-images</code></a> as <code>type Image = Image_ ByteString</code>.\nI am not sure what <code>Image_</code> is; its definition is not linked in that documentation for the <a href=\"https://hackage.haskell.org/package/hakyll-images-0.3.1/docs/Hakyll-Images.html#t:Image\" rel=\"nofollow noreferrer\"><code>Hakyll.Images</code> module</a>.</p>\n\n<p>In any case, it appears that the example from <code>hakyll-images</code>'s Readme does not compile due to <code>Image</code> not being an instance of <code>Writable</code>. I'm wondering if perhaps the <code>hakyll-images</code> package became out-of-sync with <code>hakyll</code> at some point leading to the example no longer compiling.</p>\n\n<p>Does this assessment seem correct?\nWhat do you suggest for how might I approach a solution?</p>\n\n<p>I am considering:</p>\n\n<ul>\n<li>Updating <code>hakyll-images</code> by somehow adding a <code>Writable</code> instance for <code>Image</code>.</li>\n<li>Using some other set or combination of functions to perform the aspect-ratio-preserving image scalings.</li>\n<li>Ditching <code>hakyll-images</code> and finding some other way to scale the images.</li>\n</ul>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1547940519, "post_id": 54272249, "comment_id": 95367380, "body": "Wel you created a <i>cyclic</i> definition, so Haskell got stuck in an &quot;infinite loop&quot;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1547940583, "post_id": 54272249, "comment_id": 95367393, "body": "Note that in Haskell you do <i>not</i> assign values, you declare these, since you write <code>b = a + 3 + b</code> (in essence), you thus constructed an expression that is defined in terms of itself, and without a stop condition, so this will keep evaluating."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1547940675, "post_id": 54272249, "comment_id": 95367413, "body": "Fixing something is hard, if we do not know what the <i>expected</i> behavior should be. What exactly should happen (according to you) here?"}, {"owner": {"reputation": 175, "user_id": 10832310, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BTRsOLhbuYY/AAAAAAAAAAI/AAAAAAAAAAA/sZXLwRw5JZ0/photo.jpg?sz=128", "display_name": "Jung", "link": "https://stackoverflow.com/users/10832310/jung"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1547940946, "post_id": 54272249, "comment_id": 95367465, "body": "im just testing out the concept bound and unbound variables. Question: the <code>a</code> in first line and the first <code>a</code> in second line do not represent the same variable right?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1547941008, "post_id": 54272249, "comment_id": 95367476, "body": "indeed, since that <code>a</code> is bounded to the <code>a</code> in the <i>inner</i> <code>let a</code> part."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1547945977, "post_id": 54272249, "comment_id": 95368178, "body": "in ghci (and everywhere, always) do <code>:set -Wall</code> to be made aware of name shadowing"}], "answers": [{"tags": [], "owner": {"reputation": 321, "user_id": 10205083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1889fbfa86aa1d996e51f465b5f6ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/10205083/steve"}, "is_accepted": false, "score": 2, "last_activity_date": 1548110459, "last_edit_date": 1548110459, "creation_date": 1548098694, "answer_id": 54296575, "question_id": 54272249, "link": "https://stackoverflow.com/questions/54272249/load-a-function-but-ghci-doesnt-seem-to-have-compiled-it/54296575#54296575", "title": "Load a function but ghci doesnt seem to have compiled it", "body": "<p>Your function is pretty nonsensical, do you know that? Lets do a little math,\nshall we.</p>\n\n<pre><code>module Q54272249 where\n\nu :: Integer -- this tells you that `u` takes nothing and returns an Integer\nu = let a = 2\n        b = a + (let a = 3\n                 in a+b)\n    in b*b\n</code></pre>\n\n<p>Just substituting the inner <code>a</code> with the constant <code>3</code></p>\n\n<pre><code>u' :: Integer\nu' = let a = 2\n         b = a + (3+b)\n     in b*b\n</code></pre>\n\n<p>Doing the same for the outer <code>a</code></p>\n\n<pre><code>u'' :: Integer\nu'' = let b = 2 + (3+b) in b*b\n</code></pre>\n\n<p>Addition is associative</p>\n\n<pre><code>u''' :: Integer\nu''' = let b = 5+b in b*b\n</code></pre>\n\n<p>Replacing the let binding with an equivalent function</p>\n\n<pre><code>u'''' :: Integer\nu'''' = (5 + u'''') ^ 2\n</code></pre>\n\n<p>Do you see the problem now? It is a function that takes no arguments and returns a value of type <code>Integer</code> that is <code>5</code> added to itself squared. What is the value of itself at some point in time? You recursively evaluate it and never get an answer.</p>\n\n<p>We can fix that though. Make the function take an argument and establish a termination criterion like so.</p>\n\n<pre><code>u''''' :: Integer -&gt; Integer\nu''''' 0 = 0\nu''''' x = (5 + u''''' (x - 1)) ^ 2\n</code></pre>\n\n<p><code>x</code> gets smaller by <code>1</code> with every call and when it hits <code>0</code> it will return <code>0</code> or any other value you would like to. That is called recursion and it's always the same, establish one or more basecases and a recurrence relation.</p>\n\n<p>Note that recurrence relations are the counterpart in discrete mathematics to differential equations in analysis.</p>\n"}], "owner": {"reputation": 175, "user_id": 10832310, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BTRsOLhbuYY/AAAAAAAAAAI/AAAAAAAAAAA/sZXLwRw5JZ0/photo.jpg?sz=128", "display_name": "Jung", "link": "https://stackoverflow.com/users/10832310/jung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1548110459, "creation_date": 1547940437, "question_id": 54272249, "link": "https://stackoverflow.com/questions/54272249/load-a-function-but-ghci-doesnt-seem-to-have-compiled-it", "title": "Load a function but ghci doesnt seem to have compiled it", "body": "<p>I have ran into this problems few times before but not sure what the cause is. I just simply close the command window and reopen. For ex, I enter <code>u</code> in the compiler and nothing happens (dont know how to explain this, better if you try it yourself). Would be great if sb can explain me the problem and how to fix it!</p>\n\n<pre><code>u = let a = 2\n        b = a + (let a = 3\n                 in a+b)\n    in b*b\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 7, "creation_date": 1547931299, "post_id": 54271294, "comment_id": 95365410, "body": "Also look at <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/extending_ghc.html#source-plugins\" rel=\"nofollow noreferrer\">source plugins</a>, in the latest <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/8.6.1-notes.html#plugins\" rel=\"nofollow noreferrer\">GHC 8.6</a>"}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 3, "creation_date": 1547931444, "post_id": 54271294, "comment_id": 95365442, "body": "<a href=\"http://oleg.fi/gists/posts/2018-07-06-idiom-brackets-via-source-pluging.html\" rel=\"nofollow noreferrer\">Here Oleg Grenrus uses source plugins</a> to interpret singleton lists <code>[_]</code> surrounded by parens <code>([_])</code> as <a href=\"http://strictlypositive.org/Idiom.pdf\" rel=\"nofollow noreferrer\">idiom brackets</a>"}], "tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": true, "score": 7, "last_activity_date": 1547931152, "creation_date": 1547931152, "answer_id": 54271294, "question_id": 54271240, "link": "https://stackoverflow.com/questions/54271240/how-to-define-my-own-custom-language-extension-in-haskell/54271294#54271294", "title": "How to define my own custom LANGUAGE Extension in Haskell?", "body": "<p>Yes and no, language extensions are a feature of the <em>implementation</em> of the language (so, the compiler), this means if you are using the common implementations of Haskell, such as GHC, there is no built-in way to add custom language extensions.  </p>\n\n<p>However, there is nothing (besides time and knowledge) stopping you from building your <em>own</em> implementation of Haskell that supports whatever crazy language extension you like.  </p>\n\n<p>Depending on what you actually want, <a href=\"https://wiki.haskell.org/Template_Haskell\" rel=\"noreferrer\"><em>Template Haskell</em></a> might be a solution you can use instead.</p>\n"}], "owner": {"reputation": 474, "user_id": 2645138, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000993761098/picture?type=large", "display_name": "Vigneshwaran Rajan", "link": "https://stackoverflow.com/users/2645138/vigneshwaran-rajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 1, "closed_date": 1547966359, "accepted_answer_id": 54271294, "answer_count": 1, "score": 3, "last_activity_date": 1548228596, "creation_date": 1547930671, "last_edit_date": 1548228596, "question_id": 54271240, "link": "https://stackoverflow.com/questions/54271240/how-to-define-my-own-custom-language-extension-in-haskell", "closed_reason": "Not suitable for this site", "title": "How to define my own custom LANGUAGE Extension in Haskell?", "body": "<pre><code>{-# LANGUAGE CustomHaskellExtension #-}\n</code></pre>\n\n<p>Is there a way to define my own custom Haskell language extension?</p>\n\n<p>If YES, please can you point me to the documentation or tutorial.</p>\n"}, {"tags": ["haskell", "ghc", "gtk2hs"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1547938829, "post_id": 54271235, "comment_id": 95367012, "body": "I&#39;m far from an expert on Mac, but it looks like you may have installed glib twice in two different places, and GHC isn&#39;t sure which one to use. I&#39;m not too sure how to solve it, but <code>brew uninstall glib</code> <i>may</i> work."}], "answers": [{"tags": [], "owner": {"reputation": 443, "user_id": 2744010, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/df615d2508e3ca5d838717bca04c3923?s=128&d=identicon&r=PG&f=1", "display_name": "user2744010", "link": "https://stackoverflow.com/users/2744010/user2744010"}, "is_accepted": false, "score": 0, "last_activity_date": 1548884292, "creation_date": 1548884292, "answer_id": 54449940, "question_id": 54271235, "link": "https://stackoverflow.com/questions/54271235/gtk2hs-invalid-signals/54449940#54449940", "title": "Gtk2hs invalid signals", "body": "<p>Self answer: I fixed this by removing the Haskell Platform and reinstalling GHC with brew. Then all worked fine.</p>\n"}], "owner": {"reputation": 443, "user_id": 2744010, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/df615d2508e3ca5d838717bca04c3923?s=128&d=identicon&r=PG&f=1", "display_name": "user2744010", "link": "https://stackoverflow.com/users/2744010/user2744010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1548884292, "creation_date": 1547930638, "question_id": 54271235, "link": "https://stackoverflow.com/questions/54271235/gtk2hs-invalid-signals", "title": "Gtk2hs invalid signals", "body": "<p>I'm running a very simple \"hello world\" GUI program. (Saved as gui.hs) My code is:</p>\n\n<pre><code>import Graphics.UI.Gtk\n\nmain = do\n  initGUI\n  window &lt;- windowNew\n  widgetShowAll window\n  onDestroy window mainQuit\n  mainGUI  \n</code></pre>\n\n<p>I compile with: <code>ghc -L/usr/lib gui</code></p>\n\n<p>It compiles fine, but when I run it I see:</p>\n\n<pre><code>objc[51245]: Class GNotificationCenterDelegate is implemented in both /usr/local/opt/glib/lib/libgio-2.0.0.dylib and /opt/local/lib/libgio-2.0.0.dylib. One of the two will be used. Which one is undefined.\n\n(process:51245): GLib-GObject-WARNING **: gsignal.c:2423: signal 'destroy' is invalid for instance '0x7fe9dc81a0e0' of type '(null)'\n</code></pre>\n\n<p>The window appears, but it won't quit when I click to close the window. (Window disappears, but the process doesn't terminate.)</p>\n\n<p>This is a very simple example- I've tried making buttons that trigger signals, but I (almost) always get this \"signal is invalid\" warning.</p>\n\n<p>I'm using Mac OS X El Capitan with GHC 8.4.3 (Haskell platform), and I installed everything following instructions here: (section 2)\n[<a href=\"https://wiki.haskell.org/Gtk2Hs/Mac]\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Gtk2Hs/Mac]</a></p>\n\n<p>I am starting to feel like my installation is messed up somehow? Maybe do I need to have installed GHC also with brew? Is there any way I can test the installation (other than trying what I'm already doing)? Are the two runtime warnings related to each other? Thanks for any help!</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1547922840, "post_id": 54270155, "comment_id": 95363243, "body": "You need to add parenthesis, right now it looks like you define <code>evaluate Constant x</code> with two variables."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 8, "creation_date": 1547922973, "post_id": 54270155, "comment_id": 95363282, "body": "Furthermore an <code>Expression</code> like <code>Constant | Variable | Add | Multiply</code> does not seem to make much sense in the first place, I would expect <code>Constant Int | Variable VariableName | Add Expression Expression | Multiply Expression Expression</code> for example, since then these are <i>parameters</i> of the expression."}, {"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 3, "creation_date": 1547928833, "post_id": 54270155, "comment_id": 95364795, "body": "My guess is that you are inputting this code line by line through ghci, since the code <code>evaluate :: Expression -&gt; Int; evaluate Constant x = x</code> should not even compile, along with the comments by Willem."}, {"owner": {"reputation": 15, "user_id": 8935965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/572e85066d3c1558b7e10f65872553e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neon Xd", "link": "https://stackoverflow.com/users/8935965/neon-xd"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1547994319, "post_id": 54270155, "comment_id": 95376696, "body": "@WillemVanOnsem I tried adding every possible combination of parantheses, and it still gives me the same error. :/"}], "answers": [{"tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": true, "score": 1, "last_activity_date": 1548094698, "last_edit_date": 1592644375, "creation_date": 1548094698, "answer_id": 54295723, "question_id": 54270155, "link": "https://stackoverflow.com/questions/54270155/data-constructor-not-in-scope/54295723#54295723", "title": "Data constructor not in scope", "body": "<p>Let's take a look at the errors:</p>\n<blockquote>\n<pre><code>Variable not in scope: evaluate :: t0 -&gt; Integer -&gt; t\n\nData constructor not in scope: Constant\n</code></pre>\n</blockquote>\n<p>These mean that you haven't defined the <code>evaluate</code> function and the <code>Constant</code> constructor (even though you clearly have). But you say when you use <code>getValue</code> and <code>X</code>, those work?</p>\n<p>This doesn't appear to be the (extremely common) multiline <code>ghci</code> confusion, as suggested in a comment. First, the error you get from that tends to be a <code>non-exhaustive patterns</code>, which is not what you're getting. Second, your <code>ghci</code> prompt reads <code>*Main&gt;</code> instead of <code>Prelude&gt;</code>, which implies that you've <code>:load</code>ed a file. Said file simply hasn't defined the code you expect it to have.</p>\n<p>My guess is that is you wrote the first part of the code in the file, then <code>:load</code>ed it properly, then modified the file and forgot to <code>:reload</code>, so the changes you made were never loaded.</p>\n<p>Another possibility is that you put a <code>module Main (VariableName (..), getValue) where</code> at the beginning of your file, and forgot to add your new exports to it. But that seems less likely.</p>\n<p>If none of the above works, just try closing <code>ghci</code>, opening it again, and <code>:load</code>ing the file anew.</p>\n<hr>\n<p>Even once you fix that issue, there are a number of other errors you'll run into, mostly to do with parentheses. In Haskell, When you write something like this:</p>\n<pre><code>evaluate Constant 20\n</code></pre>\n<p>It means &quot;call the <code>evaluate</code> function, and pass it two arguments: <code>Constant</code> and <code>20</code>&quot;. This implies <code>evaluate :: Expression -&gt; Int -&gt; Int</code>, but you really want <code>evaluate :: Expression -&gt; Int</code>. So you need parentheses:</p>\n<pre><code>evaluate (Constant 20)\n</code></pre>\n<p>This means &quot;call the <code>Constant</code> constructor with one argument <code>20</code>, and pass that value as the single argument to <code>evaluate</code>&quot;.</p>\n<hr>\n<p>Not only must you make this change at the call site, you also need it in the definition. Currently, you have:</p>\n<pre><code>evaluate :: Expression -&gt; Int\nevaluate Constant x = x\nevaluate Variable x = getValue x\nevaluate Add x y = x+y\nevaluate Multiply x y = x * y\n</code></pre>\n<p>Each of these patterns expects a different number of arguments: the first two expect two arguments, and the last two expect three arguments. The problem is that <code>x</code> and <code>y</code> are being seen as arguments to the function, not the constructors. To change this, you need parentheses:</p>\n<pre><code>evaluate :: Expression -&gt; Int\nevaluate (Constant x) = x\nevaluate (Variable x) = getValue x\nevaluate (Add x y) = x+y\nevaluate (Multiply x y) = x * y\n</code></pre>\n<hr>\n<p>The final change you need to make is in the constructor definition: you need to tell the constructors that they take arguments in the first place. Currently your data definition looks like this (I've added formatting):</p>\n<pre><code>data Expression = Constant\n                | Variable\n                | Add\n                | Multiply\n                deriving Show\n</code></pre>\n<p>None of these constructors currently take arguments: they're values (like <code>True</code>, <code>X</code>, <code>Nothing</code>, etc), rather than value constructors. This is not what you want. You need to give the types of the arguments for each constructor, like so:</p>\n<pre><code>data Expression = Constant Int\n                | Variable VariableName\n                | Add      Int Int\n                | Multiply Int Int\n                deriving Show\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 8935965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/572e85066d3c1558b7e10f65872553e1?s=128&d=identicon&r=PG&f=1", "display_name": "Neon Xd", "link": "https://stackoverflow.com/users/8935965/neon-xd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1704, "favorite_count": 0, "accepted_answer_id": 54295723, "answer_count": 1, "score": 0, "last_activity_date": 1548094698, "creation_date": 1547922765, "question_id": 54270155, "link": "https://stackoverflow.com/questions/54270155/data-constructor-not-in-scope", "title": "Data constructor not in scope", "body": "<p>I'm learning Haskell and writing a simple program. Now I'm getting a problem, which for me, is quite confusing. Here is the code:</p>\n\n<pre><code>data VariableName = X|Y deriving Show  \ngetValue :: VariableName -&gt; Int\ngetValue X = 5\ngetValue Y = 13\n\ndata Expression = Constant|Variable|Add|Multiply deriving Show\nevaluate :: Expression -&gt; Int\nevaluate Constant x = x\nevaluate Variable x = getValue x\nevaluate Add x y = x+y\nevaluate Multiply x y = x * y\n</code></pre>\n\n<p>I expect the output:</p>\n\n<pre><code>Constant  20  = 20\n</code></pre>\n\n<p>but I'm getting</p>\n\n<pre><code>*Main&gt; evaluate Constant 20\n\n&lt;interactive&gt;:79:1: error:\n    Variable not in scope: evaluate :: t0 -&gt; Integer -&gt; t\n\n&lt;interactive&gt;:79:10: error: Data constructor not in scope: Constant\n</code></pre>\n\n<p>But when e.g.:  I write </p>\n\n<pre><code>*Main&gt; getValue X\n5\n</code></pre>\n\n<p>Which is the right answer. I just started Haskell, which is way this is quite confusing for me. Some help would be much appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1547905521, "post_id": 54267716, "comment_id": 95358491, "body": "Where exactly did you find this answer? Do you understand what it is doing? Creating an (infinte) list of <code>False</code>s, is just <code>repeat False</code>. Furthermore since Haskell is a declarative language, you can just &quot;update&quot; a value, in fact all variables are, once assigned, constant."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1547907031, "post_id": 54267716, "comment_id": 95358811, "body": "@Willem this code (the second fragment anyway, have no idea how the first one works) does more or less what the Python code does, modulo non-destructive nature of Haskell. Namely it goes over a list of <i>indices</i> and then replaces corresponding elements in another list with <code>False</code>. Why do you think <code>repeat False</code> is relevant here?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1547907177, "post_id": 54267716, "comment_id": 95358840, "body": "@n.m.: ah, I somehow had the idea that we ranged over <i>all</i> indices. Thanks."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1547908012, "post_id": 54267716, "comment_id": 95359010, "body": "Try <a href=\"https://ideone.com/ZgwbLb\" rel=\"nofollow noreferrer\">this</a> though I doubt it will bring any significant speed up (can&#39;t check it myself with my phone)."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1547925963, "post_id": 54267716, "comment_id": 95364075, "body": "If you want a mutable array in Haskell why would you use an immutable linked list?  use the <code>array</code> or <code>vector</code> package and the structures provided therein."}, {"owner": {"reputation": 405, "user_id": 8164113, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/Ccd5p.jpg?s=128&g=1", "display_name": "William Song", "link": "https://stackoverflow.com/users/8164113/william-song"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1547994529, "post_id": 54267716, "comment_id": 95376768, "body": "@n.m. thank you for your help and thank Willem too."}], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 8164113, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/Ccd5p.jpg?s=128&g=1", "display_name": "William Song", "link": "https://stackoverflow.com/users/8164113/william-song"}, "edited": false, "score": 0, "creation_date": 1553153133, "post_id": 54279769, "comment_id": 97281219, "body": "but, is that fast?"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "reply_to_user": {"reputation": 405, "user_id": 8164113, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/Ccd5p.jpg?s=128&g=1", "display_name": "William Song", "link": "https://stackoverflow.com/users/8164113/william-song"}, "edited": false, "score": 0, "creation_date": 1553330500, "post_id": 54279769, "comment_id": 97351195, "body": "It\u2019s linear. Specifically if <code>is</code> has maximum element m and <code>xs</code> has length n, the complexity is O(min(m,n)). If you want something fast then updating immutable lists is entirely wrong."}], "tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 0, "last_activity_date": 1548009932, "creation_date": 1548009932, "answer_id": 54279769, "question_id": 54267716, "link": "https://stackoverflow.com/questions/54267716/assignment-update-of-a-list-in-haskell-speed-is-considered/54279769#54279769", "title": "assignment/update of a list in Haskell (speed is considered)", "body": "<p>If you can guarantee that <code>s</code> is strictly increasing (and still want to use an immutable list) then you can do the following:</p>\n\n<pre><code>setFalse is xs = go is xs 0 where\n  go [] xs _ = xs\n  go _ [] _= error \u201cindex out of bounds\u201d\n  go is@(i:is') (x:xs) n | i &lt;= n = False : go is' xs (1+n)\n                         | otherwise = x : go is xs\n</code></pre>\n"}], "owner": {"reputation": 405, "user_id": 8164113, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/Ccd5p.jpg?s=128&g=1", "display_name": "William Song", "link": "https://stackoverflow.com/users/8164113/william-song"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1548009932, "creation_date": 1547905441, "last_edit_date": 1547995050, "question_id": 54267716, "link": "https://stackoverflow.com/questions/54267716/assignment-update-of-a-list-in-haskell-speed-is-considered", "title": "assignment/update of a list in Haskell (speed is considered)", "body": "<p>I want to implement the following Python code in Haskell. Similar article has been found in stack overflow, but I found they are too slow.</p>\n\n<p>python:</p>\n\n<pre><code>for k in s:\n    a[k] = False\n</code></pre>\n\n<p>haskell:</p>\n\n<pre><code>setfalse s a = over (elements (`elem` s)) (const False) a\n</code></pre>\n\n<p>or more natively</p>\n\n<pre><code>setfalse [] a = a\nsetfalse _ [] = []\nsetfalse (0:is) (a:as) = False : (setfalse ((\\x-&gt;(x-1)) &lt;$&gt; is) as)\nsetfalse s (a:as) = a : (setfalse ((\\x-&gt;(x-1)) &lt;$&gt; s) as)\n</code></pre>\n\n<p>Do you have a faster implementation?</p>\n\n<p>I constructed the problem when I tried to implement <code>sieve of Eratosthenes</code></p>\n"}, {"tags": ["haskell", "bounded-types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1547896898, "post_id": 54266529, "comment_id": 95356478, "body": "The <code>a</code> in the body is another <code>a</code> as the one in the signature."}, {"owner": {"reputation": 473, "user_id": 2642172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/bLVR0.jpg?s=128&g=1", "display_name": "MMacphail", "link": "https://stackoverflow.com/users/2642172/mmacphail"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1547896983, "post_id": 54266529, "comment_id": 95356494, "body": "How to point <code>maxBound</code> to the <code>a</code> in the signature?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1547897033, "post_id": 54266529, "comment_id": 95356506, "body": "you already did in the <code>a -&gt; a</code> signature."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1547898503, "post_id": 54266529, "comment_id": 95356864, "body": "all you need as <code>maxBound `asTypeOf` (undefined::Int)</code>. no need to define your own."}], "answers": [{"comments": [{"owner": {"reputation": 473, "user_id": 2642172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/bLVR0.jpg?s=128&g=1", "display_name": "MMacphail", "link": "https://stackoverflow.com/users/2642172/mmacphail"}, "edited": false, "score": 0, "creation_date": 1547897243, "post_id": 54266564, "comment_id": 95356566, "body": "Thanks for your answer. Interesting! If I had a more complex functions that returned different type, let&#39;s say type <code>b</code>, would it still be possible in Haskell to mean the <code>maxBound</code> of <code>a</code> ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 473, "user_id": 2642172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/bLVR0.jpg?s=128&g=1", "display_name": "MMacphail", "link": "https://stackoverflow.com/users/2642172/mmacphail"}, "edited": false, "score": 0, "creation_date": 1547897318, "post_id": 54266564, "comment_id": 95356586, "body": "@MMacphail: if you define it as <code>a -&gt; b</code>, then this would not work, since then you basically say &quot;the return value is a free choice&quot; whereas the function body suggests it is not."}, {"owner": {"reputation": 473, "user_id": 2642172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/bLVR0.jpg?s=128&g=1", "display_name": "MMacphail", "link": "https://stackoverflow.com/users/2642172/mmacphail"}, "edited": false, "score": 0, "creation_date": 1547897468, "post_id": 54266564, "comment_id": 95356618, "body": "And what of functions where the context is important ?       rotN :: (Bounded a, Enum a) =&gt; a -&gt; a     rotN c = toEnum rotation       where alphabetSize = fromEnum (maxBound) + 1             halfAlphabet = alphabetSize <code>div</code> 2             offset = fromEnum c + halfAlphabet             rotation = offset <code>mod</code> alphabetSize  In this example, if I don&#39;t specify the type of maxBound, the compiler can&#39;t decide, but if I specify <code>a</code> the compiler tells me type <code>a1</code> is unknown... When I really want the <code>a</code> in signature."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1547897566, "last_edit_date": 1547897566, "creation_date": 1547897012, "answer_id": 54266564, "question_id": 54266529, "link": "https://stackoverflow.com/questions/54266529/how-to-get-the-maxbound-of-a-type-that-has-a-bounded-instance/54266564#54266564", "title": "How to get the maxBound of a type that has a Bounded instance", "body": "<h1>Type signature is sufficient</h1>\n\n<p>Since the signature already restricts the type, you can drop the <code>:: a</code> part in the function body:</p>\n\n<pre><code>getMaxBound :: Bounded a =&gt; <b>a</b> -&gt; <b>a</b>\ngetMaxBound _ = maxBound</code></pre>\n\n<p>The type signature specifies that type of the input of the function is the same as the type of the output of the function.</p>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; getMaxBound (3 :: Int)\n9223372036854775807\nPrelude&gt; getMaxBound 'c'\n'\\1114111'\nPrelude&gt; getMaxBound True\nTrue\nPrelude&gt; getMaxBound LT\nGT\n</code></pre>\n\n<h1>Using the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#ghc-flag--XScopedTypeVariables\" rel=\"nofollow noreferrer\"><code>ScopedTypeVariables</code></a> extension</h1>\n\n<p>We can also use the <a href=\"https://wiki.haskell.org/Scoped_type_variables\" rel=\"nofollow noreferrer\"><strong><code>ScopedTypeVariables</code></strong> extension [Haskell-wiki]</a>, and then implement it with a reference to the <code>a</code> type variable:</p>\n\n<pre><code>{-# LANGUAGE <b>ScopedTypeVariables</b> #-}\n\ngetMaxBound :: <b>forall a .</b> Bounded a =&gt; a -&gt; a\ngetMaxBound _ = maxBound <b>:: a</b></code></pre>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1547897596, "post_id": 54266637, "comment_id": 95356658, "body": "Lol, we updated at (almost) exactly the same time :)"}, {"owner": {"reputation": 473, "user_id": 2642172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/bLVR0.jpg?s=128&g=1", "display_name": "MMacphail", "link": "https://stackoverflow.com/users/2642172/mmacphail"}, "edited": false, "score": 1, "creation_date": 1547897680, "post_id": 54266637, "comment_id": 95356679, "body": "Thanks, both of your answers were great :) I didn&#39;t know about the shadowing."}], "tags": [], "owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "is_accepted": false, "score": 4, "last_activity_date": 1547897617, "last_edit_date": 1547897617, "creation_date": 1547897564, "answer_id": 54266637, "question_id": 54266529, "link": "https://stackoverflow.com/questions/54266529/how-to-get-the-maxbound-of-a-type-that-has-a-bounded-instance/54266637#54266637", "title": "How to get the maxBound of a type that has a Bounded instance", "body": "<p>Willem's answer should work just fine in this case, but an alternative that might also be useful in more complicated cases is to use <code>-XScopedTypeVariables</code></p>\n\n<p>if you add the line <code>{-# LANGUAGE ScopedTypeVariables #-}</code> to the top of the file, your code should compile.</p>\n\n<p>what the extension does is to allow you to reference the type variables from an outer scope in an inner scope. in your code, <code>a</code> gets shadowed in the function body, and there is no connection between it and the outer <code>a</code>, causing you to lose the <code>Bounded a</code> context!</p>\n"}], "owner": {"reputation": 473, "user_id": 2642172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/bLVR0.jpg?s=128&g=1", "display_name": "MMacphail", "link": "https://stackoverflow.com/users/2642172/mmacphail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 54266564, "answer_count": 2, "score": 2, "last_activity_date": 1547897617, "creation_date": 1547896736, "question_id": 54266529, "link": "https://stackoverflow.com/questions/54266529/how-to-get-the-maxbound-of-a-type-that-has-a-bounded-instance", "title": "How to get the maxBound of a type that has a Bounded instance", "body": "<p>The following Haskell code does not compile:</p>\n\n<pre><code>getMaxBound :: (Bounded a) =&gt; a -&gt; a\ngetMaxBound _ = maxBound :: a\n</code></pre>\n\n<p>The error I get is the following:</p>\n\n<pre><code>Could not deduce (Bounded a1) arising from a use of \u2018maxBound\u2019\n  from the context: Bounded a\n    bound by the type signature for:\n               getMaxBound :: Bounded a =&gt; a -&gt; a\n    at rot13.hs:3:1-36\n</code></pre>\n\n<p>Why can't I get the maxBound of a bounded type in Haskell?</p>\n\n<p>Ideally, I would use this function like this:</p>\n\n<pre><code>getMaxBound 3\n&gt; 9223372036854775807\n\ngetMaxBound 'c'\n&gt; '\\1114111'\n</code></pre>\n\n<p>I feel like every time I have any type <code>a</code> which has a Bounded instance, I should be able to get the maxBound of that type.</p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1547877057, "post_id": 54263748, "comment_id": 95352800, "body": "If you want this to be reality then go complain to Getty that he should finish the extension: <a href=\"https://twitter.com/aisamanra/status/519721321681268736\" rel=\"nofollow noreferrer\">twitter.com/aisamanra/status/519721321681268736</a>"}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 1, "creation_date": 1547877375, "post_id": 54263748, "comment_id": 95352851, "body": "Yeah. Records (and their syntax) are second-class citizens in Haskell. The <code>RecordWithFunc{ func = (+) }</code> form is sugar for using the data constructor with positional notation <code>RecordWithFunc (+)</code>. And in that there&#39;s no place to bind parameters to functions. Use a `\\` expression, per @bradrn&#39;s answer."}], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 8, "last_activity_date": 1547868209, "creation_date": 1547868209, "answer_id": 54263815, "question_id": 54263748, "link": "https://stackoverflow.com/questions/54263748/syntax-extension-for-compact-function-definitions-within-a-record/54263815#54263815", "title": "syntax extension for compact function definitions within a record", "body": "<p>No, there is no such extension. (It would be nice though!) The usual method of doing this would be to say:</p>\n\n<pre><code>a :: RecordWithFunc\na = RecordWithFunc {\n    func = \\x y -&gt; x + y\n}\n</code></pre>\n\n<p>Or even, in this case:</p>\n\n<pre><code>a :: RecordWithFunc\na = RecordWithFunc {\n    func = (+)\n}\n</code></pre>\n"}], "owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 54263815, "answer_count": 1, "score": 5, "last_activity_date": 1547868209, "creation_date": 1547867450, "question_id": 54263748, "link": "https://stackoverflow.com/questions/54263748/syntax-extension-for-compact-function-definitions-within-a-record", "title": "syntax extension for compact function definitions within a record", "body": "<p>The following syntax is the ordinary way of defining a function scoped to a module or within a where clause.</p>\n\n<pre><code>add :: Int -&gt; Int -&gt; Int\nadd x y = x + y\n</code></pre>\n\n<p>However, it does not work inside a record. At least by default, this is syntactically invalid</p>\n\n<pre><code>data RecordWithFunc = RecordWithFunc { func :: Int -&gt; Int -&gt; Int}\n\na :: RecordWithFunc\na = RecordWithFunc {\n    func x y = x + y\n}\n</code></pre>\n\n<p>Here's an example of the GHC frontend producing a parse error</p>\n\n<pre><code>$ runhaskell /tmp/hask.hs \n\n/tmp/hask.hs:5:10: error: parse error on input \u2018x\u2019\n  |\n5 |     func x y = x + y\n  |          ^\n</code></pre>\n\n<p>Is there a syntax extension that enables arguments to appear after a field name?</p>\n"}, {"tags": ["haskell", "functor", "category-theory"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1547850235, "post_id": 54261967, "comment_id": 95348502, "body": "This could use more detail about what you do and don&#39;t understand. For instance are you comfortable with type families? With type classes generally?"}, {"owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1547891434, "post_id": 54261967, "comment_id": 95355279, "body": "@jberryman Yes, I am pretty familiar with type classes. To be honest, I don&#39;t have a clear idea what is a monad, but functor is quite clear to me."}], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1547914941, "post_id": 54266043, "comment_id": 95360893, "body": "An example of a package which provides Representable instances for its core data type: <a href=\"http://hackage.haskell.org/package/grids\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/grids</a> And also <a href=\"https://twitter.com/phadej/status/1037667021968822272\" rel=\"nofollow noreferrer\">twitter.com/phadej/status/1037667021968822272</a>"}, {"owner": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "edited": false, "score": 8, "creation_date": 1548391185, "post_id": 54266043, "comment_id": 95532498, "body": "I would add that, in general, product types are representable, whereas sum types are not. The intuition is that the representation is like a logarithm of a data structure (that&#39;s because the function type is an exponential). A logarithm of a product is a sum of logarithms. But, in general, there is no simple formula for a logarithm of a sum. The list is not representable because it&#39;s a sum of Nil and Cons. A stream is representable because it has no Nil, and Cons is a product."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 9111, "user_id": 90088, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=128&d=identicon&r=PG", "display_name": "Bartosz Milewski", "link": "https://stackoverflow.com/users/90088/bartosz-milewski"}, "edited": false, "score": 0, "creation_date": 1608744222, "post_id": 54266043, "comment_id": 115674287, "body": "Vectors as functors represented by Fin in Idris: <a href=\"https://blog.cofree.coffee/2020-10-17-bounded-space-automata/\" rel=\"nofollow noreferrer\">blog.cofree.coffee/2020-10-17-bounded-space-automata</a> <a href=\"https://blog.cofree.coffee/2020-12-22-finally-modular-arithmetic/\" rel=\"nofollow noreferrer\">blog.cofree.coffee/2020-12-22-finally-modular-arithmetic</a>"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 21, "last_activity_date": 1547914066, "last_edit_date": 1547914066, "creation_date": 1547892896, "answer_id": 54266043, "question_id": 54261967, "link": "https://stackoverflow.com/questions/54261967/what-is-representable-used-for-in-haskell/54266043#54266043", "title": "What is Representable used for in Haskell?", "body": "<p><code>Representable</code>s are containter-like functors that have a \"special relationship\" with another type that serves as an index into the <code>Representable</code>. In the Haskell definition, this index type is given by the associated type family <code>type Rep f :: *</code></p>\n\n<p>For <em>every</em> value of the index and for <em>every</em> value of the <code>Representable</code>, we can call the <code>index :: f a -&gt; Rep f -&gt; a</code> function to get the corresponding element. And <code>tabulate :: (Rep f -&gt; a) -&gt; f a</code> constructs a container where each element is derived from its own index.</p>\n\n<p>Now, here is an example of a functor that is NOT representable: the typical Haskell list type <code>[]</code>. One might naively think that it can be indexed by something like a <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/GHC-Natural.html\" rel=\"noreferrer\"><code>Natural</code></a>, but the problem is that lists can be empty, or not have enough elements to reach a given index.</p>\n\n<p>An always-infinite type like <code>data Stream a = Stream a (Stream a)</code> <em>is</em> <code>Representable</code> and it's indexed by <code>Natural</code>, because there will always be a value for any given <code>Natural</code> that we pass to <code>index</code>.</p>\n\n<p>Similarly, the homogeneous pair <code>data Pair a = Pair a a</code> is indexed by the type <code>Bool</code>: the index tells us which of the components to select.</p>\n\n<p>If we get dependent-ish, <a href=\"http://hackage.haskell.org/package/vec-0.1/docs/Data-Vec-Pull.html#t:Vec\" rel=\"noreferrer\">fixed-size vectors</a> are <code>Representable</code> and are indexed by <a href=\"http://hackage.haskell.org/package/fin-0.0.1/docs/Data-Fin.html#t:Fin\" rel=\"noreferrer\">finite naturals</a> bounded by the size of the vector. They aren't indexed by unbounded <code>Natural</code>s  because then we could have an out-of-bounds access!</p>\n\n<hr>\n\n<p>Reading the various instances defined for <code>Representable</code> is instructive, but it seems we have to get down to the source code because the associated types are not visible in the Haddocks. Some interesting tidbits:</p>\n\n<ul>\n<li><p>The <code>Identity</code> functor is indexed by the unit type <code>()</code>, this makes sense because <code>Identity</code> only has one \"slot\" so to speak, so we don't need to provide any information.</p></li>\n<li><p>The \"functions from some type\" type <code>((-&gt;) e)</code> is indexed by the source type itself. And <code>index</code> is simply <code>id</code>. This is what's meant by \"isomorphic to the reader monad\", because the <code>Reader e</code> monad is just a newtype over <code>((-&gt;) e)</code>.</p></li>\n<li><p>The <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor-Compose.html#t:Compose\" rel=\"noreferrer\"><code>Composition</code></a> (nesting) of two representable functors is again <code>Representable</code>, and it is indexed by the <em>pair</em> of the original indexes! This makes sense: first we must know how to index into the outer functor, and then into the inner one.</p></li>\n<li><p>The <a href=\"https://hackage.haskell.org/package/base-4.10.1.0/docs/Data-Functor-Product.html#t:Product\" rel=\"noreferrer\"><code>Product</code></a> (pairing) of two <code>Representable</code> functors is indexed by the sum (<code>Either</code>) of the original indexes. The branch of the <code>Either</code> tells us in which part of the product to index.</p></li>\n<li><p>A notable omission (because it is not true in general): there is no <code>(Representable f, Representable g) =&gt; Representable (Sum f g)</code> instance.</p></li>\n</ul>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 2, "accepted_answer_id": 54266043, "answer_count": 1, "score": 12, "last_activity_date": 1548096691, "creation_date": 1547848731, "last_edit_date": 1548081753, "question_id": 54261967, "link": "https://stackoverflow.com/questions/54261967/what-is-representable-used-for-in-haskell", "title": "What is Representable used for in Haskell?", "body": "<p>I am looking to understand what does <a href=\"https://hackage.haskell.org/package/adjunctions-4.4/docs/Data-Functor-Rep.html#t:Representable\" rel=\"noreferrer\">Representable</a> stand for in Haskell. The definition</p>\n\n<blockquote>\n  <p>Representable endofunctors over the category of Haskell types are isomorphic to the reader monad and so inherit a very large number of properties for free.</p>\n</blockquote>\n\n<p>is not clear enough to me. I would like to take a look at a real example, to understand how can I use <code>tabulate</code> and <code>index</code> methods.</p>\n\n<p><strong>So, my question is:</strong></p>\n\n<ul>\n<li>What is Representable used for?</li>\n<li>Can you clarify the definition and provide an example, please?</li>\n</ul>\n"}, {"tags": ["r", "haskell", "lazy-evaluation", "call-by-need"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1547848181, "post_id": 54261834, "comment_id": 95347892, "body": "I can think of two possibilities: one is I can show you a reduction trace in a call-by-need language, say, working with an infinite list. This will require some familiarity with ML-style (Haskell) syntax, which is not easy to read without some experience. Another is that I can show you an implementation of call-by-need in a normal imperative language and how it might be used there, which can be instructive.  Which would you like?"}, {"owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1547848467, "post_id": 54261834, "comment_id": 95347973, "body": "@luqui I do have experience with <code>SML</code> but not with <code>Haskell</code>. Also I don&#39;t afraid to learn the syntax of a PL. I would like to see a real PL which supports this feature please :)"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547850468, "post_id": 54261834, "comment_id": 95348581, "body": "Do you mean something like <code>print (take 5 (map (* 2) [1 ..]))</code>?"}, {"owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547854376, "post_id": 54261834, "comment_id": 95349572, "body": "@melpomene Maybe you can show me an example that shows the difference between <code>call-by-need</code> and <code>call-be-value</code>. Something like the example between <code>call-by-name</code> and  <code>call-by-value</code> in Scala as was shown in the following thread: <a href=\"https://stackoverflow.com/questions/13337338/call-by-name-vs-call-by-value-in-scala-clarification-needed\" title=\"call by name vs call by value in scala clarification needed\">stackoverflow.com/questions/13337338/&hellip;</a>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1547855688, "post_id": 54261834, "comment_id": 95349840, "body": "@vesii Yes, that&#39;s exactly what my comment shows."}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 1, "creation_date": 1548849569, "post_id": 54261834, "comment_id": 95689368, "body": "This question appears to be off-topic for Stack Overflow as defined in the <a href=\"https://stackoverflow.com/help\">help center</a>, because it&#39;s a general theoretic question, rather than a specific programming problem.  It may be better suited to the <a href=\"https://cs.stackexchange.com\">Computer Science</a> site; see <a href=\"//meta.stackexchange.com/q/129598\">Which computer science / programming Stack Exchange sites do I post on?</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1547855829, "post_id": 54262834, "comment_id": 95349869, "body": "Great answer! Can you please add an example which shows that <code>call-by-need</code> will evaluate only once?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 2, "creation_date": 1547861906, "post_id": 54262834, "comment_id": 95350874, "body": "@vesii That&#39;s harder to prove in Haskell with just code because it requires side-effects, which requires using some unsafe code that is typically only used in low level libraries. A more readily observable way to prove that it only evaluates once is to observe the memory usage &amp; speed of the program when a value is used more than once."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1547873028, "post_id": 54262834, "comment_id": 95352189, "body": "Or <code>Debug.Trace</code>!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "edited": false, "score": 0, "creation_date": 1547892362, "post_id": 54262834, "comment_id": 95355477, "body": "@vesii every code snippet in this answer would work under call-by-name, without call-by-need."}, {"owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1547903279, "post_id": 54262834, "comment_id": 95357987, "body": "@WillNess Yes that&#39;s exactly the thing I tried to tell. It does not show the difference between call-by-need and call-by-name. Are there any other languages that support call-by-need?"}, {"owner": {"reputation": 120535, "user_id": 123109, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/157c96de3d125abc1c363ff25c20dfaf?s=128&d=identicon&r=PG", "display_name": "Greg Bacon", "link": "https://stackoverflow.com/users/123109/greg-bacon"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1547904927, "post_id": 54262834, "comment_id": 95358363, "body": "@WillNess It is true that call-by-name could handle the <code>say_hello</code> example because it never evaluates <code>numbers</code>. <code>take</code> and <code>filter</code> applied to an infinite list do. That makes the slight difference that the function at least tries to execute, but the program still runs off into an infinite loop."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1547916396, "post_id": 54262834, "comment_id": 95361316, "body": "@GregBacon I&#39;d expect the <code>[1..]</code> in any call-by-name language to be implemented by what is essentially a generator. it won&#39;t ever attempt to calculate the full extent of the &quot;infinite&quot; list on its own. all it does is produce <i>next</i> element when asked to."}], "tags": [], "owner": {"reputation": 120535, "user_id": 123109, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/157c96de3d125abc1c363ff25c20dfaf?s=128&d=identicon&r=PG", "display_name": "Greg Bacon", "link": "https://stackoverflow.com/users/123109/greg-bacon"}, "is_accepted": true, "score": 4, "last_activity_date": 1547855407, "creation_date": 1547855407, "answer_id": 54262834, "question_id": 54261834, "link": "https://stackoverflow.com/questions/54261834/simple-example-of-call-by-need/54262834#54262834", "title": "Simple example of call-by-need", "body": "<p>The function</p>\n\n<pre><code>say_hello numbers = putStrLn \"Hello!\"\n</code></pre>\n\n<p>ignores its <code>numbers</code> argument. Under <a href=\"https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_value\" rel=\"nofollow noreferrer\">call-by-value</a> semantics, even though an argument is ignored, the parameter at the function call site may need to be evaluated, perhaps because of side effects that the rest of the program depends on.</p>\n\n<p>In Haskell, we might call <code>say_hello</code> as</p>\n\n<pre><code>say_hello [1..]\n</code></pre>\n\n<p>where <code>[1..]</code> is the infinite list of naturals. Under call-by-value semantics, the CPU would run off trying to build an infinite list and never get to the <code>say_hello</code> at all!</p>\n\n<p>Haskell merely outputs</p>\n\n<pre><code>$ runghc cbn.hs\nHello!\n</code></pre>\n\n<p>For less dramatic examples, the first ten natural numbers are</p>\n\n<pre><code>ghci&gt; take 10 [1..]\n[1,2,3,4,5,6,7,8,9,10]\n</code></pre>\n\n<p>The first ten odds are</p>\n\n<pre><code>ghci&gt; take 10 $ filter odd [1..]\n[1,3,5,7,9,11,13,15,17,19]\n</code></pre>\n\n<p>Under <a href=\"https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_need\" rel=\"nofollow noreferrer\">call-by-need</a> semantics, each value \u2014 even a conceptually infinite one as in the examples above \u2014 is evaluated only to the extent required and no more.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1548052602, "last_edit_date": 1548052602, "creation_date": 1547916752, "answer_id": 54269301, "question_id": 54261834, "link": "https://stackoverflow.com/questions/54261834/simple-example-of-call-by-need/54269301#54269301", "title": "Simple example of call-by-need", "body": "<p>update: A simple example, as asked for:</p>\n\n<pre><code>ff 0 = 1\nff 1 = 1\nff n = go (ff (n-1))\n  where\n  go x = x + x\n</code></pre>\n\n<p>Under call-by-name, each invocation of <code>go</code> evaluates <code>ff (n-1)</code> twice, each for each appearance of <code>x</code> in its definition (because <code>+</code> is strict in both arguments, i.e. demands the values of the both of them).</p>\n\n<p>Under call-by-need, <code>go</code>'s argument is evaluated at most once. Specifically, here, <code>x</code>'s value is found out only once, and reused for the second appearance of <code>x</code> in the expression <code>x + x</code>. If it weren't needed, <code>x</code> wouldn't be evaluated at all, just as with call-by-name. </p>\n\n<p>Under call-by-value, <code>go</code>'s argument is always evaluated exactly once, prior to entering the function's body, even if it isn't used anywhere in the function's body.</p>\n\n<hr>\n\n<p>Here's my understanding of it, in the context of Haskell. </p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_need\" rel=\"nofollow noreferrer\">According to Wikipedia</a>, <em>\"call by need is a memoized variant of call by name where, if the function argument is evaluated, that value is stored for subsequent uses.\"</em></p>\n\n<p>Call by name:</p>\n\n<pre><code>take 10 . filter even $ [1..]\n</code></pre>\n\n<p>With one consumer the produced value disappears after being produced so it might as well be call-by-name.</p>\n\n<p>Call by need:</p>\n\n<pre><code>import qualified Data.List.Ordered as O\n\nh = 1 : map (2*) h &lt;&gt; map (3*) h &lt;&gt; map (5*) h\n    where\n    (&lt;&gt;) = O.union\n</code></pre>\n\n<p>The difference is, here the <code>h</code> list is reused by several consumers, at different tempos, so it is essential that the produced values are remembered. In a call-by-name language there'd be much replication of computational effort here because the computational expression for <code>h</code> would be substituted at each of its occurrences, causing separate calculation for each. In a call-by-need--<em>capable</em> language like Haskell the results of computing the elements of <code>h</code> are shared between each reference to <code>h</code>.</p>\n\n<p>Another example is, most any data defined by <code>fix</code> is only possible under call-by-need. With call-by-value the most we can have is the <strong>Y</strong> combinator.</p>\n\n<p>See: <a href=\"https://stackoverflow.com/questions/53715841/sharing-vs-non-sharing-fixed-point-combinator\">Sharing vs. non-sharing fixed-point combinator</a> and its linked entries and comments (among them, <a href=\"https://stackoverflow.com/a/13029529/849891\">this</a>, and <em>its</em> links, like <a href=\"https://stackoverflow.com/questions/12298169/can-fold-be-used-to-create-infinite-lists/12299223#12299223\">Can fold be used to create infinite lists?</a>).</p>\n"}], "owner": {"reputation": 1811, "user_id": 9808098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c44d685cabf03d0555543896b4ba1?s=128&d=identicon&r=PG&f=1", "display_name": "vesii", "link": "https://stackoverflow.com/users/9808098/vesii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 561, "favorite_count": 0, "accepted_answer_id": 54262834, "answer_count": 2, "score": 5, "last_activity_date": 1548052602, "creation_date": 1547847912, "last_edit_date": 1547861291, "question_id": 54261834, "link": "https://stackoverflow.com/questions/54261834/simple-example-of-call-by-need", "title": "Simple example of call-by-need", "body": "<p>I'm trying to understand the theorem behind \"call-by-need.\" I do understand the definition, but I'm a bit confused. I would like to see a simple example which shows how call-by-need works.</p>\n\n<p>After reading some previous threads, I found out that Haskell uses this kind of evaluation. Are there any other programming languages which support this feature?</p>\n\n<p>I read about the call-by-name of Scala, and I do understand that call-by-name and call-by-need are similar but different by the fact that call-by-need will keep the evaluated value. But I really would love to see a real-life example (it does not have to be in Haskell), which shows call-by-need.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1547845245, "post_id": 54261197, "comment_id": 95346888, "body": "(Community: I was tempted to vote-close this as &quot;off topic - small typo&quot;, but ended up answering it anyway. I&#39;m not sure what the proper action here should have been, since it&#39;s not a typo by the OP, and the OP looked genuinely puzzled by a seemingly strange syntax. Feel free to disagree :-) )"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1547974909, "last_edit_date": 1547974909, "creation_date": 1547844762, "answer_id": 54261288, "question_id": 54261197, "link": "https://stackoverflow.com/questions/54261197/haskell-h1-syntax-and-scientific-unit-checking/54261288#54261288", "title": "Haskell &quot;h1&gt;&quot; Syntax and Scientific Unit Checking", "body": "<p>I'm fairly sure that's only a typo, or some HTML which somehow was pasted inside an Haskell script.</p>\n\n<p>The code should likely read as:</p>\n\n<pre><code>-- multiply units composed of non-empty lists recursively\ninstance (Add i j k, Mult r s t) =&gt;\n         Mult ((a, i) `Cons` r) ((a, j) `Cons` s) ((a, k) `Cons` t) where\n   mult ((a, i) `Cons` r) ((_, j) `Cons` s) = (a, add i j) `Cons` mult r s\n</code></pre>\n\n<p>In the linked tutorial another <code>h1&gt;</code> appears, and it should be <code>=</code> as well. Even if the tutorial is old, it should compile with a few extensions on. GHC should point out in the error messages which extensions you need. I'd keep recompiling this and enabling extensions as needed.</p>\n\n<p>There's no special <code>h1&gt;</code> syntax in Haskell.</p>\n"}], "owner": {"reputation": 421, "user_id": 1758759, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5e7df1d51660a7dd65bb2e7f46eca915?s=128&d=identicon&r=PG", "display_name": "dim_voly", "link": "https://stackoverflow.com/users/1758759/dim-voly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 54261288, "answer_count": 1, "score": 1, "last_activity_date": 1547974909, "creation_date": 1547844247, "question_id": 54261197, "link": "https://stackoverflow.com/questions/54261197/haskell-h1-syntax-and-scientific-unit-checking", "title": "Haskell &quot;h1&gt;&quot; Syntax and Scientific Unit Checking", "body": "<p>I've been trying to replicate <a href=\"https://liftm.wordpress.com/2007/06/03/scientificdimension-type-arithmetic-and-physical-units-in-haskell/\" rel=\"nofollow noreferrer\">this (rather old) tutorial</a> on using Haskell's type checker as a unit checker for any arithmetic/maths to have consistent units (i.e. meters, kilograms, seconds and derivatives thereof).</p>\n\n<p>Essentially a way to count Peano numerals is introduced as well as a way to recursively define lists. Then these two features are used to define unit types as lists with each element being a Peano numeral corresponding to what exponent belongs to each of meters, kilograms and seconds.</p>\n\n<p>I am stuck on the following bit of code that they've provided:</p>\n\n<pre><code>-- multiply units composed of non-empty lists recursively\ninstance (Add i j k, Mult r s t) =&gt;\n         Mult ((a, i) `Cons` r) ((a, j) `Cons` s) ((a, k) `Cons` t) where\n  mult ((a, i) `Cons` r) ((_, j) `Cons` s) h1&gt;\n    (a, add i j) `Cons` mult r s\n</code></pre>\n\n<p>Nowhere in the tutorial do I see <code>h1&gt;</code> defined. The compiler reports:</p>\n\n<pre><code>    parse error (possibly incorrect indentation or mismatched brackets)\n    |\n314 |     main :: IO ()\n    |     ^\n</code></pre>\n\n<p>Where 314 is the next line of code that worked before introducing the multiplication <code>instance</code> definition block. I have tried the following permutation of the above code:</p>\n\n<pre><code>-- multiply units composed of non-empty lists recursively\ninstance (Add i j k, Mult r s t) =&gt;\n         Mult ((a, i) `Cons` r) ((a, j) `Cons` s) ((a, k) `Cons` t) where\n  mult ((a, i) `Cons` r) ((_, j) `Cons` s) ((a, add i j) `Cons` mult r s)\n</code></pre>\n\n<p>To attain the same result. Since no one complained in the tutorial comments, at the moment I'm guessing that the two option declarations are the culprits:</p>\n\n<pre><code>{-# OPTIONS -fglasgow-exts #-}\n{-# OPTIONS -fallow-undecidable-instances #-}\n</code></pre>\n\n<p>Since both raise deprecation warnings. But in my mind if something is deprecated, it should still work so am a bit stumped. I am using GHC 8.4.3.</p>\n\n<p>What would be the correct form for the above <code>instance</code> declaration?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1547845725, "post_id": 54261046, "comment_id": 95347052, "body": "Why not simply not name the fields, and write seperate field-fetching functions?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1547846785, "post_id": 54261046, "comment_id": 95347424, "body": "Why does point 3 concern you, exactly?"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1547847607, "post_id": 54261046, "comment_id": 95347697, "body": "name clashes become annoying: I can imagine having e.g. a <code>time</code> field in many different record types, and they even mean the same thing. I guess not naming the fields might be an option."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1547851069, "post_id": 54261046, "comment_id": 95348748, "body": "@bbarker The answers on the question you linked discuss what to do about that... (Use a typeclass, a prefix, or imports with qualified+as.) I&#39;m very, very tempted to just mark this as a duplicate of that one. Lenses don&#39;t really change the answer significantly."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1547852632, "post_id": 54261046, "comment_id": 95349179, "body": "I think the thing that is still tripping me up: say I have a datatype named <code>Record</code> with <code>Record{id:: Int}</code> - is there a way to be able to refer directly to an unprefixed <code>Record</code> and then also do something like <code>RCD.id</code> where <code>RCD</code> is the qualified import to use the <code>id</code> field (or to just not have them imported at all, as my original question states, which is the main difference from the prior question, I suppose)."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1547860782, "post_id": 54261046, "comment_id": 95350707, "body": "In addition to a qualified import, you can make an unqualified import of only the <code>Record</code> type. <code>import qualified ThePackage AS RCD; import ThePackage (Record)</code>"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1547873662, "post_id": 54261046, "comment_id": 95352266, "body": "@4castle - great, that does work. Somehow I was still thinking this was like JVM-land where the names might class on import, but in Haskell (since things are always lazy?) I suppose they only class on use (i.e. if there is ambiguity during a call)."}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1547843532, "creation_date": 1547843532, "question_id": 54261046, "link": "https://stackoverflow.com/questions/54261046/how-can-one-export-a-datatype-record-in-haskell-without-exporting-its-fields", "title": "How can one export a datatype record in haskell without exporting its fields?", "body": "<p>I saw the somewhat older question at <a href=\"https://stackoverflow.com/questions/4260507/avoiding-namespace-pollution-in-haskell\">Avoiding namespace pollution in Haskell</a> and am looking for a modern solution using lenses.</p>\n\n<p>I think the approach would come in a few steps:</p>\n\n<ol>\n<li>Rewrite fields to be lens friendly: <code>field</code> -> <code>_field</code>.</li>\n<li>Use lenses.</li>\n<li>Avoid exporting (or if on the user's side, importing) the <code>_field</code>s.</li>\n</ol>\n\n<p>I'm mostly concerned with point 3 in this question, as I think I can figure out the rest based on existing resources. But, maybe this isn't possible.</p>\n"}, {"tags": ["haskell", "proof"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1547839069, "post_id": 54260109, "comment_id": 95344438, "body": "What is the <code>UI</code> class for? It has no methods, no constraints, and no functional dependencies. That would seem to make it quite useless."}, {"owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1547839631, "post_id": 54260109, "comment_id": 95344658, "body": "@ dfeuer. UI is a class for unique identifiers. The code has been simplified to focus on the proof. So, in the context of the code the class just as a constraint on the type variables ."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1547845750, "post_id": 54260109, "comment_id": 95347068, "body": "Ah... When I&#39;m writing an example like that, I&#39;ll usually use an ellipsis to indicate that there&#39;s something in the body. <code>class UI a where ...</code>, <code>instance UI Int where ...</code>."}], "answers": [{"comments": [{"owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "edited": false, "score": 0, "creation_date": 1547915763, "post_id": 54260841, "comment_id": 95361121, "body": "Is the compilation or execution of <code>test</code> in any sense a proof of the theorem for specific types? \u2013"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "edited": false, "score": 1, "creation_date": 1547923150, "post_id": 54260841, "comment_id": 95363324, "body": "No, it&#39;s a test case, which still provides a bit of assurance and is valuable, just not what &quot;proof&quot; means.  Of course if <code>test</code> ever returned false then you would have a proof that the property is false (because if it&#39;s false for one example, then it&#39;s not true for every example)"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 3, "last_activity_date": 1547842509, "creation_date": 1547842509, "answer_id": 54260841, "question_id": 54260109, "link": "https://stackoverflow.com/questions/54260109/how-could-i-prove-this-type-level-haskell-theorem/54260841#54260841", "title": "How could I prove this type level Haskell theorem?", "body": "<p>To prove this, just start with one side of the equation and rewrite until you get to the other side.  I like to start with the more complicated side.</p>\n\n<pre><code>when x :: Int,\n\nContinuant (getUI (Continuant x))\n    --      ^^^^^^^^^^^^^^^^^^^^\n    -- by definition of getUI in Category Continuant Int\n    = Continuant x\n</code></pre>\n\n<p>That was easy!  This does count as a proof (mind, not a formally verified one -- Haskell is not powerful enough to express term-level proofs.  But it's so trivial it wouldn't be worth the boilerplate in agda.).</p>\n\n<p>I was a bit bewildered by the phrasing of this axiom, since it seems to be mixing up types and terms quite a lot.  Skimming the paper, it seems like this is only intended to work for simple single-constructor <code>newtype</code>s, thus this mixing is justified (still odd).  Anyway, it seems like the paper doesn't have the <code>Category</code> class parameterized on <code>a</code>: i.e. instead of</p>\n\n<pre><code>class Category t a where ...\n</code></pre>\n\n<p>it would be</p>\n\n<pre><code>class Category t where ...\n</code></pre>\n\n<p>which makes more sense to me, that the class describes polymorphic wrappers, rather than a possibly different description of how it wraps each individual type (especially since it appears that the axiom requires the implementation to be the same no matter what <code>a</code> you pick!).</p>\n"}], "owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1613485274, "creation_date": 1547838608, "last_edit_date": 1613485274, "question_id": 54260109, "link": "https://stackoverflow.com/questions/54260109/how-could-i-prove-this-type-level-haskell-theorem", "title": "How could I prove this type level Haskell theorem?", "body": "<p>With respect to <strong>Listing 1</strong>, how would I go about proving the type level axiom</p>\n<p><code>(t a) = (t (getUI (t a)))</code></p>\n<p>holds?</p>\n<p><strong>Listing 1</strong></p>\n<pre><code>    data Continuant a = Continuant a  deriving (Show,Eq)\n        \n    class UI a where -- ...\n          \n    instance UI Int where -- ...\n        \n    class Category t  where\n      getUI :: (UI a) =&gt; (t a) -&gt; a\n\n   instance Category Continuant where\n     getUI (Continuant a) = a\n        \n     -- Does axiom (t a) = (t (getUI(t a))) holds for given types?\n     test :: Int -&gt; Bool\n     test x =  (Continuant x) == (Continuant (getUI (Continuant x)))\n</code></pre>\n<p>The code is based on a <a href=\"https://www.researchgate.net/publication/305430663_Ontologies_of_Dynamical_Systems_and_Verifiable_Ontology-Based_Computation_Towards_a_Haskell-Based_Implementation_of_Referent_Tracking\" rel=\"nofollow noreferrer\">paper</a> where it is stated:</p>\n<blockquote>\n<p>For all implementations of getUI one may require that the axiom  (t a)\n= (t (getUI (t a))) holds. This must be proven to hold for every specific type class instance declaration. For finite types this can be\ndone by a program that enumerates all possibilities. For infinite\ntypes this must be done manually via proofs by induction.</p>\n</blockquote>\n<p>My current intuition is that the <code>test</code> function in some way satisfies the axiom, but I do not think that it amounts to a proof.</p>\n<p>This question follows on from a <a href=\"https://stackoverflow.com/questions/54253762/does-this-haskell-program-provide-an-example-of-theorems-for-free\">previous question</a>.</p>\n"}, {"tags": ["haskell", "functional-programming", "applicative"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1547835257, "post_id": 54259128, "comment_id": 95342870, "body": "If you have a <code>Monad</code> instance already, you can just define <code>(&lt;*&gt;) = ap</code> (from <code>Control.Monad</code>).  You could unroll the definition <code>ap fab fa</code> to find out how it works."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1547840474, "post_id": 54259128, "comment_id": 95344998, "body": "This is indeed a case where defining <code>fmap</code>, <code>return</code> and <code>join</code> is very simple and intuitive. That can then be used to build a monad. By comparison defining the applicative instance feels far less natural: I&#39;d just use <code>(&lt;*&gt;)=ap</code> as luqui suggests and forget about it :-P"}, {"owner": {"reputation": 1365, "user_id": 1059650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3f0d762911ed1769b4c9f5260791ddd?s=128&d=identicon&r=PG", "display_name": "retnuH", "link": "https://stackoverflow.com/users/1059650/retnuh"}, "edited": false, "score": 1, "creation_date": 1547854578, "post_id": 54259128, "comment_id": 95349622, "body": "Still learning about all these things so I only worked on <code>bind</code>/<code>&gt;&gt;=</code> - I&#39;m only vaguely aware of <code>ap</code> and <code>join</code>, haven&#39;t really got into them.  I remember that there&#39;s some stuff where you can define some in terms of the others and vice versa.  Hopefully the book will go into it some more or another thorough going through the Typeclassopdia after finishing the book will help connect the dots.  And, you know, writing some actual code :)"}], "answers": [{"comments": [{"owner": {"reputation": 1365, "user_id": 1059650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3f0d762911ed1769b4c9f5260791ddd?s=128&d=identicon&r=PG", "display_name": "retnuH", "link": "https://stackoverflow.com/users/1059650/retnuh"}, "edited": false, "score": 0, "creation_date": 1547854329, "post_id": 54259533, "comment_id": 95349560, "body": "Although, <code>Val x &lt;*&gt; Val y = ...</code> isn&#39;t really the choice, though, is it?  What about <code>Val x &lt;*&gt; (Add l r)</code> and <code>Val x &lt;*&gt; Var r</code> - as you suggest, there can be only one correct answer, easily verified by the use of <code>ap</code> as you suggested elsewhere."}, {"owner": {"reputation": 1365, "user_id": 1059650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3f0d762911ed1769b4c9f5260791ddd?s=128&d=identicon&r=PG", "display_name": "retnuH", "link": "https://stackoverflow.com/users/1059650/retnuh"}, "edited": false, "score": 1, "creation_date": 1547854372, "post_id": 54259533, "comment_id": 95349569, "body": "Great answer, thanks for helping me to build my intuition and understanding without just flat out saying &quot;do this&quot;.  Really appreciate it!"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 3, "last_activity_date": 1547841014, "last_edit_date": 1547841014, "creation_date": 1547835663, "answer_id": 54259533, "question_id": 54259128, "link": "https://stackoverflow.com/questions/54259128/understand-the-applicative-problem-7-in-chapter-12-of-programming-in-haskell/54259533#54259533", "title": "Understand the Applicative problem (#7) in Chapter 12 of &quot;Programming In Haskell&quot;", "body": "<pre><code>Val :: Int -&gt; Expr a\n</code></pre>\n\n<p>for <em>any</em> <code>a</code>.  So</p>\n\n<pre><code>Val x &lt;*&gt; _ = Val x\n</code></pre>\n\n<p>is valid, as is</p>\n\n<pre><code>_ &lt;*&gt; Val y = Val y\n</code></pre>\n\n<p>as is</p>\n\n<pre><code>Val x &lt;*&gt; Val y = Val (something about x and y)\n</code></pre>\n\n<p>so unfortunately now you have a choice, which means you are about to make the wrong one.  Fortunately only one of these is compatible with the <code>Monad</code> instance (which one?).</p>\n\n<p>As for the recursive case, you have</p>\n\n<pre><code>Add e e' &lt;*&gt; fb = ...\n     -- e :: Expr (a -&gt; b)\n     -- e' :: Expr (a -&gt; b)\n     -- fb :: Expr a\n</code></pre>\n\n<p>And you should use all the incoming information to make an <code>Expr b</code>, as well as preserving the \"structure\" (<code>Add</code>).  What are all the ways you could make an <code>Expr b</code> from this (remember you can use the applicative operator recursively)?</p>\n"}], "owner": {"reputation": 1365, "user_id": 1059650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3f0d762911ed1769b4c9f5260791ddd?s=128&d=identicon&r=PG", "display_name": "retnuH", "link": "https://stackoverflow.com/users/1059650/retnuh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 54259533, "answer_count": 1, "score": 4, "last_activity_date": 1547841014, "creation_date": 1547833839, "question_id": 54259128, "link": "https://stackoverflow.com/questions/54259128/understand-the-applicative-problem-7-in-chapter-12-of-programming-in-haskell", "title": "Understand the Applicative problem (#7) in Chapter 12 of &quot;Programming In Haskell&quot;", "body": "<p>I've been working through the excellent <a href=\"http://www.cs.nott.ac.uk/~pszgmh/pih.html\" rel=\"nofollow noreferrer\">Programming in Haskell (2nd ed)</a>.  I'm a bit flummoxed by the question on Applicatives, though.</p>\n\n<p>Given the following type:</p>\n\n<pre><code>data Expr a = Var a | Val Int | Add (Expr a) (Expr a) deriving Show\n</code></pre>\n\n<p>The question is to write the implementations of the <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> classes.</p>\n\n<p><code>Functor</code> is straightforward, as is <code>Monad</code> (at least it compiles, I've not fully wrapped my head around it yet but I'm more worried about this bit first).</p>\n\n<p>I've come up with this, which compiles, but I have concerns:</p>\n\n<pre><code>instance Applicative Expr where\n    -- pure :: a -&gt; Expr a\n    pure = Var\n\n    -- (&lt;*&gt;) :: Expr (a -&gt; b) -&gt; Expr a -&gt; Expr b\n    (Var fab) &lt;*&gt; fa = fmap fab fa\n</code></pre>\n\n<p><code>pure</code> is fine, but I'm worried about the actual applicative operator <code>&lt;*&gt;</code>.  As far as I can tell, it only makes sense for <code>Var</code> - not for <code>Val</code> or <code>Add</code>.  And it just seems weird to me that you'd have a type where's it's legal to express things that can explode - for instance, you could have <code>Add (Var ord) (Val 10)</code> which is of type <code>Expr (Char -&gt; Int)</code>, so would typecheck as the lhs in a <code>&lt;*&gt;</code> expression, but (as it stands) would explode.  And it's not clear to me how the recursive definition would work - because as soon as you hit <code>(Val 10)</code>, you're stuffed - there's no way to convert the rhs to the necessary type.</p>\n\n<p>What am I missing here?  How do I complete the definition of <code>&lt;*&gt;</code> such that things don't explode, and it's still a valid applicative?  Am I right in thinking/feeling that in reality, you wouldn't design a type like this?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1547828755, "post_id": 54257838, "comment_id": 95339866, "body": "Does <code>getCurrentTimeMicroseconds</code> emit a different type than <code>getCurrentTime</code>?"}, {"owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "reply_to_user": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1547829461, "post_id": 54257838, "comment_id": 95340237, "body": "@RobertHarvey it does not, at present."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1547830090, "post_id": 54258176, "comment_id": 95340533, "body": "It might be nice if e.g. <code>stack</code> could allow local packages with conflicting names to shadow the published hackage version for multi-package projects"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 1, "last_activity_date": 1547829786, "creation_date": 1547829786, "answer_id": 54258176, "question_id": 54257838, "link": "https://stackoverflow.com/questions/54257838/how-can-i-get-ghc-to-emit-a-warning-for-a-given-function/54258176#54258176", "title": "How can I get GHC to emit a warning for a given function?", "body": "<p>I can't think of a way to do this right now, but I think the closest you can get is something like:</p>\n\n<ul>\n<li>create a new package <code>my-time</code> that depends on <code>time</code></li>\n<li><p>re-export your shim functions annotated with warnings, like</p>\n\n<pre><code>import qualified Data.Time as Time\n{-# WARNING getCurrentTime \"you should prefer getCurrentTimeMicroseconds\" #-}\ngetCurrentTime = Time.getCurrentTime\n</code></pre></li>\n<li><p>depend on <code>my-time</code> in your packages</p></li>\n</ul>\n\n<p>obviously this doesn't give you a way to enforce <em>not</em> importing <code>Data.Time.getCurrentTime</code>, and is even less satisfying when the code you want to shim is in Prelude or <code>base</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 104, "user_id": 101287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8efbcab730ad4274206c593a1a907dfb?s=128&d=identicon&r=PG", "display_name": "Moss Prescott", "link": "https://stackoverflow.com/users/101287/moss-prescott"}, "is_accepted": true, "score": 3, "last_activity_date": 1547830326, "creation_date": 1547830326, "answer_id": 54258304, "question_id": 54257838, "link": "https://stackoverflow.com/questions/54257838/how-can-i-get-ghc-to-emit-a-warning-for-a-given-function/54258304#54258304", "title": "How can I get GHC to emit a warning for a given function?", "body": "<p>This is what types are for. The type you use for times should reflect the constraints you want to place on the values it represents.</p>\n\n<p>For example, you could wrap <code>UTCTime</code> like so:</p>\n\n<pre><code>newtype UTCTimeMicroseconds = UTCTimeMicroseconds { picos :: UTCTime }\n\nmicrosecondsFromPicos :: UTCTime -&gt; UTCTimeMicroseconds\nmicrosecondsFromPicos = ...\n\ngetCurrentTimeMilliseconds :: IO UTCTimeMicroseconds\ngetCurrentTimeMilliseconds = microsecondsFromPicos &lt;$&gt; getCurrentTime\n</code></pre>\n\n<p>And use the new type everywhere in your package that you need times to have this property.</p>\n\n<p>If you want to be strict about it, don't export the <code>UTCTimeMicroseconds</code> constructor, so the only way to get one of these values is to use <code>microsecondsFromPicos</code>, which enforces your requirement.</p>\n\n<p>That makes any misuse an error, not a warning, but in most cases that's what you want anyway.</p>\n\n<p>When you do want to use <code>UTCTime</code> with the full resolution, or just don't care, you can just use that type as usual. It'll be easy to find the places in your code base where that happens, because they'll be the <em>only</em> places where <code>UTCTime</code> is used.</p>\n"}], "owner": {"reputation": 51262, "user_id": 208257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d59503078761ba50620cbee4348882e?s=128&d=identicon&r=PG", "display_name": "Dan Burton", "link": "https://stackoverflow.com/users/208257/dan-burton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 54258304, "answer_count": 2, "score": 3, "last_activity_date": 1547830326, "creation_date": 1547828572, "question_id": 54257838, "link": "https://stackoverflow.com/questions/54257838/how-can-i-get-ghc-to-emit-a-warning-for-a-given-function", "title": "How can I get GHC to emit a warning for a given function?", "body": "<p>Suppose I've decided that everywhere in a given code base (package) I want to use a custom <code>getCurrentTimeMicroseconds</code> rather than <code>getCurrentTime</code>. Is there a way for me to get GHC to emit warnings me about uses of <code>getCurrentTime</code>, only in that code base? (Not for anything upstream or downstream.)</p>\n\n<p>Bonus question, suppose I want to selectively allow usages with an explicit annotation at the use site (preferably not module-wide). Is this also possible?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1547825469, "post_id": 54256998, "comment_id": 95338077, "body": "What did you try <i>yourself</i>?"}, {"owner": {"reputation": 45, "user_id": 7805635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7791678b293f12e2a0bf696b163e19f7?s=128&d=identicon&r=PG&f=1", "display_name": "ahmedES", "link": "https://stackoverflow.com/users/7805635/ahmedes"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1547825609, "post_id": 54256998, "comment_id": 95338166, "body": "i tried a lot actually but i couldn&#39;t figure it out, this is the last exercise so it is the hardest"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1547825642, "post_id": 54256998, "comment_id": 95338187, "body": "Can you at least share a &quot;path of thought&quot;, <a href=\"https://stackoverflow.com/posts/54256998/edit\">edit</a> your question."}, {"owner": {"reputation": 5335, "user_id": 6920962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e62cd73355fc90d37429f9443df38da?s=128&d=identicon&r=PG&f=1", "display_name": "user28434", "link": "https://stackoverflow.com/users/6920962/user28434"}, "edited": false, "score": 3, "creation_date": 1547825663, "post_id": 54256998, "comment_id": 95338205, "body": "@ahmed.py, try <code>:t twice</code> in <code>ghci</code>"}, {"owner": {"reputation": 45, "user_id": 7805635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7791678b293f12e2a0bf696b163e19f7?s=128&d=identicon&r=PG&f=1", "display_name": "ahmedES", "link": "https://stackoverflow.com/users/7805635/ahmedes"}, "edited": false, "score": 0, "creation_date": 1547825866, "post_id": 54256998, "comment_id": 95338297, "body": "sorry i&#39;m not a native english speaker so i didn not understand your question at first, i understand how the function should work but i could not figure out the syntax for it it take tow argument the first is a function and the second a abasic type i think and applay the function twice one for x and one for the return of (f x)"}, {"owner": {"reputation": 45, "user_id": 7805635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7791678b293f12e2a0bf696b163e19f7?s=128&d=identicon&r=PG&f=1", "display_name": "ahmedES", "link": "https://stackoverflow.com/users/7805635/ahmedes"}, "edited": false, "score": 0, "creation_date": 1547826271, "post_id": 54256998, "comment_id": 95338540, "body": "guys i spent almost an hour trying to solve this , forgive if i can&#39;t express myself right"}, {"owner": {"reputation": 7953, "user_id": 812149, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6lIqv.png?s=128&g=1", "display_name": "S.L. Barth", "link": "https://stackoverflow.com/users/812149/s-l-barth"}, "edited": false, "score": 1, "creation_date": 1547826276, "post_id": 54256998, "comment_id": 95338544, "body": "I have added your attempt into the question. When asking questions here, show what you have tried. You can <a href=\"https://stackoverflow.com/posts/54256998/edit\">edit</a> your questions. You may want to try defining the function, compiling, and see what errors it gives."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 7805635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7791678b293f12e2a0bf696b163e19f7?s=128&d=identicon&r=PG&f=1", "display_name": "ahmedES", "link": "https://stackoverflow.com/users/7805635/ahmedes"}, "edited": false, "score": 0, "creation_date": 1547827523, "post_id": 54257316, "comment_id": 95339211, "body": "thanks a lot, thats exactly what i was thinking of but with out the right syntax , i was trying to do this <code>twice :: (f -&gt; a)  -&gt; a</code>"}], "tags": [], "owner": {"reputation": 5335, "user_id": 6920962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e62cd73355fc90d37429f9443df38da?s=128&d=identicon&r=PG&f=1", "display_name": "user28434", "link": "https://stackoverflow.com/users/6920962/user28434"}, "is_accepted": true, "score": 5, "last_activity_date": 1547826615, "creation_date": 1547826615, "answer_id": 54257316, "question_id": 54256998, "link": "https://stackoverflow.com/questions/54256998/what-is-the-type-of-this-function-definition-twice-f-x-f-f-x/54257316#54257316", "title": "What is the type of this function definition &quot;twice f x = f (f x)&quot;", "body": "<p>You should deducting type of <code>twice</code> starting with it's parameters.</p>\n\n<p>Start with <code>x</code>, it has type <code>x :: _</code>, but we have no idea what it is, lets call it's type <code>a</code>: <code>x :: a</code>.</p>\n\n<p>Then we have <code>f</code>, it's a function, from <code>f x</code> we can tell it accepts one argument of type <code>a</code>: <code>f :: a -&gt; _</code>, let's call new unknown type <code>b</code>: <code>f :: a -&gt; b</code>. </p>\n\n<p>So <code>f x</code> should be of type <code>b</code>: <code>(f x) :: b</code> right? </p>\n\n<p>But from <code>f (f x)</code> we can tell that <code>(f x)</code> should be <code>a</code>, so we can guess that <code>a</code> and <code>b</code> are actually the same type, so we can drop <code>b</code> and tell that <code>f :: a -&gt; a</code>.</p>\n\n<p>And now we can tell what type <code>twice</code> is: it's a function that takes <code>a -&gt; a</code> function and value of type <code>a</code> and returns result of the first argument function (so <code>a</code> again).</p>\n\n<p>So we have <code>twice :: (a -&gt; a) -&gt; a -&gt; a</code>.</p>\n"}], "owner": {"reputation": 45, "user_id": 7805635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7791678b293f12e2a0bf696b163e19f7?s=128&d=identicon&r=PG&f=1", "display_name": "ahmedES", "link": "https://stackoverflow.com/users/7805635/ahmedes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 803, "favorite_count": 0, "accepted_answer_id": 54257316, "answer_count": 1, "score": -3, "last_activity_date": 1547827899, "creation_date": 1547825409, "last_edit_date": 1547827899, "question_id": 54256998, "link": "https://stackoverflow.com/questions/54256998/what-is-the-type-of-this-function-definition-twice-f-x-f-f-x", "title": "What is the type of this function definition &quot;twice f x = f (f x)&quot;", "body": "<p>This is an excerice question from a book I'm reading now, so what is the type of this definition:</p>\n\n<pre><code>twice f x = f (f x)\n</code></pre>\n\n<p>I understand how the function should work, but I could not figure out the \nright syntax for it,<br>\nIt takes two arguments, the first is a function and the second is a basic type I think and apply the function twice, one for x and one for the return of (f x) , this is what is was trying to do but obviously it's a wrong syntax</p>\n\n<p><code>twice :: (f -&gt; a) -&gt; a</code></p>\n\n<p>Can you help me find the type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1547827773, "post_id": 54256851, "comment_id": 95339355, "body": "I think it&#39;s saying that the type signature <code>Bool -&gt; Poly f</code> has to work for <i>all</i> types <code>f</code>, that is there has to be effectively a different possible output for any type you specify. (A bit like how <code>read</code> can output any type that is an instance of <code>Read</code>.) You are only outputting values of type <code>Poly One</code> or <code>Poly Two</code> - which I think is illegal in any case. (I&#39;m no expert though, perhaps it is possible to do this with some language extension.) Also the <code>Foo f</code> constraint in the data declaration is wrong I believe, that constraint should only be on the functions that require it."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1547829966, "post_id": 54256851, "comment_id": 95340472, "body": "Put the constraints where they belong - on the functions that actually use them. It pays off in the long term."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1547843491, "creation_date": 1547843491, "answer_id": 54261036, "question_id": 54256851, "link": "https://stackoverflow.com/questions/54256851/polymorphic-adt-with-type-class-constrained-constructor/54261036#54261036", "title": "Polymorphic ADT with type-class constrained Constructor", "body": "<p>It looks like you are slightly mixed up about existentials.  What you have written</p>\n\n<pre><code>data Poly f = (Foo f) =&gt; Poly { member :: f }\n</code></pre>\n\n<p>defines a family of types, e.g. one type <code>Poly One</code>, a <em>different type</em> <code>Poly Two</code>, etc.  When a <code>Poly</code> is constructed, its <code>Foo</code>-ness is checked.</p>\n\n<p>The problem with</p>\n\n<pre><code>makePoly :: Bool -&gt; Poly f\n</code></pre>\n\n<p>is that the <em>caller</em> gets to choose <code>f</code>.  So </p>\n\n<pre><code>makePoly True :: Poly One\nmakePoly True :: Poly Two\nmakePoly True :: Poly Elephant\n</code></pre>\n\n<p>all have to work, but your function doesn't work this way.   It seems like you almost know what you're doing, since if instead of defining a family of types you defined a <em>single</em> existential type, then this would be fine:</p>\n\n<pre><code>data Poly = forall f. (Foo f) =&gt; Poly { member :: f }\n</code></pre>\n\n<p>Notice that there is no <code>f</code> on the left side of the <code>=</code> sign, so this is a single type, not a family.  Therefore a function claiming to return a <code>Poly</code> can return any <code>Poly</code> it likes.  This definition makes your code work.</p>\n\n<p>Technical note, the <code>member</code> field accessor is completely useless, because the return type depends on what <em>value</em> is passed in </p>\n\n<pre><code>member :: Poly -&gt; ????\n</code></pre>\n\n<p>so it cannot be assigned a type in the Haskell type system (dependent type systems could do it, though).  To use a <code>Poly</code> you <em>must</em> pattern match:</p>\n\n<pre><code>usePoly :: Poly -&gt; Int\nusePoly (Poly x) = whoAmI x -- x :: a  for some *unknown* type a in this scope\n</code></pre>\n\n<p>Another note, <code>Poly</code> is completely equivalent to <code>Int</code>, since if we are given a <code>Poly x</code>, all we know about <code>x</code> is that it is a <code>Foo</code>, and the only thing we can do with a <code>Foo</code> is call <code>whoAmI</code>.  In cases like this I would just <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">skip the existential</a> and use <code>Int</code>.  But there are valid uses of existentials, they are just a lot less common than people expect.</p>\n"}], "owner": {"reputation": 6658, "user_id": 20467, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/45a7163f8d5f19f76f5802a089ab167b?s=128&d=identicon&r=PG", "display_name": "Christoph Schiessl", "link": "https://stackoverflow.com/users/20467/christoph-schiessl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 54261036, "answer_count": 1, "score": 1, "last_activity_date": 1547843491, "creation_date": 1547824883, "question_id": 54256851, "link": "https://stackoverflow.com/questions/54256851/polymorphic-adt-with-type-class-constrained-constructor", "title": "Polymorphic ADT with type-class constrained Constructor", "body": "<p>Why does the following code fail to compile?</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE GADTs #-}\n\nclass Foo x where whoAmI :: x -&gt; Int\n\ndata One = One\ninstance Foo One where\n  whoAmI _ = 1\n\ndata Two = Two\ninstance Foo Two where\n  whoAmI _ = 2\n\ndata Poly f = (Foo f) =&gt; Poly { member :: f }\nmakePoly :: Bool -&gt; Poly f\nmakePoly what =\n  if what == True then Poly { member = One }\n  else Poly { member = Two }\n</code></pre>\n\n<p>Obviously, this is a contrived example. In the end, I want to have a record <code>Poly f</code> and pass that to other functions like <code>g :: Poly f -&gt; Int</code>, where <code>g</code> can only interact with it's argument by using the functions given by the class <code>Foo</code>.</p>\n\n<p>This is the GHC v8.6.3 compile error:</p>\n\n<pre><code>Couldn't match expected type \u2018f\u2019 with actual type \u2018One\u2019\n\u2018f\u2019 is a rigid type variable bound by\n  the type signature for:\n    makePoly :: forall f. Bool -&gt; Poly f\n</code></pre>\n\n<p>Is it at all possible to do something like that? Which extensions (if any) are needed to make it compile?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1547835322, "post_id": 54253762, "comment_id": 95342904, "body": "I think &quot;how would I go about proving this&quot; is a pretty different question -- and one that seems like it would be roughly welcome here on SO. Feel free to open a separate question. You might like to have a Google for &quot;equational reasoning&quot; (or perhaps &quot;equational reasoning Haskell&quot;) first to see if reading a bit about that gives you enough hints to make progress yourself."}, {"owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548060590, "post_id": 54253762, "comment_id": 95393464, "body": "@Daniel I have asked the <a href=\"https://stackoverflow.com/questions/54260109/how-could-i-prove-this-type-level-haskell-theorem\">follow-on question</a> suggested."}], "answers": [{"comments": [{"owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "edited": false, "score": 0, "creation_date": 1547831138, "post_id": 54253905, "comment_id": 95341034, "body": "Thanks. Does the compilation prove anything at type level?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "edited": false, "score": 1, "creation_date": 1547835140, "post_id": 54253905, "comment_id": 95342827, "body": "@PatrickBrowne Sure, lots of things! For example, you prove that <code>getUI</code> will never be passed an <code>Int</code>; you prove that, in the particular instance you wrote, the <code>a</code> will never be a <code>String</code> (this and the last are just &quot;type correctness&quot; theorems); if you wrote an <code>instance Category F a</code> for some specific type <code>F</code> but unconstrained type <code>a</code> you would prove roughly <code>t . getUI = getUI . fmap t</code> (as a free theorem)."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 6, "last_activity_date": 1547823406, "last_edit_date": 1547823406, "creation_date": 1547813957, "answer_id": 54253905, "question_id": 54253762, "link": "https://stackoverflow.com/questions/54253762/does-this-haskell-program-provide-an-example-of-theorems-for-free/54253905#54253905", "title": "Does this Haskell program provide an example of &quot;Theorems for free!&quot;?", "body": "<p>No, the fact that it's a class gives you far too much leeway for the type alone to guarantee that axiom. For example, the following alternate instance typechecks but violates your axiom:</p>\n\n<pre><code>instance Category Continuant Int where\n    getUI _ = 42\n</code></pre>\n\n<p>(Being completely explicit, our adversary could choose for example <code>t=Continuant</code> and <code>a=6*9</code> to violate the axiom.) This abuses the fact that the class instantiator gets to choose the contained type. We can remove that ability by removing that argument to the class:</p>\n\n<pre><code>class Category t where\n    getUI :: UI a =&gt; t a -&gt; a\n</code></pre>\n\n<p>Alas, even this is not enough. We can write</p>\n\n<pre><code>data Pair a = Pair a a\n</code></pre>\n\n<p>and then the free theorem tells us that for <code>instance Category Pair</code>, we must write one of the following two definitions:</p>\n\n<pre><code>getUI (Pair x y) = x\n-- OR\ngetUI (Pair x y) = y\n</code></pre>\n\n<p>Whichever we choose, our adversary can choose a <code>t</code> which shows us that our axiom is wrong.</p>\n\n<pre><code>Our choice                 Adversary's choice\ngetUI (Pair x y) = x       t y = Pair 42 y; a = 6*9\ngetUI (Pair x y) = y       t x = Pair x 42; a = 6*9\n</code></pre>\n\n<p>Okay, this abuses the fact that the class instantiator gets to choose <code>t</code>. What if we removed that ability...?</p>\n\n<pre><code>class Category where\n    getUI :: UI a =&gt; t a -&gt; a\n</code></pre>\n\n<p>This restricts the instantiator of <code>Category</code> quite a lot. Too much, in fact: <code>getUI</code> can't be implemented except as an infinite loop or the like.</p>\n\n<p>I suspect it will be very difficult to encode the axiom you wish for as a type which can only be inhabited by things that satisfy it.</p>\n"}], "owner": {"reputation": 203, "user_id": 9952780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a2469a9716383b916f6db1205853858?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Browne", "link": "https://stackoverflow.com/users/9952780/patrick-browne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1547887628, "creation_date": 1547813395, "last_edit_date": 1547887628, "question_id": 54253762, "link": "https://stackoverflow.com/questions/54253762/does-this-haskell-program-provide-an-example-of-theorems-for-free", "title": "Does this Haskell program provide an example of &quot;Theorems for free!&quot;?", "body": "<p>With respect <strong>Listing 1</strong>, it is required that the type level axiom </p>\n\n<pre><code>(t a) = (t (getUI(t a)))\n</code></pre>\n\n<p>should  derivable as a theorem for every specific type class instance.</p>\n\n<p>Does the compilation of the <code>test</code> function prove the type level axiom holds for the particular types in the program? Does the compilation provide an example of <a href=\"https://people.mpi-sws.org/~dreyer/tor/papers/wadler.pdf\" rel=\"nofollow noreferrer\">Theorems for free!</a>?</p>\n\n<p><strong>Listing 1</strong></p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\ndata Continuant a = Continuant a  deriving (Show,Eq)\n\nclass UI a where\n\ninstance UI Int where\n\nclass Category t a where\n   getUI :: (UI a) =&gt; (t a) -&gt; a\n\n instance Category Continuant Int where\n    getUI (Continuant a) = a\n\n -- axiom (t a) = (t (getUI(t a))) holds for given types?\n test :: Int -&gt; Bool\n test x =  (Continuant x) == (Continuant (getUI (Continuant x)))\n</code></pre>\n\n<p><strong>Additional Context</strong></p>\n\n<p>The code is based on a <a href=\"https://www.researchgate.net/publication/305430663_Ontologies_of_Dynamical_Systems_and_Verifiable_Ontology-Based_Computation_Towards_a_Haskell-Based_Implementation_of_Referent_Tracking\" rel=\"nofollow noreferrer\">paper</a> where it is stated:</p>\n\n<blockquote>\n  <p>For all implementations of getUI one may require that the axiom  (t a)\n  = (t (getUI (t a))) holds. This must be proven to hold for every specific type class instance declaration. For finite types this can be\n  done by a program that enumerates all possibilities. For infinite\n  types this must be done manually via proofs by induction.</p>\n</blockquote>\n\n<p><strong>Listing 1</strong> was my attempt at a proof. In the light of Solution 1, perhaps I mistakenly thought this required <a href=\"https://people.mpi-sws.org/~dreyer/tor/papers/wadler.pdf\" rel=\"nofollow noreferrer\">Theorems for free!</a></p>\n"}, {"tags": ["c", "haskell", "cabal"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 3, "creation_date": 1547758784, "post_id": 54243742, "comment_id": 95312917, "body": "Thanks for a well written question with a good <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1547759994, "post_id": 54243742, "comment_id": 95313415, "body": "BTW, I think it should be <code>main-is: AI.hs</code> in the cabal file, not <code>AI.h</code>"}, {"owner": {"reputation": 630, "user_id": 6707737, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/bc7b6d3815e8d4e653eea177739b3558?s=128&d=identicon&r=PG&f=1", "display_name": "Yan.F", "link": "https://stackoverflow.com/users/6707737/yan-f"}, "edited": false, "score": 0, "creation_date": 1547797645, "post_id": 54243742, "comment_id": 95323377, "body": "My bad it is A.hs its a copy paste error, I&#39;ve updated the question"}, {"owner": {"reputation": 345, "user_id": 5509894, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-IeIcWLzjPnc/AAAAAAAAAAI/AAAAAAAABsY/_IaDPQowLJk/photo.jpg?sz=128", "display_name": "Geraint Ballinger", "link": "https://stackoverflow.com/users/5509894/geraint-ballinger"}, "edited": false, "score": 0, "creation_date": 1547926302, "post_id": 54243742, "comment_id": 95364174, "body": "Which compiler are you using to compile the <code>.c</code> file and what arguments are you giving it?"}, {"owner": {"reputation": 630, "user_id": 6707737, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/bc7b6d3815e8d4e653eea177739b3558?s=128&d=identicon&r=PG&f=1", "display_name": "Yan.F", "link": "https://stackoverflow.com/users/6707737/yan-f"}, "reply_to_user": {"reputation": 345, "user_id": 5509894, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-IeIcWLzjPnc/AAAAAAAAAAI/AAAAAAAABsY/_IaDPQowLJk/photo.jpg?sz=128", "display_name": "Geraint Ballinger", "link": "https://stackoverflow.com/users/5509894/geraint-ballinger"}, "edited": false, "score": 0, "creation_date": 1547932694, "post_id": 54243742, "comment_id": 95365758, "body": "@Geraint Ballinger  gcc compiler, flags: <code>sdl2-config --libs --cflags</code> -ggdb3 -O0 --std=c99 -lSDL2_image -lm -Wall"}], "answers": [{"tags": [], "owner": {"reputation": 341, "user_id": 3196456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1X8eo.jpg?s=128&g=1", "display_name": "dontpanic", "link": "https://stackoverflow.com/users/3196456/dontpanic"}, "is_accepted": false, "score": 2, "last_activity_date": 1548061716, "creation_date": 1548061716, "answer_id": 54286532, "question_id": 54243742, "link": "https://stackoverflow.com/questions/54243742/calling-haskell-from-c-with-cabal/54286532#54286532", "title": "Calling Haskell from C with Cabal", "body": "<p><code>HsFFI.h</code> is located in your Haskell installation folder. I'm using Windows and it is at <code>C:\\Program Files\\Haskell Platform\\8.4.3\\lib\\include</code>.</p>\n\n<p>Also, when you build your Haskell module, a <code>.a</code> file should be generated. On my machine it is called <code>HSdll.dll.a</code>. (I have to rename it to <code>HSdll.a</code> in order to satisfy gcc, but I think it should be a Windows-specific issue.)</p>\n\n<p>Then the following command will work:</p>\n\n<p><code>gcc -I\"C:\\Program Files\\Haskell Platform\\8.4.3\\lib\\include\" -L. -lHSdll main.c</code></p>\n\n<p>Note: change the <code>-I</code> to your haskell include folder and <code>-L.</code> to the place where the <code>.a</code> file is.</p>\n"}, {"comments": [{"owner": {"reputation": 345, "user_id": 5509894, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-IeIcWLzjPnc/AAAAAAAAAAI/AAAAAAAABsY/_IaDPQowLJk/photo.jpg?sz=128", "display_name": "Geraint Ballinger", "link": "https://stackoverflow.com/users/5509894/geraint-ballinger"}, "edited": false, "score": 0, "creation_date": 1548615212, "post_id": 54317164, "comment_id": 95595253, "body": "Is there a reason why you instructed GHC to compile the Haskell code into a dynamic shared library in your original question but not in this answer?"}, {"owner": {"reputation": 630, "user_id": 6707737, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/bc7b6d3815e8d4e653eea177739b3558?s=128&d=identicon&r=PG&f=1", "display_name": "Yan.F", "link": "https://stackoverflow.com/users/6707737/yan-f"}, "reply_to_user": {"reputation": 345, "user_id": 5509894, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-IeIcWLzjPnc/AAAAAAAAAAI/AAAAAAAABsY/_IaDPQowLJk/photo.jpg?sz=128", "display_name": "Geraint Ballinger", "link": "https://stackoverflow.com/users/5509894/geraint-ballinger"}, "edited": false, "score": 0, "creation_date": 1548624144, "post_id": 54317164, "comment_id": 95597686, "body": "@GeraintBallinger I had trouble using the generated library, maybe I&#39;ll give it another go."}], "tags": [], "owner": {"reputation": 630, "user_id": 6707737, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/bc7b6d3815e8d4e653eea177739b3558?s=128&d=identicon&r=PG&f=1", "display_name": "Yan.F", "link": "https://stackoverflow.com/users/6707737/yan-f"}, "is_accepted": false, "score": 1, "last_activity_date": 1548527674, "last_edit_date": 1548527674, "creation_date": 1548194810, "answer_id": 54317164, "question_id": 54243742, "link": "https://stackoverflow.com/questions/54243742/calling-haskell-from-c-with-cabal/54317164#54317164", "title": "Calling Haskell from C with Cabal", "body": "<p>This has worked for me but I used GHC instead of cabal: </p>\n\n<p>(<a href=\"https://wiki.haskell.org/Calling_Haskell_from_C\" rel=\"nofollow noreferrer\">following this example</a>)</p>\n\n<p><strong>First I compiled my Haskell library:</strong> </p>\n\n<pre><code>ghc -c -O src/haskell/** -outputdir tmp\n</code></pre>\n\n<p><strong>Then I compiled with GHC:</strong></p>\n\n<pre><code>ghc --make `sdl2-config --libs --cflags` -optc-O src/c/*.c src/haskell/*.hs -no-hs-main -outputdir tmp -lSDL2_image -o targetLinux/myExecutable\n</code></pre>\n\n<p><strong>Where:</strong> </p>\n\n<ul>\n<li>src/c Is my c sources directory.</li>\n<li>src/haskell Is my Haskell sources directory.</li>\n<li>tmp Is my object files folder (all of *.o files).</li>\n</ul>\n\n<p>Although I have no clue how to build the entire project including c sources with cabal.</p>\n"}], "owner": {"reputation": 630, "user_id": 6707737, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/bc7b6d3815e8d4e653eea177739b3558?s=128&d=identicon&r=PG&f=1", "display_name": "Yan.F", "link": "https://stackoverflow.com/users/6707737/yan-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 3, "answer_count": 2, "score": 13, "last_activity_date": 1548527674, "creation_date": 1547756591, "last_edit_date": 1548195089, "question_id": 54243742, "link": "https://stackoverflow.com/questions/54243742/calling-haskell-from-c-with-cabal", "title": "Calling Haskell from C with Cabal", "body": "<p>I can't figure out how to build a C SDL application that calling Haskell with Foreign Function Interface, my main is in C, here is my .cabal file:</p>\n\n<pre><code>build-type:          Simple\nextra-source-files:  README.md\ncabal-version:       &gt;=1.10\n\nlibrary\n  exposed-modules:     AI     \n\n  other-extensions:    ForeignFunctionInterface\n  build-depends:       base &gt;=4.9 &amp;&amp; &lt;4.10\n  hs-source-dirs:      src/haskell\n  default-language:    Haskell2010\n  ghc-options:         -O2 -shared -fPIC -dynamic \n  extra-libraries:     HSrts-ghc8.0.2\n</code></pre>\n\n<p>I followed the instructions in this <a href=\"https://idontgetoutmuch.wordpress.com/2017/01/14/calling-haskell-from-c/\" rel=\"nofollow noreferrer\">link</a> with no success(it's for OSX, not Linux).\nI'm getting the Haskell source to build successfully with:</p>\n\n<pre><code>cabal install\n</code></pre>\n\n<p>But I can't figure out how to build the C code in such manner that Haskell will be recognized and imported into C.\nHere is an example of my C and Haskell sources:</p>\n\n<p>main.c:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"game.h\"\n#include &lt;SDL2/SDL.h&gt;\n#include &lt;SDL2/SDL_timer.h&gt;\n#include &lt;SDL2/SDL_image.h&gt;\n#include &lt;SDL2/SDL_error.h&gt;\n#include \"HsFFI.h\" // include path not recognized\n#include \"AI_stub.h\" // new! edited\n\nint main( int argc, char** argv ) {\n    hs_init(&amp;argc, &amp;argv);\n    //HASKELL CALL\n    int i;\n    i = fibonacci_hs(42);\n    printf(\"Fibonacci: %d\\n\", i);\n    //END HASKELL CALL\n    initializeSdl();\n    window = createWindow(SDL_WINDOW_SHOWN | SDL_WINDOW_OPENGL);\n    renderer = createRenderer();\n    printf(\"Pre gameLoop\\n\"); \n    play();\n    return 0;\n}\n</code></pre>\n\n<p>AI.hs: </p>\n\n<pre><code>{-# OPTIONS_GHC -Wall                 #-}\n{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule AI where\n\nimport Foreign.C.Types\n\nfibonacci :: Int -&gt; Int\nfibonacci n = fibs !! n\n    where fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n\nfibonacci_hs :: CInt -&gt; CInt\nfibonacci_hs = fromIntegral . fibonacci . fromIntegral\n\nforeign export ccall fibonacci_hs :: CInt -&gt; CInt\n</code></pre>\n\n<p>P.S: </p>\n\n<ul>\n<li>I am developing in ubuntu 18.04. </li>\n<li>GHC version is 8.0.2.</li>\n<li>Cabal version is 1.24.0.2.</li>\n</ul>\n"}, {"tags": ["haskell", "math", "runtime", "big-o", "induction"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1547753581, "creation_date": 1547753581, "answer_id": 54243051, "question_id": 54242680, "link": "https://stackoverflow.com/questions/54242680/proof-exponential-runtime-by-induction/54243051#54243051", "title": "Proof exponential runtime by induction", "body": "<p>Let's try to prove a tighter bound, like</p>\n\n<pre><code>t(n) &lt;= c*2^n - k        (*)\n</code></pre>\n\n<p>for some constants <code>c</code> and <code>k</code>.</p>\n\n<p>Assuming (*) holds by induction hypothesis, we get</p>\n\n<pre><code>t(n+1) \n= { recursive definition }\n2*t(n) + 4\n&lt;= { induction hypothesis }\n2*(c*2^n - k) + 4\n&lt;= { math }\nc*2^(n+1) - 2k + 4\n&lt;= { ???? }\nc*2^(n+1) - k\n</code></pre>\n\n<p>Now, we only need to choose <code>k</code> so that we can actually justify the last step, but that's easy.</p>\n\n<p>Note that we also need to check the base case <code>t(0)</code>, and choose <code>c</code>.</p>\n\n<p>I'll leave the rest to you.</p>\n"}, {"tags": [], "owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "is_accepted": false, "score": 1, "last_activity_date": 1547756049, "creation_date": 1547756049, "answer_id": 54243611, "question_id": 54242680, "link": "https://stackoverflow.com/questions/54242680/proof-exponential-runtime-by-induction/54243611#54243611", "title": "Proof exponential runtime by induction", "body": "<p>Let's prove a bit more general claim. If algorithm complexity is such that:</p>\n\n<pre><code> t(0) = c\n t(n) = a*t(n-1) + b \n</code></pre>\n\n<p>assuming <code>a&gt;1</code> the algorithm's complexity is <code>O(a^n)</code>. </p>\n\n<p>Let's choose <code>k1 = c</code>, <code>d = b/(a-1)</code> (this choice of <code>d</code> will become clear at the end), and <code>k2 = a + d</code>.  Let's assume that <code>a &gt; c</code> (otherwise it would have been <code>k1 = min(a,c)</code>, <code>d= b/(max(a,c)-1)</code>, and <code>k2 = max(a,c) + d</code> but I'm too lazy to write all those <code>max</code> and <code>min</code>). We want to prove that</p>\n\n<pre><code>k1*a^n &lt;= t(n) &lt;= k2*a^n\n</code></pre>\n\n<p>but here is a twist, let's prove a bit stricter upper bound:</p>\n\n<pre><code>k1*a^n &lt;= t(n) &lt;= k2*a^n - d\n</code></pre>\n\n<p><strong>Base case</strong>:</p>\n\n<pre><code>c &lt;= c &lt;= (a + d) - d\n</code></pre>\n\n<p>is obviously true</p>\n\n<p><strong>Induction step</strong>:</p>\n\n<p>We know that </p>\n\n<pre><code>k1*a^n &lt;= t(n) &lt;= k2*a^n - d\n</code></pre>\n\n<p>is true and want to prove that</p>\n\n<pre><code>k1*a^(n+1) &lt;= t(n+1) &lt;= k2*a^(n+1) - d\n</code></pre>\n\n<p>The left side is easy:</p>\n\n<pre><code>t(n+1) = a*t(n) + b &gt;= a*t(n) &gt;= a*(k1*a^n) = k1*a^(n+1)\n</code></pre>\n\n<p>The right side is a bit more complicated</p>\n\n<pre><code>t(n+1) = a*t(n) + b &lt;= a*(k2*a^n - d) + b = a*k2*a^n - a*b/(a-1) + b = k2*a^(n+1) - b/(a-1) =  k2*a^(n+1) - d\n</code></pre>\n\n<p>The last step is true because</p>\n\n<pre><code>a*b/(a-1) - b = b*(a/(a-1) - 1) = b*(a - (a-1))/(a-1) = b/(a-1)\n</code></pre>\n\n<p>in other words</p>\n\n<pre><code>a*d - b = d\n</code></pre>\n"}], "owner": {"reputation": 472, "user_id": 7414754, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0d8a029a39a846a27ec35008ddf4cdad?s=128&d=identicon&r=PG&f=1", "display_name": "nicksheen", "link": "https://stackoverflow.com/users/7414754/nicksheen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 54243051, "answer_count": 2, "score": 4, "last_activity_date": 1547756049, "creation_date": 1547752014, "question_id": 54242680, "link": "https://stackoverflow.com/questions/54242680/proof-exponential-runtime-by-induction", "title": "Proof exponential runtime by induction", "body": "<p>I have a problem showing with induction that the given function</p>\n\n<pre><code>foo :: [Int] -&gt; Int\nfoo    []  = 0\nfoo (x:xs) = max (max x (foo xs)) (max (-x) (foo xs))\n</code></pre>\n\n<p>which returns the max absolute value of a given list of <code>Int</code>'s , has a runtime of <code>O(2^n)</code>.</p>\n\n<p>I got so far by now:</p>\n\n<p><code>t(0) = 1</code> and <code>t(n&gt;1)= 2 * t(n-1) + 4</code> where <code>t</code> shows the sum of calls of <code>foo</code> and <code>max</code> for a list of <code>n</code> elements.</p>\n\n<pre><code>Base Case:            n = 0 =&gt; t(0) = 1 &lt;= c * 2^0, for c &gt;= 1\nInduction Hypothesis: t(n) &lt;= c * 2^n\nInduction Step:       n -&gt; n+1\n                   =&gt; t(n+1) &lt;= c * 2^{n+1}\n                  &lt;=&gt; 2 * t(n) + 4 &lt;= c * 2^{n+1} | Induction Hypothesis\n                  &lt;=&gt; 2 * c * 2^n + 4 &lt;= c * 2^{n+1}\n                  &lt;=&gt; c * 2^{n+1} + 4 &lt;= c * 2^{n+1}\n</code></pre>\n\n<p>which is obviously wrong and I don't know how to fix that issue.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "haskell-vector"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1547744038, "post_id": 54240591, "comment_id": 95305881, "body": "Maybe the compiler can optimise this away?"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1547749511, "post_id": 54240591, "comment_id": 95308569, "body": "Sorry, thought I had searched for this late the other night when I was wondering about it - but apparently didn&#39;t search well enough! This will take some time to digest but I&#39;m confident it answers my question. If not, I&#39;ll ask a more specific question."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1547761463, "post_id": 54240591, "comment_id": 95313980, "body": "no need to apologize, I only knew of the other question because I had answered.  It&#39;s a great question."}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "closed_date": 1547749523, "answer_count": 0, "score": 7, "last_activity_date": 1547743555, "creation_date": 1547743555, "question_id": 54240591, "link": "https://stackoverflow.com/questions/54240591/can-data-vectors-modify-ever-really-be-done-in-place", "closed_reason": "Duplicate", "title": "Can Data.Vector&#39;s modify ever really be done in place?", "body": "<p>In the source for <code>modify</code> it <a href=\"http://hackage.haskell.org/package/vector-0.12.0.2/docs/src/Data.Vector.Generic.html#modify\" rel=\"noreferrer\">is stated</a> that the operation will be performed in place if it is safe to do so and will modify a copy of the vector otherwise.</p>\n\n<p>But looking at the code for <code>modify</code>: </p>\n\n<pre><code>modify :: Vector v a =&gt; (forall s. Mutable v s a -&gt; ST s ()) -&gt; v a -&gt; v a\nmodify p = new . New.modify p . clone\n</code></pre>\n\n<p>It looks to me that <code>clone</code> is always called (which makes sense to me, as I would think it would have to be for a destructive operation on an immutable vector).</p>\n\n<p>Am I misunderstanding this? If not, what is an example of where <code>clone</code> is not called, and how does <code>Data.Vector</code> accomplish the bypass?</p>\n"}, {"tags": ["haskell", "dependent-type", "gadt"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1547731314, "creation_date": 1547731314, "answer_id": 54236875, "question_id": 54236704, "link": "https://stackoverflow.com/questions/54236704/access-gadt-contstraint-from-evaluation-level/54236875#54236875", "title": "Access GADT contstraint from evaluation level", "body": "<p>In Haskell this is impossible, since types are erased at runtime. That is, when the program will run, there is no information in memory about the value of the index <code>let</code> in the type.</p>\n\n<p>To overcome this issue, we need to force Haskell to keep in memory that value, at runtime. This is usually done using a <em>singleton</em> auxiliary type:</p>\n\n<pre><code>data Num = Zero | Succ Num\n\ndata SNum (n :: Num) where\n   SZero :: SNum 'Zero\n   SSucc :: SNum n -&gt; SNum ('Succ n)\n\ndata Something (len :: Num) where\n  Some :: SNum len -&gt; Something len\n</code></pre>\n\n<p>Using this you can easily write</p>\n\n<pre><code>sToNum :: SNum n -&gt; Num\nsToNum SZero = Zero\nsToNum (SSucc n) = Succ (sToNum n)\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>toNum :: Something len -&gt; Num\ntoNum (Some n) = sToNum n\n</code></pre>\n\n<p>If you look up \"haskell singletons\" you should find several examples. There's even a <code>singletons</code> library to partially automatize this.</p>\n\n<p>If / when \"dependent Haskell\" will be released, we will have less cumbersome tools at our disposal. Currently, singletons work, but they are a hassle sometimes. Still, for the moment, we have to use them.</p>\n"}], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 54236875, "answer_count": 1, "score": 2, "last_activity_date": 1547731314, "creation_date": 1547730620, "question_id": 54236704, "link": "https://stackoverflow.com/questions/54236704/access-gadt-contstraint-from-evaluation-level", "title": "Access GADT contstraint from evaluation level", "body": "<p>I am trying to make use of some of GADT parameter from runtime, assuming that I have used <code>DataKinds</code> extension to allow promoting data to types. i.e. having</p>\n\n<pre><code>data Num = Zero | Succ Num\ndata Something (len :: Num) where\n  Some :: Something len\n</code></pre>\n\n<p>I would like to have function</p>\n\n<pre><code>toNum :: Something len -&gt; Num\n</code></pre>\n\n<p>That for any <code>Some :: Something n</code> will return <code>n</code>:</p>\n\n<pre><code>toNum (s :: Something n) = n\n</code></pre>\n\n<p>Which is invalid in Haskell. Is it possible to do so?</p>\n"}, {"tags": ["haskell", "dependent-type"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1547744195, "post_id": 54236422, "comment_id": 95305981, "body": "Have you proved commutativity and associativity? This is a consequence of those properties."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1547751309, "post_id": 54236422, "comment_id": 95309392, "body": "@AJFarmar this is usually a lemma along the path to proving commutativity... so..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1547757919, "post_id": 54236422, "comment_id": 95312535, "body": "What is <code>Bounded&#39;</code> for? That looks rather peculiar."}], "answers": [{"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 10, "last_activity_date": 1547824134, "last_edit_date": 1547824134, "creation_date": 1547752941, "answer_id": 54242900, "question_id": 54236422, "link": "https://stackoverflow.com/questions/54236422/proving-m-1-n-1-m-n-in-dependent-haskell/54242900#54242900", "title": "Proving m + (1 + n) == 1+ (m + n) in Dependent Haskell", "body": "<p>Your definition of addition is not the conventional one.</p>\n\n<pre><code>type family Add (m :: Nat) (n :: Nat) :: Nat where\n  Add Zero n = n\n  Add (Succ m) n = Add m (Succ n)\n</code></pre>\n\n<p>This is a \"tail recursive\" addition.  It sure seems like there should be a way to prove your properties using this form of addition, but I can't figure it out.  Until then, tail recursion at the type/property level tends to be a lot more difficult to work with than the standard kind:</p>\n\n<pre><code>type family Add (m :: Nat) (n :: Nat) :: Nat where\n  Add Zero n = n\n  Add (Succ m) n = Succ (Add m n)\n</code></pre>\n\n<p>This latter definition of addition makes your <code>sum'</code> pass without any convincing at all.</p>\n\n<hr>\n\n<p><strong>EDIT</strong> actually it was easy once I saw it right.  Here's what I got (importing <code>Data.Type.Equality</code> and enabling <code>LANGUAGE TypeOperators</code>):</p>\n\n<pre><code>propSucc2 :: SNat m -&gt; SNat n -&gt; Add m (Succ n) :~: Succ (Add m n)\npropSucc2 Zy _ = Refl\npropSucc2 (Suc m) n = propSucc2 m (Suc n)\n</code></pre>\n\n<p>Tail-recursive definition, tail-recursive proof.  Then to use it, you use <code>gcastWith</code>:</p>\n\n<pre><code>sum' (B m) (B n) = ...\n        (Suc x, y) -&gt; gcastWith (propSucc2 x y) \n                                (let B z = sum' (B x) (B y) in Suc z)\n</code></pre>\n\n<p><code>gcastWith</code> just takes a <code>:~:</code> equality and makes it available to the type checker within the scope of its second argument.</p>\n\n<p>By the way, if you define <code>sum'</code> in a parallel structure to your <code>Add</code> type family, then you don't need any lemmas.  Getting things to follow parallel structures is a good technique to keep things easy (this is part of the art of dependent programming, since it's not always obvious how):</p>\n\n<pre><code>sum' :: Bounded' (SNat m) -&gt; Bounded' (SNat n) -&gt; Bounded' (SNat (Add m n))\nsum' (B Zy) (B n) = B n\nsum' (B (Suc m)) (B n) = sum' (B m) (B (Suc n))\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 6665045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/440cdfdd21d225dbc880be6c69545c37?s=128&d=identicon&r=PG&f=1", "display_name": "skilluminati", "link": "https://stackoverflow.com/users/6665045/skilluminati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 1, "accepted_answer_id": 54242900, "answer_count": 1, "score": 6, "last_activity_date": 1547824134, "creation_date": 1547729685, "last_edit_date": 1547738736, "question_id": 54236422, "link": "https://stackoverflow.com/questions/54236422/proving-m-1-n-1-m-n-in-dependent-haskell", "title": "Proving m + (1 + n) == 1+ (m + n) in Dependent Haskell", "body": "<p>I am experimenting with Haskell's type system and want to write a type safe addition function. This function should accept two singleton witnesses representing numbers and returns a singleton witness of a number whose type carries the proof that it is indeed a sum of the arguments. Here is the code:</p>\n\n<pre><code>{-# language TypeFamilies, KindSignatures, DataKinds, PolyKinds, UndecidableInstances, GADTs #-}\n\ndata Nat = Zero | Succ Nat deriving Show\ntype family Add (m :: Nat) (n :: Nat) :: Nat where\n  Add Zero n = n\n  Add (Succ m) n = Add m (Succ n)\n\ndata SNat :: Nat -&gt; * where\n  Zy :: SNat Zero\n  Suc :: SNat m -&gt; SNat (Succ m)\n\ndata Bounded' m = B m\n\nsum' :: Bounded' (SNat m) -&gt; Bounded' (SNat n) -&gt; Bounded' (SNat (Add m n))\nsum' (B m) (B n) = B $ case (m, n) of\n                    (Zy,x) -&gt; x\n                    (Suc x, y) -&gt; let B z = sum' (B x) (B y) in Suc z\n</code></pre>\n\n<p>Here is the error:</p>\n\n<pre><code>    \u2022 Could not deduce: Add m1 ('Succ n) ~ 'Succ (Add m1 n)\n      from the context: m ~ 'Succ m1\n      bound by a pattern with constructor:\n               Suc :: forall (m :: Nat). SNat m -&gt; SNat ('Succ m),\n               in a case alternative\n      at main.hs:17:22-26\n      Expected type: SNat (Add m n)\n      Actual type:   SNat ('Succ (Add m1 n))\n    \u2022 In the expression: Suc z\n      In the expression: let B z = sum' (B x) (B y) in Suc z\n      In a case alternative:\n        (Suc x, y) -&gt; let B z = sum' (B x) (B y) in Suc z\n</code></pre>\n\n<p>I understand the error message. How do I provide GHC with the necessary proof that Add m n = Succ (Add k n) in expression <code>Suc z</code> when it learns that m ~ Succ k (in second case match) and are there alternative approaches to doing so. Thank you.</p>\n"}, {"tags": ["haskell", "aeson"], "comments": [{"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "edited": false, "score": 1, "creation_date": 1547721100, "post_id": 54233506, "comment_id": 95292596, "body": "Could you please provide an example of what you precisely need?. As far as I know you can derive Aeson&#39;s type classes using <code>Generics</code>, so you don&#39;t need to write the instance"}], "answers": [{"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 3, "last_activity_date": 1547722794, "last_edit_date": 1547722794, "creation_date": 1547721349, "answer_id": 54234005, "question_id": 54233506, "link": "https://stackoverflow.com/questions/54233506/read-single-field-of-object-using-aeson-without-writing-a-fromjson-instance/54234005#54234005", "title": "Read single field of object using Aeson without writing a FromJSON instance", "body": "<p>You can use <code>decode</code> to read a JSON <code>ByteString</code> as a <code>Maybe Value</code>, since <code>Value</code> already has a <code>FromJSON</code> instance:</p>\n\n<pre><code>*Q54233506 Q54233506&gt; :set -XOverloadedStrings\n*Q54233506 Q54233506&gt; decode \"{ \\\"foo\\\": \\\"bar\\\", \\\"baz\\\": 42 }\" :: Maybe Value\nJust (Object (fromList [(\"foo\",String \"bar\"),(\"baz\",Number 42.0)]))\n</code></pre>\n\n<p>From there, you can use one of the techniques described in <a href=\"https://stackoverflow.com/a/53969550/126014\">this other answer</a> to extract data from the <code>Value</code>.</p>\n\n<p>For example, you can use the lenses from <a href=\"http://hackage.haskell.org/package/lens-aeson\" rel=\"nofollow noreferrer\">lens-aeson</a> to extract the <code>foo</code> and <code>baz</code> values:</p>\n\n<pre><code>*Q54233506 Q54233506&gt; :set -XOverloadedStrings\n*Q54233506 Q54233506&gt; v = decode \"{ \\\"foo\\\": \\\"bar\\\", \\\"baz\\\": 42 }\" :: Maybe Value\n*Q54233506 Q54233506&gt; v &gt;&gt;= (^? key \"foo\")\nJust (String \"bar\")\n*Q54233506 Q54233506&gt; v &gt;&gt;= (^? key \"baz\")\nJust (Number 42.0)\n</code></pre>\n\n<p>You can further compose this with <code>_String</code> or <code>_Number</code> to extract text or numbers:</p>\n\n<pre><code>*Q54233506 Q54233506&gt; v &gt;&gt;= (^? key \"foo\") &gt;&gt;= (^? _String)\nJust \"bar\"\n*Q54233506 Q54233506&gt; v &gt;&gt;= (^? key \"baz\") &gt;&gt;= (^? _Number)\nJust 42.0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 344, "user_id": 3626747, "user_type": "registered", "profile_image": "https://graph.facebook.com/100004670593545/picture?type=large", "display_name": "robert_peszek", "link": "https://stackoverflow.com/users/3626747/robert-peszek"}, "is_accepted": false, "score": 0, "last_activity_date": 1616030599, "creation_date": 1616030599, "answer_id": 66683501, "question_id": 54233506, "link": "https://stackoverflow.com/questions/54233506/read-single-field-of-object-using-aeson-without-writing-a-fromjson-instance/66683501#66683501", "title": "Read single field of object using Aeson without writing a FromJSON instance", "body": "<p><a href=\"https://hackage.haskell.org/package/aeson-combinators\" rel=\"nofollow noreferrer\">aeson-combinators</a>\npackage contains combinators that allow decoding/encoding JSON without the need for FromJSON / ToJSON instances.</p>\n<p>This can be very convenient in general, for example, when decoding depends on other information such as HTTP header values.</p>\n<p>In your case, you can use <code>key :: Text -&gt; Decoder a -&gt; Decoder a</code> <a href=\"https://hackage.haskell.org/package/aeson-combinators-0.0.5.0/docs/Data-Aeson-Combinators-Decode.html#g:9\" rel=\"nofollow noreferrer\">combinator</a> to\nget value of given key.</p>\n<p>Check it out!</p>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "accepted_answer_id": 54234005, "answer_count": 2, "score": 1, "last_activity_date": 1616030599, "creation_date": 1547719795, "last_edit_date": 1547722844, "question_id": 54233506, "link": "https://stackoverflow.com/questions/54233506/read-single-field-of-object-using-aeson-without-writing-a-fromjson-instance", "title": "Read single field of object using Aeson without writing a FromJSON instance", "body": "<p>How do I read a single field (by name) from a JSON object using Aeson, without writing any type class instance?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1547717626, "post_id": 54232450, "comment_id": 95290496, "body": "I&#39;m not sure why your <code>delete</code> returns <code>Maybe [a]</code>. You probably should at least make type aliases for your types so that it&#39;s more clear what they represent"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1547719790, "post_id": 54232450, "comment_id": 95291763, "body": "What exactly is the question? If it&#39;s that you want the &quot;edit&quot; function written for you - that&#39;s not how SO works, but if you share your attempts and explain how they&#39;re not working, we will help. Also it looks like you&#39;ve cut off your script at the bottom."}], "answers": [{"tags": [], "owner": {"reputation": 2350, "user_id": 10033674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bbU6P.jpg?s=128&g=1", "display_name": "Karol Samborski", "link": "https://stackoverflow.com/users/10033674/karol-samborski"}, "is_accepted": true, "score": 2, "last_activity_date": 1547722931, "creation_date": 1547722931, "answer_id": 54234487, "question_id": 54232450, "link": "https://stackoverflow.com/questions/54232450/changing-variable-values-from-a-list-in-haskell/54234487#54234487", "title": "Changing variable values from a list in Haskell", "body": "<p>All what your <code>edit</code> function needs to do is take another argument that will change the edited item:</p>\n\n<pre><code>edit :: Int -&gt; (a -&gt; a) -&gt; [a] -&gt; Maybe [a]\nedit 0 f (a:as) = Just (f a : as)\nedit n (a:as) = do\n    let x = n - 1\n    y &lt;- x `seq` edit x f as\n    return (a:y)\nedit _ [] = Nothing\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 9519509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XK8Jq.jpg?s=128&g=1", "display_name": "WebDeveloper", "link": "https://stackoverflow.com/users/9519509/webdeveloper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "closed_date": 1547746769, "accepted_answer_id": 54234487, "answer_count": 1, "score": -1, "last_activity_date": 1547722931, "creation_date": 1547716363, "question_id": 54232450, "link": "https://stackoverflow.com/questions/54232450/changing-variable-values-from-a-list-in-haskell", "closed_reason": "Needs more focus", "title": "Changing variable values from a list in Haskell", "body": "<p>I have to make a todo app. Create and delete functions are done but I need to create an edit function, the same with the delete function, taking a variable by number and edit it. I'm a newbie in this field. Thank you. </p>\n\n<pre><code>putTodo :: (Int, String) -&gt; IO ()\nputTodo (n, todo) = putStrLn (show n ++ \": \" ++ todo)\n\nprompt :: [String] -&gt; IO ()\nprompt todos = do\n    putStrLn \"The list has:\"\n    mapM_ putTodo (zip [0..] todos)\n    putStrLn \" \"\n    command &lt;- getLine\n    getCommand command todos\n\ngetCommand :: String -&gt; [String] -&gt; IO ()\ngetCommand ('+':' ':todo) todos = prompt (todo:todos)\ngetCommand ('-':' ':num) todos = \n    case delete (read num) todos of\n        Nothing -&gt; do\n            putStrLn \"That number isn't correct.\"\n            prompt todos\n        Just todos' -&gt; prompt todos'\ngetCommand \"exit\"      todos = return ()\ngetCommand command  todos = do\n    putStrLn (\"Invalid: '\" ++ command ++ \"'\")\n    prompt todos\n\ndelete :: Int -&gt; [a] -&gt; Maybe [a]\ndelete 0 (_:as) = Just as\ndelete n (a:as) = do\n    let x = n - 1\n    y &lt;- x `seq` delete x as\n    return (a:y)\ndelete _ [] = Nothing\n\nmain = do\n</code></pre>\n"}, {"tags": ["haskell", "google-cloud-platform", "haskell-stack", "haskell-snap-framework"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1547714468, "post_id": 54231762, "comment_id": 95288706, "body": "Possibly helpful: <a href=\"https://stackoverflow.com/questions/40050596/cannot-access-google-cloud-compute-instance-external-ip\" title=\"cannot access google cloud compute instance external ip\">stackoverflow.com/questions/40050596/&hellip;</a>  Would be useful to check ports are opened and not blocked by a firewall (iptables etc)."}, {"owner": {"reputation": 401, "user_id": 1985931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cda15456fc1622e0855b351c6f2854de?s=128&d=identicon&r=PG", "display_name": "iluvAS", "link": "https://stackoverflow.com/users/1985931/iluvas"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1547715147, "post_id": 54231762, "comment_id": 95289035, "body": "@ChrisStryczynski I&#39;ve added a firewall rule under the VPC network tab in google cloud for ip range <code>0.0.0.0&#47;0</code> for <code>tcp:8000</code> still to no avail, I&#39;m getting <code>35.240.220.33 took too long to respond</code> on the browser when i go to <code>http:&#47;&#47;35.240.220.33:8000</code> (my external ip). I&#39;ve also enabled http and https traffic."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1547715329, "post_id": 54231762, "comment_id": 95289146, "body": "Please add the output of <code>netstat -tlp</code>"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1547715412, "post_id": 54231762, "comment_id": 95289207, "body": "Hmm <a href=\"http://35.240.220.33:8000/\" rel=\"nofollow noreferrer\">35.240.220.33:8000</a> is working for me though? &quot;Nonogram Solver in Haskell&quot; probably that VPC filter took a minute or two to activate."}, {"owner": {"reputation": 401, "user_id": 1985931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cda15456fc1622e0855b351c6f2854de?s=128&d=identicon&r=PG", "display_name": "iluvAS", "link": "https://stackoverflow.com/users/1985931/iluvas"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1547715670, "post_id": 54231762, "comment_id": 95289354, "body": "Wow! ok so it works on 4g I&#39;m able to access it on my phone, but not on my laptop&#39;s wi-fi connection."}, {"owner": {"reputation": 401, "user_id": 1985931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cda15456fc1622e0855b351c6f2854de?s=128&d=identicon&r=PG", "display_name": "iluvAS", "link": "https://stackoverflow.com/users/1985931/iluvas"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1547716107, "post_id": 54231762, "comment_id": 95289590, "body": "I believe its working now so this question may be closed, you may post the firewall ports as the answer as i think that might be the original issue"}, {"owner": {"reputation": 123, "user_id": 6646144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UU5qw.jpg?s=128&g=1", "display_name": "Cristian Sanchez", "link": "https://stackoverflow.com/users/6646144/cristian-sanchez"}, "edited": false, "score": 0, "creation_date": 1548162369, "post_id": 54231762, "comment_id": 95437426, "body": "@iluvAS can you add the firewall rules comment as and answer? so we can upvote it and accepted and close this as needed."}], "answers": [{"tags": [], "owner": {"reputation": 401, "user_id": 1985931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cda15456fc1622e0855b351c6f2854de?s=128&d=identicon&r=PG", "display_name": "iluvAS", "link": "https://stackoverflow.com/users/1985931/iluvas"}, "is_accepted": true, "score": 1, "last_activity_date": 1548173602, "creation_date": 1548173602, "answer_id": 54312281, "question_id": 54231762, "link": "https://stackoverflow.com/questions/54231762/unable-to-connect-externally-to-snap-application-running-on-google-cloud/54312281#54312281", "title": "Unable to connect externally to Snap application running on google cloud", "body": "<p>Adding a firewall rule under the VPC network tab in google cloud for ip range <code>0.0.0.0/0</code> for <code>tcp:8000</code> seems to solve the issue.</p>\n"}], "owner": {"reputation": 401, "user_id": 1985931, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cda15456fc1622e0855b351c6f2854de?s=128&d=identicon&r=PG", "display_name": "iluvAS", "link": "https://stackoverflow.com/users/1985931/iluvas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 1, "accepted_answer_id": 54312281, "answer_count": 1, "score": 0, "last_activity_date": 1548173602, "creation_date": 1547713743, "last_edit_date": 1547714537, "question_id": 54231762, "link": "https://stackoverflow.com/questions/54231762/unable-to-connect-externally-to-snap-application-running-on-google-cloud", "title": "Unable to connect externally to Snap application running on google cloud", "body": "<p>I'm trying to run my <a href=\"https://github.com/AHaliq/nonosolver\" rel=\"nofollow noreferrer\">project</a> on google cloud. The server is run with <code>quickHttpServe</code> which runs on <code>http://0.0.0.0:8000</code>. I've ssh'ed into my cloud instance, cloned my repo, install stack, built the project, and able to run it on the cloud instance.</p>\n\n<p>It works fine on my local machine and am able to receive html file from the server on <code>http://localhost:8000</code> but not on <code>http://&lt;my cloud instance external ip&gt;:8000</code>.</p>\n\n<p>I'd like to be able to go to <code>http://&lt;my cloud instance external ip&gt;:8000</code> and be served a html page as how it works when i run it locally on my machine.</p>\n"}, {"tags": ["haskell", "ftp"], "owner": {"reputation": 305, "user_id": 10766820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cac5bb90a520b8dc234f299108b36a17?s=128&d=identicon&r=PG&f=1", "display_name": "JoeChoi", "link": "https://stackoverflow.com/users/10766820/joechoi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547710336, "creation_date": 1547710336, "question_id": 54230992, "link": "https://stackoverflow.com/questions/54230992/network-ftp-access-violation-with-ntdll-dll-in-windows", "title": "Network FTP access violation with ntdll.dll in windows", "body": "<p>I try to test ftp client of <a href=\"http://hackage.haskell.org/package/ftphs-1.0.9.2/docs/Network-FTP-Client.html\" rel=\"nofollow noreferrer\">ftphs</a> package in windows 7. The test just copy the example from the API document of above link:</p>\n\n<pre><code>-- FtpTest.hs\nimport Network.FTP.Client\n\nmain = do h &lt;- easyConnectFTP \"ftp.astron.com\"\n          loginAnon h\n          cwd h \"/pub/file\"\n          nlst h Nothing &gt;&gt;= putStrLn . unlines\n</code></pre>\n\n<p>and run</p>\n\n<pre><code>runhaskell FtpTest.hs\n</code></pre>\n\n<p>Access violation occurred:</p>\n\n<pre><code>Access violation in generated code when reading 0xffffffffffffffff\n\n Attempting to reconstruct a stack trace...\n\n   Frame        Code address\n * 0x6a7dad8    0x10f38973 C:\\Users\\user\\AppData\\Roaming\\cabal\\x86_64-windows-ghc\n-8.4.2\\regex-posix-0.95.2-JzP20x6SHdt1UVPk1SIrSH\\HSregex-posix-0.95.2-JzP20x6SHd\nt1UVPk1SIrSH.o+0x2881b\n                 (regexec+0x1435)\n * 0x6a7dae0    0x10\n * 0x6a7dae8    0x10\n * 0x6a7daf0    0x41a0298\n * 0x6a7dc00    0x776c7974 C:\\Windows\\SYSTEM32\\ntdll.dll+0x27974\n * 0x6a7dc08    0xe120e20\n * 0x6a7dc10    0xf91e1f0\n * 0x6a7dc18    0x1\n * 0x6a7dc20    0x1\n * 0x6a7dc28    0x22\n * 0x6a7dc30    0x776f7584 C:\\Windows\\SYSTEM32\\ntdll.dll+0x57584\n ...\n</code></pre>\n\n<p>Do anyone kwon how to solve it?</p>\n"}]