[{"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 7, "creation_date": 1481755242, "post_id": 41153454, "comment_id": 69508880, "body": "Yes. Off the top of my head, the <a href=\"https://hackage.haskell.org/package/Earley-0.11.0.1/docs/Text-Earley.html#v:fullParses\" rel=\"nofollow noreferrer\"><code>fullParses</code> function from the Earley package</a> is an example of this."}, {"owner": {"reputation": 2354, "user_id": 2730024, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f388ccdbbf7e31ac1b5399d99feed97e?s=128&d=identicon&r=PG&f=1", "display_name": "mba12", "link": "https://stackoverflow.com/users/2730024/mba12"}, "edited": false, "score": 2, "creation_date": 1481755317, "post_id": 41153454, "comment_id": 69508917, "body": "Similar answer found here: <a href=\"http://stackoverflow.com/questions/35630746/can-we-define-a-non-context-free-grammar-with-antlr\" title=\"can we define a non context free grammar with antlr\">stackoverflow.com/questions/35630746/&hellip;</a>"}, {"owner": {"reputation": 1159, "user_id": 3953988, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/803352198cc6f048e409a07eefa19d7b?s=128&d=identicon&r=PG", "display_name": "Rahul Manne", "link": "https://stackoverflow.com/users/3953988/rahul-manne"}, "reply_to_user": {"reputation": 2354, "user_id": 2730024, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f388ccdbbf7e31ac1b5399d99feed97e?s=128&d=identicon&r=PG&f=1", "display_name": "mba12", "link": "https://stackoverflow.com/users/2730024/mba12"}, "edited": false, "score": 0, "creation_date": 1481755815, "post_id": 41153454, "comment_id": 69509101, "body": "@mba12 MetaS seems to be exactly what I&#39;m looking for, but I can&#39;t seem to find any such package. AlexisKing that answers my question, thanks!"}, {"owner": {"reputation": 2354, "user_id": 2730024, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f388ccdbbf7e31ac1b5399d99feed97e?s=128&d=identicon&r=PG&f=1", "display_name": "mba12", "link": "https://stackoverflow.com/users/2730024/mba12"}, "edited": false, "score": 0, "creation_date": 1481756234, "post_id": 41153454, "comment_id": 69509262, "body": "@RahulManne Sorry, I don&#39;t know anything about MetaS. You could also write a parser in Antlr that uses custom code to handle ambiguities. That is likely more work than you are looking to do but is probably a reasonable solution."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481772423, "post_id": 41153454, "comment_id": 69513634, "body": "<code>ReadP</code> in the standard library will also do it, though it&#39;s potentially exponential in the depth of the parse multi-tree (earley is only cubic)."}, {"owner": {"reputation": 627, "user_id": 4179599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7df8139d9f4ec48fee9d6bfd968976?s=128&d=identicon&r=PG&f=1", "display_name": "Renzeee", "link": "https://stackoverflow.com/users/4179599/renzeee"}, "edited": false, "score": 0, "creation_date": 1481799001, "post_id": 41153454, "comment_id": 69525357, "body": "The <a href=\"https://hackage.haskell.org/package/uu-parsinglib\" rel=\"nofollow noreferrer\"><code>uu-parsinglib</code></a> can also handle ambiguous grammers. See <a href=\"http://foswiki.cs.uu.nl/foswiki/HUT/ParserCombinators\" rel=\"nofollow noreferrer\">their website</a>: &quot;ambiguous grammars can be handled, provided one is prepared to indicate that a non-terminal is ambiguous&quot;. They have also a few ambiguous examples."}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481894399, "post_id": 41153454, "comment_id": 69570288, "body": "Happy(<a href=\"https://www.haskell.org/happy/doc/html/sec-glr.html\" rel=\"nofollow noreferrer\">haskell.org/happy/doc/html/sec-glr.html</a>) can deal with ambiguity."}], "owner": {"reputation": 1159, "user_id": 3953988, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/803352198cc6f048e409a07eefa19d7b?s=128&d=identicon&r=PG", "display_name": "Rahul Manne", "link": "https://stackoverflow.com/users/3953988/rahul-manne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 410, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1481755133, "creation_date": 1481755133, "question_id": 41153454, "link": "https://stackoverflow.com/questions/41153454/ambiguous-grammar-parser", "title": "Ambiguous Grammar Parser", "body": "<p>Is there a parser that can parse ambiguous grammars (ideally in Haskell)?</p>\n\n<p>Parsec's paper (<a href=\"http://research.microsoft.com/en-us/um/people/daan/download/papers/parsec-paper.pdf\" rel=\"nofollow noreferrer\">http://research.microsoft.com/en-us/um/people/daan/download/papers/parsec-paper.pdf</a>) states the following:</p>\n\n<p>\"Ambiguous grammars have more than one parse tree for a sentence in the language. Only parser combinators that can return more than one value can handle ambiguous grammars. Such combinators use a list as their reply type.\"</p>\n\n<p>But I haven't found any such parser combinators. Do they exist?</p>\n"}, {"tags": ["unit-testing", "haskell", "hspec"], "answers": [{"comments": [{"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1481750681, "post_id": 41152184, "comment_id": 69507043, "body": "This answer is good, but I\u2019m confused when you say that <code>evaluate</code> doesn\u2019t evaluate to WHNF when <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception.html#v:evaluate\" rel=\"nofollow noreferrer\">the docs explicitly state that it evaluates its argument to WHNF</a>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1481750977, "post_id": 41152184, "comment_id": 69507172, "body": "@AlexisKing I stand corrected! In any case, WNHF is not enough, hence why you need <code>NFData</code>."}, {"owner": {"reputation": 4226, "user_id": 801466, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ea940f547251fd26d79da5043ec307e3?s=128&d=identicon&r=PG", "display_name": "Artem Oboturov", "link": "https://stackoverflow.com/users/801466/artem-oboturov"}, "edited": false, "score": 0, "creation_date": 1481788255, "post_id": 41152184, "comment_id": 69519002, "body": "So, actually, the test passes because it produces a list with a single undefined element? Why isn&#39;t the (+1) function applied?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481789215, "post_id": 41152184, "comment_id": 69519476, "body": "Since there is no need to inspect the first element of the list, Haskell doesn&#39;t bother to try to evaluate <code>(+1) undefined</code>. The thunk is there, but Haskell doesn&#39;t need to force it for <code>evaluate</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1481751341, "last_edit_date": 1481751341, "creation_date": 1481749590, "answer_id": 41152184, "question_id": 41151927, "link": "https://stackoverflow.com/questions/41151927/unit-testing-the-undefined-evaluated-in-lazy-expression-in-haskell/41152184#41152184", "title": "Unit-testing the undefined evaluated in lazy expression in Haskell", "body": "<p>The problem is that <code>evaluate</code> doesn't force your expression to NH <s>or even WHNF</s><sup>1</sup>. Try <code>x &lt;- evaluate (take 1 $ map (+1) [undefined, 2, 3])</code> in GHCi - it doesn't give you any error! The only reason it does when you paste in <code>evaluate (take 1 $ map (+1) [undefined, 2, 3])</code> is that GHCi also tries to print the result of what it got and, to do that, it ends up trying to evaluate the expression.</p>\n\n<p>If you want to see how much of a thunk has been evaluated, you can always use <code>:sprint</code> in GHCi:</p>\n\n<pre><code>ghci&gt; x &lt;- evaluate (take 1 $ map (+1) [undefined, 2, 3])\nghci&gt; :sprint x\nx = [_]\n</code></pre>\n\n<p>As you can see, <code>evaluate</code> hasn't forced the expression far enough to realize <code>x</code> contains an <code>undefined</code>. A quick fix is to evaluate the thing you are examining to normal form using <code>force</code>.</p>\n\n<pre><code>import Test.Hspec\nimport Control.Exception (evaluate)\nimport Control.DeepSeq (force)\n\nmain :: IO ()\nmain = hspec $ do\n  describe \"Test\" $ do\n    it \"test case\" $ do\n      evaluate (force (take 1 $ map (+1) [undefined, 2, 3] :: [Int])) \n        `shouldThrow` anyException\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/deepseq-1.4.2.0/docs/Control-DeepSeq.html#v:force\" rel=\"nofollow noreferrer\"><code>force</code></a> lets you trigger the evaluation of thunks until the argument is full evaluated. Note that it has an <code>NFData</code> (stands for \"normal form data\") constraint on it, so you may find yourself deriving <code>Generic</code> and <code>NFData</code> for your data structures.</p>\n\n<hr>\n\n<p><sup>1</sup> Thanks for @AlexisKing for pointing out that <code>evaluate</code> <em>does</em> push its argument into WNHF, which is why <code>head $ map (+1) [undefined, 2, 3]</code> does trigger the error. In the case of <code>take</code>, it isn't enough though.</p>\n"}], "owner": {"reputation": 4226, "user_id": 801466, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ea940f547251fd26d79da5043ec307e3?s=128&d=identicon&r=PG", "display_name": "Artem Oboturov", "link": "https://stackoverflow.com/users/801466/artem-oboturov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 41152184, "answer_count": 1, "score": 2, "last_activity_date": 1481751341, "creation_date": 1481748638, "question_id": 41151927, "link": "https://stackoverflow.com/questions/41151927/unit-testing-the-undefined-evaluated-in-lazy-expression-in-haskell", "title": "Unit-testing the undefined evaluated in lazy expression in Haskell", "body": "<p>Writing a unit test in Haskell where an expression should fail when <code>undefined</code> is encountered is a bit tricky. I tried the following with HSpec:</p>\n\n<pre><code>module Main where\n\nimport Test.Hspec\nimport Control.Exception (evaluate)\n\nmain :: IO ()\nmain = hspec $ do\n  describe \"Test\" $ do\n    it \"test case\" $ do\n      evaluate (take 1 $ map (+1) [undefined, 2, 3]) `shouldThrow` anyException\n</code></pre>\n\n<p>to no avail. It reports me <code>did not get expected exception: SomeException</code></p>\n\n<p>If I evaluate the same expression in REPL, I'd get:</p>\n\n<pre><code>[*** Exception: Prelude.undefined\nCallStack (from HasCallStack):\n  error, called at libraries\\base\\GHC\\Err.hs:79:14 in base:GHC.Err\n  undefined, called at &lt;interactive&gt;:2:20 in interactive:Ghci1\n</code></pre>\n"}, {"tags": ["haskell", "traversable"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1481743003, "post_id": 41150270, "comment_id": 69503076, "body": "Are you missing that <a href=\"http://stackoverflow.com/questions/24112786/why-should-applicative-be-a-superclass-of-monad\"><code>Applicative</code> is a superclass of <code>Monad</code></a>? <code>forM</code>, <code>liftM</code>, etc. are reminders from when <code>Applicative</code> wasn&#39;t (in the Prelude) a superclass of <code>Monad</code>."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481743479, "post_id": 41150270, "comment_id": 69503323, "body": "@Alec isn&#39;t that the other way around? Meaning that I could pass the code in applicative style into forM without any changes, but not in the opposite direction? I&#39;m not quite sure how it would be possible to use <code>return</code> when <code>Applicative</code> constraint is present."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1481743740, "post_id": 41150270, "comment_id": 69503440, "body": "<code>parseJSON</code> works in the <code>Parser</code> monad, which is also an applicative (of course). <code>return</code> (and do notation) checks <code>Parser</code> is a monad -- it is. <code>for</code> checks it is also an applicative -- it is. Everything works just fine."}], "answers": [{"comments": [{"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1481745523, "post_id": 41150678, "comment_id": 69504432, "body": "Thank you. I see how <code>Monad</code> is more powerful and that with AMP every <code>Monad</code> is an <code>Applicative</code> as well. But when a signature says it specifically wants an <code>Applicative</code> wouldn&#39;t that mean that it wants to restrict those powers and only work with <code>Applicative</code> interface?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 3, "creation_date": 1481746302, "post_id": 41150678, "comment_id": 69504840, "body": "Yes, <code>for</code> is only permitted to use the <code>Applicative</code> powers of the object you pass in. But you can use monadic powers to construct values of that type - how you do stuff inside your lambda is a black box to <code>for</code>."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1481748234, "post_id": 41150678, "comment_id": 69505808, "body": "@amalloy I think I got it now - <code>for</code> doesn&#39;t care how the value was produced, only that it satisfies the <code>Applicative</code> constraint. I thought that the <code>Applicative</code> restriction would be imposed on what the lambda itself can do, not just on what it returns."}, {"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1481748895, "post_id": 41150678, "comment_id": 69506170, "body": "And it seems the crucial thing I missed was <i>producing</i> an <code>Applicative</code> vs <i>working</i> with one :-("}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 2, "creation_date": 1481749727, "post_id": 41150678, "comment_id": 69506601, "body": "@ppb It&#39;s not about <i>producing</i> vs <i>working</i> with a type. It&#39;s about what you (and the type system) know about the type. When you call <code>for :: forall f.  ...</code> you are passing <code>for</code> both its arguments and the type <code>f</code>. You know more about <code>f</code> than it&#39;s an <code>Applicative f</code> or a <code>Monad f</code>; you know what <code>f</code> is! It&#39;s <code>Parser</code>. You can use anything you know about the type, including crazy things that aren&#39;t even a part of either <code>Applicative</code> or <code>Monad</code>, like <code>parseJSON</code> (which you&#39;re already using). If you know that <code>f</code> is <code>Parser</code> to use <code>parseJSON</code>, you also know it&#39;s a <code>Monad</code> to use <code>&gt;&gt;=</code>."}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1481743832, "creation_date": 1481743832, "answer_id": 41150678, "question_id": 41150270, "link": "https://stackoverflow.com/questions/41150270/why-does-for-from-data-traversable-accept-monadic-actions/41150678#41150678", "title": "Why does &#39;for&#39; from Data.Traversable accept monadic actions?", "body": "<p>The first short answer is that <a href=\"https://hackage.haskell.org/package/aeson-1.0.2.1/docs/Data-Aeson-Types.html#t:Parser\" rel=\"nofollow noreferrer\"><code>Parser</code></a> has an <code>Applicative</code> instance. The snippet</p>\n\n<pre><code>do\n  a' &lt;- parseJSON a\n  b' &lt;- parseJSON b\n  return (a', b')\n</code></pre>\n\n<p>has the type <code>Parser (Whitelisted, WhitelistComment)</code> which unifies with <code>f b</code> in the type signature</p>\n\n<pre><code>for :: (Traversable t, Applicative f) =&gt; t a -&gt; (a -&gt; f b) -&gt; f (t b)\n</code></pre>\n\n<p>Since there's an <code>Applicative Parser</code> instance, it also satisfies that constraint. (I think I got the types for <code>a'</code> and <code>b'</code> right)</p>\n\n<hr>\n\n<p>The second short answer is that a <code>Monad</code> is strictly more powerful than an <code>Applicative</code>, anywhere you need an <code>Applicative</code> you can use a <code>Monad</code> instead. Ever since the <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"nofollow noreferrer\"><code>Monad</code>-<code>Applicative</code> proposal</a> was implemented, <em>every</em> <code>Monad</code> is also <code>Applicative</code>. The <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#t:Monad\" rel=\"nofollow noreferrer\"><code>Monad</code></a> class now looks like</p>\n\n<pre><code>class Applicative m =&gt; Monad m where \n    ...\n</code></pre>\n\n<p>A <code>Monad</code> is strictly more powerful than an <code>Applicative</code>, anywhere you need an <code>Applicative</code> you can use a <code>Monad</code> instead with the following substitutions:</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:ap\" rel=\"nofollow noreferrer\">ap</a> instead of <code>&lt;*&gt;</code></li>\n<li><code>return</code> instead of <code>pure</code></li>\n<li><a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Monad.html#v:liftM\" rel=\"nofollow noreferrer\"><code>liftM</code></a> instead of <code>fmap</code></li>\n</ul>\n\n<p>If you're writing some new type, <code>SomeMonad</code>, and have provided an instance for the <code>Monad</code> class you can use it to provide the instances for <code>Applicative</code> and <code>Functor</code> too.</p>\n\n<pre><code>import Control.Monad\n\ninstance Applicative SomeMonad where\n    pure = return\n    (&lt;*&gt;) = ap\n\ninstance Functor SomeMonad where\n    fmap = liftM\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 6, "last_activity_date": 1481779718, "last_edit_date": 1481779718, "creation_date": 1481757815, "answer_id": 41153954, "question_id": 41150270, "link": "https://stackoverflow.com/questions/41150270/why-does-for-from-data-traversable-accept-monadic-actions/41153954#41153954", "title": "Why does &#39;for&#39; from Data.Traversable accept monadic actions?", "body": "<p>This is just the usual caller-vs-implementer duality going on, where one side gets flexibility and the other restriction.</p>\n\n<p><code>for</code> provides you with this interface:</p>\n\n<pre><code>for :: (Traversable t, Applicative f) =&gt; t a -&gt; (a -&gt; f b) -&gt; f (t b)\n</code></pre>\n\n<p>You as the caller get the flexibility to choose any type <code>f</code> to instantiate it, so you can use it as if it were:</p>\n\n<pre><code>for :: Traversable t =&gt; t a -&gt; (a -&gt; Parser b) -&gt; Parser (t b)\n</code></pre>\n\n<p>Clearly once you've done that, there's no reason you couldn't use any <code>Parser</code>-specific functionality in the function you pass to <code>for</code>, including <code>Monad</code> stuff.</p>\n\n<p>The <em>implementer</em> of <code>for</code> on the other hand gets restricted by the polymorphism in the interface of <code>for</code>. They have to work with <strong>any</strong> choice of <code>f</code>, so they can <em>only</em> use the <code>Applicative</code> interface in the code they write to implement <code>for</code>. But that only restricts the code of <code>for</code> itself, not the function passed into it.</p>\n\n<p>If the author of <code>for</code> wanted to restrict what the caller could do in that function, they could have used <code>RankNTypes</code> to instead provide this interface:</p>\n\n<pre><code>for :: forall t f. (Traversable t, Applicative f) =&gt; t a -&gt; (forall g. Applicative g =&gt; a -&gt; g b) -&gt; f (t b)\n</code></pre>\n\n<p>Now the provided lambda itself must be polymorphic in <code>g</code> (subject to an <code>Applicative</code> constraint). The caller of <code>for</code> still gets the flexibility to choose <code>f</code>, with the implementer being restricted in using only <code>Applicative</code> features. But the caller of <code>for</code> is the <strong>implementer</strong> of the function argument, so now that that function is polymorphic itself the caller of <code>for</code> is restricted to using only <code>Applicative</code> features there and the implementer of <code>for</code> gets the freedom to use it with any type they like (including possibly using monad features to combine it with other internal values). With this specific type signature the implementer of <code>for</code> will have to choose to instantiate <code>g</code> with the same type the caller of <code>for</code> selected for <code>f</code>, in order to come up with the final <code>f (t b)</code> return value. But the caller of <code>for</code> would still be restricted by the type system to providing a function that works for any <code>Applicative g</code>.</p>\n\n<p>The point is, if you get to choose what type to instantiate a polymorphic signature with then you are not the one restricted by that interface. You can choose a type and then use whatever other features of that type you like, provided you still do provide the bits of information the interface requires of you. i.e. You can use non-<code>Traversable</code> functionality to create your <code>t a</code> and non-<code>Applicative</code> functionality to create your <code>a -&gt; f b</code>, all that's required is that you do provide those inputs. And indeed you almost <em>have</em> to make use of functionality specific to <code>a</code> and <code>b</code>. The <em>implementer</em> of the polymorphic signature doesn't get that freedom, they are restricted by the polymorphism to only doing things that would work for any possible choice.</p>\n\n<p>As an aside, similarly to how rank 2 types add \"another level\" of this duality with the roles reversed (and rank N types allow arbitrarily many levels), a similar duality is also seen (flipped around again) in the constraints themselves. Consider again the signature:</p>\n\n<pre><code>for :: (Traversable t, Applicative f) =&gt; t a -&gt; (a -&gt; f b) -&gt; f (t b)\n</code></pre>\n\n<p>The <em>caller</em> of <code>for</code> is restricted by the <code>Traversable</code> and <code>Applicative</code> constraints when choosing the types <code>t</code> and <code>f</code>. The implementer gets the freedom to use any functions implied by those constraints, without worrying about how to prove the constraints are satisfied.</p>\n"}], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 41150678, "answer_count": 2, "score": 3, "last_activity_date": 1481779718, "creation_date": 1481742412, "last_edit_date": 1481750486, "question_id": 41150270, "link": "https://stackoverflow.com/questions/41150270/why-does-for-from-data-traversable-accept-monadic-actions", "title": "Why does &#39;for&#39; from Data.Traversable accept monadic actions?", "body": "<p>I was working on the following small fragment of code:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import           Control.Monad\nimport           Data.Aeson\nimport qualified Data.HashMap.Strict as HashMap\nimport           Data.Map (Map)\nimport qualified Data.Map as Map\nimport           GHC.Generics\n\n-- definitions of Whitelisted, WhitelistComment and their FromJSON instances\n-- omitted for brevity\n\ndata Whitelist = Whitelist\n  { whitelist :: Map Whitelisted WhitelistComment\n  } deriving (Eq, Ord, Show)\n\ninstance FromJSON Whitelist where\n  parseJSON (Object v) =\n    fmap (Whitelist . Map.fromList) . forM (HashMap.toList v) $ \\(a, b) -&gt; do\n      a' &lt;- parseJSON (String a)\n      b' &lt;- parseJSON b\n      return (a', b')\n  parseJSON _ = mzero\n</code></pre>\n\n<p>when I realised that I can rewrite the <code>do</code> block in applicative style:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance FromJSON Whitelist where\n  parseJSON (Object v) =\n    fmap (Whitelist . Map.fromList) . forM (HashMap.toList v) $ \\(a, b) -&gt;\n      (,) &lt;$&gt; parseJSON (String a) &lt;*&gt; parseJSON b\n  parseJSON _ = mzero\n</code></pre>\n\n<p>and with that I could also replace <code>forM</code> with <code>for</code>. Before making the change above I switched to <code>for</code> first:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance FromJSON Whitelist where\n  parseJSON (Object v) =\n    fmap (Whitelist . Map.fromList) . for (HashMap.toList v) $ \\(a, b) -&gt; do\n      a' &lt;- parseJSON (String a)\n      b' &lt;- parseJSON b\n      return (a', b')\n  parseJSON _ = mzero\n</code></pre>\n\n<p>and to my surprise this still compiled. Given the definition of  <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Traversable.html#v:for\" rel=\"nofollow noreferrer\"><code>for</code></a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>for :: (Traversable t, Applicative f) =&gt; t a -&gt; (a -&gt; f b) -&gt; f (t b)\n</code></pre>\n\n<p>I thought the <code>Applicative</code> constraint would prevent me from using do notation / return in the action passed to <code>for</code>.</p>\n\n<p>I'm clearly missing something fundamental here, either in terms of what <code>for</code> signature really implies, or how the code I posted is interpreted by the compiler, and would appreciate any help understanding what's going on.</p>\n"}, {"tags": ["haskell", "monads", "functor"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 8, "creation_date": 1481736400, "post_id": 41148536, "comment_id": 69499588, "body": "Your <code>User</code> type is isomorphic to <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor-Identity.html#t:Identity\" rel=\"nofollow noreferrer\">the <code>Identity</code> functor</a>. Have a look at <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Functor.Identity.html#line-97\" rel=\"nofollow noreferrer\">its source code</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1481737332, "post_id": 41148536, "comment_id": 69500100, "body": "Regarding 2, see <a href=\"http://stackoverflow.com/a/38719766/3072788\">this</a>."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 3, "creation_date": 1481738933, "post_id": 41148536, "comment_id": 69500910, "body": "Or <a href=\"http://stackoverflow.com/questions/17409260/what-advantage-does-monad-give-us-over-an-applicative\">this</a>."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1481761885, "last_edit_date": 1495535441, "creation_date": 1481760264, "answer_id": 41154327, "question_id": 41148536, "link": "https://stackoverflow.com/questions/41148536/defining-and-using-monadic-structures-on-custom-datatypes/41154327#41154327", "title": "Defining and using monadic structures on custom datatypes?", "body": "<blockquote>\n  <p>1) how to define a monad structure for my 'User a' type</p>\n</blockquote>\n\n<p>(Preliminary note: Learn You a Haskell predates <code>Applicative</code> becoming a superclass of <code>Monad</code>. For that reason, and unlike the book suggests, with recent versions of GHC there is no need of implementing <code>return</code> -- by default, it is the same as <code>pure</code>. That being so, I will jump directly to <code>(&gt;&gt;=)</code>.)</p>\n\n<p>One nice thing about methods with very general types such as <code>(&gt;&gt;=)</code>...</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>... is that they are so general that there are few sensible ways of implementing them -- often just one. If we specialise <code>(&gt;&gt;=)</code> for your type, we get:</p>\n\n<pre><code>(&gt;&gt;=) @User :: User a -&gt; (a -&gt; User b) -&gt; User b\n</code></pre>\n\n<p>So <code>(&gt;&gt;=)</code> is supposed to take an <code>User a</code> and an <code>a -&gt; User b</code> and use them to produce an <code>User b</code>. Given that the function takes an <code>a</code> value, the first thing to try is looking for an <code>a</code> value to pass to it. We do have such a value: the one wrapped by the <code>Age</code> constructor in the <code>User a</code> value:</p>\n\n<pre><code>instance Monad User where\n    (Age a) &gt;&gt;= f = f a\n</code></pre>\n\n<p>To write a <code>Monad</code> instance in good conscience, we should check whether it follows the monad laws:</p>\n\n<pre><code>return a &gt;&gt;= f = f a\n\nm &gt;&gt;= return = m\n\n(m &gt;&gt;= f) &gt;&gt;= g = m &gt;&gt;= (\\x -&gt; f x &gt;&gt;= g)\n</code></pre>\n\n<p>That can be done with (your favourite equivalent of) pen and paper:</p>\n\n<pre><code>return a &gt;&gt;= f = f a\nAge a &gt;&gt;= f = f a\nf a = f a\n\nm &gt;&gt;= return = m\nAge a &gt;&gt;= return = Age a -- [*]\nAge a &gt;&gt;= Age = Age a\nAge a = Age a \n\n-- [*]: Both here and in the next law, we can replace 'm' by 'Age a'\n--      because there is just one constructor. If there were more\n--      (as in e.g. data Maybe a = Nothing | Just a), we would have\n--      to check the law holds for all constructors.  \n\n(m &gt;&gt;= f) &gt;&gt;= g = m &gt;&gt;= (\\x -&gt; f x &gt;&gt;= g)\n(Age a &gt;&gt;= f) &gt;&gt;= g = Age a &gt;&gt;= (\\x -&gt; f x &gt;&gt;= g)\nf a &gt;&gt;= g = (\\x -&gt; f x &gt;&gt;= g) a\nf a &gt;&gt;= g = f a &gt;&gt;= g\n</code></pre>\n\n<blockquote>\n  <p>2) what functionality a monad provides versus, say, an applicative functor?</p>\n</blockquote>\n\n<p>Here I will leave it to <a href=\"https://stackoverflow.com/q/17409260/2751851\">the question arrowd suggested</a>. I will only note that your example doesn't give you enough to really appreciate the difference, as the <code>User</code> context is too simple to let you do anything interesting with <code>(&gt;&gt;=)</code> (as Benjamin Hodgson points out, it is isomorphic to <code>Identity</code>, the dummy functor). <code>Maybe</code>, which is used by the accepted answer of the linked question, is quite a bit more illustrative. </p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 41154327, "answer_count": 1, "score": 0, "last_activity_date": 1481761885, "creation_date": 1481736056, "question_id": 41148536, "link": "https://stackoverflow.com/questions/41148536/defining-and-using-monadic-structures-on-custom-datatypes", "title": "Defining and using monadic structures on custom datatypes?", "body": "<p>I'm getting to grips with functors, applicatives and monads. </p>\n\n<p>These examples are just to illustrate the basics:</p>\n\n<pre><code>data User a = Age a deriving (Show, Eq, Ord)\n</code></pre>\n\n<p><strong>Functor</strong> (apply a non-context function to a single context datatype):</p>\n\n<pre><code>instance Functor User where\n  fmap f (Age a) = Age (f a)\n\nfunctorFunction :: Int -&gt; Int\nfunctorFunction e = e + 1\n\nmain = do\n print $ fmap functorFunction (Age 22)\n</code></pre>\n\n<p><strong>Applicative</strong> (apply a simple function to multiple context datatypes):</p>\n\n<pre><code>instance Applicative User where\n  pure a = Age a\n  (&lt;*&gt;) (Age a) = fmap a\n\napplicativeFunction :: Int -&gt; Int -&gt; Int\napplicativeFunction e1 e2 = e1 + e2\n\nmain = do \n  print $ pure (applicativeFunction) &lt;*&gt; (Age 44) &lt;*&gt; (Age 65)  \n</code></pre>\n\n<p>I've going through <a href=\"http://learnyouahaskell.com\" rel=\"nofollow noreferrer\">learnyouahaskell</a> and haven't been able to find a simple explanation of </p>\n\n<p>1) how to define a monad structure for my 'User a' type, and 2) what functionality a monad provides versus, say, an applicative functor?</p>\n"}, {"tags": ["haskell", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1481727646, "post_id": 41145328, "comment_id": 69493864, "body": "I do that a lot in my projects. IMO that should be the standard signature of <code>^</code> \u2013 there&#39;s almost never a need for exponents too large to fit in <code>Int</code>. In the cases where you have an exponent of a fixed other type given, you can generally use <code>fromIntegral</code> to get to <code>Int</code>."}, {"owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "edited": false, "score": 0, "creation_date": 1481729938, "post_id": 41145328, "comment_id": 69495309, "body": "Yeah ... I should probably do that too ... any recommendations on the actual sign to use? I wouldn&#39;t want the <i>Prelude hiding preamble</i> in every file."}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "edited": false, "score": 1, "creation_date": 1481732422, "post_id": 41145328, "comment_id": 69497028, "body": "It might be best to use NoImplicitPrelude and have a custom prelude for the project.  There&#39;s a good blog post about doing that <a href=\"http://www.stephendiehl.com/posts/protolude.html\" rel=\"nofollow noreferrer\">here</a>."}], "tags": [], "owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "is_accepted": true, "score": 7, "last_activity_date": 1481726517, "creation_date": 1481726517, "answer_id": 41145328, "question_id": 41144775, "link": "https://stackoverflow.com/questions/41144775/exponents-defaulting-to-integer/41145328#41145328", "title": "Exponents defaulting to Integer", "body": "<p>You could define your own operator with a more specific type.  Or you could redefine the <code>(^)</code> operator with a more specific type, like this:</p>\n\n<pre><code>import Prelude hiding ((^))\nimport qualified Prelude ((^))\n\n(^) :: Num a =&gt; a -&gt; Int -&gt; a\n(^) = (Prelude.^)\n\nx :: Int\nx = 2^3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1481727626, "creation_date": 1481727626, "answer_id": 41145707, "question_id": 41144775, "link": "https://stackoverflow.com/questions/41144775/exponents-defaulting-to-integer/41145707#41145707", "title": "Exponents defaulting to Integer", "body": "<p>If you don't want defaulting, you need the type annotations somewhere. An alternative to inline type annotations for places where they look too ugly are local definitions with signatures:</p>\n\n<pre><code>alignment :: Storable a =&gt; a -&gt; Int\nalignment a = 2 ^ (ceiling sizeLb :: Int) \n    where\n    sizeLb :: Double\n    sizeLb = logBase 2 (fromIntegral (sizeOf a))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": false, "score": 0, "last_activity_date": 1481729013, "creation_date": 1481729013, "answer_id": 41146177, "question_id": 41144775, "link": "https://stackoverflow.com/questions/41144775/exponents-defaulting-to-integer/41146177#41146177", "title": "Exponents defaulting to Integer", "body": "<p>I've seen some people explicitly type their literals in a single location.  I don't think it is the right solution for your case, the times I've seen it the issue was always Int/Integer ambiguity, but for the record:</p>\n\n<pre><code>two :: Int\ntwo = 2\ntwoDbl :: Double\ntwoDbl = 2\n\n...  two ^ blah\n  where ...\n    sizeLb = logBase twoDbl ...\n</code></pre>\n"}], "owner": {"reputation": 6568, "user_id": 383508, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d61149baeb9e5c9d1432b220e49cd0?s=128&d=identicon&r=PG", "display_name": "fho", "link": "https://stackoverflow.com/users/383508/fho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 41145328, "answer_count": 3, "score": 1, "last_activity_date": 1481729013, "creation_date": 1481724928, "question_id": 41144775, "link": "https://stackoverflow.com/questions/41144775/exponents-defaulting-to-integer", "title": "Exponents defaulting to Integer", "body": "<p>I use <code>(^) :: (Num a, Integral b) =&gt; a -&gt; b -&gt; a</code> a lot to define constant factors or sizes. Problem is that GHC complains about defaulting to <code>Integer</code>.</p>\n\n<p>Now I know why this happens ... and I know that I can \"just\" write <code>(x^(y::Int))</code> to get rid of the warning. But that looks just \"ugly\". Otoh living with the warnings is also not a great option.</p>\n\n<p>Same thing applies for <code>(^^) :: (Integral b, Fractional a) =&gt; a -&gt; b -&gt; a</code> and <code>(**) :: Floating a =&gt; a -&gt; a -&gt; a</code> is not usable to me.</p>\n\n<p>Anyone has a nice solution to this (first world) problem?</p>\n\n<h3>edit</h3>\n\n<p>Just found this gem of code:</p>\n\n<pre><code>alignment a = 2 ^ ceiling (logBase 2 (fromIntegral (sizeOf a)))\n</code></pre>\n\n<p>This is one LOC and GHC complains about defaulting to <code>Integer</code> and <code>Double</code> on the same line.</p>\n"}, {"tags": ["haskell", "wav", "data-conversion", "bytestring"], "comments": [{"owner": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1481735169, "post_id": 41143884, "comment_id": 69498825, "body": "have you looked at <code>readDouble</code> in the <code>bytestring-lexing</code> library?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1481737926, "post_id": 41143884, "comment_id": 69500404, "body": "Those don&#39;t look like hex characters to me."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 1178, "user_id": 1667161, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233658d12fabd9d72b04d0a6916f6389?s=128&d=identicon&r=PG", "display_name": "liminalisht", "link": "https://stackoverflow.com/users/1667161/liminalisht"}, "edited": false, "score": 0, "creation_date": 1481746471, "post_id": 41143884, "comment_id": 69504918, "body": "@liminalisht I have. But I can&#39;t seem to install the package. It looks like it has bitrotten..."}, {"owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1481747490, "post_id": 41143884, "comment_id": 69505423, "body": "@ThomasM.DuBuisson You&#39;re right. I&#39;m actually not quite sure what the representation is. I&#39;ll change the question."}], "answers": [{"tags": [], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "is_accepted": true, "score": 0, "last_activity_date": 1481806576, "last_edit_date": 1481806576, "creation_date": 1481796486, "answer_id": 41161453, "question_id": 41143884, "link": "https://stackoverflow.com/questions/41143884/bytestring-representation-of-a-double-conversion/41161453#41161453", "title": "ByteString representation of a Double conversion", "body": "<p>This is my current solution to turn the ByteString into a double:</p>\n\n<pre><code>convertNBytesLen :: [Word8] -&gt; Int32\nconvertNBytesLen = foldr accum 0\n  where accum bs a = 256 * a + fromIntegral bs\n\n\nbsToDouble :: S.ByteString -&gt; Int -&gt; Double\nbsToDouble bs n = if intV &gt;= 0\n                   then fromIntegral intV / 2147483647\n                   else - (fromIntegral intV / (-2147483648))\n  where intV = convertNBytesLen (S.unpack bs) `shift` (32 - 8 * n)\n</code></pre>\n\n<p>I'm wondering if this can be done in a more efficient manner. </p>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 41161453, "answer_count": 1, "score": 1, "last_activity_date": 1481806576, "creation_date": 1481722179, "last_edit_date": 1481790717, "question_id": 41143884, "link": "https://stackoverflow.com/questions/41143884/bytestring-representation-of-a-double-conversion", "title": "ByteString representation of a Double conversion", "body": "<p>I'm writing my own <code>WAVE</code> parser that uses <a href=\"https://hackage.haskell.org/package/conduit-0.5.3/docs/Data-Conduit.html\" rel=\"nofollow noreferrer\">Conduit</a> so I can stream values, one by one, through a pipeline. </p>\n\n<p>I get a sample from a .wav file via <code>hGet</code> (n is the number of bytes per sample for that wav file):</p>\n\n<p><code>bytes &lt;- hGet h n</code></p>\n\n<p>This gives me a ByteString with a representation of the Double value of the sample. E.g.: </p>\n\n<p><code>\"\\131\\237\\242\"</code> represents <code>-0.10212671756744385</code></p>\n\n<p><code>\"g\\238\\242\"</code> represents <code>-0.10209953784942627</code></p>\n\n<p><code>\"\\215\\238\\242\"</code> represents <code>-0.10208618640899658</code>. </p>\n\n<p>The possible values are between -1 and +1.</p>\n\n<p>Is there any convenient way to do this conversion? Is there a library available to do this? </p>\n\n<p>I've taken a look at existing <code>WAVE</code> parsers for Haskell. <a href=\"https://hackage.haskell.org/package/WAVE-0.1.3/docs/Data-WAVE.html\" rel=\"nofollow noreferrer\">Data.WAVE</a> parses a <code>.wav</code> file and returns the samples as left-justified <code>Int32</code> values. I've found a workaround where I use it's library functions to convert my <code>ByteString</code> to a left-justified <code>Int32</code> and then convert it to a <code>Double</code> using the library's <code>sampleToDouble</code> function. This works, but I'm wondering if there is a more direct way of solving this problem. </p>\n\n<p>Another possible solution would be to convert the <code>ByteString</code> to <code>[Word8]</code> with <code>ByteString.unpack</code>, convert <code>[Word8]</code> to <code>Word32</code> and then convert this value to a <code>Float</code> using the conversion functions from <a href=\"http://hackage.haskell.org/package/data-binary-ieee754-0.4.4/docs/Data-Binary-IEEE754.html\" rel=\"nofollow noreferrer\">Data.Binary.IEEE754</a>. Would this be a good solution? One problem is that I currently don't know how to convert a four-element list of [Word8] to Word32. </p>\n"}, {"tags": ["haskell", "types"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 6086379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00b8766f11b3fe0341b3ed7e75abf9a6?s=128&d=identicon&r=PG&f=1", "display_name": "Midasso", "link": "https://stackoverflow.com/users/6086379/midasso"}, "edited": false, "score": 0, "creation_date": 1481716591, "post_id": 41141796, "comment_id": 69486461, "body": "Ah, i see thanks! I mistakenly thought that the &quot;Machine&quot;s were the same. Thanks for clearing that up for me"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 15, "user_id": 6086379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00b8766f11b3fe0341b3ed7e75abf9a6?s=128&d=identicon&r=PG&f=1", "display_name": "Midasso", "link": "https://stackoverflow.com/users/6086379/midasso"}, "edited": false, "score": 1, "creation_date": 1481734454, "post_id": 41141796, "comment_id": 69498396, "body": "@Midasso For future reference, it is <code>&lt;!-- language-all: lang-hs --&gt;</code> for Haskell."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 4, "last_activity_date": 1481734426, "last_edit_date": 1481734426, "creation_date": 1481715943, "answer_id": 41141796, "question_id": 41141534, "link": "https://stackoverflow.com/questions/41141534/haskell-data-type-not-recognised/41141796#41141796", "title": "Haskell data type not recognised", "body": "<p>You have two things called <code>Machine</code>. One is a type constructor that returns a <code>Station</code> type, and the other is a type. The two are unrelated, even though they share the same name.</p>\n\n<p>It may be helpful to disambiguate the two terms by adding a <code>'</code> (prime) to the data constructor. In doing so, we can tie the <code>Machine'</code> data constructor to hold a <code>Machine</code> as its only argument:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Station a b = Machine' (Machine a b)\n             | Line [Station a b]\n        deriving(Show)\n</code></pre>\n\n<p>And now we can update the <code>machine</code> function to use the newly defined constructor:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>machine :: [(a, Int)] -&gt; b -&gt; Station a b\nmachine l b = Machine' (Req l b)\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 6086379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00b8766f11b3fe0341b3ed7e75abf9a6?s=128&d=identicon&r=PG&f=1", "display_name": "Midasso", "link": "https://stackoverflow.com/users/6086379/midasso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 41141796, "answer_count": 1, "score": 0, "last_activity_date": 1481734426, "creation_date": 1481715185, "question_id": 41141534, "link": "https://stackoverflow.com/questions/41141534/haskell-data-type-not-recognised", "title": "Haskell data type not recognised", "body": "<p>I got this code:</p>\n\n<pre><code>data Station a b = Machine a b\n             | Line [Station a b]\n        deriving(Show)\n\ndata Machine a b = Req [(a,Int)] b\n    deriving(Show)\n\n\nmachine :: [(a, Int)] -&gt; b -&gt; Station a b\nmachine l b = Req l b\n</code></pre>\n\n<p>and when i try to compile, it says that the signature of machine is wrong. It says it is [(a, Int)] -> b -> Machine a b, instead of [(a, Int)] -> b -> Station a b. But in my data type i say that Station a b = Machine a b. I don't get why this won't work?</p>\n"}, {"tags": ["haskell", "types", "ghc", "type-level-computation", "data-kinds"], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1481692975, "last_edit_date": 1481692975, "creation_date": 1481692619, "answer_id": 41135325, "question_id": 41135212, "link": "https://stackoverflow.com/questions/41135212/understanding-this-definition-of-hlist/41135325#41135325", "title": "Understanding this definition of HList", "body": "<p><code>'[]</code> and <code>(x ': xs)</code> are syntax for type-level lists in the sense that the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#datatype-promotion\" rel=\"nofollow noreferrer\"><code>DataKinds</code> language extension allows promoting types to kinds and constructors to types</a>; i.e. if <code>k</code> is some kind, then <code>'[k]</code> is also a kind, and <code>'[]</code> is a type of kind <code>'[k]</code>, and if <code>t :: k</code> and <code>ts :: '[k]</code>, then <code>t ': ts :: '[k]</code>. Everything gets shifted by one.</p>\n\n<p>So in <code>HList (x ': xs)</code>, <code>x</code> and <code>xs</code> match two types: <code>x</code> matches a \"normal\" type of kind <code>*</code> (e.g. <code>Int</code>) and <code>xs</code> matches another type-level list of kind <code>'[*]</code>. The right-hand side defines a (<code>newtype</code>) datatype that has a constructor <code>HCons1</code> with a parameter of type <code>(x, HList xs)</code>. </p>\n\n<p>As an example, we can have</p>\n\n<pre><code>HCons1 (1, HCons1 (True, HNil)) :: HList '[Int, Bool]\n</code></pre>\n\n<p>Or, using the pattern synonym:</p>\n\n<pre><code>1 `HCons` True `HCons` HNil :: HList '[Int, Bool]\n</code></pre>\n\n<p>I don't have a good answer to your second question regarding why it's represented as a newtype with a tuple.</p>\n"}, {"comments": [{"owner": {"reputation": 2004, "user_id": 4916831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/kIpeA.jpg?s=128&g=1", "display_name": "lcmylin", "link": "https://stackoverflow.com/users/4916831/lcmylin"}, "edited": false, "score": 0, "creation_date": 1481698543, "post_id": 41135693, "comment_id": 69476311, "body": "Does the <code>(l :: [*])</code> mean a type parameter <code>l</code> constrained to kind <code>[*]</code>?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2004, "user_id": 4916831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/kIpeA.jpg?s=128&g=1", "display_name": "lcmylin", "link": "https://stackoverflow.com/users/4916831/lcmylin"}, "edited": false, "score": 1, "creation_date": 1481698862, "post_id": 41135693, "comment_id": 69476441, "body": "@Textfield Exactly! A type parameter that has is a promoted list of types. Come to think of it, getting that to compile may need turning on <code>KindSignatures</code> too and possibly importing <code>Data.Kind</code> too... Just do whatever GHC advises you to. :)"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 8, "last_activity_date": 1481773614, "last_edit_date": 1495540802, "creation_date": 1481694520, "answer_id": 41135693, "question_id": 41135212, "link": "https://stackoverflow.com/questions/41135212/understanding-this-definition-of-hlist/41135693#41135693", "title": "Understanding this definition of HList", "body": "<p>First, you are missing part of the definition: the <code>data family</code> declaration itself.</p>\n\n<pre><code>data family HList (l :: [*])\ndata instance HList '[] = HNil\nnewtype instance HList (x ': xs) = HCons1 (x, HList xs)\n</code></pre>\n\n<p>This is called a <a href=\"https://wiki.haskell.org/GHC/Type_families#Detailed_definition_of_data_families\" rel=\"nofollow noreferrer\"><code>data family</code></a> (available under the <code>TypeFamilies</code> extension).</p>\n\n<pre><code>pattern HCons x xs = HCons1 (x, xs)\n</code></pre>\n\n<p>This is a bidirectional pattern (available under the <code>PatternSynonyms</code> extension).</p>\n\n<blockquote>\n  <p>What is the <code>'[]</code> and <code>(x ': xs)</code> syntax I'm seeing?</p>\n</blockquote>\n\n<p>When you see <code>'</code> marks in front of constructors, it is to denote their <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#overview\" rel=\"nofollow noreferrer\">promoted type-level counterparts</a>. As a syntactic convenience, <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#promoted-list-and-tuple-types\" rel=\"nofollow noreferrer\">promoted lists and tuples</a> also just need the extra tick (and we still get to write <code>'[]</code> for the empty type-level list and <code>':</code> for the type level cons. All of this is available through the <code>DataKinds</code> extension.</p>\n\n<blockquote>\n  <p>Is there any point in using a <code>newtype</code> declaration with a tuple (instead of a data declaration with two fields) besides avoiding boxing of <code>HCons1</code>?</p>\n</blockquote>\n\n<p>Yes, it is to make sure that <code>HList</code> has a representational <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Roles\" rel=\"nofollow noreferrer\">role</a>, which means you can coerce between <code>HList</code>s<sup>1</sup>. This is a bit too involved to explain in just an answer, but here is an example of where things don't go as we want when we have</p>\n\n<pre><code> data instance HList (x ': xs) = HCons x (HList xs)\n</code></pre>\n\n<p>instead of the <code>newtype instance</code> (and no pattern). Consider the following <code>newtype</code>s which are representationally equivalent to <code>Int</code>, <code>Bool</code>, and <code>()</code> respectively</p>\n\n<pre><code>newtype MyInt = MyInt Int\nnewtype MyBool = MyBool Bool\nnewtype MyUnit = MyUnit ()\n</code></pre>\n\n<p>Recall we can use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Coerce.html\" rel=\"nofollow noreferrer\"><code>coerce</code></a> to wrap or unwrap these types automatically. Well, we'd like to be able to do the same thing, but for a whole <code>HList</code>:</p>\n\n<pre><code>ghci&gt; l  = (HCons 3 (HCons True (HCons () HNil))) :: HList '[Int,   Bool,   ()]\nghci&gt; l' = coerce l                               :: HList '[MyInt, MyBool, MyUnit]\n</code></pre>\n\n<p>This works with the <code>newtype instance</code> variant, but not the <code>data instance</code> one because of the roles. (More on that <a href=\"https://stackoverflow.com/questions/24222552/does-this-gadt-actually-have-type-role-representational\">here</a>.)</p>\n\n<hr>\n\n<p><sup>1</sup> technically, there is no role for a <code>data family</code> as a whole: the roles can be different for each <code>instance</code>/<code>newtype</code> - here we only really need the <code>HCons</code> case to be representational, since that's the one that gets coerced. <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8177\" rel=\"nofollow noreferrer\">Check out this Trac ticket</a>.</p>\n"}], "owner": {"reputation": 2004, "user_id": 4916831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/kIpeA.jpg?s=128&g=1", "display_name": "lcmylin", "link": "https://stackoverflow.com/users/4916831/lcmylin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 408, "favorite_count": 1, "accepted_answer_id": 41135693, "answer_count": 2, "score": 4, "last_activity_date": 1481773614, "creation_date": 1481691875, "last_edit_date": 1481692747, "question_id": 41135212, "link": "https://stackoverflow.com/questions/41135212/understanding-this-definition-of-hlist", "title": "Understanding this definition of HList", "body": "<p>I'm relatively new to Haskell, and I'm trying to understand one of the definitions of <a href=\"https://hackage.haskell.org/package/HList-0.4.1.0/docs/Data-HList-HList.html\" rel=\"nofollow noreferrer\">HList</a>.</p>\n\n<pre><code>data instance HList '[] = HNil\nnewtype instance HList (x ': xs) = HCons1 (x, HList xs)\npattern HCons x xs = HCons1 (x, xs)\n</code></pre>\n\n<p>I have a couple specific questions:</p>\n\n<ul>\n<li><p>What is the <code>'[]</code> and <code>(x ': xs)</code> syntax I'm seeing? It almost looks like it's pattern matching on variadic type parameters, but I have never seen this syntax before, nor am I familiar with variadic type parameters in Haskell. I would guess this is part of <a href=\"https://wiki.haskell.org/GHC/Type_families\" rel=\"nofollow noreferrer\">GHC's Type Families</a>, but I don't see anything about this on the linked page, and it's rather hard to search syntax in Google.</p></li>\n<li><p>Is there any point in using a <code>newtype</code> declaration with a tuple (instead of a <code>data</code> declaration with two fields) besides avoiding boxing of <code>HCons1</code>?</p></li>\n</ul>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1481684263, "post_id": 41133826, "comment_id": 69472130, "body": "Likely useful: <a href=\"http://stackoverflow.com/questions/40331179/how-to-automatically-parenthesize-arbitrary-haskell-expressions/40333460#40333460\" title=\"how to automatically parenthesize arbitrary haskell expressions\">stackoverflow.com/questions/40331179/&hellip;</a>"}, {"owner": {"reputation": 69, "user_id": 6544090, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0740cd7a71a62991de0b29504c96ae8b?s=128&d=identicon&r=PG&f=1", "display_name": "ndrue", "link": "https://stackoverflow.com/users/6544090/ndrue"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481687127, "post_id": 41133826, "comment_id": 69472883, "body": "oh I get it, thanks"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1481710003, "post_id": 41133826, "comment_id": 69482478, "body": "Does the problem fixes itself one you add some parentheses in the &quot;right&quot; places?"}], "owner": {"reputation": 69, "user_id": 6544090, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0740cd7a71a62991de0b29504c96ae8b?s=128&d=identicon&r=PG&f=1", "display_name": "ndrue", "link": "https://stackoverflow.com/users/6544090/ndrue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 199, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1481682417, "creation_date": 1481682417, "question_id": 41133826, "link": "https://stackoverflow.com/questions/41133826/monad-challenges-no-instance-for-monadstate", "title": "Monad Challenges: No instance for MonadState", "body": "<p>I'm new to Haskell and trying my hand at <a href=\"http://mightybyte.github.io/monad-challenges/pages/set1.html\" rel=\"nofollow noreferrer\">the monad challenges</a>. The following code gives an error message:</p>\n\n<pre><code>type Rand a = StateT Seed Identity a    \n\nhi :: Rand Integer\nhi = get &gt;&gt;= \\std -&gt; (put . snd $ rand std) &gt;&gt; return . fst $ rand std\n-- hi = state rand\n\nmain = print $ product . fst $ runState (replicateM 5 hi) (mkSeed 1)\n\n\nNo instance for (MonadState Seed ((-&gt;) (Integer, Seed)))\n      arising from a use of \u2018put\u2019\n    In the first argument of \u2018(.)\u2019, namely \u2018put\u2019\n    In the expression: put . snd\n    In the first argument of \u2018(&gt;&gt;)\u2019, namely \u2018(put . snd $ rand std)\u2019\n</code></pre>\n\n<p>While the code below runs fine, even though it should be the same thing. </p>\n\n<pre><code>hi = get &gt;&gt;= \\std -&gt; (put . snd $ rand std) &gt;&gt;= \\_ -&gt; return . fst $ rand std\n</code></pre>\n\n<p>Can someone explain why? Thanks in advance. </p>\n"}, {"tags": ["haskell", "syntax", "scope", "pattern-matching"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481678447, "post_id": 41133260, "comment_id": 69470696, "body": "<code>where</code> clauses only apply to a single pattern match case.  (Though it can apply to multiple guards in a single case)"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 11, "creation_date": 1481679092, "post_id": 41133260, "comment_id": 69470879, "body": "It&#39;s clearly insufficient merely to say what the rules are. Why are those the rules? Well, in the definition of <code>func2</code>, the variables <code>x</code> and <code>y</code> are in scope. The scope of the <code>where</code> is not determined by what gets used, and the presumption is that different clauses will have different pattern variables, hence different scopes, so there&#39;s no reason to believe sharing <code>where</code> clauses will make sense. Pattern matching is a rather flattened way to manage hierarchichal decision processes: the <code>where</code> notation gives split-then-make-helper, but, yes, make-helper-then-split can sometimes be good."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1481688508, "post_id": 41133260, "comment_id": 69473151, "body": "And importantly, if you want make-helper-then-split you don&#39;t need <code>where</code>, you can just define a new top-level function, or use a <code>let</code> if you&#39;re closing over some locals. As is, you have access to both options; if <code>where</code> shared patterns, you could only write shared bindings."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1481705795, "post_id": 41133260, "comment_id": 69479929, "body": "Think about what you wrote. It&#39;s the same thing as writing: <code>func Nothing Nothing = func2 &quot;hello&quot; &quot;world&quot;; func x y = let func2 a b = a ++ b in func2 &quot;hello&quot; &quot;world&quot;</code>. Why do you expect the <code>let</code> binding to be valid in the first equation? Every single patter-case is a <i>separate</i> definition. If you want shared local definitions you have to do something like <code>func x y = case (x, y) of (Nothing, Nothing) -&gt; ...; (_,_) -&gt; ... where func2 a b = a ++b</code>, i.e. have the top-level function use a single catch-all match and use a <code>case</code> for the actual pattern matching."}], "owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 314, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1481692081, "creation_date": 1481678270, "last_edit_date": 1481692081, "question_id": 41133260, "link": "https://stackoverflow.com/questions/41133260/why-cant-pattern-matching-share-where-clauses", "title": "why can&#39;t pattern matching share where clauses?", "body": "<p>I wrote this and it does not compile</p>\n\n<pre><code>import Data.Maybe\nfunc Nothing Nothing = func2 \"hello\" \"world\"\nfunc x       y       = func2 \"hello\" \"world\"\n  where func2 a b = a ++ b\nmain = print $ func Nothing Nothing\n</code></pre>\n\n<blockquote>\n<pre><code>test.hs:2:24: error:\n    \u2022 Variable not in scope: func2 :: [Char] -&gt; [Char] -&gt; [Char]\n    \u2022 Perhaps you meant \u2018func\u2019 (line 2)\n</code></pre>\n</blockquote>\n\n<p>I rewrote it by using guards and it worked. But I would like to know why it is like this.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "is_accepted": true, "score": 1, "last_activity_date": 1481915113, "creation_date": 1481915113, "answer_id": 41190891, "question_id": 41133195, "link": "https://stackoverflow.com/questions/41133195/test-framework-plustestoptions-and-testproperty/41190891#41190891", "title": "Test.Framework &#39;plusTestOptions&#39; and &#39;testProperty&#39;", "body": "<p>The answer is that one has to increase the number of unsuitable tests, <code>topt_maximum_unsuitable_generated_tests</code>, so that it is greater or equal to the number of generated tests, <code>topt_maximum_generated_tests</code>. Also, should use the <code>mempty</code> instance and modify it with the updated record members. The modified code fragment is:</p>\n\n<pre><code>import           Data.Monoid (mempty)\nimport           Test.Framework (Test, defaultMainWithArgs, plusTestOptions, testGroup)\nimport           Test.Framework.Options               (TestOptions' (..))\nimport           Test.Framework.Providers.HUnit       (testCase)\nimport           Test.Framework.Providers.QuickCheck2 (testProperty)\nimport           Test.HUnit                           (Assertion, assertBool, assertFailure)\nimport           Test.QuickCheck                      (Property, choose, forAll)\n\n{- list of tests -}\nmkMsysTests :: TestArgs -&gt; [Test]\nmkMsysTests opts =\n  [ testGroup \"foo\"\n    [ plusTestOptions testOptions_more (testProperty \"bar\" prop_bar) ]\n  ]\n\ntestOptions_more =\n  mempty { topt_maximum_unsuitable_generated_tests = Just 10000\n         , topt_maximum_generated_tests = Just 10000\n         }\n</code></pre>\n\n<p>I don't have a good explanation why the <code>Test.Framework</code> code gives up if the number of unsuitable tests is less than the number of generated tests; I just did a quick \"eyeball\" scan on the code and noticed the fix.</p>\n"}], "owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 41190891, "answer_count": 1, "score": 1, "last_activity_date": 1481915113, "creation_date": 1481677778, "question_id": 41133195, "link": "https://stackoverflow.com/questions/41133195/test-framework-plustestoptions-and-testproperty", "title": "Test.Framework &#39;plusTestOptions&#39; and &#39;testProperty&#39;", "body": "<p>I've got an individual QuickCheck2 property I'd like to run more than the standard 100 times, but I've gotten stuck on how to convince <code>Test.Framework</code> to run more using <code>plusTestOptions</code> -- the <code>testProperty</code> fails with \"Arguments exhausted after 0 tests\".</p>\n\n<p>Relevant code snippet:</p>\n\n<pre><code>mkMsysTests :: TestArgs -&gt; [Test]\nmkMsysTests opts =\n  [ testGroup \"foo\"\n    [ plusTestOptions testOptions_more (testProperty \"bar\" prop_bar) ]\n  ]\n\ntestOptions_more =\n  TestOptions { topt_seed = Nothing\n              , topt_maximum_unsuitable_generated_tests = Nothing\n              , topt_maximum_test_size = Just 500\n              , topt_maximum_test_depth = Nothing\n              , topt_timeout = Nothing\n              , topt_maximum_generated_tests = Just 10000\n              }\n</code></pre>\n\n<p>Theoretically, this should test the property 10,000 times. But it doesn't. Is there any good documentation or example that demonstrates how to use <code>TestOptions</code> to run property tests more than the standard 100 times?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1481677925, "post_id": 41133102, "comment_id": 69470544, "body": "Just a word of warning, the docs say &quot;The ListT monad transformer, adding backtracking to a given monad, which must be commutative.&quot;.  <code>IO</code> is not commutative (which means roughly that it doesn&#39;t matter which order you do your effects in, very much not true in <code>IO</code>).  So that means you don&#39;t get monad laws -- e.g. if you say <code>do { do { foo; bar }; baz }</code> it could behave differently than if you say <code>do { foo; do { bar; baz } }</code>.  And who knows what the difference is supposed to be? -- basically it doesn&#39;t make sense anymore."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1481678132, "post_id": 41133102, "comment_id": 69470612, "body": "&quot;I want to compute a list while doing IO operations along the way&quot; -- I think you misunderstand what <code>ListT</code> does, which adds backtracking-style nondeterminism to a monad.  You sure you don&#39;t just want <code>IO</code> (which is perfectly capable of manipulating lists)?  Or maybe <code>WriterT [Int] IO</code>, which adds a list &quot;global variable&quot; that gets appended to ?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 1, "creation_date": 1481712688, "post_id": 41133102, "comment_id": 69484090, "body": "Your problem is that <code>[6,7,8]</code> has type <code>[Int]</code> but compiler expect <code>ListT IO Int</code>. So, you should have transformation <code>[Int] -&gt; ListT IO Int</code>. For example, <code>ListT . return $ [6,7,8]</code>."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1481721152, "post_id": 41133102, "comment_id": 69489426, "body": "You should use one of the &quot;ListT done right&quot; libraries for the reasons luqui mentions.  <a href=\"https://hackage.haskell.org/package/list-transformer-1.0.1/docs/List-Transformer.html\" rel=\"nofollow noreferrer\"><code>list-transformer</code></a> has some nice tutorial material. (With that library the offending line freestyle corrects would be written <code>select [6,7,8]</code>) There are several different implementations on hackage, e.g <a href=\"https://hackage.haskell.org/package/list-t\" rel=\"nofollow noreferrer\"><code>list-t</code></a>"}], "answers": [{"tags": [], "owner": {"reputation": 362, "user_id": 8418198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4434b8336d810f5db23fb578a52fbd18?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaokui Shu", "link": "https://stackoverflow.com/users/8418198/xiaokui-shu"}, "is_accepted": false, "score": 2, "last_activity_date": 1527025047, "last_edit_date": 1527025047, "creation_date": 1527024335, "answer_id": 50476669, "question_id": 41133102, "link": "https://stackoverflow.com/questions/41133102/how-to-use-the-listt-monad-transformer/50476669#50476669", "title": "How to use the ListT monad transformer", "body": "<p>Here's a complete program to answer the question. First, I think what you need (from functionality perspective) is simpler than <code>ListT</code>, or just <code>IO Int</code>. Second, maybe you want to learn ListT, so I also provide the ListT versions. This program also serves as an example to understand <code>toList</code> and <code>traverse_</code> functions in <code>list-t</code> library. The difference is wonderfully explained in another streaming library: <a href=\"https://github.com/snoyberg/conduit#interleaved-effects\" rel=\"nofollow noreferrer\">https://github.com/snoyberg/conduit#interleaved-effects</a></p>\n\n<p>Before compiling, please add <code>mtl</code> and <code>list-t</code> as dependencies in the <code>package.yaml</code> file (assuming you are using stack).</p>\n\n<pre><code>import qualified ListT as L\nimport Control.Monad.Trans (lift)\n\nmain :: IO ()\nmain =  putStrLn \"#### Just IO version: maybe you are actually looking for this.\"\n     &gt;&gt; scrapJustIO &gt;&gt;= print\n     &gt;&gt; putStrLn \"#### ListT version serializing everything into a list before output.\"\n     &gt;&gt; L.toList scrapListT &gt;&gt;= print\n     &gt;&gt; putStrLn \"#### ListT version as stream (what list-t is actually for)\"\n     &gt;&gt; L.traverse_ print scrapListT\n\nscrapJustIO :: IO Int\nscrapJustIO = do\n    putStrLn \"Hello\"\n    print 6\n    mapM_ (print . (+1)) [6,7,8]\n    return 4\n\nscrapListT :: L.ListT IO Int\nscrapListT = do\n    lift $ putStrLn \"Hello\"\n    lift $ print 6\n    x &lt;- L.fromFoldable [6,7,8]\n    lift $ print (x+1)\n    return 4\n</code></pre>\n"}], "owner": {"reputation": 12714, "user_id": 505306, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TjIHR.png?s=128&g=1", "display_name": "smilingbuddha", "link": "https://stackoverflow.com/users/505306/smilingbuddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1324, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1527025047, "creation_date": 1481677109, "question_id": 41133102, "link": "https://stackoverflow.com/questions/41133102/how-to-use-the-listt-monad-transformer", "title": "How to use the ListT monad transformer", "body": "<p>I am a newbie to Monad Transformers in Haskell and in particular I am struggling with the ListT monad transformer. </p>\n\n<p>I want to compute a list while doing some IO operations along the way. </p>\n\n<p>Here is an stupid example that does not compile. I want to print <code>x+1</code> for every member x of a list. </p>\n\n<pre><code>import Control.Monad\nimport Control.Monad.Trans.List\nimport Control.Monad.Trans.Class \nimport System.IO.Unsafe\n\nscrap :: ListT IO Int\nscrap = do lift $ print \"Hello\"\n           lift $ print 6\n           x &lt;- [6,7,8]\n           lift $ print (x+1) -- code crashes here\n           return 4\n</code></pre>\n\n<p>This does not compile. I get the error </p>\n\n<pre><code>[1 of 1] Compiling Main             ( problem.hs, interpreted )\n\nproblem.hs:41:17:\n    Couldn't match expected type \u2018ListT IO Integer\u2019\n                with actual type \u2018[Integer]\u2019\n    In a stmt of a 'do' block: x &lt;- [6, 7, 8]\n    In the expression:\n      do { lift $ print \"Hello\";\n           lift $ print 6;\n           x &lt;- [6, 7, ....];\n           lift $ print (x + 1);\n           .... }\n    In an equation for \u2018scrap\u2019:\n        scrap\n          = do { lift $ print \"Hello\";\n                 lift $ print 6;\n                 x &lt;- [6, ....];\n                 .... }\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I want the code to print 7,8,9. What should I do? </p>\n"}, {"tags": ["haskell", "persistent"], "answers": [{"tags": [], "owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "is_accepted": true, "score": 0, "last_activity_date": 1481790441, "creation_date": 1481790441, "answer_id": 41159542, "question_id": 41132279, "link": "https://stackoverflow.com/questions/41132279/where-does-persiststorewrite-basebackend-x-constraint-come-from-when-using-gen/41159542#41159542", "title": "Where does PersistStoreWrite (BaseBackend x) constraint come from when using generic Persistent?", "body": "<p>The strange thing was, also the <code>get</code> method required the <code>BaseBackend</code> write. As hinted by @snoyman, this is partly due to the generated TH code. Part of the TH-generated splice:</p>\n\n<pre><code>instance PersistStore backend =&gt;\n         PersistEntity (TaskItemGeneric backend) where\n    type PersistEntityBackend (TaskItemGeneric backend) = backend\n</code></pre>\n\n<p>Note that <code>PersistStore</code> is an alias to <code>PersistStoreWrite</code>. This, in combination with the constraint <code>PersistRecordBackend record backend</code> on the <code>get</code> method of <code>PersistStoreRead</code>, which expands to:</p>\n\n<pre><code>type PersistRecordBackend record backend =\n    (PersistEntity record, PersistEntityBackend record ~ BaseBackend backend) \n</code></pre>\n\n<p>indeed results in the inferred constraint <code>PersistStoreWrite (BaseBackend backend)</code>.</p>\n\n<p><strong>Solution</strong></p>\n\n<p>In fact this is trivial - a sensible <code>BaseBackend</code> should always support writes. So I just added aliases for the constraints:</p>\n\n<pre><code>type PersistRead b = (PersistStoreRead b, PersistStoreWrite (BaseBackend b))\ntype PersistWrite b = (PersistRead b, PersistStoreWrite b)\n</code></pre>\n\n<p>so</p>\n\n<pre><code>x :: (MonadIO m, PersistWrite b) =&gt; ReaderT b m ()\nx = do\n    now &lt;- liftIO getCurrentTime\n    aTaskId &lt;- insert (TaskItem \"Hello\" now)\n    aTask &lt;- get aTaskId\n    liftIO (print aTask)\n</code></pre>\n"}], "owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 41159542, "answer_count": 1, "score": 1, "last_activity_date": 1481790441, "creation_date": 1481671390, "question_id": 41132279, "link": "https://stackoverflow.com/questions/41132279/where-does-persiststorewrite-basebackend-x-constraint-come-from-when-using-gen", "title": "Where does PersistStoreWrite (BaseBackend x) constraint come from when using generic Persistent?", "body": "<p>While toying around with <code>persistent</code>, I can't figure out where does the <code>PersistStoreWrite (BaseBackend b)</code> constraint come from. I can't see it on the signature of <a href=\"https://www.stackage.org/haddock/lts-7.12/persistent-2.6/Database-Persist-Class.html#v:insert\" rel=\"nofollow noreferrer\"><code>insert</code></a>.</p>\n\n<pre><code>x :: (\n    MonadIO m,\n    PersistStoreRead b,\n    PersistStoreWrite b,\n    PersistStoreWrite (BaseBackend b)      -- &lt;--- where does this come from?\n    ) =&gt; ReaderT b m ()\nx = do\n    now &lt;- liftIO getCurrentTime\n    aTaskId &lt;- insert (TaskItem \"Hello\" now)\n    aTask &lt;- get aTaskId\n    liftIO (print aTask)\n</code></pre>\n\n<p>The above works fine, but if I remove the mentioned constraint, the compiler complains (\"arising from a use of <code>insert</code>\"). \nI'm using stack with lts-7.12 resolver (GHC 8, persistent 2.6).</p>\n\n<p>Data definition for the record:</p>\n\n<pre><code>share [mkPersist sqlSettings{mpsGeneric = True}, mkMigrate \"migrateAll\"] [persistLowerCase|\nTaskItem\n    name Text\n    submittedAt UTCTime\n    deriving Show\n</code></pre>\n"}, {"tags": ["haskell", "cabal", "servant"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1481670742, "post_id": 41131842, "comment_id": 69468560, "body": "One of your errors is <code>Variable not in scope: runClientM</code>. <code>runClientM</code>, which is exported by <code>Servant.Client</code>, was introduced in Servant 0.9 (cf. <a href=\"https://hackage.haskell.org/package/servant-client-0.9.1.1/changelog\" rel=\"nofollow noreferrer\">the changelog</a> and the Haddock indexes for <a href=\"https://hackage.haskell.org/package/servant-client-0.8.1/docs/doc-index.html\" rel=\"nofollow noreferrer\"><i>servant-client</i> 0.8.1</a> and <a href=\"https://hackage.haskell.org/package/servant-client-0.9.1.1/docs/doc-index.html\" rel=\"nofollow noreferrer\"><i>servant-client</i> 0.9.1.1</a>). Are you sure that you are using the latest version of Servant?"}, {"owner": {"reputation": 21, "user_id": 5977562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55804be0ed8f2ea4691f90af2b3a59f4?s=128&d=identicon&r=PG&f=1", "display_name": "tjsdn", "link": "https://stackoverflow.com/users/5977562/tjsdn"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481672303, "post_id": 41131842, "comment_id": 69469028, "body": "@duplode I have servant-client in my .cabal . Would this use the latest version? I tried to add servant-client &gt;= 0.9 and got the following : Failure when adding dependencies:           servant-client: needed (&gt;=0.9), 0.8.1 found (latest applicable is 0.9.1.1)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1481672944, "post_id": 41131842, "comment_id": 69469204, "body": "Adding <code>servant-client &gt;= 0.9</code> to the .cabal file is the right thing to do -- now <i>cabal-install</i> demands the version you actually need. The new error message tells you that you currently have 0.8.1, and need to install 0.9.1.1. <code>cabal install servant</code> should do the trick. (Note: What I have just said assumes that you are using just <i>cabal-install</i>, and not <i>stack</i>, to manage your packages and project. If you never heard of <i>stack</i>, you can safely ignore this note.)"}, {"owner": {"reputation": 21, "user_id": 5977562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55804be0ed8f2ea4691f90af2b3a59f4?s=128&d=identicon&r=PG&f=1", "display_name": "tjsdn", "link": "https://stackoverflow.com/users/5977562/tjsdn"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481675080, "post_id": 41131842, "comment_id": 69469833, "body": "@duplode Thanks so much that was the issue!"}, {"owner": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1583920508, "post_id": 41131842, "comment_id": 107271089, "body": "@duplode move that to answer :)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 3683, "user_id": 330242, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c9f3ffc3e30d25eb64e2e464f0a86bd7?s=128&d=identicon&r=PG", "display_name": "przemo_li", "link": "https://stackoverflow.com/users/330242/przemo-li"}, "edited": false, "score": 0, "creation_date": 1585621273, "post_id": 41131842, "comment_id": 107819289, "body": "@przemo_li Done. Not sure why I didn&#39;t do that back then; thanks for the reminder."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1585621233, "creation_date": 1585621233, "answer_id": 60942465, "question_id": 41131842, "link": "https://stackoverflow.com/questions/41131842/haskell-servant-client-tutorial/60942465#60942465", "title": "Haskell Servant client tutorial", "body": "<p>The first \"not in scope\" error here mentions a <code>ClientM</code> type which, according to <a href=\"https://hackage.haskell.org/package/servant-client-0.17/changelog\" rel=\"nofollow noreferrer\">the <em>servant-client</em> changelog</a>, was introduced by the 0.9 version of <em>servant-client</em>. Specifying <code>servant-client &gt;= 0.9</code> in the .cabal file dependencies will ensure cabal-install won't pull an older version (though note that, as of March 2020, 0.9 itself is quite old already). With cabal-install version 3, no further configuration steps should be necessary, as <code>cabal build</code> will automatically install any specified dependencies.</p>\n"}], "owner": {"reputation": 21, "user_id": 5977562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55804be0ed8f2ea4691f90af2b3a59f4?s=128&d=identicon&r=PG&f=1", "display_name": "tjsdn", "link": "https://stackoverflow.com/users/5977562/tjsdn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 994, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1585621443, "creation_date": 1481669013, "last_edit_date": 1585621443, "question_id": 41131842, "link": "https://stackoverflow.com/questions/41131842/haskell-servant-client-tutorial", "title": "Haskell Servant client tutorial", "body": "<p>I am new to Haskell and Servant and am trying to get an official tutorial up and running. I have been trying to get this tutorial working to have a look at it and have been unable to get it working all day.I hate to post a question like this here but I honestly don't know why the code isn't working as I have made no changes to it. I am wondering has anyone else tried to implement this tutorial and has similar issues.</p>\n\n<p>I have seen posts about some tutorials not working with with current servant versions anymore but this tutorial seems to be the most recent for Servant Client.</p>\n\n<p>This is the tutorial <a href=\"http://haskell-servant.readthedocs.io/en/stable/tutorial/Client.html\" rel=\"nofollow noreferrer\">http://haskell-servant.readthedocs.io/en/stable/tutorial/Client.html</a></p>\n\n<p>Here is the code</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE TypeOperators #-}\n\nmodule Client where\n\nimport Data.Aeson\nimport Data.Proxy\nimport GHC.Generics\nimport Network.HTTP.Client (newManager, defaultManagerSettings)\nimport Servant.API\nimport Servant.Client\n\ndata Position = Position\n  { x :: Int\n  , y :: Int\n  } deriving (Show, Generic)\n\ninstance FromJSON Position\n\nnewtype HelloMessage = HelloMessage { msg :: String }\n  deriving (Show, Generic)\n\ninstance FromJSON HelloMessage\n\ndata ClientInfo = ClientInfo\n  { clientName :: String\n  , clientEmail :: String\n  , clientAge :: Int\n  , clientInterestedIn :: [String]\n  } deriving Generic\n\ninstance ToJSON ClientInfo\n\ndata Email = Email\n  { from :: String\n  , to :: String\n  , subject :: String\n  , body :: String\n  } deriving (Show, Generic)\n\ninstance FromJSON Email\n\ntype API = \"position\" :&gt; Capture \"x\" Int :&gt; Capture \"y\" Int :&gt; Get '[JSON] Position\n      :&lt;|&gt; \"hello\" :&gt; QueryParam \"name\" String :&gt; Get '[JSON] HelloMessage\n      :&lt;|&gt; \"marketing\" :&gt; ReqBody '[JSON] ClientInfo :&gt; Post '[JSON] Email\n\nposition :: Int -&gt; Int -&gt; ClientM Position\n\nhello :: Maybe String -&gt; ClientM HelloMessage\n\nmarketing :: ClientInfo -&gt; ClientM Email\n\napi :: Proxy API\napi = Proxy\n\nposition :&lt;|&gt; hello :&lt;|&gt; marketing = client api\n\nqueries :: ClientM (Position, HelloMessage, Email)\nqueries = do\n  pos &lt;- position 10 10 \n  message &lt;- hello (Just \"servant\") \n  em  &lt;- marketing (ClientInfo \"Alp\" \"alp@foo.com\" 26 [\"haskell\", \"mathematics\"])\n  return (pos, message, em)\n\nrun :: IO ()\nrun = do\n  manager &lt;- newManager defaultManagerSettings\n  res &lt;- runClientM queries (ClientEnv manager (BaseUrl Http \"localhost\" 8081 \"\"))\n  case res of\n    Left err -&gt; putStrLn $ \"Error: \" ++ show err\n    Right (pos, message, em) -&gt; do\n      print pos\n      print message\n      print em\n</code></pre>\n\n<p>Here are the errors I am getting</p>\n\n<blockquote>\n<pre><code>Couldn't match type \u2018http-client-0.4.31.2:Network.HTTP.Client.Types.Manager\n                           -&gt; BaseUrl -&gt; ClientM Position\u2019\n                     with \u2018Control.Monad.Trans.Except.ExceptT ServantError IO Position\u2019\n      Expected type: Int -&gt; Int -&gt; ClientM Position\n        Actual type: Int\n                     -&gt; Int\n                     -&gt; http-client-0.4.31.2:Network.HTTP.Client.Types.Manager\n                     -&gt; BaseUrl\n                     -&gt; ClientM Position\n    \u2022 When checking that the inferred type\n        position :: Int\n                    -&gt; Int\n                    -&gt; http-client-0.4.31.2:Network.HTTP.Client.Types.Manager\n                    -&gt; BaseUrl\n                    -&gt; ClientM Position\n      is as general as its signature\n        position :: Int -&gt; Int -&gt; ClientM Position\n\n\nVariable not in scope:\n      runClientM\n        :: ClientM (Position, HelloMessage, Email)\n           -&gt; t0 -&gt; IO (Either a0 (a1, a2, a3))\n\n\nData constructor not in scope:\n      ClientEnv\n        :: http-client-0.4.31.2:Network.HTTP.Client.Types.Manager\n           -&gt; BaseUrl -&gt; t0\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1481668314, "post_id": 41130707, "comment_id": 69467710, "body": "What if you just add the constraint it says is missing?"}, {"owner": {"reputation": 77, "user_id": 5590652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25b18bd69ee7f07ba0111c60f61a0902?s=128&d=identicon&r=PG&f=1", "display_name": "John Lavelle", "link": "https://stackoverflow.com/users/5590652/john-lavelle"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481671669, "post_id": 41130707, "comment_id": 69468832, "body": "The type of <code>s</code> is ambiguous"}], "answers": [{"tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1481719370, "creation_date": 1481719370, "answer_id": 41142976, "question_id": 41130707, "link": "https://stackoverflow.com/questions/41130707/how-can-i-generalize-this-in-place-selection-sort/41142976#41142976", "title": "How can I generalize this in-place Selection Sort?", "body": "<p>The class API for <code>array</code> unfortunately doesn't properly hide the <code>s</code> state parameter. When you write <code>runSTUArray action</code>, the <code>action</code> takes as input an <code>s</code> type parameter. In the type annotation for <code>selectionSort</code> we would have to write <code>MArray (STUArray s) a (ST s)</code>, but this isn't meaningful, since the <code>s</code> parameter used inside the runned action isn't even in scope here. Mentioning <code>s</code> here just introduces a new different <code>s</code> parameter, hence the ambiguity error. </p>\n\n<p>The <a href=\"https://hackage.haskell.org/package/constraints-0.8\" rel=\"nofollow noreferrer\"><code>constraint</code></a> package has a nice solution for this sort of thing. With <code>Forall</code> from <a href=\"https://hackage.haskell.org/package/constraints-0.8/docs/Data-Constraint-Forall.html\" rel=\"nofollow noreferrer\"><code>Data.Constraint.Forall</code></a> we can express that a constraint has to hold for an arbitrary choice for a type parameter. In our case, we can express that <code>MArray (STUArray s) a (ST s)</code> has to hold for arbitrary <code>s</code>, and inside the <code>ST</code> action we can instantiate the quantified constraint to the specific <code>s</code> that we need.</p>\n\n<pre><code>{-# language UndecidableInstances, ScopedTypeVariables #-}\n\nimport Data.STRef\nimport Control.Monad\nimport Control.Monad.ST.Strict\nimport Data.Constraint.Forall\nimport Data.Constraint\nimport Data.Proxy\n</code></pre>\n\n<p>First, we have to create a wrapper class that we can plug into <code>Forall</code>.</p>\n\n<pre><code>class    (MArray (STUArray s) a (ST s)) =&gt; MArray' a s\ninstance (MArray (STUArray s) a (ST s)) =&gt; MArray' a s\n</code></pre>\n\n<p>Now <code>Forall (MArray' a)</code> becomes a constraint from which we can generate <code>MArray' a s</code> constraints for arbitrary <code>s</code>, and <code>MArray' a s</code> implies by superclassing the <code>MArray (STUArray s) a (ST s)</code> constraint (which we actually need).</p>\n\n<p>For convenience we need an alternate runner function which makes the <code>s</code> input type parameter more explicit, so we can refer to it in the body:</p>\n\n<pre><code>runSTUArray' :: (forall s. Proxy s -&gt; ST s (STUArray s i e)) -&gt; UArray i e\nrunSTUArray' f = runSTUArray (f Proxy)\n</code></pre>\n\n<p>The general <code>selectionSort</code> can be written now, and we observe that it can be specialized to the previous type:</p>\n\n<pre><code>selectionSort ::\n  forall i a.\n  (IArray UArray a, Ord a, Ix i, Enum i, Forall (MArray' a))\n  =&gt; UArray i a -&gt; UArray i a\nselectionSort arr = runSTUArray' $ \\(s :: Proxy s) -&gt; do\n  let (l, n) = bounds arr\n\n  -- we use \"inst\" and a type annotation on its result to instantiate\n  -- the Forall constraint to the current \"s\"\n  case inst of\n    (Sub (Dict :: Dict (MArray' a s))) -&gt; do\n\n      a &lt;- thaw arr\n      forM_ [l..n] $ \\i -&gt; do\n        minIdx &lt;- newSTRef i\n        forM_ [i..n] $ \\j -&gt; do\n          currentMin &lt;- readSTRef minIdx\n          jVal &lt;- readArray a j\n          minVal &lt;- readArray a currentMin\n          when (jVal &lt; minVal) (writeSTRef minIdx j)\n        currentMin &lt;- readSTRef minIdx\n        iVal &lt;- readArray a i\n        minVal &lt;- readArray a currentMin\n        writeArray a i minVal\n        writeArray a currentMin iVal\n      return a\n\nselectionSort' :: UArray Int Int -&gt; UArray Int Int\nselectionSort' = selectionSort\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 5590652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25b18bd69ee7f07ba0111c60f61a0902?s=128&d=identicon&r=PG&f=1", "display_name": "John Lavelle", "link": "https://stackoverflow.com/users/5590652/john-lavelle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 1, "accepted_answer_id": 41142976, "answer_count": 1, "score": 4, "last_activity_date": 1481719370, "creation_date": 1481663880, "question_id": 41130707, "link": "https://stackoverflow.com/questions/41130707/how-can-i-generalize-this-in-place-selection-sort", "title": "How can I generalize this in-place Selection Sort?", "body": "<p>Below is an implementation of a selection sort in the <code>ST</code> Monad. The input array is copied to a <code>STUArray s Int Int</code> with <code>thaw</code>, then the copy is sorted in-place. </p>\n\n<pre><code>selectionSort :: UArray Int Int -&gt; UArray Int Int\nselectionSort arr = runSTUArray $ do\n  let (l, n) = bounds arr\n  a &lt;- thaw arr\n  forM_ [l..n] $ \\i -&gt; do\n    minIdx &lt;- newSTRef i\n    forM_ [i..n] $ \\j -&gt; do\n      currentMin &lt;- readSTRef minIdx\n      jVal &lt;- readArray a j\n      minVal &lt;- readArray a currentMin\n      when (jVal &lt; minVal) (writeSTRef minIdx j)\n    currentMin &lt;- readSTRef minIdx\n    iVal &lt;- readArray a i\n    minVal &lt;- readArray a currentMin\n    writeArray a i minVal\n    writeArray a currentMin iVal\n  return a\n</code></pre>\n\n<p>Using <code>FlexibleContexts</code>, I would like to generalize the type to:</p>\n\n<pre><code>(IArray UArray a, Ord a, Ix i, Enum i) =&gt; UArray i a -&gt; UArray i a\n</code></pre>\n\n<p>However, this causes the following type error:</p>\n\n<pre><code>Could not deduce (MArray (STUArray s) a (ST s))\n  arising from a use of `thaw'\nfrom the context (IArray UArray a, Ord a, Ix i, Enum i)\n</code></pre>\n\n<p>How can I change the constraints of <code>selectionSort</code> to allow this generalization?</p>\n"}, {"tags": ["haskell", "template-haskell"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 1, "last_activity_date": 1482822491, "creation_date": 1482822491, "answer_id": 41340606, "question_id": 41130619, "link": "https://stackoverflow.com/questions/41130619/templatehaskell-class-name-with-conflict-newname/41340606#41340606", "title": "TemplateHaskell class name with conflict newName", "body": "<p><code>newName</code> doesn't work the way you're imagining.  It <em>doesn't</em> create a random unused symbol using the supplied string merely as a prefix, and -- as far as I can tell -- Template Haskell doesn't have a standard function to do that.  However you can get the equivalent effect with:</p>\n\n<pre><code>gensym :: String -&gt; Q Name\ngensym pfx = mkName . show &lt;$&gt; newName pfx\n</code></pre>\n\n<p>which should work for your anonymous classes:</p>\n\n<pre><code>test :: Q [Dec]\ntest = do\n  clsname &lt;- gensym \"A\"   -- use gensym here\n  a &lt;- newName \"a\"        -- this is fine, though\n  return [\n    ClassD [] clsname [PlainTV a] [][]\n    ]\n</code></pre>\n\n<p>If you're interested in the longer explanation, what <code>newName</code> <strong>does</strong> do is create a name that cannot be captured by \"deeper\" bindings, but it does this by attaching additional information to the created <code>Name</code> object, not by mangling the actual name.  If such a <code>Name</code> is used to create a binding, the binding uses the original <strong>supplied</strong> name, not a mangled version.</p>\n\n<p>To see this, note first that the <code>Name</code> created by <code>mkName</code> has more structure than its printable representation suggests:</p>\n\n<pre><code>GHCi&gt; :m Language.Haskell.TH Language.Haskell.TH.Syntax\nGHCi&gt; nm &lt;- runQ (newName \"foo\")\nGHCi&gt; nm\nfoo_16\nGHCi&gt; let Name occname nmtype = nm\nGHCi&gt; occname\nOccName \"foo\"\nGHCi&gt; nmtype\nNameU 16\nGHCi&gt; \n</code></pre>\n\n<p>Second, note that the quotation:</p>\n\n<pre><code>[d| one = 1 |]\n</code></pre>\n\n<p>is equivalent to the following do-block using <code>newName</code>:</p>\n\n<pre><code>do nm &lt;- newName \"one\"\n   decl &lt;- valD (varP nm) (normalB (litE (integerL 1))) []\n   return [decl]\n</code></pre>\n\n<p>so you can write the following:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n\nimport Language.Haskell.TH\n\n$(do nm &lt;- newName \"one\"\n     decl &lt;- valD (varP nm) (normalB (litE (integerL 1))) []\n     return [decl])\n\nmain = print one\n</code></pre>\n\n<p>illustrating that the \"one\" name created by <code>newName</code> can be used to create a top-level binding that is referenced in the <code>main</code> function using its plain, unadorned, name: <code>one</code>.   (If you created an extra copy of the splice here, you'd get the same \"multiple declarations\" error you got with your classes.)</p>\n"}], "owner": {"reputation": 7714, "user_id": 149901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d1a6db7a9fb5385fde6ba426e27d5ac6?s=128&d=identicon&r=PG", "display_name": "ondra", "link": "https://stackoverflow.com/users/149901/ondra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 41340606, "answer_count": 1, "score": 1, "last_activity_date": 1482822491, "creation_date": 1481663538, "last_edit_date": 1481663914, "question_id": 41130619, "link": "https://stackoverflow.com/questions/41130619/templatehaskell-class-name-with-conflict-newname", "title": "TemplateHaskell class name with conflict newName", "body": "<p>I have a TemplateHaskell function creating a class name:</p>\n\n<pre><code>test :: Q [Dec]\ntest = do\n  clsname &lt;- newName \"A\"\n  a &lt;- newName \"a\"\n  return [\n    ClassD [] clsname [PlainTV a] [][]\n    ]\n</code></pre>\n\n<p>The classname is generated with <code>newName</code>, so should be conflict free (the reason is I create the instances directly in TH and don't need it to be visible).</p>\n\n<pre><code>test\ntest\n\nSchema.hs:27:1: error:\n    Multiple declarations of \u2018A\u2019\n    Declared at: Schema.hs:26:1\n                 Schema.hs:27:1\n</code></pre>\n\n<p>However testing it with Debug.Trace, the name of <code>A</code> is indeed something like <code>A_1627476119</code>. This is the same in both GHC 7.10.3 and GHC8. Is this a bug or do I understand it wrong?</p>\n"}, {"tags": ["haskell", "haskell-lens", "state-monad"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481669513, "post_id": 41130226, "comment_id": 69468124, "body": "This is essentially a duplicate of <a href=\"http://stackoverflow.com/questions/29407289/lens-zooming-newtype\">this question</a>."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481669750, "post_id": 41130226, "comment_id": 69468219, "body": "I saw that one, but was still a little confused, they give a solution, but don&#39;t explain it very clearly."}], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1481671247, "post_id": 41131823, "comment_id": 69468708, "body": "I&#39;ll try this out! Thanks! Would you be able to explain the <code>type instance</code> line a little more in depth? I haven&#39;t learned type families yet :P Also, why do we need undecidable instances? And lastly, why do I need both a type family <code>Zoomed</code> and the Zoom instance? I&#39;d love to understand why it all works and why it&#39;s all required. Cheers! :)"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 1, "creation_date": 1481671890, "post_id": 41131823, "comment_id": 69468899, "body": "@Chris Penner Type families are a bit like functions at the type level. They take a type (in our case <code>BufAction</code>) and produce another type (in our case <code>Zoomed (StateT Buffer IO)</code>). They have some particularities compared to regular functions: the syntax is not the same, the different &quot;cases&quot; can be dispersed in different modules, and so on. You can &quot;run&quot; a type family in <code>ghci</code> using the <code>:kind!</code> command, like <code>:kind! Zoomed (StateT Buffer IO)</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 1, "creation_date": 1481672091, "post_id": 41131823, "comment_id": 69468963, "body": "@Chris Penner <code>UndecidableInstances</code> is required because when dealing with complex instance definitions GHC can be unsure about if typechecking can terminate. Turning on <code>UndecidableInstances</code> says &quot;compiler, don&#39;t worry about non-terminating typechecking, if it takes too long I will just Ctrl-C and be done with it.&quot; It&#39;s not a harmful extension, if typechecking actually terminates, of course."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1481669517, "last_edit_date": 1481669517, "creation_date": 1481668937, "answer_id": 41131823, "question_id": 41130226, "link": "https://stackoverflow.com/questions/41130226/how-to-zoom-a-monad-transformer/41131823#41131823", "title": "How to zoom a monad transformer?", "body": "<p>It seems that there is a <code>Zoomed</code> type family that is used to specify what kind of \"effect\" we will have when we zoom. In some cases, the <code>Zoomed</code> type instance for a monad transformer appears to piggyback on the <code>Zoomed</code> for the underlying monad, for example</p>\n\n<pre><code>type Zoomed (ReaderT * e m) = Zoomed m\n</code></pre>\n\n<p>Given that <code>Alteration</code> and <code>BufAction</code> are just newtypes over a state transformer, perhaps we could do the same:</p>\n\n<pre><code>{-# language TypeFamilies #-}\n{-# language UndecidableInstances #-}\n{-# language MultiParamTypeClasses #-}    \n\ntype instance Zoomed BufAction = Zoomed (StateT Buffer IO)\n</code></pre>\n\n<p>Then we must provide the <code>Zoom</code> instance. <code>Zoom</code> is a multi-parameter typeclass and the four parameters seem to be <em>original monad</em>, <em>zoomed out monad</em>, <em>original state</em>, <em>zoomed out state</em>:</p>\n\n<pre><code>instance Zoom BufAction Alteration Buffer Store where\n    zoom f (BufAction a) = Alteration (zoom f a)\n</code></pre>\n\n<p>We just unwrap <code>BufAction</code>, zoom with the underlying monad, and wrap as <code>Alteration</code>.</p>\n\n<p>This basic test typechecks:</p>\n\n<pre><code>foo :: Alteration ()\nfoo = zoom (editor.buffers.traversed) (return () :: BufAction ())\n</code></pre>\n\n<hr>\n\n<p>I believe you could avoid defining the <code>Zoom</code> instance and have a special-purpose <code>zoomBufActionToAlteration</code> function</p>\n\n<pre><code>zoomBufActionToAlteration :: LensLike' (Zoomed (StateT Buffer IO) a) Store Buffer \n                          -&gt; BufAction a \n                          -&gt; Alteration a\nzoomBufActionToAlteration f (BufAction a) = Alteration (zoom f a)       \n</code></pre>\n\n<p>But then if you have a lot of different zoomable things it can be a chore to remember the name of each zoom funcion. That's where the typeclass can help.</p>\n"}, {"comments": [{"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1481673114, "post_id": 41132289, "comment_id": 69469247, "body": "This works great! I appreciate the explanation along with @danidiaz&#39;s answer of course, it&#39;s nice to learn about type families finally! But is there any reason why I should use the type family wizardry instead of this solution?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1481673894, "post_id": 41132289, "comment_id": 69469460, "body": "Yes, it is, if you want to add possibility to use the <code>zoom</code> or somthing like the <code>zoomBufActionToAlteration</code>. This reason maybe (as wrote @danidiaz) if you have a lot of different zoomable things."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 3, "last_activity_date": 1481671469, "creation_date": 1481671469, "answer_id": 41132289, "question_id": 41130226, "link": "https://stackoverflow.com/questions/41130226/how-to-zoom-a-monad-transformer/41132289#41132289", "title": "How to zoom a monad transformer?", "body": "<p>As additional to the answer @danidiaz.</p>\n\n<hr>\n\n<p>Basically, you can avoid <code>Zoom</code> instance by this way:</p>\n\n<pre><code>bufDo :: BufAction () -&gt; Alteration ()\nbufDo = Alteration . zoom (editor . buffers . traverse) . runBufAction\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 2, "accepted_answer_id": 41131823, "answer_count": 2, "score": 4, "last_activity_date": 1481671469, "creation_date": 1481661839, "question_id": 41130226, "link": "https://stackoverflow.com/questions/41130226/how-to-zoom-a-monad-transformer", "title": "How to zoom a monad transformer?", "body": "<p>thanks again for the help!</p>\n\n<p>I'm making extensive use of the E. Kmett's Lens library, to avoid X/Y problems I'll explain a bit of context.</p>\n\n<p>I'm working on an extensible text editor and want to provide extension writers with a monad DSL, an <code>Alteration</code> is a monad transformer stack with a StateT over the <code>Store</code> type, which basically stores the whole text editor. Inside the <code>Store</code> is an <code>Editor</code> which has <code>Buffer</code>s. Users can specify an <code>Alteration</code> to act over the whole store, but to simplify things I also provide a <code>BufAction</code> which operates over just a single buffer.</p>\n\n<p>I was planning on implementing this by using a helper called <code>bufDo</code> which runs a <code>BufAction</code> over each <code>Buffer</code>, and a <code>focusDo</code> which runs a <code>BufAction</code> on the 'focused' <code>Buffer</code>. Here's some context:</p>\n\n<pre><code>data Store = Store\n  { _event :: [Event]\n  , _editor :: E.Editor\n  , _extState :: Map TypeRep Ext\n  } deriving (Show)\n\ndata Editor = Editor {\n    _buffers :: [Buffer]\n  , _focused :: Int\n  , _exiting :: Bool\n} deriving Show\n\ndata Buffer = Buffer\n  { _text :: T.Text\n  , _bufExts :: Map TypeRep Ext\n  , _attrs :: [IAttr]\n  }\n\nnewtype Alteration a = Alteration\n  { runAlt :: StateT Store IO a\n  } deriving (Functor, Applicative, Monad, MonadState Store, MonadIO)\n\nnewtype BufAction a = BufAction \n  { runBufAction::StateT Buffer IO a\n  } deriving (Functor, Applicative, Monad, MonadState Buffer, MonadIO)\n</code></pre>\n\n<p>Here's my proposed implementations for <code>bufDo</code> and <code>focusDo</code>:</p>\n\n<pre><code>bufDo :: ???\nbufDo = zoom (buffers.traverse)\n\n-- focusedBuf is a Lens' over the focused buffer (I just 'force' the traversal using ^?! in case you're wondering)\nfocusDo :: ???\nfocusDo = zoom focusedBuf\n</code></pre>\n\n<p>This makes sense in my head and gets close to type-checking, but when I try to add a type for them I get a bit confused, ghc suggests a few things and I ended up with this, which is far from elegant:</p>\n\n<pre><code>bufDo :: (Applicative (Zoomed BufAction ()), Zoom BufAction Alteration Buffer Store) =&gt; BufAction () -&gt; Alteration ()\n\nfocusDo :: (Functor (Zoomed BufAction ()), Zoom BufAction Alteration Buffer Store) =&gt; BufAction () -&gt; Alteration ()\n</code></pre>\n\n<p>Which makes ghc happy for those definitions, but when I try to actually use either of them I get these errors:</p>\n\n<pre><code>    - No instance for (Functor (Zoomed BufAction ()))\n    arising from a use of \u2018focusDo\u2019\n\n    - No instance for (Applicative (Zoomed BufAction ()))\n    arising from a use of \u2018bufDo\u2019\n</code></pre>\n\n<p>Looking around it seems like I may need to specify an instance for Zoom, but I'm not sure quite how to do that.</p>\n\n<p>Anyone have ideas? I'd also love it if you could explain why I need a Zoom instance (if that's the case).</p>\n\n<p>Cheers!</p>\n"}, {"tags": ["haskell", "typeclass", "data-kinds"], "comments": [{"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1481665854, "post_id": 41130040, "comment_id": 69466610, "body": "I closed this as a duplicate of <a href=\"http://stackoverflow.com/questions/32408110/datakinds-and-type-class-instances\" title=\"datakinds and type class instances\">stackoverflow.com/questions/32408110/&hellip;</a> but reopened it. The separate <code>Foo</code> class constrained to only operate on <code>AB</code> might leave room for magic I can&#39;t imagine."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481670558, "post_id": 41132094, "comment_id": 69468502, "body": "Or <code>GHC.Exts.Any :: AB</code>."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481674497, "post_id": 41132094, "comment_id": 69469636, "body": "Interesting, I hadn&#39;t considered that all kinds might have a &quot;bottom&quot;, which would certainly put a damper on things semantically.  Then it makes sense to constrain to normal-form kinds, perhaps with a class <code>NF k</code>, which could then be used to provide the necessary dictionaries.  Hmmm....   anyway, thanks for the insight"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481675830, "post_id": 41132094, "comment_id": 69470030, "body": "@luqui, a singleton will do. <code>data ABy x where Ay :: ABy &#39;A; By :: ABy &#39;B</code>. If you like, <code>class KnownAB x where knownAB :: ABy x</code>. Pattern matching on <code>knownAB</code> lets you use the instances."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1481705778, "post_id": 41132094, "comment_id": 69479921, "body": "@luqui, you can use a singleton like <b>dfeuer</b> suggested, but also get rid of explicit pattern matching like <a href=\"http://lpaste.net/349915\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1481711265, "post_id": 41132094, "comment_id": 69483184, "body": "More on stuck type families <a href=\"https://typesandkinds.wordpress.com/2015/09/09/what-are-type-families/\" rel=\"nofollow noreferrer\">on Richard Eisenberg&#39;s blog</a>"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1481670298, "creation_date": 1481670298, "answer_id": 41132094, "question_id": 41130040, "link": "https://stackoverflow.com/questions/41130040/typeclass-instantiated-on-every-value-of-a-data-kind/41132094#41132094", "title": "Typeclass instantiated on every value of a data kind", "body": "<p>No, you can't do that. The primary problem is that, as you mention, there's nothing there to get you a dictionary. But the other problem is that your claim that every type in <code>AB</code> is an instance of <code>Foo</code> is false.</p>\n\n<pre><code>type family Broken :: AB where\n</code></pre>\n"}], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 41132094, "answer_count": 1, "score": 3, "last_activity_date": 1481670298, "creation_date": 1481661060, "last_edit_date": 1481661495, "question_id": 41130040, "link": "https://stackoverflow.com/questions/41130040/typeclass-instantiated-on-every-value-of-a-data-kind", "title": "Typeclass instantiated on every value of a data kind", "body": "<p>Is it possible to specify that every member of a datakind satisfies a typeclass, such that the class constraint is implied?  E.g.</p>\n\n<pre><code>data AB = A | B\nclass Foo (a :: AB) where get :: proxy a -&gt; String\ninstance Foo A where get _ = \"A\"\ninstance Foo B where get _ = \"B\"\n\n-- note lack of constraint here\nget' :: proxy (a :: AB) -&gt; String\nget' = get\n</code></pre>\n\n<p>Basically <code>a</code> is an <code>AB</code> so we're sure there's an instance of <code>Foo</code> for it.\nI find it unlikely -- where is it going to get the <code>Foo</code> dictionary? -- but I've seen some magic in my day.</p>\n"}, {"tags": ["haskell", "hunit"], "answers": [{"comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 618, "user_id": 3712254, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0a88228c246d0e8e2bbb92c9c0af3a45?s=128&d=identicon&r=PG&f=1", "display_name": "bantmen", "link": "https://stackoverflow.com/users/3712254/bantmen"}, "edited": false, "score": 0, "creation_date": 1481652741, "post_id": 41127693, "comment_id": 69459614, "body": "Yes, assuming you&#39;re using <code>error</code> to produce values of type <code>IO</code>. I&#39;ve updated the answer to include this."}, {"owner": {"reputation": 618, "user_id": 3712254, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0a88228c246d0e8e2bbb92c9c0af3a45?s=128&d=identicon&r=PG&f=1", "display_name": "bantmen", "link": "https://stackoverflow.com/users/3712254/bantmen"}, "edited": false, "score": 0, "creation_date": 1481653163, "post_id": 41127693, "comment_id": 69459832, "body": "Thank you. I am probably missing something obvious but when I enter your code into repl I get an error for <code>throws io = ...</code>:  <code>Illegal type signature: &#39;SomeException&#39;       Type signatures are only allowed in patterns with ScopedTypeVariables</code>"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 618, "user_id": 3712254, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0a88228c246d0e8e2bbb92c9c0af3a45?s=128&d=identicon&r=PG&f=1", "display_name": "bantmen", "link": "https://stackoverflow.com/users/3712254/bantmen"}, "edited": false, "score": 0, "creation_date": 1481653271, "post_id": 41127693, "comment_id": 69459887, "body": "Sorry, I forgot I have some GHC extensions enabled by default in my <code>~&#47;.ghc&#47;ghci.conf</code>. Use <code>:set -XScopedTypeVariables</code> in the repl to enable that one."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 2, "last_activity_date": 1481653178, "last_edit_date": 1481653178, "creation_date": 1481652114, "answer_id": 41127693, "question_id": 41127482, "link": "https://stackoverflow.com/questions/41127482/unit-testing-for-exceptions/41127693#41127693", "title": "Unit testing for exceptions", "body": "<p>This isn't specific to HUnit, but you can write a function to check whether an <code>IO</code> value throws:</p>\n\n<pre><code>\u03bb&gt; :set -XScopedTypeVariables\n\u03bb&gt; import Control.Exception\n\u03bb&gt; import Data.Functor\n\u03bb&gt; import System.Environment\n\n\u03bb&gt; throws io = catch (io $&gt; False) $ \\(e :: SomeException) -&gt; pure True\nthrows :: IO a -&gt; IO Bool\n\n\u03bb&gt; sequence $ throws &lt;$&gt; [ getEnv \"HOME\", getEnv \"whatever\", error \"a\" ]\n[False,True,True]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 618, "user_id": 3712254, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0a88228c246d0e8e2bbb92c9c0af3a45?s=128&d=identicon&r=PG&f=1", "display_name": "bantmen", "link": "https://stackoverflow.com/users/3712254/bantmen"}, "edited": false, "score": 0, "creation_date": 1481652641, "post_id": 41127698, "comment_id": 69459570, "body": "I see. Unfortunately I needed it for the &#39;error&#39; case."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 618, "user_id": 3712254, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0a88228c246d0e8e2bbb92c9c0af3a45?s=128&d=identicon&r=PG&f=1", "display_name": "bantmen", "link": "https://stackoverflow.com/users/3712254/bantmen"}, "edited": false, "score": 0, "creation_date": 1481652764, "post_id": 41127698, "comment_id": 69459624, "body": "@cberkay Added. As long as you are willing to catch inside the <code>IO</code> monad, it is possible."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 2, "last_activity_date": 1481658410, "last_edit_date": 1481658410, "creation_date": 1481652132, "answer_id": 41127698, "question_id": 41127482, "link": "https://stackoverflow.com/questions/41127482/unit-testing-for-exceptions/41127698#41127698", "title": "Unit testing for exceptions", "body": "<p>If by an \"exception\" you mean <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception.html#t:Exception\" rel=\"nofollow noreferrer\"><code>Exception</code></a> and it is being thrown in some <code>IO</code> code, then you can use <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception.html#v:catch\" rel=\"nofollow noreferrer\"><code>catch</code> or <code>catches</code></a>. However, if you mean catching things like <code>error \"Something bad happened\"</code> <em>in pure code</em>, you are out of luck. If you are willing to do the handling in <code>IO</code>, you have more options:</p>\n\n<pre><code>ghci&gt; import Control.Exception\nghci&gt; catch (error \"Eek\") (\\(ErrorCallWithLocation msg _) -&gt; putStrLn msg) \nEek\n</code></pre>\n\n<hr>\n\n<p>From the Haskell 2010 report <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#x8-230003.1\" rel=\"nofollow noreferrer\">section 3</a>:</p>\n\n<blockquote>\n  <p>Errors during expression evaluation, denoted by \u22a5 (\u201cbottom\u201d), are indistinguishable by a Haskell program from non-termination. </p>\n</blockquote>\n\n<p>Here is another way to think about it: notice that the moment we try to evaluate a value that is \u22a5 (like <code>error \"Help!\"</code>) depends not on when this value was <em>created</em> but only when it was first <em>needed</em> (since Haskell is non-strict). A mechanism to catch this sort of error would then break referential transparency.</p>\n"}], "owner": {"reputation": 618, "user_id": 3712254, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0a88228c246d0e8e2bbb92c9c0af3a45?s=128&d=identicon&r=PG&f=1", "display_name": "bantmen", "link": "https://stackoverflow.com/users/3712254/bantmen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1481658410, "creation_date": 1481651318, "last_edit_date": 1481652978, "question_id": 41127482, "link": "https://stackoverflow.com/questions/41127482/unit-testing-for-exceptions", "title": "Unit testing for exceptions", "body": "<p>Can I write a test case with <code>Test.HUnit</code> that checks whether a call throws an exception?</p>\n\n<p>I only care whether it throws any error, regardless of what message it prints.</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 2, "creation_date": 1481649865, "post_id": 41126865, "comment_id": 69457942, "body": "Try leaving off the type signature to see what GHC deduces it to be.  It should be able to correctly identify all necessary constraints.  Many of the operators used in this function definition are from typeclasses, so you have to have your desired type implementing those type classes to gain access to them."}, {"owner": {"reputation": 737, "user_id": 2407334, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4acb5ca13fd1fdedeea0fc8d6f6bc95e?s=128&d=identicon&r=PG", "display_name": "user2407334", "link": "https://stackoverflow.com/users/2407334/user2407334"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1481650395, "post_id": 41126865, "comment_id": 69458272, "body": "@bheklilr Oh.. wow, I see. Thank you for your comment. I did try it. GHC gave me back <code>bmiTell :: (Fractional a, Ord a) =&gt; a -&gt; a -&gt; [Char]</code> as the type signature, which obviously works when I type it in my code : ). It makes a little bit more sense. I am still confused about why <code>bmiTell :: (Num a, Ord a) =&gt; a -&gt; a -&gt; [Char]</code> wont work. Is it because the <code>Num</code> typeclass contains complex numbers also? And I guess complex numbers can NOT be ordered?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1481652787, "post_id": 41126865, "comment_id": 69459635, "body": "@user2407334 <code>Num</code> is <i>too</i> general, and thus includes types like <code>Int</code> for which <code>&#47;</code> is not defined."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1481660708, "post_id": 41126865, "comment_id": 69463855, "body": "@user2407334 A <code>(Num a, Ord a)</code> constraint would just say that any type which happens to be an instance of both <code>Num</code> and <code>Ord</code> would be acceptable. The fact that <code>Complex Double</code> is a <code>Num</code> but not an <code>Ord</code>, or, for that matter, the fact that <code>Bool</code> is an <code>Ord</code> but not a <code>Num</code>, doesn&#39;t affect that."}], "answers": [{"comments": [{"owner": {"reputation": 2851, "user_id": 243089, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c504339686fb2092eba997ee8899131?s=128&d=identicon&r=PG", "display_name": "Victor Zamanian", "link": "https://stackoverflow.com/users/243089/victor-zamanian"}, "edited": false, "score": 1, "creation_date": 1610086823, "post_id": 41127104, "comment_id": 116026150, "body": "How can <code>Fractional</code> be enough when it doesn&#39;t provide <code>&lt;=</code>? Haskell newbie here."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2851, "user_id": 243089, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c504339686fb2092eba997ee8899131?s=128&d=identicon&r=PG", "display_name": "Victor Zamanian", "link": "https://stackoverflow.com/users/243089/victor-zamanian"}, "edited": false, "score": 1, "creation_date": 1610145758, "post_id": 41127104, "comment_id": 116049732, "body": "@VictorZamanian Indeed; <code>&lt;=</code> is provided by <a href=\"https://hackage.haskell.org/package/base-4.14.1.0/docs/Prelude.html#t:Ord\" rel=\"nofollow noreferrer\"><code>Ord</code></a>, which also constrains <code>a</code> in the  <code>bmiTell</code> signature I have suggested here."}, {"owner": {"reputation": 2851, "user_id": 243089, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c504339686fb2092eba997ee8899131?s=128&d=identicon&r=PG", "display_name": "Victor Zamanian", "link": "https://stackoverflow.com/users/243089/victor-zamanian"}, "edited": false, "score": 1, "creation_date": 1610146088, "post_id": 41127104, "comment_id": 116049827, "body": "Oh right, you have two typeclasses there, duh. Thanks!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 12, "last_activity_date": 1524628772, "last_edit_date": 1524628772, "creation_date": 1481650035, "answer_id": 41127104, "question_id": 41126865, "link": "https://stackoverflow.com/questions/41126865/what-is-realfloat-type-in-haskell-used-for/41127104#41127104", "title": "What is RealFloat type in Haskell used for?", "body": "<p>While <code>Num</code> is not enough, <code>RealFloat</code> is indeed excessive for this example. <code>Fractional</code>, which is necessary for <code>(/)</code>, is good enough:</p>\n\n<pre><code>GHCi&gt; :t (/)\n(/) :: Fractional a =&gt; a -&gt; a -&gt; a\n</code></pre>\n\n<p>An appropriate signature, then, would be:</p>\n\n<pre><code>bmiTell :: (Fractional a, Ord a) =&gt; a -&gt; a -&gt; String\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#t:RealFloat\" rel=\"noreferrer\"><code>RealFloat</code></a> is a class for floating point types, while <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#t:Fractional\" rel=\"noreferrer\"><code>Fractional</code></a> covers everything that supports real division. <code>Double</code> is a <code>RealFloat</code> (and also a <code>Fractional</code>, as that is a superclass of <code>RealFloat</code>). The <code>Ratio</code> type for rational numbers, available from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Ratio.html\" rel=\"noreferrer\"><code>Data.Ratio</code></a>, is an example of a <code>Fractional</code> that isn't a <code>RealFloat</code>.</p>\n\n<p>See also: <a href=\"https://stackoverflow.com/a/41130559/2751851\">Ben's answer</a>, which considers why the book might have used <code>RealFloat</code> rather than the arguably simpler alternative shown here. </p>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1481664211, "post_id": 41130559, "comment_id": 69465731, "body": "Good call on the likely rationale by the book author. I&#39;m not sure if it pays off (what is more costly: introducing a mildly esoteric class instead of a more obvious one, or making a side remark about a feature which is not being focused?), but it can be argued either way."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 9, "last_activity_date": 1481663233, "creation_date": 1481663233, "answer_id": 41130559, "question_id": 41126865, "link": "https://stackoverflow.com/questions/41126865/what-is-realfloat-type-in-haskell-used-for/41130559#41130559", "title": "What is RealFloat type in Haskell used for?", "body": "<p>In addition to <code>/</code> as noted in duplode's answer, you use non-integer literals like <code>18.5</code>. Those can't be used as every <code>Num</code> type (what would <code>18.5 :: Integer</code> be, for example?), so you can't promise that your function can handle any <code>Num</code> type the caller likes.</p>\n\n<p>I suspect the book uses <code>RealFloat</code> simply because it also implies <code>Ord</code> (via <code>RealFrac</code> and <code>Real</code>), so that it was only necessary to write a single constraint. Multiple constraints might have made the example look more complex and intimidating, with a feature that isn't the point of the exercise.</p>\n"}], "owner": {"reputation": 737, "user_id": 2407334, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4acb5ca13fd1fdedeea0fc8d6f6bc95e?s=128&d=identicon&r=PG", "display_name": "user2407334", "link": "https://stackoverflow.com/users/2407334/user2407334"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2517, "favorite_count": 2, "accepted_answer_id": 41127104, "answer_count": 2, "score": 11, "last_activity_date": 1524628772, "creation_date": 1481649273, "question_id": 41126865, "link": "https://stackoverflow.com/questions/41126865/what-is-realfloat-type-in-haskell-used-for", "title": "What is RealFloat type in Haskell used for?", "body": "<p>In the <strong>Learn You A Haskell</strong> book, there is an example about calculating your BMI. </p>\n\n<pre><code>bmiTell :: (RealFloat a) =&gt; a -&gt; a -&gt; String\nbmiTell weight height\n    | bmi &lt;= skinny = \"You're underweight, you emo, you!\"\n    | bmi &lt;= normal = \"You're supposedly normal. Pffft, I bet you're ugly!\"\n    | bmi &lt;= fat    = \"You're fat! Lose some weight, fatty!\"\n    | otherwise     = \"You're a whale, congratulations!\"\n    where bmi = weight / height ^ 2\n          (skinny, normal, fat) = (18.5, 25.0, 30.0)\n</code></pre>\n\n<p>When I tried to do this example by myself, I used <code>(Num a) =&gt; a -&gt; a -&gt; String</code> as the type signature for the method. However that threw the following error: </p>\n\n<pre><code>Could not deduce (Ord a) arising from a use of \u2018&lt;=\u2019\n    from the context (Num a)\n      bound by the type signature for\n                 bmiTell :: Num a =&gt; a -&gt; a -&gt; String\n      at scratch.hs:96:12-38\n    Possible fix:\n      add (Ord a) to the context of\n        the type signature for bmiTell :: Num a =&gt; a -&gt; a -&gt; String\n</code></pre>\n\n<p>I was not able to resolve the error just using the <code>Num</code> and <code>Ord</code> typeclasses. Why do I need to use <code>RealFloat</code> typeclass to make this piece of code work? What is so special about <code>RealFloat</code> that is not covered by <code>Num</code>?</p>\n"}, {"tags": ["haskell", "sudoku"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1481648244, "post_id": 41126330, "comment_id": 69456921, "body": "start by writing the function in english (or natural language of choice): e.g. &quot;<code>candidates</code> of <code>sudoku</code> at <code>pos</code> are the union of: values not present in pos&#39;s vertical, values not present in pos&#39;s horizontal, values not present in pos&#39;s 9x9 square&quot;. Then perhaps continue the excercise with &quot;<code>valuesInHorizontal</code> at <code>pos</code> are ...&quot;, &quot;<code>valuesInVertical</code> at <code>pos</code> are...&quot;, etc."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1481660027, "post_id": 41126330, "comment_id": 69463471, "body": "Instead of representing a cell by either an unknown or exactly known value, generalize this to representing a cell by its list (more properly, a <code>Set</code>) of candidates - then your candidates functions is completely trivial. None of the other functions are significantly complicated by this, as you can always &#39;view&#39; a cell in the &#39;old&#39; way: <code>view [x] = Just x; view _ = Nothing</code>. Some functions like <code>isOkay</code> are much simpler - just check if every cell has at least one candidate (0 candidates is obviously a contradiction)"}], "owner": {"reputation": 3215, "user_id": 4153021, "user_type": "registered", "accept_rate": 77, "profile_image": "https://graph.facebook.com/100000232211540/picture?type=large", "display_name": "Timo Cengiz", "link": "https://stackoverflow.com/users/4153021/timo-cengiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 473, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1481647583, "creation_date": 1481647583, "question_id": 41126330, "link": "https://stackoverflow.com/questions/41126330/writing-sudoku-in-haskell-find-possible-candidates-for-a-cell", "title": "Writing Sudoku in haskell, Find possible candidates for a cell", "body": "<p>This is the code i have for Sudoku in haskell. However i got stuck on a function that is supposed to find possible candidates for a specific cell. Example:</p>\n\n<pre><code>candidates allBlankSudoku (8,8)\n[1,2,3,4,5,6,7,8,9]\n</code></pre>\n\n<p>Since the whole map is blank all numbers can be inserted..</p>\n\n<p>This is the code i have:</p>\n\n<pre><code>module Sudoku where\n\nimport Data.Char\nimport Data.List\nimport Data.Maybe\n\nimport Test.QuickCheck\n\ndata Sudoku = Sudoku[[Maybe Int]]\n  deriving (Show, Eq) \n\n--data Sudoku = Sudoku { rows :: [[Maybe Int]] }\n\nexample :: Sudoku\nexample =   Sudoku [[Just 3, Just 6, Nothing,Nothing,Just 7, Just 1, Just 2, Nothing,Nothing]\n    , [Nothing,Just 5, Nothing,Nothing,Nothing,Nothing,Just 1, Just 8, Nothing]\n    , [Nothing,Nothing,Just 9, Just 2, Nothing,Just 4, Just 7, Nothing,Nothing]\n    , [Nothing,Nothing,Nothing,Nothing,Just 1, Just 3, Nothing,Just 2, Just 8]\n    , [Just 4, Nothing,Nothing,Just 5, Nothing,Just 2, Nothing,Nothing,Just 9]\n    , [Just 2, Just 7, Nothing,Just 4, Just 6, Nothing,Nothing,Nothing,Nothing]\n    , [Nothing,Nothing,Just 5, Just 3, Nothing,Just 8, Just 9, Nothing,Nothing]\n    , [Nothing,Just 8, Just 3, Nothing,Nothing,Nothing,Nothing,Just 6, Nothing]\n    , [Nothing,Nothing,Just 7, Just 6, Just 9, Nothing,Nothing,Just 4, Just 3]\n    ]\nrows :: Sudoku -&gt; [[Maybe Int]]\nrows (Sudoku rs) = rs\n\n-- A\n\n-- Crates a blank sudoku \"map\"\nallBlankSudoku :: Sudoku\nallBlankSudoku = Sudoku (replicate 9 (replicate 9 Nothing)) \n\n-- Checks if the criterias meet the standard sudoku\nisSudoku :: Sudoku -&gt; Bool\nisSudoku x = (length (rows x) == 9) &amp;&amp; ( and [length y == 9 | y &lt;- rows x]) &amp;&amp; ( and [x &gt; 0 &amp;&amp; x &lt; 10 | Just x &lt;- concat (rows x)])\n\n-- Checks if the sudoku puzzle is solved. Which is when there is no more cells to fill in\nisSolved :: Sudoku -&gt; Bool\nisSolved x = Nothing `notElem` concat (rows x)\n\n-- Prints a sudoko\nprintSudoku :: Sudoku -&gt; IO()\nprintSudoku x = putStr (unlines ([ map convertInt y | y &lt;- rows x]))\n\n-- converting from int to char \nconvertInt :: Maybe Int -&gt; Char \nconvertInt Nothing = '.'\nconvertInt (Just x) = chr (x+48)\n\n-- simply reads sudoku from file\nreadSudoku :: FilePath -&gt; IO Sudoku \nreadSudoku x = \n        do y &lt;- readFile x\n           return (Sudoku [map convertChar c | c &lt;- lines y])\n\n-- Convertion from char to int.       \nconvertChar :: Char -&gt; Maybe Int\nconvertChar '.' = Nothing\nconvertChar x  = Just (digitToInt x)\n\n-- this function crates a cell\ncell :: Gen (Maybe Int) \ncell  = frequency\n        [(1, do n &lt;- choose (1,9)\n                return (Just n)),\n            (9, return Nothing)]\n\n -- C2. Make Sudokus an instance of the class Arbitrary.\ninstance Arbitrary Sudoku where\n  arbitrary =\n    do rows &lt;- sequence [ sequence [ cell | j &lt;- [1..9] ] | i &lt;- [1..9] ]\n       return (Sudoku rows)\n\n-- check sudoku\nprop_Sudoku :: Sudoku -&gt; Bool\nprop_Sudoku x = isSudoku x\n\ntype Block = [ Maybe Int]\n\n-- CHeck if block containts same digit twice\nisOkayBlock :: Block -&gt; Bool\nisOkayBlock x = x' == nub x'\n            where x' = filter isJust x\n\n-- create list of all blocks\nblocks :: Sudoku -&gt; [Block]\nblocks x = rows x ++ transpose (rows x) ++ blocks1 x\n\n-- 3x3 made by blocks\nblocks1 :: Sudoku -&gt; [Block] \nblocks1 x = [concat [take 3 (drop a b) | b &lt;- take 3 (drop d (rows x))] | a &lt;- [0,3,6] , d &lt;- [0,3,6]]\n\n-- checks the whole sudoku\nisOkay :: Sudoku -&gt; Bool\nisOkay x = and (map isOkayBlock (blocks x))\nprop_isOkay x = and [ length a == 9 | a &lt;- blocks x ] &amp;&amp; length (blocks x) == 27\n\n\ntype Pos = (Int,Int)\n\n--way to find the blanks in sudoku.\nblank :: Sudoku -&gt; Pos -- Tells where a blank cell is located\nblank x = head $ concat $ map blank' (zip [0..8] (rows x))\n\nblank' :: (Int ,[Maybe Int]) -&gt; [Pos] -- A help function for blank\nblank' (x,y) = [(x,z) | (z,Nothing) &lt;- zip [0..8] y]\n\n--Replace/update \n(!!=) :: [a] -&gt; (Int ,a) -&gt; [a] \n(x:xs) !!= (0,a) = (a:xs)\n(x:xs) !!= (y,a) = (x:(xs!!=(y-1,a)))\n\n-- Update cell with new value\nupdate :: Sudoku -&gt; Pos -&gt; Maybe Int -&gt; Sudoku\nupdate x (p,i) y = Sudoku ((rows x) !!= (p,z))\n                   where z = (rows x) !! p !!= (i,y) \n\n-- Check update function\nprop_update (x,y) sud n = prop_XY (x',y') (update sud (x',y') n) == n \n                          where x' = x `mod` 9 \n                                y' = y `mod` 9\n\n-- helepr to find specific value \nprop_XY (x,y) sud = ((!!) (rows (sud)) x) !! y\n\n--candidates :: Sudoku -&gt; Pos -&gt; [Int]\n-- any tips on how to solve this? we got stuck here...\n\nsolve :: Sudoku -&gt; Maybe Sudoku\nsolve x \n       | not(isOkay x) = Nothing\n       | isSolved x = Just x\n       | otherwise = solve' [solve $ update x (blank x) (Just c) | c &lt;- [1..9]]\n\n-- take from our list solutions\nsolve' :: [Maybe a] -&gt; Maybe a \nsolve' [] = Nothing\nsolve' (Nothing:xs) = solve' xs\nsolve' (Just x:xs) = Just x \n\n-- read and solves the sudoku. \nreadAndSolve :: FilePath -&gt; IO () \nreadAndSolve x = \n                 do y &lt;- readFile x\n                    printSudoku $ fromJust $ solve $ Sudoku [map convertChar i | i &lt;- lines y]\n\n-- check if x 2 solution to x1\nisSolutionOf :: Sudoku -&gt; Sudoku -&gt; Bool\nisSolutionOf x1 x2 = isOkay x1 &amp;&amp; isSolved x1 &amp;&amp; isSolutionOf2 (zip (concat(rows x1)) (concat(rows x2)))\n\n-- helper func\nisSolutionOf2 :: (Eq a) =&gt; [(Maybe a, Maybe a)] -&gt; Bool \nisSolutionOf2 [] = True\nisSolutionOf2 ((x,y):xs) = x == y || y == Nothing &amp;&amp; isSolutionOf2 xs\n\n-- Solved or not \nprop_SolveSound :: Sudoku -&gt; Property\nprop_SolveSound x = isOkay x ==&gt; (fromJust (solve x)) `isSolutionOf` x \n</code></pre>\n\n<p>This is how the function is supposed to look like:</p>\n\n<pre><code>candidates :: Sudoku -&gt; Pos -&gt; [Int]\n</code></pre>\n"}, {"tags": ["haskell", "haskell-snap-framework", "heist"], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1484756047, "post_id": 41335778, "comment_id": 70643095, "body": "I do appreciate your answer, however upon multiple attempts I seemed to go down a rabbit hole with the types (I do not have much experience with monad transformers and kept battling with the HeistT type).  Regarding <code>mySplices</code> - it seems that <code>k1, v1, k2 ,v2</code> can not just be strings / text values?"}, {"owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1485237300, "post_id": 41335778, "comment_id": 70829695, "body": "I can&#39;t really give you a better answer without more context (ideally actual code) about precisely how you are trying to use Heist."}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1485251269, "post_id": 41335778, "comment_id": 70836869, "body": "I had difficulty understanding how to get a value of <code>Splice s</code> for <code>v1</code> or <code>v2</code> in the example.  I was attempting to just use a string, so I eventually figured I just needed <code>I.textSplice</code> for that purpose like so: <code>&quot;k1&quot; ## I.textSplice &quot;exampleValue&quot;</code>.  I think it would add clarity to the answer if you had an actual value rather then a type hole (for <code>k1</code>, <code>v1</code> etc.)"}], "tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": true, "score": 2, "last_activity_date": 1485528847, "last_edit_date": 1485528847, "creation_date": 1482782596, "answer_id": 41335778, "question_id": 41125841, "link": "https://stackoverflow.com/questions/41125841/how-do-i-render-a-heist-template-with-splices/41335778#41335778", "title": "How do I render a heist template with splices?", "body": "<p>The <a href=\"http://snapframework.com/docs/tutorials/compiled-splices\" rel=\"nofollow noreferrer\">heist tutorial</a> has a couple examples of defining the <code>Splices</code> type.</p>\n\n<p>If you click on the <code>Splices</code> link in the haddock you linked to above, we see that <code>Splices</code> is defined as follows:</p>\n\n<pre><code>type Splices s = MapSyntax Text s\n</code></pre>\n\n<p>If you then click on the <code>MapSyntax</code> link, you're taking to the docs for the <code>map-syntax</code> package.  This is a small package defining some more convenient syntax for creating maps.  There's an example at the top, but the general pattern is as follows:</p>\n\n<pre><code>mySplices = do\n    k1 ## v1\n    k2 ## v2\n</code></pre>\n\n<p>Since the previous definition told us that the keys are text, we can do the following to find out what the type of the values needs to be:</p>\n\n<pre><code>someFunc = do\n    ...\n    renderWithSplices \"my-template\" mySplices\n    ...\n\nmySplices = do\n    \"foo\" ## I.textSplice \"bar\"\n</code></pre>\n\n<p>If you have a recent enough GHC (I think 7.8 or higher), the underscore on that last line will create a type hole and cause the compiler to tell you what the type of the thing in that location should be.  Then you can write the appropriate thing of that type and it should be more obvious what to do from there.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 41335778, "answer_count": 1, "score": 1, "last_activity_date": 1485528847, "creation_date": 1481646175, "last_edit_date": 1482782652, "question_id": 41125841, "link": "https://stackoverflow.com/questions/41125841/how-do-i-render-a-heist-template-with-splices", "title": "How do I render a heist template with splices?", "body": "<p>I'm trying to use <code>renderWithSplices</code> - <a href=\"http://hackage.haskell.org/package/snap-1.0.0.0/docs/Snap-Snaplet-Heist.html#v:renderWithSplices\" rel=\"nofollow noreferrer\">http://hackage.haskell.org/package/snap-1.0.0.0/docs/Snap-Snaplet-Heist.html#v:renderWithSplices</a></p>\n\n<p>What is an idiomatic way to get a value of type <code>Splices s</code> (for the second parameter to <code>renderWithSplices</code>)?</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 3711, "user_id": 745750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ff67b821b06f226cec94c3bb1a422fe?s=128&d=identicon&r=PG&f=1", "display_name": "bwegs", "link": "https://stackoverflow.com/users/745750/bwegs"}, "edited": false, "score": 1, "creation_date": 1481643915, "post_id": 41125035, "comment_id": 69454027, "body": "Isn&#39;t it the &#39;o&#39; that satisfies the required conditions in your example?"}, {"owner": {"reputation": 211, "user_id": 970897, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/214da511bfcaad927efce92069bc49d5?s=128&d=identicon&r=PG", "display_name": "Green Noob", "link": "https://stackoverflow.com/users/970897/green-noob"}, "reply_to_user": {"reputation": 3711, "user_id": 745750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ff67b821b06f226cec94c3bb1a422fe?s=128&d=identicon&r=PG&f=1", "display_name": "bwegs", "link": "https://stackoverflow.com/users/745750/bwegs"}, "edited": false, "score": 0, "creation_date": 1481643998, "post_id": 41125035, "comment_id": 69454089, "body": "@bwegs Thanks. Corrected."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1481645596, "post_id": 41125035, "comment_id": 69455125, "body": "Your problem gets rather complex in the last paragraph.  What do you have at this point?  Have you solved the original problem of just matching pairs of words?  In what ways do you think you can extend that solution to work with the nth letter matches the mth letter?  What information would you need to pass to a function for the completely general case?"}, {"owner": {"reputation": 211, "user_id": 970897, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/214da511bfcaad927efce92069bc49d5?s=128&d=identicon&r=PG", "display_name": "Green Noob", "link": "https://stackoverflow.com/users/970897/green-noob"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1481647072, "post_id": 41125035, "comment_id": 69456116, "body": "@bheklilr No, I haven&#39;t solved the original problem at this point. I&#39;m an absolute beginner who&#39;s teaching himself Haskell. However, based on what little I know, I feel that this problem will have an elegant solution in Haskell. Concretely, I was wondering whether crossword puzzles can be solved if the words that can be used for the creating the puzzle come from a fixed dictionary. So, that means the function must accept a dictionary, and how each word is linked to another word or words. I hope this makes it clearer."}], "answers": [{"comments": [{"owner": {"reputation": 211, "user_id": 970897, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/214da511bfcaad927efce92069bc49d5?s=128&d=identicon&r=PG", "display_name": "Green Noob", "link": "https://stackoverflow.com/users/970897/green-noob"}, "edited": false, "score": 0, "creation_date": 1481677414, "post_id": 41126892, "comment_id": 69470410, "body": "Thanks a lot. I think I can extend this solution. By the way, is there something wrong with my question? I don&#39;t think it&#39;s an exact duplicate because I couldn&#39;t find a solution after searching on Google. Or does the question violate any other guideline?"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 211, "user_id": 970897, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/214da511bfcaad927efce92069bc49d5?s=128&d=identicon&r=PG", "display_name": "Green Noob", "link": "https://stackoverflow.com/users/970897/green-noob"}, "edited": false, "score": 0, "creation_date": 1481680558, "post_id": 41126892, "comment_id": 69471244, "body": "@GreenNoob it&#39;s probably more because you didn&#39;t show any work in your question, and it looks a lot like a homework problem. Keep in mind that stackoverflow has this ideal of being a repository of useful questions and answers, and it could be argued that your question would mainly help lazy students looking for a quick solution to their homework. Of course, SO is more than that in reality, people come here when they&#39;re stuck on a problem and they want a specific answer."}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 211, "user_id": 970897, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/214da511bfcaad927efce92069bc49d5?s=128&d=identicon&r=PG", "display_name": "Green Noob", "link": "https://stackoverflow.com/users/970897/green-noob"}, "edited": false, "score": 0, "creation_date": 1481680575, "post_id": 41126892, "comment_id": 69471250, "body": "@GreenNoob  In the future, it&#39;d be better to ask questions about how to extend code you already have to solve a more complex problem, rather than trying to get the solution to begin with. The downvotes are meant to indicate that you haven&#39;t asked a question useful to others, not that you have a duplicate or trivial problem."}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 3, "last_activity_date": 1481649338, "creation_date": 1481649338, "answer_id": 41126892, "question_id": 41125035, "link": "https://stackoverflow.com/questions/41125035/how-can-i-pattern-match-using-a-condition-like-the-nth-letter-of-a-given-word-eq/41126892#41126892", "title": "How can I pattern match using a condition like the nth letter of a given word equals the mth letter of another word?", "body": "<p>The first use case is pretty simple to solve in Haskell, you first need to pair up consecutive words:</p>\n\n<pre><code>pairs :: [String] -&gt; [(String, String)]\npairs wrds = zip wrds $ drop 1 wrds\n</code></pre>\n\n<p>Then write the logic to match the second letter of the first word with the first letter of the second word, pretty straightforward with pattern matching:</p>\n\n<pre><code>secondLetterMatchesFirstLetter :: String -&gt; String -&gt; Bool\nsecondLetterMatchesFirstLetter (_:a:_) (b:_) = a == b\nsecondLetterMatchesFirstLetter _ _ = False\n</code></pre>\n\n<p>Finally tie these together:</p>\n\n<pre><code>matchingWords :: [String] -&gt; [(String, String)]\nmatchingWords = filter (uncurry secondLetterMatchesFirstLetter) . pairs\n</code></pre>\n\n<p>Doing this for any mth and nth letters involves a few extra arguments along with swapping out <code>secondLetterMatchesFirstLetter</code> with a more general function, lets write that first:</p>\n\n<pre><code>mthMatchesNth :: Int -&gt; Int -&gt; String -&gt; String -&gt; Bool\nmthMatchesNth m n first second = (first `safeIdx` m) == (second `safeIdx` n)\n    where\n        -- Note: this isn't efficient\n        safeIdx [] n = Nothing\n        safeIdx (x:_) 0 = Just x\n        safeIdx (_:rest) n = safeIdx rest (n - 1)\n\nmatchingWords :: Int -&gt; Int -&gt; [String] -&gt; [(String, String)]\nmatchingWords m n = filter (uncurry $ mthMatchesNth m n) . pairs\n</code></pre>\n\n<p>Extending this to work on arbitrary groupings of words would be somewhat more complicated, and I'll let you work on that on your own.  This code should get you started for understanding how to do the matching itself, particularly since you'll be able to reuse the <code>mthMatchesNth</code> function regardless.  I would consider making a data type to represent that problem, since just passing some <code>Int</code>s around would make it hard to keep up with the details.</p>\n"}], "owner": {"reputation": 211, "user_id": 970897, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/214da511bfcaad927efce92069bc49d5?s=128&d=identicon&r=PG", "display_name": "Green Noob", "link": "https://stackoverflow.com/users/970897/green-noob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 41126892, "answer_count": 1, "score": -3, "last_activity_date": 1481649338, "creation_date": 1481643714, "last_edit_date": 1481643961, "question_id": 41125035, "link": "https://stackoverflow.com/questions/41125035/how-can-i-pattern-match-using-a-condition-like-the-nth-letter-of-a-given-word-eq", "title": "How can I pattern match using a condition like the nth letter of a given word equals the mth letter of another word?", "body": "<p>Given a list of words like [\"hello\",\"pale\",\"joke\",\"okay\"], how do I convert the following statement into Haskell code?</p>\n\n<blockquote>\n  <p>Give me the set(s) of words in the list such that the second letter of the first word equals the first letter of the second word.</p>\n</blockquote>\n\n<p>In this case, the answer is [\"joke\",\"okay\"] since the letter 'o' satisfies the condition. In general, how do I specify that I need the set of words where the nth letter of one word equals the mth letter of another.</p>\n\n<p>Further, how can I extend this concept to multiple words, for eg, give me the set of words where the fourth letter of the first word equals the third letter of the second and the last letter of the first word equals the first letter of the third word. The result for the given list should be [\"hello\",\"pale\",\"okay\"].</p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 5, "creation_date": 1481642935, "post_id": 41124599, "comment_id": 69453353, "body": "It&#39;s fairly common although usually the auxiliary function would be in a <code>where</code> clause, not at the top level."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1481643494, "post_id": 41124599, "comment_id": 69453722, "body": "A different, vaguely related, trick that is often used is reordering the arguments so that the ones you might want to hide with a separate definition come first. If <code>functionExA</code> were <code>Int -&gt; String -&gt; Int</code>, you could just use <code>functionExA 0 :: String -&gt; Int</code> anywhere you felt like, getting at least some of the benefits a separate name might give you."}], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481643242, "post_id": 41124682, "comment_id": 69453549, "body": "Well-chosen example."}], "tags": [], "owner": {"reputation": 1483, "user_id": 7202550, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3Mk8ftXiI2c/AAAAAAAAAAI/AAAAAAAAADo/OYKHG3htILQ/photo.jpg?sz=128", "display_name": "Jeremy Gurr", "link": "https://stackoverflow.com/users/7202550/jeremy-gurr"}, "is_accepted": false, "score": 2, "last_activity_date": 1481643153, "last_edit_date": 1481643153, "creation_date": 1481642639, "answer_id": 41124682, "question_id": 41124599, "link": "https://stackoverflow.com/questions/41124599/auxiliary-function-in-haskell/41124682#41124682", "title": "&#39;Auxiliary&#39; function in Haskell", "body": "<p>If the special case definition is used frequently, it can be an advantage to do this. For example, the sum function is just a special case of the fold function. So why don't we just use <code>foldr (+) 0 [1, 2, 3]</code> each time instead of <code>sum [1,2,3]</code>? Because <code>sum</code> is much more readable. </p>\n"}, {"tags": [], "owner": {"reputation": 13169, "user_id": 967945, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/47244a17f72cee237f57f4c4b9613ea1?s=128&d=identicon&r=PG", "display_name": "Dan Hulme", "link": "https://stackoverflow.com/users/967945/dan-hulme"}, "is_accepted": true, "score": 5, "last_activity_date": 1481643750, "creation_date": 1481643750, "answer_id": 41125048, "question_id": 41124599, "link": "https://stackoverflow.com/questions/41124599/auxiliary-function-in-haskell/41125048#41125048", "title": "&#39;Auxiliary&#39; function in Haskell", "body": "<p>Yes, this is commonplace, and not only in functional programming. It's good practice in your code to separate the interface to your code (in this case, that means the function signature: what arguments you have to pass) from the details of the implementation (the need to have a counter or similar in recursive code).</p>\n\n<p>In real-world programming, one manifestation of this is having default arguments or multiple overloads of one function. Another common way of doing this is returning or taking an instance of an interface instead of a particular class that implements that interface. In Java, this might mean returning a <code>List</code> from a method instead of <code>ArrayList</code>, even when you know that the code actually uses an <code>ArrayList</code> (where <code>ArrayList</code> implements the <code>List</code> interface). In Haskell, typeclasses often serve the same function.</p>\n\n<p>The \"one argument which always should be zero at the start\" pattern happens occasionally in the real world, but it's especially common in functional programming teaching, because you want to show how to write the same function in a recursive style vs. tail-recursive. The wrapper function is also important to demonstrate that both the implementations actually have the same result.</p>\n\n<p>In Haskell, it's more common to use <code>where</code> as follows:</p>\n\n<pre><code>functionEx :: String -&gt; Int\nfunctionEx s = functionExA s 0 where\n    functionExA s n = --function code\n</code></pre>\n\n<p>This way, even the existence of the \"real\" function is hidden from the external interface. There's no reason to expose the fact that this function is (say) tail-recursive with a count argument.</p>\n"}], "owner": {"reputation": 502, "user_id": 1731195, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/05863adbed3a673ae6a94a9e10527687?s=128&d=identicon&r=PG", "display_name": "Overt_Agent", "link": "https://stackoverflow.com/users/1731195/overt-agent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2773, "favorite_count": 1, "accepted_answer_id": 41125048, "answer_count": 2, "score": 4, "last_activity_date": 1501682878, "creation_date": 1481642373, "last_edit_date": 1501682878, "question_id": 41124599, "link": "https://stackoverflow.com/questions/41124599/auxiliary-function-in-haskell", "title": "&#39;Auxiliary&#39; function in Haskell", "body": "<p>My lecturer at the moment has a strange habit I've not seen before, I'm wondering if this is a Haskell standard or a quirk of his programming style.</p>\n\n<p>Basically, he'll often do thing such as this:</p>\n\n<pre><code>functionEx :: String -&gt; Int\nfunctionEx s = functionExA s 0\n\nfunctionExA :: String -&gt; Int -&gt; Int\nfunctionExA s n = --function code\n</code></pre>\n\n<p>He calls these 'auxiliary' functions, and for the most part the only advantage I can see to these is to make a function callable with fewer supplied arguments. But most of these are hidden away in code anyway and in my view adding the argument to the original call is much more readable.</p>\n\n<p>As I said, I'm not suggesting my view is correct, I've just not seen it done like this before and would like to know if it's common in Haskell.</p>\n"}, {"tags": ["haskell", "exception", "io", "monads", "short-circuiting"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1481639462, "post_id": 41123473, "comment_id": 69450882, "body": "This is more or less what I wrote as well. <code>ContT</code> is (in)famous for being hard to beginners, so some more comment would help as well. I&#39;d also suggest to add <code>lift (putStrLn &quot;foo&quot;) &gt;&gt; ...</code> somewhere so to show how to to IO within <code>ContT _ IO _</code>."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1481641396, "post_id": 41123473, "comment_id": 69452307, "body": "This computation runs in <code>ContT Int IO Int</code> instead of plain <code>IO</code> as I requested. I&#39;ll edit the question to make it less confusing, sorry."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1481641977, "post_id": 41123473, "comment_id": 69452765, "body": "&quot;you can define you own version of <code>foldM</code>&quot; \u2014 I can&#39;t: the library provides only <code>ffoldlIO</code> and it&#39;s far too complicated to implement my own <code>foldM</code>. Lists in the question are just for an example of what I want to achieve."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1481642471, "post_id": 41123473, "comment_id": 69453081, "body": "@user3237465 I think you solution is the best if you don&#39;t want to use monad transformers. But why don&#39;t you want?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1481642900, "post_id": 41123473, "comment_id": 69453326, "body": "@freestyle, it&#39;s not that I don&#39;t want \u2014 I just can&#39;t. The library I&#39;m using provides a data type <code>f</code> and the only folding function over it runs in the <code>IO</code> monad. And that <code>f</code> is too complicated, so I can&#39;t implement something that runs in any <code>MonadIO</code> instead of plain <code>IO</code>. I already implemented some combinators to add <code>StateT</code> and <code>ExceptT</code> layers on top of <code>IO</code> (by manually wrapping and unwrapping everything), but now I need early termination and the <code>Terminate</code> solution looks like a dirty hack."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1481643902, "post_id": 41123473, "comment_id": 69454020, "body": "@user3237465 Sorry, I didn&#39;t pay attention to it."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 3, "last_activity_date": 1481641697, "last_edit_date": 1481641697, "creation_date": 1481639119, "answer_id": 41123473, "question_id": 41122812, "link": "https://stackoverflow.com/questions/41122812/how-to-terminate-a-computation-that-runs-in-the-io-monad/41123473#41123473", "title": "How to terminate a computation that runs in the `IO` monad?", "body": "<p>For example, you can use <code>ContT</code> monad transformer like this:</p>\n\n<pre><code>example3 :: IO Int\nexample3 = flip runContT return . callCC $ \\exit -&gt; do\n    let step a x\n            | a' &lt; 4    = return a'\n            | otherwise = exit a'\n            where a' = a + x\n    foldM step 0 [1..]\n</code></pre>\n\n<p>Also, you can define you own version of <code>foldM</code> with posibility of termination.</p>\n\n<pre><code>termFoldM :: (Monad m, Foldable t) =&gt;\n    ((b -&gt; ContT b m c) -&gt; b -&gt; a -&gt; ContT b m b) -&gt; b -&gt; t a -&gt; m b\ntermFoldM f a t = flip runContT return . callCC $ \\exit -&gt; foldM (f exit) a xs\n\nexample4 :: IO Int\nexample4 = termFoldM step 0 [1..]\n  where\n    step exit a x\n        | a' &lt; 4    = return a'\n        | otherwise = exit a'\n        where a' = a + x\n</code></pre>\n\n<p>But this way (with <code>ContT</code>) has one problem. You can't easy do some <code>IO</code> actions. For example, this code will not be compiled, because <code>step</code> function must return value of type <code>ContT Int IO Int</code> not <code>IO Int</code>.</p>\n\n<pre><code>let step a x\n        | a' &lt; 4    = putStrLn (\"'a = \" ++ show a') &gt;&gt; return a'\n        | otherwise = exit a'\n        where a' = a + x\n</code></pre>\n\n<p>Fortunately, you can solve this by the <code>lift</code> function, like this:</p>\n\n<pre><code>let step a x\n        | a' &lt; 4    = lift (putStrLn (\"'a = \" ++ show a')) &gt;&gt; return a'\n        | otherwise = exit a'\n        where a' = a + x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1481654972, "post_id": 41126497, "comment_id": 69460707, "body": "That&#39;s a nice trick, thanks. Though, I don&#39;t want to introduce orphan instances and I already have a <a href=\"https://github.com/effectfully/prefolds\" rel=\"nofollow noreferrer\">machinery</a> that allows to write short-circuiting folds, so I just need to interpret such folds in the <code>IO</code> monad, and I&#39;m still not sure about the <code>Terminate</code> approach. Do you maybe have a reference that confirms this approach is OK? A paper that mentions it, or a commonly used library or something like this."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1481656587, "post_id": 41126497, "comment_id": 69461589, "body": "@user3237465 No, I don&#39;t. But I known one potential problem with this approach - someone can catch all exceptions and this can broken your program. Fortunately, this is unlikely. So, it is bad idea to use this approach everywhere, but in some cases it can be possible."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1481660638, "post_id": 41126497, "comment_id": 69463813, "body": "That&#39;s a good observation. Then I&#39;ll just store accumulators in an <code>IORef</code> and a final value always will be in the <code>IORef</code> no matter whether an exception was thrown and no matter whether it was caught by someone."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 1, "last_activity_date": 1481711794, "last_edit_date": 1481711794, "creation_date": 1481648053, "answer_id": 41126497, "question_id": 41122812, "link": "https://stackoverflow.com/questions/41122812/how-to-terminate-a-computation-that-runs-in-the-io-monad/41126497#41126497", "title": "How to terminate a computation that runs in the `IO` monad?", "body": "<p>My first answer was not correct. So, I'll try to improve.</p>\n\n<hr>\n\n<p>I think that the use of exceptions to terminate in IO monad is not a hack but it does not look clean. I propose to define the instance <code>MonadCont IO</code> like this:</p>\n\n<pre><code>data Terminate = forall a . Terminate a deriving (Typeable)\ninstance Show Terminate where show = const \"Terminate\"\ninstance Exception Terminate\n\ninstance MonadCont IO where\n    callCC f = f exit `catch` (\\(Terminate x) -&gt; return . unsafeCoerce $ x)\n      where exit = throwIO . Terminate\n</code></pre>\n\n<p>Then you can rewrite your example more cleaner.</p>\n\n<pre><code>example :: IO Int\nexample = callCC $ \\exit -&gt; do\n    let step a x\n            | a' &lt; 4    = return a'\n            | otherwise = exit a'\n            where a' = a + x\n    foldlIO step 0 [1..]\n</code></pre>\n\n<hr>\n\n<p>Variant with <code>IOREf</code>.</p>\n\n<pre><code>data Terminate = Terminate deriving (Show, Typeable)\ninstance Exception Terminate\n\ninstance MonadCont IO where\n    callCC f = do\n        ref &lt;- newIORef undefined\n        let exit a = writeIORef ref a &gt;&gt; throwIO Terminate\n        f exit `catch` (\\Terminate -&gt; readIORef ref)\n</code></pre>\n"}], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1481711794, "creation_date": 1481637070, "last_edit_date": 1481645077, "question_id": 41122812, "link": "https://stackoverflow.com/questions/41122812/how-to-terminate-a-computation-that-runs-in-the-io-monad", "title": "How to terminate a computation that runs in the `IO` monad?", "body": "<p>There is a library that provides a data type <code>F</code> and a function of type</p>\n\n<pre><code>ffoldlIO :: (b -&gt; a -&gt; IO b) -&gt; b -&gt; F a -&gt; IO b\n</code></pre>\n\n<p>The function is similar to</p>\n\n<pre><code>foldlIO :: (b -&gt; a -&gt; IO b) -&gt; b -&gt; [a] -&gt; IO b\nfoldlIO f a = \\xs -&gt; foldr (\\x r (!a') -&gt; f a' x &gt;&gt;= r) return xs a\n</code></pre>\n\n<p>I wonder whether <code>foldlIO</code> (and thus <code>ffoldlIO</code>) can run in a short-circuit fashion.</p>\n\n<p>Consider this example:</p>\n\n<pre><code>example1 :: IO Int\nexample1 = foldlIO (\\a x -&gt; if a &lt; 4 then return (a + x) else return a) 0 [1..5]\n</code></pre>\n\n<p>Here <code>foldlIO</code> traverses the entire list, but what if we throw an exception to stop the computation and then catch it? Something like this:</p>\n\n<pre><code>data Terminate = Terminate\n  deriving (Show)\n\ninstance Exception Terminate\n\nexample2 :: IO Int\nexample2 = do\n  ra &lt;- newIORef 0\n  let step a x\n        | a' &lt; 4    = return a'\n        | otherwise = writeIORef ra a' &gt;&gt; throwIO Terminate\n        where a' = a + x\n  foldlIO step 0 [1..] `catch` \\(_ :: Terminate) -&gt; readIORef ra\n</code></pre>\n\n<p>Is this reliable? Is there a better way to terminate a computation that runs in the <code>IO</code> monad (and no other monad) or am I not supposed to do this at all?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1481639213, "post_id": 41122109, "comment_id": 69450709, "body": "FTR: despite the name, <code>Floating</code> is not really \u201cthe class of floating-point numbers\u201d, that would be <code>RealFloat</code> (or even <a href=\"http://hackage.haskell.org/package/ieee754-0.7.9/docs/Numeric-IEEE.html#t:IEEE\" rel=\"nofollow noreferrer\"><code>IEEE</code></a>). It&#39;s rather simply the class of <i>number types you can do calculus with</i>, also allowing stuff like exact real arithmetic."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1481639564, "post_id": 41122109, "comment_id": 69450957, "body": "@leftaroundabout Thanks for highlighting that; imprecise statement removed."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 15, "last_activity_date": 1481639539, "last_edit_date": 1481639539, "creation_date": 1481635000, "answer_id": 41122109, "question_id": 41121107, "link": "https://stackoverflow.com/questions/41121107/what-does-has-kind-constraint-mean-in-haskell/41122109#41122109", "title": "What does has kind &#39;Constraint&#39; mean in Haskell", "body": "<p>A few things to adjust:</p>\n\n<p>0) <code>mod</code> isn't a good name for your function, as it is the name of the modulo function from the standard library. I will call it <code>norm</code> instead.</p>\n\n<p>1) The type signature you meant to write is:</p>\n\n<pre><code>norm :: Num a =&gt; [a] -&gt; a\n</code></pre>\n\n<p><code>[a]</code> is the type of a list with elements of type <code>a</code>. The <code>Num a</code> before the <code>=&gt;</code> isn't a type, but a <em>constraint</em>, which specifies that <code>a</code> must be a number type (or, more accurately, that it has to be an instance of the <code>Num</code> class). <code>[Num a] =&gt;</code> leads to the error you have seen because, given the square brackets, the type checker takes it as an attempt to use a list type instead of a constraint.</p>\n\n<p>Beyond the <code>Num a</code> issue, you have left out the result type from the signature. The corrected signature reflects that your function takes a list of numbers and returns a number.</p>\n\n<p>2) The <code>Num a</code> constraint is too weak for what you are trying to do. In order to use <code>sqrt</code>, you need to have not merely a number type, but one that is an instance of <code>Floating</code> (cf. leftaroundabout's comment to this answer):</p>\n\n<pre><code>GHCi&gt; :t sqrt\nsqrt :: Floating a =&gt; a -&gt; a\n</code></pre>\n\n<p>Therefore, your signature should be</p>\n\n<pre><code>norm :: Floating a =&gt; [a] -&gt; a\n</code></pre>\n\n<p>3) <code>[x]</code> is a list with a single element, <code>x</code>. If your argument is already a list, as the type signature says, there is no need to enclose it in square brackets. Your function, then, becomes:</p>\n\n<pre><code>norm :: Floating a =&gt; [a] -&gt; a\nnorm x = sqrt a\n    where a = sum b\n            where b = map sq x\n</code></pre>\n\n<p>Or, more neatly, without the second <code>where</code>-block:</p>\n\n<pre><code>norm :: Floating a =&gt; [a] -&gt; a\nnorm x = sqrt (sum b)\n    where b = map sq x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 954, "user_id": 5709737, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e98c852727ac0cf858868d262bd3d00c?s=128&d=identicon&r=PG&f=1", "display_name": "frederick99", "link": "https://stackoverflow.com/users/5709737/frederick99"}, "edited": false, "score": 1, "creation_date": 1583858779, "post_id": 41123141, "comment_id": 107251509, "body": "Thanks for explaining about Constraints. Do all typeclasses give a constraint when applied to appropriate types?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 954, "user_id": 5709737, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e98c852727ac0cf858868d262bd3d00c?s=128&d=identicon&r=PG&f=1", "display_name": "frederick99", "link": "https://stackoverflow.com/users/5709737/frederick99"}, "edited": false, "score": 2, "creation_date": 1583859197, "post_id": 41123141, "comment_id": 107251734, "body": "Yes; a typeclass is essentially a constraint constructor."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 10, "last_activity_date": 1481638057, "creation_date": 1481638057, "answer_id": 41123141, "question_id": 41121107, "link": "https://stackoverflow.com/questions/41121107/what-does-has-kind-constraint-mean-in-haskell/41123141#41123141", "title": "What does has kind &#39;Constraint&#39; mean in Haskell", "body": "<p>As you are aware, values can be classified by their type. <code>\"foo\"</code> has type <code>[Char]</code>, <code>Just 'c'</code> has type <code>Maybe Char</code>, etc.</p>\n\n<p>Similarly, types can be classified by their <em>kind</em>. All concrete types for which you can provide a value have kind <code>*</code>. You can see this using the <code>:k</code> command in GHCi:</p>\n\n<pre><code>&gt; :k Int\nInt :: *\n&gt; :k Maybe Int\nMaybe Int :: *\n</code></pre>\n\n<p>Type constructors also have kinds. They are essentially type-valued functions, so their kinds are similar to regular functions.</p>\n\n<pre><code>&gt; :t id\nid :: a -&gt; a\n&gt; :k Maybe\nMaybe :: * -&gt; *\n</code></pre>\n\n<p>But what is <code>Num a</code>? It's not a type, so it doesn't have kind <code>*</code>. It's not a type constructor, so it doesn't have an arrow kind. It is something new, so a new kind was created to describe it.</p>\n\n<pre><code>&gt; :k Num Int\nNum Int :: Constraint\n</code></pre>\n\n<p>And <code>Num</code> itself is a <code>Constraint</code>-valued function: it takes a value of kind <code>*</code> and produces a <code>Constraint</code>:</p>\n\n<pre><code>&gt; :k Num\nNum :: * -&gt; Constraint\n</code></pre>\n\n<p>A thing with kind <code>Constraint</code> is used to specify the typeclass that a particular type must be an instance of. It is the value that can occur before <code>=&gt;</code> in a type signature. It is also the \"argument\" to the <code>instance</code> \"function\":</p>\n\n<pre><code>instance Num Int where\n  ...\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 6462350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170fe653b1c3840613f8bb33b397ea24?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Brown", "link": "https://stackoverflow.com/users/6462350/mike-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8561, "favorite_count": 3, "accepted_answer_id": 41122109, "answer_count": 2, "score": 8, "last_activity_date": 1481639539, "creation_date": 1481632012, "last_edit_date": 1481635399, "question_id": 41121107, "link": "https://stackoverflow.com/questions/41121107/what-does-has-kind-constraint-mean-in-haskell", "title": "What does has kind &#39;Constraint&#39; mean in Haskell", "body": "<p>I am fresh to Haskell and I am trying to understand the language by writing some code. I am only familiar with very simple instructions on ghci: head, tail, sum, (*), and the like \u2013 very simple. </p>\n\n<p>The function I am trying to make is for solving Pythagoras's theorem for vectors of any number of dimensions. This looks something like this: square root (a^2 + b^2 + c^2 ...)</p>\n\n<p>What I can do in ghci in a few lines, which I am trying to make a function is the following:</p>\n\n<pre><code>sq x = x*x\n\nb = map sq [1,2,3]\n\na = sum b\n\nx = sqrt b\n</code></pre>\n\n<p>When I do this I try to include a signature of many sorts,\nCurrently my function looks like this:</p>\n\n<pre><code>mod :: [Num a] =&gt; a\nmod x = sqrt a\n    where a = sum [b]\n            where [b] = map sq [x]\n</code></pre>\n\n<p>I do not understand the issue when I try to run it:</p>\n\n<pre><code>Expected a constraint, but \u2018[Num a]\u2019 has kind \u2018*\u2019\n    \u2022 In the type signature:\n        Main.mod :: [Num a] =&gt; a\n</code></pre>\n"}, {"tags": ["haskell", "latex", "pandoc", "mathml"], "comments": [{"owner": {"reputation": 852, "user_id": 3977107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c28ec3d3d48af82483febac6b2dff62?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio Correia", "link": "https://stackoverflow.com/users/3977107/sergio-correia"}, "edited": false, "score": 1, "creation_date": 1481664293, "post_id": 41119436, "comment_id": 69465776, "body": "&quot;it is the MathML bit that should mimic standard pandoc behaviour that is giving me problems.&quot; --&gt; Why don&#39;t you leave it as it is and let Pandoc handle it after your filter has run?"}, {"owner": {"reputation": 19332, "user_id": 2192488, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/6JFOF.png?s=128&g=1", "display_name": "Serge Stroobandt", "link": "https://stackoverflow.com/users/2192488/serge-stroobandt"}, "reply_to_user": {"reputation": 852, "user_id": 3977107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c28ec3d3d48af82483febac6b2dff62?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio Correia", "link": "https://stackoverflow.com/users/3977107/sergio-correia"}, "edited": false, "score": 1, "creation_date": 1481664580, "post_id": 41119436, "comment_id": 69465932, "body": "@SergioCorreia Because, I run <code>pandoc</code> with <code>--jsmath</code> instead of <code>--mathml</code> to generate the SVG using MathJax."}, {"owner": {"reputation": 19332, "user_id": 2192488, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/6JFOF.png?s=128&g=1", "display_name": "Serge Stroobandt", "link": "https://stackoverflow.com/users/2192488/serge-stroobandt"}, "reply_to_user": {"reputation": 852, "user_id": 3977107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c28ec3d3d48af82483febac6b2dff62?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio Correia", "link": "https://stackoverflow.com/users/3977107/sergio-correia"}, "edited": false, "score": 1, "creation_date": 1481669483, "post_id": 41119436, "comment_id": 69468110, "body": "@SergioCorreia I double checked. Indeed, <code>pandoc</code> performs its <a href=\"http://pandoc.org/MANUAL.html#math\" rel=\"nofollow noreferrer\">math conversion</a> <i>prior</i> to exposing its <a href=\"https://hackage.haskell.org/package/pandoc-types-1.16.1.1/docs/Text-Pandoc-JSON.html\" rel=\"nofollow noreferrer\"><code>ToJSONFilter</code></a>. As far as I know, below solution is the only way of getting there."}, {"owner": {"reputation": 19332, "user_id": 2192488, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/6JFOF.png?s=128&g=1", "display_name": "Serge Stroobandt", "link": "https://stackoverflow.com/users/2192488/serge-stroobandt"}, "reply_to_user": {"reputation": 852, "user_id": 3977107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c28ec3d3d48af82483febac6b2dff62?s=128&d=identicon&r=PG&f=1", "display_name": "Sergio Correia", "link": "https://stackoverflow.com/users/3977107/sergio-correia"}, "edited": false, "score": 0, "creation_date": 1610977834, "post_id": 41119436, "comment_id": 116295588, "body": "<b>EDIT:</b> A completely new, more modern Lua filter solution to this problem can be found <a href=\"https://github.com/pandoc/lua-filters/tree/master/math2svg#math2svg\" rel=\"nofollow noreferrer\"><b>HERE</b></a>."}], "answers": [{"comments": [{"owner": {"reputation": 19332, "user_id": 2192488, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/6JFOF.png?s=128&g=1", "display_name": "Serge Stroobandt", "link": "https://stackoverflow.com/users/2192488/serge-stroobandt"}, "edited": false, "score": 0, "creation_date": 1481641338, "post_id": 41122378, "comment_id": 69452279, "body": "Exquisite answer with an excellent explanation! I learnt a lot from it."}], "tags": [], "owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "is_accepted": true, "score": 2, "last_activity_date": 1481635847, "creation_date": 1481635847, "answer_id": 41122378, "question_id": 41119436, "link": "https://stackoverflow.com/questions/41119436/pandoc-filter-mimicking-default-mathml-conversion/41122378#41122378", "title": "Pandoc filter mimicking default MathML conversion", "body": "<p>Admittedly I'm not familiar with Pandoc and the problem domain but if correctly understood the purpose of <code>tex2mml</code> function then I believe this should achieve what you want:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Control.Applicative ((&lt;$&gt;))\nimport Text.Pandoc.JSON\nimport Text.TeXMath\n       (writeMathML, readTeX, DisplayType(DisplayInline))\nimport Text.XML.Light (Element,showElement)\n\ntexMathToMathML :: DisplayType -&gt; String -&gt; Either String Element\ntexMathToMathML dt s = writeMathML dt &lt;$&gt; readTeX s\n\ntex2mml :: String -&gt; String\ntex2mml latex = either id showElement (texMathToMathML DisplayInline latex)\n\n-- actual definition of tex2svg goes here\ntex2svg = undefined\n\nmain :: IO ()\nmain = toJSONFilter tex2math\n  where\n    tex2math :: Inline -&gt; IO Inline\n    tex2math (Math DisplayMath latex) = do\n      svg &lt;- tex2svg latex\n      return (Math DisplayMath svg)\n    tex2math (Math InlineMath latex) = return (Math InlineMath (tex2mml latex))\n    tex2math other = return other\n</code></pre>\n\n<p>I'm using <code>either</code> function to scrutinise the result of the conversion function <code>texMathToMathML</code> - in case of failure the error is returned as is (<code>id</code>), in case of success <code>showElement</code> function is used to convert <code>Element</code> into its XML string representation.</p>\n\n<p>This could also be rewritten using pattern matching if you find that clearer:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>tex2mml :: String -&gt; String\ntex2mml latex = case texMathToMathML DisplayInline latex of\n  Left err -&gt; err\n  Right xml -&gt; showElement xml\n</code></pre>\n\n<p>As the computation is pure it doesn't need to be embedded in IO monad, and the result can be passed straight into the <code>Math</code> constructor.</p>\n\n<p>There are also other functions in <a href=\"https://hackage.haskell.org/package/xml-1.3.14/docs/Text-XML-Light-Output.html\" rel=\"nofollow noreferrer\">Text.XML.Light.Output</a> module if you wish to pretty print the XML string or wish to include XML document header in the output.</p>\n"}], "owner": {"reputation": 19332, "user_id": 2192488, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/6JFOF.png?s=128&g=1", "display_name": "Serge Stroobandt", "link": "https://stackoverflow.com/users/2192488/serge-stroobandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 1, "accepted_answer_id": 41122378, "answer_count": 1, "score": 1, "last_activity_date": 1481636820, "creation_date": 1481626766, "last_edit_date": 1481636820, "question_id": 41119436, "link": "https://stackoverflow.com/questions/41119436/pandoc-filter-mimicking-default-mathml-conversion", "title": "Pandoc filter mimicking default MathML conversion", "body": "<p>I am writing a <a href=\"http://pandoc.org/scripting.html#json-filters\" rel=\"nofollow noreferrer\">Pandoc JSON filter</a> in Haskell that should transform display LaTeX math to SVG with an external application, whereas inline LaTeX math should be transformed to MathML by <a href=\"https://pandoc.org/MANUAL.html\" rel=\"nofollow noreferrer\"><code>pandoc</code></a> internally.</p>\n\n<p>The first SVG bit is working fine; it is the MathML bit that should mimic standard <code>pandoc</code> behaviour that is giving me problems.</p>\n\n<p>Browsing Hackage, I found <a href=\"https://hackage.haskell.org/package/texmath-0.9/docs/Text-TeXMath.html\" rel=\"nofollow noreferrer\">the <code>texMathToMathML</code> code example</a> (see below). This function returns <code>Either String Element</code>.</p>\n\n<p>However, what I need is a function <code>tex2mml</code> (see below) returning an <code>IO String</code>.\n<strong>What needs to be added to the definition of <code>tex2mml</code> to achieve this?</strong></p>\n\n<pre><code>tex2mml latex = texMathToMathML DisplayInline latex\n</code></pre>\n\n<p>I am doing this on (X)Ubuntu LTS 16.04 with the following <code>pandoc 1.16.0.2</code> packages installed:</p>\n\n<pre><code>$ sudo apt install pandoc libghc-pandoc-prof\n</code></pre>\n\n<p>Here is an excerpt of what I got so far:</p>\n\n<pre><code>#!/usr/bin/env runhaskell\n\nimport Text.Pandoc.JSON\nimport Control.Applicative ((&lt;$&gt;))\nimport Text.TeXMath (writeMathML, readTeX, DisplayType( DisplayInline ) )\nimport Text.XML.Light (Element)\n\n\ntexMathToMathML :: DisplayType -&gt; String -&gt; Either String Element\ntexMathToMathML dt s = writeMathML dt &lt;$&gt; readTeX s\n\n\ntex2mml :: String -&gt; IO String\ntex2mml latex = texMathToMathML DisplayInline latex\n\n\nmain :: IO ()\nmain = toJSONFilter tex2math\n  where tex2math (Math (DisplayMath) latex) = do\n          svg &lt;- tex2svg latex\n          return (Math (DisplayMath) (svg))\n\n        tex2math (Math (InlineMath) latex) = do\n          mml &lt;- tex2mml latex\n          return (Math (InlineMath) (mml))\n\n        tex2math other = return other\n</code></pre>\n\n<p>Please, bear with me, as I am an absolute Haskell beginner.\nAny suggestions for code improvement are more than welcome!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1481626196, "post_id": 41111715, "comment_id": 69442173, "body": "Why are you trying to do this?"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1481637466, "post_id": 41111715, "comment_id": 69449461, "body": "@BenjaminHodgson I&#39;m trying to make a record like thing with a type changing map. It works now."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481588833, "post_id": 41111819, "comment_id": 69428166, "body": "I am very surprised that this works. It seems like this ought to allow us to write <code>foo :: K Int =&gt; () -&gt; Int; foo x = x</code> since <code>K Int</code> implies <code>MaybeEq Int</code>, which implies <code>() ~ Int</code>. Yet it doesn&#39;t. Why not?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481590833, "post_id": 41111819, "comment_id": 69428665, "body": "@DanielWagner I&#39;m working in 8.0.1 right now and I can define such a <code>foo</code> without problem (naturally I can&#39;t <i>use</i> it since there is no instance for <code>K Int</code>). What version are you running?"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1481591801, "post_id": 41111819, "comment_id": 69428969, "body": "<code>rf2 :: Test K -&gt; Maybe Bool</code> <code>rf2 (Test o) = (==) &lt;$&gt; o &lt;*&gt; o -- I need GHC to infer that o is Maybe Eq</code>"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1481591844, "post_id": 41111819, "comment_id": 69428983, "body": "Error : <code>\u2022 Could not deduce: a ~ Maybe a0   from the context: K a</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481595244, "post_id": 41111819, "comment_id": 69429845, "body": "@Alec I am also in 8.0.1. When I write <code>let foo :: K Int =&gt; () -&gt; Int; foo x = x</code> in ghci I get <code>Couldn&#39;t match expected type \u2018Int\u2019 with actual type \u2018()\u2019 In the expression: x</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481596322, "post_id": 41111819, "comment_id": 69430106, "body": "@DanielWagner Huh. Something seems amiss. Some clarifications: I&#39;m actually in <code>8.0.1.20161117</code>, and I am both able to get the error message and avoiding it (depending on extensions enabled I think?) - still trying to whittle down a minimal test case..."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 7, "last_activity_date": 1481594881, "last_edit_date": 1481594881, "creation_date": 1481588401, "answer_id": 41111819, "question_id": 41111715, "link": "https://stackoverflow.com/questions/41111715/making-a-constraint-of-maybe-a-where-eq-a/41111819#41111819", "title": "Making a constraint of Maybe a where Eq a", "body": "<p>This is a <a href=\"https://ghc.haskell.org/trac/ghc/ticket/3490\" rel=\"nofollow noreferrer\">known issue</a>. GHC is choking up because you have introduced a new type variable <code>b</code> not mentioned anywhere else in the instance head. One workaround is to use type families and constraint kinds.</p>\n\n<pre><code>{-# LANGUAGE ConstraintKinds, TypeFamilies, UndecideableInstances, \n             UndecideableSuperclasses, FlexibleInstances\n  #-}\n\nimport GHC.Exts (Constraint)\nimport GHC.Prim (Any)\n\ntype family MaybeEq x :: Constraint where\n  MaybeEq (Maybe a) = Eq a\n  MaybeEq _         = Any    -- A good \"unsatisfiable\" constraint\n\nclass MaybeEq a =&gt; K a where\ninstance MaybeEq a =&gt; K a where\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481588576, "post_id": 41111825, "comment_id": 69428106, "body": "Given that there is such a strict constraint <code>b ~ Maybe a</code>, it is a bit annoying to have to include both <code>a</code> and <code>b</code> in the instance head."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1481594309, "post_id": 41111825, "comment_id": 69429612, "body": "<code>fj1 :: Test Eq -&gt; Test (EqMaybe b)</code> <code>fj1 (Test o) = Test $ Just o</code>"}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1481594315, "post_id": 41111825, "comment_id": 69429614, "body": "\u2022 Could not deduce (EqMaybe b (Maybe a)) arising from a use of \u2018Test\u2019   from the context: Eq a"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1481594999, "post_id": 41111825, "comment_id": 69429788, "body": "@2426021684 Fixed."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481595364, "post_id": 41111825, "comment_id": 69429870, "body": "@DanielWagner Very nice! This is the trick dfeuer keeps using (adding the constraint in both directions to facilitate type inference) - I really need to get the hang of this."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481618490, "post_id": 41111825, "comment_id": 69437505, "body": "Tiny quibble: there&#39;s no reason for <code>UnMaybe</code> to be an associated type. I think it&#39;s clearer as a closed type family: <code>type family UnMaybe m where UnMaybe (Maybe a) = a</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481619525, "post_id": 41111825, "comment_id": 69438064, "body": "One more quibble: you might as well make the instance head fully polymorphic as well. This will involve less duplication if you use a type synonym for the constraint."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481621120, "post_id": 41111825, "comment_id": 69438938, "body": "@dfeuer Regarding the closed type family: unless you are planning on adding a second catch all case and have it report a <code>TypeError</code>, isn&#39;t the type family better like this? At you can be sure it will never end up stuck..."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481636702, "post_id": 41111825, "comment_id": 69448899, "body": "@Alec, it can still be stuck. Nothing stops one from applying it to an arbitrary type."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481742262, "post_id": 41111825, "comment_id": 69502706, "body": "@dfeuer Is it possible to generalize this by writing a <code>((* -&gt; *) -&gt; Constraint) -&gt; (* -&gt; Constraint) -&gt; * -&gt; Constraint</code> type function?` <code>(F ((~) Maybe) Eq)</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 0, "creation_date": 1481744730, "post_id": 41111825, "comment_id": 69503941, "body": "@2426021684, I don&#39;t believe <code>~</code> can be partially applied, but you might be able to make that general approach work."}, {"owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481744823, "post_id": 41111825, "comment_id": 69503999, "body": "@dfeuer It can be partially applied."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "edited": false, "score": 1, "creation_date": 1481870663, "post_id": 41111825, "comment_id": 69557467, "body": "@2426021684, I believe I have a fully general solution: <a href=\"http://stackoverflow.com/questions/41178589/is-there-a-general-way-to-apply-constraints-to-a-type-application/41178590#41178590\" title=\"is there a general way to apply constraints to a type application\">stackoverflow.com/questions/41178589/&hellip;</a>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1481594989, "last_edit_date": 1481594989, "creation_date": 1481588420, "answer_id": 41111825, "question_id": 41111715, "link": "https://stackoverflow.com/questions/41111715/making-a-constraint-of-maybe-a-where-eq-a/41111825#41111825", "title": "Making a constraint of Maybe a where Eq a", "body": "<p>The following compiles on my machine. No idea how sensible it is.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE ConstraintKinds #-}\nclass (Eq (UnMaybe a), a ~ Maybe (UnMaybe a)) =&gt; EqMaybe a where\n    type UnMaybe a\n\ninstance Eq a =&gt; EqMaybe (Maybe a) where\n    type UnMaybe (Maybe a) = a\n\ndata Test c = forall a. c a =&gt; Test a\nr :: Test EqMaybe -&gt; Maybe Bool\nr (Test o) = (==) &lt;$&gt; o &lt;*&gt; o\nf :: Test Eq -&gt; Test EqMaybe\nf (Test o) = Test (Just o)\n</code></pre>\n"}], "owner": {"reputation": 2865, "user_id": 6369276, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d91ac54d4035616b112dcfb66433550e?s=128&d=identicon&r=PG&f=1", "display_name": "michaelmesser", "link": "https://stackoverflow.com/users/6369276/michaelmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 586, "favorite_count": 0, "accepted_answer_id": 41111825, "answer_count": 2, "score": 7, "last_activity_date": 1481902108, "creation_date": 1481587568, "last_edit_date": 1495542275, "question_id": 41111715, "link": "https://stackoverflow.com/questions/41111715/making-a-constraint-of-maybe-a-where-eq-a", "title": "Making a constraint of Maybe a where Eq a", "body": "<p>How can I constrain to Maybe a where Eq a? It needs to be of kind * -> Constraint</p>\n\n<p>What I tried:</p>\n\n<pre><code>class (a ~ Maybe b, Eq b) =&gt; K a where\ninstance (a ~ Maybe b, Eq b) =&gt; K a where\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>Not in scope: type variable \u2018b\u2019\n</code></pre>\n\n<p>Example Usage:</p>\n\n<pre><code>data Test c = forall a. (c a) =&gt; Test a\nr :: Test K -&gt; Maybe Bool\nr (Test o) = (==) &lt;$&gt; o &lt;*&gt; o -- I need GHC to infer that o is Maybe Eq\n</code></pre>\n\n<p>Cases that work:</p>\n\n<pre><code>pp :: Test ((~) String) -&gt; String\npp (Test o) = o ++ \"X\" -- GHC infers that o is a string\n\nhh :: Test Eq -&gt; Bool\nhh (Test o) = o == o -- GHC infers that o is Eq\n</code></pre>\n\n<p>Generic answer here: <a href=\"https://stackoverflow.com/questions/41178589/is-there-a-general-way-to-apply-constraints-to-a-type-application/41178590#41178590\">Is there a general way to apply constraints to a type application?</a></p>\n"}, {"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1481601582, "post_id": 41110469, "comment_id": 69431223, "body": "for what it&#39;s worth, this problem wouldn&#39;t show up if you were using a <code>ghc</code> with a <code>ghci</code> released some time within the past three years :)"}], "owner": {"reputation": 43, "user_id": 6119290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57529e9a1a47746200650015823c8676?s=128&d=identicon&r=PG&f=1", "display_name": "Ruslan A", "link": "https://stackoverflow.com/users/6119290/ruslan-a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "closed_date": 1481581316, "answer_count": 0, "score": 1, "last_activity_date": 1481580272, "creation_date": 1481580272, "question_id": 41110469, "link": "https://stackoverflow.com/questions/41110469/why-this-implementation-of-maximum-doesnt-work-in-haskell-maximum-foldr1-ma", "closed_reason": "Duplicate", "title": "Why this implementation of maximum doesn&#39;t work in haskell: maximum&#39; = foldr1 max", "body": "<p>This implementation works fine:</p>\n\n<pre><code> \u03bb &gt; let maximum' xs = foldl1 max xs\n \u03bb &gt; maximum' [1..5]\n 5\n</code></pre>\n\n<p>Because of currying we can rewrite function like <code>foo a = bar b a</code> as <code>foo = bar b</code></p>\n\n<p>Result of <code>foldl1 max</code> have expected type</p>\n\n<pre><code> \u03bb &gt; :t foldl1 max\n foldl1 max :: Ord a =&gt; [a] -&gt; a\n</code></pre>\n\n<p>But this doesn't work</p>\n\n<pre><code> \u03bb &gt; let maximum' = foldl1 max\n \u03bb &gt; maximum' [1..5]\n\n&lt;interactive&gt;:71:11:\n    No instance for (Num ()) arising from the literal `1'\n    Possible fix: add an instance declaration for (Num ())\n    In the expression: 1\n    In the first argument of maximum', namely `[1 .. 5]'\n    In the expression: maximum' [1 .. 5]\n</code></pre>\n\n<p>This error isn't clear for me in this case. So, why this error occur? Is there a way to fix it and define functions like this without explicitly specifying last argument?</p>\n"}, {"tags": ["haskell", "literals", "type-signature"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1481568337, "post_id": 41107452, "comment_id": 69419173, "body": "Hint: put a space between <code>-</code> and <code>2</code>. Does that make the code behave differently?"}, {"owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1481568828, "post_id": 41107452, "comment_id": 69419453, "body": "@leftaroundabout tried adding a difference between - and 2, it behaves much the same"}, {"owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1481569423, "post_id": 41107452, "comment_id": 69419740, "body": "@leftaroundabout <code>(-2)</code> worked, I think it was attempting to apply <code>-</code> as a function instead of evaluating the number <code>-2</code>"}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1481570758, "post_id": 41107452, "comment_id": 69420434, "body": "Yep, I think that&#39;s what @leftaroundabout was pointing out (where the space makes it more clear to see it as an infix operator)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1481570803, "post_id": 41107452, "comment_id": 69420459, "body": "The issue here is that <code>take -2 [1,2]</code> means <code>(take) - (2 [1])</code> this uses <code>take</code> as a number and <code>2</code> as a function. IMO, the error message is not very informative to a beginner, and GHC should emit a better one for <code>Num (_ -&gt; _)</code> unresolved constraints."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1481576459, "post_id": 41107452, "comment_id": 69423261, "body": "@chi: Could you put that as an answer? Thanks!"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1481576753, "post_id": 41107452, "comment_id": 69423437, "body": "@TikhonJelvis I was about to that earlier, but I didn&#39;t want to &quot;steal&quot; the answer/comment of from leftaroundabout"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1481588277, "post_id": 41107452, "comment_id": 69428029, "body": "@chi don&#39;t be sheepish. Like I cared! It&#39;s not as if you needed that hint to analyse the problem."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1481592289, "last_edit_date": 1481592289, "creation_date": 1481588282, "answer_id": 41111808, "question_id": 41107452, "link": "https://stackoverflow.com/questions/41107452/type-error-when-testing-a-function-with-a-negative-number/41111808#41111808", "title": "Type error when testing a function with a negative number", "body": "<p>As already discussed in the comments, this is simply a matter of parsing rules. Your expression <code>take' -2 [2]</code> sure looks like it should mean <code>take' (-2) [2]</code> as you intend. And arguably, it should be parsed as just that. In fact GHC has an extension to achieve that behaviour:</p>\n\n<pre><code>GHCi, version 7.10.2: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :set -XNegativeLiterals \nPrelude&gt; take -2 [2]\n[]\n</code></pre>\n\n<p>By default however, Haskell always first tries to parse all operators, including <code>-</code>, as <em>infix operators</em>. In the above expression, <code>-</code> has both something to the left and to the right (albeit with inconsistent spacing, but that's ignored), so without <code>-XNegativeLiterals</code> this ends up getting parsed as <code>(take) - (2 [2])</code>, which means something completely different. Really it's just utter bogus, as the error message suggests in a really cryptic way: it wants <code>Num (i -&gt; [a] -&gt; [a])</code>, i.e. it finds your code requires to treat a function (namely, <code>take</code>) as a number (namely, as an argument to the subtraction operator).</p>\n\n<p>Almost always when you see an error including demand for <code>Num (Some Compound Type)</code> it means something is completely wrong already at the parsing level.</p>\n"}], "owner": {"reputation": 5335, "user_id": 2309862, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/8xjCJ.jpg?s=128&g=1", "display_name": "vamsiampolu", "link": "https://stackoverflow.com/users/2309862/vamsiampolu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "accepted_answer_id": 41111808, "answer_count": 1, "score": 2, "last_activity_date": 1486245025, "creation_date": 1481568241, "last_edit_date": 1486245025, "question_id": 41107452, "link": "https://stackoverflow.com/questions/41107452/type-error-when-testing-a-function-with-a-negative-number", "title": "Type error when testing a function with a negative number", "body": "<p>I am following along with the <em>Learn you a Haskell for great good</em>, I have implemented <code>take'</code>:</p>\n\n<pre><code>take' :: (Ord i, Num i) =&gt; i -&gt; [a] -&gt; [a]\ntake' n _\n  | n &lt;= 0 = []\ntake' _ [] = []\ntake' n (x:xs) = x: take' (n-1) xs\n</code></pre>\n\n<p>When testing the function with:</p>\n\n<pre><code>take' -2 [2]\n</code></pre>\n\n<p>instead of getting an empty list, I have this message:</p>\n\n<pre><code>Non type-variable argument in the constraint: Num (i -&gt; [a] -&gt; [a])\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018it\u2019 has the inferred type\n      it :: forall i a t.\n            (Num i, Num t, Num (i -&gt; [a] -&gt; [a]), Num ([t] -&gt; i -&gt; [a] -&gt; [a]),\n             Ord i) =&gt;\n            i -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>I have added a space between <code>-</code> and <code>2</code> as suggested, and it leads to the same error:</p>\n\n<pre><code>*Main&gt; take' - 2 [2]\n\n&lt;interactive&gt;:78:1:\n    Non type-variable argument in the constraint: Num (i -&gt; [a] -&gt; [a])\n    (Use FlexibleContexts to permit this)\n    When checking that \u2018it\u2019 has the inferred type\n      it :: forall i a t.\n            (Num i, Num t, Num (i -&gt; [a] -&gt; [a]), Num ([t] -&gt; i -&gt; [a] -&gt; [a]),\n             Ord i) =&gt;\n            i -&gt; [a] -&gt; [a]\n</code></pre>\n"}, {"tags": ["function", "haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1481568509, "post_id": 41107368, "comment_id": 69419278, "body": "In this case it doesn&#39;t make sense -- or I would have mentioned it in my answer -- but perhaps the case in your question is a simplification of what you are actually trying to do. If so, you could consider making a typeclass that contains <code>isBig</code>, <code>isLoyal</code>, and so on, and making <i>types</i> <code>Dog</code>, <code>Cat</code>, and <code>Cow</code> which implement this class. This is pretty different, though: classes are open, unlike types."}], "answers": [{"comments": [{"owner": {"reputation": 359, "user_id": 2649762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8574838cef0a260ea45417d364e002b6?s=128&d=identicon&r=PG", "display_name": "user2649762", "link": "https://stackoverflow.com/users/2649762/user2649762"}, "edited": false, "score": 0, "creation_date": 1481568524, "post_id": 41107476, "comment_id": 69419283, "body": "What would be a good way to organize a piece of code like that example, then?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 359, "user_id": 2649762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8574838cef0a260ea45417d364e002b6?s=128&d=identicon&r=PG", "display_name": "user2649762", "link": "https://stackoverflow.com/users/2649762/user2649762"}, "edited": false, "score": 0, "creation_date": 1481568695, "post_id": 41107476, "comment_id": 69419387, "body": "@user2649762 I have added a thought on one approach you might like."}, {"owner": {"reputation": 359, "user_id": 2649762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8574838cef0a260ea45417d364e002b6?s=128&d=identicon&r=PG", "display_name": "user2649762", "link": "https://stackoverflow.com/users/2649762/user2649762"}, "edited": false, "score": 0, "creation_date": 1481569912, "post_id": 41107476, "comment_id": 69419975, "body": "Thanks, one more thing. There are a lot of properties, and most of them aren&#39;t defined for all Animals. I had something like &#39;isLoyal _ = False; isBig _ = False&quot; at the end of the file, so that if I didn&#39;t define a particular property for an Animal, it just defaults to a value. How to implement this with your approach?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 359, "user_id": 2649762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8574838cef0a260ea45417d364e002b6?s=128&d=identicon&r=PG", "display_name": "user2649762", "link": "https://stackoverflow.com/users/2649762/user2649762"}, "edited": false, "score": 1, "creation_date": 1481571630, "post_id": 41107476, "comment_id": 69420885, "body": "@user2649762 <code>def = Stats { isLoyal = False }; stats Cat = def { isBig = False }</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 5, "last_activity_date": 1481568677, "last_edit_date": 1481568677, "creation_date": 1481568375, "answer_id": 41107476, "question_id": 41107368, "link": "https://stackoverflow.com/questions/41107368/function-declaration-via-pattern-matching-on-multiple-lines/41107476#41107476", "title": "Function declaration via pattern-matching on multiple lines", "body": "<p>It is neither a flaw in the language nor an indication that your approach is wrong. It is merely a syntactic restriction put in place as part of a nasty design decision that had to be made one way or another.</p>\n\n<p>The attraction of the restriction is that it means that when reading code, one doesn't need to fear that they have missed part of the definition of a value because it is spread out far across the current file. It does prevent some perfectly logical ways of organizing code, though, including the one you're currently trying to use.</p>\n\n<p>What a shame that we can't have both!</p>\n\n<p>One could consider doing something like this:</p>\n\n<pre><code>data Stats = Stats\n    { isBig :: Bool\n    , isLoyal :: Bool\n    , -- ...\n    }\n\nstats :: Animal -&gt; Stats\nstats Cat = Stats\n    { isBig = False\n    , isLoyal = False\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1481569293, "last_edit_date": 1592644375, "creation_date": 1481568803, "answer_id": 41107585, "question_id": 41107368, "link": "https://stackoverflow.com/questions/41107368/function-declaration-via-pattern-matching-on-multiple-lines/41107585#41107585", "title": "Function declaration via pattern-matching on multiple lines", "body": "<p>Quoting <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-800004.4\" rel=\"nofollow noreferrer\">Section 4.4.3.1 of the Haskell Report</a>:</p>\n<blockquote>\n<p><strong>4.4.3.1 Function bindings</strong></p>\n<p>A function binding binds a variable to a function value. The general form of a function binding for variable x is:</p>\n<p>[Specification for the syntax of function bindings, covering the multiple clause scenario.]</p>\n<p>Note that all clauses defining a function must be contiguous, and the number of patterns in each clause must be the same. [...]</p>\n</blockquote>\n<p>The restriction you have noted is that &quot;all clauses defining a function must be contiguous&quot;. Daniel Wagner's answer discusses the presumable rationale behind this design decision. I would, in particular, emphasise that forgetting a clause corresponding to one of the constructors of a type is a quite dangerous mistake that would be easier to commit if it was possible to break apart the clauses in the way you suggest (a function that takes an <code>Animal</code> is expected to handle all three possibilities).</p>\n"}], "owner": {"reputation": 359, "user_id": 2649762, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8574838cef0a260ea45417d364e002b6?s=128&d=identicon&r=PG", "display_name": "user2649762", "link": "https://stackoverflow.com/users/2649762/user2649762"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 41107476, "answer_count": 2, "score": 2, "last_activity_date": 1481571677, "creation_date": 1481567952, "last_edit_date": 1481571677, "question_id": 41107368, "link": "https://stackoverflow.com/questions/41107368/function-declaration-via-pattern-matching-on-multiple-lines", "title": "Function declaration via pattern-matching on multiple lines", "body": "<p>I want to have this nice, clean way to describe an object's properties with functions and pattern matching:</p>\n\n<pre><code>data Animal = Cat | Dog | Cow\n\nisBig :: Animal -&gt; Bool\nisLoyal :: Animal -&gt; Bool\n-- many more possible properties, including complicated non-bools, methods, and whatnot\n\n\n--- Describing Cat\n\nisBig Cat = False\nisLoyal Cat = False\n--- more properties\n\n\n--- Describing Dog\n\nisBig Dog = False\nisLoyal Dog = True\n--- more properties\n\n\n--- Describing Cow\n\nisBig Cow = True\nisLoyal Cow = False\n--- more properties\n</code></pre>\n\n<p>However, this gives an error about multiple declarations. Because, apparently, function definition via pattern-matching must be done in consecutive lines.</p>\n\n<p>Is it indicative that my approach is wrong, un-Haskell-like? Or is it just a flaw in the language? Or do I misunderstand something?</p>\n"}, {"tags": ["opencv", "haskell", "zeromq"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481572552, "post_id": 41106511, "comment_id": 69421358, "body": "What is the type of <code>CV.withWindow</code>? (Generally: where does the module <code>OpenCV</code> come from?)"}, {"owner": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "edited": false, "score": 0, "creation_date": 1481572970, "post_id": 41106511, "comment_id": 69421550, "body": "<code>OpenCV</code> is coming from <a href=\"https://github.com/LumiGuide/haskell-opencv\" rel=\"nofollow noreferrer\">here</a> and according to the <a href=\"http://lumiguide.github.io/haskell-opencv/doc/OpenCV-HighGui.html\" rel=\"nofollow noreferrer\">docs</a> <code>CV.withWindow :: String -&gt; (Window -&gt; IO a) -&gt; IO a</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1481575275, "post_id": 41106511, "comment_id": 69422666, "body": "Okay, because <code>withWindow</code> returns the result of the action you pass it there is another approach as well. I&#39;ve expanded my answer."}], "answers": [{"comments": [{"owner": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "edited": false, "score": 0, "creation_date": 1481569266, "post_id": 41106802, "comment_id": 69419670, "body": "I didn&#39;t consider IORef, good point. When I try it, though, I have to <code>liftIO</code> whileM_ and I end up with the same old clash between <code>ZMQ z ()</code> and <code>IO ()</code> when I use <code>receive</code>. Now I try the second solution..."}, {"owner": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "edited": false, "score": 0, "creation_date": 1481570011, "post_id": 41106802, "comment_id": 69420026, "body": "Ok, about the second solution. <code>loop</code> has signature <code>loop :: ZMQ z ()</code> but <code>CV.withWindow :: String -&gt; (Window -&gt; IO a) -&gt; IO a</code> so if I do a <code>liftIO</code> before <code>CV.withWindow</code> I&#39;m still out of luck."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1481571393, "post_id": 41106802, "comment_id": 69420741, "body": "I wonder if the latter solution will leak memory at every loop or not. I guess that <code>withWindow</code> should be kind-of tail recursive, but I have no idea about how OpenCV works (and I can not find it, even on stackage)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "edited": false, "score": 0, "creation_date": 1481571954, "post_id": 41106802, "comment_id": 69421047, "body": "@mezzomondo I misunderstood the type of <code>runZMQ</code>, sorry about that. I&#39;ve updated with a new proposal for the <code>whileM_</code>/<code>IORef</code> solution, but I don&#39;t have zeromq installed to test it; anyway, give it a try."}, {"owner": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "edited": false, "score": 0, "creation_date": 1481573464, "post_id": 41106802, "comment_id": 69421780, "body": "Thank you @daniel-wagner, the <code>liftIO</code> in the parentheses was the missing bit. Now it works."}, {"owner": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "edited": false, "score": 0, "creation_date": 1481577644, "post_id": 41106802, "comment_id": 69423920, "body": "In the second shouldn&#39;t it be <code>when (key &#47;= 27) loop</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "edited": false, "score": 0, "creation_date": 1481579078, "post_id": 41106802, "comment_id": 69424709, "body": "@mezzomondo Thanks, fixed. =)"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1481582451, "post_id": 41106802, "comment_id": 69426250, "body": "As a matter of style, would it be terrible to instead write: <code>fix $ \\loop -&gt; do {... when (key &#47;= 27) loop}</code>? It seems a bit nicer to me to make it clear that we&#39;ll be calling loop immediately after defining it, and points out that the only reason for the let-binding is to create the recursive action."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1481579071, "last_edit_date": 1481579071, "creation_date": 1481565821, "answer_id": 41106802, "question_id": 41106511, "link": "https://stackoverflow.com/questions/41106511/again-on-breaking-loops-in-haskell/41106802#41106802", "title": "Again on breaking loops in Haskell", "body": "<p>Read and write an <code>IORef</code>, and use <a href=\"http://hackage.haskell.org/package/monad-loops-0.4.3/docs/Control-Monad-Loops.html#v:whileM_\" rel=\"nofollow noreferrer\"><code>whileM_</code></a>.</p>\n\n<pre><code>main = runZMQ $ do\n    receiver &lt;- socket Pull\n    bind receiver \"tcp://*:5554\"\n    continue &lt;- liftIO $ newIORef True\n\n    whileM_ (liftIO $ readIORef continue) $ do\n        buffer &lt;- receive receiver\n        let img = CV.imdecode CV.ImreadUnchanged buffer -- simple decoder\n        liftIO . CV.withWindow \"Video\" $ \\window -&gt; do\n            CV.imshow window img\n            key &lt;- CV.waitKey 10\n            when (key == 27) $ writeIORef continue False\n</code></pre>\n\n<p>Or have your loop call itself explicitly as appropriate:</p>\n\n<pre><code>main = runZMQ $ do\n    receiver &lt;- socket Pull\n    bind receiver \"tcp://*:5554\"\n\n    let loop = do\n            buffer &lt;- receive receiver\n            let img = CV.imdecode CV.ImreadUnchanged buffer -- simple decoder\n            key &lt;- liftIO . CV.withWindow \"Video\" $ \\window -&gt; do\n                CV.imshow window img\n                CV.waitKey 10\n            when (key /= 27) loop\n\n    loop\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "edited": false, "score": 0, "creation_date": 1481574186, "post_id": 41108711, "comment_id": 69422139, "body": "Giving it a try. <code>runExceptT . forever . ExceptT :: Monad m =&gt; m (Either e a) -&gt; m (Either e b)</code>, so it returns a <code>ZMQ z (Either () b)</code> while I&#39;m expecting a <code>ZMQ z ()</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "edited": false, "score": 0, "creation_date": 1481579276, "post_id": 41108711, "comment_id": 69424802, "body": "@mezzomondo You could put <code>return ()</code> after the <code>ZMQ z (Either () b)</code> in a do-block, our you could use the function <code>void :: Functor f =&gt; f a -&gt; f ()</code> from <code>Control.Monad</code> to &quot;erase&quot; the return value."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1481573666, "last_edit_date": 1481573666, "creation_date": 1481573330, "answer_id": 41108711, "question_id": 41106511, "link": "https://stackoverflow.com/questions/41106511/again-on-breaking-loops-in-haskell/41108711#41108711", "title": "Again on breaking loops in Haskell", "body": "<p>How about making the callback return an <code>Either () ()</code> and then wrapping it in <code>ExceptT</code> before passing it to forever? Something like</p>\n\n<pre><code>runExceptT . forever . ExceptT $ do\n  buffer &lt;- receive receiver\n  let img = CV.imdecode CV.ImreadUnchanged buffer -- simple decoder\n  liftIO $ CV.withWindow \"Video\" $ \\window -&gt; do\n      CV.imshow window img\n      key &lt;- CV.waitKey 10\n      if (key == 27) \n          then (return (Left ()))\n          else (return (Right ()))\n</code></pre>\n"}], "owner": {"reputation": 335, "user_id": 325787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d271220be04b05902e04206dc162506?s=128&d=identicon&r=PG", "display_name": "mezzomondo", "link": "https://stackoverflow.com/users/325787/mezzomondo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 1, "accepted_answer_id": 41106802, "answer_count": 2, "score": 2, "last_activity_date": 1481579071, "creation_date": 1481564681, "last_edit_date": 1495535420, "question_id": 41106511, "link": "https://stackoverflow.com/questions/41106511/again-on-breaking-loops-in-haskell", "title": "Again on breaking loops in Haskell", "body": "<p>I have a small piece of code that receives frames on a zeromq Pull socket and displays it in a opencv window:</p>\n\n<pre><code>module Main where\n\nimport           Control.Monad\nimport qualified OpenCV as CV\nimport           System.ZMQ4.Monadic\nimport           System.Exit\n\nmain :: IO()\nmain = runZMQ $ do\n  receiver &lt;- socket Pull\n  bind receiver \"tcp://*:5554\"\n\n  -- do some stuff not relevant\n\n  forever $ do\n    buffer &lt;- receive receiver\n    let img = CV.imdecode CV.ImreadUnchanged buffer -- simple decoder\n    liftIO $ CV.withWindow \"Video\" $ \\window -&gt; do\n        CV.imshow window img\n        key &lt;- CV.waitKey 10\n        when (key == 27) exitSuccess -- &lt;- UGLY!\n</code></pre>\n\n<p>What I would like to find is a way to break the loop that allows me more control. I'm aware of the EitherT solution proposed by Gabriel Gonzalez <a href=\"https://stackoverflow.com/a/17267261/325787\">here</a> (that I like very much) but I'm not able to implement it in the <code>CV.withWindow</code> context, for example:</p>\n\n<pre><code>quit :: (Monad m) =&gt; e -&gt; EitherT e m r\nquit = left\n\nloop :: (Monad m) =&gt; EitherT e m a -&gt; m e\nloop = fmap (either id id) . runEitherT . forever\n\nmain :: IO()\nmain = runZMQ $ do\n  receiver &lt;- socket Pull\n  bind receiver \"tcp://*:5554\"\n\n  loop $ do\n    buffer &lt;- receive receiver\n    let img = CV.imdecode CV.ImreadUnchanged buffer -- simple decoder\n    liftIO $ CV.withWindow \"Video\" $ \\window -&gt; do\n        CV.imshow window img\n        key &lt;- CV.waitKey 10\n        when (key == 27) $ quit ()\n</code></pre>\n\n<p>But of course <code>quit</code> wraps the argument in a Left and this solution doesn't compile.</p>\n"}, {"tags": ["haskell", "data-structures", "tree", "binary-tree"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1481554250, "post_id": 41103420, "comment_id": 69411050, "body": "What would it mean to add 3 leaves to an arbitrary tree? Can you draw a picture of it?"}, {"owner": {"reputation": 3, "user_id": 7284841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3862cff1c0976c0c95ca60935ae8d396?s=128&d=identicon&r=PG&f=1", "display_name": "SmokedHering", "link": "https://stackoverflow.com/users/7284841/smokedhering"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1481555604, "post_id": 41103420, "comment_id": 69411864, "body": "I added a link to a picture. Sorry,it is a bit crappy."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1481555646, "post_id": 41103420, "comment_id": 69411887, "body": "&quot;without degenerating the tree&quot; -- what does this mean, exactly? Does the tree need to be balanced in some way?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1481555949, "post_id": 41103420, "comment_id": 69412083, "body": "Any reason the third leaf in your picture is added as a right child instead of a left? It otherwise looks like you want to add leaves in a left-to-right breadth-first manner."}, {"owner": {"reputation": 3, "user_id": 7284841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3862cff1c0976c0c95ca60935ae8d396?s=128&d=identicon&r=PG&f=1", "display_name": "SmokedHering", "link": "https://stackoverflow.com/users/7284841/smokedhering"}, "edited": false, "score": 0, "creation_date": 1481556162, "post_id": 41103420, "comment_id": 69412222, "body": "no reason at all. sorry, the picture is a bit shifted. And by &#39;degenerated&#39; I meant &#39;balanced&#39;."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1481556168, "post_id": 41103420, "comment_id": 69412225, "body": "Your datatype cannot represent the new tree shown in your picture; a node must either be a leaf or an internal node with two children. An <code>N</code> node cannot have a single leaf."}, {"owner": {"reputation": 3, "user_id": 7284841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3862cff1c0976c0c95ca60935ae8d396?s=128&d=identicon&r=PG&f=1", "display_name": "SmokedHering", "link": "https://stackoverflow.com/users/7284841/smokedhering"}, "edited": false, "score": 0, "creation_date": 1481556701, "post_id": 41103420, "comment_id": 69412526, "body": "oh, you right. Thank you for the hint. Okay , I changed the picture and just n even number is allowed :)"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7284841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3862cff1c0976c0c95ca60935ae8d396?s=128&d=identicon&r=PG&f=1", "display_name": "SmokedHering", "link": "https://stackoverflow.com/users/7284841/smokedhering"}, "edited": false, "score": 0, "creation_date": 1481563528, "post_id": 41104602, "comment_id": 69416524, "body": "Thank you very much for the detailed answer. Realy awesome!Just one question. For an better understanding I simplified the addTree function for myself: <code>addTree L = (N L L )</code>   <code>addTree (N l r) = if (height l &gt; height r) then (N l ( addTree  r) else (N (add l) r)</code> . That should add only one ( N L L ) on the emptier side. But it always gives back a parse error on else. Why?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 3, "user_id": 7284841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3862cff1c0976c0c95ca60935ae8d396?s=128&d=identicon&r=PG&f=1", "display_name": "SmokedHering", "link": "https://stackoverflow.com/users/7284841/smokedhering"}, "edited": false, "score": 0, "creation_date": 1481569338, "post_id": 41104602, "comment_id": 69419705, "body": "You are missing a closing parenthesis in the <code>then</code> expression."}, {"owner": {"reputation": 3, "user_id": 7284841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3862cff1c0976c0c95ca60935ae8d396?s=128&d=identicon&r=PG&f=1", "display_name": "SmokedHering", "link": "https://stackoverflow.com/users/7284841/smokedhering"}, "edited": false, "score": 0, "creation_date": 1481569834, "post_id": 41104602, "comment_id": 69419934, "body": "Dang it! Thank you, you  helped me a lot in understanding trees better."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1481558469, "last_edit_date": 1481558469, "creation_date": 1481558037, "answer_id": 41104602, "question_id": 41103420, "link": "https://stackoverflow.com/questions/41103420/how-to-manipulate-trees-in-haskell/41104602#41104602", "title": "How to manipulate trees in Haskell", "body": "<p>First, you'll need a helper function to figure out which side of the tree is \"emptier\".</p>\n\n<pre><code>height :: SimpleT -&gt; Int\nheight L = 0\nheight (N l r) = 1 + max (height l) (height r)\n</code></pre>\n\n<p>Then, it's just a matter of adding 2 leaves at a time to the emptier side (that is, add 2 leaves to the emptier side, then add <code>n-2</code> leaves to the resulting tree).</p>\n\n<pre><code>-- Warning: partial function, not defined for odd n\naddTree :: Int -&gt; SimpleT -&gt; SimpleT\naddTree 0 t = t\naddTree n L = addTree (n - 2) (N L L)\naddTree n (N l r) = addTree (n - 2) (if height l &gt; height r\n                                     then (N l (addTree 2 r))\n                                     else (N (addTree 2 l) r))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1481571520, "post_id": 41106232, "comment_id": 69420831, "body": "I don&#39;t think this works out quite right. Consider a tree like <code>N L (N L (N L (N L (N L (N L (N L (N L (N L L))))))))</code>. <code>budget</code> will assign all available nodes to the left subtree without saving any for the right subtree, leaving the tree unbalanced."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1481574802, "post_id": 41106232, "comment_id": 69422445, "body": "That tree is already degenerated - we are supposed not to degenerate it."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1481579320, "post_id": 41106232, "comment_id": 69424821, "body": "The question doesn&#39;t say anything about the given tree being balanced, although that could be a reasonable assumption that was left unstated."}], "tags": [], "owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "is_accepted": false, "score": 1, "last_activity_date": 1481575242, "last_edit_date": 1481575242, "creation_date": 1481563542, "answer_id": 41106232, "question_id": 41103420, "link": "https://stackoverflow.com/questions/41103420/how-to-manipulate-trees-in-haskell/41106232#41106232", "title": "How to manipulate trees in Haskell", "body": "<p>A lazier approach also does not have to keep traversing the tree for quadratic time (still takes suboptimal O(n*log(n)) though, and would give to the right half of your example \"first\" because it is emptier):</p>\n\n<pre><code>size :: SimpleT -&gt; Int\nsize L = 1\nsize (N l r) = size l + size r\n\naddTree :: Int -&gt; SimpleT -&gt; SimpleT\naddTree 0 t = t\naddTree n L = addTree (n-1) (N L L)\naddTree n (N l r) = let (u, v) = budget (size l) (size r) n in\n  N (addTree u l) (addTree v r)\n\nbudget :: Int -&gt; Int -&gt; Int -&gt; (Int, Int)\nbudget l r n = let\n  l' = min (n+l) r -- Raise l to r from our budget n\n  n' = n+l-l'\n  r' = min (n'+r) l' -- Raise r to l from our budget n\n  n'' = n'+r-r'\n  n''' = div n'' 2\n  in (l'-l+n''-n''', r'-r+n''') -- Divide our remaining budget fairly\n</code></pre>\n\n<p>Edit: \"That tree is already degenerated - we are supposed not to degenerate it.\" &lt;- In fact, this gives way to a simpler budgeting solution:</p>\n\n<pre><code>budget :: Int -&gt; Int -&gt; Int -&gt; (Int, Int)\nbudget l r n = let (n', m) = divMod n 2\n  in (if l&gt;r then swap else id) (n'+m,n')\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7284841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3862cff1c0976c0c95ca60935ae8d396?s=128&d=identicon&r=PG&f=1", "display_name": "SmokedHering", "link": "https://stackoverflow.com/users/7284841/smokedhering"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "accepted_answer_id": 41104602, "answer_count": 2, "score": 0, "last_activity_date": 1481575242, "creation_date": 1481553998, "last_edit_date": 1481557005, "question_id": 41103420, "link": "https://stackoverflow.com/questions/41103420/how-to-manipulate-trees-in-haskell", "title": "How to manipulate trees in Haskell", "body": "<p>I would like to write a function that, given an n will exactly add the amount of leaves without degenerating the tree. Something like this:</p>\n\n<pre><code>data SimpleT= L | N SimpleT SimpleT deriving Show\n</code></pre>\n\n<p>and addTree defined as:</p>\n\n<pre><code>addTree::Int-&gt;SimpleT-&gt;SimpleT\naddTree n (N left right) = something\n</code></pre>\n\n<p>But I can not get it right. The only working thing i've got so far, just adds a (N L L ) on every leaf:</p>\n\n<pre><code> addTree2  L = (N L L)\n addTree2  (N left right)= N (addTree2  left)(addTree2  right)\n</code></pre>\n\n<p>How can I add 'n' properly? With only even numbers for n are allowed.</p>\n\n<p>e.g. adding 2 leaves <img src=\"https://i.stack.imgur.com/RP74z.jpg\" alt=\"adding 2 leaves\"></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 3, "creation_date": 1481552390, "post_id": 41102823, "comment_id": 69409877, "body": "What doesn&#39;t work exactly? There are type errors. First of all, you have to fix them."}, {"owner": {"reputation": 925, "user_id": 2534489, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/WzwA0.gif?s=128&g=1", "display_name": "adamasan", "link": "https://stackoverflow.com/users/2534489/adamasan"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481554099, "post_id": 41102823, "comment_id": 69410958, "body": "Already did a fix suggested by Chad Gilbert and updated the original post. I now get an error &quot;Undefined variable &#39;txt&#39;&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 925, "user_id": 2534489, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/WzwA0.gif?s=128&g=1", "display_name": "adamasan", "link": "https://stackoverflow.com/users/2534489/adamasan"}, "edited": false, "score": 0, "creation_date": 1481554047, "post_id": 41102944, "comment_id": 69410919, "body": "Thank you. I fixed the first countVCAux pattern. However I don&#39;t understand how am I supposed to change the countVC definition, since the code in your post already matches the same line of code in my original post. I now get an error &quot;Undefined variable &#39;txt&#39;&quot;."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 925, "user_id": 2534489, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/WzwA0.gif?s=128&g=1", "display_name": "adamasan", "link": "https://stackoverflow.com/users/2534489/adamasan"}, "edited": false, "score": 0, "creation_date": 1481554140, "post_id": 41102944, "comment_id": 69410982, "body": "Woops! I just fixed my answer. The first example now includes <code>txt</code> as a parameter"}, {"owner": {"reputation": 925, "user_id": 2534489, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/WzwA0.gif?s=128&g=1", "display_name": "adamasan", "link": "https://stackoverflow.com/users/2534489/adamasan"}, "edited": false, "score": 0, "creation_date": 1481554755, "post_id": 41102944, "comment_id": 69411355, "body": "Thank you so much Chad! Working great now! :D"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 1, "last_activity_date": 1481554106, "last_edit_date": 1481554106, "creation_date": 1481552481, "answer_id": 41102944, "question_id": 41102823, "link": "https://stackoverflow.com/questions/41102823/how-can-i-count-the-number-of-vowels-and-consonants-in-a-string-using-haskell/41102944#41102944", "title": "How can I count the number of vowels and consonants in a string using Haskell?", "body": "<p>One problem is that your <code>countVC</code> definition currently does not take a <code>[Char]</code> parameter as its signature implies. Change it to this:</p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>countVC txt = countVCAux txt 0 0\n</code></pre>\n\n<p>The first <code>countVCAux</code> pattern isn't quite right either. <code>txt</code> should probably be omitted in favor of the empty string <code>[]</code>, and you need to add <code>con</code> and <code>vow</code> parameters:</p>\n\n<pre class=\"lang-haskell prettyprint-override\"><code>countVCAux [] con vow  = (con, vow)\n</code></pre>\n"}], "owner": {"reputation": 925, "user_id": 2534489, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/WzwA0.gif?s=128&g=1", "display_name": "adamasan", "link": "https://stackoverflow.com/users/2534489/adamasan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 852, "favorite_count": 0, "accepted_answer_id": 41102944, "answer_count": 1, "score": -1, "last_activity_date": 1481554106, "creation_date": 1481552096, "last_edit_date": 1481553799, "question_id": 41102823, "link": "https://stackoverflow.com/questions/41102823/how-can-i-count-the-number-of-vowels-and-consonants-in-a-string-using-haskell", "title": "How can I count the number of vowels and consonants in a string using Haskell?", "body": "<p>I'm starting to study Haskell, and I'm completely at lost. This exercise requires me to count the amout of vowels and consonants in a string, and print both numbers.</p>\n\n<p>Here's the code I have so far:</p>\n\n<pre><code>--Here I take the string and will \n--return a tuple with both values\ncountVC::[Char]-&gt;(Int, Int)\n--I call an aux function where I pass the string \n--and two values, which I will use to increment\n--according to the amount of vowels or consonants \ncountVC = countVCAux txt 0 0\n\ncountVCAux::[Char]-&gt;Int-&gt;Int-&gt;(Int, Int)\n--If the string is empty I try to return the tuple with (0, 0)\ncountVCAux [] con vow  = (con, vow)\n--If not I take the head and compare with the consonants\ncountVCAux (c:r) con vow\n    --If it's a vowel I pass the rest of the list, the consonant and increment the vowel count\n    |c=='a' || c=='e' || c=='i' || c=='o' || c=='u' = countVCAux r con (vow + 1)\n    --Else I do the same, but increment the consonant count\n    |otherwise = countVCAux r (con + 1) vow\n</code></pre>\n\n<p>However it doesn't work. What is the problem with this code?</p>\n"}, {"tags": ["haskell", "data-structures", "functional-programming", "algebraic-data-types"], "answers": [{"comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1481538215, "post_id": 41098534, "comment_id": 69401522, "body": "<code>-(b-a)</code> is the same as <code>(a-b)</code>."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1481538832, "post_id": 41098534, "comment_id": 69401895, "body": "@bereal No, because <code>a</code> and <code>b</code> are natural numbers and if <code>a &lt; b</code> then result of <code>a - b</code> isn&#39;t defined."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1481540054, "post_id": 41098534, "comment_id": 69402567, "body": "&quot;pair of Nuts&quot;. Well, that&#39;s one possible interpretation."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1481542134, "post_id": 41098534, "comment_id": 69403751, "body": "@n.m. &quot;pair of Nuts&quot; is technical point of view. Logically, it&#39;s integer number (this conclusion was derived from function definitions)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1481559650, "post_id": 41098534, "comment_id": 69414272, "body": "<code>canonical</code> can be simplified by listing the both-non-zero case first. The other two cases then reduce to <code>canonical x = x</code>."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": false, "score": 8, "last_activity_date": 1481560260, "last_edit_date": 1481560260, "creation_date": 1481537812, "answer_id": 41098534, "question_id": 41098322, "link": "https://stackoverflow.com/questions/41098322/difficulties-in-understanding-algebraic-data-type/41098534#41098534", "title": "Difficulties in understanding algebraic data type", "body": "<p>It's just integer numbers. <code>Nat</code> represents a natural number. <code>ZInt</code> represents an integer number. In <code>Z a b</code> if <code>a &gt;= b</code> then integer is a - b else -(b - a).</p>\n\n<p>For example:</p>\n\n<pre><code>ZInt representation | Traditional representation\nZ Zero Zero         | 0\nZ (S Zero) Zero     | 1\nZ Zero (S Zero)     | -1\nZ (S Zero) (S Zero) | 0\n...\n</code></pre>\n\n<p>As we can see, to <code>negate</code> an integer you just swap the <code>Nat</code> values in its representation:</p>\n\n<pre><code>negate :: ZInt -&gt; ZInt\nnegate (Z n m) = Z m n\n</code></pre>\n\n<p>And we can define <code>subZ</code> like this:</p>\n\n<pre><code>a `subZ` b = a `addZ` negate b\n</code></pre>\n\n<p>This representation is not canonical, <code>Z (S Zero) (S Zero)</code> is the same integer as <code>Z Zero Zero</code>. So, we can define canonical form like this:</p>\n\n<pre><code>canonical :: ZInt -&gt; ZInt\ncanonical (Z (S n) (S m)) = canonical (Z n m)\ncanonical x               = x\n</code></pre>\n\n<p>What reason is to define integer numbers by this way?</p>\n\n<p>First of all, it mathematically clear. If someone defined the set of natural number named <code>N</code> the we can easy define the set of integers named <code>Z</code> as <code>Z = N * N</code> where (*) is product of two sets.</p>\n\n<p>In Haskell, I can see only one reason for that. By this way we can define integer numbers on type level. </p>\n"}, {"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 4, "last_activity_date": 1481560931, "last_edit_date": 1481560931, "creation_date": 1481547188, "answer_id": 41101391, "question_id": 41098322, "link": "https://stackoverflow.com/questions/41098322/difficulties-in-understanding-algebraic-data-type/41101391#41101391", "title": "Difficulties in understanding algebraic data type", "body": "<p>First, <code>ZInt</code> is representing each integer as an <em>ordered</em> pair of natural numbers. @freestyle covers how this representation works well; I will just expand on how the arithmetic operators take advantage of this encoding.</p>\n\n<p><code>addZ</code>, <code>subZ</code> and <code>multZ</code> are simply manipulating the pair of natural numbers that represent each integer.</p>\n\n<pre><code>addZ (Z a b) (Z c d) = Z (add a c) (add b d)\n(a - b) + (c - d) == a - b + c - d\n                  == a + c - b - d\n                  == (a + c) - (b + d)\n\nsubZ (Z a b) (Z c d) = Z (add a d) (add b c)\n(a - b) - (c - d) == a - b - c + d\n                  == a + d - b - c\n                  == (a + d) - (b + c)\n\nmultZ (Z a b) (Z c d) = Z (add (mult a d) (mult c b)) (add (mult a c) (mult b d))\n(a - b) * (c - d) == ac - ad - bc + bd\n                  == ac + bd - ad - bc\n                  == (ac + bd) - (ad + bc)\n</code></pre>\n\n<p>Note that the given definition of <code>multZ</code> can get the sign wrong; it should be</p>\n\n<pre><code>multZ (Z a b) (Z c d) = Z (add (mult a c) (mult b d)) (add (mult a d) (mult b c))\n</code></pre>\n\n<p>(For clarity, it should also use <code>mult b c</code> instead of <code>mult c b</code>, even though multiplication of natural numbers is commutative.)</p>\n"}], "owner": {"reputation": 99, "user_id": 6414566, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ed1971c96d5d73a8d964ea4c8a99799?s=128&d=identicon&r=PG&f=1", "display_name": "SOAP", "link": "https://stackoverflow.com/users/6414566/soap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "accepted_answer_id": 41101391, "answer_count": 2, "score": 3, "last_activity_date": 1481560931, "creation_date": 1481537169, "question_id": 41098322, "link": "https://stackoverflow.com/questions/41098322/difficulties-in-understanding-algebraic-data-type", "title": "Difficulties in understanding algebraic data type", "body": "<p>I am not quite sure what this ZInt is actually describing. </p>\n\n<pre><code>data Nat = Zero | S Nat\ndata ZInt = Z Nat Nat deriving Show\n\naddZ :: ZInt -&gt; ZInt -&gt; ZInt\naddZ (Z a b) (Z c d) = Z (add a c) (add b d)\n\nwith\nadd ::  Nat -&gt; Nat -&gt; Nat\nadd a Zero  = a\nadd a (S b) = S (add a b)\n\nmult :: Nat -&gt; Nat -&gt; Nat\nmult _ Zero  = Zero\nmult a (S b) = add a (mult a b)\n</code></pre>\n\n<p>At first glance i thought maybe it's a presentation of complex numbers, adding imaginary and real  components (in function addZ) without displaying form of </p>\n\n<pre><code>a+b*i\n</code></pre>\n\n<p>But what is happening in this functions? </p>\n\n<pre><code> subZ :: ZInt -&gt; ZInt -&gt; ZInt \n subZ (Z a b) (Z c d) = Z (add a d) (add b c)\n\nmultZ :: ZInt -&gt; ZInt -&gt; ZInt\nmultZ (Z a b) (Z c d) = Z (add (mult a d) (mult c b)) (add (mult a c) (mult b d))\n</code></pre>\n\n<p>So I do understand  data Nat = Zero | S Nat and also the add and mult functions, but not addZ, subZ and multZ. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 815, "user_id": 245743, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/11a87619d08da72466e99e16453ea318?s=128&d=identicon&r=PG", "display_name": "ppb", "link": "https://stackoverflow.com/users/245743/ppb"}, "edited": false, "score": 0, "creation_date": 1481539322, "post_id": 41097961, "comment_id": 69402186, "body": "Both <code>group</code> and <code>groupBy</code> reside in Data.List module which you would need to add to your import list. You can use <a href=\"http://hoogle.haskell.org/?hoogle=groupBy\" rel=\"nofollow noreferrer\">Hoogle</a> to search functions by their name or type signature and identify in which module they are. You may also find <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:lines\" rel=\"nofollow noreferrer\">unlines</a> useful for splitting the string into individual lines, and the <code>readMany</code> function from <a href=\"http://stackoverflow.com/questions/20176706/reading-ints-in-haskell/20177526#20177526\">this post</a> for extracting Ints from your string."}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1481549290, "post_id": 41097961, "comment_id": 69407952, "body": "In haskell, your list of tuple should be in this form  [(4, [12, 32, 52]), (5, [12, 32, 52])]"}], "answers": [{"tags": [], "owner": {"reputation": 1668, "user_id": 4050960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2433d3125076f5789fe82a2eae87fdd1?s=128&d=identicon&r=PG&f=1", "display_name": "Chuck Aguilar", "link": "https://stackoverflow.com/users/4050960/chuck-aguilar"}, "is_accepted": false, "score": 0, "last_activity_date": 1481546948, "last_edit_date": 1495540908, "creation_date": 1481546948, "answer_id": 41101324, "question_id": 41097961, "link": "https://stackoverflow.com/questions/41097961/how-to-transform-a-string-into-a-list-of-tuple/41101324#41101324", "title": "How to transform a String into a list of tuple?", "body": "<p>Daniel!</p>\n\n<p>Yeah, you could use groupBy for helping you. </p>\n\n<p>Here's the doc: \n<a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:groupBy\" rel=\"nofollow noreferrer\">hoogle</a></p>\n\n<p>And here are two nice examples: </p>\n\n<p><a href=\"http://zvon.org/other/haskell/Outputlist/groupBy_f.html\" rel=\"nofollow noreferrer\">example1</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/1316365/haskell-surprising-behavior-of-groupby\">example2</a></p>\n\n<p>So, you gotta decide what's in your function (a -> a -> Bool) for grouping the way you want. \nAlso, you have to decide if you need just one group criterion or more than one. \nWe could say, you have this pattern \"a | b\\na | b\\n\", and so on, well, you need to decide where \"to cut\" for grouping but also what happens with \"a\" and \"b\".</p>\n\n<p>And that's it. </p>\n\n<p>I hope I could help. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7115782"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 352, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1481546948, "creation_date": 1481535923, "question_id": 41097961, "link": "https://stackoverflow.com/questions/41097961/how-to-transform-a-string-into-a-list-of-tuple", "title": "How to transform a String into a list of tuple?", "body": "<p>We have a String that if shown with putStr would produce the timetable for buses.</p>\n\n<p>it looks something like this:\n    \"4 | 12 32 52\\n5 | 12 32 52\\n\"</p>\n\n<p>What I need to work with is to change it into this form:\n    [{4, [12 32 52]},{5, [12 32 52]}] \nI need int to work with.</p>\n\n<p>Please don't solve it, just give me ideas, or functions that might help.</p>\n\n<p>Also we were told to use groupBy, but for group and groupBy I only get a \"not in scope\"</p>\n"}, {"tags": ["haskell", "monad-transformers"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481536883, "post_id": 41096328, "comment_id": 69400782, "body": "It&#39;s just limitation of mtl. You can see other libraries. <a href=\"https://ro-che.info/articles/extensible-effects\" rel=\"nofollow noreferrer\">This post</a> can help you more."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481537258, "post_id": 41096328, "comment_id": 69401031, "body": "@freestyle, that post is about slightly different problem. I tried to clarify the question: why MonadReader isn&#39;t a superclass of MonadState"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481538735, "post_id": 41096328, "comment_id": 69401837, "body": "I think you would want to ask another question: Why I can&#39;t use MonadReader or MonadWriter interface when I have the State monad on my stack? So I&#39;ve just tried to answer on it."}], "answers": [{"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1481551272, "post_id": 41096879, "comment_id": 69409203, "body": "So, I could write <code>RWST s m</code> (n.b: only <code>s</code>), implementing <code>MonadReader s</code>, <code>MonadWriter s</code> and <code>MonadState s</code>. I wonder is anyone has made such in their public or private developments. I suspect that with lenses, only one transformer would be enough.   I&#39;m keen to learn about potential API issues."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 3, "creation_date": 1481554557, "post_id": 41096879, "comment_id": 69411224, "body": "@phadej I would call that <code>State2</code> or something else, but not <code>RWS</code>, since the point of <code>RWS</code> is having a guaranteed read-only part and a guaranteed append-only part, beyond the read/write part of the state. If there is only <code>s</code>, I guess we actually have a <code>State</code> newtype except with more instances (which is not a bad idea, for the reasons you mention)."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 7, "last_activity_date": 1481531718, "creation_date": 1481531718, "answer_id": 41096879, "question_id": 41096328, "link": "https://stackoverflow.com/questions/41096328/why-monadreader-r-statet-s-m-uses-an-instance-of-the-underlying-monad/41096879#41096879", "title": "Why MonadReader r (StateT s m) uses an instance of the underlying monad", "body": "<p>Yes, you could do that, but it would violate the spirit of <code>mtl</code> and potentially lead to API issues. The idea of <code>mtl</code> is that each standard monad transformer adds one or more distinct effects. Adding <code>StateT</code> and <code>ReaderT</code> to the transformer stack give you a state and an environment. If <code>StateT</code> implemented its own <code>MonadReader</code> instance, then you'd have access to just the state blob, through two different interfaces. To add an environment to the mix, you'd have to work with the transformers \"manually\". If you see <code>MonadChronicle</code> as offering effects you might want to layer on top of writer and exception effects, then you should keep them separate. If you see it as an extension/refinement of those effects, then superclasses make sense.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481614886, "post_id": 41113604, "comment_id": 69435666, "body": "The fact that <code>mappend</code> and <code>&lt;|&gt;</code> for <code>Maybe</code> do different things is most unfortunate."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1507519763, "post_id": 41113604, "comment_id": 80225991, "body": "@dfeuer Why do you think it&#39;s unfortunate? There&#39;s an <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Monoid.html#t:Alt\" rel=\"nofollow noreferrer\"><code>Alt</code></a> wrapper for that, as well as <a href=\"http://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Monoid.html#t:First\" rel=\"nofollow noreferrer\"><code>First</code></a>."}], "tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": false, "score": 0, "last_activity_date": 1481602311, "creation_date": 1481602311, "answer_id": 41113604, "question_id": 41096328, "link": "https://stackoverflow.com/questions/41096328/why-monadreader-r-statet-s-m-uses-an-instance-of-the-underlying-monad/41113604#41113604", "title": "Why MonadReader r (StateT s m) uses an instance of the underlying monad", "body": "<p>I think, aside from the nice theoretical/philosophical reasons about the <code>MonadReader</code> instance for <code>StateT</code>, I think that the current set-up is also the most <em>practical</em>.</p>\n\n<p>It's more <em>useful</em> to have <code>MonadReader</code> and <code>MonadState</code> give different functionality.  Then you can leverage <code>ask</code> and <code>get</code> to do two different things.  If <code>ask</code> and <code>get</code> did the same thing, it'd pretty much be redundant functionality.  Having them do separate things is much more practical and gives you much more flexibility in the usage of <code>StateT</code> through its <code>MonadReader</code> and <code>MonadState</code> instances/interfaces.</p>\n\n<p>It's a similar reason to why <code>mappend</code> and <code>&lt;|&gt;</code> for <code>Maybe</code> do different things.  It'd just be a waste of potential utility :)</p>\n\n<p>I'd imagine that if <code>StateT</code> gave the same behavior for <code>ask</code> and <code>get</code>, people would be complaining about how impractical/limiting it'd be.</p>\n"}], "owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 41096879, "answer_count": 2, "score": 4, "last_activity_date": 1481602311, "creation_date": 1481529214, "last_edit_date": 1481537208, "question_id": 41096328, "link": "https://stackoverflow.com/questions/41096328/why-monadreader-r-statet-s-m-uses-an-instance-of-the-underlying-monad", "title": "Why MonadReader r (StateT s m) uses an instance of the underlying monad", "body": "<p>As far as I can see, we could implement <code>MonadReader s (StateT s m)</code> instance:</p>\n\n<pre><code>instance MonadReader s (StateT s m) where\n    ask = get\n    local f m = do\n        s &lt;- get\n        put (f s)\n        m\n        put s   \n</code></pre>\n\n<p>i.e. why it isn't</p>\n\n<pre><code>class MonadReader s m =&gt; MonadState s m | s -&gt; m where ...\n</code></pre>\n\n<p>Similarly we could have <code>Monoid s =&gt; MonadWriter s (StateT s m)</code> instance.</p>\n\n<p>Is there some deep reason between the choice?</p>\n\n<hr>\n\n<p>This question is motivated by whether <code>MonadError</code> and <code>MonadWriter</code> should be\nsuper classes of <a href=\"http://hackage.haskell.org/package/these-0.7.2/docs/Control-Monad-Chronicle.html#t:MonadChronicle\" rel=\"nofollow noreferrer\"><code>MonadChronicle</code></a></p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1481528167, "post_id": 41096040, "comment_id": 69396596, "body": "That would make the language impure. If we allow arbitrary I/O actions in pure code then the function <code>f :: Int -&gt; Int</code> could overwrite the whole harddisk when called. By forcing I/O only inside the IO monad we have the guarantee that <code>f</code> <i>cannot</i> overwrite the harddisk when called."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1481528332, "post_id": 41096040, "comment_id": 69396659, "body": "Are you suggesting that <code>readFile :: FilePath -&gt; String</code> (in which case <code>readFile</code> would be impure), or are you suggesting that <code>.</code> be polymorphic enough to include the type <code>(.) :: (b -&gt; c) -&gt; (a -&gt; IO b) -&gt; a -&gt; IO c</code>?"}, {"owner": {"reputation": 2019, "user_id": 5800895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cab3b0361b7e54267c70c02754f21de?s=128&d=identicon&r=PG&f=1", "display_name": "Derek Elkins left SE", "link": "https://stackoverflow.com/users/5800895/derek-elkins-left-se"}, "edited": false, "score": 6, "creation_date": 1481546678, "post_id": 41096040, "comment_id": 69406386, "body": "I recommend not thinking of <code>IO</code> as a &quot;wrapper&quot;.  You probably don&#39;t think of <code>Tree</code> as a &quot;wrapper&quot; around <code>a</code> in <code>Tree a</code>."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1481528806, "post_id": 41096208, "comment_id": 69396857, "body": "The <a href=\"http://homepages.inf.ed.ac.uk/wadler/papers/imperative/imperative.ps\" rel=\"nofollow noreferrer\">1993 paper by Peyton Jones and Wadler</a> which introduced the IO monad is a good introduction and might be a worthy reference."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1481529539, "post_id": 41096208, "comment_id": 69397146, "body": "I don&#39;t really like the wording of this answer... you are stating that because expressions are referentially transparent, then <code>readFile &quot;a.txt&quot;</code> would always return the same result... this sounds pretty wrong from a language design point of view. The language was <i>designed</i> to avoid I/O actions in expressions <i>in order to obtain</i> referential transparency... I mean: referential transparency is <i>not</i> &quot;the cause&quot;, it&#39;s the objective achieved by forcing I/O into the IO monad. Haskell <i>could</i> have been designed how the OP wanted, but then it would not be referentially transparent."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1481529868, "post_id": 41096208, "comment_id": 69397278, "body": "Yes, it is an important note that the language was deliberately designed this way, thanks."}], "tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": false, "score": 7, "last_activity_date": 1481563557, "last_edit_date": 1481563557, "creation_date": 1481528710, "answer_id": 41096208, "question_id": 41096040, "link": "https://stackoverflow.com/questions/41096040/why-wrap-an-io-result-in-io-monad/41096208#41096208", "title": "Why wrap an IO result in IO Monad", "body": "<p>Haskell expressions are <a href=\"https://en.wikipedia.org/wiki/Referential_transparency\" rel=\"nofollow noreferrer\">referentially transparent</a>. This means that if <code>readFile</code> would really have a type of <code>FilePath -&gt; String</code>, then expression <code>readFile \"a.txt\"</code> would always yield the same result. Even if you read the file, then change it, and then read again, you will get the contents in its first state.</p>\n\n<p>Thus, we need to distingush between <strong>values</strong> and <strong>actions</strong>, and this is what <code>IO</code> is for. It doesn't let you use the result <code>readFile \"a.exe\"</code> in other expressions until you <strong>perform</strong> an action associated with it. As a consequence, after changing your file you <strong>have to perform</strong> the reading action again, to get file contents, and because of that you will able to see the changes.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1481531882, "post_id": 41096524, "comment_id": 69398107, "body": "<code>main</code> is not a function. Its type has no arrows in it."}, {"owner": {"reputation": 12612, "user_id": 884463, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tH15z.png?s=128&g=1", "display_name": "David Tonhofer", "link": "https://stackoverflow.com/users/884463/david-tonhofer"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481627019, "post_id": 41096524, "comment_id": 69442674, "body": "@dfeuer What <i>is</i> <code>main</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 12612, "user_id": 884463, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tH15z.png?s=128&g=1", "display_name": "David Tonhofer", "link": "https://stackoverflow.com/users/884463/david-tonhofer"}, "edited": false, "score": 3, "creation_date": 1481749976, "post_id": 41096524, "comment_id": 69506721, "body": "@DavidTonhofer It is a value of type <code>IO a</code>. If you want a more vivid description, it is a <i>program</i>, in the sense explained by the answers here. (Saying that a value of type <code>IO a</code> is a program is no different than saying e.g. a value of type <code>[a]</code> is a list.)"}], "tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": false, "score": 5, "last_activity_date": 1481530617, "last_edit_date": 1481530617, "creation_date": 1481530060, "answer_id": 41096524, "question_id": 41096040, "link": "https://stackoverflow.com/questions/41096040/why-wrap-an-io-result-in-io-monad/41096524#41096524", "title": "Why wrap an IO result in IO Monad", "body": "<h2>We write functions that create computer programs</h2>\n\n<p>It should be noted that Haskell is a functional programming language. Functions, in the mathematical sense, always produce the same values for the same inputs.</p>\n\n<p>Now this requirement to always produce the same result constrains things quite a bit, since a function to read a file would somehow have to produce the same result every time, even if the file was later changed. That's obviously not what we really want.</p>\n\n<p>There is, however, a way to make a functional programming language that can handle reading a changing file. What you do is to write a function that produces some action the computer should perform. So you might perform an action composed of the following steps:</p>\n\n<pre><code>Read the file\nBreak it into lines\nChange the even-numbered lines to uppercase\nOutput the lines to the screen\n</code></pre>\n\n<p>These four actions aren't performed yet. They're just a sequence of actions that we might perform. A function can return that exact same sequence of potential actions every time it's called, which makes it a proper mathematical function.</p>\n\n<p>The <code>main :: IO a</code> function in Haskell returns the action that the program should perform. It always returns the same action, making it a proper mathematical function. When the program is run, the computer evaluates the <code>main</code> function, producing the action the computer should perform, and the computer then executes the action.</p>\n\n<h2>Do notation</h2>\n\n<p>Do notation takes the strangeness out of the process, giving you the feel of a much more standard programming language. You have three options:</p>\n\n<ol>\n<li>Perform an action and do nothing with its results</li>\n<li>Perform an action and store its results</li>\n<li>Process data using only functions (no actions)</li>\n</ol>\n\n<p>These are done in the following ways, respectively:</p>\n\n<ol>\n<li><code>action args</code></li>\n<li><code>result &lt;- action args</code></li>\n<li><code>let result = f . g . h . whateverCalculation $ value</code></li>\n</ol>\n\n<p>This is similar to an imperative language like C where you do, respectively:</p>\n\n<ol>\n<li><code>action(args);</code></li>\n<li><code>result = action(args);</code></li>\n<li><code>result = f(g(h(whateverCalculation(value))));</code></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1538059835, "last_edit_date": 1538059835, "creation_date": 1481571455, "answer_id": 41108269, "question_id": 41096040, "link": "https://stackoverflow.com/questions/41096040/why-wrap-an-io-result-in-io-monad/41108269#41108269", "title": "Why wrap an IO result in IO Monad", "body": "<p>For <code>(lines.readFile) path</code> to work, the type of <code>readFile</code> would need to be <code>FilePath -&gt; String</code>. That, however, doesn't make sense in Haskell. A Haskell function is supposed to always produce the same results when given the same arguments. If the result type <code>readFile</code> was <code>String</code>, however, that would not happen, as <code>readFile \"foo.txt\"</code> would have to, for any useful implementation of such a <code>readFile</code>, produce different strings depending on the contents of the <em>foo.txt</em> file.</p>\n\n<p>The Haskell solution to this issue is giving <code>readFile</code> the type <code>FilePath -&gt; IO String</code>. An <code>IO String</code> is not a string, but a <em>program</em> that can be executed by the computer and that, when executed, somehow materialises a <code>String</code> into memory. While the <code>String</code> thus produced might be different each time the program is executed, the program itself remains the same, and therefore <code>readFile</code> always returns the same results when given the same arguments (and so, for instance, <code>readFile \"foo.txt\"</code> is always the same program).</p>\n\n<p>This trick of manipulating a program that produces an I/O-dependent result instead of the result itself only works if the I/O-dependent result is kept opaque; that is, if there is no way of directly extracting it. In other words, there cannot be, for instance, an <code>IO String -&gt; String</code> function -- for one, it would allow us to implement a <code>readFile</code> with the inappropriate type <code>FilePath -&gt; String</code> that we have discussed above. There are, however, indirect ways of using the I/O-dependent result that do not lead to trouble. One of them is using it to create a second program, whose I/O-dependent result is just as opaque as the first one was. The <code>Monad</code> interface allows us to express this usage pattern:</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Specialising <code>(&gt;&gt;=)</code> to <code>IO</code>, we get:</p>\n\n<pre><code>(&gt;&gt;=) @IO :: IO a -&gt; (a -&gt; IO b) -&gt; IO b\n</code></pre>\n\n<p>The first program has type <code>IO a</code>, and the function that produces the second program using the I/O-dependent result of the first one has type <code>a -&gt; IO b</code>. The result of <code>(&gt;&gt;=)</code> is a program which executes the first program and the second, newly generated, one in sequence. For instance...</p>\n\n<pre><code>readFile \"foo.txt\" &gt;&gt;= putStrLn\n</code></pre>\n\n<p>... is a program which reads the contents of <em>foo.txt</em> and then displays these contents.</p>\n\n<hr>\n\n<p>P.S.: With respect to your example involving <code>lines</code>, it is worth noting that both <code>(readFile &gt;&gt;= lines) path</code>, as you have written it,  and <code>(\\p -&gt; readFile p &gt;&gt;= lines) path</code> are rejected by the type checker. Something that does work is:</p>\n\n<pre><code>(fmap lines . readFile) path\n</code></pre>\n\n<p>In it, we are making indirect use of the file contents in a different way. If we have a program which produces an I/O-dependent result, we can turn it into a program which produces a modified version of this result. That is done through <code>fmap</code>, from the <code>Functor</code> class:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Or, specialising to <code>IO</code>:</p>\n\n<pre><code>fmap @IO :: (a -&gt; b) -&gt; IO a -&gt; IO b\n</code></pre>\n"}], "owner": {"reputation": 2330, "user_id": 2708169, "user_type": "registered", "accept_rate": 49, "profile_image": "https://graph.facebook.com/100002659380732/picture?type=large", "display_name": "Faiz Halde", "link": "https://stackoverflow.com/users/2708169/faiz-halde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 928, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1538059835, "creation_date": 1481527893, "last_edit_date": 1481571614, "question_id": 41096040, "link": "https://stackoverflow.com/questions/41096040/why-wrap-an-io-result-in-io-monad", "title": "Why wrap an IO result in IO Monad", "body": "<p>In Haskell we have a function <code>readFile :: FilePath -&gt; IO String</code>. My question while understanding monad is why wrap it in <code>IO</code>? Couldn't we just have written function like these:</p>\n\n<pre><code>(lines.readFile) path\n</code></pre>\n\n<p>Rather than</p>\n\n<pre><code>(readFile &gt;&gt;= lines) path \n</code></pre>\n\n<p>What benefit does the IO wrapper provide?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1481527832, "creation_date": 1481527832, "answer_id": 41096023, "question_id": 41095748, "link": "https://stackoverflow.com/questions/41095748/how-to-convert-arbitrary-type-to-string-without-adding-extra-quotes-to-strings/41096023#41096023", "title": "How to convert arbitrary type to string, without adding extra quotes to strings?", "body": "<p>This sort of ad-hoc polymorphism is permitted through type-classes. However, they will have to be overlapping since you want a catch all case:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances, UndecideableInstances #-}\n\nclass Print a where\n  makeString :: a -&gt; String\n\ninstance {-# OVERLAPPING #-} Print String where\n  makeString s = s\n\ninstance Show a =&gt; Print a where\n  makeString x = show x\n</code></pre>\n\n<hr>\n\n<p>Then, your function is <code>makeString :: Print a =&gt; a -&gt; String</code> and it has an instance for everything that has a <code>Show</code> instance. To have the second instance, you need <code>FlexibleInstances</code> (the instance head is not of the usual form) and <code>UndecideableInstances</code> (since the constraint is as general as the instance head, GHC can't be sure that it won't fall into an infinite loop trying to solve these constraints).</p>\n"}, {"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 4, "last_activity_date": 1481534079, "creation_date": 1481534079, "answer_id": 41097463, "question_id": 41095748, "link": "https://stackoverflow.com/questions/41095748/how-to-convert-arbitrary-type-to-string-without-adding-extra-quotes-to-strings/41097463#41097463", "title": "How to convert arbitrary type to string, without adding extra quotes to strings?", "body": "<p>If you want something like Alec's approach without overlapping instances, you can get it with a type family.</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies, MultiParamTypeClasses, ScopedTypeVariables, UndecidableInstances, FlexibleInstances, DataKinds, ... whatever else GHC tells you it needs #-}\n\nimport Data.Text (Text, unpack)\nimport Data.Proxy\n\nclass Print a where\n  makeString :: a -&gt; String\n\ndata Name = NString | NText | NShow\ntype family Choose a where\n  Choose [Char] = 'NString\n  Choose Text = 'NText\n  Choose _ = 'NShow\n\nclass Print' (n :: Name) a where\n  makeString' :: proxy n -&gt; a -&gt; String\n\ninstance (Choose a ~ n, Print' n a) =&gt; Print a where\n  makeString = makeString' (Proxy :: Proxy n)\n\ninstance a ~ String =&gt; Print' 'NString a where\n  makeString' _ = id\n\ninstance a ~ Text =&gt; Print' 'NText a where\n  makeString' _ = unpack\n\ninstance Show a =&gt; Print' 'NShow a where\n  makeString' _ = show\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 466, "user_id": 13601469, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GgwMGfIvSVfMGGUfd1B7rQTwpGTpTbzsGGJMpKf=k-s128", "display_name": "daydaynatation", "link": "https://stackoverflow.com/users/13601469/daydaynatation"}, "edited": false, "score": 0, "creation_date": 1616009679, "post_id": 41103342, "comment_id": 117872467, "body": "This only works if x is <code>String</code>. For example, if x is <code>Text</code>, then it still adds the quote"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1481553983, "last_edit_date": 1481553983, "creation_date": 1481553738, "answer_id": 41103342, "question_id": 41095748, "link": "https://stackoverflow.com/questions/41095748/how-to-convert-arbitrary-type-to-string-without-adding-extra-quotes-to-strings/41103342#41103342", "title": "How to convert arbitrary type to string, without adding extra quotes to strings?", "body": "<p>Expanding the OP solution attempt into a working one:</p>\n\n<pre><code>import Data.Typeable\n\ntoString :: (Show a, Typeable a) =&gt; a -&gt; String\ntoString x = case cast x of\n   Just y  -&gt; y\n   Nothing -&gt; show x\n</code></pre>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "accepted_answer_id": 41096023, "answer_count": 3, "score": 5, "last_activity_date": 1481553983, "creation_date": 1481526615, "last_edit_date": 1481527646, "question_id": 41095748, "link": "https://stackoverflow.com/questions/41095748/how-to-convert-arbitrary-type-to-string-without-adding-extra-quotes-to-strings", "title": "How to convert arbitrary type to string, without adding extra quotes to strings?", "body": "<p>I want to define a function which converts to strings, like the following 'toString':</p>\n\n<pre><code>toString 1 = \"1\"\ntoString True = \"True\"\ntoString \"1\" = \"1\"\n</code></pre>\n\n<p>Note that 'show' does not do this. By contrast it does the following:</p>\n\n<pre><code>show 1 = \"1\"\nshow True = \"True\"\nshow \"1\" = \"\\\"1\\\"\"\n</code></pre>\n\n<p>That is, it adds extra quotes around strings. In this case I don't want to add extra quotes if I already have a string.</p>\n\n<p>I'm considering using something like:</p>\n\n<pre><code>import Data.Typeable\n\ntoString a :: (Show a) =&gt; a -&gt; String\ntoString a\n  | typeOf a == typeOf \"\" = a\n  | otherwise = show a\n</code></pre>\n\n<p>Are there any pitfalls in doing such a weird type-based conditional? Is there some built-in Haskell function that would be better to use instead?</p>\n"}, {"tags": ["haskell", "recursion", "stack-overflow"], "comments": [{"owner": {"reputation": 45920, "user_id": 4996248, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IUaWZ.jpg?s=128&g=1", "display_name": "John Coleman", "link": "https://stackoverflow.com/users/4996248/john-coleman"}, "edited": false, "score": 4, "creation_date": 1481521736, "post_id": 41094651, "comment_id": 69394386, "body": "Not all implementation of all programming languages use a fixed-size stack to allocate call frames."}], "answers": [{"tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": true, "score": 3, "last_activity_date": 1481525624, "creation_date": 1481525624, "answer_id": 41095544, "question_id": 41094651, "link": "https://stackoverflow.com/questions/41094651/why-doesnt-this-cause-stackoverflow/41095544#41095544", "title": "Why doesn&#39;t this cause stackoverflow?", "body": "<p>Nothing special is going on. 10,000 is just not enough to fill the stack. I get a stack overflow in <code>ghci</code> when I replace <code>take 10000</code> with <code>take 100000000</code>.</p>\n"}], "owner": {"reputation": 7535, "user_id": 956134, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95f88f7c5f4fac6d14156c0100bdbc4d?s=128&d=identicon&r=PG", "display_name": "math4tots", "link": "https://stackoverflow.com/users/956134/math4tots"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 41095544, "answer_count": 1, "score": 0, "last_activity_date": 1481525624, "creation_date": 1481520419, "question_id": 41094651, "link": "https://stackoverflow.com/questions/41094651/why-doesnt-this-cause-stackoverflow", "title": "Why doesn&#39;t this cause stackoverflow?", "body": "<p>In <code>8.hs</code> I define</p>\n\n<pre><code>digitProduct [] = 1\ndigitProduct (c:rest) = (read [c] :: Int) * digitProduct rest\n</code></pre>\n\n<p>Then inside <code>ghci</code>, I run</p>\n\n<pre><code>digitProduct $ take 10000 $ repeat '9'\n</code></pre>\n\n<p>And it produces a result:</p>\n\n<pre><code>-3633723290617080191\n</code></pre>\n\n<p>I would've imagined that a recursion of 10000 would've caused a stackoverflow. Also, my recursion isn't a tail call. What's going on here?</p>\n"}, {"tags": ["haskell", "type-conversion", "isomorphism"], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 4998031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/890d16362868811d15ca0e0aeb73c7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Max twelve", "link": "https://stackoverflow.com/users/4998031/max-twelve"}, "edited": false, "score": 0, "creation_date": 1481514542, "post_id": 41093828, "comment_id": 69392690, "body": "Thank you for your response, I am trying to give implementation for the two functions  sToS2 :: Stream a -&gt; Stream2 a  s2ToS :: Stream2 a -&gt; Stream a  Where it converts between the two data types."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 101, "user_id": 4998031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/890d16362868811d15ca0e0aeb73c7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Max twelve", "link": "https://stackoverflow.com/users/4998031/max-twelve"}, "edited": false, "score": 0, "creation_date": 1481515012, "post_id": 41093828, "comment_id": 69392779, "body": "@Maxtwelve I know, this answer is a work in progess. See the latest edit."}, {"owner": {"reputation": 101, "user_id": 4998031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/890d16362868811d15ca0e0aeb73c7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Max twelve", "link": "https://stackoverflow.com/users/4998031/max-twelve"}, "edited": false, "score": 0, "creation_date": 1481577768, "post_id": 41093828, "comment_id": 69423998, "body": "Thank you for your response, Can the Cons operator be used for data type that is not a list? Can it just be read the same way as in x is the head and xs is the tail of the Stream datatype?"}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "reply_to_user": {"reputation": 101, "user_id": 4998031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/890d16362868811d15ca0e0aeb73c7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Max twelve", "link": "https://stackoverflow.com/users/4998031/max-twelve"}, "edited": false, "score": 0, "creation_date": 1481584416, "post_id": 41093828, "comment_id": 69426983, "body": "Sorry, I don&#39;t understand the question."}], "tags": [], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "is_accepted": false, "score": 6, "last_activity_date": 1481515197, "last_edit_date": 1481515197, "creation_date": 1481513581, "answer_id": 41093828, "question_id": 41093747, "link": "https://stackoverflow.com/questions/41093747/conversion-between-two-stream-types/41093828#41093828", "title": "Conversion between two stream types", "body": "<blockquote>\n  <p>there is no base case, which makes me wonder if this is somehow infinite</p>\n</blockquote>\n\n<p>It is!</p>\n\n<blockquote>\n  <p>and how I could go about creating a stream</p>\n</blockquote>\n\n<p>Recursively! Haskell is nonstrict, so this is no problem. Behold:</p>\n\n<pre><code>successors :: Num a =&gt; a -&gt; Stream a\nsuccessors start = Cons start $ successors $ start + 1\n\n\u03bb&gt; case successors 1 of Cons _ (Cons _ (Cons x _)) -&gt; x\n3\n</code></pre>\n\n<blockquote>\n  <p>the constructor for Stream2 is given in record syntax where one of the fields is also something of type Stream2</p>\n</blockquote>\n\n<p>Indeed. Aside from using the record sugar, the <code>Stream2</code> type is identical (or, more precisely, <em>isomorphic</em>) to <code>Stream</code>. We might line things up a bit to make the parallels more visually obvious:</p>\n\n<pre><code>data Stream  a = Cons            a           (Stream  a)\ndata Stream2 a = ST   { shead :: a, stail ::  Stream2 a }\n--   [  1  ]     [ 2 ]          [3]           [   4   ]\n</code></pre>\n\n<ol>\n<li>The type</li>\n<li>The type's only constructor</li>\n<li>Type of the first constructor parameter</li>\n<li>Type of the second constructor parameter</li>\n</ol>\n\n<p>You can ignore the record syntax when you're writing the conversions.</p>\n\n<pre><code>sToS2 :: Stream  a -&gt; Stream2 a\ns2ToS :: Stream2 a -&gt; Stream  a\n\nsToS2 (Cons x xs) = ST   x $ sToS2 xs\ns2ToS (ST   x xs) = Cons x $ s2ToS xs\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 4998031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/890d16362868811d15ca0e0aeb73c7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Max twelve", "link": "https://stackoverflow.com/users/4998031/max-twelve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1481515330, "creation_date": 1481512863, "last_edit_date": 1592644375, "question_id": 41093747, "link": "https://stackoverflow.com/questions/41093747/conversion-between-two-stream-types", "title": "Conversion between two stream types", "body": "<p>I have a question regarding converting between two datatypes in Haskell.</p>\n<blockquote>\n<p>Consider the following two datatypes</p>\n<pre><code>data Stream a = Cons a (Stream a)\n\ndata Stream2 a = ST {shead :: a, stail :: Stream2 a}\n</code></pre>\n<p>Q2: Write</p>\n<pre><code>sToS2 :: Stream a -&gt; Stream2 a\n\ns2ToS :: Stream2 a -&gt; Stream a\n</code></pre>\n<p>that convert between the two representations of streams</p>\n</blockquote>\n<p>The first thing that I am having trouble with is the Stream datatype, We can see this is a recursive datatype but there is no base case, which makes me wonder if this is somehow infinite and how I could go about creating a stream datatype. Furthermore the constructor for Stream2 is given in record syntax where one of the fields is also something of type Stream2. I understand there was a question similar to time where</p>\n<pre><code>data Ab = A | B\ndata Cd = C | D\n\nfromAb :: Ab -&gt; Cd\nfromAb A = C\nfromAb B = D\n\ntoAb :: Cd -&gt; Ab\ntoAb C = A\ntoAb D = B\n</code></pre>\n<p>but I am unsure how I can apply the answers from this question to my particular confusion.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1481510530, "post_id": 41093242, "comment_id": 69391724, "body": "There is no answer to &quot;What is <code>xs</code> in <code>x:xs</code> in every &#39;iteration&#39;?&quot; because there are no &quot;iterations&quot; of <code>x:xs</code>. Meditate on this expression: <code>[undefined | _ &lt;- []] == []</code>."}, {"owner": {"reputation": 2430, "user_id": 1525842, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95abedfeb09f68271233421d1aafb3be?s=128&d=identicon&r=PG", "display_name": "zeronone", "link": "https://stackoverflow.com/users/1525842/zeronone"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1481526628, "post_id": 41093242, "comment_id": 69395970, "body": "@duplode gave a great answer regarding why it doesn&#39;t work. But I assume, you wanted to create lists of lists each containing a single element; which you can do with <code>f n = [x:xs | x &lt;- [1..n], xs &lt;- [[]] ]</code>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1481563152, "post_id": 41093242, "comment_id": 69416332, "body": "That creates single-element lists, but why would you do it that way? Just <code>f n = [[x] | x &lt;- [1..n]]</code>, or <code>f n = map pure [1..n]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 10, "last_activity_date": 1520273092, "last_edit_date": 1520273092, "creation_date": 1481509479, "answer_id": 41093377, "question_id": 41093242, "link": "https://stackoverflow.com/questions/41093242/empty-list-generators/41093377#41093377", "title": "Empty list generators", "body": "<p>The zoomed-out answer is that...</p>\n\n<pre><code>[x:xs | x &lt;- [1..n], xs &lt;- []]\n</code></pre>\n\n<p>... consists of all possible lists generated by picking an element (<code>x</code>) from <code>[1..n]</code> plus an element (<code>xs</code>) from <code>[]</code> and prepending one to the other. Since there are no elements in <code>[]</code>, the number of lists that can be generated in this way is zero.</p>\n\n<p>The zoomed-in answer is that <a href=\"https://stackoverflow.com/q/8029046/2751851\">list comprehensions are sugar for the list monad</a>, and so this...</p>\n\n<pre><code>[x:xs | x &lt;- [1..n], xs &lt;- []]\n</code></pre>\n\n<p>... is equivalent to...</p>\n\n<pre><code>do\n    x &lt;- [1..n]\n    xs &lt;- []\n    return (x:xs)\n</code></pre>\n\n<p>... that is (after desugaring do-notation)...</p>\n\n<pre><code>[1..n] &gt;&gt;= \\x -&gt;\n[] &gt;&gt;= \\xs -&gt;\nreturn (x:xs)\n\n-- Or, without the line breaks:\n[1..n] &gt;&gt;= \\x -&gt; [] &gt;&gt;= \\xs -&gt; return (x:xs)\n</code></pre>\n\n<p>... that is (after substituting the definitions of <code>(&gt;&gt;=)</code> and <code>return</code> for the list monad):</p>\n\n<pre><code>concatMap (\\x -&gt; concatMap (\\xs -&gt; [x:xs]) []) [1..n]\n</code></pre>\n\n<p><code>concatMap</code> (which, as the name suggests, is merely <code>map</code> followed by <code>concat</code>) on an empty list gives an empty list, and so it becomes...</p>\n\n<pre><code>concatMap (\\x -&gt; []) [1..n]\n</code></pre>\n\n<p>... which amounts to replacing each element of <code>[1..n]</code> with an empty list and then <code>concat</code>-ing the result, which produces an empty list.</p>\n"}], "owner": {"reputation": 25, "user_id": 7276253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ee55ed5310ecea3d0adc211cc467?s=128&d=identicon&r=PG&f=1", "display_name": "Steven D.", "link": "https://stackoverflow.com/users/7276253/steven-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 41093377, "answer_count": 1, "score": 0, "last_activity_date": 1520273092, "creation_date": 1481508029, "last_edit_date": 1481509738, "question_id": 41093242, "link": "https://stackoverflow.com/questions/41093242/empty-list-generators", "title": "Empty list generators", "body": "<p>How list generators are handled by Haskell? Specifically, why does this</p>\n\n<pre><code>f n = [x:xs | x &lt;- [1..n], xs &lt;- []]\n</code></pre>\n\n<p>yields empty list? What is <code>xs</code> in <code>x:xs</code> in every 'iteration'?</p>\n"}, {"tags": ["haskell", "bytestring", "http-conduit"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1481507853, "post_id": 41093163, "comment_id": 69391230, "body": "As a footnote, it is worth mentioning that importing the bytestring modules qualified is also useful to avoid name clashes with <code>Prelude</code> stuff such as <code>map</code> or <code>readFile</code>."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1481508075, "post_id": 41093163, "comment_id": 69391267, "body": "Thanks, @Alec.  Couple things trying to work this.  If I do the import as only import Data.ByteString, it does not seem to match:      <code>\u2022 Couldn&#39;t match type \u2018Data.ByteString.Lazy.Internal.ByteString\u2019                      with \u2018ByteString\u2019</code>"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1481508350, "post_id": 41093163, "comment_id": 69391321, "body": "And (2), what am I doing wrong in trying to make my monads match your comments on that?  I&#39;m trying:  <code>getUrl :: String -&gt; ByteString getUrl = do simpleHttp url </code>  And I get:       <code>Variable not in scope: url :: String</code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 1, "creation_date": 1481508788, "post_id": 41093163, "comment_id": 69391408, "body": "@Mittenchops For your first comment - that&#39;s my bad (I&#39;ve fixed the answer). You need to import <code>Data.ByteString.Lazy</code> not just <code>Data.ByteString</code> (you need the lazy, not strict version). As to the second: <code>getUrl url = simpleHttp url</code> is enough, and <code>main = getUrl &quot;https:&#47;&#47;www.stackoverflow.com&quot;</code> is enough."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1481508933, "last_edit_date": 1481508933, "creation_date": 1481507282, "answer_id": 41093163, "question_id": 41093043, "link": "https://stackoverflow.com/questions/41093043/clumsy-looking-type-signature-for-bytestrings-in-haskell-http-response/41093163#41093163", "title": "Clumsy Looking Type Signature for ByteStrings in Haskell HTTP Response", "body": "<p>You can always write types with their qualified path. However, as you've already imported <code>Data.ByteString.Lazy.Internal</code> and unless you have some other <code>ByteString</code> type in scope (like the strict one) you can simply omit the <code>Data.ByteString.Lazy.Internal</code>:</p>\n\n<pre><code>getUrl :: IO ByteString\n</code></pre>\n\n<p>Also, unless you have some particular need to import <code>Internal</code>, I recommend you just import <code>Data.ByteString.Lazy</code> (which also exports the lazy <code>ByteString</code> type you are using). If you have both strict and lazy <code>ByteString</code> in scope, I'd import them qualified:</p>\n\n<pre><code> import qualified Data.ByteString as BS\n import qualified Data.ByteString.Lazy as BL\n</code></pre>\n\n<p>Then <code>BS.ByteString</code> is the strict type and <code>BL.ByteString</code> the lazy one - no need to write out the full <code>Data.ByteString.ByteString</code> or <code>Data.ByteString.Lazy.ByteString</code>.</p>\n\n<p>It is also worth mentioning (thanks @duplode) that either of the bytestring modules is usually best imported qualified since they defines a whole bunch of functions that clash with the Prelude (and with each other).</p>\n\n<p>Finally, note that parens around a type by itself does nothing. <code>(ByteString)</code> and <code>ByteString</code> are identical. As such, I would not include them.</p>\n\n<hr>\n\n<p>Unrelated to your question, but some remarks on your monadic code:</p>\n\n<ul>\n<li><p>Every time you write something like</p>\n\n<pre><code>do x &lt;- e\n   return x\n</code></pre>\n\n<p>it can be replace with just <code>e</code>.</p></li>\n<li><p>Every time you write something like</p>\n\n<pre><code>do e\n</code></pre>\n\n<p>it can be replaced with <code>e</code>.</p></li>\n</ul>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 41093163, "answer_count": 1, "score": 0, "last_activity_date": 1481508933, "creation_date": 1481506147, "last_edit_date": 1495540801, "question_id": 41093043, "link": "https://stackoverflow.com/questions/41093043/clumsy-looking-type-signature-for-bytestrings-in-haskell-http-response", "title": "Clumsy Looking Type Signature for ByteStrings in Haskell HTTP Response", "body": "<p>I'm experimenting with the http-conduit library and have this simple example:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n    --resolver lts-7.12\n    --install-ghc\n    runghc\n    --package http-conduit\n-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport Network.HTTP.Conduit\nimport Data.ByteString.Lazy.Internal\n\ngetUrl :: IO (Data.ByteString.Lazy.Internal.ByteString) ---eeew!\ngetUrl = do\n  resp &lt;- simpleHttp \"http://www.stackoverflow.com\"\n  return resp\n</code></pre>\n\n<p>I understand from <a href=\"https://stackoverflow.com/questions/37571939/data-bytestring-lazy-internal-bytestring-to-string\">this post</a> that I should prefer a response as a ByteString to a [Char] or String. I assumed the OverloadedStrings pragma might make this less of an issue, but doesn't appear to change with respect to my out-type.</p>\n\n<p>The function works fine and dutifully prints out a simple http response for the homepage of SO, but that type signature looks really ugly:</p>\n\n<pre><code>getUrl :: IO (Data.ByteString.Lazy.Internal.ByteString)\n</code></pre>\n\n<p>And I have to say I see very few things like that from internet examples (we've got more dots than an elliptical Java import, man).  Is that right?  If I want to return a reponse and then start parsing on it, say with HXT or tagsoup or attoparsec, is this the right approach or type signature?</p>\n\n<p>I notice, for example, this gets even uglier when I start to add the ability to take arguments, such as supplying a different URL:</p>\n\n<pre><code>import Network.HTTP.Conduit\nimport Data.ByteString.Lazy.Internal\n\n-- alright, first arg is now string for my url...\ngetUrl :: String -&gt; IO (Data.ByteString.Lazy.Internal.ByteString)\ngetUrl url = do\n  resp &lt;- simpleHttp url\n  return resp\n\n\nmain :: IO (ByteString)  -- what?!  inside the () ?\nmain = do\n  getUrl \"https://www.stackoverflow.com\"\n</code></pre>\n\n<p>This seems unwholesome.  How should I understand how to structure this correctly?</p>\n"}, {"tags": ["haskell", "fft", "pcm"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1481503131, "post_id": 41092524, "comment_id": 69390386, "body": "What is wrong with <code>hGet</code> from <code>Data.ByteString</code>? You get to specify the number of bytes you want to read."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481566763, "post_id": 41092524, "comment_id": 69418305, "body": "@Alec: Could you put this as an answer? It would also be good to add how to get a <code>Handle</code> from a named pipe (which I don&#39;t know myself)."}, {"owner": {"reputation": 31, "user_id": 6302448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17c85c4b4028b974d2a142330033a371?s=128&d=identicon&r=PG&f=1", "display_name": "Rigel", "link": "https://stackoverflow.com/users/6302448/rigel"}, "edited": false, "score": 0, "creation_date": 1481571290, "post_id": 41092524, "comment_id": 69420688, "body": "Yeup that does it! I posted it as an answer after using your snippet to figure it out fully."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481605952, "post_id": 41108188, "comment_id": 69432429, "body": "Glad you got it! Might want to mention that <code>hGet</code> blocks (or so I think) until it gets either the number of bytes you specified or EOF. IIRC handles are sort of equivalent to file descriptors on unix based systems."}], "tags": [], "owner": {"reputation": 31, "user_id": 6302448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17c85c4b4028b974d2a142330033a371?s=128&d=identicon&r=PG&f=1", "display_name": "Rigel", "link": "https://stackoverflow.com/users/6302448/rigel"}, "is_accepted": false, "score": 1, "last_activity_date": 1481571193, "creation_date": 1481571193, "answer_id": 41108188, "question_id": 41092524, "link": "https://stackoverflow.com/questions/41092524/haskell-read-fixed-amount-of-data-from-named-pipe/41108188#41108188", "title": "Haskell: read fixed amount of data from named pipe", "body": "<p>As mentioned by Alec, this is actually very simple.</p>\n\n<p>Simply get a handle for the named pipe:</p>\n\n<pre><code>sourceHandle &lt;- openFile \"/path/to/pipe.fifo\" ReadMode\n</code></pre>\n\n<p>and then use <code>Data.ByteString.hGet sourceHandle n</code> to read n bytes.</p>\n\n<p>I hadn't seen examples using this method and simply thought that handles would work the same as readFile which can only do the entire file. So as I had assumed, I was missing something, thanks!</p>\n"}], "owner": {"reputation": 31, "user_id": 6302448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17c85c4b4028b974d2a142330033a371?s=128&d=identicon&r=PG&f=1", "display_name": "Rigel", "link": "https://stackoverflow.com/users/6302448/rigel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1481571193, "creation_date": 1481500892, "question_id": 41092524, "link": "https://stackoverflow.com/questions/41092524/haskell-read-fixed-amount-of-data-from-named-pipe", "title": "Haskell: read fixed amount of data from named pipe", "body": "<p>I'm somewhat new to Haskell, and as a beginner project I'm trying to make a little music visualizer. </p>\n\n<p>I typically use ncmpcpp+mpd as a music player, and due to that I have a fifo named pipe sending raw PCM data to /tmp/mpd.fifo. </p>\n\n<p>What I want to do is read in a fixed amount of PCM samples from this file, perform an FFT on that data chunk, print the output and then repeat. I've looked at Data.Stream, Data.Bytestring in Haskell's library but cannot figure out how to simply get a fixed size amount of data from the named pipe.</p>\n\n<p>I figure there must be a simple way to do this and I'm just missing/not understand something, so any help is appreciated.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1481498490, "post_id": 41092220, "comment_id": 69389387, "body": "You should start by expanding <code>&gt;&gt;=</code> and <code>return</code>, replacing them by their definition."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481499166, "post_id": 41092220, "comment_id": 69389570, "body": "&quot;from what I understand (&gt;&gt;=) is called bind and could be read in the expression above as applyMaybe&quot; -- The name &quot;applyMaybe&quot; would only make sense in the <code>Maybe</code> monad."}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 7044369, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ab445262cc43d7c5deb3dff2b467d24?s=128&d=identicon&r=PG", "display_name": "Kono Dio Da", "link": "https://stackoverflow.com/users/7044369/kono-dio-da"}, "edited": false, "score": 0, "creation_date": 1481500846, "post_id": 41092351, "comment_id": 69389969, "body": "I see what you meant, but my Prof. originally intended it to be like that. But yeah probably would have helped if she had it just like you illustrated. Thanks."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 1, "last_activity_date": 1481499358, "creation_date": 1481499358, "answer_id": 41092351, "question_id": 41092220, "link": "https://stackoverflow.com/questions/41092220/result-of-expressions-in-haskell-with-monads/41092351#41092351", "title": "Result of expressions in Haskell with monads", "body": "<p>First, let's be clear how this expression is parsed: lambdas are <em>syntactic heralds</em>, i.e. they grab as much as they can to their right, using it as the function result. So what you have there is parsed as</p>\n\n<pre><code>[1,2,3] &gt;&gt;= (\\x -&gt; ([x..3] &gt;&gt;= \\y -&gt; return x))\n</code></pre>\n\n<p>The inner expression is actually written more complicated than it should be. <code>y</code> isn't used at all, and <code>a &gt;&gt;= \\_ -&gt; p</code> can just be written as <code>a &gt;&gt; p</code>. There's an even better replacement though: generally, the monadic bind <code>a &gt;&gt;= \\q -&gt; return (f q)</code> is equivalent to <code>fmap f a</code>, so your expression should really be written</p>\n\n<pre><code>[1,2,3] &gt;&gt;= (\\x -&gt; (fmap (const x) [x..3]))\n</code></pre>\n\n<p>or</p>\n\n<pre><code>[1,2,3] &gt;&gt;= \\x -&gt; map (const x) [x..3]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>[1,2,3] &gt;&gt;= \\x -&gt; replicate (3-x+1) x\n</code></pre>\n\n<p>At this point it should be pretty clear what the result will be, since <code>&gt;&gt;=</code> in the list monad simply maps over each element and concatenates the results.</p>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481500791, "post_id": 41092374, "comment_id": 69389952, "body": "That&#39;s a great diagram at the end"}, {"owner": {"reputation": 17, "user_id": 7044369, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ab445262cc43d7c5deb3dff2b467d24?s=128&d=identicon&r=PG", "display_name": "Kono Dio Da", "link": "https://stackoverflow.com/users/7044369/kono-dio-da"}, "edited": false, "score": 0, "creation_date": 1481500914, "post_id": 41092374, "comment_id": 69389985, "body": "Thanks for the detailed explanation, helped me understand it better."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1481500615, "last_edit_date": 1481500615, "creation_date": 1481499574, "answer_id": 41092374, "question_id": 41092220, "link": "https://stackoverflow.com/questions/41092220/result-of-expressions-in-haskell-with-monads/41092374#41092374", "title": "Result of expressions in Haskell with monads", "body": "<blockquote>\n  <p>this case for the first part of bind we get [1,2,3,2,3,3]</p>\n</blockquote>\n\n<p>Correct.</p>\n\n<blockquote>\n  <p>and we continue to the second part of the bind, but \"return x\" is defined to return the list of x. Which should have been [1,2,3,2,3,3].</p>\n</blockquote>\n\n<p>Note that, in...</p>\n\n<pre><code>[1,2,3] &gt;&gt;= \\x -&gt; [x..3] &gt;&gt;= \\y -&gt; return x\n</code></pre>\n\n<p>... <code>x</code> is bound by (the lambda of) the first <code>(&gt;&gt;=)</code>, and not by the second one. Some extra parentheses might make that clearer:</p>\n\n<pre><code>[1,2,3] &gt;&gt;= (\\x -&gt; [x..3] &gt;&gt;= (\\y -&gt; return x))\n</code></pre>\n\n<p>In <code>\\y -&gt; return x</code>, the values bound to <code>y</code> (that is, the elements of <code>[1,2,3,2,3,3]</code>) are ignored, and replaced by the corresponding values bound to <code>x</code> (that is, the elements of the original list from which each <code>y</code> was generated). Schematically, we have:</p>\n\n<pre><code>[1,     2,   3] -- [1,2,3]\n[1,2,3, 2,3, 3] -- [1,2,3] &gt;&gt;= \\x -&gt; [x..3]\n[1,1,1, 2,2, 3] -- [1,2,3] &gt;&gt;= \\x -&gt; [x..3] &gt;&gt;= \\y -&gt; return x\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 7044369, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ab445262cc43d7c5deb3dff2b467d24?s=128&d=identicon&r=PG", "display_name": "Kono Dio Da", "link": "https://stackoverflow.com/users/7044369/kono-dio-da"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 41092374, "answer_count": 2, "score": 1, "last_activity_date": 1481518352, "creation_date": 1481498308, "last_edit_date": 1481518352, "question_id": 41092220, "link": "https://stackoverflow.com/questions/41092220/result-of-expressions-in-haskell-with-monads", "title": "Result of expressions in Haskell with monads", "body": "<p>I'm currently preparing for my final exam regarding Haskell, and I am going over the Monads and we were giving an example such as:</p>\n\n<p>Given the following definition for the List Monad:</p>\n\n<pre><code>instance Monad [] where\n  m &gt;&gt;= f = concatMap f m\n  return x = [x] \n</code></pre>\n\n<p>where the types of <code>(&gt;&gt;=)</code> and <code>concatMap</code> are</p>\n\n<pre><code> (&gt;&gt;=) :: [a] -&gt; (a -&gt; [b]) -&gt; [b]\n concatMap :: (a -&gt; [b]) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>What is the result of the expression?</p>\n\n<pre><code>&gt; [1,2,3] &gt;&gt;= \\x -&gt; [x..3] &gt;&gt;= \\y -&gt; return x\n  [1, 1, 1, 2, 2, 3] //Answer\n</code></pre>\n\n<p>Here the answer is different from what I thought it to be, now we briefly went over Monads, but from what I understand <code>(&gt;&gt;=)</code> is called bind and could be read in the expression above as \"applyMaybe\". In this case for the first part of bind we get <code>[1,2,3,2,3,3]</code> and we continue to the second part of the bind, but <code>return x</code> is defined to return the list of x. Which should have been <code>[1,2,3,2,3,3]</code>. However, I might have misunderstood the expression. Can anyone explain the wrong doing of my approach and how should I have tackled this. Thanks.    </p>\n"}, {"tags": ["algorithm", "haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 175, "user_id": 1617848, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/vMztI.png?s=128&g=1", "display_name": "ibe", "link": "https://stackoverflow.com/users/1617848/ibe"}, "edited": false, "score": 0, "creation_date": 1481499179, "post_id": 41091843, "comment_id": 69389574, "body": "considering <code>(y:xs&#39;) &lt;- [[1,2,3],[2,3],[3],[]]</code> (1), the function should take the fist element and construct all combinations starting from it; then take the second element etc...  so, what happens when the pattern (1) reaches <code>[3]</code> ?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 175, "user_id": 1617848, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/vMztI.png?s=128&g=1", "display_name": "ibe", "link": "https://stackoverflow.com/users/1617848/ibe"}, "edited": false, "score": 0, "creation_date": 1481501047, "post_id": 41091843, "comment_id": 69390009, "body": "@ibe, <code>[3] = 3 : []</code>  . So <code>y</code> will be <code>3</code> and <code>xs&#39;</code> will be <code>[]</code>.  Figure out what <code>combos</code> does on an empty list and you will know...   (Btw <code>[ whatever | x &lt;- [] ]</code> is just <code>[]</code>, because there&#39;s no value we could give <code>x</code>)"}, {"owner": {"reputation": 175, "user_id": 1617848, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/vMztI.png?s=128&g=1", "display_name": "ibe", "link": "https://stackoverflow.com/users/1617848/ibe"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481501590, "post_id": 41091843, "comment_id": 69390129, "body": "@luqui <code>y</code> will be <code>3</code> and <code>xs&#39;</code> will be <code>[]</code>. then given <code>ys &lt;- combos 1 []</code> won&#39;t we have <code>3:[]</code> ? by algorithm we construct combinations by taking 1st element and generating all combos starting from it etc..., this goes to the <code>end</code> of the list. however there aren&#39;t any combos starting from <code>3</code>. how the function handles it?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481501694, "post_id": 41091843, "comment_id": 69390146, "body": "<code>combos 1 [] = []</code>, so <code>ys</code> can&#39;t be assigned any value, thus the whole list comprehension is <code>[]</code>.  Again this is about the difference between <code>&lt;-</code> and <code>let</code>.  When you say <code>x &lt;- xs</code>, <code>x</code> takes on <i>each</i> value in <code>xs</code>, like a loop."}, {"owner": {"reputation": 175, "user_id": 1617848, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/vMztI.png?s=128&g=1", "display_name": "ibe", "link": "https://stackoverflow.com/users/1617848/ibe"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481503115, "post_id": 41091843, "comment_id": 69390384, "body": "@luqui btw, how it is possible for <code>combos</code> to return <code>[]</code> when by type signature it returns <code>[[]]</code> ? is haskell somehow relaxes this or what?"}, {"owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "edited": false, "score": 1, "creation_date": 1481503448, "post_id": 41091843, "comment_id": 69390451, "body": "<code>[[a]]</code> means <code>a list of lists of a</code>; the outer list can be empty, too!"}], "tags": [], "owner": {"reputation": 8806, "user_id": 257418, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/97Mb4.png?s=128&g=1", "display_name": "Lynn", "link": "https://stackoverflow.com/users/257418/lynn"}, "is_accepted": false, "score": 3, "last_activity_date": 1481495308, "creation_date": 1481495308, "answer_id": 41091843, "question_id": 41091780, "link": "https://stackoverflow.com/questions/41091780/constructing-list-of-lists-inside-list-comprehensions-in-haskell/41091843#41091843", "title": "Constructing list of lists inside list comprehensions in Haskell", "body": "<p>Note the difference between <code>\u2026 &lt;- \u2026</code> and <code>let \u2026 = \u2026</code> here. In a list comprehension, both sides of <code>x &lt;- xs</code> can\u2019t have the same type; <code>x</code> is successively assigned to each <em>element</em> of <code>xs</code>.</p>\n\n<p>In your example, <code>(y:xs') &lt;- [[1,2,3],[2,3],[3],[]]</code> means we <em>take</em> elements from that list matching the pattern <code>(y:xs')</code>. So the first time we make a selection here, <code>y == 1</code> and <code>xs' == [2,3]</code>; the second time we make a selection, <code>y == 2</code> and <code>xs' == [3]</code>, et cetera.</p>\n"}], "owner": {"reputation": 175, "user_id": 1617848, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/vMztI.png?s=128&g=1", "display_name": "ibe", "link": "https://stackoverflow.com/users/1617848/ibe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 653, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1481495964, "creation_date": 1481494853, "last_edit_date": 1481495964, "question_id": 41091780, "link": "https://stackoverflow.com/questions/41091780/constructing-list-of-lists-inside-list-comprehensions-in-haskell", "title": "Constructing list of lists inside list comprehensions in Haskell", "body": "<p>There's an algorithm I've found on wiki.haskell.org for generating combinations of n elements from a given list. It constructs <code>[[a]]</code> via list comprehension.</p>\n\n<pre><code>combos :: Int -&gt; [a] -&gt; [[a]]\ncombos 0 _  = [ [] ]\ncombos n xs = [ y:ys | y:xs' &lt;- tails xs\n                           , ys &lt;- combos (n-1) xs']\n</code></pre>\n\n<p>Say we execute <code>combos 2 [1,2,3]</code>, then the main function would look like:</p>\n\n<pre><code>combos 2 [1,2,3] = [ y:ys | y:xs' &lt;- [[1,2,3],[2,3],[3],[]]\n                           , ys &lt;- combos 1 xs']\n</code></pre>\n\n<p>I assume that in a pattern <code>y:xs'</code> <code>y</code> is a list (<code>[1,2,3]</code> for the first run) and <code>xs'</code> is a list of lists (<code>[[2,3],[3],[]]</code> for the first run).</p>\n\n<p>I'm confused about the part, when <code>xs'</code> gets thrown as an argument to the recursive <code>combos</code> call (<code>ys &lt;- combos 1 xs')</code>. (<code>combos</code> now becomes <code>[[a]] -&gt; [[[a]]]</code>?)</p>\n\n<p>How it is all working out? Could you, please, describe how this function works?</p>\n"}, {"tags": ["algorithm", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1481480850, "post_id": 41089463, "comment_id": 69383943, "body": "Detecting loops is impossible."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 5, "creation_date": 1481480940, "post_id": 41089463, "comment_id": 69383984, "body": "<code>==</code> tests value equality (by looking at every element of the lists), not pointer equality. Haskell doesn&#39;t feature pointers."}, {"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 1, "creation_date": 1481482256, "post_id": 41089463, "comment_id": 69384445, "body": "You should state that you are trying to implement the <a href=\"https://en.wikipedia.org/wiki/Cycle_detection#Tortoise_and_hare\" rel=\"nofollow noreferrer\">Tortoise and Hare</a> algorithm. This is not possible in pure haskell. With <code>IO</code>, it should be possible though."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1481482441, "post_id": 41089463, "comment_id": 69384507, "body": "There are no looping linked lists in Haskell, as there are no pointers to form a loop. There are infinite lists, but it&#39;s not possible to detect one."}, {"owner": {"reputation": 620, "user_id": 2576287, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh5.googleusercontent.com/-VegFz4P9Ovc/AAAAAAAAAAI/AAAAAAAAATo/Z-69W9rBCno/photo.jpg?sz=128", "display_name": "mrLSD", "link": "https://stackoverflow.com/users/2576287/mrlsd"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1481486599, "post_id": 41089463, "comment_id": 69385877, "body": "@n.m. Why do you think no looping linked lists here? Looping linked list infinite a-priori."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1481486760, "post_id": 41089463, "comment_id": 69385913, "body": "@mrLSD Please provide a simple value of type <code>List a</code> that contains a loop."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1481488918, "post_id": 41089463, "comment_id": 69386557, "body": "Of course they are infinite. They also don&#39;t exist."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1481489267, "post_id": 41089463, "comment_id": 69386675, "body": "@chepner Do you not consider values like this to be a linked list with a loop? <code>let x = Cons 5 x in x</code>. Of course it&#39;s still not a loop you can <i>detect</i>."}], "answers": [{"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1481481121, "post_id": 41089574, "comment_id": 69384050, "body": "Maybe add a note to contrast this to pointer equality, which op is looking for?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 2, "creation_date": 1481481305, "post_id": 41089574, "comment_id": 69384112, "body": "@jpath I don&#39;t know what OP is looking for yet. And I don&#39;t like the name &quot;pointer equality&quot;: You can compare pointers in Haskell (by value), but normal values don&#39;t have addresses. So I&#39;d have to contrast this to something that literally doesn&#39;t exist in Haskell (with an additional note that it&#39;s unrelated to the <code>Ptr</code> type)."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1481481635, "post_id": 41089574, "comment_id": 69384223, "body": "They don&#39;t have to exist in Haskell, to compare them to value equality. I just thought it would be helpful, as OP probably comes from a procedural background and it would help him understand why he can do this in which ever language he is coming from but not so easily in Haskell. But maybe he can figure it out and it&#39;s fine."}, {"owner": {"reputation": 620, "user_id": 2576287, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh5.googleusercontent.com/-VegFz4P9Ovc/AAAAAAAAAAI/AAAAAAAAATo/Z-69W9rBCno/photo.jpg?sz=128", "display_name": "mrLSD", "link": "https://stackoverflow.com/users/2576287/mrlsd"}, "edited": false, "score": 0, "creation_date": 1481487455, "post_id": 41089574, "comment_id": 69386099, "body": "@melpomene I made conclusion, that with pure Haskell, it is impossible detect infinite loop for subject? IO my way?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 620, "user_id": 2576287, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh5.googleusercontent.com/-VegFz4P9Ovc/AAAAAAAAAAI/AAAAAAAAATo/Z-69W9rBCno/photo.jpg?sz=128", "display_name": "mrLSD", "link": "https://stackoverflow.com/users/2576287/mrlsd"}, "edited": false, "score": 1, "creation_date": 1481488010, "post_id": 41089574, "comment_id": 69386287, "body": "@mrLSD Given your data type, you can&#39;t detect cycles in it. It may be possible for a different data structure (e.g. one with explicit pointers)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1481517099, "post_id": 41089574, "comment_id": 69393250, "body": "This answer as stands is perfectly correct, but <a href=\"https://hackage.haskell.org/package/data-reify\" rel=\"nofollow noreferrer\">the claim that you cannot detect cycles in pure data types is entirely false.</a>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1481518717, "post_id": 41089574, "comment_id": 69393604, "body": "@user2407038 That 1) looks like black magic and 2) seems to be undocumented. (I see it uses <code>unsafeCoerce</code>, and according to the description it &quot;<i>can be used safely even with unsafePerformIO if some simple conditions are met</i>&quot; but those conditions are never explained.) But even so I&#39;m pretty sure it only detects &quot;physical&quot; cycles (where the underlying implementation points back to existing nodes), not &quot;logical&quot; cycles where values just happen to repeat (I think <code>iterate (\\n -&gt; succ n `div` 2) 0</code> is an example of the latter.)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1481519300, "post_id": 41089574, "comment_id": 69393737, "body": "@melpomene There is a <a href=\"https://pdfs.semanticscholar.org/4838/bd0a91b3058b467fa31ad9e0810121b46388.pdf\" rel=\"nofollow noreferrer\">paper</a>, but we are on stackoverflow and not math.stackexchange.  And indeed, the concepts of definitional cycles and semantic cycles are entirely orthogonal, in Haskell. The question seems to be about the latter and the answer addresses that exactly. The former is invariably brought up whenever &#39;detecting cycles&#39; is mentioned."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 4, "last_activity_date": 1481481759, "last_edit_date": 1481481759, "creation_date": 1481481015, "answer_id": 41089574, "question_id": 41089463, "link": "https://stackoverflow.com/questions/41089463/simple-linked-list-loop-detection-in-haskell/41089574#41089574", "title": "Simple linked list loop detection in Haskell", "body": "<pre><code>      | current == next1 || current == next2            = True\n</code></pre>\n\n<p>This line uses <code>==</code> on two unknown lists. To determine whether two lists are equal, <code>==</code> has to walk over their elements. If the lists are infinite, <code>==</code> will only return after finding a difference. If they're equal, <code>==</code> will never stop.</p>\n\n<p>As for why <code>==</code> does this: The compiler-generated <code>Eq</code> instance for your type (as provided by <code>deriving (Eq)</code>) looks like this:</p>\n\n<pre><code>instance (Eq a) =&gt; Eq (List a) where\n    (==) Nil         Nil         = True\n    (==) (Cons x xs) (Cons y ys) = x == y &amp;&amp; xs == ys\n    (==) _           _           = False\n</code></pre>\n\n<p>The recursion is in the <code>xs == ys</code> part.</p>\n"}], "owner": {"reputation": 620, "user_id": 2576287, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh5.googleusercontent.com/-VegFz4P9Ovc/AAAAAAAAAAI/AAAAAAAAATo/Z-69W9rBCno/photo.jpg?sz=128", "display_name": "mrLSD", "link": "https://stackoverflow.com/users/2576287/mrlsd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "accepted_answer_id": 41089574, "answer_count": 1, "score": 0, "last_activity_date": 1481481947, "creation_date": 1481480368, "last_edit_date": 1481481947, "question_id": 41089463, "link": "https://stackoverflow.com/questions/41089463/simple-linked-list-loop-detection-in-haskell", "title": "Simple linked list loop detection in Haskell", "body": "<p>I tried to implement a simple linked list in Haskell...</p>\n\n<pre><code>data List a = Nil | Cons a (List a) deriving (Show, Eq)\n</code></pre>\n\n<p>... and a loop detection algorithm for it:</p>\n\n<pre><code>listNext :: List a -&gt; List a\nlistNext Nil          = Nil\nlistNext (Cons _ xs) = xs\n\nloopDetecting' :: (Eq a) =&gt; List a -&gt; List a -&gt; Bool\nloopDetecting' current next\n      | current == Nil || next1 == Nil || next2 == Nil  = False\n      | current == next1 || current == next2            = True\n      | otherwise = loopDetecting' (listNext current) next2\n      where\n          next1 = listNext next\n          next2 | next1 == Nil  = Nil\n                | otherwise     = listNext next1\n\nloopDetecting :: (Eq a) =&gt;  List a -&gt; Bool\nloopDetecting Nil         = False\nloopDetecting (Cons _ xs) = loopDetecting' xs xs\n</code></pre>\n\n<p>However, I got infinite recursion. What is wrong?</p>\n\n<p>Full code here: <a href=\"https://gist.github.com/mrLSD/03381a277c336c1902f9d78b79a131b0\" rel=\"nofollow noreferrer\">https://gist.github.com/mrLSD/03381a277c336c1902f9d78b79a131b0</a></p>\n"}, {"tags": ["haskell", "ghc", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1481467076, "post_id": 41086866, "comment_id": 69379573, "body": "Ooh, that&#39;s neat."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481483361, "post_id": 41086866, "comment_id": 69384833, "body": "Is this constraint trick in the SO Documentation for Haskell? It seems to come up fairly often. I know I&#39;ve used it in several answers and comments."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481490164, "post_id": 41086866, "comment_id": 69386980, "body": "@dfeuer I&#39;m not sure. Also the name &quot;constraint trick&quot; is overly general and makes it sound like, well, a trick. Would something like &quot;instance resolution can drive type inference&quot; be better?"}, {"owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "edited": false, "score": 0, "creation_date": 1481518911, "post_id": 41086866, "comment_id": 69393649, "body": "Unfortunately the line with <code>flex &quot;1&quot;</code> still causes problems when I enable OverloadedStrings.  You mentioned that instance resolution doesn&#39;t backtrack. But what about type inference? GHC could try with the most obvious choice for <code>&quot;1&quot;</code>, which is <code>String</code> and then try to infer the other types based on that."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "edited": false, "score": 0, "creation_date": 1481529422, "post_id": 41086866, "comment_id": 69397091, "body": "@wereHamster To solve the problem with OverloadedStrings, perhaps you can try the &quot;constraint trick&quot; for a second time: <code>instance (a ~ (),s ~ String) =&gt; Term (s -&gt; StyleM a)</code>. Resolving the instance will inform the typechecker that <code>a</code> must be <code>()</code> and <code>s</code> must be <code>String</code>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "edited": false, "score": 0, "creation_date": 1481529633, "post_id": 41086866, "comment_id": 69397182, "body": "@wereHamster &quot;GHC could try with the most obvious choice for <code>1</code>, which is String and then try to infer the other types based on that.&quot; But then if you later added a <code>Term (Text -&gt; StyleM a)</code> instance, that would create an ambiguity. As Reid Barton said, &quot;GHC never assumes that it knows about all instances, when checking a use of a type class&quot;. This conservative approach ensures that existing code won&#39;t change behaviour or cease to compile because someone added a new instance elsewhere in your program, or in a library."}, {"owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "edited": false, "score": 0, "creation_date": 1481538989, "post_id": 41086866, "comment_id": 69401998, "body": "@danidiaz The trick with the second constraint helped. Thanks a lot! Now I can move forward with the actual implementation of the library :)"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 14, "last_activity_date": 1481465803, "last_edit_date": 1481465803, "creation_date": 1481464166, "answer_id": 41086866, "question_id": 41086039, "link": "https://stackoverflow.com/questions/41086039/ghc-doesnt-pick-the-only-available-instance/41086866#41086866", "title": "GHC doesn&#39;t pick the only available instance", "body": "<p>The problem is that the <code>Term</code> instance for <code>String -&gt; StyleM ()</code> only exists when <code>StyleM</code> is parameterized with <code>()</code>. But in a do-block like</p>\n\n<pre><code>someStyle :: Style\nsomeStyle = Style $ do\n    flex \"1\"\n    return ()\n</code></pre>\n\n<p>there is not enough information to know which is the type parameter in <code>flex \"1\"</code>, because the return value is thrown away.</p>\n\n<p>A common solution to this problem is the <a href=\"http://chrisdone.com/posts/haskell-constraint-trick\" rel=\"noreferrer\">\"constraint trick\"</a>. It requires type equality constraints, so you have to enable <code>{-# LANGUAGE TypeFamilies #-}</code>\n or <code>{-# LANGUAGE GADTs #-}</code> and tweak the instance like this:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ninstance (a ~ ()) =&gt; Term (String -&gt; StyleM a) where\n    term property value = tell [(property, value)]\n</code></pre>\n\n<p>This tells the compiler: \"You don't need to know the precise type <code>a</code> to get the instance, there is one for all types! However, once the instance is determined, you'll <em>always</em> find that the type was <code>()</code> after all!\"</p>\n\n<p>This trick is the typeclass version of Henry Ford's \"You can have any color you like, as long as it's black.\" The compiler can find an instance <em>despite</em> the ambiguity, and finding the instance gives him enough information to <em>resolve</em> the ambiguity.</p>\n\n<p>It works because Haskell's instance resolution <em>never</em> backtracks, so once an instance \"matches\", the compiler has to commit to any equalities it discovers in the preconditions of the instance declaration, or throw a type error.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1481484090, "post_id": 41087264, "comment_id": 69385069, "body": "I think saying that fully polymorphic instances are almost never a good idea goes a bit too far. Fully polymorphic instances of custom classes can be very useful. They&#39;re pretty commonly used to bundle many constraints into a single one, and are often necessary for using machinery like <code>Data.Constraint.Forall</code>. That said, fully polymorphic instances of standard classes are absolutely terrible."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481500470, "post_id": 41087264, "comment_id": 69389867, "body": "That&#39;s the &quot;almost&quot;. And nowadays you can write a type synonym for the constraints."}, {"owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "edited": false, "score": 0, "creation_date": 1481521960, "post_id": 41087264, "comment_id": 69394448, "body": "&gt;  Logically, then, the only possible answers to a question &quot;is there an instance for C T&quot; are &quot;yes&quot; and &quot;I don&#39;t know&quot;.   That question though is a precondition to be able to compile the code. And the compiler can not say &quot;I don&#39;t know&quot; when you ask it whether it can compile code or not. Or rather, &quot;I don&#39;t know&quot; is the same as &quot;No&quot;, because the output is binary: Either I get an executable or not."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1481551189, "post_id": 41087264, "comment_id": 69409145, "body": "If your program needs an instance <code>C T</code> to compile then an &quot;I don&#39;t know&quot; answer is the same as a &quot;no&quot; answer, yes. But if your program needs an instance to <i>not</i> exist in order to compile, then you can never be sure that the instance does not exist. In your example, you need the nonexistence of instances like <code>String -&gt; StyleM Bool</code> (which could have totally different behavior!) in order to not be ambiguous."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 6, "last_activity_date": 1481466743, "creation_date": 1481466743, "answer_id": 41087264, "question_id": 41086039, "link": "https://stackoverflow.com/questions/41086039/ghc-doesnt-pick-the-only-available-instance/41087264#41087264", "title": "GHC doesn&#39;t pick the only available instance", "body": "<blockquote>\n  <p>There is only one instance which fits (and indeed, in the type error GHC prints \"These potential instance exist:\" and then it lists just one). I'm confused that given the choice of a single instance, GHC refuses to use it.</p>\n</blockquote>\n\n<p>Type classes are open; any module could define new instances. So GHC never assumes that it knows about <em>all</em> instances, when checking a use of a type class. (With the possible exception of the bad extensions like <code>OverlappingInstances</code>.) Logically, then, the only possible answers to a question \"is there an instance for <code>C T</code>\" are \"yes\" and \"I don't know\". To answer \"no\" risks incoherence with another part of your program that does define an instance <code>C T</code>.</p>\n\n<p>So, you should not imagine the compiler iterating over every declared instance and seeing whether it fits at the particular use site of interest, because what would it do with all the \"I don't know\"s? Instead, the process works like this: infer the most general type that could be used at the particular use site and <em>query</em> the instance store for the needed instance. The query can return a more general instance than the one needed, but it can never return a more specific instance, since it would have to choose which more specific instance to return; then your program is ambiguous.</p>\n\n<p>One way to think about the difference is that iterating over all declared instances for <code>C</code> would take linear time in the number of instances, while querying the instance store for a specific instance only has to examine a constant number of potential instances. For example, if I want to type check</p>\n\n<p><code>Left True == Left False</code></p>\n\n<p>I need an instance for <code>Eq (Either Bool t)</code>, which can only be satisfied by one of</p>\n\n<pre><code>instance Eq (Either Bool t)\ninstance Eq (Either a t)    -- *\ninstance Eq (f Bool t)\ninstance Eq (f a t)\ninstance Eq (g t)\ninstance Eq b\n</code></pre>\n\n<p>(The instance marked <code>*</code> is the one that actually exists, and in standard Haskell (without <code>FlexibleInstances</code>) it's the <em>only</em> one of these instances that is legal to declare; the traditional restriction to instances of the form <code>C (T var1 ... varN)</code> makes this step easy since there will always be exactly one potential instance.)</p>\n\n<p>If instances are stored in something like a hash table then this query can be done in constant time regardless of the number of declared instances of <code>Eq</code> (which is probably a pretty large number).</p>\n\n<p>In this step, only instance heads (the stuff to the right of the <code>=&gt;</code>) are examined. Along with a \"yes\" answer, the instance store can return new constraints on type variables that come from the context of the instance (the stuff to the left of the <code>=&gt;</code>). These constraints then need to be solved in the same manner. (This is why instances are considered to overlap if they have overlapping heads, even if their contexts look mutually exclusive, and why <code>instance Foo a =&gt; Bar a</code> is almost never a good idea.)</p>\n\n<p>In your case, since a value of any type can be discarded in <code>do</code> notation, we need an instance for <code>Term (String -&gt; StyleM a)</code>. The instance <code>Term (String -&gt; StyleM ())</code> is more specific, so it's useless in this case. You could either write</p>\n\n<pre><code>do\n  () &lt;- flex \"1\"\n  ...\n</code></pre>\n\n<p>to make the needed instance more specific, or make the provided instance more general by using the type equality trick as explained in danidiaz's answer.</p>\n"}], "owner": {"reputation": 447, "user_id": 1075783, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7f02c799d087a8fa2cc3d4b25bf0d2e3?s=128&d=identicon&r=PG", "display_name": "wereHamster", "link": "https://stackoverflow.com/users/1075783/werehamster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 1, "accepted_answer_id": 41086866, "answer_count": 2, "score": 6, "last_activity_date": 1481466743, "creation_date": 1481458481, "question_id": 41086039, "link": "https://stackoverflow.com/questions/41086039/ghc-doesnt-pick-the-only-available-instance", "title": "GHC doesn&#39;t pick the only available instance", "body": "<p>I'm trying to write a CSS DSL in Haskell, and keep the syntax as close to CSS as possible. One difficulty is that certain terms can appear both as a property and value. For example flex: you can have \"display: flex\" and \"flex: 1\" in CSS.</p>\n\n<p>I've let myself inspire by the Lucid API, which overrides functions based on the function arguments to generate either attributes or DOM nodes (which sometimes also share names, eg <code>&lt;style&gt;</code> and <code>&lt;div style=\"...\"&gt;</code>).</p>\n\n<p>Anyway, I've ran into a problem that GHC fails to typecheck the code (Ambiguous type variable), in a place where it is supposed to pick one of the two available typeclass instances. There is only one instance which fits (and indeed, in the type error GHC prints \"These potential instance exist:\" and then it lists just one). I'm confused that given the choice of a single instance, GHC refuses to use it. Of course, if I add explicit type annotations then the code compiles. Full example below (only dependency is mtl, for Writer).</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances #-}\nmodule Style where\n\nimport Control.Monad.Writer.Lazy\n\n\ntype StyleM = Writer [(String, String)]\nnewtype Style = Style { runStyle :: StyleM () }\n\n\nclass Term a where\n    term :: String -&gt; a\n\ninstance Term String where\n    term = id\n\ninstance Term (String -&gt; StyleM ()) where\n    term property value = tell [(property, value)]\n\n\ndisplay :: String -&gt; StyleM ()\ndisplay = term \"display\"\n\nflex :: Term a =&gt; a\nflex = term \"flex\"\n\nsomeStyle :: Style\nsomeStyle = Style $ do\n    flex \"1\"     -- [1] :: StyleM ()\n    display flex -- [2]\n</code></pre>\n\n<p>And the error:</p>\n\n<pre><code>Style.hs:29:5: error:\n    \u2022 Ambiguous type variable \u2018a0\u2019 arising from a use of \u2018flex\u2019\n      prevents the constraint \u2018(Term\n                                  ([Char]\n                                   -&gt; WriterT\n                                        [(String, String)]\n                                        Data.Functor.Identity.Identity\n                                        a0))\u2019 from being solved.\n        (maybe you haven't applied a function to enough arguments?)\n      Probable fix: use a type annotation to specify what \u2018a0\u2019 should be.\n      These potential instance exist:\n        one instance involving out-of-scope types\n          instance Term (String -&gt; StyleM ()) -- Defined at Style.hs:17:10\n    \u2022 In a stmt of a 'do' block: flex \"1\"\n      In the second argument of \u2018($)\u2019, namely\n        \u2018do { flex \"1\";\n              display flex }\u2019\n      In the expression:\n        Style\n        $ do { flex \"1\";\n               display flex }\nFailed, modules loaded: none.\n</code></pre>\n\n<p>I've found two ways how to make this code compile, none of which I'm happy with.</p>\n\n<ol>\n<li>Add explicit annotation where the flex function is used ([1]).</li>\n<li>Move the line where flex is used to the end of the do block (eg. comment out [2]).</li>\n</ol>\n\n<p>One difference between my API and Lucid is that the Lucid terms always take one argument, and Lucid uses fundeps, which presumably gives the GHC typechecker more information to work with (to choose the correct typeclass instance). But in my case the terms don't always have an argument (when they appear as the value).</p>\n"}, {"tags": ["java", "sockets", "haskell", "upnp", "ssdp"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1481441591, "post_id": 41083332, "comment_id": 69373588, "body": "Are you sure it&#39;s not hanging on <code>sendAll</code>?  You have no log between the two calls."}, {"owner": {"reputation": 1774, "user_id": 802303, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/VynpR.jpg?s=128&g=1", "display_name": "John Dorian", "link": "https://stackoverflow.com/users/802303/john-dorian"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481468717, "post_id": 41083332, "comment_id": 69380069, "body": "@luqui Ah it&#39;s a good thought but I&#39;ve added a <code>putStrLn</code> right before call to <code>recv</code>and it looks like it is sending. Plus I&#39;ve gone through line by line in ghci."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1481469664, "post_id": 41083332, "comment_id": 69380348, "body": "Also check the value returned by <code>sendAll</code>; how many bytes are you sending?"}, {"owner": {"reputation": 1774, "user_id": 802303, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/VynpR.jpg?s=128&g=1", "display_name": "John Dorian", "link": "https://stackoverflow.com/users/802303/john-dorian"}, "reply_to_user": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1481474730, "post_id": 41083332, "comment_id": 69381874, "body": "@ja. It says I&#39;m sending 87, which <code>== length msearch</code>. Do I maybe need to pad it to a certain length?"}], "owner": {"reputation": 1774, "user_id": 802303, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/VynpR.jpg?s=128&g=1", "display_name": "John Dorian", "link": "https://stackoverflow.com/users/802303/john-dorian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 429, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1481434828, "creation_date": 1481434828, "question_id": 41083332, "link": "https://stackoverflow.com/questions/41083332/sending-udp-datagram-with-haskell", "title": "Sending UDP datagram with Haskell", "body": "<p>I'm trying to send an MSEARCH datagram packet to discover my Roku device on my LAN. I have this implemented in Java already, and it works fine, however I'm trying to learn Haskell. While I'm not getting any compilation errors, the code is hanging during a call to <code>recv</code>. </p>\n\n<p>Here's my work in progress, shamelessly mostly plagiarized from the <a href=\"https://hackage.haskell.org/package/network-bytestring-0.1.3.4/docs/Network-Socket-ByteString.html\" rel=\"nofollow noreferrer\">Network.Socket.ByteString documentation page</a>. </p>\n\n<pre><code>import Network.Socket hiding (recv)\nimport Network.Socket.ByteString (recv, sendAll)\nimport qualified Data.ByteString.Char8 as C\nmsearch = \"M-SEARCH * HTTP/1.1\\r\\nHost: 239.255.255.250:1900\\r\\nMan: \\\"ssdp:discover\\\"\\nST: roku:ecp\\r\\n\\r\\n\"\n\nmain :: IO ()\nmain = withSocketsDo $\n    do addrinfos &lt;- getAddrInfo Nothing (Just \"239.255.255.250\") (Just \"1900\")\n       let serveraddr = head addrinfos\n       sock &lt;- socket (addrFamily serveraddr) Datagram defaultProtocol\n       connect sock (addrAddress serveraddr)\n       putStrLn \"Sending: \"\n       putStrLn msearch\n       sendAll sock $ C.pack msearch\n       msg &lt;- recv sock 1024\n       close sock\n       putStr \"Got response: \"\n       C.putStrLn msg\n</code></pre>\n\n<p>In Java:</p>\n\n<pre><code>import java.net.*;\npublic class Msearch {\n    public static void main(String[] args) {\n        try {\n            // MSEARCH query\n            String MSEARCH = \"M-SEARCH * HTTP/1.1\\r\\nHost: 239.255.255.250:1900\\r\\nMan: \\\"ssdp:discover\\\"\\r\\nST: roku:ecp\\r\\n\\r\\n\";\n            byte[] sendData = MSEARCH.getBytes();\n\n            // Send a datagram packet\n            System.out.println(\"Sending:\\n\" + MSEARCH);\n            DatagramPacket sendPacket = new DatagramPacket(sendData, sendData.length, InetAddress.getByName(\"239.255.255.250\"), 1900);\n            DatagramSocket clientSocket = new DatagramSocket();\n            clientSocket.send(sendPacket);\n\n            // Wait for response &amp; close\n            byte[] receiveData = new byte[1024];\n            DatagramPacket receivePacket = new DatagramPacket(receiveData, receiveData.length);\n            clientSocket.receive(receivePacket);\n            clientSocket.close();\n\n            // Print the response\n            String response = new String(receivePacket.getData());\n            System.out.println(\"Got response:\\n\" + response);\n        } catch (Exception e) {\n            // ...\n        }\n    }\n}\n</code></pre>\n\n<p>The Java version works perfectly, yielding:</p>\n\n<pre><code>Sending:\nM-SEARCH * HTTP/1.1\nHost: 239.255.255.250:1900\nMan: \"ssdp:discover\"\nST: roku:ecp\n\n\nGot response:\nHTTP/1.1 200 OK\nCache-Control: max-age=3600\nST: roku:ecp\nUSN: uuid:roku:ecp:2N00G7750045\nExt: \nServer: Roku UPnP/1.0 MiniUPnPd/1.4\nLOCATION: http://192.168.1.169:8060/\n</code></pre>\n\n<p>The Haskell version hangs on the call to <code>recv</code>. I'm still learning Haskell and I'm not sure what I'm doing differently that may be causing this. I would be grateful for any insights!</p>\n"}, {"tags": ["macos", "haskell", "llvm", "ghc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 6, "creation_date": 1481435236, "post_id": 41083281, "comment_id": 69372553, "body": "IIRC GHC is (or at least used to be) pretty touchy about the version of LLVM used, so you may need to install 3.7. The problem is that LLVM has a pretty frequent release cycle with breaking features. Keeping GHC working with these versions is a pain. See <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ImprovedLLVMBackend\" rel=\"nofollow noreferrer\">this page</a> for more details."}], "answers": [{"tags": [], "owner": {"reputation": 2852, "user_id": 183140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b91de057bd9a235c29be070ea4605bb8?s=128&d=identicon&r=PG", "display_name": "Grandpa", "link": "https://stackoverflow.com/users/183140/grandpa"}, "is_accepted": false, "score": 1, "last_activity_date": 1505051899, "creation_date": 1505051899, "answer_id": 46141524, "question_id": 41083281, "link": "https://stackoverflow.com/questions/41083281/compiling-haskell-with-llvm/46141524#46141524", "title": "Compiling haskell with llvm", "body": "<p>The <a href=\"https://downloads.haskell.org/~ghc/8.0.2/docs/html/users_guide/codegens.html#llvm-code-generator-fllvm\" rel=\"nofollow noreferrer\">GHC documentation</a> says that it's compatible with llvm-2.8+, but as you've discovered, it actually requires llvm-3.7.</p>\n\n<p>The simplest way to get it is:</p>\n\n<p><code>brew install llvm@3.7\n</code></p>\n\n<p>This installs llvm binaries in your path with a <code>-3.7</code> suffix, like <code>clang-3.7</code>. GHC will need the unadorned names, which are in a subdirectory:</p>\n\n<p><code>export PATH=/usr/local/opt/llvm@3.7/lib/llvm-3.7/bin:$PATH\n</code></p>\n"}], "owner": {"reputation": 185, "user_id": 7147804, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c838f7fe5963d449ead5757805900b41?s=128&d=identicon&r=PG&f=1", "display_name": "user7147804", "link": "https://stackoverflow.com/users/7147804/user7147804"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549582080, "creation_date": 1481434047, "last_edit_date": 1549582080, "question_id": 41083281, "link": "https://stackoverflow.com/questions/41083281/compiling-haskell-with-llvm", "title": "Compiling haskell with llvm", "body": "<p>I'm starting to learn Haskell and I found out that <code>ghc</code> can compile using LLVM with the <code>-fllvm</code> flag. Whenever I use the flag, I get the error message:</p>\n\n<pre><code>&lt;no location info&gt;: error:\nWarning: Couldn't figure out LLVM version!\n         Make sure you have installed LLVM 3.7\nghc: could not execute: opt\n</code></pre>\n\n<p>However, I have <code>opt</code> in my <code>/usr/local/Cellar/llvm/3.9.0/</code> folder. I'm on a Mac OS X and I've installed the full LLVM with <code>brew install llvm</code> but error persists. Is this a genuine version problem where I have to unistall LLVM and reinstall its 3.7 version? Or is <code>ghc</code> having trouble finding <code>opt</code> and there is some kind of search path I can modify to fix the problem? Thanks for the help and have a great day.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1481423337, "post_id": 41082367, "comment_id": 69370720, "body": "Well, have you tried running it &quot;by hand&quot; on small inputs? What do you think <code>subsequences [1]</code> does, and why? Does <code>ghci</code> agree? What about <code>subsequences [2,1]</code>? (In general: show us you&#39;ve put some effort in, so we can talk to you about the specific part that&#39;s giving you trouble.)"}, {"owner": {"reputation": 75, "user_id": 6724755, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/7ade53fcaa81cddafd5d65f3e955e774?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/6724755/arushi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481426884, "post_id": 41082367, "comment_id": 69371263, "body": "I have made the changes."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1481429014, "post_id": 41082367, "comment_id": 69371597, "body": "Not answering your question, but there is a really cute way one-liner way of writing this: <code>subsequences = filterM $ const [False, True]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1481428149, "creation_date": 1481428149, "answer_id": 41082809, "question_id": 41082367, "link": "https://stackoverflow.com/questions/41082367/recursion-of-subsequences-is-not-clear/41082809#41082809", "title": "Recursion of subsequences is not clear", "body": "<p>In your explanation of how you think <code>subsequences [1,2,3]</code> should run, you write:</p>\n\n<blockquote>\n  <p>the second part of line 2 <code>map (e:) (subsequences es)</code> will be <code>map (1:) [2,3]</code></p>\n</blockquote>\n\n<p>This is close, but not quite right! You've dropped the call to <code>subsequences</code>, so it should actually be</p>\n\n<pre><code>map (1:) (subsequences [2,3])\n</code></pre>\n\n<p>This gives <code>subsequences</code> a chance to recurse and produce:</p>\n\n<pre><code>subsequences [2,3] = [[],[3],[2],[2,3]]\n</code></pre>\n\n<p>Substituting that into the <code>map</code> expression from before, we have</p>\n\n<pre><code>map (1:) [[], [3], [2], [2,3]]\n=\n[[1],[1,3],[1,2],[1,2,3]]\n</code></pre>\n\n<p>which are indeed the final elements of <code>subsequences [1,2,3]</code>.</p>\n"}], "owner": {"reputation": 75, "user_id": 6724755, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/7ade53fcaa81cddafd5d65f3e955e774?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/6724755/arushi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1481428149, "creation_date": 1481422900, "last_edit_date": 1481426841, "question_id": 41082367, "link": "https://stackoverflow.com/questions/41082367/recursion-of-subsequences-is-not-clear", "title": "Recursion of subsequences is not clear", "body": "<p>The following is the code for subsequences </p>\n\n<pre><code>subsequences  [] = [[]]                                                 ---Line1\nsubsequences (e:es) =  subsequences es ++ map (e:) (subsequences es)    ---Line2\n</code></pre>\n\n<p>I do not understand the recursion in this i.e. how do I get the following output by this code.</p>\n\n<pre><code>subsequences [1]\n[[],[1]]\n</code></pre>\n\n<p>According to this, first part of Line2 <code>subsequences es</code> is reaching <code>[]</code> then going to  Line 1 and returning <code>[[]]</code>, \nthe second part of Line2 <code>map (e:) (subsequences es)</code> which is <code>map (1:) [[]]</code>which gives <code>[[1]]</code>. Now, this clubs with <code>[[]] ++ [[1]]</code> and gives the output as <code>[[],[1]]</code>.</p>\n\n<pre><code>subsequences [1,2,3]\n[[],[3],[2],[2,3],[1],[1,3],[1,2],[1,2,3]]\n</code></pre>\n\n<p>According to this, first part of Line2 <code>subsequences es</code> is reaching <code>[2,3]</code>, \nthe second part of Line2 <code>map (e:) (subsequences es)</code> will be <code>map (1:) [2,3]</code>.\nHere is where I am getting confused that how is it reaching to the end of subsequences i.e. the empty list, Am I supposed to look at it in as two different parts? I am not able to figure out how is this called recursively.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1481399630, "post_id": 41079352, "comment_id": 69365522, "body": "I&#39;m not sure this is a good idea. Some library functions might assume (?) that <code>Enum</code> is not cyclical e.g. <code>[West .. South]</code> will probably not work."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1481400780, "post_id": 41079352, "comment_id": 69365873, "body": "@chi I wonder if there is a sensible way of implementing <code>enumFromTo</code> and related methods in this case."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 17837, "user_id": 1923190, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/D0JyZ.jpg?s=128&g=1", "display_name": "Simon H", "link": "https://stackoverflow.com/users/1923190/simon-h"}, "edited": false, "score": 2, "creation_date": 1481403205, "post_id": 41079352, "comment_id": 69366503, "body": "+1 to @SimonH.  I think it&#39;s monoid, not enumerate problem. So, <code>West &lt;&gt; x = x &lt;&gt; West = x</code>, <code>West &lt;&gt; North = North</code> and <code>North &lt;&gt; South = West</code>. It&#39;s similar to hours."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1481415379, "post_id": 41079352, "comment_id": 69369518, "body": "Define, yes. <i>Derive</i>, no."}], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "closed_date": 1481411808, "answer_count": 0, "score": 0, "last_activity_date": 1481397749, "creation_date": 1481397749, "question_id": 41079352, "link": "https://stackoverflow.com/questions/41079352/how-do-i-define-a-cyclical-enumeration", "closed_reason": "Duplicate", "title": "How do I define a cyclical enumeration?", "body": "<p>I am interested in creating a cyclical enumeration where the first and last elements of the type are adjacent. The cardinal directions on a compass are an example of such an enumeration.</p>\n\n<pre><code>data Compass = North | East | South | West deriving (Enum)\n</code></pre>\n\n<p>The enumeration functions <code>pred</code> and <code>succ</code> would make functions that updated data with a <code>Compass</code> property declarative and easy to reason. There is no need explicitly define the behavior for every instance of <code>Compass</code>.</p>\n\n<pre><code>data Rotation = CounterClockwise | Clockwise\ndata Position = Position Compass Integer Integer\n\nrotate :: Position -&gt; Rotation -&gt; Position\nrotate (Position c x y) Clockwise = Position (succ c) x y\nrotate (Position c x y) CounterClockwise = Position (pred c) x y\n</code></pre>\n\n<p>The problem is that <code>Enum</code> fails when <code>pred</code> or <code>succ</code> are called on the first and last <code>Compass</code> type repsectively. Is it possibile to define a cyclical enumeration that allows these functions to wrap to the beginning or end of the type list?</p>\n"}, {"tags": ["haskell", "cabal", "bytestring", "conduit"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481425414, "post_id": 41078686, "comment_id": 69371042, "body": "How are you compiling?"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1481425389, "post_id": 41079494, "comment_id": 69371038, "body": "Upgrading GHC seems like overkill. Why not give instructions for building using the user package database (which already has an appropriate version of bytestring available) instead?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481426924, "post_id": 41079494, "comment_id": 69371272, "body": "@DanielWagner Perhaps I&#39;m missing something, but wouldn&#39;t that require rebuilding all installed packages that depend on <i>bytestring</i> (which includes <i>binary</i> and <i>unix</i> in the global database, as well as a large chunk of the user database)?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481427228, "post_id": 41079494, "comment_id": 69371321, "body": "Yes, and managing that build work is what cabal was invented for."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481429142, "post_id": 41079494, "comment_id": 69371622, "body": "@DanielWagner When using <i>cabal-install</i>, I generally assumed that, in order to avoid diamond dependency headaches, it was best to not update the core, globally installed packages. Distancing myself from my assumptions, I can see how overriding the default choices of package databases, <a href=\"http://stackoverflow.com/q/30685248/2751851\">perhaps as in this Q&amp;A</a>, might be a feasible solution. Would you consider adding an alternative answer? (I guess you would be able to explain the relevant workflow better than me.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1481487380, "post_id": 41079494, "comment_id": 69386072, "body": "I plan to write such an answer, but writing it well requires a few more details in the question (which I have asked about in a comment)."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1481404109, "last_edit_date": 1592644375, "creation_date": 1481398687, "answer_id": 41079494, "question_id": 41078686, "link": "https://stackoverflow.com/questions/41078686/data-bytestring-char8-does-not-export-stripsuffix/41079494#41079494", "title": "Data.ByteString.Char8 does not export stripSuffix", "body": "<p>Firs of all, it is worth mentioning that <code>stripSuffix</code> was indeed introduced in version 0.18 of <em>bytestring</em>. Quoting <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/changelog\" rel=\"nofollow noreferrer\">the changelog</a>:</p>\n<blockquote>\n<p>0.10.8.0 Duncan Coutts duncan@community.haskell.org May 2016</p>\n<p>[etc.]</p>\n<ul>\n<li>Added <code>stripPrefix</code> and <code>stripSuffix</code> for lazy and strict bytestrings</li>\n</ul>\n</blockquote>\n<p>That sad, onward to your question:</p>\n<blockquote>\n<p>Is there a simple way to uninstall bytestring-0.10.6.0?</p>\n</blockquote>\n<p>No, there isn't, because, as the <em>ghc-pkg</em> output tells you, the 0.10.6.0 version is among the packages installed globally (i.e. system-wide rather than per-user). Uninstalling it would break all the other packages you had installed previously that depend on <em>bytestring</em>. When you installed <em>bytestring</em> from GitHub, it went to your per-user package database. To avoid further headache, the first thing I suggest is getting rid of the newer <em>bytestring</em> that you have installed, with:</p>\n<pre><code>ghc-pkg unregister bytestring-0.10.8.2\n</code></pre>\n<p>Then, to get the latest <em>bytestring</em>, you should update the Haskell installation in your system (for instance, the latest <a href=\"https://www.haskell.org/platform/mac.html\" rel=\"nofollow noreferrer\">minimal Haskell Platform</a> carries <em>bytestring-0.10.8.1</em>). Alternatively, you can use <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">Stack</a> to manage multiple GHC versions (as well as appropriate package databases for them) for your projects.</p>\n"}], "owner": {"reputation": 850, "user_id": 3560671, "user_type": "registered", "accept_rate": 97, "profile_image": "https://graph.facebook.com/1078263042/picture?type=large", "display_name": "Thomas Vanhelden", "link": "https://stackoverflow.com/users/3560671/thomas-vanhelden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 41079494, "answer_count": 1, "score": 0, "last_activity_date": 1481404109, "creation_date": 1481393560, "last_edit_date": 1481397266, "question_id": 41078686, "link": "https://stackoverflow.com/questions/41078686/data-bytestring-char8-does-not-export-stripsuffix", "title": "Data.ByteString.Char8 does not export stripSuffix", "body": "<p>I'm working on a stream of ByteStrings. I've imported ByteString via:</p>\n\n<pre><code>import qualified Data.ByteString as B\n</code></pre>\n\n<p>I can call every function from the ByteString library e.g.:</p>\n\n<pre><code>reverseBS :: Monad m =&gt; Conduit B.ByteString m B.ByteString\nreverseBS = CL.map B.reverse\n</code></pre>\n\n<p>This works as intended. </p>\n\n<p>I need a function to remove the trailing newline from a ByteString. I've opted to use <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString.html#v:stripSuffix\" rel=\"nofollow noreferrer\">stripSuffix</a> from <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString.html\" rel=\"nofollow noreferrer\">ByteString</a>. My code looks like this:</p>\n\n<pre><code>removeNewline :: Monad m =&gt; Conduit B.ByteString m B.ByteString\nremoveNewline = CL.map $ B.stripSuffix \"\\n\"\n</code></pre>\n\n<p>But my code won't compile and gives the following error: </p>\n\n<pre><code>Not in scope: \u2018B.stripSuffix\u2019\n</code></pre>\n\n<p>I've tried install the latest version of ByteString from <a href=\"https://github.com/haskell/bytestring\" rel=\"nofollow noreferrer\">GitHub</a> but this didn't help. </p>\n\n<p>EDIT:</p>\n\n<p>I noticed that there's something wrong with my ghc-pkg list. It give me the following output:</p>\n\n<pre><code>Thomass-MacBook-Pro:src ThomasVanhelden$ ghc-pkg list\n/Applications/ghc-7.10.3.app/Contents/lib/ghc-7.10.3/package.conf.d\n   Cabal-1.22.5.0\n   array-0.5.1.0\n   base-4.8.2.0\n   bin-package-db-0.0.0.0\n   binary-0.7.5.0\n   bytestring-0.10.6.0\n   containers-0.5.6.2\n   deepseq-1.4.1.1\n   directory-1.2.2.0\n   filepath-1.4.0.0\n   ghc-7.10.3\n   ghc-prim-0.4.0.0\n   haskeline-0.7.2.1\n   hoopl-3.10.0.2\n   hpc-0.6.0.2\n   integer-gmp-1.0.0.0\n   pretty-1.1.2.0\n   process-1.2.3.0\n   rts-1.0\n   template-haskell-2.10.0.0\n   terminfo-0.4.0.1\n   time-1.5.0.1\n   transformers-0.4.2.0\n   unix-2.7.1.0\n   xhtml-3000.2.1\n/Users/ThomasVanhelden/.ghc/x86_64-darwin-7.10.3/package.conf.d\n   WAVE-0.1.3\n   abstract-deque-0.3\n   abstract-par-0.3.3\n   async-2.1.1\n   attoparsec-0.13.1.0\n   base16-bytestring-0.1.1.6\n   base64-bytestring-1.0.0.1\n   blaze-builder-0.4.0.2\n   bytestring-0.10.8.2\n   bytestring-lexing-0.5.0.2\n   cereal-0.5.4.0\n   chunked-data-0.3.0\n   conduit-1.2.8\n   conduit-combinators-1.0.8.3\n   conduit-extra-1.1.15\n   exceptions-0.8.3\n   extensible-exceptions-0.1.1.4\n   fail-4.9.0.0\n   hashable-1.2.4.0\n   lifted-base-0.2.3.8\n   mmorph-1.0.9\n   monad-control-1.0.1.0\n   monad-par-0.3.4.8\n   monad-par-extras-0.3.3\n   mono-traversable-1.0.1\n   mtl-2.2.1\n   mwc-random-0.13.5.0\n   network-2.6.3.1\n   network-conduit-1.1.0\n   parallel-3.2.1.0\n   parallel-io-0.3.3\n   parseargs-0.2.0.8\n   primitive-0.6.1.0\n   random-1.1\n   resourcet-1.1.8.1\n   scientific-0.3.4.9\n   semigroups-0.18.2\n   split-0.2.3.1\n   stm-2.4.4.1\n   streaming-commons-0.1.16\n   tagged-0.8.5\n   text-1.2.2.1\n   transformers-base-0.4.4\n   transformers-compat-0.5.1.4\n   unix-compat-0.4.2.0\n   unordered-containers-0.2.7.1\n   vector-0.11.0.0\n   vector-algorithms-0.7.0.1\n   void-0.7.1\n   word8-0.1.2\n   zlib-0.6.1.2\n</code></pre>\n\n<p>It looks like it is looking in two different directories for packages and two different versions of ByteString might be the cause of the problem. How can I solve this? Is there a simple way to uninstall bytestring-0.10.6.0?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 5, "last_activity_date": 1481402499, "last_edit_date": 1481402499, "creation_date": 1481392805, "answer_id": 41078555, "question_id": 41078433, "link": "https://stackoverflow.com/questions/41078433/pattern-matching-tuples-in-haskell/41078555#41078555", "title": "Pattern Matching Tuples in Haskell", "body": "<p>Pattern matching is possible:</p>\n\n<ol>\n<li>for the arguments of a function equation</li>\n<li>in the <code>pat &lt;- expr</code> constructs in guards, do-expressions and list comprehensions</li>\n<li>in value bindings left from the equal sign in let/where</li>\n<li>for the arguments of a lambda expression</li>\n<li>in case alternatives</li>\n</ol>\n\n<p>You can't use a pattern in an expression except in the aforementioned places.</p>\n\n<p>What you want is to check if there is a tuple whose left element is 'A'. You can say</p>\n\n<pre><code>'A' `elem` (map fst [ ('A', 'B') ] )\n</code></pre>\n\n<p>Or you can use <code>elemBy</code> from <code>Data.List</code> thus:</p>\n\n<pre><code>elemBy (\\x y -&gt; x == fst y) 'A'  [ ('A', 'B') ]\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 7277412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42a075e47cba75ab1998e10f096b08a1?s=128&d=identicon&r=PG&f=1", "display_name": "JoeDoeBro", "link": "https://stackoverflow.com/users/7277412/joedoebro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 928, "favorite_count": 0, "accepted_answer_id": 41078555, "answer_count": 1, "score": 1, "last_activity_date": 1481402499, "creation_date": 1481391990, "last_edit_date": 1481399838, "question_id": 41078433, "link": "https://stackoverflow.com/questions/41078433/pattern-matching-tuples-in-haskell", "title": "Pattern Matching Tuples in Haskell", "body": "<p>I'm trying to get this function to return True, however currently it just spits out errors</p>\n\n<pre><code>('A',_) `elem` [('A','B')]\n\nFound hole: _ :: Char\n\u2022 In the expression: _\n  In the first argument of \u2018elem\u2019, namely \u2018('A', _)\u2019\n  In the expression: ('A', _) `elem` [('A', 'B')]\n\u2022 Relevant bindings include\n    it :: Bool (bound at &lt;interactive&gt;:31:1)\n</code></pre>\n\n<p>Any help appreciated</p>\n"}, {"tags": ["haskell", "functional-programming", "neural-network", "frp"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481392351, "post_id": 41078209, "comment_id": 69363183, "body": "I don&#39;t understand why do you write <code>newY = stepLayer y (currentResponse newX) (currentReponse newZ)</code> but your diagram says <code>newY = stepLayer y (hOldResponse x) (hOldResponse z)</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 2, "last_activity_date": 1481397986, "creation_date": 1481397986, "answer_id": 41079385, "question_id": 41078209, "link": "https://stackoverflow.com/questions/41078209/how-to-model-system-over-time-in-haskell/41079385#41079385", "title": "How to model system over time in Haskell", "body": "<p>The architecture of a recurrent neural network <code>f</code> that observes an input vector <code>x</code> and has a state <code>h</code> is </p>\n\n<pre><code>f :: h -&gt; x -&gt; h\n</code></pre>\n\n<p>As you've already observed, if it has some side effect or output you can model it as</p>\n\n<pre><code>f :: h -&gt; x -&gt; m h\n</code></pre>\n\n<p>and run it with <code>foldM f</code>. Another typical thing to do is train an output layer that produces output <code>o</code> from <code>h</code>, either a separate network <code>g :: h -&gt; o</code> or</p>\n\n<pre><code>f :: h -&gt; x -&gt; (h, o)\n</code></pre>\n\n<p>which is equivalent to <code>f :: x -&gt; State h o</code>; if that has a side effect it's <code>f :: x -&gt; StateT m h o</code>.</p>\n\n<p>Training the network amounts to learning the function <code>f</code> and in some cases learning the type <code>h</code>. A recurrent network uses the same function <code>f</code> at all time steps. It's the job of training to <em>learn</em> which features from the past need to be remembered in <code>h</code>. You don't need \"some gross data structures attempting to remember things from previous networks\", the network learns to use <code>h</code> to remember pertinent things from previous time steps.</p>\n\n<p>Any network or supervised training mechanism can be used to implement and learn <code>f</code>.</p>\n\n<p>If you use a convolution instead of a recurrent neural network then you will need to remember a window of time that the convolution acts on. The easy way to do this is to present the entire window as the input vector <code>x'</code>. in neither case do you explicitly store any history in the implementation of the network <code>f</code>. A convolved network doesn't necessarily see a state carried forward from earlier time steps, it may be a function <code>f :: x' -&gt; o</code>.</p>\n\n<hr>\n\n<p>I think you're trying to go deeper, since you are presenting both the images and the labels (which I presume are examples for supervised learning). If you want to train <code>f</code> from a known set of examples then you don't need to model <em>learning from a series of experiences</em>.</p>\n\n<p>If you want to model <em>learning from a series of experiences</em> you will have a state <code>t</code> of the machine training <code>f</code>, and a function <code>t -&gt; typeOf(f)</code>. The type of the machine training <code>f</code> will depend on how the machine is connected to the real world. If the real world doesn't repeat experiences reliably, the machine will want to remember previous experiences (especially ones <code>f</code> performed poorly on) so that it can present those experiences to <code>f</code> for additional training. The machinery wrapped around the learning thing <code>f</code> should give <code>f</code> nightmares. It may want to remember a few experiences <code>f</code> does well on to make sure it doesn't lose existing performance, in which case <code>f</code> gets to enjoy some pleasant dreams.</p>\n\n<p>In no case is it <code>f</code>'s job to remember previous experiences.</p>\n\n<hr>\n\n<p>You want to go deeper? If the training machine needs to learn how to train things like <code>f</code> it would be trained over families of problems like the problem <code>f</code> is learning. The parameters of the training machine would be shared between problems, and the machine would learn which things to remember. As some level the machine would probably supervise itself, and machines of this kind which learn poor parameters and get stuck would be weeded out by some larger selectionary system that destroys incompetent machines.</p>\n"}], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 41079385, "answer_count": 1, "score": 2, "last_activity_date": 1481397986, "creation_date": 1481390564, "question_id": 41078209, "link": "https://stackoverflow.com/questions/41078209/how-to-model-system-over-time-in-haskell", "title": "How to model system over time in Haskell", "body": "<p>I am attempting to implement a neural network of sorts in Haskell.  This network is temporally aware, so timesteps are an important part of its function.  Without needing too many details, my general implementation of running the network over time is:</p>\n\n<p><code>foldM stepNetwork initialNetwork (zip images labels)</code></p>\n\n<p>The idea is that each timestep generates a new network that has learned one more image/label pair.  However, this approach leads to some gross data structures attempting to remember things from previous networks. Here is my hidden layer structure:</p>\n\n<pre><code>data HiddenLayer = HiddenLayer { hResponse    :: Response\n                               , hOldResponse :: Response\n                               , hNeurons     :: [YNeuron]\n                               } deriving Show\n</code></pre>\n\n<p>and my current stepNetwork function is akin to:</p>\n\n<pre><code>stepNetwork (Network x y z) = Network newX newY newZ\n  where\n    newX = stepLayer x (hOldResponse y)\n    newZ = stepLayer z (hOldResponse y)\n    newY = stepLayer y (currentResponse newX) (currentReponse newZ)\n</code></pre>\n\n<p>I don't want to have to carry the old response along in the network.  Here is the relationship between the layers in the network, where X, Y, and Z are the three layers.</p>\n\n<p><a href=\"https://i.stack.imgur.com/XQVqn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/XQVqn.png\" alt=\"enter image description here\"></a></p>\n\n<p>Since it is time sensitive, it seems like FRP would be a good way to model this relationship, but I'm just not sure how to model this in an FRP paradigm.  Any advice?</p>\n"}, {"tags": ["haskell", "deployment", "cabal"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1481421117, "post_id": 41077415, "comment_id": 69370436, "body": "Like <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#accessing-data-files-from-package-code\" rel=\"nofollow noreferrer\">this</a>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481425715, "post_id": 41077415, "comment_id": 69371085, "body": "What exactly does &quot;run it under different configs&quot; mean?"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1481451537, "creation_date": 1481385564, "last_edit_date": 1481451537, "question_id": 41077415, "link": "https://stackoverflow.com/questions/41077415/run-cabal-executable-with-different-paths-containing-data-files", "title": "Run cabal executable with different paths containing data-files", "body": "<p>I have an executable built by cabal that uses <code>data-files:</code> feature. I need to run it under different configs (for example <code>cd /opt/my-app/config2 &amp;&amp; ./my-app</code> or <code>PREFIX=/opt/my-app/config2 ./my-app</code>). It currently looks into a fixed path.</p>\n\n<p>How can I accomplish that?</p>\n"}, {"tags": ["haskell", "gloss"], "comments": [{"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481383217, "post_id": 41076989, "comment_id": 69360413, "body": "1. you can use <code>pictures</code> function for [Picture] -&gt; Picture."}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481383380, "post_id": 41076989, "comment_id": 69360457, "body": "2. Just use helping function for <code>drawline</code> and make <code>drawline</code> using that helping function and <code>pictures</code>"}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481383423, "post_id": 41076989, "comment_id": 69360466, "body": "P.S. use different type for Column, Line, Dimension, not just use comment."}, {"owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "reply_to_user": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481385848, "post_id": 41076989, "comment_id": 69361160, "body": "I only used the comments to explain it here."}, {"owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "reply_to_user": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481385880, "post_id": 41076989, "comment_id": 69361168, "body": "I have Column,Line and Dimension set as INT and I can&#39;t use int here xD"}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481386083, "post_id": 41076989, "comment_id": 69361222, "body": "Then use other name, but a type, not a comment."}, {"owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "reply_to_user": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481386405, "post_id": 41076989, "comment_id": 69361318, "body": "One more thing, what shoud i use in the place of:       drawline _ _ 0 = Nothing or []"}, {"owner": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481387517, "post_id": 41076989, "comment_id": 69361685, "body": "It&#39;s my second point. Use helping function that generate [Picture] and return <code>[]</code>"}, {"owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "reply_to_user": {"reputation": 313, "user_id": 5953321, "user_type": "registered", "profile_image": "https://graph.facebook.com/886468944803810/picture?type=large", "display_name": "Junyoung Clare Jang", "link": "https://stackoverflow.com/users/5953321/junyoung-clare-jang"}, "edited": false, "score": 0, "creation_date": 1481387739, "post_id": 41076989, "comment_id": 69361769, "body": "Yes, I already solved, now i just need to place my functions to put what i want insteed of a bunch of circles in the screen. Thank you"}], "owner": {"reputation": 33, "user_id": 7049147, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d1b2c8bc723cd06e915c0cd670f8bf69?s=128&d=identicon&r=PG&f=1", "display_name": "Dost", "link": "https://stackoverflow.com/users/7049147/dost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1481382839, "creation_date": 1481382839, "question_id": 41076989, "link": "https://stackoverflow.com/questions/41076989/creating-a-picture-of-a-map-with-a-recurssive-function", "title": "Creating a picture of a map with a recurssive function", "body": "<p>i'm using haskell gloss for the first time and I'm having some trouble, in this code:</p>\n\n<pre><code>-- the initial c and l will be imagine for dimension 9: (-160) 160 \n-- (so the square ends in the center of the window\n\n--         column;  line;   dimension   \ndrawmap :: Float -&gt; Float -&gt; Float -&gt; Picture\ndrawmap c l d = (drawline x c l d) : (drawmap xs c (l+40) d)\n\ndrawline :: Float -&gt; Float -&gt; Float -&gt; Picture\ndrawline c l d = if (d&gt;0) then (Translate c l $ Color red (circle 20)) : (drawline (c+40) l (d-1))\n                          else (Translate c l $ Color red (circle 20))\n</code></pre>\n\n<p>The only question I have right now is with the type, because I need it to be the type Picture, and not [Picture], any help?</p>\n\n<p>And also, how do i make this stop point:</p>\n\n<pre><code>drawline _ _ 0 = Nothing or [] \n</code></pre>\n\n<p>I know this is not acceptable, but how do I tell it when to stop doing circles?</p>\n\n<p>This is not pratical at all, is just an example very simple, if someone helps me understand this I can after apply what I really need to do.</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "is_accepted": false, "score": 1, "last_activity_date": 1481379215, "creation_date": 1481379215, "answer_id": 41076507, "question_id": 41075705, "link": "https://stackoverflow.com/questions/41075705/exception-from-warp-stack-overflow-when-logging-in/41076507#41076507", "title": "Exception from Warp: stack overflow when logging in", "body": "<p>Yep, my problem was indeed removing getAuthId !\nSolved it by adding this instead :</p>\n\n<pre><code>    authenticate creds = runDB $ do\n      x &lt;- getBy $ UniqueUser $ credsIdent creds\n      case x of\n        Just (Entity uid _) -&gt; return $ Authenticated uid\n        Nothing -&gt; return $ UserError InvalidUsernamePass\n</code></pre>\n"}], "owner": {"reputation": 825, "user_id": 962828, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/78c370f00a14fb3bd59dc334082378cd?s=128&d=identicon&r=PG", "display_name": "Ulrar", "link": "https://stackoverflow.com/users/962828/ulrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1481379215, "creation_date": 1481374156, "question_id": 41075705, "link": "https://stackoverflow.com/questions/41075705/exception-from-warp-stack-overflow-when-logging-in", "title": "Exception from Warp: stack overflow when logging in", "body": "<p>I'm making a little app for work to handle shared to-do lists, I'm almost done but I'd like to add some very simple authentication. I followed the doc to add hashdb to the scaffolded site (<a href=\"https://github.com/yesodweb/yesod-cookbook/blob/master/cookbook/Using-HashDB-In-a-Scaffolded-Site.md\" rel=\"nofollow noreferrer\">https://github.com/yesodweb/yesod-cookbook/blob/master/cookbook/Using-HashDB-In-a-Scaffolded-Site.md</a>), and it compiles fine, but when I log in with correct username / password (added by hand in the database) I get this :</p>\n\n<pre><code>10/Dec/2016:13:36:02 +0100 [Debug#SQL] SELECT `name`,`password` FROM `user` WHERE `name`=?; [PersistText \"Ulrar\"]\n10/Dec/2016:13:36:08 +0100 [Error#yesod] Exception from Warp: stack overflow @(cstod_GjWCdZJB9K0EGPCbjz5gnP:Application Application.hs:133:15)\n</code></pre>\n\n<p>Line 133 of Application.hs is this one : $(qLocation >>= liftLoc)\nThat's from the default code.</p>\n\n<p>As you can see my \"User\" table is pretty simple, I have a primary key on the name and a password, and that's it. The name must be unique, of course.\nI'll be adding the few user by hand in the database, that'll be more than enough for us.</p>\n\n<p>I tried the query by hand, it returns what you'd expect, and trying to log in with the wrong username / password does \"work\", it redirects to the login form with an error. Only using the correct username / password couple will give that Exception, and it does seem to load for a while before throwing it after clicking on the button.</p>\n\n<p>I end up on <a href=\"http://localhost:3000/auth/page/hashdb/login\" rel=\"nofollow noreferrer\">http://localhost:3000/auth/page/hashdb/login</a> with just \"Something went wrong\" written.</p>\n\n<p>I assume I must have missed something, I'm using the yesod-mysql scaffolded site and I have this in the YesodAuth instance :</p>\n\n<pre><code>authPlugins app = [authHashDB (Just . UniqueUser)]\n</code></pre>\n\n<p>I removed the getAuthId definition since I had no idea what to put there, the definition from the doc doesn't compile because getAuthIdHashDB isn't exported anymore apparently. Is this my problem ?</p>\n\n<p>Thanks !</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 2, "creation_date": 1481373860, "post_id": 41075645, "comment_id": 69357632, "body": "You&#39;re trying to add a number and a list. Can you think of a way to <i>sum</i> the numbers in a list?"}, {"owner": {"reputation": 5, "user_id": 7276454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7b72216067ed65e41e095bbec72e577?s=128&d=identicon&r=PG&f=1", "display_name": "gon91", "link": "https://stackoverflow.com/users/7276454/gon91"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1481374358, "post_id": 41075645, "comment_id": 69357778, "body": "but this kind of list return an int no?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 1, "creation_date": 1481374966, "post_id": 41075645, "comment_id": 69357971, "body": "There are no lists that &quot;return&quot; an int. A list is a list."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1481375390, "post_id": 41075645, "comment_id": 69358113, "body": "I Think you should first define what you mean by size. Is it the depth of the tree, the number of elements or even something else ?"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 1, "creation_date": 1481375570, "post_id": 41075645, "comment_id": 69358163, "body": "On your question, you should not post commented code. And you should give us your error message."}, {"owner": {"reputation": 5, "user_id": 7276454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7b72216067ed65e41e095bbec72e577?s=128&d=identicon&r=PG&f=1", "display_name": "gon91", "link": "https://stackoverflow.com/users/7276454/gon91"}, "edited": false, "score": 0, "creation_date": 1481375644, "post_id": 41075645, "comment_id": 69358190, "body": "Number of elements"}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1481377024, "post_id": 41075645, "comment_id": 69358609, "body": "As a side note, your definition of tree is a bit odd to me, I think it&#39;s a bit error prone, because you can have two terminal cases, for example <code>Empty</code> and <code>Node 1 []</code>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "reply_to_user": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1481408990, "post_id": 41075645, "comment_id": 69368093, "body": "That&#39;s pretty normal, @Jean-BaptistePotonnier. You want a way to have zero-element trees as well as one-element trees, and the Node constructor in <code>Node 1 []</code> has the element <code>1</code> in it."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1481375783, "creation_date": 1481375783, "answer_id": 41075969, "question_id": 41075645, "link": "https://stackoverflow.com/questions/41075645/tree-size-in-haskell/41075969#41075969", "title": "Tree size in haskell", "body": "<p>Hint:</p>\n\n<pre><code>&gt; 1 + [2,3,4]\n&lt;interactive&gt;:8:1: error:\n    \u2022 Non type-variable argument in the constraint: Num [t]\n      (Use FlexibleContexts to permit this)\n    \u2022 When checking the inferred type\n        it :: forall t. (Num [t], Num t) =&gt; [t]\n\n&gt; 1 + sum [2,3,4]\n10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "is_accepted": false, "score": 1, "last_activity_date": 1481377260, "last_edit_date": 1481377260, "creation_date": 1481376094, "answer_id": 41076025, "question_id": 41075645, "link": "https://stackoverflow.com/questions/41075645/tree-size-in-haskell/41076025#41076025", "title": "Tree size in haskell", "body": "<p>You obviously have a typing error in your code.</p>\n\n<pre><code>Couldn't match expected type \u2018Int\u2019 with actual type \u2018[Int]\u2019\n\u2022 In the expression: 1 + [size t | t &lt;- ts]\n  In an equation for \u2018size\u2019:\n      size (Node a ts) = 1 + [size t | t &lt;- ts]\n</code></pre>\n\n<p>Since you want an <code>Int</code>, you have to find a way to convert your list of <code>Int</code> to an <code>Int</code>.</p>\n\n<p>In other words, you can introduce a hole like this : </p>\n\n<pre><code>size :: Tree a -&gt; Int\nsize Empty         = 0\nsize (Node a ts) = 1 + _g [size t | t&lt;-ts]  \n</code></pre>\n\n<p>leading to the error message :</p>\n\n<pre><code>\u2022 Found hole: _g :: [Int] -&gt; Int\n  Or perhaps \u2018_g\u2019 is mis-spelled, or not in scope\n\u2022 In the expression: _g\n  In the second argument of \u2018(+)\u2019, namely \u2018_g [size t | t &lt;- ts]\u2019\n  In the expression: 1 + _g [size t | t &lt;- ts]\n\u2022 Relevant bindings include\n    ts :: [Tree a]\n      (bound at /Users/jeeb/incubator/scratch/app/Main.hs:10:14)\n    a :: a (bound at /Users/jeeb/incubator/scratch/app/Main.hs:10:12)\n    size :: Tree a -&gt; Int\n      (bound at /Users/jeeb/incubator/scratch/app/Main.hs:9:1)\n</code></pre>\n\n<p>Depending of what you mean by \"size\", you should be able to  replace <code>g</code> by the correct function.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1515067456, "post_id": 48081516, "comment_id": 83164306, "body": "it&#39;s the depth, with maximum."}], "tags": [], "owner": {"reputation": 26, "user_id": 7901278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d60c115b1fb045b86b9d991a3619d69?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Ramon Casero", "link": "https://stackoverflow.com/users/7901278/jose-ramon-casero"}, "is_accepted": true, "score": 1, "last_activity_date": 1514997550, "creation_date": 1514997550, "answer_id": 48081516, "question_id": 41075645, "link": "https://stackoverflow.com/questions/41075645/tree-size-in-haskell/48081516#48081516", "title": "Tree size in haskell", "body": "<pre><code>size:: Tree a -&gt; Int\nsize Empty = 0\nsize (Node a ts) = 1 + maximum[size t | t &lt;- ts]\n</code></pre>\n\n<p>probably you want the max size of the subtrees so I would use the function predefined maximum to get it after convert every branch into his size.</p>\n"}], "owner": {"reputation": 5, "user_id": 7276454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7b72216067ed65e41e095bbec72e577?s=128&d=identicon&r=PG&f=1", "display_name": "gon91", "link": "https://stackoverflow.com/users/7276454/gon91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 48081516, "answer_count": 3, "score": 0, "last_activity_date": 1514997550, "creation_date": 1481373797, "last_edit_date": 1481377378, "question_id": 41075645, "link": "https://stackoverflow.com/questions/41075645/tree-size-in-haskell", "title": "Tree size in haskell", "body": "<p>I have an implementation of a tree like this: </p>\n\n<p>data Tree a = Empty | Node a [Tree a] deriving Show</p>\n\n<p>and I need to get the size. </p>\n\n<p>I think this code can resolve this problem but I have an error: </p>\n\n<pre><code>size :: Tree a -&gt; Int\nsize Empty       = 0\nsize (Node a ts) = 1 + [size t | t&lt;-ts]\n</code></pre>\n"}, {"tags": ["haskell", "idioms"], "comments": [{"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1481373148, "post_id": 41075072, "comment_id": 69357419, "body": "<code>prev</code> looks like <code>prev (N x) = x; prev x = P x</code> but then shouldn&#39;t it be <code>add (P x) y = prev $ add x y</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7215398"}, "reply_to_user": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1481373749, "post_id": 41075072, "comment_id": 69357612, "body": "Actually it&#39;s much more complicated than that; I have <code>data AbInt = Zero | P Nat | N Nat</code> where <code>data Nat = One | S Nat</code>, simulated positive and negative with <code>P</code> and <code>S</code> wrappers respectively, so <code>prev (N x) = N $ S x</code> and so on."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1481384751, "post_id": 41075072, "comment_id": 69360834, "body": "You might want to consider including zero as a natural number using <code>data Nat = Zero | S Nat</code>. This allows a slightly more opaque, but much easier to work with, definition of <code>data Int&#39; = Z Nat Nat</code>, since you no longer need to distinguish between positive, negative, and zero integers explicitly. For instance, <code>next (Z a b) = Z (S a) b</code> and <code>prev (Z a b) = Z a (S b)</code>. Even better, <code>intAdd (Z a b) (Z x y) = Z (natAdd a x) (natAdd b y)</code> for suitably defined <code>natAdd :: Nat -&gt; Nat -&gt; Nat</code>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7215398"}, "edited": false, "score": 0, "creation_date": 1481374124, "post_id": 41075551, "comment_id": 69357710, "body": "That second option is very interesting, and something I totally hadn&#39;t considered. (Well, I hadn&#39;t considered the first, either, but I didn&#39;t know about it.) In your mind, is the conceptual clarity there worth the extra two lines?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1481374858, "post_id": 41075551, "comment_id": 69357942, "body": "@Canyon I don&#39;t think it particularly matters. The second implementation does emphasise that adding negative numbers is &quot;the opposite&quot; of adding positive numbers, especially if you can come up with better names than <code>f</code> and <code>g</code>. But the duplication in the first implementation isn&#39;t <i>too</i> egregious, because it&#39;s only two lines and they&#39;re right next to each other"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1481373120, "last_edit_date": 1495542744, "creation_date": 1481373120, "answer_id": 41075551, "question_id": 41075072, "link": "https://stackoverflow.com/questions/41075072/haskell-pattern-matching-idiom/41075551#41075551", "title": "Haskell pattern-matching idiom", "body": "<p>Use <a href=\"https://stackoverflow.com/questions/1153465/what-does-the-symbol-mean-in-reference-to-lists-in-haskell\">as-patterns</a>.</p>\n\n<pre><code>add Zero y = y\nadd x@(P _) y = next $ add (prev x) y\nadd x@(N _) y = prev $ add (next x) y\n</code></pre>\n\n<p>I'd also consider abstracting out the common structure of your two recursive branches by noting that you just swap the roles of the <code>prev</code> and <code>next</code> functions depending on whether <code>x</code> is positive or negative:</p>\n\n<pre><code>add Zero x = x\nadd x y = f $ add (g x) y\n    where (f, g) = case x of\n                       P _ -&gt; (next, prev)\n                       N _ -&gt; (prev, next)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481468519, "post_id": 41076233, "comment_id": 69380009, "body": "at least you can use <code>-Wincomplete-patterns -Werror</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481468801, "post_id": 41076233, "comment_id": 69380091, "body": "@luqui Yes, that&#39;s true. I usually compile with <code>-Wall</code>, though, and I find <code>-Wall -Werror</code> to be overkill."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1481377438, "creation_date": 1481377438, "answer_id": 41076233, "question_id": 41075072, "link": "https://stackoverflow.com/questions/41075072/haskell-pattern-matching-idiom/41076233#41076233", "title": "Haskell pattern-matching idiom", "body": "<p>About this style:</p>\n\n<pre><code>add Zero x  = x\nadd x y = case x of\n    P _ -&gt; next $ add (prev x) y\n    _   -&gt; prev $ add (next x) y\n</code></pre>\n\n<p>On the positive side, it avoids some repetition, which is good.</p>\n\n<p>On the negative side, the <code>case</code> looks to be non-exhaustive at a first sight. Indeed, to convince oneself that the pattern match is really exhaustive, we have to reason about the possible values for the <code>x</code> in <code>case x of</code>, and see that at runtime that can not be <code>Zero</code>, because that was handled above. This requires far more mental effort than the first snippet, which is <em>obviously</em> exhaustive.</p>\n\n<p>Worse, when turning on warnings, as we should always do, GHC complains since it is not convinced that the <code>case</code> is exhaustive.</p>\n\n<p>Personally, I wish the designers of Haskell had forbidden non exhaustive matches entirely. I'd use a <code>-Werror-on-non-exhaustive-matches</code> if there were one. I would like to be forced to write e.g.</p>\n\n<pre><code>case something of\n   A -&gt; ...\n   B -&gt; ...\n   _ -&gt; error \"the impossible happened\"\n</code></pre>\n\n<p>than having the last branch being silently inserted by the compiler for me.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1481427130, "last_edit_date": 1481427130, "creation_date": 1481426322, "answer_id": 41082638, "question_id": 41075072, "link": "https://stackoverflow.com/questions/41075072/haskell-pattern-matching-idiom/41082638#41082638", "title": "Haskell pattern-matching idiom", "body": "<p>Consider using the <a href=\"https://en.wikipedia.org/wiki/Integer#Construction\" rel=\"nofollow noreferrer\">math-style definition of integers</a> as congruence classes of pairs of naturals under the equivalence relation:</p>\n\n<pre><code>{((a,b), (c,d)) | b+c == d+a}\n</code></pre>\n\n<p>The intuition is that the pair of naturals <code>(a,b)</code> represents <code>b-a</code>. As mentioned in the Wikipedia article, this often reduces the number of special cases compared to the \"0/positive/negative\" definition. In particular, the addition operation you ask about implementing becomes a one-liner:</p>\n\n<pre><code>-- both Int and Integer are taken\ndata Int' = Int Nat Nat\n\ninstance Num Int' where\n    -- b-a + d-c = (b+d)-(a+c)\n    Int a b + Int c d = Int (a + c) (b + d)\n</code></pre>\n\n<p>It's kind of fun to work through the different operations with this representation. For example, <code>Eq</code> can be implemented with the equation given above, and <code>Ord</code> is similar:</p>\n\n<pre><code>instance Eq Int' where\n    -- b-a == d-c = b+c == d+a\n    Int a b == Int c d = b+c == d+a\n\ninstance Ord Int' where\n    -- compare (b-a) (d-c) = compare (b+c) (d+a)\n    compare (Int a b) (Int c d) = compare (b+c) (d+a)\n</code></pre>\n\n<p>On occasion, it can be handy to normalize these things. Just like fractions can be reduced by multiplying the numerator and denominator by the same number until they're relatively prime, these things can be reduced by adding or subtracting the same number to both parts until (at least) one of them is zero.</p>\n\n<pre><code>normalize (Int (S a) (S b)) = normalize (Int a b)\nnormalize v = v\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7215398"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 41075551, "answer_count": 3, "score": 1, "last_activity_date": 1481427130, "creation_date": 1481369729, "question_id": 41075072, "link": "https://stackoverflow.com/questions/41075072/haskell-pattern-matching-idiom", "title": "Haskell pattern-matching idiom", "body": "<p>I'm making a calculator on abstract integers and I'm doing an awful lot of pattern matching. I can write</p>\n\n<pre><code>add Zero x  = x\nadd (P x) y = next $ add (prev $ P x) y\nadd (N x) y = prev $ add (next $ N x) y\n</code></pre>\n\n<p>or</p>\n\n<pre><code>add Zero x  = x\nadd x y = case x of\n    P _ -&gt; next $ add (prev x) y\n    _   -&gt; prev $ add (next x) y\n</code></pre>\n\n<p>While the first way is shorter, something in the second way appeals to me more.</p>\n\n<p>Which is the preferred way to do this?</p>\n"}, {"tags": ["algorithm", "haskell", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 604, "user_id": 1264345, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a815668d20d49da314fed5cfe32c04e6?s=128&d=identicon&r=PG", "display_name": "wardva", "link": "https://stackoverflow.com/users/1264345/wardva"}, "is_accepted": true, "score": 3, "last_activity_date": 1481369518, "last_edit_date": 1481369518, "creation_date": 1481369047, "answer_id": 41074977, "question_id": 41074928, "link": "https://stackoverflow.com/questions/41074928/haskell-as-patterns-in-algorithm/41074977#41074977", "title": "Haskell &quot;as patterns&quot; in algorithm", "body": "<p>No they are not the same. The @ symbol is used to give a name to a parameter and to match against a pattern after the @ symbol. </p>\n\n<p>In your example <code>ys</code> is a synonym for <code>(y:_)</code>. Writing it as <code>(x:(ys@(y:_)))</code> makes it more clear. <code>x</code> is the first element of the list, <code>y</code> is the second element of the list, <code>ys</code> is the list without the first element <code>x</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 7276253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ee55ed5310ecea3d0adc211cc467?s=128&d=identicon&r=PG&f=1", "display_name": "Steven D.", "link": "https://stackoverflow.com/users/7276253/steven-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 41074977, "answer_count": 1, "score": 2, "last_activity_date": 1481369518, "creation_date": 1481368717, "question_id": 41074928, "link": "https://stackoverflow.com/questions/41074928/haskell-as-patterns-in-algorithm", "title": "Haskell &quot;as patterns&quot; in algorithm", "body": "<p><code>compress</code> is a function that removes consecutive duplicates of list elements.</p>\n\n<pre><code>compress (x:ys@(y:_))\n    | x == y    = compress ys\n    | otherwise = x : compress ys\ncompress ys = ys\n</code></pre>\n\n<p>Now, isn't <code>x:ys</code> is the same pattern as <code>y:_</code> in <code>(x:ys@(y:_))</code>? If it is, then how this function correctly executes?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481391809, "post_id": 41076041, "comment_id": 69363012, "body": "Indeed, <code>State (Integer, Bool)</code> is likely better anyway. <code>Writer</code> doesn&#39;t really work well with things like <code>Sum Integer</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481402253, "post_id": 41076041, "comment_id": 69366256, "body": "@dfeuer Could you quantify that? Are you talking about laziness?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481410236, "post_id": 41076041, "comment_id": 69368417, "body": "Yes. Even <code>Control.Monad.Writer.Strict</code> is lazy in the &quot;log&quot;. You could implement your own instance of <code>MonadWriter</code> and use that, but the conversion to a tail-recursive form will end up making it look like <code>State</code>. <code>newtype WriterT&#39; w m a = WriterT&#39; (StateT w m a) deriving (Functor, Applicative, Monad); instance (Monoid w, Monad m) =&gt; MonadWriter w (WriterT&#39; w m) where tell a = WriterT $ modify&#39; (&lt;&gt; a)</code>. I&#39;m not sure if all the other effects are supported, but probably. In the end, you basically land back in <code>State</code> land, with some stuff under the hood that could be fussy to verify."}, {"owner": {"reputation": 734, "user_id": 6279389, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lYeAD.jpg?s=128&g=1", "display_name": "Sophia Gold", "link": "https://stackoverflow.com/users/6279389/sophia-gold"}, "edited": false, "score": 0, "creation_date": 1481440952, "post_id": 41076041, "comment_id": 69373466, "body": "Thanks! I decided to just use <code>State</code> for everything as I think that makes the most sense. But I&#39;m still not sure I&#39;m composing them correctly because I get a typing error trying to just test it with a string in GHCi: <code>evalState clwcm &quot;this is a test, this is only a test&quot;</code> yields <code>Couldn&#39;t match type \u2018String -&gt; State (Integer, Bool) String\u2019 with \u2018StateT [Char] Data.Functor.Identity.Identity a\u2019</code> <code>Expected type: State [Char] a</code> <code>Actual type: String -&gt; State (Integer, Bool) String</code>"}, {"owner": {"reputation": 734, "user_id": 6279389, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lYeAD.jpg?s=128&g=1", "display_name": "Sophia Gold", "link": "https://stackoverflow.com/users/6279389/sophia-gold"}, "edited": false, "score": 0, "creation_date": 1481691390, "post_id": 41076041, "comment_id": 69473796, "body": "Turns out I confused the code in the paper. It doesn&#39;t compose the monads using kleisli arrows, but through product functors like this: <code>data Product&#39; m n a = Product { pfst :: m a, psnd :: n a } deriving (Show)</code> <code>prod :: (Functor m, Functor n) =&gt; (a -&gt; m b) -&gt; (a -&gt; n b) -&gt; (a -&gt; Product&#39; m n b)</code> <code>prod f g x = Product&#39; (f x) (g x)</code>. I&#39;m not sure I understand what they&#39;re getting at with that, but I didn&#39;t need them to simulate the results of the C version, which essentially just returns a triple."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 3, "last_activity_date": 1481376535, "last_edit_date": 1481376535, "creation_date": 1481376218, "answer_id": 41076041, "question_id": 41074739, "link": "https://stackoverflow.com/questions/41074739/ghc-8-0-1-errors-from-writer-and-state-monads/41076041#41076041", "title": "GHC 8.0.1 errors from Writer and State monads", "body": "<p>For the <code>Writer</code> monad to work, the object you're writing has to be an instance of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html\" rel=\"nofollow noreferrer\"><code>Monoid</code></a>. <code>tell</code> uses <code>mappend</code> to add its argument to the running log.</p>\n\n<p>For integers, however, there are at least two good choices for a <code>Monoid</code> instance. One of them is addition, with 0 as the unit element:</p>\n\n<pre><code>instance Monoid Int where\n    mempty = 0\n    mappend = (+)\n</code></pre>\n\n<p>and the other is multiplication with 1:</p>\n\n<pre><code>instance Monoid Int where\n    mempty = 1\n    mappend = (*)\n</code></pre>\n\n<p>How should the Haskell designers choose between these two options? They're both equally valid, and both useful in different situations. In the end they decided not to express an opinion, leaving <code>Int</code> without a <code>Monoid</code> instance of its own and instead providing two <code>newtype</code>s to allow you to choose which instance you want.</p>\n\n<pre><code>newtype Sum n = Sum { getSum :: n }\ninstance Num n =&gt; Monoid (Sum n) where\n    mempty = Sum 0\n    Sum x `mappend` Sum y = Sum (x + y)\n\nnewtype Product n = Product { getProduct :: n }\ninstance Num n =&gt; Monoid (Product n) where\n    mempty = Product 1\n    Product x `mappend` Product y = Product (x * y)\n</code></pre>\n\n<p>These two <code>newtype</code>s are found <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#g:3\" rel=\"nofollow noreferrer\">in the <code>Data.Monoid</code> module</a>. I'm guessing in your case you want to add up the numbers in the <code>Writer</code> monad, so all you should need to do is change all your type signatures from <code>Writer Integer</code> to <code>Writer (Sum Integer)</code>.</p>\n\n<hr>\n\n<p>The other type error is GHC telling you that you can't compose a <code>Writer</code> action with a <code>State</code> action. You have <code>wcm :: State (Integer, Bool) String</code> and <code>ccm :: Writer Integer String</code>. Skim-reading your code, it looks like you're only using the <code>Integer</code> component of your state to add things up (I'm guessing it's meant to take part in the running total along with the <code>Writer</code> bits?), so I would consider using the <em>monad transformer</em> version of <code>State</code>:</p>\n\n<pre><code>wcm :: StateT Bool (Writer Integer) String\n</code></pre>\n\n<p>and then using <code>lift</code> to bring the plain old <code>Writer Integer</code> monads into the <code>StateT</code>-enriched context.</p>\n\n<p>If you're not used to monad transformers yet, the other option is to write everything in the <code>State (Integer, Bool)</code> monad.</p>\n"}], "owner": {"reputation": 734, "user_id": 6279389, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lYeAD.jpg?s=128&g=1", "display_name": "Sophia Gold", "link": "https://stackoverflow.com/users/6279389/sophia-gold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 41076041, "answer_count": 1, "score": 2, "last_activity_date": 1481376535, "creation_date": 1481367505, "question_id": 41074739, "link": "https://stackoverflow.com/questions/41074739/ghc-8-0-1-errors-from-writer-and-state-monads", "title": "GHC 8.0.1 errors from Writer and State monads", "body": "<p>I'm relatively new to Haskell and trying to port the UNIX wc program demonstrated in Kernighan and Ritchie using monadic composition, as shown in <a href=\"https://www.cs.ox.ac.uk/jeremy.gibbons/publications/iterator.pdf\" rel=\"nofollow noreferrer\"><em>The Essence of the Iterator Pattern</em></a> by Jeremy Gibbons and Bruno C. d. S. Oliveira, and having some trouble getting it to compile. Here's my code:</p>\n\n<pre><code>import Control.Monad.Writer\nimport Control.Monad.State\nimport Data.Char\n\ntest :: Bool -&gt; Integer\ntest b = if b then 1 else 0\n\nccmBody :: Char -&gt; Writer Integer Char\nccmBody c = do\n  tell 1\n  return c\n\nccm :: String -&gt; Writer Integer String\nccm = mapM ccmBody\n\nlcmBody :: Char -&gt; Writer Integer Char\nlcmBody c = do\n  tell(test(c == '\\n'))\n  return c\n\nlcm' :: String -&gt; Writer Integer String\nlcm' = mapM lcmBody\n\nwcmBody :: Char -&gt; State (Integer, Bool) Char\nwcmBody c = let s = not (isSpace c) in do\n              (n,w) &lt;- get\n              put (n + test(not (w || s)), s)\n              return c\n\nwcm :: String -&gt; State (Integer, Bool) String\nwcm = mapM wcmBody\n\nclwcm = ccm &gt;=&gt; lcm' &gt;=&gt; wcm\n</code></pre>\n\n<p>And the compiler errors:</p>\n\n<pre><code>wordcount.hs:10:3: error: \u2026\n    \u2022 No instance for (Monoid Integer) arising from a do statement\n    \u2022 In a stmt of a 'do' block: tell 1\n       In the expression:\n        do { tell 1;\n             return c }\n      In an equation for \u2018ccmBody\u2019:\n          ccmBody c\n            = do { tell 1;\n                   return c }\nwordcount.hs:33:26: error: \u2026\n    \u2022 Couldn't match type \u2018StateT\n                             (Integer, Bool) Data.Functor.Identity.Identity\u2019\n                     with \u2018WriterT Integer Data.Functor.Identity.Identity\u2019\n      Expected type: String\n                     -&gt; WriterT Integer Data.Functor.Identity.Identity String\n        Actual type: String -&gt; State (Integer, Bool) String\n    \u2022 In the second argument of \u2018(&gt;=&gt;)\u2019, namely \u2018wcm\u2019\n      In the second argument of \u2018(&gt;=&gt;)\u2019, namely \u2018lcm' &gt;=&gt; wcm\u2019\n      In the expression: ccm &gt;=&gt; lcm' &gt;=&gt; wcm\nCompilation failed.\n</code></pre>\n\n<p>I can't understand what I'm doing wrong here in either case. Any help would be greatly appreciated. Thanks!</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1481379214, "creation_date": 1481379214, "answer_id": 41076506, "question_id": 41074156, "link": "https://stackoverflow.com/questions/41074156/how-to-use-monad-in-this-case/41076506#41076506", "title": "How to use monad in this case?", "body": "<p><code>doQueryForever</code> should take a connection as an argument. When a query fails, call it recursively with a new connection; when a query succeeds, call it recursively with the existing connection. The initial call, of course, also needs to take the first connection.</p>\n\n<pre><code>handleResult result = ...\nrunQueries = connectToDatabase &gt;&gt;= doQueryForever\n\ndoQueryForever conn = do\n    result &lt;- queryDatabase conn\n    case result of\n        Left _ -&gt; runQueries\n        Right s -&gt; handleResult s &gt;&gt; doQueryForever conn\n\nrunQueries\n</code></pre>\n"}], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 41076506, "answer_count": 1, "score": 2, "last_activity_date": 1481379214, "creation_date": 1481363054, "question_id": 41074156, "link": "https://stackoverflow.com/questions/41074156/how-to-use-monad-in-this-case", "title": "How to use monad in this case?", "body": "<p>Say, I want to connect to a database and do some query. I decide to use monad to implement like this:</p>\n\n<pre><code>queryDatabase :: IO String\n...\n\ndoSomeQuery :: IO ()\ndoSomeQuery = do\n    conn   &lt;- connectToDatabase\n    result &lt;- queryDatabase conn\n    return ()\n\ndoQueryForever :: IO ()\ndoQueryForever = forever doSomeQuery\n</code></pre>\n\n<p>But, I do not want have a new connection to database every time, I want to reuse the old connection and reconnect when the old connection broken. So, I redesign my program like this:</p>\n\n<pre><code>queryDatabase :: IO (Either Connection String)\n-- when the connection is broken, return (Left oldConnection)\n\ndoSomeQuery :: IO ()\ndoSomeQuery = do\n    conn   &lt;- connectToDatabase\n    result &lt;- queryDatabase conn\n    return ()\n\ndoQueryForever :: IO ()\ndoQueryForever = do\n    conn   &lt;- connectToDatabase  -- Firstly, create a connection\n\n    forever $ do\n        result &lt;- queryDatabase conn -- How can I update this conn when broken?\n        case result of\n          --\n          -- Here is the QUESTION. \n          -- If I create a New connection, it seems difficult for me to \n          -- make the new connection use by queryDatabase function.\n          --\n          Left oldConn -&gt; createNewConnection\n          Right s -&gt; putStrLn s\n</code></pre>\n\n<p>The Question is: How can I make the new connection just created to be used by queryDatabase function ? When <code>forever</code> function run again, I think the <code>conn</code> it uses is the old connection.</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 98400, "user_id": 3001761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feZwC.jpg?s=128&g=1", "display_name": "jonrsharpe", "link": "https://stackoverflow.com/users/3001761/jonrsharpe"}, "edited": false, "score": 0, "creation_date": 1481364652, "post_id": 41074096, "comment_id": 69355121, "body": "I&#39;m not familiar with Stack, but have you considered git submodules?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 98400, "user_id": 3001761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feZwC.jpg?s=128&g=1", "display_name": "jonrsharpe", "link": "https://stackoverflow.com/users/3001761/jonrsharpe"}, "edited": false, "score": 0, "creation_date": 1481371042, "post_id": 41074096, "comment_id": 69356851, "body": "@jonrsharpe, thanks, &quot;submodule&quot; is a term I needed. It <a href=\"https://github.com/commercialhaskell/stack/issues/348\" rel=\"nofollow noreferrer\">seems</a> people indeed use them with Stack for this kind of a task. Still, I&#39;d prefer to reference the library by its name."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1481429476, "post_id": 41074096, "comment_id": 69371659, "body": "Sounds a bit like you want a private hackage. <a href=\"https://www.reddit.com/r/haskell/comments/5eo2w3/question_solution_for_a_private_package_repo/\" rel=\"nofollow noreferrer\">Here</a>&#39;s a recent discussion on that and related approaches."}], "answers": [{"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": true, "score": 0, "last_activity_date": 1481624343, "last_edit_date": 1495542632, "creation_date": 1481624343, "answer_id": 41118616, "question_id": 41074096, "link": "https://stackoverflow.com/questions/41074096/how-to-develop-with-stack-two-separate-but-related-packages/41118616#41118616", "title": "How to develop with Stack two separate but related packages?", "body": "<p>I ended up using git submodules as <a href=\"https://stackoverflow.com/users/3001761/jonrsharpe\">jonrsharpe</a> suggested. Works good so far.</p>\n"}], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 41118616, "answer_count": 1, "score": 2, "last_activity_date": 1481624343, "creation_date": 1481362647, "question_id": 41074096, "link": "https://stackoverflow.com/questions/41074096/how-to-develop-with-stack-two-separate-but-related-packages", "title": "How to develop with Stack two separate but related packages?", "body": "<p>I'm writing a library and a project that uses the library. It's common with Stack to put both in the same folder and maintain a multi-package project, but I want to have two separate projects instead. Stack has external dependencies for this, but they are specified by locations and the projects runs on multiple machines, so it's inconvenient to specify paths (unless it's possible to have nested Stack projects, but this kinds defeats the purpose of having separate packages). I also don't want to use git locations, because it feels burdensome to explicitly specify commits (or maybe this is not necessary?), and don't want to pack the repository in an archive and then download it each time I change something.</p>\n\n<p>Ideally, I would like to be able to install the library on a machine and then reference it somehow in <code>stack.yaml</code> by its name, not location. Is it possible to do that? If not, is there a convenient way to maintain two separate but related packages?</p>\n"}, {"tags": ["haskell", "functor", "bifunctor"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1481411088, "post_id": 41075765, "comment_id": 69368599, "body": "May I ask what sort of work in what sorts of programming languages? Can you point to something accessible? I&#39;ve been thinking it might be possible to define something like <code>class Covariant (n :: Nat) p</code> expressing that <code>p</code> is covariant in its <code>nth</code> parameter, but I&#39;m not quite sure what that would look like."}, {"owner": {"reputation": 734, "user_id": 6279389, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lYeAD.jpg?s=128&g=1", "display_name": "Sophia Gold", "link": "https://stackoverflow.com/users/6279389/sophia-gold"}, "edited": false, "score": 0, "creation_date": 1481428466, "post_id": 41075765, "comment_id": 69371505, "body": "Thanks for the clear explanation! I was thinking of bifunctors as superfluous syntactic sugar, but your example of overloading map to take two parameters demonstrates how they&#39;re actually much simpler semantically as well. I&#39;m also intrigued by what you were referring to in your comment at the end, though. Doesn&#39;t OCaml have polymorphic functors?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481454135, "post_id": 41075765, "comment_id": 69376277, "body": "@dfeuer Oh, I was just making reference to the constellation of &quot;universe&quot;-style datatype descriptions that have been developed in DT languages."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1481454583, "post_id": 41075765, "comment_id": 69376376, "body": "@dfeuer PS, thinking aloud here, but I think a &quot;Covariant-in-parameter-n&quot; class wouldn&#39;t be the right way to go. Instead make a more flexible <code>Functor</code> which goes between arbitrary categories: <code>class (Category c1, Category c2) =&gt; Functor c1 c2 f | f -&gt; c1, f -&gt; c2 where fmap :: c1 a b -&gt; c2 (f a) (f b)</code>. Then a bifunctor (after uncurrying) is just a functor from the product category."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1481483578, "post_id": 41075765, "comment_id": 69384905, "body": "@dfeuer, one example of such work (the only I&#39;m aware of) is <a href=\"http://dreixel.net/research/pdf/gpif.pdf\" rel=\"nofollow noreferrer\">Generic Programming with Indexed Functors</a>. If you sacrifice first-orderness they have in the paper, you&#39;ll get <a href=\"https://github.com/effectfully/random-stuff/blob/master/Desc/InternalMuSet.agda\" rel=\"nofollow noreferrer\">something</a> quite powerful, but it&#39;s not ideal still as you can&#39;t e.g. make an index depend on a parameter or define several data types mutually such that they have distinct parameter telescopes."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 17, "last_activity_date": 1493762380, "last_edit_date": 1493762380, "creation_date": 1481374527, "answer_id": 41075765, "question_id": 41073862, "link": "https://stackoverflow.com/questions/41073862/what-are-bifunctors/41075765#41075765", "title": "What are bifunctors?", "body": "<p>I think you're overthinking it slightly. A bifunctor is just like a two-parameter functor. Gibbons and Oliveira's idea is just one application of bifunctors, just like the standard zoo of recursion schemes is just one application of functors.</p>\n\n<pre><code>class Bifunctor f where\n    bimap :: (a -&gt; c) -&gt; (b -&gt; d) -&gt; f a b -&gt; f c d\n</code></pre>\n\n<p><code>Bifunctor</code>s have a kind of <code>* -&gt; * -&gt; *</code> and both parameters can be covariantly mapped over. Compare this to regular <code>Functor</code>s, which have only one parameter (<code>f :: * -&gt; *</code>) which can be covariantly mapped over.</p>\n\n<p>For example, think about <code>Either</code>'s usual <code>Functor</code> instance. It only allows you to <code>fmap</code> over the second type parameter - <code>Right</code> values get mapped, <code>Left</code> values stay as they are.</p>\n\n<pre><code>instance Functor (Either a) where\n    fmap f (Left x) = Left x\n    fmap f (Right y) = Right (f y)\n</code></pre>\n\n<p>However, its <code>Bifunctor</code> instance allows you to map both halves of the sum.</p>\n\n<pre><code>instance Bifunctor Either where\n    bimap f g (Left x) = Left (f x)\n    bimap f g (Right y) = Right (g y)\n</code></pre>\n\n<p>Likewise for tuples: <code>(,)</code>'s <code>Functor</code> instance allows you to map only the second component, but <code>Bifunctor</code> allows you to map both parts.</p>\n\n<pre><code>instance Functor ((,) a) where\n    fmap f (x, y) = (x, f y)\n\ninstance Bifunctor (,) where\n    bimap f g (x, y) = (f x, g y)\n</code></pre>\n\n<p>Note that <code>Maybe</code>, which you mentioned, doesn't fit into the framework of bifunctors because it has only one parameter.</p>\n\n<hr>\n\n<p>On the question of <code>Fix</code>, the fixed point of a bifunctor allows you to characterise recursive types which have a functorial type parameter, such as most container-like structures. Let's use lists as an example.</p>\n\n<pre><code>newtype Fix f = Fix { unFix :: f (Fix f) }\n\ndata ListF a r = Nil_ | Cons_ a r deriving Functor\ntype List a = Fix (ListF a)\n</code></pre>\n\n<p>Using the standard functorial <code>Fix</code>, as I have above, there's no generic derivation of an instance of <code>Functor</code> for <code>List</code>, because <code>Fix</code> doesn't know anything about <code>List</code>'s <code>a</code> parameter. That is, I can't write anything like <code>instance Something f =&gt; Functor (Fix f)</code> because <code>Fix</code> has the wrong kind. I have to hand-crank a <code>map</code> for lists, perhaps using <code>cata</code>:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; List a -&gt; List b\nmap f = cata phi\n    where phi Nil_ = Fix Nil_\n          phi Cons_ x r = Fix $ Cons_ (f x) r\n</code></pre>\n\n<p>The bifunctorial version of <code>Fix</code> does permit an instance of <code>Functor</code>. <code>Fix</code> uses one of the bifunctor's parameters to plug in the recursive occurrence of <code>Fix f a</code> and the other one to stand in for the resultant datatype's functorial parameter.</p>\n\n<pre><code>newtype Fix f a = Fix { unFix :: f a (Fix f a) }\n\ninstance Bifunctor f =&gt; Functor (Fix f) where\n    fmap f = Fix . bimap f (fmap f) . unFix\n</code></pre>\n\n<p>So we can write:</p>\n\n<pre><code>deriveBifunctor ''ListF\n\ntype List = Fix ListF\n</code></pre>\n\n<p>and get the <code>Functor</code> instance for free:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; List a -&gt; List b\nmap = fmap\n</code></pre>\n\n<p>Of course, if you want to work generically with recursive structures with more than one parameter then you need to generalise to tri-functors, quad-functors, etc... This is clearly not sustainable, and plenty of work (in more advanced programming languages) has been put into designing more flexible systems for characterising types.</p>\n"}], "owner": {"reputation": 734, "user_id": 6279389, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lYeAD.jpg?s=128&g=1", "display_name": "Sophia Gold", "link": "https://stackoverflow.com/users/6279389/sophia-gold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2632, "favorite_count": 2, "accepted_answer_id": 41075765, "answer_count": 1, "score": 13, "last_activity_date": 1596142113, "creation_date": 1481360638, "last_edit_date": 1596142113, "question_id": 41073862, "link": "https://stackoverflow.com/questions/41073862/what-are-bifunctors", "title": "What are bifunctors?", "body": "<p>I'm relatively new to Haskell and having trouble understanding the utility of bifunctors. I think I understand them in theory: say for example if I wanted to map across a type that abstracts multiple concrete types, such as Either or Maybe, I'd need to encapsulate them in a bifunctor. But on the one hand, those examples seems particularly contrived, and on the other it does seem like you could achieve that same functionality simply through composition. </p>\n\n<p>As an example, I came across this code in <a href=\"https://www.cs.ox.ac.uk/jeremy.gibbons/publications/iterator.pdf\" rel=\"noreferrer\"><em>The Essence of the Iterator Pattern</em></a> by Jeremy Gibbons and Bruno C. d. S. Oliveira:</p>\n\n<pre><code>import Data.Bifunctor\n\ndata Fix s a = In {out::s a (Fix s a) }\n\nmap' :: Bifunctor s =&gt; (a -&gt; b) -&gt; Fix s a -&gt; Fix s b\nmap' f = In . bimap f (map' f) . out\n\nfold' :: Bifunctor s =&gt; (s a b -&gt; b) -&gt; Fix s a -&gt; b\nfold' f = f . bimap id (fold' f) . out\n\nunfold' :: Bifunctor s =&gt; (b -&gt; s a b) -&gt; b -&gt; Fix s a\nunfold' f = In . bimap id (unfold' f) . f\n</code></pre>\n\n<p>I understand the point is to compose mapping and folding functions to create an iterator pattern and this is achieved by defining a data constructor that requires two parameters. But in practice I don't understand how this is any different then using a regular functor and composing the functions with fmap instead of bimap. I think I clearly must be missing something, both with this example and, likely, in general.</p>\n"}, {"tags": ["haskell", "types", "ghc"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 6, "creation_date": 1481334429, "post_id": 41071219, "comment_id": 69349615, "body": "truly excellent pun. A+"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1481334459, "post_id": 41071219, "comment_id": 69349619, "body": "It looks as if the former declares <code>F k</code> to be fixed for the whole declaration, while the latter allows <code>H</code> to be used in its own declaration at different kinds. I.e. it allows polykinded recursion. Could be similar to the &quot;parameters vs indices&quot; distinction in inductive types (as in Agda/Coq)."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "edited": false, "score": 4, "creation_date": 1481337419, "post_id": 41071219, "comment_id": 69350115, "body": "Looks like this might be a (recently fixed) compiler bug.  I can duplicate your error message with &quot;ghc-8.0.1&quot; but it compiles fine with &quot;ghc-8.0.1.20161117&quot;, the latest version that &quot;stack&quot; decided to install for me (and which seems to be a release candidate for 8.0.2)."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1481348696, "post_id": 41071219, "comment_id": 69351889, "body": "@chi: I don&#39;t think that&#39;s it, for two reasons.  First, because you can&#39;t refer to <code>k</code> in the constructor: <code>data H&#39; :: F k -&gt; * where H&#39; :: forall (x :: F k). H&#39; x</code> produces the same error as <code>H</code>.  And second, because my understanding is that GHC doesn&#39;t have a parameter/index distinction, not even with TypeInType :-)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 1, "creation_date": 1481349005, "post_id": 41071219, "comment_id": 69351942, "body": "@AntalSpector-Zabusky, GHC does make that distinction, but it&#39;s not syntactic. Rather, it infers whether an argument is &quot;GADT-like&quot; (an index) or not (a parameter)."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1481349093, "post_id": 41071219, "comment_id": 69351958, "body": "@dfeuer: My understanding is that this is a surface Haskell thing only though, right?  &quot;Parameters&quot; get translated to Core in the boring way, and &quot;GADT-like&quot; arguments get translated to Core as an equality.  So you still &quot;only have parameters&quot;, in a certain sense."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1481349666, "post_id": 41071219, "comment_id": 69352036, "body": "@AntalSpector-Zabusky, I think you&#39;re right that they&#39;re only in Haskell and not Core. They affect role inference, at least. Not sure what else."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1481442050, "post_id": 41071219, "comment_id": 69373668, "body": "Seems like this may be related to visibility: <a href=\"https://ghc.haskell.org/trac/ghc/wiki/DependentHaskell/Phase1#Visibilitychangesintypes\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/wiki/DependentHaskell/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 259, "user_id": 1062395, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o9kzo.jpg?s=128&g=1", "display_name": "Richard Eisenberg", "link": "https://stackoverflow.com/users/1062395/richard-eisenberg"}, "is_accepted": true, "score": 3, "last_activity_date": 1481482615, "creation_date": 1481482615, "answer_id": 41089868, "question_id": 41071219, "link": "https://stackoverflow.com/questions/41071219/kind-of-confused-about-forall-in-type-indexed-gadts/41089868#41089868", "title": "&#39;Kind&#39; of confused about forall in type-indexed GADTs", "body": "<p>Author of <code>TypeInType</code> here. K. A. Buhr gets it right above; this is just a bug. It's fixed in HEAD.</p>\n\n<p>For the overly curious: this error message is meant to eliminate definitions like</p>\n\n<pre><code>data J = forall (a :: k). MkJ (Proxy a)\n</code></pre>\n\n<p>where</p>\n\n<pre><code>data Proxy (a :: k) = Proxy\n</code></pre>\n\n<p>can be imported from <code>Data.Proxy</code>. When declaring a datatype in Haskell98-style syntax, any existentially quantified variables must be explicitly brought into scope with a <code>forall</code>. But <code>k</code> is never brought into scope explicitly; it is just used in the kind of <code>a</code>. So that means that <code>k</code> should be universally quantified (in other words, it should be an invisible parameter to <code>J</code>, like the <code>k</code> parameter to <code>Proxy</code>)... but then when we write <code>J</code>, there is no way to determine what <code>k</code> should be, so it would always be ambiguous. (In contrast, we can discover the choice for the <code>k</code> parameter to <code>Proxy</code> by looking at <code>a</code>'s kind.)</p>\n\n<p>This definition for <code>J</code> is disallowed in 8.0.1 and in HEAD.</p>\n"}], "owner": {"reputation": 113, "user_id": 6472021, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-MdoCAts98oE/AAAAAAAAAAI/AAAAAAAAAFA/n8x2OSW1iuI/photo.jpg?sz=128", "display_name": "Jennifer Paykin", "link": "https://stackoverflow.com/users/6472021/jennifer-paykin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 41089868, "answer_count": 1, "score": 8, "last_activity_date": 1481482615, "creation_date": 1481332947, "question_id": 41071219, "link": "https://stackoverflow.com/questions/41071219/kind-of-confused-about-forall-in-type-indexed-gadts", "title": "&#39;Kind&#39; of confused about forall in type-indexed GADTs", "body": "<p>I've run into an odd situation in GHC 8.0.1 with kind-indexed (?) GADTs where introducing foralls in the type vs kind signatures produces different type-checking behaviors.</p>\n\n<p>Consider the following data types:</p>\n\n<pre><code>{-# LANGUAGE TypeInType, GADTs, ExplicitForAll #-}\n-- Same thing happens when we replace ExplicitForAll with ScopedTypeVariables\n\nimport Data.Kind\n\ndata F (k :: * -&gt; *) where\n\ndata G :: F k -&gt; * where\n  G :: G x\n</code></pre>\n\n<p>This data type compiles just fine. However, if we want to specify the kind of <code>x</code> in the constructor <code>G</code>, we get a type error.</p>\n\n<pre><code>data H :: F k -&gt; * where\n  H :: forall k' (x :: F k'). H x\n</code></pre>\n\n<p>The error message is</p>\n\n<blockquote>\n<pre><code>\u2022 Kind variable \u2018k\u2019 is implicitly bound in datatype\n  \u2018H\u2019, but does not appear as the kind of any\n  of its type variables. Perhaps you meant\n  to bind it (with TypeInType) explicitly somewhere?\n\u2022 In the data declaration for \u2018H\u2019\n</code></pre>\n</blockquote>\n\n<p>If we add the <code>forall</code> to the kind signature (with or without the <code>forall</code> in the constructor), there is no error.</p>\n\n<pre><code>data I :: forall k. F k -&gt; * where\n  I :: I x\n\ndata J :: forall k. F k -&gt; * where\n  J :: forall k' (x :: F k'). J x\n</code></pre>\n\n<p>What's going on?</p>\n"}, {"tags": ["json", "ajax", "haskell", "file-upload", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 3, "last_activity_date": 1481352000, "creation_date": 1481352000, "answer_id": 41072920, "question_id": 41070813, "link": "https://stackoverflow.com/questions/41070813/how-to-write-a-json-endpoint-in-yesod-which-receives-file-image-uploads/41072920#41072920", "title": "How to write a JSON endpoint in Yesod which receives file/image uploads?", "body": "<p>One simple way of doing this is to encode the file as base64 data and\nthen send it as part of JSON. But the disadvantage of this method is\nthat it increases the data size.</p>\n\n<p>Example:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n     --resolver lts-6.24\n     --install-ghc\n     runghc\n     --package yesod\n     --package yesod-core\n     --package persistent\n     --package text\n     --package aeson\n     --package bytestring\n     --package base64-bytestring\n-}\n\n{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE FlexibleInstances#-}\n{-# LANGUAGE OverloadedStrings#-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Control.Monad (join)\nimport Control.Applicative\nimport Data.Text (Text, unpack)\nimport qualified Data.Text.Lazy.Encoding\nimport Data.Typeable (Typeable)\nimport Text.Blaze.Html.Renderer.Utf8 (renderHtml)\nimport Yesod\nimport Data.Aeson\nimport Data.Aeson.Types\nimport qualified Data.ByteString as BS\nimport Data.ByteString (ByteString)\nimport qualified Data.ByteString.Base64 as BS\nimport qualified Data.Text.Encoding as T\n\ndata App = App\n\nmkYesod\n  \"App\"\n  [parseRoutes|\n/json/test TestR POST\n|]\n\ninstance Yesod App where\n  approot = ApprootStatic \"http://localhost:3006\"\n\ninstance RenderMessage App FormMessage where\n  renderMessage _ _ = defaultFormMessage\n\ndata Test = Test {\n      fileData :: Text,\n      name :: String\n} deriving (Show, Eq, Ord)\n\ninstance FromJSON Test where\n    parseJSON (Object v) = Test &lt;$&gt;\n                           v .: \"fileData\" &lt;*&gt;\n                           v .: \"name\"\n    parseJSON _ = empty\n\npostTestR :: Handler TypedContent\npostTestR = do\n  testData :: Test &lt;- requireJsonBody\n  let fileData' = BS.decode (T.encodeUtf8 $ fileData testData)\n  case fileData' of\n    Left err -&gt; error err\n    Right dat -&gt; liftIO $ BS.writeFile \"/home/sibi/myfile\" dat\n  selectRep $ provideRep $ return emptyObject\n\nmain :: IO ()\nmain = warp 3006 App\n</code></pre>\n\n<p>On execution:</p>\n\n<pre><code>$ curl -H \"Content-Type: application/json\" -H \"Accept: application/json\" -X POST -d '{\"fileData\":\"aGVsbG8gd29ybGQ=\",\"name\":\"Filename\"}' http://127.0.0.1:3006/json/test\n$ cat /home/sibi/myfile\nhello world\n</code></pre>\n"}], "owner": {"reputation": 1206, "user_id": 783116, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ZOv9Y.jpg?s=128&g=1", "display_name": "josiah", "link": "https://stackoverflow.com/users/783116/josiah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 2, "accepted_answer_id": 41072920, "answer_count": 1, "score": 3, "last_activity_date": 1481352000, "creation_date": 1481329070, "last_edit_date": 1481336533, "question_id": 41070813, "link": "https://stackoverflow.com/questions/41070813/how-to-write-a-json-endpoint-in-yesod-which-receives-file-image-uploads", "title": "How to write a JSON endpoint in Yesod which receives file/image uploads?", "body": "<p>I see a lot of posts that involve writing a form widget to handle image uploads, but my Yesod server is just a JSON API.  I would be receiving the Post request via Angular File Upload.</p>\n"}, {"tags": ["haskell", "traversal", "haskell-lens"], "answers": [{"comments": [{"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1481333225, "post_id": 41071188, "comment_id": 69349379, "body": "Looks like this could work! Would you be able to explain the (Proxy :: Proxy a)? Does it create a TypeRep for the provided type?  Also, do I need <code>coerce</code> and Ext, or could I do a <code>Map TypeRep Dynamic</code>? or is using the Ext with existential quantification faster? (I suppose the unsafeCoerce is safe since I know which type is stored by the typeref). Just wondering why you made the choice to go with <code>Ext a</code>. I&#39;ll fiddle with this as soon as I have time and let you know if it fits!"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1481333588, "post_id": 41071188, "comment_id": 69349446, "body": "P.S. I only wanted there to be one of each Extension type anyways, so that&#39;s actually a feature not a limitation :D"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 1, "creation_date": 1481333649, "post_id": 41071188, "comment_id": 69349462, "body": "Yes, it does. It&#39;s new way to get TypeRep for something. It was added to base since 4.7.0.0. For doing with <code>(Proxy :: Proxy a)</code> you have to use <code>-XScopedTypeVariables</code>"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1481334151, "post_id": 41071188, "comment_id": 69349555, "body": "Awesome! If this works out we have a winner! For future reference; as a beginner I find it very helpful to have required extensions listed in the answer (and perhaps explained if non-obvious). Even though GHC usually lets me know, it&#39;s a better experience for those less experienced :D"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "edited": false, "score": 0, "creation_date": 1481334856, "post_id": 41071188, "comment_id": 69349692, "body": "You can do with <code>Map TypeRep Dynamic</code> but it has overhead, because you known the type of value which you get from the map, but extraction from <code>Dynamic</code> will be checking it again."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 0, "last_activity_date": 1481332628, "creation_date": 1481332628, "answer_id": 41071188, "question_id": 41070794, "link": "https://stackoverflow.com/questions/41070794/prism-over-maybe-existent-list-element/41071188#41071188", "title": "Prism over maybe-existent list element", "body": "<p>I think the list of extensions is not proper solution for you. I would be added something like <code>_extState :: Map TypeRep Ext</code> where <code>data Ext = forall a. Ext a</code>. Then I would be added the lens:</p>\n\n<pre><code>ext :: forall a . Typeable a =&gt; Lens' Store (Maybe a)\next = _extState . at (typeRep (Proxy :: Proxy a)) . mapping coerce\n  where\n    coerce = iso (\\(Ext x) -&gt; unsafeCoerce x) Ext\n</code></pre>\n\n<p>This lens does like <code>at</code>. So you can simply get/set your extensions.</p>\n\n<p>But there is one limitation, all extensions must be of different types.</p>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 41071188, "answer_count": 1, "score": 2, "last_activity_date": 1481332628, "creation_date": 1481328922, "last_edit_date": 1481329768, "question_id": 41070794, "link": "https://stackoverflow.com/questions/41070794/prism-over-maybe-existent-list-element", "title": "Prism over maybe-existent list element", "body": "<p>today on \"adventures in functional programming with lenses\" our hero attempts to define a prism over a list element that may or may not exist.</p>\n\n<p>It's a bit tricky to explain, so to avoid the X, Y problem I'll give the actual use-case in all its glory.</p>\n\n<p>I'm writing a Text editor in Haskell called <a href=\"https://github.com/chrispenner/rasa\" rel=\"nofollow noreferrer\">Rasa</a>, the whole idea is that it's extremely extensible, and that means most functionality is written as extensions. Since it's a core principle, extensions ALSO depend on other extensions, so I needed a way to store their state centrally such that all extensions depending on an extension could access its current 'extension state'. Of course the types of these states is not known to the core of the editor, so at the moment I'm storing a list of <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Dynamic.html\" rel=\"nofollow noreferrer\">Dynamic</a> values. When the extension stores the state it converts to a Dynamic, then it can be extracted later via a prism like so:</p>\n\n<pre><code>data Store = Store\n  { _event :: [Event]\n  , _editor :: E.Editor\n  , _extState :: [Dynamic]\n  }\n\next :: Typeable a =&gt; Traversal' Store a\next = extState.traverse._Dynamic\n</code></pre>\n\n<p>So now <code>ext</code> is a polymorphic Traversal that essentially operates over only the Dynamics that 'match' the type in question (if you set to it it'll replace values of the same type, if you 'get' from it, it acts as a traversal over the Dynamics that match the type of the outbound value). If that seems like magic, it basically is...</p>\n\n<p>BTW, I'd love to have exactly 1 copy of a given Extension's state object in the list at any time.</p>\n\n<p>So getting and setting is actually working fine IFF there's already a value of the proper type in the list, <strong>my question is how can I make a version of this Traversal such that if a value of the proper type is in the list that it will replace it (and getting works as expected), but that will ADD a value to the list if the traversal is SET to and there's NO matching element in the list.</strong> I understand that Traversal's aren't supposed to change the number of elements that they're traversing, so perhaps this needs to be a prism or lens over the list itself?</p>\n\n<p>I understand this is really confusing, so please ask clarifying questions :)</p>\n\n<p>As for things I've taken a look at already, I was looking at <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Data-List-Lens.html#v:prefixed\" rel=\"nofollow noreferrer\">prefixed</a> and <a href=\"https://hackage.haskell.org/package/lens-4.15.1/docs/Control-Lens-Cons.html#v:Cons\" rel=\"nofollow noreferrer\">_Cons</a> as possible ways to do this, but I'm just not quite sure how to wire it up. Maybe I'm barking up the wrong tree entirely.</p>\n\n<p>I could perhaps add a default value to the end of the traversal somehow, but I don't want to require Monoid or Default so I can't conjure up elements from nowhere (and I only want to do it when SETTING).</p>\n\n<p>I'm also open to discussions about whether this is actually the proper way to store this state at all, but it's the most elegant of solutions I've found so far (though I know typecasting at run time is sub-optimal). I've looked into the Vault type, but passing keys around didn't really work well when I tried it (and I imagine it has similar type-casting performance issues).</p>\n\n<p>Cheers! Thanks for reading.</p>\n"}, {"tags": ["multithreading", "haskell", "recursion", "concurrency", "deadlock"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1481320975, "post_id": 41069250, "comment_id": 69346346, "body": "You should really try to reduce this to a small example you can paste in the body of your question. I know that may be hard, but someone will have to do that to fix the bug, or even to determine which package is responsible."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 4, "creation_date": 1481320982, "post_id": 41069250, "comment_id": 69346347, "body": "This question has the potential to be very interesting, but there&#39;s missing information. You should provide (a minimised version of) the problematic code in the question itself. See <a href=\"http://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a> for more guidance"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1481321210, "post_id": 41069250, "comment_id": 69346424, "body": "This is already the smallest example I can possibly make for now. If you don&#39;t count my library Timeless, which is kind of difficult to reduce. I will try"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1481322133, "post_id": 41069250, "comment_id": 69346733, "body": "Yes, once I put up my &quot;minimal&quot; timeless, you will see that it is used in test0, that <code>state</code> statement. No netwire involved, I will put in a single file."}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 1, "creation_date": 1481323007, "post_id": 41069250, "comment_id": 69347009, "body": "There it is, the minimal example. No external library is needed, and no concurrency and MVar"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1481324328, "post_id": 41069250, "comment_id": 69347432, "body": "This looks like it could be a GHC bug. What version of GHC are you using? If someone hasn&#39;t already done so, you should report it on <a href=\"https://ghc.haskell.org/trac/ghc/\" rel=\"nofollow noreferrer\">the GHC bug tracker</a>."}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1481324445, "post_id": 41069250, "comment_id": 69347470, "body": "8.0.1. Maybe I should try something earlier."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 7, "creation_date": 1481324613, "post_id": 41069250, "comment_id": 69347511, "body": "<code>mfix</code> for <code>IO</code> <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/src/System.IO.html#fixIO\" rel=\"nofollow noreferrer\">uses an <code>MVar</code></a>. Probably relevant question: <a href=\"http://stackoverflow.com/q/26635324/2751851\"><i>`mfix` not working as expected</i></a>."}, {"owner": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "edited": false, "score": 1, "creation_date": 1481331554, "post_id": 41069250, "comment_id": 69349129, "body": "Remove <code>seq</code> in <code>stepSignal</code> to get rid of the exception. I suspect that by forcing the value of signal <code>fixIO</code> indeed <a href=\"http://stackoverflow.com/questions/25876042/what-does-fixio-do\">hangs on empty MVar in IO</a>"}, {"owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "edited": false, "score": 0, "creation_date": 1481403669, "post_id": 41069250, "comment_id": 69366656, "body": "But then I get a heap exhausted problem. I tried to find where space leaks, but cannot locate the problem. Partially because I don&#39;t know how to read profile results, partially because <code>hp2ps</code> for all current GHC doesn&#39;t generate correct PS files"}], "owner": {"reputation": 1221, "user_id": 2353597, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bd9a1e25ba73d9fdfa8c87013ac122da?s=128&d=identicon&r=PG", "display_name": "Carl Dong", "link": "https://stackoverflow.com/users/2353597/carl-dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1481324142, "creation_date": 1481319249, "last_edit_date": 1495535419, "question_id": 41069250, "link": "https://stackoverflow.com/questions/41069250/haskell-mvar-block-indefinitely-while-no-mvar-is-involved", "title": "Haskell MVar block indefinitely while no MVar is involved", "body": "<p>TL;DR: I have a haskell project where everything is in a single thread, without any concurrency, but crashes like this:</p>\n\n<pre><code>program1: thread blocked indefinitely in an MVar operation\n</code></pre>\n\n<p>Longer description:</p>\n\n<p>I am trying to locate the bug when working on <a href=\"https://github.com/carldong/timeless-tutorials/blob/master/src/Tutorial1.hs\" rel=\"nofollow noreferrer\">https://github.com/carldong/timeless-tutorials/blob/master/src/Tutorial1.hs</a>, which depends on another library, timeless. You would notice that all concurrency code are commented out, and doing a grep on the timeless repo will show that no concurrency code is involved. Then I am totally confused about this crash, and I don't know how to get more detailed information, like stack trace. I tried running with some RTS parameters:</p>\n\n<pre><code>$ stack exec -- Tutorial1 +RTS -p -M4m -xc\n*** Exception (reporting due to +RTS -xc): (THUNK_STATIC), stack trace: \n  FRP.Timeless.Internal.Signal.loop.\\,\n  called from FRP.Timeless.Internal.Signal.loop,\n  called from FRP.Timeless.state,\n  called from FRP.Timeless.Internal.Signal.first.\\,\n  called from FRP.Timeless.Internal.Signal.first,\n  called from FRP.Timeless.Internal.Signal...\\,\n  called from FRP.Timeless.Internal.Signal..,\n  called from Tutorial1.test0,\n  called from FRP.Timeless.Internal.Signal.stepSignal.step,\n  called from FRP.Timeless.Internal.Signal.stepSignal,\n  called from FRP.Timeless.Run.runBox,\n  called from Tutorial1.main\n*** Exception (reporting due to +RTS -xc): (THUNK_STATIC), stack trace: \n  FRP.Timeless.Internal.Signal.loop.\\,\n  called from FRP.Timeless.Internal.Signal.loop,\n  called from FRP.Timeless.state,\n  called from FRP.Timeless.Internal.Signal.first.\\,\n  called from FRP.Timeless.Internal.Signal.first,\n  called from FRP.Timeless.Internal.Signal...\\,\n  called from FRP.Timeless.Internal.Signal..,\n  called from Tutorial1.test0,\n  called from FRP.Timeless.Internal.Signal.stepSignal.step,\n  called from FRP.Timeless.Internal.Signal.stepSignal,\n  called from FRP.Timeless.Run.runBox,\n  called from Tutorial1.main\nTutorial1: thread blocked indefinitely in an MVar operation\n</code></pre>\n\n<p>And I cannot find what <code>THUNK_STATIC</code> is, because nothing on Google says about it. From <a href=\"https://stackoverflow.com/questions/30000359/recursive-update-a-behaviour-in-sodium-yields-thread-blocked\">recursive update a &quot;Behaviour&quot; in Sodium yields &#39;thread blocked ...&#39;</a> I might guess that the bug might have some relationship with the magical <code>ArrowLoop</code> which originally comes from Netwire, but I can't really make sense out of it.</p>\n\n<p>I stripped down the entire Timeless and my test case into the smallest sample, which is self-contained and contains the bug. I cannot strip down the <code>Signal</code>s any more because these are originally forked from Netwire, and I don't fully understand how ArrowLoop stuff really work under the hood.</p>\n\n<p><em>Update</em> I made the example even smaller. I also confirmed that this bug is present without the <code>-threaded</code> flag</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n{-# LANGUAGE TupleSections #-}\n{-# LANGUAGE GADTs #-}\n\nimport Prelude hiding ((.),id)\nimport Control.Applicative\nimport Control.Arrow\nimport Control.Monad\nimport Control.Monad.Fix\n-- import Data.Monoid\nimport Control.Category\nimport Data.Maybe\n\n\n---------\n-- Stripped down Timeless here\n---------\ndata Signal a b where\n  SGen ::\n    (Maybe a -&gt; IO (Maybe b, Signal a b)) -&gt; Signal a b\n\n\ninstance Category Signal where\n    id = SGen (\\ma -&gt; return (ma, id))\n    s2 . s1 = SGen $ \\mx0 -&gt; do\n                (mx1, s1') &lt;- stepSignal s1 mx0\n                (mx2, s2') &lt;- stepSignal s2 mx1\n                mx2 `seq` return (mx2, s2'. s1')\n\ninstance Arrow Signal where\n    arr f = SGen $ \\ma -&gt; case ma of\n      Just a -&gt; return (Just (f a), arr f)\n      Nothing -&gt; return (Nothing, arr f)\n\n    first s' =\n        SGen $ \\mxy' -&gt;\n            fmap (\\(mx, s) -&gt; lstrict (liftA2 (,) mx (fmap snd mxy'), first s))\n                  (stepSignal s' (fmap fst mxy'))\n\ninstance ArrowLoop Signal where\n  loop s =\n    SGen $ \\mx -&gt;\n      fmap (fmap fst ***! loop) .\n      mfix $ \\ ~(mx',_) -&gt;\n        let d | Just (_,d) &lt;- mx' = d\n              | otherwise = error \"Feedback broken by inhibition\"\n        in stepSignal s (fmap (,d) mx)\n\n-- | Steps a signal in certain time step\nstepSignal ::\n              Signal a b\n           -- ^ Signal to be stepped\n           -&gt; Maybe a\n           -- ^ Input\n           -- | Stateful output\n           -&gt; IO (Maybe b, Signal a b)\nstepSignal s Nothing = return (Nothing, s)\nstepSignal s (Just x) = x `seq` step s (Just x)\n  where\n    step (SGen f) = f\n\n-- | Left-strict version of '&amp;&amp;&amp;' for functions.\n(&amp;&amp;&amp;!) :: (a -&gt; b) -&gt; (a -&gt; c) -&gt; (a -&gt; (b, c))\n(&amp;&amp;&amp;!) f g x' =\n    let (x, y) = (f x', g x')\n    in x `seq` (x, y)\n\n\n-- | Left-strict version of '***' for functions.\n(***!) :: (a -&gt; c) -&gt; (b -&gt; d) -&gt; ((a, b) -&gt; (c, d))\n(***!) f g (x', y') =\n    let (x, y) = (f x', g y')\n    in x `seq` (x, y)\n\n-- | Left strict tuple\nlstrict :: (a,b) -&gt; (a,b)\nlstrict (x,y) = x `seq` (x,y)\n\n\n-- | Make a pure stateful signal from given transition function\nmkPure :: (a -&gt; (Maybe b, Signal a b)) -&gt; Signal a b\nmkPure f =\n  SGen $ \\mx -&gt;\n  case mx of\n    Just x -&gt; return . lstrict $ f x\n\n-- | Make a pure stateful signal from given signal function\nmkSF :: (a -&gt; (b, Signal a b)) -&gt; Signal a b\nmkSF f = mkPure (lstrict . first Just . f)\n\n-- | Make a pure stateless signal from given signal function\nmkSF_ :: (a -&gt; b) -&gt; Signal a b\nmkSF_ = arr\n\ndelay :: a -&gt; Signal a a\ndelay x' = mkSF $ \\x -&gt; (x', delay x)\n\n-- | Make a stateful wire from chained state transition\n-- function. Notice that the output will always be the new value\nmkSW_ :: b -&gt; (b -&gt; a -&gt; b) -&gt; Signal a b\nmkSW_ b0 f = mkSF $ g b0\n    where\n      g b0 x = let b1 = f b0 x in\n                   lstrict (b1, mkSW_ b1 f)\n\n-- | This command drives a black box of signal network. The driver\n-- knows nothing about the internals of the network, only stops when\n-- the network is inhibited.\nrunBox :: Signal () () -&gt; IO ()\nrunBox n = do\n (mq, n') &lt;- stepSignal n (Just ())\n case mq of\n   Just _ -&gt; n' `seq` runBox n'\n   Nothing -&gt; return ()\n\n-- | Holds a discrete value to be continuous. An initial value must be given\nhold :: a -&gt; Signal (Maybe a) a\nhold a0 = mkSW_ a0 fromMaybe\n\n-- | Takes a snapshot of b when an event a comes. Meanwhile, transform the\n-- 'Stream' with the 'Cell' value\nsnapshot :: ((a,b) -&gt; c) -&gt; Signal (Maybe a, b) (Maybe c)\nsnapshot f = mkSF_ $ \\(ma, b) -&gt;\n  case ma of\n    Just a -&gt; Just $ f (a,b)\n    Nothing -&gt; Nothing\n\nstate :: s -&gt; ((a, s) -&gt; s) -&gt; Signal (Maybe a) s\nstate s0 update = loop $ proc (ma, s) -&gt; do\n  sDelay &lt;- delay s0 -&lt; s\n  s' &lt;- hold s0 &lt;&lt;&lt; snapshot update -&lt; (ma, sDelay)\n  returnA -&lt; (s', s')\n\n------\n-- Stripped down Timeless ends\n------\n\n-- | Problematic Arrow\ntest0 = proc () -&gt; do\n  s &lt;- state 0 (\\(_, coin) -&gt; coin + 1) -&lt; Nothing\n  returnA -&lt; ()\n\n\nmain :: IO ()\nmain = runBox test0\n</code></pre>\n"}, {"tags": ["json", "parsing", "haskell", "yesod", "aeson"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481321086, "post_id": 41069249, "comment_id": 69346385, "body": "Do you really need your own representation as <code>Restaurant</code>? You can use <code>Data.Aeson.Value</code> as it is. If need then I think you should to design it without the json example then you can design parser."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481322986, "post_id": 41069249, "comment_id": 69347002, "body": "And, the json example isn&#39;t valid."}], "owner": {"reputation": 1, "user_id": 7245540, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-L4aN4zcWKl0/AAAAAAAAAAI/AAAAAAAAAak/Ma8EYLTE_EU/photo.jpg?sz=128", "display_name": "DmLitov4", "link": "https://stackoverflow.com/users/7245540/dmlitov4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1481319238, "creation_date": 1481319238, "question_id": 41069249, "link": "https://stackoverflow.com/questions/41069249/data-structure-for-google-places-api-json-in-yesod", "title": "Data structure for Google Places API JSON in Yesod", "body": "<p>I am new to Haskell and Yesod development.\nI try to parse JSON from Google Web Api using Aeson.\nMy JSON is like</p>\n\n<pre><code>{\n   \"html_attributions\" : [],\n   \"results\" : [\n       {\n         \"geometry\" : {\n             \"location\" : {\n             \"lat\" : 47.2487941,\n             \"lng\" : 39.7119239\n          },\n         \"viewport\" : {\n           \"northeast\" : {\n              \"lat\" : 47.2488398,\n              \"lng\" : 39.71313905\n           },\n           \"southwest\" : {\n              \"lat\" : 47.24865699999999,\n              \"lng\" : 39.71151884999999\n           }\n        }\n     },\n     \"icon\" : \"https://maps.gstatic.com/mapfiles/place_api/icons/lodging-71.png\",\n     \"id\" : \"5aae9c47cad3016c64d3cc2c8d438ae656c8c0af\",\n     \"name\" : \"AMAKS Congress hotel\",\n     \"photos\" : [\n        {\n           \"height\" : 2304,\n           \"html_attributions\" : [\n              \"\\u003ca href=\\\"https://maps.google.com/maps/contrib/116238492021115373516/photos\\\"\\u003eDmitry Semenov\\u003c/a\\u003e\"\n           ],\n           \"photo_reference\" : \"CoQBdwAAAP5F6Xu0nGvQ8wjAyY4ENNKEWzw8CohQU_2Z15oXWIQOvzwAOBQduK4OQfh-nRyw0iKCwLMS2o9fKanMcxpC4xop22SrxZI45OZWmvC-bTf80kJlgdnlU0q-AsncUxcP6sbfWMaTmAPCsqiAFLJhHwHD93VXCvyV2V4pC2CUpWKAEhBAr9aS0xoapQvNmvcUYfU7GhT3IKDXEdZ49LtEeMXMaBQKlNZ6DQ\",\n           \"width\" : 4096\n        }\n     ],\n     \"place_id\" : \"ChIJNT2qOT7r40ARrxvwbj2Huxg\",\n     \"rating\" : 4.1,\n     \"reference\" : \"CmRRAAAAUR4QujRBtpkltqU51qCjuihX1JDEgX9ijFzkTeWGWkeQkw4spvaKqCPUrYit4jNs5AyT1hV-y0M72U2CtOTYgT_6chw5KAq0sB3l1k18BOoioDJqTL6HQ_kvqNn62ISIEhA-lNI9YXDt-cjErgJqHjGFGhQpYucBzRg9yilMU0MEn6b293lVUQ\",\n     \"scope\" : \"GOOGLE\",\n     \"types\" : [\n        \"bowling_alley\",\n        \"bakery\",\n        \"lodging\",\n        \"restaurant\",\n        \"food\",\n        \"store\",\n        \"point_of_interest\",\n        \"establishment\"\n     ],\n     \"vicinity\" : \"\u043f\u0440\u043e\u0441\u043f\u0435\u043a\u0442 \u041c\u0438\u0445\u0430\u0438\u043b\u0430 \u041d\u0430\u0433\u0438\u0431\u0438\u043d\u0430, 19, \u0420\u043e\u0441\u0442\u043e\u0432-\u043d\u0430-\u0414\u043e\u043d\u0443\"\n  }, \n  / more items here\n  \"status\" : \"ok\"\n}\n</code></pre>\n\n<p>I created data for representing JSON:</p>\n\n<pre><code>data Restaurant = Restaurant {status :: Text} deriving  (Show, Generic)\n</code></pre>\n\n<p>And it works, I can extract status. But when it comes to more complicated enclosed fields such as \"results\", I don't know how to describe and use it.\nSo what should I write instead of ??? in</p>\n\n<pre><code>data Restaurant = Restaurant {results :: ???, status :: Text} deriving (Show, Generic)\n</code></pre>\n\n<p>And then how can I get access to items inside (name, rating, etc.)?\nThank you!</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 2, "last_activity_date": 1481315439, "creation_date": 1481315439, "answer_id": 41068402, "question_id": 41068075, "link": "https://stackoverflow.com/questions/41068075/parsec-permutation-parsing/41068402#41068402", "title": "Parsec permutation parsing", "body": "<p><code>(&lt;|?&gt;)</code> does not play nicely with folding because the type of the <code>StreamPermParser</code> you pass as its first argument isn't the same than that of the <code>StreamPermParser</code> result. For a simpler yet analogous issue, you would run into similar problems if you were trying to use <code>(,,)</code> with <code>(&lt;$&gt;)</code> and <code>(&lt;*&gt;)</code> in applicative style (e.g. <code>(,,) &lt;$&gt; foo &lt;*&gt; bar &lt;*&gt; baz</code>).</p>\n\n<p>If you want to cut down some of the repetition, my prosaic suggestion would be using a local definition:</p>\n\n<pre><code>entryParser :: Parser Entry\nentryParser = do\n  (f, l) &lt;- nameParser\n  (d, n, p) &lt;- permute ((,,)\n    &lt;$?&gt; optField \"Date of Birth\"\n    &lt;|?&gt; optField \"Nationality\"\n    &lt;|?&gt; optField \"Parentage\"\n    )\n  return $ Entry f l d n p\n  where\n  optField fieldName = (Nothing, liftM Just (try $ attributeParser fieldName))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 2, "last_activity_date": 1481315908, "creation_date": 1481315908, "answer_id": 41068511, "question_id": 41068075, "link": "https://stackoverflow.com/questions/41068075/parsec-permutation-parsing/41068511#41068511", "title": "Parsec permutation parsing", "body": "<p>As a first step, you can abstract the stuff you do for every component:</p>\n\n<pre><code>attr txt = (Nothing, liftM Just (try $ attributeParser txt))\n</code></pre>\n\n<p>With this, you can go to:</p>\n\n<pre><code>entryParser :: Parser Entry\nentryParser = do\n  (f, l) &lt;- nameParser\n  (d, n, p) &lt;- permute ((,,)\n    &lt;$?&gt; attr \"Date of Birth\"\n    &lt;|?&gt; attr \"Nationality\"\n    &lt;|?&gt; attr \"Parentage\"\n    )\n  return $ Entry f l d n p\n</code></pre>\n\n<p>Then, if you want, you can combine the infix combinators and the <code>attr</code> calls:</p>\n\n<pre><code>f .$ x = f &lt;$?&gt; attr x\nf .| x = f &lt;|?&gt; attr x\n\ninfixl 2 .$\ninfixl 2 .|\n</code></pre>\n\n<p>This gives you:</p>\n\n<pre><code>entryParser :: Parser Entry\nentryParser = do\n  (f, l) &lt;- nameParser\n  (d, n, p) &lt;- permute ((,,)\n    .$ \"Date of Birth\"\n    .| \"Nationality\"\n    .| \"Parentage\"\n    )\n  return $ Entry f l d n p\n</code></pre>\n\n<p>Then you can further simplify by getting rid of the intermediate triple. All you're doing is to build it and then apply its components to <code>Entry f l</code>, so you can as well apply the result of the permutation parser to <code>Entry f l</code> directly:</p>\n\n<pre><code>entryParser :: Parser Entry\nentryParser = do\n  (f, l) &lt;- nameParser\n  permute (Entry f l\n    .$ \"Date of Birth\"\n    .| \"Nationality\"\n    .| \"Parentage\"\n    )\n</code></pre>\n\n<p>I think this is compact enough. If you really want some kind of fold, you'll either have to introduce an intermediate list and collect the permutation results in a list. This, however, only works as long as all the permutable attributes are of the same type (they currently are), and is not so nice because you'll make assumptions about the number of elements in this list. Or you'll have to use a heterogeneous list / some type class magic, which will lead to more complexity with the types and is, I think, not worth it here.</p>\n"}], "owner": {"reputation": 23, "user_id": 5346542, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XKOUIxTHV58/AAAAAAAAAAI/AAAAAAAAAZQ/o6nA1BYK8AI/photo.jpg?sz=128", "display_name": "Alexander Shestakov", "link": "https://stackoverflow.com/users/5346542/alexander-shestakov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 41068511, "answer_count": 2, "score": 2, "last_activity_date": 1481315908, "creation_date": 1481314106, "last_edit_date": 1481314200, "question_id": 41068075, "link": "https://stackoverflow.com/questions/41068075/parsec-permutation-parsing", "title": "Parsec permutation parsing", "body": "<p>I wrote such permutation parsing example:</p>\n\n<pre><code>data Entry = Entry {\n    first_name :: String\n  , last_name :: String\n  , date_of_birth :: Maybe String\n  , nationality :: Maybe String\n  , parentage :: Maybe String\n} deriving (Show)\n\nnameParser :: Parser (String, String)\nnameParser = do\n  first_name &lt;- many1 upper\n  endOfLine\n  last_name &lt;- many1 letter\n  endOfLine\n  return $ (first_name, last_name)\n\nattributeParser :: String -&gt; Parser String\nattributeParser field = do\n  string $ field ++ \": \"\n  value &lt;- many1 (noneOf \"\\n\")\n  endOfLine\n  return value\n\nentryParser :: Parser Entry\nentryParser = do\n  (f, l) &lt;- nameParser\n  (d, n, p) &lt;- permute ((,,)\n    &lt;$?&gt; (Nothing, liftM Just (try $ attributeParser \"Date of Birth\"))\n    &lt;|?&gt; (Nothing, liftM Just (try $ attributeParser \"Nationality\"))\n    &lt;|?&gt; (Nothing, liftM Just (try $ attributeParser \"Parentage\"))\n    )\n  return $ Entry f l d n p\n\nmain = do\n    mapM_ putStrLn . map (show . parse entryParser \"\") $ goodTests\n\ngoodTests =\n  \"AAKVAAG\\nTorvild\\nDate of Birth: 1 July\\nNationality: Norwegian\\nParentage: business executive\\n\" :\n  \"AAKVAAG\\nTorvild\\nNationality: Norwegian\\nParentage: business executive\\n\" :\n  \"AAKVAAG\\nTorvild\\nParentage: business executive\\nNationality: Norwegian\\n\" :\n  \"AAKVAAG\\nTorvild\\nParentage: business executive\\n\" :\n  \"AAKVAAG\\nTorvild\\nNationality: Norwegian\\n\" : []\n</code></pre>\n\n<p>It would be good to extend <code>Entry</code> data with new fields in future, but doing that will require to put even more repetitive code in <code>entryParser</code> function. Is there a way to make this function accept list of parsers?</p>\n\n<p>I started with this:</p>\n\n<pre><code>attributeParsers =\n  map attributeParser [\"Date of Birth\", \"Nationality\", \"Parentage\"]\n\npermuteParams =\n  map (\\p -&gt; (Nothing, liftM Just (try p))) attributeParsers\n</code></pre>\n\n<p>But could not come of with correct way to fold <code>permuteParams</code> together with <code>&lt;|?&gt;</code> operator (I guess it would require something smarter than <code>(,,)</code> tuple constructor then).</p>\n"}, {"tags": ["haskell", "middleware", "servant"], "answers": [{"tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 9, "last_activity_date": 1481291533, "last_edit_date": 1481291533, "creation_date": 1481290909, "answer_id": 41061815, "question_id": 41061044, "link": "https://stackoverflow.com/questions/41061044/haskell-servant-wai-middleware-not-working-properly/41061815#41061815", "title": "Haskell servant wai middleware not working properly", "body": "<p>If I understand correctly, you want to compose two middleware's: <code>logStdoutDev</code> and <code>staticPolicy $ addBase \"static\"</code>. But what did you do?</p>\n\n<pre><code>middleware = do\n    logStdoutDev\n    staticPolicy $ addBase \"static\"\n</code></pre>\n\n<p>It's equivalent with:</p>\n\n<pre><code>middleware = logStdoutDev &gt;&gt; (staticPolicy $ addBase \"static\")\n</code></pre>\n\n<p>So, What monad has been used? The <code>middleware</code> has type <code>Application -&gt; Application</code>. So it's monad reader <code>(-&gt;) Application</code>.</p>\n\n<p>The expression <code>logStdoutDev &gt;&gt; (staticPolicy $ addBase \"static\")</code> equivalent with <code>\\r -&gt; (\\_ -&gt; (staticPolicy $ addBase \"static\") r) (logStdoutDev r)</code>. Or if simplify, we'll get: <code>\\r -&gt; (staticPolicy $ addBase \"static\") r</code>.</p>\n\n<p>You should to do like this:</p>\n\n<pre><code>middleware = logStdoutDev . (staticPolicy $ addBase \"static\")\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 3893319, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wd9aa.jpg?s=128&g=1", "display_name": "Reygoch", "link": "https://stackoverflow.com/users/3893319/reygoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 41061815, "answer_count": 1, "score": 2, "last_activity_date": 1481291533, "creation_date": 1481288240, "question_id": 41061044, "link": "https://stackoverflow.com/questions/41061044/haskell-servant-wai-middleware-not-working-properly", "title": "Haskell servant wai middleware not working properly", "body": "<p>So, I want to add two wai middlewares to my servant server. One middleware for serving static files, and one for logging.</p>\n\n<p>I have my api defined (<code>router</code>) and this is how I start my server :</p>\n\n<pre><code>webServer :: IO ()\nwebServer = run 80 (middleware $ router)\n</code></pre>\n\n<p>And here is how I defined my <code>middleware</code> :</p>\n\n<pre><code>middleware :: Application -&gt; Application\nmiddleware = do\n  logStdoutDev\n  staticPolicy $ addBase \"static\"\n</code></pre>\n\n<p>Now, if I put <code>logStdoutDev</code> first than I can't serve static files, but if I put <code>staticPolicy</code> first, than I can serve static files but I loose ability to log events (basically they get ignored).</p>\n\n<p>Question is really, how to properly combine <code>wai</code> middleware in servant.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1481249465, "post_id": 41051862, "comment_id": 69311542, "body": "Please include actual error messages in your question, rather than presenting paraphrased or abridged versions. They really are useful. The error message you ask about in the comment is because putStrLn wants a String, and x is a list of Ints, not a String."}, {"owner": {"reputation": 45, "user_id": 5480378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/610de795e4db70ee8b4c438bd6e46f18?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/5480378/tyler"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1481251922, "post_id": 41051862, "comment_id": 69312086, "body": "Thanks, I am fairly new to this site, Ill keep this in mind for future questions"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 5480378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/610de795e4db70ee8b4c438bd6e46f18?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/5480378/tyler"}, "edited": false, "score": 0, "creation_date": 1481249253, "post_id": 41051929, "comment_id": 69311497, "body": "It fixed 1 error, but I am still getting &quot;couldn&#39;t match type &#39;Int&#39; with &#39;Char&#39; Expected type: String, Actual type: [Int]"}, {"owner": {"reputation": 3233, "user_id": 2487227, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yLbAE.jpg?s=128&g=1", "display_name": "Frederick Zhang", "link": "https://stackoverflow.com/users/2487227/frederick-zhang"}, "reply_to_user": {"reputation": 45, "user_id": 5480378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/610de795e4db70ee8b4c438bd6e46f18?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/5480378/tyler"}, "edited": false, "score": 0, "creation_date": 1481249471, "post_id": 41051929, "comment_id": 69311543, "body": "@Tyler ...or you can derive <code>Show</code> for that... if you want"}, {"owner": {"reputation": 45, "user_id": 5480378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/610de795e4db70ee8b4c438bd6e46f18?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/5480378/tyler"}, "edited": false, "score": 0, "creation_date": 1481249641, "post_id": 41051929, "comment_id": 69311590, "body": "Yeah I noticed that just after I posted the comment, it works now thank you both for the help!"}], "tags": [], "owner": {"reputation": 3233, "user_id": 2487227, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yLbAE.jpg?s=128&g=1", "display_name": "Frederick Zhang", "link": "https://stackoverflow.com/users/2487227/frederick-zhang"}, "is_accepted": true, "score": 3, "last_activity_date": 1481249342, "last_edit_date": 1481249342, "creation_date": 1481248459, "answer_id": 41051929, "question_id": 41051862, "link": "https://stackoverflow.com/questions/41051862/how-do-i-write-a-haskell-program-that-prints-out-the-prime-factors-of-a-specifie/41051929#41051929", "title": "How do I write a Haskell program that prints out the prime factors of a specified number?", "body": "<pre><code>let x = factors $ (read number :: Int)\nprint x\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>number &lt;- readLn\n</code></pre>\n\n<p>(thanks @Daniel)</p>\n\n<p>This should do the work.</p>\n"}], "owner": {"reputation": 45, "user_id": 5480378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/610de795e4db70ee8b4c438bd6e46f18?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/5480378/tyler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 41051929, "answer_count": 1, "score": 0, "last_activity_date": 1481259088, "creation_date": 1481248001, "last_edit_date": 1481259088, "question_id": 41051862, "link": "https://stackoverflow.com/questions/41051862/how-do-i-write-a-haskell-program-that-prints-out-the-prime-factors-of-a-specifie", "title": "How do I write a Haskell program that prints out the prime factors of a specified number?", "body": "<p>This is what I have so far, I am pretty sure the function itself is correct but I am confused on what to do in the main = do block. \nThe error I am getting is that the function wants an integer but I am giving it a string instead. I am assuming it has to do with the getLine part and the fact I am not checking to see if the entered number is an int.</p>\n\n<pre><code>factors :: Int -&gt; [Int]\nfactors n = [x | x &lt;- [1..n], mod n x == 0]\nprimeFactors :: Int -&gt; [Int]\nprimeFactors n = [x | x &lt;- [1..n], mod n x == 0, isPrime x]\nisPrime x = (length (factors x)) == 2\nmain = do\n  putStrLn \"Enter a number.\"\n  number &lt;- getLine\n  let x = factors number\n  putStrLn x\n</code></pre>\n\n<p>The errors I get when I run this code:</p>\n\n<blockquote>\n  <p>primeFactor.hs:9:19: error:<pre>\n    \u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Int\u2019\n      Expected type: Int\n        Actual type: String\n    \u2022 In the first argument of \u2018factors\u2019, namely \u2018number\u2019\n      In the expression: factors number\n      In an equation for \u2018x\u2019: x = factors number\n      </pre></p>\n  \n  <p>primeFactor.hs:10:12: error:<pre>\n    \u2022 Couldn't match type \u2018Int\u2019 with \u2018Char\u2019\n      Expected type: String\n        Actual type: [Int]\n    \u2022 In the first argument of \u2018putStrLn\u2019, namely \u2018x\u2019\n      In a stmt of a 'do' block: putStrLn x\n      In the expression:\n        do { putStrLn \"Enter a number.\";\n             number &lt;- getLine;\n             let x = factors number;\n             putStrLn x }\n    </pre></p>\n</blockquote>\n"}, {"tags": ["haskell", "installation", "macos-sierra", "hugs"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 11, "creation_date": 1481247599, "post_id": 41051195, "comment_id": 69311028, "body": "Are you required to use Hugs for something? If not, you should use GHC. GHC updates regularly, while the latest release of Hugs is 10 years old."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 4, "creation_date": 1481270630, "post_id": 41051195, "comment_id": 69318082, "body": "If you&#39;re working with course material designed around Hugs, you may want to use GHC version 7.8. Changes since then could confuse you somewhat."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 2317671, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aop2t.jpg?s=128&g=1", "display_name": "Elizabeth Lagesse", "link": "https://stackoverflow.com/users/2317671/elizabeth-lagesse"}, "is_accepted": false, "score": 1, "last_activity_date": 1495330196, "last_edit_date": 1495330196, "creation_date": 1495327251, "answer_id": 44092125, "question_id": 41051195, "link": "https://stackoverflow.com/questions/41051195/installing-hugs-98-on-macos-sierra/44092125#44092125", "title": "Installing Hugs 98 on macOS sierra", "body": "<p>Leaving aside other respondents' caveats about the wisdom of using hugs at all, you can <a href=\"https://georgegarside.com/blog/macos/installing-hugs-98-haskell/\" rel=\"nofollow noreferrer\">get a version of Hugs that works splendidly on the current (10.12.3) version of Sierra here</a>.</p>\n\n<p>The instructions work as stated, and building should take between 5 and 10 minutes. </p>\n"}], "owner": {"reputation": 1, "user_id": 7270273, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154802864846100/picture?type=large", "display_name": "MRanks123", "link": "https://stackoverflow.com/users/7270273/mranks123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1495330196, "creation_date": 1481243178, "question_id": 41051195, "link": "https://stackoverflow.com/questions/41051195/installing-hugs-98-on-macos-sierra", "title": "Installing Hugs 98 on macOS sierra", "body": "<p>I am having trouble installing Hugs 98  on macOS Sierra. I have followed the instructions here (<a href=\"http://www.willamette.edu/~fruehr/154/HugsMacInstall.html\" rel=\"nofollow noreferrer\">http://www.willamette.edu/~fruehr/154/HugsMacInstall.html</a>) which tell me to install macports then run sudo port install hugs98. Unfortunately, this results in the following error message :</p>\n\n<p>Error: Processing of port hugs98 failed</p>\n\n<p>Does anyone know if installing HUGS on macOS sierra is going to be possible?<br>\nThanks!</p>\n"}, {"tags": ["haskell", "functional-programming", "function-composition"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 5, "creation_date": 1481222000, "post_id": 41046206, "comment_id": 69300514, "body": "All functions are single-argument, i.e. <code>a-&gt;b-&gt;c</code> is the same as <code>a-&gt;(b-&gt;c)</code>. Build from here."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 5, "creation_date": 1481222998, "post_id": 41046206, "comment_id": 69301015, "body": "... and so <code>f x y</code> is the same as <code>(f x) y</code>. (<code>f :: a-&gt;(b-&gt;c)</code>, <code>x :: a</code>, <code>y :: b</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 23573, "user_id": 330889, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/daacb6d0a16d95a3858ccae59b44860d?s=128&d=identicon&r=PG", "display_name": "Pedro Rolo", "link": "https://stackoverflow.com/users/330889/pedro-rolo"}, "edited": false, "score": 0, "creation_date": 1481227553, "post_id": 41047068, "comment_id": 69303297, "body": "Thank you! My confusion was due to thinking through this as if function application would be right associative, and the mess was due to that (-&gt;) associating to the right in the type signatures... I am now finding it funny that functional application in type declarations has a different associativity than in the expressions themselves."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 23573, "user_id": 330889, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/daacb6d0a16d95a3858ccae59b44860d?s=128&d=identicon&r=PG", "display_name": "Pedro Rolo", "link": "https://stackoverflow.com/users/330889/pedro-rolo"}, "edited": false, "score": 3, "creation_date": 1481233297, "post_id": 41047068, "comment_id": 69306227, "body": "@PedroMorteRolo It is sort of symmetrical that way. With it set like it is, you can have no parentheses in an application of <code>fn</code> to &#39;two&#39; arguments as <code>fn x y</code> and no parentheses in the corresponding type signature for <code>fn :: Int -&gt; Int -&gt; Bool</code> (for example). If they associated in the same way (regardless of which way that is), one of those two things would need parens and the other wouldn&#39;t."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 9, "last_activity_date": 1481224612, "last_edit_date": 1481224612, "creation_date": 1481224265, "answer_id": 41047068, "question_id": 41046206, "link": "https://stackoverflow.com/questions/41046206/how-does-multi-argument-functional-composition-work-e-g-fmap-fmap/41047068#41047068", "title": "How does &quot;multi-argument&quot; functional composition work (e.g. fmap . fmap)?", "body": "<p>Well, just look at the definition of <code>(.)</code>:</p>\n\n<pre><code>(f . g) x = f (g x)\n</code></pre>\n\n<p>So,</p>\n\n<pre><code>(fmap . fmap) function = fmap (fmap function)\n</code></pre>\n\n<p>Adding an additional argument at the end doesn't really change the equation -- just makes it more specific.</p>\n\n<pre><code>(fmap . fmap) function nested_functor = fmap (fmap function) nested_functor\n</code></pre>\n\n<p>(N.B. function application is left associative, so <code>f x y</code> means <code>(f x) y</code>.)</p>\n"}], "owner": {"reputation": 23573, "user_id": 330889, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/daacb6d0a16d95a3858ccae59b44860d?s=128&d=identicon&r=PG", "display_name": "Pedro Rolo", "link": "https://stackoverflow.com/users/330889/pedro-rolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 41047068, "answer_count": 1, "score": 1, "last_activity_date": 1481226083, "creation_date": 1481221069, "last_edit_date": 1481226083, "question_id": 41046206, "link": "https://stackoverflow.com/questions/41046206/how-does-multi-argument-functional-composition-work-e-g-fmap-fmap", "title": "How does &quot;multi-argument&quot; functional composition work (e.g. fmap . fmap)?", "body": "<p>When we have the expression:</p>\n\n<pre><code>(fmap . fmap) function nested_functor\n</code></pre>\n\n<p>I would expect it to translate to something like</p>\n\n<pre><code>fmap (fmap function nested_functor)\n</code></pre>\n\n<p>Though it surprisingly seems to behave as </p>\n\n<pre><code>fmap (fmap function) nested_functor\n</code></pre>\n\n<p>Why?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481240006, "post_id": 41044554, "comment_id": 69308860, "body": "Have you tried using <code>INLINE CONLIKE [1]</code> for modify to delaying the inlining of modify until after the rule fires?"}, {"owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481240152, "post_id": 41044554, "comment_id": 69308913, "body": "@Alec I just used <code>NOINLINE</code> to be sure inlining wasn&#39;t the issue. But I tried <code>INLINE CONLIKE [1]</code> just now and it doesn&#39;t help."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1481260766, "post_id": 41044554, "comment_id": 69314408, "body": "I am surprised that <code>l</code> does not get inlined even before the rule fires, and then the code would look equal. I guess you will have to look closer at the Core, both of the code and of the LHS of the rule."}, {"owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1481294037, "post_id": 41044554, "comment_id": 69332285, "body": "@JoachimBreitner the core for <code>fusionB</code> is <a href=\"https://gist.github.com/jkarni/828065f3f9fdfce998f91bc91b7b155e#file-core-L318-L346\" rel=\"nofollow noreferrer\">here</a>. Happy to paste the core for <code>fusionB&#39;</code> too (the one in which the rule fires), though I&#39;m not sure how that helps figure out why the rule doesn&#39;t fire in this case."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1481391266, "post_id": 41044554, "comment_id": 69362838, "body": "It has floated out stuff to the top-level, which often prevents rule from firing. Can you make <code>pb</code> an argument of <code>fusionB</code>?"}, {"owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1482532424, "post_id": 41044554, "comment_id": 69820129, "body": "@JoachimBreitner yes, and that helps (if I don&#39;t give it a signature), but I&#39;d like this to fire reliably, since it&#39;s part of a library&#39;s API."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1482579531, "post_id": 41044554, "comment_id": 69829082, "body": "That seems to be a largely unsolved problem, unfortunately."}], "owner": {"reputation": 2647, "user_id": 2141650, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/68388df031850463b7bbb5a9e6034abe?s=128&d=identicon&r=PG", "display_name": "user2141650", "link": "https://stackoverflow.com/users/2141650/user2141650"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 284, "favorite_count": 2, "answer_count": 0, "score": 15, "last_activity_date": 1481215446, "creation_date": 1481215446, "question_id": 41044554, "link": "https://stackoverflow.com/questions/41044554/rewrite-rules-and-let-abstraction-in-ghc", "title": "Rewrite rules and let abstraction in GHC", "body": "<p>I have a rewrite rule that looks like this:</p>\n\n<pre><code>{-# RULES\n\"modify/fusedModify\" forall f g key book. modify key f (modify key g book) = fusedModify key f g book\n  #-}\n</code></pre>\n\n<p>Which fires in the following function:</p>\n\n<pre><code>pb :: PersonB\npb = ...\n\nfusionB' :: PersonB\nfusionB' =\n  let l x = (modify #name ('c':) (modify #name ('a':) x))\n  in l pb\n</code></pre>\n\n<p>However, without let (and presumably let-abstraction?) it does not fire:</p>\n\n<pre><code>fusionB :: PersonB\nfusionB = modify #name ('c':) (modify #name ('a':) pb)\n</code></pre>\n\n<p>If it went the <em>other</em> way - that is, if the let-abstracted version didn't cause a firing, but <code>fusionB</code> did - I think I'd understand. It could be that in the specific case, <code>fusedModify</code> has the right type signature, but in the general (more polymorphic) case, it doesn't. But why in the world am I seeing this? </p>\n\n<p>For what it's worth, the definition of <code>fusedModify</code> is <a href=\"https://github.com/turingjump/bookkeeper/blob/fusion/bookkeeper/src/Bookkeeper/Internal.hs#L127\" rel=\"noreferrer\">here</a>, and the file with <code>fusionB</code> and <code>fusionB'</code> is <a href=\"https://github.com/turingjump/bookkeeper/blob/fusion/bookkeeper/bench/Main.hs\" rel=\"noreferrer\">here</a>. I've tried <code>unsafeCoercing</code> type equalities to get both signatures to match up (in reality, though GHC doesn't realize it, they do always match), but somehow that doesn't help either. </p>\n\n<p><em>EDIT</em>: I should perhaps mention that I'm using GHC 8.0.1.</p>\n"}, {"tags": ["haskell", "lambda", "evaluation"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 5, "creation_date": 1481226506, "post_id": 41044436, "comment_id": 69302782, "body": "You might also like comparing these two, which gets to the essence of the question, and avoids all the vagaries of having typeclasses lying around to confuse things: <code>(id True, id &#39;a&#39;)</code> is fine but <code>(\\f -&gt; (f True, f &#39;a&#39;)) id</code> is an error."}, {"owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1481258087, "post_id": 41044436, "comment_id": 69313636, "body": "@DanielWagner Why does this happen? Isn&#39;t <code>id</code> polymorphic?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1481259695, "post_id": 41044436, "comment_id": 69314080, "body": "Yes indeed, <code>id</code> is polymorphic; and <code>\\f -&gt; ...</code> can be polymorphic; but inside the <code>...</code>, <code>f</code> itself is <i>not</i> polymorphic! <code>\\f -&gt; (f True, f &#39;a&#39;)</code> is already a type error without ever mentioning <code>id</code>. This restriction is put in place to make type inference easier and to preserve the desirable property that any term that can be given a type at all has a most general type."}], "answers": [{"comments": [{"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 1, "creation_date": 1481215926, "post_id": 41044680, "comment_id": 69297042, "body": "Does this relate to monomorphism restriction?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 14, "creation_date": 1481216127, "post_id": 41044680, "comment_id": 69297180, "body": "I don&#39;t think so. In the first example, the first 199 is free to default to <code>Integer</code>, but the second one is forced to be treated as <code>Int</code> because it is being compared to the return value of <code>lenDigits</code>. In the second, <code>i</code> is forced to be <code>Int</code> for the same reason, which in turn forces 199 to be an <code>Int</code> as well."}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1481216592, "post_id": 41044680, "comment_id": 69297482, "body": "Is there any reason the return type of <code>length</code> isn&#39;t polymorphic?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 1, "creation_date": 1481216856, "post_id": 41044680, "comment_id": 69297657, "body": "@mnoronha Yes, for example perfomence. But you can use <code>genericLength :: Num i =&gt; [a] -&gt; i</code>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 5, "creation_date": 1481216971, "post_id": 41044680, "comment_id": 69297727, "body": "@mnoronha See also: <a href=\"http://softwareengineering.stackexchange.com/q/211053/101698\"><i>Why isn&#39;t `length` generic by default?</i></a> at SE.SE."}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 26, "last_activity_date": 1481216126, "last_edit_date": 1481216126, "creation_date": 1481215796, "answer_id": 41044680, "question_id": 41044436, "link": "https://stackoverflow.com/questions/41044436/contradictory-behaviour-of-lambda-functions/41044680#41044680", "title": "Contradictory Behaviour of Lambda Functions", "body": "<p>Because in the first expression the first <code>199</code> has type <code>Integer</code> and the second has <code>Int</code>. But in the second expression both have type <code>Int</code> and <code>factorial 199</code> can't be represented by the type <code>Int</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 8, "last_activity_date": 1481399241, "last_edit_date": 1481399241, "creation_date": 1481396144, "answer_id": 41079130, "question_id": 41044436, "link": "https://stackoverflow.com/questions/41044436/contradictory-behaviour-of-lambda-functions/41079130#41079130", "title": "Contradictory Behaviour of Lambda Functions", "body": "<p>Here goes a step-by-step take on this question.</p>\n\n<p>Let's begin with:</p>\n\n<pre><code>((lenDigits . factorial) 199) &lt;= 199\n</code></pre>\n\n<p>According to the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch6.html#x13-1360006.4.1\" rel=\"noreferrer\">Haskell Report</a>...</p>\n\n<blockquote>\n  <p>An integer literal represents the application of the function <code>fromInteger</code> to the appropriate value of type <code>Integer</code>.</p>\n</blockquote>\n\n<p>That means our first expression is actually:</p>\n\n<pre><code>((lenDigits . factorial) (fromInteger (199 :: Integer)) \n    &lt;= (fromInteger (199 :: Integer))\n</code></pre>\n\n<p>By itself, <code>fromInteger (199 :: Integer)</code> has the polymorphic type <code>Num a =&gt; a</code>. We now have to see whether this type is specialised in the context of the whole expression. Note that, until we find a reason for it not being so, we should assume that the polymorphic types of the two occurrences of <code>fromInteger (199 :: Integer)</code> are independent (<code>Num a =&gt; a</code> and <code>Num b =&gt; b</code>, if you will).</p>\n\n<p><code>lenDigits</code> is <code>Show a =&gt; a -&gt; Int</code>, and so the... </p>\n\n<pre><code>(lenDigits . factorial) (fromInteger (199 :: Integer))\n</code></pre>\n\n<p>... to the left of the <code>&lt;=</code> must be an <code>Int</code>. Given that <code>(&lt;=)</code> is <code>Ord a =&gt; a -&gt; a -&gt; Bool</code>, the <code>fromInteger (199 :: Integer)</code> to the right of the <code>&lt;=</code> also has to be an <code>Int</code>. The whole expression then becomes:</p>\n\n<pre><code>((lenDigits . factorial) (fromInteger (199 :: Integer)) &lt;= (199 :: Int)\n</code></pre>\n\n<p>While the second <code>199</code> was specialised to <code>Int</code>, the first one is still polymorphic. In the absence of other type annotations, defaulting makes it specialise to <code>Integer</code> when we use the expression in GHCi. Therefore, we ultimately get:</p>\n\n<pre><code>((lenDigits . factorial) (199 :: Integer)) &lt;= (199 :: Int)\n</code></pre>\n\n<p>Now, on to the second expression:</p>\n\n<pre><code>(\\i -&gt; ((lenDigits . factorial) i) &lt;= i) 199\n</code></pre>\n\n<p>By the same reasoning used above, <code>(lenDigits . factorial) i</code> (to the left of <code>&lt;=</code>) is an <code>Int</code>, and so <code>i</code> (to the right of <code>&lt;=</code>) is also an <code>Int</code>. That being so, we have...</p>\n\n<pre><code>GHCi&gt; :t \\i -&gt; (lenDigits . factorial) i &lt;= i\n\\i -&gt; (lenDigits . factorial) i &lt;= i :: Int -&gt; Bool\n</code></pre>\n\n<p>... and therefore applying it to <code>199</code> (which is actually <code>fromInteger (199 :: Integer)</code>) specialises it to int, giving:</p>\n\n<pre><code>((lenDigits . factorial) (199 :: Int)) &lt;= (199 :: Int)\n</code></pre>\n\n<p>The first <code>199</code> is now <code>Int</code> rather than <code>Integer</code>. <code>factorial (199 :: Int)</code> overflows the fixed size <code>Int</code> type, leading to a bogus result. One way of avoiding that would be introducing an explicit <code>fromInteger</code> in order to get something equivalent to the first scenario:</p>\n\n<pre><code>GHCi&gt; :t \\i -&gt; (lenDigits . factorial) i &lt;= fromInteger i\n\\i -&gt; (lenDigits . factorial) i &lt;= fromInteger i :: Integer -&gt; Bool\nGHCi&gt; (\\i -&gt; (lenDigits . factorial) i &lt;= fromInteger i) 199\nFalse\n</code></pre>\n"}], "owner": {"reputation": 1818, "user_id": 1955231, "user_type": "registered", "accept_rate": 22, "profile_image": "https://graph.facebook.com/100002848311925/picture?type=large", "display_name": "Agnishom Chattopadhyay", "link": "https://stackoverflow.com/users/1955231/agnishom-chattopadhyay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1549, "favorite_count": 2, "accepted_answer_id": 41044680, "answer_count": 2, "score": 27, "last_activity_date": 1481399241, "creation_date": 1481215025, "question_id": 41044436, "link": "https://stackoverflow.com/questions/41044436/contradictory-behaviour-of-lambda-functions", "title": "Contradictory Behaviour of Lambda Functions", "body": "<p>Using the following definitions:</p>\n\n<pre><code>lenDigits n = length (show n)\nfactorial n = product [1..n]\n</code></pre>\n\n<p>I evaluate the following </p>\n\n<pre><code>Prelude&gt; ((lenDigits . factorial) 199) &lt;= 199\nFalse\nPrelude&gt; (\\i -&gt; ((lenDigits . factorial) i) &lt;= i) 199\nTrue\n</code></pre>\n\n<p>What is the reason for such behaviour? As I see it, the first expression is just the same as the second expression with the lambdas reduced.</p>\n"}, {"tags": ["haskell", "functional-programming", "currying"], "comments": [{"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481209002, "post_id": 41041583, "comment_id": 69292139, "body": "Why did you use <code>myFilter</code> instead <code>filter</code>? And I think more appropriate is to use <code>find</code> instead <code>filter</code>."}], "answers": [{"comments": [{"owner": {"reputation": 404, "user_id": 3446982, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e0817a4df91c0acaedeb649dff964e0f?s=128&d=identicon&r=PG&f=1", "display_name": "Spark Monkay", "link": "https://stackoverflow.com/users/3446982/spark-monkay"}, "edited": false, "score": 0, "creation_date": 1481216026, "post_id": 41041713, "comment_id": 69297107, "body": "I see it, thank you. It&#39;s sad that I did not took the x from the context and applied it to the function."}], "tags": [], "owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "is_accepted": false, "score": 5, "last_activity_date": 1481206926, "creation_date": 1481206926, "answer_id": 41041713, "question_id": 41041583, "link": "https://stackoverflow.com/questions/41041583/curry-anonymous-function/41041713#41041713", "title": "Curry Anonymous Function", "body": "<p><code>x</code> is an argument to <code>largestDivisible</code>, but you don't need to pass it as an argument to your lambda. The lambda can get <code>x</code> from the captured context, and only needs <code>y</code> as an argument.</p>\n\n<p>The first version passes the partially-applied <code>f x</code>  to <code>myFilter</code>, and that - with the first argument given - is a unary function.</p>\n\n<p>The second version tries passing a lambda of two arguments, without using partial application to get a suitable function first.</p>\n\n<p>Either use partial application as in your first example, or just write a lambda of one argument (<code>y</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 404, "user_id": 3446982, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e0817a4df91c0acaedeb649dff964e0f?s=128&d=identicon&r=PG&f=1", "display_name": "Spark Monkay", "link": "https://stackoverflow.com/users/3446982/spark-monkay"}, "edited": false, "score": 0, "creation_date": 1481215969, "post_id": 41041859, "comment_id": 69297069, "body": "To you second code fragment: Does the whitespace matter? Is there a difference to write <code>\\ x ... </code>or <code>\\x ...</code>? Okay, I think I got the point. In the third code fragment I create a function, to which I pass x (the x which you marked) and then I pass the list. Thank you for this! Obviously the fourth code fragment would be the &#39;best&#39; one."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 404, "user_id": 3446982, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e0817a4df91c0acaedeb649dff964e0f?s=128&d=identicon&r=PG&f=1", "display_name": "Spark Monkay", "link": "https://stackoverflow.com/users/3446982/spark-monkay"}, "edited": false, "score": 0, "creation_date": 1481217040, "post_id": 41041859, "comment_id": 69297764, "body": "@SparkMonkay <code>\\ x</code> is the same of <code>\\x</code>. The space inside <code>\\x y</code> matters, of course, otherwise <code>\\xy</code> takes variable <code>xy</code> as argument."}, {"owner": {"reputation": 404, "user_id": 3446982, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e0817a4df91c0acaedeb649dff964e0f?s=128&d=identicon&r=PG&f=1", "display_name": "Spark Monkay", "link": "https://stackoverflow.com/users/3446982/spark-monkay"}, "edited": false, "score": 0, "creation_date": 1481217928, "post_id": 41041859, "comment_id": 69298291, "body": "That is what I mean, <code>\\ x y z</code> is the same as <code>\\x y z</code>."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1481207386, "creation_date": 1481207386, "answer_id": 41041859, "question_id": 41041583, "link": "https://stackoverflow.com/questions/41041583/curry-anonymous-function/41041859#41041859", "title": "Curry Anonymous Function", "body": "<p>The code </p>\n\n<pre><code>| otherwise = head (myFilter (f x) [x-1, x-2..1])\nwhere f x y= x `mod` y == 0\n</code></pre>\n\n<p>is equivalent to</p>\n\n<pre><code>| otherwise = head (myFilter (f x) [x-1, x-2..1])\nwhere f = \\x y -&gt; x `mod` y == 0\n</code></pre>\n\n<p>which is equivalent to</p>\n\n<pre><code>| otherwise = head (myFilter ((\\x y -&gt; x `mod` y == 0) x) [x-1, x-2..1])\n                                                   -- ^^^\n</code></pre>\n\n<p>Note that the application of <code>x</code> still remains there! We can further simplify by applying the anonymous function (a beta step):</p>\n\n<pre><code>| otherwise = head (myFilter (\\y -&gt; x `mod` y == 0) [x-1, x-2..1])\n</code></pre>\n"}], "owner": {"reputation": 404, "user_id": 3446982, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e0817a4df91c0acaedeb649dff964e0f?s=128&d=identicon&r=PG&f=1", "display_name": "Spark Monkay", "link": "https://stackoverflow.com/users/3446982/spark-monkay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 41041859, "answer_count": 2, "score": 1, "last_activity_date": 1481207386, "creation_date": 1481206521, "question_id": 41041583, "link": "https://stackoverflow.com/questions/41041583/curry-anonymous-function", "title": "Curry Anonymous Function", "body": "<p>I am new to Haskell and functionall programming and am a little confused. Why can not I curry an anonymous function, or is it even possible?</p>\n\n<p>I have the following piece of code:</p>\n\n<pre><code>largestDivisible :: (Integral a) =&gt; a -&gt; a\nlargestDivisible x\n    | x &lt;= 0    = error \"NOT A VALID VALUE\"\n    | otherwise = head (myFilter (f x) [x-1, x-2..1])\n    where f x y= x `mod` y == 0\n</code></pre>\n\n<p>When I try to write it like this:</p>\n\n<pre><code>largestDivisible :: (Integral a) =&gt; a -&gt; a\nlargestDivisible x\n    | x &lt;= 0    = error \"NOT A VALID VALUE\"\n    | otherwise = head (myFilter (\\ x y = x `mod` y == 0) [x-1, x-2..1])\n</code></pre>\n\n<p>Then I get the following error if I try to load it into the GHCi I get the following error:</p>\n\n<pre><code>ListStuff.hs:85:35: error:\n\u2022 Couldn't match expected type \u2018Bool\u2019 with actual type \u2018a -&gt; Bool\u2019\n\u2022 The lambda expression \u2018\\ x y -&gt; (mod x y == 0)\u2019\n  has two arguments,\n  but its type \u2018a -&gt; Bool\u2019 has only one\n  In the first argument of \u2018myFilter\u2019, namely\n    \u2018(\\ x y -&gt; (mod x y == 0))\u2019\n  In the first argument of \u2018head\u2019, namely\n    \u2018(myFilter (\\ x y -&gt; (mod x y == 0)) [x - 1, x - 2 .. 1])\u2019\n\u2022 Relevant bindings include\n    x :: a (bound at ListStuff.hs:83:19)\n    largestDivisible' :: a -&gt; a (bound at ListStuff.hs:83:1)\nFailed, modules loaded: none.\n</code></pre>\n"}, {"tags": ["list", "haskell", "data-structures", "key-value"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1481192102, "post_id": 41036672, "comment_id": 69281095, "body": "What code did you try, and what exact error(s) did you actually get?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1481192282, "post_id": 41036672, "comment_id": 69281224, "body": "<code>getVar</code> will be partial. After all, it might be that your <code>SymTable</code> doesn&#39;t contain the given <code>Ident</code>. You have to wrap <code>Either a [a]</code> in <code>Maybe</code> or similar."}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481192395, "post_id": 41036672, "comment_id": 69281291, "body": "List can contain single and many items. Do you really need to use <code>Either</code>?"}, {"owner": {"reputation": 411, "user_id": 4316384, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mmXKh.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/4316384/paul"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481192718, "post_id": 41036672, "comment_id": 69281501, "body": "@freestyle Yes, because for me &#39;a&#39; is a variable and &#39;[a]&#39; is a stack."}, {"owner": {"reputation": 411, "user_id": 4316384, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mmXKh.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/4316384/paul"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1481192786, "post_id": 41036672, "comment_id": 69281548, "body": "@Zeta I tried to return Nothing if Ident is not present, but then should I change the header to Maybe Either a [a]?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481194303, "post_id": 41036672, "comment_id": 69282526, "body": "We can help you if you help us to understand what exactly did you try to do?"}, {"owner": {"reputation": 411, "user_id": 4316384, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mmXKh.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/4316384/paul"}, "reply_to_user": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1481198220, "post_id": 41036672, "comment_id": 69285050, "body": "@freestyle Updated with code"}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1481198816, "post_id": 41036672, "comment_id": 69285422, "body": "Still we don&#39;t know the error you are getting."}], "answers": [{"comments": [{"owner": {"reputation": 411, "user_id": 4316384, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mmXKh.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/4316384/paul"}, "edited": false, "score": 0, "creation_date": 1481209768, "post_id": 41039581, "comment_id": 69292723, "body": "Thanks very much! I&#39;ve updated the question with a litte modification on setVar"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "reply_to_user": {"reputation": 411, "user_id": 4316384, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mmXKh.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/4316384/paul"}, "edited": false, "score": 0, "creation_date": 1481210471, "post_id": 41039581, "comment_id": 69293194, "body": "I think you can simplify <code>clearList</code> like this: <code>clearList (x:xs) i | fst x == i = xs</code> (don&#39;t continue)"}], "tags": [], "owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "is_accepted": true, "score": 3, "last_activity_date": 1481200178, "creation_date": 1481200178, "answer_id": 41039581, "question_id": 41036672, "link": "https://stackoverflow.com/questions/41036672/creating-a-table-for-storing-data-in-haskell/41039581#41039581", "title": "Creating a table for storing data in Haskell", "body": "<p>I don't see any problem with compilation of <code>setVar</code>, but more better is <code>setVar (ST xs) i a = ST ((i, a) : xs)</code>.</p>\n\n<p>You have problem with <code>getVar</code>. The <code>filter</code> can \"eat\" a list, but you gave the <code>SymTable</code>.</p>\n\n<p>So you can do like this:</p>\n\n<pre><code>getVar (ST xs) i = snd (head (filter (\\x -&gt; fst x == i) xs))\n</code></pre>\n\n<p>More better way:</p>\n\n<pre><code>getVar (ST xs) i = fromJust (lookup i xs)\n</code></pre>\n\n<p>But, if key doesn't exist you will get an exception. So, maybe you want like this:</p>\n\n<pre><code>getVar :: SymTable a -&gt; Ident -&gt; Maybe (Either a [a])\ngetVar (ST xs) i = lookup i xs\n</code></pre>\n"}], "owner": {"reputation": 411, "user_id": 4316384, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mmXKh.jpg?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/4316384/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1154, "favorite_count": 0, "accepted_answer_id": 41039581, "answer_count": 1, "score": 0, "last_activity_date": 1481209742, "creation_date": 1481191475, "last_edit_date": 1481209742, "question_id": 41036672, "link": "https://stackoverflow.com/questions/41036672/creating-a-table-for-storing-data-in-haskell", "title": "Creating a table for storing data in Haskell", "body": "<p>I'm trying to store data in a key-value style in Haskell. The idea is that I have an identification (Ident) and it can be a single value or a list of them.</p>\n\n<p>I have tried the following structure:</p>\n\n<pre><code>type Ident = String\ndata SymTable a = ST [(Ident, Either a [a])]\n                  deriving (Show)\n</code></pre>\n\n<p>The problem comes when I try to define the following basic functions to store/retrieve data from the data structure:</p>\n\n<pre><code>setVar :: SymTable a -&gt; Ident -&gt; Either a [a] -&gt; SymTable a\ngetVar :: SymTable a -&gt; Ident -&gt; Either a [a]\n</code></pre>\n\n<p>I've tried several implementations but I can't get the compiler to work (accept types).</p>\n\n<p>As a constraint, I can't use any external library (no Map or similars).</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>So my idea was to do something like this:</p>\n\n<pre><code>setVar :: SymTable a -&gt; Ident -&gt; Either a [a] -&gt; SymTable a\nsetVar (ST xs) i a = ST ([(i, a)] ++ xs)\n\ngetVar :: SymTable a -&gt; Ident -&gt; Either a [a]\ngetVar t i = snd (head (filter (\\x -&gt; fst x == i) t))\n</code></pre>\n\n<p><strong>UPDATE 2</strong></p>\n\n<p>Following @freestyle answer, i changed a little bit setVar so if you input an Ident that already exists, it overwrites it. </p>\n\n<pre><code>setVar :: SymTable a -&gt; Ident -&gt; Either a [a] -&gt; SymTable a\nsetVar (ST xs) i a = ST ([(i, a)] ++ clearList xs i)\n   where\n       clearList [] _ = []\n       clearList (x:xs) i\n           | fst x == i = clearList xs i\n           | otherwise = x : clearList xs i\n</code></pre>\n\n<p>getVar stays as he suggested:</p>\n\n<pre><code>getVar :: SymTable a -&gt; Ident -&gt; Maybe (Either a [a])\ngetVar (ST xs) i = lookup i xs\n</code></pre>\n"}, {"tags": ["haskell", "packages", "cabal", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 3793144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd79d2295d54bc80d561a15e630b2a1a?s=128&d=identicon&r=PG", "display_name": "DuckOfDoom", "link": "https://stackoverflow.com/users/3793144/duckofdoom"}, "edited": false, "score": 0, "creation_date": 1481286289, "post_id": 41038483, "comment_id": 69327148, "body": "Thanks for the answer and edits. I was just thinking that my core app will not be considered a package, but now I see that everything has to be a package in terms of cabal in order to build multipackage projects with libs and such."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 0, "last_activity_date": 1481200638, "last_edit_date": 1592644375, "creation_date": 1481196822, "answer_id": 41038483, "question_id": 41036325, "link": "https://stackoverflow.com/questions/41036325/hackage-name-collision-while-using-stack-solver-with-extra-deps/41038483#41038483", "title": "Hackage name collision while using stack solver with extra-deps", "body": "<p>Quoting the <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#package-names-and-versions\" rel=\"nofollow noreferrer\">Cabal user guide</a> (emphasis mine):</p>\n<blockquote>\n<p>Package names and versions</p>\n<p>All packages have a name, e.g. \u201cHUnit\u201d. <em>Package names are assumed to be unique</em>. Cabal package names can use letters, numbers and hyphens, but not spaces. The namespace for Cabal packages is flat, not hierarchical.</p>\n</blockquote>\n<p>Accordingly, the <em>Cabal</em> library doesn't have a feature for handling package name conflicts, and neither do <em>cabal-install</em> nor <em>stack</em>. That being so, you will have to rename your package.</p>\n<p>P.S.: I am deliberately not considering seriously the possibility of setting up your project to use a <a href=\"https://docs.haskellstack.org/en/stable/nonstandard_project_init/#private-hackage\" rel=\"nofollow noreferrer\">private Hackage</a> that excludes the homonymous package, both because I don't know how it would play out in practice and because it is vastly more trouble than it is worth.</p>\n"}], "owner": {"reputation": 13, "user_id": 3793144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd79d2295d54bc80d561a15e630b2a1a?s=128&d=identicon&r=PG", "display_name": "DuckOfDoom", "link": "https://stackoverflow.com/users/3793144/duckofdoom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 41038483, "answer_count": 1, "score": 1, "last_activity_date": 1481200638, "creation_date": 1481190537, "last_edit_date": 1481196177, "question_id": 41036325, "link": "https://stackoverflow.com/questions/41036325/hackage-name-collision-while-using-stack-solver-with-extra-deps", "title": "Hackage name collision while using stack solver with extra-deps", "body": "<p>Well it turns out that my app name is the same as one of the packages that is uploaded to hackage, so when I try to resolver extra dependencies using <code>stack solver --resolver lts 7.12</code>, I get the following error:</p>\n\n<pre><code>$ stack solver --resolver lts-7.12\nUsing configuration file: stack.yaml\nUsing cabal packages:\n- html-parse.cabal\n\nUsing resolver: lts-7.12\nUsing compiler: ghc-8.0.1\nAsking cabal to calculate a build plan...\nTrying with packages from lts-7.12 as hard constraints...\nAttempt failed.\n\n&gt;&gt;&gt;&gt; Cabal errors begin\ncabal.exe: Could not resolve dependencies:\nnext goal: html-parse (user goal)\nrejecting: html-parse-0.2.0.0, 0.1.0.0 (global constraint requires ==0.0.0.3)\ntrying: html-parse-0.0.0.3\nnext goal: hunit (dependency of html-parse-0.0.0.3)\nDependency tree exhaustively searched.\n&lt;&lt;&lt;&lt; Cabal errors end\n\nCould not parse cabal-install errors:\n\n&gt;&gt;&gt;&gt; Cabal errors begin\ncabal.exe: Could not resolve dependencies:\nnext goal: html-parse (user goal)\nrejecting: html-parse-0.2.0.0, 0.1.0.0 (global constraint requires ==0.0.0.3)\ntrying: html-parse-0.0.0.3\nnext goal: hunit (dependency of html-parse-0.0.0.3)\nDependency tree exhaustively searched.\n&lt;&lt;&lt;&lt; Cabal errors end\n</code></pre>\n\n<p>My app/package name in .cabal file is <code>html-parse</code> and the current version is 0.0.0.3. It looks like my own package is listed as a dependency with a constraint of <code>==0.0.0.3</code>, but there is another pacakge on hackage that has the same name but different versions. </p>\n\n<p>Can I somehow solve this issue without renaming my own app?</p>\n"}, {"tags": ["haskell", "composition", "monoids"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1481183512, "post_id": 41033743, "comment_id": 69275949, "body": "A morphism from <i>A</i>  to <i>A</i>  is called an <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Monoid.html#t:Endo\" rel=\"nofollow noreferrer\">endomorphism</a>. Your <code>Comp</code> monoid is  <code>Dual . Endo</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1481190298, "post_id": 41033743, "comment_id": 69279814, "body": "Polymorphic pipeline? I suspect there might be an X/Y problem here. How do you intend to use this?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1481226841, "post_id": 41033743, "comment_id": 69302945, "body": "Yes, as @leftaroundabout seems to hint, you only need this fancy machinery if you need to be able to take the list apart, as well as compose the functions in it. Otherwise, you should surely just deal with the composition and get rid of the list."}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1481311165, "post_id": 41033743, "comment_id": 69341910, "body": "@leftaroundabout This is a pattern I often find myself doing, in this particular case it was for an advent of code problem where I had a list of &#39;commands&#39; that I&#39;d parsed from input, I partially applied the functions which operate over the commands <code>(CMD -&gt; State -&gt; State)</code> so I had a list of <code>State -&gt; State</code>, then I wanted to feed in my initial <code>State</code> and get the result out the end.  Do you have suggestions on how I could do this better :)?"}, {"owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1481311207, "post_id": 41033743, "comment_id": 69341928, "body": "@Zeta That&#39;s exactly what I wanted to know! Thanks!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1481386702, "post_id": 41033743, "comment_id": 69361397, "body": "@ChrisPenner: there&#39;s no need to do that in two steps \u2013 why not just <code>foldl&#39;</code> over the list of commands?"}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1481182602, "post_id": 41034084, "comment_id": 69275521, "body": "Or, if you want to stay in the fuzzy realm of <code>Monoid</code>: <code>appEndo . foldMap Endo</code> and <code>(appEndo . getDual) . foldMap (Dual . Endo)</code>. By the way, I hope you don&#39;t mind the example."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1481192135, "post_id": 41034084, "comment_id": 69281117, "body": "I usually use <code>foldr (.) id</code> for this -- is there any reason to use <code>foldl</code> here?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1481200959, "post_id": 41034084, "comment_id": 69286760, "body": "@Zeta Isn&#39;t this again a place to use <code>stimesMonoid</code>?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1481201239, "post_id": 41034084, "comment_id": 69286925, "body": "@Alec: Sorry, &quot;again&quot;? We haven&#39;t had a discussion about <code>stimesMonoid</code>. And no."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1481214560, "post_id": 41034084, "comment_id": 69296144, "body": "@chi, Yep, <code>foldr (.) id</code> is the productive one: <code>foldr (.) id (const 7:repeat id) 9 == 7</code>"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1481271478, "last_edit_date": 1481271478, "creation_date": 1481182331, "answer_id": 41034084, "question_id": 41033743, "link": "https://stackoverflow.com/questions/41033743/piping-data-through-a-dynamic-list-of-functions/41034084#41034084", "title": "Piping data through a dynamic list of functions", "body": "<p>You're looking for one of</p>\n\n<pre><code>foldr (.) id        -- right-to-left\n</code></pre>\n\n<p>or</p>\n\n<pre><code>foldl (flip (.)) id -- left-to-right\n</code></pre>\n\n<p>depending on which order you want the functions composed:</p>\n\n<pre><code>ghci&gt; foldr (.) id [(+1),(*10)] 0\n1\nghci&gt; foldl (flip (.)) id [(+1),(*10)] 0\n10\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 3907685, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4a9d7cdfc525e689e6baefb7d2158fb0?s=128&d=identicon&r=PG", "display_name": "Chris Penner", "link": "https://stackoverflow.com/users/3907685/chris-penner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 41034084, "answer_count": 1, "score": 2, "last_activity_date": 1481271478, "creation_date": 1481180974, "question_id": 41033743, "link": "https://stackoverflow.com/questions/41033743/piping-data-through-a-dynamic-list-of-functions", "title": "Piping data through a dynamic list of functions", "body": "<p>So I often find myself designing 'pipeline' like flows of data,\nand oftentimes it ends up that the pipeline itself is dynamic.</p>\n\n<p>Is there an easy way to do something like this?</p>\n\n<pre><code>pipe :: [a -&gt; a] -&gt; a -&gt; a\n</code></pre>\n\n<p>Or is there a different pattern I should be reaching for with something like this? It's similar to the State monad, but I don't want to have to edit the functions to be <code>(a -&gt; (), a)</code> or whatever :/</p>\n\n<p>I realized that this is a monoid, so I wrote this, which seems like an elegant solution, does this exist in a library somewhere? It seems like most Arrow and Function Monoids do different things.</p>\n\n<pre><code>newtype Comp a = Comp { \n      runComp :: a -&gt; a \n}\n\ninstance Monoid (Comp a) where\n  (Comp a) `mappend` (Comp b) =  Comp (b . a)\n  mempty = Comp id\n\npipe :: [a -&gt; a] -&gt; a -&gt; a\npipe = runComp . foldMap Comp\n</code></pre>\n\n<p>Anyone have patterns that they use for this sort of thing? Thanks!</p>\n"}, {"tags": ["selenium", "haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1481181952, "post_id": 41032222, "comment_id": 69275199, "body": "A <code>Monad</code> isn&#39;t a type. Also, keep it simple. <code>createProcess&#39; and </code>runSession` both use <code>IO</code>, so stay in <code>IO</code>. <code>withBrowser :: IO a -&gt; IO a</code>."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1481198944, "post_id": 41032222, "comment_id": 69285508, "body": "Why not use a shell script?"}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1481243763, "post_id": 41049783, "comment_id": 69310013, "body": "Is that bracket_ to avoid the arg?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 1, "creation_date": 1481244052, "post_id": 41049783, "comment_id": 69310087, "body": "@Mittenchops Initially I thought that&#39;s what you&#39;d want too, but note that the cleanup action doesn&#39;t have an argument there either. So you wouldn&#39;t have  a way to transport the PID from the startup action to the cleanup one (without sticking it in an IORef or something)."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 1, "last_activity_date": 1481235280, "creation_date": 1481235280, "answer_id": 41049783, "question_id": 41032222, "link": "https://stackoverflow.com/questions/41032222/a-haskell-withsubprocess-construct-around-a-do-block/41049783#41049783", "title": "A haskell &quot;withSubprocess&quot; construct around a do block", "body": "<p>You basically just want <code>bracket</code> from <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception.html#v:bracket\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/base-4.9.0.0/docs/Control-Exception.html#v:bracket</a> .</p>\n\n<p>It allows you to specify setup and teardown IO actions to to run around a third action. It automatically handles feeding the output of the setup action into both the main and teardown actions, do your setup action should just give the PID as it's result, so the teardown action will be told what PID to kill.</p>\n\n<p>Something like:</p>\n\n<pre><code>withBrowser browserAction\n  = bracket startSelenium killSelenium (const browserAction)\n</code></pre>\n\n<p>(Where I've assumed you don't want the main action to have to take an argument for the pid, so I used <code>const</code> to ignore it)</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 41049783, "answer_count": 1, "score": 6, "last_activity_date": 1481235280, "creation_date": 1481174032, "question_id": 41032222, "link": "https://stackoverflow.com/questions/41032222/a-haskell-withsubprocess-construct-around-a-do-block", "title": "A haskell &quot;withSubprocess&quot; construct around a do block", "body": "<p>I'm working through the Haskell WebDriver selenium package for testing, <a href=\"https://github.com/kallisti-dev/hs-webdriver/blob/master/examples/readme-example-beginner.md\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>I have this example:</p>\n\n<pre><code>import Test.WebDriver\n\nfirefoxConfig :: WDConfig\nfirefoxConfig = defaultConfig\n\nmain :: IO ()\nmain = runSession firefoxConfig $ do                      \n  openPage \"http://google.com\"                            \n  searchInput &lt;- findElem ( ByCSS \"input[type='text']\" )  \n  sendKeys \"Hello, World!\" searchInput                    \n  submit searchInput                                      \n  closeSession                                            \n</code></pre>\n\n<p>The <a href=\"https://github.com/kallisti-dev/hs-webdriver#getting-started\" rel=\"nofollow noreferrer\">getting started section</a> makes clear that the selenium client requires a selenium server to communicate with</p>\n\n<pre><code>java -jar selenium-server-standalone-*.jar\n</code></pre>\n\n<p>Without it running, you get this:</p>\n\n<pre><code>ghci    \u03bb&gt; main\n*** Exception: FailedConnectionException2 \"127.0.0.1\" 4444 False connect: does not exist (Connection refused)\n</code></pre>\n\n<p>I'd like to wrap my whole test script in a function that initializes the selenium-server, records its pid, and kill(pid) after I run the session.  That is, for the duration of my existing main, I'd like to call the java selenium-server into existence, but I'd like it to stop existing as soon as the call finishes.</p>\n\n<p>In python I'd do this by something like defining a <code>__enter__()</code> and an <code>__exit__()</code> with other tear-down stuff, <code>subprocess.Popen</code>, record the id, kill it, then calling</p>\n\n<pre><code>with Browser() as b:\n  do_stuff\n</code></pre>\n\n<p>I get the sense the runSession entity is the kind of thing I would need to replicate to wrap startup and teardown like this in the sense that it takes the <code>firefoxConfig $ do</code> block as an argument and I want to do that, too.</p>\n\n<p>However, I can't quite understand the types from interrogating runSession, how to make this kind of thing:</p>\n\n<pre><code>ghci    \u03bb&gt; :t runSession\nrunSession\n  :: Test.WebDriver.Config.WebDriverConfig conf =&gt;\n     conf -&gt; WD a -&gt; IO a\n</code></pre>\n\n<p>I think I'd be looking for some kind of withMonad I could apply to this which is applied to the <code>do</code>. I think the syntax would be some kind of...</p>\n\n<pre><code>import Test.WebDriver\nimport System.Process\n\nfirefoxConfig :: WDConfig\nfirefoxConfig = defaultConfig\n\nwithBrowser :: Monad a -&gt; Monad a -- maybe this type?\nwithBrowser = do\n  r &lt;- createProcess (proc \"java -jar selenium-server-standalone-*.jar\" [])\n  -- other magic here?\n\nmain :: IO ()\nmain = withBrowser $ runSession firefoxConfig $ do                      \n  openPage \"http://google.com\"                            \n  searchInput &lt;- findElem ( ByCSS \"input[type='text']\" )  \n  sendKeys \"Hello, World!\" searchInput                    \n  submit searchInput                                      \n  closeSession                                            \n</code></pre>\n\n<p>How would I achieve this?  Is monad right at all?  Is there a more Haskell idiom or strategy for this?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": true, "score": 2, "last_activity_date": 1481189018, "creation_date": 1481189018, "answer_id": 41035840, "question_id": 41031207, "link": "https://stackoverflow.com/questions/41031207/generic-diff-of-objects-that-include-lists-with-gdiff/41035840#41035840", "title": "Generic diff of objects that include lists with gdiff", "body": "<p>There's no direct support for polymorphic lists in gdiff.</p>\n\n<p>For every type at which you use a list, you have to treat the list type and its constructors (<code>[]</code>, <code>(:)</code>) as parts of the family.</p>\n\n<p>Here are declarations that should work for your example:</p>\n\n<pre><code>data FooFamily :: * -&gt; * -&gt; * where\n  FooF       :: FooFamily Foo         (Cons [FooEnvVar] Nil)\n  FooEnvVarF :: FooFamily FooEnvVar   (Cons FooStr Nil)\n  FooStrF    :: FooFamily FooStr      (Cons String Nil)\n  NilF       :: FooFamily [FooEnvVar] Nil\n  ConsF      :: FooFamily [FooEnvVar] (Cons FooEnvVar (Cons [FooEnvVar] Nil))\n  String     :: String -&gt; FooFamily String Nil\n\ninstance Family FooFamily where\n  decEq FooF FooF = Just (Refl, Refl)\n  decEq FooEnvVarF FooEnvVarF = Just (Refl, Refl)\n  decEq FooStrF FooStrF = Just (Refl, Refl)\n  decEq NilF NilF = Just (Refl, Refl)\n  decEq ConsF ConsF = Just (Refl, Refl)\n  decEq (String x) (String y)\n    | x == y = Just (Refl, Refl)\n    | otherwise = Nothing\n  decEq _ _ = Nothing\n\n  fields FooF (Foo fe) = Just (CCons fe CNil)\n  fields FooEnvVarF (FooEnvVar ev) = Just (CCons ev CNil)\n  fields FooStrF (FooStr x) = Just (CCons x CNil)\n  fields NilF [] = Just CNil\n  fields ConsF (x : xs) = Just (CCons x (CCons xs CNil))\n  fields (String _) _ = Just CNil\n  fields _ _ = Nothing\n\n  apply FooF (CCons fe CNil) = Foo fe\n  apply FooEnvVarF (CCons ev CNil) = FooEnvVar ev\n  apply FooStrF (CCons x CNil) = FooStr x\n  apply NilF CNil = []\n  apply ConsF (CCons x (CCons xs CNil)) = x : xs\n  apply (String x) CNil = x\n\n  string FooF = \"FooF\"\n  string FooEnvVarF = \"FooEnvVarF\"\n  string FooStrF = \"FooStrF\"\n  string NilF = \"[]\"\n  string ConsF = \"(:)\"\n  string (String x) = show x\n\ninstance Type FooFamily Foo where\n  constructors = [Concr FooF]\n\ninstance Type FooFamily [FooEnvVar] where\n  constructors = [Concr NilF, Concr ConsF]\n\ninstance Type FooFamily FooEnvVar where\n  constructors = [Concr FooEnvVarF]\n\ninstance Type FooFamily FooStr where\n  constructors = [Concr FooStrF]\n\ninstance Type FooFamily String where\n  constructors = [Abstr String]\n</code></pre>\n"}], "owner": {"reputation": 70793, "user_id": 28128, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e974a514f0764fdfe99a8915f192002?s=128&d=identicon&r=PG", "display_name": "David Grayson", "link": "https://stackoverflow.com/users/28128/david-grayson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 41035840, "answer_count": 1, "score": 4, "last_activity_date": 1481189018, "creation_date": 1481167097, "last_edit_date": 1481167737, "question_id": 41031207, "link": "https://stackoverflow.com/questions/41031207/generic-diff-of-objects-that-include-lists-with-gdiff", "title": "Generic diff of objects that include lists with gdiff", "body": "<p>I am trying to use <strong><a href=\"https://hackage.haskell.org/package/gdiff\" rel=\"nofollow noreferrer\">gdiff</a></strong> 1.1, a generic diff library for Haskell, to get a difference between two objects that happen to contain a list.  However, I am not able to get it to work and I think it is because I don't know how to define the instance of <code>Type FooFamily</code> for <code>[FooEnvVar]</code>.  Here is the code I have so far:</p>\n\n<pre><code>module Main where\n\nimport Data.Generic.Diff\n\ndata Foo = Foo { fooEnv :: [FooEnvVar] }\n  deriving (Show, Eq)\n\ndata FooStr = FooStr String\n  deriving (Show, Eq, Ord)\n\ndata FooEnvVar = FooEnvVar { fooEnvName :: FooStr }\n  deriving (Show, Eq, Ord)\n\ndata FooFamily :: * -&gt; * -&gt; * where\n  FooF :: FooFamily Foo (Cons [FooEnvVar] Nil)\n  FooStrF :: FooFamily FooStr (Cons String Nil)\n\ninstance Family FooFamily where\n  decEq FooF FooF = Just (Refl, Refl)\n  decEq FooStrF FooStrF = Just (Refl, Refl)\n  decEq _ _ = Nothing\n  fields FooF (Foo fe) = Just (CCons fe CNil)\n  fields FooStrF (FooStr str) = Just (CCons str CNil)\n  apply FooF (CCons fe CNil) = Foo fe\n  apply FooStrF (CCons str CNil) = FooStr str\n  string FooF = \"FooF\"\n  string FooStrF = \"FooStrF\"\n\ninstance Type FooFamily Foo where\n  constructors = [Concr FooF]\n\ninstance Type FooFamily [FooEnvVar] where\n  constructors = []   -- what should I put here?\n\nmain :: IO ()\nmain =\n  putStrLn $ show ((diff a b) :: EditScript FooFamily Foo Foo)\n  where\n    a = Foo [FooEnvVar (FooStr \"hello\"), FooEnvVar (FooStr \"world\")]\n    b = Foo [FooEnvVar (FooStr \"hi\"), FooEnvVar (FooStr \"world\")]\n</code></pre>\n\n<p>This code compiles with no warnings under GHC 8.0.1 with the <code>-Wall</code> option.  When I run this code, I would want it to show the differences between <code>a</code> and <code>b</code>, but instead it shows this output:</p>\n\n<pre><code>test_gdiff: Incorrect Family or Type instance.\nCallStack (from HasCallStack):\n  error, called at src/Data/Generic/Diff.hs:313:22 in gdiff-1.1-KTbM5AUQcBxD5ewDUGZ4O3:Data.Generic.Diff\n</code></pre>\n\n<p>In case it matters, I am using the Haskell2010 language with these extensions: GADTs, LambdaCase, MultiParamTypeClasses, OverloadedStrings, FlexibleInstances.</p>\n\n<p>How can I fix this error?</p>\n"}, {"tags": ["function", "haskell", "duplicates"], "comments": [{"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1481179007, "post_id": 41030541, "comment_id": 69273705, "body": "<code>dup y = (&gt;&gt;= \\x -&gt; x : [x | x == y])</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "is_accepted": true, "score": 2, "last_activity_date": 1481163485, "last_edit_date": 1481163485, "creation_date": 1481162703, "answer_id": 41030601, "question_id": 41030541, "link": "https://stackoverflow.com/questions/41030541/i-need-to-write-a-haskell-function-which-duplicates-every-occurrence-of-a-charac/41030601#41030601", "title": "I need to write a haskell function which duplicates every occurrence of a character in a string, both given by the user.", "body": "<p>There are a few problems, so I'll go in order. First, syntax:</p>\n\n<ol>\n<li>You don't want the final <code>putStrLn x</code> do be on a different indentation level from the rest of the content of your <code>do</code> block.</li>\n<li>You don't want to surround <code>letter</code> and <code>sentence</code> by single-quotes in your function call.</li>\n</ol>\n\n<p>If we change these and try to compile, we get the following error:</p>\n\n<blockquote>\n  <p>\u2022 Couldn't match type \u2018[Char]\u2019 with \u2018Char\u2019\n        Expected type: Char\n          Actual type: String\n      \u2022 In the first argument of \u2018dup\u2019, namely \u2018letter\u2019\n        In the expression: dup letter sentence\n        In an equation for \u2018x\u2019: x = dup letter sentence</p>\n</blockquote>\n\n<p>The problem is that the type of <code>letter</code> is <code>String</code>, while we need it to be <code>Char</code>. One way to fix this would be to use the <code>getChar</code> function instead, which has type <code>IO Char</code> rather than <code>IO String</code>:</p>\n\n<pre><code>main = do\n  putStrLn \"Enter a sentence.\"\n  sentence &lt;- getLine\n  putStrLn \"Enter a single letter that is in your sentence, to duplicate.\"\n  letter &lt;- getChar\n  let x = dup letter sentence\n  putStrLn $ '\\n' : x\n</code></pre>\n\n<p>I've added the line break character <code>'\\n'</code> before the <code>x</code> so that output is printed on a new line.</p>\n\n<p>Usage:</p>\n\n<pre><code>ghci&gt;&gt; main\nEnter a sentence.\nhi\nEnter a single letter that is in your sentence, to duplicate.\nh\nhhi\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1481163225, "post_id": 41030612, "comment_id": 69268864, "body": "Is there any reason this would be preferred over <code>getChar</code>? Wouldn&#39;t it be better to fail if improper string input is given, rather than giving the appearance that the entire string is being processed?"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1481163478, "post_id": 41030612, "comment_id": 69268920, "body": "<code>getChar</code> doesn&#39;t consume a newline, which makes it not very friendly for users."}, {"owner": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 0, "creation_date": 1481163520, "post_id": 41030612, "comment_id": 69268931, "body": "Fair enough; I added the a newline explicitly in my answer. Is there a better way to do this?"}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 2, "creation_date": 1481163744, "post_id": 41030612, "comment_id": 69268980, "body": "To be clear: <b>consume</b> a newline.  This is different from emitting a newline.  When users type input into a command-line program, they typically expect that you can type an input, and then press enter when they are done typing it.  You can then do input validation later."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "reply_to_user": {"reputation": 2538, "user_id": 2608433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39f954ac48900859dea3fb1a061d71?s=128&d=identicon&r=PG", "display_name": "mnoronha", "link": "https://stackoverflow.com/users/2608433/mnoronha"}, "edited": false, "score": 2, "creation_date": 1481163793, "post_id": 41030612, "comment_id": 69268992, "body": "The reason you emit a newline is a quirk of the terminal, it only works that way because echo is enabled.  If your terminal is set not to echo, or if standard input and output are different streams, then you&#39;ll get an extra newline.  Not that those are reasonable things to expect here, though."}], "tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": false, "score": 3, "last_activity_date": 1481162795, "creation_date": 1481162795, "answer_id": 41030612, "question_id": 41030541, "link": "https://stackoverflow.com/questions/41030541/i-need-to-write-a-haskell-function-which-duplicates-every-occurrence-of-a-charac/41030612#41030612", "title": "I need to write a haskell function which duplicates every occurrence of a character in a string, both given by the user.", "body": "<p>So close.  Where <code>getLine</code> gives a <code>String</code>, or <code>[Char]</code>, you just want a <code>Char</code>.  You can do this:</p>\n\n<pre><code>main = do\n  putStrLn \"Enter a sentence.\"\n  sentence &lt;- getLine\n  putStrLn \"Enter a single letter that is in your sentence, to duplicate.\"\n  -- Get first character only\n  letter:_ &lt;- getLine\n  let x = dup letter sentence\n  putStrLn x\n</code></pre>\n\n<p>There are some caveats to this, since the pattern matching could fail, but it will work, and it is quite close to what you wrote.</p>\n"}], "owner": {"reputation": 45, "user_id": 5480378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/610de795e4db70ee8b4c438bd6e46f18?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler", "link": "https://stackoverflow.com/users/5480378/tyler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 41030601, "answer_count": 2, "score": 4, "last_activity_date": 1481163485, "creation_date": 1481162259, "question_id": 41030541, "link": "https://stackoverflow.com/questions/41030541/i-need-to-write-a-haskell-function-which-duplicates-every-occurrence-of-a-charac", "title": "I need to write a haskell function which duplicates every occurrence of a character in a string, both given by the user.", "body": "<p>So far, this is what I have. I know it has something to do with the function itself since I have Char -> String -> String, but I need it to be input from the user, so IO. I am not really sure how to do this. </p>\n\n<pre><code>dup :: Char -&gt; String -&gt; String\ndup c [] = []\ndup c (x:xs)\n  | c == x    =  x:x:dup c xs\n  | otherwise =  x:dup c xs\n\nmain = do\n  putStrLn \"Enter a sentence.\"\n  sentence &lt;- getLine\n  putStrLn \"Enter a single letter that is in your sentence, to duplicate.\"\n  letter &lt;- getLine\n  let x = dup 'letter''sentence'\n   putStrLn x\n</code></pre>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1481166722, "post_id": 41030290, "comment_id": 69269781, "body": "Please add the imports you are using to the code, so that we can run it more straightforwardly."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1481169199, "post_id": 41030290, "comment_id": 69270392, "body": "Isn&#39;t <code>toByteString</code> turning the whole stream of <code>Word8</code>s into a single strict bytestring? If so it seems like <code>ansiFilter</code> must never get finished."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1481169991, "post_id": 41030290, "comment_id": 69270600, "body": "For example if I just write <code>toByteString =  mapC BS.singleton</code> it is productive, though the interference of stdin and stdout is a little hard to follow."}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1481204226, "post_id": 41030290, "comment_id": 69288867, "body": "@duplode I edited my question to include the imports. Sorry about that."}], "answers": [{"tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": false, "score": 1, "last_activity_date": 1481210523, "creation_date": 1481210523, "answer_id": 41042881, "question_id": 41030290, "link": "https://stackoverflow.com/questions/41030290/filtering-ansi-escape-sequences-from-a-bytestring-with-conduit/41042881#41042881", "title": "Filtering ANSI escape sequences from a ByteString with Conduit", "body": "<p>Went with a slightly different approach and am having more luck leaving the ByteStrings alone. I think this gives up some of the streaming stuff, but is acceptable for my use-case.</p>\n\n<pre><code>ansiFilter :: Monad m =&gt; Conduit ByteString m ByteString\nansiFilter = mapC (go \"\")\n  where\n    csi = \"\\27[\"\n    go acc \"\" = acc\n    go acc remaining = go (acc &lt;&gt; filtered) (stripCode unfiltered)\n      where\n        (filtered, unfiltered) = BS.breakSubstring csi remaining\n        stripCode bs = BS.drop 1 (BS.dropWhile (not . Word8.isLetter) bs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1481271668, "creation_date": 1481271668, "answer_id": 41055988, "question_id": 41030290, "link": "https://stackoverflow.com/questions/41030290/filtering-ansi-escape-sequences-from-a-bytestring-with-conduit/41055988#41055988", "title": "Filtering ANSI escape sequences from a ByteString with Conduit", "body": "<p>I reimplemented <code>ansiFilter</code> in terms of the higher level chunked data functions in conduit-combinator, like <code>takeWhileCE</code>. This seems to work, and should be more efficient by letting more of the data remain in an efficient memory representation:</p>\n\n<pre><code>ansiFilter :: MonadIO m =&gt; ConduitM ByteString ByteString m ()\nansiFilter = loop\n  where\n    loop = do\n      takeWhileCE (/= 0x1b)\n      mfirst &lt;- headCE\n      case mfirst of\n        Nothing -&gt; return ()\n        Just first -&gt; assert (first == 0x1b) $ do\n          msecond &lt;- peekCE\n          case msecond of\n            Just 0x5b -&gt; do\n              dropWhileCE (not . Word8.isLetter)\n              dropCE 1\n            _ -&gt; yield $ BS.singleton first\n          loop\n</code></pre>\n"}], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 1, "accepted_answer_id": 41055988, "answer_count": 2, "score": 6, "last_activity_date": 1481271668, "creation_date": 1481160414, "last_edit_date": 1481204122, "question_id": 41030290, "link": "https://stackoverflow.com/questions/41030290/filtering-ansi-escape-sequences-from-a-bytestring-with-conduit", "title": "Filtering ANSI escape sequences from a ByteString with Conduit", "body": "<p>I'm trying to make a Conduit that filters ANSI escape codes from ByteStrings. I've come up with a function that converts the ByteString into a stream of Word8's, does the filtering, and converts back into a stream of ByteStream at the end.</p>\n\n<p>It seems to work fine when I use it in GHCi:</p>\n\n<pre><code>&gt; runConduit $ yield \"hello\\27[23;1m world\" .| ansiFilter .| printC\n\"hello world\"\n</code></pre>\n\n<p>When I use it in my application, conduits that contain <code>ansiFilter</code> don't seem to pass anything through. Here is the full source:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Conduit\nimport Control.Concurrent.Async\nimport Control.Concurrent.STM\nimport Data.ByteString (ByteString)\nimport qualified Data.ByteString as BS\nimport Data.Conduit.TQueue\nimport Data.Word8 (Word8)\nimport qualified Data.Word8 as Word8\n\nmain :: IO ()\nmain = do\n\n      queue &lt;- atomically $ newTBQueue 25\n      let qSource = sourceTBQueue queue\n      atomically $ writeTBQueue queue (\"hello\" :: ByteString)\n\n      race_\n        (putInputIntoQueue queue)\n        (doConversionAndPrint qSource)\n\nputInputIntoQueue q =\n  runConduit\n    $ stdinC\n    .| iterMC (atomically . writeTBQueue q)\n    .| sinkNull\n\ndoConversionAndPrint src =\n  runConduit\n    $ src\n    .| ansiFilter\n    .| stdoutC\n\nansiFilter :: MonadIO m =&gt; ConduitM ByteString ByteString m ()\nansiFilter = toWord8 .| ansiFilter' .| toByteString\n  where\n    ansiFilter' = awaitForever $ \\first -&gt; do\n      msecond &lt;- peekC\n      case (first, msecond) of\n        (0x1b, Just 0x5b) -&gt; do\n          dropWhileC (not . Word8.isLetter)\n          dropC 1\n        _ -&gt; yield first\n\n    toWord8 = concatC\n\n    toByteString :: Monad m =&gt; ConduitM Word8 ByteString m ()\n    toByteString =\n      (mapC BS.singleton .| foldC) &gt;&gt;= yield\n</code></pre>\n\n<p>This program is supposed to echo back the filtered contents of <code>stdin</code>, but nothing gets echoed back.</p>\n\n<p>However, if I comment out the <code>ansiFilter</code> in <code>doConversionAndPrint</code>, echoing does work which makes me thing the <code>ansiFilter</code> function is wrong.</p>\n\n<p>Any help would be greatly appreciated!</p>\n"}, {"tags": ["haskell", "process"], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 5, "last_activity_date": 1481166544, "creation_date": 1481166544, "answer_id": 41031114, "question_id": 41030168, "link": "https://stackoverflow.com/questions/41030168/haskell-using-the-handle-created-from-createprocess-and-createpipe-to-pipe-int/41031114#41031114", "title": "Haskell - Using the handle created from createProcess and CreatePipe to pipe into StdStream", "body": "<p><code>StdStream</code> has a <code>UseHandle</code> constructor that will perform the conversion, so adjust your code to read:</p>\n\n<pre><code>_ &lt;- createProcess (proc \"sort\" []) { std_in = UseHandle so }\n</code></pre>\n\n<p>and it'll run, printing a sorted directory listing.</p>\n\n<p>However, if you want \"foo\" to be printed after the processes complete, you need to wait on both processes first.  (You want to do this anyway, or you'll have a bunch of \"zombie\" processes hanging around until Haskell terminates.)  Adjust your code to read:</p>\n\n<pre><code>main = do                                                                         \n    (_, Just so, _, ph1)  &lt;- createProcess (proc \"ls\" [\".\"])\n                               { std_out = CreatePipe } \n    (_, _, _, ph2) &lt;- createProcess (proc \"sort\" []) { std_in = UseHandle so }\n    waitForProcess ph1\n    waitForProcess ph2\n    print \"foo\"\n</code></pre>\n\n<p>and you should be good to go</p>\n"}], "owner": {"reputation": 97, "user_id": 4119576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HYnsk.png?s=128&g=1", "display_name": "Wolfe", "link": "https://stackoverflow.com/users/4119576/wolfe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 0, "accepted_answer_id": 41031114, "answer_count": 1, "score": 3, "last_activity_date": 1481166544, "creation_date": 1481159719, "question_id": 41030168, "link": "https://stackoverflow.com/questions/41030168/haskell-using-the-handle-created-from-createprocess-and-createpipe-to-pipe-int", "title": "Haskell - Using the handle created from createProcess and CreatePipe to pipe into StdStream", "body": "<p>I currently have this code:</p>\n\n<pre><code>main :: IO ()                                                                       \nmain = do                                                                           \n    (_, Just so, _, _)  &lt;- createProcess (proc \"ls\" [\".\"]) { std_out = CreatePipe } \n    _ &lt;- createProcess (proc \"sort\" []) { std_in = so }                             \n    print \"foo\"     \n</code></pre>\n\n<p>The error I'm getting is:</p>\n\n<pre><code> Couldn't match expected type \u2018StdStream\u2019                 \n         with actual type \u2018GHC.IO.Handle.Types.Handle\u2019\n In the \u2018std_in\u2019 field of a record                        \n In the first argument of \u2018createProcess\u2019, namely         \n   \u2018(proc \"sort\" []) {std_in = so}\u2019                       \n In a stmt of a 'do' block:                               \n   _ &lt;- createProcess ((proc \"sort\" []) {std_in = so})    \n</code></pre>\n\n<p>I'm trying to pipe the output from the ls process into the sort process however the CreatePipe returns a Handle pair and std_in expects a StdStream.</p>\n\n<p>How would I go about converting the handle into a stdstream.</p>\n\n<p>Thanks!</p>\n"}]