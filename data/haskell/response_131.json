[{"tags": ["haskell", "integer-arithmetic"], "comments": [{"owner": {"reputation": 760, "user_id": 8009379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c808a3b5c059f2b448f39970d384fd33?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/8009379/alex"}, "edited": false, "score": 3, "creation_date": 1499897374, "post_id": 45067989, "comment_id": 77109886, "body": "I get a segmentation fault when I run this with the latest arithmoi version and GHCi version 8.0.1 on Mac OS 10.12.5, with the <code>:set +s</code> option. Without <code>:set +s</code> I get &quot;Bus error: 10&quot;. Seems like this <code>integerRoot</code> function makes memory act pretty strangely."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1499900617, "post_id": 45068686, "comment_id": 77110936, "body": "That is frustrating indeed. The whole reason I have these big <code>Integer</code>s lying around in the first place (and part of the reason I&#39;m using arithmoi) is because I&#39;m working really hard to avoid <code>Double</code>..."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499900829, "post_id": 45068686, "comment_id": 77110988, "body": "@DanielWagner: Yeah, I\u2019m trying to figure out why they\u2019re not just scaling by more than (h \u2212 1)k. Might have a fix in a little while."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499901948, "post_id": 45068686, "comment_id": 77111290, "body": "@DanielWagner: For example, <code>let !a@(I# a#) = 1024; h = 106; k = 787; n = (10^32)^k; !(I# s) = h * k - k in floor (scaleFloat 105 (fromInteger (n `shiftRInteger` (s +# a#)) ** (1&#47;fromIntegral k) * 2**(fromIntegral a&#47;k) :: Double))</code> results in a reasonable approximation, and you could just keep scaling <code>a</code> up as appropriate. Might be worth raising an issue for."}], "tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 23, "last_activity_date": 1499899486, "creation_date": 1499899486, "answer_id": 45068686, "question_id": 45067989, "link": "https://stackoverflow.com/questions/45067989/whats-special-about-787/45068686#45068686", "title": "What&#39;s special about 787?", "body": "<p>arithmoi <a href=\"https://github.com/cartazio/arithmoi/blob/1ef36280b2f4cfa8def4e2f0ba645c55c643e577/Math/NumberTheory/Powers/General.hs#L58\" rel=\"noreferrer\">implements <code>integerRoot</code></a> by getting an initial approximate root and refining its guess with Newton\u2019s method. For (10<sup>32</sup>)<sup>786</sup>, the second approximation gets a really good starting point:</p>\n\n<pre><code>&gt; appKthRoot 786 ((10^32)^786)\n100000000000000005366162204393472\n</code></pre>\n\n<p>For (10<sup>32</sup>)<sup>787</sup>, the second approximation gets a really bad starting point. Like, <em>really</em> bad.</p>\n\n<pre><code>&gt; appKthRoot 787 ((10^32)^787)   \n1797693134862315907729305190789024733617976978942306572734300811577326758055009\n6313270847732240753602112011387987139335765878976881441662249284743063947412437\n7767893424865485276302219601246094119453082952085005768838150682342462881473913\n110540827237163350510684586298239947245938479716304835356329624224137216\n</code></pre>\n\n<p>It actually gets this approximation for everything starting there.</p>\n\n<pre><code>&gt; length $ nub [appKthRoot x ((10^32)^x) | x &lt;- [787..1000]]\n1\n</code></pre>\n\n<p>Anyway, putting in <a href=\"https://github.com/cartazio/arithmoi/blob/1ef36280b2f4cfa8def4e2f0ba645c55c643e577/Math/NumberTheory/Powers/General.hs#L216\" rel=\"noreferrer\">the important parts of <code>appKthRoot</code></a>, we get:</p>\n\n<pre><code>&gt; let h = 106; k = 786; n = (10^32)^k; !(I# s) = h * k - k in floor (scaleFloat (h - 1) (fromInteger (n `shiftRInteger` s) ** (1/fromIntegral k) :: Double))\n100000000000000005366162204393472\n\n&gt; let h = 106; k = 787; n = (10^32)^k; !(I# s) = h * k - k in floor (scaleFloat (h - 1) (fromInteger (n `shiftRInteger` s) ** (1/fromIntegral k) :: Double))\n179769313486231590772930519078902473361797697894230657273430081157732675805500963132708477322407536021120113879871393357658789768814416622492847430639474124377767893424865485276302219601246094119453082952085005768838150682342462881473913110540827237163350510684586298239947245938479716304835356329624224137216\n</code></pre>\n\n<p>and taking a look at what\u2019s going into <code>scaleFloat</code>:</p>\n\n<pre><code>&gt; let h = 106; k = 786; n = (10^32)^k; !(I# s) = h * k - k in fromInteger (n `shiftRInteger` s) ** (1/fromIntegral k) :: Double\n2.465190328815662\n\n&gt; let h = 106; k = 787; n = (10^32)^k; !(I# s) = h * k - k in fromInteger (n `shiftRInteger` s) ** (1/fromIntegral k) :: Double\nInfinity\n</code></pre>\n\n<p>Yeah, that\u2019d do it. (10<sup>32</sup>)<sup>786</sup> \u00f7 2<sup>82530</sup> &approx; 2<sup>1023.1</sup> fits in a double, but (10<sup>32</sup>)<sup>787</sup> \u00f7 2<sup>82635</sup> &approx; 2<sup>1024.4</sup> does not.</p>\n"}], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 546, "favorite_count": 1, "accepted_answer_id": 45068686, "answer_count": 1, "score": 18, "last_activity_date": 1499899486, "creation_date": 1499895801, "last_edit_date": 1499896241, "question_id": 45067989, "link": "https://stackoverflow.com/questions/45067989/whats-special-about-787", "title": "What&#39;s special about 787?", "body": "<p>In ghci, using the <a href=\"http://hackage.haskell.org/package/arithmoi\" rel=\"noreferrer\">arithmoi</a> package:</p>\n\n<pre><code>Math.NumberTheory.Powers.General&gt; :set +s\nMath.NumberTheory.Powers.General&gt; integerRoot 786 ((10^32)^786)\n100000000000000000000000000000000\n(0.04 secs, 227,064 bytes)\nMath.NumberTheory.Powers.General&gt; integerRoot 787 ((10^32)^787)\n</code></pre>\n\n<p>After five minutes, it still hasn't responded. Why is it taking so long?</p>\n\n<p>(From some ad-hoc testing, it appears to be slow for all choices larger than 787 and fast for all choices smaller.)</p>\n"}, {"tags": ["regex", "haskell", "unicode"], "comments": [{"owner": {"reputation": 1336, "user_id": 794944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b885541101d504bbd39901d5d7fc1766?s=128&d=identicon&r=PG", "display_name": "Jack Henahan", "link": "https://stackoverflow.com/users/794944/jack-henahan"}, "edited": false, "score": 0, "creation_date": 1500063838, "post_id": 45067622, "comment_id": 77193777, "body": "What libraries are you using? Your G&#246;teborg regexes give me <code>ReturnCode 17,&quot;illegal byte sequence&quot;</code> when I attempt them. In any case, the <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html#tag_09\" rel=\"nofollow noreferrer\">POSIX regex spec</a> says &quot;Matching [is] based on the bit pattern used for encoding the character.... [I]f a character set contains two or more encodings for a graphic symbol... no attempt is made to search for any other representation of the encoded symbol. If that is required... specify equivalence classes containing all variations of the... symbol.&quot; Maybe that&#39;s it?"}, {"owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "reply_to_user": {"reputation": 1336, "user_id": 794944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b885541101d504bbd39901d5d7fc1766?s=128&d=identicon&r=PG", "display_name": "Jack Henahan", "link": "https://stackoverflow.com/users/794944/jack-henahan"}, "edited": false, "score": 0, "creation_date": 1500066550, "post_id": 45067622, "comment_id": 77195010, "body": "I used the <code>regex-compat</code> library, which conatins the <code>subRegex</code> function. I have swedish keyboard settings on my ubuntu. You can see that Haskell has recognised it as unicode point 246, correctly. I would not expect character classes to be the problem, since the negated char class pattern didnt work either."}], "answers": [{"tags": [], "owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "is_accepted": true, "score": 2, "last_activity_date": 1499940292, "creation_date": 1499940292, "answer_id": 45077474, "question_id": 45067622, "link": "https://stackoverflow.com/questions/45067622/how-to-find-and-replace-unicode-chars-in-haskell/45077474#45077474", "title": "How to find and replace unicode chars in Haskell?", "body": "<p>I've now decided to go with Text.Regex.PCRE.Heavy as suggested in this <a href=\"https://stackoverflow.com/questions/3847475/haskell-regex-substitution/33253831#33253831\">SO Answer</a> written by the author. It solves my problem.</p>\n\n<p>Thus, the solution becomes </p>\n\n<pre><code>GHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nPrelude&gt; :m Text.Regex.PCRE.Heavy\nPrelude Text.Regex.PCRE.Heavy&gt; :set -XFlexibleContexts\nPrelude Text.Regex.PCRE.Heavy&gt; :set -XQuasiQuotes\nPrelude Text.Regex.PCRE.Heavy&gt; gsub [re|\\[\\[([^\\]]*)\\]\\]|] (\\(firstMatch:_) -&gt; firstMatch :: String) \"[[G\u00f6teborg]]\" :: String\n\"G\\246teborg\"\n</code></pre>\n\n<p>Unfortunately I still don't know why the POSIX backend cannot handle this, but the PCRE backend can.</p>\n"}, {"tags": [], "owner": {"reputation": 2824, "user_id": 187223, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9ab705e8ee51d24c8e52192f7fde8d76?s=128&d=identicon&r=PG", "display_name": "James Brock", "link": "https://stackoverflow.com/users/187223/james-brock"}, "is_accepted": false, "score": 0, "last_activity_date": 1589087247, "creation_date": 1589087247, "answer_id": 61707436, "question_id": 45067622, "link": "https://stackoverflow.com/questions/45067622/how-to-find-and-replace-unicode-chars-in-haskell/61707436#61707436", "title": "How to find and replace unicode chars in Haskell?", "body": "<p>To find and replace unicode characters in Haskell we can use the <a href=\"https://hackage.haskell.org/package/replace-megaparsec/docs/Replace-Megaparsec.html#v:streamEdit\" rel=\"nofollow noreferrer\"><code>streamEdit</code></a> function, with <a href=\"http://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">Megaparsec</a> parsers for the pattern matching (instead of regex). The Megaparsec <a href=\"http://hackage.haskell.org/package/megaparsec/docs/Text-Megaparsec-Char.html#v:letterChar\" rel=\"nofollow noreferrer\"><code>letterChar</code></a> parser will match all Swedish letters.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>:set -XOverloadedStrings\nimport Text.Megaparsec\nimport Text.Megaparsec.Char\nimport Replace.Megaparsec\nimport Data.Text as T\nimport Data.Text.IO as T\nimport Data.Void\n\nlet wikilink :: Parsec Void T.Text [Char]\n    wikilink = do\n        _ &lt;- chunk \"[[\"\n        fst &lt;$&gt; manyTill_ letterChar (chunk \"]]\")\n\nT.putStr $ streamEdit wikilink T.pack \"Se mer om [[Stockholm]]\"\nT.putStr $ streamEdit wikilink T.pack \"Se mer om [[G\u00f6teborg]]\"\n</code></pre>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Se mer om Stockholm\nSe mer om G\u00f6teborg\n</code></pre>\n"}], "owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 0, "accepted_answer_id": 45077474, "answer_count": 2, "score": 5, "last_activity_date": 1589087247, "creation_date": 1499894033, "last_edit_date": 1499895782, "question_id": 45067622, "link": "https://stackoverflow.com/questions/45067622/how-to-find-and-replace-unicode-chars-in-haskell", "title": "How to find and replace unicode chars in Haskell?", "body": "<p>I have a unicode file containing a (Swedish) wikipedia article in MediaText markup. I want to clean it from all markup. In certain cases I want to extract text from the markup tags, such as the link titles from hyperlinks (like a simplified <a href=\"https://github.com/attardi/wikiextractor\" rel=\"nofollow noreferrer\">wikiextractor</a>).</p>\n\n<p>My approach is to run a set of regex'es over the file to remove markup. In the link-example, I need to replace <code>[[link]]</code> with <code>link</code>. I manage to fix this well with a regex as long as the text does not contain unicode chars such as <code>\u00f6</code>.</p>\n\n<p>Example of what I've tried:</p>\n\n<pre><code>ghci&gt; :m +Data.Text\nghci&gt; subRegex (mkRegex \"\\\\[\\\\[([() a-zA-Z]*)\\\\]\\\\]\") \"Se mer om [[Stockholm]]\" \"\\\\1\"\n\"Se mer om Stockholm\"\nghci&gt; subRegex (mkRegex \"\\\\[\\\\[([() a-zA-Z]*)\\\\]\\\\]\") \"Se mer om [[G\u00f6teborg]]\" \"\\\\1\"\n\"Se mer om [[G\\246teborg]]\"\n</code></pre>\n\n<p>Why does this not work? How can I make the regex engine realize that <code>\u00f6</code> is indeed a normal letter (at least in Swedish)?</p>\n\n<p><strong>Edit:</strong>\nThe issue seems to not really sit in the pattern, but in the engine. If i allow all characters except <code>q</code> in the link text, one could expect <code>\u00f6</code> to be allowed. But not so...</p>\n\n<pre><code>ghci&gt; subRegex (mkRegex \"\\\\[\\\\[([^q]*)\\\\]\\\\]\") \"[[Goteborg]]\" \"\\\\1\"\n\"Goteborg\"\nghci&gt; subRegex (mkRegex \"\\\\[\\\\[([^q]*)\\\\]\\\\]\") \"[[G\u00f6teborg]]\" \"\\\\1\"\n\"[[G\\246teborg]]\"\nghci&gt; subRegex (mkRegex \"\u00f6\") \"\u00f6\" \"q\"\n\"q\"\nghci&gt; subRegex (mkRegex \"[\u00f6]\") \"\u00f6\" \"q\"\n\"\\246\"\n</code></pre>\n\n<p>The problem seems to arise specifically when using character classes. It matches <code>\u00f6</code>fine on its own.</p>\n"}, {"tags": ["haskell", "functional-dependencies"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1499891668, "post_id": 45066627, "comment_id": 77107354, "body": "I guess functional dependencies do not introduce <code>c1 ~ c2</code> constraints -- arguably, they should. I&#39;d consider switching to type families instead of fundeps."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1500134706, "post_id": 45066627, "comment_id": 77211122, "body": "&quot;How can I persuade the compiler to understand that the two c bindings are required to be the same type by the functional dependency?&quot; - with <code>unsafeCoerce</code>. (You could also use associated types instead of fundeps.) I think I answered a question about this a while ago, but I can&#39;t find it now. But basically, the fact you hope to state isn&#39;t true; if it were, two different modules could have two different instances for the same type, e.g. <code>Classifiable Int Bool</code> and <code>Classifiable Int String</code>, and a third module importing both modules would be able to prove <code>Bool ~ String</code>."}], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 129, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1499889959, "creation_date": 1499889959, "question_id": 45066627, "link": "https://stackoverflow.com/questions/45066627/how-to-ensure-functional-dependencies-are-used-to-unify-dependent-existential-ty", "title": "How to ensure functional dependencies are used to unify dependent existential type variables", "body": "<p>I have a typeclass that introduces a functional dependency between two types:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies, FlexibleInstances #-}\n{-# LANGUAGE GADTs, StandaloneDeriving, UndecidableInstances #-}\n\nclass Eq c =&gt; Classifiable t c | t -&gt; c where \n    classification :: t -&gt; c\n</code></pre>\n\n<p>I have a number of instances of this class, e.g. for pairs, we use that the \"classification\" of the pair is the value stored in the first position:</p>\n\n<pre><code>instance Eq a =&gt; Classifiable (a,b) a where\n    classification = fst\n</code></pre>\n\n<p>I also have a type that uses this class to allow it to store an instance of type <code>c</code> when configured with type <code>t</code> in its arguemnts, i.e. <code>c</code> is existentially qualified, but it is constrained by the functional dependency to have exactly one actual possible type that is determined uniquely by one of the visible arguments, in this case <code>t</code>:</p>\n\n<pre><code>data Symbol t nt s where\n    Terminal ::    (Classifiable t c, Show c, Ord c) =&gt;\n                   c                         -&gt; Symbol t nt s\n    NonTerminal :: Classifiable t c =&gt;\n                   nt -&gt; [Production t nt s] -&gt; Symbol t nt s\n</code></pre>\n\n<p>My problem is that when I try to use this, GHC is apparently unaware that for any pair of <code>Symbol</code>s with given arguments, the type <code>c</code> must be the same if <code>t</code> is.  Hence, if I try to create an instance of <code>Ord</code> for this type:</p>\n\n<pre><code>deriving instance (Ord c, Ord nt, Classifiable t c) =&gt;   Ord (Symbol t nt s)\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>Could not deduce (Eq (Symbol t nt s))\n  arising from the superclasses of an instance declaration\nfrom the context (Ord c, Ord nt, Classifiable t c)\n  bound by the instance declaration\n  at src\\Text\\Parser\\ALLStar.hs:16:1-76\nIn the instance declaration for `Ord (Symbol t nt s)'\nC:\\development\\haskell\\delta-parser-git\\delta-parser\\src\\Text\\Parser\\ALLStar.hs: 16, 1\nCouldn't match expected type `c1' with actual type `c2'\n  `c2' is a rigid type variable bound by\n       a pattern with constructor\n         Terminal :: forall t nt s c.\n                     (Classifiable t c, Show c, Ord c) =&gt;\n                     c -&gt; Symbol t nt s,\n       in a case alternative\n       at src\\Text\\Parser\\ALLStar.hs:16:1\n  `c1' is a rigid type variable bound by\n       a pattern with constructor\n         Terminal :: forall t nt s c.\n                     (Classifiable t c, Show c, Ord c) =&gt;\n                     c -&gt; Symbol t nt s,\n       in a case alternative\n       at src\\Text\\Parser\\ALLStar.hs:16:1\nRelevant bindings include\n  b1 :: c2 (bound at src\\Text\\Parser\\ALLStar.hs:16:1)\n  a1 :: c1 (bound at src\\Text\\Parser\\ALLStar.hs:16:1)\nIn the second argument of `compare', namely `b1'\nIn the expression: (a1 `compare` b1)\nWhen typechecking the code for  `compare'\n  in a derived instance for `Ord (Symbol t nt s)':\n  To see the code I am typechecking, use -ddump-deriv\n</code></pre>\n\n<p>How can I persuade the compiler to understand that the two <code>c</code> bindings are required to be the same type by the functional dependency?</p>\n"}, {"tags": ["haskell", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1499884821, "post_id": 45065275, "comment_id": 77103847, "body": "I just tried that: you need an additional space <code>&#39;[ &#39;(...</code>, otherwise the parser parses a character literal ... :) -- I felt free to edit accordingly."}, {"owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "edited": false, "score": 0, "creation_date": 1499886385, "post_id": 45065275, "comment_id": 77104719, "body": "Oh this i tricky: I assumed GHC would be clever enough to know, that in a type-level list &#39;[] there cannot be value pairs but only type-level pairs..."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 4, "last_activity_date": 1499884840, "last_edit_date": 1499884840, "creation_date": 1499884698, "answer_id": 45065275, "question_id": 45065074, "link": "https://stackoverflow.com/questions/45065074/how-to-create-a-type-level-list-with-symbols-to-test-a-type-family/45065275#45065275", "title": "How to create a type level list with symbols to test a type family", "body": "<p><code>(k1, k2)</code> is the type of pairs of elements of type/kind <code>k1</code> and <code>k2</code>, and <code>'(a, b)</code> is a type-level pair (note the <code>'</code>).</p>\n\n<pre><code>'(a, b) :: (k1, k2)   with a :: k1 and b :: k2\n</code></pre>\n\n<p>Fix:</p>\n\n<pre><code>Lookup \"bar\" '[ '(\"foo\", Int), '(\"bar\", String)]\n</code></pre>\n"}], "owner": {"reputation": 1496, "user_id": 7350814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bd7e1bdad619c54ab51e05ff9cfaa199?s=128&d=identicon&r=PG&f=1", "display_name": "Jogger", "link": "https://stackoverflow.com/users/7350814/jogger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 1, "accepted_answer_id": 45065275, "answer_count": 1, "score": 2, "last_activity_date": 1499884840, "creation_date": 1499883944, "question_id": 45065074, "link": "https://stackoverflow.com/questions/45065074/how-to-create-a-type-level-list-with-symbols-to-test-a-type-family", "title": "How to create a type level list with symbols to test a type family", "body": "<p>I try to learn about Haskell type level programming. I wrote a little function to lookup a key, a Symbol, in a type level list:</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport GHC.TypeLits\n\ntype family Lookup (x :: k) (l :: [(k,v)]) :: k where\n    Lookup k  ('(k,a) ': ls) = a\n    Lookup k  ('(x,a) ': ls) = Lookup k ls\n    Lookup k '[]             = TypeError (Text \"Key not found: \") \n</code></pre>\n\n<p>GHC (8.0.1) compiles this function without errors and \nnow I need to test the function in GHCi. In GHCi I set the options:</p>\n\n<pre><code>:set -XDataKinds\n:set -XTypeOperators\n</code></pre>\n\n<p>and try to run a first test example:</p>\n\n<pre><code>:kind! Lookup \"bar\" '[(\"foo\", Int), (\"bar\", String)]\n</code></pre>\n\n<p>The Strings \"bar\" and \"foo\" should be Type-level Strings aka <code>Symbols</code>.</p>\n\n<p>GHC rejects my little test case with:</p>\n\n<pre><code>&lt;interactive&gt;:1:14: error:\n    \u2022 Expected kind \u2018[(Symbol, v0)]\u2019,\n        but \u2018'[(\"foo\", Int), (\"bar\", String)]\u2019 has kind \u2018[*]\u2019\n    \u2022 In the second argument of \u2018Lookup\u2019, namely\n        \u2018'[(\"foo\", Int), (\"bar\", String)]\u2019\n      In the type \u2018Lookup \"bar\" '[(\"foo\", Int), (\"bar\", String)]\u2019\n</code></pre>\n\n<p>The question is how to change the test example, so GHC will accept it.</p>\n\n<p>Note: My type level function <code>Lookup</code> is in its first version, it may be wrong, maybe I should use <code>CmpSymbol</code> or do other changes. However this is <strong>not</strong> the topic of this SO question.</p>\n"}, {"tags": ["sql", "haskell", "yesod", "esqueleto"], "answers": [{"tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": false, "score": 0, "last_activity_date": 1499865898, "last_edit_date": 1499865898, "creation_date": 1499865423, "answer_id": 45058781, "question_id": 45057213, "link": "https://stackoverflow.com/questions/45057213/esqueleto-join-on-subquery-using-sublist-select/45058781#45058781", "title": "Esqueleto: join on subquery (using subList_select)", "body": "<p>I guess I can use the following which should be semantically identical (inspired by <a href=\"https://stackoverflow.com/a/123481/214446\">this answer</a>):</p>\n\n<pre><code>$ select\n$ from $ \\( s `LeftOuterJoin` ms ) -&gt; do\n        on ( just (s ^. ScenarioAuthorId)  ==. ms ?. ScenarioAuthorId &amp;&amp;.\n             just (s ^. ScenarioTaskId)    ==. ms ?. ScenarioTaskId   &amp;&amp;.\n             just (s ^. ScenarioLastUpdate) &lt;. ms ?. ScenarioLastUpdate )\n  where_ (isNothing (ms ?. ScenarioId))\n</code></pre>\n\n<p>Still baffles me that Esqueleto apparently supports sub-queries with multiple results only in combination with <code>in_</code>...</p>\n"}], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 318, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1499930582, "creation_date": 1499861034, "last_edit_date": 1499930582, "question_id": 45057213, "link": "https://stackoverflow.com/questions/45057213/esqueleto-join-on-subquery-using-sublist-select", "title": "Esqueleto: join on subquery (using subList_select)", "body": "<p>I'm trying to translate the following SQL to Esqueleto:</p>\n\n<pre><code>SELECT id, task_id, author_id\nFROM scenario\nINNER JOIN ( SELECT task_id as tId, author_id as aId, MAX(last_update) as lastUp\n             FROM scenario\n             GROUP BY task_id, author_id\n           ) t\n      ON task_id = tId AND author_id = aId AND last_update = lastUp\n</code></pre>\n\n<p>To do a sub-query, you have to use <a href=\"https://www.stackage.org/haddock/lts-8.22/esqueleto-2.5.3/Database-Esqueleto.html#v:subList_select\" rel=\"nofollow noreferrer\">subList_select</a>.</p>\n\n<p>I couldn't figure out a way to combine it with the pattern matching in:</p>\n\n<pre><code>from $ \\(s `InnerJoin` ?subQueryhere?) -&gt; do ...\n</code></pre>\n\n<p>So I tried with <code>where_</code> instead:</p>\n\n<pre><code>where_ (s ^. ScenarioTaskId ==. (subList_select $\n         from $ \\s' -&gt; do\n         groupBy (s' ^. ScenarioTaskId, s' ^. ScenarioAuthorId)\n         return s'\n       ) ^. ScenarioTaskId)\n</code></pre>\n\n<p>However, this doesn't compile since <code>subList_select</code> returns a <code>expr (ValueList a)</code> instead of a <code>expr (Entity Scenario)</code>.</p>\n"}, {"tags": ["haskell", "newtons-method"], "comments": [{"owner": {"reputation": 277, "user_id": 6063947, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/cba0e3566e2aaa7a3b475d46728b6c56?s=128&d=identicon&r=PG", "display_name": "iamwhoiam", "link": "https://stackoverflow.com/users/6063947/iamwhoiam"}, "edited": false, "score": 0, "creation_date": 1499861067, "post_id": 45056955, "comment_id": 77087446, "body": "I haven&#39;t gone through all the code, but <code>pow a b</code> is likely to throw that exception when <code>b &lt; 0</code>"}, {"owner": {"reputation": 670, "user_id": 7781818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f5392f913a0f47fab3e6719bda4b08?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/7781818/chris"}, "edited": false, "score": 0, "creation_date": 1499861345, "post_id": 45056955, "comment_id": 77087681, "body": "<code>pow a b</code> will absolutely end up in an infinite recursion if it is ever called with <code>b &lt; 0</code>... you could try to catch this case and just give the answer you can interpret to check if this is what is going on..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1499861387, "post_id": 45056955, "comment_id": 77087724, "body": "Why would you implement <code>pow</code> yourself in the first place, anyway? Use <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:-94-\" rel=\"nofollow noreferrer\"><code>^</code></a> which does the exact same thing (just faster, for large-ish exponents) if <code>n</code> is positive, and doesn&#39;t diverge when it&#39;s negative."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 3, "creation_date": 1499866782, "post_id": 45056955, "comment_id": 77092015, "body": "Also show <i>how</i> you&#39;ve encountered that problem. There is no example."}, {"owner": {"reputation": 29, "user_id": 3775499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e4ae453ffda1099b6694aa046aa17a5?s=128&d=identicon&r=PG&f=1", "display_name": "MaMa", "link": "https://stackoverflow.com/users/3775499/mama"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499868769, "post_id": 45056955, "comment_id": 77093556, "body": "@leftaroundabout: changing pow to ^ says &quot;No instance for (Integral Float) arising from a use of ^&quot;"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499869124, "post_id": 45056955, "comment_id": 77093845, "body": "No, you really shouldn&#39;t need all those type conversions; in particular, rounding  the argument to <code>eval</code> is clearly wrong for this application. Declare <code>Monom</code> as <code>Monom Float Int</code>, then you can simply do <code>evalMonom (Monom a e) x = a * x^e</code>."}, {"owner": {"reputation": 29, "user_id": 3775499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e4ae453ffda1099b6694aa046aa17a5?s=128&d=identicon&r=PG&f=1", "display_name": "MaMa", "link": "https://stackoverflow.com/users/3775499/mama"}, "edited": false, "score": 0, "creation_date": 1499871952, "post_id": 45056955, "comment_id": 77096066, "body": "Thanks for your help! Problem has been solved by replacing the pow function with ^ =)"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1499881585, "post_id": 45056955, "comment_id": 77102002, "body": "Next time you should also tell how you&#39;re running / compiling: using ghci or compiling with ghc using optimizations?"}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1499931105, "post_id": 45056955, "comment_id": 77120797, "body": "Please take your time to read <a href=\"https://stackoverflow.com/help/how-to-ask\">How to ask</a>"}], "owner": {"reputation": 29, "user_id": 3775499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e4ae453ffda1099b6694aa046aa17a5?s=128&d=identicon&r=PG&f=1", "display_name": "MaMa", "link": "https://stackoverflow.com/users/3775499/mama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 376, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1499860312, "creation_date": 1499860312, "question_id": 45056955, "link": "https://stackoverflow.com/questions/45056955/haskell-newton-method", "title": "Haskell newton method", "body": "<p>i'm trying to implement newtons method in haskell, but i'm ending every time in a \"Stackoverflow\" Exception.. I spent a lot of time and got no solution .. -.-</p>\n\n<pre><code>data Term = Monom(Integer, Integer)\n            | Add(Term, Term)\n            | Mul(Term, Term)\n            | Div(Term, Term);\n\niterate :: (a -&gt; a) -&gt; a -&gt; [a]\niterate f a0 = a0 : (Main.iterate f (f(a0)))\n\nstop1 :: Float -&gt; [Float] -&gt; Float\nstop1 eps (a1 : (a2:as))\n  | abs(a1-a2) &lt; eps = a2\n  | otherwise = stop1 eps (a2:as)\n\nstep1 :: Term -&gt; Float -&gt; Float\n--step1 f f' a = a - (f a) / (f' a)\nstep1 f a = a - (eval f a) / (eval (diff f) a)\n\n--newton :: (Float -&gt; Float) -&gt; (Float -&gt; Float) -&gt; Float -&gt; Float -&gt; Float\nnewton :: Term -&gt; Float -&gt; Float -&gt; Float\nnewton f a0 eps = stop1 eps (Main.iterate (step1 f) a0)\n\nquadrieren (Monom(a,b)) = Monom(a*a, b*b)\n\ndiff :: Term -&gt; Term\ndiff (Monom(a,b)) = if b&gt;0 then Monom(a*b, b-1) else Monom(0,0)                \ndiff (Add(x,y)) = Add(diff(x), diff(y))                                        \ndiff (Mul(x,y)) = Add(Mul(diff(x), y), Mul(diff(y), x))                        \ndiff (Div(x,y)) = Div(Add(Mul(diff(x), y), Mul(diff(y), x)), quadrieren(y)) \n\neval :: Term -&gt; Float -&gt; Float\neval (Monom(a,b)) f = (evalMonom (Monom(a,b)) f)\neval (Add(Monom(a,b), Monom(c,d))) f = (evalMonom (Monom(a,b)) f) + (evalMonom (Monom(c,d)) f)\neval (Mul(Monom(a,b), Monom(c,d))) f = (evalMonom (Monom(a,b)) f) * (evalMonom (Monom(c,d)) f)\neval (Div(Monom(a,b), Monom(c,d))) f = (evalMonom (Monom(a,b)) f) / (evalMonom (Monom(c,d)) f)\n\nevalMonom :: Term -&gt; Float -&gt; Float\nevalMonom (Monom(a,b)) x = fromInteger(a) * fromInteger(pow (toInt(x)) b)\n\npow :: Integer -&gt; Integer -&gt; Integer \npow x 0 = 1\npow x n = x * pow x (n-1)\n\ntoInt :: Float -&gt; Integer\ntoInt x = round x\n</code></pre>\n\n<p>I assume that the problem could be in the pow function, but i'm not sure.. \nThanks in advance for every help!</p>\n"}, {"tags": ["multithreading", "haskell", "concurrency", "parallel-processing"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499843103, "post_id": 45050415, "comment_id": 77074781, "body": "The book actually elaborates on that quite a bit, have read all of it yet?"}, {"owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499843761, "post_id": 45050415, "comment_id": 77075183, "body": "Not yet, I&#39;ll keep reading."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 3, "creation_date": 1499848702, "post_id": 45050758, "comment_id": 77078556, "body": "GHC&#39;s threads are much cheaper than OS threads, but they still use some memory (1KB?) and there&#39;s a little scheduling overhead."}, {"owner": {"reputation": 126499, "user_id": 1531124, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zw18i.png?s=128&g=1", "display_name": "GhostCat", "link": "https://stackoverflow.com/users/1531124/ghostcat"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1499849221, "post_id": 45050758, "comment_id": 77078855, "body": "So on the downside that raises the question if those threads can make us of the underlying hardware then."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 3, "creation_date": 1499854250, "post_id": 45050758, "comment_id": 77082626, "body": "@GhostCat GHC multiplexes multiple lightweight green threads over a smaller number of real OS threads. (Number of OS threads defaults to the number of CPU cores.)"}], "tags": [], "owner": {"reputation": 126499, "user_id": 1531124, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/zw18i.png?s=128&g=1", "display_name": "GhostCat", "link": "https://stackoverflow.com/users/1531124/ghostcat"}, "is_accepted": false, "score": 1, "last_activity_date": 1499843417, "creation_date": 1499843417, "answer_id": 45050758, "question_id": 45050415, "link": "https://stackoverflow.com/questions/45050415/what-is-overhead-in-term-of-parallel-and-concurrent-programming-haskell/45050758#45050758", "title": "What is overhead in term of parallel and concurrent programming (Haskell)?", "body": "<p>You have to understand that <em>threads</em> are <strong>resources</strong>. They do not come for free. In other words: when you create a thread (independent of the language) then you have to make system calls, the OS has to create a thread instance, and so on. Threads have state - which changes over time; so some kind of thread management happens in the background.</p>\n\n<p>And of course, when you end up with <strong>more</strong> threads than the underlying hardware can support - then the system will have to switch threads from time to time. Of course, that is not as expensive as switching full blown processes, but it still means that registers need to be saved (or restored), your hardware caches might be affected, and so on.</p>\n"}, {"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 4, "last_activity_date": 1499854059, "creation_date": 1499854059, "answer_id": 45054666, "question_id": 45050415, "link": "https://stackoverflow.com/questions/45050415/what-is-overhead-in-term-of-parallel-and-concurrent-programming-haskell/45054666#45054666", "title": "What is overhead in term of parallel and concurrent programming (Haskell)?", "body": "<p>In any system, a thread takes resources. You have to store the state of that thread somewhere. It takes time to create the thread and set it running. Now GHC uses lightweight \"green threads\", which are much less expensive than OS threads. But they still cost <em>something</em>.</p>\n\n<p>If you were to (for example) spawn a new thread for every single add, subtract, multiply and divide... well, the work to spawn a new thread has to be at least several dozen machine instructions, whereas a trivial arithmetic operation is probably a single instruction. Queuing the work as sparks takes even less work than spawning a whole new thread, but even that isn't as cheap as just doing the operation on the current thread.</p>\n\n<p>Basically the cost of the work you want to do in parallel has to exceed the cost of arranging to do it in parallel. (Whether that's launching an OS thread or a green thread or queuing a spark or whatever.) GHC has all sorts of stuff to lower the cost, but it's still not <em>free</em>.</p>\n"}], "owner": {"reputation": 827, "user_id": 1276388, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4ae985df9e533570f5ac2ea9bfc25dfd?s=128&d=identicon&r=PG", "display_name": "\u0397\u03bb\u03b5\u03ba\u03c4\u03c1\u03bf\u03bb\u03cc\u03b3\u03bf\u03c2 \u039c\u03b7\u03c7\u03b1\u03bd\u03b9\u03ba\u03cc\u03c2", "link": "https://stackoverflow.com/users/1276388/%ce%97%ce%bb%ce%b5%ce%ba%cf%84%cf%81%ce%bf%ce%bb%cf%8c%ce%b3%ce%bf%cf%82-%ce%9c%ce%b7%cf%87%ce%b1%ce%bd%ce%b9%ce%ba%cf%8c%cf%82"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 680, "favorite_count": 0, "accepted_answer_id": 45054666, "answer_count": 2, "score": 2, "last_activity_date": 1499854059, "creation_date": 1499842330, "last_edit_date": 1499849273, "question_id": 45050415, "link": "https://stackoverflow.com/questions/45050415/what-is-overhead-in-term-of-parallel-and-concurrent-programming-haskell", "title": "What is overhead in term of parallel and concurrent programming (Haskell)?", "body": "<p>What is overhead in term of parallel and concurrent programming (Haskell)?</p>\n\n<blockquote>\n  <p>However, even in a purely functional language, automatic parallelization is thwarted by an age-old problem: To make the program faster, we have to gain more from parallelism than we lose due to the <strong>overhead</strong> of adding it, and compile-time analysis cannot make good judgments in this area. An alternative approach is to use runtime profiling to find good candidates for parallelization and to feed this information back into the compiler. Even this, however, has not been terribly successful in practice.</p>\n</blockquote>\n\n<p>(quoted from Simon Marlow's book <em>Parallel and Concurrent Programming in Haskell</em>)</p>\n\n<p>What are some examples in Haskell?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1499845513, "post_id": 45045294, "comment_id": 77076333, "body": "Effect is colloquial for the computational strategy of a monad. The Identity monad, for instance, doesn&#39;t pursue a specific strategy. It performs just normal function application without any modifications."}], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 1, "creation_date": 1499876338, "post_id": 45045641, "comment_id": 77099164, "body": "Would <code>Maybe</code> have any monadic effect? It doesn&#39;t have any <code>run</code> method which adds a bit of confusion."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1499881373, "post_id": 45045641, "comment_id": 77101889, "body": "You&#39;re right, I almost went back to edit that in light of <code>Maybe</code> and <code>[]</code> but don&#39;t really have a good quick clarification (but certainly that sentence is not really accurate). <code>Maybe</code> expresses the effect of computations which can fail (or computation in a language with <code>null</code>)"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 3, "last_activity_date": 1499813186, "creation_date": 1499813186, "answer_id": 45045641, "question_id": 45045294, "link": "https://stackoverflow.com/questions/45045294/in-haskell-terminology-what-are-monadic-effects/45045641#45045641", "title": "In Haskell terminology, what are monadic effects?", "body": "<p>I'm going to try to talk at the question several ways, and hopefully it's helpful.</p>\n\n<p>An \"effect\" (as in \"side-effects\") refer to the behaviors of a <em>specific instance</em> of <code>Monad</code>, so e.g. the <code>State</code> monad expresses the effect of \"stateful computation\" with <code>get</code> and <code>put</code>. Monad transformer libraries like <code>mtl</code> can be thought of as ways of \"composing effects\".</p>\n\n<p>Without knowing the types (or in fact reading the docs) for <code>foo</code> and <code>bar</code> here, we can't say anything about what \"monadic effects\" are happening here, even though we can say quite a few other things about this code:</p>\n\n<pre><code>do a &lt;- fmap bar $ foo x\n   b &lt;- baz\n   return (a,b)\n</code></pre>\n\n<p>The <code>do</code> block above has a type of the form <code>SomeMonad m=&gt; m (a,b)</code>. That tuple <code>(a,b)</code> that is \"returned\", and the way it can be passed to another \"effectful computation\" with <code>&gt;&gt;=</code>, is not what we're talking about when we talk about \"effects\".</p>\n\n<p>Monadic effects always actually \"happen\" when you <code>run</code> them (by calling <code>runState</code> for <code>State</code> for instance).</p>\n\n<p>In the case of <code>IO</code> only the runtime has access to the particular <code>run</code> function for <code>IO</code>, so the nonexistent <code>runIO</code> function calls <code>main</code> to run your program. For <code>IO</code> the \"monadic effects\" are truly the same as what in other languages you'd call \"side-effects\", i.e. just about anything that might change the state of the world.</p>\n"}, {"comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1499875123, "post_id": 45045690, "comment_id": 77098433, "body": "I don&#39;t like this &quot;A value of <code>IO Int</code> is an <code>Int</code> with some <code>IO</code> effects&quot; wording. An <code>IO Int</code> is no more an <code>Int</code> than <code>ls</code> is a list of files. It would be more accurate to call it a recipe for producing an <code>Int</code>."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 15, "last_activity_date": 1499857564, "last_edit_date": 1499857564, "creation_date": 1499813461, "answer_id": 45045690, "question_id": 45045294, "link": "https://stackoverflow.com/questions/45045294/in-haskell-terminology-what-are-monadic-effects/45045690#45045690", "title": "In Haskell terminology, what are monadic effects?", "body": "<p>If you have a value of type <code>M a</code> with <code>M</code> a <code>Monad</code> (or <code>Applicative</code> for applicative effects), then by effects we mean the information that is not contained in the <code>a</code> part. For example with <code>IO</code> it is very clear. A value of <code>IO Int</code> is an <code>Int</code> with some <code>IO</code> effects like writing to a file or firing missiles. A value of type <code>Maybe Int</code> is an Int with the effect of maybe actually not containing an <code>Int</code>. For <code>[Int]</code> the effect is, that you actually have multiple <code>Int</code>s.</p>\n\n<p>We call this an effect because you can think of Monads and Applicatives as notions of computation with certain effects. For <code>Maybe</code> the effects are that you can abort the computation prematurely, for <code>[]</code> you can split the computation.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1499868654, "creation_date": 1499811166, "question_id": 45045294, "link": "https://stackoverflow.com/questions/45045294/in-haskell-terminology-what-are-monadic-effects", "title": "In Haskell terminology, what are monadic effects?", "body": "<p>I feel I have a good understanding of monads, but I'm not too sure what is referred to by 'monadic effects'? Is this the evaluation of a monad? Does it have something to do with IO?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1499811722, "post_id": 45045217, "comment_id": 77065133, "body": "You could do <code>newtype Properties a = Property (String, a) deriving (Show, Eq, Functor, Applicative, Monad)</code> if you use <code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}</code>"}, {"owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1499812127, "post_id": 45045217, "comment_id": 77065245, "body": "By itself or in conjunction with the ADT above? Assuming by itself (to avoid multiple declarations of <code>Property</code>) if I write <code>newtype Property a = String a deriving (Show, Eq, Functor, Applicative, Monad)</code> gives an error that Functor can&#39;t be derived and have to use <code>DerivedFunctor</code>."}, {"owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1499812262, "post_id": 45045217, "comment_id": 77065274, "body": "And adding <code>DerivedFunctor</code> the error then becomes,   <code>Can&#39;t make a derived instance of \u2018Applicative Property\u2019     (even with cunning GeneralizedNewtypeDeriving):     cannot eta-reduce the representation type enough</code>"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 1, "creation_date": 1499812307, "post_id": 45045217, "comment_id": 77065283, "body": "The <code>newtype</code> I recommended is a wrapper for the 2-tuple <code>(String, a)</code>. It produced no compiler errors in my testing. You don&#39;t need <code>DerivedFunctor</code>."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1499812575, "post_id": 45045217, "comment_id": 77065370, "body": "This type breaks the Applicative laws, doesn&#39;t it? That you are ignoring the left-most String in your definition of <code>(&lt;*&gt;)</code> set off alarm bells in my head, and the law it seems to break is the &quot;<a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Applicative.html#g:1\" rel=\"nofollow noreferrer\">interchange</a>&quot; law: <code>u &lt;*&gt; pure y = pure ($ y) &lt;*&gt; u</code>"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 3, "creation_date": 1499814526, "post_id": 45045217, "comment_id": 77065898, "body": "Unfortunately it&#39;s <a href=\"https://stackoverflow.com/q/31018528/1048572\">not possible to define an instance for <code>Property [a]</code></a>. I would recommend distinguishing between <code>data Property a = Property String a</code> and <code>data Properties a = Properties String [a]</code> - the latter you can make an instance of <code>Alternative</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "edited": false, "score": 0, "creation_date": 1499811603, "post_id": 45045288, "comment_id": 77065091, "body": "Thanks, is there a <code>Listable</code> type class constraint that I could give to <code>a</code>?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "edited": false, "score": 1, "creation_date": 1499813795, "post_id": 45045288, "comment_id": 77065698, "body": "@IvanAbraham There&#39;s an <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-Exts.html#t:IsList\" rel=\"nofollow noreferrer\"><code>IsList</code></a> typeclass, but there&#39;s no way to add <code>IsList a =&gt;</code> as a constraint for <code>empty</code>. <code>Alternative</code> requires that <i>any</i> type can be used as the <code>a</code> in <code>f a</code>."}, {"owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1499814221, "post_id": 45045288, "comment_id": 77065811, "body": "@4Castle Is it for use with <code>ConstraintKinds</code>? My aim is to define <code>Alternative</code> for the dataType. The <code>undefined</code> trick works with <code>empty</code> (will possible break something later). But for <code>&lt;|&gt;</code> I just want to do  <code>++</code> on the second element of the tuple (as in your previous comment)."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "edited": false, "score": 0, "creation_date": 1499814486, "post_id": 45045288, "comment_id": 77065888, "body": "@IvanAbraham If you want <code>&lt;|&gt;</code> to be <code>++</code>, then you must define your <code>Property</code> as <code>Property String [a]</code>."}, {"owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1499814743, "post_id": 45045288, "comment_id": 77065958, "body": "@4castle That is how I began with this, but the <code>fmap</code> breaks down - since it needs <code>a -&gt; a</code> and to map something like <code>permutation</code> won&#39;t be possible; will permute the list of strings as well as the strings themselves."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "reply_to_user": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "edited": false, "score": 0, "creation_date": 1499815302, "post_id": 45045288, "comment_id": 77066126, "body": "@IvanAbraham It looks to me like you&#39;re trying to create a blend of the <code>Identity</code> and list monad in one type. Instead, you should create two separate types as <a href=\"https://stackoverflow.com/questions/45045217/haskell-alternative-class-and-empty-function-for-guards#comment77065898_45045217\">Bergi recommended</a>."}, {"owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "reply_to_user": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1499815917, "post_id": 45045288, "comment_id": 77066271, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/148945/discussion-between-ivan-abraham-and-4castle\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 4, "last_activity_date": 1499811105, "creation_date": 1499811105, "answer_id": 45045288, "question_id": 45045217, "link": "https://stackoverflow.com/questions/45045217/haskell-alternative-class-and-empty-function-for-guards/45045288#45045288", "title": "Haskell alternative class and empty function for guards", "body": "<blockquote>\n  <p>But I thought <code>a</code> could be anything and <code>[]</code> is one of anything, so what is the problem?</p>\n</blockquote>\n\n<p>It's not that <code>a</code> can be anything, but that <code>a</code> has to be able to be anything. That is if the user writes <code>x :: Property [a]; x = empty</code>, that has to be allowed, but <code>x :: Property Int; x = empty</code> has to be allowed as well. Your definition only allows the former, so it's incorrect.</p>\n\n<p>There is no way to define a valid <code>empty</code> for your <code>Property</code> type unless you make it produce an error (like <code>empty = Property \"\" undefined</code>) or change the definition of <code>Property</code> to add a case for an empty property.</p>\n"}], "owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 45045288, "answer_count": 1, "score": 0, "last_activity_date": 1499811430, "creation_date": 1499810777, "question_id": 45045217, "link": "https://stackoverflow.com/questions/45045217/haskell-alternative-class-and-empty-function-for-guards", "title": "Haskell alternative class and empty function for guards", "body": "<p>Lets say I have the following ADT, </p>\n\n<pre><code>data Properties a = Property String a\n    deriving (Show,Eq)\n</code></pre>\n\n<p>I have made the following instances for it, </p>\n\n<pre><code>instance Functor Properties where\n  fmap f (Property name prop) = Property name (f prop)\n--\ninstance Applicative (Properties) where\n  pure a = Property \"\" a\n  (Property _ f) &lt;*&gt; p = fmap f p\n\ninstance Monad (Properties) where\n  return a = Property \"\" a\n  (Property name prop) &gt;&gt;= f = (f prop)\n</code></pre>\n\n<p>So far so good. Let see what we can do so far, </p>\n\n<pre><code>pColors = Property \"Color\" [\"Blue\", \"Red\", \"White\"]\npNationality = Property \"Nationality\" [\"Italian\", \"Norwegian\", \"Spanish\"]\n\nanswers = do\n  color &lt;- fmap permutations pColors\n  nation &lt;- fmap permutations pNationality\n  return $ zip color nation\n</code></pre>\n\n<p>gives, </p>\n\n<pre><code>*Main&gt; answers\nProperty \"\" [([\"Blue\",\"Red\",\"White\"],[\"Italian\",\"Norwegian\",\"Spanish\"]),([\"Red\",\"Blue\",\"White\"],[\"Norwegian\",\"Italian\",\"Spanish\"]),([\"White\",\"Red\",\"Blue\"],[\"Spanish\",\"Norwegian\",\"Italian\"]),([\"Red\",\"White\",\"Blue\"],[\"Norwegian\",\"Spanish\",\"Italian\"]),([\"White\",\"Blue\",\"Red\"],[\"Spanish\",\"Italian\",\"Norwegian\"]),([\"Blue\",\"White\",\"Red\"],[\"Italian\",\"Spanish\",\"Norwegian\"])]\n</code></pre>\n\n<p>So <code>fmap</code> and the monadic bind are working as intended. Now I want to use the <code>guard</code> function from <code>alternative</code>. Basically I want to prune <code>pColors</code> and <code>pNationality</code> based on some predicates. So I try to define, </p>\n\n<pre><code>instance Alternative (Properties) where\n  empty = Property \"\" []\n</code></pre>\n\n<p>But this gives me an error and I think (please correct me if I am wrong) that it is because Haskell is interpreting <code>[]</code> as different from <code>a</code>. But I thought <code>a</code> could be anything and <code>[]</code> is one of anything, so what is the problem? </p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 5741065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10e8b6dd3925b2443895bbc080065389?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Sirak", "link": "https://stackoverflow.com/users/5741065/simon-sirak"}, "edited": false, "score": 0, "creation_date": 1499808637, "post_id": 45044284, "comment_id": 77063990, "body": "I had no idea it was actually a linked list! Thank you for the very useful information :) The accepted answer combined with this one makes for a wholesome answer!"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 5, "last_activity_date": 1499806738, "last_edit_date": 1499806738, "creation_date": 1499806404, "answer_id": 45044284, "question_id": 45044244, "link": "https://stackoverflow.com/questions/45044244/what-time-complexity-does-haskells-tail-function-have/45044284#45044284", "title": "What Time Complexity Does Haskell&#39;s &quot;tail&quot;-Function Have?", "body": "<p>Short answer: if the list is already constructed up to that node, <strong><em>O(1)</em></strong>.</p>\n\n<p>A list in Haskell is a <strong>linked list</strong>. It is defined as:</p>\n\n<pre><code>data [a] = [] | a : [a]\n</code></pre>\n\n<p>So that means that either we have the empty list, or the <code>a : [a]</code> construct. So a <em>node</em> with a <code>head</code> (the <code>a</code>) that refers to an object of type <code>a</code>, and a <code>tail</code> that refers to a list <code>[a]</code> (which can be the empty list, or another node).</p>\n\n<p>The source code of the <code>tail</code> in <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.List.html#tail\" rel=\"nofollow noreferrer\"><code>base</code></a> is defined as:</p>\n\n<blockquote>\n<pre><code>tail                    :: [a] -&gt; [a]\ntail (_:xs)             =  xs\ntail []                 =  errorEmptyList \"tail\"\n</code></pre>\n</blockquote>\n\n<p>It runs in O(1) since we simply follow the pointer to the \"tail\" of that node.</p>\n\n<p>Mind however that <strong>Haskell works lazily</strong>. It is not because we get an object of type <code>[a]</code> that we have a <em>materialized</em> list: usually Haskell will first have to evaluate the <em>expression tree</em> it has been given up to the given node. This can result in evaluating a complex and time consuming algorithm. So it <strong>depends on the expression tree you have been given</strong>.</p>\n"}, {"comments": [{"owner": {"reputation": 185, "user_id": 5741065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10e8b6dd3925b2443895bbc080065389?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Sirak", "link": "https://stackoverflow.com/users/5741065/simon-sirak"}, "edited": false, "score": 4, "creation_date": 1499809030, "post_id": 45044296, "comment_id": 77064171, "body": "As for the challenge problem; if I can assume that the list is a singly-linked list (as stated in Williems answer), it should be O(n) because there is no way of having a list without the last element without either removing the &quot;pointer&quot; to the last element (not possible) or copying over the values to a new linked list which does not contain the last element. Is this a correct way to reason?"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 185, "user_id": 5741065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10e8b6dd3925b2443895bbc080065389?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Sirak", "link": "https://stackoverflow.com/users/5741065/simon-sirak"}, "edited": false, "score": 1, "creation_date": 1588371527, "post_id": 45044296, "comment_id": 108879189, "body": "@SimonSirak but consider <code>data NList a = NList ([a], Int)</code> where <code>Int</code> is the list&#39;s length. <code>init</code> then simply becomes <code>second (subtract 1)</code>, more or less."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 16, "last_activity_date": 1499807531, "last_edit_date": 1499807531, "creation_date": 1499806498, "answer_id": 45044296, "question_id": 45044244, "link": "https://stackoverflow.com/questions/45044244/what-time-complexity-does-haskells-tail-function-have/45044296#45044296", "title": "What Time Complexity Does Haskell&#39;s &quot;tail&quot;-Function Have?", "body": "<p>Haskell the language doesn't specify. But in GHC (the most frequently used implementation), it is O(1). The tail does not need to be copied -- it is safe to share between the original list and whoever uses just the tail of the list -- because everything in Haskell is immutable.</p>\n\n<p>Challenge problem: why does <code>init</code>, which keeps all but the <em>last</em> element of a list, run in O(n)? Why doesn't the sharing argument above apply there?</p>\n"}], "owner": {"reputation": 185, "user_id": 5741065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10e8b6dd3925b2443895bbc080065389?s=128&d=identicon&r=PG&f=1", "display_name": "Simon Sirak", "link": "https://stackoverflow.com/users/5741065/simon-sirak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1190, "favorite_count": 1, "accepted_answer_id": 45044296, "answer_count": 2, "score": 4, "last_activity_date": 1499807531, "creation_date": 1499806179, "question_id": 45044244, "link": "https://stackoverflow.com/questions/45044244/what-time-complexity-does-haskells-tail-function-have", "title": "What Time Complexity Does Haskell&#39;s &quot;tail&quot;-Function Have?", "body": "<p>I was reading a tutorial on Haskell when I thought to myself; <strong>what time complexity does Haskell's <code>tail</code> function have (and why)?</strong> (I cannot find an answer in any documentation)</p>\n\n<p>I would guess that for a list of size n, the <code>tail</code> function would be <strong>O(n)</strong>, i.e just copying over the tail to a new list and returning that one. But then again, I do not know too much about the underlying architecture of Haskell (I'm new to the language).</p>\n\n<p>Of course, I could time it. But I don't know how to time stuff in Haskell yet, and I also want to learn how Haskell handles the problem, to justify why it is O(n)/O(1) or whatever.</p>\n\n<p>Thanks in advance :)</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 0, "creation_date": 1499803526, "post_id": 45043009, "comment_id": 77061504, "body": "Are you certain that BangPatterns simply translate to that use of <code>seq</code>? The docs show that an extra <code>case</code> expression is also added."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 4959, "user_id": 503377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/83ad33b911f7d1bdb203427f474924b1?s=128&d=identicon&r=PG", "display_name": "Elliot Cameron", "link": "https://stackoverflow.com/users/503377/elliot-cameron"}, "edited": false, "score": 1, "creation_date": 1499804025, "post_id": 45043009, "comment_id": 77061769, "body": "@ElliotCameron, there&#39;s some funny magic around there that I don&#39;t really understand. They both compile to Core <code>case</code> expressions, but there&#39;s some monkey business to allow them to match a <code>seq</code> on the left-hand side of a rewrite rule."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 17, "last_activity_date": 1499803825, "creation_date": 1499803825, "answer_id": 45043669, "question_id": 45043009, "link": "https://stackoverflow.com/questions/45043009/strictness-of-datatotag-argument/45043669#45043669", "title": "Strictness of dataToTag argument", "body": "<p>GHC tracks certain information about each primop. One key datum is whether the primop \"can_fail\". The original meaning of this flag is that a primop can fail if it can cause a hard fault. For example, array indexing can cause a segmentation fault if the index is out of range, so indexing operations can fail.</p>\n\n<p>If a primop can fail, GHC will restrict certain transformations around it, and in particular won't float it out of any <code>case</code> expressions. It would be rather bad, for example, if</p>\n\n<pre><code>if n &lt; bound\nthen unsafeIndex c n\nelse error \"out of range\"\n</code></pre>\n\n<p>were compiled to</p>\n\n<pre><code>case unsafeIndex v n of\n  !x -&gt; if n &lt; bound\n        then x\n        else error \"out of range\"\n</code></pre>\n\n<p>One of these bottoms is an exception; the other is a segfault.</p>\n\n<p><code>dataToTag#</code> is marked can_fail. So GHC sees (in Core) something like</p>\n\n<pre><code>getTag = \\x -&gt; case x of\n           y -&gt; dataToTag# y\n</code></pre>\n\n<p>(Note that <code>case</code> is strict in Core.) Because <code>dataToTag#</code> is marked can_fail, it won't be floated out of any <code>case</code> expressions.</p>\n"}], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 398, "favorite_count": 1, "accepted_answer_id": 45043669, "answer_count": 1, "score": 15, "last_activity_date": 1499803825, "creation_date": 1499801237, "question_id": 45043009, "link": "https://stackoverflow.com/questions/45043009/strictness-of-datatotag-argument", "title": "Strictness of dataToTag argument", "body": "<p>In <code>GHC.Prim</code>, we find a magical function named <a href=\"http://hackage.haskell.org/package/ghc-prim-0.5.0.0/docs/GHC-Prim.html#v:dataToTag-35-\" rel=\"noreferrer\">dataToTag#</a>:</p>\n\n<pre><code>dataToTag# :: a -&gt; Int#\n</code></pre>\n\n<p>It turns a value of any type into an integer based on the data constructor it uses. This is used to speed up derived implementations of <code>Eq</code>, <code>Ord</code>, and <code>Enum</code>. In the GHC source, the <a href=\"https://github.com/ghc/ghc/blob/564a31f32e522398c50828bcf35cf8deeec5e654/compiler/prelude/primops.txt.pp#L2687\" rel=\"noreferrer\">docs for <code>dataToTag#</code></a> explain that the argument should already by evaluated:</p>\n\n<blockquote>\n  <p>The dataToTag# primop should always be applied to an evaluated argument.\n  The way to ensure this is to invoke it via the 'getTag' wrapper in GHC.Base:</p>\n\n<pre><code>getTag :: a -&gt; Int#\ngetTag !x = dataToTag# x\n</code></pre>\n</blockquote>\n\n<p>It makes total sense to me that we need to force <code>x</code>'s evaluation before <code>dataToTag#</code> is called. What I do not get is why the bang pattern is sufficient. The definition of <code>getTag</code> is just syntactic sugar for:</p>\n\n<pre><code>getTag :: a -&gt; Int#\ngetTag x = x `seq` dataToTag# x\n</code></pre>\n\n<p>But let's turn to the <a href=\"http://hackage.haskell.org/package/ghc-prim-0.5.0.0/docs/GHC-Prim.html#v:seq\" rel=\"noreferrer\">docs for seq</a>:</p>\n\n<blockquote>\n  <p>A note on evaluation order: the expression <code>seq a b</code> does not guarantee that a will be evaluated before b. The only guarantee given by seq is that the both a and b will be evaluated before seq returns a value. In particular, this means that b may be evaluated before a. If you need to guarantee a specific order of evaluation, you must use the function pseq from the \"parallel\" package.</p>\n</blockquote>\n\n<p>In the <code>Control.Parallel</code> module from the <code>parallel</code> package, the docs <a href=\"https://hackage.haskell.org/package/parallel-3.2.1.1/docs/Control-Parallel.html\" rel=\"noreferrer\">elaborate further</a>:</p>\n\n<blockquote>\n  <p>... seq is strict in both its arguments, so the compiler may, for example, rearrange <code>a `seq` b</code> into <code>b `seq` a `seq` b</code> ...</p>\n</blockquote>\n\n<p>How is it that <code>getTag</code> is guaranteed to behave work, given that <code>seq</code> is insufficient for controlling evaluation order?</p>\n"}, {"tags": ["haskell", "typeerror"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1499797189, "post_id": 45040946, "comment_id": 77058026, "body": "The error messages seem to describe the issues pretty well. Have you read them and, if so, what trouble did you have interpreting them?"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1499799739, "post_id": 45040946, "comment_id": 77059491, "body": "Both <code>numCon</code> and <code>numCon_1</code> seem to have 1 too many parameters in their type declaration. Also, <code>0 0</code> doesn&#39;t make any sense."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1499873098, "post_id": 45040946, "comment_id": 77097008, "body": "Additionally you seem to have a spurious <code>outsys</code> at the end of your definition for <code>numCon_1</code> as because you are trying to call an <code>Int</code> as a function otherwise. You also don&#39;t appear to be using that parameter"}], "answers": [{"tags": [], "owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "is_accepted": false, "score": 0, "last_activity_date": 1499873806, "creation_date": 1499873806, "answer_id": 45062115, "question_id": 45040946, "link": "https://stackoverflow.com/questions/45040946/numeric-converter-not-working/45062115#45062115", "title": "numeric converter not working", "body": "<p>The comments have addressed why your program doesn't compile. I'm going to try to guess what you want to do and suggest a more idiomatic way to write it.</p>\n\n<pre><code>-- example: fromBase 10 [1,2,3] == 123\nfromBase base digits = sum $ zipWith (*) (reverse digits) powers\n  where powers = iterate (*base) 1\n\n-- example: toBase 10 123 == [1,2,3]\ntoBase base number | number == 0 = [0]\n                   | otherwise   = reverse $ toBase' base number\n  where toBase' n | n == 0    = []\n                  | otherwise = let (q,r) = n `divMod` base in\n                                  r : toBase' q\n\nchangeBase from to digits = toBase to $ fromBase from digits\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 8279308, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/xBPta.jpg?s=128&g=1", "display_name": "majorTom", "link": "https://stackoverflow.com/users/8279308/majortom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1499873806, "creation_date": 1499793590, "last_edit_date": 1499872247, "question_id": 45040946, "link": "https://stackoverflow.com/questions/45040946/numeric-converter-not-working", "title": "numeric converter not working", "body": "<p>its supposed to be the start of a converter for different numeric systhems</p>\n\n<pre><code>numCon :: [Int] -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nnumCon a c d = numCon_1 (reverse a) (length a) c d\n</code></pre>\n\n<p>-> this is supposed to be just a preprocess to get the length of the entered number and also to reverse the list so that i can go through it from the start\n(it sometimes destroyes something too thats why i put it in)</p>\n\n<pre><code>numCon_1 :: [Int] -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int\nnumCon_1 [] _ _ _ = 0 0\nnumCon_1 (x:xs) len insys outsys = ( x * (insys^((len - length xs)-1) ) + (numCon_1 (xs) len insys outsys)) outsys\n</code></pre>\n\n<p>-> this is the part that doesn't work</p>\n\n<p>I allways get some form of type error no matter what I try but mostly this one:</p>\n\n<pre><code>ZahlsysthemKonverter.hs:10:36: error:\n\u2022 Couldn't match expected type \u2018Int -&gt; Int -&gt; Int\u2019\n              with actual type \u2018Int\u2019\n\u2022 The function \u2018x * (insys ^ ((len - length xs) - 1))\n                + (numCon_1 (xs) len insys outsys)\u2019\n  is applied to one argument,\n  but its type \u2018Int\u2019 has none\n  In the expression:\n    (x * (insys ^ ((len - length xs) - 1))\n     + (numCon_1 (xs) len insys outsys))\n      outsys\n  In an equation for \u2018numCon_1\u2019:\n      numCon_1 (x : xs) len insys outsys\n        = (x * (insys ^ ((len - length xs) - 1))\n           + (numCon_1 (xs) len insys outsys))\n            outsys\n\nZahlsysthemKonverter.hs:10:76: error:\n\u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018Int -&gt; Int\u2019\n\u2022 Probable cause: \u2018numCon_1\u2019 is applied to too few arguments\n  In the second argument of \u2018(+)\u2019, namely\n    \u2018(numCon_1 (xs) len insys outsys)\u2019\n  In the expression:\n    x * (insys ^ ((len - length xs) - 1))\n    + (numCon_1 (xs) len insys outsys)\n  In the expression:\n    (x * (insys ^ ((len - length xs) - 1))\n     + (numCon_1 (xs) len insys outsys))\n      outsys\n</code></pre>\n\n<p>ok had a look at it again my main problem seems to be, that i'm creating a function with the <code>()</code> in <code>(x * (insys^...)</code> and this <code>outsys</code> is the argument to wich its applied, so this one i can solve but the other one persists.</p>\n\n<p>Are there not four Aguments: (xs), len, insys, outsys ?</p>\n\n<p>Or is it because xs can be <code>[]</code> how am i supposed to solve it?</p>\n"}, {"tags": ["haskell", "types", "ghc"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1499786990, "creation_date": 1499786990, "answer_id": 45038792, "question_id": 45038549, "link": "https://stackoverflow.com/questions/45038549/how-does-ghc-interpret-foldl-0-1-2-3-without-parentheses-around/45038792#45038792", "title": "How does GHC interpret `foldl + 0 [1,2,3]` (without parentheses around +)?", "body": "<p><code>foldl + 0 [1,2,3]</code> is parsed as the sum of <code>foldl</code> and <code>0 [1,2,3]</code>, which is <code>0</code> applied to the list <code>[1,2,3]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "is_accepted": false, "score": 0, "last_activity_date": 1499792792, "creation_date": 1499792792, "answer_id": 45040718, "question_id": 45038549, "link": "https://stackoverflow.com/questions/45038549/how-does-ghc-interpret-foldl-0-1-2-3-without-parentheses-around/45040718#45040718", "title": "How does GHC interpret `foldl + 0 [1,2,3]` (without parentheses around +)?", "body": "<p>In Haskell parentheses are not only used to set precedence of expression evaluation. The two statements are actually quite different.</p>\n\n<p>The sign + is an <em>operator</em>, so it's supposed to work like <code>a + b = c</code>. That is, one function argument to the left and the other to the right. You say the operator is used in <em>infix</em> notation when it is like that. </p>\n\n<p>You can covert any operator to a normal function being in the <em>prefix</em> notation by having parentheses. <code>(+) a b = c</code>. </p>\n\n<p>Because of this, your two provided expressions are quite different. It's natural they have different type signatures. </p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 8, "last_activity_date": 1499974384, "last_edit_date": 1499974384, "creation_date": 1499794443, "answer_id": 45041179, "question_id": 45038549, "link": "https://stackoverflow.com/questions/45038549/how-does-ghc-interpret-foldl-0-1-2-3-without-parentheses-around/45041179#45041179", "title": "How does GHC interpret `foldl + 0 [1,2,3]` (without parentheses around +)?", "body": "<p>Because <code>+</code> is an infix operator and there are no parentheses overriding things,</p>\n\n<pre><code>foldl + 0 [1,2,3]\n</code></pre>\n\n<p>parses as</p>\n\n<pre><code>(foldl) + (0 [1,2,3])\n</code></pre>\n\n<p>The easiest starting point is the type of <code>foldl</code>, which is well known (and if you don't know it, you can just ask GHCI with <code>:t foldl</code>).</p>\n\n<pre><code>foldl :: Foldable f =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; f b -&gt; a\n</code></pre>\n\n<p>Next, the other side of the addition. Because <code>0</code> is being applied as a function with <code>[1,2,3]</code> as an argument, there must be a Num instance for a function type which takes a list of some numeric type as input, and produces as output...well, we'll get to that.</p>\n\n<pre><code>0 [1,2,3] :: (Num t, Num ([t] -&gt; s)) =&gt; s\n</code></pre>\n\n<p>Because <code>+</code> is being applied to these two expressions, they must have the same type. Therefore, we must unify</p>\n\n<pre><code>foldl :: Foldable f =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; f b -&gt; a\n</code></pre>\n\n<p>with</p>\n\n<pre><code>0 [1,2,3] :: (Num t, Num ([t] -&gt; s)) =&gt; s\n</code></pre>\n\n<p>The most general way to do that is to let <code>s</code> be the exact same type as <code>foldl</code> (combining their constraints), giving us</p>\n\n<pre><code>0 [1,2,3] :: (Foldable f,\n              Num t, \n              Num ([t] -&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; f b -&gt; a)) \n          =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; f b -&gt; a\n</code></pre>\n\n<p>And remember that of course <code>foldl</code> must have precisely the same type:</p>\n\n<pre><code>foldl :: (Foldable f, \n          Num t,\n          Num ([t] -&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; f b -&gt; a)) \n      =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; f b -&gt; a\n</code></pre>\n\n<p>And since <code>+</code> is from the Num typeclass, the type that they share must be Num as well.</p>\n\n<pre><code>foldl + 0 [1,2,3] :: (Foldable f, \n                      Num t, \n                      Num ([t] -&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; f b -&gt; a),\n                      Num ((a -&gt; b -&gt; a) -&gt; a -&gt; f b -&gt; a))\n                  =&gt; (a -&gt; b -&gt; a) -&gt; a -&gt; f b -&gt; a\n</code></pre>\n\n<p>Which as you can see is, modulo some renaming of types, just what GHC told you.</p>\n\n<p>But of course, this is a rather silly type. It's <em>possible</em> someone would write all these outrageous Num instances, so GHC dutifully infers this as a valid type. But nobody actually has written these instances, so you will have a great deal of trouble actually using this expression. Really what you should do is fix your parentheses.</p>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 45041179, "answer_count": 3, "score": 3, "last_activity_date": 1499974384, "creation_date": 1499786341, "question_id": 45038549, "link": "https://stackoverflow.com/questions/45038549/how-does-ghc-interpret-foldl-0-1-2-3-without-parentheses-around", "title": "How does GHC interpret `foldl + 0 [1,2,3]` (without parentheses around +)?", "body": "<p>One thing that got me stuck early when learning Haskell was the difference between <code>foldl +</code> and <code>foldl (+)</code>.</p>\n\n<pre><code>Prelude&gt; :t foldl + 0 [1,2,3]\n  :: (Num t1, Num ((b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b),\n      Num ([t1] -&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b), Foldable t) =&gt;\n     (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>Prelude&gt; :t foldl (+) 0 [1,2,3]\nfoldl (+) 0 [1,2,3] :: Num b =&gt; b\n</code></pre>\n\n<p>How does Haskell / GHC derive the type of <code>foldl + 0 [1,2,3]</code>? How can I understand why it expands to this giant type?</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 1842, "user_id": 5861569, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/AuMZG.png?s=128&g=1", "display_name": "Khundragpan", "link": "https://stackoverflow.com/users/5861569/khundragpan"}, "edited": false, "score": 3, "creation_date": 1499786011, "post_id": 45038277, "comment_id": 77050870, "body": "Because, in Haskell, all functions are considered curried"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1499787604, "post_id": 45038277, "comment_id": 77052133, "body": "This is abstraction over arity, which is possible with languages that support first class functions. Instead of having to pay attention to the arity of a multi-argument function, you have to keep an eye on the function sequence."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1499965159, "post_id": 45038277, "comment_id": 77146099, "body": "This is actually a very common thing to do in Haskell with applicatives. <code>f &lt;$&gt; x &lt;*&gt; y</code> means <code>fmap f x &lt;*&gt; y</code>. For example, <code>(*) &lt;$&gt; [2, 3] &lt;*&gt; [5, 7]</code> means <code>[(2 *), (3 *)] &lt;*&gt; [5, 7]</code>, which evaluates to <code>[2 * 5, 2 * 7, 3 * 5, 3 * 7]</code> or <code>[10, 14, 15, 21]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 9, "last_activity_date": 1499785850, "creation_date": 1499785850, "answer_id": 45038376, "question_id": 45038277, "link": "https://stackoverflow.com/questions/45038277/too-many-arguments-for-fmap/45038376#45038376", "title": "Too many arguments for fmap", "body": "<p>Haskell does not actually have functions with more (or less) than one argument. A \"two-argument function\" is really just a function that takes one argument and produces another function that takes another argument. That is, <code>\\x y -&gt; x * y</code> is just a syntactic short cut for <code>\\x -&gt; \\y -&gt; x * y</code>. This concept is known as currying.</p>\n\n<p>So this should explain what's happening in your example. Your <code>fmap</code> will simply turn an <code>f</code> of numbers into an <code>f</code> of functions. So, for example, <code>x [1,2,3]</code> would produce the list <code>[\\y -&gt; 1 * y, \\y -&gt; 2 * y, \\y -&gt; 3 * y]</code> (a.k.a. <code>[(1*), (2*), (3*)]</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1499785862, "creation_date": 1499785862, "answer_id": 45038379, "question_id": 45038277, "link": "https://stackoverflow.com/questions/45038277/too-many-arguments-for-fmap/45038379#45038379", "title": "Too many arguments for fmap", "body": "<p>You have <strong>defined a function</strong>. One of the fundamental aspects of functional programming that functions can be parameters, stored into variables, etc.</p>\n\n<p>If we then query the <strong>type</strong> of <code>x</code>, we get:</p>\n\n<pre><code>Prelude&gt; :t x\nx :: (Functor f, Num a) =&gt; f a -&gt; f (a -&gt; a)\n</code></pre>\n\n<p>So <code>x</code> is now a function that takes as input a <em><code>Functor</code> with <code>a</code> applied on that function</em>, and returns the an element of a type with the same functor, but applied with <code>a -&gt; a</code>.</p>\n\n<p>So you can for instance <em>apply a list</em> on <code>x</code>, like:</p>\n\n<pre><code>Prelude&gt; :t x [1,4,2,5]\nx [1,4,2,5] :: Num a =&gt; [a -&gt; a]\n</code></pre>\n\n<p>So now we have a <em>list of functions</em>, that is <em>equivalent</em> to:</p>\n\n<pre><code>[\\x -&gt; 1*x, \\x -&gt; 4*x, \\x -&gt; 2*x, \\x -&gt; 5*x]\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 45038376, "answer_count": 2, "score": 3, "last_activity_date": 1573920747, "creation_date": 1499785557, "last_edit_date": 1573920747, "question_id": 45038277, "link": "https://stackoverflow.com/questions/45038277/too-many-arguments-for-fmap", "title": "Too many arguments for fmap", "body": "<p>The first argument, that <code>fmap</code> is expected is a function with one argument. </p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Then I tried as follow in prelude:</p>\n\n<pre><code>Prelude&gt; x = fmap (\\x y -&gt; x * y)\n</code></pre>\n\n<p>As you can see, the first argument to <code>fmap</code> is a function, that has two arguments. Why does the compiler let it pass?</p>\n\n<p>The function that I pass to <code>fmap</code> above has two arguments not one!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1499775293, "post_id": 45033909, "comment_id": 77042031, "body": "See <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:nub\" rel=\"nofollow noreferrer\"><code>Data.List.nub</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:nubBy\" rel=\"nofollow noreferrer\"><code>nubBy</code></a> for removing duplicates"}], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 5388727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f066380ff341cde5c43a68f82641395?s=128&d=identicon&r=PG&f=1", "display_name": "Snake", "link": "https://stackoverflow.com/users/5388727/snake"}, "edited": false, "score": 0, "creation_date": 1499775918, "post_id": 45034333, "comment_id": 77042544, "body": "Thanks, the solution was even shorter than I thought. And thanks for pointing out and explaining which improvements I can make to my code. I don&#39;t really understand the last part, but that&#39;s probably because my math skills aren&#39;t that respectable :)"}, {"owner": {"reputation": 273, "user_id": 5388727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f066380ff341cde5c43a68f82641395?s=128&d=identicon&r=PG&f=1", "display_name": "Snake", "link": "https://stackoverflow.com/users/5388727/snake"}, "edited": false, "score": 0, "creation_date": 1499776106, "post_id": 45034333, "comment_id": 77042721, "body": "&quot;By the way, the above now looks wrong, since you did not handle a3,b3 at all. You should fix that, I think?&quot;   I thought that if you check the first two parameters of both tuples you automatically check the third. But now I&#39;m not sure. I&#39;m going to look into that, thanks for pointing that out."}, {"owner": {"reputation": 273, "user_id": 5388727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f066380ff341cde5c43a68f82641395?s=128&d=identicon&r=PG&f=1", "display_name": "Snake", "link": "https://stackoverflow.com/users/5388727/snake"}, "edited": false, "score": 0, "creation_date": 1499776712, "post_id": 45034333, "comment_id": 77043216, "body": "Sorry for another comment, but I thought about it and <code>b1 div a1 == b2 div a2</code> takes care of that. So I don&#39;t have to check a3 and b3"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 273, "user_id": 5388727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f066380ff341cde5c43a68f82641395?s=128&d=identicon&r=PG&f=1", "display_name": "Snake", "link": "https://stackoverflow.com/users/5388727/snake"}, "edited": false, "score": 1, "creation_date": 1499779184, "post_id": 45034333, "comment_id": 77045330, "body": "@Snake If they are indeed Pythagorean triples, that looks correct, you only have to check two. For some reason, I thought you wanted to check that on arbitrary triples."}, {"owner": {"reputation": 1336, "user_id": 794944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b885541101d504bbd39901d5d7fc1766?s=128&d=identicon&r=PG", "display_name": "Jack Henahan", "link": "https://stackoverflow.com/users/794944/jack-henahan"}, "edited": false, "score": 1, "creation_date": 1499779626, "post_id": 45034333, "comment_id": 77045688, "body": "Just as an additional stylistic note, if you know you don&#39;t need to use <code>a3</code> and <code>b3</code>, you can signify this directly by writing it as <code>doubleCheck (a1, a2, _) (b1, b2, _)</code>. This really only silences <code>-fwarn-unused-binds</code>, so it&#39;s not hugely important, just something to keep in mind as you write more functions."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 3, "last_activity_date": 1499775693, "last_edit_date": 1499775693, "creation_date": 1499775267, "answer_id": 45034333, "question_id": 45033909, "link": "https://stackoverflow.com/questions/45033909/haskell-filter-3-tuple-list-with-the-list-itself/45034333#45034333", "title": "Haskell Filter (3-tuple) list with the list itself", "body": "<p>I can suggest a few simplifications.</p>\n\n<p>First, boolean are ordinary values. They do not have to be relegated to <code>if</code> guards, or <code>| ...</code> guards. In particular,</p>\n\n<pre><code>f x | condition = True\n    | otherwise = False\n</code></pre>\n\n<p>can be simplified to</p>\n\n<pre><code>f x = condition\n</code></pre>\n\n<p>In your specific case:</p>\n\n<pre><code>doubleCheck :: (Int, Int, Int) -&gt; (Int, Int, Int) -&gt; Bool\ndoubleCheck a b = \n   (((first b) `div` (first a)) == ((second b) `div` (second a))) \n   &amp;&amp; ((first b) `mod` (first a) == 0)\n   &amp;&amp; ((second b) `mod` (second a) == 0)\n</code></pre>\n\n<p>Second, let's remove some redundant parentheses, there's too much noise there.</p>\n\n<pre><code>doubleCheck :: (Int, Int, Int) -&gt; (Int, Int, Int) -&gt; Bool\ndoubleCheck a b = \n   (first b `div` first a) == (second b `div` second a) \n   &amp;&amp; (first b `mod` first) == 0\n   &amp;&amp; (second b `mod` second a) == 0\n</code></pre>\n\n<p>Actually, we could remove all the parentheses in the last three lines, but let's leave some of those.</p>\n\n<p>Third, you helper functions do not help at all. Forget about such accessors, and exploit pattern matching when you need it.</p>\n\n<pre><code>doubleCheck :: (Int, Int, Int) -&gt; (Int, Int, Int) -&gt; Bool\ndoubleCheck (a1,a2,a3) (b1,b2,b3) = \n   (b1 `div` a1) == (b2 `div` a2) \n   &amp;&amp; (b1 `mod` a1) == 0\n   &amp;&amp; (b2 `mod` a2) == 0\n</code></pre>\n\n<p>By the way, the above now looks wrong, since you did not handle <code>a3,b3</code> at all. You should fix that, I think?</p>\n\n<p>Anyway, to filter a list and keep only the first copy of each triple, we can use <code>Data.List.nubBy</code></p>\n\n<pre><code>nubBy doubleCheck myListOfTriples\n</code></pre>\n\n<p>This has O(n^2) complexity, which is not that great, but it should do. At the moment I can't find a better complexity solution for this specific problem.</p>\n\n<p>Perhaps, one could reduce each triple by diving each component by the gcd of the triple. After this normalization process, our equivalence is plain identity. Hence we can sort in O(n log n) and then remove duplicates in O(n).</p>\n"}], "owner": {"reputation": 273, "user_id": 5388727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f066380ff341cde5c43a68f82641395?s=128&d=identicon&r=PG&f=1", "display_name": "Snake", "link": "https://stackoverflow.com/users/5388727/snake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "accepted_answer_id": 45034333, "answer_count": 1, "score": 0, "last_activity_date": 1499775693, "creation_date": 1499774175, "question_id": 45033909, "link": "https://stackoverflow.com/questions/45033909/haskell-filter-3-tuple-list-with-the-list-itself", "title": "Haskell Filter (3-tuple) list with the list itself", "body": "<p>I'm still new to Haskell and am trying some things. I've got a list full of Pythagorean triples. Now I want to remove all identical triples. For example (6,8,10) is in a way identical to (3,4,5). So I wrote a function which checks whether two 3-tuples are identical or not, if it's identical it returns <code>True</code>, if not <code>False</code>. But now I have a list of 3-tuples (among which are identical triplets) and I want to filter out all the identical (3-tuples). I've been searching for identical problems on StackOverflow, but sadly couldn't find anything that I could use. </p>\n\n<p>My current code is below. (Don't mind efficiency, because I'm sure I'm doing it very inefficient at the moment.)</p>\n\n<p>Generating the list of triples:</p>\n\n<pre><code>pyth :: Int -&gt; [(Int, Int, Int)]\npyth i = [(a, b, c) | a &lt;- [1..i], b &lt;- [1..a], c &lt;- [1..i], (a^2) + (b^2) == (c^2)]\n</code></pre>\n\n<p>Some functions to help work with 3-tuples:</p>\n\n<pre><code>first :: (Int, Int, Int) -&gt; Int\nfirst (a,_,_) = a\n\nsecond :: (Int, Int, Int) -&gt; Int\nsecond (_,a,_) = a\n\nthird :: (Int, Int, Int) -&gt; Int\nthird (_,_,a) = a\n</code></pre>\n\n<p>The function which checks if two triples are identical or not:</p>\n\n<pre><code>    doubleCheck :: (Int, Int, Int) -&gt; (Int, Int, Int) -&gt; Bool\n    doubleCheck a b\n     | (((first b) `div` (first a)) == ((second b) `div` (second a))) &amp;&amp;\n      ((first b) `mod` (first a) == 0) &amp;&amp; \n      ((second b) `mod` (second a) == 0) = True\n     |  otherwise = False\n</code></pre>\n\n<p>Now with the things I heard and read about Haskell and the power of higher order functions I suppose the solution would be like two lines of code or something. But I'm stuck with this for like a day and can't figure out how to solve this problem.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499778500, "post_id": 45032808, "comment_id": 77044771, "body": "There is no such flag because the designers of GHC are not in the business of gold-plating their compiler (in my opinion, such a flag would be a huge misfeature). GHC <a href=\"https://downloads.haskell.org/~ghc/master/users-guide/phases.html#pre-processor\" rel=\"nofollow noreferrer\">already supports</a> adding your own custom pre-processors; I&#39;m guessing you could also implement this as a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/extending_ghc.html#compiler-plugins\" rel=\"nofollow noreferrer\">pluging</a>. Lastly, is there any reason you can&#39;t use your editor to insert the constraint, and from then on write it on new functions?"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 3, "creation_date": 1499780234, "post_id": 45032808, "comment_id": 77046178, "body": "Well, we might as well then use editor macros instead of deriving statements, right? No sense in gold-plating the compiler. What about things like the -XStrict and -XStrictData flags? Why not have those as editor plugins as well?"}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1499780330, "post_id": 45032808, "comment_id": 77046259, "body": "A preprocessor would probably break all the tooling I have, not to mention I&#39;d have to parse the actual source code."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499782275, "post_id": 45032808, "comment_id": 77047855, "body": "Plugins do not require you to parse the source code. If you think it would be a useful feature, feel free to open a ticket or write a proposal (maybe I&#39;m wrong about it being gold-plating!). Regardless, the answer to the question of &#39;why doesn&#39;t it exist&#39; does nothing to solve the problem."}, {"owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1499782644, "post_id": 45032808, "comment_id": 77048138, "body": "@user2407038 Don&#39;t get me wrong, &quot;people didn&#39;t find it useful enough&quot;, &quot;too complex to implement&quot;, &quot;nobody&#39;s gotten around to it yet&quot;, etc. are all valid answers to my question. The reason I asked why is because often there are deeper reasons than it seems at first glance."}, {"owner": {"reputation": 1336, "user_id": 794944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b885541101d504bbd39901d5d7fc1766?s=128&d=identicon&r=PG", "display_name": "Jack Henahan", "link": "https://stackoverflow.com/users/794944/jack-henahan"}, "edited": false, "score": 6, "creation_date": 1499783475, "post_id": 45032808, "comment_id": 77048841, "body": "There seems to be some discussion on <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ExplicitCallStack/ImplicitLocations\" rel=\"nofollow noreferrer\">Trac</a> about this kind of feature, in particular on <a href=\"https://ghc.haskell.org/trac/ghc/ticket/11049\" rel=\"nofollow noreferrer\">ticket 11049</a>. I&#39;m afraid I don&#39;t know enough about it to speak with any authority, but it might give you another direction besides adding <code>HasCallStack</code> to all your functions."}], "owner": {"reputation": 3975, "user_id": 1031627, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/yamFN.jpg?s=128&g=1", "display_name": "Luka Horvat", "link": "https://stackoverflow.com/users/1031627/luka-horvat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 147, "favorite_count": 3, "answer_count": 0, "score": 7, "last_activity_date": 1499771219, "creation_date": 1499771219, "question_id": 45032808, "link": "https://stackoverflow.com/questions/45032808/automatically-add-hascallstack-constraints-on-all-my-functions", "title": "Automatically add HasCallStack constraints on all my functions", "body": "<p>I'm looking for a compiler flag or something similar that would automatically add the <code>HasCallStack</code> context to all of my functions.</p>\n\n<p>I was suggested to enable profiling to get a similar effect but I don't want to recompile my dependencies, and I'd be perfectly fine with only the functions in my application getting annotated.</p>\n\n<p>If there isn't such a flag, why?</p>\n"}, {"tags": ["list", "haskell", "range", "precision"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 5, "creation_date": 1499770259, "post_id": 45032413, "comment_id": 77038399, "body": "<a href=\"https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html\" rel=\"nofollow noreferrer\">docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html</a>. Simplified tl;dr: floating-point arithmetic is <i>always wrong</i> by a small epsilon (which doesn&#39;t matter in the intended application \u2013 physical quantities \u2013 because these can only ever be measured with some uncertainty anyway. \u2014 If you need exact results use an exact type. E.g. <code>[0.1, 0.2 .. 1] :: [Rational]</code> gives <code>[1 % 10,1 % 5,3 % 10,2 % 5,1 % 2,3 % 5,7 % 10,4 % 5,9 % 10,1 % 1]</code>, to be read as <code>[1&#47;10, 1&#47;5, 3&#47;10 ...]</code>."}, {"owner": {"reputation": 9, "user_id": 3786676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b5345644c084d89bd5ef45dd3243ce3?s=128&d=identicon&r=PG&f=1", "display_name": "user61801", "link": "https://stackoverflow.com/users/3786676/user61801"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499771084, "post_id": 45032413, "comment_id": 77038966, "body": "perfect, thanks! I got tricked by the fact that, as a human, for me it&#39;s clear that the step in that case is 0.1, but I suppose GHC does not care and whether the step is small or not it follows always the same steps which introduce the error."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499771850, "post_id": 45032413, "comment_id": 77039503, "body": "Well, that&#39;s not really the issue; just, the number <code>0.1 \u2261 &#185;\u2044\u2081\u2080</code> doesn&#39;t really exist in (binary-) floating-point arithmetic. It only has a close approximation, namely <code>7205759403792794 &#183; 2\u207b\u2075\u2076</code>. And <code>7205759403792794 * 10</code> is almost, but not quite the same as <code>2\u2075\u2076 = 72057594037927936</code>. If you directly compute <code>0.1 * 10</code> you don&#39;t notice that because it happens to be rounded to the correct value, but <code>0.1 * 3</code> is rounded to <code>0.30000000000000004</code> instead."}], "owner": {"reputation": 9, "user_id": 3786676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b5345644c084d89bd5ef45dd3243ce3?s=128&d=identicon&r=PG&f=1", "display_name": "user61801", "link": "https://stackoverflow.com/users/3786676/user61801"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "closed_date": 1499792979, "answer_count": 0, "score": 0, "last_activity_date": 1499770121, "creation_date": 1499770121, "question_id": 45032413, "link": "https://stackoverflow.com/questions/45032413/why-using-range-on-haskell-lists-with-floats-produce-strange-values", "closed_reason": "Duplicate", "title": "Why using range on Haskell lists with floats produce strange values?", "body": "<pre><code>Prelude&gt; [0.1,0.2..1.0]\n[0.1,0.2,0.30000000000000004,0.4000000000000001,0.5000000000000001,0.6000000000000001,0.7000000000000001,0.8,0.9,1.0]\n</code></pre>\n\n<p>Why only 0.8 and 0.9 are correct?</p>\n\n<p>In other cases like <code>[0.1,0.11..0.2]</code> you also get a few initial values correct, but many others are wrong.</p>\n\n<p>I wonder what the problem is here. </p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 1, "creation_date": 1499763118, "post_id": 45029416, "comment_id": 77033191, "body": "sounds like a good idea"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1499799060, "post_id": 45029416, "comment_id": 77059133, "body": "Yeah, why not ? This seems to the most reasonable way to do."}], "answers": [{"tags": [], "owner": {"reputation": 754, "user_id": 2140910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtvpI.jpg?s=128&g=1", "display_name": "Bjartur Thorlacius", "link": "https://stackoverflow.com/users/2140910/bjartur-thorlacius"}, "is_accepted": true, "score": 1, "last_activity_date": 1499877073, "creation_date": 1499877073, "answer_id": 45063188, "question_id": 45029416, "link": "https://stackoverflow.com/questions/45029416/yesod-web-application-where-to-store-user-settings/45063188#45063188", "title": "Yesod Web application: where to store user settings", "body": "<p>Yes, do store permanent user preferences in a database. That way the settings follow the user, irrespective of the user agent (device and/or browser) she uses to access your website. Further more, databases can be backed up offline by your database administrator and can easily be copied or shared with new servers. Settings in a database can also easily be aggregated for statistics on which preferences are unused and which are common, and which preferences correlate.</p>\n\n<p>Storing them elsewhere, whether in a obscure, flat file on the webserver or in a HTTP cookie, would only be appropriate for transient settings that will not even be of statistical or historical interest later.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 45063188, "answer_count": 1, "score": 0, "last_activity_date": 1499877073, "creation_date": 1499762192, "question_id": 45029416, "link": "https://stackoverflow.com/questions/45029416/yesod-web-application-where-to-store-user-settings", "title": "Yesod Web application: where to store user settings", "body": "<p>I'm creating a web application(Yesod + sqlite) where users basically do a bunch of full text searches.\nUsers can set their preferences such as articles length, number of keyword matches etc.</p>\n\n<p>What is the recommended way to store users preferences and settings?\nI can of course store these settings in the database. So at each connection the user retrieves the settings from database and keep it in memory?</p>\n"}, {"tags": ["haskell", "types", "typeclass", "type-families"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 5, "creation_date": 1499761854, "post_id": 45029144, "comment_id": 77032381, "body": "GHC is worried that someone might define an <code>instance Test Integer</code>, in which case the choice of instance will be ambiguous."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1499763161, "post_id": 45029144, "comment_id": 77033218, "body": "GHC, like many compilers, allows for separate compilation: we can compile each module separately. GHC can not know if, in some module which was not yet compiled, there are another instances for your class. Hence, it would be wrong if it committed to the only instance it can see right now. To tell it that this commitment is correct, we have to constrain out call so it can be related to that instance, only. Since the numeric literal in the second argument could be of any type, we have to make its type explicit."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1499778990, "post_id": 45029144, "comment_id": 77045162, "body": "You have very subtly asked two entirely different questions (&quot;why do I need a type annotation on this program&quot; and &quot;why does the type annotation not have the same affect when placed on the <code>Maybe Int</code> argument&quot;). Answers and commenters seem to have chosen to ignore the 2nd question (perhaps rightfully) so you should probably post a separate question for the 2nd question. The short answer is, <a href=\"https://stackoverflow.com/questions/7866375/why-does-ghc-think-that-this-type-variable-is-not-injective\">type families aren&#39;t injective</a>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499819594, "post_id": 45029144, "comment_id": 77067071, "body": "@user2407038, it&#39;s possible to work around the second problem with an injective type family or (probably better) by using another type family that &quot;takes the inverse&quot; of the first."}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 10, "last_activity_date": 1499763138, "creation_date": 1499763138, "answer_id": 45029756, "question_id": 45029144, "link": "https://stackoverflow.com/questions/45029144/when-do-i-need-type-annotations/45029756#45029756", "title": "When do I need type annotations?", "body": "<blockquote>\n  <p>When do I need to cast types in Haskell?</p>\n</blockquote>\n\n<p>Only in very obscure, pseudo-dependently-typed settings where the compiler can't proove that two types are equal but you know they are; in this case you can <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Unsafe-Coerce.html#v:unsafeCoerce\" rel=\"noreferrer\"><code>unsafeCoerce</code></a> them. (Which is like C++' <code>reinterpret_cast</code>, i.e. it completely circumvents the type system and just treats a memory location as if it contains the type you've told it. This is <em>very</em> unsafe indeed!)</p>\n\n<p><strong>However</strong>, that's not what you're talking about here at all. Adding a local signature like <code>::Int</code> does <em>not</em> perform any cast, it merely <em>adds a hint</em> to the type checker. That such a hint is needed shouldn't be surprising: you didn't specify anywhere what <code>a</code> is supposed to be; <code>show</code> is polymorphic in its input and <code>doIt</code> polymorphic in its output. But the compiler must know what it is before it can resolve the associated <code>TT</code>; choosing the wrong <code>a</code> might lead to completely different behaviour from the intended.</p>\n\n<p>The more surprising thing is, really, that sometimes you <em>can</em> omit such signatures. The reason this is possible is that Haskell, and more so GHCi, has <a href=\"http://www.alexeyshmalko.com/2014/haskell-defaulting-rules/\" rel=\"noreferrer\">defaulting rules</a>. When you write e.g. <code>show 3</code>, you again have an ambiguous <code>a</code> type variable, but GHC recognises that the <code>Num</code> constraint can be \u201cnaturally\u201d fulfilled by the <code>Integer</code> type, so it just takes that pick.<br>\nDefaulting rules are handy when quickly evaluating something at the REPL, but they are fiddly to rely on, hence I recommend you <em>never do it</em> in a proper program.</p>\n\n<p>Now, that doesn't mean you should always add <code>:: Int</code> signatures to any subexpression. It does mean that, as a rule, you should aim for making <em>function arguments always less polymorphic than the results</em>. What I mean by that: any local type variables should, if possible, be deducable <em>from the environment</em>. Then it's sufficient to specify the type of the <em>final end result</em>.</p>\n\n<p>Unfortunately, <code>show</code> violates that condition, because its argument is polymorphic with a variable <code>a</code> that doesn't appear in the result at all. So this is one of the functions where you don't get around having some signature.</p>\n"}, {"comments": [{"owner": {"reputation": 1199, "user_id": 1744344, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1e64cde3a7667b8b2ee69af9a7aea5aa?s=128&d=identicon&r=PG", "display_name": "helq", "link": "https://stackoverflow.com/users/1744344/helq"}, "edited": false, "score": 1, "creation_date": 1499994654, "post_id": 45034664, "comment_id": 77158891, "body": "Nice, writing <code>default ()</code> into GHCi makes it unable to infer something as simple as <code>42</code>, it just throws an error saying that the type is ambiguous."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 4, "last_activity_date": 1499817533, "last_edit_date": 1499817533, "creation_date": 1499776117, "answer_id": 45034664, "question_id": 45029144, "link": "https://stackoverflow.com/questions/45029144/when-do-i-need-type-annotations/45034664#45034664", "title": "When do I need type annotations?", "body": "<p>All this discussion is fine, but it hasn't yet been stated explicitly that in Haskell <em>numeric literals are polymorphic</em>.  You probably knew that, but may not have realized that it has bearing on this question.  In the expression</p>\n\n<pre><code>doIt (Just 2) 25\n</code></pre>\n\n<p><code>25</code> does not have type <code>Int</code>, it has type <code>Num a =&gt; a</code> &mdash; that is, its type is just some numeric type, awaiting extra information to pin it down exactly.  And what makes this tricky is that the specific choice might affect the type of the first argument.  Thus amalloy's comment</p>\n\n<blockquote>\n  <p>GHC is worried that someone might define an <code>instance Test Integer</code>, in which case the choice of instance will be ambiguous.</p>\n</blockquote>\n\n<p>When you give that information &mdash; which can come from either the argument or the result type (because of the <code>a -&gt; a</code> part of <code>doIt</code>'s signature) &mdash; by writing either of</p>\n\n<pre><code>doIt (Just 2) (25 :: Int)\ndoIt (Just 2) 25 :: Int   -- N.B. this annotates the type of the whole expression\n</code></pre>\n\n<p>then the specific instance is known.</p>\n\n<p>Note that you do not need type families to produce this behavior.  This is par for the course in typeclass resolution.  The following code will produce the same error for the same reason.</p>\n\n<pre><code>class Foo a where\n    foo :: a -&gt; a\n\nmain = print $ foo 42\n</code></pre>\n\n<p>You might be wondering why this doesn't happen with something like</p>\n\n<pre><code>main = print 42\n</code></pre>\n\n<p>which is a good question, that leftroundabout has already addressed. It has to do with Haskell's <a href=\"https://www.haskell.org/onlinereport/decls.html#default-decls\" rel=\"nofollow noreferrer\">defaulting rules</a>, which are so specialized that I consider them little more than a hack.</p>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 2, "last_activity_date": 1499827157, "creation_date": 1499827157, "answer_id": 45047429, "question_id": 45029144, "link": "https://stackoverflow.com/questions/45029144/when-do-i-need-type-annotations/45047429#45047429", "title": "When do I need type annotations?", "body": "<p>With this expression:</p>\n\n<pre><code>putStrLn $ show $ tryMe (Just 2) 25\n</code></pre>\n\n<p>We've got this starting information to work from:</p>\n\n<pre><code>putStrLn :: String -&gt; IO ()\nshow :: Show a =&gt; a -&gt; String\ntryMe :: Maybe Int -&gt; Int -&gt; Int\nJust :: b -&gt; Maybe b\n2 :: Num c =&gt; c\n25 :: Num d =&gt; d\n</code></pre>\n\n<p>(where I've used different type variables everywhere, so we can more easily consider them all at once in the same scope)</p>\n\n<p>The job of the type-checker is basically to find types to choose for all of those variables, so and then make sure that the argument and result types line up, and that all the required type class instances exist.</p>\n\n<p>Here we can see that <code>tryMe</code> applied to two arguments is going to be an <code>Int</code>, so <code>a</code> (used as input to <code>show</code>) must be <code>Int</code>. That requires that there is a <code>Show Int</code> instance; indeed there is, so we're done with <code>a</code>.</p>\n\n<p>Similarly <code>tryMe</code> wants a <code>Maybe Int</code> where we have the result of applying <code>Just</code>. So <code>b</code> must be <code>Int</code>, and our use of <code>Just</code> is <code>Int -&gt; Maybe Int</code>.</p>\n\n<p><code>Just</code> was applied to <code>2 :: Num c =&gt; c</code>. We've decided it must be applied to an <code>Int</code>, so <code>c</code> must be <code>Int</code>. We can do that if we have <code>Num Int</code>, and we do, so <code>c</code> is dealt with.</p>\n\n<p>That leaves <code>25 :: Num d =&gt; d</code>. It's used as the second argument to <code>tryMe</code>, which is expecting an <code>Int</code>, so <code>d</code> must be <code>Int</code> (again discharging the <code>Num</code> constraint).</p>\n\n<p>Then we just have to make sure all the argument and result types line up, which is pretty obvious. This is mostly rehashing the above since we <em>made</em> them line up by choosing the only possible value of the type variables, so I won't get into it in detail.</p>\n\n<p>Now, what's different about this?</p>\n\n<pre><code>putStrLn $ show $ doIt (Just 2) 25\n</code></pre>\n\n<p>Well, lets look at all the pieces again:</p>\n\n<pre><code>putStrLn :: String -&gt; IO ()\nshow :: Show a =&gt; a -&gt; String\ndoIt :: Test t =&gt; TT t -&gt; t -&gt; t\nJust :: b -&gt; Maybe b\n2 :: Num c =&gt; c\n25 :: Num d =&gt; d\n</code></pre>\n\n<p>The input to <code>show</code> is the result of applying <code>doIt</code> to two arguments, so it is <code>t</code>. So we know that <code>a</code> and <code>t</code> are the same type, which means we need <code>Show t</code>, but we don't know what <code>t</code> is yet so we'll have to come back to that.</p>\n\n<p>The result of applying <code>Just</code> is used where we want <code>TT t</code>. So we know that <code>Maybe b</code> must be <code>TT t</code>, and therefore <code>Just :: _b -&gt; TT t</code>. I've written <code>_b</code> using GHC's <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#partial-type-signatures\" rel=\"nofollow noreferrer\">partial type signature syntax</a>, because this <code>_b</code> is not like the <code>b</code> we had before. When we had <code>Just :: b -&gt; Maybe b</code> we could pick any type we liked for <code>b</code> and <code>Just</code> could have that type. But now we need some <em>specific but unknown</em> type <code>_b</code> such that <code>TT t</code> is <code>Maybe _b</code>. We don't have enough information to know what that type is yet, because without knowing <code>t</code> we don't know which instance's definition of <code>TT t</code> we're using.</p>\n\n<p>The argument of <code>Just</code> is <code>2 :: Num c =&gt; c</code>. So we can tell that <code>c</code> must also be <code>_b</code>, and this also means we're going to need a <code>Num _b</code> instance. But since we don't know what <code>_b</code> is yet we can't check whether there's a <code>Num</code> instance for it. We'll come back to it later.</p>\n\n<p>And finally the <code>25 :: Num d =&gt; d</code> is used where <code>doIt</code> wants a <code>t</code>. Okay, so <code>d</code> is also <code>t</code>, and we need a <code>Num t</code> instance. Again, we still don't know what <code>t</code> is, so we can't check this.</p>\n\n<p>So all up, we've figured out this:</p>\n\n<pre><code>putStrLn :: String -&gt; IO ()\nshow :: t -&gt; String\ndoIt :: TT t -&gt; t -&gt; t\nJust :: _b -&gt; TT t\n2 :: _b\n25 :: t\n</code></pre>\n\n<p>And have also these constraints waiting to be solved:</p>\n\n<pre><code>Test t, Num t, Num _b, Show t, (Maybe _b) ~ (TT t)\n</code></pre>\n\n<p>(If you haven't seen it before, <code>~</code> is how we write a constraint that two type expressions must be the same thing)</p>\n\n<p>And we're stuck. There's nothing further we can figure out here, so GHC is going to report a type error. The particular error message you quoted is complaining that we can't tell that <code>TT t</code> and <code>Maybe _b</code> are the same (it calls the type variables <code>a0</code> and <code>a1</code>), since we didn't have enough information to select concrete types for them (they are ambiguous).</p>\n\n<p>If we add some extra type signatures for parts of the expression, we can go further. Adding <code>25 :: Int</code><sup>1</sup> immediately lets us read off that <code>t</code> is <code>Int</code>. Now we can get somewhere! Lets patch that into the constrints we had yet to solve:</p>\n\n<pre><code>Test Int, Num Int, Num _b, Show Int, (Maybe _b) ~ (TT Int)\n</code></pre>\n\n<p><code>Num Int</code> and <code>Show Int</code> are obvious and built in. We've got <code>Test Int</code> too, and that gives us the definition <code>TT Int = Maybe Int</code>. So <code>(Maybe _b) ~ (Maybe Int)</code>, and therefore <code>_b</code> is <code>Int</code> too, which also allows us to discharge that <code>Num _b</code> constraint (it's <code>Num Int</code> again). And again, it's easy now to verify all the argument and result types match up, since we've filled in all the type variables to concrete types.</p>\n\n<p>But why didn't your other attempt work? Lets go back to as far as we could get with no additional type annotation:</p>\n\n<pre><code>putStrLn :: String -&gt; IO ()\nshow :: t -&gt; String\ndoIt :: TT t -&gt; t -&gt; t\nJust :: _b -&gt; TT t\n2 :: _b\n25 :: t\n</code></pre>\n\n<p>Also needing to solve these constraints:</p>\n\n<pre><code>Test t, Num t, Num _b, Show t, (Maybe _b) ~ (TT t)\n</code></pre>\n\n<p>Then add <code>Just 2 :: Maybe Int</code>. Since we know that's also <code>Maybe _b</code> and also <code>TT t</code>, this tells us that <code>_b</code> is <code>Int</code>. We also now know we're looking for a <code>Test</code> instance that gives us <code>TT t = Maybe Int</code>. But that doesn't actually determine what <code>t</code> is! It's possible that there could also be:</p>\n\n<pre><code>instance Test Double where\n    type TT Double = Maybe Int\n    doIt (Just a) _ = fromIntegral a\n    doIt Nothing b = b\n</code></pre>\n\n<p>Now it would be valid to choose <code>t</code> as either <code>Int</code> or <code>Double</code>; either would work fine with your code (since the <code>25</code> could also be a <code>Double</code>), but would print different things!</p>\n\n<p>It's tempting to complain that because there's only one instance for <code>t</code> where <code>TT t = Maybe Int</code> that we should choose that one. But the instance selection logic is defined not to guess this way. If you're in a situation where it's <em>possible</em> that another matching instance should exist, but isn't there due to an error in the code (forgot to import the module where it's defined, for example), then it doesn't commit to the only matching instance it can see. It only chooses an instance when it <strong>knows</strong> no other instance could possibly apply.<sup>2</sup></p>\n\n<p>So the \"there's only one instance where <code>TT t = Maybe Int</code>\" argument doesn't let GHC work backward to settle that <code>t</code> could be <code>Int</code>.</p>\n\n<p>And in general with type families you can only \"work forwards\"; if you know the type you're applying a type family to you can tell from that what the resulting type should be, but if you know the resulting type this doesn't identify the input type(s). This is often surprising, since ordinary type constructors <strong>do</strong> let us \"work backwards\" this way; we used this above to conclude from <code>Maybe _b = Maybe Int</code> that <code>_b = Int</code>. This only works because with new <code>data</code> declarations, applying the type constructor always preserves the argument type in the resulting type (e.g. when we apply <code>Maybe</code> to <code>Int</code>, the resulting type is <code>Maybe Int</code>). The same logic doesn't work with type families, because there could be multiple type family instances mapping to the same type, and even when there isn't there is no requirement that there's an identifiable pattern connecting something in the resulting type to the input type (I could have <code>type TT Char = Maybe (Int -&gt; Double, Bool)</code>.</p>\n\n<p>So you'll often find that when you need to add a type annotation, you'll often find that adding one in a place whose type is the result of a type family doesn't work, and you'll need to pin down the input to the type family instead (or something else that is required to be the same type as it).</p>\n\n<hr>\n\n<p><sup>1</sup> Note that the line you quoted as working in your question <code>main = putStrLn $ show $ doIt (Just 2) 25::Int</code> does not actually work. The <code>:: Int</code> signature binds \"as far out as possible\", so you're actually claiming that the entire expression <code>putStrLn $ show $ doIt (Just 2) 25</code> is of type <code>Int</code>, when it must be of type <code>IO ()</code>. I'm assuming when you really checked it you put brackets around <code>25 :: Int</code>, so <code>putStrLn $ show $ doIt (Just 2) (25 :: Int)</code>.</p>\n\n<p><sup>2</sup> There are specific rules about what GHC considers \"certain knowledge\" that there could not possibly be any other matching instances. I won't get into them in detail, but basically when you have <code>instance Constraints a =&gt; SomeClass (T a)</code>, it has to be able to unambiguously pick an instance only by considering the <code>SomeClass (T a)</code> bit; it can't look at the constraints left of the <code>=&gt;</code> arrow.</p>\n"}], "owner": {"reputation": 7435, "user_id": 4617597, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/b1Sdw.png?s=128&g=1", "display_name": "Marcelo Lazaroni", "link": "https://stackoverflow.com/users/4617597/marcelo-lazaroni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 883, "favorite_count": 0, "accepted_answer_id": 45029756, "answer_count": 3, "score": 9, "last_activity_date": 1499827157, "creation_date": 1499761377, "last_edit_date": 1499778776, "question_id": 45029144, "link": "https://stackoverflow.com/questions/45029144/when-do-i-need-type-annotations", "title": "When do I need type annotations?", "body": "<p>Consider these functions</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n\ntryMe :: Maybe Int -&gt; Int -&gt; Int\ntryMe (Just a) b = a\ntryMe Nothing b  = b\n\nclass Test a where\n    type TT a\n    doIt :: TT a -&gt; a -&gt; a\n\ninstance Test Int where\n    type TT Int = Maybe Int\n    doIt (Just a) b  = a\n    doIt (Nothing) b = b\n</code></pre>\n\n<p>This works</p>\n\n<pre><code>main = putStrLn $ show $ tryMe (Just 2) 25\n</code></pre>\n\n<p>This doesn't </p>\n\n<pre><code>main = putStrLn $ show $ doIt (Just 2) 25\n{- \n  \u2022 Couldn't match expected type \u2018TT a0\u2019 with actual type \u2018Maybe a1\u2019\n  The type variables \u2018a0\u2019, \u2018a1\u2019 are ambiguous\n-}\n</code></pre>\n\n<p>But then, if I specify the type for the second argument it does work</p>\n\n<pre><code>main = putStrLn $ show $ doIt (Just 2) 25::Int\n</code></pre>\n\n<p>The type signature for both functions seem to be the same. Why do I need to annotate the second parameter for the type class function? Also, if I annotate only the first parameter to <code>Maybe Int</code> it still doesn't work. Why?</p>\n"}, {"tags": ["haskell", "executable", "nix", "nixos"], "comments": [{"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1499751984, "post_id": 45026060, "comment_id": 77026565, "body": "Don&#39;t executable need to be in path in all linux distributions? (nix or not)"}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "reply_to_user": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 1, "creation_date": 1499754225, "post_id": 45026060, "comment_id": 77027646, "body": "no, not if you use the full (absolute) name of the executable.  The path is just a convenience."}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1499774675, "post_id": 45026060, "comment_id": 77041555, "body": "Your were right, I completely forget about absolute path."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499779274, "post_id": 45026060, "comment_id": 77045404, "body": "It is my (rudimentary) understand of <code>nix</code> that it should be handling the setup of the environment for a particular program all by itself. Why would you want to re-implement that logic in Haskell? In other words, you say that you have &quot;dependencies declared in the .nix file&quot; - can <code>nix</code> add those dependencies to the PATH during the execution of your program? (Feel free to ignore if this understanding of <code>nix</code> is entirely wrong...)"}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1499839851, "post_id": 45026060, "comment_id": 77073001, "body": "nix will handle setting up the environment during the <b>build</b> of the program, but nothing special happens during the <b>runtime</b> of the program once installed (I believe you can demonstrate this by comparing the strings output of env, which contains strings used during the build, with the output of running env).  So my goal is to get the strings used during the build phase, representing the dependent executables I wish to run, into the executable (or possibly a data file in a fixed place owned by the executable), so that it may read &amp; call them, and the dependencies will be documented."}, {"owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "edited": false, "score": 0, "creation_date": 1500972855, "post_id": 45026060, "comment_id": 77558297, "body": "What kind of script do you want to run? What is it most tied to?"}], "answers": [{"comments": [{"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1499839929, "post_id": 45034118, "comment_id": 77073042, "body": "Thank you wizzup, but that&#39;s slightly tangential to my question - I can indeed find the full paths from the environment during the build phase, it&#39;s where / how to store them such that at runtime the executable can retrieve them that is foxing me."}], "tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": false, "score": 0, "last_activity_date": 1499776215, "last_edit_date": 1499776215, "creation_date": 1499774695, "answer_id": 45034118, "question_id": 45026060, "link": "https://stackoverflow.com/questions/45026060/how-to-replace-paths-to-executables-in-source-code-with-nix-that-are-not-in-path/45034118#45034118", "title": "How to replace paths to executables in source code with Nix that are not in PATH", "body": "<p>This is not indented to be the answer but if I post this in comment section it would turn out to be ugly formatted.</p>\n\n<p>Also I am not sure if this hack is the right way to do the job.</p>\n\n<p>I notice that if I use <code>nix-shell</code> I can get full path to nix store</p>\n\n<p>Assume hash is always the same, AFAIK I believe it is, you can use it to hard-coded in build recipe.</p>\n\n<pre><code>$ which bash\n/run/current-system/sw/bin/bash\n[wizzup@ ~] \n$ nix-shell -p bash\n\n[nix-shell:~]$ which bash\n/nix/store/wb34dgkpmnssjkq7yj4qbjqxpnapq0lw-bash-4.4-p12/bin/bash\n</code></pre>\n\n<p>Lastly, I doubt if you have to to any of this if you use <a href=\"https://nixos.org/nixpkgs/manual/#ssec-stdenv-attributes\" rel=\"nofollow noreferrer\">buildInput</a>, it should be the same path.</p>\n"}, {"comments": [{"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1505763450, "post_id": 45298300, "comment_id": 79536970, "body": "Many thanks, Robert.  Using that example, and particularly the bit about the use of postConfigure, I have indeed a working solution.  I made a few changes so that I can use the nix paths in development (e.g., under cabal repl) as well as under build."}], "tags": [], "owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "is_accepted": false, "score": 4, "last_activity_date": 1500972542, "creation_date": 1500972542, "answer_id": 45298300, "question_id": 45026060, "link": "https://stackoverflow.com/questions/45026060/how-to-replace-paths-to-executables-in-source-code-with-nix-that-are-not-in-path/45298300#45298300", "title": "How to replace paths to executables in source code with Nix that are not in PATH", "body": "<p>Assuming you're building the Haskell app in Nix, you can patch a configuration file via your Nix expression. For an example of how to do this, have a look at <a href=\"https://github.com/roberth/example-haskell-nix-dependency\" rel=\"nofollow noreferrer\">this small project</a>.</p>\n\n<p>The crux is that you can define a <code>postConfigure</code> hook like <a href=\"https://github.com/roberth/example-haskell-nix-dependency/blob/master/packages.nix#L23\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>pkgs.haskell.lib.overrideCabal yourProject (old: {\n  postConfigure = ''\n    substituteInPlace src/Configuration.hs --replace 'helloPrefix = Nothing' 'helloPrefix = Just \"${pkgs.hello}\"'\n  '';\n})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 2, "last_activity_date": 1501034608, "creation_date": 1501034608, "answer_id": 45316212, "question_id": 45026060, "link": "https://stackoverflow.com/questions/45026060/how-to-replace-paths-to-executables-in-source-code-with-nix-that-are-not-in-path/45316212#45316212", "title": "How to replace paths to executables in source code with Nix that are not in PATH", "body": "<p>What I do with my xmonad build in nix<sup>1</sup> is refer to executable paths as things like <code>@@compton@@/bin/compton</code>. Then I use a script like this to generate my default.nix file:</p>\n\n<pre class=\"lang-bash prettyprint-override\"><code>#!/usr/bin/env bash\n\nset -eu\n\npackages=($(grep '@@[^@]*@@' src/Main.hs | sed -e 's/.*@@\\(.*\\)@@.*/\\1/' | sort -u))\n\nextra_args=()\nfor p in \"${packages[@]}\"; do\n    extra_args+=(--extra-arguments \"$p\")\ndone\n\ncabal2nix . \"${extra_args[@]}\" \\\n    | head -n-1\n\necho \"  patchPhase = ''\";\necho \"    substituteInPlace src/Main.hs \\\\\"\nfor p in \"${packages[@]}\"; do\n    echo \"      --replace '@@$p@@' '\\${$p}' \\\\\"\ndone\necho \"  '';\"\n\necho \"}\"\n</code></pre>\n\n<p>What it does is grep through <code>src/Main.hs</code> (could easily be changed to find all haskell files, or to some specific configuration module) and pick out all the tags surrounded by<code>@@</code> like <code>@@some-package-name@@</code>. It then does 2 things with them:</p>\n\n<ol>\n<li>passes them to cabal2nix as extra arguments for the nix expression it generates</li>\n<li>post-processes nix expression output from cabal2nix to add a patch phase, which replaces the <code>@@some-package-name@@</code> tag in the Haskell source file with the actual path to the derivation.<sup>2</sup></li>\n</ol>\n\n<p>This generates a nix-expression like this:</p>\n\n<pre><code>{ mkDerivation, base, compton, networkmanagerapplet, notify-osd\n, powerline, setxkbmap, stdenv, synapse, system-config-printer\n, taffybar, udiskie, unix, X11, xmonad, xmonad-contrib\n}:\nmkDerivation {\n  pname = \"xmonad-custom\";\n  version = \"0.0.0.0\";\n  src = ./.;\n  isLibrary = false;\n  isExecutable = true;\n  executableHaskellDepends = [\n    base taffybar unix X11 xmonad xmonad-contrib\n  ];\n  description = \"My XMonad build\";\n  license = stdenv.lib.licenses.bsd3;\n  patchPhase = ''\n    substituteInPlace src/Main.hs \\\n      --replace '@@compton@@' '${compton}' \\\n      --replace '@@networkmanagerapplet@@' '${networkmanagerapplet}' \\\n      --replace '@@notify-osd@@' '${notify-osd}' \\\n      --replace '@@powerline@@' '${powerline}' \\\n      --replace '@@setxkbmap@@' '${setxkbmap}' \\\n      --replace '@@synapse@@' '${synapse}' \\\n      --replace '@@system-config-printer@@' '${system-config-printer}' \\\n      --replace '@@udiskie@@' '${udiskie}' \\\n  '';\n}\n</code></pre>\n\n<p>The net result is I can just write Haskell code and a cabal package file; I don't have to worry much about maintaining the nix package file as well, only re-running my generate-nix script if my dependencies change.</p>\n\n<p>In my Haskell code I just write paths to executables as if <code>@@the-nix-package-name@@</code> was an absolute path to a folder where that package is installed, and everything magically works.</p>\n\n<p>The installed xmonad binary ends up containing hardcoded references to the absolute paths to the executables I call, which is how nix likes to work (this means it automatically knows about the dependency during garbage collection, for example). And I don't have to worry about keeping the things I called in my interactive environment's <code>PATH</code>, or maintaining a wrapper that sets up <code>PATH</code> just for this executable.</p>\n\n<hr>\n\n<p><sup>1</sup> I have it set up as a cabal project that gets built and installed into the nix store, rather than having it dynamically recompile itself from <code>~/.xmonad/xmonad.hs</code></p>\n\n<p><sup>2</sup> Step 2 is a little meta, since I'm using a bash script to generate nix code with an embedded bash script in it</p>\n"}], "owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 900, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1594555192, "creation_date": 1499750988, "last_edit_date": 1594555192, "question_id": 45026060, "link": "https://stackoverflow.com/questions/45026060/how-to-replace-paths-to-executables-in-source-code-with-nix-that-are-not-in-path", "title": "How to replace paths to executables in source code with Nix that are not in PATH", "body": "<p>I wish to write some Haskell that calls an executable as part of its work; and install this on a nixOS host.  I don't want the executable to be in my PATH (and to rely on that would disrupt the beautiful dependency model of nix).</p>\n\n<p>If this were, say, a Perl script, I would have a simple builder that looked for strings of a certain format, and replaced them with the executable names, based upon dependencies declared in the .nix file.  But that seems somewhat harder with the cabal-based building common to haskell.</p>\n\n<p>Is there a standard idiom for encoding the paths to executables at build time (including during development, as well as at install time) within Haskell code on nix?</p>\n\n<p>For the sake of a concrete example, here is a trivial \"script\":</p>\n\n<pre><code>import System.Process ( readProcess )\n\nmain = do\n  stdout &lt;- readProcess \"hostname\" [] \"\"\n  putStrLn $ \"Hostname: \" ++ stdout\n</code></pre>\n\n<p>I would like to be able to compile run this (in principle) without relying on hostname being in the PATH, but rather replacing hostname with the full /nix/store/-inetutils-/bin/hostname path, and thus also gaining the benefits of dependency management under nix.</p>\n\n<p>This could possibly be managed by using a shell (or similar) script, built using a replacement scheme as defined above, that sets up an environment that the haskell executable expects; but still that would need some bootstrapping via the cabal.mkDerivation, and since I'm a lover of OptParse-Applicative's bash completion, I'm loathe to slow that down with another script to fire up every time I hit the tab key.  But if that's what's needed, fair enough.</p>\n\n<p>I did look through cabal.mkDerivation for some sort of pre-build step, but if it's there I'm not seeing it.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499752014, "post_id": 45026157, "comment_id": 77026582, "body": "Some mention of the <code>Distributive</code> class, and perhaps <code>Representable</code>, seems appropriate."}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1499752194, "post_id": 45026157, "comment_id": 77026667, "body": "@dfeuer that&#39;s out of my depth, perhaps elaborate in a separate answer?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499763472, "post_id": 45026157, "comment_id": 77033425, "body": "@dfeuer <code>Distributive</code> can&#39;t help here because <code>Maybe</code> isn&#39;t <code>Distributive</code>. You need <code>Traversable f</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1499779481, "post_id": 45026157, "comment_id": 77045572, "body": "@BenjaminHodgson, <code>Maybe</code> not being <code>Distributive</code> was my point."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1499779518, "post_id": 45026157, "comment_id": 77045604, "body": "Ah, we agree then :)"}], "tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": false, "score": 5, "last_activity_date": 1499751400, "creation_date": 1499751400, "answer_id": 45026157, "question_id": 45025898, "link": "https://stackoverflow.com/questions/45025898/pushing-a-functor-into-a-tuple/45026157#45026157", "title": "Pushing a Functor into a tuple", "body": "<p>Pushing <code>f</code> one level down can be done by:</p>\n\n<pre><code>fn :: Functor f =&gt; f (a, b) -&gt; (f a, f b)\nfn v = (fmap fst v, fmap snd v)\n</code></pre>\n\n<p>(Note that tuples are not traversable if you want <em>both</em> sides.)</p>\n\n<p>The second part is</p>\n\n<pre><code>Functor f =&gt; f (Maybe a) -&gt; Maybe (f a)\n</code></pre>\n\n<p>This type is only inhabited by <code>const Nothing</code>, because the only function you can apply to this value is <code>fmap</code>, getting a value of type <code>f b</code> for some <code>b</code>.</p>\n\n<p>To illustrate why this second part is not possible, consider the fact that <code>IO</code> is an instance of <code>Functor</code>. If you could get a <code>Maybe (IO a)</code> from your value, applying <code>isJust</code> to it would leak one bit of information about the original <code>IO (Maybe a)</code> value without executing it.</p>\n"}, {"tags": [], "owner": {"reputation": 383, "user_id": 3024170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c69db72fd6a246ba01bc7fc71348835?s=128&d=identicon&r=PG&f=1", "display_name": "YoshikuniJujo", "link": "https://stackoverflow.com/users/3024170/yoshikunijujo"}, "is_accepted": true, "score": 4, "last_activity_date": 1499755826, "last_edit_date": 1499755826, "creation_date": 1499753514, "answer_id": 45026684, "question_id": 45025898, "link": "https://stackoverflow.com/questions/45025898/pushing-a-functor-into-a-tuple/45026684#45026684", "title": "Pushing a Functor into a tuple", "body": "<p>We can do, if it is Traversable and not Functor.</p>\n\n<pre><code>fn :: Traversable t =&gt; t (Maybe a, b) -&gt; (Maybe (t a), t b)\nfn v = (sequenceA $ fmap fst v, fmap snd v)\n</code></pre>\n\n<p>Is it okay?</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 45026684, "answer_count": 2, "score": 1, "last_activity_date": 1499755826, "creation_date": 1499750070, "question_id": 45025898, "link": "https://stackoverflow.com/questions/45025898/pushing-a-functor-into-a-tuple", "title": "Pushing a Functor into a tuple", "body": "<p>I've simplified the type signature of some code I need, and it looks roughly like this:</p>\n\n<pre><code>Functor f =&gt; f (Maybe a, b) -&gt; (Maybe (f a), f b)\n</code></pre>\n\n<p>Can I, how do I implement such a function? And if so, how? I'm half guessing I need to push the functor down using <code>Traversable</code>, but I'm having trouble putting this all together in my head.</p>\n"}, {"tags": ["haskell", "opaleye"], "answers": [{"tags": [], "owner": {"reputation": 7947, "user_id": 997606, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b6117f6630078d6612afa75fb8e5bc9a?s=128&d=identicon&r=PG", "display_name": "Tom Ellis", "link": "https://stackoverflow.com/users/997606/tom-ellis"}, "is_accepted": false, "score": 0, "last_activity_date": 1500220567, "creation_date": 1500220567, "answer_id": 45130554, "question_id": 45024640, "link": "https://stackoverflow.com/questions/45024640/how-to-implement-this-fuzzy-search-sql-query-in-opaleye/45130554#45130554", "title": "How to implement this fuzzy search sql query in Opaleye?", "body": "<p>I'm not sure what exactly your question is because what you have looks pretty much fine.  There are two things I would improve.  Firstly, pass the string as an argument to a <code>QueryArr</code> rather than as a function argument.  Secondly use <code>like</code> rather than <code>.==</code>.</p>\n\n<pre><code>getNamesByLicenseNumber :: QueryArr (Column PGText) NamesColumnRead\ngetNamesByLicenseNumber = proc licNumber -&gt; do\n  names &lt;- namesQuery -&lt; ()\n  restrict -&lt; licNumber `like` licenseNumber (names :: NamesColumnRead)\n  returnA -&lt; names\n</code></pre>\n\n<p>Does this do what you want?</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1500220567, "creation_date": 1499741942, "question_id": 45024640, "link": "https://stackoverflow.com/questions/45024640/how-to-implement-this-fuzzy-search-sql-query-in-opaleye", "title": "How to implement this fuzzy search sql query in Opaleye?", "body": "<p>I have an sql query that I am attempting to convert to Opaleye.</p>\n\n<p>I'll simplify my code to focus on the point of my question, namely <strong>how to fuzzy search with Opaleye</strong>.</p>\n\n<p>The Haskell (with some existing Opaleye structures) is</p>\n\n<pre><code>namesTable :: O.Table NamesColumnWrite NamesColumnRead\nnamesTable = O.Table \"names\" (pNames Names { id = O.optional \"id\"\n                                            , licenseNumber = O.required \"license_number\"\n                                            , fullName = O.required \"full_name\"\n                                            })\n\nimport qualified Database.PostgreSQL.Simple as PGS\n\ndata Names' id' licenseNumber' fullName' =\n    Names\n        { id           :: id'\n        , licenseNumber     :: licenseNumber'\n        , fullName          :: fullName'\n        } deriving (Show, Eq)\n\nnamesQuery :: Query NamesColumnRead\nnamesQuery = queryTable NamesTable\n\ntype NamesRead = Names' Int String String\ntype NamesWrite = Names' (Maybe Int) String String\ntype NamesColumnWrite = Names' (Maybe (O.Column O.PGInt4)) (O.Column O.PGText) (O.Column O.PGText)\ntype NamesColumnRead = Names' (O.Column O.PGInt4) (O.Column O.PGText) (O.Column O.PGText)\n\ngetNamesByFuzzyLicenseNumber :: PGS.Connection -&gt; String -&gt; IO [NamesRead]\ngetNamesByFuzzyLicenseNumber conn licNumber = do\n  let query' = \"SELECT id, license_number, full_name FROM get_names_by_fuzzy_license_number_fn(?)\"\n  PGS.query conn query' [licNumber]\n</code></pre>\n\n<p>And the Sql is</p>\n\n<pre><code>CREATE OR REPLACE FUNCTION get_names_by_license_number_fuzzy_fn(p_license_number VARCHAR)\n  RETURNS TABLE\n    (id INT\n    ,license_number VARCHAR\n    ,full_name TEXT\n    )\nAS $$\n  SELECT\n    id,\n    license_number,\n    full_name\n  FROM names\n  WHERE license_number LIKE '%' || p_license_number || '%'\n$$\nLANGUAGE sql;\n</code></pre>\n\n<p>By 'fuzzy search', I mean it searches for any row with a licence number containing as a substring the search parameter <code>p_license_number</code>'s value.</p>\n\n<p><strong>How can I convert this fuzzy search query to Opaleye?</strong></p>\n\n<p>This would involve getting rid of the Sql file and replacing the <code>getNamesByLicenseNumber</code> with a Haskell Opaleye query.\nI expect the answer could be something like</p>\n\n<pre><code>getNamesByLicenseNumber :: String -&gt; Query NamesColumnRead\ngetNamesByLicenseNumber licNumber = proc () -&gt; do\n  names &lt;- namesQuery -&lt; ()\n  restrict -&lt; pgString licNumber .== licenseNumber (names :: NamesColumnRead)\n  returnA -&lt; names\n</code></pre>\n\n<p>except with fuzzy instead of strict matching.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1499730006, "post_id": 45023140, "comment_id": 77020693, "body": "You can do it. You just can&#39;t call your functions <code>minBound</code> and <code>maxBound</code>, because those values only get the <i>type</i> as &quot;input&quot;, not a value of that type."}, {"owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "edited": false, "score": 0, "creation_date": 1499730178, "post_id": 45023140, "comment_id": 77020734, "body": "So I can&#39;t define a bounded instance of <code>Properties</code> but must give it that functionality in some other way?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499730380, "post_id": 45023140, "comment_id": 77020786, "body": "Also, as an aside: unless you actually plan on installing new properties with new sets of values <i>at runtime</i>, I strongly recommend considering using the built-in records and simple enumerated types. I would guess you are asking about this because you are thinking about using a common idiom in dynamically typed languages like Python and Ruby where you have a dictionary with values whose types depend on which key you&#39;re looking at. This is much more naturally translated to a record in Haskell than to a (dynamically typed!) dictionary."}, {"owner": {"reputation": 1336, "user_id": 794944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b885541101d504bbd39901d5d7fc1766?s=128&d=identicon&r=PG", "display_name": "Jack Henahan", "link": "https://stackoverflow.com/users/794944/jack-henahan"}, "edited": false, "score": 2, "creation_date": 1499730565, "post_id": 45023140, "comment_id": 77020826, "body": "I think you may be misunderstanding what <code>Bounded</code> says about a type. It signifies that you wish to define a lower limit and an upper limit. <code>minBound</code> and <code>maxBound</code> must have type <code>Bounded a =&gt; a</code>. Note that these signify concrete values. You can&#39;t use a function to define those values without dependent types."}, {"owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499730810, "post_id": 45023140, "comment_id": 77020872, "body": "@Daniel, you made a good guess. Actually my purpose <i>is</i> to define new values <i>at</i> runtime. In-fact what I want eventually to do is, let the user define properties through statements via the prompt like `&quot;DefStmt prop &quot;Pets&quot; [&quot;Dogs&quot;, &quot;Cats&quot;, &quot;Birds&quot;] which I will parse and (hope to) associate to my ADT."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499746159, "post_id": 45023140, "comment_id": 77024524, "body": "Also, the result of <code>minBound</code> has to have the type <code>Properties a</code>, but you seem to want it to produce a <code>String</code>. These are not the same."}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 4, "last_activity_date": 1499818702, "last_edit_date": 1499818702, "creation_date": 1499746510, "answer_id": 45025277, "question_id": 45023140, "link": "https://stackoverflow.com/questions/45023140/set-specific-properties-for-data-in-haskell/45025277#45025277", "title": "Set specific properties for data in Haskell", "body": "<p>Well no, you can't do quite what you're asking, but maybe you'll find inspiration in this other neat trick.</p>\n\n<pre><code>{-# language ScopedTypeVariables, FlexibleContexts, UndecidableInstances #-}\n\nimport Data.Reflection -- from the reflection package\nimport qualified Data.List.NonEmpty as NE\nimport Data.List.NonEmpty (NonEmpty (..))\nimport Data.Proxy\n\n-- Just the plain string part\nnewtype Pstring p = P String deriving Eq\n\n-- Those properties you're interested in. It will\n-- only be possible to produce bounds if there's at\n-- least one property, so NonEmpty makes more sense\n-- than [].\ntype Props = NonEmpty String\n\n-- This is just to make a Show instance that does\n-- what you seem to want easier to write. It's not really\n-- necessary.\ndata Properties = Property String [String] deriving Show\n</code></pre>\n\n<p>Now we get to the key part, where we use reflection to produce class instances that can depend on run-time values. Roughly speaking, you can think of</p>\n\n<pre><code>Reifies x t =&gt; ...\n</code></pre>\n\n<p>as being a class-level version of</p>\n\n<pre><code>\\(x :: t) -&gt; ...\n</code></pre>\n\n<p>Because it operates at the class level, you can use it to parametrize instances. Since <code>Reifies x t</code> binds a <em>type variable</em> <code>x</code>, rather than a <em>term variable</em>, you need to use <code>reflect</code> to actually get the value back. If you happen to have a value on hand whose type ends in <code>p</code>, then you can just apply <code>reflect</code> to that value. Otherwise, you can always magic up a <code>Proxy :: Proxy p</code> to do the job.</p>\n\n<pre><code>-- If some Props are \"in the air\" tied to the type p,\n-- then we can show them along with the string.\ninstance Reifies p Props =&gt; Show (Pstring p) where\n  showsPrec k p@(P str) =\n     showsPrec k $ Property str (NE.toList $ reflect p)\n\n-- If some Props are \"in the air\" tied to the type p,\n-- then we can give Pstring p a Bounded instance.\ninstance Reifies p Props =&gt; Bounded (Pstring p) where\n  minBound = P $ NE.head (reflect (Proxy :: Proxy p))\n  maxBound = P $ NE.last (reflect (Proxy :: Proxy p))\n</code></pre>\n\n<p>Now we need to have a way to actually bind types that can be passed to the type-level lambdas. This is done using the <code>reify</code> function. So let's throw some <code>Prop</code>s into the air and then let the butterfly nets get them back.</p>\n\n<pre><code>main :: IO ()\nmain = reify (\"Hi\" :| [\"how\", \"are\", \"you\"]) $\n  \\(_ :: Proxy p) -&gt; do\n    print (minBound :: Pstring p)\n    print (maxBound :: Pstring p)\n\n./dfeuer@squirrel:~/src&gt; ./WeirdBounded \nProperty \"Hi\" [\"Hi\",\"how\",\"are\",\"you\"]\nProperty \"you\" [\"Hi\",\"how\",\"are\",\"you\"]\n</code></pre>\n\n<p>You can think of <code>reify x $ \\(p :: Proxy p) -&gt; ...</code> as binding a type <code>p</code> to the value <code>x</code>; you can then pass the type <code>p</code> where you like by constraining things to have types involving <code>p</code>.</p>\n\n<hr>\n\n<p>If you're just doing a couple of things, all this machinery is way more than necessary. Where it gets nice is when you're performing lots of operations with values that have phantom types carrying extra information. In many cases, you can avoid most of the explicit applications of <code>reflect</code> and the explicit proxy handling, because type inference just takes care of it all for you. For a good example of this technique in action, see the <a href=\"https://hackage.haskell.org/package/hyperloglog\" rel=\"nofollow noreferrer\"><code>hyperloglog</code></a> package. Configuration information for the <code>HyperLogLog</code> data structure is carried in a type parameter; this guarantees, at compile time, that only similarly configured structures are merged with each other.</p>\n"}], "owner": {"reputation": 1540, "user_id": 6395452, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a57f20b2424b5a90e46cf1bbe311e033?s=128&d=identicon&r=PG&f=1", "display_name": "ITA", "link": "https://stackoverflow.com/users/6395452/ita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 45025277, "answer_count": 1, "score": 1, "last_activity_date": 1499818702, "creation_date": 1499729444, "question_id": 45023140, "link": "https://stackoverflow.com/questions/45023140/set-specific-properties-for-data-in-haskell", "title": "Set specific properties for data in Haskell", "body": "<p>Let us say I want to make a ADT as follows in Haskell:</p>\n\n<pre><code>data Properties = Property String [String]\n  deriving (Show,Eq)\n</code></pre>\n\n<p>I want to know if it is possible to give the second list a bounded and enumerated property? Basically the first element of the list will be the <code>minBound</code> and the last element will be the <code>maxBound</code>. I am trying, </p>\n\n<pre><code>data Properties a = Property String [a]\n  deriving (Show, Eq)\n\ninstance Bounded (Properties a) where\n  minBound a = head a\n  maxBound a  = (head . reverse) a\n</code></pre>\n\n<p>But not having much luck. </p>\n"}, {"tags": ["haskell", "tree", "fold"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 3, "creation_date": 1499737390, "post_id": 45022756, "comment_id": 77022407, "body": "FWIW, <code>fold_plant</code> <i>is</i> equivalent to <code>foldr</code>.  Both of them are the catamorphism for their type. You can think of a catamorphism in a couple different ways. One, it&#39;s a conversion from a data structure to its Church-encoded form. Alternatively, it&#39;s a function that takes takes an argument that describes how to convert each constructor to an arbitrary result type (with some cleverness in handling recursion)."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 3, "last_activity_date": 1499743684, "last_edit_date": 1499743684, "creation_date": 1499726860, "answer_id": 45022798, "question_id": 45022756, "link": "https://stackoverflow.com/questions/45022756/how-to-count-the-number-of-leaves-of-a-plant-with-this-fold-function/45022798#45022798", "title": "How to count the number of leaves of a plant with this fold function?", "body": "<p>No, the idea is usually <strong>to use the <code>fold_plant</code></strong> as a way to count the number of leaves. You can do this with:</p>\n\n<pre><code>amount :: Num n =&gt; Plant -&gt; n\namount = fold_plant (+) (const 0) 1\n</code></pre>\n\n<p>So that means that:</p>\n\n<ul>\n<li>for every <code>Stalk x y</code>, we fold it and return the <em>sum</em> of the number of leaves of the two children;</li>\n<li>for every <code>Blossom x</code>, we return <code>0</code> (since we call <code>const 0</code> on the color <code>x</code>, and <code>const 0</code> returns <code>0</code> on every input); and</li>\n<li>for every <code>Leaf</code>, we return a <code>1</code>.</li>\n</ul>\n\n<p>So since every leave is mapped on <code>1</code>, every <code>Blossom</code> on <code>0</code>, and the <code>Stalk</code> works as an addition <code>(+)</code> operator, we obtain the total number of leaves.</p>\n"}, {"comments": [{"owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 0, "creation_date": 1499728685, "post_id": 45023000, "comment_id": 77020395, "body": "Thanks for the answer. I think I understood now. For example if I wanted to add every color of every blossom to a list could I just write <code>colors = fold_plant (++) Color _</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 1, "creation_date": 1499728829, "post_id": 45023000, "comment_id": 77020439, "body": "@dYTe Try it and see! And if that function doesn&#39;t work the way you thought it would, do try arriving at that answer the long way -- by writing down the function explicitly, and slowly (as in this answer) working out what <code>s</code>, <code>b</code>, and <code>l</code> should be by comparing the definition of your function with the definition of the fold. You will, with practice, be able to do that in your head, but the way you get good practice is by doing it slowly and carefully."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 0, "creation_date": 1499744158, "post_id": 45023000, "comment_id": 77023951, "body": "@dYTe now compare the last definition in this answer with the <code>reduction_step</code> in <a href=\"https://stackoverflow.com/a/44927473/849891\">my answer</a> to your previous question on the subject. they match verbatim. the <code>r</code> in <code>Result r</code> stands for &quot;number of leaves&quot; now. so <code>s</code> combines the two recursive results, <code>l</code> and <code>b</code> convert the result in non-recursive case (i.e., base case)."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499746358, "post_id": 45023000, "comment_id": 77024588, "body": "@WillNess Yikes. Now that I see that this is the latest in a chain of questions, I&#39;m beginning to worry we&#39;re depriving dYTe of his homework. =/"}, {"owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 1, "creation_date": 1499801345, "post_id": 45023000, "comment_id": 77060353, "body": "While I didn&#39;t expect a complete solution to the question, I still was able to fully understand how everything works now. I was also able to finish all the other exercises now thanks to you, so you actually made it possible for me to not just finish everything but to also actually understand what I&#39;m doing. Thanks again."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "edited": false, "score": 0, "creation_date": 1499805756, "post_id": 45023000, "comment_id": 77062625, "body": "@dYTe I&#39;m really happy to hear that, thanks for letting us know! That&#39;s very reassuring, and I wish you continued success."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1499728730, "last_edit_date": 1499728730, "creation_date": 1499728296, "answer_id": 45023000, "question_id": 45022756, "link": "https://stackoverflow.com/questions/45022756/how-to-count-the-number-of-leaves-of-a-plant-with-this-fold-function/45023000#45023000", "title": "How to count the number of leaves of a plant with this fold function?", "body": "<p>The other answer jumps straight to the solution, then defends that solution as the correct one. In this answer, I'd like to go the other direction: to describe a method by which you can invent the solution yourself.</p>\n\n<p>I will assume that you could yourself have first written this function <em>without</em> the fold, just with basic pattern matching and recursion. Here's what you might have come up with (modulo some naming, perhaps):</p>\n\n<pre><code>amount Leaf = 1\namount (Blossom c) = 0\namount (Stalk lef rig) = amount lef + amount rig\n</code></pre>\n\n<p>Now compare with this simplified definition of the fold (which doesn't use a <code>where</code>-block helper function):</p>\n\n<pre><code>fold_plant s b l Leaf = l\nfold_plant s b l (Blossom c) = b c\nfold_plant s b l (Stalk lef rig) = s (fold_plant s b l lef) (fold_plant s b l rig)\n</code></pre>\n\n<p>My goodness those two definitions look similar! Let's hypothesize that <code>amount = fold_plant s b l</code> for some choices of <code>s</code>, <code>b</code>, and <code>l</code>. Looking at the first two equations:</p>\n\n<pre><code>amount           Leaf = 1\nfold_plant s b l Leaf = l\n</code></pre>\n\n<p>So we should choose <code>l = 1</code>. For the second two equations:</p>\n\n<pre><code>amount           (Blossom c) = 0\nfold_plant s b l (Blossom c) = b c\n</code></pre>\n\n<p>So we should choose <code>b c = 0</code>. And the last two equations:</p>\n\n<pre><code>amount           (Stalk lef rig) = amount lef + amount rig\nfold_plant s b l (Stalk lef rig) = s (fold_plant s b l lef) (fold_plant s b l rig)\n</code></pre>\n\n<p>Well, recall our hypothesis is that <code>amount = fold_plant s b l</code>, so</p>\n\n<pre><code>s (fold_plant s b l lef) (fold_plant s b l rig) = s (amount lef) (amount rig)\n</code></pre>\n\n<p>and the two equations are now:</p>\n\n<pre><code>amount           (Stalk lef rig) = amount lef + amount rig\nfold_plant s b l (Stalk lef rig) = s (amount lef) (amount rig)\n</code></pre>\n\n<p>So we should choose <code>s x y = x + y</code>. Writing down these equations all at once, we have arrived at our answer:</p>\n\n<pre><code>amount = fold_plant s b l where\n    l = 1\n    b c = 0\n    s x y = x + y\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 45023000, "answer_count": 2, "score": 1, "last_activity_date": 1499743684, "creation_date": 1499726634, "question_id": 45022756, "link": "https://stackoverflow.com/questions/45022756/how-to-count-the-number-of-leaves-of-a-plant-with-this-fold-function", "title": "How to count the number of leaves of a plant with this fold function?", "body": "<p>Color and Plant are datatypes, defined like this:</p>\n\n<pre><code>data Color = Red | Pink | White | Blue | Purple | Green | Yellow\n   deriving (Show, Eq)\n\ndata Plant=\n      Leaf\n   |  Blossom Color\n   |  Stalk Plant Plant\n   deriving (Show, Eq)\n</code></pre>\n\n<p>The fold function is this:</p>\n\n<pre><code>fold_plant :: (x -&gt; x -&gt; x) -&gt; (Color -&gt; x) -&gt; x -&gt; Plant -&gt; x\nfold_plant s b l = fold_plant'\n    where fold_plant' Leaf = l\n          fold_plant' (Blossom c) = b c\n          fold_plant' (Stalk lef rig) = s (fold_plant' lef) (fold_plant' right)\n</code></pre>\n\n<p>Now I'm supposed to implement a function <code>amount</code> which makes use of the fold function, takes a <code>Plant</code> as argument and returns the amount of leaves in the plant.\nThe main problem I think I'm facing right now is that the fold function I'm supposed to use doesn't work like the usual fold functions. By that I mean like <code>foldr</code> and <code>foldl</code>, since those take 3 arguments: a function, an initial value and a list. But in my function <code>fold_plant</code> there's just none of that.</p>\n\n<p>This is what I thought about using but I think I don't understand everything correctly.</p>\n\n<pre><code>amount :: Plant-&gt; Integer\namount input = length . filter (Leaf ==) fold_plant Stalk Blossom Leaf input\n</code></pre>\n"}, {"tags": ["haskell", "nix"], "answers": [{"comments": [{"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 2, "creation_date": 1499751147, "post_id": 45023011, "comment_id": 77026204, "body": "Wow, that&#39;s a great explanation, Ben.  And indeed, it works perfectly.  Once I&#39;m qualified, I&#39;ll suggest an enhancement to the manpage for nix-shell, but in the meantime, many thanks for taking the time to explain what and why.  You&#39;ve both solved my immediate problem and empowered me to tackle the next one with a much deeper understanding."}, {"owner": {"reputation": 2373, "user_id": 3335288, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qfxhh.jpg?s=128&g=1", "display_name": "Zimm i48", "link": "https://stackoverflow.com/users/3335288/zimm-i48"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 1, "creation_date": 1499776549, "post_id": 45023011, "comment_id": 77043077, "body": "@user3416536 Possibly, that would be <a href=\"https://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure\" rel=\"nofollow noreferrer\">nixos.org/nixpkgs/manual/&hellip;</a> that would need some improvement? I personally feel like the section &quot;How to install a compiler with libraries&quot; isn&#39;t highlighted enough."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1499816739, "post_id": 45023011, "comment_id": 77066462, "body": "@user3416536 Unfortunately the nix-shell man page isn&#39;t really enough to use it with everything. This particular point isn&#39;t really a consequence of how nix-shell works (or even how nix works), but how GHC works, and how the specific nix code used to support GHC environments works. There are other languages that work this way in nix (python is one), but also others that don&#39;t. It&#39;s not really appropriate to describe this specifically in the nix-shell man page, but that means it&#39;s not clear why your script didn&#39;t work unless you know there&#39;s a specific Haskell section of the nixpkgs manual. :("}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1499817041, "post_id": 45023011, "comment_id": 77066514, "body": "@user3416536 In general with nix it seems that &quot;end user programs&quot; are pretty fire and forget, but for fairly technical things with lots of independently installable parts (like programming language libraries) you often have to know quite a bit about how the nix code describing them works in order to work with them on a nix system."}, {"owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1499839474, "post_id": 45023011, "comment_id": 77072797, "body": "Your point about this being perhaps too deep for the nix-shell manpage is fair, but being as it does have an example for haskell &quot;scripts&quot;, I think that the example should work!  I argue that the example should be corrected so it does; or else removed (if we think that correcting it would make it too involved for the manpage)."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "edited": false, "score": 0, "creation_date": 1499846472, "post_id": 45023011, "comment_id": 77076999, "body": "@user3416536 Oh, definitely! I didn&#39;t actually realise there was a concrete Haskell example in the nix-shell man page; that would be a documentation bug if it doesn&#39;t work."}, {"owner": {"reputation": 156, "user_id": 6227376, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/85099febfaf3add71d997224cc2e29c2?s=128&d=identicon&r=PG&f=1", "display_name": "C. Hammill", "link": "https://stackoverflow.com/users/6227376/c-hammill"}, "edited": false, "score": 0, "creation_date": 1534288749, "post_id": 45023011, "comment_id": 90655048, "body": "Seems like this doesn&#39;t work anymore, switching from single to double quotes above fixed it for me."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 156, "user_id": 6227376, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/85099febfaf3add71d997224cc2e29c2?s=128&d=identicon&r=PG&f=1", "display_name": "C. Hammill", "link": "https://stackoverflow.com/users/6227376/c-hammill"}, "edited": false, "score": 0, "creation_date": 1534291010, "post_id": 45023011, "comment_id": 90655460, "body": "@C.Hammill Thanks for noticing that, how strange! I&#39;ve edited my answer so the example works. I can&#39;t remember now whether I would have tested the single-quotes version before posting this... probably though, since I don&#39;t really use the second shebang line nix-shell feature."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 8, "last_activity_date": 1534290840, "last_edit_date": 1534290840, "creation_date": 1499728386, "answer_id": 45023011, "question_id": 45022141, "link": "https://stackoverflow.com/questions/45022141/nix-shell-as-interpreter-for-runghc/45023011#45023011", "title": "nix-shell as #! interpreter for runghc", "body": "<p>The environment that you're using to run the script is missing a step. It's got a GHC and a HTTP package, but the compiler doesn't know about the package.</p>\n\n<p>The way GHC and library packages work in nix might be a little \"inside out\" from what you're expecting. You actually need to install a compiler that \"depends on\" all of the libraries you want, rather than simply installing the compiler and the library separately. The reason is that GHC is designed to have library packages added by modifying the file tree where GHC is installed. On a mutable file system with only a single system GHC install you would just modify GHC whenever a library was installed, but nix can't. Nix has to be able to install a frozen GHC that never changes, and potentially many of them.</p>\n\n<p>So what happens instead is that you install a tiny wrapper which depends on the both the underlying \"raw\" GHC install <em>and</em> all of the libraries that you want to use. The wrapper then acts like an install of GHC that had those libraries registered, without actually needing to duplicate an entire GHC install. When you just install a library package on its own it just sits there inert, without any GHC being able to find it just by it existing.</p>\n\n<p>In fact, the script you've shown here doesn't actually specify that it should have a compiler installed at all; it <em>just</em> asks for the <code>HTTP</code> <em>library</em>. When I tried your script I got <code>command not found: runghc</code>. The <code>runghc</code> is only working on your system because it happened to already be in your path when you ran this (perhaps because you have GHC installed in your profile?), and that GHC wasn't installed with the <code>HTTP</code> package and so can't see it. The <code>nix-shell</code> adding just the library to the environment doesn't help.</p>\n\n<p>What you need to do instead is use this line:</p>\n\n<pre><code>#! nix-shell -i runghc -p \"ghc.withPackages (ps: [ ps.HTTP ])\"\n</code></pre>\n\n<p>You're not installing either <code>ghc</code> or <code>HTTP</code> directly; instead the <code>ghc.withPackages</code> function computes a nix package that installs a GHC wrapper that knows about the <code>HTTP</code> Haskell package. Under the hood this depends on a \"raw\" GHC with no additional libraries, and also on the <code>HTTP</code> library and will cause those to be installed too.</p>\n\n<p>If you use lots of different Haskell environments (possibly via nix-shell scripts like this that each need a different set of libraries), then you will end up with a unique <code>withPackages</code> wrapper installed on your system for each combination of libraries you ever use. But that's okay because the wrappers themselves are tiny, and nix is able to share and reuse the underlying GHCs and library packages between all of those environments.</p>\n"}], "owner": {"reputation": 1237, "user_id": 3416536, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/33e660f9b48e97aa96c9029e9645f15d?s=128&d=identicon&r=PG&f=1", "display_name": "user3416536", "link": "https://stackoverflow.com/users/3416536/user3416536"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 1, "accepted_answer_id": 45023011, "answer_count": 1, "score": 8, "last_activity_date": 1534290840, "creation_date": 1499723111, "question_id": 45022141, "link": "https://stackoverflow.com/questions/45022141/nix-shell-as-interpreter-for-runghc", "title": "nix-shell as #! interpreter for runghc", "body": "<p>I'm trying to use nix-shell as a #! wrapper for runghc, as suggested in the manpage.  But it cannot find the libraries.  Given the following example, cut-down from the manpage</p>\n\n<pre><code>#! /usr/bin/env nix-shell\n#! nix-shell -i runghc -p haskellPackages.HTTP\n\nimport Network.HTTP\n\nmain = return ()\n</code></pre>\n\n<p>I get the following result:</p>\n\n<pre><code>[~:0]$ ./nixshelltest \n\nnixshelltest:4:1: error:\n    Failed to load interface for \u2018Network.HTTP\u2019\n    Use -v to see a list of the files searched for.\n[~:1]$ \n</code></pre>\n\n<p>to my mind, that's exactly what nix-shell -p is to avoid.</p>\n\n<p>Am I doing something wrong, missing the point, or is there a bug?  This is both on a nixOS 17.03 host, and also a host running nix 17.09 on top of Ubuntu.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["scala", "haskell", "functional-programming", "lifting"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1499721908, "post_id": 45021763, "comment_id": 77018000, "body": "Can you make one or more specific examples of lifting something somewhere? What kind of transformation are you talking about? I&#39;m having trouble following."}, {"owner": {"reputation": 675, "user_id": 3694556, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65cd43fd325cd82664a702c7692dd241?s=128&d=identicon&r=PG&f=1", "display_name": "altayseyhan", "link": "https://stackoverflow.com/users/3694556/altayseyhan"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1499721999, "post_id": 45021763, "comment_id": 77018051, "body": "e.g <a href=\"https://stackoverflow.com/questions/17965059/what-is-lifting-in-scala\" title=\"what is lifting in scala\">stackoverflow.com/questions/17965059/what-is-lifting-in-scal&zwnj;&#8203;a</a> val pf: PartialFunction[Int, Boolean] = { case i if i &gt; 0 =&gt; i % 2 == 0} then calling pf.lift"}, {"owner": {"reputation": 675, "user_id": 3694556, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65cd43fd325cd82664a702c7692dd241?s=128&d=identicon&r=PG&f=1", "display_name": "altayseyhan", "link": "https://stackoverflow.com/users/3694556/altayseyhan"}, "reply_to_user": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1499722339, "post_id": 45021763, "comment_id": 77018191, "body": "or in examples like here <a href=\"https://en.wikibooks.org/wiki/Haskell/Monad_transformers#Lifting\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/Monad_transformers#Lifting</a>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1499726021, "post_id": 45021763, "comment_id": 77019611, "body": "The rules for &quot;lifting&quot; depend on what &quot;lifting&quot; means. If lifting means <code>liftM</code> then the rules are the <code>Functor</code> laws because <code>liftM</code> is another name for <code>fmap</code>."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 5, "creation_date": 1499726434, "post_id": 45021763, "comment_id": 77019729, "body": "I think you&#39;re trying to generalize something that isn&#39;t generalizable. The Scala example lifts a function into a larger domain. The Haskell example is a monad transformer lift. There&#39;s also <code>liftM</code> which lifts a function into a functor scope. Each of these on their own follows rules, but the naming is just a coincidence. Like how object-oriented programmers and functional programmers mean totally different things when they talk about &quot;composition&quot;."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1499732595, "post_id": 45021763, "comment_id": 77021321, "body": "Sadly <code>lift</code> is one of those words which means whatever the speaker wants it to mean (<code>hoist</code>&#39;s another one), though it usually has some connotation of using something in a larger context."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499780550, "post_id": 45021763, "comment_id": 77046436, "body": "&quot;lifting&quot; typically refers to an <a href=\"https://en.wikipedia.org/wiki/Injective_function\" rel=\"nofollow noreferrer\">injection</a>. The simplest examples (I can think of) of injections are <code>Left :: a -&gt; Either a b</code>, <code>Right :: b -&gt; Either a b</code>, and <code>Identity :: a -&gt; Identity</code> (a trivial one). <code>lift</code> (from <code>MonadTrans</code>), <code>liftM</code>, and the scala examples in the linked question are all injections. (Aside: all the claims here that &quot;lift means whatever you want it to mean&quot; are silly. Clearly a word means whatever you chose! But clearly there is a commonly understood underlying concept)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1500151296, "post_id": 45021763, "comment_id": 77215997, "body": "@user2407038, usually, but not always. <code>data U2 m a = U2</code> <code>instance MonadTrans U2 where lift _ = U2</code> defines a perfectly valid <code>MonadTrans</code> instance, but not an injection. The same goes for <code>liftM</code>/<code>fmap</code> to a trivial functor. Injectivity is also certainly insufficient for most senses of &quot;lift&quot;. So I don&#39;t think injectivity really has anything to do with it."}], "answers": [{"tags": [], "owner": {"reputation": 1731, "user_id": 780350, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/afaa8b1a1e2fe1b53755564e5fa34568?s=128&d=identicon&r=PG", "display_name": "melston", "link": "https://stackoverflow.com/users/780350/melston"}, "is_accepted": false, "score": -1, "last_activity_date": 1499986201, "creation_date": 1499986201, "answer_id": 45092069, "question_id": 45021763, "link": "https://stackoverflow.com/questions/45021763/does-lifting-in-functional-programming-follows-strict-rules/45092069#45092069", "title": "Does &quot;Lifting&quot; in functional programming follows strict rules?", "body": "<p>Lifting doesn't change the 'shape', just the 'type'.  By this I mean that lifting a function into, e.g., a <code>List&lt;A&gt;</code> results in a <code>List&lt;B&gt;</code>.  The shape (<code>List</code>) doesn't change, but the specific type may.</p>\n\n<p>You are right that it is similar to any other transformation.  In fact, the standard operation <code>map</code> is the mechanism of 'lifting' a function of a single variable into the Functor (the datatype being mapped over).  So, you can think of <code>map</code> as <code>lift1</code>, then you have <code>lift2</code> (for functions of two variables), etc.</p>\n"}], "owner": {"reputation": 675, "user_id": 3694556, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65cd43fd325cd82664a702c7692dd241?s=128&d=identicon&r=PG&f=1", "display_name": "altayseyhan", "link": "https://stackoverflow.com/users/3694556/altayseyhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 311, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1499986201, "creation_date": 1499721605, "last_edit_date": 1499755726, "question_id": 45021763, "link": "https://stackoverflow.com/questions/45021763/does-lifting-in-functional-programming-follows-strict-rules", "title": "Does &quot;Lifting&quot; in functional programming follows strict rules?", "body": "<p>I have looked into \"lifting\" q/a's, examples it seemed to me lift function is just like any transformation function that changes the shape (like monad transformation).</p>\n\n<p>Am I missing any point or lift function(\"lifting concept\") does have any rules ?</p>\n\n<p>If not is it just concept in functional transformations?</p>\n"}, {"tags": ["list", "haskell", "lambda", "anonymous", "haskell-prelude"], "comments": [{"owner": {"reputation": 9801, "user_id": 567650, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ccbc30c848110d05818d71e37ae8c8cf?s=128&d=identicon&r=PG", "display_name": "jwd", "link": "https://stackoverflow.com/users/567650/jwd"}, "edited": false, "score": 0, "creation_date": 1499712606, "post_id": 45019602, "comment_id": 77013098, "body": "Seems like a perfect question for <a href=\"https://codegolf.stackexchange.com/\">codegolf.stackexchange.com</a>"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1499712611, "post_id": 45019602, "comment_id": 77013104, "body": "Well, <code>(\\x -&gt; x - h)</code> can be written as <code>(- h)</code> iirc"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1499712674, "post_id": 45019602, "comment_id": 77013156, "body": "Shouldn&#39;t the correct function be: <code>f (h:t)   = (\\x -&gt; x - h) : f t</code>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 2, "creation_date": 1499712702, "post_id": 45019602, "comment_id": 77013167, "body": "@Carcigenicate That&#39;s a bit of a strange corner of the Haskell syntax. <code>(- h)</code> means to negate the number <code>h</code>. <code>subtract h</code> would be equivalent to that lambda."}, {"owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1499712732, "post_id": 45019602, "comment_id": 77013180, "body": "@Willem Van Onsem yes you&#39;re right, fixed it"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1499712732, "post_id": 45019602, "comment_id": 77013181, "body": "@Carcigenicate Unfortunately, no: <code>(-h)</code> is unary minus, and not a section! That&#39;s why we have <code>subtract h</code> from the <code>Prelude</code>."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1499712781, "post_id": 45019602, "comment_id": 77013208, "body": "@chi Ah, damn. Thanks for the reminder."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 7, "last_activity_date": 1499721399, "last_edit_date": 1499721399, "creation_date": 1499712733, "answer_id": 45019650, "question_id": 45019602, "link": "https://stackoverflow.com/questions/45019602/how-can-this-function-be-simplified/45019650#45019650", "title": "How can this function be simplified?", "body": "<p>You can simply use:</p>\n\n<pre><code>f :: Num a =&gt; [a] -&gt; [a -&gt; a]\nf = map subtract\n</code></pre>\n\n<p>Since <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:subtract\" rel=\"nofollow noreferrer\"><code>subtract :: Num n =&gt; n -&gt; n -&gt; n</code></a>, it thus means that we map every element <code>h</code> from the list to a function <code>subtract h</code>. Subtract <code>h</code> subtracts <code>h</code> from any given value <code>x</code>. So <code>subtract h x == x - h</code>.</p>\n"}], "owner": {"reputation": 161, "user_id": 6278149, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/092596c1b1bc647a15058aafd34567b2?s=128&d=identicon&r=PG&f=1", "display_name": "dYTe", "link": "https://stackoverflow.com/users/6278149/dyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512973771, "creation_date": 1499712506, "last_edit_date": 1512973771, "question_id": 45019602, "link": "https://stackoverflow.com/questions/45019602/how-can-this-function-be-simplified", "title": "How can this function be simplified?", "body": "<p>This is the function:</p>\n\n<pre><code>f []      = []\nf (h:t)   = (\\x -&gt; x - h) : f t\n</code></pre>\n\n<p>It takes a list and returns a list of anonymous functions, that substract each each element from x.</p>\n\n<p>Apparently there is some way to write this whole function in 20 characters or less. </p>\n\n<p>I tried to do it with <code>map</code> but that just applies a function to each element of the list. I also tried to replace the anonymous function with <code>(-a)</code> which didn't work either.</p>\n\n<p>Does anybody have an idea?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1499708539, "post_id": 45018107, "comment_id": 77010813, "body": "You cannot use <code>xs</code> as an argument to <code>(+)</code>; it&#39;s a list, not the sum of the values in that list."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1499712470, "post_id": 45018107, "comment_id": 77013020, "body": "@chepner I think it&#39;s the opposite: in the second definition, <code>xs</code> is a number, so it can&#39;t be fed to <code>length</code>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1499712620, "post_id": 45018107, "comment_id": 77013109, "body": "Right; I can never keep the arguments to that function straight."}], "answers": [{"tags": [], "owner": {"reputation": 810, "user_id": 223689, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/72513b978e46e0d0db13ec5ede02108b?s=128&d=identicon&r=PG", "display_name": "Paul Spencer", "link": "https://stackoverflow.com/users/223689/paul-spencer"}, "is_accepted": false, "score": 4, "last_activity_date": 1499712526, "last_edit_date": 1499712526, "creation_date": 1499711181, "answer_id": 45019253, "question_id": 45018107, "link": "https://stackoverflow.com/questions/45018107/convert-bit-to-int-forward-with-foldr/45019253#45019253", "title": "convert bit to int forward with foldr", "body": "<p>I solved my problem: </p>\n\n<pre><code>binToInt' = foldl (\\acc x -&gt; x + 2 * acc) 0\n</code></pre>\n\n<p>which unfolds to:</p>\n\n<pre><code>f = (\\acc x -&gt; x + 2 * acc)\nfoldl f 0\n  [1,0,1,0]\n  (f [1,0,1]) * 2 + 0\n  ((f [1,0]) * 2 + 1) * 2 + 0\n  (((f [1]) * 2 + 0) * 2 + 1) * 2 + 0\n  ((((f []) * 2 + 1) * 2 + 0) * 2 + 1) * 2 + 0\n  ((((0) * 2 + 1) * 2 + 0) * 2 + 1) * 2 + 0\n</code></pre>\n"}], "owner": {"reputation": 810, "user_id": 223689, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/72513b978e46e0d0db13ec5ede02108b?s=128&d=identicon&r=PG", "display_name": "Paul Spencer", "link": "https://stackoverflow.com/users/223689/paul-spencer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1499712526, "creation_date": 1499707159, "question_id": 45018107, "link": "https://stackoverflow.com/questions/45018107/convert-bit-to-int-forward-with-foldr", "title": "convert bit to int forward with foldr", "body": "<p>bit array right to left, e.g. [0,1,0,1] = 10 can be read with:</p>\n\n<pre><code>binToInt = foldr (\\x xs -&gt; x + 2 * xs) 0  \n</code></pre>\n\n<p>I would like to read it left to right, e.g. [1,0,1,0] = 10</p>\n\n<p>I thought this would work:</p>\n\n<pre><code>binToInt' = foldr (\\x xs -&gt; (x * ((^) 2 (length xs)) + xs) 0\n</code></pre>\n\n<p>however I get the error:</p>\n\n<pre><code>Couldn't match type `t0 a0' with `Int' \n</code></pre>\n\n<p>what am I doing wrong?</p>\n\n<p>(as a work around I am reversing the result of binToInt)</p>\n"}, {"tags": ["list", "haskell", "divide"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 6, "creation_date": 1499701436, "post_id": 45016270, "comment_id": 77006459, "body": "Sounds like a left fold. Have a look at <code>foldl</code> or <code>foldl&#39;</code>..."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1499701570, "post_id": 45016270, "comment_id": 77006557, "body": "Note that <code>(((((x1&#47;x2)&#47;x3)&#47;x4)&#47;x5)&#47;x6) = x1&#47;(x2 * x3 * x4 * x5 * x6)</code> so your non-empty case could be <code>divis (x:xs) = x &#47; product xs</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1499701666, "post_id": 45016270, "comment_id": 77006625, "body": "This function doesn&#39;t really make sense mathematically. Why would <code>[] -&gt; 0</code>? If anything, it&#39;s <code>0&#47;0</code>; at best you could coax it to <code>1</code> or perhaps <code>Infinity</code>, but not to <code>0</code>. \u2013 Really I&#39;d <i>start with one element</i> as the base case: I think you want the signature <code>divis :: Double -&gt; [Double] -&gt; Double</code>, then you can simply do <code>divis x\u2080 xs = divis x\u2080 &#47; product xs</code>."}, {"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 0, "creation_date": 1500081958, "post_id": 45016270, "comment_id": 77198557, "body": "It would make more sense for <code>divis [] = 1</code> (the nullary product), so that <code>divis (x:[]) == divis [x] == x</code>. Currently, this is a contradiction."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1499708802, "post_id": 45017890, "comment_id": 77010975, "body": "Worth noting that <code>divis []</code> is undefined and <code>div2 []</code> is <code>1</code>. Not <code>0</code> as in your question. This sort of ties back to  @leftaroundabout&#39;s point."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1499712860, "post_id": 45017890, "comment_id": 77013249, "body": "Also worth noting that you shouldn&#39;t ever use <code>foldl</code> in real programs. And <code>mul</code> is probably <code>product</code> from <code>Prelude</code>?"}], "tags": [], "owner": {"reputation": 17, "user_id": 2478642, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/3eded30d2c94920cba8162522f738001?s=128&d=identicon&r=PG", "display_name": "Maksim Kerbel", "link": "https://stackoverflow.com/users/2478642/maksim-kerbel"}, "is_accepted": false, "score": 0, "last_activity_date": 1499766410, "last_edit_date": 1499766410, "creation_date": 1499706318, "answer_id": 45017890, "question_id": 45016270, "link": "https://stackoverflow.com/questions/45016270/haskell-division-of-all-elements-of-a-list/45017890#45017890", "title": "Haskell Division of all elements of a list", "body": "<p>so i found 2 sollutions. thx to Alec and Mark Seemann</p>\n\n<pre><code>divis :: [Double] -&gt; Double\ndivis [x] = x\ndivis (x1 : xs) =  x1 / mul xs\n</code></pre>\n\n<p>and </p>\n\n<pre><code>div2 :: [Double] -&gt; Double\ndiv2 (x1:xs) = foldl (/) x1\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 2478642, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/3eded30d2c94920cba8162522f738001?s=128&d=identicon&r=PG", "display_name": "Maksim Kerbel", "link": "https://stackoverflow.com/users/2478642/maksim-kerbel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 692, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1499766410, "creation_date": 1499701208, "last_edit_date": 1499701766, "question_id": 45016270, "link": "https://stackoverflow.com/questions/45016270/haskell-division-of-all-elements-of-a-list", "title": "Haskell Division of all elements of a list", "body": "<p>I have a problem with this function, that should divide all elements of a list.  </p>\n\n<pre><code>[x1,x2,x3,x4,x5,x6] = (((((x1/x2)/x3)/x4)/x5)/x6)\n</code></pre>\n\n<p>My code thus far is:</p>\n\n<pre><code>division :: [Double] -&gt; Double\ndivis    :: [Double] -&gt; Double\ndivis []      = 0\ndivis [x]     = x\ndivis (x1:xs) = ????\n</code></pre>\n\n<p>How could I solve this problem?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1499687684, "post_id": 45010424, "comment_id": 76996100, "body": "Great question! You might find <a href=\"https://stackoverflow.com/questions/35013293/what-is-applicative-functor-definition-from-the-category-theory-pov\">this</a> iluminating. (If not I&#39;ll be happy to write up an answer going into a bit more detail.)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1499688242, "post_id": 45010424, "comment_id": 76996512, "body": "Also: <a href=\"https://stackoverflow.com/questions/13625905/how-much-is-applicative-really-about-applying-rather-than-combining\" title=\"how much is applicative really about applying rather than combining\">stackoverflow.com/questions/13625905/&hellip;</a>"}, {"owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 0, "creation_date": 1499689939, "post_id": 45010424, "comment_id": 76997820, "body": "You might also find typiclassopedia valuable <a href=\"https://wiki.haskell.org/Typeclassopedia#Definition_6\" rel=\"nofollow noreferrer\">wiki.haskell.org/Typeclassopedia#Definition_6</a>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1499701426, "post_id": 45010424, "comment_id": 77006454, "body": "An applicative <code>m a</code> has &quot;structure&quot; <code>m</code> and &quot;value&quot; <code>a</code>. <code>pure :: a -&gt; m a</code> gives us the ability to construct a minimal structure (sort of an identity of <code>m</code>) and <code>(&lt;*&gt;) :: m (a -&gt; b) -&gt; m a -&gt; m b</code> gives us the ability to combine two <code>m</code>s (the operation of a monoid) all while defining function application on the values inside (one value is <code>a -&gt; b</code>, the other is <code>a</code>, and you get back a <code>b</code>)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1499702904, "post_id": 45010424, "comment_id": 77007500, "body": "Note that the use of Monoid here is in the more general mathematical sense. Haskell would <i>not</i> accept this as a <code>Monoid</code>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499719902, "post_id": 45019405, "comment_id": 77017052, "body": "I&#39;ve been playing around a bit with another formulation: <code>class Functor f =&gt; Cappl f where unit :: Category c =&gt; f (c a a); comp :: Category c =&gt; f (c y z) -&gt; f (c x y) -&gt; f (c x z)</code>. This is equivalent to <code>Applicative</code> and also to the seemingly less powerful <code>class Functor f =&gt; Fappl f where funit :: f (a -&gt; a); fcomp :: f (y -&gt; z) -&gt; f (x -&gt; y) -&gt; f (x -&gt; z)</code>. I dunno if there&#39;s anything interesting there."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499720843, "post_id": 45019405, "comment_id": 77017485, "body": "@dfeuer Curious: how do you get from <code>Fappl</code> to <code>Cappl</code> without <code>Profunctor c</code>?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1499737369, "post_id": 45019405, "comment_id": 77022397, "body": "@BenjaminHodgson, I actually went <code>Fappl</code> to <code>Applicative</code> to (obvious) <code>Cappl</code> to (trivial) <code>Fappl</code>. If you have trouble with that route, let me know. I can give you a hint, but it might be too big."}, {"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1499757692, "post_id": 45019405, "comment_id": 77029786, "body": "@Zeta could you please public the link for irc?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499761766, "post_id": 45019405, "comment_id": 77032313, "body": "@dfeuer I got it. That hint was big enough \ud83d\ude09"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 1, "creation_date": 1499770379, "post_id": 45019405, "comment_id": 77038483, "body": "@zero_coding: IRC? &quot;IIRC&quot; means &quot;If I recall correctly&quot; as in &quot;if I&#39;m not mistaken at least one of the authors has a StackOverflow account&quot;."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 13, "last_activity_date": 1499711758, "creation_date": 1499711758, "answer_id": 45019405, "question_id": 45010424, "link": "https://stackoverflow.com/questions/45010424/how-are-monoid-and-applicative-connected/45019405#45019405", "title": "How are monoid and applicative connected?", "body": "<p>Remark: I don't own the book (yet), and IIRC, at least one of the authors is active on SO and should be able to answer this question. That being said, the idea behind a monoid (or rather a semigroup) is that you have a way to create another object from two objects in that monoid<sup><sub>1</sub></sup>:</p>\n\n<pre><code>mappend :: Monoid m =&gt; m -&gt; m -&gt; m\n</code></pre>\n\n<p>So how is <code>Applicative</code> a monoid? Well, it's a monoid in terms of its structure, as your quote says. That is, we start with an <code>f something</code>, continue with <code>f anotherthing</code>, and we get, you've guessed it a <code>f resulthing</code>:</p>\n\n<pre><code>amappend :: f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>Before we continue, for a short, a very short time, let's forget that <code>f</code> has kind <code>* -&gt; *</code>. What do we end up with?</p>\n\n<pre><code>amappend :: f          -&gt; f   -&gt; f\n</code></pre>\n\n<p>That's the \"monodial structure\" part. And that's the difference between <code>Applicative</code> and <code>Functor</code> in Haskell, since with <code>Functor</code> we don't have that property:</p>\n\n<pre><code>fmap     ::   (a -&gt; b) -&gt; f a -&gt; f b\n--          ^\n--       no f here\n</code></pre>\n\n<p>That's also the reason we get into trouble if we try to use <code>(+)</code> or other functions with <code>fmap</code> only: after a single <code>fmap</code> we're stuck, unless we can <em>somehow apply our new function in that new structure</em>. Which brings us to the second part of your question: </p>\n\n<blockquote>\n  <p>So, with Applicative, we have [...] function application for our values!</p>\n</blockquote>\n\n<p>Function application is <code>($)</code>. And if we have a look at <code>&lt;*&gt;</code>, we can immediately see that they are similar:</p>\n\n<pre><code>($)   ::   (a -&gt; b) -&gt;   a -&gt;   b\n(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>If we forget the <code>f</code> in <code>(&lt;*&gt;)</code>, we just end up with <code>($)</code>. So <code>(&lt;*&gt;)</code> is just function application in the context of our structure:</p>\n\n<pre><code>increase  :: Int -&gt; Int\nincrease x = x + 1\n\nfive :: Int\nfive = 5\n\nincreaseA :: Applicative f =&gt; f (Int -&gt; Int)\nincreaseA = pure increase\n\nfiveA :: Applicative f =&gt; f Int\nfiveA = pure 5\n\nnormalIncrease      = increase   $  five\napplicativeIncrease = increaseA &lt;*&gt; fiveA\n</code></pre>\n\n<p>And that's, I guessed, what the author meant with \"function application\". We suddenly can take those functions that are hidden away in our structure and apply them on other values in our structure. And due to the monodial nature, we stay in that structure.</p>\n\n<p>That being said, I personally would never call that monodial, since <code>&lt;*&gt;</code> does not operate on two arguments of the same type, and an applicative is missing the empty element.</p>\n\n<p><sup><sup>1</sup> For a real semigroup/monoid that operation should be associative, but that's not important here</sup></p>\n"}, {"tags": [], "owner": {"reputation": 1672, "user_id": 11143763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HWExJ.png?s=128&g=1", "display_name": "Zhiltsoff Igor", "link": "https://stackoverflow.com/users/11143763/zhiltsoff-igor"}, "is_accepted": false, "score": 1, "last_activity_date": 1600026937, "last_edit_date": 1600026937, "creation_date": 1599932678, "answer_id": 63863199, "question_id": 45010424, "link": "https://stackoverflow.com/questions/45010424/how-are-monoid-and-applicative-connected/63863199#63863199", "title": "How are monoid and applicative connected?", "body": "<p>Although this question got a great answer long ago, I would like to add a bit.</p>\n<p>Take a look at <a href=\"https://wiki.haskell.org/Typeclassopedia#Alternative_formulation\" rel=\"nofollow noreferrer\">the following class</a>:</p>\n<pre><code>class Functor f =&gt; Monoidal f where\n  unit :: f ()\n  (**) :: f a -&gt; f b -&gt; f (a, b)\n</code></pre>\n<p>Before explaining why we need some <code>Monoidal</code> class for a question about <code>Applicative</code>s, let us first take a look at its laws, abiding by which gives us a monoid:</p>\n<ul>\n<li><code>f a</code> (<code>x</code>) is isomorphic to <code>f ((), a)</code> (<code>unit ** x</code>), which gives us the <strong>left identity</strong>. <code>(** unit) :: f a -&gt; f ((), a)</code>, <code>fmap snd :: f ((), a) -&gt; f a</code>.</li>\n<li><code>f a</code> (<code>x</code>) is also isomorphic <code>f (a, ())</code> (<code>x ** unit</code>), which gives us the <strong>right identity</strong>. <code>(unit **) :: f a -&gt; f (a, ())</code>, <code>fmap fst :: f (a, ()) -&gt; f a</code>.</li>\n<li><code>f ((a, b), c)</code> (<code>(x ** y) ** z</code>) is isomorphic to <code>f (a, (b, c))</code> (<code>x ** (y ** z)</code>), which gives us the <strong>associativity</strong>. <code>fmap assoc :: f ((a, b), c) -&gt; f (a, (b, c))</code>, <code>fmap assoc' :: f (a, (b, c)) -&gt; f ((a, b), c)</code>.</li>\n</ul>\n<p>As you might have guessed, one can write down <code>Applicative</code>'s methods with <code>Monoidal</code>'s and the other way around:</p>\n<pre><code>unit   = pure ()\nf ** g = (,) &lt;$&gt; f &lt;*&gt; g = liftA2 (,) f g\n\npure x  = const x &lt;$&gt; unit\nf &lt;*&gt; g = uncurry id &lt;$&gt; (f ** g)\nliftA2 f x y = uncurry f &lt;$&gt; (x ** y)\n</code></pre>\n<p>Moreover, one can prove that <code>Monoidal</code> and <code>Applicative</code> laws are telling us the same thing. <a href=\"https://stackoverflow.com/questions/62949200/why-are-monoidal-and-applicative-laws-telling-us-the-same-thing\">I asked a question about this a while ago</a>.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 732, "favorite_count": 2, "accepted_answer_id": 45019405, "answer_count": 2, "score": 15, "last_activity_date": 1600026937, "creation_date": 1499684784, "last_edit_date": 1499695691, "question_id": 45010424, "link": "https://stackoverflow.com/questions/45010424/how-are-monoid-and-applicative-connected", "title": "How are monoid and applicative connected?", "body": "<p>I am reading in the <a href=\"http://haskellbook.com/\" rel=\"noreferrer\">haskellbook</a> about applicative and trying to understand it.  </p>\n\n<p>In the book, the author mentioned:</p>\n\n<blockquote>\n  <p>So, with Applicative, we have a Monoid for our structure and function\n  application for our values!</p>\n</blockquote>\n\n<p>How is monoid connected to applicative?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1499682915, "post_id": 45009749, "comment_id": 76992865, "body": "<code>(a,b)</code> is the type constructor <code>(,)</code> applied to <code>a</code> and <code>b</code>. It can also be written <code>(,) a b</code>. <code>(,) a</code> is the type constructor <code>(,)</code> partially applied to <code>a</code>. The applicative instance for <code>(,) a</code> takes the monoidal sum of the 1st component in <code>&lt;*&gt;</code>; for the 2nd component, the same logic is used as that for <code>Identity</code> (but you can see this by looking at the source code for that instance)."}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499699009, "post_id": 45010364, "comment_id": 77004805, "body": "Isn&#39;t there a language pragma to allow tuple sections? Or am I thinking of something else?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499699673, "post_id": 45010364, "comment_id": 77005244, "body": "<code>{-# LANGUAGE TupleSections #-}</code> only works at the value level AFAIK."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499702288, "post_id": 45010364, "comment_id": 77007106, "body": "Ah, OK. That&#39;s what I&#39;m thinking of."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1499684592, "creation_date": 1499684592, "answer_id": 45010364, "question_id": 45009749, "link": "https://stackoverflow.com/questions/45009749/representation-of-tuple-applicative/45010364#45010364", "title": "Representation of tuple applicative", "body": "<p>I prefer to write the instance as a tuple section (which is not actually legal Haskell, but gets the point across:</p>\n\n<pre><code>instance Monoid a =&gt; Applicative (a,)\n</code></pre>\n\n<p>... and before discussing that, consider</p>\n\n<pre><code>instance Functor (a,)\n</code></pre>\n\n<p>What this does is just: for any left-hand element (of type <code>a</code>), map over whichever right-hand argument there is. I.e.</p>\n\n<pre><code>  fmap :: (b -&gt; c) -&gt; (a,b) -&gt; (a,c)\n</code></pre>\n\n<p>One might at this point wonder why we have <code>(a,)</code> and not <code>(,a)</code>. Well, mathematically speaking, the following is just as valid:</p>\n\n<pre><code>instance Functor (,a)\n  fmap :: (a -&gt; b) -&gt; (a,c) -&gt; (b,c)\n</code></pre>\n\n<p>...however that can't be defined because <code>(a,b)</code> is in fact syntactic sugar for <code>(,) a b</code>, i.e. the tuple-type-constructor <code>(,)</code> applied first to the <code>a</code> type and then to the <code>b</code> type. Now, in <code>instance Functor (a,)</code>, we simply leave the <code>b</code> open to be fmapped over, hence</p>\n\n<pre><code>instance Functor ((,) a)\n</code></pre>\n\n<p>But it's not possible to _only apply the <code>b</code> argument, while leaving <code>a</code> open \u2013 that would require a sort of type-level lambda</p>\n\n<pre><code>\u201cinstance Functor (\\b -&gt; (a,b))\u201d\n</code></pre>\n\n<p>which is not supported.</p>\n\n<p>Now as to <code>Applicative</code> \u2013 that just extends the <code>(a,)</code> functor to also support combinations of multiple tuples, provided there's already a <em>natural way</em> to combine the <code>a</code> elements \u2013 that's what the <code>Monoid</code> instance offers. This is better known as the <a href=\"http://hackage.haskell.org/package/transformers-0.5.4.0/docs/Control-Monad-Trans-Writer-Lazy.html#g:1\" rel=\"nofollow noreferrer\">Writer monad</a>, because it's well suited for generating a \u201coperations log\u201d along with the actual computation results:</p>\n\n<pre><code>Prelude&gt; (\"4+\", (4+)) &lt;*&gt; (\"10\",10)\n(\"4+10\",14)\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 681, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1499684592, "creation_date": 1499682676, "question_id": 45009749, "link": "https://stackoverflow.com/questions/45009749/representation-of-tuple-applicative", "title": "Representation of tuple applicative", "body": "<p>I am trying to understand the tuple applicative. When I look at information in prelude about tuple, it says:</p>\n\n<pre><code>instance (Monoid a, Monoid b) =&gt; Monoid (a, b)\ninstance Monoid a =&gt; Applicative ((,) a)\n</code></pre>\n\n<p>What does <code>((,) a)</code> mean? It does not look like a tuple.   </p>\n\n<p>I have following example:</p>\n\n<pre><code>Prelude Data.Monoid&gt; ((Sum 2), (+2)) &lt;*&gt; ((Sum 45), 8)\n(Sum {getSum = 47},10)\n</code></pre>\n\n<p>The first argument in the tuple is an instance of monoid and the second it is just a function application. But how does the signature <code>((,) a)</code> match the example above?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2704, "user_id": 4978205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/286541fdef1e5aad84a9bffbe2279dea?s=128&d=identicon&r=PG&f=1", "display_name": "Glubus", "link": "https://stackoverflow.com/users/4978205/glubus"}, "edited": false, "score": 0, "creation_date": 1499678044, "post_id": 45007826, "comment_id": 76989568, "body": "What is this function supposed to do according to you?"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 3, "creation_date": 1499678142, "post_id": 45007826, "comment_id": 76989639, "body": "You probably need the Scoped Type Variables language extension to make this work. Otherwise the two <code>a</code> variables don&#39;t refer to the same type."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499680419, "post_id": 45007826, "comment_id": 76991277, "body": "Yes. Switch on <code>{-# LANGUAGE ScopedTypeVariables #-}</code>, then do <code>f :: \u2200 a . a -&gt; a</code> \\n <code>f x = x :: a</code>. (But also note that in this specific example, the local signature is completely redundant, you might just as well write <code>f :: a -&gt; a</code> \\n <code>f x = x</code> or indeed <code>f = id</code>.)"}, {"owner": {"reputation": 11, "user_id": 3689868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de76c3960dc2e3c306b09e0f8941227b?s=128&d=identicon&r=PG&f=1", "display_name": "user3689868", "link": "https://stackoverflow.com/users/3689868/user3689868"}, "edited": false, "score": 0, "creation_date": 1499689584, "post_id": 45007826, "comment_id": 76997564, "body": "Ah, I see. So type &#39;a&#39; is not present inside the function body. Thank you very much!"}], "owner": {"reputation": 11, "user_id": 3689868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de76c3960dc2e3c306b09e0f8941227b?s=128&d=identicon&r=PG&f=1", "display_name": "user3689868", "link": "https://stackoverflow.com/users/3689868/user3689868"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "closed_date": 1499680250, "answer_count": 0, "score": 1, "last_activity_date": 1499677346, "creation_date": 1499677346, "question_id": 45007826, "link": "https://stackoverflow.com/questions/45007826/haskell-troubled-typed-binding-in-a-simple-identity-function", "closed_reason": "Duplicate", "title": "Haskell, troubled typed binding in a simple identity function", "body": "<p>I have encounter a very strange error while compiling with GHC. This involves a function f.</p>\n\n<pre><code>f :: a -&gt; a\nf x = x :: a\n</code></pre>\n\n<p>GHC complains that x has an expression type a1, which does not match a.\nI do not understand how Haskell's type system works here, is there any explanation? Thank you!</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1499709539, "post_id": 45007042, "comment_id": 77011437, "body": "The title and body of your question are completely different questions."}], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1499702157, "post_id": 45007551, "comment_id": 77007019, "body": "Still gives an error: <code>Expected type: ExceptT AppError (ReaderT Env (LoggingT IO)) a &#47;&#47; Actual type: ExceptT AppError IO a</code>"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1499709512, "post_id": 45007551, "comment_id": 77011418, "body": "This answer is wrong, presumably because the question in the title is not the same as the actual question in the body."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1499760568, "post_id": 45007551, "comment_id": 77031564, "body": "<code>PGS.withTransaction conn $ runAppM appm</code> evaluates to an <code>IO (Either e a)</code> and it needs to be converted to an <code>ExceptT e m a</code>. Is there a gap in my understanding of what&#39;s happening here?"}, {"owner": {"reputation": 738, "user_id": 8075159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8709365a90d8a840b976b0f132f912e5?s=128&d=identicon&r=PG&f=1", "display_name": "Hogeyama", "link": "https://stackoverflow.com/users/8075159/hogeyama"}, "edited": false, "score": 0, "creation_date": 1499768788, "post_id": 45007551, "comment_id": 77037381, "body": "I see. <code>ExceptT $ liftIO $ PGS.withTransaction conn $ runAppM appm</code> is right. <code>liftIO</code> lifts <code>IO (Either e a)</code> to <code>ReaderT Env (LoggingT IO) (Either e a)</code> and then <code>ExceptT</code> lifts it to <code>AppM a</code>"}], "tags": [], "owner": {"reputation": 738, "user_id": 8075159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8709365a90d8a840b976b0f132f912e5?s=128&d=identicon&r=PG&f=1", "display_name": "Hogeyama", "link": "https://stackoverflow.com/users/8075159/hogeyama"}, "is_accepted": false, "score": -1, "last_activity_date": 1499676542, "creation_date": 1499676542, "answer_id": 45007551, "question_id": 45007042, "link": "https://stackoverflow.com/questions/45007042/how-to-convert-an-io-either-e-a-into-an-exceptt-e-m-a/45007551#45007551", "title": "How to convert an &quot;IO (Either e a) into an ExceptT e m a", "body": "<p>Use the constructor <code>ExceptT : m (Either e a) -&gt; ExceptT e m a</code></p>\n\n<pre><code>withTransaction :: AppM a -&gt; AppM a\nwithTransaction appm = do\n  conn &lt;- getDbConnection\n  env &lt;- getEnv\n  ExceptT $ PGS.withTransaction conn $ runAppM appm\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 258, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1499676542, "creation_date": 1499674806, "question_id": 45007042, "link": "https://stackoverflow.com/questions/45007042/how-to-convert-an-io-either-e-a-into-an-exceptt-e-m-a", "title": "How to convert an &quot;IO (Either e a) into an ExceptT e m a", "body": "<p>I'm using <a href=\"https://www.stackage.org/haddock/nightly-2017-03-01/mtl-2.2.1/Control-Monad-Except.html\" rel=\"nofollow noreferrer\">Control.Monad.Except</a> and am stuck in a place where I have to force execution of an <code>ExceptT AppError m a</code> action to obtain an <code>IO</code> action, and then to wrap it back again into an <code>ExceptT AppErr m a</code>. If you're wondering why this is required, it is because the underlying library function that I need to run, only accepts IO action. In this case it would be <code>Database.PostgreSQL.Simple.withTransaction :: Connection -&gt; IO a -&gt; IO a</code></p>\n\n<p>How do I write the conceptual equivalent of the following:</p>\n\n<pre><code>type AppM = ExceptT AppError (ReaderT Env (LoggingT IO))\n\nrunAppM :: Env -&gt; AppM a -&gt; a\n\nwithTransaction :: AppM a -&gt; AppM a\nwithTransaction appm = do\n  conn &lt;- getDbConnection\n  env &lt;- getEnv\n  liftIO $ PGS.withTransaction conn $ runAppM appm\n</code></pre>\n\n<p>Here's the error that I'm getting:</p>\n\n<pre><code>Excepted type: ExceptT AppError (ReadertT Env (LoggingT IO)) a\nActual type: ExceptT AppError (ReadertT Env (LoggingT IO)) (Either AppError a)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1499671165, "post_id": 45005813, "comment_id": 76985358, "body": "<code>any&lt;..&gt;Exception</code> is <code>const True</code> because it has a type signature constraining it to operate only on values of a particular type; every <code>SomeException</code> is &quot;any exception&quot; (since <code>SomeException</code> is the least upper bound of exception types) and clearly every <code>IOException</code> is an &quot;IO exception&quot;. <code>instanceOf</code> works because <code>typeOf</code> should not examine its argument; if it does, then the <code>Typeable</code> instance for that type is broken (probably an artifact from when you could manually write <code>Typeable</code> instances - that is not the case today, so <code>instanceOf = const undefined</code> would be just as good)."}, {"owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499671554, "post_id": 45005813, "comment_id": 76985612, "body": "@user2407038 how can <code>any&lt;..&gt;Exception</code> type signature constraint work at runtime? about <code>instanceOf</code> - how can compiler only by type signature derive that it must build function that  excerpt <code>a</code> from <code>(a -&gt; Bool)</code>?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499673726, "post_id": 45005813, "comment_id": 76986791, "body": "1) Because all exceptions are <code>Typeable</code>; the type of the actual exception thrown is compared against the type of the <code>Selector</code> (this logic is inside <code>try</code>), and if they match, the actual <code>Selector</code> function is applied to further select specific exceptions from those types. Thus, in the cases in question, every exception of the types <code>SomeException</code> and <code>IOException</code> will be selected. 2) I&#39;m not sure what you mean - the compiler (more specifically, typechecker) deriving information from type signatures is basically what it does..."}, {"owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499678418, "post_id": 45005813, "comment_id": 76989846, "body": "1) <code>any...Exception</code> - ok, <code>Typeable</code> allows to magically compare types in type signatures, so <code>anyIOException IOException</code> return <code>True</code>, will compiler return <code>False</code> on <code>anyIOException ArithException</code> or throw error once again? 2) now I completely confused what <code>instanceOf</code> doing and what will <code>typeOf</code> get from it, can you write some examples? and what you mean by <code>instanceOf works because typeOf should not examine its argument</code>? You can write it in answer"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1499682549, "post_id": 45005813, "comment_id": 76992638, "body": "1) <code>anyIOException (x::ArithException)</code> is ill-typed; this application would never happen. Again, the logic is in <code>try</code>; if the exception type selected by the <code>Selector</code> matches the one actually thrown, it will apply the selector to that function. Otherwise, <code>try</code> itself will rethrow the exception. 2) There are plenty of examples on how to use <code>Typeable</code> to be found on the internet. There is little I can say to elucidate how it works beyond the host of literature already available."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499720498, "post_id": 45005813, "comment_id": 77017329, "body": "This code seems to have a bit of ancient cruft in it. It should really use <code>typeRep</code> instead of <code>typeOf</code>, which would avoid this <code>undefined</code> nonsense altogether."}], "owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 252, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1499684557, "creation_date": 1499670794, "last_edit_date": 1499684557, "question_id": 45005813, "link": "https://stackoverflow.com/questions/45005813/how-does-hspecs-shouldthrow-work", "title": "How does hspec&#39;s shouldThrow work?", "body": "<p>From <a href=\"https://hackage.haskell.org/package/hspec-expectations-0.8.2/docs/src/Test-Hspec-Expectations.html#anyException\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>type Selector a = (a -&gt; Bool)\n\nshouldThrow :: (HasCallStack, Exception e) =&gt; IO a -&gt; Selector e -&gt; Expectation\naction `shouldThrow` p = do\n  r &lt;- try action\n  case r of\n    Right _ -&gt;\n      expectationFailure $\n        \"did not get expected exception: \" ++ exceptionType\n    Left e -&gt;\n      (`expectTrue` p e) $\n        \"predicate failed on expected exception: \" ++ exceptionType ++ \" (\" ++ show e ++ \")\"\n  where\n    -- a string repsentation of the expected exception's type\n    exceptionType = (show . typeOf . instanceOf) p\n      where\n        instanceOf :: Selector a -&gt; a\n        instanceOf _ = error \"Test.Hspec.Expectations.shouldThrow: broken Typeable instance\"\n\nanyException :: Selector SomeException\nanyException = const True\n</code></pre>\n\n<p>Specifically why <code>any...Exception</code> always return <code>True</code> and how <code>instanceOf</code> works? Are there any documentation that explains all this?</p>\n"}, {"tags": ["c", "haskell", "io", "posix"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2371524"}, "edited": false, "score": 3, "creation_date": 1499663590, "post_id": 45003503, "comment_id": 76982098, "body": "Reading your linked documentation, it seems <code>handleToFd()</code> closes the <i>handle</i>, so it can&#39;t be used any more (which makes sense, because it has its own buffering), but I don&#39;t think the FD itself is closed -- that wouldn&#39;t make much sense after all. Given this assumption is correct, just use <code>fdopen(dup(fd), ...)</code> in the C glue code and <code>fclose()</code> before control is passed back to haskell so you can be sure C <code>stdio</code> buffers won&#39;t cause problems as well."}, {"owner": {"reputation": 81, "user_id": 12302537, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-n4lgPjclylk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5stjaCA1yaJmEfPz6FQFLSSMi4w/photo.jpg?sz=128", "display_name": "\u9c8d\u51ef\u6587", "link": "https://stackoverflow.com/users/12302537/%e9%b2%8d%e5%87%af%e6%96%87"}, "edited": false, "score": 0, "creation_date": 1499664853, "post_id": 45003503, "comment_id": 76982487, "body": "Thanks, I&#39;ll give that a try."}], "owner": {"reputation": 81, "user_id": 12302537, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-n4lgPjclylk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc5stjaCA1yaJmEfPz6FQFLSSMi4w/photo.jpg?sz=128", "display_name": "\u9c8d\u51ef\u6587", "link": "https://stackoverflow.com/users/12302537/%e9%b2%8d%e5%87%af%e6%96%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1546807252, "creation_date": 1499658449, "last_edit_date": 1546807252, "question_id": 45003503, "link": "https://stackoverflow.com/questions/45003503/is-it-possible-to-switch-between-c-streams-i-e-file-and-haskell-handles", "title": "Is it possible to switch between C streams (i.e. FILE*) and Haskell Handles?", "body": "<p>I'm writing some C library bindings using <a href=\"https://www.stackage.org/lts-8.21/package/inline-c-0.5.6.1\" rel=\"nofollow noreferrer\">inline-c</a>, and some of the C functions take FILE* parameters. Is there a preferred way to convert a Haskell Handle to a FILE*? Or is this the wrong approach to interfacing with the library?</p>\n\n<p>My initial thoughts were to use <a href=\"https://www.stackage.org/haddock/lts-8.21/unix-2.7.2.1/System-Posix-IO.html#v:handleToFd\" rel=\"nofollow noreferrer\">handleToFd</a>\nto first convert a given Handle to a file-descriptor and then call fopen() to get a FILE* to pass to library functions. The docs for handleToFd state that using it on a Handle has the effect of flushing and closing it, so do do the aforementioned I'd have to record the state of the Handle(?) and reinstate it when calling fopen(). This seems like a bad idea to me because AFAIK there's no way to reopen a standard stream, and I might have to resort to black magic if I use Handle internals.</p>\n"}, {"tags": ["haskell", "io", "routing", "jack"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1499661529, "post_id": 45003110, "comment_id": 76981578, "body": "I can not reproduce your issue. Please consider making a MCVE, this would include imports, exclude <code>runAudioStuff</code>, and include you testing the example to ensure it still behaves incorrectly.  My version behaves fine - if yours does not then I suspect it is an issue with your terminal and not a Haskell issue at all."}], "answers": [{"tags": [], "owner": {"reputation": 93, "user_id": 2713180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6386cff106a78e4d498c4c88ec4909fe?s=128&d=identicon&r=PG&f=1", "display_name": "m88", "link": "https://stackoverflow.com/users/2713180/m88"}, "is_accepted": true, "score": 0, "last_activity_date": 1499666949, "creation_date": 1499666949, "answer_id": 45004819, "question_id": 45003110, "link": "https://stackoverflow.com/questions/45003110/haskell-concurrent-i-o-routing/45004819#45004819", "title": "Haskell -- Concurrent I/O Routing", "body": "<p>Implementation always matters.  It turns out that <code>runJack</code> called <code>waitForBreak</code> in Sound.JACK, which has the definition:</p>\n\n<pre><code> waitForBreak :: IO ()\n waitForBreak =\n     let go = getLine &gt;&gt; go\n     in  go\n</code></pre>\n\n<p>Using <code>collectInput</code> in its place solved the problem.</p>\n"}], "owner": {"reputation": 93, "user_id": 2713180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6386cff106a78e4d498c4c88ec4909fe?s=128&d=identicon&r=PG&f=1", "display_name": "m88", "link": "https://stackoverflow.com/users/2713180/m88"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 45004819, "answer_count": 1, "score": 2, "last_activity_date": 1499683854, "creation_date": 1499654978, "last_edit_date": 1499683854, "question_id": 45003110, "link": "https://stackoverflow.com/questions/45003110/haskell-concurrent-i-o-routing", "title": "Haskell -- Concurrent I/O Routing", "body": "<p>I am new to Haskell, and I'm not exactly sure how the concurrent I/O works.  I'm exploring what can be accomplished with the JACK audio bindings.  Basically, the following code is (almost) functional, but I need to press enter twice every time I input a value:</p>\n\n<pre><code>collectInput :: IORef Double -&gt; IO ()\ncollectInput freq = forever $ do\n        putStr \"&gt;&gt; \"\n        hFlush stdout\n        f &lt;- getLine\n        case readMaybe f of\n            Just x -&gt; do \n                putStrLn $ show x\n                writeIORef freq x\n            Nothing -&gt; do\n                 putStrLn \"Nada\"\n\n\nmain :: IO ()\nmain = do\n    freq &lt;- newIORef 440\n    _ &lt;- forkIO $ runJackStuff freq\n    collectInput freq\n</code></pre>\n\n<p>To clarify the problem:</p>\n\n<pre><code>Input  |  Result            | Output\n----------------------------------------\n\n330    | Frequency changes  | \"&gt;&gt; 330.0\"\n440    | Nothing happens    | \"\"\n220.0  | Frequency changes  | \"&gt;&gt; 220.0\"\n550.0  | Nothing happens    | \"\"\nbleh   | Outputs \"Nada\"     | \"&gt;&gt; Nada\"\n       | Nothing Happens    | \"\"\nfoo    | Outputs \"Nada\"     | \"&gt;&gt; Nada\"\n</code></pre>\n\n<p>I'm not sure, but it would seem that the IO stream is cycled through threads.  Is there a way to make the program read every line of input, instead of every other line?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1499645538, "post_id": 45002208, "comment_id": 76978440, "body": "what do you think <code>filterA ++ [(3 * n + 2)]</code> is doing?"}, {"owner": {"reputation": 325, "user_id": 7778287, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/87cafd6f0a91772ff3a9c1c568195f33?s=128&d=identicon&r=PG&f=1", "display_name": "user7778287", "link": "https://stackoverflow.com/users/7778287/user7778287"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1499648224, "post_id": 45002208, "comment_id": 76978916, "body": "I was thinking that it &#39;added&#39; to filterA. But now I believe it is creating a new list out of the two values on either side of ++."}], "answers": [{"tags": [], "owner": {"reputation": 383, "user_id": 3024170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c69db72fd6a246ba01bc7fc71348835?s=128&d=identicon&r=PG&f=1", "display_name": "YoshikuniJujo", "link": "https://stackoverflow.com/users/3024170/yoshikunijujo"}, "is_accepted": true, "score": 2, "last_activity_date": 1499733307, "last_edit_date": 1499733307, "creation_date": 1499647449, "answer_id": 45002379, "question_id": 45002208, "link": "https://stackoverflow.com/questions/45002208/do-blocks-in-haskell-not-behaving-as-expected/45002379#45002379", "title": "Do blocks in Haskell not behaving as expected", "body": "<p>To append list is not an action. <code>filterA ++ [3 * n + 2]</code> is not an action but an expression. It evaluates to list.</p>\n\n<p>You may want to use an IO monad. But the return type of the function you defined is List and not IO. In your definition, do block expresses a list monad and not an IO monad.</p>\n\n<p>And in Haskell, the value once defined is not to be changed.</p>\n\n<p>You may want to do following.</p>\n\n<pre><code>funA n = if not (elem n filterA)\n        then let\n                filterA' = filterA ++ [3 * n + 2]\n                filterB' = filterB ++ [3 * n + 2]\n                output' = output ++ [3 * n + 2] in\n                (filterA', filterB', output')\n        else (filterA, filterB, output)\n</code></pre>\n"}], "owner": {"reputation": 325, "user_id": 7778287, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/87cafd6f0a91772ff3a9c1c568195f33?s=128&d=identicon&r=PG&f=1", "display_name": "user7778287", "link": "https://stackoverflow.com/users/7778287/user7778287"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "accepted_answer_id": 45002379, "answer_count": 1, "score": 0, "last_activity_date": 1499733307, "creation_date": 1499645344, "question_id": 45002208, "link": "https://stackoverflow.com/questions/45002208/do-blocks-in-haskell-not-behaving-as-expected", "title": "Do blocks in Haskell not behaving as expected", "body": "<pre><code>filterA = [3]\nfilterB = [2]\noutput = []\n\nfunA n =\nif not (elem (n) filterA)\n    then do  \n        filterA ++ [(3 * n + 2) ] \n        filterB ++ [(3 * n + 2) ]\n        output ++ [(3 * n + 2)]\n        else output\n</code></pre>\n\n<p>It seems some imperative habits must be kicking in...</p>\n\n<p>The point of this code is to add a value to <code>filterA</code>, <code>filterB</code> and <code>output</code>, so long as <code>n</code> is not part of the corresponding filter list (for this function it's <code>filterA</code>). Accepted inputs are added to both filters, even though the B function (which would look similar) is not shown here.</p>\n\n<p>I am clearly misunderstanding the way <code>do</code> works, as a result that runs through the <code>do</code> block in this code gives back something like this: </p>\n\n<p><code>*Main&gt; funA 4\n [14,14,14,14]</code></p>\n\n<p>I'm not understanding how adding to separate lists in a <code>do</code> block is getting all mixed up. How do I perform multiple actions under the same function without them interfering with each other?</p>\n\n<p>To add to that, if I remove one of the <code>filterA ++ [(3 ...</code> lines the result becomes <code>[14,14]</code> and removing both gives the desired result <code>[14]</code>, minus of course concatenating values to <code>filterA</code> or <code>filterB</code>. But something about having both of them produces four replicates. </p>\n\n<p>TL:DR How do I execute multiple separate actions inside of a <code>do</code> block? Is it possible to understand without going in depth into monads? Am a missing a more simple solution?</p>\n"}, {"tags": ["haskell", "stm", "tvar"], "comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1499669715, "post_id": 45001744, "comment_id": 76984557, "body": "See also <a href=\"https://stackoverflow.com/questions/4235348/converting-io-int-to-int\" title=\"converting io int to int\">stackoverflow.com/questions/4235348/converting-io-int-to-int</a>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1499641887, "creation_date": 1499641887, "answer_id": 45001900, "question_id": 45001744, "link": "https://stackoverflow.com/questions/45001744/tvar-constructor-i-cant-get-a-tvar/45001900#45001900", "title": "TVar constructor? I can&#39;t get a TVar", "body": "<p>Allocating locks requires doing IO, and you can't get around that. So admit it in the type for your action:</p>\n\n<pre><code>rwconst :: Integer -&gt; IO Rwlock\nrwcost n = do\n    rcount &lt;- newTVarIO 0\n    wcount &lt;- newTVarIO 0\n    return Rwlock { readCant = rcount, writeCant = wcount, maxLectores = n }\n</code></pre>\n\n<p>Then, in <code>main</code>, you can write something like this:</p>\n\n<pre><code>main = do\n    a &lt;- rwconst 10\n    forkIO (reader a)\n    forkIO (writer a)\n    -- and you should do something to wait for reader and writer to finish\n</code></pre>\n"}], "owner": {"reputation": 98, "user_id": 8280524, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ada099973841c714725c41cddca1a306?s=128&d=identicon&r=PG&f=1", "display_name": "Pernoctador", "link": "https://stackoverflow.com/users/8280524/pernoctador"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 45001900, "answer_count": 1, "score": -2, "last_activity_date": 1499641887, "creation_date": 1499640220, "question_id": 45001744, "link": "https://stackoverflow.com/questions/45001744/tvar-constructor-i-cant-get-a-tvar", "title": "TVar constructor? I can&#39;t get a TVar", "body": "<p>I'm new at haskell and stm and i wanted to make a simple rwlock. First I created the 4 main functions (wlock, wunlock, rlock, runlock) that requires 2 TVar Integeres: the amount of reading threads and writing threads.</p>\n\n<p>At this point I can't use it as intended. I try to compile like this</p>\n\n<pre><code>v1 &lt;- atomically(newTVar 0);\nv2 &lt;- atomically(newTVar 0);\nwlock v1 v2 -- wlock :: TVar Integer -&gt; TVar Integer -&gt; IO ()\n</code></pre>\n\n<p>wich of course is ugly, but it works (not sure why because atomically returns <code>IO (TVar a)</code> instead of <code>TVar a</code>)</p>\n\n<p><strong>What I want:</strong></p>\n\n<p>I'm trying to make it better by hidding the values. I read somewhere that monads might be the way to go, but I haven't study them yet. Instead, I try to make a new type Rwlock as</p>\n\n<pre><code>data Rwlock = Rwlock {  readCant :: TVar Integer \n    ,writeCant :: TVar Integer\n}\n</code></pre>\n\n<p>and a constructor, so I can do something like this:</p>\n\n<pre><code>import Rwlock\n\ndo{\n    a = rwconst;\n    forkIO(reader a);\n    forkIO(writer a);\n}\n</code></pre>\n\n<p>where reader will call <code>rlock a</code>, and writer <code>wlock a</code>.</p>\n\n<p><strong>The problem:</strong></p>\n\n<p>I can't make the constructor. This is what I try (ignore <code>maxLectores</code> )</p>\n\n<p>(A):</p>\n\n<pre><code>rwconst :: Integer -&gt; Rwlock\nrwconst n = Rwlock {readCant = TVar 0, writeCant = TVar 0, maxLectores = n}\n{-rwconst n = Rwlock {readCant = atomically(newTVar 0), writeCant = atomically(newTVar 0), maxLectores = n}-}\n</code></pre>\n\n<p>But TVar constructor is not exported, and nothing returns a TVar. I don't know why the first block of code works when I do <code>wlock v1 v2</code>, but this way it doesn't.</p>\n\n<p>And (B):</p>\n\n<pre><code>rwconst :: Integer -&gt; Rwlock\nrwconst n = do\n    a &lt;- (atomically(newTVar 0));\n    Rwlock {readCant = a, writeCant = a, maxLectores = n}\n</code></pre>\n\n<p>Here Rwlock doesn't have a problem, but the do statement returns IO(), instead of Rwlock as I want, and I can't found how to do it :(</p>\n\n<p>Anyone can tell me the way to do it? Thanks in advance.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1499640310, "post_id": 45001689, "comment_id": 76977541, "body": "Your <code>(###)</code> is essentially flipped <code>fmap</code>. The type of <code>fmap</code> is <code>Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code>; it becomes <code>(a -&gt; b) -&gt; Maybe a -&gt; Maybe b</code> once you specialise it to <code>Maybe</code>. See also <a href=\"https://stackoverflow.com/q/42674517/2751851\">this somewhat similar question</a>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1499645527, "post_id": 45001689, "comment_id": 76978438, "body": "Note that <a href=\"http://hackage.haskell.org/package/lens-4.15.3/docs/Control-Lens-Lens.html#v:-60--38--62-\" rel=\"nofollow noreferrer\"><code>(&lt;&amp;&gt;)</code></a> is a generalized version of <code>(###)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "edited": false, "score": 0, "creation_date": 1499646478, "post_id": 45001922, "comment_id": 76978632, "body": "Thanks. I had a feeling it had something to do with Functors :) I didn&#39;t like the right to left processing order though. <code>&lt;&amp;&gt;</code> mentioned in a comment by Alec solves the problem."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1499642070, "creation_date": 1499642070, "answer_id": 45001922, "question_id": 45001689, "link": "https://stackoverflow.com/questions/45001689/bind-function-alternative-without-explicitly-returning-to-monad/45001922#45001922", "title": "Bind function alternative without explicitly returning to Monad", "body": "<p>Congratulations, you just invented <code>Functor</code>s! Check out the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Base.html#line-652\" rel=\"nofollow noreferrer\">source</a> for the <code>Functor</code> instance for <code>Maybe</code>:</p>\n\n<pre><code>instance  Functor Maybe  where\n    fmap _ Nothing       = Nothing\n    fmap f (Just a)      = Just (f a)\n</code></pre>\n\n<p>It is one of the lesser-mentioned monad laws that <code>m &gt;&gt;= return . f = fmap f m</code> -- a sort of \"coherence\" law between the monad actions and the functor action.</p>\n\n<p><code>fmap</code> also has an infix alias, <code>(&lt;$&gt;)</code>, so you could write</p>\n\n<pre><code>main = print ((+3) &lt;$&gt; (*2) &lt;$&gt; (*3) &lt;$&gt; Just 10)\n</code></pre>\n\n<p>and this outputs <code>Just 63</code>.</p>\n"}], "owner": {"reputation": 11366, "user_id": 672018, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/02deb8d589e1c74650bc334394529571?s=128&d=identicon&r=PG&f=1", "display_name": "Andrzej Gis", "link": "https://stackoverflow.com/users/672018/andrzej-gis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 45001922, "answer_count": 1, "score": 2, "last_activity_date": 1499642070, "creation_date": 1499639636, "question_id": 45001689, "link": "https://stackoverflow.com/questions/45001689/bind-function-alternative-without-explicitly-returning-to-monad", "title": "Bind function alternative without explicitly returning to Monad", "body": "<p>I'm just beginning to play with Haskell (just learned the bind function). I like the way it allows to chain subsequent operations left to right inside a Monad.</p>\n\n<p>I'm wondering if there is a way to write the code below more nicely?</p>\n\n<pre><code>main = do\n    print $ Just 10 \n        &gt;&gt;= (\\x -&gt; return (x*2))\n        &gt;&gt;= (\\x -&gt; return (x*3))\n</code></pre>\n\n<p>It feels like the lambdas and return could be replaced with some kind of partially applied function. I was thinking about something like that:</p>\n\n<pre><code>(###) :: Maybe Int -&gt; (Int -&gt; Int) -&gt; Maybe Int\n(Just x) ### f = Just (f x)\nNothing ### f = Nothing\n\nmain = do\n    print $ Just 10 \n        &gt;&gt;= (\\x -&gt; return (x*2))\n        &gt;&gt;= (\\x -&gt; return (x*3))\n        ### (+3) -- the result should be (Just 63)\n</code></pre>\n\n<p>Which of course is ugly, non-generic and doesn't compile :) :</p>\n\n<pre><code>monads.hs:8:13:\n    Couldn't match expected type `a0 -&gt; Maybe b0'\n                with actual type `Maybe Int'\n    In the second argument of `(&gt;&gt;=)', namely\n      `(\\ x -&gt; return (x * 3)) ### (+ 3)'\n    In the second argument of `($)', namely\n      `Just 10 &gt;&gt;= (\\ x -&gt; return (x * 2))\n       &gt;&gt;= (\\ x -&gt; return (x * 3)) ### (+ 3)'\n    In a stmt of a 'do' block:\n      print\n      $ Just 10 &gt;&gt;= (\\ x -&gt; return (x * 2))\n        &gt;&gt;= (\\ x -&gt; return (x * 3)) ### (+ 3)\n\nmonads.hs:8:14:\n    Couldn't match expected type `a1 -&gt; m0 a1'\n                with actual type `Maybe Int'\n    The lambda expression `\\ x -&gt; return (x * 3)' has one argument,\n    but its type `Maybe Int' has none\n    In the first argument of `(###)', namely `(\\ x -&gt; return (x * 3))'\n    In the second argument of `(&gt;&gt;=)', namely\n      `(\\ x -&gt; return (x * 3)) ### (+ 3)'\n</code></pre>\n\n<p>Anyway, it seems to be a useful tool, to be able to chain a sequence of operations inside a monad without worrying too much about intermediate results (no do-notation) and without explicitly instructing the code when to fallback to Nothing.</p>\n\n<ol>\n<li>Is there a built-in function for that?</li>\n<li>If not, how should I change my <code>###</code> function to be generic, dandy and compile?</li>\n</ol>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 6255674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e1f08713330e67540f83a3d95c7c8d9?s=128&d=identicon&r=PG&f=1", "display_name": "Pranay Sashank", "link": "https://stackoverflow.com/users/6255674/pranay-sashank"}, "is_accepted": true, "score": 2, "last_activity_date": 1499750553, "creation_date": 1499750553, "answer_id": 45025990, "question_id": 45001259, "link": "https://stackoverflow.com/questions/45001259/yesod-scaffolding-project-stack-build-automatic-removal-of-my-package-in-cabal/45025990#45025990", "title": "Yesod Scaffolding Project: Stack Build automatic removal of my package in cabal file", "body": "<p>You shouldn't edit <code>.cabal</code> file while using <code>hpack</code>. The Yesod scaffolding uses stack with hpack. hpack generates your .cabal file by reading the <code>package.yaml</code> file. Add your package to the <code>dependencies</code> section in the package.yaml file, it then gets added to .cabal file during build.</p>\n"}], "owner": {"reputation": 5139, "user_id": 705510, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7xrNQ.png?s=128&g=1", "display_name": "McBear Holden", "link": "https://stackoverflow.com/users/705510/mcbear-holden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 45025990, "answer_count": 1, "score": 3, "last_activity_date": 1499750553, "creation_date": 1499636174, "question_id": 45001259, "link": "https://stackoverflow.com/questions/45001259/yesod-scaffolding-project-stack-build-automatic-removal-of-my-package-in-cabal", "title": "Yesod Scaffolding Project: Stack Build automatic removal of my package in cabal file", "body": "<p>In the project cabal file, I have added a package.\nBut whenever I run <code>stack build</code> or <code>stack exec -- yesod devel</code>, the package got removed from cabal automatically.</p>\n\n<p>Why is this?</p>\n"}, {"tags": ["haskell", "colors", "winghci"], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1499678379, "post_id": 45001474, "comment_id": 76989819, "body": "I wish more people knew about <code>ansi-terminal</code>. Unlike just outputting hard-coded ANSI escapes, the <code>ansi-terminal</code> package works on Windows and Linux transparently. (With some caveats...)"}, {"owner": {"reputation": 103, "user_id": 5264184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cf8b8d3dac9663ab01c6804fa807a94?s=128&d=identicon&r=PG&f=1", "display_name": "Ove Ahlman", "link": "https://stackoverflow.com/users/5264184/ove-ahlman"}, "edited": false, "score": 0, "creation_date": 1499769347, "post_id": 45001474, "comment_id": 77037763, "body": "Yes, this seems like sometihng I can use... Took some time to figure out exactly how to get it all installed though... Thanks."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 2, "last_activity_date": 1499637821, "creation_date": 1499637821, "answer_id": 45001474, "question_id": 45000593, "link": "https://stackoverflow.com/questions/45000593/changing-output-colours-of-specific-chars-in-winghci/45001474#45001474", "title": "Changing output colours of specific chars in WinGHCi", "body": "<p>You may find the <a href=\"https://hackage.haskell.org/package/ansi-terminal-0.6.3.1\" rel=\"nofollow noreferrer\"><code>ansi-terminal</code></a> package interesting. It lets you easily change the foreground colour, background colour, style, etc. For example, here is a function which will print out the string you give it in bold red, with a green background.</p>\n\n<pre><code>import System.Console.ANSI\n\nearlyChristmas :: String -&gt; IO ()\nearlyChristmas s = do\n  setSGR [ SetConsoleIntensity BoldIntensity\n         , SetColor Foreground Vivid Red\n         , SetColor Background Dull Green\n         ]\n  putStr s\n  setSGR [ Reset ]\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 5264184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cf8b8d3dac9663ab01c6804fa807a94?s=128&d=identicon&r=PG&f=1", "display_name": "Ove Ahlman", "link": "https://stackoverflow.com/users/5264184/ove-ahlman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 45001474, "answer_count": 1, "score": 0, "last_activity_date": 1499637821, "creation_date": 1499631188, "question_id": 45000593, "link": "https://stackoverflow.com/questions/45000593/changing-output-colours-of-specific-chars-in-winghci", "title": "Changing output colours of specific chars in WinGHCi", "body": "<p>So I am trying to make an ASCII chess game for Haskell. When thinking about how to represent the chesspieces I think that giving the letters different colours would be a nice way.</p>\n\n<p>Thus I need someway, in the haskell code, to specify which color a certain output character should be. Is there such a package ready for me which I just have not found? Or is there some quite easy way to do it? </p>\n\n<p>Or are there other suggestions on how to do this representation of  chesspiececolor? My first thought of a workaround was to do wP, wB, bK for white peon, white bishop and black king but I think it looks quite cluttery.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499627380, "post_id": 44999869, "comment_id": 76973915, "body": "You can&#39;t prettify it, it isn&#39;t ugly to begin with!"}, {"owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499627688, "post_id": 44999869, "comment_id": 76974009, "body": "So give it empty string is normal behavior, im asking just because DList has function <code>toList dl = unDL dl []</code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1499633146, "post_id": 44999869, "comment_id": 76975749, "body": "The canonical function to convert <code>ShowS</code> to <code>String</code> is <code>($ &quot;&quot;)</code>. What more do you need?"}, {"owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499668065, "post_id": 44999869, "comment_id": 76983747, "body": "@dfeuer love it, exactly what I needed)"}], "answers": [{"comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1499633993, "post_id": 45000093, "comment_id": 76976037, "body": "I think this is a bit unfair. Sure, the type <code>String -&gt; String</code> allows functions to inspect the argument, but the idea of the <code>ShowS</code> type is that it represents strings as difference lists, with the convention that the argument is the remaining string and not looked at. This might not be manifest on the type level, and limits of the Haskell type class system prevent <code>instance Show ShowS</code>, but for any \u201claw-abiding\u201d value of <code>ShowS</code>, approach 3 is sensible."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "edited": false, "score": 0, "creation_date": 1499641320, "post_id": 45000093, "comment_id": 76977735, "body": "@bjornmelgaard You&#39;ve already used it: <code>showsToString f = f &quot;&quot;</code>. It&#39;s so simple it&#39;s not even worth giving a name."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1499641438, "post_id": 45000093, "comment_id": 76977755, "body": "@JoachimBreitner I would object to such an instance appearing in the standard libraries, for the reasons I listed. I would be much less hesitant to allow an instance if <code>ShowS</code> were an abstract type whose operations all respected the law (that there exists string <code>s</code> for which the function is extensionally equal to <code>(s++)</code>), but that isn&#39;t the world we live in."}, {"owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "edited": false, "score": 0, "creation_date": 1499668038, "post_id": 45000093, "comment_id": 76983734, "body": "@DanielWagner , dont like hand-made gratuitous functions) love dfeuer answer"}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1499755330, "post_id": 45000093, "comment_id": 77028280, "body": "I agree with that! We can\u2019t have that instance in the world we live in, but there is an instance we would like to have, if we could."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1499627783, "creation_date": 1499627783, "answer_id": 45000093, "question_id": 44999869, "link": "https://stackoverflow.com/questions/44999869/best-way-to-convert-shows-to-string/45000093#45000093", "title": "Best way to convert ShowS to String?", "body": "<p>You can't <code>show $ displayS blah</code> because <code>ShowS</code> isn't an instance of <code>Show</code>. Recall that</p>\n\n<pre><code>type ShowS = String -&gt; String\n</code></pre>\n\n<p>so if we wanted an instance of <code>Show</code> we would have to write:</p>\n\n<pre><code>instance Show (String -&gt; String) where\n    show f = ...\n</code></pre>\n\n<p>And now we have a bit of a problem. After all, the only thing we can do with the function <code>f</code>, really, is call it with <code>String</code> arguments. There's a couple choices that spring to mind readily, but they each have drawbacks:</p>\n\n<ol>\n<li>Try to describe the behavior of <code>f</code> on every possible input. This isn't going to work very well -- there's infinitely many inputs. Reading and understanding the infinite output would take a longish time.</li>\n<li>Don't bother calling <code>f</code> at all. Pick a single <code>String</code> to be the output of <code>show</code>, as in <code>show f = \"&lt;it's a function, lol&gt;\"</code>. This isn't terribly useful because it doesn't actually give you any information about <code>f</code>.</li>\n<li>Call <code>f</code> with the distinguished string <code>\"\"</code>. This isn't useful because there are lots of different functions that give the same output for that input, and you won't be able to distinguish between them. (Maybe it so happens that your library for cooking up <code>ShowS</code> values won't have that problem, but if we're going to have the instance it ought to work for values that come from anywhere, not just some tiny subset of the values!)</li>\n</ol>\n\n<p>Because of these considerations, an instance of <code>Show</code> for functions is not included in the standard libraries, though approaches (1) and (2) are available for installation from Hackage.</p>\n"}], "owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "accepted_answer_id": 45000093, "answer_count": 1, "score": 1, "last_activity_date": 1499668468, "creation_date": 1499626310, "last_edit_date": 1499668468, "question_id": 44999869, "link": "https://stackoverflow.com/questions/44999869/best-way-to-convert-shows-to-string", "title": "Best way to convert ShowS to String?", "body": "<p>How to to prettify </p>\n\n<pre><code>(displayS $ renderPretty 0.8 80 $ _errDoc ei &lt;&gt; linebreak) \"\"\n</code></pre>\n\n<p>why I cant </p>\n\n<pre><code>show $ displayS $ renderPretty 0.8 80 $ _errDoc ei &lt;&gt; linebreak\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 0, "creation_date": 1499624525, "post_id": 44999591, "comment_id": 76973144, "body": "so I can switch back to older versions?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "edited": false, "score": 1, "creation_date": 1499624827, "post_id": 44999591, "comment_id": 76973225, "body": "@Randomize If it&#39;s for testing, I would suggest you to <a href=\"https://github.com/psibi/download/blob/master/.travis.yml\" rel=\"nofollow noreferrer\">use a CI system like Travis</a> for supporting old compilers. If you still want to install locally, the only way to do is download the old compiler from <a href=\"https://www.haskell.org/ghc/download.html\" rel=\"nofollow noreferrer\">here</a> and try doing it. But it will be a slightly painful process."}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 1, "last_activity_date": 1499625042, "last_edit_date": 1499625042, "creation_date": 1499624376, "answer_id": 44999591, "question_id": 44999540, "link": "https://stackoverflow.com/questions/44999540/switching-through-different-versions-of-ghc-included-7-0-4/44999591#44999591", "title": "Switching through different versions of GHC included 7.0.4", "body": "<p>No, you cannot have stack use ghc 7.0.4 because it's not in their snapshot. The oldest compiler stack supports is 7.8.3.</p>\n\n<p>Theoretically, stack can provide support for older compilers, but the <a href=\"https://www.fpcomplete.com/blog/2014/08/announcing-stackage-server\" rel=\"nofollow noreferrer\">Stackage server</a> was announced at August, 2014 and GHC 7.0.4 was <a href=\"https://www.haskell.org/ghc/download_ghc_7_0_4.html\" rel=\"nofollow noreferrer\">released on June, 2011</a>. That's my educated guess of why 7.0.4 is not present.</p>\n\n<p>If you want your code to have support for older compilers, I would recommend you to use a <a href=\"https://github.com/psibi/download/blob/master/.travis.yml\" rel=\"nofollow noreferrer\">CI system like Travis</a>. Another alternative if you are using a Ubuntu machine is to use <a href=\"https://launchpad.net/~hvr/+archive/ubuntu/ghc\" rel=\"nofollow noreferrer\">Herber's PPA</a> for installing the older compilers.</p>\n"}, {"tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": false, "score": 0, "last_activity_date": 1499781815, "last_edit_date": 1499781815, "creation_date": 1499781300, "answer_id": 45036585, "question_id": 44999540, "link": "https://stackoverflow.com/questions/44999540/switching-through-different-versions-of-ghc-included-7-0-4/45036585#45036585", "title": "Switching through different versions of GHC included 7.0.4", "body": "<p>Do you really need stack to build the project, i.e. <code>stack.yaml</code> and <code>stack build</code>?</p>\n\n<p>If it is not the case and you just want multiple ghc versions, you might want to try </p>\n\n<ol>\n<li><strong>nix</strong>, it have various ghc <a href=\"https://github.com/NixOS/nixpkgs/tree/master/pkgs/development/compilers/ghc\" rel=\"nofollow noreferrer\">versions</a>.</li>\n</ol>\n\n<p>But keep in mind that older than 8.0.2 is not officially <a href=\"https://github.com/NixOS/nixpkgs/issues/26468#issuecomment-311724007\" rel=\"nofollow noreferrer\">support</a> but it might still working.</p>\n\n<ol start=\"2\">\n<li><p><strong>docker</strong>, use it to setup any version you want</p></li>\n<li><p><strong>travis</strong>, as previous <a href=\"https://stackoverflow.com/a/44999591/1664572\">answer</a> suggested. </p></li>\n</ol>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1499781815, "creation_date": 1499623954, "last_edit_date": 1499624865, "question_id": 44999540, "link": "https://stackoverflow.com/questions/44999540/switching-through-different-versions-of-ghc-included-7-0-4", "title": "Switching through different versions of GHC included 7.0.4", "body": "<p>I need to compile some code starting from the GHC version 7.0.4 until the most recent 8.0.2.\nI know that using <code>stack</code> I can do something like:</p>\n\n<p><code>stack init --resolver lts ...</code></p>\n\n<p>on the local project but the <code>lts</code> versions don't go further than GHC 7.8.3.</p>\n\n<p>How can I switch back to older version of GHC without using <code>stack</code>?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 0, "creation_date": 1499603066, "post_id": 44996288, "comment_id": 76966664, "body": "Possible duplicate for question <b>(1)</b>: <a href=\"https://stackoverflow.com/questions/44724662/using-network-http-simple-httpjson-in-ghci\" title=\"using network http simple httpjson in ghci\">stackoverflow.com/questions/44724662/&hellip;</a> but it still doesnt help me with <b>(2)</b>"}, {"owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "edited": false, "score": 0, "creation_date": 1499667646, "post_id": 44996288, "comment_id": 76983570, "body": "Why downvote? Is there something I could have improved in the question?"}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1499625109, "creation_date": 1499625109, "answer_id": 44999695, "question_id": 44996288, "link": "https://stackoverflow.com/questions/44996288/what-in-the-parse-body-code-makes-the-header-read-to-not-fail/44999695#44999695", "title": "What in the parse body code makes the header read to not fail?", "body": "<h3>Type checking</h3>\n\n<p>We have this signature: <a href=\"https://hackage.haskell.org/package/http-conduit-2.2.3.1/docs/Network-HTTP-Simple.html#v:getResponseBody\" rel=\"nofollow noreferrer\"><code>getResponseBody :: Response a -&gt; a</code></a>.</p>\n\n<p>At first, just after <code>httpJSON</code>, we have <code>response :: Response a0</code> for some yet unknown <code>a0</code>. </p>\n\n<p>Then we write <code>getResponseBody response</code>, which has type <code>a0</code>, still unknown.</p>\n\n<p>Then we annotate <code>getResponseBody response :: Value</code>, so <code>a0 ~ Value</code>, and now instance resolution has a concrete type to work with.</p>\n\n<h3>Alternative ways to restrict the type of <code>response</code></h3>\n\n<p>You can annotate the <code>response</code> value directly wherever it gets used, for instance you could write <code>getResponseStatusCode (response :: Response Value)</code> in the middle of your snippet.</p>\n\n<p>With the <code>ScopedTypeVariables</code> extension, you can also annotate the pattern which binds it: <code>(response :: Response Value) &lt;- httpJSON \"...\"</code>.</p>\n\n<p>The <code>a0</code> type variable also occurs in the result type of <code>httpJSON</code>, so you can also annotate it.</p>\n\n<pre><code>response &lt;- httpJSON \"...\" :: IO (Response Value)\n</code></pre>\n\n<p>With <code>TypeApplications</code>, here are more alternatives, any one should be sufficient for the type checker to deduce <code>a0 ~ Value</code>:</p>\n\n<pre><code>response &lt;- httpJSON @_ @Value \"...\"\n\ngetResponseStatusCode @Value response\ngetResponseHeader @Value \"...\" response\ngetResponseBody @Value response\n</code></pre>\n"}], "owner": {"reputation": 1698, "user_id": 4050510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f3123195051caa2f71674df0798284b0?s=128&d=identicon&r=PG", "display_name": "LudvigH", "link": "https://stackoverflow.com/users/4050510/ludvigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 44999695, "answer_count": 1, "score": 0, "last_activity_date": 1499625109, "creation_date": 1499602581, "last_edit_date": 1499603166, "question_id": 44996288, "link": "https://stackoverflow.com/questions/44996288/what-in-the-parse-body-code-makes-the-header-read-to-not-fail", "title": "What in the parse body code makes the header read to not fail?", "body": "<p>I am trying to build a simple web scraper to get some corpus of text from wikipedia. I would like to use their REST API building a simple HTTP client in Haskell.</p>\n\n<p>To do so, I've turned to the Network.HTTP.Simple package.  In their <a href=\"https://haskell-lang.org/library/http-client\" rel=\"nofollow noreferrer\">tutorial</a> they provide the following snippet, which i can get to run nicely.</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack --install-ghc --resolver lts-5.13 runghc\n    --package http-conduit\n    --package yaml\n-}\n{-# LANGUAGE OverloadedStrings #-}\nimport           Data.Aeson            (Value)\nimport qualified Data.ByteString.Char8 as S8\nimport qualified Data.Yaml             as Yaml\nimport           Network.HTTP.Simple\n\nmain :: IO ()\nmain = do\n    response &lt;- httpJSON \"http://httpbin.org/get\"\n\n    putStrLn $ \"The status code was: \" ++\n               show (getResponseStatusCode response)\n    print $ getResponseHeader \"Content-Type\" response\n    S8.putStrLn $ Yaml.encode (getResponseBody response :: Value)\n</code></pre>\n\n<p>Trying to understand the code I commented out the last line (the one starting <code>S8.putStrLn</code>..., and now the code breaks. The error is </p>\n\n<pre><code>No instance for (Yaml.FromJSON a0) arising from a use of \u2018httpJSON\u2019\n    The type variable \u2018a0\u2019 is ambiguous\n    Note: there are several potential instances:\n      instance Yaml.FromJSON\n                 aeson-1.2.1.0:Data.Aeson.Types.Internal.DotNetTime\n        -- Defined in \u2018aeson-1.2.1.0:Data.Aeson.Types.FromJSON\u2019\n      instance Yaml.FromJSON Value\n        -- Defined in \u2018aeson-1.2.1.0:Data.Aeson.Types.FromJSON\u2019\n      instance Yaml.FromJSON\n                 attoparsec-0.13.1.0:Data.Attoparsec.Number.Number\n        -- Defined in \u2018aeson-1.2.1.0:Data.Aeson.Types.FromJSON\u2019\n      ...plus 78 others\n</code></pre>\n\n<p>So my questions are: \n<strong>(1)</strong> So my guess is that the <code>getResponseBody</code> forces the type signature of <code>httpJSON</code>, so the ambiguity is lifted. But how?\n<strong>(2)</strong> Can I disambiguate the expression without calling <code>getResponseBody</code>? What options do I have to fix the return type of polymorphic functions?</p>\n\n<p><strong>Edit:</strong> I am running this with <code>cabal run</code> since i have not installed Stack. I did not expect that to change things, but who knows... Might provide a clue.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1499609966, "post_id": 44996195, "comment_id": 76968648, "body": "With <code>x :: Num a =&gt; a</code> you define an ad-hoc polymorphic type and with <code>x = (1.0 :: Double)</code> you immediately &quot;convert&quot; it to a monomorphic type when binding a value of that type to a variable. This doesn&#39;t make sense. If you want <code>x</code> to be of type <code>Double</code>, then define it as such in the first place."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1499634901, "post_id": 44996195, "comment_id": 76976299, "body": "Another, identical, way to write <code>x :: Num a =&gt; a</code> is <code>x :: forall a. Num a =&gt; a</code>."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499680071, "post_id": 44996195, "comment_id": 76991017, "body": "<code>g</code> does not get to &quot;choose&quot; what type to return; <i>the caller</i> gets to choose. The type signature claims that <code>g</code> can return any possible number type... but actually it always returns <code>Double</code>. So the type signature is lying."}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 2851270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f5240120fe0ff8850dfecc0bb6c70f?s=128&d=identicon&r=PG&f=1", "display_name": "user2851270", "link": "https://stackoverflow.com/users/2851270/user2851270"}, "edited": false, "score": 1, "creation_date": 1499604016, "post_id": 44996325, "comment_id": 76966923, "body": "That makes perfect sense and unifies the two cases: the specific type is always selected by the caller. It would even be possible to define <code>x</code> so that it would also be a function: <code>x :: Num a =&gt; () -&gt; a</code> and <code>x = \\ () -&gt; 1</code>. Thanks!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1499609904, "last_edit_date": 1499609904, "creation_date": 1499602799, "answer_id": 44996325, "question_id": 44996195, "link": "https://stackoverflow.com/questions/44996195/constrained-polymorphism-variable-vs-function-parameter/44996325#44996325", "title": "Constrained polymorphism: variable vs. function parameter", "body": "<p>You should read the type <code>g :: Num a =&gt; a -&gt; a</code> as follows:</p>\n\n<ul>\n<li>the caller of <code>g</code> chooses a type <code>a</code></li>\n<li>the caller must prove that <code>a</code> is a numeric type</li>\n<li>the caller must provide an argument value of type <code>a</code></li>\n<li><code>g</code> must then answer with a result value of type <code>a</code></li>\n</ul>\n\n<p>Hence, <code>x :: Num a =&gt; a</code> becomes</p>\n\n<ul>\n<li>the user of <code>x</code> chooses a type <code>a</code></li>\n<li>the user must prove that <code>a</code> is a numeric type</li>\n<li><code>x</code> must then answer with a result value of type <code>a</code></li>\n</ul>\n\n<p>So, <code>x</code> is not allowed to pick <code>a = Double</code>, the user of <code>x</code> gets to choose that.\nThink e.g. of <code>(x :: Int) + 4</code>: this will type check, picking <code>a=Int</code>. The implementation of <code>x</code> must be general, so to work on all the numeric type.</p>\n\n<p>Incidentally, note that numeric literals have the same type <code>42 :: Num a =&gt; a</code>, this is why we are allowed to use them as <code>Double</code>, as <code>Int</code>, or any other numeric type.</p>\n"}], "owner": {"reputation": 121, "user_id": 2851270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f5240120fe0ff8850dfecc0bb6c70f?s=128&d=identicon&r=PG&f=1", "display_name": "user2851270", "link": "https://stackoverflow.com/users/2851270/user2851270"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 44996325, "answer_count": 1, "score": 2, "last_activity_date": 1499609904, "creation_date": 1499601764, "question_id": 44996195, "link": "https://stackoverflow.com/questions/44996195/constrained-polymorphism-variable-vs-function-parameter", "title": "Constrained polymorphism: variable vs. function parameter", "body": "<p>This is a very basic question. I have just started studying Haskell using a couple of different sources. There is something I can't currently decipher from these.</p>\n\n<p>The following will naturally typecheck just fine.</p>\n\n<pre><code>g :: Num a =&gt; a -&gt; a\ng x = x + 2\nh = g (1.0 :: Double)\n</code></pre>\n\n<p>This example of constrained polymorphism makes complete sense to me when I interpret it as follows: as long as the parameter provided to <code>g</code> is of the type that has a <code>Num</code> instance, everything is ok.</p>\n\n<p>So, consider the following.</p>\n\n<pre><code>x :: Num a =&gt; a\n</code></pre>\n\n<p>If I interpret this as above, I get: <code>x</code> can take any value of a type that has a <code>Num</code> instance. However, the following will <em>not</em> typecheck.</p>\n\n<pre><code>x :: Num a =&gt; a\nx = (1.0 :: Double)\n</code></pre>\n\n<p>My question is: what is <em>exactly</em> the difference here?</p>\n\n<p>I <em>sort of</em> get what <em>might be</em> happening: in the second example, <code>x</code> is defined so that it will evaluate to any <code>Num</code>, and  <code>(1.0 :: Double)</code> does not qualify.</p>\n\n<p>But my vague idea is far from being a complete explanation, and I am looking for a better one.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 2, "creation_date": 1499601793, "post_id": 44996183, "comment_id": 76966277, "body": "What is the question here?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1499603699, "post_id": 44996183, "comment_id": 76966840, "body": "Your example is just a function calling another function. That&#39;s not higher order, which would require taking a function as an argument or returning a function from a function."}, {"owner": {"reputation": 157, "user_id": 7631220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/42ac4a8aebbc6491db718dbd189c78ba?s=128&d=identicon&r=PG&f=1", "display_name": "Babas", "link": "https://stackoverflow.com/users/7631220/babas"}, "edited": false, "score": 0, "creation_date": 1499606718, "post_id": 44996183, "comment_id": 76967700, "body": "Ok, may be I&#39;m confused, I thought that I was doing higher order by calling sum2 in the argument of sum3. It&#39;s my first day in Haskell and I am clearing mixing up some concepts. Thanks for your answer."}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 7631220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/42ac4a8aebbc6491db718dbd189c78ba?s=128&d=identicon&r=PG&f=1", "display_name": "Babas", "link": "https://stackoverflow.com/users/7631220/babas"}, "edited": false, "score": 0, "creation_date": 1499606403, "post_id": 44996418, "comment_id": 76967625, "body": "Thank you Chi, may be I&#39;m confused about how to call declare and call functions but you example helped me. Have a nice day :)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1499603483, "creation_date": 1499603483, "answer_id": 44996418, "question_id": 44996183, "link": "https://stackoverflow.com/questions/44996183/haskell-high-order-functions/44996418#44996418", "title": "Haskell High Order Functions", "body": "<p>There is no question, but I'll guess the OP wants some explanation about why this is not working:</p>\n\n<pre><code>Sum3 :: (Double -&gt; Double -&gt; Double) -&gt; Double -&gt; Double    \nSum3 a b c = (Sum2 a b) + c\n</code></pre>\n\n<p>First, functions should have a lowercase name. Second, the type above is the type of a function with two arguments:</p>\n\n<pre><code>sum3 :: (Double -&gt; Double -&gt; Double) -&gt; Double -&gt; Double    \n        ----- first arg ------------    -2nd--    -result type-\n</code></pre>\n\n<p>So, one should write</p>\n\n<pre><code>sum3 f a = ...\n</code></pre>\n\n<p>where <code>f</code> is the function passed as first argument <code>Double -&gt; Double -&gt; Double</code>, and <code>a</code> is the second argument number. Since <code>f</code> is a function taking two arguments, we need to use it accordingly, e.g.</p>\n\n<pre><code>sum3 f a = f a a\n-- or\nsum3 f a = f a 12\n-- or\nsum3 f a = f (a+12) (f 32 a)\n</code></pre>\n\n<p>I have no idea about what you are trying to achieve, the above ones are only examples.</p>\n\n<p>Finally, the name <code>sum3</code> is unintuitive, we should use something else.</p>\n"}], "owner": {"reputation": 157, "user_id": 7631220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/42ac4a8aebbc6491db718dbd189c78ba?s=128&d=identicon&r=PG&f=1", "display_name": "Babas", "link": "https://stackoverflow.com/users/7631220/babas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 44996418, "answer_count": 1, "score": 0, "last_activity_date": 1499603483, "creation_date": 1499601678, "question_id": 44996183, "link": "https://stackoverflow.com/questions/44996183/haskell-high-order-functions", "title": "Haskell High Order Functions", "body": "<p>I'm a little bit confuse about high order function and I wanted to do a stupid example to see if I understood well but still I can't compile without errors, i.e I guess I'm missing something. My very basic example is as follow, I create a function that adds up two number, and then I create an other function which uses my previous function and sum up an other number.</p>\n\n<pre><code>Sum2 :: Double -&gt; Double -&gt; Double  \nSum2  a b = a + b\n\nSum3 :: (Double -&gt; Double -&gt; Double) -&gt; Double -&gt; Double    \nSum3 a b c = (Sum2 a b) + c\n\n\ntest1:: Double\ntest1 = Sum3 2.0 3.0 4.0\n</code></pre>\n"}, {"tags": ["debugging", "haskell", "ghci"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499595997, "post_id": 44995269, "comment_id": 76964765, "body": "Idea: <code>:force _result</code>. Alas, that doesn&#39;t seem to alter the state of the debugger..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1499596994, "post_id": 44995269, "comment_id": 76965042, "body": "Can you set a breakpoint and continue?"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1499595000, "creation_date": 1499595000, "question_id": 44995269, "link": "https://stackoverflow.com/questions/44995269/ghci-debugger-how-to-step-out-of-the-current-expression", "title": "GHCi debugger: how to step out of the current expression?", "body": "<p>In your typical imperative debugger, if you end up inside a function you don't care about, you can \"step out\" of the function (i.e., execute until you end up somewhere else). How do you do that with the GHCi debugger?</p>\n\n<p>Of course, lazy evaluation makes this... a little weird. But I think it's well-defined in my case.</p>\n\n<p>(I'm stepping through some code I wrote, and I've ended up inside Parsec. Well I already know my parser works OK, so I just want to step over the entire parser to the bit where it returns a result &mdash; which I <em>believe</em> happens \"in one go\", if you will. How do I skip to that point?)</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 1, "creation_date": 1500450923, "post_id": 44994989, "comment_id": 77336398, "body": "For future reference, you can find functions <i>by type</i> with <a href=\"https://www.haskell.org/hoogle/?hoogle=Monad+m+%3D%3E+%28a+-%3E+m+b%29+-%3E+%5Ba%5D+-%3E+m+%28%29\" rel=\"nofollow noreferrer\">Hoogle</a>"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1499593327, "last_edit_date": 1499593327, "creation_date": 1499593227, "answer_id": 44994998, "question_id": 44994989, "link": "https://stackoverflow.com/questions/44994989/are-there-any-operator-in-haskell-that-fold-list-of-actions-with/44994998#44994998", "title": "Are there any operator in Haskell that fold list of actions with (&gt;&gt;)?", "body": "<p>You can simply use <a href=\"http://hackage.haskell.org/packages/archive/base/latest/doc/html/Prelude.html#v:mapM-95-\" rel=\"noreferrer\"><strong><code>mapM_ :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m ()</code></strong></a> for that:</p>\n\n<pre><code>mapM_ test [arg1,arg2,arg3,arg4]\n</code></pre>\n\n<p>Or if you really want to write it infix:</p>\n\n<pre><code>test `mapM_` [ arg1\n             , arg2\n             , arg3\n             , arg4\n             ]\n</code></pre>\n"}], "owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 44994998, "answer_count": 1, "score": 3, "last_activity_date": 1499593420, "creation_date": 1499593133, "last_edit_date": 1499593420, "question_id": 44994989, "link": "https://stackoverflow.com/questions/44994989/are-there-any-operator-in-haskell-that-fold-list-of-actions-with", "title": "Are there any operator in Haskell that fold list of actions with (&gt;&gt;)?", "body": "<p>I want some operator <code>&lt;?&gt;</code> that could transform this</p>\n\n<pre><code>test arg1 &gt;&gt;\ntest arg2 &gt;&gt;\ntest arg3 &gt;&gt;\ntest arg4\n</code></pre>\n\n<p>to this</p>\n\n<pre><code>test &lt;?&gt; [ arg1\n         , arg2\n         , arg3\n         , arg4\n         ]\n</code></pre>\n"}, {"tags": ["list", "haskell", "fold"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1499710590, "post_id": 44993377, "comment_id": 77012042, "body": "Are you sure the exercise doesn&#39;t ask you to use <code>foldr</code>? Implementing <code>takeWhile</code> using <code>foldl</code> makes no sense. Implementing it with <code>foldr</code> is relatively simple."}, {"owner": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1499876639, "post_id": 44993377, "comment_id": 77099345, "body": "The exercise didn&#39;t mention which fold to use."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1499581397, "post_id": 44993551, "comment_id": 76961665, "body": "This implements <code>filter</code>, not <code>takeWhile</code>."}, {"owner": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "edited": false, "score": 0, "creation_date": 1499581739, "post_id": 44993551, "comment_id": 76961744, "body": "<code>myTakeWhile&#39; f xs = foldr (\\x rs  -&gt; if f x then x:rs else []) [] xs</code> works, although i wanted to know what is wrong in the where step expression that i have written"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499582427, "post_id": 44993551, "comment_id": 76961873, "body": "You should also mention that <code>foldl</code> is the wrong fold to use for <code>takeWhile</code>: <code>foldr</code> is much more suitable."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499582585, "post_id": 44993551, "comment_id": 76961903, "body": "@amalloy that&#39;s also true, I will mention, thanks a lot again!"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "edited": false, "score": 0, "creation_date": 1499584651, "post_id": 44993551, "comment_id": 76962276, "body": "@PiyushDivyankar , I made an important edit to the answer that you should be looking at, that&#39;s why you had the errors using foldl"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499584688, "post_id": 44993551, "comment_id": 76962283, "body": "@amalloy, I made another edit, that&#39;s why you were talking about when you said &quot;more suitable&quot;?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499589840, "post_id": 44993551, "comment_id": 76963324, "body": "Try your <code>foldr</code> version like this: <code>takeWhile&#39; (&lt; 10) [1..]</code>, and then try the same thing with your <code>foldl</code> version."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499589967, "post_id": 44993551, "comment_id": 76963340, "body": "@amalloy I got the point, not need to try... mmm, I will take another rid on it.... Very good point"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499590178, "post_id": 44993551, "comment_id": 76963387, "body": "<code>foldl</code> is never productive on infinite lists, while <code>foldr</code> can be if the folding function is non-strict in its second argument."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499590433, "post_id": 44993551, "comment_id": 76963437, "body": "@amalloy aaaaah, I can see now, I was breaking my brain, but it was worth the time! So, the approach with a non infinite list, using reverse with foldl, is valid?"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1499590751, "post_id": 44993551, "comment_id": 76963497, "body": "I mean, sure, it will work, but it is strictly worse for no good reason."}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499591417, "post_id": 44993551, "comment_id": 76963625, "body": "@amalloy I really really grateful, I learned a lot of things with your comments!"}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": true, "score": 4, "last_activity_date": 1499890006, "last_edit_date": 1499890006, "creation_date": 1499580924, "answer_id": 44993551, "question_id": 44993377, "link": "https://stackoverflow.com/questions/44993377/how-do-i-write-takewhile-using-foldl/44993551#44993551", "title": "How do I write takeWhile using foldl?", "body": "<blockquote>\n  <p>Edit</p>\n</blockquote>\n\n<p>1) Your main error, is that you are not understanding that <code>fold</code> does the recursion for you, you don't have to self reference the function <code>myTakeWhile'</code>, also, fold has another type: </p>\n\n<pre><code>foldl: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre>\n\n<p>your type error in the step function on where clause is because of it.</p>\n\n<p>2) Your second error, because of the definition of <code>foldl</code>, your <code>takeWhile</code> will be created from the end to the beginning, so, you should have to reverse the list <strong>(all this only because you are asking how to do it with foldl)</strong></p>\n\n<p>You can do this by using a simple <code>lambda</code> and an <code>if else</code>, is a little more readable:</p>\n\n<pre><code>myTakeWhile' f xs = foldl (\\rs x -&gt; if f x then x:rs else []) [] (reverse xs)\n</code></pre>\n\n<p>example:</p>\n\n<pre><code>myTakeWhile' (&lt;10) [1..20]\n</code></pre>\n\n<blockquote>\n  <p>[1,2,3,4,5,6,7,8,9]</p>\n</blockquote>\n\n<p>However, with this, you just can't go over infinite list, like this:</p>\n\n<pre><code>myTakeWhile' (&lt;10) [1..]\n</code></pre>\n\n<p>It will hangs trying to create all the unevaluated expression.</p>\n\n<p>Anyway, if you want to use <code>guards</code> and <code>where</code>, you should do it like this:</p>\n\n<pre><code>myTakeWhile f xs = foldl step [] (reverse xs)\n  where step rs x | f x = x : rs\n                  | otherwise = []\n</code></pre>\n\n<p><strong>3) Most important of all:</strong></p>\n\n<p>As @amalloy says, <code>takeWhile</code> is much more suitable if you implement it by using <strong><code>foldr</code></strong> :). Understand the differences between the two is crucial in some cases one using one or another can cause you <strong>performance</strong> issues, for that, you can read this question:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/3082324/foldl-versus-foldr-behavior-with-infinite-lists\">foldl versus foldr behavior with infinite lists</a></p>\n\n<p><strong>4) Finally, the correct alternative using <code>foldr</code>:</strong></p>\n\n<pre><code>myTakeWhile'' f xs = foldr (\\x rs -&gt; if f x then x:rs else []) [] xs\n</code></pre>\n\n<p>with this, you can use infinite list:</p>\n\n<pre><code>myTakeWhile' (&lt;10) [1..]\n</code></pre>\n\n<p>You can see the difference of how it makes the folds like this:</p>\n\n<pre><code>Prelude&gt; foldr (\\x y -&gt; concat [\"(\",x,\"+\",y,\")\"]) \"0\" (map show [1..13])\n\"(1+(2+(3+(4+(5+(6+(7+(8+(9+(10+(11+(12+(13+0)))))))))))))\"\n\nPrelude&gt; foldl (\\x y -&gt; concat [\"(\",x,\"+\",y,\")\"]) \"0\" (map show [1..13])\n\"(((((((((((((0+1)+2)+3)+4)+5)+6)+7)+8)+9)+10)+11)+12)+13)\"\n</code></pre>\n\n<p>This sources from <a href=\"https://wiki.haskell.org/Fold\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Fold</a></p>\n"}], "owner": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 444, "favorite_count": 0, "accepted_answer_id": 44993551, "answer_count": 1, "score": 3, "last_activity_date": 1499890006, "creation_date": 1499578991, "last_edit_date": 1499584770, "question_id": 44993377, "link": "https://stackoverflow.com/questions/44993377/how-do-i-write-takewhile-using-foldl", "title": "How do I write takeWhile using foldl?", "body": "<p>So I am doing exercises from real world haskell book and I wrote following code for takeWhile function using foldl. </p>\n\n<pre><code>myTakeWhile' :: (a-&gt;Bool) -&gt; [a] -&gt; [a]\nmyTakeWhile' f xs = foldl step [] xs\n    where step x xs | f x       = x:(myTakeWhile' f xs)\n                    | otherwise = []\n</code></pre>\n\n<p>This gives the following error, which I am unable to understand. </p>\n\n<pre><code>Couldn't match type \u2018a\u2019 with \u2018[a]\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for myTakeWhile' :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\n          at p1.hs:17:17\n    Expected type: [a] -&gt; [a] -&gt; [a]\n      Actual type: a -&gt; [a] -&gt; [a]\n    Relevant bindings include\n      step :: a -&gt; [a] -&gt; [a] (bound at p1.hs:19:11)\n      xs :: [a] (bound at p1.hs:18:16)\n      f :: a -&gt; Bool (bound at p1.hs:18:14)\n      myTakeWhile' :: (a -&gt; Bool) -&gt; [a] -&gt; [a] (bound at p1.hs:18:1)\n    In the first argument of \u2018foldl\u2019, namely \u2018step\u2019\n    In the expression: foldl step [] xs\n</code></pre>\n"}, {"tags": ["list", "haskell", "memory"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499573249, "post_id": 44992558, "comment_id": 76960437, "body": "You&#39;ve already identified the underlying cause of this behaviour: &quot;both sum and length can lazily consume the list as a stream, while the seq will be triggering the evaluation of the whole list, which must then be stored&quot;. If you want to know what exactly is the source of the allocation, you should profile the program with GHCs profiler, not <code>time</code>, which is obviously fairly rudimentary. It is impossible to say how to avoid it without seeing the actual program; in this simple case, it is obviously to use <code>sum l</code> instead of <code>seq (length l) (sum l)</code>."}, {"owner": {"reputation": 15, "user_id": 7896339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d497e83b5f78c85841279d6b406494ee?s=128&d=identicon&r=PG&f=1", "display_name": "Gozz", "link": "https://stackoverflow.com/users/7896339/gozz"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499573963, "post_id": 44992558, "comment_id": 76960518, "body": "Thanks for the suggestion. I forgot to mention I had already done this. I will edit the post to be more clear, but profiling reveals that 100% of allocations are performed when computing <code>handle.l</code>. The issue here is I can&#39;t see what it could possibly be doing to require just shy of 8 GB of working memory to compute a 400 MB list."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1499575711, "post_id": 44992558, "comment_id": 76960784, "body": "My back-of-the envelope estimate looks like this: You have 1e8 elements / list nodes. Every list node consists of a pointer to type information (8 bytes), a constructor tag (probably 8 bytes too because of alignment), and a pointer to the actual <code>Int</code> value (8 bytes). Every <code>Int</code> consists of a pointer to type information (8 bytes) and the numeric value (8 bytes). That&#39;s <code>1e8 * (8 * 5) &#47; 1e9 = 1.3</code> gigabytes of data right there, without taking lazy evaluation into account."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499576009, "post_id": 44992558, "comment_id": 76960831, "body": "You would expect simply manifesting the list to take at least <code>4*400MB</code> of space (see <a href=\"https://wiki.haskell.org/GHC/Memory_Footprint\" rel=\"nofollow noreferrer\">here</a>); but you are not simply manifesting it. This is seemingly the source of your misunderstanding; a list representing 400MB of data simply will not take 400MB of space. If you genuinely need to stream data of this size, you will almost certainly need to use a streaming abstraction to get the performance you&#39;re looking for."}, {"owner": {"reputation": 15, "user_id": 7896339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d497e83b5f78c85841279d6b406494ee?s=128&d=identicon&r=PG&f=1", "display_name": "Gozz", "link": "https://stackoverflow.com/users/7896339/gozz"}, "edited": false, "score": 0, "creation_date": 1499576820, "post_id": 44992558, "comment_id": 76960938, "body": "Sorry if I am being unclear. I am aware of the overhead, just I would expect the overhead to be a smaller factor than 20. The memory footprint page you linked is very helpful, and I will keep it on hand for the future, and very nearly answers my question: It specifies that an <code>[Int]</code> is 5 N + 1 <i>words</i>. At 8 bytes per word on 64-bit arch, that gives 40 bytes per element, so we would expect my list of 10^8 to be 4 GB. This is still only half of what I am seeing in practise, but is close enough to satisfy my curiosity."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 7896339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d497e83b5f78c85841279d6b406494ee?s=128&d=identicon&r=PG&f=1", "display_name": "Gozz", "link": "https://stackoverflow.com/users/7896339/gozz"}, "edited": false, "score": 0, "creation_date": 1499598543, "post_id": 44994800, "comment_id": 76965433, "body": "Thanks for the detailed response. I think this information will be valuable to anyone who encounters this behaviour (a large part of the reason I made this post), so I am going to mark it as the answer. You may be interested in seeing my most recent edit, where I like to the code that triggers this behaviour in my case."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 1, "last_activity_date": 1499591537, "creation_date": 1499591537, "answer_id": 44994800, "question_id": 44992558, "link": "https://stackoverflow.com/questions/44992558/haskell-list-generator-high-memory-usage/44994800#44994800", "title": "Haskell List Generator High Memory Usage", "body": "<p>There are multiple factors that come to play here. The first one is that GHC will lazily lift <code>l</code> out of <code>handle</code>. This would enable <code>handle</code> to reuse <code>l</code>, so that you don't have to recalculate it every time, but in this case it creates a space leak. You can check this if you <code>-ddump-simpl</code>ified core:</p>\n\n<pre><code>Main.handle_l :: [Int]                                                   \n[GblId,                                                                  \n Str=DmdType,                                                            \n Unf=Unf{Src=&lt;vanilla&gt;, TopLvl=True, Value=False, ConLike=False,         \n         WorkFree=False, Expandable=False, Guidance=IF_ARGS [] 40 0}]    \nMain.handle_l =                                                          \n  case Main.handle3 of _ [Occ=Dead] { GHC.Types.I# y_a1HY -&gt;             \n  GHC.Enum.eftInt 0 y_a1HY                                               \n  }\n</code></pre>\n\n<p>The functionality to calculate the <code>[0..10^7]</code> <sup><sub>1</sub></sup> is hidden away in other functions, but essentially, <code>handle_l = [0..10^7]</code>, at top-level (<code>TopLvl=True</code>). It won't get reclaimed, since you may or may not use <code>handle</code> again. If we use <code>handle s = show $ length l</code>, <code>l</code> itself will be inlined. You will not find any <code>TopLvl=True</code> function that has type <code>[Int]</code>.</p>\n\n<p>So GHC detects that you use <code>l</code> twice and creates a top-level CAF. How big is that CAF? An <code>Int</code> takes two words:</p>\n\n<pre><code>data Int = I# Int#\n</code></pre>\n\n<p>One for <code>I#</code>, one for <code>Int#</code>. How much for <code>[Int]</code>?</p>\n\n<pre><code>data [a] = [] | (:) a ([a]) -- pseudo, but similar\n</code></pre>\n\n<p>That's one word for <code>[]</code>, and three words for <code>(:) a ([a])</code>. A list of <code>[Int]</code> with size N will therefore have a total size of (3N + 1) + 2N words, in your case 5N+1 words. Given your memory, I assume a word is 8byte on your plattform, so we end up with</p>\n\n<pre><code>5 * 10^8 * 8 bytes = 4 000 000 000 bytes\n</code></pre>\n\n<p>So how do we get rid of that list? The first option we have is to get rid of <code>l</code>:</p>\n\n<pre><code>handle _ = show $ seq (length [0..10^8]) (sum [0..10^8])\n</code></pre>\n\n<p>This will now run in constant memory due to <code>foldr/buildr</code> rules. While we have <code>[0..10^8]</code> there twice, they don't share the same name. If we check the <code>-s</code>tats, we will see that it runs in constant memory:</p>\n\n<pre><code>&gt; SO.exe +RTS -s                                                                \n5000000050000000   4,800,066,848 bytes allocated in the heap                    \n         159,312 bytes copied during GC                                         \n          43,832 bytes maximum residency (2 sample(s))                          \n          20,576 bytes maximum slop                                             \n               1 MB total memory in use (0 MB lost due to fragmentation)        \n\n                                     Tot time (elapsed)  Avg pause  Max pause   \n  Gen  0      9154 colls,     0 par    0.031s   0.013s     0.0000s    0.0000s   \n  Gen  1         2 colls,     0 par    0.000s   0.000s     0.0001s    0.0002s   \n\n  INIT    time    0.000s  (  0.000s elapsed)                                    \n  MUT     time    4.188s  (  4.232s elapsed)                                    \n  GC      time    0.031s  (  0.013s elapsed)                                    \n  EXIT    time    0.000s  (  0.001s elapsed)                                    \n  Total   time    4.219s  (  4.247s elapsed)                                    \n\n  %GC     time       0.7%  (0.3% elapsed)                                       \n\n  Alloc rate    1,146,284,620 bytes per MUT second                              \n\n  Productivity  99.3% of total user, 98.6% of total elapsed\n</code></pre>\n\n<p>But that's not really nice, since we now have to track all the uses of <code>[0..10^8]</code>. What if we create a function instead?</p>\n\n<pre><code>handle :: String -&gt; String\nhandle _ = show $ seq (length $ l ()) (sum $ l ())\n  where\n    {-# INLINE l #-}\n    l _ = [0..10^7] :: [Int]\n</code></pre>\n\n<p>This works, but we <strong>must</strong> inline <code>l</code>, otherwise we get the same problem as before if we use opti&shy;miza&shy;tions. <code>-O1</code> (and <code>-O2</code>) enable <code>-ffull-laziness</code>, which&mdash;together with common sub&shy;expres&shy;sion eli&shy;mi&shy;na&shy;tion&mdash;would lift <code>l ()</code> to the top. So we either need to inline it or use <code>-O2 -fno-full-laziness</code> to prevent that behaviour.</p>\n\n<hr>\n\n<p><sup><sub>1</sub></sup> Had to decrease the list size, otherwise I would have started swapping.</p>\n"}], "owner": {"reputation": 15, "user_id": 7896339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d497e83b5f78c85841279d6b406494ee?s=128&d=identicon&r=PG&f=1", "display_name": "Gozz", "link": "https://stackoverflow.com/users/7896339/gozz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 44994800, "answer_count": 1, "score": 1, "last_activity_date": 1499598430, "creation_date": 1499569026, "last_edit_date": 1499598430, "question_id": 44992558, "link": "https://stackoverflow.com/questions/44992558/haskell-list-generator-high-memory-usage", "title": "Haskell List Generator High Memory Usage", "body": "<p>While working on a competitive programming problem I discovered an interesting issue that drastically reduced the performance of some of my code. After much experimentation I have managed to reduce the issue to the following minimal example:</p>\n\n<pre><code>module Main where\n\nmain = interact handle\n\nhandle :: String -&gt; String\n-- handle s = show $ sum l\n-- handle s = show $ length l\n-- handle s = show $ seq (length l) (sum l)\n  where\n    l = [0..10^8] :: [Int]\n</code></pre>\n\n<p>If you uncomment each commented line individually, compile with <code>ghc -O2 test.hs</code> and run with <code>time ./test &gt; /dev/null</code>, you should get something like the following:</p>\n\n<p>For <code>sum l</code>:</p>\n\n<pre><code>0.02user 0.00system 0:00.03elapsed 93%CPU (0avgtext+0avgdata 3380maxresident)k\n0inputs+0outputs (0major+165minor)pagefaults 0swaps\n</code></pre>\n\n<p>For <code>length l</code>:</p>\n\n<pre><code>0.02user 0.00system 0:00.02elapsed 100%CPU (0avgtext+0avgdata 3256maxresident)k\n0inputs+0outputs (0major+161minor)pagefaults 0swaps\n</code></pre>\n\n<p>For <code>seq (length l) (sum l)</code>:</p>\n\n<pre><code>5.47user 1.15system 0:06.63elapsed 99%CPU (0avgtext+0avgdata 7949048maxresident)k\n0inputs+0outputs (0major+1986697minor)pagefaults 0swaps\n</code></pre>\n\n<p>Look at that huge increase in peak memory usage. This makes some amount of sense, because of course both sum and length can lazily consume the list as a stream, while the <code>seq</code> will be triggering the evaluation of the whole list, which must then be stored. But the <code>seq</code> version of the code is using just shy of 8 GB of memory to handle a list that contains just 400 MB of actual data. The purely functional nature of Haskell lists could explain some small constant factor, but a 20 fold increase in memory seems unintended.</p>\n\n<p>This behaviour can be triggered by a number of things. Perhaps the easiest way is using <code>force</code> from <code>Control.DeepSeq</code>, but the way in which I originally encountered this was while using <code>Data.Array.IArray</code> (I can only use the standard library) and trying to construct an array from a list. The implementation of <code>Array</code> is monadic, and so was forcing the evaluation of the list from which it was being constructed.</p>\n\n<p>If anyone has any insight into the underlying cause of this behaviour, I would be very interested to learn why this happens. I would of course also appreciate any suggestions as to how to avoid this issue, bearing in mind that I have to use just the standard library in this case, and that every <code>Array</code> constructor takes and eventually forces a list.</p>\n\n<p>I hope you find this issue as interesting as I did, but hopefully less baffling.</p>\n\n<p><strong>EDIT:</strong> user2407038's comment made me realize I had forgotten to post profiling results. I have tried profiling this code and the profiler simply states that 100% of allocations are performed in <code>handle.l</code>, so it seems that simply anything that forces the evaluation of the list uses huge amounts of memory. As I mentioned above, using the <code>force</code> function from <code>Control.DeepSeq</code>, constructing an <code>Array</code>, or anything else that forces the list causes this behaviour. I am confused as to why it would ever require 8 GB of memory to compute a list containing 400 MB of data. Even if every element in the list required two 64-bit pointers, that is still only a factor of 5, and I would think GHC would be able to do something more efficient than that. If not this is an obvious bottleneck for the <code>Array</code> package, as constructing any array inherently requires us to allocate far more memory than the array itself.</p>\n\n<p>So, ultimately: Does anyone have any idea why forcing a list requires such huge amounts of memory, which has such a high cost on performance?</p>\n\n<p><strong>EDIT:</strong> user2407038 provided a link to the very helpful <a href=\"https://wiki.haskell.org/GHC/Memory_Footprint\" rel=\"nofollow noreferrer\">GHC Memory Footprint</a> reference. This explains exactly the data sizes of everything, and almost entirely explains the huge overhead: An <code>[Int]</code> is specified as requiring 5N+1 words of memory, which at 8 bytes per word gives 40 bytes per element. In this example that would suggest 4 GB, which accounts for half the total peak usage. It is easy to then believe that the evaluation of sum would then add a similar factor, so this answers my question.</p>\n\n<p>Thanks to all commenters for your help.</p>\n\n<p><strong>EDIT:</strong> As I mentioned above, I originally encountered this behaviour why trying to construct an <code>Array</code>. Having had a bit of a dig into <a href=\"https://hackage.haskell.org/package/base-4.0.0.0/docs/src/GHC-Arr.html#unsafeArray&#39;\" rel=\"nofollow noreferrer\"><code>GHC.Arr</code></a> I have found what I think is the root cause of this behaviour when constructing an array: The constructor folds over the list to compose a program in the ST monad that it then runs. Obviously the ST can't be executed until it is completely composed, and in this case the ST construct will be large and linear in the size of the input. To avoid this behaviour we would have to somehow modify the constructor to stream elements from the list as it adds them in ST.</p>\n"}, {"tags": ["templates", "haskell"], "owner": {"reputation": 31, "user_id": 8277073, "user_type": "registered", "profile_image": "https://graph.facebook.com/1396669157091196/picture?type=large", "display_name": "Pedro Garcia Herradon", "link": "https://stackoverflow.com/users/8277073/pedro-garcia-herradon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1499545988, "creation_date": 1499545988, "question_id": 44990507, "link": "https://stackoverflow.com/questions/44990507/trouble-while-compiling-the-next-code-in-haskell-splicing-in-template-haskell", "title": "Trouble while compiling the next code in haskell (splicing in template haskell)", "body": "<p>I am getting this problem that happens while using inside a splice a variable/function that is not yet defined at compile time when checking the splice.\nBut I would like to ask if there is any way to do it so I can get the same result. The code is this one:</p>\n\n<pre><code>passFun :: Name -&gt; Int -&gt; [a] -&gt; ([a],[b])\npassFun f_name n list = (list, (passFunAux f_name n list))\n\npassFunAux :: Name -&gt; Int -&gt; [a] -&gt; [b]\npassFunAux _ _ [] = []\npassFunAux f_name n (t:ts)= y:(passFunAux f_name n ts)\n     where y = testP f_name n t\n\ntestP :: Name -&gt; Int -&gt; a -&gt; b\ntestP f_name n t = []\ntestP f_name n t = $(lamE (tupleParam (listVar n)) (body f_name (listVar n))) t\n</code></pre>\n\n<p>The code is supposed to get as input the name of the function, its number of input parameters and a list of tuples of n components each. Then this function calculates the output of the function for each of those tuples of inputs and returns a list of all the outputs.</p>\n\n<pre><code>GHC stage restriction:\n      `n' is used in a top-level splice or annotation,\n      and must be imported, not defined locally\n    In the splice:\n      $(lamE (tupleParam (listVar n)) (body f_name (listVar n)))\n</code></pre>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 223, "user_id": 8198583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X2yJ0.png?s=128&g=1", "display_name": "ncaq", "link": "https://stackoverflow.com/users/8198583/ncaq"}, "is_accepted": true, "score": 1, "last_activity_date": 1499586488, "last_edit_date": 1499586488, "creation_date": 1499583458, "answer_id": 44993872, "question_id": 44989460, "link": "https://stackoverflow.com/questions/44989460/overwrite-response-header-in-yesod/44993872#44993872", "title": "Overwrite response header in Yesod", "body": "<p><code>addHeader</code> implementation by Writer.\n<a href=\"https://www.stackage.org/haddock/lts-8.21/yesod-core-1.4.35/src/Yesod.Core.Handler.html#addHeaderInternal\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/lts-8.21/yesod-core-1.4.35/src/Yesod.Core.Handler.html#addHeaderInternal</a></p>\n\n<p>It's not possible using <code>addHeader</code>.</p>\n\n<p>It can be achieved by using <a href=\"https://www.stackage.org/haddock/lts-8.21/yesod-core-1.4.35/Yesod-Core-Handler.html#v:sendWaiResponse\" rel=\"nofollow noreferrer\"><code>sendWaiResponse</code></a> and creating <code>Response</code> by hand, but it's messy.</p>\n"}], "owner": {"reputation": 69847, "user_id": 3853934, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GtQuz.jpg?s=128&g=1", "display_name": "Micha\u0142 Per\u0142akowski", "link": "https://stackoverflow.com/users/3853934/micha%c5%82-per%c5%82akowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 44993872, "answer_count": 1, "score": 3, "last_activity_date": 1499586488, "creation_date": 1499538323, "last_edit_date": 1499585944, "question_id": 44989460, "link": "https://stackoverflow.com/questions/44989460/overwrite-response-header-in-yesod", "title": "Overwrite response header in Yesod", "body": "<p>How can I overwrite previously set response header in Yesod? When I use the <a href=\"https://hackage.haskell.org/package/yesod-core-1.4.35/docs/Yesod-Core-Handler.html#v:addHeader\" rel=\"nofollow noreferrer\"><code>addHeader</code></a> function, it adds another header with the same name instead of overwriting it. For example, if inside a handler function I do this:</p>\n\n<pre><code>addHeader \"foo\" \"bar\"\naddHeader \"foo\" \"baz\"\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>foo: bar\nfoo: baz\n</code></pre>\n\n<p>but I want to get just</p>\n\n<pre><code>foo: baz\n</code></pre>\n\n<p>In my case, the header is an authentication token, and it works in a way that if it's present in the request, then I send it back in the response. I implemented this as a middleware. However, if it's a login request, a new token is generated, and it should be sent instead of the value from the request header.</p>\n"}, {"tags": ["haskell", "frp", "ghcjs", "reflex"], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "is_accepted": false, "score": 1, "last_activity_date": 1499537289, "creation_date": 1499537289, "answer_id": 44989309, "question_id": 44988826, "link": "https://stackoverflow.com/questions/44988826/conditionally-adding-dom-elements-with-reflex/44989309#44989309", "title": "Conditionally adding DOM elements with Reflex", "body": "<p>I've found the solution. The function <a href=\"https://hackage.haskell.org/package/reflex-dom-0.3/docs/Reflex-Dom-Widget-Basic.html#v:dyn\" rel=\"nofollow noreferrer\">dyn</a> can be used in those situations. Also see <a href=\"https://stackoverflow.com/questions/40481916/how-can-i-branch-on-the-value-inside-a-reflex-dynamic\">this other stackoverflow question</a>.</p>\n"}], "owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1499537289, "creation_date": 1499534180, "question_id": 44988826, "link": "https://stackoverflow.com/questions/44988826/conditionally-adding-dom-elements-with-reflex", "title": "Conditionally adding DOM elements with Reflex", "body": "<p>I have a function that receives a Dynamic and has to display a dom element which will contain a different kind of child depending on the value in the Dynamic. Is there a way to do such thing using Reflex and Reflex-Dom? The code would look like this if the value in the dynamic could be unwrapped by pattern matching:</p>\n\n<pre><code>myNode :: MonadWidget t m =&gt; Dynamic t Bool -&gt; m (Event t ())\nmyNode (Dynamic True) = elClass \"div\" \"foo\" $\n  elClass \"div\" \"bar\"\nmyNode (Dynamic False) = blank\n</code></pre>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "continuations"], "answers": [{"comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1499536766, "post_id": 44988812, "comment_id": 76953160, "body": "I feel the state-forgetting behaviour should be the default one, not just for uniformity with <code>WriterT</code>, but to enforce the intuitive rule that the effects of inner monads &quot;have priority&quot; in some sense."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1499535097, "last_edit_date": 1499535097, "creation_date": 1499534086, "answer_id": 44988812, "question_id": 44988528, "link": "https://stackoverflow.com/questions/44988528/statet-over-cont-why-is-my-state-not-being-reset/44988812#44988812", "title": "StateT over Cont. Why is my state not being reset?", "body": "<p>(I feel this is not a completely satisfactory answer, but at least it should clarify a little.)</p>\n\n<p>I believe this is because of the lifting of <code>callCC</code>. In the state monad case, after chasing the rabbit down the hole, we meet this:</p>\n\n<blockquote>\n<pre><code>liftCallCC :: CallCC m (a, s) (b, s) -&gt; CallCC (StateT s m) a b\n</code></pre>\n  \n  <p>Uniform lifting of a callCC operation to the new monad. This version\n  rolls back to the original state on entering the continuation.</p>\n\n<pre><code>liftCallCC' :: CallCC m (a, s) (b, s) -&gt; CallCC (StateT s m) a b\n</code></pre>\n  \n  <p>In-situ lifting of a callCC operation to the new monad. This version\n  uses the current state on entering the continuation.</p>\n</blockquote>\n\n<p>Which one is taken? The one preserving state:</p>\n\n<pre><code>instance MonadCont m =&gt; MonadCont (LazyState.StateT s m) where\n    callCC = LazyState.liftCallCC' callCC\n\ninstance MonadCont m =&gt; MonadCont (StrictState.StateT s m) where\n    callCC = StrictState.liftCallCC' callCC\n</code></pre>\n\n<p>What happens for the writer monad?</p>\n\n<pre><code>instance (Monoid w, MonadCont m) =&gt; MonadCont (LazyWriter.WriterT w m) where\n    callCC = LazyWriter.liftCallCC callCC\n\ninstance (Monoid w, MonadCont m) =&gt; MonadCont (StrictWriter.WriterT w m) where\n    callCC = StrictWriter.liftCallCC callCC\n</code></pre>\n\n<p>Ah-ha! No <code>'</code>!</p>\n\n<blockquote>\n<pre><code>liftCallCC :: Monoid w =&gt; CallCC m (a, w) (b, w) -&gt; CallCC (WriterT w m) a b\n</code></pre>\n  \n  <p>Lift a callCC operation to the new monad.</p>\n</blockquote>\n\n<p>No state-preserving variant is found in the library. The above variant, instead, is found there defined as</p>\n\n<pre><code>liftCallCC callCC f = WriterT $\n    callCC $ \\ c -&gt;\n    runWriterT (f (\\ a -&gt; WriterT $ c (a, mempty)))\n</code></pre>\n\n<p>Note the <code>mempty</code>. If we had a <code>get</code> operation, we could store there the \"current state\", so that it is not lost in the process, but if we had that we would no longer be in the writer monad, but in the state one.</p>\n\n<hr>\n\n<p>Also note that stacking the monads in the opposite order achieves what we'd want.</p>\n\n<pre><code>bar :: ContT String (Writer String) ()\nbar = do\n    (stop,loop) &lt;- getCC' False\n    if stop\n        then do lift $tell \"bbb\"\n        else do lift $ tell \"aaa\"\n                loop True\n\n-- &gt; runWriter (runContT bar (const $ pure \"\"))\n-- (\"\",\"aaabbb\")\n</code></pre>\n"}], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 44988812, "answer_count": 1, "score": 6, "last_activity_date": 1499535097, "creation_date": 1499532423, "question_id": 44988528, "link": "https://stackoverflow.com/questions/44988528/statet-over-cont-why-is-my-state-not-being-reset", "title": "StateT over Cont. Why is my state not being reset?", "body": "<p>I'm playing with the <code>Cont</code> monad tricks described <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2005-July/010623.html\" rel=\"noreferrer\">here</a> and in <a href=\"https://stackoverflow.com/questions/5193876/goto-in-haskell-can-anyone-explain-this-seemingly-insane-effect-of-continuation\">this SO question</a>.</p>\n\n<p>This function lets you \"jump back\" to earlier in the computation, taking a parameter so you can do things differently:</p>\n\n<pre><code>import Control.Monad.Cont\nimport Control.Monad.State.Strict\nimport Control.Monad.Writer.Strict\n\ngetCC' :: MonadCont m =&gt; a -&gt; m (a,a -&gt; m b)\ngetCC' x0 = callCC (\\c -&gt; let f x = c (x, f) in return (x0, f))\n</code></pre>\n\n<p>I have these toy examples of monad transformers on top of <code>Cont</code>:</p>\n\n<pre><code>foo :: WriterT String (Cont String) ()\nfoo = do\n    (stop,loop) &lt;- getCC' False\n    if stop\n        then do tell \"bbb\"\n        else do tell \"aaa\"\n                loop True\n\nfoo' :: StateT String (Cont String) ()\nfoo' = do\n    (stop,loop) &lt;- getCC' False\n    if stop\n        then do modify $ \\s -&gt; s ++ \"bbb\"\n        else do modify $ \\s -&gt; s ++ \"aaa\"\n                loop True\n</code></pre>\n\n<p>In the first example (as <a href=\"https://stackoverflow.com/a/5203603/1364288\">explained</a> in the linked SO question) the effects of <code>Cont</code> have \"priority\" over the effects of the <code>WriterT</code>. When we reset the computation, the log is lost:</p>\n\n<pre><code>*Main&gt; print $ runCont (execWriterT foo) id\n\"bbb\"\n</code></pre>\n\n<p>The second example does exactly the same thing, only using <code>StateT</code> instead of <code>WriterT</code>. However, in this case the log is preserved!</p>\n\n<pre><code>*Main&gt; print $ runCont (execStateT foo' \"\") id\n\"aaabbb\"\n</code></pre>\n\n<p>What is the explanation of this discrepancy?</p>\n"}, {"tags": ["haskell", "archlinux", "haskell-stack", "stackage"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1499528936, "post_id": 44987887, "comment_id": 76950722, "body": "Update LTS version?"}, {"owner": {"reputation": 1204, "user_id": 1599054, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/d4a721253898db1ee42eb770cf3d752a?s=128&d=identicon&r=PG", "display_name": "GlinesMome", "link": "https://stackoverflow.com/users/1599054/glinesmome"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1499531445, "post_id": 44987887, "comment_id": 76951482, "body": "That&#39;d imply a package modification and it seems against the stack&#39;s mindset"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1499537993, "creation_date": 1499537993, "answer_id": 44989412, "question_id": 44987887, "link": "https://stackoverflow.com/questions/44987887/stack-unsupported-version/44989412#44989412", "title": "Stack unsupported version", "body": "<p>The source of the problem is hinted at by this error message:</p>\n\n<blockquote>\n<pre><code>No information found for ghc-7.10.2.\n  Supported versions for OS key 'linux64-ncurses6': GhcVersion 7.10.3, GhcVersion 8.0.1, GhcVersion 8.0.2\n</code></pre>\n</blockquote>\n\n<p>Arch Linux provides by default libncurses6, while the standard builds of GHC expect libncurses5/libtinfo5. Stack can fetch alternative GHC builds that use libncurses6; however, they are only available from GHC 7.10.3 onward, which explains why you are having this issue with a snapshot that uses GHC 7.10.2. The following suggestion, taken from <a href=\"https://github.com/commercialhaskell/stack/issues/3177\" rel=\"nofollow noreferrer\">Stack issue #3177</a>, should solve it:</p>\n\n<blockquote>\n  <p>Install <a href=\"https://aur.archlinux.org/packages/ncurses5-compat-libs/\" rel=\"nofollow noreferrer\">ncurses5-compat-libs</a> from AUR and then force Stack to use the standard GHC bindist by doing something like <code>stack --ghc-build=standard setup</code>.</p>\n</blockquote>\n\n<p>(Note that the <code>--ghc-build=standard</code> might not be necessary -- if I remember correctly, when I ran into this issue several months ago <code>stack setup</code> detected the appropriate GHC build once I installed ncurses5-compat-libs, with no need to specify it explicitly.)</p>\n"}], "owner": {"reputation": 1204, "user_id": 1599054, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/d4a721253898db1ee42eb770cf3d752a?s=128&d=identicon&r=PG", "display_name": "GlinesMome", "link": "https://stackoverflow.com/users/1599054/glinesmome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 405, "favorite_count": 0, "accepted_answer_id": 44989412, "answer_count": 1, "score": 2, "last_activity_date": 1499538098, "creation_date": 1499528348, "last_edit_date": 1499538098, "question_id": 44987887, "link": "https://stackoverflow.com/questions/44987887/stack-unsupported-version", "title": "Stack unsupported version", "body": "<p>I'm trying to build <a href=\"https://github.com/portnov/libssh2-hs\" rel=\"nofollow noreferrer\">libssh2-hs</a> with stack (lts-3.20) and I get some errors:</p>\n\n<pre><code>$ stack build\nNo compiler found, expected minor version match with ghc-7.10.2 (x86_64-ncurses6) (based on resolver setting in /home/black/programmation/haskell/libssh2-hs/stack.yaml).\nTo install the correct GHC into /home/black/.stack/programs/x86_64-linux/, try running \"stack setup\" or use the \"--install-ghc\" flag.\n$ stack setup\nNo information found for ghc-7.10.2.\nSupported versions for OS key 'linux64-ncurses6': GhcVersion 7.10.3, GhcVersion 8.0.1, GhcVersion 8.0.2\n</code></pre>\n\n<p>I use archlinux 64 bits, what happens here and what can I do?</p>\n"}, {"tags": ["haskell", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 73, "user_id": 9414418, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p7jD4FCoE7c/AAAAAAAAAAI/AAAAAAAACkk/KPBQusRwRPk/photo.jpg?sz=128", "display_name": "Giulio De Stasio", "link": "https://stackoverflow.com/users/9414418/giulio-de-stasio"}, "is_accepted": false, "score": 1, "last_activity_date": 1526884635, "creation_date": 1526884635, "answer_id": 50443275, "question_id": 44987069, "link": "https://stackoverflow.com/questions/44987069/yesod-scaffolding-function-widgetfile/50443275#50443275", "title": "Yesod Scaffolding function widgetFile", "body": "<p>The scaffolding make you easier to develop a program instead using a single file. In <code>Foundation.hs</code> and <code>Application.hs</code> you'll find all configurations about auth, static files and also default-layout and widgetFile. You can do it in single file, but is harder and noisy.</p>\n\n<p>If you want to do it in single file install missing deps and copy the widgetFile configuration from Foundation (or Application, i don't remember)</p>\n"}], "owner": {"reputation": 234, "user_id": 6475907, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-xQd4dCvGOmg/AAAAAAAAAAI/AAAAAAAAABo/WuJS4WB_RNg/photo.jpg?sz=128", "display_name": "WellTyped", "link": "https://stackoverflow.com/users/6475907/welltyped"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1526884635, "creation_date": 1499522416, "question_id": 44987069, "link": "https://stackoverflow.com/questions/44987069/yesod-scaffolding-function-widgetfile", "title": "Yesod Scaffolding function widgetFile", "body": "<p>The <code>widgetFile</code> is very useful. Why it it not available in the Yesod library?</p>\n\n<p>I do not always want to use Scaffolding site.\nI usually would like a one file quick and dirty solution to test ideas.</p>\n"}, {"tags": ["haskell", "path", "ghc", "cabal", "lib"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 8464281, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/bcbadebbd70ce16472473a4c050f619e?s=128&d=identicon&r=PG", "display_name": "Zork", "link": "https://stackoverflow.com/users/8464281/zork"}, "is_accepted": false, "score": 1, "last_activity_date": 1502745229, "creation_date": 1502745229, "answer_id": 45683136, "question_id": 44986644, "link": "https://stackoverflow.com/questions/44986644/cabal-sandbox-library-path/45683136#45683136", "title": "Cabal sandbox library path", "body": "<p>Try to do:</p>\n\n<p>cabal install zlib --reinstall --force-reinstalls</p>\n\n<p>cabal install async --reinstall --force-reinstalls</p>\n\n<p>cabal install network-uri --reinstall --force-reinstalls</p>\n\n<p>and relaunch the install.</p>\n"}], "owner": {"reputation": 455, "user_id": 5252811, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/25f4662cd8d11abc2110cad00a9e2b52?s=128&d=identicon&r=PG&f=1", "display_name": "x4rkz", "link": "https://stackoverflow.com/users/5252811/x4rkz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1502745229, "creation_date": 1499519790, "question_id": 44986644, "link": "https://stackoverflow.com/questions/44986644/cabal-sandbox-library-path", "title": "Cabal sandbox library path", "body": "<p>When I run <code>cabal install</code> in my sandbox project, I get</p>\n\n<pre><code>/usr/bin/ld: cannot find -lHSzlib-0.6.1.2-GcLmGV5PElZD6CJvjR9umm\n/usr/bin/ld: cannot find -lHSasync-2.1.1.1-2GwQEYzLBsdIBCHbNA3HGy\n/usr/bin/ld: cannot find -lHSnetwork-uri-2.6.1.0-GzRvaV3udR3JtWfa3CLYOw\n</code></pre>\n\n<p>It turns out I have the lib:</p>\n\n<pre><code>locate HSzlib\n</code></pre>\n\n<p>/usr/lib/x86_64-linux-ghc-8.0.2/libHSzlib-0.6.1.2-GcLmGV5PElZD6CJvjR9umm-ghc8.0.2.so</p>\n\n<p>But I think that cabal doesn't find it, how to make it find it?</p>\n"}, {"tags": ["haskell", "algebraic-data-types"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1499509449, "post_id": 44985084, "comment_id": 76944878, "body": "The <i>value</i> <code>Literal</code> is a constructor of type <code>Value</code>; it takes no arguments and is unrelated to the <i>type</i> <code>Literal</code>. Did you mean <code>data Value = Literal Literal | ...</code> <code>Literal Null == Variable &quot;foo&quot;</code>?"}, {"owner": {"reputation": 33, "user_id": 8274553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77e114a790e2534cd2fbbb9877d365b3?s=128&d=identicon&r=PG&f=1", "display_name": "Bob T", "link": "https://stackoverflow.com/users/8274553/bob-t"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1499509923, "post_id": 44985084, "comment_id": 76944999, "body": "If I use <code>data Value = Literal Literal | Variable String deriving (Show, Eq)</code> I get the expected result: <code>(Literal $ IntLiteral 3) == Variable &quot;foo&quot;</code> =&gt; <code>False</code>. I&#39;m not sure I understand the difference between the <code>Literal</code> constructor and the <code>Literal</code> type."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1499513425, "post_id": 44985084, "comment_id": 76945823, "body": "The first word after <code>data .. =</code> and after each subsequent <code>|</code> is a (value) constructor name. The others refer to types. The syntax is something like <code>data T .. = K1 T11 T12 ... | K2 T21 T22 ... | K3 T31 T32 ...| ...</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499522250, "post_id": 44985084, "comment_id": 76948047, "body": "<code>Null</code> is of type <code>Literal</code>, <code>Variable &quot;foo&quot;</code> is of type <code>Value</code>. there can also be a data constructor <code>Literal</code>, unrelated to the type with the same name. these are just different things, living in separate namespaces, in Haskell. if you write <code>data Value = Literal Literal | ...</code>, the first <code>Literal</code> is a name of a data constructor (creates values of type <code>Value</code>, in that case), the second is a name of a type."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1499541026, "post_id": 44985084, "comment_id": 76954401, "body": "Why has this been downvoted? It looks like a perfectly valid and reasonable question."}, {"owner": {"reputation": 33, "user_id": 8274553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77e114a790e2534cd2fbbb9877d365b3?s=128&d=identicon&r=PG&f=1", "display_name": "Bob T", "link": "https://stackoverflow.com/users/8274553/bob-t"}, "edited": false, "score": 0, "creation_date": 1499543504, "post_id": 44985084, "comment_id": 76955160, "body": "Thanks, that makes sense. I&#39;d be happy to mark one of those as an accepted answer."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 1, "last_activity_date": 1499619167, "creation_date": 1499619167, "answer_id": 44998820, "question_id": 44985084, "link": "https://stackoverflow.com/questions/44985084/haskell-nested-algebraic-data-type/44998820#44998820", "title": "Haskell nested algebraic data type", "body": "<p><code>Null</code> is of type <code>Literal</code>, <code>Variable \"foo\"</code> is of type <code>Value</code>. There can also be a data constructor <code>Literal</code>, unrelated to the type with the same name. These are just different things, living in separate namespaces, in Haskell. If you write </p>\n\n<pre><code>data Value = Literal Literal | ...\n</code></pre>\n\n<p>then, the first <code>Literal</code> is a name of a data constructor (creates values of type <code>Value</code>, in that case), the second is a name of a type.</p>\n"}], "owner": {"reputation": 33, "user_id": 8274553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77e114a790e2534cd2fbbb9877d365b3?s=128&d=identicon&r=PG&f=1", "display_name": "Bob T", "link": "https://stackoverflow.com/users/8274553/bob-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "accepted_answer_id": 44998820, "answer_count": 1, "score": 1, "last_activity_date": 1499619167, "creation_date": 1499509146, "question_id": 44985084, "link": "https://stackoverflow.com/questions/44985084/haskell-nested-algebraic-data-type", "title": "Haskell nested algebraic data type", "body": "<p>I'm trying to model the following simple Scala ADT in Haskell:</p>\n\n<pre><code>sealed trait Value\n\nsealed trait Literal &lt; Value\ncase object Null extends Literal\ncase class IntLiteral(value: Int) extends Literal\n\ncase class Variable(name: String) &lt; Value\n</code></pre>\n\n<p>I model the <code>Literal</code> trait:</p>\n\n<pre><code>Prelude&gt; data Literal = Null | IntLiteral Int deriving (Show, Eq)\n</code></pre>\n\n<p>So far so good:</p>\n\n<pre><code>Prelude&gt; Null\nNull\nPrelude&gt; Null == IntLiteral 3\nFalse\nPrelude&gt; IntLiteral 3 == IntLiteral 3\nTrue\n</code></pre>\n\n<p>Now I try to introduce <code>Variable</code>:</p>\n\n<pre><code>data Value = Literal | Variable String deriving (Show, Eq)\n</code></pre>\n\n<p>Why doesn't this work?</p>\n\n<pre><code>Prelude&gt; Null == Variable \"foo\"\n\n&lt;interactive&gt;:3:9: error:\n    \u2022 Couldn't match expected type \u2018Literal\u2019 with actual type \u2018Value\u2019\n    \u2022 In the second argument of \u2018(==)\u2019, namely \u2018Variable \"foo\"\u2019\n      In the expression: Null == Variable \"foo\"\n      In an equation for \u2018it\u2019: it = Null == Variable \"foo\"\n</code></pre>\n"}, {"tags": ["bash", "haskell", "autocomplete", "shake-build-system"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1499509932, "post_id": 44985042, "comment_id": 76945000, "body": "As far as I know <i>autocompletion</i> is <i>not</i> specific to a program: the operating system has a set of rules to do autocompletion. So you cannot do this on a &quot;program level&quot; so to speak, since the OS cannot derive this from the program binary."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1499511971, "post_id": 44985042, "comment_id": 76945471, "body": "@WillemVanOnsem yes, however it&#39;s relatively easy (albeit hackish) to tell the OS to <i>ask the program for completions</i>. For instance <code>cabal</code> uses this route, via some command-line flag (forgot which, it&#39;s not really documented)."}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1499512627, "post_id": 44985042, "comment_id": 76945635, "body": "I have no idea what command parsing library used in shake, but there is <a href=\"https://stackoverflow.com/questions/16863284/cmdargs-bash-completion\">cmdArgs</a> that seem to have bash-completion"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1499516268, "post_id": 44985042, "comment_id": 76946472, "body": "as both shake and cmdArgs are written in haskell, I&#39;d have said that @ndmitchell would have used it, but checking the documentation, shake does not depend on cmdArgsr"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1499519367, "post_id": 44985042, "comment_id": 76947210, "body": "It works for <code>bash</code> because you have something defined for <code>make</code> that says to look for strings matching <code>^.*:</code> in the Makefile when completing the first argument for <code>make</code>. You would need to write (or find) a similar set of definitions for <code>shake</code> (or more specifically, <code>build</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 8563, "user_id": 160673, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/7BSPT.jpg?s=128&g=1", "display_name": "Neil Mitchell", "link": "https://stackoverflow.com/users/160673/neil-mitchell"}, "is_accepted": false, "score": 0, "last_activity_date": 1528299611, "creation_date": 1528299611, "answer_id": 50724410, "question_id": 44985042, "link": "https://stackoverflow.com/questions/44985042/does-shake-support-bash-completion/50724410#50724410", "title": "Does shake support bash completion?", "body": "<p>Not currently, but there's a ticket to add it: <a href=\"https://github.com/ndmitchell/shake/issues/601\" rel=\"nofollow noreferrer\">https://github.com/ndmitchell/shake/issues/601</a></p>\n"}], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1528299611, "creation_date": 1499508890, "last_edit_date": 1499512821, "question_id": 44985042, "link": "https://stackoverflow.com/questions/44985042/does-shake-support-bash-completion", "title": "Does shake support bash completion?", "body": "<p>I am learning to use <a href=\"http://shakebuild.com/\" rel=\"nofollow noreferrer\">shake</a> to replace Makefile and wonder if <code>shake</code> have <code>bash-completion</code> support.</p>\n\n<p>For example, a simple (do nothing) <code>Makefile</code></p>\n\n<pre><code>all :\n\nclean:\n</code></pre>\n\n<p>would show a tab completion target as</p>\n\n<pre><code>$ make &lt;TAB&gt;                                           \nall    clean \n</code></pre>\n\n<p>but there is no <code>target-completion</code> when using <code>./build &lt;TAB&gt;</code> complied from this <code>build.hs</code></p>\n\n<pre><code>import Development.Shake\n\nmain :: IO ()\nmain = shakeArgs shakeOptions{shakeFiles=\"_build\"} $ do\n    phony \"all\" $ return ()\n\n    phony \"clean\" $ do\n      putNormal \"Cleaning files in _build\"\n      removeFilesAfter \"_build\" [\"//*\"]\n</code></pre>\n\n<p>I am expect something similar to <a href=\"https://docs.haskellstack.org/en/stable/shell_autocompletion/#for-bash-users\" rel=\"nofollow noreferrer\">stack</a> or Python's <a href=\"https://argcomplete.readthedocs.io/en/latest/\" rel=\"nofollow noreferrer\">argcomplete</a></p>\n"}, {"tags": ["list", "dictionary", "haskell", "indexing"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1499510376, "last_edit_date": 1499510376, "creation_date": 1499507406, "answer_id": 44984810, "question_id": 44984791, "link": "https://stackoverflow.com/questions/44984791/modify-a-lists-elements-based-on-element-index/44984810#44984810", "title": "Modify a list&#39;s elements based on element index", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:zipWith\" rel=\"nofollow noreferrer\"><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]</code></a> for this:</p>\n\n<pre><code><b>zipWith</b> (\\<b>i</b> x -&gt; if p x then f <b>i</b> x else x) <b>[0..]</b> xs</code></pre>\n\n<p>where <code>f</code> thus takes <code>i</code> (the index) and <code>x</code> (the element) both into account.</p>\n\n<p>For example:</p>\n\n<pre><code>zipWith (\\i x -&gt; if x == 3 then (i+x) else x) [0..] xs\n</code></pre>\n\n<p>Which generates the desired output:</p>\n\n<pre><code>Prelude&gt; let xs = [1,3,4,2,3]\nPrelude&gt; zipWith (\\i x -&gt; if x == 3 then (i+x) else x) [0..] xs\n[1,4,4,2,7]\n</code></pre>\n\n<p>You can encapsulate this logic into a separate function, for instance <code>imap :: (Enum n, Num n) =&gt; (n -&gt; a -&gt; b) -&gt; [a] -&gt; b</code>:</p>\n\n<pre><code>imap :: (Enum n, Num n) =&gt; (n -&gt; a -&gt; b) -&gt; [a] -&gt; b\nimap = flip zipWith [0..]\n</code></pre>\n\n<p>This will work with any type that is an instance of <code>Num</code> and <code>Enum</code> (so <code>Integer</code>, <code>Int</code>, <code>Float</code>,...).</p>\n"}, {"tags": [], "owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "is_accepted": false, "score": 1, "last_activity_date": 1499526257, "creation_date": 1499526257, "answer_id": 44987542, "question_id": 44984791, "link": "https://stackoverflow.com/questions/44984791/modify-a-lists-elements-based-on-element-index/44987542#44987542", "title": "Modify a list&#39;s elements based on element index", "body": "<p>While <code>zipWith</code> is probably the right way, just for a variety you may go recursive as follows;</p>\n\n<pre><code>tpi :: [Int] -&gt; [Int]\ntpi = runner 0\n      where runner _ []     = []\n            runner n (x:xs) | x == 3    = (n + x) : runner (n+1) xs\n                            | otherwise = x : runner (n+1) xs\n</code></pre>\n"}], "owner": {"reputation": 325, "user_id": 7778287, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/87cafd6f0a91772ff3a9c1c568195f33?s=128&d=identicon&r=PG&f=1", "display_name": "user7778287", "link": "https://stackoverflow.com/users/7778287/user7778287"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 44984810, "answer_count": 2, "score": 2, "last_activity_date": 1499526257, "creation_date": 1499507251, "last_edit_date": 1499517853, "question_id": 44984791, "link": "https://stackoverflow.com/questions/44984791/modify-a-lists-elements-based-on-element-index", "title": "Modify a list&#39;s elements based on element index", "body": "<p>Using Haskell:</p>\n\n<p>Let's say I have list: <code>[1,3,4,2,3]</code>\nAnd I want to modify all 3's in the list. I know that I can apply this to select the 3's in this case:</p>\n\n<pre><code>map (\\x -&gt; if p x then f x else x) xs \n</code></pre>\n\n<p>However, the functions being applied to the threes is dependent on their index within the list. </p>\n\n<p>So for example if the index was added to the desired number the output of the function I'm going for would be: <code>[1,4,4,2,7]</code>.</p>\n"}, {"tags": ["list", "haskell", "syntax", "monads", "do-notation"], "comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499511939, "post_id": 44984184, "comment_id": 76945463, "body": "another case in point for always using explicit braces and semicolons (<i>especially</i> in teaching materials)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1499518396, "post_id": 44984184, "comment_id": 76946972, "body": "If you have really big expressions, use a <code>let</code> expression to define temporary names for them."}], "answers": [{"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499505384, "post_id": 44984207, "comment_id": 76943778, "body": "Huh. Really weird that you have to indent <i>incorrectly</i> in order to <i>fix</i> the indentation rule... I also discovered that you can use a superfluous <code>let</code> block to get rid of this. Still annoying though."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499505847, "post_id": 44984207, "comment_id": 76943873, "body": "@MathematicalOrchid well, depends on what you call \u201ccorrect\u201d. The rule that opening and closing brackets should be indented to the same level is not standard, and IMO doesn&#39;t make much sense either. What I find more annoying is that you also can&#39;t indent <i>commata</i> to the same level as their precededing bracket in such a case. \u2014 Note that in case of a <code>do</code> block, the issue is easier to circumvent than <code>let</code> \u2013 it&#39;s sufficient to write <code>&gt; id [ x+y</code> \\n <code>&gt;\u00a0\u00a0\u00a0, x-y ]</code>. (Possibly that would be more confusing though, so I don&#39;t really recommend this.)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1499502839, "creation_date": 1499502839, "answer_id": 44984207, "question_id": 44984184, "link": "https://stackoverflow.com/questions/44984184/parse-error-in-list-monads-do-notation/44984207#44984207", "title": "Parse error in list monad&#39;s `do` notation", "body": "<p>If I parse this, I get the following error:</p>\n\n<pre><code>File.hs:10:3: error:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>I think the parsers simply sees the closing square bracket <code>]</code> as a new statement. And it complains that the previous statement had no closing bracket (and the new one a closing bracket without an opening bracket). If you push it one column to the right, it parses correctly (at least with GHC-8.0.2)</p>\n\n<pre><code>test = do\n  x &lt;- [1..5]\n  y &lt;- [1..5]\n  [\n    x+y,\n    x-y\n   ] -- one space to the right\n</code></pre>\n\n<p>As long as you do not go back to the previous indentation level (here one space to the left), it should probably be fine. Since the compiler will see it as one <code>do</code>-statement.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 4, "last_activity_date": 1499504892, "creation_date": 1499504892, "answer_id": 44984467, "question_id": 44984184, "link": "https://stackoverflow.com/questions/44984184/parse-error-in-list-monads-do-notation/44984467#44984467", "title": "Parse error in list monad&#39;s `do` notation", "body": "<p>After <code>do</code>, each line which starts on the same column as the first word after <code>do</code> starts a new entry. With explicit braces, your code is equivalent to</p>\n\n<pre><code>test = do\n  { x &lt;- [1..5]\n  ; y &lt;- [1..5]\n  ; [\n      x+y,\n      x-y\n  ; ]\n  }\n</code></pre>\n\n<p>This is due to the <a href=\"https://stackoverflow.com/a/33010779/3234959\">indentation rules</a>. As we can see, the last semicolon should not be there -- to avoid it, we should indent the last line more.</p>\n"}, {"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499509780, "post_id": 44984673, "comment_id": 76944959, "body": "My personal favourite is using <code>id</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499512190, "post_id": 44984673, "comment_id": 76945509, "body": "@MathematicalOrchid <code>id</code> looks like a hack. a &quot;native&quot; solution  is an extra tailing <code>return</code>, like <code>do { ... ; r &lt;- [x+y, x-y] ; return r}</code>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1499512384, "post_id": 44984673, "comment_id": 76945575, "body": "@WillNess I&#39;d say that&#39;s even more of a hack. The only really sensible thing is to just make the indentation Haskell-conformant."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499512441, "post_id": 44984673, "comment_id": 76945592, "body": "@leftaroundabout matter of opinion, then. I&#39;d prefer for the tailing return to <i>always</i> be there, for clarity. (well, almost always)."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1499506407, "creation_date": 1499506407, "answer_id": 44984673, "question_id": 44984184, "link": "https://stackoverflow.com/questions/44984184/parse-error-in-list-monads-do-notation/44984673#44984673", "title": "Parse error in list monad&#39;s `do` notation", "body": "<p>Here are a couple of possible ways to write this legally:</p>\n\n<pre><code>test = do\n  [x,y] &lt;- replicateM 2 [1..5]\n  [\n    x+y\n   ,x-y\n   ]\n\ntest = do\n  [x,y] &lt;- replicateM 2 [1..5]\n  [ x+y\n   ,x-y ]\n\ntest = do\n  [x,y] &lt;- replicateM 2 [1..5]\n  [ x+y ,\n    x-y ]\n\ntest = do\n  [x,y] &lt;- replicateM 2 [1..5]\n  id [ x+y\n     , x-y ]\n\ntest = do\n  [x,y] &lt;- replicateM 2 [1..5]\n  id [\n       x+y,\n       x-y\n     ]\n\ntest = do\n  [x,y] &lt;- replicateM 2 [1..5]\n  ([\n     x+y,\n     x-y\n   ])\n</code></pre>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 44984207, "answer_count": 3, "score": 1, "last_activity_date": 1499512603, "creation_date": 1499502617, "last_edit_date": 1499512603, "question_id": 44984184, "link": "https://stackoverflow.com/questions/44984184/parse-error-in-list-monads-do-notation", "title": "Parse error in list monad&#39;s `do` notation", "body": "<p>OK, so here's a weird one.</p>\n\n<p>This works perfectly:</p>\n\n<pre><code>test = do\n  x &lt;- [1..5]\n  y &lt;- [1..5]\n  [x+y, x-y]\n</code></pre>\n\n<p>But this:</p>\n\n<pre><code>test = do\n  x &lt;- [1..5]\n  y &lt;- [1..5]\n  [\n    x+y,\n    x-y\n  ]\n</code></pre>\n\n<p><em>fails miserably</em>. GHC utterly <em>refuses</em> to parse this. No matter how I fidget with it, I can't seem to convince GHC to allow me to spread the list across multiple lines. Which is a problem, because if you replace <code>x+y</code> and <code>x-y</code> with really <em>big</em> expressions, it quickly becomes hard to read...</p>\n\n<p>Does anybody know why isn't this working, and how can I force it to work? (Or at least do something that looks legible?)</p>\n"}, {"tags": ["haskell", "existential-type", "rank-n-types"], "comments": [{"owner": {"reputation": 26848, "user_id": 683453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/263366f6318ce617f95d7282883402c0?s=128&d=identicon&r=PG", "display_name": "Philip JF", "link": "https://stackoverflow.com/users/683453/philip-jf"}, "edited": false, "score": 1, "creation_date": 1499467461, "post_id": 44980520, "comment_id": 76936600, "body": "<code>\u2200a. P(a) = \u2203b. b \u2227 (\u2203a. b \u2192 P(a))</code> is not correct. Indeed, <code>\u2203b. b \u2227 (\u2203a. b \u2192 P(a)) = a. P(a)</code>.  And, I don&#39;t off the top of my head know if there is a dualization of the previous formula that works in an intuitionist setting."}], "owner": {"reputation": 968, "user_id": 990666, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8d529bafee19e75a60b00f035a7a58ae?s=128&d=identicon&r=PG", "display_name": "Molossus Spondee", "link": "https://stackoverflow.com/users/990666/molossus-spondee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1499466434, "creation_date": 1499466434, "question_id": 44980520, "link": "https://stackoverflow.com/questions/44980520/how-can-i-work-around-skolemization-errors-in-this-haskell-code", "title": "How can I work around skolemization errors in this Haskell code?", "body": "<p>I have the following Haskell code</p>\n\n<pre><code>{-# LANGUAGE RankNTypes, TypeOperators, ExistentialQuantification #-}\n\nnewtype Forall p = Forall (forall a. p a)\ndata Exists p = forall a. Exists !(p a)\n\nnewtype p :-&gt; b = ForallFun (forall a. p a -&gt; b)\ndata b :~&gt; p = forall a. ExistsFun !(b -&gt; p a)\n\nnewtype EmuExists p = EmuExists (forall b. (p :-&gt; b) -&gt; b)\ndata EmuForall p = forall b. EmuForall b (b :~&gt; p)\n\ntoEmuForall :: Forall p -&gt; EmuForall p\ntoEmuForall (Forall x) = EmuForall x (ExistsFun (\\y -&gt; y))\n\ntoEmuExists :: Exists p -&gt; EmuExists p\ntoEmuExists (Exists x) = EmuExists (\\(ForallFun f) -&gt; f x)\n\nfromEmuForall :: EmuForall p -&gt; Forall p\nfromEmuForall (EmuForall x (ExistsFun f)) = Forall (f x)\n\nfromEmuExists :: EmuExists p -&gt; Exists p\nfromEmuExists (EmuExists f) = Exists (f (ForallFun (\\x -&gt; x)))\n</code></pre>\n\n<p>I am trying to emulate universal quantification in term of existential quantification using the logical formula</p>\n\n<pre><code>(\u2200a. P(a) \u2192 b) \u2192 b = \u2203a. P(a)\n</code></pre>\n\n<p>And I think the dual formula is:</p>\n\n<pre><code>\u2200a. P(a) = \u2203b. b \u2227 (\u2203a. b \u2192 P(a))\n</code></pre>\n\n<p>But I can't get the from functions to work.</p>\n"}, {"tags": ["haskell", "glpk"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499469324, "post_id": 44978906, "comment_id": 76937139, "body": "C dependencies are typically detected via <code>pkg-config</code>. Does <code>pkg-config</code> know about glpk? What does <code>pkg-config --modversion glpk</code> say? You might consider searching for an appropriate <code>*.pc</code> file on your hard drive -- e.g. look through the output of <code>locate &#39;*.pc&#39;</code> for something that looks glpk-related -- and make sure the directory that file is in is on your <code>PKG_CONFIG_PATH</code>."}, {"owner": {"reputation": 71, "user_id": 5800250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062a584e388218c41568b5e0a9c04be8?s=128&d=identicon&r=PG&f=1", "display_name": "Fandom_Lover", "link": "https://stackoverflow.com/users/5800250/fandom-lover"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499480402, "post_id": 44978906, "comment_id": 76938993, "body": "@DanielWagner I tried the <code>pkg-config --modversion glpk</code>, and it said that the command was not found. I also attempted the <code>locate &#39;*.pc&#39;</code>, and looked for something related to glpsol or glpk, and there was nothing. Do you think it&#39;s a problem with <code>pkg-config</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499482916, "post_id": 44978906, "comment_id": 76939361, "body": "Perhaps not. I just checked the cabal file for glpk-hs, and it uses <code>extra-libraries</code>, not <code>pkgconfig-depends</code>. So my previous comments about pkg-config are probably a red herring. (Sorry.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499482994, "post_id": 44978906, "comment_id": 76939376, "body": "Followup question: can <code>ld</code> find your glpk library? (Can you build a C program that uses glpk?)"}, {"owner": {"reputation": 71, "user_id": 5800250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062a584e388218c41568b5e0a9c04be8?s=128&d=identicon&r=PG&f=1", "display_name": "Fandom_Lover", "link": "https://stackoverflow.com/users/5800250/fandom-lover"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1499569291, "post_id": 44978906, "comment_id": 76959936, "body": "No worries. Hm, I&#39;m having trouble testing the <code>ld</code> finding the glpk, as I&#39;m not too familiar with C. Though going by the <a href=\"https://en.wikibooks.org/wiki/GLPK/Using_GLPSOL\" rel=\"nofollow noreferrer\">glpsol</a> (command line solver), command line recognizes the GLPK package."}], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 5800250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062a584e388218c41568b5e0a9c04be8?s=128&d=identicon&r=PG&f=1", "display_name": "Fandom_Lover", "link": "https://stackoverflow.com/users/5800250/fandom-lover"}, "is_accepted": true, "score": 1, "last_activity_date": 1499697642, "creation_date": 1499697642, "answer_id": 45015001, "question_id": 44978906, "link": "https://stackoverflow.com/questions/44978906/unable-to-install-glpk-hs/45015001#45015001", "title": "Unable to Install glpk-hs", "body": "<p>Figured it out! <code>hmatrix-glpk</code> had the extra directories for OS X in the .cabal file: </p>\n\n<pre><code>if os(OSX)\n     extra-lib-dirs: /usr/lib\n     extra-lib-dirs: /opt/local/lib/\n     include-dirs: /opt/local/include/\n     extra-lib-dirs: /usr/local/lib/\n     include-dirs: /usr/local/include/\n     if arch(i386)\n         cc-options: -arch i386\n</code></pre>\n\n<p>Copying this into the <code>glpk-hs.cabal</code> allows the installation to work. </p>\n"}], "owner": {"reputation": 71, "user_id": 5800250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062a584e388218c41568b5e0a9c04be8?s=128&d=identicon&r=PG&f=1", "display_name": "Fandom_Lover", "link": "https://stackoverflow.com/users/5800250/fandom-lover"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 45015001, "answer_count": 1, "score": 1, "last_activity_date": 1499697642, "creation_date": 1499458171, "last_edit_date": 1499480143, "question_id": 44978906, "link": "https://stackoverflow.com/questions/44978906/unable-to-install-glpk-hs", "title": "Unable to Install glpk-hs", "body": "<p>I've installed the Haskell Compiler and glpk-hs using the instructions <a href=\"https://en.wikibooks.org/wiki/GLPK/Linux_OS\" rel=\"nofollow noreferrer\">here</a>. Further, I've used <code>cabal install glpk-hs</code> to install required files in an attempt to compile a Haskell Program. </p>\n\n<p>However, the cabal installation of glpk is not working. The following message keeps popping up: </p>\n\n<blockquote>\n  <p>Resolving dependencies...</p>\n  \n  <p>Configuring glpk-hs-0.5...</p>\n  \n  <p>Failed to install glpk-hs-0.5</p>\n  \n  <p>Build log :</p>\n  \n  <p>cabal: Entering directory '/var/folders/cr/9f1ltj7d4b31hmkfn03hjl_r0000gn/T/cabal-tmp-12521/glpk-hs-0.5'</p>\n  \n  <p>Configuring glpk-hs-0.5...</p>\n  \n  <p>cabal.real: Missing dependency on a foreign library:</p>\n  \n  <ul>\n  <li>Missing C library: glpk</li>\n  </ul>\n  \n  <p>This problem can usually be solved by installing the system package that\n  provides this library (you may need the \"-dev\" version). If the library is\n  already installed but in a non-standard location then you can use the flags\n  --extra-include-dirs= and --extra-lib-dirs= to specify where it is.\n  cabal: </p>\n  \n  <p>Leaving directory '/var/folders/cr/9f1ltj7d4b31hmkfn03hjl_r0000gn/T/cabal-tmp-12521/glpk-hs-0.5'</p>\n  \n  <p>cabal: Error: some packages failed to install:\n  glpk-hs-0.5 failed during the configure step. The exception was:</p>\n  \n  <p>ExitFailure 1</p>\n</blockquote>\n\n<p>As above, I have tried both installing glpk in a nonstandard location and the standard location, but in all cases, has been unable to find the glpk. </p>\n\n<p>The <a href=\"https://en.wikibooks.org/wiki/GLPK/Using_GLPSOL\" rel=\"nofollow noreferrer\">glpsol solver</a>, which uses GLPK is installed though, as it shows the version of which it is currently running: <code>GLPSOL: GLPK LP/MIP Solver, v4.62</code></p>\n"}, {"tags": ["function", "haskell", "types", "arguments", "fold"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499458358, "post_id": 44978869, "comment_id": 76933128, "body": "Questions like this are asked about foldr often, but I can&#39;t find anything good enough to mark this as a duplicate of. Anyone have an idea? The best I could find are <a href=\"https://stackoverflow.com/q/15879940/625403\">stackoverflow.com/q/15879940/625403</a> and <a href=\"https://stackoverflow.com/q/4733019/625403\">stackoverflow.com/q/4733019/625403</a>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1499459394, "post_id": 44978869, "comment_id": 76933643, "body": "<code>-&gt;</code> in types is right associative. Your function type can also be written <code>a -&gt; (Int -&gt; a) -&gt; (Int -&gt; a)</code>."}, {"owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "edited": false, "score": 0, "creation_date": 1499460281, "post_id": 44978869, "comment_id": 76933991, "body": "Yeah, I see that with such step function <code>r</code> is out <code>go</code> that already has <code>ys</code> and waits for <code>(k-1)</code>, question can be closed, thanks to all"}, {"owner": {"reputation": 166, "user_id": 8242965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5724b2e35bafc1fbff7092793b3ffb4a?s=128&d=identicon&r=PG", "display_name": "user8242965", "link": "https://stackoverflow.com/users/8242965/user8242965"}, "edited": false, "score": 1, "creation_date": 1499470279, "post_id": 44978869, "comment_id": 76937336, "body": "With more parens added - foldr takes a function <code>fn :: a -&gt; (Int -&gt; a) -&gt; (Int -&gt; a)</code> and returns a value of type <code>(Int -&gt; a)</code>. After foldr is done this n gets applied to this function: <code>(foldr fn tooLarge xs) n</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1499506178, "post_id": 44978869, "comment_id": 76943948, "body": "@amalloy neither is an exact duplicate. This question can be rewritten as &quot;why can foldr take a function with three arguments?&quot;."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1551038552, "post_id": 44978869, "comment_id": 96483450, "body": "The type of <code>tooLarge</code> should be a big hint."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 2, "last_activity_date": 1499506535, "creation_date": 1499506535, "answer_id": 44984693, "question_id": 44978869, "link": "https://stackoverflow.com/questions/44978869/why-can-foldr-take-a-function-with-three-arguments/44984693#44984693", "title": "Why can foldr take a function with three arguments?", "body": "<p><code>-&gt;</code> is right-associative. So <code>a -&gt; b -&gt; c</code> is <code>a -&gt; (b -&gt; c)</code>. Therefore, your type</p>\n\n<pre><code>a -&gt; (Int -&gt; a) -&gt;  Int -&gt; a\n</code></pre>\n\n<p>is the same as</p>\n\n<pre><code>a -&gt; (Int -&gt; a) -&gt; (Int -&gt; a)\n</code></pre>\n\n<p>and  we can see that it fits <code>foldr</code>'s type quite well.</p>\n"}, {"tags": [], "owner": {"reputation": 952, "user_id": 2223325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1dd0ca1429a44e81ca28411bebd01b9?s=128&d=identicon&r=PG", "display_name": "maczniak", "link": "https://stackoverflow.com/users/2223325/maczniak"}, "is_accepted": false, "score": 1, "last_activity_date": 1551032410, "creation_date": 1551032410, "answer_id": 54855016, "question_id": 44978869, "link": "https://stackoverflow.com/questions/44978869/why-can-foldr-take-a-function-with-three-arguments/54855016#54855016", "title": "Why can foldr take a function with three arguments?", "body": "<p>(more explanation for others ;)</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(!!)                    :: [a] -&gt; Int -&gt; a\nxs !! n\n  | n &lt; 0     = negIndex\n  | otherwise = foldr (\\x r k -&gt; case k of\n                                   0 -&gt; x\n                                   _ -&gt; r (k-1)) tooLarge xs n\n\nfoldr            :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\n--                                   ^1          ^2\n</code></pre>\n\n<p><code>foldr</code> commonly makes an accumulated(?) value. In this case, <code>foldr</code> makes an\naccumulated function (<code>b</code>) of the type <code>(Int -&gt; a)</code>! <code>foldr ... tooLarge xs</code> is evaluated to an\naccumulated function, and this accumulated function (<code>^2</code>) takes an argument <code>n</code>. <code>^1</code> is a <code>tooLarge</code> function. Interestingly, the buildup of this\naccumulated function depends on the value of a free variable <code>n</code> (i.e., <code>k</code>).</p>\n\n<p>For example, <code>['a', 'b', 'c'] !! 2</code> is evaluated like below:<br/>\n<code>\\x r k</code> = <code>\\'a' r 2 -&gt; r (2-1)</code> (<code>r</code> is not known yet, and drives further evaluations.)<br/>\n<code>\\x r k</code> = <code>\\'b' r 1 -&gt; r (1-1)</code><br/>\n<code>\\x r k</code> = <code>\\'c' r 0 -&gt; 'c'</code></p>\n\n<p><code>['a', 'b', 'c'] !! 3</code> goes like this:<br/>\n<code>\\x r k</code> = <code>\\'a' r 3 -&gt; r (3-1)</code><br/>\n<code>\\x r k</code> = <code>\\'b' r 2 -&gt; r (2-1)</code><br/>\n<code>\\x r k</code> = <code>\\'c' r 1 -&gt; r (1-1)</code> (<code>r</code> turns out to be <code>tooLarge</code>.) = <code>tooLarge (1-1)</code> (ERROR!)</p>\n\n<p>You can check debug traces:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Main where\n\nimport Debug.Trace\n\ntooLarge _ = errorWithoutStackTrace \"!!!: index too large\"\nnegIndex = errorWithoutStackTrace \"!!!: negative index\"\n\n(!!!)                    :: Show a =&gt; [a] -&gt; Int -&gt; a\nxs !!! n\n  | n &lt; 0     = negIndex\n  | otherwise = foldr (\\x r k -&gt; trace (\"x: \" ++ show x ++ \", k: \" ++ show k) $\n                                 case k of\n                                   0 -&gt; x\n                                   _ -&gt; r (k-1)) tooLarge xs n\n\nmain = do\n  print $ ['a', 'b', 'c'] !!! 2\n  print $ ['a', 'b', 'c'] !!! 3\n\n-- x: 'a', k: 2\n-- x: 'b', k: 1\n-- x: 'c', k: 0\n-- 'c'\n-- x: 'a', k: 3\n-- x: 'b', k: 2\n-- x: 'c', k: 1\n-- sample: !!!: index too large\n</code></pre>\n\n<p><hr/>\nThis <code>(!!)</code> implementation is a report version. The report version of the prelude is more efficient than a familiar naive recursive implementation,\ndue to optimizations of <code>foldr</code>.</p>\n"}], "owner": {"reputation": 3281, "user_id": 3574379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/B85yX.png?s=128&g=1", "display_name": "srghma", "link": "https://stackoverflow.com/users/3574379/srghma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "accepted_answer_id": 44984693, "answer_count": 2, "score": 5, "last_activity_date": 1551038259, "creation_date": 1499458004, "last_edit_date": 1551038259, "question_id": 44978869, "link": "https://stackoverflow.com/questions/44978869/why-can-foldr-take-a-function-with-three-arguments", "title": "Why can foldr take a function with three arguments?", "body": "<p>I was having a look at some list operations and came across <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.List.html#%21%21\" rel=\"nofollow noreferrer\"><code>!!</code></a>:</p>\n\n<pre><code>(!!)                    :: [a] -&gt; Int -&gt; a\nxs !! n\n  | n &lt; 0     = negIndex\n  | otherwise = foldr (\\x r k -&gt; case k of\n                                   0 -&gt; x\n                                   _ -&gt; r (k-1)) tooLarge xs n\n</code></pre>\n\n<p>The function <code>(\\x r k -&gt; ...)</code> has type <code>a -&gt; (Int -&gt; a) -&gt; Int -&gt; a</code>, but <code>foldr</code> takes a function that should only accept two arguments:</p>\n\n<pre><code>foldr            :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b\nfoldr k z = go\n          where\n            go []     = z\n            go (y:ys) = y `k` go ys\n</code></pre>\n\n<p>Can someone explain to me why <code>foldr</code> accepts a function that takes 3 arguments with the following type <code>a -&gt; (Int -&gt; a) -&gt; Int -&gt; a</code>? Especially since the result should have the same type as the second argument?</p>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1499459613, "post_id": 44978818, "comment_id": 76933720, "body": "Right, so this works:  <code>test = hoist (flip runReaderT cfg) $ do ...</code>. Thank you!"}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 4, "last_activity_date": 1499457772, "creation_date": 1499457772, "answer_id": 44978818, "question_id": 44978331, "link": "https://stackoverflow.com/questions/44978331/mtl-reader-exceptt-stacking-order/44978818#44978818", "title": "mtl, reader, exceptt &amp; stacking order", "body": "<p>You can use <a href=\"http://hackage.haskell.org/package/mmorph-1.1.0/docs/Control-Monad-Morph.html#v:hoist\" rel=\"nofollow noreferrer\"><code>hoist</code></a> from <a href=\"http://hackage.haskell.org/package/mmorph-1.1.0/docs/Control-Monad-Morph.html\" rel=\"nofollow noreferrer\"><code>Control.Monad.Morph</code></a> to run the <code>Reader</code> below the <code>ExceptT</code>:</p>\n\n<pre><code>ghci&gt; let foo = undefined :: ExceptT () (ReaderT () IO) ()\nghci&gt; :t hoist (flip runReaderT ()) foo\nhoist (flip runReaderT ()) foo :: ExceptT () IO ()\n</code></pre>\n\n<p>It's also easy to do it yourself, you just have to unwrap with <code>runExceptT</code>, supply the environment with <code>runReader</code>, and re-wrap the result in the <code>ExceptT</code> constructor: </p>\n\n<pre><code>ghci&gt; :t \\env -&gt; ExceptT . flip runReaderT env . runExceptT\n\\env -&gt; ExceptT . flip runReaderT env . runExceptT\n    :: r -&gt; ExceptT e (ReaderT r m) a -&gt; ExceptT e m a\n</code></pre>\n"}], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "accepted_answer_id": 44978818, "answer_count": 1, "score": 1, "last_activity_date": 1499457772, "creation_date": 1499455516, "question_id": 44978331, "link": "https://stackoverflow.com/questions/44978331/mtl-reader-exceptt-stacking-order", "title": "mtl, reader, exceptt &amp; stacking order", "body": "<p>So this is going to be a bit long, because I'm not sure how to frame this question more generally. The good news is that I have a code sample at the bottom of the question, the idea is just to make it build &amp; elegant :-)</p>\n\n<p>I have a couple of functions which have signatures like:</p>\n\n<pre><code>calledFunction\n  :: (MonadReader env m, HasToken env, MonadIO m)\n  =&gt; m (Either MyError MyResult)\n\ncalledFunction2\n  :: (MonadReader env m, HasToken env, MonadIO m)\n  =&gt; m (Either MyError MyResult2)\n</code></pre>\n\n<p>And I'd like to get in the end a result of type <code>ExceptT String IO MyResult3</code> which I get by combining <code>MyResult</code> &amp; <code>MyResult2</code>.</p>\n\n<p>Now it's very nice that <code>calledFunction</code> returns an <code>Either</code> because I can leverage:</p>\n\n<pre><code>ExceptT :: m (Either e a) -&gt; ExceptT e m a\n</code></pre>\n\n<p>And I just type <code>EitherT calledFunction</code> and I won't have anymore <code>m (Either MyError MyResult)</code> but straight <code>ExceptT MyError m MyResult)</code>. Progress!</p>\n\n<p>But I also need to give to <code>calledFunction</code> the reader context it wants. Now, I would do that with <code>runReaderT</code>. I have now come to the <code>ExceptT MyError m MyResult</code> transformer stack, so naturally the <code>ReaderT</code> should go where the <code>m</code> is.. So <code>ExceptT MyError (ReaderT Config IO) MyResult</code>...</p>\n\n<p>Except, how do I 'fill in' the readerT with the value to read, since it's at the bottom of the transformer stack? And if I reverse the stack to have the reader at the toplevel, then <code>runReaderT</code> comes naturally, but I don't see how to use <code>EitherT</code> to transform my <code>Either</code> in an <code>ExceptT</code> elegantly...</p>\n\n<pre><code>import Control.Monad.Reader\nimport Control.Monad.Trans.Reader\nimport Control.Monad.Trans.Except\nimport Control.Monad.IO.Class\nimport Control.Error -- 'error' package\n\nclass HasToken a where\n    getToken :: a -&gt; String\ndata Config = Config String\ninstance HasToken Config where\n    getToken (Config x) = x\n\ndata MyError = MyError String deriving Show\ndata MyResult = MyResult String\ndata MyResult2 = MyResult2 String\n\ndata MyResult3 = MyResult3 MyResult MyResult2\n\ncalledFunction\n  :: (MonadReader env m, HasToken env, MonadIO m)\n  =&gt; m (Either MyError MyResult)\ncalledFunction = undefined\n\ncalledFunction2\n  :: (MonadReader env m, HasToken env, MonadIO m)\n  =&gt; m (Either MyError MyResult2)\ncalledFunction2 = undefined\n\ncfg = Config \"test\"\n\nmain = undefined\n\ntest :: ExceptT MyError IO MyResult3\ntest = do\n    -- calling runReaderT each time defeats the purpose..\n    r1 &lt;- ExceptT (runReaderT calledFunction cfg)\n    r2 &lt;- ExceptT (runReaderT calledFunction2 cfg)\n    return $ MyResult3 r1 r2\n\ntest1 = runReaderT test2 cfg\n\ntest2 :: ReaderT Config (ExceptT MyError IO) MyResult3\ntest2 = do\n    -- how to make this compile?\n    let cfg = Config \"test\"\n    r1 &lt;- ExceptT calledFunction\n    r2 &lt;- ExceptT calledFunction2\n    return $ MyResult3 r1 r2\n</code></pre>\n"}, {"tags": ["haskell", "io", "command-line-arguments"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1499455313, "post_id": 44978186, "comment_id": 76931688, "body": "write a one linner bash script to parse the input file and invoke your haskell ... post what the parm input file would look like"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1499456627, "post_id": 44978186, "comment_id": 76932347, "body": "What have I done wrong?  Everyone has the right to downvote but it would be helpful if I they could comment so I can get some feedback."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1499457061, "post_id": 44978186, "comment_id": 76932557, "body": "Downvoters should comment. Anyway, probably you need to read an IO or monad tutorial, like <a href=\"http://learnyouahaskell.com/input-and-output\" rel=\"nofollow noreferrer\">LYAH</a>. The idea is that you can use <code>parseFile &lt;$&gt; readFile (last args)</code> (or <code>fmap</code>, or <code>do</code> notation or many other alternatives) and its type will be <code>IO [String]</code>. But this is probably one of the most frequent FAQs in Haskell, and is a bit broad, so a tutorial should really be the best option."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1499457853, "post_id": 44978186, "comment_id": 76932887, "body": "This is a really basic question about how to use <code>IO</code>. I recommend thinking about <code>(&gt;&gt;=) :: IO a -&gt; (a -&gt; IO b) -&gt; IO b</code> (the real type is more general) and how you could use it to make the types fit."}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1499458543, "post_id": 44978186, "comment_id": 76933222, "body": "@chi Thanks for the advice.  I read that a while ago when I first started programming in Haskell.  I probably just forgot the important bits."}], "answers": [{"comments": [{"owner": {"reputation": 567, "user_id": 1765828, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/9rVAH.jpg?s=128&g=1", "display_name": "salc2", "link": "https://stackoverflow.com/users/1765828/salc2"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1499461940, "post_id": 44979454, "comment_id": 76934739, "body": "That was just a pseudo code. Tell me what type args is?"}, {"owner": {"reputation": 567, "user_id": 1765828, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/9rVAH.jpg?s=128&g=1", "display_name": "salc2", "link": "https://stackoverflow.com/users/1765828/salc2"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1499461992, "post_id": 44979454, "comment_id": 76934758, "body": "@EpsilonNeighborhoodWatch"}, {"owner": {"reputation": 567, "user_id": 1765828, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/9rVAH.jpg?s=128&g=1", "display_name": "salc2", "link": "https://stackoverflow.com/users/1765828/salc2"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1499462179, "post_id": 44979454, "comment_id": 76934846, "body": "What type do you want in myInput? [String] or just String?"}, {"owner": {"reputation": 567, "user_id": 1765828, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/9rVAH.jpg?s=128&g=1", "display_name": "salc2", "link": "https://stackoverflow.com/users/1765828/salc2"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1499462209, "post_id": 44979454, "comment_id": 76934858, "body": "@EpsilonNeighborhoodWatch"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1499462312, "post_id": 44979454, "comment_id": 76934912, "body": "<code>myInput</code> should be a <code>[String]</code>.  Which is why I wrote the parser to turn a <code>String</code> into a <code>[String]</code>."}, {"owner": {"reputation": 567, "user_id": 1765828, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/9rVAH.jpg?s=128&g=1", "display_name": "salc2", "link": "https://stackoverflow.com/users/1765828/salc2"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1499468211, "post_id": 44979454, "comment_id": 76936814, "body": "@EpsilonNeighborhoodWatch  look at.. I changed the code regarding your comment"}, {"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1499468278, "post_id": 44979454, "comment_id": 76936838, "body": "Yes that indeed does work.  I was just writing up an answer doing exactly what your pseudo code does.  thanks"}], "tags": [], "owner": {"reputation": 567, "user_id": 1765828, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/9rVAH.jpg?s=128&g=1", "display_name": "salc2", "link": "https://stackoverflow.com/users/1765828/salc2"}, "is_accepted": false, "score": 0, "last_activity_date": 1499468126, "last_edit_date": 1499468126, "creation_date": 1499460815, "answer_id": 44979454, "question_id": 44978186, "link": "https://stackoverflow.com/questions/44978186/read-from-file-or-from-command-line-arguments-haskell/44979454#44979454", "title": "Read from file or from command line arguments haskell", "body": "<p>You need to do an inversion of control in the flow of your data.. Haskell's <code>IO</code> datatypes are there to manage the effects of i/o operations. Read string from a file is not a fact, the file couldn't exist, can be empty or so on. Many possibilities could happend. So for that reason <code>main</code> function use to be based on <code>IO</code>. The way you can use to \"extract\" wrapped value from a IO is using <code>do-return</code> block</p>\n\n<pre><code>inputIO = if flagDetected then\n             do \n               cnt &lt;- (readFile path)\n               return (parseFile cnt)\n          else return args\nmain = do\n      input &lt;- inputIO\n      return yourProgram input\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/5920888/haskell-how-can-i-use-if-statement-in-do-block-properly\">Look here</a></p>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 707, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1499468126, "creation_date": 1499454961, "last_edit_date": 1499462115, "question_id": 44978186, "link": "https://stackoverflow.com/questions/44978186/read-from-file-or-from-command-line-arguments-haskell", "title": "Read from file or from command line arguments haskell", "body": "<p>I am designing the IO for a program I have written in Haskell.  I would like to be able to read some arguments from file using <code>-f</code> or from the command line by default.  The command line arguments get split up into convenient chunks meaning I do not need to parse them.  However this does not happen when reading from file.  So I wrote a simple little parser to do what I wanted.</p>\n\n<pre><code>parseFile :: String -&gt; [String]\nparseFile [] = [\"\"]\nparseFile ('\"':xs) = parseString xs '\"'\nparseFile ('\\'':xs) = parseString xs '\\''\nparseFile (' ':xs) = \"\":parseFile xs\nparseFile ('\\t':xs) = \"\":parseFile xs\nparseFile ('\\n':xs) = \"\":parseFile xs\nparseFile (s:xs) = (\\(a:xa)-&gt;(a++[s]):xa)$ parseFile xs\n\nparseString :: String -&gt; Char -&gt; [String]\nparseString (s:xs) a\n | s == a = \"\":parseFile xs\n | otherwise = (\\(a:xa)-&gt;(a++[s]):xa)$ parseString xs a\n</code></pre>\n\n<p>I thought this would be pretty simple I would do something like</p>\n\n<pre><code>let myInput = if (flagDetected) then (parseFile $ readFile $ last args) else (args)\n</code></pre>\n\n<p>However the result of <code>readFile</code> is an IO action and not a string thus I cannot parse it.  I've tried a number of configurations all which have fails, mostly for typing reasons.  I've tried assigning the results before parsing, which resulted in a type mismatch between <code>args</code> which is a <code>[[Char]]</code> ( it is the result of using <code>getArgs</code> from the <code>System.Environment</code> module) and the result of <code>readFile</code> which is still an IO String. \n I tried wrapping <code>args</code> with a <code>return</code> which of course doesn't fix this problem because of a type mismatch.  I'm really at a loss of ideas now.  I feel like this is probably a problem with the way I am thinking about the issue.</p>\n\n<p>How can I get the behavior I desire?</p>\n\n<p><a href=\"https://stackoverflow.com/questions/44485607/conditional-io-action\">Here's a related question I asked earlier</a>.  The root of the problem is the same but the answers on the last one were far to specific to help me here. It seems this is a frequent problem for me.</p>\n"}, {"tags": ["haskell", "pandoc", "hakyll"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1499455710, "post_id": 44977923, "comment_id": 76931878, "body": "There is no such function (it cannot exist); so it isn&#39;t the function you want. The actual function you want is <code>&gt;&gt;= :: Compiler a -&gt; (a -&gt; Compiler b) -&gt; Compiler b</code>. Or, since you are already using <code>do</code> notation, <code>do { body &lt;- ..; doc &lt;- readPandocWith ropt body; withItemBody (..) doc }</code>. Aside: I would suggest to familiarize yourself with the more basic abstraction patterns which are employed by nearly every mature Haskell library; this would certainly help you navigate the Haskell ecosystem."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1499463484, "post_id": 44977923, "comment_id": 76935432, "body": "@user2407038 Make this an answer."}], "answers": [{"comments": [{"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "edited": false, "score": 0, "creation_date": 1501710523, "post_id": 44987350, "comment_id": 77904147, "body": "I didn&#39;t read the Hakyll documentation well enough and I didn&#39;t saw that <code>Compiler</code> was a monad. I&#39;m very embarrassed."}], "tags": [], "owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "is_accepted": true, "score": 0, "last_activity_date": 1499524897, "creation_date": 1499524897, "answer_id": 44987350, "question_id": 44977923, "link": "https://stackoverflow.com/questions/44977923/custom-pandoc-writer-with-hakyll/44987350#44987350", "title": "Custom pandoc writer with Hakyll", "body": "<p>As mentioned by @user2407038, the following should work:</p>\n\n<pre><code>customWriterCompilerWith customWriter ropt wopt = do\n    body &lt;- getResourceBody\n    doc  &lt;- readPandocWith ropt body\n    withItemBody (unsafeCompiler . customWriter wopt) doc\n</code></pre>\n\n<p>To read more about <code>&lt;-</code> (which is syntactic sugar for <code>&gt;&gt;=</code>), I can recommend <a href=\"http://learnyouahaskell.com\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com</a> (the monad chapter).</p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 44987350, "answer_count": 1, "score": 1, "last_activity_date": 1499524897, "creation_date": 1499453904, "question_id": 44977923, "link": "https://stackoverflow.com/questions/44977923/custom-pandoc-writer-with-hakyll", "title": "Custom pandoc writer with Hakyll", "body": "<p>I'm trying to write a special Hakyll compiler to use a lua script to build my website. I found this function which seams to make what I want : </p>\n\n<pre><code>customWriterCompilerWith :: (WriterOptions -&gt; Pandoc -&gt; IO String)\n                         -&gt; ReaderOptions -&gt; WriterOptions\n                         -&gt; Compiler (Item String)\ncustomWriterCompilerWith customWriter ropt wopt = do\n    body &lt;- getResourceBody\n    withItemBody (unsafeCompiler . customWriter wopt) $ readPandocWith ropt body\n</code></pre>\n\n<p>However, when I try to compile this function, I get this error : </p>\n\n<pre><code>\u2022 Couldn't match expected type \u2018Item Pandoc\u2019\n              with actual type \u2018Compiler (Item Pandoc)\u2019\n\u2022 In the second argument of \u2018($)\u2019, namely\n    \u2018readPandocWith ropt body\u2019\n</code></pre>\n\n<p>After searching in the Hakyll documentation, there is a difference between the type of <code>readPandocWith</code> in versions <code>4.6.8.0</code> and <code>4.9.8.0</code> (my version) :</p>\n\n<pre><code>readPandocWith:: ReaderOptions-&gt; Item String-&gt; Item Pandoc -- 4.6.8.0\n\nreadPandocWith:: ReaderOptions-&gt; Item String-&gt; Compiler (Item Pandoc) -- 4.9.8.0\n</code></pre>\n\n<p>I didn't find in the Hakyll documentation a function (whose type should be <code>Compiler (Item Pandoc)-&gt; Item Pandoc</code>) which could help me.</p>\n\n<p><strong>Do you know how to solve this problem ?</strong></p>\n\n<p><strong>Do you know another way to make a custom Hakyll compiler with a LUA script ?</strong></p>\n"}, {"tags": ["haskell", "permutation"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1499454050, "post_id": 44977838, "comment_id": 76931016, "body": "<code>evenPerm</code> is not the elements of any &#39;set&#39; (if we are taking sets to be represented by lists). <code>even :: Int -&gt; Bool</code> (loosely speaking) so <code>evenPerm</code> is a predicate on sets. <code>inversions</code> is a somewhat curious function which computes the number of elements in a set <i>of sets</i> smaller than the first &#39;set&#39;, using the lexographic ordering on lists. Really, this has little to do with Haskell - it is more (somewhat non-elementary) set theory than anything. All that aside, have you run your functions on a few sample inputs to see what they do in those cases? That usually helps gain an intuition."}, {"owner": {"reputation": 31, "user_id": 8272416, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213165024298247/picture?type=large", "display_name": "Blake Sims", "link": "https://stackoverflow.com/users/8272416/blake-sims"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499457056, "post_id": 44977838, "comment_id": 76932554, "body": "Yeah, I have tried the code which was provided to me by someone else. The code works and does exactly what I want it to do, but like I said it was provided to me by someone else, and I am trying to understand how it works."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1499465668, "post_id": 44977838, "comment_id": 76936112, "body": "How many moves you need to bring <code>[a1,..,an]</code> into <code>[1..n]</code>? Well, you first need as many moves as needed to sort <code>[a2,..,an]</code>, then you need to swap <code>a1</code> to its sorted position, i.e. swap it with the longest prefix of <code>[a2,..,an]</code> made by elements <code>&lt;a1</code>. In your code, <code>length $ filter (&lt;x) xs</code> counts this last figure, the <code>sum</code> does the recursive step. (Here I ignore the fact that in the recursive step we no longer have all the <code>1..n</code> elements, but it can be phrased exactly with a bit more care)"}], "answers": [{"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1499519864, "last_edit_date": 1499519864, "creation_date": 1499496736, "answer_id": 44983400, "question_id": 44977838, "link": "https://stackoverflow.com/questions/44977838/finding-even-permutations-using-haskell/44983400#44983400", "title": "Finding even permutations using Haskell", "body": "<p>To take a bird\u2019s-eye view, what we want to do is count how many swaps we would need to sort the list in place.  (Equivalently, in the language of group theory, to decompose the permutation into transpositions.) Which sorting algorithm we use to count swaps doesn\u2019t matter for correctness: an even permutation will generate an even number of swaps and an odd permutation an odd number of swaps regardless of how we sort.</p>\n\n<p>Let\u2019s look first at:</p>\n\n<pre><code>go [] = 0\ngo (x:xs) = length $ filter (&lt;x) xs\n</code></pre>\n\n<p>The indentation in that sample is confusing, but <code>go</code> is a nested local function of <code>inversions</code>.  It appears inside a <code>where</code> clause.  The <code>go</code> function counts the number of elements in a list that need to be moved <em>before</em> the first element in the list, that is, the elements smaller than the head of the list.  It does this by filtering the tail and taking its length.  An empty list has no head, so there\u2019s another pattern matching it for completeness.  (Otherwise, the compiler would complain that some inputs do not match any pattern.)</p>\n\n<pre><code>inversions as = sum $ map go (tails as)\n</code></pre>\n\n<p>The <code>tails</code> function is from the <code>Data.List</code> library that we imported.  It generates a list of shorter and shorter final segments: <code>tails [1,2,3] = [[1,2,3] [2,3], [3]]</code>.  We then map <code>go</code> onto each final segment in the list, giving us a list of the inversion count for each final segment.  Finally, we sum the counts.</p>\n\n<p>You will often see things like this written as a composition of functions: <code>inversions = sum . map go . tails</code>.  That just applies each function from right to left: <code>tails</code>, then <code>map go</code> on the result, then <code>sum</code> on the result of that.</p>\n\n<p>For example.</p>\n\n<pre><code>list == [4,3,2,1]\ntails list == [[4,3,2,1], [3,2,1], [2,1], [1]]\nmap go (tails list) == [3,2,1,0]\nsum $ map go (tails list) == 6\n</code></pre>\n\n<p>This counts the number of swaps for a bubble sort.  We could theoretically perform the following swaps to sort the list:</p>\n\n<pre><code>[4,3,2,1] -- 0 swaps needed to sort [1]\n[4,3,1,2] -- 1 swap to sort final sequence [2,1]\n[4,1,3,2] -- Which equals go [2,1]\n[4,1,2,3] -- 2 additional swaps to sort [3,2,1]\n[1,4,2,3] -- Which equals go [3,2,1]\n[1,2,4,3]\n[1,2,3,4] -- 3 additional swaps to sort [4,3,2,1]\n          -- Which equals go [4,3,2,1]\n</code></pre>\n\n<p>This is far from a minimal number of swaps, but we just need some count for some sorting algorithm, and that one is simple.</p>\n\n<p>The next step is</p>\n\n<pre><code>evenPerm as = even (inversions as)\n</code></pre>\n\n<p>This is a predicate that simply tells us whether the result of the computation we just looked at was even or odd.  It could also have been defined as <code>even . inversions</code>, or <code>even . sum . map go . tails</code>.</p>\n\n<pre><code>alternating n = [ p | p &lt;- permutations [1..n], evenPerm p ]\n</code></pre>\n\n<p>This is a list comprehension.  It calls another function from <code>Data.List</code>, <code>permutations</code>, to generate a list of all permutations.  It then adds a permutation <em>p</em> to our output list if and only if <code>evenPerm p</code> is true.</p>\n\n<p>This could also have been written as <code>evenPerms = filter evenPerm . permutations</code>, which is shorter and works with more types, with <code>alternating n = evenPerms [1..n]</code>.  That is, given an input list, generate its permutations and apply a filter to them.  (This version of <code>alternating</code> only works on numbers, because it uses <code>[1..n]</code>, but the algorithm could work just as well on anything with a less-than operator.)</p>\n\n<h2>Cleaned-up Version</h2>\n\n<pre><code>import Data.List\n\n{- In the type signatures below, capitalized type names are specific types.\n - Lowercase type parameters are generic.  Ord, to the left of the =&gt; sign,\n - is the type class of all types with an ordering relation.  So, the argu-\n - ment is a list of some type a that can be ordered, and the return value\n - is a Bool, True or False.\n -}\nisEvenPerm :: Ord a =&gt; [a] -&gt; Bool\nisEvenPerm = even . sum . map go . tails\n  where go []     = 0\n        go (x:xs) = length . filter (&lt;x) $ xs\n\nevenPerms :: Ord a =&gt; [a] -&gt; [[a]]\nevenPerms = filter isEvenPerm . permutations\n\n{- This only makes sense for positive whole numbers. -}\nalternating :: Integral a =&gt; a -&gt; [[a]]\nalternating n | n &gt;= 1    = evenPerms [1..n]\n              | otherwise = error \"Argument must be positive.\"\n</code></pre>\n\n<p>You can try <code>evenPerms \"abcd\"</code> and <code>alternating 4</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "is_accepted": false, "score": 0, "last_activity_date": 1519752343, "creation_date": 1519752343, "answer_id": 49014550, "question_id": 44977838, "link": "https://stackoverflow.com/questions/44977838/finding-even-permutations-using-haskell/49014550#49014550", "title": "Finding even permutations using Haskell", "body": "<p>I know the OP want a \"bare hands\" code but here is a way with the <code>combinat</code> package (I'm a big fan of this package) which can be helpful for future readers. Since it took me a certain time to achieve this I think it's worth to share.</p>\n\n<pre><code>import           Data.List hiding (permutations) -- just in case\nimport           Math.Combinat.Permutations\n\nfoo :: [[Double]]\nfoo =\n  [[ permuteList p [phi/2, 1/2, 1/2/phi, 0]  | p &lt;- permutations4, isEvenPermutation p] ++\n  [ permuteList p [phi/2, 1/2, -1/2/phi, 0]  |  p &lt;- permutations4, isEvenPermutation p] ++\n  [ permuteList p [phi/2, -1/2, 1/2/phi, 0]  |  p &lt;- permutations4, isEvenPermutation p] ++\n  [ permuteList p [-phi/2, -1/2, 1/2/phi, 0]  |  p &lt;- permutations4, isEvenPermutation p] ++\n  [ permuteList p [-phi/2, -1/2, 1/2/phi, 0]  |  p &lt;- permutations4, isEvenPermutation p] ++\n  [ permuteList p [-phi/2, -1/2, -1/2/phi, 0]  |  p &lt;- permutations4, isEvenPermutation p] ++\n  [ permuteList p [-phi/2, 1/2, -1/2/phi, 0]  |  p &lt;- permutations4, isEvenPermutation p] ++\n  [ permuteList p [phi/2, 1/2, -1/2/phi, 0]  |  p &lt;- permutations4, isEvenPermutation p]]\n  where\n    permutations4 = permutations 4\n    phi = (1 + sqrt 5) / 2\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 8272416, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213165024298247/picture?type=large", "display_name": "Blake Sims", "link": "https://stackoverflow.com/users/8272416/blake-sims"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1519752343, "creation_date": 1499453524, "last_edit_date": 1499518596, "question_id": 44977838, "link": "https://stackoverflow.com/questions/44977838/finding-even-permutations-using-haskell", "title": "Finding even permutations using Haskell", "body": "<p>I tried to figure out how to find the even permutations out of the set {permutations [1..n]}. I have asked this question before on a different forum, and got an answer that worked namely the code was:</p>\n\n<pre><code>Import Data.List\n\n-- number of inversions in a permutation\ninversions as = sum $ map go (tails as)\nwhere go [] = 0\ngo (x:xs) = length $ filter (&lt;x) xs\n\nevenPerm as = even (inversions as)\n\nalternating n = [ p | p &lt;- permutations [1..n], evenPerm p ]\n</code></pre>\n\n<p>I understand the last line in the code: <code>alternating n =[p | p &lt;- permutations [1..n], evenPerm p]</code>. That is, the <code>p</code> of the set <code>{permutations [1..n]}</code> such that they are even permutations. The function <code>evenPerm</code> as I think I understand too. It is just the even elements of the set <code>{inversion as}</code>. The thing I truly don't understand how it is working is the inversion as function. Naively, how I would imagine things to work is take the element of the set {permutations [1..n]} [1..n] i.e. (1,2,3,..,n) and compare every other element in the set to this one and count how many moves you have to make to get it in that form, but how you go about doing that in Haskell?</p>\n"}, {"tags": ["haskell", "xmonad"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1499451939, "post_id": 44977410, "comment_id": 76929954, "body": "That&#39;s not something xmonad handles, I believe. <code>xmodmap</code> is indeed one way to do this (as shown in your link)."}], "answers": [{"tags": [], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "is_accepted": true, "score": 3, "last_activity_date": 1499541721, "last_edit_date": 1499541721, "creation_date": 1499454082, "answer_id": 44977971, "question_id": 44977410, "link": "https://stackoverflow.com/questions/44977410/in-xmonad-how-to-remap-capslock-to-ctrl/44977971#44977971", "title": "In xmonad, how to remap CapsLock to Ctrl?", "body": "<p>@melpomene's comment led me to seek something other than xmonad for performing the keybinding remap.</p>\n\n<p>Instead I used <code>xmodmap</code> following the instructions described at this blog, <a href=\"http://efod.se/writings/linuxbook/html/caps-lock-to-ctrl.html\" rel=\"nofollow noreferrer\">Changing your caps lock into Ctrl in X</a>.</p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1255, "favorite_count": 0, "accepted_answer_id": 44977971, "answer_count": 1, "score": 1, "last_activity_date": 1499541721, "creation_date": 1499451823, "last_edit_date": 1499452057, "question_id": 44977410, "link": "https://stackoverflow.com/questions/44977410/in-xmonad-how-to-remap-capslock-to-ctrl", "title": "In xmonad, how to remap CapsLock to Ctrl?", "body": "<p>I'm new to xmonad, and trying to remap CapsLock to Ctrl.</p>\n\n<p>I think I can do this by adding a <code>~/.xmonad/xmonad.hs</code> file as suggested at this <a href=\"https://www.howtogeek.com/114728/how-to-use-xmonad-a-tiling-window-manager-for-linux/\" rel=\"nofollow noreferrer\">xmonad setup tutorial</a>, and it seems that the <code>xmonad.hs</code> file should look something like the example given at the <a href=\"https://wiki.haskell.org/Xmonad/Frequently_asked_questions\" rel=\"nofollow noreferrer\">xmonad FAQ page</a>.</p>\n\n<pre><code>import XMonad\n\nmain = xmonad defaultConfig\n         { modMask = mod4Mask\n         , terminal = \"urxvt\"\n         }\n</code></pre>\n\n<p>I'm not sure exactly how the various fields there <code>modMask</code>, <code>mod4Mask</code>, <code>terminal</code>, and <code>\"urxvt\"</code> represent keyboard keys, or what field to use to represent my CapsLock and Ctrl keys.</p>\n\n<p><strong>How exactly do I remap my CapsLock to Ctrl?</strong></p>\n\n<p><strong>Is there documentation somewhere describing the field associated with each key, CapsLock, Ctrl, etc.?</strong></p>\n\n<p>P.S. As a side-note <a href=\"http://lists.suckless.org/dwm/0706/2715.html\" rel=\"nofollow noreferrer\">this</a> mailing list item also says something about xmonad keymay rebinding, but it does not appear to be haskell.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1499449584, "post_id": 44976769, "comment_id": 76928731, "body": "Why do you have two <code>do</code>s in a row?"}, {"owner": {"reputation": 1, "user_id": 7788590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5f85fcae2c3ddcc8ade0a811a00d8f4?s=128&d=identicon&r=PG&f=1", "display_name": "Pedro Garc&#237;a Castillo", "link": "https://stackoverflow.com/users/7788590/pedro-garc%c3%ada-castillo"}, "reply_to_user": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "edited": false, "score": 0, "creation_date": 1499449907, "post_id": 44976769, "comment_id": 76928873, "body": "One should be part of the else clause while the second one is outside the else. Maybe Isn&#180;t it?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 2, "creation_date": 1499450055, "post_id": 44976769, "comment_id": 76928946, "body": "No. An empty do block would itself be an error."}, {"owner": {"reputation": 1, "user_id": 7788590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5f85fcae2c3ddcc8ade0a811a00d8f4?s=128&d=identicon&r=PG&f=1", "display_name": "Pedro Garc&#237;a Castillo", "link": "https://stackoverflow.com/users/7788590/pedro-garc%c3%ada-castillo"}, "edited": false, "score": 0, "creation_date": 1499450085, "post_id": 44976769, "comment_id": 76928963, "body": "so what should it be?     else do return ()"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1499450432, "post_id": 44976769, "comment_id": 76929150, "body": "@PedroGarc&#237;aCastillo Should <code>testPost f_name n ts os</code> be included in both cases, or only in the <code>else</code> path? If <code>else</code> should truly be empty, I would consider using <code>Control.Monad.when</code> instead of <code>if</code>."}, {"owner": {"reputation": 1, "user_id": 7788590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5f85fcae2c3ddcc8ade0a811a00d8f4?s=128&d=identicon&r=PG&f=1", "display_name": "Pedro Garc&#237;a Castillo", "link": "https://stackoverflow.com/users/7788590/pedro-garc%c3%ada-castillo"}, "edited": false, "score": 0, "creation_date": 1499450570, "post_id": 44976769, "comment_id": 76929220, "body": "It should be evaluated in both cases"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1499450870, "post_id": 44976769, "comment_id": 76929369, "body": "This is not a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1499451424, "post_id": 44976769, "comment_id": 76929693, "body": "@PedroGarc&#237;aCastillo <code>else return ()</code> would work (<code>do return ()</code> is fine, but the <code>do</code> is unnecessary for only a single expression). Though I think you would then have an issue with the concept of &quot;after&quot; the <code>if...</code>. Outside a <code>do</code> block there&#39;s no concept of sequencing expressions, so you would have to put the <code>if-then-else</code> and the <code>testPost ...</code> inside an outer <code>do</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7788590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5f85fcae2c3ddcc8ade0a811a00d8f4?s=128&d=identicon&r=PG&f=1", "display_name": "Pedro Garc&#237;a Castillo", "link": "https://stackoverflow.com/users/7788590/pedro-garc%c3%ada-castillo"}, "edited": false, "score": 0, "creation_date": 1499451572, "post_id": 44977171, "comment_id": 76929760, "body": "Thanks a lot I didnt knew when at all but it&#39;s really usefull as you say to avoiud mixing if&#39;s and do&#39;s."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499454200, "post_id": 44977171, "comment_id": 76931087, "body": "<code>if</code> is not indentation sensitive, so a statement containing the phrase &quot;the layout of <code>if</code>&quot; doesn&#39;t make sense."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499456032, "post_id": 44977171, "comment_id": 76932050, "body": "@user2407038 I&#39;ll admit I don&#39;t know the rules precisely, but I&#39;ve had to adjust the layout of <code>if-then-else</code> when used inside a <code>do</code> block."}], "tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": false, "score": 1, "last_activity_date": 1499450902, "creation_date": 1499450902, "answer_id": 44977171, "question_id": 44976769, "link": "https://stackoverflow.com/questions/44976769/im-getting-haskell-parse-error-possibly-incorrect-indentation-or-mismatched-b/44977171#44977171", "title": "I&#39;m getting Haskell &quot;parse error (possibly incorrect indentation or mismatched brackets)&quot; and I cannot see what&#39;s wrong", "body": "<p>To get it to compile, at least:</p>\n\n<pre><code>import Control.Monad (when)\n\nnewtype Name = Name { nameBase::String}\n\npost _ _ _ _ = True\n\n-----Function to test the postcondition----------------------------------\ntestPost :: (Show a,Show b) =&gt; Name -&gt; Int -&gt; [a] -&gt; [b] -&gt; IO ()\ntestPost _ _ [] [] = putStrLn \"Test finished correctly\"\ntestPost f_name n (t:ts) (o:os) = do\n  when (not aux_bool) $ do\n    putStr (\"Failed on function \" ++ (nameBase f_name) ++ \" with inputs \")\n    print ts\n    putStr \" and output \"\n    print os\n    putStrLn \"\"\n  testPost f_name n ts os\n  where\n    aux_bool = post f_name n t o\n</code></pre>\n\n<p>The layout with <code>if-then-else</code> and <code>do</code> can get tricky. Personally, I try to avoid mixing them if I can. Something that could have helped is pulling out the bodies of each block into their own expressions to simplify things when trying to debug.</p>\n"}], "owner": {"reputation": 1, "user_id": 7788590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5f85fcae2c3ddcc8ade0a811a00d8f4?s=128&d=identicon&r=PG&f=1", "display_name": "Pedro Garc&#237;a Castillo", "link": "https://stackoverflow.com/users/7788590/pedro-garc%c3%ada-castillo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1499450902, "creation_date": 1499449258, "last_edit_date": 1499449645, "question_id": 44976769, "link": "https://stackoverflow.com/questions/44976769/im-getting-haskell-parse-error-possibly-incorrect-indentation-or-mismatched-b", "title": "I&#39;m getting Haskell &quot;parse error (possibly incorrect indentation or mismatched brackets)&quot; and I cannot see what&#39;s wrong", "body": "<p>Here is the code where I'm actually having the problem:</p>\n\n<pre><code>-----Function to test the postcondition----------------------------------\ntestPost :: Name -&gt; Int -&gt; [a] -&gt; [b] -&gt; IO ()\ntestPost _ _ [] [] = putStrLn \"Test finished correctly\"\ntestPost f_name n (t:ts) (o:os) = if (not aux_bool) then\n                                         do putStr (\"Failed on function \" ++ (nameBase f_name) ++ \" with inputs \")\n                                            print ts\n                                            putStr \" and output \"\n                                            print os\n                                            putStrLn \"\"\n                                  else do\n                                  do testPost f_name n ts os\n                                      where aux_bool = post f_name n t o\n</code></pre>\n\n<p>The compiler just complains about the first line:</p>\n\n<pre><code>C:\\Users\\pegartillo\\Desktop\\TFG\\CaseGenerator\\src\\UUTReader.hs:205:1:\n    parse error (possibly incorrect indentation or mismatched brackets)\n</code></pre>\n\n<p>I am using the template haskell library, that's why it appears Name data type.</p>\n"}, {"tags": ["haskell", "amqp", "x509"], "comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1499857785, "post_id": 44974783, "comment_id": 77085092, "body": "So you want to authenticate the client, so the server can trust the client?"}, {"owner": {"reputation": 2416, "user_id": 990403, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3bcbd781c6de2ac68c0cfab7ff90c714?s=128&d=identicon&r=PG", "display_name": "mkingston", "link": "https://stackoverflow.com/users/990403/mkingston"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1499871959, "post_id": 44974783, "comment_id": 77096074, "body": "Sorry about the delayed reply. That is correct. I&#39;ll test your answer sometime this afternoon and let you know how it goes. Thanks!"}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1499961227, "post_id": 44974783, "comment_id": 77143671, "body": "Let me know if you have problems getting this to work. We could start a chat for that, too."}, {"owner": {"reputation": 2416, "user_id": 990403, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3bcbd781c6de2ac68c0cfab7ff90c714?s=128&d=identicon&r=PG", "display_name": "mkingston", "link": "https://stackoverflow.com/users/990403/mkingston"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1499985332, "post_id": 44974783, "comment_id": 77156526, "body": "Thanks a lot for the offer. I had a bit of time yesterday afternoon, but not enough. Then was delayed today. So it&#39;s tomorrow morning&#39;s priority. My plan is to attempt a little more to incorporate your answer into my work, but if that fails I&#39;ll run your answer standalone and post back here with results. Thanks again for your help."}], "answers": [{"comments": [{"owner": {"reputation": 2416, "user_id": 990403, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3bcbd781c6de2ac68c0cfab7ff90c714?s=128&d=identicon&r=PG", "display_name": "mkingston", "link": "https://stackoverflow.com/users/990403/mkingston"}, "edited": false, "score": 0, "creation_date": 1500047250, "post_id": 45052350, "comment_id": 77185195, "body": "Hey, I haven&#39;t got my own solution working totally yet; but I think your answer got me within reach. Thanks a lot. Hope you don&#39;t mind if I come crawling back with more questions later. (Though I hope not to). Thanks again, have a great weekend."}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 1, "last_activity_date": 1499868679, "last_edit_date": 1499868679, "creation_date": 1499848073, "answer_id": 45052350, "question_id": 44974783, "link": "https://stackoverflow.com/questions/44974783/haskell-amqp-x509-client-auth/45052350#45052350", "title": "haskell amqp x509 client auth", "body": "<p>We need to do two (for my test environment three) things.</p>\n\n<ol>\n<li>read the client credentials</li>\n<li>set a cipher suite as <code>defaultParamsClient</code> sets an empty cipher suite (I don't know why.).</li>\n<li>(for my test environment) read the CA root certificate, so we can validate the server certificate presented to us. If you are not in a test environment, then this certificate should be installed in the system certificate store and should be found be default. In this case you could drop the <code>CertificateStore</code> handling from the programm.</li>\n</ol>\n\n<p>The function <code>mkMyTLSSettings</code> in the following program replaces the mentioned parts from the result of <code>defaultParamsClient</code>. In the function used as <code>onCertificateRequest</code> you could consume the argument and hand out different credentials depending on the argument <a href=\"https://hackage.haskell.org/package/tls-1.3.11/docs/Network-TLS.html#t:ClientHooks\" rel=\"nofollow noreferrer\">values</a>. The needed values themself are read in\n<code>main</code> to get rid of <code>IO</code>.</p>\n\n<p>For the following program, I modified bits I found in this <a href=\"https://stackoverflow.com/a/40082394/\">answer</a>.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Main where\n\nimport Data.Default.Class\nimport Network.AMQP\nimport Network.Socket.Internal (PortNumber)\nimport Network.TLS\nimport Network.TLS.Extra.Cipher (ciphersuite_default)\nimport Data.X509.CertificateStore (CertificateStore (..), readCertificateStore)\nimport Data.Maybe\nimport qualified Data.ByteString as BS\nimport qualified Network.Connection as C\nimport qualified Data.ByteString.Lazy.Char8 as BL\n\nmkMyTLSSettings :: CertificateStore -&gt; Credential -&gt; C.TLSSettings\nmkMyTLSSettings castore creds =\n  let defaultParams = defaultParamsClient \"127.0.0.1\" BS.empty\n      newClientShared = (clientShared defaultParams) { sharedCAStore = castore }\n      newClientSupported = (clientSupported defaultParams) { supportedCiphers = ciphersuite_default }\n      newClientHooks = (clientHooks defaultParams) { onCertificateRequest = \\_ -&gt; return (Just creds) }\n  in C.TLSSettings $ defaultParams { clientShared = newClientShared\n                                   , clientSupported = newClientSupported\n                                   , clientHooks = newClientHooks\n                                   }\n\nmyTLSSettings :: CertificateStore -&gt; Credential -&gt; TLSSettings\nmyTLSSettings castore creds = TLSCustom $ mkMyTLSSettings castore creds\n\nmyTLSConnectionOpts :: TLSSettings -&gt; ConnectionOpts\nmyTLSConnectionOpts opts = ConnectionOpts\n  [(\"127.0.0.1\", 5671 :: PortNumber)]\n  \"/\"\n  [plain \"guest\" \"guest\"]\n  (Just 131072)\n  Nothing\n  (Just 1)\n  (Just opts)\n\ntestConnectionOpts :: ConnectionOpts -&gt; IO ()\ntestConnectionOpts opts = do \n   conn &lt;- openConnection'' opts\n   chan &lt;- openChannel conn\n   declareQueue chan newQueue {queueName = \"hello\"}\n   putStrLn \"Trying to register callback\"\n   consumeMsgs chan \"hello\" Ack myCallback\n   publishMsg chan \"\" \"hello\" newMsg {msgBody = (BL.pack \"hello world\"), msgDeliveryMode = Just Persistent}\n   getLine\n   closeConnection conn\n   putStrLn \"connection closed\"\n\nmain :: IO ()\nmain = do\n  testConnectionOpts defaultConnectionOpts\n  putStrLn \"trying with tls\"\n  castore &lt;- maybe (error \"couldn't read CA root Certificate\") id &lt;$&gt; (readCertificateStore \"/pathto/rootCA.pem\")\n  creds &lt;- either error id &lt;$&gt; credentialLoadX509 \"/pathto/client.pem\" \"/pathto/client.key\"\n  let opts = myTLSSettings castore creds\n  testConnectionOpts (myTLSConnectionOpts opts)\n\nmyCallback :: (Message, Envelope) -&gt; IO ()\nmyCallback (msg, env) = do\n  putStrLn $ \"received message: \" ++ (BL.unpack $ msgBody msg)\n  ackEnv env\n</code></pre>\n\n<p>As a <a href=\"https://gist.github.com/erwo42/ff499b0632ef9a0d9a1659ffa3a4a6a3\" rel=\"nofollow noreferrer\">gist</a>.</p>\n\n<p>The first communication in this program I did to make sure that rabbitmq was setup properly and I really only encountered TLS errors. If you delete line 20 and 23 you can test wether you configured your rabbitmq correctly. The connection attempt in this case should fail, as we don't present a client certificate.</p>\n\n<p>I created a toy CA for testing and issued a certificate for use with the rabbitmq server and one for the client. So I had a file <code>rootCA.pem</code> which stored the CA root certificate and files like <code>rabbitmq.key</code> and <code>rabbitmq.pem</code> which where used to setup TLS with rabbitmq. Also <code>client.pem</code> and <code>client.key</code> for the client. I configured rabbitmq to only serve clients which present a trustworthy certificate, by setting\n<code>fail_if_no_peer_cert</code> to <code>true</code> and setting the <code>{verify, verify_peer}</code> options.</p>\n\n<p>On my first tries I got the kinds of errors with <code>LeafNotV3</code> which means I created my <code>rabbitmq.pem</code> wrong on my first try. It was a X509.v1 certificate, which are not accepted by <code>Network.TLS</code> by default. I needed to make sure to create a X509.v3 certificate, which is done, by enabling certain extensions while issuing the certificate <code>rabbitmq.pem</code>, see <a href=\"https://stackoverflow.com/questions/18233835/creating-an-x509-v3-user-certificate-by-signing-csr\">here</a>. I needed to add the option <code>-req</code> to that command line cited there to make it work.</p>\n"}], "owner": {"reputation": 2416, "user_id": 990403, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3bcbd781c6de2ac68c0cfab7ff90c714?s=128&d=identicon&r=PG", "display_name": "mkingston", "link": "https://stackoverflow.com/users/990403/mkingston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 45052350, "answer_count": 1, "score": 1, "last_activity_date": 1499868679, "creation_date": 1499441902, "question_id": 44974783, "link": "https://stackoverflow.com/questions/44974783/haskell-amqp-x509-client-auth", "title": "haskell amqp x509 client auth", "body": "<p>I've been trying to figure out how to use x509 client auth with <code>Network.AMQP</code>. It seems like I need to create an <code>AMQP.ConnectionOpts</code> with (amongst others) the <code>coTLSSettings</code> parameter as follows:</p>\n\n<pre><code>import qualified Network.AMQP as AMQP\nimport Network.Connection\nlet opts = AMQP.ConnectionOpts {\n    ..\n  , coTLSSettings = Just $ AMQP.TLSCustom $ ...\n}\n</code></pre>\n\n<p>At this point (the ellipsis), having read some of the <code>Network.Connection</code> documentation (and being rather out of my depth) it's starting to look very complicated. And I'm left wondering whether I'm going down the right path here.</p>\n\n<p>So, my question(s): how do I implement x509 client auth easily? If the answer to that is \"you can't,\" does anyone know where I can find an example of x509 client auth using the <code>Network.Connection</code> module?</p>\n"}, {"tags": ["haskell", "polymorphism", "composition", "higher-kinded-types"], "comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 3, "creation_date": 1499444114, "post_id": 44974688, "comment_id": 76926001, "body": "I think <code>mapToList foo (Compose y)</code> will work with your <code>mapToList</code> definition, if that&#39;s reasonable. <code>Compose y</code> would have type <code>Compose [] ((,) String) t</code>."}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1499453680, "post_id": 44974688, "comment_id": 76930865, "body": "I like your solution with <code>Compose</code> more. Probably it&#39;s the least possible boilerplate I can imagine with general approach. But can it be done in reverse way? For example, mostly I have lists and only few <code>Maybe</code>&#39;s. Can I somehow flatten or ignore types to specify type only for <code>Maybe</code>?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1499456757, "post_id": 44974688, "comment_id": 76932408, "body": "You could use <code>mapToList f = concatMap (map f . toList)</code> with type <code>mapToList :: (Foldable f) =&gt; (t -&gt; a) -&gt; [f t] -&gt; [a]</code> and wrap your <code>Maybe</code> values in <code>[]</code>. Or you could use <code>(Foldable fo,Foldable fi) =&gt; fo (fi t)</code> and an extra <code>toList</code> call and wrap it in any <code>Foldable</code> (<code>Identity</code>, perhaps). I would probably prefer the list version unless the generality was truly needed."}], "answers": [{"tags": [], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "is_accepted": false, "score": 1, "last_activity_date": 1499446456, "creation_date": 1499446456, "answer_id": 44976099, "question_id": 44974688, "link": "https://stackoverflow.com/questions/44974688/generalize-function-to-fold-both-elements-with-one-higher-kinded-type-and-with-t/44976099#44976099", "title": "Generalize function to fold both elements with one higher-kinded type and with two nested types?", "body": "<p>Not sure this helps at all since it's just shifting the boilerplate away from the call site, but:</p>\n\n<pre><code>{-# LANGUAGE FlexibleInstances,FunctionalDependencies,RankNTypes #-}\n\nimport Data.Functor.Compose (Compose(Compose))\nimport Data.Foldable\n\nclass AsFoldable x a | x -&gt; a where\n  withFoldable :: (forall f. (Foldable f) =&gt; f a -&gt; b) -&gt; x -&gt; b\n\ninstance AsFoldable [(String,a)] a where\n  withFoldable f = f . Compose\n\ninstance AsFoldable (Maybe a) a where\n  withFoldable = id\n\nx :: Maybe Int\nx = Just 3\n\ny :: [(String,Int)]\ny = [(\"A\",5),(\"B\",6)]\n\nmapToList :: (AsFoldable x t) =&gt; (t -&gt; a) -&gt; x -&gt; [a]\nmapToList f = withFoldable (map f . toList)\n\nmain = do\n  print $ mapToList (+1) x\n  print $ mapToList (+1) y\n</code></pre>\n"}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1499446456, "creation_date": 1499441676, "last_edit_date": 1499443702, "question_id": 44974688, "link": "https://stackoverflow.com/questions/44974688/generalize-function-to-fold-both-elements-with-one-higher-kinded-type-and-with-t", "title": "Generalize function to fold both elements with one higher-kinded type and with two nested types?", "body": "<p>I have next two elements:</p>\n\n<pre><code>x :: Maybe t\ny :: [(String, t)]\n</code></pre>\n\n<p>And I have a function:</p>\n\n<pre><code>foo :: t -&gt; a\n</code></pre>\n\n<p>How can I implement polymorphic function that can work both on <code>x</code> and <code>y</code> with <code>foo</code> to collect results in list? More specifically, I need to put something instead of <code>???</code> here:</p>\n\n<pre><code>mapToList :: ??? =&gt; (t -&gt; a) -&gt; ??? t -&gt; [a]\n</code></pre>\n\n<p>And I want to call with less boilerplate possible, most closest option to this is preferable:</p>\n\n<pre><code>mapToList foo x\nmapToList foo y\n</code></pre>\n\n<p>Something naive like this doesn't work :(</p>\n\n<pre><code>mapToList :: Foldable f =&gt; (t -&gt; a) -&gt; f t -&gt; [a]\nmapToList extractor = map extractor . toList\n\nmapToList @Maybe             foo x\nmapToList @([] ((,) String)) foo y\n</code></pre>\n\n<p>I was looking at <a href=\"https://www.stackage.org/haddock/lts-8.21/base-4.9.1.0/Data-Functor-Compose.html#t:Compose\" rel=\"nofollow noreferrer\"><code>Compose</code></a> but didn't manage to figure out how to apply it to my problem in nice simple way. I can use <code>Compose</code> to generalize <strong>somehow</strong> but my solution is not satisfactory. I can always use <code>map</code> for lists and just <code>maybe [] foo</code> on <code>Maybe</code>'s. But I wonder, is there nice way to generalize both use cases?</p>\n"}, {"tags": ["list", "haskell", "boolean", "concatenation", "predicate"], "comments": [{"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 2, "creation_date": 1499430528, "post_id": 44970524, "comment_id": 76916156, "body": "Have you looked at boundary cases?"}, {"owner": {"reputation": 23, "user_id": 7214509, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344622035562012/picture?type=large", "display_name": "Denis Zahariev", "link": "https://stackoverflow.com/users/7214509/denis-zahariev"}, "reply_to_user": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1499431976, "post_id": 44970524, "comment_id": 76917155, "body": "No, I have not. What exactly do you in mind?"}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1499433582, "post_id": 44970524, "comment_id": 76918238, "body": "Try to, for example, evaluate <code>all (const False) []</code>..."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 7214509, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344622035562012/picture?type=large", "display_name": "Denis Zahariev", "link": "https://stackoverflow.com/users/7214509/denis-zahariev"}, "edited": false, "score": 0, "creation_date": 1499433064, "post_id": 44970984, "comment_id": 76917901, "body": "Thanks for the answer!"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1499437416, "post_id": 44970984, "comment_id": 76921309, "body": "but the question (&quot;Boolean values of both&quot;) presupposes termination in both cases."}, {"owner": {"reputation": 336, "user_id": 7236501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f52887fba37383964c102def911c9bc?s=128&d=identicon&r=PG&f=1", "display_name": "shinobi", "link": "https://stackoverflow.com/users/7236501/shinobi"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499447049, "post_id": 44970984, "comment_id": 76927512, "body": "@Will Ness:  You have a point.  I all but started explaining how there was no way to produce different boolean values, then got carried away exploring the broader context.  I missed the point, in a way, but I&#39;ve no regrets about that :)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1499454793, "post_id": 44970984, "comment_id": 76931447, "body": "Of course, if you want to avoid the &#39;luck&#39; factor, just interleave the lists and call <code>lucky</code> on that."}], "tags": [], "owner": {"reputation": 336, "user_id": 7236501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f52887fba37383964c102def911c9bc?s=128&d=identicon&r=PG&f=1", "display_name": "shinobi", "link": "https://stackoverflow.com/users/7236501/shinobi"}, "is_accepted": true, "score": 2, "last_activity_date": 1499431510, "last_edit_date": 1499431510, "creation_date": 1499431080, "answer_id": 44970984, "question_id": 44970524, "link": "https://stackoverflow.com/questions/44970524/a-list-check-before-and-after-concatenation-with-different-results/44970984#44970984", "title": "A list check before and after concatenation with different results", "body": "<p>For infinite \"lucky\" <code>bs</code> and \"unlucky\" <code>as</code>, <code>test_luck1</code> will terminate, while <code>test_luck2</code> will not.</p>\n\n<p>The functions test the values in different order, due to the (somewhat weird) implementation of <code>catenate</code>, which prepends <code>bs</code> to <code>as</code>.  Thus, <code>test_luck1</code> tests <code>as</code> first, then <code>bs</code>, whereas <code>test_luck2</code> tests <code>bs</code> first, and then <code>as</code>.</p>\n\n<p>P.S.  This can be seen as a boundary case, as per @Mark Seemann's remark -- sorry for the spoiler ;)</p>\n"}, {"tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": false, "score": 0, "last_activity_date": 1502129607, "creation_date": 1502129607, "answer_id": 45553243, "question_id": 44970524, "link": "https://stackoverflow.com/questions/44970524/a-list-check-before-and-after-concatenation-with-different-results/45553243#45553243", "title": "A list check before and after concatenation with different results", "body": "<p>Looking at this some more, I think I was too quick on the trigger with my comments. Apart from shinobi's answer, I don't see any way in which the two functions would return different results.</p>\n\n<p>Not that this <em>proves</em> anything, but I wrote a QuickCheck property to verify the hypothesis that <code>test_luck1</code> will always return the same result as <code>test_luck2</code>:</p>\n\n<pre><code>prop :: [Integer] -&gt; [Integer] -&gt; Bool\nprop as bs =\n  test_luck1 as bs == test_luck2 as bs\n</code></pre>\n\n<p>I've been running this property with 1,000,000 tests, and they all pass, so I don't think that there's any 'normal' values of <code>as</code> and <code>bs</code> that will cause the output of <code>test_luck1</code> to be different from the output of <code>test_luck2</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 7214509, "user_type": "registered", "profile_image": "https://graph.facebook.com/1344622035562012/picture?type=large", "display_name": "Denis Zahariev", "link": "https://stackoverflow.com/users/7214509/denis-zahariev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 44970984, "answer_count": 2, "score": 2, "last_activity_date": 1502129607, "creation_date": 1499429710, "last_edit_date": 1499437659, "question_id": 44970524, "link": "https://stackoverflow.com/questions/44970524/a-list-check-before-and-after-concatenation-with-different-results", "title": "A list check before and after concatenation with different results", "body": "<p>I have an assignment and the code is really simple to understand but I cant find a possible solution. Thats the code:</p>\n\n<pre><code>lucky:: [Integer] -&gt; Bool\nlucky (xs) = all (/=13) xs\n\ncatenate as []     = as\ncatenate as (b:bs) = b : (catenate as bs)\n\ntest_luck1 as bs = lucky as &amp;&amp; lucky bs\ntest_luck2 as bs = lucky (catenate as bs)\n</code></pre>\n\n<p>So the question is: For which input(the same for both functions) are the boolean values of both functions different, for example the first one true and the second one false or vice versa. So the first function tests both lists individually and the second tests the concatenation of the lists. I have been thinking all day yesterday and have absolutely no idea. Could you guys help me with finding the trick that should be used to solve the question?</p>\n"}, {"tags": ["haskell", "functional-programming", "purely-functional"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1499426309, "post_id": 44969386, "comment_id": 76913561, "body": "Well that is up to you to decide: how to <i>generalize</i> the function. But your generalization makes sense, yes."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1499426857, "post_id": 44969386, "comment_id": 76913848, "body": "I think your example is incorrect. Is it a result on calling it on <code>&quot;howdie&quot; &quot;world&quot;</code>?"}, {"owner": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "edited": false, "score": 0, "creation_date": 1499427061, "post_id": 44969386, "comment_id": 76913940, "body": "sorry about that corrected it to the result for hello world"}, {"owner": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "edited": false, "score": 0, "creation_date": 1499427206, "post_id": 44969386, "comment_id": 76914046, "body": "I tried using something like <code>map head [&quot;hello&quot;, &quot;world&quot;]</code> which returns <code>&quot;hw&quot;</code> but i am not able to make this recursive. How do i generate a list that has dropped h and w and apply same map head to it."}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 0, "creation_date": 1499433565, "post_id": 44969386, "comment_id": 76918227, "body": "Check out <code>transpose</code> in <code>Data.List</code>."}], "answers": [{"tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 2, "last_activity_date": 1499453267, "last_edit_date": 1499453267, "creation_date": 1499427491, "answer_id": 44969849, "question_id": 44969386, "link": "https://stackoverflow.com/questions/44969386/how-do-i-extend-this-mergewords-function-to-any-number-of-strings/44969849#44969849", "title": "How do I extend this mergeWords function to any number of strings?", "body": "<p>Sounds reasonably easy if you do it in steps:</p>\n\n<pre><code>cutWords :: [String] -&gt; [[String]]    -- [\"ab\", \"cd\", \"e\"] -&gt; [[\"a\", \"c\", \"e\"], [\"b\", \"d\"]]\nconcatWord :: [String] -&gt; String       -- [\"a\", \"c\", \"e\"] -&gt; \"ace\\n\"\nconcatWords :: [String] -&gt; String    -- use mergeWord on all of them\n</code></pre>\n\n<p>The most interesting part is of course the <code>cutWords</code> part. What you want there is a zip-like behaviour, and for that it'll help if we \"safe\" <code>tail</code> and <code>head</code>:</p>\n\n<pre><code>head' (x:xs) = [x]\nhead' \"\" = \"\"\n\ntail' (x:xs) = xs\ntail' \"\" = \"\"\n</code></pre>\n\n<p>Now we can implement our <code>cutWords</code>, making sure we stop in time:</p>\n\n<pre><code>cutWords xs = heads : rest\n  where\n    heads = map head' xs\n    tails = map tail' xs\n    rest = if any (/= \"\") tails then cutWords tails\n                                else []\n</code></pre>\n\n<p>Then the remaining part is trivial:</p>\n\n<pre><code>concatWord word = concat word ++ \"\\n\"\nconcatWords words = concatMap concatWord word\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "edited": false, "score": 0, "creation_date": 1499571025, "post_id": 44972139, "comment_id": 76960149, "body": "This is a nice solution, but I am trying write transpose function myself."}], "tags": [], "owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "is_accepted": false, "score": 4, "last_activity_date": 1499434431, "creation_date": 1499434431, "answer_id": 44972139, "question_id": 44969386, "link": "https://stackoverflow.com/questions/44969386/how-do-i-extend-this-mergewords-function-to-any-number-of-strings/44972139#44972139", "title": "How do I extend this mergeWords function to any number of strings?", "body": "<p>The puzzle is effectively to merge a <em>list</em> of words, a character at a time, into lines with trailing newline characters.</p>\n\n<pre><code>mergeWords :: [String] -&gt; String\n</code></pre>\n\n<p>We need to take a list like</p>\n\n<pre><code>[ \"hello\"\n, \"jim\"\n, \"nice\"\n, \"day\"\n]\n</code></pre>\n\n<p>and rearrange it into the lists of things at a given position</p>\n\n<pre><code>[ \"hjnd\"\n, \"eiia\"\n, \"lmcy\"\n, \"le\"\n, \"o\"\n]\n</code></pre>\n\n<p>That's what the library function <code>transpose</code> does.</p>\n\n<p>And then we need to make a single string which treats those as lines, separated by newlines. Which is what <code>unlines</code> does.</p>\n\n<p>So</p>\n\n<pre><code>mergeWords = unlines . transpose\n</code></pre>\n\n<p>and we're done.</p>\n"}], "owner": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 44969849, "answer_count": 2, "score": 2, "last_activity_date": 1499453267, "creation_date": 1499426055, "last_edit_date": 1499426988, "question_id": 44969386, "link": "https://stackoverflow.com/questions/44969386/how-do-i-extend-this-mergewords-function-to-any-number-of-strings", "title": "How do I extend this mergeWords function to any number of strings?", "body": "<p>Following is the mergeWords function.</p>\n\n<pre><code>mergeWords [] [] = []\nmergeWords [] (y:ys) = y:'\\n':(mergeWords [] ys)\nmergeWords (x:xs) [] = x:'\\n':(mergeWords xs [])\nmergeWords (x:xs) (y:ys) = x:y:'\\n':(mergeWords xs ys)\n</code></pre>\n\n<p>If applied on <code>mergeWords \"hello\" \"world\"</code> it gives </p>\n\n<pre><code>\"hw\\neo\\nlr\\nll\\nod\\n\"\n</code></pre>\n\n<p>I can't figure out how to extend this to list of strings. Like applying it to 3 strings should first take first character of each of the strings and then put a '\\n' and then the second character and so on. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 8, "creation_date": 1499421335, "post_id": 44967783, "comment_id": 76910541, "body": "Where did you find that second code fragment. That is not valid Haskell code."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1499423016, "post_id": 44967783, "comment_id": 76911586, "body": "@WillemVanOnsem theoretically speaking, it <i>is</i> valid Haskell; what it does is, it defines the type <code>Newtype</code> as <code>(Bool Int) String</code>. Which is not well-kinded because <code>Bool</code> doesn&#39;t accept any type parameters. However, <code>type Newtype = Either Int String</code> would be legal. \u2014 Obviously you&#39;re right though: this looks like somebody completely messed up an example of the <code>newtype</code> keyword."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1499423218, "post_id": 44967783, "comment_id": 76911699, "body": "@leftaroundabout: yes, it is valid Haskell in syntax and grammar. But the type system will error on the fact that <code>Bool</code> has type <code>*</code> and not <code>* -&gt; * -&gt; *</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1499423168, "last_edit_date": 1499423168, "creation_date": 1499422345, "answer_id": 44968222, "question_id": 44967783, "link": "https://stackoverflow.com/questions/44967783/understanding-type-keyword-in-haskell/44968222#44968222", "title": "Understanding Type keyword in haskell", "body": "<p>As one can read in <a href=\"https://wiki.haskell.org/Type#Type_and_newtype\" rel=\"noreferrer\">the documentation</a>:</p>\n\n<blockquote>\n  <p><strong>2 Type and newtype</strong></p>\n  \n  <p>The other two ways one may introduce types to Haskell programs are via\n  the <code>type</code> and <code>newtype</code> statements. <strong><code>type</code> introduces a synonym</strong>\n  for a type and uses the same data constructors. (..) When using a type\n  declaration, the type synonym and its base type are interchangeble\n  almost everywhere (There are some restrictions when dealing with\n  instance declarations).</p>\n</blockquote>\n\n<p>So <code>type &lt;name&gt; = &lt;type-expression&gt;</code> simply renames a (usually more complex) type expression. As a result the second code fragment is <strong>invalid</strong>.</p>\n\n<p>It is however possible that there are higher order types in the <code>&lt;type-expression&gt;</code> like:</p>\n\n<pre><code>type Alias = Either Int String\n</code></pre>\n\n<p>This is because the <code>Either</code> type is a higher order type: it has \"meta-type\" <code>* -&gt; * -&gt; *</code>. So here you thus \"apply\" <code>Int</code> and <code>String</code> to <code>Either</code>.</p>\n\n<p>Note that an alias does not have any special semantics: for Haskell <code>Alias</code> is the same as <code>Either Int String</code> and vice versa: every method that is defined on <code>Alias</code> works with <code>Either Int String</code> as well.</p>\n\n<p>If you however write <code>type NewType = Bool Int String</code>, then the type system will complain that:</p>\n\n<pre><code>\u2022 Expecting two fewer arguments to \u2018Bool\u2019\n  Expected kind \u2018* -&gt; * -&gt; k0\u2019, but \u2018Bool\u2019 has kind \u2018*\u2019\n\u2022 In the type \u2018Bool Int String\u2019\n  In the type declaration for \u2018NewType\u2019\n</code></pre>\n\n<p>So it complains that <code>Bool</code> is a type that does <em>not</em> accept any (two) type parameters. Therefore it cannot construct such a type.</p>\n"}], "owner": {"reputation": 1231, "user_id": 6026051, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-dO8H_7VApJo/AAAAAAAAAAI/AAAAAAAAFCw/Of-7HvES4dE/photo.jpg?sz=128", "display_name": "danish sodhi", "link": "https://stackoverflow.com/users/6026051/danish-sodhi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 983, "favorite_count": 0, "accepted_answer_id": 44968222, "answer_count": 1, "score": 0, "last_activity_date": 1499462653, "creation_date": 1499421076, "last_edit_date": 1499462653, "question_id": 44967783, "link": "https://stackoverflow.com/questions/44967783/understanding-type-keyword-in-haskell", "title": "Understanding Type keyword in haskell", "body": "<p>From my understanding of type keyword, <code>type</code> keyword creates synonyms.</p>\n\n<pre><code>type String = [Char] \n</code></pre>\n\n<p>But how can I interpret something like this : </p>\n\n<pre><code>type Newtype = Bool\n      Int\n      String\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1499416682, "post_id": 44964917, "comment_id": 76907314, "body": "Please always link to the concrete APIs you&#39;re working, with, i.e. in this case <a href=\"http://hackage.haskell.org/package/sdl2-2.2.0/docs/SDL-Audio.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/sdl2-2.2.0/docs/SDL-Audio.html</a> and <a href=\"https://hackage.haskell.org/package/wave-0.1.4/docs/Codec-Audio-Wave.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/wave-0.1.4/docs/&hellip;</a>, or what? \u2014 Generally speaking, you don&#39;t want \u201ccallbacks communicating with each other\u201d. Those \u201cfile callbacks\u201d aren&#39;t really understood as callbacks at all, merely as exception brackets. Just put the audio-recorder entirely within that bracket. That&#39;s of  course a bit limiting; the modern alterative are pipes/<a href=\"http://hackage.haskell.org/package/conduit-audio\" rel=\"nofollow noreferrer\">conduits</a>."}, {"owner": {"reputation": 7463, "user_id": 1145760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/065408758852145010d28c2aa811ca68?s=128&d=identicon&r=PG", "display_name": "Vorac", "link": "https://stackoverflow.com/users/1145760/vorac"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499420116, "post_id": 44964917, "comment_id": 76909684, "body": "@leftaroundabout Still confused. Is this my &quot;recorder&quot;: <code>openAudioDevice :: MonadIO m =&gt; OpenDeviceSpec -&gt; m (AudioDevice, AudioSpec)</code> (audioCb is part of AudioSpec)?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1499455398, "post_id": 44964917, "comment_id": 76931732, "body": "&quot;Callback&quot; is a poor name to describe the role of the function argument to <code>writeWaveFile</code>, so whatever intuition you have about &quot;callbacks&quot; you should simply discard. Your program logic will work something like this: open the audio device, in the scope of the <code>Handle</code>, read some amount of data from the device and write it to the <code>Handle</code>, and then after the scope of the <code>Handle</code>, close your device. This is exactly what you would do if you were explicitly opening and closing the file, except you don&#39;t need to explicitly open or close it."}, {"owner": {"reputation": 7463, "user_id": 1145760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/065408758852145010d28c2aa811ca68?s=128&d=identicon&r=PG", "display_name": "Vorac", "link": "https://stackoverflow.com/users/1145760/vorac"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1500388963, "post_id": 44964917, "comment_id": 77308090, "body": "@leftaroundabout, user2407038 - thanks for the help. Took me a couple of days to realize what &quot;in the context of&quot; means (which is - exactly what is C). Now my first Haskell program is complete. Yey!"}], "owner": {"reputation": 7463, "user_id": 1145760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/065408758852145010d28c2aa811ca68?s=128&d=identicon&r=PG", "display_name": "Vorac", "link": "https://stackoverflow.com/users/1145760/vorac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500388877, "creation_date": 1499412292, "last_edit_date": 1500388877, "question_id": 44964917, "link": "https://stackoverflow.com/questions/44964917/how-to-communicate-among-two-callbacks", "title": "How to communicate among two callbacks?", "body": "<p>AS an introduction to the language, I am writing a simple sound recorder, using <a href=\"http://hackage.haskell.org/package/sdl2-2.2.0/docs/SDL-Audio.html\" rel=\"nofollow noreferrer\">sdl2</a> and <a href=\"https://hackage.haskell.org/package/wave-0.1.4/docs/Codec-Audio-Wave.html\" rel=\"nofollow noreferrer\">wave</a></p>\n\n<p>SDL is successfully calling my audio callback. Trouble is, I have no idea how to write those bytes to a file. The audio callback is of type </p>\n\n<pre><code>openDeviceCallback :: forall actualSampleType. AudioFormat actualSampleType -&gt; IOVector actualSampleType -&gt; IO ()\n</code></pre>\n\n<p>so I don't get a <code>Handle</code> parameter here. On the other hand, the wave write callback is of type </p>\n\n<pre><code>Handle -&gt; IO ()\n</code></pre>\n\n<p>which doesn't indicate what is to be written. Please help with simple code suggestions and materials for reading.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1499407887, "post_id": 44962686, "comment_id": 76902206, "body": "<code>Just b</code> is a value of type <code>Maybe b</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6445533"}, "edited": false, "score": 0, "creation_date": 1499412532, "post_id": 44962686, "comment_id": 76904758, "body": "The type of the <code>Just</code> constructor is <code>b -&gt; Maybe b</code>. So when used as a constructor, <code>b</code> is a parameter with a value of type <code>b</code>. <code>b</code> of the LHS refers to a type parameter. <code>b</code> of the RHS refers to a value parameter. Since a type is a set of associated values, I&#39;d say both refer to the same thing, but from different levels of abstraction. Anyway, my definition is still fuzzy, sorry."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1499438571, "post_id": 44962686, "comment_id": 76922168, "body": "@n.m. <code>Just b</code> is a value of type <code>Maybe t</code> where <code>b :: t</code>. those mental shortcuts can be very confusing to new learners."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499438919, "post_id": 44962686, "comment_id": 76922459, "body": "<a href=\"https://wiki.haskell.org/Type#Data_declarations\" rel=\"nofollow noreferrer\">wiki.haskell.org/Type#Data_declarations</a> ; <a href=\"https://www.haskell.org/onlinereport/decls.html#sect4.2\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/decls.html#sect4.2</a> ; <a href=\"http://learnyouahaskell.com/making-our-own-types-and-typeclasses\" rel=\"nofollow noreferrer\">learnyouahaskell.com/making-our-own-types-and-typeclasses</a> ; <a href=\"https://en.wikibooks.org/wiki/Haskell/Type_declarations#data_and_constructor_functions\" rel=\"nofollow noreferrer\">en.wikibooks.org/wiki/Haskell/&hellip;</a> ; etc. search for &quot;haskell data declaration&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 534, "user_id": 3741667, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/21cb614bca606c41959304bf9463f8d0?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas", "link": "https://stackoverflow.com/users/3741667/jonas"}, "edited": false, "score": 0, "creation_date": 1499409912, "post_id": 44963625, "comment_id": 76903218, "body": "<code>Just b does, indeed, indicate that one of the ways you can create a value of Maybe b is by supplying a value of the type b.</code> This helps. Thanks. Though, I will tend to consider the type of <code>Just 42</code> as concrete rather abstract."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499439041, "post_id": 44963625, "comment_id": 76922561, "body": "&quot;generic&quot; in Haskellspeak is &quot;parametric&quot;, methinks. tyvar is just tyvar, no &quot;generic&quot; qualifier is needed here."}], "tags": [], "owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "is_accepted": true, "score": 0, "last_activity_date": 1499407653, "creation_date": 1499407653, "answer_id": 44963625, "question_id": 44962686, "link": "https://stackoverflow.com/questions/44962686/type-parameters-in-type-and-data-constructors/44963625#44963625", "title": "Type parameters in type and data constructors", "body": "<p><code>data Maybe b</code> means that the type is generic, and that <code>b</code> is the generic type variable.</p>\n\n<p><code>Just b</code> does, indeed, indicate that one of the ways you can create a value of <code>Maybe b</code> is by supplying a value of the type <code>b</code>.</p>\n\n<pre><code>Prelude&gt; Just \"foo\"\nJust \"foo\"\nPrelude&gt; Just 42\nJust 42\n</code></pre>\n\n<p>Here, <code>Just \"Foo\"</code> has the type <code>Maybe String</code>, so the type type variable <code>b</code> is <code>String</code>. In Haskell, types are variables as well.</p>\n\n<p>If you, however, examine the type of <code>Just 42</code>, you'll see that it's still abstract:</p>\n\n<pre><code>Prelude&gt; :t Just 42\nJust 42 :: Num a =&gt; Maybe a\n</code></pre>\n\n<p>This means that it could be any <code>Maybe a</code> as long as <code>a</code> is an instance of the <code>Num</code> typeclass. So in this case, the type is still 'variable'.</p>\n\n<p>(The first example, <code>data Int</code>, doesn't compile...)</p>\n"}], "owner": {"reputation": 534, "user_id": 3741667, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/21cb614bca606c41959304bf9463f8d0?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas", "link": "https://stackoverflow.com/users/3741667/jonas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 44963625, "answer_count": 1, "score": 3, "last_activity_date": 1499409043, "creation_date": 1499402548, "last_edit_date": 1499409043, "question_id": 44962686, "link": "https://stackoverflow.com/questions/44962686/type-parameters-in-type-and-data-constructors", "title": "Type parameters in type and data constructors", "body": "<p>If I understand correctly,</p>\n\n<pre><code>data Int = 1 | 2 | 3 | 4 | ...\n</code></pre>\n\n<p>All things on the right-hand side are just values.</p>\n\n<p>In the following,</p>\n\n<pre><code>data Maybe b = Nothing\n             | Just b\n</code></pre>\n\n<p>Do <code>b</code> in <code>Maybe b</code> and <code>b</code> in <code>Just b</code> mean the same thing? To me, it looks like that <code>b</code> in <code>Maybe b</code> is a <strong>type variable</strong>, and <code>b</code> in <code>Just b</code> is a <strong>value variable of type b</strong>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1499392518, "post_id": 44961256, "comment_id": 76898110, "body": "For the record, I&#39;m guessing you&#39;re not using the signature <code>toFoo :: forall p. (Maybe (forall a. p a)) -&gt; Foo p</code> (which would make the implementation trivial) because of the &quot;GHC doesn&#39;t yet support impredicative polymorphism&quot; error message."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 0, "creation_date": 1499393016, "post_id": 44961256, "comment_id": 76898252, "body": "@rampion, ah, now I understand your question. I think that&#39;s a valid question, but perhaps a slightly different one."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "edited": false, "score": 1, "creation_date": 1499431206, "post_id": 44961256, "comment_id": 76916626, "body": "@rampion Isn&#39;t the question equivalent to <code>(forall a. Maybe (p a)) -&gt; Maybe (forall a. p a)</code>? Not the type in your comment"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1499432020, "post_id": 44961256, "comment_id": 76917193, "body": "I have a feeling there might exist datatypes <code>T</code> for which <code>forall a. T a</code> is not equivalent to <code>T (forall a. a)</code>. Struggling to come up with an example though, so I may well be wrong."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 2, "creation_date": 1499432252, "post_id": 44961256, "comment_id": 76917327, "body": "Actually, yeah: <code>newtype Pred a = Pred { runPred :: a -&gt; Bool }</code>. <code>forall a. Pred a</code> is a polymorphic predicate that works on any <code>a</code>, but <code>Pred (forall a. a)</code> (let&#39;s pretend for a moment that that&#39;s a valid type) is a monomorphic predicate that only works on polymorphic values. So there&#39;s no general recipe for pushing the <code>forall</code>s around like that. Any answer you&#39;re gonna get is going to have to be specific to <code>Maybe</code> (or at least some part of its interface, like <code>Functor</code>)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1499451175, "post_id": 44961256, "comment_id": 76929544, "body": "@BenjaminHodgson, that&#39;s an example where it can&#39;t be pulled out; it can be pushed in just fine. Note also the &quot;when sound&quot; in the title."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1499452937, "post_id": 44961256, "comment_id": 76930479, "body": "Ah, of course. Keen to see if this question gets an answer!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499457092, "post_id": 44961256, "comment_id": 76932571, "body": "\u201cbecause parametricity ensures that <code>m @a</code> behaves exactly the same as <code>m @()</code>\u201d \u2013 true, but only if <code>a</code> is completely unconstrained. <i>You</i> know that, but I don&#39;t suppose GHC has a special case of universal quantification witnessing that free theorem, hence it&#39;s a piece of information the compiler has no right to exploit \u2013 you must explicitly circumvent the type system to get access to it, as you do with <code>fromJust</code> or <code>unsafeCoerce</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1499460641, "post_id": 44961256, "comment_id": 76934159, "body": "@leftaroundabout, it must have <i>some</i> of that machinery to make @rampion&#39;s expression (and my <code>unsafeCoerce#</code> one) work as written. It instantiates <code>a</code> to <code>Any</code> to perform the pattern match, knowing that it doesn&#39;t matter which type it picks."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499404348, "post_id": 44961791, "comment_id": 76900927, "body": "Another disgusting option is to match on the <code>Just</code> constructor and then <code>unsafeCoerce</code> its contents to generalize."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": false, "score": 1, "last_activity_date": 1499395788, "creation_date": 1499395788, "answer_id": 44961791, "question_id": 44961256, "link": "https://stackoverflow.com/questions/44961256/is-there-a-way-to-push-foralls-past-constructors-when-sound/44961791#44961791", "title": "Is there a way to push foralls past constructors when sound?", "body": "<p>The best I can come up with so far still uses <code>fromJust</code>, but it's simpler:</p>\n\n<pre><code>toFoo :: forall p.\n         (forall a. Maybe (p a))\n      -&gt; Foo p\ntoFoo Nothing = NoFoo\ntoFoo m = YesFoo $ fromJust m\n</code></pre>\n"}], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": 10, "last_activity_date": 1499455427, "creation_date": 1499391389, "last_edit_date": 1499455427, "question_id": 44961256, "link": "https://stackoverflow.com/questions/44961256/is-there-a-way-to-push-foralls-past-constructors-when-sound", "title": "Is there a way to push foralls past constructors when sound?", "body": "<p>Suppose I have</p>\n\n<pre><code>data Foo p =\n    NoFoo\n  | YesFoo (forall a. p a)\n</code></pre>\n\n<p>I can write</p>\n\n<pre><code>fromFoo :: Foo p -&gt; Maybe (p a)\nfromFoo NoFoo = Nothing\nfromFoo (YesFoo p) = Just p\n</code></pre>\n\n<p>It's also possible to go the other way:</p>\n\n<pre><code>toFoo :: forall p.\n         (forall a. Maybe (p a))\n      -&gt; Foo p\ntoFoo m =\n  case m :: Maybe (p ()) of\n    Nothing -&gt; NoFoo\n    Just _ -&gt; YesFoo (fromJust m)\n</code></pre>\n\n<p>The <code>fromJust</code> is disgusting! <code>toFoo</code> is actually total, because parametricity ensures that <code>m @a</code> behaves exactly the same as <code>m @()</code>, but this is gross. Is there any cleaner way?</p>\n\n<p>Edit: rampion pointed out that this can be written more concisely, still with <code>fromJust</code>. I just realized it can be done a bit humorously, making fun of the newbies:</p>\n\n<pre><code>toFoo m\n  | isNothing m = NoFoo\n  | otherwise = YesFoo (fromJust m)\n</code></pre>\n\n<p>The only way I see to avoid creating a thunk to apply <code>fromJust</code> is by getting super-evil:</p>\n\n<pre><code>toFoo Nothing = NoFoo\ntoFoo (Just x) = YesFoo (unsafeCoerce# x)\n</code></pre>\n"}, {"tags": ["haskell", "type-families"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1499372744, "post_id": 44958114, "comment_id": 76891850, "body": "If we take <code>(~&gt;) = (-&gt;)</code> they unify -- I think <code>~&gt;</code> is handled as any other type variable of kind <code>*-&gt;*-&gt;*</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1499385251, "post_id": 44958114, "comment_id": 76896363, "body": "@chi <code>~&gt;</code> isn&#39;t parsed as a type variable; removing the <code>singletons</code> import causes a scope error. <code>kx ~&gt; Constraint</code> is a type synonym which expands to <code>TyFun kx Constraint -&gt; *</code>. There is no way to unify <code>.. -&gt; *</code> and <code>.. -&gt; Constraint</code> so I think it should work; indeed if you replace <code>Constraint</code> with any other type (except <code>*</code>) it does work - so I think it&#39;s indeed a bug. Back in the day <code>*</code> and <code>Constraint</code> were the same type, so I&#39;m guessing some part of the typechecker still believes that?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499388060, "post_id": 44958114, "comment_id": 76897034, "body": "This is totally off topic, but <code>TypeInType</code> implies both <code>DataKinds</code> and (via <code>PolyKinds</code>) <code>KindSignatures</code>, so you can cut two lines of boilerplate."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499388219, "post_id": 44958114, "comment_id": 76897083, "body": "As for the actual point, I&#39;m pretty sure <code>Constraint</code> and <code>*</code> are still the same in Core, and therefore also for type families. The GHC devs are working on fixing that, but it proved complicated, so I think they put it off till 8.4."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499389784, "post_id": 44958114, "comment_id": 76897443, "body": "See <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/32\" rel=\"nofollow noreferrer\">github.com/ghc-proposals/ghc-proposals/pull/32</a>"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1499393735, "creation_date": 1499372203, "last_edit_date": 1499393735, "question_id": 44958114, "link": "https://stackoverflow.com/questions/44958114/why-these-type-family-instances-conflicting", "title": "Why these type family instances conflicting?", "body": "<p>I'm using GHC-8.0.1. This code (requires the <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow noreferrer\">singletons</a> lib):</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies            #-}       \n{-# LANGUAGE DataKinds               #-}\n{-# LANGUAGE KindSignatures          #-}\n{-# LANGUAGE TypeOperators           #-}\n{-# LANGUAGE FlexibleInstances       #-}\n{-# LANGUAGE FlexibleContexts        #-}           \n{-# LANGUAGE ScopedTypeVariables     #-}\n{-# LANGUAGE TypeInType              #-}\n{-# LANGUAGE AllowAmbiguousTypes     #-}\n{-# LANGUAGE GADTs                   #-}\n{-# LANGUAGE ConstraintKinds         #-}\n\nmodule Bug where\n\nimport Data.Kind\nimport Data.Singletons\n\ntype family MkCtx (kx :: Type) (kc :: Type) (c :: kc) (x :: kx) :: Constraint\ntype instance MkCtx kx (kx ~&gt; Constraint) c x = Apply c x\ntype instance MkCtx kx (kx -&gt; Constraint) c x = c x\n</code></pre>\n\n<p>with message:</p>\n\n<pre><code>Conflicting family instance declarations:\n      forall kx (x :: kx) (c :: kx ~&gt; Constraint).\n        MkCtx kx (kx ~&gt; Constraint) c x = Apply c x\n      forall kx (x :: kx) (c :: kx -&gt; Constraint).\n        MkCtx kx (kx -&gt; Constraint) c x = c x\n</code></pre>\n\n<p>Why GHC considers these instances conflicting? \nI don't see how they overlap.</p>\n\n<p><strong>UPDATE:</strong> Confirmed GHC bug <a href=\"https://ghc.haskell.org/trac/ghc/ticket/13931\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/13931</a></p>\n"}, {"tags": ["haskell", "monad-transformers", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 760, "user_id": 8009379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c808a3b5c059f2b448f39970d384fd33?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/8009379/alex"}, "edited": false, "score": 0, "creation_date": 1499368243, "post_id": 44956701, "comment_id": 76889670, "body": "That fixed it and enlightened me. Thank you."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 9, "last_activity_date": 1499370250, "last_edit_date": 1499370250, "creation_date": 1499366758, "answer_id": 44956701, "question_id": 44956497, "link": "https://stackoverflow.com/questions/44956497/why-does-my-maybet-state-type-ignore-state-changes/44956701#44956701", "title": "Why does my MaybeT (State &lt;type&gt;) () ignore state changes?", "body": "<p>Look at this line</p>\n\n<pre><code>verifiedMoves = map ((&gt;&gt; verify) . return) moves\n</code></pre>\n\n<p>equivalent to</p>\n\n<pre><code>= map (\\m -&gt; return m &gt;&gt; verify) moves\n</code></pre>\n\n<p>but for all <code>x</code>, we have <code>return x &gt;&gt; a = a</code>, thus</p>\n\n<pre><code>= map (\\_ -&gt; verify) moves\n</code></pre>\n\n<p>So you discarded the moves. You probably meant to use <code>lift</code> instead of <code>return</code> there.</p>\n"}], "owner": {"reputation": 760, "user_id": 8009379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c808a3b5c059f2b448f39970d384fd33?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/8009379/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 2, "accepted_answer_id": 44956701, "answer_count": 1, "score": 4, "last_activity_date": 1499370250, "creation_date": 1499365941, "question_id": 44956497, "link": "https://stackoverflow.com/questions/44956497/why-does-my-maybet-state-type-ignore-state-changes", "title": "Why does my MaybeT (State &lt;type&gt;) () ignore state changes?", "body": "<p><strong>Short version:</strong> when I use <code>runMaybeT</code> and then <code>runState</code> on a monad of type <code>MaybeT (State &lt;type&gt;) ()</code>, it looks like no state changes occur even though the <code>Maybe</code> result is equal to <code>Just ()</code>. Why?</p>\n\n<p><strong>Full version:</strong> I'm writing a program to solve the Towers of Hanoi. I represent the solution as a list of <code>State</code> monads that, when sequenced, manipulate an initial <code>Towers</code> state:</p>\n\n<pre><code>data Towers = Towers [Int] [Int] [Int]\n    deriving (Show)\ntype Move = State Towers ()\n\ntowerMoves :: Int -&gt; Rod -&gt; Rod -&gt; [Move]\ntowerMoves 1 r1 r2 = [pop r1 &gt;&gt;= push r2]\ntowerMoves n r1 r2 = topToTemp ++ (towerMoves 1 r1 r2) ++ topToFinal\n  where\n    r3 = other r1 r2\n    topToTemp = towerMoves (n - 1) r1 r3\n    topToFinal = towerMoves (n - 1) r3 r2\n\nmoves = towerMoves 5 First Third\ninitTowers = Towers [1,2,3,4,5] [] []\n\nmain = print $ snd $ runState (sequence_ moves) initTowers\n</code></pre>\n\n<p>Thus far, this program produces the correct output:</p>\n\n<pre><code>Towers [] [] [1,2,3,4,5]\n</code></pre>\n\n<p>Then, I wanted to verify that the program respected the rules of the puzzle, namely that no larger disc (represented by numbers here) comes before a smaller disc. I wanted to insert some kind of verification after every <code>Move</code>, so I tried to use the <code>MaybeT</code> monad transformer to send a failure down the list of moves:</p>\n\n<pre><code>verifiedMoves :: [MaybeT (State Towers) ()]\nverifiedMoves = map ((&gt;&gt; verify) . return) moves\n  where\n    check :: [Int] -&gt; Bool\n    check [] = True\n    check [_] = True\n    check (x:y:ys) = (x &lt; y) &amp;&amp; check (y:ys)\n    verify :: MaybeT (State Towers) ()\n    verify = do\n        (Towers xs ys zs) &lt;- lift get\n        guard (check xs &amp;&amp; check ys &amp;&amp; check zs)\n</code></pre>\n\n<p>Accordingly I changed the <code>main</code> monad:</p>\n\n<pre><code>main = maybe (putStrLn \"violation\") (const $ print finalTowers) v\n  where\n    (v, finalTowers) = runState (runMaybeT $ sequence_ verifiedMoves) initTowers\n</code></pre>\n\n<p>Now the output looks wrong, like no state changes occurred:</p>\n\n<pre><code>Towers [1,2,3,4,5] [] []\n</code></pre>\n\n<p>If I make the initial state invalid, it indeed fails the verification. So if there is no state change because the effects of the <code>Move</code>s got interrupted, I would expect the output to be the word \"violation.\"</p>\n\n<p><strong>Why</strong>, after applying <code>runMaybeT</code>, is the result of applying <code>runState</code> equal to <code>(Just (), Towers [1,2,3,4,5] [] [])</code>?</p>\n\n<hr>\n\n<p>Here is the rest of the code, for reference. I tried <a href=\"https://stackoverflow.com/questions/40973351/monad-transformers-implementation-of-a-stack-machine-with-maybet-state-stack\">lifting the <code>get</code> and <code>put</code> monads in my <code>pop</code> and <code>push</code> functions</a>, but that produced the same output.</p>\n\n<pre><code>import Control.Monad\nimport Data.Functor.Identity\nimport Control.Monad.State\nimport Control.Monad.Trans.Maybe\nimport qualified Data.Map as M\n\ndata Rod = First | Second | Third\n    deriving (Show)\n\nother :: Rod -&gt; Rod -&gt; Rod\nother First Second = Third\nother Second First = Third\nother First Third = Second\nother Third First = Second\nother Second Third = First\nother Third Second = First\n\ngetRod :: Towers -&gt; Rod -&gt; [Int]\ngetRod (Towers x y z) First  = x\ngetRod (Towers x y z) Second = y\ngetRod (Towers x y z) Third  = z\n\nsetRod :: Rod -&gt; Towers -&gt; [Int] -&gt; Towers\nsetRod First t ds  = Towers ds r2 r3\n  where\n    r2 = t `getRod` Second\n    r3 = t `getRod` Third\nsetRod Second t ds = Towers r1 ds r3\n  where\n    r1 = t `getRod` First\n    r3 = t `getRod` Third\nsetRod Third t ds  = Towers r1 r2 ds \n  where\n    r1 = t `getRod` First\n    r2 = t `getRod` Second\n\npop :: Rod -&gt; State Towers Int\npop r = do\n    t &lt;- get\n    let ds = t `getRod` r\n        d = head ds\n        load = setRod r\n    put $ t `load` (tail ds)\n    return d\n\npush :: Rod -&gt; Int -&gt; State Towers ()\npush r d = do\n    t &lt;- get\n    let ds = t `getRod` r\n        load = setRod r\n    put $ t `load` (d:ds)\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1499364079, "post_id": 44955945, "comment_id": 76887450, "body": "<code>lastButOne tail xs</code> is <code>(lastButOne tail) xs</code>, not <code>lastButOne (tail xs)</code>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1499365949, "post_id": 44955945, "comment_id": 76888457, "body": "You should avoid <code>head</code>, <code>tail</code> as much as possible. They are not idiomatic Haskell, since 1) they can crash your program if you ever use them on the empty list, and 2) pattern matching is easier to use and more convenient, too."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1499364443, "last_edit_date": 1499364443, "creation_date": 1499364103, "answer_id": 44955994, "question_id": 44955945, "link": "https://stackoverflow.com/questions/44955945/why-is-this-haskell-function-inferred-to-this-type/44955994#44955994", "title": "Why is this Haskell function inferred to this type?", "body": "<p>The problem is with the line:</p>\n\n<pre><code>        else lastButOne tail xs\n</code></pre>\n\n<p>It should be:</p>\n\n<pre><code>        else lastButOne (tail xs)\n</code></pre>\n\n<p>Otherwise <code>ghci</code> things that you give <code>lastButOne</code> two arguments: <code>tail</code> and <code>xs</code>.</p>\n\n<p>You can however make the code more elegant:</p>\n\n<pre><code>lastButOne [x,_] = x\nlastButOne xs = lastButOne $ tail xs\n</code></pre>\n\n<p>Furthermore you will have to find a way to <strong>resolve lists with one element, and the empty list</strong>. Right now the function will start looping. An idea could be to to error on these lists, like:</p>\n\n<pre><code>lastButOne [x,_] = x\nlastButOne (_:xs) = lastButOne xs\nlastButOne [] = error \"The list has no last but one element.\"\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8266602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b7d5ee98ad18842f808373e58a4ddac?s=128&d=identicon&r=PG&f=1", "display_name": "AstroEngiSci", "link": "https://stackoverflow.com/users/8266602/astroengisci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 44955994, "answer_count": 1, "score": 1, "last_activity_date": 1506542485, "creation_date": 1499363928, "last_edit_date": 1506542485, "question_id": 44955945, "link": "https://stackoverflow.com/questions/44955945/why-is-this-haskell-function-inferred-to-this-type", "title": "Why is this Haskell function inferred to this type?", "body": "<p>I'm a Haskell beginner working through an exercise in Chapter 2 of Real World Haskell, where you write a function that returns the second-to-last element of a list.</p>\n\n<p>I've written the following function to attempt to solve this:</p>\n\n<pre><code>-- file: \\Learn Haskell\\lastButOne.hs\nlastButOne xs = if length xs == 2\n                then head xs\n                else lastButOne tail xs\n</code></pre>\n\n<p>What I don't understand is this error the compiler throws:</p>\n\n<pre><code>lastButOne.hs:2:1: error:\n    \u2022 Couldn't match type \u2018[a] -&gt; [a]\u2019 with \u2018[t]\u2019\n      Expected type: ([a] -&gt; [a]) -&gt; [t] -&gt; t\n        Actual type: [t] -&gt; t\n    \u2022 Relevant bindings include\n        lastButOne :: ([a] -&gt; [a]) -&gt; [t] -&gt; t (bound at lastButOne.hs:2:1)\n</code></pre>\n\n<p>From what I understand, ghci thinks my function ought to have a different type than it does, but I don't understand why that's happening, or how I can fix it.</p>\n\n<p>Edit: Thanks for the answers! I've updated my code to:</p>\n\n<pre><code>-- file: \\Learn Haskell\\lastButOne.hs\nlastButOne xs = if length xs == 2\n                then head xs\n                else if length xs &lt; 2\n                     then error \"This list does not have a second-to-last element.\"\n                     else lastButOne (tail xs)\n</code></pre>\n\n<p>This eliminates the error where <code>tail xs</code> is being interpreted as two arguments, rather than a single expression. I also added some code that ensures the list isn't too short. Willem Van Onsem's solution is nicer, but as an exercise I thought I'd come up with a solution that only used the concepts introduced so far in the book.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1499353152, "post_id": 44951513, "comment_id": 76880147, "body": "As soon as the main thread is over, all others are killed. You should make the main thread wait for the other. Check the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Concurrent.html#g:12\" rel=\"nofollow noreferrer\">docs</a> about &quot;Terminating the program&quot; for a solution."}, {"owner": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1499355831, "post_id": 44951513, "comment_id": 76882139, "body": "Thanks for the help. Did you notice the call to threadDelay? I think that should pause the main thread long enough to allow the child thread to complete."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1499357707, "post_id": 44951513, "comment_id": 76883491, "body": "That&#39;s right, I don&#39;t know why the delay does not help."}, {"owner": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1499421999, "post_id": 44951513, "comment_id": 76910996, "body": "Actually, it does - this seems to have something to do with stack rather than Haskell itself (see my comment below)"}], "answers": [{"comments": [{"owner": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "edited": false, "score": 0, "creation_date": 1499355938, "post_id": 44953291, "comment_id": 76882216, "body": "Thank you for the advice. The problem is that other errors, from dependencies don&#39;t print either. I will use your idiom for printing errors since it does look better.   This is rather odd, since it occurs in several different projects. I didn&#39;t really think it was worth mentioning that I am using stack to manage the project, but maybe I should investigate that avenue..."}, {"owner": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "edited": false, "score": 3, "creation_date": 1499356154, "post_id": 44953291, "comment_id": 76882385, "body": "...and it turns out that I should have! It works if compiled with ghc but not with stack. OK, thanks again for your help - I&#39;ll go and look into this a little further."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1499355173, "creation_date": 1499355173, "answer_id": 44953291, "question_id": 44951513, "link": "https://stackoverflow.com/questions/44951513/how-do-you-print-an-error-from-a-child-thread-in-haskell/44953291#44953291", "title": "How do you print an error from a child thread in Haskell?", "body": "<p>I can't reproduce your problem; for me, it does print \"You can't see me!\":</p>\n\n<pre><code>% runhaskell test.hs\ntest.hs: You can't see me!\nCallStack (from HasCallStack):\n  error, called at test.hs:8:16 in main:Main\n\"Finished\"\n</code></pre>\n\n<p>I see similar behavior as far back as GHC 7.6 (the oldest GHC I have lying around); I would be mildly surprised to learn that this behavior has changed significantly in the last twenty years or so.</p>\n\n<p>Anyway I would recommend switching over to printing the message you want printed:</p>\n\n<pre><code>import System.IO\nerrorPrinter = hPutStrLn stderr \"You can't see me!\"\n</code></pre>\n\n<p>Say what you mean, and all that.</p>\n"}], "owner": {"reputation": 427, "user_id": 2137161, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07b4f848472c3c0859900f576b3a27a?s=128&d=identicon&r=PG", "display_name": "James Hamilton", "link": "https://stackoverflow.com/users/2137161/james-hamilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 44953291, "answer_count": 1, "score": 4, "last_activity_date": 1499355173, "creation_date": 1499350662, "question_id": 44951513, "link": "https://stackoverflow.com/questions/44951513/how-do-you-print-an-error-from-a-child-thread-in-haskell", "title": "How do you print an error from a child thread in Haskell?", "body": "<p>Given the following code: </p>\n\n<pre><code>module Main where\n\nimport Control.Concurrent\n\nmain :: IO ()\nmain = forkIO errorPrinter &gt;&gt; threadDelay 1000000 &gt;&gt; print \"Finished\"\n\nerrorPrinter = error \"You can't see me!\"\n</code></pre>\n\n<p>I would expect, that upon running this code I would see this:</p>\n\n<pre><code>\"You can't see me\"\n\"Finished!\"\n</code></pre>\n\n<p>Printed to the console. However, \"You can't see me\" is never printed. </p>\n\n<p>I realise that using error is not a good idea in production code, but I use it in development and I find that no errors are printed to the console - even those raised by dependencies. </p>\n\n<p>I am sure this problem has an easy solution. I can't be the first person to have this issue, but I can't find an answer anywhere. </p>\n\n<p>Any help would be much appreciated!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1499345684, "post_id": 44949459, "comment_id": 76874021, "body": "You can pass an <code>undefined</code> handle..."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1499348490, "post_id": 44949459, "comment_id": 76876277, "body": "@WillemVanOnsem Unless you need to do something with the handle that succeeds before trying to close it."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1499371728, "creation_date": 1499371728, "answer_id": 44957995, "question_id": 44949459, "link": "https://stackoverflow.com/questions/44949459/creating-a-handle-that-guarantees-hclose-failure/44957995#44957995", "title": "Creating a Handle that guarantees hClose failure", "body": "<p>The module <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-IO-Handle.html\" rel=\"nofollow noreferrer\"><code>GHC.IO.Handle</code></a> of the <em>base</em> package has the function <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-IO-Handle.html#v:mkFileHandle\" rel=\"nofollow noreferrer\"><code>mkFileHandle</code></a>:</p>\n\n<blockquote>\n  <p>mkFileHandle :: (IODevice dev, BufferedIO dev, Typeable dev) => dev   -> FilePath -> IOMode -> Maybe TextEncoding -> NewlineMode  -> IO Handle</p>\n</blockquote>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-IO-Device.html#t:IODevice\" rel=\"nofollow noreferrer\"><code>IODevice</code></a> and <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-IO-BufferedIO.html#t:BufferedIO\" rel=\"nofollow noreferrer\"><code>BufferedIO</code></a> are typeclasses that provide basic handle operations for a device. In particular, <code>IODevice</code> has the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-IO-Device.html#v:close\" rel=\"nofollow noreferrer\"><code>close</code></a> method.</p>\n\n<p>You can create your own dummy device type, define those two instances for it (with a <code>close</code> that throws an exception) and then use <code>mkFileHandle</code> to obtain a useable <code>Handle</code>.</p>\n\n<p>See the code of the <a href=\"http://hackage.haskell.org/package/knob\" rel=\"nofollow noreferrer\">knob</a> package for an example of how to do this.</p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 1, "accepted_answer_id": 44957995, "answer_count": 1, "score": 2, "last_activity_date": 1499371728, "creation_date": 1499345575, "question_id": 44949459, "link": "https://stackoverflow.com/questions/44949459/creating-a-handle-that-guarantees-hclose-failure", "title": "Creating a Handle that guarantees hClose failure", "body": "<p>I'd like to create a <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#t:Handle\" rel=\"nofollow noreferrer\"><code>Handle</code></a> that guarantees failure (exception) when it's passed into <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#v:hClose\" rel=\"nofollow noreferrer\"><code>hClose</code></a>. I need this for testing purposes.</p>\n\n<p>How do I create such a <code>Handle</code>?</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1499345558, "post_id": 44949417, "comment_id": 76873922, "body": "That is not how list comprehension works. The idea is that it is <i>declarative</i>, so fixed filters."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1499345587, "post_id": 44949417, "comment_id": 76873942, "body": "Use explicit recursion, or possibly <code>foldr</code> -- but explicit recursion look easier."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1499345622, "post_id": 44949417, "comment_id": 76873970, "body": "Or perhaps one can use a reference to the list being generated. For instance for prime numbers this works."}, {"owner": {"reputation": 4185, "user_id": 15467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a89c04ada36efa853c7f5be0a96b6dd9?s=128&d=identicon&r=PG", "display_name": "ja.", "link": "https://stackoverflow.com/users/15467/ja"}, "edited": false, "score": 0, "creation_date": 1499358961, "post_id": 44949417, "comment_id": 76884319, "body": "look at <code>span</code> and <code>break</code>, also at section 3.11 of the Haskell Report where list comprehensions are defined in terms of <code>if&#47;then&#47;else</code> and <code>concatMap</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1499363867, "post_id": 44949417, "comment_id": 76887329, "body": "make your filter refer by name to the list being produced from the list comprehension, like <a href=\"https://wiki.haskell.org/Prime_numbers#Optimal_trial_division\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1499384118, "post_id": 44949417, "comment_id": 76896105, "body": "You&#39;ve got plenty of good suggestions in the comments here, but you won&#39;t get any concrete answers unless you include what you&#39;ve tried (i.e. code). As it stands, this is much too abstract to give a concrete answer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1499387909, "post_id": 44949417, "comment_id": 76896996, "body": "Even more to the point, we need a clear, concrete problem statement accompanied by examples of arguments and desired results."}], "owner": {"reputation": 325, "user_id": 7778287, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/87cafd6f0a91772ff3a9c1c568195f33?s=128&d=identicon&r=PG&f=1", "display_name": "user7778287", "link": "https://stackoverflow.com/users/7778287/user7778287"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1499380643, "creation_date": 1499345477, "last_edit_date": 1499380643, "question_id": 44949417, "link": "https://stackoverflow.com/questions/44949417/need-list-comprehension-that-updates-its-exclusions-as-the-list-is-made", "title": "Need list comprehension that updates its exclusions as the list is made", "body": "<p>I'm trying to find a way to update the 'filters' of my list comprehension as the list is generated, as the numbers generated affect the filtering of the numbers afterward. I have no idea what I should do. I should also state that I am at a beginner level, so while I don't need copy and paste code, I will need a definitive method to source my learning.</p>\n\n<p><em>Edit for clarification</em>: Algorithmically, I need to generate two lists in an alternating fashion, but in between each addition each list receives a new permanent filter, which will exclude certain inputs of each list in the future. I'm not even sure how to create one 'filter' list being separate from the main output, let alone two, but any help or guidance is appreciated.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1499340879, "post_id": 44947626, "comment_id": 76870403, "body": "Because <code>break</code> does <i>not guarantees</i> progress?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1499341500, "post_id": 44947626, "comment_id": 76870836, "body": "The patterns are exhaustive, otherwise you would get a runtime exception (or compile time warning). The issue here is infinite recursion rather than exhaustiveness."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1499343134, "post_id": 44947626, "comment_id": 76872001, "body": "The word you are looking for is &#39;generative&#39;. Also, consider the very trivial case of <code>splitWith (const False)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1589, "user_id": 2535671, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fca1ba52e0c41803e676d449ef242e75?s=128&d=identicon&r=PG&f=1", "display_name": "Julian Leviston", "link": "https://stackoverflow.com/users/2535671/julian-leviston"}, "is_accepted": false, "score": 2, "last_activity_date": 1499342070, "last_edit_date": 1499342070, "creation_date": 1499340949, "answer_id": 44947763, "question_id": 44947626, "link": "https://stackoverflow.com/questions/44947626/why-isnt-the-pattern-in-this-code-exhaustive/44947763#44947763", "title": "Why isn&#39;t the pattern in this code exhaustive?", "body": "<p>It'd be because this will continually add an empty list to the end.</p>\n\n<p>You can see this is if you take some arbitrary quantity of values from the infinite collection:</p>\n\n<pre><code>*Main&gt; take 10 $ splitWith (==5) [1,2,3,4,5]\n[[1,2,3,4],[],[],[],[],[],[],[],[],[]]\n</code></pre>\n\n<p>If you <code>break (==5) [5]</code>, the result is <code>([],[5])</code> which gets pattern matched into <code>pre</code> as <code>[]</code> and <code>suf</code> as <code>[5]</code>. The next iteration gets the same <code>break (==5) [5]</code> to evaluate... and so it goes.</p>\n\n<p><strong>update:</strong></p>\n\n<p>I'm not sure of the exact semantics you're after, but this might be helpful in formulating the function you want:</p>\n\n<pre><code>splitWith :: (a -&gt; Bool) -&gt; [a] -&gt; [[a]]\nsplitWith f [] = []\nsplitWith f xs = doSplitWith [] xs\n  where\n    doSplitWith first second @ (y:ys) =\n      if f y\n      then (reverse first) : [second]\n      else doSplitWith (y:first) ys\n\n\nsplitWith' f xs = takeWhile (not . f) xs : [dropWhile (not . f) xs]\n</code></pre>\n\n<p>Tho I guess that'd be more like <code>splitAt</code> or something, wouldn't it?</p>\n"}, {"comments": [{"owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "edited": false, "score": 1, "creation_date": 1499370137, "post_id": 44947809, "comment_id": 76890614, "body": "I think <code>(pre2, suf2) = span f list</code> should be <code>(pre2, suf2) = span f suf1</code>?"}, {"owner": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "edited": false, "score": 0, "creation_date": 1499425105, "post_id": 44947809, "comment_id": 76912828, "body": "Thanks to both @Al"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1499370225, "last_edit_date": 1499370225, "creation_date": 1499341079, "answer_id": 44947809, "question_id": 44947626, "link": "https://stackoverflow.com/questions/44947626/why-isnt-the-pattern-in-this-code-exhaustive/44947809#44947809", "title": "Why isn&#39;t the pattern in this code exhaustive?", "body": "<p><code>break</code> is defined as:</p>\n\n<blockquote>\n  <p><strong><code>break :: (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])</code></strong></p>\n  \n  <p><code>break</code>, applied to a predicate <code>p</code> and a list <code>xs</code>, returns a tuple\n  where first element is <strong>longest prefix (possibly empty)</strong> of <code>xs</code> of\n  elements that do not satisfy <code>p</code> and second element is the remainder\n  of the list:</p>\n\n<pre><code>break (&gt; 3) [1,2,3,4,1,2,3,4] == ([1,2,3],[4,1,2,3,4])\nbreak (&lt; 9) [1,2,3] == ([],[1,2,3])\nbreak (&gt; 9) [1,2,3] == ([1,2,3],[])\n</code></pre>\n</blockquote>\n\n<p>So once you have done the first <code>break</code>, all the remaining <code>break</code>s will simply split the list into an empty list and the original list. As a result, there is no progress in the pattern so to speak. Unless all the elements do not satisfy the predicate, you will keep iterating over a list where the first element satisifies the predicate, and never get rid of it.</p>\n\n<p>What you probably want is to interleave the <code>break</code> with the <code>span</code>:</p>\n\n<pre><code>splitWith :: (a -&gt; Bool) -&gt; [a] -&gt; [[a]]\nsplitWith f [] = []\nsplitWith f list = pre1 : pre2 : (splitWith f suf2)\n    where (pre1, suf1) = break f list\n          (pre2, suf2) = span f suf1\n</code></pre>\n\n<p>This will split the given list interleaved in a list of elements where the predicate is <em>not</em> satisfied, and a list where it is satisfied.</p>\n\n<p>In case you do not want the latter, you can simply <code>dropWhile</code> these:</p>\n\n<pre><code>splitWith :: (a -&gt; Bool) -&gt; [a] -&gt; [[a]]\nsplitWith f [] = []\nsplitWith f list = pre : (splitWith f $ dropWhile f suf)\n    where (pre1, suf) = break f list\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 6474865, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/--t2eQYQHC-o/AAAAAAAAAAI/AAAAAAAACSU/2IRU5I_PsrI/photo.jpg?sz=128", "display_name": "Piyush Divyankar", "link": "https://stackoverflow.com/users/6474865/piyush-divyankar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 44947809, "answer_count": 2, "score": 1, "last_activity_date": 1499370225, "creation_date": 1499340524, "last_edit_date": 1499340909, "question_id": 44947626, "link": "https://stackoverflow.com/questions/44947626/why-isnt-the-pattern-in-this-code-exhaustive", "title": "Why isn&#39;t the pattern in this code exhaustive?", "body": "<pre><code>splitWith :: (a -&gt; Bool) -&gt; [a] -&gt; [[a]]\nsplitWith f [] = []\nsplitWith f list = pre : (splitWith f suf)\n    where (pre, suf) = break f list\n</code></pre>\n\n<p>This function should split a list according to a predicate. But I get an infinite recursion. </p>\n"}, {"tags": ["haskell", "xor", "monoids"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 6, "creation_date": 1499334067, "post_id": 44945116, "comment_id": 76865644, "body": "I would say the opposite: identity is trivially False, because <code>False ^ x == x</code>, which you can easily confirm exhaustively. But it&#39;s less obvious that associativity holds, and that could use a proof. Also, these maybe ints are a very strange way to encode bools."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499334102, "post_id": 44945116, "comment_id": 76865672, "body": "Hint: if you have integers <code>x</code> and <code>y</code>, then <code>x `xor` y</code> is the least significant bit of <code>x + y</code>. Separately, you should look at <code>Data.Bits</code> and also not use <code>Integer</code> to represent a Boolean value."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1499334153, "post_id": 44945116, "comment_id": 76865701, "body": "This cannot form a monoid (with an identity element), since the function should be of the type <code>X -&gt; X -&gt; X</code> with <code>X</code> the set over which the monoid is defined."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1499336498, "post_id": 44945116, "comment_id": 76867409, "body": "(Xor, False) is indeed a monoid (and even a group with an obvious inversion operator). Your code doesn&#39;t deal with booleans though. It isn&#39;t clear why you think it shouldn&#39;t make a difference. It obviously does. You had to introduce Maybe because of it."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1499336799, "post_id": 44945116, "comment_id": 76867620, "body": "Why don&#39;t you just make it like <code>xor :: Eq a =&gt; a -&gt; a -&gt; Bool</code> <code>xor x y = x &#47;= y</code>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 2, "creation_date": 1499336841, "post_id": 44945116, "comment_id": 76867656, "body": "@Redu: or simply <code>xor = (&#47;=)</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1499354664, "post_id": 44945116, "comment_id": 76881291, "body": "@Redu, because that&#39;s silly. <code>Data.Bits</code> gets it right: <code>xor :: Bits a =&gt; a -&gt; a -&gt; a</code>."}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1499355343, "post_id": 44945116, "comment_id": 76881797, "body": "@dfeuer you say silly but that&#39;s how exactly <code>xor</code> is <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/Data.Bits.html#local-8214565720323817535\" rel=\"nofollow noreferrer\">defined in the <code>Data.Bits</code> package</a>."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 1, "creation_date": 1499370408, "post_id": 44945116, "comment_id": 76890742, "body": "@Redu only for <code>Bool</code>, not for all <code>Eq</code> types."}], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 8138142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db1d0687a43f80c2caebe125dae26844?s=128&d=identicon&r=PG&f=1", "display_name": "Vajk", "link": "https://stackoverflow.com/users/8138142/vajk"}, "is_accepted": true, "score": 1, "last_activity_date": 1499335299, "creation_date": 1499335299, "answer_id": 44945781, "question_id": 44945116, "link": "https://stackoverflow.com/questions/44945116/does-the-exclusive-or-form-a-monoid-for-bools/44945781#44945781", "title": "Does the Exclusive-Or form a monoid for Bools?", "body": "<p>I made a stupid mistake in my proof, as amalloy said the identity is false. Here's the complete proof, I hope it's correct now.</p>\n\n<pre><code>mempty &lt;&gt; p = p\nxor False p = p\n-- For p = True:\nxor False True = True\nTrue = True\n-- For p = False:\nxor False False = False\nFalse = False\n-- Q.E.D\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 8138142, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db1d0687a43f80c2caebe125dae26844?s=128&d=identicon&r=PG&f=1", "display_name": "Vajk", "link": "https://stackoverflow.com/users/8138142/vajk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 44945781, "answer_count": 1, "score": 0, "last_activity_date": 1499336687, "creation_date": 1499333659, "last_edit_date": 1499336687, "question_id": 44945116, "link": "https://stackoverflow.com/questions/44945116/does-the-exclusive-or-form-a-monoid-for-bools", "title": "Does the Exclusive-Or form a monoid for Bools?", "body": "<p>I made an operator for the xor-function, it looks like that:</p>\n\n<pre><code>op :: Integer -&gt; Integer -&gt; Maybe Integer\nop x y\n  | x == 0 &amp;&amp; y == 0 = Just 0\n  | x == 0 &amp;&amp; y == 1 = Just 1\n  | x == 1 &amp;&amp; y == 0 = Just 1\n  | x == 1 &amp;&amp; y == 1 = Just 0\n  | otherwise = Nothing\n</code></pre>\n\n<p>I used 0 and 1 instead of True and False but that shouldn't make a difference for the result. I read it forms a monoid but I don't understand why. Associativity is obvious and doesn't need a proof(I already made the proof by myself), but what is the identity element and why?</p>\n\n<p>Edit: Here's one without numbers:</p>\n\n<pre><code>xor :: Bool -&gt; Bool -&gt; Bool\nxor x y | x == True &amp;&amp; y == False = True\n        | x == False &amp;&amp; y == True = True\n        | otherwise = False\n</code></pre>\n"}, {"tags": ["list", "haskell", "pattern-matching", "refactoring"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499334684, "post_id": 44944389, "comment_id": 76866101, "body": "What should the code do if the list is a mixture of As and Bs?"}, {"owner": {"reputation": 1263, "user_id": 532647, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/7c1caab91478136b1cc442569c7da085?s=128&d=identicon&r=PG", "display_name": "Iarek", "link": "https://stackoverflow.com/users/532647/iarek"}, "edited": false, "score": 0, "creation_date": 1499334687, "post_id": 44944389, "comment_id": 76866105, "body": "What if you extract <code>\\(TA x) -&gt; x</code> into a function and complete that function&#39;s pattern match with an error/assert of some sorts? While more verbose, that would definitely help you against future additions to the constructor of T, which may go unnoticed for some time otherwise."}, {"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1499335359, "post_id": 44944389, "comment_id": 76866629, "body": "@MathematicalOrchid convert all the As to Bs using &#39;f&#39;"}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 2, "creation_date": 1499336269, "post_id": 44946040, "comment_id": 76867248, "body": "You&#39;re right. Author just learned about <i>bool blindness</i>. Instead of relying on <code>Bool</code> you should better use some evidence. This is common pattern in functional programming. Read this blog post: <a href=\"https://cs-syd.eu/posts/2016-07-24-overcoming-boolean-blindness-evidence.html\" rel=\"nofollow noreferrer\">cs-syd.eu/posts/&hellip;</a>"}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 2, "last_activity_date": 1499336006, "creation_date": 1499336006, "answer_id": 44946040, "question_id": 44944389, "link": "https://stackoverflow.com/questions/44944389/avoiding-an-incomplete-pattern-match/44946040#44946040", "title": "Avoiding an incomplete pattern match", "body": "<p>The only way I can think of is something like</p>\n\n<pre><code>tryA :: [T] -&gt; Maybe [A]\ntryA [] = []\ntryA (t:ts) =\n  case t of\n    TA x -&gt; do xs &lt;- tryA ts; return (x:xs)\n    TB _ -&gt; Nothing\n</code></pre>\n\n<p>If <code>tryA</code> returns nothing, then do <code>map f' l</code> as before.</p>\n\n<p>This way you're doing the <code>all isA l</code> and the <code>map</code> in a single pass, and it avoids an incomplete pattern.</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499520530, "post_id": 44946367, "comment_id": 76947521, "body": "what would you say about <a href=\"https://stackoverflow.com/questions/44944389/avoiding-an-incomplete-pattern-match/44946040#comment76947174_44950978\">this</a> re &quot;presence of <code>Just</code> in alternative ...&quot; validates the use of <code>fromJust</code> overall? could it redeem that use of <code>from Just</code> in your opinion? at least it&#39;s short and only uses standard <code>Maybe</code> instances. (and skimming through your post without reading it closely, since Alternative is  Applicative&#39;s Monoid, isn&#39;t your post recreating that functionality? ... just a superficial impression)."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499521908, "post_id": 44946367, "comment_id": 76947940, "body": "@WillNess Yes and no, I guess. Any time you use a partial function you&#39;re asserting something you believe to be true about your code. You could be wrong, in which case your assertion will fail and crash the program. Clearly <code>x &lt;|&gt; Just y</code> will always return a <code>Just</code>, so <code>fromJust</code> is justified in some sense, but on the other hand the code might change at some point in the future and the use of <code>fromJust</code> prevents the type system from giving you feedback. Kinda like how you <i>can</i> write correct code with pointers or mutability but it&#39;s safer not to :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499522865, "post_id": 44946367, "comment_id": 76948257, "body": "yeah, thanks; in the mean time I realized <code>maybe</code> is better there - for the reasons you describe: no partial functions, just two plain alternatives."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 2, "last_activity_date": 1499556707, "last_edit_date": 1499556707, "creation_date": 1499336828, "answer_id": 44946367, "question_id": 44944389, "link": "https://stackoverflow.com/questions/44944389/avoiding-an-incomplete-pattern-match/44946367#44946367", "title": "Avoiding an incomplete pattern match", "body": "<p>I'd structure it like this: build <em>two</em> lists - one full of <code>A</code>s and one full of <code>B</code>s - with the effect that building the list of <code>A</code>s could fail. One can build a <code>Monoid</code> which implements this logic and <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Foldable.html#v:foldMap\" rel=\"nofollow noreferrer\"><code>foldMap</code></a> into it.</p>\n\n<p>Since one could fail to build a list of <code>A</code>s, we'll need to build this  <code>Monoid</code> on top of <code>Maybe</code>. The behaviour we want comes from <code>Maybe</code>'s <code>Applicative</code> instance: if either of <code>mappend</code>'s arguments is <code>Nothing</code> then the whole thing fails, otherwise we want to use <code>mappend</code> to combine the two results. This is a general recipe for combining an <code>Applicative</code> and a <code>Monoid</code>. Concretely:</p>\n\n<pre><code>newtype WrappedApplicative f a = Wrap { unWrap :: f a }\n\ninstance (Applicative f, Monoid m) =&gt; Monoid (WrappedApplicative f m) where\n    mempty = pure mempty\n    Wrap x `mappend` Wrap y = Wrap $ liftA2 mappend x y\n</code></pre>\n\n<p>I don't know if this <code>newtype</code> is somewhere in <code>base</code>. It seems like the sort of thing that would be there but I couldn't find it.</p>\n\n<p>Without further ado, here's the <code>Monoid</code> we'll be <code>foldMap</code>ping into:</p>\n\n<pre><code>type Result = ([B], WrappedApplicative Maybe [A])\n</code></pre>\n\n<p>I'm borrowing <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Base.html#line-278\" rel=\"nofollow noreferrer\"><code>(a, b)</code>'s <code>Monoid</code> instance</a>, which delegates in parallel to <code>a</code> and <code>b</code>'s <code>Monoid</code> instances.</p>\n\n<pre><code>getAsOrToBs :: [Either A B] -&gt; Either [A] [B]\ngetAsOrToBs = fromResult . foldMap toResult\n    where toResult (Left a) = ([aToB a], Wrap (Just [a]))\n          toResult (Right b) = ([b], Wrap Nothing)\n          fromResult (_, Wrap (Just as)) = Left as\n          fromResult (bs, Wrap Nothing) = Right bs\n</code></pre>\n\n<p>Alternatively, with <code>foldr</code>:</p>\n\n<pre><code>getAsOrToBs :: [Either A B] -&gt; Either [A] [B]\ngetAsOrToBs = fromResult . foldr f ([], Just [])\n    where f (Left a) (bs, mas) = (aToB a : bs, fmap (a:) mas)\n          f (Right b) (bs, _) = (b:bs, Nothing)\n          fromResult (_, Just as) = Left as\n          fromResult (bs, Nothing) = Right bs\n</code></pre>\n\n<p>Look, ma, no partial functions!</p>\n"}, {"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499519236, "post_id": 44950978, "comment_id": 76947174, "body": "<code>toA (TA a) = Just a ; toA _ = Nothing ; g xs = fromJust $ (fmap ListTA . traverse toA) xs &lt;|&gt; (Just . ListTB . map f&#39;) xs</code>. though <code>fromJust</code> is partial, the presence of <code>Just</code> in the alternative reveals totality of the whole.  pointfree, it&#39;s <code>g = fromJust . ((&lt;|&gt;) . fmap ListTA . traverse toA &lt;*&gt; Just . ListTB . map f&#39;)</code>. this is the solution from <a href=\"https://stackoverflow.com/a/44946040/849891\">this answer</a>, repackaged."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499520807, "post_id": 44950978, "comment_id": 76947600, "body": "or it could be (a bit more readable) <code>fromJust . uncurry (&lt;|&gt;) . (fmap ListTA . traverse toA &amp;&amp;&amp; Just . ListTB . map f&#39;)</code>, whatever your preference in such things."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1499521520, "post_id": 44950978, "comment_id": 76947831, "body": "but your use of <code>maybe</code> is better. Should&#39;ve read your answer first. (just, maybe use <code>traverse</code> and not <code>mapM</code>)."}], "tags": [], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "is_accepted": true, "score": 1, "last_activity_date": 1499548505, "last_edit_date": 1499548505, "creation_date": 1499349290, "answer_id": 44950978, "question_id": 44944389, "link": "https://stackoverflow.com/questions/44944389/avoiding-an-incomplete-pattern-match/44950978#44950978", "title": "Avoiding an incomplete pattern match", "body": "<p>After some help from the other answers, I'm going to answer my own question for the benefit of future viewers. I believe the most suscinct function for <code>g</code> is as follows (and noticed I've generalised to <code>Traversable</code> instead of just lists). </p>\n\n<pre><code>data ListT t = ListTA (t A) | ListTB (t B)\n\ng :: (Traversable t) =&gt; t T -&gt; ListT t\ng l = \n  let\n    f2B :: T -&gt; B\n    f2B (TA x) = f x\n    f2B (TB x) = x\n    f2A :: T -&gt; Maybe A\n    f2A (TA x) = Just x\n    f2A (TB x) = Nothing\n  in\n    maybe (ListTB (fmap f2B l)) ListTA (traverse f2A l)\n\nmain = pure ()\n</code></pre>\n\n<p>On lists, this should only take space proportional to the number of leading <code>A</code>s, which is minimal I believe.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 44950978, "answer_count": 3, "score": 8, "last_activity_date": 1529038085, "creation_date": 1499331880, "last_edit_date": 1529038085, "question_id": 44944389, "link": "https://stackoverflow.com/questions/44944389/avoiding-an-incomplete-pattern-match", "title": "Avoiding an incomplete pattern match", "body": "<p>Consider the following code:</p>\n\n<pre><code>data A\ndata B\n\nf :: A -&gt; B\nf = undefined\n\ndata T = TA A | TB B\ndata ListT = ListTA [A] | ListTB [B]\n\ng :: [T] -&gt; ListT\ng l = \n  let\n    f' :: T -&gt; B\n    f' (TA x) = f x\n    f' (TB x) = x\n    isA :: T -&gt; Bool\n    isA TA{} = True\n    isA TB{} = False\n  in\n    case (all isA l) of\n      True -&gt; ListTA (map (\\(TA x) -&gt; x) l)\n      False -&gt; ListTB (map f' l)\n\nmain = pure ()\n</code></pre>\n\n<p>The idea behind this is I've got a list of either <code>A</code>s or <code>B</code>s mixed together. I can convert <code>A -&gt; B</code> but not the other way around. Based on this list, I want to make either a list of <code>A</code>s or list of <code>B</code>s, the former if all my original list elements are <code>A</code>s, the latter if at least one is a <code>B</code>. </p>\n\n<p>The above code compiles (and I'm guessing will work) but the incomplete pattern match in the <code>map (\\(TA x) -&gt; x) l</code> makes me just a little uncomfortable. Is such an incomplete match just a necessity of what I'm doing here? Also, am I reinventing the wheel, is there something that generalises what I'm doing here?</p>\n"}]