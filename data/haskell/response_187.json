[{"tags": ["haskell", "currying"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 7, "creation_date": 1533767639, "post_id": 51756566, "comment_id": 90472619, "body": "Yes it is. (This space intentionally left blank)"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 5, "creation_date": 1533769193, "post_id": 51756566, "comment_id": 90472971, "body": "For the same reason, <code>(a -&gt; b -&gt; c)</code> and <code>(a -&gt; (b -&gt; c))</code> also mean exactly the same thing."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1533802965, "post_id": 51756566, "comment_id": 90483143, "body": "Yes, both expressions result in exactly the same <i>abstract syntax tree</i>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1533775673, "creation_date": 1533775673, "answer_id": 51757416, "question_id": 51756566, "link": "https://stackoverflow.com/questions/51756566/is-f-a-b-the-same-as-f-a-b-in-haskell/51757416#51757416", "title": "Is ((f a) b) the same as (f a b) in Haskell?", "body": "<p>Yes, they are exactly the same.</p>\n"}, {"comments": [{"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 1, "creation_date": 1533920703, "post_id": 51775910, "comment_id": 90539645, "body": "Can you explain more about overriding currying?"}, {"owner": {"reputation": 791, "user_id": 1587319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1c8a88b9a8d79a518cba52a7a8d099f9?s=128&d=identicon&r=PG", "display_name": "pdexter", "link": "https://stackoverflow.com/users/1587319/pdexter"}, "edited": false, "score": 2, "creation_date": 1533996108, "post_id": 51775910, "comment_id": 90557157, "body": "that&#39;s not accurate. <code>uncurry</code> will return a function where the first two arguments are instead taken as a single tuple. Not &#39;all&#39; parameters. Further it&#39;s not &#39;overriding&#39; currying, it returns a new function with a different type. The returned function is still curried."}], "tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": true, "score": 0, "last_activity_date": 1533849497, "creation_date": 1533849497, "answer_id": 51775910, "question_id": 51756566, "link": "https://stackoverflow.com/questions/51756566/is-f-a-b-the-same-as-f-a-b-in-haskell/51775910#51775910", "title": "Is ((f a) b) the same as (f a b) in Haskell?", "body": "<p>Haskell transposes (f a b) into ((f a) b). It's called currying. It does that to all functions by default but can be overridden.</p>\n\n<pre><code> add = (+)\n(add 1 2) -- becomes --  ((add 1) 2) -- upon execution.\n</code></pre>\n\n<p>Both return <code>3</code>. The result of a function is its value.</p>\n\n<p>Curried functions are natural.</p>\n\n<pre><code>add1 = add 1\nadd1 2 -- also returns 3\n</code></pre>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 51775910, "answer_count": 2, "score": 2, "last_activity_date": 1533849497, "creation_date": 1533767550, "question_id": 51756566, "link": "https://stackoverflow.com/questions/51756566/is-f-a-b-the-same-as-f-a-b-in-haskell", "title": "Is ((f a) b) the same as (f a b) in Haskell?", "body": "<pre><code>map2_Maybe :: (a -&gt; b -&gt; c) -&gt; Maybe a -&gt; Maybe b -&gt; Maybe c\nmap2_Maybe f Nothing _ = Nothing\nmap2_Maybe f (Just a) Nothing = Nothing\nmap2_Maybe f (Just a) (Just b) = Just ((f a) b)\n-- Or: map2_Maybe f (Just a) mb = fmap (f a) mb\n\nmap2_Either :: (a -&gt; b -&gt; c) -&gt; Either e a -&gt; Either e b -&gt; Either e c\nmap2_Either f (Left e) _ = Left e\nmap2_Either f (Right a) (Left e) = Left e\nmap2_Either f (Right a) (Right b) = Right (f a b)\n-- Or: map2_Either f (Right a) eb = fmap (f a) eb\n</code></pre>\n\n<p>In these two examples, Is <code>((f a) b)</code> the same as <code>(f a b)</code> since every function in Haskell can only take one argument?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1533767751, "post_id": 51755686, "comment_id": 90472649, "body": "I guess the answer could be &quot;because nobody wrote that&quot;, as boring as that might sound."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1533768399, "post_id": 51755686, "comment_id": 90472785, "body": "Yeah. You may want to implement the instance and file a ticket for including it in <code>base</code>! \u2014 Anyway note that <code>printf</code> is not really Haskell-idiomatic \u2013 it essentially mimics C&#39;s <code>printf</code> by using a strange typeclass hack to allow for variadic functions. I recommend you check out the <a href=\"http://hackage.haskell.org/package/fmt\" rel=\"nofollow noreferrer\">fmt</a> library, which takes a much simpler approach and particularly is designed to make use of the <code>Show</code> typeclass when that makes sense. With <code>fmt</code>, you can simply write <code>&quot;... &quot;+||123%456||+&quot; ...\\n&quot;</code>."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 2, "creation_date": 1533781634, "post_id": 51755686, "comment_id": 90475410, "body": "Because <code>printf</code> was originally written for Lazy ML and LML didn\u2019t have rational at the time.  When I transliterated it to Haskell I simply didn\u2019t think of it. (The original printf code dates back to about 1983.)"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1533784767, "post_id": 51755686, "comment_id": 90475952, "body": "Also check out <a href=\"https://stackoverflow.com/questions/30931369/how-to-convert-a-rational-into-a-pretty-string\" title=\"how to convert a rational into a pretty string\">stackoverflow.com/questions/30931369/&hellip;</a> for formatting code.  I like my version since it allows you to find the repetition in the expansion."}, {"owner": {"reputation": 12530, "user_id": 381619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8f67f35200cf319e30329dddd412b6d?s=128&d=identicon&r=PG", "display_name": "Neil Mayhew", "link": "https://stackoverflow.com/users/381619/neil-mayhew"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1533918894, "post_id": 51755686, "comment_id": 90538812, "body": "@leftaroundabout I didn&#39;t know about <code>fmt \u2014 thanks for the tip. I plan to use that more in future. However, as I found with </code>printf` vs <code>iostream</code> in C++, good old <code>printf</code> is still great when you want to produce tabular output, because you can control widths and precisions so succinctly."}, {"owner": {"reputation": 12530, "user_id": 381619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8f67f35200cf319e30329dddd412b6d?s=128&d=identicon&r=PG", "display_name": "Neil Mayhew", "link": "https://stackoverflow.com/users/381619/neil-mayhew"}, "reply_to_user": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1533919127, "post_id": 51755686, "comment_id": 90538909, "body": "@augustss Thanks for the background info \u2014 fascinating! I like your formatting implementation, too, that handles the recurring digits. However, I think that should be selected with a modifier because the most common use case would be for displaying an exact number of digits, in order to make tabulated output align."}], "answers": [{"tags": [], "owner": {"reputation": 12530, "user_id": 381619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8f67f35200cf319e30329dddd412b6d?s=128&d=identicon&r=PG", "display_name": "Neil Mayhew", "link": "https://stackoverflow.com/users/381619/neil-mayhew"}, "is_accepted": true, "score": 1, "last_activity_date": 1533919445, "creation_date": 1533919445, "answer_id": 51790814, "question_id": 51755686, "link": "https://stackoverflow.com/questions/51755686/why-isnt-there-a-printf-formatter-for-rational/51790814#51790814", "title": "Why isn&#39;t there a printf formatter for Rational?", "body": "<p>The consensus in the comments seems to be, <em>because nobody got around to writing one, and it seems like a good idea</em>.</p>\n\n<p>I'm answering my own question so it can be marked as answered. I'll add a comment if I or anyone else get around to implementing it.</p>\n"}], "owner": {"reputation": 12530, "user_id": 381619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8f67f35200cf319e30329dddd412b6d?s=128&d=identicon&r=PG", "display_name": "Neil Mayhew", "link": "https://stackoverflow.com/users/381619/neil-mayhew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 51790814, "answer_count": 1, "score": 3, "last_activity_date": 1533919445, "creation_date": 1533762554, "question_id": 51755686, "link": "https://stackoverflow.com/questions/51755686/why-isnt-there-a-printf-formatter-for-rational", "title": "Why isn&#39;t there a printf formatter for Rational?", "body": "<p>Simple inclusion of a <code>Rational</code> in <code>printf</code> output can be accomplished using <code>%s</code> and <code>show</code>:</p>\n\n<pre><code>&gt; printf \"... %s ...\\n\" (show $ 123 % 456)\n... 41 % 152 ...\n</code></pre>\n\n<p>However, it would be useful to be able to use the <code>%f</code> format code as well:</p>\n\n<pre><code>&gt; printf \"... %.30f ...\\n\" (123 % 456)\n... 0.269736842105263157894736842105 ...\n</code></pre>\n\n<p>Note that formatting via a conversion to <code>Double</code> (eg using <code>fromRational</code>) would not allow the arbitrary precision I'm looking for:</p>\n\n<pre><code>&gt; printf \"... %.30f ...\\n\" (fromRational $ 123 % 456)\n... 0.269736842105263160000000000000 ...\n</code></pre>\n\n<p>The <code>%v</code> code could be used to produce the same output as <code>show</code>, and perhaps some modifiers could be allowed with it.</p>\n\n<p>Is there any reason why this shouldn't be accomplished with a custom formatter (an instance of <code>PrintfArg (Ratio a)</code>)?</p>\n\n<p>For reference, here's a standalone function that I'm using as a partial workaround:</p>\n\n<pre><code>showDecimal :: RealFrac a =&gt; Int -&gt; a -&gt; String\nshowDecimal n r = printf \"%d.%0*d\" (i :: Integer) n (abs d :: Integer)\n  where (i, d) = (round $ r * 10^n) `quotRem` (10^n)\n\n&gt; printf \"... %35s ...\\n\" (showDecimal 30 $ 123 % 456)\n...    0.269736842105263157894736842105 ...\n</code></pre>\n\n<p>However, this doesn't allow the use of modifiers, and involves specifying widths in separate places.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1533755566, "post_id": 51753694, "comment_id": 90467827, "body": "This is a very common mistake.  The signature you have given <code>(Uniform b) =&gt; Int -&gt; a -&gt; State b</code> means that it must work for <i>all</i> <code>b</code>.  So if some caller requests a <code>State Elephant</code>, the function must know how to return that.  I think the correct design here is to return a monomorphic (no type variables) data type from <code>render</code> -- though it&#39;s hard to advise since I can&#39;t really tell what you intend to do with the result of render."}, {"owner": {"reputation": 1055, "user_id": 4071245, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/XCJqT.jpg?s=128&g=1", "display_name": "Aravindh S", "link": "https://stackoverflow.com/users/4071245/aravindh-s"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1533756228, "post_id": 51753694, "comment_id": 90468083, "body": "@luqui I get the issue you said. But as I said, the compiler can still verify whether the <code>Elephant</code> adheres to <code>Uniform</code> in the implementation place where an Elephant is returned isnt it? To your second question, as I had given in the example, my intention is to pass the type adhering to &#217;niform` to a function  : <code>library :: (Uniform a) =&gt; a -&gt; IO ()</code>"}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1533777992, "post_id": 51753694, "comment_id": 90474688, "body": "It looks to me like you just need to specify what type the result of that call to <code>uniform</code> is supposed to be. Currently both the producer and consumer of that value are polymorphic, so the  compiler doesn&#39;t know what instance to use."}], "answers": [{"comments": [{"owner": {"reputation": 1055, "user_id": 4071245, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/XCJqT.jpg?s=128&g=1", "display_name": "Aravindh S", "link": "https://stackoverflow.com/users/4071245/aravindh-s"}, "edited": false, "score": 0, "creation_date": 1533766582, "post_id": 51755938, "comment_id": 90472302, "body": "thanks for the explanation. While I understand your answer, Is it correct for to think &quot;caller can always specify which type they want&quot;? The guarantee that the typeclass provides is that the result will adhere to a constraint <code>Uniform</code>. Thats all. So In the <code>Collection</code> example, isnt it still totally fine that an implementation always returns Integer? Because it still adheres to a Num. I am not able to understand the complete reasoning behind your explanation. Maybe I am missing something. Can you explain more?"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 1055, "user_id": 4071245, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/XCJqT.jpg?s=128&g=1", "display_name": "Aravindh S", "link": "https://stackoverflow.com/users/4071245/aravindh-s"}, "edited": false, "score": 0, "creation_date": 1533767082, "post_id": 51755938, "comment_id": 90472466, "body": "@AravindhS yeah you&#39;re not correct.  That&#39;s just the meaning of a type variable in a signature, the <i>caller</i> chooses.  When I call <code>read :: (Read a) =&gt; String -&gt; a</code>, <i>I</i> decide what type is being read -- I can read a <code>String</code> or a <code>[Int]</code> or whatever, and <code>read</code> must be prepared to transform a string into that type.  So when you are implementing <code>render</code>, you must be prepared to provide <i>any</i> type that is requested of you, as long as the requested type satisfies the constraint.  It feels very different than OO languages, I know."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 1055, "user_id": 4071245, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/XCJqT.jpg?s=128&g=1", "display_name": "Aravindh S", "link": "https://stackoverflow.com/users/4071245/aravindh-s"}, "edited": false, "score": 0, "creation_date": 1533767224, "post_id": 51755938, "comment_id": 90472512, "body": "@AravindhS It&#39;s the caller&#39;s job to choose types within the constraints of the type signature, so the callee needs to be able to handle all types that might fit the signature. The type checker doesn&#39;t really distinguish between &quot;parameter types&quot; and &quot;return types&quot;, it treats them the same. It&#39;s no more fine for a <code>Collection</code> instance to always return an <code>Integer</code> than it is for <code>fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b</code> to only accept an <code>Int64</code>."}, {"owner": {"reputation": 1055, "user_id": 4071245, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/XCJqT.jpg?s=128&g=1", "display_name": "Aravindh S", "link": "https://stackoverflow.com/users/4071245/aravindh-s"}, "edited": false, "score": 0, "creation_date": 1533809718, "post_id": 51755938, "comment_id": 90487410, "body": "Thanks. I understand it now. I think TypeFamilies also can be used to express this relation. Is this correct?"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 1055, "user_id": 4071245, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/XCJqT.jpg?s=128&g=1", "display_name": "Aravindh S", "link": "https://stackoverflow.com/users/4071245/aravindh-s"}, "edited": false, "score": 0, "creation_date": 1533832645, "post_id": 51755938, "comment_id": 90502844, "body": "@AravindhS I think that&#39;s a different thing. TypeFamilies allows you to define a special sort of parametric type synonym that resolves to completely different types depending on its type parameter. So if you define a type family <code>Foo a</code>, you can instantiate <code>Foo Char</code> to be a type synonym for <code>String</code>, and <code>Foo Bool</code> to mean <code>Int</code>, whatever you want. This is especially useful when you define a type family inside of a class, then each instance of the class can instantiate that family with its own special type."}], "tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": false, "score": 1, "last_activity_date": 1533763956, "creation_date": 1533763956, "answer_id": 51755938, "question_id": 51753694, "link": "https://stackoverflow.com/questions/51753694/enforce-class-constraints-in-type-class-that-is-not-captured-in-the-type-signatu/51755938#51755938", "title": "Enforce class constraints in type class that is not captured in the type signature of implementing type", "body": "<p>It appears that you're expecting to be able to define <code>render</code> to return a different distinct type for each implementation of <code>Renderable</code>, as long as that type is <code>Uniform</code>:</p>\n\n<pre><code>instance Renderable Foo where\n  render _ _ = State True\n\ninstance Renderable Bar where\n  render _ _ = State \"mothman\"\n\ninstance Renderable Baz where\n  render _ _ = State 19\n</code></pre>\n\n<p>So if <code>render</code> is called with a <code>Foo</code>, it will return a <code>State Bool</code>, but if it's called with a <code>Bar</code> it will return a <code>State String</code> (assuming both <code>Bool</code> and <code>String</code> are <code>Uniform</code>). This is not how it works, and you'll get a type mismatch error if you try instantiating like this.</p>\n\n<p><code>render :: (Uniform b) =&gt; Int -&gt; a -&gt; State b</code> means that a <code>Uniform b =&gt; State b</code> is returned. If this is what your type signature is, your implementation must be no more or less specific; your implementation must be able to return a value of ANY type <code>Uniform b =&gt; State b</code>. If it is not able to do so, any code that requests a return value of a specific type won't get the right type, and things will break in ways that the type system SHOULD be able to prevent.</p>\n\n<p>Let's look at a different example:</p>\n\n<pre><code>class Collection t where\n  size :: Num i =&gt; t a -&gt; i\n</code></pre>\n\n<p>Assume someone wants to run this <code>size</code> function, and get the result as a <code>Double</code>. They can do that, because any implementation of <code>size</code> must be able to return any type of class <code>Num</code>, so the caller can always specify which type they want. If you were allowed to write an implementation that always returned an <code>Integer</code>, this would no longer be possible.</p>\n\n<hr>\n\n<p>I think to do what you're trying to do, you'd need something like <a href=\"https://wiki.haskell.org/Functional_dependencies\" rel=\"nofollow noreferrer\"><code>FunctionalDependencies</code></a>. With this, your class can be something like:</p>\n\n<pre><code>class Uniform b =&gt; Renderable a b | a -&gt; b where\n  render :: Int -&gt; a -&gt; State b\n</code></pre>\n\n<p>The \"<code>| a -&gt; b</code>\" tells the type checker that the type <code>b</code> should be decided based on the type <code>a</code> provided by the caller. This disallows the caller from choosing their own <code>b</code>, which means the implementation should force a more specific type. Note that now you need to specify both <code>a</code> and <code>b</code> in your instances, so:</p>\n\n<pre><code>instance Renderable Foo Bool where ...\ninstance Renderable Bar String where ...\n</code></pre>\n\n<p>I'm certain there are other valid approaches to this problem, as well.</p>\n"}, {"comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 1, "creation_date": 1533768909, "post_id": 51756441, "comment_id": 90472902, "body": "From what OP said, I get the impression that <code>Uniform</code>, <code>library</code>, etc are imported from an existing OpenGL module, so I doubt he can just change them like this. That said, I think it&#39;s an excellent approach in general. I actually read your blog post a few months back, and it&#39;s really impacted my approach to designing interfaces like this, so cheers ^^"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1533771795, "post_id": 51756441, "comment_id": 90473548, "body": "Ah, I didn&#39;t get that.  In that case <code>SomeUniform</code> is a decent middle ground."}, {"owner": {"reputation": 1055, "user_id": 4071245, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/XCJqT.jpg?s=128&g=1", "display_name": "Aravindh S", "link": "https://stackoverflow.com/users/4071245/aravindh-s"}, "edited": false, "score": 0, "creation_date": 1533809802, "post_id": 51756441, "comment_id": 90487456, "body": "Thanks @Luqui for the explanation. Making the typeclasses into Data types seems to be an interesting approach. It seems more flexible for me"}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 2, "last_activity_date": 1533766789, "creation_date": 1533766789, "answer_id": 51756441, "question_id": 51753694, "link": "https://stackoverflow.com/questions/51753694/enforce-class-constraints-in-type-class-that-is-not-captured-in-the-type-signatu/51756441#51756441", "title": "Enforce class constraints in type class that is not captured in the type signature of implementing type", "body": "<p>Here is a technique for you.  I've <a href=\"https://lukepalmer.wordpress.com/2010/01/24/haskell-antipattern-existential-typeclass/\" rel=\"nofollow noreferrer\">written about this</a> many years ago (in a slightly different context, but the idea is the same) and I still stand by it.</p>\n\n<p>First, the framing.  If we write out the signature of <code>render</code> explicitly, we have:</p>\n\n<pre><code>render :: forall b. Uniform b =&gt; Int -&gt; a -&gt; State b\n</code></pre>\n\n<p>That is, the <em>caller</em> of render chooses the type <code>b</code>.  It seems to me that your intention is more like this pseudo-Haskell*:</p>\n\n<pre><code>render :: exists b. (Uniform b) &amp; Int -&gt; a -&gt; State b\n</code></pre>\n\n<p>In which the <em>callee</em> gets to choose the type.  That is, different implementations of <code>render</code> may choose different types <code>b</code> to return, so long as they are uniform.</p>\n\n<p>This might be a fine way to phrase it, except that Haskell does not support existential quantification directly.  You can make a wrapper data type to simulate it</p>\n\n<pre><code>data SomeUniform where\n    SomeUniform :: Uniform a =&gt; a -&gt; SomeUniform\n</code></pre>\n\n<p>making your signature</p>\n\n<pre><code>render :: Int -&gt; a -&gt; SomeUniform\n</code></pre>\n\n<p>which I think has the properties you are looking for.  <em>However</em> the <code>SomeUniform</code> type and the <code>Uniform</code> typeclass are very likely superfluous.  You said in the comments that the <code>Uniform</code> typeclass looks like this:</p>\n\n<pre><code>class Uniform a where\n    library :: a -&gt; IO ()\n</code></pre>\n\n<p>Let's consider this question: let's say we have a <code>SomeUniform</code>, that is, we have a value of some type <code>a</code> about which we know nothing except that it is an instance of the <code>Uniform</code> typeclass.  What can we possibly do with <code>x</code>?  There is only one way to get any information out of <code>x</code>, and that is to call <code>library</code> on it.  So in essence the only thing the <code>SomeUniform</code> type is doing is carrying around a <code>library</code> method to be called later.  This whole <em>existential/typeclass</em> is kind of pointless, we would be better served collapsing it down to a simple <em>data type</em>:</p>\n\n<pre><code>data Uniform = Uniform { library :: IO () }\n</code></pre>\n\n<p>and your <code>render</code> method becomes:</p>\n\n<pre><code>render :: Int -&gt; a -&gt; Uniform\n</code></pre>\n\n<p>It's so beautifully unfancy, isn't it?  If there were more methods in <code>Uniform</code> typeclass, they would become additional fields of this data type (whose types may be functions, which can take some getting used to).  Where you had types and instances of the typeclass, e.g.</p>\n\n<pre><code>data Thingy = Thingy String\n-- note the constructor type Thingy :: String -&gt; Thingy\n\ninstance Uniform String where\n    library (Thingy s) = putStrLn $ \"thingy \" ++ s\n</code></pre>\n\n<p>you can now also be rid of the data type and just use a function in place of the constructor</p>\n\n<pre><code>thingy :: String -&gt; Uniform\nthingy s = Uniform { library = putStrLn $ \"thingy \" ++ s }\n</code></pre>\n\n<p>(If you can't get rid of the data type for other reasons, you can provide a conversion function instead <code>uniformThingy :: Thingy -&gt; Uniform</code>)</p>\n\n<p>The principle here is, you may replace an existential type with the collection of its observations, and it's usually pretty nice if you do.</p>\n\n<hr>\n\n<p><i>*</i> My pseudo-Haskell <code>&amp;</code> is dual to <code>=&gt;</code>, playing essentially the same role but for existentially quantified dictionaries.  <code>c =&gt; t</code> means that once the <em>caller</em> provides the dictionary <code>c</code>, the type <code>t</code> is returned, whereas <code>c &amp; t</code> means that the <em>callee</em> provides both the dictionary <code>c</code> <em>and</em> the type <code>t</code>.</p>\n"}], "owner": {"reputation": 1055, "user_id": 4071245, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/XCJqT.jpg?s=128&g=1", "display_name": "Aravindh S", "link": "https://stackoverflow.com/users/4071245/aravindh-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 51756441, "answer_count": 2, "score": 1, "last_activity_date": 1533766789, "creation_date": 1533753988, "last_edit_date": 1533756354, "question_id": 51753694, "link": "https://stackoverflow.com/questions/51753694/enforce-class-constraints-in-type-class-that-is-not-captured-in-the-type-signatu", "title": "Enforce class constraints in type class that is not captured in the type signature of implementing type", "body": "<p>I am trying to use a typeclass that enforces a constraint on the type returned by  one of the functions it defines. But the return type of the function does not capture the constraint in its type variable. I would like to know what is wrong with the code or what is the correct way to encode it. \nA sample code is given below:</p>\n\n<pre><code>  data State a = State {\n    uniform :: a\n  }\n  class Renderable a where\n    render :: (Uniform b) =&gt; Int -&gt; a -&gt; State b\n\n  library :: (Uniform a) =&gt; a -&gt; IO ()\n  -- some implementation\n\n  draw :: (Renderable a) =&gt; a -&gt; IO ()\n  draw renderable = do\n    let state = render 0 renderable\n    _ &lt;- library (uniform state)\n</code></pre>\n\n<p>In the above snippet, the <code>render</code> function tries to enforce that the <code>uniform</code> property in State adheres to a class constraint Uniform. When I run the code, I am getting an error that </p>\n\n<pre><code> Could not deduce (Uniform a5) arising from a use of \u2018draw\u2019\n  from the context: (Renderable r, Uniform a)\n  bound by the type signature for:\n               draw :: forall r a.\n                       (Renderable r, Uniform a) =&gt;\n                       Int -&gt; Renderable r -&gt; IO ()\n</code></pre>\n\n<p>Thinking of it, I am sort of able to understand that since the type of <code>draw</code> uses only <code>Renderable</code> and <code>Renderable</code> does not have a parameter of type <code>Uniform</code> in its type signature, the compiler is not able to verify the flow completely. But I am wondering, why cant the compiler, while testing the type signature of <code>draw</code> ignore the issue and basically depend on the fact that it will know if a type implementing <code>Renderable</code> will definitely have to provide a value for <code>uniform</code> as a part of <code>State</code> and it can verify the type correctness in the implementation site rather than usage.</p>\n\n<p>PS: This is an extracted snippet from OpenGL code and <code>Uniform</code>, <code>Library</code> are opengl terminologies.</p>\n"}, {"tags": ["haskell", "cyclic-dependency"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1533735973, "post_id": 51748308, "comment_id": 90456395, "body": "This should compile. What is not working? In <code>ghci</code>, you will however need to write it as a multiline statement."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1533736273, "post_id": 51748308, "comment_id": 90456582, "body": "well the reason a single line will not work is because it first interprets the firs tline, and then <code>Neu</code> is unknown. But if you feed the two lines at the same time, then the compiler can <i>tie the knot</i> itself :)."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 3, "last_activity_date": 1533762353, "creation_date": 1533762353, "answer_id": 51755642, "question_id": 51748308, "link": "https://stackoverflow.com/questions/51748308/tying-the-knot-in-cyclic-records/51755642#51755642", "title": "Tying the knot in cyclic records", "body": "<p>Your code compiles fine (I took the liberty of giving it a module name), there are not errors:</p>\n\n<pre><code>% ghc -c so.hs\n% cat so.hs\n{-# LANGUAGE OverloadedStrings, DuplicateRecordFields #-}\nmodule So where\n\ndata Syn = S { inputs :: [Neu] }\ndata Neu = N { weigth :: Double, inputs :: [ Syn ] }\n\n% ls -l so.o\n-rw-r--r--  1 tommd  wheel  4888 Aug  8 14:02 so.o\n</code></pre>\n\n<p>If you are getting an error please be sure to post the actual code, the command used to compile or interpret, the version of the compiler, and the error message itself.</p>\n"}], "owner": {"reputation": 4718, "user_id": 1805129, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/5754dda1f072edff8efc699b1a876d36?s=128&d=identicon&r=PG", "display_name": "Dilawar", "link": "https://stackoverflow.com/users/1805129/dilawar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "closed_date": 1533922308, "accepted_answer_id": 51755642, "answer_count": 1, "score": 0, "last_activity_date": 1533762353, "creation_date": 1533735847, "last_edit_date": 1533736151, "question_id": 51748308, "link": "https://stackoverflow.com/questions/51748308/tying-the-knot-in-cyclic-records", "closed_reason": "Not suitable for this site", "title": "Tying the knot in cyclic records", "body": "<p>What is the best way to rewrite the following so it compiles? Both data-type depends on each other.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings, DuplicateRecordFields #-}   \ndata Syn = S { inputs :: [Neu] }\ndata Neu = N { weigth :: Double, inputs :: [ Syn ] }\n</code></pre>\n"}, {"tags": ["haskell", "type-inference"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1533732107, "post_id": 51746869, "comment_id": 90453736, "body": "Well <code>instance Num a =&gt; Num (Sum a)</code> holds, so that means that <code>5</code> is a <code>Sum Int</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1533732914, "post_id": 51746869, "comment_id": 90454260, "body": "Yikes, &quot;Found hole: <code>_ :: Integer -&gt; Sum Int</code>&quot; is incredibly misleading! It should actually be something like &quot;Found hole: <code>_ :: exists a. Num a *&gt; a -&gt; Sum Int</code>&quot;, but <code>exists</code> (the dual of <code>forall</code>) and <code>(*&gt;)</code> (the dual of <code>(=&gt;)</code>) don&#39;t exist in Haskell (yet?). Defaulting chose <code>a ~ Integer</code>, but other choices are valid, too, including in particular <code>Sum Int</code>, so another valid type for that hole is <code>Sum Int -&gt; Sum Int</code> -- and <code>(+3)</code> can indeed be given that type."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1533733142, "post_id": 51746869, "comment_id": 90454455, "body": "@DanielWagner I get <code>Found hole: _ :: a0 -&gt; Sum Int</code> after disabling defaulting. And then <code>Ambiguous type variable \u2018a0\u2019 arising from the literal \u20185\u2019 prevents the constraint \u2018(Num a0)\u2019 from being solved.</code> Not too shabby. The default version is indeed yikes-worthy."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1533733607, "post_id": 51746869, "comment_id": 90454762, "body": "@chi Ah, nice, I had tried <code>-XNoMonomorphismRestriction</code>, since that&#39;s the <i>usual</i> culprit for defaulting, which didn&#39;t help; I didn&#39;t think to try <code>default ()</code>, but once I read your comment it was clear that was the way to go, and that collection of errors does look much better!"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 10175838, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_QCvm_yANrY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rbiG5xdJw-JrEXhH1n1T4dxflssg/mo/photo.jpg?sz=128", "display_name": "simkestuff", "link": "https://stackoverflow.com/users/10175838/simkestuff"}, "edited": false, "score": 0, "creation_date": 1533737444, "post_id": 51747598, "comment_id": 90457388, "body": "Uff! I was not aware that compiler will run <code>fromInteger</code> function trying to adjust 3 and 5 into something that will allow signatures to match and compile; that makes it understandable now, thanks!"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 45, "user_id": 10175838, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_QCvm_yANrY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rbiG5xdJw-JrEXhH1n1T4dxflssg/mo/photo.jpg?sz=128", "display_name": "simkestuff", "link": "https://stackoverflow.com/users/10175838/simkestuff"}, "edited": false, "score": 0, "creation_date": 1533773064, "post_id": 51747598, "comment_id": 90473781, "body": "@simkestuff You don&#39;t really need to be aware that <code>fromInteger</code> is how the compiler does it (unless you&#39;re writing your own <code>Num</code> instances), but you do need to know that numeric literals like <code>3</code> and <code>5</code> can be interpreted as many different types. The interpretation the compiler chooses depends on the context you use them in, so unfortunately when you change the code to get more information as in your question with the hole, then you might change what types the numbers are and get misleading information."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 6, "last_activity_date": 1533733730, "creation_date": 1533733730, "answer_id": 51747598, "question_id": 51746869, "link": "https://stackoverflow.com/questions/51746869/how-function-signature-matches-requested-types/51747598#51747598", "title": "How function signature matches requested types", "body": "<p><strong>In short</strong>: since <code>instance Num a =&gt; Num (Sum a)</code> holds, your <code>5</code> is seen as a <code>Sum Int</code>.</p>\n\n<p>Given <code>a</code> is a <code>Num</code> type, <code>Sum a</code>, is a <code>Num</code> type as well. Indeed, in the <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Num\" rel=\"noreferrer\">documentation</a> we see:</p>\n\n<blockquote>\n<pre><code>Num a =&gt; Num (Sum a)\n</code></pre>\n</blockquote>\n\n<p>Now a <code>Num</code> type <code>n</code> has a function <code>fromInteger :: Integer -&gt; n</code> to transform an <code>Integer</code> into that number type <code>n</code>. The idea is that if you thus write <code>5</code>, you implicitly write something like <code>fromInteger 5</code>.</p>\n\n<p>By writing</p>\n\n<pre><code>foldMap (+3) (Just 5) :: Sum Int\n</code></pre>\n\n<p>with <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Foldable.html#v:foldMap\" rel=\"noreferrer\"><strong><code>foldMap :: (Foldable f, Monoid m) =&gt; (a -&gt; m) -&gt; t a -&gt; m</code></strong></a> we thus know that <code>m</code> should be a <code>Sum Int</code>, that <code>t ~ Maybe</code>, and since <code>(+3) :: Num a =&gt; a -&gt; a</code>, it means that <code>m ~ a ~ Sum Int</code>. It thus means that the <code>5</code> (from <code>Just 5</code>) and <code>3</code> (from <code>(+3)</code>) are <code>Sum Int</code>s. The <code>5</code> you have written is thus interpreted as a <code>Sum 5</code>. The same holds for <code>3</code>.</p>\n\n<p>So now that we know that we actually have written:</p>\n\n<pre><code>foldMap (+ (Sum 3)) (Just (Sum 5)) :: Sum Int\n</code></pre>\n\n<p>The <code>foldMap</code> will map every element of the structure to a monoid (well it is already a monoid, but it will increment them with <code>3</code> anyway), and then perform a fold. So that means we have written something like:</p>\n\n<pre><code>(+ (Sum 3)) (Sum 5) &lt;&gt; mempty\n</code></pre>\n\n<p>For the <code>Num n =&gt; Sum n</code> types the <code>mempty</code> is <code>Sum 0</code>, so that means we wrote:</p>\n\n<pre><code>(+ (Sum 3)) (Sum 5) &lt;&gt; (Sum 0)\n</code></pre>\n\n<p>and <code>(&lt;&gt;)</code> for a <code>Sum</code> is the <code>(+)</code>, so it means the expression boils down to:</p>\n\n<pre><code>(+ (Sum 3)) (Sum 5) + (Sum 0)\n</code></pre>\n\n<p>which can be evaluated to:</p>\n\n<pre><code>(Sum 5 + Sum 3) + Sum 0\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>Sum 8\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 10175838, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_QCvm_yANrY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rbiG5xdJw-JrEXhH1n1T4dxflssg/mo/photo.jpg?sz=128", "display_name": "simkestuff", "link": "https://stackoverflow.com/users/10175838/simkestuff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 51747598, "answer_count": 1, "score": 4, "last_activity_date": 1533733730, "creation_date": 1533731545, "question_id": 51746869, "link": "https://stackoverflow.com/questions/51746869/how-function-signature-matches-requested-types", "title": "How function signature matches requested types", "body": "<p>Im trying to understand how this works; In GHCi: </p>\n\n<pre><code>foldMap (+3) (Just 5) :: Sum Int\n</code></pre>\n\n<p>produce result</p>\n\n<pre><code>Sum {getSum = 8}\n</code></pre>\n\n<p>Now, type of foldMap is</p>\n\n<pre><code>foldMap :: (Foldable t, Monoid m) =&gt; (a -&gt; m) -&gt; t a -&gt; m\n</code></pre>\n\n<p>and from that type signatures for function used by foldMap do not match with signature of used function (+3):</p>\n\n<pre><code>(+3) :: Num a =&gt; a -&gt; a\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>f :: Monoid m =&gt; a -&gt; m\n</code></pre>\n\n<p>If I also try something like this:</p>\n\n<pre><code>foldMap _ (Just 5) :: Sum Int\n---------------------------------------\n&lt;interactive&gt;:113:9: error:  \n* Found hole: _ :: Integer -&gt; Sum Int  \n* In the first argument of `foldMap', namely `_'  \n  In the expression: foldMap _ (Just 5) :: Sum Int  \n....\n</code></pre>\n\n<p>this also show that expected function is of signature <code>:: (Integer -&gt; Sum Int)</code> and which is consistent with signature in foldMap declaration but not consistent with (+3) which is used  above? My understanding of foldMap is that it apply function which turn every element of Foldable instance into Monoid which is then possible to collapse into single values.</p>\n\n<p>I assume that compiler infere what types should be (in line above it is explicitly stated) but what I don't understand is how does compiler \"adjust\" types signature of function (+3) so that first line compile?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1533722272, "post_id": 51743653, "comment_id": 90447438, "body": "You forgot a <code>return</code> on line 9"}], "answers": [{"tags": [], "owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "is_accepted": true, "score": 5, "last_activity_date": 1533724917, "creation_date": 1533724917, "answer_id": 51744658, "question_id": 51743653, "link": "https://stackoverflow.com/questions/51743653/couldnt-match-type-maybe-with-io/51744658#51744658", "title": "Couldn&#39;t match type \u2018Maybe\u2019 with \u2018IO\u2019", "body": "<p>The culprit is <code>Nothing -&gt; Nothing</code>, where the first <code>Nothing</code> is a <code>Maybe Day</code> and the second is a <code>Maybe (Either UserError Day)</code>.</p>\n\n<p>You want</p>\n\n<pre><code>Nothing -&gt; return $ Left InvalidDate\n</code></pre>\n\n<p>(or some other <code>UserError</code>).</p>\n"}], "owner": {"reputation": 11, "user_id": 8077066, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ErFZpNV8j6s/AAAAAAAAAAI/AAAAAAAAAjA/C-JGpUL5xW0/photo.jpg?sz=128", "display_name": "MixFix Chanel", "link": "https://stackoverflow.com/users/8077066/mixfix-chanel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 51744658, "answer_count": 1, "score": -1, "last_activity_date": 1533735011, "creation_date": 1533721888, "last_edit_date": 1533735011, "question_id": 51743653, "link": "https://stackoverflow.com/questions/51743653/couldnt-match-type-maybe-with-io", "title": "Couldn&#39;t match type \u2018Maybe\u2019 with \u2018IO\u2019", "body": "<p>This is my function</p>\n\n<pre><code>getDateFromUser :: IO (Either UserError Day)\ngetDateFromUser = do\n  Prelude.putStrLn \"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0443\u043a\u0430\u0436\u0438\u0442\u0435 \u0434\u0430\u0442\u0443 \u0434\u043b\u044f \u043f\u0440\u043e\u0433\u043d\u043e\u0437\u0430 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u0413\u0413\u0413\u0413-\u041c\u041c-\u0414\u0414:\"\n  currentTime &lt;- getCurrentTime\n  date &lt;- Prelude.getLine\n  let retrievedDate = utctDay currentTime\n      dayFromUser   = parseTimeM True defaultTimeLocale \"%Y-%-m-%-d\" date :: Maybe Day\n   case dayFromUser of\n     Nothing -&gt; Nothing\n     Just validDay -&gt; do\n       let differenceInDays = diffDays validDay retrievedDate\n       if differenceInDays &gt;= 0 &amp;&amp; differenceInDays &lt;= 16\n          then return $ Right validDay\n          else return $ Left InvalidDate\n</code></pre>\n\n<p>and this error message </p>\n\n<p>Expected type: IO (Either UserError Day)\nActual type: Maybe (Either UserError Day)</p>\n\n<p>How can I fix this?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1533721769, "last_edit_date": 1533721769, "creation_date": 1533719886, "answer_id": 51742937, "question_id": 51742717, "link": "https://stackoverflow.com/questions/51742717/what-does-a-quoted-string-in-the-import-syntax-import-cryptonite-crypto-hash/51742937#51742937", "title": "What does a quoted string in the import syntax `import &quot;cryptonite&quot; Crypto.Hash` mean?", "body": "<p>This is extra syntax that is supported when using the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#ghc-flag--XPackageImports\" rel=\"noreferrer\"><strong><code>PackageImports</code></strong></a> extension:</p>\n\n<blockquote>\n  <p>With the PackageImports extension, GHC allows import declarations to\n  be qualified by the package name that the module is intended to be\n  imported from. For example:</p>\n\n<pre><code>import \"network\" Network.Socket\n</code></pre>\n  \n  <p>would import the module <code>Network.Socket</code>\n  from the package <code>network</code> (any version). This may be used to\n  disambiguate an import when the same module is available from multiple\n  packages, or is present in both the current package being built and an\n  external package.</p>\n  \n  <p>The special package name this can be used to refer to the current\n  package being built.</p>\n</blockquote>\n\n<p>It occasionally happens that two packages export a module with the same name. For example both <a href=\"https://hackage.haskell.org/package/hashmap-1.3.3/docs/Data-HashSet.html\" rel=\"noreferrer\"><code>hashmap</code></a> and <a href=\"https://hackage.haskell.org/package/unordered-containers-0.2.9.0/docs/Data-HashSet.html\" rel=\"noreferrer\"><code>unordered-containers</code></a> export <strong><code>Data.HashSet</code></strong>. If both packages are installed, we want to disambiguate between the different packages. With this type of import, the author thus specifies that the <a href=\"https://hackage.haskell.org/package/cryptonite-0.25/docs/Crypto-Hash.html\" rel=\"noreferrer\"><strong><code>Crypto.Hash</code></strong></a> module of the <a href=\"https://hackage.haskell.org/package/cryptonite\" rel=\"noreferrer\"><strong><code>cryptonite</code></strong></a> needs to be used.</p>\n\n<p>This is to to the best of my knowledge not standard Haskell (in the sense that other Haskell compilers do not <em>have</em> to support this, it seems <em>not</em> specified in the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch5.html#x11-1010005.3\" rel=\"noreferrer\">import statement section of the Haskell 2010 report</a>), but a Glasgow Haskell compiler <em>extension</em>. Of course other compilers can support this as well, but a compiler without this extension, can still rightfully call itself a \"Haskell compiler\". In order to activate this extension, you need to compile with the <code>-XPackageImports</code> extension:</p>\n\n<pre><code>ghc <b>-XPackageImports</b> main.hs</code></pre>\n\n<p>This is a <em>dynamic</em> flag, and thus can be specified in the \"pragma\" of a Haskell source file as well.</p>\n"}], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 1, "accepted_answer_id": 51742937, "answer_count": 1, "score": 7, "last_activity_date": 1533721769, "creation_date": 1533719189, "question_id": 51742717, "link": "https://stackoverflow.com/questions/51742717/what-does-a-quoted-string-in-the-import-syntax-import-cryptonite-crypto-hash", "title": "What does a quoted string in the import syntax `import &quot;cryptonite&quot; Crypto.Hash` mean?", "body": "<p>As stated in the title. There is a codebase, where I have seen the following syntax</p>\n\n<pre><code>import       \"cryptonite\" Crypto.Hash\n             (Context, Digest, SHA256, hash, hashFinalize, hashInit,\n             hashUpdate)\n</code></pre>\n\n<p>This syntax doesn't seem to be mentioned on <a href=\"https://wiki.haskell.org/Import\" rel=\"noreferrer\">haskell wiki on imports</a>.</p>\n\n<p>What does the <code>\"cryptonite\"</code> string do here?</p>\n\n<p>Where does this syntax come from?</p>\n\n<p>Is is part of Haskell2010 and if it is so where in the language report is it mentioned?</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1533716183, "post_id": 51741647, "comment_id": 90443438, "body": "What if there are no tuples with <code>True</code> and/or <code>False</code>, is the result then <code>0 % 1</code>?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 2, "creation_date": 1533716378, "post_id": 51741647, "comment_id": 90443556, "body": "can you show what you have tried with <code>foldM</code> and  where you are stuck?"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1533719350, "post_id": 51741647, "comment_id": 90445526, "body": "Use <code>partition</code> from <code>Data.List</code>, after that you can do the summing."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1533721366, "post_id": 51742192, "comment_id": 90446827, "body": "Well gosh as long as you&#39;re using <code>Data.Map</code> might as well make it easy on yourself <code>M.toList . M.fromListWith (+)</code>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1533729065, "post_id": 51742192, "comment_id": 90451632, "body": "Totally forgot about <code>fromListWith</code>"}, {"owner": {"reputation": 215, "user_id": 1876850, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e36e3bcf77a173a8322fb3a408bf630f?s=128&d=identicon&r=PG", "display_name": "Florian", "link": "https://stackoverflow.com/users/1876850/florian"}, "edited": false, "score": 0, "creation_date": 1533729267, "post_id": 51742192, "comment_id": 90451771, "body": "I chose this as best answer as it was the easiest to understand for me."}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": true, "score": 1, "last_activity_date": 1533717482, "creation_date": 1533717482, "answer_id": 51742192, "question_id": 51741647, "link": "https://stackoverflow.com/questions/51741647/reduce-a-list-with-entries-made-up-of-bool-and-rational-values-in-haskell/51742192#51742192", "title": "Reduce a list with entries made up of Bool and Rational values in Haskell", "body": "<p>I think with <code>foldM</code> you are already going in the right direction - although the <code>M</code> is not necessary as your function can be implemented purely - i.e. without side effects.</p>\n\n<p>I would use a <code>Map Bool Rational</code> (from the containers package) for the accumulator - as this can be generalized easily if your tuples have a more complex type in the first position.</p>\n\n<pre><code>import qualified Data.Map as M\n\nprocessList :: (Ord k, Bounded k, Enum k, Num v) =&gt; [(k,v)] -&gt; [(k,v)]\nprocessList = M.toList . foldr' (uncurry (M.insertWith (+))) init\n  where init = M.fromList [(x,0) | x &lt;- [minBound..maxBound] ]\n</code></pre>\n\n<p>alternatively you can use</p>\n\n<pre><code>  where init = M.empty \n</code></pre>\n\n<p>if you don't want default values (<code>0%1</code>) in the list, then you can also drop the <code>Enum</code> and <code>Bounded</code> constraints</p>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1533717921, "creation_date": 1533717921, "answer_id": 51742314, "question_id": 51741647, "link": "https://stackoverflow.com/questions/51741647/reduce-a-list-with-entries-made-up-of-bool-and-rational-values-in-haskell/51742314#51742314", "title": "Reduce a list with entries made up of Bool and Rational values in Haskell", "body": "<p>You can indeed use a <code>fold</code> here. I would here use a 2-tuple where for example the first element contains the sum of the <code>False</code>s, and the second the sum of the <code>True</code>s:</p>\n\n<pre><code>import Control.Arrow(first, second)\nimport Data.Bool(bool)\n\ndsum :: (Foldable f, Num a) =&gt; f (Bool, a) -&gt; (a, a)\ndsum = foldr (uncurry ((. (+)) . bool first second)) (0,0)\n</code></pre>\n\n<p>For a foldable of <code>(Bool, a)</code> tuples, it will thus calculate a 2-tuple where the first element contains the sum of the <code>(False, ...)</code> tuples, and the second the sum of the <code>(True, ...)</code> tuples.</p>\n\n<p>Here the <code>(uncurry ((. (+)) . bool first second))</code> is a compact representation of a function <code>f</code>:</p>\n\n<pre><code>f :: Num a =&gt; (Bool, a) -&gt; (a, a) -&gt; (a, a)\nf (False, d) (a, b) = (d+a, b)\nf (True, d) (a, b) = (a, d+b)\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; d = [(False,1 % 40),(False,9 % 40),(False,1 % 40),(False,9 % 40), (False,1 % 40),(False,9 % 40),(False,1 % 40),(True,9 % 40)]\nPrelude&gt; dsum d\n(31 % 40,9 % 40)\n</code></pre>\n\n<p>By using a 2-tuple, we thus add a \"contract\" that we will have <em>exactly</em> two elements, which is usually preferrable over a list that will always contain two items.</p>\n"}, {"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1533735026, "post_id": 51744583, "comment_id": 90455725, "body": "Beware that this does not work well if <code>False</code>s and <code>True</code>s alternate in the input list."}], "tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": false, "score": 1, "last_activity_date": 1533724665, "creation_date": 1533724665, "answer_id": 51744583, "question_id": 51741647, "link": "https://stackoverflow.com/questions/51741647/reduce-a-list-with-entries-made-up-of-bool-and-rational-values-in-haskell/51744583#51744583", "title": "Reduce a list with entries made up of Bool and Rational values in Haskell", "body": "<p>I think the solution below is more appropriate for beginners but it won't work if your list has no tuples with either True or False (you can solve this easily. Give it a try ;) )</p>\n\n<pre><code>sumBooleans :: (Num a) =&gt; [(Bool,a)] -&gt; [(Bool,a)]\nsumBooleans l = map (foldr1 sumTuples) grouppedList\n   where sumTuples (b,r) (_, r') = (b, r + r')\n         grouppedList = groupBy myCondition l\n         myCondition (b,_) (b', _) = b == b'\n</code></pre>\n\n<p>So <code>grouppedList</code> is a list containing two list. One list is all \"True tuples\", and the other is all \"False tuples\". Then you reduce each list using <code>foldr1 sumTuples</code> (you have to map this <code>foldr1 sumTuples</code> because you have a list of lists).</p>\n\n<p>Have you considered that a list is not the best data structure for the output of your function?</p>\n\n<p>Best,</p>\n"}], "owner": {"reputation": 215, "user_id": 1876850, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e36e3bcf77a173a8322fb3a408bf630f?s=128&d=identicon&r=PG", "display_name": "Florian", "link": "https://stackoverflow.com/users/1876850/florian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 51742192, "answer_count": 3, "score": -1, "last_activity_date": 1533724665, "creation_date": 1533715772, "question_id": 51741647, "link": "https://stackoverflow.com/questions/51741647/reduce-a-list-with-entries-made-up-of-bool-and-rational-values-in-haskell", "title": "Reduce a list with entries made up of Bool and Rational values in Haskell", "body": "<p>I got a list that contains entries which are made up of a Bool and a Rational value that looks like this:</p>\n\n<pre><code>[(False,1 % 40),(False,9 % 40),(False,1 % 40),(False,9 % 40),  \n (False,1 % 40),(False,9 % 40),(False,1 % 40),(True,9 % 40)]\n</code></pre>\n\n<p>I want to reduce the entries that share a Bool value into one and also add up the corresponding Rational values.</p>\n\n<p>The result for the above example should look like this:</p>\n\n<pre><code>[(False,31 % 40),(True,9 % 40)]\n</code></pre>\n\n<p>I am new to Haskell and tried to accomplish the task using foldM, but I don't think that's the right way to do it.</p>\n\n<p>Any help is much appreciated.</p>\n"}, {"tags": ["haskell", "types", "ghc"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 9, "creation_date": 1533703600, "post_id": 51738630, "comment_id": 90437761, "body": "There is <a href=\"https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0029-scoped-type-variables-types.rst\" rel=\"nofollow noreferrer\">an accepted GHC proposal for lifting this restriction</a>. Its &quot;Motivation&quot; section explains the issue quite well."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 4, "creation_date": 1533704037, "post_id": 51738630, "comment_id": 90437872, "body": "Hats off for the good question, I was entirely unaware of this restriction."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 5, "last_activity_date": 1533918886, "last_edit_date": 1533918886, "creation_date": 1533853887, "answer_id": 51776590, "question_id": 51738630, "link": "https://stackoverflow.com/questions/51738630/significance-of-scoped-type-variables-standing-for-type-variables-and-not-types/51776590#51776590", "title": "Significance of scoped type variables standing for type variables and not types", "body": "<p><strong>tl;dr:</strong>  The documentation says what it says because the old implementation of scoped typed variables in GHC was different, and the new documentation (over)emphasizes the contrast between the old behavior and the new behavior.  In fact, the scoped typed variables you use with the <code>ScopedTypeVariables</code> extension in place are just plain old (rigid) type variables, and these are the same type variables you've been using in regular Haskell type signatures without scoping (even if you didn't realize they were \"rigid\").  It's true that scoped type variables don't simply \"stand for types\", but regular unscoped type variables don't simply \"stand for types\", either.</p>\n\n<p>Longer answer:</p>\n\n<p>First, setting aside the issue of scoped type variables, consider the following:</p>\n\n<pre><code>pluralize :: [a] -&gt; [a]\npluralize x = x ++ \"s\"\n</code></pre>\n\n<p>If <code>a</code>, as a type variable, simply \"stood for a type\", this would be fine. GHC would determine that <code>a</code> stood for the type <code>Char</code>, and the resulting signature <code>[Char] -&gt; [Char]</code> would be determined to be the correct type of <code>pluralize</code>, so there'd be no problem.  In fact, if we were inferring the type of:</p>\n\n<pre><code>pluralize x = x ++ \"s\"\n</code></pre>\n\n<p>in a plain old Hindley-Milner (HM) type system, this is probably exactly what would happen.  As an intermediate step while typing the <code>(++)</code> application, the type checker would assign <code>x</code> the type <code>[a]</code> for a \"fresh\" HM type variable <code>a</code>, and it would assign <code>pluralize</code> the type <code>[a] -&gt; [a]</code> before unifying <code>[a]</code> with the type of <code>\"s\" :: [Char]</code> to unify <code>a</code> and <code>Char</code>.</p>\n\n<p>Instead, this is rejected by the GHC type checker because <code>a</code> in this type signature is not an HM-style type variable and so does <em>not</em> simply stand for a type.  Instead, it is a rigid (i.e., user-specified) Haskell type variable, and the type checker doesn't permit such a variable to unify with anything other than itself while defining <code>pluralize</code>.</p>\n\n<p>Similarly, the following is rejected:</p>\n\n<pre><code>pairlist :: a -&gt; b -&gt; [a]\npairlist x y = [x,y]\n</code></pre>\n\n<p>even though, if <code>a</code> and <code>b</code> just stood for types, this would be fine (as it works for any <code>a</code> and <code>b</code> of kind <code>*</code> provided only that <code>a</code> and <code>b</code> are the same type).  Instead, it is rejected by the type checker because two rigid Haskell type variables <code>a</code> and <code>b</code> can't unify.</p>\n\n<p>Now, you might try to make the case that the issue is <strong>not</strong> that type variables are \"rigid\" and can't unify with concrete types (like <code>Char</code>) or with each other, but rather that there is an implicit quantification in Haskell type signatures, so that the signature for <code>pluralize</code> is actually:</p>\n\n<pre><code>pluralize :: forall a . [a] -&gt; [a]\n</code></pre>\n\n<p>and so when <code>a</code> is determined to \"stand for\" <code>Char</code>, it is the contradiction with this <code>forall a</code> quantification that triggers the error.  The problem with this argument is that both explanations are actually more or less equivalent.  It is because Haskell type variables are rigid (i.e., because type signatures in Haskell are implicitly universally quantified) that the types cannot unify (i.e., that the unification contradicts the quantification).  However, it turns out that the \"rigid type variables\" explanation is closer to what's actually happening in the GHC type checker than the \"implicit quantification\" explanation.  That's why the error messages generated by the above definitions refer to inability to match rigid type variables rather than to contradictions with universal type variable quantifications.</p>\n\n<p>Now, let's turn back to the question of scoped type variables.  In the olden days, GHC's <code>-fscoped-type-variables</code> extension was implemented quite differently.  In particular, for pattern type signatures, you were permitted to write things like the following (taken from the <a href=\"https://downloads.haskell.org/~ghc/6.0/docs/html/users_guide/type-extensions.html#SCOPED-TYPE-VARIABLES\" rel=\"nofollow noreferrer\">documentation for GHC 6.0</a>):</p>\n\n<pre><code>f :: [Int] -&gt; Int -&gt; Int\nf (xs::[a]) (y::a) = (head xs + y) :: a\n</code></pre>\n\n<p>and the documentation went on to say:</p>\n\n<blockquote>\n  <p>The pattern type signatures on the left hand side of <code>f</code> express the fact that <code>xs</code> must be a list of things of some type <code>a</code>; and that <code>y</code> must have this same type.  The type signature on the expression <code>(head xs)</code> <em>[sic]</em> specifies that this expression must have the same type <code>a</code>. <em>There is no requirement that the type named by \"<code>a</code>\" is in fact a type variable.</em>  Indeed, in this case, the type named by \"<code>a</code>\" is <code>Int</code>.  (This is a slight liberalisation from the original rather complex rules, which specified that a pattern-bound type variable should be universally quantified.)</p>\n</blockquote>\n\n<p>It went on to give some additional examples of use of scoped type variables, such as:</p>\n\n<pre><code>g (x::a) (y::b) = [x,y]       -- a unifies with b\n\nk (x::a) True    = ...        -- a unifies with Int\nk (x::Int) False = ...\n</code></pre>\n\n<p>In 2006, Simon Peyton-Jones made a big commit (<a href=\"https://github.com/ghc/ghc/commit/ac10f8408520a30e8437496d320b8b86afda2e8f\" rel=\"nofollow noreferrer\"><code>ac10f840</code></a>) to add impredicativity to the type system which also ended up substantially changing the implementation of lexically scoped type variables.  The commit text contains a detailed explanation of the change including the requirements for the new design.</p>\n\n<p>A key design choice was that lexically scoped type variables now named rigid (i.e., user-specified polymorphic) Haskell type variables, rather than being more like the HM-style variables that simply stood for a type and were subject to unification.</p>\n\n<p>That made the above examples (<code>f</code>, <code>g</code>, and <code>k</code>) illegal, because scoped type variables in pattern matches now behaved more like regular rigid type variables.</p>\n\n<p>Soooo...  the old design was probably a weird hack that made scoped type variables more like HM type variables and so quite different from \"normal\" Haskell type variables, and the new system brought them more into line with how unscoped type variables behaved.</p>\n\n<p>However, complicating things further, @duplode's link in the comments references a proposal to partially \"undo\" this \"restriction\" in the context of signatures in pattern matches.  I <em>think</em> it would be fair to say that the old design, which treated scoped type variables more like a special case, was inferior to the new design which better unified the treatment of scoped and unscoped type variables, and there is no desire to go back to the old implementation.  However, the new, simpler implementation had the side effect of being unnecessarily restrictive for pattern signatures which perhaps ought to be treated as a special case where non-rigid type variables are permitted.</p>\n"}, {"tags": [], "owner": {"reputation": 717, "user_id": 2905219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bde88eb92833e086844c9bf1a254c66?s=128&d=identicon&r=PG&f=1", "display_name": "echinodermata", "link": "https://stackoverflow.com/users/2905219/echinodermata"}, "is_accepted": false, "score": 1, "last_activity_date": 1535438377, "creation_date": 1535438377, "answer_id": 52051576, "question_id": 51738630, "link": "https://stackoverflow.com/questions/51738630/significance-of-scoped-type-variables-standing-for-type-variables-and-not-types/52051576#52051576", "title": "Significance of scoped type variables standing for type variables and not types", "body": "<p>I'm adding this answer (to my own question) in order to expand on duplode's reference in the comments. ScopedTypeVariables is currently being changed to allow scoped type variables to stand for types instead of only type variables. The discussion for this change the motivation for the new and old designs. This does <em>not</em>, however, address the even earlier design mentioned in the question and in K. A. Buhr's answer.</p>\n\n<p>In the current state, before the forthcoming change, the definition</p>\n\n<pre><code>prefix :: a -&gt; [[a]] -&gt; [[a]]\nprefix (x :: b) yss = map xcons yss\n    where xcons ys = x : ys\n</code></pre>\n\n<p>is valid (with ScopedTypeVariables), in which <code>b</code> is a newly introduced type variable that stands for the same thing as <code>a</code>. On the other hand, if <code>prefix</code> is specialized to</p>\n\n<pre><code>prefix :: Int -&gt; [[Int]] -&gt; [[Int]]\nprefix (x :: b) yss = map xcons yss\n    where xcons ys = x : ys\n</code></pre>\n\n<p>then the program is rejected: <code>b</code> is forbidden from standing for <code>Int</code> since <code>Int</code> is not a type <em>variable</em>. Simon Peyton Jones remarked on why it was designed so that <code>b</code> could not stand for <code>Int</code>:</p>\n\n<blockquote>\n  <p>At the time I was worried that it'd be confusing to have a type\n  variable that was just an alias for Int; that is not a type variable\n  at all. But in these days of GADTs and type equalities we are all used\n  to that. We'd make a different choice today.</p>\n</blockquote>\n\n<p>In the current consensus of the GHC maintainers, the limitation against <code>b</code> standing for <code>Int</code> is viewed as unnatural, especially in light of the possibility of type equalities <code>(a ~ Int) =&gt; ...</code>. The presence of such constraints blur the lines of what being \"bound to a type variable\" really means. Should the examples</p>\n\n<pre><code>f1 :: (a ~ Int) =&gt; Maybe a -&gt; Int\nf1 (Just (x :: b)) = ...\n\nf2 :: (a ~ Int) =&gt; Maybe Int -&gt; Int\nf2 (Just (x :: a)) = ...\n</code></pre>\n\n<p>be permitted? Under the new proposal, all four examples above are allowed.</p>\n\n<hr>\n\n<p>In my own view, the tension ultimately comes from the coexistence of two very different type annotation systems. One of them has the effect of <em>preventing</em> you from giving different names to the same type (for instance, you cannot write <code>(\\x -&gt; x) :: a -&gt; b</code> or <code>(\\x -&gt; x) :: Int -&gt; b</code> and expect <code>b</code> to be unified with <code>a</code> or <code>Int</code>). The other <em>enables</em> and encourages you to give new names to things (pattern type signatures like <code>foo (x :: b) = ...</code>), a feature which exists to enable you to name types that would otherwise be un-nameable. The leftover question is whether pattern type signatures should allow you to alias types that are already nameable. The answer at its core depends on which of the two precedents you find more compelling.</p>\n\n<hr>\n\n<p>References:</p>\n\n<ol>\n<li>Joachim Breitner \"nomeata\" (April-August 2018). Feature request ticket \"ScopedTypeVariables could allow more programs\", <a href=\"https://ghc.haskell.org/trac/ghc/ticket/15050\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/15050</a></li>\n<li>nomeata (April-August 2018). Pull request \"Allow ScopedTypeVariables to refer to types\", <a href=\"https://github.com/ghc-proposals/ghc-proposals/pull/128\" rel=\"nofollow noreferrer\">https://github.com/ghc-proposals/ghc-proposals/pull/128</a></li>\n<li>Richard A. Eisenberg, Joachim Breitner, and Simon Peyton Jones (June 2018). \"Type variables in patterns\", <a href=\"https://www.microsoft.com/en-us/research/uploads/prod/2018/06/tyvars-in-pats-haskell18-preprint.pdf\" rel=\"nofollow noreferrer\">https://www.microsoft.com/en-us/research/uploads/prod/2018/06/tyvars-in-pats-haskell18-preprint.pdf</a>, especially  sections 3.5 and 4.3</li>\n<li>nomeata (August 2018). GHC proposal \"Allow ScopedTypeVariables to refer to types\", <a href=\"https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0029-scoped-type-variables-types.rst\" rel=\"nofollow noreferrer\">https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0029-scoped-type-variables-types.rst</a></li>\n</ol>\n"}], "owner": {"reputation": 717, "user_id": 2905219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bde88eb92833e086844c9bf1a254c66?s=128&d=identicon&r=PG&f=1", "display_name": "echinodermata", "link": "https://stackoverflow.com/users/2905219/echinodermata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 1, "answer_count": 2, "score": 22, "last_activity_date": 1535438377, "creation_date": 1533702505, "question_id": 51738630, "link": "https://stackoverflow.com/questions/51738630/significance-of-scoped-type-variables-standing-for-type-variables-and-not-types", "title": "Significance of scoped type variables standing for type variables and not types", "body": "<p>In the GHC <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#lexically-scoped-type-variables\" rel=\"noreferrer\">documentation</a> for the ScopedTypeVariables extension, the  overview states the following as a design principle:</p>\n\n<blockquote>\n  <p>A scoped type variable stands for a type <em>variable</em>, and not for a <em>type</em>. (This is a change from GHC\u2019s earlier design.)</p>\n</blockquote>\n\n<p>I know the general purpose of the scoped type variables extension, but I don't know the implications of the distinction made here between standing for type variables and standing for types. What is the significance of the difference, from the perspective of users of the language?</p>\n\n<p>The comment above alludes to two designs which approached this decision differently and made different tradeoffs. What was the alternative design, and how does it compare to the one currently implemented?</p>\n"}, {"tags": ["java", "haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 31664, "user_id": 226975, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ad744cf47bf63187d6b406f8be7cfa3a?s=128&d=identicon&r=PG", "display_name": "Wyzard", "link": "https://stackoverflow.com/users/226975/wyzard"}, "edited": false, "score": 27, "creation_date": 1533700414, "post_id": 51738257, "comment_id": 90437026, "body": "As an aside, in C++ this is known as the &quot;<a href=\"https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern\" rel=\"nofollow noreferrer\">curiously-recurring template pattern</a>&quot;."}, {"owner": {"reputation": 6164, "user_id": 1319284, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/519eaa527537a16e0a4665432095c2e5?s=128&d=identicon&r=PG", "display_name": "kutschkem", "link": "https://stackoverflow.com/users/1319284/kutschkem"}, "edited": false, "score": 3, "creation_date": 1533716817, "post_id": 51738257, "comment_id": 90443841, "body": "I think the better way should be <code>public interface Negatable&lt;T extends Negatable&gt;</code>, so that negate can be chained no matter what. Or is there a reason not to do it like that?"}, {"owner": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "reply_to_user": {"reputation": 6164, "user_id": 1319284, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/519eaa527537a16e0a4665432095c2e5?s=128&d=identicon&r=PG", "display_name": "kutschkem", "link": "https://stackoverflow.com/users/1319284/kutschkem"}, "edited": false, "score": 0, "creation_date": 1533718848, "post_id": 51738257, "comment_id": 90445150, "body": "@kutschkem <code>Negatable</code> isn&#39;t the correct type bound. <code>public interface Negatable&lt;T extends Negatable&lt;T&gt;&gt;</code> isn&#39;t legal Java"}, {"owner": {"reputation": 6164, "user_id": 1319284, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/519eaa527537a16e0a4665432095c2e5?s=128&d=identicon&r=PG", "display_name": "kutschkem", "link": "https://stackoverflow.com/users/1319284/kutschkem"}, "reply_to_user": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 1, "creation_date": 1533721606, "post_id": 51738257, "comment_id": 90446983, "body": "@Caleth Just tested, totally valid."}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "edited": false, "score": 8, "creation_date": 1533738794, "post_id": 51738257, "comment_id": 90458388, "body": "Note that this is <i>not</i> exactly equivalent to the given Haskell type class, as the type class <i>guarantees</i> that if you have <code>v :: Negatable t =&gt; t</code> then both <code>v</code> and <code>negate v</code> are values of type <code>t</code>, whereas in Java you could have <code>Negatable&lt;T&gt; v</code> but not have <code>v</code> actually be of type <code>t</code> (I could for instance define <code>public class X implements Negatable&lt;Integer&gt; { public void negate () { return 1; } }</code>, which satisfies all the given conditions, but Haskell would disallow this due to not being correctly reflexive as specified in the typeclass."}, {"owner": {"reputation": 74851, "user_id": 238419, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/460167b95ff5a363d3977ddb56cfe074?s=128&d=identicon&r=PG", "display_name": "BlueRaja - Danny Pflughoeft", "link": "https://stackoverflow.com/users/238419/blueraja-danny-pflughoeft"}, "reply_to_user": {"reputation": 34388, "user_id": 2610810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c6433073e71478e8da278a188e1d15?s=128&d=identicon&r=PG", "display_name": "Caleth", "link": "https://stackoverflow.com/users/2610810/caleth"}, "edited": false, "score": 4, "creation_date": 1533758849, "post_id": 51738257, "comment_id": 90469258, "body": "@Caleth: Not only is that legal, it&#39;s <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/Enum.html\" rel=\"nofollow noreferrer\">exactly how Enum is defined</a>."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "reply_to_user": {"reputation": 31664, "user_id": 226975, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ad744cf47bf63187d6b406f8be7cfa3a?s=128&d=identicon&r=PG", "display_name": "Wyzard", "link": "https://stackoverflow.com/users/226975/wyzard"}, "edited": false, "score": 8, "creation_date": 1533770637, "post_id": 51738257, "comment_id": 90473294, "body": "@Wyzard: Everywhere else, this is known as <i>F-bounded Polymorphism</i>."}, {"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 3, "creation_date": 1533772838, "post_id": 51738257, "comment_id": 90473736, "body": "It&#39;s the wrong kind of polymorphism. It allows you to add <i>more implementations</i> of the <code>Negatable</code> interface with <i>same functions</i>. Haskell&#39;s ad-hoc polymorphisms allows you to add <i>more functions</i> on <i>same data</i>. The one kind scales well if you need more &quot;things&quot; which have the same capabilities (e.g. thousand different GUI-widgets with a couple of methods like <code>repaint</code> and <code>reactOnMouseClick</code>), the other kind of polymorphism allows you to add more <i>functions</i> on same data (starting with <code>Bool</code>, you can later tack on <code>Negatable</code>, <code>Monoid</code>, <code>Lattice</code>, <code>Ring</code>... etc.). It scales differently."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 62, "last_activity_date": 1533699201, "creation_date": 1533699201, "answer_id": 51738257, "question_id": 51738158, "link": "https://stackoverflow.com/questions/51738158/can-i-define-the-negatable-interface-in-java/51738257#51738257", "title": "Can I define the Negatable interface in Java?", "body": "<p>Actually, yes. Not directly, but you can do it. Simply include a generic parameter and then derive from the generic type.</p>\n\n<pre><code>public interface Negatable&lt;T&gt; {\n    T negate();\n}\n\npublic static &lt;T extends Negatable&lt;T&gt;&gt; T normalize(T a) {\n    return a.negate().negate();\n}\n</code></pre>\n\n<p>You would implement this interface like so</p>\n\n<pre><code>public static class MyBoolean implements Negatable&lt;MyBoolean&gt; {\n    public boolean a;\n\n    public MyBoolean(boolean a) {\n        this.a = a;\n    }\n\n    @Override\n    public MyBoolean negate() {\n        return new MyBoolean(!this.a);\n    }\n\n}\n</code></pre>\n\n<p>In fact, the Java standard library uses this exact trick to implement <code>Comparable</code>.</p>\n\n<pre><code>public interface Comparable&lt;T&gt; {\n    int compareTo(T o);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1094, "user_id": 5259805, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448bac0393b643e9a7e2f36cb3995ed0?s=128&d=identicon&r=PG&f=1", "display_name": "zale", "link": "https://stackoverflow.com/users/5259805/zale"}, "edited": false, "score": 0, "creation_date": 1533701594, "post_id": 51738308, "comment_id": 90437251, "body": "Self typing is probably the name I was looking for. Do you know if there are languages that support self typing natively, without using this trick?"}, {"owner": {"reputation": 3598, "user_id": 436524, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f9668e754daecfa1260501a71ee9876a?s=128&d=identicon&r=PG", "display_name": "Octavia Togami", "link": "https://stackoverflow.com/users/436524/octavia-togami"}, "reply_to_user": {"reputation": 1094, "user_id": 5259805, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448bac0393b643e9a7e2f36cb3995ed0?s=128&d=identicon&r=PG&f=1", "display_name": "zale", "link": "https://stackoverflow.com/users/5259805/zale"}, "edited": false, "score": 1, "creation_date": 1533706731, "post_id": 51738308, "comment_id": 90438634, "body": "@zale Typescript has the <code>this</code> type, which uses the type of the expression where the function is used."}, {"owner": {"reputation": 2924, "user_id": 5319267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8711578a7edbce62929678c9d6ea8201?s=128&d=identicon&r=PG&f=1", "display_name": "Mario Ishac", "link": "https://stackoverflow.com/users/5319267/mario-ishac"}, "edited": false, "score": 1, "creation_date": 1533709836, "post_id": 51738308, "comment_id": 90439903, "body": "You could force implementations to specify themselves through <code>public interface Negatable&lt;T extends Negatable&lt;T&gt;&gt;</code>"}, {"owner": {"reputation": 28043, "user_id": 180719, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/AWsdT.png?s=128&g=1", "display_name": "Olivier Gr&#233;goire", "link": "https://stackoverflow.com/users/180719/olivier-gr%c3%a9goire"}, "reply_to_user": {"reputation": 2924, "user_id": 5319267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8711578a7edbce62929678c9d6ea8201?s=128&d=identicon&r=PG&f=1", "display_name": "Mario Ishac", "link": "https://stackoverflow.com/users/5319267/mario-ishac"}, "edited": false, "score": 2, "creation_date": 1533727836, "post_id": 51738308, "comment_id": 90450822, "body": "@MarDev That doesn&#39;t force implementations to specify themselves. Example: <code>class A implements Negatable&lt;A&gt;{} class B implements Negatable&lt;A&gt; {}</code>. <code>B</code> doesn&#39;t specifies itself."}, {"owner": {"reputation": 1205, "user_id": 4667934, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hk11W.jpg?s=128&g=1", "display_name": "LinkBerest", "link": "https://stackoverflow.com/users/4667934/linkberest"}, "reply_to_user": {"reputation": 1094, "user_id": 5259805, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448bac0393b643e9a7e2f36cb3995ed0?s=128&d=identicon&r=PG&f=1", "display_name": "zale", "link": "https://stackoverflow.com/users/5259805/zale"}, "edited": false, "score": 1, "creation_date": 1533781078, "post_id": 51738308, "comment_id": 90475327, "body": "@zale Scala allows for self-typing using this and mix-ins. Such to self-type a trait: <code>trait Foo { def name: String} trait Bar { this: Foo =&gt; def baz(....)}</code>"}], "tags": [], "owner": {"reputation": 3615, "user_id": 229743, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tef4U.jpg?s=128&g=1", "display_name": "Taylor", "link": "https://stackoverflow.com/users/229743/taylor"}, "is_accepted": false, "score": 7, "last_activity_date": 1533699676, "creation_date": 1533699676, "answer_id": 51738308, "question_id": 51738158, "link": "https://stackoverflow.com/questions/51738158/can-i-define-the-negatable-interface-in-java/51738308#51738308", "title": "Can I define the Negatable interface in Java?", "body": "<p>You're looking for generics, plus self typing.  Self typing is the notion of generic placeholder that equates to the class of the instance.</p>\n\n<p>However, self typing doesn't exist in java.</p>\n\n<p>This can be solved with generics though.</p>\n\n<pre><code>public interface Negatable&lt;T&gt; {\n    public T negate();\n}\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>public class MyBoolean implements Negatable&lt;MyBoolean&gt;{\n\n    @Override\n    public MyBoolean negate() {\n        //your impl\n    }\n\n}\n</code></pre>\n\n<p>Some implications for implementers:</p>\n\n<ul>\n<li>They must specify themselves when they implement the interface, e.g. <code>MyBoolean implements Negatable&lt;MyBoolean&gt;</code></li>\n<li>Extending <code>MyBoolean</code> would require one to override the <code>negate</code> method again.</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1533763235, "post_id": 51749646, "comment_id": 90471203, "body": "The first few paragraphs seem to be void because of F-bounded polymorphism: <code>interface Neg&lt;T extends Neg&lt;T&gt;&gt; { T neg(); }</code> allows you to invoke <code>t.neg().neg().neg()</code> as often as you want, and always get a <code>T</code> back: <code>&lt;T extends Neg&lt;T&gt;&gt; T foo(T t) {     return t.neg().neg().neg();   }</code>. Maybe I just don&#39;t quite get what the first few paragraphs are talking about."}, {"owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "reply_to_user": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 3, "creation_date": 1533763643, "post_id": 51749646, "comment_id": 90471345, "body": "@AndreyTyukin - It compiles, but you still don&#39;t have the guarantee that on executing the result is the same type as the original value due to the fact that (as long as <code>T</code> implements <code>Neg&lt;T&gt;</code>) some type other than <code>T</code> can also implement <code>Neg&lt;T&gt;</code>.  Now, <i>for this specific example</i>, I can&#39;t see any reason why that could cause a problem, but for other cases (like <code>Equatable</code>, where it&#39;s expected that if we can call <code>equals(a,b)</code> we can also call <code>equals(b,a)</code>) that may not work very well."}], "tags": [], "owner": {"reputation": 13337, "user_id": 441899, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/368fb99f86e2264ceec0539a3746b9d3?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/441899/jules"}, "is_accepted": true, "score": 12, "last_activity_date": 1533764529, "last_edit_date": 1533764529, "creation_date": 1533739735, "answer_id": 51749646, "question_id": 51738158, "link": "https://stackoverflow.com/questions/51738158/can-i-define-the-negatable-interface-in-java/51749646#51749646", "title": "Can I define the Negatable interface in Java?", "body": "<p>In general, no.</p>\n\n<p>You <em>can</em> use tricks (as suggested in the other answers) that will make this work, but they do not provide all of the same guarantees that the Haskell typeclass does.  Specifically, in Haskell, I could define a function like this:</p>\n\n<pre><code>doublyNegate :: Negatable t =&gt; t -&gt; t\ndoublyNegate v = negate (negate v)\n</code></pre>\n\n<p>It is now known that the argument and return value of <code>doublyNegate</code> are both <code>t</code>.  But the Java equivalent:</p>\n\n<pre><code>public &lt;T extends Negatable&lt;T&gt;&gt; T doublyNegate (Negatable&lt;T&gt; v)\n{\n    return v.negate().negate();\n}\n</code></pre>\n\n<p>doesn't, because <code>Negatable&lt;T&gt;</code> could be implemented by another type:</p>\n\n<pre><code>public class X implements Negatable&lt;SomeNegatableClass&gt; {\n    public SomeNegatableClass negate () { return new SomeNegatableClass(); }\n    public static void main (String[] args) { \n       new X().negate().negate();   // results in a SomeNegatableClass, not an X\n}\n</code></pre>\n\n<p>This isn't particularly serious for this application, but does cause trouble for other Haskell typeclasses, e.g. <code>Equatable</code>.  There is no way of implementing a Java <code>Equatable</code> typeclass without using an additional object and sending an instance of that object around wherever we send values that need comparing, (e.g: </p>\n\n<pre><code>public interface Equatable&lt;T&gt; {\n    boolean equal (T a, T b);\n}\npublic class MyClass\n{\n    String str;\n\n    public static class MyClassEquatable implements Equatable&lt;MyClass&gt; \n    { \n         public boolean equal (MyClass a, MyClass b) { \n             return a.str.equals(b.str);\n         } \n    }\n}\n...\npublic &lt;T&gt; methodThatNeedsToEquateThings (T a, T b, Equatable&lt;T&gt; eq)\n{\n    if (eq.equal (a, b)) { System.out.println (\"they're equal!\"); }\n}  \n</code></pre>\n\n<p>(In fact, this is exactly how Haskell implements type classes, but it hides the parameter passing from you so you don't need to figure out which implementation to send where)</p>\n\n<p>Trying to do this with just plain Java interfaces leads to some counterintuitive results:</p>\n\n<pre><code>public interface Equatable&lt;T extends Equatable&lt;T&gt;&gt;\n{\n    boolean equalTo (T other);\n}\npublic MyClass implements Equatable&lt;MyClass&gt;\n{\n    String str;\n    public boolean equalTo (MyClass other) \n    {\n        return str.equals(other.str);\n    }\n}\npublic Another implements Equatable&lt;MyClass&gt;\n{\n    public boolean equalTo (MyClass other)\n    {\n        return true;\n    }\n}\n\n....\nMyClass a = ....;\nAnother b = ....;\n\nif (b.equalTo(a))\n    assertTrue (a.equalTo(b));\n....\n</code></pre>\n\n<p>You'd expect, due to the fact that <code>equalTo</code> really ought to be defined symmetrically, that if the <code>if</code> statement there compiles, the assertion would also compile, but it doesn't, because <code>MyClass</code> isn't equatable with <code>Another</code> even though the other way around is true.  But with a Haskell <code>Equatable</code> type class, we know that if <code>areEqual a b</code> works, then <code>areEqual b a</code> is also valid.  [1]</p>\n\n<p>Another limitation of interfaces versus type classes is that a type class can provide a means of creating a value which implements the type class without having an existing value (e.g. the <code>return</code> operator for <code>Monad</code>), whereas for an interface you must already have an object of the type in order to be able to invoke its methods.</p>\n\n<p>You ask whether there is a name for this limitation, but I'm not aware of one.  It's simply because type classes are actually different to object-oriented interfaces, despite their similarities, because they are implemented in this fundamentally different way: an object is a subtype of its interface, thus carries around a copy of the interface's methods directly without modifying their definition, while a type class is a separate list of functions each of which is customised by substituting type variables.  There is no subtype relationship between a type and a type class that has an instance for the type (a Haskell <code>Integer</code> isn't a subtype of <code>Comparable</code>, for example: there simply exists a <code>Comparable</code> instance that can be passed around whenever a function needs to be able to compare its parameters and those parameters happen to be Integers).</p>\n\n<p>[1]: The Haskell <code>==</code> operator is actually implemented using a type class, <code>Eq</code> ... I haven't used this because operator overloading in Haskell can be confusing to people not familiar with reading Haskell code.</p>\n"}, {"tags": [], "owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "is_accepted": false, "score": 7, "last_activity_date": 1533780292, "last_edit_date": 1592644375, "creation_date": 1533762622, "answer_id": 51755695, "question_id": 51738158, "link": "https://stackoverflow.com/questions/51738158/can-i-define-the-negatable-interface-in-java/51755695#51755695", "title": "Can I define the Negatable interface in Java?", "body": "<p>I interpret the question as</p>\n<h3>How can we implement ad-hoc polymorphism using typeclasses in Java?</h3>\n<p>You <em>can</em> do something very similar in Java, but without the type safety guarantees of Haskell - the solution presented below can throw errors at runtime.</p>\n<p>Here is how you can do it:</p>\n<ol>\n<li><p>Define interface that represents the typeclass</p>\n<pre><code>interface Negatable&lt;T&gt; {\n  T negate(T t);\n}\n</code></pre>\n</li>\n<li><p>Implement some mechanism that allows you to <em>register instances</em> of the typeclass for various types. Here, a static <code>HashMap</code> will do:</p>\n<pre><code>static HashMap&lt;Class&lt;?&gt;, Negatable&lt;?&gt;&gt; instances = new HashMap&lt;&gt;();\nstatic &lt;T&gt; void registerInstance(Class&lt;T&gt; clazz, Negatable&lt;T&gt; inst) {\n  instances.put(clazz, inst);\n}\n@SuppressWarnings(&quot;unchecked&quot;)\nstatic &lt;T&gt; Negatable&lt;T&gt; getInstance(Class&lt;?&gt; clazz) {\n  return (Negatable&lt;T&gt;)instances.get(clazz);\n}\n</code></pre>\n</li>\n<li><p>Define the <code>normalize</code> method that uses the above mechanism to get the appropriate instance based on the runtime class of the passed object:</p>\n<pre><code>  public static &lt;T&gt; T normalize(T t) {\n    Negatable&lt;T&gt; inst = Negatable.&lt;T&gt;getInstance(t.getClass());\n    return inst.negate(inst.negate(t));\n  }\n</code></pre>\n</li>\n<li><p>Register actual instances for various classes:</p>\n<pre><code>Negatable.registerInstance(Boolean.class, new Negatable&lt;Boolean&gt;() {\n  public Boolean negate(Boolean b) {\n    return !b;\n  }\n});\n\nNegatable.registerInstance(Integer.class, new Negatable&lt;Integer&gt;() {\n  public Integer negate(Integer i) {\n    return -i;\n  }\n});\n</code></pre>\n</li>\n<li><p>Use it!</p>\n<pre><code>System.out.println(normalize(false)); // Boolean `false`\nSystem.out.println(normalize(42));    // Integer `42`\n</code></pre>\n</li>\n</ol>\n<p>The main drawback is that, as already mentioned, the typeclass instance lookup can fail at runtime, not at compile-time (as in Haskell). Using a static hash map is suboptimal too, because it brings all the problems of a shared global variable, this could be mitigated with more sophisticated dependency injection mechanisms. Automatically generating typeclass instances from other typeclass instances, would require even more infrastructure (could be done in a library). But in principle, it implements ad-hoc polymorphism using typeclasses in Java.</p>\n<p>Full code:</p>\n<pre><code>import java.util.HashMap;\n\nclass TypeclassInJava {\n  \n  static interface Negatable&lt;T&gt; {\n    T negate(T t);\n\n    static HashMap&lt;Class&lt;?&gt;, Negatable&lt;?&gt;&gt; instances = new HashMap&lt;&gt;();\n    static &lt;T&gt; void registerInstance(Class&lt;T&gt; clazz, Negatable&lt;T&gt; inst) {\n      instances.put(clazz, inst);\n    }\n    @SuppressWarnings(&quot;unchecked&quot;)\n    static &lt;T&gt; Negatable&lt;T&gt; getInstance(Class&lt;?&gt; clazz) {\n      return (Negatable&lt;T&gt;)instances.get(clazz);\n    }\n  }\n\n  public static &lt;T&gt; T normalize(T t) {\n    Negatable&lt;T&gt; inst = Negatable.&lt;T&gt;getInstance(t.getClass());\n    return inst.negate(inst.negate(t));\n  }\n\n  static {\n    Negatable.registerInstance(Boolean.class, new Negatable&lt;Boolean&gt;() {\n      public Boolean negate(Boolean b) {\n        return !b;\n      }\n    });\n  \n    Negatable.registerInstance(Integer.class, new Negatable&lt;Integer&gt;() {\n      public Integer negate(Integer i) {\n        return -i;\n      }\n    });\n  }\n\n  public static void main(String[] args) {\n    System.out.println(normalize(false));\n    System.out.println(normalize(42));\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 1094, "user_id": 5259805, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448bac0393b643e9a7e2f36cb3995ed0?s=128&d=identicon&r=PG&f=1", "display_name": "zale", "link": "https://stackoverflow.com/users/5259805/zale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3244, "favorite_count": 6, "accepted_answer_id": 51749646, "answer_count": 4, "score": 51, "last_activity_date": 1533780292, "creation_date": 1533698235, "last_edit_date": 1533764306, "question_id": 51738158, "link": "https://stackoverflow.com/questions/51738158/can-i-define-the-negatable-interface-in-java", "title": "Can I define the Negatable interface in Java?", "body": "<p>Asking this question to clarify my understanding of type classes and higher kinded types, I'm not looking for workarounds in Java.</p>\n\n<hr>\n\n<p>In Haskell, I could write something like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Negatable t where\n    negate :: t -&gt; t\n\nnormalize :: (Negatable t) =&gt; t -&gt; t\nnormalize x = negate (negate x)\n</code></pre>\n\n<p>Then assuming <code>Bool</code> has an instance of <code>Negatable</code>, </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>v :: Bool\nv = normalize True\n</code></pre>\n\n<p>And everything works fine.</p>\n\n<hr>\n\n<p>In Java, it does not seem possible to declare a proper <code>Negatable</code> interface. We could write:</p>\n\n<pre><code>interface Negatable {\n    Negatable negate();\n}\n\nNegatable normalize(Negatable a) {\n    a.negate().negate();\n}\n</code></pre>\n\n<p>But then, unlike in Haskell, the following would not compile without a cast (assume <code>MyBoolean</code> implements <code>Negatable</code>):</p>\n\n<pre><code>MyBoolean val = normalize(new MyBoolean()); // does not compile; val is a Negatable, not a MyBoolean\n</code></pre>\n\n<p><strong>Is there a way to refer to the implementing type in a Java interface, or is this a fundamental limitation of the Java type system?</strong> If it is a limitation, is it related to higher-kinded type support? I think not: it looks like this is another sort of limitation. If so, does it have a name?</p>\n\n<p>Thanks, and please let me know if the question is unclear!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1533697117, "post_id": 51736934, "comment_id": 90436405, "body": "Have you already <a href=\"https://stackoverflow.com/q/51680886/1126841\">asked this question</a>?"}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1533734051, "post_id": 51736934, "comment_id": 90455068, "body": "This question is a bit unclear. Could you give an example of how you would &quot;apply <code>f</code> to each element of <code>[a]</code> and <code>[b]</code> respectively&quot; in order to accomplish it?"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1533740595, "post_id": 51748450, "comment_id": 90459630, "body": "... or <code>zipWith</code>. :)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1533740987, "post_id": 51748450, "comment_id": 90459908, "body": "Well, sure, if you want to go the <i>really</i> easy route :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1533741100, "post_id": 51748450, "comment_id": 90459979, "body": "I do, yessir, always."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1533741421, "last_edit_date": 1533741421, "creation_date": 1533736294, "answer_id": 51748450, "question_id": 51736934, "link": "https://stackoverflow.com/questions/51736934/need-an-example-showing-how-to-apply-a-binary-function-to-all-pairs-of-elements/51748450#51748450", "title": "Need an example showing how to apply a binary function to all pairs of elements of two lists", "body": "<p>You never deconstruct the <code>b</code> list, so every time you call <code>map (f a)</code>, that's being applied to <em>each</em> value of <code>bs</code>. For example,</p>\n\n<pre><code>map2_List (+) [1,2,3] [10,11,12] == map (+ 1) [10,11,12] ++\n                                    map2_list (+) [2,3] [10,11,12]\n\n                                 == map (+ 1) [10,11,12] ++\n                                    map (+ 2) [10,11,12] ++\n                                    map2_List (+) [3] [10,11,12]\n\n                                 == map (+ 1) [10,11,12] ++\n                                    map (+ 2) [10,11,12] ++\n                                    map (+ 3) [10,11,12] ++\n                                    map2_List (+) [] [10,11,12]\n\n                                 == map (+ 1) [10,11,12] ++\n                                    map (+ 2) [10,11,12] ++\n                                    map (+ 3) [10,11,12] ++\n                                    []\n\n                                 == [11,12,13] ++\n                                    map (+ 2) [10,11,12] ++\n                                    map (+ 3) [10,11,12] ++\n                                    []\n\n                                 == [11,12,13] ++\n                                    [12,13,14] ++\n                                    map (+ 3) [10,11,12] ++\n                                    []\n\n                                 == [11,12,13] ++\n                                    [12,13,14] ++\n                                    [13,14,15] ++\n                                    []\n\n                                 == [11,12,13,12,13,14,13,14,15]\n</code></pre>\n\n<p>A much more compact definition would use the <code>Applicative</code> instance for lists:</p>\n\n<pre><code>map2_List f as bs = f &lt;$&gt; as &lt;*&gt; bs\n</code></pre>\n\n<hr>\n\n<p>The version you seem to be thinking of would deconstruct both lists in parallel:</p>\n\n<pre><code>map2_ZipList f [] [] = []\nmap2_ZipList f (a:as) (b:bs) = f a b : map2_ZipList as bs\n</code></pre>\n\n<p>which is already defined as <code>zipWith</code>:</p>\n\n<pre><code>map2_ZipList = zipWith\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1533806568, "last_edit_date": 1533806568, "creation_date": 1533740929, "answer_id": 51750051, "question_id": 51736934, "link": "https://stackoverflow.com/questions/51736934/need-an-example-showing-how-to-apply-a-binary-function-to-all-pairs-of-elements/51750051#51750051", "title": "Need an example showing how to apply a binary function to all pairs of elements of two lists", "body": "<p>It is unclear to you how this works:</p>\n\n<pre><code>map2_List :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nmap2_List f [] _ = []\nmap2_List f (a:as) bs = map (f a) bs ++ map2_List f as bs\n</code></pre>\n\n<p>Re-write it as a list comprehension, for clarity:</p>\n\n<pre><code>map2_List f as bs = concat [ map (f a) bs | a &lt;- as]\n                  = [ r | a &lt;- as, r &lt;- map (f a) bs]\n                  = [ r | a &lt;- as, r &lt;- [(f a) b | b &lt;- bs]]\n                  = [ r | a &lt;- as, r &lt;- [ f a  b | b &lt;- bs]]\n                  = [ r | a &lt;- as, b &lt;- bs, r &lt;- [f a b]]\n                  = [ f a b | a &lt;- as, b &lt;- bs]\n</code></pre>\n\n<p>and you can see that it is equivalent to the usual imperative nested loop,</p>\n\n<pre><code>for a in as :\n   for b in bs :\n       yield (f a b)\n</code></pre>\n\n<p>and is indeed applying the function <code>f</code> on each pair of <code>a</code> from <code>as</code> and <code>b</code> from <code>bs</code>, combined in the nested fashion.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 51748450, "answer_count": 2, "score": -4, "last_activity_date": 1533806568, "creation_date": 1533686386, "question_id": 51736934, "link": "https://stackoverflow.com/questions/51736934/need-an-example-showing-how-to-apply-a-binary-function-to-all-pairs-of-elements", "title": "Need an example showing how to apply a binary function to all pairs of elements of two lists", "body": "<pre><code>map2_List :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nmap2_List f [] _ = []\nmap2_List f (a:as) bs = map (f a) bs ++ map2_List f as bs\n</code></pre>\n\n<p>This is an example to apply a binary function to all pairs of elements of two lists. I feel confused why this apply every <code>(f a)</code> to <code>bs</code> instead of apply <code>f</code> to each element of <code>[a]</code> and <code>[b]</code> respectively.</p>\n\n<p>Could anyone give an example of how it works?</p>\n"}, {"tags": ["haskell", "generic-programming", "scrap-your-boilerplate"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1533682845, "post_id": 51736130, "comment_id": 90433692, "body": "A relevant package for this is generic-lens."}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1533681013, "post_id": 51736283, "comment_id": 90433244, "body": "I know impossibility arguments are fun, but my gut says <code>Generic</code> and <code>Typeable</code> could handle this without much trouble. (You would need the constraints of course, which are what let you escape from this argument)"}], "tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 0, "last_activity_date": 1533680860, "creation_date": 1533680860, "answer_id": 51736283, "question_id": 51736130, "link": "https://stackoverflow.com/questions/51736130/a-function-for-returning-part-of-a-product-or-record-depending-on-parameter-and/51736283#51736283", "title": "A function for returning part of a product or record depending on parameter and requested return type", "body": "<p>This cannot be done with under the Haskell 98 standard.  In general, a parametric function cannot change behavior based the concrete type that it becomes.  It must remain generic.</p>\n\n<p>As a thought process as to why this might be consider the case:</p>\n\n<pre><code>data MpProduct a = My Product Int Int String [a]\n</code></pre>\n\n<p>What should the <code>func</code> return asked for an Int?  What about when <code>a</code> is Char?</p>\n\n<p>Now, I'm not saying that some crack-shot of a programmer with a deep knowledge of GHC extensions could not make this happen, but it is not possible with the standard Hindley Milner typechecker.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 2, "last_activity_date": 1533682667, "last_edit_date": 1533682667, "creation_date": 1533682147, "answer_id": 51736441, "question_id": 51736130, "link": "https://stackoverflow.com/questions/51736130/a-function-for-returning-part-of-a-product-or-record-depending-on-parameter-and/51736441#51736441", "title": "A function for returning part of a product or record depending on parameter and requested return type", "body": "<p>Here's how to get a list of all compatible fields:</p>\n\n<pre><code>import Data.Data\nimport Data.Typeable\nimport Data.Maybe (maybeToList)\n\nfields :: (Data a, Typeable b) =&gt; a -&gt; [b]\nfields = gmapQr (++) [] (maybeToList . cast)\n</code></pre>\n\n<p>The product types you use should derive <code>Data</code>.  This can be done automatically with <code>{-# LANGUAGE DeriveDataTypeable #-}</code></p>\n\n<pre><code>data MyProduct = MyProduct String Int Bool\n    deriving (Typeable, Data)\n</code></pre>\n\n<p>See the docs for <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Data.html#v:gmapQr\" rel=\"nofollow noreferrer\"><code>gmapQr</code></a> and <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Typeable.html#v:cast\" rel=\"nofollow noreferrer\"><code>cast</code></a>.</p>\n\n<p>The only caveat is that I can't think of a way to give a <em>compile-time</em> error when you request a field that is not present, as you requested.  We would need some sort of compile-time version of <code>Data.Data</code>. I'm not aware of any such thing, though I suspect it is possible (it would probably be a bit more of a pain though\u2013\u2013that <code>deriving Data</code> is doing a lot of the heavy lifting for us!).</p>\n"}, {"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1533738053, "last_edit_date": 1533738053, "creation_date": 1533726699, "answer_id": 51745238, "question_id": 51736130, "link": "https://stackoverflow.com/questions/51736130/a-function-for-returning-part-of-a-product-or-record-depending-on-parameter-and/51745238#51745238", "title": "A function for returning part of a product or record depending on parameter and requested return type", "body": "<p>One solution is in <a href=\"https://hackage.haskell.org/package/generic-lens\" rel=\"nofollow noreferrer\">generic-lens</a>. In particular, <code>getTyped @T :: P -&gt; T</code> will access a field of type <code>T</code> in any product type <code>P</code> (that is an instance of <code>Generic</code>). Here's an example in GHCi  (for more details, see the README):</p>\n\n<pre><code>&gt; :set -XDeriveGeneric -XTypeApplications\n&gt; import Data.Generics.Product\n&gt; import GHC.Generics\n&gt; data MyProduct = MyProduct String Int Bool deriving Generic\n&gt; getTyped @Int (MyProduct \"Hello\" 33 True)\n33\n&gt; getTyped @Int (0 :: Int, \"hello\")\n0\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1533891206, "post_id": 51778157, "comment_id": 90522639, "body": "I didn&#39;t think of / know about working directly with the result of <code>Rep</code>. Great technique!"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 2, "last_activity_date": 1533868793, "creation_date": 1533868793, "answer_id": 51778157, "question_id": 51736130, "link": "https://stackoverflow.com/questions/51736130/a-function-for-returning-part-of-a-product-or-record-depending-on-parameter-and/51778157#51778157", "title": "A function for returning part of a product or record depending on parameter and requested return type", "body": "<p>As per @Li-yao_Xia's answer, it is possible to do this with <code>GHC.Generics</code> (which is what <code>generic-lens</code> uses behind the scenes).  The code in <code>generic-lens</code> is probably a little hard to follow, so here's how you can do it from scratch.</p>\n\n<p>The way <code>GHC.Generics</code> works, it represents a particular type, such as:</p>\n\n<pre><code>data MyProduct = MyProduct String Int Bool deriving (Generic)\n</code></pre>\n\n<p>by means of an isomorphic type <code>Rep MyProduct</code> that looks like this:</p>\n\n<pre><code>&gt; :kind! Rep MyProduct\nRep MyProduct :: * -&gt; *\n= D1\n    ('MetaData \"MyProduct\" \"GenericFetch3\" \"main\" 'False)\n    (C1\n       ('MetaCons \"MyProduct\" 'PrefixI 'False)\n       (S1\n          ('MetaSel\n             'Nothing 'NoSourceUnpackedness 'NoSourceStrictness 'DecidedLazy)\n          (Rec0 String)\n        :*: (S1\n               ('MetaSel\n                  'Nothing 'NoSourceUnpackedness 'NoSourceStrictness 'DecidedLazy)\n               (Rec0 Int)\n             :*: S1\n                   ('MetaSel\n                      'Nothing 'NoSourceUnpackedness 'NoSourceStrictness 'DecidedLazy)\n                   (Rec0 Bool))))\n</code></pre>\n\n<p>This is admittedly a little crazy, but most of this nested type consists of metadata wrappers represented by <code>D1</code>, <code>C1</code>, and <code>S1</code> types.  If you remove those wrappers, it boils down to:</p>\n\n<pre><code>Rep MyProduct = Rec0 String :*: Rec0 Int :*: Rec0 Bool\n</code></pre>\n\n<p>which helps show how the representation is structured.</p>\n\n<p>Anyway, to write a generic function, you create a typeclass that can process a <code>Rep a</code> using instances to handle metadata wrappers and the small set of type constructors used to represent products, sums, etc.</p>\n\n<p>In our case, we're going to define a typeclass <code>Fetch'</code> that lets us fetch the first value of type <code>b</code> out of a representation <code>t</code> (i.e., so <code>t</code> will be <code>Rep MyProduct</code> or something similar):</p>\n\n<pre><code>class Fetch' t b where\n  fetch' :: t p -&gt; Maybe b\n</code></pre>\n\n<p>For now, we're not going to require that <code>t</code> actually contain a <code>b</code>, which is why we allow <code>fetch'</code> to return <code>Nothing</code>.</p>\n\n<p>We'll need an instance to process metadata:</p>\n\n<pre><code>instance Fetch' t b =&gt; Fetch' (M1 i m t) b where\n  fetch' (M1 x) = fetch' x\n</code></pre>\n\n<p>Since all the metadata wrappers (<code>D1</code>, <code>S1</code>, and <code>C1</code>) are actually aliases (<code>M1 D</code>, <code>M1 S</code>, <code>M1 C</code> respectively), we can handle them all with an <code>M1</code> instance that passes the <code>fetch'</code> through the wrapper.</p>\n\n<p>We'll also need one to process products:</p>\n\n<pre><code>instance (Fetch' s b, Fetch' t b) =&gt; Fetch' (s :*: t) b where\n  fetch' (s :*: t) = fetch' s &lt;|&gt; fetch' t\n</code></pre>\n\n<p>This will just fetch the <code>b</code> out of the left-hand side of the product or -- failing that -- out of the right-hand side.</p>\n\n<p>And we'll need an instance to fetch a <code>b</code> out of a (top-level) field of the matching type (which matches the <code>Rec0</code> above, since that's just an alias for <code>K1 R</code>):</p>\n\n<pre><code>instance Fetch' (K1 i b) b where\n  fetch' (K1 x) = Just x\n</code></pre>\n\n<p>as well as an overlapped catch-all that will handle fields of the wrong type:</p>\n\n<pre><code>instance {-# OVERLAPPABLE #-} Fetch' (K1 i b) a where\n  fetch' (K1 _) = Nothing\n</code></pre>\n\n<p>We could also optionally handle the other possible type constructors in these representations (namely, <code>V1</code>, <code>U1</code>, and <code>:+:</code>) which I've done in the complete example below.</p>\n\n<p>Anyway, with those instances in place, we could write:</p>\n\n<pre><code>fetch1 :: (Generic t, Fetch' (Rep t) b) =&gt; t -&gt; b\nfetch1 = fromJust . fetch' . from\n</code></pre>\n\n<p>and this works fine:</p>\n\n<pre><code>&gt; fetch1 prod :: String\n\"yes\"\n&gt; fetch1 prod :: Int\n0\n&gt; fetch1 prod :: Bool\nFalse\n</code></pre>\n\n<p>but as with @luqui's answer based on <code>Data</code> generics, it doesn't catch bad fields at compile time but rather crashes at runtime:</p>\n\n<pre><code>&gt; fetch1 prod :: Double\n*** Exception: Maybe.fromJust: Nothing\n</code></pre>\n\n<p>To fix this, we can introduce a type family that calculates whether a data structure (or rather it's <code>Rep</code>) actually contains the needed field, like so:</p>\n\n<pre><code>type family Has t b where\n  Has (s :*: t) b = Or (Has s b) (Has t b)\n  Has (K1 i b) b = 'True\n  Has (K1 i a) b = 'False\n  Has (M1 i m t) b = Has t b\n</code></pre>\n\n<p>with the usual definition for the type family <code>Or</code>.  Now, we can add this as a constraint in the definition of <code>fetch</code>:</p>\n\n<pre><code>fetch :: ( Generic t\n         , Has (Rep t) b ~ 'True\n         , Fetch' (Rep t) b)\n      =&gt; t -&gt; b\nfetch = fromJust . fetch' . from\n</code></pre>\n\n<p>and now we get a compile time error for bad fields:</p>\n\n<pre><code>&gt; fetch prod :: String\n\"yes\"\n&gt; fetch prod :: Double\n\n&lt;interactive&gt;:83:1: error:\n    \u2022 Couldn't match type \u2018'False\u2019 with \u2018'True\u2019\n        arising from a use of \u2018fetch\u2019\n    \u2022 In the expression: fetch prod :: Double\n      In an equation for \u2018it\u2019: it = fetch prod :: Double\n&gt;\n</code></pre>\n\n<p>Anyway, putting the whole thing together, and adding instances and <code>Has</code> definitions for all the constructors, we get the following version.  Note that for sum types (i.e., <code>(:+:)</code>), it only allows field types that can be found in all terms in the sum (and so are guaranteed to be present).  Unlike the <code>typed</code> function in <code>generic-lens</code>, this version allows multiple fields of the target type in a product and just picks the first one.</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE TypeOperators #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE FlexibleContexts #-}\n\nmodule GenericFetch where\n\nimport Control.Applicative\nimport Data.Maybe\nimport GHC.Generics\n\ndata MyProduct = MyProduct String Int Bool deriving (Generic)\nprod :: MyProduct\nprod = MyProduct \"yes\" 0 False\n\ndata AnotherProduct = AP (Maybe Int) Char deriving (Generic)\nap :: AnotherProduct\nap = AP Nothing 'C'\n\ndata ASum = A Int String | B Int Double deriving (Generic)\nasum :: ASum\nasum = A 10 \"hello\"\n\nclass Fetch' t b where\n  fetch' :: t p -&gt; Maybe b\ninstance Fetch' V1 b where\n  fetch' _ = Nothing\ninstance Fetch' U1 b where\n  fetch' _ = Nothing\ninstance (Fetch' s b, Fetch' t b) =&gt; Fetch' (s :+: t) b where\n  fetch' (L1 s) = fetch' s\n  fetch' (R1 t) = fetch' t\ninstance (Fetch' s b, Fetch' t b) =&gt; Fetch' (s :*: t) b where\n  fetch' (s :*: t) = fetch' s &lt;|&gt; fetch' t\ninstance Fetch' (K1 i b) b where\n  fetch' (K1 x) = Just x\ninstance {-# OVERLAPPABLE #-} Fetch' (K1 i b) a where\n  fetch' (K1 _) = Nothing\ninstance Fetch' t b =&gt; Fetch' (M1 i m t) b where\n  fetch' (M1 x) = fetch' x\n\ntype family Has t b where\n  Has V1 b = 'False\n  Has U1 b = 'False\n  Has (s :+: t) b = And (Has s b) (Has t b)\n  Has (s :*: t) b = Or (Has s b) (Has t b)\n  Has (K1 i b) b = 'True\n  Has (K1 i a) b = 'False\n  Has (M1 i m t) b = Has t b\ntype family Or a b where\n  Or 'False 'False = 'False\n  Or a b = 'True\ntype family And a b where\n  And 'True 'True = 'True\n  And a b = 'False\n\nfetch :: ( Generic t\n         , Has (Rep t) b ~ 'True\n         , Fetch' (Rep t) b)\n      =&gt; t -&gt; b\nfetch = fromJust . fetch' . from\n</code></pre>\n\n<p>giving:</p>\n\n<pre><code>&gt; :l GenericFetch\n&gt; fetch prod :: Int\n0\n&gt; fetch prod :: Double\n...type error...\n&gt; fetch ap :: Maybe Int\nNothing\n&gt; fetch ap :: Int\n...type error...\n&gt; fetch asum :: Int\n10\n&gt; fetch asum :: String\n... type error: no string in `B` constructor...\n&gt; \n</code></pre>\n"}], "owner": {"reputation": 14853, "user_id": 380734, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a9d59056728e13c07fc6286b21eb9324?s=128&d=identicon&r=PG", "display_name": "Noel M", "link": "https://stackoverflow.com/users/380734/noel-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1533868793, "creation_date": 1533679934, "last_edit_date": 1533724832, "question_id": 51736130, "link": "https://stackoverflow.com/questions/51736130/a-function-for-returning-part-of-a-product-or-record-depending-on-parameter-and", "title": "A function for returning part of a product or record depending on parameter and requested return type", "body": "<p>I'm looking for a function, that, given the necessary return type, will return the part of a product parameter that matches that type, based purely on the structure of the type passed to the function.</p>\n\n<p>For example:</p>\n\n<pre><code>data MyProduct = MyProduct String Int Bool\n\nprod = MyProduct \"yes\" 0 False\n\nfunc prod :: Boolean -- would return False\nfunc prod :: String  -- would return \"yes\"\nfunc prod :: Double  -- compiler error\n</code></pre>\n\n<p>And similarly, for the same function <code>func</code>, but a different product:</p>\n\n<pre><code>data AnotherProduct = AP (Maybe Int) Char\n\nap = AP Nothing 'C'\n\nfunc ap :: Maybe Int -- would return Nothing\n</code></pre>\n\n<p>Does such a function exist? I feel this should be possible, perhaps using <code>Generic</code>. I know that this is possible in other languages, such as Scala with the Shapeless library, but I can't work out how best to approach this in Haskell.</p>\n"}, {"tags": ["haskell", "nix", "nixos"], "comments": [{"owner": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "edited": false, "score": 0, "creation_date": 1533676279, "post_id": 51734894, "comment_id": 90431700, "body": "Did you try with <code>system-ghc: true</code>? <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#system-ghc\" rel=\"nofollow noreferrer\"><code>false</code> is unsupported with Nix</a>"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 4232, "user_id": 428586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yHNYS.jpg?s=128&g=1", "display_name": "Robert Hensing", "link": "https://stackoverflow.com/users/428586/robert-hensing"}, "edited": false, "score": 0, "creation_date": 1533768581, "post_id": 51734894, "comment_id": 90472827, "body": "That did not seem to make any difference @RobertHensing"}], "answers": [{"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1534113909, "last_edit_date": 1534113909, "creation_date": 1533768717, "answer_id": 51756709, "question_id": 51734894, "link": "https://stackoverflow.com/questions/51734894/stack-build-nix-results-in-bin-bash-bad-interpreter-no-such-file-or-direc/51756709#51756709", "title": "`stack build --nix` results in /bin/bash: bad interpreter: No such file or directory", "body": "<pre><code>nix:\n    enable: true\n    packages:\n      - pkgconfig\n      - autoconf\n      - gcc\n      - xorg.libX11\n      - xorg.libXext\n      - xorg.libXft\n      - xorg.libXinerama\n      - xorg.libXpm\n      - xorg.libXrandr\n      - xorg.libXrender\n</code></pre>\n\n<p>The above worked for me. I think it's just the <code>autoconf</code> that is needed. Answering with the full list in case it's not.</p>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 248, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1534113909, "creation_date": 1533673628, "last_edit_date": 1533768571, "question_id": 51734894, "link": "https://stackoverflow.com/questions/51734894/stack-build-nix-results-in-bin-bash-bad-interpreter-no-such-file-or-direc", "title": "`stack build --nix` results in /bin/bash: bad interpreter: No such file or directory", "body": "<p>I've previous solved this issue, but I don't remember what I did... So thought I'd post it here to settle it.</p>\n\n<p>I'm trying to build a Haskell package with <code>stack build nix</code>, I'm following the answer from <a href=\"https://stackoverflow.com/a/47110522/1663462\">https://stackoverflow.com/a/47110522/1663462</a> but it runs into an error of: </p>\n\n<pre><code>Unpacking GHC into /home/chris/.stack/programs/x86_64-linuRunning /home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2.temp/ghc-8.0.2/configure --prefix=/home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2/ in directory /home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2.temp/ghc-8.0.2/ exited with ExitFailure 1                         \n\nchecking for path to top of build tree...                                  \n/home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2.temp/ghc-8.0.2/configure: utils/ghc-pwd/dist-install/build/tmp/ghc-pwd-bindist: /bin/bash: bad interpreter: No such file or directory       \nconfigure: error: cannot determine current directory    \n</code></pre>\n\n<p>How can I solve this? </p>\n\n<hr>\n\n<p><code>stack --nix setup</code> results in:</p>\n\n<pre><code>Preparing to install GHC to an isolated location.\nThis will not interfere with any system-level installation.\nAlready downloaded.                \nRunning /home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2.temp/ghc-8.0.2/configure --prefix=/home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2/ in directory /home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2.temp/ghc-8.0.2/ exited with ExitFailure 1\n\nchecking for path to top of build tree... \n/home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2.temp/ghc-8.0.2/configure: utils/ghc-pwd/dist-install/build/tmp/ghc-pwd-bindist: /bin/bash: bad interpreter: No such file or directory\nconfigure: error: cannot determine current directory\n\n\nError: Error encountered while configuring GHC with\n         /home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2.temp/ghc-8.0.2/configure --prefix=/home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2/\n         run in /home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2.temp/ghc-8.0.2/\n\n       The following directories may now contain files, but won't be used by stack:\n         - /home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2.temp/\n         - /home/chris/.stack/programs/x86_64-linux-nix/ghc-8.0.2/\n\nConfiguring GHC ...\n</code></pre>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1533672545, "post_id": 51734644, "comment_id": 90430089, "body": "That is because Haskell has interpreted it as <code>factorial - 4</code> (so a subtraction), you should use <code>factorial (-4)</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1533672610, "post_id": 51734644, "comment_id": 90430131, "body": "See: <a href=\"https://stackoverflow.com/q/20391391/67579\">stackoverflow.com/q/20391391/67579</a>"}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1533676702, "post_id": 51734644, "comment_id": 90431881, "body": "I don&#39;t really believe &quot;My code works fine without the last line&quot;. What makes you think that?"}], "answers": [{"comments": [{"owner": {"reputation": 1387, "user_id": 2561898, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/BZDcM.png?s=128&g=1", "display_name": "eightShirt", "link": "https://stackoverflow.com/users/2561898/eightshirt"}, "edited": false, "score": 1, "creation_date": 1533673364, "post_id": 51734717, "comment_id": 90430451, "body": "Ok! Thanks for your help. Here is fatorial (pt language...). ;)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 1387, "user_id": 2561898, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/BZDcM.png?s=128&g=1", "display_name": "eightShirt", "link": "https://stackoverflow.com/users/2561898/eightshirt"}, "edited": false, "score": 1, "creation_date": 1533673402, "post_id": 51734717, "comment_id": 90430465, "body": "@eightShirt: aah, I removed the note :)"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1533673391, "last_edit_date": 1533673391, "creation_date": 1533672852, "answer_id": 51734717, "question_id": 51734644, "link": "https://stackoverflow.com/questions/51734644/how-to-use-error-in-a-haskell-function/51734717#51734717", "title": "How to use error in a Haskell function?", "body": "<p>Well the error is a type error, so that means that Haskell thinks that what you wrote makes no sense (from a type system point of view).</p>\n\n<p>It interprets the <code>-</code> as the \"<em>binary minus operator</em>\", like:</p>\n\n<pre><code>--         v operator\nfactorial  -  4\n-- ^  operand ^ </code></pre>\n\n<p>So Haskell thinks you want to subtract <code>4</code> from <code>factorial</code>, but it does not see how <code>factorial</code> is a <code>Num</code>ber, hence the error. Strictly speaking, one <em>can</em> make functions <code>Num</code>bers, as long as one implements the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Num\" rel=\"noreferrer\"><strong><code>Num</code> typeclass</strong></a> (as well as the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Eq\" rel=\"noreferrer\"><strong><code>Eq</code></strong></a> and <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#t:Show\" rel=\"noreferrer\"><strong><code>Show</code></strong></a> typeclasses) we are fine.</p>\n\n<p>If you want to use negative number literals in such function call, you need to use brackets, like:</p>\n\n<pre><code>factorial <b>(-4)</b></code></pre>\n\n<p>This then produces:</p>\n\n<pre><code>Prelude&gt; fatorial (-4)\n*** Exception: My error\nCallStack (from HasCallStack):\n  error, called at &lt;interactive&gt;:5:19 in interactive:Ghci1\n</code></pre>\n\n<p>So now it raises your <code>error \"My error\"</code> (see the first output line).</p>\n"}], "owner": {"reputation": 1387, "user_id": 2561898, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/BZDcM.png?s=128&g=1", "display_name": "eightShirt", "link": "https://stackoverflow.com/users/2561898/eightshirt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "accepted_answer_id": 51734717, "answer_count": 1, "score": 2, "last_activity_date": 1533673391, "creation_date": 1533672475, "question_id": 51734644, "link": "https://stackoverflow.com/questions/51734644/how-to-use-error-in-a-haskell-function", "title": "How to use error in a Haskell function?", "body": "<p>I am using GHCI 7.10.3 and I'm getting error in a simple fatorial code.</p>\n\n<p>I would like to do something like this:</p>\n\n<pre><code>fatorial n\n    | n == 0  = 1\n    | n &gt; 0 = n * fatorial(n-1)\n    | otherwise = error \"My error\"\n</code></pre>\n\n<p>But when <code>fatorial -4</code> was called, the output was:</p>\n\n<blockquote>\n  <p>:21:1:\n      Non type-variable argument in the constraint: Num (a -> a)\n      (Use FlexibleContexts to permit this)\n      When checking that \u2018it\u2019 has the inferred type\n        it :: forall a. (Num a, Num (a -> a), Ord a) => a -> a</p>\n</blockquote>\n\n<p>My code works fine without the last line. So how can I use error message in haskell?</p>\n"}, {"tags": ["haskell", "io"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1533653150, "last_edit_date": 1533653150, "creation_date": 1533652750, "answer_id": 51729472, "question_id": 51729153, "link": "https://stackoverflow.com/questions/51729153/get-file-content-if-file-exists-or-default-string/51729472#51729472", "title": "get file content if file exists or default String", "body": "<p>We can solve the <em>compiler error</em> as follows. The problem is that <code>getFileContent</code> is an <code>IO String</code> whereas <code>\"\"</code> is just a <code>String</code>. We can use <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:return\" rel=\"nofollow noreferrer\"><strong><code>return :: Monad m =&gt; a -&gt; m a</code></strong></a> to wrap data into for example an <code>IO</code>.</p>\n\n<p>Then we still need to \"unwrap the data the <code>IO String</code> carries when we want to print it, so we can change the <code>main</code> to:</p>\n\n<pre><code>main = do\n    blacklistExists &lt;- doesFileExist \"./blacklist.txt\"\n    fileContent <b>&lt;-</b> if not blacklistExists\n            then <b>return</b> \"\"\n            else getFileContent \"./blacklist.txt\"\n    putStrLn fileContent</code></pre>\n\n<p>That being said the above is not very \"safe\". For example it could be possible that between checking the existance, and opening the file, somebody deletes the file. It is also possible that the file exists, but can not be read, etc.</p>\n\n<p>It is thus better to use an \"<strong>E</strong>asier to <strong>A</strong>sk <strong>F</strong>orgiveness than <strong>P</strong>ermission (EAFP)\" approach where we aim to open the file, and if something goes wrong, we return the empty string, like proposed by <a href=\"https://stackoverflow.com/a/51729478/67579\">@DanielWagner</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1533655843, "last_edit_date": 1533655843, "creation_date": 1533652771, "answer_id": 51729478, "question_id": 51729153, "link": "https://stackoverflow.com/questions/51729153/get-file-content-if-file-exists-or-default-string/51729478#51729478", "title": "get file content if file exists or default String", "body": "<p>Like this:</p>\n\n<pre><code>import Control.Exception\n\ngetFileContentOrElse :: String -&gt; FilePath -&gt; IO String\ngetFileContentOrElse def filePath = readFile filePath `catch`\n    \\e -&gt; const (return def) (e :: IOException)\n\nmain = getFileContentOrElse \"\" \"blacklist.txt\" &gt;&gt;= putStrLn\n</code></pre>\n\n<p>The <code>const _ (e :: IOException)</code> bit is just to be able to give <code>e</code> a type annotation, so that <code>catch</code> knows which <code>Exception</code> instance to use.</p>\n"}], "owner": {"reputation": 774, "user_id": 6034245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n3qwA.jpg?s=128&g=1", "display_name": "chrisheyn", "link": "https://stackoverflow.com/users/6034245/chrisheyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 0, "accepted_answer_id": 51729478, "answer_count": 2, "score": 1, "last_activity_date": 1533655843, "creation_date": 1533651879, "question_id": 51729153, "link": "https://stackoverflow.com/questions/51729153/get-file-content-if-file-exists-or-default-string", "title": "get file content if file exists or default String", "body": "<p>I check <code>doesFileExist filePath</code> but\nhow can i use <code>handle &lt;- openFile filePath ReadMode</code> only when the file exists</p>\n\n<p>Or how can i get a default string when file does not exist?</p>\n\n<pre><code>getFileContent filePath = do\n    handle &lt;- openFile filePath ReadMode\n    content &lt;- hGetContents handle\n    return content\n\nmain = do\n    blacklistExists &lt;- doesFileExist \"./blacklist.txt\"\n    let fileContent = if not blacklistExists\n            then \"\"\n            else getFileContent \"./blacklist.txt\"\n\n    putStrLn fileContent\n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "fold"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1533647227, "post_id": 51727040, "comment_id": 90415468, "body": "Almost, but use scanl instead of fold."}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1533715175, "post_id": 51727040, "comment_id": 90442874, "body": "If the sum goes above a threshold or if the outcome of your resource intensive function goes above a threshold?"}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "is_accepted": false, "score": 2, "last_activity_date": 1533647306, "last_edit_date": 1533647306, "creation_date": 1533646798, "answer_id": 51727463, "question_id": 51727040, "link": "https://stackoverflow.com/questions/51727040/how-to-break-out-from-a-fold-function-in-haskell-when-the-accumulator-met-a-cert/51727463#51727463", "title": "How to break out from a fold function in haskell when the accumulator met a certain condition?", "body": "<p>You <em>could</em> try making your own <code>sum</code> function, maybe call it <code>boundedSum</code> that takes</p>\n\n<ol>\n<li><p>an <code>Integer</code> upper bound</p></li>\n<li><p>an <code>[Integer]</code> to sum over</p></li>\n<li><p>a \"sum up until this point\" value to be compared with the upper bound</p></li>\n</ol>\n\n<p>and returns the sum of the list.</p>\n\n<pre><code>    boundedSum :: Integer -&gt; [Integer] -&gt; Integer -&gt; Integer\n    boundedSum upperBound (x : xs) prevSum =\n        let currentSum = prevSum + x\n            in\n        if   currentSum &gt; upperBound\n        then upperBound\n        else boundedSum upperBound xs currentSum\n    boundedSum upperBound [] prevSum =\n        prevSum\n</code></pre>\n\n<p>I think this way you won't \"eat up\" more of the list if the sum up until the current element exceeds upperBound.</p>\n\n<p><strong>EDIT</strong>: The answers to <a href=\"https://stackoverflow.com/questions/21238399/how-do-i-break-out-of-a-pure-loop-in-haskell-without-hand-written-recursion?rq=1\">this question</a> suggest better techniques than mine and the question itself looks rather similar to yours.</p>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1533650726, "post_id": 51727602, "comment_id": 90418117, "body": "Perhaps a case to take into consideration is that it is possible that the threshold is never reached, in which case <code>head</code> will error."}, {"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1607401282, "post_id": 51727602, "comment_id": 115254509, "body": "maybe i&#39;d use <code>find</code> instead of <code>head</code> and <code>dropWhile</code>: <code>find (&gt;= 1000) (scanl1 (+) [1..])</code>"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 14, "last_activity_date": 1533647290, "creation_date": 1533647290, "answer_id": 51727602, "question_id": 51727040, "link": "https://stackoverflow.com/questions/51727040/how-to-break-out-from-a-fold-function-in-haskell-when-the-accumulator-met-a-cert/51727602#51727602", "title": "How to break out from a fold function in haskell when the accumulator met a certain condition?", "body": "<p>One of the options would be using <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:scanl\" rel=\"noreferrer\">scanl</a> function, which returns a list of intermediate calculations of <code>foldl</code>.</p>\n\n<p>Thus, <code>scanl1 (+) (map someFunction myList)</code> will return the intermediate sums of your calculations. And since <code>Haskell</code> is a lazy language it won't calculate all the values of <code>myList</code> until you need it. For example:</p>\n\n<pre><code>take 5 $ scanl1 (+) (map someFunction myList)\n</code></pre>\n\n<p>will calculate <code>someFunction</code> 5 times and return the list of these 5 results.</p>\n\n<p>After that you can use either <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:takeWhile\" rel=\"noreferrer\">takeWhile</a> or <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:dropWhile\" rel=\"noreferrer\">dropWhile</a> and stop the calculation, when a certain condition is <code>True</code>. For example:</p>\n\n<pre><code>head $ dropWhile (&lt; 1000) $ scanl1 (+) [1..1000000000]\n</code></pre>\n\n<p>will stop the calculation, when sum of the numbers reaches 1000 and returns <code>1035</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1533647415, "creation_date": 1533647415, "answer_id": 51727650, "question_id": 51727040, "link": "https://stackoverflow.com/questions/51727040/how-to-break-out-from-a-fold-function-in-haskell-when-the-accumulator-met-a-cert/51727650#51727650", "title": "How to break out from a fold function in haskell when the accumulator met a certain condition?", "body": "<p>This is a possible solution:</p>\n\n<pre><code>last . takeWhile (&lt;=100) . scanl (+) 0 . map (^2) $ [1..]\n</code></pre>\n\n<p>Dissected:</p>\n\n<ul>\n<li>take your starting list (<code>[1..]</code> in the example)</li>\n<li>map your expensive function (<code>(^2)</code>)</li>\n<li>compute partial sums <code>scanl (+) 0</code></li>\n<li>stop after the partial sums become too large (keep those <code>(&lt;=100)</code>)</li>\n<li>take the last one</li>\n</ul>\n\n<p>If performance matters, also try <code>scanl'</code>, which might improve it.</p>\n"}, {"comments": [{"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 2, "creation_date": 1533658528, "post_id": 51727838, "comment_id": 90423275, "body": "This is cool, and seems like witchcraft, but applied to an infinite list it does hang. I think the trace shows that <code>a</code> just isn&#39;t forced, although the whole list is traversed."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1533663291, "post_id": 51727838, "comment_id": 90425639, "body": "Ah, right. I couldn&#39;t quite put my finger on why this seemed to work anyway."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1533720120, "post_id": 51727838, "comment_id": 90446008, "body": "I have been thinking that this lazyness trick is a canonical way to &quot;break out&quot; from folds."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1533663438, "last_edit_date": 1533663438, "creation_date": 1533647994, "answer_id": 51727838, "question_id": 51727040, "link": "https://stackoverflow.com/questions/51727040/how-to-break-out-from-a-fold-function-in-haskell-when-the-accumulator-met-a-cert/51727838#51727838", "title": "How to break out from a fold function in haskell when the accumulator met a certain condition?", "body": "<p>Use a bounded addition operator instead of <code>(+)</code> with <code>foldl</code>.</p>\n\n<pre><code>foldl (\\b a -&gt; b + if b &gt; someThreshold then 0 else a) 0 (map someFunction myList)\n</code></pre>\n\n<p>Because Haskell is non-strict, only calls to <code>someFunction</code> that are necessary to evaluate the <code>if-then-else</code> are themselves evaluated. <code>fold</code> still traverses the entire list.</p>\n\n<pre><code>&gt; foldl (\\b a -&gt; b + if b &gt; 10 then 0 else a) 0 (map (trace \"foo\") [1..20])\nfoo\nfoo\nfoo\nfoo\nfoo\n15\n</code></pre>\n\n<p><code>sum [1..5] &gt; 10</code>, and you can see that <code>trace \"foo\"</code> only executes 5 times, not 20.</p>\n\n<p>Instead of <code>foldl</code>, though, you should use the strict version <code>foldl'</code> from <code>Data.Foldable.</code></p>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 13, "last_activity_date": 1547217530, "last_edit_date": 1547217530, "creation_date": 1533649467, "answer_id": 51728336, "question_id": 51727040, "link": "https://stackoverflow.com/questions/51727040/how-to-break-out-from-a-fold-function-in-haskell-when-the-accumulator-met-a-cert/51728336#51728336", "title": "How to break out from a fold function in haskell when the accumulator met a certain condition?", "body": "<p>Another technique is to use a <code>foldM</code> with <code>Either</code> to capture the early termination effect. <code>Left</code> signals early termination.  </p>\n\n<pre><code>import Control.Monad(foldM)\n\nsumSome :: (Num n,Ord n) =&gt; n -&gt; [n] -&gt; Either n n\nsumSome thresh = foldM f 0\n  where\n    f a n \n      | a &gt;= thresh = Left a\n      | otherwise   = Right (a+n)\n</code></pre>\n\n<p>To ignore the exit condition, just compose with <code>either id id</code>.</p>\n\n<pre><code>sumSome' :: (Num n,Ord n) =&gt; n -&gt; [n] -&gt; n\nsumSome' n = either id id . sumSome n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1533650749, "creation_date": 1533650749, "answer_id": 51728752, "question_id": 51727040, "link": "https://stackoverflow.com/questions/51727040/how-to-break-out-from-a-fold-function-in-haskell-when-the-accumulator-met-a-cert/51728752#51728752", "title": "How to break out from a fold function in haskell when the accumulator met a certain condition?", "body": "<p>This will do what you ask about without building the intermediate list as <code>scanl'</code> would (and <code>scanl</code> would even cause a thunks build-up on top of that):</p>\n\n<pre><code>foldl'Breaking break reduced reducer acc list = \n    foldr cons (\\acc -&gt; acc) list acc \n          where \n          cons x r acc | break acc x = reduced acc x \n                       | otherwise   = r $! reducer acc x\n</code></pre>\n\n<p>cf. related <a href=\"https://wiki.haskell.org/Foldl_as_foldr_alternative\" rel=\"nofollow noreferrer\">wiki page</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "is_accepted": false, "score": 1, "last_activity_date": 1534592787, "last_edit_date": 1534592787, "creation_date": 1533712523, "answer_id": 51740646, "question_id": 51727040, "link": "https://stackoverflow.com/questions/51727040/how-to-break-out-from-a-fold-function-in-haskell-when-the-accumulator-met-a-cert/51740646#51740646", "title": "How to break out from a fold function in haskell when the accumulator met a certain condition?", "body": "<p>Something like this using <code>until :: (a -&gt; Bool) -&gt; (a -&gt; a) -&gt; a -&gt; a</code> from the Prelude</p>\n\n<pre><code>sumUntil :: Real a =&gt; a -&gt; [a] -&gt; a\nsumUntil threshold u = result\n\n    where\n\n    (_, result) = until stopCondition next (u, 0)\n\n    next :: Real a =&gt; ([a], a) -&gt; ([a], a)\n    next ((x:xs), y) = (xs, x + y)\n\n    stopCondition :: Real a =&gt; ([a], a) -&gt; Bool\n    stopCondition (ls, x) = null ls || x &gt; threshold\n</code></pre>\n\n<p>Then apply</p>\n\n<pre><code>sumUntil 10 (map someFunction myList)\n</code></pre>\n"}], "owner": {"reputation": 397, "user_id": 4503695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f359d78137a6658ae81e4594275e951e?s=128&d=identicon&r=PG&f=1", "display_name": "Bal&#225;zs S&#225;ros", "link": "https://stackoverflow.com/users/4503695/bal%c3%a1zs-s%c3%a1ros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3504, "favorite_count": 2, "accepted_answer_id": 51727602, "answer_count": 7, "score": 10, "last_activity_date": 1547217530, "creation_date": 1533645602, "question_id": 51727040, "link": "https://stackoverflow.com/questions/51727040/how-to-break-out-from-a-fold-function-in-haskell-when-the-accumulator-met-a-cert", "title": "How to break out from a fold function in haskell when the accumulator met a certain condition?", "body": "<p>I'm calculating the sum of a list after applying <code>someFunction</code> to every element of it like so:</p>\n\n<pre><code>sum (map someFunction myList)\n</code></pre>\n\n<p><code>someFunction</code> is very resource heavy so to optimise it I want to stop calculating the sum if it goes above a certain threshold.</p>\n\n<p>It seems like I need to use fold but I don't know how to break out if it if the accumulator reaches the threshold. My guess is to somehow compose <code>fold</code> and <code>takeWhile</code> but I'm not exactly sure how.</p>\n"}, {"tags": ["haskell", "haskell-stack", "haskell-platform", "duckling"], "comments": [{"owner": {"reputation": 3411, "user_id": 69663, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/aiMZN.png?s=128&g=1", "display_name": "unhammer", "link": "https://stackoverflow.com/users/69663/unhammer"}, "edited": false, "score": 0, "creation_date": 1534856351, "post_id": 51726563, "comment_id": 90848227, "body": "Can you build your binary on a different machine, and then just copy the binary over? I&#39;ve done this, building Windows binaries from virtualbox on Linux."}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 8839856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f620268c951601458f4e4813af19337?s=128&d=identicon&r=PG", "display_name": "atotalnoob", "link": "https://stackoverflow.com/users/8839856/atotalnoob"}, "edited": false, "score": 0, "creation_date": 1533685091, "post_id": 51726842, "comment_id": 90434197, "body": "So does same architecture refer to the same CPU architecture (like AVX) or same as in operating system?"}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "reply_to_user": {"reputation": 145, "user_id": 8839856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f620268c951601458f4e4813af19337?s=128&d=identicon&r=PG", "display_name": "atotalnoob", "link": "https://stackoverflow.com/users/8839856/atotalnoob"}, "edited": false, "score": 0, "creation_date": 1533729141, "post_id": 51726842, "comment_id": 90451679, "body": "Probably both. Otherwise you&#39;d have to start at bootstrapping the compiler. Might be more along the level of amd64 or x86 rather than specific extensions like AVX, though."}], "tags": [], "owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "is_accepted": true, "score": 7, "last_activity_date": 1533645539, "last_edit_date": 1533645539, "creation_date": 1533644948, "answer_id": 51726842, "question_id": 51726563, "link": "https://stackoverflow.com/questions/51726563/installing-and-running-a-haskell-package-offline/51726842#51726842", "title": "Installing and running a haskell package offline", "body": "<p>The first method that comes to mind is using a same architecture machine that does have internet access to fetch the toolchain and dependencies, before transferring those to the offline build machine. Something like using <code>stack build --prefetch --install-ghc --dry-run</code>, then copying the stack tool, stack root, compiler (listed by <code>stack path</code>) and your project. I suspect someone has made a better procedure for this. </p>\n\n<p>Some discussion: <a href=\"https://github.com/commercialhaskell/stack/issues/359\" rel=\"noreferrer\">https://github.com/commercialhaskell/stack/issues/359</a> <a href=\"https://groups.google.com/forum/#!topic/haskell-stack/LHG9DSrz8k8\" rel=\"noreferrer\">https://groups.google.com/forum/#!topic/haskell-stack/LHG9DSrz8k8</a></p>\n\n<p>Another option might be setting up your own mirror of the packages, and pointing stack to those using options like <a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/#latest-snapshot-url\" rel=\"noreferrer\"><code>latest-snapshot-url</code></a> and <code>package-indices</code>. <a href=\"https://github.com/ndmitchell/offline-stack\" rel=\"noreferrer\">offline-stack</a> appears to collect some steps of this. </p>\n"}], "owner": {"reputation": 145, "user_id": 8839856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f620268c951601458f4e4813af19337?s=128&d=identicon&r=PG", "display_name": "atotalnoob", "link": "https://stackoverflow.com/users/8839856/atotalnoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 570, "favorite_count": 0, "accepted_answer_id": 51726842, "answer_count": 1, "score": 1, "last_activity_date": 1533645539, "creation_date": 1533644112, "question_id": 51726563, "link": "https://stackoverflow.com/questions/51726563/installing-and-running-a-haskell-package-offline", "title": "Installing and running a haskell package offline", "body": "<p>I'm trying to run duckling (<a href=\"https://github.com/facebook/duckling\" rel=\"nofollow noreferrer\">https://github.com/facebook/duckling</a>) on a Windows server. </p>\n\n<p>Unfortunately, the server only has intranet access and no internet access. How do I set up Haskell to be able to build and run a package without internet access? </p>\n"}, {"tags": ["haskell", "emacs", "haskell-stack", "intero"], "answers": [{"tags": [], "owner": {"reputation": 638, "user_id": 143721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d76941c5297b5e53d90800513b5bda21?s=128&d=identicon&r=PG", "display_name": "calstad", "link": "https://stackoverflow.com/users/143721/calstad"}, "is_accepted": true, "score": 2, "last_activity_date": 1533743685, "creation_date": 1533743685, "answer_id": 51750937, "question_id": 51725510, "link": "https://stackoverflow.com/questions/51725510/running-emacs-intero-mode-with-stack-docker-integration/51750937#51750937", "title": "Running emacs intero-mode with stack docker integration", "body": "<p>I just came across this issue yesterday as well.  It looks like the issue is in the function <a href=\"https://github.com/commercialhaskell/intero/blob/0eec1536a0b051d1628895205c273d498385c7a7/elisp/intero.el#L2214\" rel=\"nofollow noreferrer\">intero-copy-compiler-tool-auto-install</a>\nwhich does not take into account your <code>stack.yaml</code> file and so does not build <code>intero</code> into the docker container.  A super hacky work around I found is to run </p>\n\n<pre><code>stack --docker build --copy-compiler-tool intero\n</code></pre>\n\n<p>from within your project.</p>\n"}], "owner": {"reputation": 1242, "user_id": 3252252, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/4V81y.jpg?s=128&g=1", "display_name": "Jesuspc", "link": "https://stackoverflow.com/users/3252252/jesuspc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 2, "accepted_answer_id": 51750937, "answer_count": 1, "score": 4, "last_activity_date": 1533787410, "creation_date": 1533640745, "last_edit_date": 1533787410, "question_id": 51725510, "link": "https://stackoverflow.com/questions/51725510/running-emacs-intero-mode-with-stack-docker-integration", "title": "Running emacs intero-mode with stack docker integration", "body": "<p>I'm trying to use intero-mode in a stack project that has the docker integration enabled. Therefore its stack.yml contains:</p>\n\n<pre><code>docker:\n  enable: true\n  image: my-project/build:lts-11.9\n</code></pre>\n\n<p>Even though, when I open any .hs file in the project, intero-mode tries to install the intero executable and fails. In the <em>Messages</em> buffer it reports:</p>\n\n<pre><code>Installed successfully! Starting Intero in a moment ...\nBooting up intero ...\nProblem with Intero!\nReading Haskell configuration failed with exit code 1 and output:\nget-cabal-configuration.hs: /home/jesuspc/.nix-profile/bin/hpack: createProcess: runInteractiveProcess: exec: does not exist (No such file or directory)\n</code></pre>\n\n<p>And I get the error screen for intero-mode:</p>\n\n<pre><code>...\nThe process ended. Here is the reason that Emacs gives us:\n\nexited abnormally with code 1\n\nFor troubleshooting purposes, here are the arguments used to launch intero:\n\nstack ghci --with-ghc /home/jesuspc/.stack/compiler-tools/x86_64-linux-dke094d5208e8a802cb369cecdad3049ae/ghc-8.2.2/bin/intero \"--docker-run-args=--interactive=true --tty=false\" --no-build --no-load --ghci-options -ignore-dot-ghci my-project\n...\n</code></pre>\n\n<p>When I run that line I get:</p>\n\n<pre><code>Did not find executable at specified path: /home/jesuspc/.stack/compiler-tools/x86_64-linux-dke094d5208e8a802cb369cecdad3049ae/ghc-8.2.2/bin/intero\n</code></pre>\n\n<p>Which may be something related to nix, because I found that by running instead:</p>\n\n<pre><code>stack ghci --with-ghc /home/jesuspc/.stack/compiler-tools/x86_64-linux-nix/ghc-8.2.2/bin/intero \"--docker-run-args=--interactive=true --tty=false\" --no-build --no-load --ghci-options -ignore-dot-ghci my-project\n</code></pre>\n\n<p>I get a different error:</p>\n\n<pre><code>/home/jesuspc/.stack/compiler-tools/x86_64-linux-nix/ghc-8.2.2/bin/intero: createProcess: runInteractiveProcess: exec: does not exist (No such file or directory)\n</code></pre>\n\n<p>I believe that this error may be thrown because my project uses external libraries and it can not find them, but that's just a guess. </p>\n\n<p>Is intero-mode even aware of the stack-docker integration? It seems to be trying to use the intero executable in my local machine instead of using the docker context, where all the required libraries are present. How can I fix it? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 6190, "user_id": 3523446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/268d77718b0875284cdfff02b4ec54b5?s=128&d=identicon&r=PG&f=1", "display_name": "qxg", "link": "https://stackoverflow.com/users/3523446/qxg"}, "edited": false, "score": 3, "creation_date": 1533613585, "post_id": 51718388, "comment_id": 90397881, "body": "Check writer monad at <a href=\"http://learnyouahaskell.com/for-a-few-monads-more#writer\" rel=\"nofollow noreferrer\">learnyouahaskell.com/for-a-few-monads-more#writer</a>"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1533642977, "post_id": 51718388, "comment_id": 90412600, "body": "this sounds a bit like you&#39;re looking for <code>for-loops</code> in haskell - could you explain what you need the recursion for?"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1533635981, "post_id": 51718496, "comment_id": 90408222, "body": "The tuple here is a bit odd, rather than simply taking 2 arguments."}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1533674674, "post_id": 51718496, "comment_id": 90431057, "body": "amolloy, yes in looking at it, I think you&#39;re right.  I had Writer Monad in mind when I was writing this, but decided that was more information than was needed and never took the tuple back out."}], "tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": false, "score": 7, "last_activity_date": 1533674855, "last_edit_date": 1533674855, "creation_date": 1533613232, "answer_id": 51718496, "question_id": 51718388, "link": "https://stackoverflow.com/questions/51718388/haskell-recursion-loop-counter/51718496#51718496", "title": "Haskell recursion loop counter", "body": "<p>Yes, there is but...</p>\n\n<p>Stopping recursion is normally done when some final state is achieved, something like \"I've run out of data to process\" or \"I have reached the base case.\"  When I see something as arbitrary as \"after 2 times\" I want to ask where you came up with 2.</p>\n\n<p>However in the interest of answering the question asked:</p>\n\n<p>You need to pass in a counter to the recursive function and bail out when you have done the required number of cycles. For cases like this where the number of cycles is not a matter external to the function, it is typically the case that one creates an auxilary function to introduce it.</p>\n\n<pre><code>myFunction :: Value -&gt; Value\nmyFunction init = recurse 2 init\n where\n   recurse :: Int -&gt; Value -&gt; Value\n   recurse 0 result = result\n   recurse n intermediate = recurse (n-1) (someFun intermediate)\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 8026603, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10213229531438724/picture?type=large", "display_name": "Alviss Min", "link": "https://stackoverflow.com/users/8026603/alviss-min"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1533674855, "creation_date": 1533612322, "question_id": 51718388, "link": "https://stackoverflow.com/questions/51718388/haskell-recursion-loop-counter", "title": "Haskell recursion loop counter", "body": "<p>Is there anyway I could check the number of recursion the program is at. For example, I want to stop the recursion after 2 times. Is there anyway to do that in haskell.</p>\n"}, {"tags": ["haskell", "process", "pipe"], "answers": [{"comments": [{"owner": {"reputation": 1173, "user_id": 2488240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01472f9a7eaf6e28276c535137c757a9?s=128&d=identicon&r=PG", "display_name": "sam46", "link": "https://stackoverflow.com/users/2488240/sam46"}, "edited": false, "score": 0, "creation_date": 1533611066, "post_id": 51718096, "comment_id": 90397364, "body": "Can you please show me how to print stderr produced from the process?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1173, "user_id": 2488240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01472f9a7eaf6e28276c535137c757a9?s=128&d=identicon&r=PG", "display_name": "sam46", "link": "https://stackoverflow.com/users/2488240/sam46"}, "edited": false, "score": 4, "creation_date": 1533611495, "post_id": 51718096, "comment_id": 90397441, "body": "Use <code>readCreateProcessWithExitCode</code> to capture both the return value and stderr."}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 4, "last_activity_date": 1533609927, "creation_date": 1533609927, "answer_id": 51718096, "question_id": 51718008, "link": "https://stackoverflow.com/questions/51718008/pipe-string-to-shell-command-in-haskell/51718096#51718096", "title": "Pipe string to shell command in Haskell", "body": "<p>You are looking for <code>System.Process</code> and you can use the <code>shell</code> function to create a description of a process then use <code>readCreateProcess</code> to run the shell command, provide stdin and read stdout.</p>\n\n<pre><code>import System.Process\nmain :: IO ()\nmain =\n  do result &lt;- readCreateProcess (shell \"ls\") myHaskellString\n     putStrLn result\n\nmyHaskellString :: String\nmyHaskellString = \"string\"\n</code></pre>\n"}], "owner": {"reputation": 1173, "user_id": 2488240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01472f9a7eaf6e28276c535137c757a9?s=128&d=identicon&r=PG", "display_name": "sam46", "link": "https://stackoverflow.com/users/2488240/sam46"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 51718096, "answer_count": 1, "score": 2, "last_activity_date": 1533611108, "creation_date": 1533609164, "last_edit_date": 1533611108, "question_id": 51718008, "link": "https://stackoverflow.com/questions/51718008/pipe-string-to-shell-command-in-haskell", "title": "Pipe string to shell command in Haskell", "body": "<p>How do I feed a string to shell command and \nget the output it produces in Haskell?</p>\n\n<p>For example, given this:</p>\n\n<pre><code>&gt; myHaskellProg \n  \"blah\"\n\n&gt; myHaskellProg | wc\n  4\n</code></pre>\n\n<p>I want </p>\n\n<pre><code>&gt; myHaskellProg\n</code></pre>\n\n<p>to print <code>4</code> by calling <code>wc</code> and printing out the result</p>\n\n<p>I was able to call shell commands using <code>process</code>'s <code>callCommand</code> \nbut how do I pipe a string to it and get back the result or stderr?  </p>\n"}, {"tags": ["haskell", "cabal", "ghc-pkg"], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1533576666, "creation_date": 1533576666, "answer_id": 51712857, "question_id": 51712727, "link": "https://stackoverflow.com/questions/51712727/how-to-list-files-installed-by-a-haskell-cabal-package/51712857#51712857", "title": "How to list files installed by a Haskell cabal package?", "body": "<p>You can use <code>ghc-pkg describe &lt;pkgname&gt;</code> to get a collection of directories under which the package's files have been installed. There are only a few things affected by a package installation that won't be mentioned by this:</p>\n\n<ol>\n<li>The GHC package database itself is modified. <code>ghc-pkg list</code> will show you the locations of the two standard databases.</li>\n<li>Executables installed by the package aren't known to GHC. You can use <code>cabal info &lt;pkgname&gt;</code> to get a list of executables.</li>\n<li>Your build tool (i.e. cabal-install or stack) likely keeps a cache of package metadata and sources; these are not really \"installed\" in any meaningful sense -- deleting them won't break anything -- but they are bits of the filesystem modified by the installation process. For cabal-install this cache defaults to <code>~/.cabal/packages</code>; I don't know enough about stack to answer about that tool well.</li>\n</ol>\n"}], "owner": {"reputation": 5900, "user_id": 2257411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a7dbdeb16e2a97e803ca2a593aa398b?s=128&d=identicon&r=PG", "display_name": "Rudy Matela", "link": "https://stackoverflow.com/users/2257411/rudy-matela"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533576666, "creation_date": 1533576102, "last_edit_date": 1592644375, "question_id": 51712727, "link": "https://stackoverflow.com/questions/51712727/how-to-list-files-installed-by-a-haskell-cabal-package", "title": "How to list files installed by a Haskell cabal package?", "body": "<p>Is there a way to list files installed by a <a href=\"https://www.haskell.org/\" rel=\"nofollow noreferrer\">Haskell</a>  <a href=\"https://www.haskell.org/cabal/\" rel=\"nofollow noreferrer\">cabal</a> package?\nIn other words: is there a way to list files associated with a Haskell package?</p>\n<p>For example, in <a href=\"https://www.debian.org/\" rel=\"nofollow noreferrer\">Debian</a> based systems, including <a href=\"https://www.ubuntu.com/\" rel=\"nofollow noreferrer\">Ubuntu</a>, one can use <code>dpkg -l</code> to list all packages, and <code>dpkg -L package_name</code> to <em>list files associated with a given package</em>:</p>\n<pre><code>$ dpkg -L gzip\n/.\n/bin\n/bin/gunzip\n/bin/gzexe\n/bin/gzip\n/bin/uncompress\n/bin/zcat\n/bin/zcmp\n/bin/zdiff\n/bin/zegrep\n/bin/zfgrep\n/bin/zforce\n/bin/zgrep\n/bin/zless\n/bin/zmore\n/bin/znew\n/usr\n/usr/share\n...\n</code></pre>\n<p>On <a href=\"https://www.archlinux.org/\" rel=\"nofollow noreferrer\">Arch Linux</a>, the same is achieved by <code>pacman -Ql package_name</code>:</p>\n<pre><code>$ pacman -Ql gzip\ngzip /usr/\ngzip /usr/bin/\ngzip /usr/bin/gunzip\ngzip /usr/bin/gzexe\ngzip /usr/bin/gzip\ngzip /usr/bin/uncompress\ngzip /usr/bin/zcat\ngzip /usr/bin/zcmp\ngzip /usr/bin/zdiff\ngzip /usr/bin/zegrep\ngzip /usr/bin/zfgrep\ngzip /usr/bin/zforce\ngzip /usr/bin/zgrep\ngzip /usr/bin/zless\ngzip /usr/bin/zmore\ngzip /usr/bin/znew\ngzip /usr/share/\n...\n</code></pre>\n<p>Finally, using <a href=\"https://pip.pypa.io/en/stable/installing/\" rel=\"nofollow noreferrer\">Python's PIP</a>, one can use <code>pip show -f package_name</code> to show files associated with package <code>package_name</code>. <a href=\"https://serverfault.com/questions/153843/how-do-i-list-the-files-associated-with-a-python-package-installed-using-pip-or\">1</a></p>\n<p>Is there a way to do the above for packages installed through <code>cabal</code> using either <code>cabal</code> or <code>ghc-pkg</code>?  I know I can list packages using <code>ghc-pkg list</code> or <code>cabal list --installed</code>, but not how to list the files associated with specific packages.</p>\n"}, {"tags": ["haskell", "filepath", "file-extension"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1533585732, "post_id": 51712083, "comment_id": 90391045, "body": "The documentation for <a href=\"https://hackage.haskell.org/package/filemanip-0.3.6.3/docs/System-FilePath-GlobPattern.html#t:GlobPattern\" rel=\"nofollow noreferrer\"><code>GlobPattern</code></a> doesn&#39;t mention supporting <code>?</code>; perhaps that is part of the problem."}, {"owner": {"reputation": 373, "user_id": 5558137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P6jqW.jpg?s=128&g=1", "display_name": "diagprov", "link": "https://stackoverflow.com/users/5558137/diagprov"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1533589848, "post_id": 51712083, "comment_id": 90392714, "body": "@DanielWagner thanks OK I&#39;ll try this. The answer I have looks pretty good as well, I&#39;ll try that tomorrow also."}], "answers": [{"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 6, "last_activity_date": 1533588139, "last_edit_date": 1533588139, "creation_date": 1533578875, "answer_id": 51713361, "question_id": 51712083, "link": "https://stackoverflow.com/questions/51712083/recursively-search-directories-for-all-files-matching-name-criteria-in-haskell/51713361#51713361", "title": "Recursively search directories for all files matching name criteria in Haskell", "body": "<blockquote>\n  <p>so, we're nearly at 10 ways to do it...</p>\n</blockquote>\n\n<p>Here's yet another way to do it, using functions from the <a href=\"http://hackage.haskell.org/package/directory-1.3.3.1/docs/System-Directory.html\" rel=\"nofollow noreferrer\">directory</a>, <a href=\"http://hackage.haskell.org/package/filepath\" rel=\"nofollow noreferrer\">filepath</a> and <a href=\"http://hackage.haskell.org/package/extra-1.6.9/docs/Control-Monad-Extra.html#v:partitionM\" rel=\"nofollow noreferrer\">extra</a> packages, but not too much monad wizardry:</p>\n\n<pre><code>import Control.Monad (foldM)\nimport System.Directory (doesDirectoryExist, listDirectory) -- from \"directory\"\nimport System.FilePath ((&lt;/&gt;), FilePath) -- from \"filepath\"\nimport Control.Monad.Extra (partitionM) -- from the \"extra\" package\n\ntraverseDir :: (FilePath -&gt; Bool) -&gt; (b -&gt; FilePath -&gt; IO b) -&gt; b -&gt; FilePath -&gt; IO b\ntraverseDir validDir transition =\n    let go state dirPath =\n            do names &lt;- listDirectory dirPath\n               let paths = map (dirPath &lt;/&gt;) names\n               (dirPaths, filePaths) &lt;- partitionM doesDirectoryExist paths\n               state' &lt;- foldM transition state filePaths -- process current dir\n               foldM go state' (filter validDir dirPaths) -- process subdirs\n     in go\n</code></pre>\n\n<p>The idea is that the user passes a <code>FilePath -&gt; Bool</code> function to filter unwanted directories; also an initial state <code>b</code> and a transition function <code>b -&gt; FilePath -&gt; IO b</code> that processes file names, updates the <code>b</code> state and possibly has some side effects. Notice that the type of the state is chosen by the caller, who might put useful things there.</p>\n\n<p>If we only want to print file names as they are produced, we can do something like this:</p>\n\n<pre><code>traverseDir (\\_ -&gt; True) (\\() path -&gt; print path) () \"/tmp/somedir\"\n</code></pre>\n\n<p>We are using <code>()</code> as a dummy state because we don't really need it here.</p>\n\n<p>If we want to accumulate the files into a list, we can do it like this:</p>\n\n<pre><code>traverseDir (\\_ -&gt; True) (\\fs f -&gt; pure (f : fs)) [] \"/tmp/somedir\" \n</code></pre>\n\n<p>And what if we want to filter some files? We would need to tweak the transition function we pass to <code>traverseDir</code> so that it ignores them.</p>\n"}, {"tags": [], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "is_accepted": false, "score": 2, "last_activity_date": 1533726514, "creation_date": 1533726514, "answer_id": 51745172, "question_id": 51712083, "link": "https://stackoverflow.com/questions/51712083/recursively-search-directories-for-all-files-matching-name-criteria-in-haskell/51745172#51745172", "title": "Recursively search directories for all files matching name criteria in Haskell", "body": "<p>I tested you code on my machine, and it seems to work fine. Here is some example data:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ find test/data\ntest/data\ntest/data/look-a-md-file.md\ntest/data/another-dir\ntest/data/another-dir/shown.md\ntest/data/.not-shown.md\ntest/data/also-not-shown.md.bkp\ntest/data/.hidden\ntest/data/some-dir\ntest/data/some-dir/shown.md\ntest/data/some-dir/.ahother-hidden\ntest/data/some-dir/.ahother-hidden/im-hidden.md\n</code></pre>\n\n<p>Running your function will result in:</p>\n\n<pre><code>ghci&gt; findMarkdownSources \"test\"\n[\"test/data/another-dir/shown.md\",\"test/data/look-a-md-file.md\",\"test/data/some-dir/shown.md\"]\n</code></pre>\n\n<p>I've tested this with an absolute path, and it also works. Are you sure you have passed a valid path? You'll get an empty list if that is the case (although you also get a warning).</p>\n\n<p>Note that your code could be simplified as follows:</p>\n\n<pre><code>module Traversals.FileManip where\n\nimport           Data.List            (isPrefixOf)\nimport           System.FilePath.Find (always, extension, fileName, find, (&amp;&amp;?),\n                                       (/~?), (==?))\n\nfindMdSources :: FilePath -&gt; IO [FilePath]\nfindMdSources fp = find isVisible (isMdFile &amp;&amp;? isVisible) fp\n    where\n      isMdFile = extension ==? \".md\"\n      isVisible = fileName /~? \".?*\"\n</code></pre>\n\n<p>And you can even remove the <code>fp</code> parameter, but I'm leaving it here for the sake of clarity.</p>\n\n<p>I prefer to import explicitly so that I know where each function comes from (since I don't know of any Haskell IDE with advanced symbol navigation).</p>\n\n<p>However, note that this solution uses uses unsafe interleave IO, which <a href=\"http://www.scs.stanford.edu/16wi-cs240h/slides/iteratee-slides.html#(11)\" rel=\"nofollow noreferrer\">is not recommended</a>.</p>\n\n<p>So regarding your questions 2 and 3, I would recommend a streaming solution, like <a href=\"https://www.stackage.org/haddock/lts-12.5/pipes-4.3.9/Pipes-Tutorial.html\" rel=\"nofollow noreferrer\">pipes</a> or conduits. Sticking to these kind of solutions will reduce your options (just like sticking to pure functional programming languages reduced my options for programming languages ;)). <a href=\"https://github.com/rubik/argon/blob/master/src/Argon/Walker.hs\" rel=\"nofollow noreferrer\">Here</a> you have an example on how pipes can be used to walk a directory.</p>\n\n<p><a href=\"https://github.com/dnadales/sandbox/tree/e74261c05eef5ce904acd241412691a2d8d59fef/file-traversals\" rel=\"nofollow noreferrer\">Here</a> is the code in case you want to try this out.</p>\n"}], "owner": {"reputation": 373, "user_id": 5558137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P6jqW.jpg?s=128&g=1", "display_name": "diagprov", "link": "https://stackoverflow.com/users/5558137/diagprov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1410, "favorite_count": 1, "accepted_answer_id": 51713361, "answer_count": 2, "score": 6, "last_activity_date": 1533726514, "creation_date": 1533573235, "question_id": 51712083, "link": "https://stackoverflow.com/questions/51712083/recursively-search-directories-for-all-files-matching-name-criteria-in-haskell", "title": "Recursively search directories for all files matching name criteria in Haskell", "body": "<p>I'm relatively inexperienced in Haskell and I wanted to improve, so for a learning project of mine I have the following requirements:</p>\n\n<ul>\n<li>I want to search starting from a specified top directory, not necessarily an absolute path.</li>\n<li>I want to find all files of a given extension, say <code>.md</code>.</li>\n<li>I want to not search hidden directories, say <code>toplevel/.excluded</code>.</li>\n<li>I want to be able to ignore hidden files like gedit produces <code>.filename.md.swp</code>.</li>\n<li>I want to end up with a complete list of files as the result of my function.</li>\n</ul>\n\n<p>I searched all over SO. Here's what I have so far:</p>\n\n<pre><code>import qualified System.FilePath.Find as SFF\nimport qualified Filesystem.Path.CurrentOS as FP\n\nsrcFolderName = \"src\"\noutFolderName = \"output\"\nresFolderName = \"res\"\n\nffNotHidden :: SFF.FindClause Bool\nffNotHidden = SFF.fileName SFF./~? \".?*\"\n\nffIsMD :: SFF.FindClause Bool\nffIsMD = SFF.extension SFF.==? \".md\" SFF.&amp;&amp;? SFF.fileName SFF./~? \".?*\"\n\nfindMarkdownSources :: FilePath -&gt; IO [FilePath]\nfindMarkdownSources filePath = do\n    paths &lt;- SFF.find ffNotHidden ffIsMD filePath\n    return paths\n</code></pre>\n\n<p>This doesn't work. printf-style debugging in \"findMarkdownSources\", I can verify that filePath is correct e.g. <code>\"/home/user/testdata\"</code> (print includes the \", in case that tells you something). The list <code>paths</code> is always empty. I'm absolutely certain there are markdown files in the directory I have specified (find /path/to/dir -name \"*.md\" finds them).</p>\n\n<p>I therefore have some specific questions.</p>\n\n<ol>\n<li>Is there a reason (filters incorrect) for example, why this code should not work?</li>\n<li><p>There are a number of ways to do this in haskell. It seems there are at least six packages (fileman, system.directory, system.filepath.find) dedicated to this. Here's some questions where something like this is answered:</p>\n\n<ol>\n<li><a href=\"https://stackoverflow.com/questions/14259229/streaming-recursive-descent-of-a-directory-in-haskell\">Streaming recursive descent of a directory in Haskell</a></li>\n<li><a href=\"https://stackoverflow.com/questions/13297896/is-there-some-directory-walker-in-haskell\">Is there some directory walker in Haskell?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/31993452/avoid-recursion-into-specifc-folder-using-filemanip\">avoid recursion into specifc folder using filemanip</a></li>\n</ol>\n\n<p>Each one has about three unique ways to achieve what I want to achieve, so, we're nearly at 10 ways to do it...</p></li>\n<li>Is there a specific way I should be doing this? If so why? If it helps, once I have my file list, I'm going to walk the entire thing, open and parse each file.</li>\n</ol>\n\n<p>If it helps, I'm reasonably comfortable with basic haskell, but you'll need to slow down if we start getting too heavy with monads and applicative functors (I don't use haskell enough for this to stay in my head). I find the haskell docs on hackage incomprehensible, though.</p>\n"}, {"tags": ["macos", "haskell", "cabal-install", "hackage"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1533566502, "post_id": 51710005, "comment_id": 90381500, "body": "Always show what exactly you tried and full error messages, else we can&#39;t diagnose the problem. Also relevant here would be the outputs of <code>ghc --version</code>, <code>cabal info base</code>, and <code>cabal --version</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1533566730, "post_id": 51710005, "comment_id": 90381655, "body": "Iss this the only error message you get? Did you first run <code>cabal update</code> to synchronize the list of packages?"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1533568693, "post_id": 51710005, "comment_id": 90382940, "body": "Edited original posts with the results of local stack build and cabal install. Both fail. Not only for aeson though, also for conduit, html-conduit etc."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1533569215, "post_id": 51710005, "comment_id": 90383300, "body": "What does <code>ghc-pkg check</code> say?"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1533569757, "post_id": 51710005, "comment_id": 90383616, "body": "@DanielWagner Cache outdated. ghc-pkg recache still mentioned cache being outdated. Checking for packages obviously does not show aeson, conduit and html-conduit."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1533571884, "post_id": 51710005, "comment_id": 90384720, "body": "Hm. I would suggest just nuking the entire <code>~&#47;.ghc&#47;x86_64-osx-ghc-8.4.3&#47;package.conf.d</code> and <code>~&#47;.cabal</code> folders..."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1533577384, "post_id": 51710005, "comment_id": 90387402, "body": "@leftaroundabout: I nuked ghc, cabal, stack, and haskell folder, so the complete haskell-platform. To no avail after reinstalling. Quite annoying. Make better progress with learning Haskell than figuring out why cabal is giving me all this."}], "answers": [{"comments": [{"owner": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1534222195, "post_id": 51719581, "comment_id": 90621615, "body": "The &quot;right&quot; way to uninstall the platform that should clean things out properly is to use the <code>uninstall-hs</code> command line tool installed by the platform, which knows all the things that need to be cleaned."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 37486, "user_id": 371753, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/znFEK.jpg?s=128&g=1", "display_name": "sclv", "link": "https://stackoverflow.com/users/371753/sclv"}, "edited": false, "score": 0, "creation_date": 1534320848, "post_id": 51719581, "comment_id": 90662633, "body": "@sclv Thanks for the comment. I did try that, to no avail, unfortunately, but that might be due to trying manually first. Your comment is valid. Thanks."}], "tags": [], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "is_accepted": false, "score": 2, "last_activity_date": 1533620688, "creation_date": 1533620688, "answer_id": 51719581, "question_id": 51710005, "link": "https://stackoverflow.com/questions/51710005/haskell-cabal-packing-install-fail/51719581#51719581", "title": "Haskell Cabal packing install fail", "body": "<p>Solution to the broken package issues with Cabal: in OSX there's a 'Frameworks' directory. This holds a Haskell-framework, that you need to delete, otherwise ghc stays active in the background and package building by cabal will fail. In general you need to delete the (hidden) .cabal, .stack and .ghc directories, as well the Haskell framework in 'Frameworks'. There are also two (!) Haskell directories in ~/Library and ~/User/Library you'd better delete. </p>\n\n<p>Stumbled across this when looking for the Rails framework. Thank you all for contributing with possible solutions!</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533635316, "creation_date": 1533565943, "last_edit_date": 1533635316, "question_id": 51710005, "link": "https://stackoverflow.com/questions/51710005/haskell-cabal-packing-install-fail", "title": "Haskell Cabal packing install fail", "body": "<p>I wiped and reinstalled the Haskell platform (Haskell.org: cabal, stack, ghc), but now no addon package will install properly. Cabal always end with ExitFailure1. Probably because not being able to find a dependency. Most of the times however it is the main package it cannot resolve for some reason. \nAny experience with that phenomenon?</p>\n\n<p>Local stack build </p>\n\n<pre><code>--  While building custom Setup.hs for package json-lesson-0.1.0.0 using:\n      /Users/administrator/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_2.2.0.1_ghc-8.4.3 --builddir=.stack-work/dist/x86_64-osx/Cabal-2.2.0.1 configure --with-ghc=/Users/administrator/.stack/programs/x86_64-osx/ghc-8.4.3/bin/ghc --with-ghc-pkg=/Users/administrator/.stack/programs/x86_64-osx/ghc-8.4.3/bin/ghc-pkg --user --package-db=clear --package-db=global --package-db=/Users/administrator/.stack/snapshots/x86_64-osx/lts-12.5/8.4.3/pkgdb --package-db=/Users/administrator/Desktop/Haskell/json-lesson/.stack-work/install/x86_64-osx/lts-12.5/8.4.3/pkgdb --libdir=/Users/administrator/Desktop/Haskell/json-lesson/.stack-work/install/x86_64-osx/lts-12.5/8.4.3/lib --bindir=/Users/administrator/Desktop/Haskell/json-lesson/.stack-work/install/x86_64-osx/lts-12.5/8.4.3/bin --datadir=/Users/administrator/Desktop/Haskell/json-lesson/.stack-work/install/x86_64-osx/lts-12.5/8.4.3/share --libexecdir=/Users/administrator/Desktop/Haskell/json-lesson/.stack-work/install/x86_64-osx/lts-12.5/8.4.3/libexec --sysconfdir=/Users/administrator/Desktop/Haskell/json-lesson/.stack-work/install/x86_64-osx/lts-12.5/8.4.3/etc --docdir=/Users/administrator/Desktop/Haskell/json-lesson/.stack-work/install/x86_64-osx/lts-12.5/8.4.3/doc/json-lesson-0.1.0.0 --htmldir=/Users/administrator/Desktop/Haskell/json-lesson/.stack-work/install/x86_64-osx/lts-12.5/8.4.3/doc/json-lesson-0.1.0.0 --haddockdir=/Users/administrator/Desktop/Haskell/json-lesson/.stack-work/install/x86_64-osx/lts-12.5/8.4.3/doc/json-lesson-0.1.0.0 --dependency=aeson=aeson-1.3.1.1-v8c5j6KkT8PoXkOVjikF --dependency=base=base-4.11.1.0 --dependency=bytestring=bytestring-0.10.8.2 --dependency=text=text-1.2.3.0\n    Process exited with code: ExitFailure 1\n</code></pre>\n\n<p>Using cabal install: </p>\n\n<pre><code>MacBook-2:Haskell administrator$ cabal install aeson\nclang: warning: argument unused during compilation: '-nopie' [-Wunused-command-line-argument]\nResolving dependencies...\nDownloading base-compat-0.10.4...\nDownloading dlist-0.8.0.4...\nConfiguring dlist-0.8.0.4...\nDownloading tagged-0.8.6...\nDownloading th-abstraction-0.2.8.0...\nConfiguring tagged-0.8.6...\nConfiguring base-compat-0.10.4...\nConfiguring th-abstraction-0.2.8.0...\nBuilding dlist-0.8.0.4...\nBuilding tagged-0.8.6...\nBuilding base-compat-0.10.4...\nBuilding th-abstraction-0.2.8.0...\nInstalled dlist-0.8.0.4\nDownloading time-locale-compat-0.1.1.4...\nConfiguring time-locale-compat-0.1.1.4...\nBuilding time-locale-compat-0.1.1.4...\nInstalled tagged-0.8.6\nDownloading uuid-types-1.0.3...\nConfiguring uuid-types-1.0.3...\nInstalled time-locale-compat-0.1.1.4\nBuilding uuid-types-1.0.3...\nFailed to install uuid-types-1.0.3\nBuild log ( /Users/administrator/.cabal/logs/ghc-8.4.3/uuid-types-1.0.3-tE9Bfk2PgXDUPgbtamBdI.log ):\ncabal: Entering directory '/var/folders/81/50s00bl11pv7fn8dw4n0w03m0000gn/T/cabal-tmp-5513/uuid-types-1.0.3'\nConfiguring uuid-types-1.0.3...\nclang: warning: argument unused during compilation: '-nopie' [-Wunused-command-line-argument]\nPreprocessing library for uuid-types-1.0.3..\nBuilding library for uuid-types-1.0.3..\n&lt;command line&gt;: cannot satisfy -package-id hashable-1.2.7.0-3hrKWzET808E40baaqgc23\n    (use -v for more information)\ncabal: Leaving directory '/var/folders/81/50s00bl11pv7fn8dw4n0w03m0000gn/T/cabal-tmp-5513/uuid-types-1.0.3'\nInstalled th-abstraction-0.2.8.0\nInstalled base-compat-0.10.4\nUpdating documentation index\n/Users/administrator/Library/Haskell/share/doc/x86_64-osx-ghc-8.4.3/index.html\ncabal: Error: some packages failed to install:\naeson-1.4.0.0-64eUw61rbC49Aocs9eETca depends on aeson-1.4.0.0 which failed to\ninstall.\nuuid-types-1.0.3-tE9Bfk2PgXDUPgbtamBdI failed during the building phase. The\nexception was:\nExitFailure 1\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 0, "creation_date": 1533535767, "post_id": 51701303, "comment_id": 90363963, "body": "General version of this is <code>StateT</code>"}, {"owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "reply_to_user": {"reputation": 431, "user_id": 3042847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20812bf59589551344aeae214de49f6a?s=128&d=identicon&r=PG&f=1", "display_name": "xgrommx", "link": "https://stackoverflow.com/users/3042847/xgrommx"}, "edited": false, "score": 1, "creation_date": 1533536052, "post_id": 51701303, "comment_id": 90364068, "body": "@xgrommx trying to do it on my own to understand the monad"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1533616522, "post_id": 51701595, "comment_id": 90398551, "body": "TIL you can put where clauses on case alternatives. Huh!"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1533617398, "post_id": 51701595, "comment_id": 90398814, "body": "Yup, &quot;<code>alt \t\u2192 \tpat -&gt; exp [where decls] </code>&quot; from <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/haskellch10.html</a>"}], "tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": true, "score": 3, "last_activity_date": 1533538792, "last_edit_date": 1533538792, "creation_date": 1533536421, "answer_id": 51701595, "question_id": 51701303, "link": "https://stackoverflow.com/questions/51701303/haskell-pattern-matching-inside-of-case/51701595#51701595", "title": "Haskell pattern matching inside of case", "body": "<p>You may use <code>let</code> or <code>where</code> to create pattern matching in any place those expressions are allowed: (shortened some lines to make it fit in StackOverflow's format)</p>\n\n<pre><code>instance Monad' Parser where\n result v = Parser (\\input -&gt; Just (v, input))\n bind (Parser fa) fb = \n   Parser (\\input -&gt; case (fa input) of\n       Nothing -&gt; Nothing\n       Just(v, input') -&gt; pb input'\n         where (Parser pb) = fb v\n   )\n</code></pre>\n\n<p>= or =</p>\n\n<pre><code>instance Monad' Parser where\n result v = Parser (\\input -&gt; Just (v, input))\n bind (Parser fa) fb = \n   Parser (\\input -&gt; case (fa input) of\n       Nothing -&gt; Nothing\n       Just(v, input') -&gt;\n         let (Parser pb) = fb v\n          in  pb input'\n   )\n</code></pre>\n\n<p>Haskell 98 does not allow instance declarations for type synonyms.  GHC advertises a language extension that allows this, but my experience is that it lead to an ever deeper hole of problems.</p>\n\n<p>The standard way to work around the need to pattern match is to create a record and use the field to strip away the constructor. The convention seems to be to use <code>un</code> ++ the name of the type.</p>\n\n<pre><code>data Parser a = Parser { unParser :: (String -&gt; Maybe (a, String))}\n\n-- N.B. unParser :: Parser a -&gt; String -&gt; Maybe (a, String)\n\ninstance Monad' Parser where\n result v = Parser (\\input -&gt; Just (v, input))\n bind (Parser fa) fb = \n   Parser (\\input -&gt; case (fa input) of\n       Nothing -&gt; Nothing\n       Just(v, input') -&gt; unParser (fb v) input\n   )\n</code></pre>\n\n<hr>\n\n<p><strong>The question you didn't ask</strong> </p>\n\n<p>Did you know that <code>Maybe</code> is a <code>Monad</code>? When you find yourself writing a lot of extra code to propagate <code>Nothing -&gt; Nothing</code> it is really great to just ignore failure and let the Monad (or Applicative) instance be your friend.</p>\n\n<pre><code>instance Monad' Parser where\n result v = Parser (\\input -&gt; Just (v, input))\n bind (Parser fa) fb = \n   Parser (\\input -&gt; do -- This is in the Maybe Monad. \n                        -- If any step fails the result is Nothing\n       (v, input') &lt;- fa input\n       unParser (fb v) input'\n   )\n</code></pre>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 51701595, "answer_count": 1, "score": 1, "last_activity_date": 1533538792, "creation_date": 1533534970, "question_id": 51701303, "link": "https://stackoverflow.com/questions/51701303/haskell-pattern-matching-inside-of-case", "title": "Haskell pattern matching inside of case", "body": "<p>I am trying to perform pattern matching inside of case clause:</p>\n\n<pre><code>-- different types of Parsers:\n-- type Parser = String -&gt; Maybe (String, String)\n-- type Parser = String -&gt; Maybe (Tree, String)\n-- type Parser = String -&gt; Maybe (Int, String)\n\n-- can be generalized as:\n\ndata Parser a = Parser (String -&gt; Maybe (a, String))\n\nclass Monad' m where\n result :: a -&gt; m a\n bind :: m a -&gt; (a -&gt; m b) -&gt; m b\n\ninstance Monad' Parser where\n result v = Parser (\\input -&gt; Just (v, input))\n bind (Parser fa) fb = Parser (\\input -&gt;\n                                 case (fa input) of\n                                  Nothing -&gt; Nothing\n                                  Just(v, input') -&gt; pb input' where pb in fb v = (Parser pb)\n                              )\n</code></pre>\n\n<p>The problem is with <code>where pb in fb v = (Parser pb)</code>. How do I declare pb and then pattern match with call to (fb input').</p>\n\n<p>Also the need for including the constructor <code>Parser</code> in the declaration: <code>data Parser a = Parser (String -&gt; Maybe (a, String))</code> seems to complicate things a lot. It would have much simpler to write:\n<code>data Parser a = String -&gt; Maybe (a, String)</code>, but that is not possible are there other ways to achieve this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1533533910, "post_id": 51701104, "comment_id": 90363353, "body": "What&#39;s line 11?"}, {"owner": {"reputation": 6190, "user_id": 3523446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/268d77718b0875284cdfff02b4ec54b5?s=128&d=identicon&r=PG&f=1", "display_name": "qxg", "link": "https://stackoverflow.com/users/3523446/qxg"}, "edited": false, "score": 1, "creation_date": 1533533945, "post_id": 51701104, "comment_id": 90363366, "body": "<code>checksum (x:xs) tot</code> and also see <a href=\"http://learnyouahaskell.com/syntax-in-functions\" rel=\"nofollow noreferrer\">learnyouahaskell.com/syntax-in-functions</a>"}, {"owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "edited": false, "score": 0, "creation_date": 1533535108, "post_id": 51701104, "comment_id": 90363727, "body": "May I ask why you are using a tuple in the first argument?  Your function definitions seem to want <code>checksum :: [Int] -&gt; Int -&gt; (Bool, Int)</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1533556819, "post_id": 51701104, "comment_id": 90374929, "body": "Proposal (not related to your error): make your base case be <code>[]</code> instead of <code>[x]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 22952, "user_id": 210211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8721ff8fa4b5c658058f4a2803231f44?s=128&d=identicon&r=PG", "display_name": "comingstorm", "link": "https://stackoverflow.com/users/210211/comingstorm"}, "is_accepted": false, "score": 2, "last_activity_date": 1533535329, "last_edit_date": 1533535329, "creation_date": 1533534832, "answer_id": 51701277, "question_id": 51701104, "link": "https://stackoverflow.com/questions/51701104/how-to-get-rid-of-parse-error-in-pattern-error-in-haskell/51701277#51701277", "title": "How to get rid of &quot;Parse error in pattern&quot; error in Haskell", "body": "<p>In Haskell, function application has a higher associative strength than any other operation.</p>\n\n<p>So, the pattern <code>checksum x:xs tot</code> is parsed as <code>(checksum x):(xs tot)</code>, which doesn't make any sense as a pattern, and causes a parse error.  Specifically, patterns don't allow function applications, such as <code>(checksum x)</code>, except for defining functions at the top level.</p>\n\n<p>As the comment says, you should parenthesize it as <code>checksum (x:xs) tot</code> so it will parse as you expect, defining <code>checksum</code> at the top level.</p>\n"}, {"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": true, "score": 1, "last_activity_date": 1533535234, "creation_date": 1533535234, "answer_id": 51701358, "question_id": 51701104, "link": "https://stackoverflow.com/questions/51701104/how-to-get-rid-of-parse-error-in-pattern-error-in-haskell/51701358#51701358", "title": "How to get rid of &quot;Parse error in pattern&quot; error in Haskell", "body": "<p>Ok, a number of corrections to make this work.  I am going on the assumption that your type annotation is correct.</p>\n\n<pre><code>checksum :: ([Int], Int) -&gt; (Bool, Int)\n\nchecksum ([x], tot) -- make argument a single tuple\n    | x == tot        = (True, tot)\n    | otherwise       = (False, tot)\n\nchecksum ((x:xs), tot) = checksum (xs, tot-x) -- group list; make argument and result a tuple.\n-- removed extraneous back-tick at the end of the last line.\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 4247090, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8CEBKFSdSsU/AAAAAAAAAAI/AAAAAAAADi0/Mu8RZx9pB4o/photo.jpg?sz=128", "display_name": "watson", "link": "https://stackoverflow.com/users/4247090/watson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 838, "favorite_count": 0, "accepted_answer_id": 51701358, "answer_count": 2, "score": 0, "last_activity_date": 1533535329, "creation_date": 1533533788, "question_id": 51701104, "link": "https://stackoverflow.com/questions/51701104/how-to-get-rid-of-parse-error-in-pattern-error-in-haskell", "title": "How to get rid of &quot;Parse error in pattern&quot; error in Haskell", "body": "<p>I am having trouble with some haskell code. Namely a function checksum\nwhich is meant to check whether the sum of a list of Integers is equal to the Integer argument tot.</p>\n\n<p>There is something wrong with the syntax because I keep getting:</p>\n\n<pre><code>Main.hs:11:1: Parse error in pattern: checksum\n</code></pre>\n\n<p>And the module isn't loaded.</p>\n\n<pre><code>checksum :: ([Int], Int) -&gt; (Bool, Int)\n\nchecksum [x] tot\n    | x == tot        = (True, tot)\n    | otherwise       = (False, tot)\n\nchecksum x:xs tot = checksum xs tot-x`\n</code></pre>\n"}, {"tags": ["haskell", "types", "existential-type", "type-level-computation"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1533544181, "post_id": 51699077, "comment_id": 90367776, "body": "<code>let</code> does lazy pattern matching, unlike <code>case</code> so the rules differ. I guess if one uses lazy patterns as in <code>cases .. of ~(pattern) -&gt; ...</code> one would get the similar errors."}], "answers": [{"comments": [{"owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "edited": false, "score": 0, "creation_date": 1533516044, "post_id": 51699103, "comment_id": 90360075, "body": "Thanks, @Carl! Suggestion verified, and fixed code added below original code above."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 2, "last_activity_date": 1533512980, "creation_date": 1533512980, "answer_id": 51699103, "question_id": 51699077, "link": "https://stackoverflow.com/questions/51699077/what-is-the-scope-of-a-type-variable-brought-into-existence-by-pattern-matching/51699103#51699103", "title": "What is the scope of a type variable brought into existence by pattern matching on SomeNat?", "body": "<p>Interesting - usually GHC tells you its brain exploded if you try something like that. I guess in your case, <code>SomeNat</code> is only an existential, not a true GADT, therefore you don't get the fun error message.</p>\n\n<p>In any case, you need to match a constructor with a <code>case</code> expression instead of a <code>let</code> if you want access to types that are hidden inside the data type.</p>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 51699103, "answer_count": 1, "score": 1, "last_activity_date": 1533515969, "creation_date": 1533512747, "last_edit_date": 1533515969, "question_id": 51699077, "link": "https://stackoverflow.com/questions/51699077/what-is-the-scope-of-a-type-variable-brought-into-existence-by-pattern-matching", "title": "What is the scope of a type variable brought into existence by pattern matching on SomeNat?", "body": "<p>I'm having trouble understanding why this code:</p>\n\n<pre><code>-- someNatVal test case\n--\n-- David Banas &lt;capn.freako@gmail.com&gt;\n-- August 5, 2018\n\n{-# OPTIONS_GHC -Wall #-}\n\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeApplications #-}\n\nimport GHC.TypeLits\nimport Data.Proxy\n\ntellNat :: forall n. KnownNat n =&gt; Integer\ntellNat = natVal (Proxy :: Proxy n)\n\nfoo :: Integer -&gt; Integer\nfoo n =\n  let SomeNat (_ :: Proxy m) =\n        fromMaybe (error \"Negative Nat!\") (someNatVal n)\n   in tellNat @m\n\nmain :: IO ()\nmain = print $ foo 1 == 1\n</code></pre>\n\n<p>produces this compilation error:</p>\n\n<blockquote>\n  <p>[1 of 1] Compiling Main             ( someNatValTest.hs,\n  someNatValTest.o )</p>\n  \n  <p>someNatValTest.hs:22:16: error: Not in scope: type variable \u2018m\u2019</p>\n</blockquote>\n\n<p>As per @Carl, this code:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n\n{-# LANGUAGE AllowAmbiguousTypes #-}\n{-# LANGUAGE RankNTypes #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeApplications #-}\n\nimport GHC.TypeLits\nimport Data.Maybe\nimport Data.Proxy\n\ntellNat :: forall n. KnownNat n =&gt; Integer\ntellNat = natVal (Proxy :: Proxy n)\n\nfoo :: Integer -&gt; Integer\nfoo n =\n  case n' of\n    SomeNat (_ :: Proxy m) -&gt;\n      tellNat @m\n  where n' = fromMaybe (error \"Negative Nat!\") (someNatVal n)\n\nmain :: IO ()\nmain = print $ foo 1 == 1\n</code></pre>\n\n<p>works:</p>\n\n<pre><code>dca9047d694f:tmp a594349$ stack runghc someNatValTest.hs\nTrue\n</code></pre>\n"}, {"tags": ["sorting", "haskell"], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1533501143, "post_id": 51697693, "comment_id": 90357478, "body": "Why do you have an <code>Ord</code> constraint? EDIT: <code>isSorted</code> could also be called <code>pairwiseCompare</code> with an alternate implementation of <code>pC f xs = all (uncurry f) (zip xs (drop 1 xs))</code>"}, {"owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1533501610, "post_id": 51697693, "comment_id": 90357566, "body": "@ThomasM.DuBuisson I think I understand where you driving at, I just wanted to illustrate that specific example, which receives comparator and checks, whether a list, that can be ordered, is actually sorted. But yea, the function can be generalised and answer whether every consecutive pair satisfy a certain condition"}], "tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": true, "score": 5, "last_activity_date": 1533505616, "last_edit_date": 1533505616, "creation_date": 1533498287, "answer_id": 51697693, "question_id": 51697602, "link": "https://stackoverflow.com/questions/51697602/i-would-like-to-check-if-the-comparison-operator-is-true-or-false/51697693#51697693", "title": "I would like to check if the comparison operator is true or false", "body": "<blockquote>\n  <p>I would like to write a code that tells me if my list is sorted by the given comparison operator for example I wanna put in</p>\n</blockquote>\n\n<p><code>isSorted</code> function can be enhanced to receive a function, which compares two elements and that function can be called instead of <code>&lt;=</code> in your example:</p>\n\n<pre><code>isSorted :: (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; Bool\nisSorted _ []       = True\nisSorted _ [x]      = True\nisSorted comparator (x:y:xs) = comparator x y &amp;&amp; isSorted comparator (y:xs)\n</code></pre>\n\n<p>So the function is going to be called as:</p>\n\n<pre><code>isSorted (&lt;) [1, 2, 3]\nisSorted (&gt;=) [3, 2, 1]\n</code></pre>\n\n<p>Calling it with <code>(==)</code> will just compare if the elements are the same in the list.</p>\n"}, {"comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1533554994, "post_id": 51704709, "comment_id": 90373826, "body": "@molbdnilo: aarrgh, yes. Thanks for spotting that."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1533555787, "post_id": 51704709, "comment_id": 90374253, "body": "@molbdnilo: yes, since this was mentioned just above the code fragment :)"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1533593334, "post_id": 51704709, "comment_id": 90393819, "body": "Not necessarily an improvement, but as an example of reasoning with laziness: the <code>isSorted _ []</code> clause can be removed using <code>isSorted f xs = and $ zipWith f xs $ tail xs</code>, since <code>and []</code> = <code>True</code> and if <code>xs</code> is empty then <code>tail xs</code> will never be called by <code>zipWith</code>; it can also be written equivalently as a lazy pattern match <code>isSorted f xs@ ~(_:xs&#39;) = and $ zipWith f xs xs&#39;</code>, but it\u2019s a bit more syntactically noisy."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 1, "last_activity_date": 1533555767, "last_edit_date": 1533555767, "creation_date": 1533548577, "answer_id": 51704709, "question_id": 51697602, "link": "https://stackoverflow.com/questions/51697602/i-would-like-to-check-if-the-comparison-operator-is-true-or-false/51704709#51704709", "title": "I would like to check if the comparison operator is true or false", "body": "<p>The idea can be to <em>parameterize</em> the comparison. Now you use <code>&lt;=</code>, but we can replace it with an <code>f</code>, we pass as a parameter:</p>\n\n<pre><code>isSorted :: <b>(a -> a -> Bool) -&gt;</b> [a] -&gt; Bool\nisSorted <b>_</b> [] = True\nisSorted <b>_</b> [x] = True\nisSorted <b>f</b> (x:y:xs) = <b>f</b> x y && isSorted <b>f</b> (y:xs)</code></pre>\n\n<p>We can however improve the following code by using <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:zipWith\" rel=\"nofollow noreferrer\"><strong><code>zipWith :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]</code></strong></a> and <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:and\" rel=\"nofollow noreferrer\"><strong><code>and :: [Bool] -&gt; Bool</code></strong></a>:</p>\n\n<pre><code>isSorted :: <b>(a -> a -> Bool) -&gt;</b> [a] -&gt; Bool\nisSorted _ [] = True\nisSorted <b>f</b> xs@(_:xs2) = <b>and(zipWith f xs xs2)</b></code></pre>\n\n<p>The <code>isSorted</code> thus takes a predicate that works with two <code>a</code>s, and we check if the predicate holds for every item, and its next item. You can thus write more advanced predicates that do not necessary encapsulate an <em>order relation</em>.</p>\n"}], "owner": {"reputation": 119, "user_id": 10162403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf85a35bc01ab9cfd3a3e6bc6c4df7ed?s=128&d=identicon&r=PG&f=1", "display_name": "Gloria95", "link": "https://stackoverflow.com/users/10162403/gloria95"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 51697693, "answer_count": 2, "score": 1, "last_activity_date": 1533555767, "creation_date": 1533497486, "last_edit_date": 1533510325, "question_id": 51697602, "link": "https://stackoverflow.com/questions/51697602/i-would-like-to-check-if-the-comparison-operator-is-true-or-false", "title": "I would like to check if the comparison operator is true or false", "body": "<p>So I know how to write a code to see if my list is sorted from smallest to biggest </p>\n\n<pre><code>isSorted :: (Ord a) =&gt; [a] -&gt; Bool\nisSorted []       = True\nisSorted [x]      = True\nisSorted (x:y:xs) = x &lt;= y &amp;&amp; isSorted (y:xs)\n</code></pre>\n\n<p>But I would like to write a code that tells me if my list is sorted by the given comparison operator\nfor example \nI wanna put in </p>\n\n<pre><code>sorted (&lt;=) [1,2,2,4,5] == True\nsorted (&lt;)  [1,2,2,4,5] == False\nsorted (==) [1,2,2,2,3] == False\n</code></pre>\n\n<p>What would I have to do?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1533497248, "post_id": 51697545, "comment_id": 90356532, "body": "No, this is totally wrong. You cannot &quot;set&quot; a variable in Haskell. <code>k == k^k</code> means &quot;k is equal to its own kth power&quot; (it&#39;s a boolean condition). There aren&#39;t many such numbers out there, and your function just happens to skip the first and only one, so there&#39;s no output."}, {"owner": {"reputation": 675, "user_id": 8672443, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/5nJJX.jpg?s=128&g=1", "display_name": "ZpfSysn", "link": "https://stackoverflow.com/users/8672443/zpfsysn"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1533497349, "post_id": 51697545, "comment_id": 90356566, "body": "@n.m. is <code>(n:lis)</code> equivalent of Java&#39;s <code>(for var in array)</code>?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1533497368, "post_id": 51697545, "comment_id": 90356573, "body": "If you want to generate a list of squares, you need something like <code>[k^2|k&lt;-lis]</code>."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1533497448, "post_id": 51697545, "comment_id": 90356595, "body": "&quot;is (n:lis) equivalent of Java&#39;s &quot; no, they even weren&#39;t in the same town."}, {"owner": {"reputation": 675, "user_id": 8672443, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/5nJJX.jpg?s=128&g=1", "display_name": "ZpfSysn", "link": "https://stackoverflow.com/users/8672443/zpfsysn"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1533498199, "post_id": 51697545, "comment_id": 90356805, "body": "@n.m. thank you for the explination"}], "answers": [{"comments": [{"owner": {"reputation": 675, "user_id": 8672443, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/5nJJX.jpg?s=128&g=1", "display_name": "ZpfSysn", "link": "https://stackoverflow.com/users/8672443/zpfsysn"}, "edited": false, "score": 0, "creation_date": 1533497634, "post_id": 51697585, "comment_id": 90356637, "body": "I dont quite understand the point of (n:lis) in this case.  In the working code here: <code>myFunc (n:lis) = [ k^k | k &lt;-lis]</code>, N does not seem to function as anything."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 675, "user_id": 8672443, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/5nJJX.jpg?s=128&g=1", "display_name": "ZpfSysn", "link": "https://stackoverflow.com/users/8672443/zpfsysn"}, "edited": false, "score": 3, "creation_date": 1533497835, "post_id": 51697585, "comment_id": 90356692, "body": "@aDev <code>n</code> is the first element of the list (which your function throws away). <code>lis</code> is the tail of the list (everything but the first element). If you want to use the input list as is, use <code>myFunc lis = [ ... ]</code>."}, {"owner": {"reputation": 13772, "user_id": 379311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c993f4f111e6ff3211ccda1b98828253?s=128&d=identicon&r=PG", "display_name": "Yann Vernier", "link": "https://stackoverflow.com/users/379311/yann-vernier"}, "edited": false, "score": 0, "creation_date": 1533730367, "post_id": 51697585, "comment_id": 90452465, "body": "<code>[ k | k &lt;- lis, k &lt; 100 ]</code>, which can be written <code>filter (&lt;100) lis</code> has a potential problem; it will never stop checking values from <code>lis</code> to see if they happen to satisfy <code>&lt;100</code>. If we know they grow monotonically, we can get a terminating list instead using <code>takeWhile (&lt;100) lis</code>. In this example, we expect the <code>take 10</code> in the original code to make sure we don&#39;t see the part where the filter runs indefinitely without completing (which happened immediately for the original comprehension)."}], "tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": true, "score": 4, "last_activity_date": 1533497330, "creation_date": 1533497330, "answer_id": 51697585, "question_id": 51697545, "link": "https://stackoverflow.com/questions/51697545/haskell-list-comprehension-error/51697585#51697585", "title": "Haskell list comprehension error", "body": "<p>You misunderstand the list comprehension.  </p>\n\n<pre><code>[ k | k &lt;- lis, k == k^k ]\n</code></pre>\n\n<p>The <code>k == k^k</code> clause is a <em>filter</em> \u2013\u2013 it only keeps elements of the list that satisfy this equation.  (<code>==</code> is a comparison operator that returns a bool, which is one hint).  The reason you see no output is that there are no numbers in <code>[1..]</code> that satisfy this equation.  But we get an infinite loop because we keep checking ever higher numbers to see if they satisfy it.</p>\n\n<p>Something to experiment with</p>\n\n<pre><code>[ k | k &lt;- lis, k &lt; 100 ]\n</code></pre>\n\n<p>As for how to get a list of squares, use a comprehension like this</p>\n\n<pre><code>[ k^2 | k &lt;- lis ]\n</code></pre>\n\n<p>If you want something more like your original phrasing, you can make <code>let</code> bindings within  a list comprehension:</p>\n\n<pre><code>[ r | k &lt;- lis, let r = k^2 ]\n</code></pre>\n\n<p>There are other issues with your code, but one baby step at a time!  Good luck!</p>\n"}], "owner": {"reputation": 675, "user_id": 8672443, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/5nJJX.jpg?s=128&g=1", "display_name": "ZpfSysn", "link": "https://stackoverflow.com/users/8672443/zpfsysn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 51697585, "answer_count": 1, "score": 0, "last_activity_date": 1533497756, "creation_date": 1533496981, "question_id": 51697545, "link": "https://stackoverflow.com/questions/51697545/haskell-list-comprehension-error", "title": "Haskell list comprehension error", "body": "<p>I just started to learn Haskell today and is completely overwhelmed by its syntax. </p>\n\n<p>I am trying to apply math calculation to a list of items. </p>\n\n<p>For example, lets say I want to square every item in the list using list comprehension.</p>\n\n<p>My attempt</p>\n\n<pre><code>myfunc (n:lis) = [ k | k &lt;-lis, k == k^k]\n\nresult_list = myfunc[1..]\n\ntake 10 result_list\n</code></pre>\n\n<p>My understand of my <code>myfunc</code> code: take a list and loop through elements that is stored in variable k and set k equals to its square.</p>\n\n<p>after i execute the <code>take</code> command, and hit enter, apparently the process is running but does not do anything.</p>\n\n<p>Note that i want to use list comprehension as a way to do it. I can use <code>map</code> do achieve my goal already.</p>\n"}, {"tags": ["function", "haskell", "functional-programming", "let"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1533490370, "post_id": 51696686, "comment_id": 90354706, "body": "<code>prefix n</code> is a function taking <code>n</code> as argument and returning the list."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 4, "creation_date": 1533490381, "post_id": 51696686, "comment_id": 90354711, "body": "I&#39;m not sure exactly what you&#39;re asking, but the <code>let</code> creates a local function called <code>prefix</code>, then it&#39;s used to map over the <code>range</code>. You can tell <code>prefix</code> is a function because it says that it takes a parameter <code>n</code>."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1533496928, "last_edit_date": 1533496928, "creation_date": 1533496382, "answer_id": 51697483, "question_id": 51696686, "link": "https://stackoverflow.com/questions/51696686/how-does-let-binding-work/51697483#51697483", "title": "How does let binding work", "body": "<p>You can think of <code>let</code> as syntactic sugar for using an anonymous function.</p>\n\n<p><code>let name = value in stuff</code> is equivalent to <code>(\\name -&gt; stuff) value</code>. An anonymous function whose body is the expression in the <code>in</code> clause is applied to the expression bound to a name in the <code>let</code> clause.</p>\n"}], "owner": {"reputation": 1426, "user_id": 429433, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/69e3cfef4d7ab01de74c8bb1a4f0ebf2?s=128&d=identicon&r=PG", "display_name": "Rizon", "link": "https://stackoverflow.com/users/429433/rizon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533496928, "creation_date": 1533490236, "last_edit_date": 1533490477, "question_id": 51696686, "link": "https://stackoverflow.com/questions/51696686/how-does-let-binding-work", "title": "How does let binding work", "body": "<p>I'm new to Haskell and I'm having troubles understanding how the let binding works in the following example:</p>\n\n<pre><code>prefixes :: [a] -&gt; [[a]] \n\nprefixes xs =\n    let prefix n = take n xs\n    in map prefix (range (length xs))\n</code></pre>\n\n<p>'take' function returns a list, so how does this get bind to 2 variables (prefix n)? Or am I totally missing the point here...</p>\n"}, {"tags": ["haskell", "recursion"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1533489451, "post_id": 51696323, "comment_id": 90354449, "body": "By the way, even in the tail recursive variant (with an accumulator), one can still use pattern matching on lists. <code>head,tail</code> should be avoided when possible, and here there is no reason to use them."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 2, "last_activity_date": 1533489279, "creation_date": 1533489279, "answer_id": 51696547, "question_id": 51696323, "link": "https://stackoverflow.com/questions/51696323/tail-recursion-in-haskell-for-a-function/51696547#51696547", "title": "Tail recursion in Haskell for a function", "body": "<p>Well, flipping the \"time direction\" in <code>f n = n * f (n-1) + n</code> by letting  <code>n = k + 1</code>, we have</p>\n\n<pre><code>f (k+1) = (k+1) * f k + (k+1)\nnext fk k = (k+1) * fk + (k+1)\n</code></pre>\n\n<p>and thus</p>\n\n<pre><code>f n = iterate 0 0\n  where\n  iterate k fk | k==n = fk\n               | otherwise = ....\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13441, "user_id": 2199600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8sl6u.jpg?s=128&g=1", "display_name": "Igor Drozdov", "link": "https://stackoverflow.com/users/2199600/igor-drozdov"}, "is_accepted": false, "score": 3, "last_activity_date": 1533489282, "creation_date": 1533489282, "answer_id": 51696549, "question_id": 51696323, "link": "https://stackoverflow.com/questions/51696323/tail-recursion-in-haskell-for-a-function/51696549#51696549", "title": "Tail recursion in Haskell for a function", "body": "<p>In order to rewrite the following function using tail-recursion:</p>\n\n<pre><code>f :: Integer -&gt; Integer\nf 0 = 0\nf n = n * f (n-1) + n\n</code></pre>\n\n<p>the same approach, which used in <code>summe'</code> can be used.</p>\n\n<p>The idea is to start from zero and increment the value until <code>n</code> is reached:</p>\n\n<pre><code>f :: Integer -&gt; Integer\nf n = iterate 0 0\n  where\n    f' x sum = x * sum + x\n    iterate x sum | x == n = f' n sum\n                  | otherwise = iterate (x + 1) (f' x sum)\n</code></pre>\n\n<p>Thus, if <code>n</code> is reached, evaluate the function with <code>n</code> and the accumulated sum; otherwise, calculate the function with intermediate sum and value and pass it to the next iteration.</p>\n"}], "owner": {"reputation": 119, "user_id": 10162403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf85a35bc01ab9cfd3a3e6bc6c4df7ed?s=128&d=identicon&r=PG&f=1", "display_name": "Gloria95", "link": "https://stackoverflow.com/users/10162403/gloria95"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1533489282, "creation_date": 1533487551, "question_id": 51696323, "link": "https://stackoverflow.com/questions/51696323/tail-recursion-in-haskell-for-a-function", "title": "Tail recursion in Haskell for a function", "body": "<p>I am trying to learn Haskell and I read about tail recursions. For example I can write the sum function this way :</p>\n\n<pre><code>sum :: Num a =&gt; [a] -&gt; a\nsum [] = 0\nsum (x:xs) = x + summe xs\n</code></pre>\n\n<p>But also this way </p>\n\n<pre><code>summe':: Num a =&gt; [a] -&gt; a\nsumme' x = iterate x 0\n    where\n    iterate x y | null x    = 0 + y\n                | otherwise = iterate (tail x) (head x + y)\n</code></pre>\n\n<p>Could someone tell me how to do it with this function? I am lost</p>\n\n<pre><code>f :: Integer -&gt; Integer\nf 0 = 0\nf n = n * f (n-1) + n\n</code></pre>\n"}, {"tags": ["haskell", "naming-conventions", "typeclass", "naming"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1533493212, "post_id": 51687101, "comment_id": 90355484, "body": "I just don&#39;t find the need to write lawless, single function, type classes that often.  Perhaps you can avoid writing such classes to begin with and thus avoid the need to name one?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1533508896, "post_id": 51687101, "comment_id": 90359033, "body": "I second ThomasM.DuBuisson: if your typeclass isn&#39;t in some way mathematically meaningful (and thus has a natural name) you should ask yourself whether a typeclass make sense at all. Very often it is more effective to just use a simple record type."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1533527968, "post_id": 51687101, "comment_id": 90362002, "body": "@ThomasM.DuBuisson how would you decouple things and allow the code to be easily extensible without them? Yes, type classes are not interfaces, but they are the closest thing one can get."}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 5, "creation_date": 1533529195, "post_id": 51687101, "comment_id": 90362251, "body": "@PetrasPurlys, often, using functions. ;-)  Though I think the recommendation to avoid classes might be a bit premature without a concrete example.  On the other hand, OO programmers coming to haskell should <i>avoid the heck out of typeclasses</i> your intuitions are all wrong!!!"}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1533530338, "post_id": 51687101, "comment_id": 90362488, "body": "@luqui I think the Show type class could serve as an example here: you could do without it and have separate functions for every printable type, but that&#39;s just not convenient. Having Show as a type class exactly defines the expected behavior / property for a type. You know it&#39;is the same for all types that implement it. This makes code easier to read and extend, don&#39;t you agree?"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1533585415, "post_id": 51687101, "comment_id": 90390913, "body": "I tend to use the same name for the typeclass as I do for the function. So if the function is <code>color</code>, the class would just be <code>Color</code>. That&#39;s how the built-in <code>Read</code> and <code>Show</code> typeclasses are, as well. But I agree with above comments, if you find yourself writing a lot of these it might be time to re-think your interface."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1533628686, "post_id": 51687101, "comment_id": 90403775, "body": "@PetrasPurlys but the <code>Show</code> class has a very clear mathematical meaning, and requires instances to fulfill the law <code>read . show = id</code>. (If <code>read</code> is actually implemented; often, this should be better understood as <code>\u2329paste in a new Haskell file and compile\u232a . show = id</code>."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1533638588, "post_id": 51687101, "comment_id": 90409862, "body": "@leftaroundabout Could you please elaborate on what you mean? Are you suggesting that type classes shouldn&#39;t be used as a means of abstracting/constraining function input types?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1533641739, "post_id": 51687101, "comment_id": 90411780, "body": "I&#39;m saying that you should have a clear reason for wanting a type class, some need that a simple record can&#39;t cover."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1533666472, "post_id": 51687101, "comment_id": 90427129, "body": "@leftaroundabout I usually need not to consume the raw record but feed it to some function and get a result. The functions have to be able to accept any type of record that can be processed into the desired result. Geometric shapes are a good example here - they can have things like Area, Volume or Center, but the shapes themselves can be either rectangles, circles, triangles... Having a type class here would allow for a very easy addition of other shapes."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1533673375, "post_id": 51687101, "comment_id": 90430460, "body": "I would use <code>Named</code> and <code>Colored</code>."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1533704175, "post_id": 51687101, "comment_id": 90437905, "body": "@danidiaz How about &quot;sample&quot; - Sampled?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1533755258, "post_id": 51687101, "comment_id": 90467691, "body": "@PetrasPurlys For something that can be sampled, &quot;Samplable&quot;."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1533755772, "post_id": 51687101, "comment_id": 90467914, "body": "@danidiaz And for something that represents or contains an actual sample?"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1533757576, "post_id": 51687101, "comment_id": 90468676, "body": "@PetrasPurlys <code>Sampled</code> in that case, but I&#39;m a bit uneasy about naming a class of types from the way their values are produced."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1533758043, "post_id": 51687101, "comment_id": 90468875, "body": "@danidiaz I completely agree that types should not be named that way. Single function type classes, on the other hand, represent only some type property, so maybe they could be named like that, especially if the type that is an instance of the Sample typeclass describes or contains a sample."}], "answers": [{"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": true, "score": 1, "last_activity_date": 1533738805, "creation_date": 1533738805, "answer_id": 51749310, "question_id": 51687101, "link": "https://stackoverflow.com/questions/51687101/single-function-typeclass-naming-in-haskell-er-vs-has/51749310#51749310", "title": "Single-function typeclass naming in Haskell | &quot;er&quot; vs &quot;has&quot;", "body": "<p>I suggest that having any prefix means a certain thing and having any suffix means a different thing. Additionally, the class prefix/suffix relates to the prefix/suffix on the member function. This convention should be written explicitly somewhere.</p>\n\n<p>For instance, </p>\n\n<pre><code>module Lib.Colour.Class\n\n-- The following convention is followed\n-- Let class prefixes denote that the member has a certain attribute\n-- or has some state internally manipulatable.\n--   Has- abstracts record type, accessed with get&lt;ClassRootName&gt;\n--   Is-  Things that *are* another type, coereced with as&lt;ClassRootName&gt;\n--   Can- Things that are manipulatable in some way, via do&lt;ClassRootName&gt;\n-- Let class suffixes denote types who primarily act on other types\n--   -er  A thing that does something to another type\n\nclass HasColour a where\n  getColour :: a -&gt; Colour\n\nclass IsColour a where\n  asColour :: a -&gt; Colour\n\nclass CanColour a where\n  doColour :: Colour -&gt; a -&gt; a\n\nclass Colourer a where\n  colour :: CanColour b =&gt; a -&gt; b -&gt; b\n</code></pre>\n\n<p>The thing I like most from this convention is the concept of giving different meaning to prefix and suffix. This consideration made me write <code>CanColour</code> instead of <code>Colourable</code>, since something that is colorable is thought of as having an internal state that changes. </p>\n\n<p>Regarding the specifics of \"color\" and \"name\", note that these nouns are also verbs. You can name people, you can color hair. I don't find adding an -er to either of these at all objectionable for code--especially measured against the gains of a consistent convention. In my example i use the verb form of color for the member function, so i will only ever use \"colorer\" in class constraints, which seems fine to me.</p>\n\n<p>Now, this convention ultimately will break down at some point, but until it does it should help the user (you) make reasonable guesses on calling conventions when using the library. It should also help guide you when developing new classes.</p>\n\n<p>So this is one suggestion. Among the packages of Hackage, I don't believe there's a clear standard to guide your design. There are some fair criticisms to the premise of this question (found in its comments). However, the intended design <em>does</em> come with precedent. The <code>diagrams</code> package, for instance, seems to do something exactly like what you are attempting here. It is a well constructed library written by a very well regarded author. </p>\n\n<p><code>diagrams</code> uses prefixes: Is- <a href=\"http://hackage.haskell.org/package/diagrams-core-1.4.1.1/docs/Diagrams-Core-Names.html\" rel=\"nofollow noreferrer\">IsName</a>; Has- <a href=\"http://hackage.haskell.org/package/diagrams-core-1.4.1.1/docs/Diagrams-Core-HasOrigin.html\" rel=\"nofollow noreferrer\">HasOrigin</a>. It uses suffixes: -ed, <a href=\"http://hackage.haskell.org/package/diagrams-core-1.4.1.1/docs/Diagrams-Core-Trace.html\" rel=\"nofollow noreferrer\">Traced</a>; -able, <a href=\"http://hackage.haskell.org/package/diagrams-core-1.4.1.1/docs/Diagrams-Core-Transform.html\" rel=\"nofollow noreferrer\">Transformable</a>. Okay, it uses too many, perhaps? It seems to me that a little more self consistency could have been gained with, for instance, <code>HasTrace</code> as opposed to <code>Traced</code>.</p>\n\n<p>So whatever the standard you adopt, since there is no clear consensus of how to do it, you should at least strive for self-consistency of names to concepts and clearly spell out in comments the adopted standard.</p>\n"}], "owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 1, "accepted_answer_id": 51749310, "answer_count": 1, "score": 2, "last_activity_date": 1533738805, "creation_date": 1533396912, "last_edit_date": 1533492666, "question_id": 51687101, "link": "https://stackoverflow.com/questions/51687101/single-function-typeclass-naming-in-haskell-er-vs-has", "title": "Single-function typeclass naming in Haskell | &quot;er&quot; vs &quot;has&quot;", "body": "<p>I find it sometimes hard to come up with reasonable single-function typeclass names. If the method name is a regular verb (like get, write, read...), it's easy to do the same thing Gophers do with single-method interfaces - stick an \"er\" to the back (Getter, Writer, Reader...) an done. But! If the function name is a noun (name, color...) then adding an \"er\" to the back no longer works. <strong>Namer</strong> and <strong>Colorer</strong> sound too weird because these words are no longer proper English.</p>\n\n<p>One solution could be to add a \"has\" to the front. One then would get things like HasName, HasColor and also it would work for verbs - HasGet and HasWrite for example. Is this a good approach or not? What are recommended ways to name single-function typeclasses that house noun-ish things?</p>\n"}, {"tags": ["haskell", "types", "exception-handling", "io", "monads"], "answers": [{"comments": [{"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1533584980, "post_id": 51684385, "comment_id": 90390744, "body": "I usually use <code>(\\e -&gt; pure $ const Nothing (e :: IOException))</code>. I find it to be a little less cluttered than the alternatives."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1533375934, "creation_date": 1533375934, "answer_id": 51684385, "question_id": 51684238, "link": "https://stackoverflow.com/questions/51684238/how-to-implement-a-safereadfile-function-yielding-maybe-string-in-haskell/51684385#51684385", "title": "How to implement a safeReadFile function yielding Maybe String in Haskell", "body": "<p>You have to specify which exception type you want to catch. <code>safeLoadFile</code> explicitly mentions <code>IOException</code>, while <code>safeLoadFile'</code> does not.</p>\n\n<p>Try this instead:</p>\n\n<pre><code>safeLoadFile' :: FilePath -&gt; IO (Maybe String)\nsafeLoadFile' p =\n    (Just &lt;$&gt; loadFile p) `catch` \n    ((\\e -&gt; pure Nothing) :: IOException -&gt; IO (Maybe String))\n</code></pre>\n\n<p>Or find some similar way to annotate the type for variable <code>e</code>. For instance <code>(\\ (e :: IOException) -&gt; ...)</code> can be also used, if you turn on <code>ScopedTypeVariables</code>.</p>\n\n<p>Yet another alternative:</p>\n\n<pre><code>safeLoadFile' :: FilePath -&gt; IO (Maybe String)\nsafeLoadFile' p = (Just &lt;$&gt; loadFile p) `catch` handler\n   where\n   handler :: IOException -&gt; IO (Maybe String)\n   handler _ = pure Nothing\n</code></pre>\n"}], "owner": {"reputation": 885, "user_id": 1704462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6664ce416d2ff42b5e5ac4add93a1b6d?s=128&d=identicon&r=PG&f=1", "display_name": "pangiole", "link": "https://stackoverflow.com/users/1704462/pangiole"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1534091970, "creation_date": 1533374812, "last_edit_date": 1534091970, "question_id": 51684238, "link": "https://stackoverflow.com/questions/51684238/how-to-implement-a-safereadfile-function-yielding-maybe-string-in-haskell", "title": "How to implement a safeReadFile function yielding Maybe String in Haskell", "body": "<p>I am trying to implement a safe <code>loadFile</code> function in Haskell which catches any exception and yields a <code>Maybe String</code> but the following implementation does not compile</p>\n\n<pre><code> import System.IO         (readFile)\n import Control.Exception (catch, IOException)\n\n -- readFile :: FilePath -&gt; IO String\n\n -- this compiles good\n safeReadFile :: FilePath -&gt; IO (Either IOException String)\n safeReadFile p =\n    (Right &lt;$&gt; readFile p) `catch`\n    (\\e -&gt; pure $ Left e)\n\n -- this does not!\n safeReadFile' :: FilePath -&gt; IO (Maybe String)\n safeReadFile' p =\n    (Just &lt;$&gt; readFile p) `catch` \n    (\\e -&gt; pure Nothing)\n</code></pre>\n\n<p>Can anybody explain why the GCH is raising the following issue, please?</p>\n\n<pre><code>  Ambiguous type variable \u2018e0\u2019 arising from a use of \u2018catch\u2019\n  prevents the constraint \u2018(GHC.Exception.Exception\n                              e0)\u2019 from being solved.\n  Probable fix: use a type annotation to specify what \u2018e0\u2019 should be.\n  These potential instances exist:\n    instance GHC.Exception.Exception IOException\n      -- Defined in \u2018GHC.IO.Exception\u2019\n    ...plus 20 instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n</code></pre>\n\n<p>How can I apply the necessary type annotation on the <code>e</code> variable? Haskell document doesn't give any clues :-(</p>\n"}, {"tags": ["haskell", "fixpoint-combinators"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1533368914, "post_id": 51683361, "comment_id": 90329629, "body": "Can you elaborate? Are you talking about fixed points at the term level (e.g. recursive functions) or at the type level (recursive types)? Also note that in a CPO with bottom every continuous function has a least fixed point, but can have no greatest fixed point (<code>id @Bool</code> only has least = bottom). (Further, if generalized a bit, this might be more in scope at CS.SE instead of SO -- even if the Haskell community has a broadish scope here on SO, and on CS.SE the community is not that large.)"}, {"owner": {"reputation": 249, "user_id": 4643591, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206103105435558/picture?type=large", "display_name": "Marius Catalin", "link": "https://stackoverflow.com/users/4643591/marius-catalin"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1533371802, "post_id": 51683361, "comment_id": 90330193, "body": "At the type level, the fix point of a functor. I find this mentioned in various places, in <a href=\"https://www.schoolofhaskell.com/user/edwardk/moore/for-less\" rel=\"nofollow noreferrer\">schoolofhaskell.com/user/edwardk/moore/for-less</a> or in <a href=\"http://www.cs.ox.ac.uk/jeremy.gibbons/publications/adt.pdf\" rel=\"nofollow noreferrer\">cs.ox.ac.uk/jeremy.gibbons/publications/adt.pdf</a> , but I can&#39;t make a picture"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1533420551, "post_id": 51685581, "comment_id": 90341571, "body": "I&#39;m unsatisfied by this answer -- the topic is non trivial, and would require a proper proof. For instance, even in the list example above, why couldn&#39;t the final coalgebra contain, beyond the lists mentioned above, some &quot;longer&quot; sequence as well? By longer, here, I mean a larger ordinal. The result might depend on the category at hand, or on some assumptions on the functor -- it&#39;s hard to see unless a painful formalization is done (IMO)."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 0, "creation_date": 1533428621, "post_id": 51685581, "comment_id": 90342824, "body": "The Wikipedia CPO page you link to opens by saying three are three different definitions that are referred to as CPOs. It might improve the answer if you say which one you&#39;re talking about."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1533449260, "post_id": 51685581, "comment_id": 90345240, "body": "@Ben The link was added by someone else, and all of the definitions imply the property I stated upfront, and that is also all I need in my answer, so it doesn&#39;t seem helpful to tell apart this or that flavor of CPO. But this is exactly the definition of omega-cpo (the third one), and the article mentions that the first two are strictly finer notions."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1533458070, "post_id": 51685581, "comment_id": 90346879, "body": "@chi It&#39;s not that painful to check that <code>[]</code> is <i>a</i> final coalgebra, which is then unique up to isomorphism. I just edited my answer to expand on that point."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1533458906, "post_id": 51685581, "comment_id": 90347058, "body": "Thanks. Set paradoxes can probably be avoided if one takes the category of CPOs whose cardinality is &lt;= some given cardinal. Even there, perhaps <code>[]</code> indeed turn out to be the final coalgebra, and that the unique morphism from a &quot;big list&quot; to <code>[]</code> is the truncation to the first omega elements."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 6, "last_activity_date": 1533457954, "last_edit_date": 1533457954, "creation_date": 1533385868, "answer_id": 51685581, "question_id": 51683361, "link": "https://stackoverflow.com/questions/51683361/least-fix-point-greatest-fix-point/51685581#51685581", "title": "Least fix point, greatest fix point", "body": "<p>In a <a href=\"https://en.wikipedia.org/wiki/Complete_partial_order\" rel=\"nofollow noreferrer\">CPO</a> (which we interpret a type as), any increasing chain has a least upper bound.</p>\n\n<p>Here's an example that should convey the intuition why, in the domain of CPOs, least fixed points and greatest fixed points coincide. Consider the following functor, abusing the list notation for conciseness:</p>\n\n<pre><code>data ListF a x = [] | a : x\n</code></pre>\n\n<p>Its greatest fixed point is the type of Haskell lists (possibly infinite, possibly partial). What about its least fixed point? The following elements must be in it (<code>Fix</code> constructors are omitted):</p>\n\n<pre><code>0 : _|_\n0 : 1 : _|_\n0 : 1 : 2 : _|_\n...\n</code></pre>\n\n<p>And they form an increasing chain, so there must be a least upper bound, which has to be the infinite list of natural integers <code>0 : 1 : 2 : ...</code>. So the least fixed point of <code>ListF</code> contains infinite lists, and consequently coincides with the greatest fixed point.</p>\n\n<hr>\n\n<p>As was pointed out in the comments, the claim that the greatest fixed point is given by the type <code>[]</code> may need clarification. For instance, wouldn't some CPO \"<code>BigList</code>\" of lists indexed by large ordinals make an even greater fixed point?</p>\n\n<p>One can first show that <code>[]</code> satisfies the definition of a final <code>ListF</code>-coalgebra. Then, a property of final coalgebras is that they are unique up to isomorphism. Therefore, lists indexed by larger ordinals would result in a non-isomorphic CPO, so that cannot be a final coalgebra.</p>\n\n<p>I could stop there, but hold on, isn't <code>BigList</code> still a greater fixed point of <code>ListF</code>? My conclusion is to chalk the issue up to bad terminology and formally we should only discuss \"final coalgebras\", and not \"greatest fixed points\".</p>\n\n<p>Depending on how you define a \"fixed point\" of a functor in CPO and a notion of (pre)order between CPOs, you may find that <code>BigList</code> is a fixed point of <code>ListF</code>, that it is greater than <code>[]</code>, that you run into set-theoretic paradoxes when reaching towards the \"greatest fixed point\", and that ultimately there is nothing of value to Haskell practitioners in that way of formalizing a \"greatest fixed point\" because you actually wanted the nice properties of a final coalgebra.</p>\n\n<p>(I'd be interested to know of a direct way to define \"fixed point\" that excludes <code>BigList</code> as one.)</p>\n\n<p>So instead, the term \"greatest fixed point\" might as well be a synonym for \"final coalgebra\". Some intuition carries over (\"fixed points\" can commonly be approached by iteration), some doesn't (it's not \"greatest\" in a set-theoretic sense).</p>\n"}], "owner": {"reputation": 249, "user_id": 4643591, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206103105435558/picture?type=large", "display_name": "Marius Catalin", "link": "https://stackoverflow.com/users/4643591/marius-catalin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 1, "accepted_answer_id": 51685581, "answer_count": 1, "score": 6, "last_activity_date": 1586400139, "creation_date": 1533366494, "last_edit_date": 1586400139, "question_id": 51683361, "link": "https://stackoverflow.com/questions/51683361/least-fix-point-greatest-fix-point", "title": "Least fix point, greatest fix point", "body": "<p>How come the least fix point coincides with the greatest fix point in a lazy non-total language like Haskell. What does continuity on complete partial orders  have to do with that?</p>\n"}, {"tags": ["haskell", "common-lisp", "ghc", "sbcl", "cffi"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1533365826, "post_id": 51683144, "comment_id": 90329096, "body": "<code>{NULL}</code> is a worrying argument. What about <code>{&quot;&quot;}</code> instead? Also, try calling it from C&#39;s <code>main()</code> as well, to find out whether your problem is in the C-&gt;Haskell layer or the SBCL-&gt;C layer."}, {"owner": {"reputation": 141, "user_id": 6800718, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/2b94f8d3b0f93f4f722e13b7ba20aba8?s=128&d=identicon&r=PG&f=1", "display_name": "Dimitris", "link": "https://stackoverflow.com/users/6800718/dimitris"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1533366542, "post_id": 51683144, "comment_id": 90329227, "body": "The C-Haskell case is working with no problem, i.e. having a main in c and linking the exact same dynamic library. Also {&quot;&quot;} didn&#39;t make any different."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1533397885, "post_id": 51683144, "comment_id": 90336412, "body": "Maybe add some printf to see where in your function the crash happens? Are you running sbcl in slime? If you are then maybe try at a command line (single thread)"}, {"owner": {"reputation": 141, "user_id": 6800718, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/2b94f8d3b0f93f4f722e13b7ba20aba8?s=128&d=identicon&r=PG&f=1", "display_name": "Dimitris", "link": "https://stackoverflow.com/users/6800718/dimitris"}, "edited": false, "score": 0, "creation_date": 1533402913, "post_id": 51683144, "comment_id": 90337665, "body": "The crash happens at fibonacci_hs. If I comment out that line the crash happens at hs_exit. When only hs_exit is commented out the program crashes at fibonacci_hs. These tests were performed without slime."}, {"owner": {"reputation": 141, "user_id": 6800718, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/2b94f8d3b0f93f4f722e13b7ba20aba8?s=128&d=identicon&r=PG&f=1", "display_name": "Dimitris", "link": "https://stackoverflow.com/users/6800718/dimitris"}, "edited": false, "score": 2, "creation_date": 1533827476, "post_id": 51683144, "comment_id": 90499637, "body": "Update: With ghc version 8.0.1 and sbcl version 1.3.14 on a different debian pc the exactly same code and commands (except from the library numbers) works!"}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 0, "creation_date": 1534069882, "post_id": 51683144, "comment_id": 90571013, "body": "@Dimitris this is weird but I\u2019m glad it worked. Perhaps you were somehow building your C program for one version of ghc and your Haskell program for another. Or maybe you had discovered a ghc bug which was fixed in a later version."}], "owner": {"reputation": 141, "user_id": 6800718, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/2b94f8d3b0f93f4f722e13b7ba20aba8?s=128&d=identicon&r=PG&f=1", "display_name": "Dimitris", "link": "https://stackoverflow.com/users/6800718/dimitris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 312, "favorite_count": 0, "answer_count": 0, "score": 6, "last_activity_date": 1533984419, "creation_date": 1533364370, "last_edit_date": 1533984419, "question_id": 51683144, "link": "https://stackoverflow.com/questions/51683144/calling-haskell-from-common-lisp-sbcl", "title": "Calling Haskell from Common Lisp (SBCL)", "body": "<p>I am trying to call Haskell (ghc version 7.6.3) from Common Lisp (sbcl version 1.2.4) on a debian pc. </p>\n\n<p>The Haskell code is</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE ForeignFunctionInterface #-}\n\nmodule Safe where\n\nimport Foreign.C.Types\n\nfibonacci :: Int -&gt; Int\nfibonacci n = fibs !! n\n    where fibs = 0 : 1 : zipWith (+) fibs (tail fibs)\n\nfibonacci_hs :: CInt -&gt; CInt\nfibonacci_hs = fromIntegral . fibonacci . fromIntegral\n\nforeign export ccall fibonacci_hs :: CInt -&gt; CInt\n</code></pre>\n\n<p>and the C interface is</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;HsFFI.h&gt;\n#ifdef __GLASGOW_HASKELL__\n#include \"Safe_stub.h\"\nextern void __stginit_Safe(void);\n#endif\n#include &lt;stdio.h&gt;\n\nint foo(int i)\n{\n  int argc = 0;\n  char *argv[] = {NULL};\n  char **pargv = argv;\n\n  int f;\n\n  hs_init(&amp;argc, &amp;pargv);\n#ifdef __GLASGOW_HASKELL__\n  hs_add_root(__stginit_Safe);\n#endif\n\n  f = fibonacci_hs(i);\n\n  hs_exit();\n\n  return f;\n}\n</code></pre>\n\n<p>Compile and linking is done by the following commands:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>ghc -c -dynamic -fPIC Safe.hs\ngcc -c -fPIC -I`ghc --print-libdir`/include foo.c\nghc -o libfoo.so -dynamic -shared -lHSrts-ghc7.6.3 Safe.o foo.o\n</code></pre>\n\n<p>In sbcl, I load cffi with quicklisp, and then load the dynamic library</p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>(cffi:load-foreign-library \"~/work/test-haskell-lisp/libfoo.so\")\n</code></pre>\n\n<p>When I call the function <code>foo</code></p>\n\n<pre class=\"lang-lisp prettyprint-override\"><code>(cffi:foreign-funcall \"foo\" :int 3 :int)\n</code></pre>\n\n<p>I get the error \"Unhandled memory fault\" from sbcl. Any suggestions or ideas are welcome.</p>\n"}, {"tags": ["haskell", "ghc", "pragma"], "comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1533504596, "post_id": 51682304, "comment_id": 90358234, "body": "hmm - I can replicate the behaviour. Would it be an option for you to use stack/cabal to specify the <code>include-dirs</code> (I guess not, just asking to make sure)."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1533563931, "post_id": 51682304, "comment_id": 90379814, "body": "@epsilonhalbe: not really for my use case..."}], "answers": [{"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1533599641, "post_id": 51713930, "comment_id": 90395238, "body": "Well that&#39;s a bummer."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1533668534, "post_id": 51713930, "comment_id": 90428149, "body": "Is there a ticket to fix the doc bug?"}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": true, "score": 2, "last_activity_date": 1533581407, "creation_date": 1533581407, "answer_id": 51713930, "question_id": 51682304, "link": "https://stackoverflow.com/questions/51682304/setting-import-path-in-an-options-pragma/51713930#51713930", "title": "Setting import path in an OPTIONS pragma", "body": "<p>This appears to be a regression of a documentation bug that was <a href=\"https://ghc.haskell.org/trac/ghc/ticket/1108\" rel=\"nofollow noreferrer\">fixed</a> in 2007 and then re-broken in 2014 when a bunch of \"static\"s were changed to \"dynamic\"s in the flag reference table.  As per the linked bug report, the <code>-i</code> flag is not fully dynamic.  It can be <code>:set</code> in GHCi but can't be specified in an <code>OPTIONS_GHC</code> line.</p>\n"}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 51713930, "answer_count": 1, "score": 9, "last_activity_date": 1533581407, "creation_date": 1533355305, "last_edit_date": 1533398861, "question_id": 51682304, "link": "https://stackoverflow.com/questions/51682304/setting-import-path-in-an-options-pragma", "title": "Setting import path in an OPTIONS pragma", "body": "<p>According to the <a href=\"https://downloads.haskell.org/~ghc/8.4.3/docs/html/users_guide/flags.html#finding-imports\" rel=\"noreferrer\">GHC 8.4.3 flag reference</a>, the <code>-i</code> flag is <em>dynamic</em>, which means <a href=\"https://downloads.haskell.org/~ghc/8.4.3/docs/html/users_guide/using.html#command-line-options-in-source-files\" rel=\"noreferrer\">it should be settable by an <code>OPTIONS</code> pragma</a>.</p>\n\n<p>So I tried the following: </p>\n\n<pre><code>.\n\u251c\u2500\u2500 Main.hs\n\u2514\u2500\u2500 imp\n    \u2514\u2500\u2500 Imported.hs\n</code></pre>\n\n<p>Contents of <code>imp/Imported.hs</code>:</p>\n\n<pre><code>module Imported (foo) where\n\nfoo :: String\nfoo = \"Foo\"\n</code></pre>\n\n<p>Contents of <code>Main.hs</code>:</p>\n\n<pre><code>{-# OPTIONS_GHC -iimp #-}\nimport Imported (foo)\n\nmain :: IO ()\nmain = putStrLn foo\n</code></pre>\n\n<p>However, if I try to run <code>Main.hs</code> using <code>runhaskell</code>, it complains that <code>Imported</code> cannot be found:</p>\n\n<pre><code>$ runhaskell -v Main.hs\n...\nMain.hs:2:1: error:\n    Could not find module \u2018Imported\u2019\n    Locations searched:\n      Imported.hs\n      Imported.lhs\n      Imported.hsig\n      Imported.lhsig\n</code></pre>\n\n<p>How do I specify the <code>-i</code> flag in an <code>OPTIONS</code> pragma?</p>\n"}, {"tags": ["haskell", "higher-order-functions", "map-function", "partial-application"], "comments": [{"owner": {"reputation": 191, "user_id": 10152792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdbcaa874842feb6653e37899fbc0023?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Mroz", "link": "https://stackoverflow.com/users/10152792/daniel-mroz"}, "edited": false, "score": 3, "creation_date": 1533336237, "post_id": 51680886, "comment_id": 90324913, "body": "Look carefully at the types. <code>f</code> is of type <code>a -&gt; b -&gt;c</code>, so <code>f a</code> is a value of type <code>b -&gt; c</code>."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 191, "user_id": 10152792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdbcaa874842feb6653e37899fbc0023?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Mroz", "link": "https://stackoverflow.com/users/10152792/daniel-mroz"}, "edited": false, "score": 0, "creation_date": 1533336292, "post_id": 51680886, "comment_id": 90324924, "body": "Wow, get it &amp; thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 25321, "user_id": 163177, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e811b5337bcad19d52c8fed3a0ea0075?s=128&d=identicon&r=PG", "display_name": "John F. Miller", "link": "https://stackoverflow.com/users/163177/john-f-miller"}, "is_accepted": true, "score": 2, "last_activity_date": 1533492796, "last_edit_date": 1533492796, "creation_date": 1533401452, "answer_id": 51687718, "question_id": 51680886, "link": "https://stackoverflow.com/questions/51680886/isnt-map-takes-a-function-and-a-list-return-a-list/51687718#51687718", "title": "Isn&#39;t map takes a function and a list return a list?", "body": "<p>\"The part <code>(f a)</code> makes me confused.\"</p>\n\n<p>What is happening here is called <a href=\"https://wiki.haskell.org/Currying\" rel=\"nofollow noreferrer\">currying</a> and if you are coming to Haskell from imperative languages, it can be confusing.</p>\n\n<p>In Haskell, all functions technically take a single value and return a single value.  The returned value <em>could</em> be another function. Most programmers take the mental shortcut of thinking of functions taking all the values in their definition (the term is \"saturated\" BTW) and producing the final value, but even with this mental shortcut, there are a lot of times, like this, when it is not the case.</p>\n\n<p>The function <code>f</code> is a binary function, and <code>(f a)</code> is that function <em>partially applied</em>.  The type of <code>(f a) :: b -&gt; c</code>. </p>\n\n<blockquote>\n  <p><em>\"Then what does <code>map value bs</code> do?\"</em></p>\n</blockquote>\n\n<p>The <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\">map</a> function (<code>map :: (a-&gt;b) -&gt; [a] -&gt;[b]</code>) is part of the standard prelude. It takes a simple function and applies it to each element in a list. </p>\n\n<p>So let's take <code>map (f a) bs</code> apart:</p>\n\n<ul>\n<li><a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/Prelude.html#v:map\" rel=\"nofollow noreferrer\"><code>map :: (b-&gt;c) -&gt; [b] -&gt;[c]</code></a> applies a function to each element of a list</li>\n<li><code>(f a) :: b -&gt; c</code> using <a href=\"https://wiki.haskell.org/Currying\" rel=\"nofollow noreferrer\">currying</a> a function <code>f :: a -&gt; b -&gt; c</code> is applied to an <code>a</code> and returns a function <code>b -&gt; c</code></li>\n<li><code>bs</code> is the second list from <code>map2_List</code></li>\n<li>The result of this function is <code>[c]</code>,  the function <code>f</code> applied to one element of the first list then applied to every element of the second list.</li>\n</ul>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 0, "accepted_answer_id": 51687718, "answer_count": 1, "score": 1, "last_activity_date": 1533492876, "creation_date": 1533336073, "last_edit_date": 1533492876, "question_id": 51680886, "link": "https://stackoverflow.com/questions/51680886/isnt-map-takes-a-function-and-a-list-return-a-list", "title": "Isn&#39;t map takes a function and a list return a list?", "body": "<pre><code>map2_List :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nmap2_List f [] _ = []\nmap2_List f (a:as) bs = map (f a) bs ++ map2_List f as bs\n</code></pre>\n\n<p>This is an example from my lecture, which try to apply a binary function to all pairs of elements of two lists. The part <code>(f a)</code> makes me confused. Does it suppose to be a value but not a function? Then what does <code>map value bs</code> do?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 4, "creation_date": 1533330849, "post_id": 51680121, "comment_id": 90323552, "body": "Those two types are the same, though spelling it as <code>(Either e) a</code> makes it easier to match up against type classes like <code>Functor</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1533331261, "post_id": 51680121, "comment_id": 90323659, "body": "In Haskell all functions take <i>exactly</i> one parameter. This also applies for type constructors."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1533331423, "post_id": 51680121, "comment_id": 90323699, "body": "Ahhh, that&#39;s true. But can we use a curried form?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1533331470, "post_id": 51680121, "comment_id": 90323706, "body": "@user8314628: yes, in fact if <code>Either</code> is already a <code>Functor</code> instance, and if we look up the source code, we see <code>instance Functor (Either e) where ...</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 3, "last_activity_date": 1533331933, "creation_date": 1533331933, "answer_id": 51680319, "question_id": 51680121, "link": "https://stackoverflow.com/questions/51680121/how-to-modify-the-type-declaration-so-we-dont-have-to-change-either-to-be-a-typ/51680319#51680319", "title": "How to modify the type declaration so we don&#39;t have to change Either to be a type constructor?", "body": "<blockquote>\n  <p>can we modify the function, which will take 2 parameters so that we can write <code>Either e a</code> instead of <code>(Either e) a</code>. Though I'm not sure if it is a good idea.</p>\n</blockquote>\n\n<p>This is already the case, in Haskell <code>Either e a</code> is the <em>same</em> as <code>(Either e) a</code>. The former simply removes some \"noise\", but behind the curtains if you write <code>Either e a</code>, you have actually written <code>(Either e) a</code>.</p>\n\n<p>In Haskell every function takes exactly one parameter. This also holds for type constructors: a type constructor takes one type parameter. If we thus write types that require two or more type parameters, we actually have written a type constructor that takes one type and produces a new \"type constructor\" that will take other parameters.</p>\n\n<p>This concept is actually used frequently in typeclasses. Take for example the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/GHC.Base.html#Functor\" rel=\"nofollow noreferrer\"><strong><code>Functor</code> typeclass</strong></a> (the typeclass that defines the <code>fmap</code> function):</p>\n\n<blockquote><pre><code>class  Functor <b>f</b> where\n    fmap        :: (a -&gt; b) -> <b>f a</b> -&gt; <b>f b</b>\n    (&lt;$)        :: a -&gt; <b>f b</b> -&gt; <b>f a</b>\n    (&lt;$)        =  fmap . const</code></pre></blockquote>\n\n<p>We here see that <code>f</code> is a type constructor that takes a type parameter, since in the body of the typeclass, we make types <code>f a</code> and <code>f b</code>.</p>\n\n<p>If we then look to the <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/Data.Either.html#line-129\" rel=\"nofollow noreferrer\"><strong><code>Functor</code> instance of <code>Either</code></strong></a> we see:</p>\n\n<blockquote>\n<pre><code>instance Functor (Either e) where\n    fmap _ (Left x) = Left x\n    fmap f (Right y) = Right (f y)\n</code></pre>\n</blockquote>\n\n<p>(I replaced <code>(Either a)</code> with <code>(Either e)</code> since the <code>a</code> in the <code>instance</code> declaration is a different <code>a</code> than the one in the <code>class</code> definition, so to avoid confusion)</p>\n\n<p>So here <code>f</code> is <code>Either e</code>, and thus <code>f a</code> will be an <code>(Either e) a</code> or <code>Either e a</code>.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 51680319, "answer_count": 1, "score": 0, "last_activity_date": 1533331933, "creation_date": 1533330720, "last_edit_date": 1533330887, "question_id": 51680121, "link": "https://stackoverflow.com/questions/51680121/how-to-modify-the-type-declaration-so-we-dont-have-to-change-either-to-be-a-typ", "title": "How to modify the type declaration so we don&#39;t have to change Either to be a type constructor?", "body": "<pre><code>{- data Either e a = Left e | Right a\n   from the standard library.\n\n   It's like Maybe, but the \"no answer\" case carries extra data, perhaps some kind\n   of reason for why \"no answer\".\n-}\nfmap_Either :: (a -&gt; b) -&gt; (Either e) a -&gt; (Either e) b\nfmap_Either f (Left e) = Left e\nfmap_Either f (Right a) = Right (f a)\n</code></pre>\n\n<p>This is an example in my lecture. Since the function takes only one parameter <code>a</code> and the output will become type <code>b</code>. We have to change <code>Either e a</code> to be a type constructor <code>(Either e) a</code>. I am wondering can we modify the function, which will take 2 parameters so that we can write <code>Either e a</code> instead of <code>(Either e) a</code>. Though I'm not sure if it is a good idea.</p>\n"}, {"tags": ["haskell", "vector", "proxy"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1533330293, "post_id": 51679970, "comment_id": 90323405, "body": "This isn&#39;t possible, since you must know the size of the vectors at compile time. You can&#39;t just convert from an <code>Integer</code> to a proxy. To see why, imagine what the type of that function would be."}, {"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 2, "creation_date": 1533408570, "post_id": 51679970, "comment_id": 90339056, "body": "Isn&#39;t this what <code>someNatVal</code> is for? <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/GHC-TypeLits.html\" rel=\"nofollow noreferrer\">Docs</a>."}], "answers": [{"tags": [], "owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "is_accepted": true, "score": 4, "last_activity_date": 1533330985, "creation_date": 1533330985, "answer_id": 51680171, "question_id": 51679970, "link": "https://stackoverflow.com/questions/51679970/in-haskell-how-do-i-turn-an-integer-into-a-proxy-n-knownnat-with-n-equal-t/51680171#51680171", "title": "In Haskell, how do I turn an Integer into a Proxy (n :: KnownNat) with n equal to the integer?", "body": "<p>Generally, you can\u2019t. The meaning of a <code>KnownNat n</code> constraint is that <code>n</code> is a type-level natural number <strong>with a value that\u2019s known at compile-time</strong>. An <code>Integer</code> represents an integer value that\u2019s known at <em>runtime</em>, and it can be influenced by all sorts of factors that might not be known until runtime (such as user input, randomness, the state of the filesystem, accessing a database, reading from the file system, etc.).</p>\n\n<p>The purpose of <code>Data.Vector.Sized</code> is to perform <strong>compile-time</strong> bounds checks, which of course can\u2019t be done without knowing something about the size at compile-time. Once you have an <code>Integer</code>, you can\u2019t magically convert it to a <code>Nat</code> because that would require divining at compile-time the value it will eventually have at runtime, when in fact it might not even always be the same value every time.</p>\n\n<p>Depending on what you\u2019re trying to do, there might be various ways to encode what you want. For example, you can use something like <a href=\"https://hackage.haskell.org/package/finite-typelits-0.1.3.0/docs/Data-Finite.html#v:packFinite\" rel=\"nofollow noreferrer\"><code>packFinite</code></a> to produce some evidence at runtime that an integer is within a given range, and you can use <a href=\"https://hackage.haskell.org/package/vector-sized-1.0.4.0/docs/Data-Vector-Sized.html#v:knownLength\" rel=\"nofollow noreferrer\"><code>knownLength</code></a> to run a computation on a vector of unknown size, but neither of these really allow you to magic a <code>Nat</code> from an <code>Integer</code>, they merely convince they type system that you have performed the appropriate runtime checks in the case that your <code>Integer</code> actually falls outside the bounds you promised.</p>\n"}], "owner": {"reputation": 1307, "user_id": 1549736, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/LBwQu.jpg?s=128&g=1", "display_name": "dbanas", "link": "https://stackoverflow.com/users/1549736/dbanas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 51680171, "answer_count": 1, "score": 2, "last_activity_date": 1533330985, "creation_date": 1533329574, "question_id": 51679970, "link": "https://stackoverflow.com/questions/51679970/in-haskell-how-do-i-turn-an-integer-into-a-proxy-n-knownnat-with-n-equal-t", "title": "In Haskell, how do I turn an Integer into a Proxy (n :: KnownNat) with n equal to the integer?", "body": "<p>I'm trying to use the <code>slice'</code> function from <code>Data.Vector.Sized</code>, but it wants the <em>starting position</em> and <em>length</em> in <code>Proxy n</code> form, as opposed to simple <code>Integer</code>s. I know what both numbers are, in <code>Integer</code> form. How can I convert them to <code>Proxy n</code> form, to use this function?</p>\n"}, {"tags": ["haskell", "module"], "comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 3, "creation_date": 1533329522, "post_id": 51679894, "comment_id": 90323131, "body": "try :browse FAM"}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "reply_to_user": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1533329587, "post_id": 51679894, "comment_id": 90323152, "body": "I got an error message <code>Could not find module \u2018FAM\u2019     It is not a module in the current program, or in any known package.</code> I tried <code>:browse Data</code> as well. And also got the same error."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1533333017, "post_id": 51679894, "comment_id": 90324156, "body": "Where is this FAM module? Is it a standalone file? in a cabal package? I&#39;d try to compile it and load in GHCi first. I&#39;d also try to generate haddock docs."}, {"owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "edited": false, "score": 0, "creation_date": 1533333197, "post_id": 51679894, "comment_id": 90324212, "body": "It&#39;s from my <a href=\"http://www.cs.utoronto.ca/~trebla/CSCC24-2018-Summer/FAM.hs\" rel=\"nofollow noreferrer\">lecture</a>"}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 1, "last_activity_date": 1533501086, "last_edit_date": 1533501086, "creation_date": 1533495511, "answer_id": 51697378, "question_id": 51679894, "link": "https://stackoverflow.com/questions/51679894/is-there-any-method-to-get-the-information-of-a-module-in-haskell/51697378#51697378", "title": "Is there any method to get the information of a module in Haskell?", "body": "<p>A module doesn't have a type, it just exports declarations.  If you want to see what declarations it exports (in a manner other than clicking the link you already have) then load the module in GHCi and browse it.</p>\n\n<p>For example, I have your FAM module saved in my tmp directory so I can load it in GHCi:</p>\n\n<pre><code>% ghci /tmp/FAM.hs\nGHCi, version 8.4.1: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /Users/tommd/.ghci\n[1 of 1] Compiling FAM              ( /tmp/FAM.hs, interpreted )\nOk, one module loaded.\n*FAM&gt;\n</code></pre>\n\n<p>Now I can ask for the declarations exported by the module with browse either leaving the module implicit (<code>:browse</code>) or specifying the module I'm interested in (<code>:browse FAM</code>) which is useful if more than one module is loaded. For example:</p>\n\n<pre><code>*FAM&gt; :browse FAM\nfmap_List :: (a -&gt; b) -&gt; [a] -&gt; [b]\nfmap_Maybe :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nfmap_Either :: (a -&gt; b) -&gt; Either e a -&gt; Either e b\ndata BinTree a = BTNil | BTNode a (BinTree a) (BinTree a)\nmap2_List :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nmap2_Maybe :: (a -&gt; b -&gt; c) -&gt; Maybe a -&gt; Maybe b -&gt; Maybe c\nmap2_Either ::\n  (a -&gt; b -&gt; c) -&gt; Either e a -&gt; Either e b -&gt; Either e c\nap_List :: [a -&gt; b] -&gt; [a] -&gt; [b]\nmap2_Listv2 :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nmap3_List :: (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]\naddRecip :: Double -&gt; Double -&gt; Maybe Double\nbind_Maybe :: Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b\nbind_Either :: Either e a -&gt; (a -&gt; Either e b) -&gt; Either e b\nbind_List :: [a] -&gt; (a -&gt; [b]) -&gt; [b]\ndata IntranetRecord = I Integer String\ndata BBRecord = B Integer String\ndata MarkUsRecord = M String String\nmyJoin :: [IntranetRecord] -&gt; [BBRecord] -&gt; [MarkUsRecord]\nmyJoin2 :: [IntranetRecord] -&gt; [BBRecord] -&gt; [MarkUsRecord]\nfoldM :: Monad m =&gt; (b -&gt; a -&gt; m b) -&gt; b -&gt; [a] -&gt; m b\nnewtype State s a = StateOf (s -&gt; (s, a))\ndeState :: State s a -&gt; s -&gt; (s, a)\nput :: s -&gt; State s ()\nget :: State s s\nstatefulSum :: [Integer] -&gt; State Integer Integer\ntoyCheck :: IO Bool\nclass Monad f =&gt; MonadToyCheck (f :: * -&gt; *) where\n  toyGetChar :: f Char\n  {-# MINIMAL toyGetChar #-}\ntoyCheck2 :: MonadToyCheck f =&gt; f Bool\nrealProgram :: IO Bool\nnewtype Feeder a = F (String -&gt; (String, a))\nunF :: Feeder a -&gt; String -&gt; (String, a)\ntestToyChecker2 :: String -&gt; Bool\n</code></pre>\n\n<p>From here you can inspect the types, classes, and functions exported by your module.</p>\n"}], "owner": {"reputation": 1377, "user_id": 8314628, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0eefa2c64f533d21e1d8f58e4252a1e9?s=128&d=identicon&r=PG&f=1", "display_name": "user8314628", "link": "https://stackoverflow.com/users/8314628/user8314628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 51697378, "answer_count": 1, "score": 0, "last_activity_date": 1533501086, "creation_date": 1533329076, "question_id": 51679894, "link": "https://stackoverflow.com/questions/51679894/is-there-any-method-to-get-the-information-of-a-module-in-haskell", "title": "Is there any method to get the information of a module in Haskell?", "body": "<pre><code>module FAM where\n</code></pre>\n\n<p>I have no idea what FAM does. So I want to get some information about it.</p>\n\n<p>By using <code>:t</code> and <code>:i</code>, we will get the type of a variable and the information of an instance respectively. Is there any method to get the information of a module?</p>\n"}, {"tags": ["haskell", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "edited": false, "score": 0, "creation_date": 1533327604, "post_id": 51679567, "comment_id": 90322459, "body": "Now how would I run that with <a href=\"http://hackage.haskell.org/package/servant-server-0.14.1/docs/Servant-Server-Internal-Handler.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/servant-server-0.14.1/docs/&hellip;</a> ?"}], "tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": -1, "last_activity_date": 1533327339, "creation_date": 1533327339, "answer_id": 51679567, "question_id": 51679147, "link": "https://stackoverflow.com/questions/51679147/combining-persistents-sqlpersistt-with-servants-handler/51679567#51679567", "title": "Combining Persistents SqlPersistT with Servants Handler", "body": "<p>This compiles with <code>persistent-2.8.2</code>:</p>\n\n<pre><code>runQuery :: MonadUnliftIO m =&gt; ReaderT SqlBackend m b -&gt; App m b\nrunQuery query =\n    asks getPool &gt;&gt;= lift . runSqlPool query\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "is_accepted": false, "score": 1, "last_activity_date": 1533328572, "creation_date": 1533328572, "answer_id": 51679811, "question_id": 51679147, "link": "https://stackoverflow.com/questions/51679147/combining-persistents-sqlpersistt-with-servants-handler/51679811#51679811", "title": "Combining Persistents SqlPersistT with Servants Handler", "body": "<p>It seems this may be an intentional design descision of <code>MonadUnliftIO</code>, looking at the readme here <a href=\"https://www.stackage.org/package/unliftio\" rel=\"nofollow noreferrer\">https://www.stackage.org/package/unliftio</a> under 'Limitations' it states that it does not support \"Transformers with multiple exit points (e.g., ExceptT)\", and Servant's <code>Handler</code> is a wrapper around <code>ExceptT</code>. I may just need to find another way of writing this code.</p>\n"}], "owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1533328572, "creation_date": 1533325158, "last_edit_date": 1533328537, "question_id": 51679147, "link": "https://stackoverflow.com/questions/51679147/combining-persistents-sqlpersistt-with-servants-handler", "title": "Combining Persistents SqlPersistT with Servants Handler", "body": "<p>I'm trying to define a helper function that will allow me to run queries using a connection pool provided when run in the <code>Reader</code> monad. I would like to define a function that will abstract away the <code>asks</code> part of fetching the pool, like so:</p>\n\n<pre><code>type Config = Config { getPool :: ConnectionPool }\n\ntype App = ReaderT Config\n\nrunQuery :: MonadBaseControl IO m =&gt; SqlPersistT m a -&gt; App m a\nrunQuery query =\n  asks getPool &gt;&gt;= lift . runSqlQuery\n</code></pre>\n\n<p>Though I am having trouble getting this to compile... I could have sworn this code had worked on a previous project, and low and behold it had. When I went to look at the definitions of <code>Handler</code> (the <code>m</code> I want in <code>App m</code>), and <code>runSqlQuery</code> they both differ. It seems that <code>Handler</code> has an instance for <code>MonadBaseControl IO m</code> whereas <code>runSqlQuery</code> uses <code>MonadUnliftIO</code>, however, looking back to the change prior to when <code>MonadUnliftIO</code> was added, <code>runSqlQuery</code> used <code>MonadBaseControl IO m</code>... which I presume is why my previous code worked in this instance.</p>\n\n<p>So I suppose my question is, how can I change my implementation of <code>runQuery</code> to support the fact that <code>runSqlQuery</code> is based off of <code>MonadUnliftIO</code> now? I had a look through the functions <code>MonadUnliftIO</code> provides (namely <code>unliftIO</code>) but I have been unable to figure out a way to make the types fit.</p>\n"}, {"tags": ["haskell", "max", "monoids", "bounded-types", "foldable"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1533310698, "post_id": 51675691, "comment_id": 90315044, "body": "I think <code>max 0 . maximum . map width</code> would be more appropriate than trying to introduce a valid monoid."}, {"owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1533311008, "post_id": 51675691, "comment_id": 90315195, "body": "As far as I understand, that would crash on an empty data structure."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1533311645, "post_id": 51675691, "comment_id": 90315598, "body": "What about <code>max 0 . Map.foldr max 0</code>? It&#39;s a bit redundant, but not too bad."}], "answers": [{"tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": true, "score": 4, "last_activity_date": 1533312698, "last_edit_date": 1533312698, "creation_date": 1533311824, "answer_id": 51676321, "question_id": 51675691, "link": "https://stackoverflow.com/questions/51675691/how-to-compute-the-maximum-of-a-floating-point-property-of-a-foldable-via-foldma/51676321#51676321", "title": "How to compute the maximum of a floating point property of a Foldable via foldMap?", "body": "<p>You can use the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Semigroup.html#t:Option\" rel=\"nofollow noreferrer\"><strong><code>Option</code></strong></a> monoid to get a monoid instance for any <code>Semigroup</code>. <code>Option a</code> is just a newtype wrapper over <code>Maybe a</code>, but it's <code>Monoid</code> instance only requires <code>Semigroup a</code> rather than <code>Monoid a</code>. So we can use it with <code>Max</code>:  </p>\n\n<pre><code>maximumMaybe :: (Ord a, Foldable t) =&gt; t a -&gt; Maybe a\nmaximumMaybe = fmap getMax . getOption . foldMap (Option . Just . Max)  \n</code></pre>\n\n<p>If you want a default value for the empty list case, you can use <code>fromMaybe</code>:</p>\n\n<pre><code>maximumWithDefault :: (Ord a, Foldable t) =&gt; a -&gt; t a -&gt; a \nmaximumWithDefault d = fromMaybe d . maximumMaybe\n</code></pre>\n\n<p>Another option is to just use <a href=\"https://hackage.haskell.org/package/safe-0.3.17/docs/Safe-Foldable.html#v:maximumMay\" rel=\"nofollow noreferrer\"><strong><code>maximumMay :: (Ord a, Foldable t) =&gt; t a -&gt; Maybe a</code></strong></a> from the <code>safe</code> package.</p>\n\n<p>If you are using <code>base-4.11.0</code> or higher, you no longer need the <code>Option a</code> type since the restriction on <code>Monoid (Maybe a)</code> has been lifted to <code>Semigroup a</code>. So as of <code>base-4.11.0</code>, which came with GHC 8.4.1, you can write:</p>\n\n<pre><code>maximumMaybe :: (Ord a, Foldable t) =&gt; t a -&gt; Maybe a\nmaximumMaybe = fmap getMax . foldMap (Just . Max)  \n</code></pre>\n"}], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 51676321, "answer_count": 1, "score": 0, "last_activity_date": 1533312698, "creation_date": 1533309535, "last_edit_date": 1533310952, "question_id": 51675691, "link": "https://stackoverflow.com/questions/51675691/how-to-compute-the-maximum-of-a-floating-point-property-of-a-foldable-via-foldma", "title": "How to compute the maximum of a floating point property of a Foldable via foldMap?", "body": "<p>Say I have a map with measurable objects, and I'd like the maximum of their widths, defaulting to 0. The machinery of <code>Foldable</code> (<a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Foldable.html#v:foldMap\" rel=\"nofollow noreferrer\"><code>foldMap</code></a>) and <code>Semigroup</code> (<a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Data-Semigroup.html#t:Max\" rel=\"nofollow noreferrer\"><code>Max</code></a>) seems perfect, except that I can't seem to introduce the arbitrary lower bound.</p>\n\n<pre><code>data Thing\n\nwidth :: Thing -&gt; Double\n\nmaxWidth :: Map k Thing -&gt; Double\nmaxWidth things = getMax . foldMap (Max . width) $ things\n</code></pre>\n\n<p>This rightly complains about the missing <code>Bounded</code> instance for <code>Double</code>, since the <code>Monoid</code> instance of <code>Max a</code> uses <code>mempty = minBound</code>.</p>\n\n<p>I see that the source for <code>Data.Foldable</code> uses a different definition of <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/Data.Functor.Utils.html#Max\" rel=\"nofollow noreferrer\"><code>newtype Max</code></a> to implement <a href=\"http://hackage.haskell.org/package/base-4.11.1.0/docs/src/Data.Foldable.html#maximum\" rel=\"nofollow noreferrer\"><code>maximum</code></a>. That variant would do nicely, but it seems to not be exported:</p>\n\n<pre><code>maxWidth things = fromMaybe 0 . getMax . foldMap (Max . Just . width) $ things\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2531, "user_id": 6084317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4295c9b1ada748080d7a123f7263ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Edward Minnix", "link": "https://stackoverflow.com/users/6084317/edward-minnix"}, "is_accepted": false, "score": 8, "last_activity_date": 1533309637, "creation_date": 1533309637, "answer_id": 51675719, "question_id": 51675672, "link": "https://stackoverflow.com/questions/51675672/haskell-sum-of-one-element-of-tuples/51675719#51675719", "title": "Haskell sum of one element of tuples", "body": "<p>For this you could use <code>map</code> and the built in <code>sum</code></p>\n\n<pre><code> sum $ map fst [(10, \"x\"), (100, \"y\"), (-54, \"z\")]\n</code></pre>\n\n<p>where <code>fst</code> is the built in which if the equivalent of</p>\n\n<pre><code> fst (x, y) = x\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1533309935, "post_id": 51675784, "comment_id": 90314623, "body": "You can also write that as <code>foldr ((+) . fst) 0</code>."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 1, "creation_date": 1533324107, "post_id": 51675784, "comment_id": 90320995, "body": "The compiler should get all these solutions down to one pass."}], "tags": [], "owner": {"reputation": 191, "user_id": 10152792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdbcaa874842feb6653e37899fbc0023?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Mroz", "link": "https://stackoverflow.com/users/10152792/daniel-mroz"}, "is_accepted": false, "score": 4, "last_activity_date": 1533309831, "creation_date": 1533309831, "answer_id": 51675784, "question_id": 51675672, "link": "https://stackoverflow.com/questions/51675672/haskell-sum-of-one-element-of-tuples/51675784#51675784", "title": "Haskell sum of one element of tuples", "body": "<p><code>foldr (\\(x,y) z -&gt; x+z) 0</code> will do it in one pass.</p>\n"}], "owner": {"reputation": 1375, "user_id": 1881719, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f9d319fb5c2669d9bab860c9b2227505?s=128&d=identicon&r=PG", "display_name": "Wouter Vandenputte", "link": "https://stackoverflow.com/users/1881719/wouter-vandenputte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1533309831, "creation_date": 1533309440, "question_id": 51675672, "link": "https://stackoverflow.com/questions/51675672/haskell-sum-of-one-element-of-tuples", "title": "Haskell sum of one element of tuples", "body": "<p>For example, I have a list of tuples (Int,String) </p>\n\n<pre><code>[ (10,\"x\"), (100,\"y\"), (-54,\"z\") ]\n</code></pre>\n\n<p>how do I calculate the sum of it (10+100-54) in Haskell as quick as possible ? \nI don't seem to get it with a fold function</p>\n"}, {"tags": ["haskell", "yesod", "persistent", "haskell-persistent"], "answers": [{"tags": [], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "is_accepted": true, "score": 1, "last_activity_date": 1533305959, "creation_date": 1533305959, "answer_id": 51674652, "question_id": 51674651, "link": "https://stackoverflow.com/questions/51674651/nologgingt-does-not-disable-logging-in-persistent/51674652#51674652", "title": "NoLoggingT does not disable logging in Persistent", "body": "<p>It seems that the logging function is assigned to the connection information itself, and <code>createSqlPool</code> assigns wherever you run your <code>createSqlitePool</code> in:</p>\n\n<pre><code>createSqlPool\n    :: (MonadLogger m, MonadUnliftIO m, IsSqlBackend backend)\n    =&gt; (LogFunc -&gt; IO backend)\n    -&gt; Int\n    -&gt; m (Pool backend)\ncreateSqlPool mkConn size = do\n    logFunc &lt;- askLogFunc\n    liftIO $ createPool (mkConn logFunc) close' 1 20 size\n</code></pre>\n\n<p>And <code>runSqlite</code> explicitly runs its code in a <code>NoLoggingT</code>:</p>\n\n<pre><code>runSqlite :: (MonadUnliftIO m, IsSqlBackend backend)\n          =&gt; Text -- ^ connection string\n          -&gt; ReaderT backend (NoLoggingT (ResourceT m)) a -- ^ database action\n          -&gt; m a\nrunSqlite connstr = runResourceT\n                  . runNoLoggingT\n                  . withSqliteConn connstr\n                  . runSqlConn\n</code></pre>\n\n<p>So if you change the code to:</p>\n\n<pre><code>  budgetPool &lt;- runNoLoggingT $ createSqlitePool \":memory:\" 1\n</code></pre>\n\n<p>it will stop logging. It still doesn't respect the <code>NoLoggingT</code> in the <code>selectFooBars</code> type annotation, which is slightly confusing.</p>\n"}], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "accepted_answer_id": 51674652, "answer_count": 1, "score": 0, "last_activity_date": 1533305959, "creation_date": 1533305959, "question_id": 51674651, "link": "https://stackoverflow.com/questions/51674651/nologgingt-does-not-disable-logging-in-persistent", "title": "NoLoggingT does not disable logging in Persistent", "body": "<p>I've made this piece of code and I'm puzzled with two things:</p>\n\n<ul>\n<li>why do the two pieces work differently, one logging and another not?</li>\n<li>why does the second piece log if there is a NoLoggingT wrapper added on the <code>selectFoobars</code>?</li>\n</ul>\n\n<p>Code:</p>\n\n<pre><code>{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Control.Monad.IO.Class\nimport Control.Monad.Logger.CallStack\nimport Control.Monad.Trans.Reader (ReaderT)\nimport Control.Monad.Trans.Resource (ResourceT)\nimport Data.String.Class (toString)\nimport Database.Esqueleto\nimport Database.Persist.Sqlite (createSqlitePool)\nimport qualified Database.Persist.Sqlite as P\nimport Database.Persist.TH\nimport GHC.Natural\nimport System.Log.FastLogger (fromLogStr)\n\ninstance MonadLogger IO where\n  monadLoggerLog _loc _src _lvl msg =\n    putStrLn (toString (fromLogStr (toLogStr msg)))\n\nshare\n  [mkPersist sqlSettings, mkMigrate \"migrateAll\"]\n  [persistLowerCase|\nFoo\n  bar Natural\n|]\n\nrunSomeQuery :: ConnectionPool -&gt; Natural -&gt; IO (Maybe Natural)\nrunSomeQuery pool aid = do\n  flip runSqlPersistMPool pool $ do\n    runMigration migrateAll\n    _ &lt;- selectFooBars aid\n    return Nothing\n\nselectFooBars ::\n     Natural -&gt; ReaderT SqlBackend (NoLoggingT (ResourceT IO)) [Entity Foo]\nselectFooBars aid = do\n  logDebugN \"This should not log?\"\n  select . from $ \\s -&gt; do\n    where_ $ (s ^. FooBar ==. val aid)\n    limit 1\n    return s\n\nmain :: IO ()\nmain = do\n  logDebugN \"MAIN\"\n  P.runSqlite \":memory:\" $ do\n    logDebugN \"STARTING UP 01\"\n    runMigration migrateAll\n    _ &lt;- selectFooBars 123\n    return ()\n  budgetPool &lt;- createSqlitePool \":memory:\" 1\n  logDebugN \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;\"\n  logDebugN \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;\"\n  logDebugN \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;\"\n  logDebugN \"STARTING UP 02\"\n  _ &lt;- runSomeQuery budgetPool 975\n  return ()\n</code></pre>\n\n<p>Fully buildable repo can be found at <a href=\"https://github.com/k-bx/nologesqueleto\" rel=\"nofollow noreferrer\">https://github.com/k-bx/nologesqueleto</a></p>\n"}, {"tags": ["haskell", "applicative", "monoids"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1533299061, "post_id": 51671633, "comment_id": 90307679, "body": "I could be wrong, but I think you are using the term &quot;monoidal functor&quot; to mean something other than its <a href=\"https://en.wikipedia.org/wiki/Monoidal_functor\" rel=\"nofollow noreferrer\">actual definition</a>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1533303317, "post_id": 51671633, "comment_id": 90310531, "body": "You&#39;re running into the same problem that means <code>Set</code> can&#39;t be a <code>Monad</code> (or <code>Applicative</code>), so the many discussions around that problem floating around the web should also be interesting to you. Consider googling &quot;constrained monad&quot; for many, many starting points."}], "answers": [{"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1533297272, "creation_date": 1533297272, "answer_id": 51672052, "question_id": 51671633, "link": "https://stackoverflow.com/questions/51671633/applicative-instance-trying-to-use-monoidal-functors/51672052#51672052", "title": "Applicative instance trying to use monoidal functors", "body": "<p>I don't think that <code>Pair</code> is an <code>Applicative</code> the way you want it to be, <code>Applicative</code> states that</p>\n\n<pre><code>(&lt;*&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>should work for all functions in first position whereas you want </p>\n\n<pre><code>(&lt;*&gt;) :: Semigroup b =&gt; f (a -&gt; b) -&gt; f a -&gt; f b.\n</code></pre>\n\n<p>If Pair was always a <code>Semigroup</code> (like <code>Maybe</code> or <code>List</code> for example) your reasoning would be sound, but you need the pre-requisite of the <code>Pair</code>-containee to be <code>Semigroup</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 10175838, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_QCvm_yANrY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rbiG5xdJw-JrEXhH1n1T4dxflssg/mo/photo.jpg?sz=128", "display_name": "simkestuff", "link": "https://stackoverflow.com/users/10175838/simkestuff"}, "edited": false, "score": 0, "creation_date": 1533315369, "post_id": 51673707, "comment_id": 90317373, "body": "Thanks! Being beginner it is somewhat hard to follow discussions but I think I understood part of it: applicative instance should work for all types that implement it while my implementation depended on fact  that type should implement instance of Semigroup (all the types regardless how deep they are in structure) and second the &quot;monoidal&quot; part should be about structure (in my case it is Pair constructor) not the values which I was trying to combine (this is what Monoid is doing)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 4, "last_activity_date": 1533302666, "creation_date": 1533302666, "answer_id": 51673707, "question_id": 51671633, "link": "https://stackoverflow.com/questions/51671633/applicative-instance-trying-to-use-monoidal-functors/51673707#51673707", "title": "Applicative instance trying to use monoidal functors", "body": "<p>Although it's true that <code>Applicative</code> is the class representing monoidal functors (specifically, <strong>Hask</strong> endofunctors which are monoidal), Allen&amp;Moronuki present this unfortunately in a way that seems to suggest a direct relation between the <code>Monoid</code> and <code>Applicative</code> classes. <em>There is, in general, no such relation</em>! (The <code>Writer</code> type  does define one particular <code>Applicative</code> instance based on the <code>Monoid</code> class, but that's an extremely special case.)<br>\nThis spawned <a href=\"https://stackoverflow.com/a/50703828/745903\">a rather extended discussion at another SO question</a>.</p>\n\n<p>What the \u201cmonoidal\u201d in \u201cmonoidal functor\u201d refers to is a monoidal structure on <em>the category's objects</em>, i.e. on Haskell types. Namely, you can combine any two types to a tuple-type. This has per se nothing whatsoever to do with the <code>Monoid</code> class, which is about combining two <em>values</em> of a single type to a value of the same type.</p>\n\n<p><code>Pair</code> does allow an <code>Applicative</code> instance, but you can't base it on the <code>Semigroup</code> instance, although the definition actually looks quite similar:</p>\n\n<pre><code>instance Applicative Pair where\n  pure x = Pair x x\n  Pair f g &lt;*&gt; Pair p q = Pair (f p) (g q)\n</code></pre>\n\n<p>However, you can now define the <code>Semigroup</code> instance <em>in terms of this</em>:</p>\n\n<pre><code>instance Semigroup a =&gt; Semigroup (Pair a) where\n  (&lt;&gt;) = liftA2 (&lt;&gt;)\n</code></pre>\n\n<p>That, indeed, is a valid <code>Semigroup</code> instance for <em>any</em> applicative, but it's usually not the definition you want (often, containers have a natural combination operation that never touches the contained elements, e.g. list concatenation).</p>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1533304331, "creation_date": 1533304331, "answer_id": 51674187, "question_id": 51671633, "link": "https://stackoverflow.com/questions/51671633/applicative-instance-trying-to-use-monoidal-functors/51674187#51674187", "title": "Applicative instance trying to use monoidal functors", "body": "<p>Correct: <code>Pair</code> can't be made an <code>Applicative</code> in the way you want, because <code>Applicative f</code> demands that <code>f a</code> \"feel applicative-y\" for <em>any</em> <code>a</code>, even non-<code>Semigroup</code> <code>a</code>s. Consider writing an alternative class and implementing it:</p>\n\n<pre><code>class CApplicative f where\n    type C f\n    pure :: C f a =&gt; a -&gt; f a\n    app  :: C f b =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\n\ninstance CApplicative Pair where\n    type C Pair = Semigroup\n    pure x = Pair x x\n    app (Pure f g) p = fmap f p &lt;&gt; fmap g p\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 10175838, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_QCvm_yANrY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rbiG5xdJw-JrEXhH1n1T4dxflssg/mo/photo.jpg?sz=128", "display_name": "simkestuff", "link": "https://stackoverflow.com/users/10175838/simkestuff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 51673707, "answer_count": 3, "score": 0, "last_activity_date": 1533304331, "creation_date": 1533295742, "question_id": 51671633, "link": "https://stackoverflow.com/questions/51671633/applicative-instance-trying-to-use-monoidal-functors", "title": "Applicative instance trying to use monoidal functors", "body": "<p>I'm learning Haskell and trying to do exercises from book Haskell Programming from first principles and I'm stack trying to write applicative for Pair type</p>\n\n<pre><code> data Pair a = Pair a a deriving Show\n</code></pre>\n\n<p>I have seen some other examples on web but I'm trying somewhat different applicative functor, I'm trying to utilize monoidal structure of this type. Here is what I have</p>\n\n<pre><code>data Pair a = Pair a a deriving (Show, Eq)\n\ninstance Functor Pair where\n     fmap f (Pair x y) = Pair (f x) (f y)\n\ninstance Semigroup a =&gt; Semigroup (Pair a) where\n    (Pair x y) &lt;&gt; (Pair x' y') = Pair (x &lt;&gt; x') (y &lt;&gt; y')\n\ninstance Applicative Pair where\n    pure x = Pair x x \n    (Pair f g) &lt;*&gt; p = fmap f p &lt;&gt; fmap g p\n</code></pre>\n\n<p>Unfortunately this will not compile:</p>\n\n<pre><code>* No instance for (Semigroup b) arising from a use of `&lt;&gt;'\n  Possible fix:\n    add (Semigroup b) to the context of\n      the type signature for:\n        (&lt;*&gt;) :: forall a b. Pair (a -&gt; b) -&gt; Pair a -&gt; Pair b\n* In the expression: fmap f p &lt;&gt; fmap g p\n  In an equation for `&lt;*&gt;': (Pair f g) &lt;*&gt; p = fmap f p &lt;&gt; fmap g p\n  In the instance declaration for `Applicative Pair'\n</code></pre>\n\n<p>And this is where I'm stack; I don't see how can I add typeclass constraint to Applicative definition and I thought that making type Pair instance of Semigroup is enough.</p>\n\n<p>Other solutions that I have seen are like</p>\n\n<pre><code>Pair (f g) &lt;*&gt; Pair x y = Pair (f x) (g y)\n</code></pre>\n\n<p>but these solutions don't utilize monoidal part of Pair type</p>\n\n<p>Is it even possible to make this applicative the way I't trying?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1533289934, "post_id": 51669820, "comment_id": 90302421, "body": "<code>flip(:)</code> is <code>flip</code> with <code>(:)</code> as function, so you here see <code>b -&gt; a -&gt; [c]</code> but specialized according with the type parameters of <code>(:)</code>."}, {"owner": {"reputation": 41, "user_id": 8778583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aab619f30a140dc2032572fc5f2a44d1?s=128&d=identicon&r=PG&f=1", "display_name": "Binjie Yuan", "link": "https://stackoverflow.com/users/8778583/binjie-yuan"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1533290030, "post_id": 51669820, "comment_id": 90302489, "body": "I forgot that <code>(:)</code> is also a function. Thank you very much!"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1533293306, "post_id": 51669820, "comment_id": 90304417, "body": "\u201c<i>Also</i> a function\u201d? What else <i>but</i> a function is it?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1533295563, "post_id": 51669820, "comment_id": 90305610, "body": "@leftaroundabout I think the &quot;also&quot; refers to &quot;<code>(:)</code>&quot;, not to &quot;function&quot; -- as in, &quot;<code>flip</code> is a function, and also <code>(:)</code> is a function&quot;, not &quot;<code>(:)</code> is a function, and also <code>(:)</code> is an X&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1533290308, "creation_date": 1533290308, "answer_id": 51670098, "question_id": 51669820, "link": "https://stackoverflow.com/questions/51669820/why-are-flip-and-flip-different-functions-in-haskell/51670098#51670098", "title": "Why are flip and flip(:) different functions in Haskell?", "body": "<p>The \"ingredients\" are:</p>\n\n<pre><code>flip :: (a -&gt; (b -&gt; c)) -&gt; (b -&gt; (a -&gt; c))\n(:) :: d -&gt; ([d] -&gt; [d])\n</code></pre>\n\n<p>So here <code>flip</code> can take a function (of type <code>a -&gt; b -&gt; c</code>), and it basically converts it to a function of type <code>b -&gt; a -&gt; c</code>, where thus the \"parameters\" (technically speaking in Haskell a function has <em>exactly</em> one parameter) are \"flipped\".</p>\n\n<p>If you write <code>flip (:)</code>, you thus flip the <code>(:)</code> function. Since the <code>(:)</code> function has type <code>d -&gt; [d] -&gt; [d]</code>, the result is <code>[d] -&gt; d -&gt; [d]</code>.</p>\n\n<p>We can however perform a more rigorous type inference. Since <code>(:)</code> is the parameter of a function application with <code>flip</code>, we know that the type of <code>(:)</code> should be the same as the type of the <em>parameter</em> of <code>flip</code>, so:</p>\n\n<pre><code>   a -&gt; ( b  -&gt; c  )\n~  d -&gt; ([d] -&gt; [d])\n-----------------------\na ~ d, b ~ [d], c ~ [d]\n</code></pre>\n\n<p>So we conclude that <code>a ~ d</code> (<code>a</code> and <code>d</code> are the same type), <code>b ~ c ~ [d]</code>. This thus means that the type of <code>flip (:)</code> is:</p>\n\n<pre><code>flip (:) :: b -&gt; a -&gt; c\n</code></pre>\n\n<p>or when we perform the replacements to more specific types:</p>\n\n<pre><code>flip (:) :: [d] -&gt; d -&gt; [d]\n</code></pre>\n\n<p>Semantically <code>flip (:)</code> takes a list <code>xs</code>, and an element <code>x</code>, and returns a list where the element is <em>prepended</em> to the given list (so <code>(x:xs)</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1533290445, "creation_date": 1533290445, "answer_id": 51670149, "question_id": 51669820, "link": "https://stackoverflow.com/questions/51669820/why-are-flip-and-flip-different-functions-in-haskell/51670149#51670149", "title": "Why are flip and flip(:) different functions in Haskell?", "body": "<p><code>flip (:)</code> is an application of <code>flip</code> and <code>(:)</code>. </p>\n\n<p>Their types are</p>\n\n<pre><code>Prelude&gt; :t flip\nflip ::   (a -&gt;  b  -&gt;  c ) -&gt; ( b  -&gt; a -&gt;  c )\nPrelude&gt; :t (:)\n(:)  ::    a -&gt; [a] -&gt; [a]\nPrelude&gt; :t flip (:)\nflip (:) ::                     [a] -&gt; a -&gt; [a]\n</code></pre>\n\n<p><code>flip</code> just switches the two arguments to a function:</p>\n\n<pre><code>flip f y x = f x y\n</code></pre>\n\n<p>Thus</p>\n\n<pre><code>flip (:) xs x = (:) x xs = x : xs\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 8778583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aab619f30a140dc2032572fc5f2a44d1?s=128&d=identicon&r=PG&f=1", "display_name": "Binjie Yuan", "link": "https://stackoverflow.com/users/8778583/binjie-yuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 51670098, "answer_count": 2, "score": 1, "last_activity_date": 1533290445, "creation_date": 1533289508, "question_id": 51669820, "link": "https://stackoverflow.com/questions/51669820/why-are-flip-and-flip-different-functions-in-haskell", "title": "Why are flip and flip(:) different functions in Haskell?", "body": "<pre><code>Prelude&gt; :t flip\nflip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\nPrelude&gt; :t flip(:)\nflip(:) :: [a] -&gt; a -&gt; [a]\n</code></pre>\n\n<p>I don't think <code>(:)</code> is a special syntactic sugar for <code>flip</code>. So what has it done to <code>flip</code>?</p>\n"}, {"tags": ["haskell", "heroku", "haskell-stack"], "comments": [{"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1533288084, "post_id": 51669338, "comment_id": 90301272, "body": "I presume, you are using some web framework, like Yesod?"}, {"owner": {"reputation": 3833, "user_id": 5250620, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/viaIW.jpg?s=128&g=1", "display_name": "Haha TTpro", "link": "https://stackoverflow.com/users/5250620/haha-ttpro"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1533288174, "post_id": 51669338, "comment_id": 90301328, "body": "I am trying to deploy <a href=\"https://github.com/facebook/duckling\" rel=\"nofollow noreferrer\">github.com/facebook/duckling</a> (no idea about any framework)"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1533293294, "post_id": 51669338, "comment_id": 90304407, "body": "Can you do a <code>stack exec -- duckling-example-exe --port $PORT</code> on heroku?"}], "answers": [{"comments": [{"owner": {"reputation": 6985, "user_id": 83125, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/lGPkK.jpg?s=128&g=1", "display_name": "PierrOz", "link": "https://stackoverflow.com/users/83125/pierroz"}, "edited": false, "score": 0, "creation_date": 1542372696, "post_id": 51671356, "comment_id": 93555291, "body": "it works pretty well. Have you proposed it in a pull request to FB?"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 6985, "user_id": 83125, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/lGPkK.jpg?s=128&g=1", "display_name": "PierrOz", "link": "https://stackoverflow.com/users/83125/pierroz"}, "edited": false, "score": 1, "creation_date": 1542401415, "post_id": 51671356, "comment_id": 93569407, "body": "@PierrOz I didn&#39;t think about it - but here I filed a <a href=\"https://github.com/facebook/duckling/pull/281\" rel=\"nofollow noreferrer\">PR-281</a>"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 5, "last_activity_date": 1542401513, "last_edit_date": 1542401513, "creation_date": 1533294793, "answer_id": 51671356, "question_id": 51669338, "link": "https://stackoverflow.com/questions/51669338/how-to-specific-binding-port-for-haskell-app/51671356#51671356", "title": "How to specific binding port for Haskell app ?", "body": "<p>If you cannot do a <code>stack exec -- duckling-example-exe --port $PORT</code>,\nyou have to adapt the source code (a little bit) in <code>exe/ExampleMain.hs</code>.</p>\n\n<pre><code>import System.Environment (lookupEnv)\n...\n\nmain :: IO ()\nmain = do\n  setupLogs\n  tzs &lt;- loadTimeZoneSeries \"/usr/share/zoneinfo/\"\n  p &lt;- lookupEnv \"PORT\"\n  conf &lt;- commandLineConfig $ maybe defaultConfig (`setPort` defaultConfig)\n                                                  (p &gt;&gt;= readMaybe)\n  httpServe conf $\n    ifTop (writeBS \"quack!\") &lt;|&gt;\n    route\n      [ (\"targets\", method GET targetsHandler)\n      , (\"parse\", method POST $ parseHandler tzs)\n      ]\n</code></pre>\n\n<p>The change is not too hard since you can read in the <a href=\"http://hackage.haskell.org/package/snap-server-1.1.0.0/docs/src/Snap-Http-Server.html#quickHttpServe\" rel=\"nofollow noreferrer\">source code</a> how <code>quickHttpServe</code> is implemented, adding the port is a bit of a hassle since <code>setPort :: Int -&gt; Config m a -&gt; Config m a</code> instead of taking a <code>Maybe Int</code> which would have been more convenient here.</p>\n\n<p>Since <code>lookupEnv</code> returns a <code>Maybe String</code> we can use the monadic bind <code>&gt;&gt;=</code> and <code>readMaybe</code> to produce a <code>Maybe Int</code>.</p>\n\n<p>The function now works as follows:</p>\n\n<ul>\n<li>if no <code>PORT</code> environment variable is set and no command line param is given default value is chosen</li>\n<li>if there is a <code>--port 8080</code> this overrides a <code>PORT=9000</code>.</li>\n</ul>\n"}], "owner": {"reputation": 3833, "user_id": 5250620, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/viaIW.jpg?s=128&g=1", "display_name": "Haha TTpro", "link": "https://stackoverflow.com/users/5250620/haha-ttpro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1542401513, "creation_date": 1533288011, "question_id": 51669338, "link": "https://stackoverflow.com/questions/51669338/how-to-specific-binding-port-for-haskell-app", "title": "How to specific binding port for Haskell app ?", "body": "<p>When I run and app using stack, it said</p>\n\n<pre><code>$ stack exec duckling-example-exe\nno port specified, defaulting to port 8000\nListening on http://0.0.0.0:8000\n</code></pre>\n\n<p>However, I would like to bind the port to $PORT (in order to host on heroku). </p>\n\n<p>How should I do so ?\nSorry about newbie question, but I don't know anything about Haskell yet and can't search for any solution so far. </p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1533329600, "creation_date": 1533329600, "answer_id": 51679975, "question_id": 51666657, "link": "https://stackoverflow.com/questions/51666657/how-to-convert-a-function-to-a-lens-getter/51679975#51679975", "title": "How to convert a function to a lens getter?", "body": "<p>You are looking for <a href=\"https://www.stackage.org/haddock/lts-12.1/lens-4.16.1/Control-Lens-Getter.html#v:to\" rel=\"nofollow noreferrer\"><code>to</code></a>, which \"build[s] an (index-preserving) <code>Getter</code> from an arbitrary Haskell function\".</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1533329600, "creation_date": 1533278333, "question_id": 51666657, "link": "https://stackoverflow.com/questions/51666657/how-to-convert-a-function-to-a-lens-getter", "title": "How to convert a function to a lens getter?", "body": "<p>Probably related to <a href=\"https://stackoverflow.com/questions/39311908/what-in-lens-should-i-use-to-build-a-read-only-getter-by-index\">What in lens should I use to build a read-only getter by index?</a></p>\n\n<p>I'm looking for a variant of the <a href=\"https://www.stackage.org/haddock/lts-12.1/lens-4.16.1/Control-Lens-Combinators.html#v:lens\" rel=\"nofollow noreferrer\">lens function</a> that allows me to build a <a href=\"https://www.stackage.org/haddock/lts-12.1/lens-4.16.1/Control-Lens-Combinators.html#t:Getter\" rel=\"nofollow noreferrer\"><code>Getter s a</code></a> from an <code>s -&gt; a</code>. Does something like this exist?</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "edited": false, "score": 0, "creation_date": 1533265154, "post_id": 51662755, "comment_id": 90292710, "body": "I just found that changing the last line to <code>lift . lift $ yieldM $ liftM getResponseBody $ httpBS req</code> makes the code compilable. This is even more confusing, I think they are equivalent? How come <code>httpSource req getResponseBody</code> is not an instance of <code>MonadResource IO</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "edited": false, "score": 1, "creation_date": 1533848567, "post_id": 51774811, "comment_id": 90509927, "body": "Thanks for working out the error. I&#39;ve found through reading that the recommended way of doing this is <code>type Cmd i o = Conduit i o (ExceptT HttpException (ReaderT Text IO))</code>. There is a library <code>Data.Conduit.Lift</code> that is mainly for such constructions."}], "tags": [], "owner": {"reputation": 493, "user_id": 6889286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76d9b8a4d03d0de0a49eac62a5569c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Kartik Sabharwal", "link": "https://stackoverflow.com/users/6889286/kartik-sabharwal"}, "is_accepted": true, "score": 2, "last_activity_date": 1533844251, "creation_date": 1533844251, "answer_id": 51774811, "question_id": 51662755, "link": "https://stackoverflow.com/questions/51662755/composition-of-lifts-in-mt-stack/51774811#51774811", "title": "composition of lift&#39;s in MT stack", "body": "<p>I started by reducing the layers in the monad transformer stack to shrink your\ncode to this:</p>\n\n<pre><code>    #!/usr/bin/env stack\n    -- stack script --resolver lts-8.22\n    {-# LANGUAGE OverloadedStrings #-}\n\n    import           Network.HTTP.Simple\n    import qualified Data.ByteString           as BS\n    import           Control.Monad.Reader\n    import           Control.Monad.Except\n    import           Control.Monad.Trans.Class\n    import           Data.Conduit\n\n    type Cmd i o = ConduitM i o IO\n\n    readHost :: BS.ByteString -&gt; Cmd () BS.ByteString ()\n    readHost host = do\n      let req = setRequestMethod \"GET\" . setRequestHost host $ defaultRequest\n      httpSource req getResponseBody\n</code></pre>\n\n<p>I then ran <code>stack {scriptname}</code> and got an error very similar to the one you got\nfor the larger stack:</p>\n\n<pre><code>    {scriptname}:17:3: error:\n        \u2022 No instance for (resourcet-1.1.9:Control.Monad.Trans.Resource.Internal.MonadResource\n                             IO)\n            arising from a use of \u2018httpSource\u2019\n        \u2022 In a stmt of a 'do' block: httpSource req getResponseBody\n          In the expression:\n            do { let req\n                       = setRequestMethod \"GET\" . setRequestHost host $ defaultRequest;\n                 httpSource req getResponseBody }\n          In an equation for \u2018readHost\u2019:\n              readHost host\n                = do { let req = ...;\n                       httpSource req getResponseBody }\n</code></pre>\n\n<p>Figuring out this smaller case may very well make the more complicated version\neasier to tackle.</p>\n\n<p>Let's look at the type for <code>httpSource</code>:</p>\n\n<pre><code>    httpSource :: (MonadResource m, MonadIO n) =&gt;\n                     Request\n                  -&gt; (Response (ConduitM i ByteString n ()) -&gt; ConduitM i o m r)\n                  -&gt; ConduitM i o m r\n</code></pre>\n\n<p>Its return type is <code>ConduitM i o m r</code> where <code>m</code> must be an instance of \n<code>MonadResource</code>.</p>\n\n<p>Now let's have a second glance at the final return type of <code>readHost</code>.\nIt's <code>Cmd () BS.ByteString ()</code> which is nothing but\n<code>ConduitM () BS.ByteString IO ()</code> in disguise.</p>\n\n<p>Compare <code>Conduit () BS.ByteString IO ()</code> with <code>ConduitM i o m r</code> to see that\n<code>m</code> corresponds with <code>IO</code>.</p>\n\n<p>Is <code>IO</code> an instance of <code>MonadResource</code>? According to GHC, it isn't.</p>\n\n<p>A little looking around using Hoogle lets us know that <code>ResourceT IO</code> is an\ninstance of <code>MonadResource</code>. Let's try it out in a program.</p>\n\n<pre><code>    -- stack script --resolver lts-8.22\n    {-# LANGUAGE OverloadedStrings #-}\n\n    import           Network.HTTP.Simple\n    import qualified Data.ByteString           as BS\n    import           Control.Monad.Reader\n    import           Control.Monad.Except\n    import           Control.Monad.Trans.Class\n    import           Control.Monad.Trans.Resource\n    import           Data.Conduit\n\n    main :: IO ()\n    main = putStrLn \"hello\"\n\n    type Cmd i o = ConduitM i o (ResourceT IO)\n\n    readHost :: BS.ByteString -&gt; Cmd () BS.ByteString ()\n    readHost host = do\n      let req = setRequestMethod \"GET\" . setRequestHost host $ defaultRequest\n      httpSource req getResponseBody\n</code></pre>\n\n<p>This compiles without errors and also prints to standard output.</p>\n\n<p>I believe you can use this fix for the larger program. At the very least it explains the error.</p>\n"}], "owner": {"reputation": 447, "user_id": 2812201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a5900e009117b30b90fb5bce64d6fd8e?s=128&d=identicon&r=PG&f=1", "display_name": "user2812201", "link": "https://stackoverflow.com/users/2812201/user2812201"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 1, "accepted_answer_id": 51774811, "answer_count": 1, "score": 2, "last_activity_date": 1533844251, "creation_date": 1533247435, "question_id": 51662755, "link": "https://stackoverflow.com/questions/51662755/composition-of-lifts-in-mt-stack", "title": "composition of lift&#39;s in MT stack", "body": "<p>I am having a lot of trouble understanding this compilation error. The code is the following: </p>\n\n<pre><code>#!/usr/bin/env stack                                                                                                                                                              \n-- stack script --resolver lts-8.22                                                                                                                                               \n{-# LANGUAGE OverloadedStrings #-}                                                                                                                                                \n\nimport           Network.HTTP.Simple                                                                                                                                              \nimport qualified Data.ByteString       as BS                                                                                                                                      \nimport           Control.Monad.Reader                                                                                                                                             \nimport           Control.Monad.Except                                                                                                                                             \nimport           Control.Monad.Trans.Class                                                                                                                                        \nimport           Data.Conduit                                                                                                                                                     \n\n\n\ntype Cmd i o = ReaderT (BS.ByteString) (ExceptT HttpException (ConduitM i o IO))                                                                                                  \n\nrunCmd :: Cmd i o a -&gt; BS.ByteString -&gt; ConduitM i o IO (Either HttpException a)                                                                                                  \nrunCmd cmdTS host = runExceptT $ runReaderT cmdTS host                                                                                                                            \n\n\nreadHost :: Cmd () BS.ByteString ()                                                                                                                                               \nreadHost = do                                                                                                                                                                     \nhost &lt;- ask                                                                                                                                                                     \nlet req = setRequestMethod \"GET\"                                                                                                                                                \n        $ setRequestHost host                                                                                                                                                   \n        $ defaultRequest                                                                                                                                                        \nlift . lift $ httpSource req getResponseBody  \n</code></pre>\n\n<p>Basically I have a MT stack of 4 layers and in <code>readHost</code> I am trying to lift an object from the second to bottom layer to the top layer so I have two <code>lift</code> composed together. But sadly the code will not compile and I got the following error:</p>\n\n<pre><code>[-Wdeferred-type-errors]                                                                                                                                                          \n\u2022 No instance for (Control.Monad.Trans.Resource.Internal.MonadResource                                                                                                        \n                     IO)                                                                                                                                                      \n    arising from a use of \u2018httpSource\u2019                                                                                                                                        \n\u2022 In the second argument of \u2018($)\u2019, namely                                                                                                                                     \n    \u2018httpSource req getResponseBody\u2019                                                                                                                                          \n  In a stmt of a 'do' block:                                                                                                                                                  \n    lift . lift $ httpSource req getResponseBody                                                                                                                              \n  In the expression:                                                                                                                                                          \n    do host &lt;- ask                                                                                                                                                            \n       let req                                                                                                                                                                \n             = setRequestMethod \"GET\" $ setRequestHost host $ defaultRequest                                                                                                  \n       lift . lift $ httpSource req getResponseBody\n</code></pre>\n\n<p>Please help me understand what this error message means.  On a side note, I have not seen people building a stack like this with <code>ConduiT</code> sitting at the bottom, so I guess this is bad practice? What will be a good \"design pattern\" here? I know that the word \"design patter\" does not exist in haskell but I cannot think of a better word. Thanks a lot! </p>\n"}, {"tags": ["windows", "haskell", "unicode", "encoding", "console"], "comments": [{"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 5, "creation_date": 1533240892, "post_id": 51661192, "comment_id": 90286359, "body": "This is on Windows?"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 6, "creation_date": 1533240971, "post_id": 51661192, "comment_id": 90286392, "body": "This works as expected for me. Could you provide more details about your environment?"}, {"owner": {"reputation": 11826, "user_id": 480674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fad9d486ce723011505e86c2136937ca?s=128&d=identicon&r=PG", "display_name": "pedrofurla", "link": "https://stackoverflow.com/users/480674/pedrofurla"}, "edited": false, "score": 0, "creation_date": 1533270075, "post_id": 51661192, "comment_id": 90293703, "body": "MacOS X with ghc 8.0.2 works as expected."}, {"owner": {"reputation": 4234, "user_id": 4942760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f322d06b4f3e34278f29a954e0f38cb1?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Robertson", "link": "https://stackoverflow.com/users/4942760/dan-robertson"}, "edited": false, "score": 1, "creation_date": 1533283354, "post_id": 51661192, "comment_id": 90298585, "body": "Are you sure the stdin you\u2019re giving is utf8 and not utf16? And is that letter a mu (U+03BC) or a micro sign (U+00B5)?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1533305735, "post_id": 51661192, "comment_id": 90312072, "body": "In the faulty <code>ghci</code> session, what does <code>GHC.IO.Encoding.getLocaleEncoding</code> say?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1533321689, "post_id": 51661192, "comment_id": 90319975, "body": "You may want to search the GHC Trac for related tickets. I imagine you&#39;re not the first to encounter such a problem. If you can&#39;t find something, open a ticket. FYI: At the moment, the go-to expert on Windows-specific problems seems to be Tamar Christina. He usually uses the handle Phyx or Phyx- online."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "edited": false, "score": 1, "creation_date": 1533597773, "post_id": 51661192, "comment_id": 90394839, "body": "@Mark Neu, just in case you are really curious to see a workaround, I made an edit to my answer with a minimal working solution."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1533602530, "post_id": 51693385, "comment_id": 90395777, "body": "Can you point out in your answer what specifically is likely to be incomplete, incorrect, or unsafe, if you have an inkling?"}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1533635491, "post_id": 51693385, "comment_id": 90407927, "body": "@dfeuer, This sort of functionality should certainly in <code>base</code>, and I can&#39;t recommend using the sample code I provided. Regardless of that I&#39;ve updated the answer with the things I can think of that would have to be fixed if that code is to be used anywhere."}, {"owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1533679826, "post_id": 51693385, "comment_id": 90432915, "body": "Ah, look, with a little bit of searching I found a similar, but more extensive solution proposed 6 years ago :) <a href=\"https://stackoverflow.com/questions/10779149/unicode-console-i-o-in-haskell-on-windows\" title=\"unicode console i o in haskell on windows\">stackoverflow.com/questions/10779149/&hellip;</a>"}], "tags": [], "owner": {"reputation": 8621, "user_id": 1848029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qfjAy.jpg?s=128&g=1", "display_name": "lehins", "link": "https://stackoverflow.com/users/1848029/lehins"}, "is_accepted": true, "score": 4, "last_activity_date": 1533635160, "last_edit_date": 1533635160, "creation_date": 1533464050, "answer_id": 51693385, "question_id": 51661192, "link": "https://stackoverflow.com/questions/51661192/how-do-you-get-getline-to-accept-unicode-characters/51693385#51693385", "title": "How do you get getLine to accept unicode characters?", "body": "<p>Console input/output is utterly broken on Windows and has been for some time now. Here is the top ticket that tracks all the issues related to IO on Windows:\n<a href=\"https://ghc.haskell.org/trac/ghc/ticket/11394\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/11394</a></p>\n\n<p>I believe, these two tickets describe best the behavior that you are experiencing:</p>\n\n<ul>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/ticket/10542\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/10542</a></li>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/ticket/4471\" rel=\"nofollow noreferrer\">https://ghc.haskell.org/trac/ghc/ticket/4471</a></li>\n</ul>\n\n<p>The only work around right now is to manually use Windows API for dealing console output/input, which is a pain of its own. </p>\n\n<p><strong>EDIT</strong></p>\n\n<p>So, just for the hell of it I decided to endure some of that pain. :)</p>\n\n<p>Here is the output of the code below:</p>\n\n<pre><code>====\nInput: \u00b5\nOutput: \u00b5\n====\n</code></pre>\n\n<p>This is by no means a fully correct or a safe solution, but it does work:</p>\n\n<pre><code>module Main where\n\nimport Control.Monad\nimport System.IO\nimport Foreign.Ptr\nimport Foreign.ForeignPtr\nimport Foreign.C.String\nimport Foreign.C.Types\nimport Foreign.Storable\n\nimport System.Win32\nimport System.Win32.Types\nimport Graphics.Win32.Misc\n\nforeign import ccall unsafe \"windows.h WriteConsoleW\"\n  c_WriteConsoleW :: HANDLE -&gt; LPWSTR -&gt; DWORD -&gt; LPDWORD -&gt; LPVOID -&gt; IO BOOL\n\nforeign import ccall unsafe \"windows.h ReadConsoleW\"\n  c_ReadConsoleW :: HANDLE -&gt; LPWSTR -&gt; DWORD -&gt; LPDWORD -&gt; LPVOID -&gt; IO BOOL\n\n-- | Read n characters from a handle, which should be a console stdin\nhwGetStrN :: Int -&gt; Handle -&gt; IO String\nhwGetStrN maxLen hdl = do\n  withCWStringLen (Prelude.replicate maxLen '\\NUL') $ \\(cstr, len) -&gt; do\n    lpNumberOfCharsWrittenForeignPtr &lt;- mallocForeignPtr\n    withHandleToHANDLE hdl $ \\winHANDLE -&gt;\n      withForeignPtr lpNumberOfCharsWrittenForeignPtr $ \\lpNumberOfCharsRead -&gt; do\n        c_ReadConsoleW winHANDLE cstr (fromIntegral len) lpNumberOfCharsRead nullPtr\n        numWritten &lt;- peek lpNumberOfCharsRead\n        peekCWStringLen (cstr, fromIntegral numWritten)\n\n-- | Write a string to a handle, which should be a console stdout or stderr.\nhwPutStr :: Handle -&gt; String -&gt; IO ()\nhwPutStr hdl str = do\n  void $ withCWStringLen str $ \\(cstr, len) -&gt; do\n    lpNumberOfCharsWrittenForeignPtr &lt;- mallocForeignPtr\n    withHandleToHANDLE hdl $ \\winHANDLE -&gt;\n      withForeignPtr lpNumberOfCharsWrittenForeignPtr $ \\ lpNumberOfCharsWritten -&gt;\n      c_WriteConsoleW winHANDLE cstr (fromIntegral len) lpNumberOfCharsWritten nullPtr\n\nmain :: IO ()\nmain = do\n  hwPutStr stdout \"====\\nInput: \"\n  str &lt;- hwGetStrN 10 stdin\n  hwPutStr stdout \"Output: \"\n  hwPutStr stdout str\n  hwPutStr stdout \"====\\n\"\n</code></pre>\n\n<p><strong>EDIT 2</strong></p>\n\n<p>@dfeuer asked me to list things that are unsafe, incorrect or incomplete with that answer. I only really code on Linux, so I am not a Windows programmer, but here are the things that pop into my mind that would need to be changed before that code could be used in a real program:</p>\n\n<ul>\n<li>The most important part is that code will work only with console handles, which can be determined by <a href=\"https://docs.microsoft.com/en-us/windows/console/getconsolemode\" rel=\"nofollow noreferrer\"><code>GetConsoleMode</code></a> API call.</li>\n<li>For other type of handles the code above will do nothing, eg. if used with pipes or file handles, which has its own issues with encoding, but that is a totally separate issue.</li>\n<li>API call failures aren't accounted for. So we'd have to check if a call was successful by looking at the returned <code>BOOL</code>, and whenever it's not use <a href=\"https://msdn.microsoft.com/library/windows/desktop/ms679360\" rel=\"nofollow noreferrer\"><code>GetLastError</code></a> to report the error back to the user.</li>\n<li>Functions implemented above are very limited, there are no checks on how much they've actually read/wrote to/from buffer. For that reason <code>hwGetStrN</code> can only handle <code>n</code> characters, so recursive call would be required in order to get behavior similar to <code>hGetLine</code></li>\n<li>Do all the sanity checks, eg. <code>DWORD</code> is <code>Word32</code>, so <code>fromIntegral len</code> call is susceptible to integer overflow, which is both incorrect and unsafe.</li>\n<li>FFI calls must be <code>stdcall</code> on 32bit OS, while <code>ccall</code> for <code>x86_64</code>, so some CPP is necessary</li>\n</ul>\n"}], "owner": {"reputation": 1474, "user_id": 8025936, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Kue08.png?s=128&g=1", "display_name": "schuelermine", "link": "https://stackoverflow.com/users/8025936/schuelermine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "accepted_answer_id": 51693385, "answer_count": 1, "score": 3, "last_activity_date": 1533635160, "creation_date": 1533239536, "last_edit_date": 1533306862, "question_id": 51661192, "link": "https://stackoverflow.com/questions/51661192/how-do-you-get-getline-to-accept-unicode-characters", "title": "How do you get getLine to accept unicode characters?", "body": "<p>When running the following code</p>\n\n<pre><code>do line &lt;- getLine\n   putStrLn line\n</code></pre>\n\n<p>or,</p>\n\n<pre><code>getLine &gt;&gt;= putStrLn\n</code></pre>\n\n<p>And, after </p>\n\n<pre><code> getLine &gt;&gt;= putStrLn\n</code></pre>\n\n<p>entering</p>\n\n<pre><code>\u00b5\n</code></pre>\n\n<p>one encounters this output:</p>\n\n<pre><code>\u2800\n</code></pre>\n\n<p>Now, I already tried <code>chcp 65001</code> beforehand, which doesn't work, and the encoding of <code>stdin</code> is <code>utf8</code>.</p>\n\n<p>An examination without <code>putStrLn</code> shows:</p>\n\n<pre><code> getLine\n\u00b5\n'\\NIL'\n</code></pre>\n\n<p>My environment:<br>\nWindows 10 Version 10.0.17134 Build 17134<br>\nLenovo ideapad 510-15IKB<br>\nBIOS Version LENOVO 3JCN30WW<br>\nGHCi v 8.2.2</p>\n\n<p>How can this be solved?</p>\n\n<p>EDIT: Specifically, the following sequence of actions causes this:</p>\n\n<ol>\n<li>Open <code>cmd</code></li>\n<li>Type <code>chcp 65001</code></li>\n<li>Type <code>ghci</code></li>\n<li>Type <code>getLine &gt;&gt;= putStrLn</code></li>\n<li>Type <code>\u00b5</code></li>\n</ol>\n\n<p>However, the following does not:</p>\n\n<ol>\n<li>Search for <code>ghci</code></li>\n<li>Open <code>ghci.exe</code> at <code>%PROGRAMS%\\Haskell Platform\\8.2.2\\bin</code></li>\n<li>Repeat 4-5.</li>\n</ol>\n\n<p>NOTE: <code>%PROGRAMS%</code> is not a real environment variable.</p>\n\n<p>EDIT: As requested, the output of <code>GHC.IO.Encoding.getLocaleEncoding</code>:</p>\n\n<pre><code>UTF-8\n</code></pre>\n\n<p>Also, the output of <code>System.IO.hGetEncoding stdin</code>:</p>\n\n<pre><code>Just UTF-8\n</code></pre>\n\n<p>(when using <code>chcp 65001</code>)</p>\n\n<p>EDIT: The character is U+00B5. I am using a German keyboard, system locale Germany, language setting English, Keyboard language ENG with German layout.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1533236483, "post_id": 51659993, "comment_id": 90284487, "body": "You need to import <a href=\"https://hackage.haskell.org/package/bifunctors-3.2.0.1/docs/Data-Bifunctor.html\" rel=\"nofollow noreferrer\"><code>Data.Bifunctor</code></a> first, which comes from the <code>bifunctors</code> library (which you may need to install first; I don&#39;t recall if that&#39;s one of the standard libraries)."}, {"owner": {"reputation": 1780, "user_id": 4168972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc92e82d2eb21eb030d4c133c70ff554?s=128&d=identicon&r=PG&f=1", "display_name": "David Fletcher", "link": "https://stackoverflow.com/users/4168972/david-fletcher"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1533238342, "post_id": 51659993, "comment_id": 90285302, "body": "@chepner Data.Bifunctor is in base now, no need to install anything unless you have an old ghc."}, {"owner": {"reputation": 9790, "user_id": 544721, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/690b6f4d543b41e22e795a42ca67dfc2?s=128&d=identicon&r=PG", "display_name": "Grzegorz Wierzowiecki", "link": "https://stackoverflow.com/users/544721/grzegorz-wierzowiecki"}, "edited": false, "score": 0, "creation_date": 1533458222, "post_id": 51659993, "comment_id": 90346913, "body": "Thanks for comments! There was something screwed up with my install. You motivated me to reinstall things and finally import works!"}], "answers": [{"comments": [{"owner": {"reputation": 9790, "user_id": 544721, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/690b6f4d543b41e22e795a42ca67dfc2?s=128&d=identicon&r=PG", "display_name": "Grzegorz Wierzowiecki", "link": "https://stackoverflow.com/users/544721/grzegorz-wierzowiecki"}, "edited": false, "score": 0, "creation_date": 1533458143, "post_id": 51661033, "comment_id": 90346888, "body": "I had some trouble with my installation and strange errors when I tried to import. So I thought that it may be not thing of importing. Thanks to your answer, I reinstalled things to make sure, and importing finally works! Thanks!"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1533238818, "creation_date": 1533238818, "answer_id": 51661033, "question_id": 51659993, "link": "https://stackoverflow.com/questions/51659993/how-to-use-bimap-on-either-idiomatically-maybe-something-else-to-map-element/51661033#51661033", "title": "How to use bimap on [Either] idiomatically? Maybe something else to map element of [Either] using two functions", "body": "<p>The <code>Bifunctor</code> class is not part of the Prelude; you need to import it from <code>Data.Bifunctor</code> first. (Depending on your installation, the module may be provided by the <code>base</code> library, or you may need to install the <code>bifunctors</code> library first.)</p>\n\n<pre><code>Prelude&gt; :t bimap\n\n&lt;interactive&gt;:1:1: error: Variable not in scope: bimap\nPrelude&gt; import Data.Bifunctor\nPrelude Data.Bifunctor&gt; :t bimap\nbimap :: Bifunctor p =&gt; (a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d\nPrelude Data.Bifunctor&gt; el = [Left 5, Right \"foo\", Left 10, Right \"bar\"]\nPrelude Data.Bifunctor&gt; fmap (bimap (*2) (++\"!!!\")) el\n[Left 10,Right \"foo!!!\",Left 20,Right \"bar!!!\"]\n</code></pre>\n"}], "owner": {"reputation": 9790, "user_id": 544721, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/690b6f4d543b41e22e795a42ca67dfc2?s=128&d=identicon&r=PG", "display_name": "Grzegorz Wierzowiecki", "link": "https://stackoverflow.com/users/544721/grzegorz-wierzowiecki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 51661033, "answer_count": 1, "score": 1, "last_activity_date": 1551801278, "creation_date": 1533234076, "last_edit_date": 1551801278, "question_id": 51659993, "link": "https://stackoverflow.com/questions/51659993/how-to-use-bimap-on-either-idiomatically-maybe-something-else-to-map-element", "title": "How to use bimap on [Either] idiomatically? Maybe something else to map element of [Either] using two functions", "body": "<p>How to apply two functions over list of <code>Either a b</code> in more idiomatic way (I guess it may be applying <code>bimap</code> correctly)? (without using <code>instance ... where</code> as I would like flexibility on \"one off\" applications of different <code>f g</code> functions -> <code>biEitherTransformGenerator</code> and <code>biEitherFmap</code> allow one-liners)</p>\n\n<p>I try to use <code>bimap</code> to map two functions over list of <code>Either a b</code>:</p>\n\n<pre><code>biEitherTransformGenerator :: (a-&gt;c) -&gt; (b-&gt;d) -&gt; Either a b -&gt; Either c d\nbiEitherTransformGenerator f g (Left x) = Left $ f x\nbiEitherTransformGenerator f g (Right x) = Right $ g x\nbiEitherFmap :: (Functor container) =&gt; (a-&gt;c) -&gt; (b-&gt;d) -&gt; container (Either a b) -&gt; container (Either c d)\nbiEitherFmap f g = fmap $ biEitherTransformGenerator f g\nel = [Left 5, Right \"foo\", Left 10, Right \"bar\"]:: [Either Int [Char]]\nmain = do\n    print el\n    let l1 = fmap (biEitherTransformGenerator (*2) (++\"!!!\")) el\n    print l1\n    let l2 = biEitherFmap (*2) (++\"!!!\") el\n    print l2\n    print $ l1 == l2\n    -- let l3 = fmap (bimap (*2) (++\"!!!\")) el\n    -- print l3\n</code></pre>\n\n<p>Output of <code>runhaskell DoubleFunctor.hs</code> :</p>\n\n<pre><code>[Left 5,Right \"foo\",Left 10,Right \"bar\"]\n[Left 10,Right \"foo!!!\",Left 20,Right \"bar!!!\"]\n[Left 10,Right \"foo!!!\",Left 20,Right \"bar!!!\"]\nTrue\n</code></pre>\n\n<p>every time I uncomment last two lines:</p>\n\n<pre><code>let l3 = fmap (bimap (*2) (++\"!!!\")) el\nprint l3\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>DoubleFunctor.hs:14:20: error:\n    Variable not in scope:\n      bimap\n        :: (Integer -&gt; Integer)\n           -&gt; ([Char] -&gt; [Char]) -&gt; Either Int [Char] -&gt; b\n   |\n14 |     let l3 = fmap (bimap (*2) (++\"!!!\")) el\n   |                    ^^^^^\n</code></pre>\n\n<p>What I try to achieve: More idomatic way of doing <code>fmap (biEitherTransformGenerator f g) listOfEither</code> or <code>biEitherFmap f g listOfEither</code>.</p>\n"}, {"tags": ["haskell", "functional-programming", "higher-order-functions", "fold", "algebraic-data-types"], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 5, "last_activity_date": 1533233843, "creation_date": 1533233843, "answer_id": 51659943, "question_id": 51659736, "link": "https://stackoverflow.com/questions/51659736/haskell-map-function-for-algebraic-data-types/51659943#51659943", "title": "Haskell Map Function for Algebraic Data types", "body": "<p><strong>tl;dr</strong> Here's your function. But I recommend reading on to see how I came up with this, so you can work out the thought process.</p>\n\n<pre><code>newbmap :: (a-&gt;b)-&gt; Newb a -&gt; Newb b\nnewbmap f = foldNewb (Leaf . f) Node\n</code></pre>\n\n<p>You're pretty close, and you're using <code>foldNewb</code> correctly, but you're overthinking it.</p>\n\n<p>First, you can't name a function <code>Newbmap</code>. Capital names are reserved for types. So we'll call it <code>newbmap</code>. Now, <code>foldNewb</code> already handles both of the cases <code>Leaf</code> and <code>Node</code>, so we shouldn't have to pattern match in <code>newbmap</code> at all. In fact, your first <code>newbmap</code> case does exactly what <code>foldNewb</code> would do anyway, so let's just consider the second case.</p>\n\n<pre><code>newbmap :: (a-&gt;b)-&gt; Newb a -&gt; Newb b\nnewbmap f (Node a) = (Node (foldNewb f concat a))\n</code></pre>\n\n<p>We want to fold over our data structure. In particular, we want our fold call to completely produce the new data structure. We <em>shouldn't</em> need to explicitly use <code>Node</code> at the end, since, again, <code>foldNewb</code> already does that work for us.</p>\n\n<pre><code>newbmap :: (a-&gt;b)-&gt; Newb a -&gt; Newb b\nnewbmap f a = foldNewb f concat a\n</code></pre>\n\n<p>Now in the first case, we need a function <code>a -&gt; Newb b</code> (since the result is going to be of type <code>Newb b</code>). You've passed <code>f :: a -&gt; b</code>, which is very close to what you want. We simply need to compose it with a function <code>b -&gt; Newb b</code>, and <code>Leaf</code> will do exactly that.</p>\n\n<pre><code>newbmap :: (a-&gt;b)-&gt; Newb a -&gt; Newb b\nnewbmap f a = foldNewb (Leaf . f) concat a\n</code></pre>\n\n<p>For the second argument, you want <code>[Newb b] -&gt; Newb b</code>, which again is very easily done by <code>Node</code>.</p>\n\n<pre><code>newbmap :: (a-&gt;b)-&gt; Newb a -&gt; Newb b\nnewbmap f a = foldNewb (Leaf . f) Node a\n</code></pre>\n\n<p>And (although it doesn't make a difference), we can pointfree the final argument.</p>\n\n<pre><code>newbmap :: (a-&gt;b)-&gt; Newb a -&gt; Newb b\nnewbmap f = foldNewb (Leaf . f) Node\n</code></pre>\n\n<p>So there's a working <code>newbmap</code> function. Now, as for how I came up with all of those types, if you're using GHC, there's a very helpful feature called <em>type holes</em> that you can use to identify what sort of types you need. So (and I did exactly this when debugging your function) if you write</p>\n\n<pre><code>newbmap :: (a-&gt;b)-&gt; Newb a -&gt; Newb b\nnewbmap f = foldNewb _1 _2\n</code></pre>\n\n<p>then you'll get very specific GHC messages telling you <code>_1 :: a -&gt; Newb b</code> and <code>_2 :: [Newb b] -&gt; Newb b</code>. Then your challenge is simply to find functions with those particular types. And this is where I came up with <code>Leaf . f</code> and <code>Node</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 31724, "user_id": 6264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bbb17eeeecd3d9d06f4db310ab630a12?s=128&d=identicon&r=PG", "display_name": "Michiel Borkent", "link": "https://stackoverflow.com/users/6264/michiel-borkent"}, "is_accepted": false, "score": 1, "last_activity_date": 1533234728, "last_edit_date": 1533234728, "creation_date": 1533234177, "answer_id": 51660012, "question_id": 51659736, "link": "https://stackoverflow.com/questions/51659736/haskell-map-function-for-algebraic-data-types/51660012#51660012", "title": "Haskell Map Function for Algebraic Data types", "body": "<p>Without using <code>foldNewb</code>:</p>\n\n<pre><code>data Newb a = Leaf a | Node [ Newb a]\n  deriving (Show)\n\nnewbMap :: (a -&gt; b) -&gt; Newb a -&gt; Newb b\nnewbMap f (Leaf a) = Leaf (f a)\n-- since a :: [Newb a] in the below clause, we can map (newbMap f) over the elements \nnewbMap f (Node a) = Node (map (newbMap f) a)\n\ntree = Node [ Leaf 1, Node [Leaf 2, Leaf 3], Leaf 4]\nmapped = newbMap (+1) tree -- Node [Leaf 2,Node [Leaf 3,Leaf 4],Leaf 5]\n</code></pre>\n"}], "owner": {"reputation": 299, "user_id": 3047143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87db5dac2e899b66815a44fcb348c4fa?s=128&d=identicon&r=PG&f=1", "display_name": "Highness", "link": "https://stackoverflow.com/users/3047143/highness"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 51659943, "answer_count": 2, "score": 2, "last_activity_date": 1533234728, "creation_date": 1533232980, "question_id": 51659736, "link": "https://stackoverflow.com/questions/51659736/haskell-map-function-for-algebraic-data-types", "title": "Haskell Map Function for Algebraic Data types", "body": "<p>I have an algebraic data type Newb defined like below. Now I want to write a custom map function for it without using recursion.Further I have a foldNewb function which could also help. </p>\n\n<pre><code> data Newb a = Leaf a | Node [Newb a]\n\n\nfoldNewb:: (a-&gt;b)-&gt;([b]-&gt;b)-&gt;Newb a -&gt; b\nfoldNewb f _ (Leaf a) = f a\nfoldNewb f1 f2 (Node a) = f2 (map (foldNewb f1 f2) a)\n\n\nNewbmap :: (a-&gt;b)-&gt; Newb a -&gt; Newb b\n\nNewbmap f (Leaf a) = (Leaf (f a))\nNewbmap f (Node a) = (Node (foldNewb f concat a))\n</code></pre>\n\n<p>above is my attempt at implementing this function. I can't get any further than this and I don't understand what I'm doing wrong here. Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "generics", "types", "numbers", "generic-programming"], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": true, "score": 1, "last_activity_date": 1533237227, "creation_date": 1533237227, "answer_id": 51660688, "question_id": 51659485, "link": "https://stackoverflow.com/questions/51659485/how-to-get-a-generic-average-that-works-with-vectors-to-compile-in-haskell/51660688#51660688", "title": "How to get a generic average that works with vectors to compile in Haskell?", "body": "<p>In this case, I would add the additional constraint suggested in the error message, to get <code>avg :: (Foldable f, VectorSpace a, Fractional (Scalar a)) =&gt; f a -&gt; a</code>.</p>\n\n<p><code>Fractional</code> implies <code>Num</code>, so no need to mention <code>Num</code>.  Also no harm if you add it - the function is not made less generic.</p>\n\n<p>As far as general advice, I think writing lots of generic functions, guided by the type errors, is the best way.  Often adding the suggested constraints is enough; other times you really want the more-general signature, and need to figure out which function is bringing in the unwanted constraint.</p>\n"}], "owner": {"reputation": 3, "user_id": 10172393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e6f7e8ee344b313296239bcef8a433e?s=128&d=identicon&r=PG&f=1", "display_name": "terekomo", "link": "https://stackoverflow.com/users/10172393/terekomo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 51660688, "answer_count": 1, "score": 0, "last_activity_date": 1533237227, "creation_date": 1533232055, "last_edit_date": 1533232936, "question_id": 51659485, "link": "https://stackoverflow.com/questions/51659485/how-to-get-a-generic-average-that-works-with-vectors-to-compile-in-haskell", "title": "How to get a generic average that works with vectors to compile in Haskell?", "body": "<p>I tried:</p>\n\n<pre><code>import Data.VectorSpace     -- ^/\nimport Data.AdditiveGroup   -- sumV\nimport Data.Foldable        -- length\n\navg :: (Foldable f, VectorSpace a) =&gt; f a -&gt; a\navg xs = sm ^/ sz    -- could be just ^*(1/sz)\n where sm = sumV xs\n       sz = fromIntegral (length xs)\n</code></pre>\n\n<p>and got:</p>\n\n<pre><code>Distancesumcurves.hs:11:10: error:\n    \u2022 Could not deduce (Fractional (Scalar a))\n        arising from a use of \u2018^/\u2019\n      from the context: (Foldable f, VectorSpace a)\n        bound by the type signature for:\n                   avg :: (Foldable f, VectorSpace a) =&gt; f a -&gt; a\n        at Distancesumcurves.hs:10:1-46\n    \u2022 In the expression: sm ^/ sz\n      In an equation for \u2018avg\u2019:\n          avg xs\n            = sm ^/ sz\n            where\n                sm = sumV xs\n                sz = fromIntegral (length xs)\n\nDistancesumcurves.hs:13:13: error:\n    \u2022 Could not deduce (Num (Scalar a))\n        arising from a use of \u2018fromIntegral\u2019\n      from the context: (Foldable f, VectorSpace a)\n        bound by the type signature for:\n                   avg :: (Foldable f, VectorSpace a) =&gt; f a -&gt; a\n        at Distancesumcurves.hs:10:1-46\n    \u2022 In the expression: fromIntegral (length xs)\n      In an equation for \u2018sz\u2019: sz = fromIntegral (length xs)\n      In an equation for \u2018avg\u2019:\n          avg xs\n            = sm ^/ sz\n            where\n                sm = sumV xs\n                sz = fromIntegral (length xs)\n</code></pre>\n\n<p>Of course I could just write one specifically for vectors, and get on with my life, but then whats the point of the generic features of Haskell. In a less pedantic language I would be done with it already, and it would work just fine, and it would be reusable. In Haskell I have to write a question here or regress to code-duplication. I consider this a failure of the language.</p>\n\n<p>Its not the first time I got frustrated with Haskell generics. I am past the level of the book Programming in Haskell by Graham Hutton. What should be the next step/book/article for me? So that I dont get into arguments with the compiler, when I know what I want, and it is correct. Its just language-technical skill I lack in this case. Feel free to correct me if I am wrong.</p>\n\n<hr>\n\n<p>edit:</p>\n\n<p>seems to work in context</p>\n\n<pre><code>approximateCurve :: [Point] -&gt; Path\napproximateCurve pts = [] -- TODO\n where center = avg pts\n       avg vs = (sum vs) ^/ (fromIntegral (length vs))\n       sum = foldr (^+^) (0,0)\n</code></pre>\n"}, {"tags": ["haskell", "haskell-lens", "haskell-persistent"], "answers": [{"tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": true, "score": 1, "last_activity_date": 1533237940, "creation_date": 1533237940, "answer_id": 51660841, "question_id": 51659150, "link": "https://stackoverflow.com/questions/51659150/is-it-possible-to-define-your-own-persistent-esqueleto-lens/51660841#51660841", "title": "Is it possible to define your own Persistent / Esqueleto lens?", "body": "<p>This isn't really possible.</p>\n\n<pre><code>(^.) :: (PersistEntity val, PersistField typ)\n     =&gt; expr (Entity val)\n     -&gt; EntityField val typ\n     -&gt; expr (Value typ)\n</code></pre>\n\n<p>You'll see that the second argument is <code>EntityField val typ</code>, which is a type family defined in the <code>PersistEntity val</code> class. This is pre-defined for your table, and can't be changed, so this particular operator can't be used for custom accessors the way you want.</p>\n\n<hr>\n\n<p>When you use <code>persistLowerCase</code> and friends, it uses Template Haskell to parse your definition and generate appropriate data definitions. As I understand it, something similar to the following is generated:</p>\n\n<pre><code>data Account = Account\n  { accountEmail :: Text\n  , accountPassphrase :: Text\n  , accountFirstName :: Text\n  , accountLastName :: Text\n  }\n\ndata AccountField a where\n  AccountId :: AccountField Key\n  AccountEmail :: AccountField Text\n  AccountPassphrase :: AccountField Text\n  AccountFirstName :: AccountField Text\n  AccountLastName :: AccountField Text\n\ninstance PersistEntity Account where\n  data EntityField Account a = AccountField a\n  ...\n</code></pre>\n\n<p>(This isn't syntactically accurate and is missing a lot of detail, but it provides enough context for this situation I think.)</p>\n\n<p>So the \"lens\" you pass to <code>(^.)</code> is actually just a constructor for a type associated with your table type <code>Account</code>. You can't create new constructors or re-associate the type family dynamically, so you can't make something else that can be passed to <code>(^.)</code>. These accessors are effectively set in stone.</p>\n\n<hr>\n\n<p>I think it makes the most sense to just go with the raw function. <code>accountFullName acc</code> isn't bad to write, and it makes it clear that you're doing something a little more complex than just pulling a field value.</p>\n"}], "owner": {"reputation": 2447, "user_id": 2061783, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5fc1d7081d9f24bd0307795baea57d56?s=128&d=identicon&r=PG", "display_name": "danbroooks", "link": "https://stackoverflow.com/users/2061783/danbroooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 51660841, "answer_count": 1, "score": 0, "last_activity_date": 1533237940, "creation_date": 1533230602, "question_id": 51659150, "link": "https://stackoverflow.com/questions/51659150/is-it-possible-to-define-your-own-persistent-esqueleto-lens", "title": "Is it possible to define your own Persistent / Esqueleto lens?", "body": "<p>Given the following persistent type:</p>\n\n<pre><code>share\n    [mkPersist sqlSettings, mkMigrate \"migrateAll\"]\n    [persistLowerCase|\nAccount\n    email Text\n    passphrase Text\n    firstName Text\n    lastName Text\n    deriving Eq Show Generic\n|]\n</code></pre>\n\n<p>What I think is a kind of lens is generated, ie <code>AccountEmail</code>, <code>AccountPassphrase</code> etc etc. Is it possible to combine these in such a way, not necessarily composition but say string concatenation, I often find myself writing these kinds of functions:</p>\n\n<pre><code>accountFullName :: SqlExpr (Entity Account) -&gt; SqlExpr Text\naccountFullName acc = acc ^. AccountFirstName ++. val \" \" ++. acc ^. AccountLastName\n</code></pre>\n\n<p>It would be good if I could define this in a similar way to <code>Account*</code> so I can call them using <code>^.</code> rather than using raw functions, ie <code>acc ^. AccountFullName</code>. This may not be an appropriate way of using these accessors, but if it isn't I would be interested to know why as I feel it may help further my understanding of this part of the Persistent library, as I feel fairly lost when I look at the code around <code>EntityField</code>...</p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1533228527, "post_id": 51658468, "comment_id": 90280801, "body": "No, one of the important design principles of Haskell is that <i>all</i> variables are immutable."}, {"owner": {"reputation": 2313, "user_id": 5318306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/897fd4f3b92d28c5c1eb28a8024661a1?s=128&d=identicon&r=PG&f=1", "display_name": "Gurkenglas", "link": "https://stackoverflow.com/users/5318306/gurkenglas"}, "edited": false, "score": 0, "creation_date": 1533239855, "post_id": 51658468, "comment_id": 90285928, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/44894152/in-ghci-how-to-remove-an-existing-binding\">In ghci, how to remove an existing binding?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 384, "user_id": 9948945, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Samuel Barr", "link": "https://stackoverflow.com/users/9948945/samuel-barr"}, "is_accepted": false, "score": 0, "last_activity_date": 1533668032, "creation_date": 1533668032, "answer_id": 51733606, "question_id": 51658468, "link": "https://stackoverflow.com/questions/51658468/how-to-change-a-variables-value-in-ghci-debugger/51733606#51733606", "title": "How to change a variable&#39;s value in GHCI debugger?", "body": "<p>If you have a variable first defined as:</p>\n\n<pre><code>x = 7 :: Integer\n</code></pre>\n\n<p>Then if you want to redefine <code>x</code>, then all you need to do is:</p>\n\n<pre><code>x = \"Hello!\"\n</code></pre>\n\n<p>Note that this will not affect functions whose body contains <code>x</code>, for example:</p>\n\n<pre><code>&gt; x = 7 : Integer\n&gt; f = (+ x)\n&gt; f 10\n17\n&gt; x = \"Hello!\"\n&gt; f 10\n17\n</code></pre>\n\n<p>You will have to redefine any function whose body contains <code>x</code> in order for the change to take affect.</p>\n"}], "owner": {"reputation": 165, "user_id": 1532146, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8a43cdc66c6d106c5c54bfbb9371645b?s=128&d=identicon&r=PG", "display_name": "user1532146", "link": "https://stackoverflow.com/users/1532146/user1532146"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1533668032, "creation_date": 1533227820, "question_id": 51658468, "link": "https://stackoverflow.com/questions/51658468/how-to-change-a-variables-value-in-ghci-debugger", "title": "How to change a variable&#39;s value in GHCI debugger?", "body": "<p>Is it possible to change a variable's value in GHCI debugger?\nIf yes, please show me how?</p>\n"}, {"tags": ["haskell", "non-exhaustive-patterns"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1533226169, "post_id": 51658023, "comment_id": 90279707, "body": "Because the <code>otherwise</code> is a <i>guard</i> of a specific pattern. What if one writes <code>mark 3 []</code>? Then which clause should fire? The same with <code>sieve</code> itself: there is no clause that describes what to do in case of an empty list."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1533226322, "post_id": 51658023, "comment_id": 90279780, "body": "Well, that makes sense. After all, in order to say <code>let x be in a set A</code>, first you need to show <code>A is not empty</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1533230836, "post_id": 51658023, "comment_id": 90281936, "body": "I strongly suggest you turn on warnings using <code>-Wall</code>. Not only that would catch the missing case at compile time, but it also will report that <code>[]</code> is the missing case."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1533230068, "creation_date": 1533230068, "answer_id": 51659006, "question_id": 51658023, "link": "https://stackoverflow.com/questions/51658023/how-is-it-possible-to-get-non-exhaustive-patterns-exception-when-using-otherw/51659006#51659006", "title": "How is it possible to get `Non-exhaustive patterns` exception when using `otherwise`", "body": "<p><code>otherwise</code> is indeed a guard which always succeeds; but guards are only considered when the associated pattern already matches. So, in</p>\n\n<pre><code>foo (x:xs) | otherwise = bar\n</code></pre>\n\n<p>we will only see <code>bar</code> as the result when the argument to <code>foo</code> matches the pattern <code>x:xs</code>. The analogous pattern to <code>otherwise</code> is <code>_</code>, which always matches and doesn't bind any new variables, so:</p>\n\n<pre><code>foo (x:xs) | otherwise = bar\nfoo _ = baz\n</code></pre>\n\n<p>would never throw an unmatched pattern exception.</p>\n"}], "owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "closed_date": 1533230948, "accepted_answer_id": 51659006, "answer_count": 1, "score": -1, "last_activity_date": 1533230068, "creation_date": 1533226124, "question_id": 51658023, "link": "https://stackoverflow.com/questions/51658023/how-is-it-possible-to-get-non-exhaustive-patterns-exception-when-using-otherw", "closed_reason": "Duplicate", "title": "How is it possible to get `Non-exhaustive patterns` exception when using `otherwise`", "body": "<p>I'm trying to prove that the numbers of the form <code>p_1 * ... * p_k + 1</code> are not all prime, and to do this, I have written this code</p>\n\n<pre><code>sieve :: [Integer] -&gt; [Integer]\nsieve (0:xs) = sieve xs\nsieve (x:xs) = x : sieve (mark x xs)\n where\n mark :: Integer -&gt; [Integer] -&gt; [Integer]\n mark n (y:ys)\n  | rem y n == 0 = 0 : (mark n ys)\n  | otherwise = y : (mark n ys)\n\ncheckPrime' :: Integer -&gt; Bool\ncheckPrime' n = elem n (sieve [n])\n\nlistPrimeFromTo' :: Integer -&gt; Integer -&gt; [Integer]\nlistPrimeFromTo' k n = sieve [k..n]\n\ncheckEulerPrimes = forall [(product xs) + 1|  n &lt;- [2..], let xs = listPrimeFromTo' 2 n] checkPrime'\n</code></pre>\n\n<p>I get this exception:</p>\n\n<blockquote>\n  <p>*** Exception: Ch3.hs:(11,2)-(13,31): Non-exhaustive patterns in function mark</p>\n</blockquote>\n\n<p>However, in the definition of the function <code>mark</code>, I use <code>otherwise</code>, so how is it possible that there are cases which the definition of the function does not specifies any rule for that. I mean I thought using the keyword <code>otherwise</code> makes sure that there is no non-exhausted patterns.</p>\n"}, {"tags": ["haskell", "recursion", "primes", "lazy-evaluation"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1533223852, "post_id": 51657083, "comment_id": 90278371, "body": "Please post code as text rather than screenshots. It makes reading, local testing, and searching far easier."}, {"owner": {"reputation": 2928, "user_id": 5927758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QmcMj.png?s=128&g=1", "display_name": "Mitch", "link": "https://stackoverflow.com/users/5927758/mitch"}, "edited": false, "score": 0, "creation_date": 1533224162, "post_id": 51657083, "comment_id": 90278578, "body": "What part makes you think the logic is circular"}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1533224458, "post_id": 51657083, "comment_id": 90278745, "body": "@Carl See my edit."}, {"owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "reply_to_user": {"reputation": 2928, "user_id": 5927758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QmcMj.png?s=128&g=1", "display_name": "Mitch", "link": "https://stackoverflow.com/users/5927758/mitch"}, "edited": false, "score": 0, "creation_date": 1533224469, "post_id": 51657083, "comment_id": 90278755, "body": "@Mitchel0022 I hope the explanation is clear."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1533224514, "post_id": 51657083, "comment_id": 90278784, "body": "Haskell is lazy; trace a call to <code>prime 2</code>, and notice how you never actually use <code>ps</code> in the call to <code>ldpf</code>. That means the recursive call to <code>prime</code> never actually gets made until you actually need it."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1533230178, "post_id": 51657083, "comment_id": 90281616, "body": "Haskell is magic like that. This is too complex a function to contemplate, try grokking this Fibonacci sequence implementation first: <code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)</code>. Note that it produces an <i>infinite</i> list."}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1533378867, "post_id": 51657976, "comment_id": 90331564, "body": "cf. <a href=\"https://stackoverflow.com/questions/21688063/haskell-to-fix-or-not-to-fix/21720650#21720650\">related answer</a>, and <a href=\"https://stackoverflow.com/questions/13894417/double-stream-feed-to-prevent-unneeded-memoization/13895347#13895347\">another one</a>."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 4, "last_activity_date": 1533289722, "last_edit_date": 1533289722, "creation_date": 1533225946, "answer_id": 51657976, "question_id": 51657083, "link": "https://stackoverflow.com/questions/51657083/is-this-even-a-function-in-haskell-if-so-how-should-we-read-it/51657976#51657976", "title": "Is this even a function in Haskell ? If so, how should we read it?", "body": "<p>The <code>ldp n == n</code> condition can be equivalently re-written as</p>\n\n<pre><code>ldpf primes n == n\n=\nnull [() | p &lt;- takeWhile (\\p -&gt; p^2 &lt;= n) primes, rem n p==0]\n=\nand [rem n p &gt; 0 | p &lt;- takeWhile (\\p -&gt; p^2 &lt;= n) primes]\n</code></pre>\n\n<p>so for any given <code>n</code>, the call <code>prime n = ldp n == n</code> only needs to generate the list </p>\n\n<pre><b>primes</b> = 2 : filter prime [3..] \n       = 2 : filter (\\n -> ldpf <b>primes</b> n == n) [3..]\n       = 2 : filter (\\n -> and [rem n p > 0 \n                                | p &lt;- takeWhile (\\p -> p^2 &lt;= n) <b>primes</b>])\n                          [3..]</pre>\n\n<p>up to the smallest prime number <code>q &gt; floor (sqrt $ fromIntegral n)</code>, and for that only the primes not greater than <em><code>q</code>'s</em> square root are needed. And to generate those, only the numbers not greater than the square root of <em>that</em> were needed. Pretty soon we end up not needing any primes at all, e.g.</p>\n\n<pre><code>prime 3\n= \nldpf primes 3 == 3\n=\nand [rem 3 p &gt; 0 | p &lt;- takeWhile (\\p -&gt; p^2 &lt;= 3) (2 : filter prime [3..])]\n= \nand [rem 3 p &gt; 0 | p &lt;- takeWhile (&lt;= 3) (4 : \n                                      map (\\p -&gt; p^2) (filter prime [3..]))]\n= \nand [rem 3 p &gt; 0 | p &lt;- []]\n=\nand []\n=\nTrue\n</code></pre>\n\n<p>because <code>2</code> already fails the predicate: <code>(2^2 &lt;= 3) = (4 &lt;= 3) = False</code>.</p>\n\n<p>And when testing <code>4</code>, <code>primes</code> will be probed for containing the number <code>3</code>, but that's OK as we've just seen above:</p>\n\n<pre><code>prime 4\n=\nand [rem 4 p &gt; 0 | p &lt;- takeWhile (\\p -&gt; p^2 &lt;= 4) primes]\n= \nand [rem 4 p &gt; 0 | p &lt;- takeWhile (&lt;= 4) (4 : \n                               map (\\p -&gt; p^2) (filter prime [3..]))]\n= \nand [rem 4 p &gt; 0 | p &lt;- 4 : takeWhile (&lt;= 4) (9 :\n                               map (\\p -&gt; p^2) (filter prime [4..]))]\n= \nand [rem 4 p &gt; 0 | p &lt;- 4 : []]\n=\nFalse\n</code></pre>\n\n<p>and we can check it at the GHCi prompt after that,</p>\n\n<pre><code>&gt; :sprint primes\n2 : 3 : _\n</code></pre>\n\n<p>(for the above to work you'll need to take <code>primes</code> out of the <code>prime</code> function and make it a top-level entity in its own right).</p>\n"}], "owner": {"reputation": 639, "user_id": 6708910, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/B5pvi.jpg?s=128&g=1", "display_name": "Our", "link": "https://stackoverflow.com/users/6708910/our"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533378458, "creation_date": 1533223015, "last_edit_date": 1533378458, "question_id": 51657083, "link": "https://stackoverflow.com/questions/51657083/is-this-even-a-function-in-haskell-if-so-how-should-we-read-it", "title": "Is this even a function in Haskell ? If so, how should we read it?", "body": "<p>In the book of <em>The Haskell Road to Logic, Math and Programming</em> by Doets et.al., at page 103, it is given that</p>\n\n<pre><code>prime :: Integer -&gt; Bool\nprime n | n &lt; 1     = error \"not a positive integer\"\n        | n == 1    = False\n        | otherwise = ldp n == n where \n  ldp    = ldpf primes\n  ldpf (p:ps) m | rem m p == 0 = p\n                | p^2 &gt; m = m\n                | otherwise = ldpf ps m \n  primes = 2 : filter prime [3..]\n</code></pre>\n\n<p>However, isn't the logic of this function circular ? I mean I think I'm quite comfortable with recursive functions, but I do not think that this is a recursive function. Even if it is, I'm not able to comprehend the logic of it, so my question is that how to read the logic of such a function.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>The reason why I'm confused is <code>prime</code> function uses the list <code>primes</code>, but to generate that list, we also use the function <code>prime</code>, so it seems that there is a circular logic, or I just do not understand recursive functions with lazy evaluation.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1533219744, "post_id": 51655737, "comment_id": 90275507, "body": "Are you sure you want <code>sort (group xs)</code> and not <code>group (sort xs)</code>?"}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1533246917, "post_id": 51655737, "comment_id": 90288756, "body": "map length.group.sort $ [1,3,5,5,3] ... ... ... ... ... [1,2,2]"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1533219987, "last_edit_date": 1533219987, "creation_date": 1533219237, "answer_id": 51655800, "question_id": 51655737, "link": "https://stackoverflow.com/questions/51655737/haskell-why-cant-i-map-into-a-sorted-and-grouped-list-of-lists/51655800#51655800", "title": "Haskell - Why can&#39;t I map into a sorted and grouped list of lists?", "body": "<p>Because in Haskell function calls are done like <code>f x</code>, not <code>f (x)</code>. Sure in many cases <code>f (x)</code> will work as well, but here you have basically written:</p>\n\n<pre><code>listLengths xs = map length sort (group(xs))\n</code></pre>\n\n<p>or more verbose:</p>\n\n<pre><code>listLengths xs = ((map length) sort) (group(xs))\n</code></pre>\n\n<p>Haskell thus sees <code>sort</code> as an independent parameter, and <code>group (xs)</code> as an extra one. But since <code>sort</code> is a function, and not a list, the typechecker will raise an error.</p>\n\n<p>You can write it like:</p>\n\n<pre><code>listLengths :: [Int] -&gt; [Int]\nlistLengths xs = map length (sort (group xs))\n</code></pre>\n\n<p>We here thus use brackets to specify that <code>sort (group xs)</code> is a parameter, the parameter in a function application with the function <code>map length :: [[a]] -&gt; [Int]</code>.</p>\n\n<p>Alternatively, we can use a point-free way like:</p>\n\n<pre><code>listLengths :: [Int] -&gt; [Int]\nlistLengths = map length . sort . group\n</code></pre>\n\n<p>Here we make use of the <code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</code> function to \"chain\" functions together. Notice that we do not have an <code>xs</code> parameter here. We thus construct a new function that first applies <code>group</code> to the input, then the output of this function is passed to the <code>sort</code> function, and finally the output of this function application is passed to the <code>map length</code> function.</p>\n\n<p>This will produce the output:</p>\n\n<pre><code>Prelude Data.List&gt; listLengths xs = map length (sort (group xs))\nPrelude Data.List&gt; listLengths [1,3,5,5,3]\n[1,1,1,2]\n</code></pre>\n\n<p>which is not completely what you want. This is because now we construct as groups: <code>[[1], [3], [5,5], [3]]</code> and then we sort these like <code>[[1], [3], [3], [5, 5]]</code> and then it will result in <code>[1, 1, 1, 2]</code> when we calculate the <code>length</code> of each subelement.</p>\n\n<p>What you thus probably want is:</p>\n\n<pre><code>listLengths :: [Int] -&gt; [Int]\nlistLengths = map length . group . sort\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 9663390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d995050ef3649a918a4dfd4ff15fe905?s=128&d=identicon&r=PG&f=1", "display_name": "compsciman", "link": "https://stackoverflow.com/users/9663390/compsciman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 0, "accepted_answer_id": 51655800, "answer_count": 1, "score": 0, "last_activity_date": 1533219987, "creation_date": 1533219031, "last_edit_date": 1533219251, "question_id": 51655737, "link": "https://stackoverflow.com/questions/51655737/haskell-why-cant-i-map-into-a-sorted-and-grouped-list-of-lists", "title": "Haskell - Why can&#39;t I map into a sorted and grouped list of lists?", "body": "<p>I have a function:</p>\n\n<pre><code>listLengths :: [Int] -&gt; [Int]\nlistLengths xs = map length sort(group(xs))\n</code></pre>\n\n<p>The <code>sort</code> and <code>group</code> work so when I input say <code>[1,3,5,5,3]</code> it separates and sorts it into <code>[[1],[3,3],[5,5]]</code>. However when I add <code>map length</code> as above it should then say <code>[1,2,2]</code> (the lengths of each of those lists but all I seem to get are type errors.</p>\n"}, {"tags": ["haskell", "nested", "functor"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1533218048, "post_id": 51652842, "comment_id": 90274297, "body": "I worry that the question is so general that it&#39;s not answerable. I can think of at least three possible approaches off the top of my head, each appropriate in different situations, and I expect with some effort I could come up with a dozen more -- with nowhere near enough detail in the question itself to choose between them. Listing them all would be a hopeless and neverending task."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1533218440, "post_id": 51652842, "comment_id": 90274582, "body": "You might want to check out <a href=\"https://hackage.haskell.org/package/transformers-0.3.0.0/docs/Data-Functor-Compose.html\" rel=\"nofollow noreferrer\"><code>Data.Functor.Compose</code></a> as an option. It tends to just shift the complexity from the <code>fmap</code> to the target value, though. <code>fmap classify (Compose . Compose $ parseRectangle)</code>, and the result will be wrapped in two layers of a newtype that you&#39;d have to strip (though maybe not immediately) with <code>getCompose . getCompose</code>."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1533220380, "post_id": 51652842, "comment_id": 90275943, "body": "@DanielWagner, can you think of a way to make the question more specific so that it would be answerable in your view? Honestly, I imagine this is a problem many people have so listing some solutions and their pros/cons might be extremely helpful."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1533223806, "post_id": 51652842, "comment_id": 90278345, "body": "@robx This is all very subjective, but I think a problem with <code>parseRectangle</code> is that it returns a half-digested thing: a map corresponding to positions in some board, but still containing chars from the original text.  I would perhaps let <code>parseRectangle</code> take the classifier as a parameter, and make it return the &quot;fully converted&quot; data."}], "answers": [{"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": true, "score": 1, "last_activity_date": 1533230825, "creation_date": 1533230825, "answer_id": 51659202, "question_id": 51652842, "link": "https://stackoverflow.com/questions/51652842/how-do-i-get-a-handle-on-deep-stacks-of-functors-in-haskell/51659202#51659202", "title": "How do I get a handle on deep stacks of functors in Haskell?", "body": "<p>Let me break the ice on this interesting question that people seem shy about answering. This question probably comes down to more of a matter of style than anything, hence the lack of answers.  </p>\n\n<p>My approach would be something like the following:</p>\n\n<pre><code>parseClassifiedRectangle :: Parser (Map (Int, Int) (Maybe Class))\nparseClassifiedRectangle = doClassify &lt;$&gt; parseRectangle\n  where\n    doClassify = Map.map (fmap classify)\n</code></pre>\n\n<p>I try to use <code>&lt;$&gt;</code> for the top level Functor, and save <code>fmap</code> for interior functors; although that doesn't always work too well in practice. </p>\n\n<p>I've used a local named binding. But even if <code>doClassify</code> were left as <code>f</code> it sometimes helps clarify a high level view of whats happening: \"on the parsed value we are doing a thing, see below for what thing does.\" I don't know what the efficiency concerns are for making a binding. </p>\n\n<p>I've also used the specific instance of <code>fmap</code> for the Map instance. This helps orient me within the stack and gives a signpost for the final <code>fmap</code>. </p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 51659202, "answer_count": 1, "score": 6, "last_activity_date": 1533230825, "creation_date": 1533210409, "question_id": 51652842, "link": "https://stackoverflow.com/questions/51652842/how-do-i-get-a-handle-on-deep-stacks-of-functors-in-haskell", "title": "How do I get a handle on deep stacks of functors in Haskell?", "body": "<p>Now and then I find myself mapping over a deep stack of functors, e.g. a parser for some collection of optional values:</p>\n\n<pre><code>-- parse a rectangular block of characters to a map of\n-- coordinate to the character, or Nothing for whitespace\nparseRectangle :: Parser (Map (Int, Int) (Maybe Char))\n\ndata Class = Letter | Digit | Other\n\nclassify :: Char -&gt; Class\n\nparseClassifiedRectangle :: Parser (Map (Int, Int) (Maybe Class))\nparseClassifiedRectangle = fmap (fmap (fmap classify)) parseRectangle\n</code></pre>\n\n<p>What are some good ways around the nested <code>fmap</code>s? Oftentimes it's not as clear as here, and I end up adding <code>fmap</code>s until the code type checks. Simple code ends up as a mess of <code>fmap</code> boilerplate, where what I really want to express is \"lift this function to the appropriate depth and apply it to the contained type\".</p>\n\n<p>Some ideas, none of which I've found particularly satisfactory so far:</p>\n\n<ul>\n<li>define <code>fmap2 :: (Functor f, Functor g) =&gt; (a -&gt; b) -&gt; g (f a) -&gt; g (f b)</code> and friends</li>\n<li>define concrete helpers, like <code>mapMaybeMap :: (a -&gt; b) -&gt; Map k (Maybe a) -&gt; Map k (Maybe b)</code></li>\n<li>introduce <code>newtype</code> wrappers for the functor stack, and make those instances of <code>Functor</code>, like <code>newtype MaybeMapParser a = Parser (Map (Int, Int) (Maybe a))</code></li>\n</ul>\n\n<p>Do others run into this problem in large codebases? Is it even a problem? How do you deal with it?</p>\n"}, {"tags": ["haskell", "build", "dependencies", "genetic-algorithm", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 1832, "user_id": 4230985, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fGVs0B-vLPU/AAAAAAAAAAI/AAAAAAAAAMg/uF4gfNSG8NQ/photo.jpg?sz=128", "display_name": "hgiasac", "link": "https://stackoverflow.com/users/4230985/hgiasac"}, "is_accepted": false, "score": 0, "last_activity_date": 1533181991, "creation_date": 1533181991, "answer_id": 51645228, "question_id": 51645138, "link": "https://stackoverflow.com/questions/51645138/stack-fails-to-build-monad-mersenne-random-0-1-package/51645228#51645228", "title": "stack fails to build monad-mersenne-random-0.1 package", "body": "<p>This library is somewhat too old. GHC version from 7.10 or above can't compile it \nIf you need to use Random library, you can find another alternative such as <a href=\"https://hackage.haskell.org/package/MonadRandom-0.1.3/docs/Control-Monad-Random.html\" rel=\"nofollow noreferrer\">MonadRandom</a></p>\n\n<p>IMO, GHC 8.4 is too new for production, many libraries haven't supported it yet. You should use GHC 8.2.2 or below</p>\n"}], "owner": {"reputation": 1, "user_id": 6615539, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-BUwQniJuc74/AAAAAAAAAAI/AAAAAAAAAF4/wjspbkXx7Ok/photo.jpg?sz=128", "display_name": "Ignacio", "link": "https://stackoverflow.com/users/6615539/ignacio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533223220, "creation_date": 1533181151, "last_edit_date": 1533223220, "question_id": 51645138, "link": "https://stackoverflow.com/questions/51645138/stack-fails-to-build-monad-mersenne-random-0-1-package", "title": "stack fails to build monad-mersenne-random-0.1 package", "body": "<p>I'm trying to install moo stackage and it has the monad-mersenne-random dependency which is giving me the following error. The stack project is fresh created. I tried to add the dependency to the configuration files but it didn't help, and I got the same error.</p>\n\n<pre><code># stack build monad-mersenne-random-0.1\n</code></pre>\n\n<p>gives me:</p>\n\n<pre><code>&gt;&gt;/tmp/stack8403/monad-mersenne-random-0.1/Control/Monad/Mersenne/Random.hs:50:10: error:\n&gt;&gt;    \u2022 No instance for (Applicative Rand)\n&gt;&gt;        arising from the superclasses of an instance declaration\n&gt;&gt;    \u2022 In the instance declaration for \u2018Monad Rand\u2019\n&gt;&gt;    |\n&gt;&gt; 50 | instance Monad Rand where\n&gt;&gt;    |          ^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1533179382, "post_id": 51644837, "comment_id": 90253848, "body": "Not related to your problem, but I recommend factoring out the stuff inside <code>many</code> into a separate (possibly non-exported) function. Your <code>parseString</code> is looking a bit monolithic there, and that&#39;d be a pretty good place to modularize it a bit."}, {"owner": {"reputation": 227, "user_id": 7746815, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1755397174722958/picture?type=large", "display_name": "Victor Feitosa", "link": "https://stackoverflow.com/users/7746815/victor-feitosa"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1533181469, "post_id": 51644837, "comment_id": 90254303, "body": "Thanks for the tip! I&#39;ll do it for sure"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1533227066, "post_id": 51644837, "comment_id": 90280116, "body": "As a small syntactic improvement, instead of <code>string &quot;\\\\\\&quot;&quot; &gt;&gt; return &#39;&quot;&#39;</code> you should be able to write <code>&#39;&quot;&#39; &lt;$ string &quot;\\\\\\&quot;&quot;</code>. The <code>(&lt;$) :: a -&gt; f b -&gt; f a</code> operator runs the functor on the right and evaluates to the value on the left."}], "answers": [{"comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1533179531, "post_id": 51644937, "comment_id": 90253885, "body": "Why use <code>anyChar</code> at all? If you use <code>noneOf &quot;\\&quot;\\\\&quot;</code>, the order doesn&#39;t matter."}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1533179693, "post_id": 51644937, "comment_id": 90253914, "body": "Fair point. Edited. The only possible problem is that this won&#39;t (currently) parse backslash at all if not followed by a quote. But I imagine the OP is fixing to add other backslash escape-sequences, so that&#39;s the way we probably want it to look anyway. Thanks for the suggestion! :)"}, {"owner": {"reputation": 227, "user_id": 7746815, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1755397174722958/picture?type=large", "display_name": "Victor Feitosa", "link": "https://stackoverflow.com/users/7746815/victor-feitosa"}, "edited": false, "score": 0, "creation_date": 1533181513, "post_id": 51644937, "comment_id": 90254313, "body": "Worked like charm! Thanks for the great answer"}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 3, "last_activity_date": 1533179614, "last_edit_date": 1533179614, "creation_date": 1533179336, "answer_id": 51644937, "question_id": 51644837, "link": "https://stackoverflow.com/questions/51644837/transforming-into-using-haskell-parsec/51644937#51644937", "title": "Transforming \\&quot; into &quot; using Haskell / Parsec", "body": "<p>Writing <code>\"\\\"\"</code> in Haskell produces a string with a single element. That's because the Haskell parser is consuming the backslash and it never gets to your program. You need to double escape it, so that both Haskell and your parser are satisfied.</p>\n\n<pre><code>noneOf \"\\\"\\\\\" &lt;|&gt; (string \"\\\\\\\"\" &gt;&gt; return '\"')\n</code></pre>\n"}], "owner": {"reputation": 227, "user_id": 7746815, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1755397174722958/picture?type=large", "display_name": "Victor Feitosa", "link": "https://stackoverflow.com/users/7746815/victor-feitosa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 51644937, "answer_count": 1, "score": 2, "last_activity_date": 1533179614, "creation_date": 1533178396, "question_id": 51644837, "link": "https://stackoverflow.com/questions/51644837/transforming-into-using-haskell-parsec", "title": "Transforming \\&quot; into &quot; using Haskell / Parsec", "body": "<p>I'm going through <a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours\" rel=\"nofollow noreferrer\">Write Yourself A Scheme</a> tutorial and there's a exercise which I can't solve.</p>\n\n<blockquote>\n  <p>Our strings aren't quite R5RS compliant, because they don't support escaping of internal quotes within the string. Change <code>parseString</code> so that \\\" gives a literal quote character instead of terminating the string. You may want to replace <code>noneOf \"\\\"\"</code> with a new parser action that accepts either a non-quote character or a backslash followed by a quote mark.</p>\n</blockquote>\n\n<p>The actual ParseString code function is:</p>\n\n<pre><code>parseString :: Parser LispVal\nparseString = do\n        char '\"'\n        x &lt;- many (noneOf \"\\\"\")\n        char '\"'\n        return $ String x\n</code></pre>\n\n<p>I've tried in many ways to do it. My attempted solution was:</p>\n\n<pre><code>parseString :: Parser LispVal\nparseString = do\n        char '\"'\n        x &lt;- many (satisfy (/= '\"') &lt;|&gt; (string \"\\\"\" &gt;&gt; return '\"'))\n        char '\"'\n        return $ String x\n</code></pre>\n\n<p>My rationale is that <code>(string \"\\\"\" &gt;&gt; return '\"')</code> will consume a string formed \\\" and return a single double-quote character, but it's not working as expected. I also researched over the internet but didn't found a solution.</p>\n"}]