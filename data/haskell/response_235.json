[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1562780455, "post_id": 56975954, "comment_id": 100488209, "body": "It&#39;s the &quot;dreaded&quot; monomorphism restriction that makes <code>f</code> have type <code>Integer</code> in your first example. I&#39;m surprised the explicit polymorphic type doesn&#39;t work, but I can&#39;t check right now."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 7, "creation_date": 1562783933, "post_id": 56975954, "comment_id": 100489735, "body": "@RobinZigmond You need to give the type to <code>f</code>, not its definition to work. <code>let f :: Num a =&gt; a ; f = 10</code>. Otherwise, you are giving <code>10</code> its own type, which is a no-op -- later on it will still be instantiated following the DMR."}, {"owner": {"reputation": 5649, "user_id": 49733, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/46d6184d8f4347ca961b6a9479a8cf2f?s=128&d=identicon&r=PG&f=1", "display_name": "Francisco Ryan Tolmasky I", "link": "https://stackoverflow.com/users/49733/francisco-ryan-tolmasky-i"}, "edited": false, "score": 0, "creation_date": 1562789018, "post_id": 56975954, "comment_id": 100491815, "body": "Ah, I see. Thanks!"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1562796650, "post_id": 56975954, "comment_id": 100494428, "body": "thanks @chi, that makes sense, I don&#39;t think I realised that the annotation was given to the literal <code>10</code> rather than the variable <code>f</code>."}], "owner": {"reputation": 5649, "user_id": 49733, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/46d6184d8f4347ca961b6a9479a8cf2f?s=128&d=identicon&r=PG&f=1", "display_name": "Francisco Ryan Tolmasky I", "link": "https://stackoverflow.com/users/49733/francisco-ryan-tolmasky-i"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "closed_date": 1562780412, "answer_count": 0, "score": 4, "last_activity_date": 1562780316, "creation_date": 1562780316, "question_id": 56975954, "link": "https://stackoverflow.com/questions/56975954/can-i-return-num-a-just-like-literals-seem-to-be-able-to-return-num-a", "closed_reason": "Duplicate", "title": "Can I &quot;return&quot; Num a just like literals seem to be able to &quot;return&quot; Num a?", "body": "<p>In ghci, if I do</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Prelude&gt; :t 5\nPrelude&gt; 5 :: Num a =&gt; a\n</code></pre>\n\n<p>But if I assign 5, I get <code>Integer</code> as the type:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>Prelude&gt; let f = 5\nPrelude&gt; t: f\nPrelude&gt; f :: Integer\n</code></pre>\n\n<p>From my understanding, the fact that 5 is <code>Num a =&gt; a</code> allows is to sit in any mathematical expression happily (such as <code>5 + 5.0</code>). I guess I'm curious if this is Haskell magic, or whether I can make a variable <code>f</code> that behave the same way, so that I can do <code>f + 5.0</code>. I've tried the following with no luck:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>let f = 10 :: Num a =&gt; a\n</code></pre>\n\n<p><code>f + 5.0</code> still gives me an error.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562763931, "post_id": 56971317, "comment_id": 100479171, "body": "What if you run this in verbose mode? So <code>-v</code>? Then it should show the list of packages it has searched through."}, {"owner": {"reputation": 2158, "user_id": 9991455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ff5d55afd5d829849efbf27962dd320?s=128&d=identicon&r=PG&f=1", "display_name": "Lorenzo", "link": "https://stackoverflow.com/users/9991455/lorenzo"}, "edited": false, "score": 1, "creation_date": 1562764505, "post_id": 56971317, "comment_id": 100479546, "body": "Not sure what the difference is, but I usually run <code>cabal install</code> without the <code>new-</code>. Just tried and it worked?"}, {"owner": {"reputation": 315, "user_id": 11764098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ddef6ea6d43e97e9ae553de2d05c3d5?s=128&d=identicon&r=PG&f=1", "display_name": "jerry_fuyi", "link": "https://stackoverflow.com/users/11764098/jerry-fuyi"}, "edited": false, "score": 0, "creation_date": 1562764854, "post_id": 56971317, "comment_id": 100479766, "body": "My cabal version is 2.4.1.0. It asked me to switch to new-install instead of using legacy v1 style command."}, {"owner": {"reputation": 315, "user_id": 11764098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ddef6ea6d43e97e9ae553de2d05c3d5?s=128&d=identicon&r=PG&f=1", "display_name": "jerry_fuyi", "link": "https://stackoverflow.com/users/11764098/jerry-fuyi"}, "edited": false, "score": 0, "creation_date": 1562765007, "post_id": 56971317, "comment_id": 100479864, "body": "It works after <code>cabal install</code>, but new errors raise."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 4, "creation_date": 1562766028, "post_id": 56971317, "comment_id": 100480359, "body": "You can save yourself some future hurt if you learn and use <code>stack</code> now."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1562772202, "post_id": 56971317, "comment_id": 100484062, "body": "The current status quo is a bit weird. We now can install things using <code>cabal install</code>, <code>cabal new-install</code>, and <code>stack install</code>. Then we might have a package installed system-wide, user-local, or in some even more local sandbox. It can easily get messy. I now tend to do everything using <code>stack</code>, since the community seems to be slowly going in that direction. It could be simpler, though."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1562804589, "post_id": 56971317, "comment_id": 100496065, "body": "@chi the plan is actually that there will be only two options: <code>cabal new-install</code> (which will then be called simply <code>cabal install</code>) and <code>stack install</code>. No sandboxes or anything."}], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 3, "last_activity_date": 1562812599, "last_edit_date": 1562812599, "creation_date": 1562800444, "answer_id": 56979729, "question_id": 56971317, "link": "https://stackoverflow.com/questions/56971317/how-to-install-and-import-a-library-in-haskell/56979729#56979729", "title": "How to install and import a library in haskell?", "body": "<p>As @Lorenzo noted, <code>cabal install</code> works fine.  With <code>cabal new-install</code> you should have seen a warning that you forgot <code>--lib</code> since <code>parallel</code> does not include an executable and libraries must be explicitly installed via <code>--lib</code>.  The full set of functional commands are:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>cd $(mktemp -d)\ncabal update &amp;&amp; cabal new-install --lib parallel\ncat &lt;&lt;EOF &gt; parallel.hs\nmodule P where\nimport Control.Parallel\nEOF\nghc -c parallel.hs\nls parallel.o parallel.hi\n</code></pre>\n\n<p>Yielding:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>% cd $(mktemp -d)\n% cabal update &amp;&amp; cabal new-install --lib parallel\n... snipped output ...\n% cat &lt;&lt;EOF &gt; parallel.hs\nmodule P where\nimport Control.Parallel\nEOF\n% ghc -c parallel.hs\nLoaded package environment from /home/tommd/.ghc/x86_64-linux-8.6.4/environments/default\n% ls parallel.o parallel.hi\nparallel.hi  parallel.o\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 11764098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ddef6ea6d43e97e9ae553de2d05c3d5?s=128&d=identicon&r=PG&f=1", "display_name": "jerry_fuyi", "link": "https://stackoverflow.com/users/11764098/jerry-fuyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1803, "favorite_count": 0, "accepted_answer_id": 56979729, "answer_count": 1, "score": 3, "last_activity_date": 1562812599, "creation_date": 1562763774, "last_edit_date": 1562765823, "question_id": 56971317, "link": "https://stackoverflow.com/questions/56971317/how-to-install-and-import-a-library-in-haskell", "title": "How to install and import a library in haskell?", "body": "<p>In official tutorial <a href=\"https://wiki.haskell.org/Haskell_in_5_steps\" rel=\"nofollow noreferrer\">Haskell in 5 steps</a>, an example imports a library:</p>\n\n<pre><code>import Control.Parallel\n</code></pre>\n\n<p>Then I use ghc to compile:</p>\n\n<pre><code>ghc parallel.hs -o parallel -O2 --make -threaded -rtsopts\n</code></pre>\n\n<p>just as the tutorial tells me to do. (My filename is parallel.hs) But I got:</p>\n\n<pre><code>parallel.hs:1:1: error:\nCould not find module \u2018Control.Parallel\u2019\nUse -v to see a list of the files searched for.\n  |\n1 | import Control.Parallel\n  | ^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Then I stackoverflowed it and find <a href=\"https://stackoverflow.com/questions/9575886/control-parallel-compile-issue-in-haskell\">this question</a>. So I:</p>\n\n<pre><code>cabal new-install parallel --lib\n</code></pre>\n\n<p>And get:</p>\n\n<pre><code>Resolving dependencies...\nUp to date \n</code></pre>\n\n<p>Then I compiled it again, but got the same error.\nHow to solve this? Did I miss any command line arguments?</p>\n\n<hr>\n\n<p>Well, after <code>cabal install parallel</code>, the library is imported, the program is compiled successfully, and runs as expected.</p>\n\n<p>I'll refer to documentations of cabal about the difference between <code>install</code> and <code>new-install</code></p>\n"}, {"tags": ["parsing", "haskell", "parser-generator", "happy"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1562756724, "post_id": 56969142, "comment_id": 100475239, "body": "Hint: you can inspect GHC&#39;s grammar: <a href=\"https://github.com/ghc/ghc/blob/master/compiler/parser/Parser.y\" rel=\"nofollow noreferrer\">github.com/ghc/ghc/blob/master/compiler/parser/Parser.y</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1562759008, "post_id": 56969142, "comment_id": 100476435, "body": "IIRC, GHC parses all infix operators ignoring fixities, and then later on transforms the AST according to the fixities. Essentially, precedence and associativity are fixed after parsing. I don&#39;t know if this is actually easier -- maybe it is."}, {"owner": {"reputation": 792, "user_id": 9382127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EMHsr.png?s=128&g=1", "display_name": "Foxy", "link": "https://stackoverflow.com/users/9382127/foxy"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1562789143, "post_id": 56969142, "comment_id": 100491856, "body": "@chi \u2013 So it would be a &quot;post-parsing&quot; element?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1562789484, "post_id": 56969142, "comment_id": 100491978, "body": "Well, it happens during type checking, at the &quot;right&quot; time. The general idea is: GHC already infers <code>10 :: Num a =&gt; a</code> so, if we annotate <code>10</code> in that way, we do not tell GHC anything it does not already know -- it&#39;s a no-op. Instead, the type of <code>f</code> is inferred (because of the MR) to something else, so annotating that matters. The full explanation is a bit tricky, and requires digging inside the type system, GHC Core, MR, and some other gory details."}], "answers": [{"comments": [{"owner": {"reputation": 792, "user_id": 9382127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EMHsr.png?s=128&g=1", "display_name": "Foxy", "link": "https://stackoverflow.com/users/9382127/foxy"}, "edited": false, "score": 0, "creation_date": 1562789058, "post_id": 56974144, "comment_id": 100491825, "body": "I really appreciate the way Swift is solving this problem, thank you! If I want to try to implement it, then do you think I should also communicate the parser and lexer, as you describe in your first part of the answer?"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 792, "user_id": 9382127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EMHsr.png?s=128&g=1", "display_name": "Foxy", "link": "https://stackoverflow.com/users/9382127/foxy"}, "edited": false, "score": 1, "creation_date": 1562792309, "post_id": 56974144, "comment_id": 100493094, "body": "@foxy: no, as I suggest in the answer the best route is to make the expression tree after the parse, pethsps in the semantic action for a parenthesised list of items."}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 2, "last_activity_date": 1562772932, "creation_date": 1562772932, "answer_id": 56974144, "question_id": 56969142, "link": "https://stackoverflow.com/questions/56969142/add-operators-during-parsing/56974144#56974144", "title": "Add operators during parsing", "body": "<p>Haskell only allows a few precedence levels. So you don't strictly need a dynamic grammar; you could just write out the grammar using precedence-level  token classes instead of individual operators, leaving the lexer with the problem of associating a given symbol with a given precedence level.</p>\n\n<p>In effect, that moves the dynamic addition of operators to the lexer. That's a slightly uncomfortable design decision, although in some cases it may not be too difficult to implement. It's uncomfortable design because it requires semantic feedback to the lexer; at a minimum, the lexer needs to consult the symbol table to figure out what type of token it is looking at. In the case of Haskell, at least, this is made more uncomfortable by the fact that fixity declarations are scoped, so in order to track fixity information, the lexer would also need to understand scoping rules.</p>\n\n<p>In practice, most languages which allow program text to define operators and operator precedence work in precisely the same way the Haskell compiler does: expressions are parsed by the grammar into a simple list of items (where parenthesized subexpressions count as a single item), and in a later semantic analysis the list is rearranged into an actual tree taking into account precedence and associativity rules, using a simple version of the shunting yard algorithm. (It's a simple version because it doesn't need to deal with parenthesized subconstructs.)</p>\n\n<p>There are several reasons for this design decision:</p>\n\n<ol>\n<li><p>As mentioned above, for the lexer to figure out what the precedence of a symbol is (or even if the symbol is an operator with precedence) requires a close collaboration between the lexer and the parser, which many would say violates separation of concerns. Worse, it makes it difficult or impossible to use parsing technologies without a small fixed lookahead, such as GLR parsers.</p></li>\n<li><p>Many languages have more precedence levels than Haskell. In some cases, even the number of precedence levels is not defined by the grammar. In Swift, for example, you can declare your own <a href=\"https://docs.swift.org/swift-book/ReferenceManual/Declarations.html#ID550\" rel=\"nofollow noreferrer\">precedence levels</a>, and you define a level not with a number but with a comparison to another previously defined level, leading to a partial order between precedence levels.</p>\n\n<p>IMHO, that's actually a better design decision than Haskell, in part because it avoids the ambiguity of a precedence level having both left- and right-associative operators, but more importantly because the relative precedence declarations both avoid magic numbers and allow the parser to flag the ambiguous use of operators from different modules. In other words, it does not force a precedence declaration to mechanically apply to any pair of totally unrelated operators; in this sense it makes operator declarations easier to compose.</p></li>\n<li><p>The grammar is much simpler, and arguably easier to understand since most people anyway rely on precedence tables rather than analysing grammar productions to figure out how operators interact with each other. In that sense, having precedence set by the grammar is more a distraction than documentation. See the C++ grammar as a good example of why precedence tables are easier to read than grammars.</p>\n\n<p>On the other hand, as the C++ grammar also illustrates, a grammar is a lot more general than simple precedence declarations because it can express asymmetric precedences. (The grammar doesn't always express these gracefully, but they can be expressed.) A classic example of an asymmetric precedence is a lambda construct (<code>&lambda; ID expr</code>) which binds very loosely to the right and very tightly to the left: the expected parse of <code>a &compfn; &lambda; b b &compfn; a</code> does not ever consult the associativity of &compfn; because the &lambda; comes between them.</p></li>\n</ol>\n\n<p>In practice, there is very little cost to building the tree later. The algorithm to build the tree is well-known, simple and cheap.</p>\n"}], "owner": {"reputation": 792, "user_id": 9382127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EMHsr.png?s=128&g=1", "display_name": "Foxy", "link": "https://stackoverflow.com/users/9382127/foxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 56974144, "answer_count": 1, "score": 3, "last_activity_date": 1562772932, "creation_date": 1562755923, "question_id": 56969142, "link": "https://stackoverflow.com/questions/56969142/add-operators-during-parsing", "title": "Add operators during parsing", "body": "<p>I try a bit the parser generators with Haskell, using Happy here. I used to use parser combinators before, such as Parsec, and one thing I can't achieve now with that is the dynamic addition (during execution) of new externally defined operators. For example, Haskell has some basic operators, but we can add more, giving them precedence and fixity. So I would like to know how to reproduce this with Happy, following the Haskell design (view example code bellow to be parsed), if it is not trivially feasible, or if it should perhaps be done through the parser combinators.</p>\n\n<pre><code>-- Adding the new operator\ninfixl 5 ++\n\n(++) :: [a] -&gt; [a] -&gt; [a]\n[]     ++ ys = ys\n(x:xs) ++ ys = x : xs ++ ys\n\n-- Using the new operator taking into consideration fixity and precedence during parsing\nexample = \"Hello, \" ++ \"world!\"\n</code></pre>\n"}, {"tags": ["haskell", "hdbc"], "comments": [{"owner": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "edited": false, "score": 0, "creation_date": 1563000651, "post_id": 56963591, "comment_id": 100565030, "body": "What happens when you use <code>fetchAllRows&#39;</code> instead of <code>fetchAllRows</code>?"}, {"owner": {"reputation": 361, "user_id": 10595010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/794f8e34f27cb955cabe10bd43f27568?s=128&d=identicon&r=PG&f=1", "display_name": "Ouyang Ze", "link": "https://stackoverflow.com/users/10595010/ouyang-ze"}, "reply_to_user": {"reputation": 4614, "user_id": 1378868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84a42920594ee2a0cc33012c407fd9d5?s=128&d=identicon&r=PG", "display_name": "snak", "link": "https://stackoverflow.com/users/1378868/snak"}, "edited": false, "score": 0, "creation_date": 1572242342, "post_id": 56963591, "comment_id": 103486252, "body": "That didn&#39;t work... I did end up getting this to work, by switching out the HDBC dependency to the mysql-haskell library."}], "owner": {"reputation": 361, "user_id": 10595010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/794f8e34f27cb955cabe10bd43f27568?s=128&d=identicon&r=PG&f=1", "display_name": "Ouyang Ze", "link": "https://stackoverflow.com/users/10595010/ouyang-ze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1562734404, "creation_date": 1562734404, "question_id": 56963591, "link": "https://stackoverflow.com/questions/56963591/hdbc-odbc-fetchallrows-returns-sqlerror", "title": "HDBC ODBC fetchAllRows returns SqlError", "body": "<p>I'm trying to get a simple haskell program to talk to a MySQL database.  The program builds properly, but when I run the program, I get about half of the output from the first query, and then the following error which I'm having difficulty interpreting:</p>\n\n<p><code>SqlError {seState = \"[]\", seNativeError = -2, seErrorMsg = \"sqlFetch: []\"}</code></p>\n\n<p>The program takes rows of labelled boxes of text from images out of a MySQL database and parses it into a fixed format.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>query :: Option -&gt; String -&gt; IO SupplementalFacts\nquery op queryText = do\n  conn &lt;- connectODBC \"DSN=imgparse\"\n  stmt &lt;- prepare conn queryText\n  execute stmt [] &gt;&gt; fetchRow stmt\n  handle op stmt where\n    unSQLString x = fromSql x :: String\n    unSQLInteger x = fromSql x :: Integer\n    unSQLRow (x:xs) = Ocr (unSQLString x) (locatize $ unSQLInteger &lt;$&gt; xs)\n    handle option statement\n      | option == Parsed = (fetchAllRows statement) &gt;&gt;= (\\rows -&gt; return $ parseTable $ unSQLRow &lt;$&gt; rows)\n\n\ntranslit :: URL -&gt; IO SupplementalFacts\ntranslit u = query Parsed $ \"SELECT description, x_1, y_1, x_3, y_3 FROM ocr_json_response where pic_url='\" ++ u ++ \"'\"\n\nparseTable :: [OcrRow] -&gt; SupplementalFacts\n...\n</code></pre>\n\n<p>with the app/Main.hs...</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>main :: IO ()\nmain = do\n       translit url1 &gt;&gt;= (\\x -&gt; putStrLn $ show x)\n       translit url2 &gt;&gt;= (\\x -&gt; putStrLn $ show x)\n       translit url3 &gt;&gt;= (\\x -&gt; putStrLn $ show x)\n       translit url4 &gt;&gt;= (\\x -&gt; putStrLn $ show x)\n       return ()\n</code></pre>\n\n<p>The Main.hs is currently just set up for testing the execution of a sample url input.</p>\n\n<p>Hopefully that's enough detail.  I'm also still very much \"climbing the haskell mountain\", so feel free to make any suggestions on the code as well.</p>\n"}, {"tags": ["haskell", "syntax", "escaping", "lexer"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1562712540, "post_id": 56961342, "comment_id": 100460514, "body": "It\u2019s an empty escape for breaking up other meaningful sequences. I don\u2019t remember exactly what it lets you write \u2013 <code>&quot;\\012\\&amp;3&quot;</code> or something?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 7, "creation_date": 1562713901, "post_id": 56961342, "comment_id": 100460763, "body": "The explanation you seek is <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-200002.6\" rel=\"nofollow noreferrer\">in section 2.6, Character and String Literals</a>."}], "answers": [{"comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 6, "creation_date": 1562714956, "post_id": 56961386, "comment_id": 100460949, "body": "It\u2019s also the zero-width equivalent of a <i>gap</i>: a backslash followed by some whitespace and another backslash is stripped from the string to allow multi-line string literals, but with no intervening whitespace this gives a single backslash. I\u2019ve found it useful to help syntax highlighters that get tripped up on gaps at the end of a string, since the literal ends with <code>\\&quot;</code> but that\u2019s not an escaped quotation mark."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 45, "last_activity_date": 1562776808, "last_edit_date": 1562776808, "creation_date": 1562712708, "answer_id": 56961386, "question_id": 56961342, "link": "https://stackoverflow.com/questions/56961342/what-does-an-escaped-ampersand-mean-in-haskell/56961386#56961386", "title": "What does an escaped ampersand mean in Haskell?", "body": "<p>It escapes... no character. It is useful to \"break\" some escape sequences. For instance \nwe might want to express <code>\"\\12\" ++ \"3\"</code> as a single string literal. If we try the obvious approach, we get</p>\n\n<pre><code>\"\\123\" ==&gt; \"{\"\n</code></pre>\n\n<p>We can however use</p>\n\n<pre><code>\"\\12\\&amp;3\"\n</code></pre>\n\n<p>for the intended result.</p>\n\n<p>Also, <code>\"\\SOH\"</code> and <code>\"\\SO\"</code> are both valid single ASCII character escapes, making <code>\"\\SO\" ++ \"H\"</code> tricky to express as a single literal: we need <code>\"\\SO\\&amp;H\"</code> for that.</p>\n\n<p>This escape trick is also exploited by the standard <code>Show String</code> instance, which has to produce a valid literal syntax. We can see this in action in GHCi:</p>\n\n<pre><code>&gt; \"\\140\" ++ \"0\"\n\"\\140\\&amp;0\"\n&gt; \"\\SO\" ++ \"H\"\n\"\\SO\\&amp;H\"\n</code></pre>\n\n<p>Further, this greatly helps external programs which aim to generate Haskell code (e.g. for metaprogramming). When emitting characters for a string literal, the external program can add <code>\\&amp;</code> at the end of potentially ambiguous escapes (or even of all escapes) so that the program does not have to handle unwanted interactions. E.g. if the program wants to emit <code>\\12</code> now, it can emit <code>\\12\\&amp;</code> and be free to emit anything as the next character. Otherwise, the program should remember that, when the next character is emitted, it has to be prepended by <code>\\&amp;</code> if it's a digit. It's simpler to always add <code>\\&amp;</code>, even if it's not needed: <code>\\12\\&amp;A</code> is legal, and has the same meaning as <code>\\12A</code>.</p>\n\n<p>Finally, a quote from the Haskell Report, explaining <code>\\&amp;</code>:</p>\n\n<blockquote>\n  <p>2.6  Character and String Literals</p>\n  \n  <p>[...]</p>\n  \n  <p>Consistent with the \"maximal munch\" rule, numeric escape characters in strings consist of all consecutive digits and may be of arbitrary length. Similarly, the one ambiguous ASCII escape code, <code>\"\\SOH\"</code>, is parsed as a string of length 1. The escape character <code>\\&amp;</code> is provided as a <code>\"null character\"</code> to allow strings such as <code>\"\\137\\&amp;9\"</code> and <code>\"\\SO\\&amp;H\"</code> to be constructed (both of length two). Thus <code>\"\\&amp;\"</code> is equivalent to <code>\"\"</code> and the character <code>'\\&amp;'</code> is disallowed. Further equivalences of characters are defined in Section 6.1.2.</p>\n</blockquote>\n"}], "owner": {"reputation": 895, "user_id": 4626533, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-YD0ktWjS7j0/AAAAAAAAAAI/AAAAAAAACyU/T7UotNQswJ4/photo.jpg?sz=128", "display_name": "Nolan", "link": "https://stackoverflow.com/users/4626533/nolan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1885, "favorite_count": 0, "accepted_answer_id": 56961386, "answer_count": 1, "score": 36, "last_activity_date": 1563316043, "creation_date": 1562712333, "last_edit_date": 1563316043, "question_id": 56961342, "link": "https://stackoverflow.com/questions/56961342/what-does-an-escaped-ampersand-mean-in-haskell", "title": "What does an escaped ampersand mean in Haskell?", "body": "<p>I looked at the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17700010.2\" rel=\"nofollow noreferrer\">Haskell 2010</a> report and noticed a weird escape sequence with an ampersand: <code>\\&amp;</code>. I couldn't  find an explanation what this escape sequence should stand for. It also might only be located in strings. I tried <code>print \"\\&amp;\"</code> in GHCi, and it prints an empty string.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1562712345, "post_id": 56961300, "comment_id": 100460485, "body": "<a href=\"https://stackoverflow.com/questions/35318562/what-is-levity-polymorphism\" title=\"what is levity polymorphism\">stackoverflow.com/questions/35318562/&hellip;</a>"}], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 1, "closed_date": 1562712437, "answer_count": 0, "score": 5, "last_activity_date": 1562712238, "creation_date": 1562711959, "last_edit_date": 1562712238, "question_id": 56961300, "link": "https://stackoverflow.com/questions/56961300/why-does-the-operator-in-haskell-have-such-a-strange-type", "closed_reason": "Duplicate", "title": "Why does the $ operator in Haskell have such a strange type?", "body": "<p>According to <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Function.html#v:-36-\" rel=\"nofollow noreferrer\">Hackage</a> the <code>$</code> operator has type</p>\n\n<pre><code>($) :: forall r a (b :: TYPE r). (a -&gt; b) -&gt; a -&gt; b \n</code></pre>\n\n<p>while I always thought it was</p>\n\n<pre><code>($) :: (a -&gt; b) -&gt; a -&gt; b\n</code></pre>\n\n<p>There is some explanation in the docs </p>\n\n<blockquote>\n  <p>Note that <code>($)</code> is levity-polymorphic in its result type, so that foo $ True where foo :: Bool -> Int# is well-typed</p>\n</blockquote>\n\n<p>but I don't understand it at all. Could somebody explain to me which issue this approach solves?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562705406, "post_id": 56960294, "comment_id": 100458617, "body": "One can only use these backticks for <i>varids</i>, <i>qvarid</i>, <i>conid</i> and <i>qconid</i>s. So variables (qualified or not), and constructors (qualified or not). For operators that is not allowed per Haskell grammar: <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch10.html\" rel=\"nofollow noreferrer\">haskell.org/onlinereport/haskell2010/haskellch10.html</a>"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562705438, "post_id": 56960294, "comment_id": 100458622, "body": "But you thus can simply assign <code>(.)</code> to a variable, like <code>let f = (+) in 2 `f` 3</code>. The idea is that the brackets <code>(...)</code> are more or less the opposite of what it does to an operator, compared to what backticks do to an identifier."}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562705593, "post_id": 56960294, "comment_id": 100458690, "body": "Ummm, at the risk of sounding stupid, what&#39;s a Lexeme?"}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562705714, "post_id": 56960294, "comment_id": 100458727, "body": "I mean, I googled it and it makes sense, but how do I grock it with regards to haskell so I can understand what a qvarid, varid, conid and qconid is?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562705743, "post_id": 56960294, "comment_id": 100458740, "body": "a lexeme is a part of your program (like a variable, an operator, etc.) <a href=\"https://en.wikipedia.org/wiki/Lexical_analysis#Lexeme\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Lexical_analysis#Lexeme</a>"}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562705840, "post_id": 56960294, "comment_id": 100458774, "body": "Ah right it&#39;s a token if, like me, you&#39;ve read bjarnn stroustropps cpp book."}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562706190, "post_id": 56960294, "comment_id": 100458901, "body": "Hmmm, so (.) is an operator? What exactly does that mean? Does it mean the sequence of characters (.) is reserved at the language level (just like + is in Java for instance). Or does haskell have an entirely different concept of what an operator is?  I found this table of Haskell operators but I cannot see (.) as one of them... <a href=\"https://imada.sdu.dk/~rolf/Edu/DM22/F05/haskell-operatorer.pdf\" rel=\"nofollow noreferrer\">imada.sdu.dk/~rolf/Edu/DM22/F05/haskell-operatorer.pdf</a>"}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "edited": false, "score": 0, "creation_date": 1562706433, "post_id": 56960294, "comment_id": 100458987, "body": "I think <code>(</code> and <code>)</code> are the operators being referred to? Not <code>.</code>"}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1562706620, "post_id": 56960294, "comment_id": 100459049, "body": "The <code>Infix-to-prefix constructors</code> then?"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1562723118, "post_id": 56960294, "comment_id": 100462424, "body": "I\u2019m surprised you tried to call the <code>.</code> operator as <code>x `(.)` y</code> when you didn\u2019t try <code>++</code> as <code>x `(++)` &quot; &quot; `(++)` y</code> or <code>*</code> as <code>(`(*)` 3)</code>. Only an alphanumeric name may be wrapped in backticks to change its fixity, and only an operator\u2019s fixity is changed by wrapping it in parens. You can\u2019t mix and match them\u2014but there\u2019s never a need to. Consider these equivalent definitions: <code>(.) = \\f g x -&gt; f (g x)</code> = <code>f . g = \\x -&gt; f (g x)</code> = <code>(f . g) x = f (g x)</code>, and their parallels with: <code>com = \\f g x -&gt; f (g x)</code> = <code>f `com` g = \\x -&gt; f (g x)</code> = <code>(f `com` g) x = f (g x)</code> = <code>com f g x = f (g x)</code>"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "edited": false, "score": 0, "creation_date": 1562740428, "post_id": 56960294, "comment_id": 100466548, "body": "@bwroga <code>(</code> and <code>)</code> and <i>not</i> operators. they are part of syntax."}], "answers": [{"comments": [{"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1562706940, "post_id": 56960590, "comment_id": 100459152, "body": "Cool that makes sense, but when you say &quot;the language provides conversions away from the default behaviour&quot; could you elaborate a bit (i.e. give some coded examples?)"}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1562707001, "post_id": 56960590, "comment_id": 100459167, "body": "For instance, why does:  <code>(,) :: Int -&gt; Int (,) x  = 1</code>  Not compile?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1562707026, "post_id": 56960590, "comment_id": 100459175, "body": "@ThomasCook You gave them yourself. <code>example x y</code> uses the by-default-prefix behavior, <code>x `example` y</code> converts from default-prefix to infix; meanwhile <code>f . g</code> uses the by-default-infix behavior, <code>(.) f g</code> converts from default-infix to prefix."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 4, "creation_date": 1562707107, "post_id": 56960590, "comment_id": 100459196, "body": "@ThomasCook Commas are not valid punctuation for the purpose of defining new by-default-prefix identifiers. You can consult the Report for the full list of valid punctuation."}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1562707146, "post_id": 56960590, "comment_id": 100459209, "body": "Eh?  By the logic:  example x y OR x <code>example</code> y  Then it should be:  (.) f g OR f <code>(.)</code> g  Surely?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 3, "creation_date": 1562707211, "post_id": 56960590, "comment_id": 100459227, "body": "@ThomasCook No, <code>.</code> is a by-default-infix identifier. <code>(.)</code> is <i>not</i> a by-default-prefix identifier; it is the conversion of a by-default-infix identifier to prefix form."}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 2, "creation_date": 1562707357, "post_id": 56960590, "comment_id": 100459281, "body": "Daniel your comment &quot;Commas are not valid punctuation for the purpose of defining new by-default-prefix identifiers&quot; made me go and write a function:  <code>($) :: a -&gt; a -&gt; a ($) x y = x ++ &quot; &quot; ++ y</code> which compiled, I was then able to write &quot;Hello&quot; $ &quot;World&quot; and get &quot;Hello World&quot;  It all makes sense now, thanks"}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 1, "creation_date": 1562711506, "post_id": 56960590, "comment_id": 100460334, "body": "@ThomasCook &quot;For instance, why does: <code>(,) :: Int -&gt; Int (,) x = 1</code> Not compile?&quot; You can&#39;t use commas, they&#39;re reserved. There is also already a built-in constructor <code>(,)</code>, which is the prefix form for a two-tuple: <code>(,) x y == (x, y)</code>"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 13, "last_activity_date": 1562707292, "last_edit_date": 1562707292, "creation_date": 1562706828, "answer_id": 56960590, "question_id": 56960294, "link": "https://stackoverflow.com/questions/56960294/why-is-called-infix-as-just-rather-than/56960590#56960590", "title": "Why is (.) called infix as just . rather than `(.)`", "body": "<p>There's nothing deep here. There's just two kinds of identifiers that have different rules about how they're parsed: by-default-infix, and by-default-prefix. You can tell which is which, because by-default-infix identifiers contain only punctuation, while by-default-prefix identifiers contain only numbers, letters, apostrophes, and underscores.</p>\n\n<p>Recognizing that the default isn't always the right choice, the language provides conversions away from the default behavior. So there are two separate syntax rules, one that converts a by-default-infix identifier to prefix (add parentheses), and one that converts a by-default-prefix identifier to infix (add backticks). You can not nest these conversions: a by-default-infix identifier converted to prefix form is <em>not</em> a by-default-prefix identifier.</p>\n\n<p>That's it. Nothing fundamentally interesting -- all of them become just function applications once parsed -- it's just syntax sugar.</p>\n"}], "owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 56960590, "answer_count": 1, "score": 2, "last_activity_date": 1562722251, "creation_date": 1562705202, "last_edit_date": 1562722251, "question_id": 56960294, "link": "https://stackoverflow.com/questions/56960294/why-is-called-infix-as-just-rather-than", "title": "Why is (.) called infix as just . rather than `(.)`", "body": "<p>I learned that functions can be invoked in two ways; prefix and infix. For example, say I've created this function:</p>\n\n<pre><code>example :: [Char] -&gt; [Char] -&gt; [Char]\nexample x y = x ++ \" \" ++ y\n</code></pre>\n\n<p>I can call it prefix like so:</p>\n\n<pre><code>example \"Hello\" \"World\"\n</code></pre>\n\n<p>or infix like so:</p>\n\n<pre><code>\"Hello\" `example` \"World\"\n</code></pre>\n\n<p>Both of which will result in the list of chars representing a string <code>\"Hello World\"</code>.</p>\n\n<p>However, I am now learning about function composition, and have come across the function defined like so:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>So, say I was wanting to compose negate with multiplication by three. I would write the prefix invocation like:</p>\n\n<pre><code>negateComposedWithMultByThree = (.) negate (*3) \n</code></pre>\n\n<p>And the infix invocation like:</p>\n\n<pre><code>negateComposedWithMultByThree = negate `(.)` (*3)\n</code></pre>\n\n<p>But, whilst the prefix invocation compiles, the infix invocation does not and instead gives me the error message: </p>\n\n<blockquote>\n  <p>error: parse error on input `('</p>\n</blockquote>\n\n<p>It seems, in order to call compose infix, I need to omit the brackets and call it like so:</p>\n\n<pre><code>negateComposedWithMultByThree = negate . (*3)\n</code></pre>\n\n<p>Can anyone shed any light on this? Why does <code>\"Hello\" `example` \"World\"</code> whilst <code>negate `(.)` (*3)</code> does not?</p>\n\n<p>In addition, if I try to make my own function with a signature like this:</p>\n\n<pre><code>(,) :: Int -&gt; Int\n(,) x = 1\n</code></pre>\n\n<p>It does not compile, with the error: </p>\n\n<blockquote>\n  <p>\"Invalid type signature (,) : ... Should be of form  :: \"</p>\n</blockquote>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1562701302, "post_id": 56959328, "comment_id": 100457122, "body": "It&#39;s Template Haskell; it uses a quasi quoter to parse the contents of the <code>[$form| ... |]</code> brackets."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 3, "creation_date": 1562701396, "post_id": 56959328, "comment_id": 100457154, "body": "<code>form</code> is a <a href=\"http://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#template-haskell-quasi-quotation\" rel=\"nofollow noreferrer\">quasiquoter</a> defined <a href=\"https://github.com/andre-artus/handbook-of-practical-logic-and-automated-reasoning-haskell/blob/master/src/ATP/FormulaSyn.hs#L331\" rel=\"nofollow noreferrer\">here</a>. Looks like the purpose is to allow you to use the pretty notation to write logic formulas, instead of directly writing the patterns in Haskell syntax. I have no idea what the <code>$</code> does though ..."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1562701507, "post_id": 56959328, "comment_id": 100457200, "body": "@DarthFennec you beat me to the answer..."}], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 2451480, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95e45762c034523ac9d3948ba3b15bb9?s=128&d=identicon&r=PG", "display_name": "TFuto", "link": "https://stackoverflow.com/users/2451480/tfuto"}, "edited": false, "score": 0, "creation_date": 1562702224, "post_id": 56959574, "comment_id": 100457462, "body": "Re: $form: By <a href=\"https://wiki.haskell.org/Quasiquotation\" rel=\"nofollow noreferrer\">this link</a>,  the quasi-quote syntax has changed:   &gt;&gt; Note that the syntax for quasiquotation has changed since the paper was written: in GHC 7 one writes [expr|...|] instead of [:expr|...|]. GHC 6.12 uses [$expr|...|]. &lt;&lt;"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1250, "user_id": 2451480, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95e45762c034523ac9d3948ba3b15bb9?s=128&d=identicon&r=PG", "display_name": "TFuto", "link": "https://stackoverflow.com/users/2451480/tfuto"}, "edited": false, "score": 1, "creation_date": 1562702291, "post_id": 56959574, "comment_id": 100457486, "body": "Ah, it&#39;s so old already. Back then I didn&#39;t know how to use TH, let alone quasi-quotes!"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1562702352, "last_edit_date": 1562702352, "creation_date": 1562701435, "answer_id": 56959574, "question_id": 56959328, "link": "https://stackoverflow.com/questions/56959328/cannot-find-out-meaning-of-form-in-haskell-code/56959574#56959574", "title": "Cannot find out meaning of $form in Haskell code", "body": "<p><a href=\"https://github.com/andre-artus/handbook-of-practical-logic-and-automated-reasoning-haskell/blob/640e1fa85c27c24d491bffef34e7b92eb8769e9b/src/ATP/FormulaSyn.hs#L331\" rel=\"noreferrer\"><code>form</code></a> is a <a href=\"https://hackage.haskell.org/package/template-haskell-2.14.0.0/docs/Language-Haskell-TH-Quote.html#t:QuasiQuoter\" rel=\"noreferrer\">quasi-quoter</a>. Those give a way of invoking Template Haskell, to generate Haskell code from any other kind of syntax you wish, such as in this case Unicode logical formulas.</p>\n\n<p>Essentially, it's just user-definable syntactic sugar: before the actual compilation, <code>[$form| \u22a4 |]</code> will be resolved to the pattern <code>Top</code>, and <code>[$form| $p \u2227 $q |]</code> to the pattern <code>And p q</code>, etc. \u2013 i.e. basically to the same stuff you have also in the OCaml code. Arguably this is overkill for this function, but when generating and/or matching more complicated formulas this can certainly come in handy.</p>\n\n<p>That it's written <code>[$form|</code> and not just <code>[form|</code> is obsolete GHC-6 syntax. With current compilers, use the latter form.</p>\n"}], "owner": {"reputation": 1250, "user_id": 2451480, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95e45762c034523ac9d3948ba3b15bb9?s=128&d=identicon&r=PG", "display_name": "TFuto", "link": "https://stackoverflow.com/users/2451480/tfuto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 56959574, "answer_count": 1, "score": 4, "last_activity_date": 1562712080, "creation_date": 1562700057, "last_edit_date": 1562712080, "question_id": 56959328, "link": "https://stackoverflow.com/questions/56959328/cannot-find-out-meaning-of-form-in-haskell-code", "title": "Cannot find out meaning of $form in Haskell code", "body": "<p>I am following the Haskell version of the codebase of \"<a href=\"https://github.com/andre-artus/handbook-of-practical-logic-and-automated-reasoning-haskell/blob/master/src/ATP/Prop.hs\" rel=\"nofollow noreferrer\">Handbook of Practical Logic and Automated Reasoning</a>\". What is the purpose of <code>$form</code> in the case below?</p>\n\n<pre><code>eval :: Formula -&gt; (Rel -&gt; Bool) -&gt; Bool\neval fm v = case fm of\n  [$form| \u22a4 |] -&gt; True\n  [$form| \u22a5 |] -&gt; False\n  [$form| ^a |] -&gt; v a\n  [$form| \u00ac $p |] -&gt; not (eval p v)\n  [$form| $p \u2227 $q |] -&gt; eval p v &amp;&amp; eval q v\n  [$form| $p \u2228 $q |] -&gt; eval p v || eval q v\n  [$form| $p \u2283 $q |] -&gt; not (eval p v) || (eval q v)\n  [$form| $p \u21d4 $q |] -&gt; eval p v == eval q v\n  _ -&gt; error \"quantifier in prop eval\"\n</code></pre>\n\n<p>The relevant OCaml code is simply:</p>\n\n<pre><code>let rec eval fm v =\n  match fm with\n    False -&gt; false\n  | True -&gt; true\n  | Atom(x) -&gt; v(x)\n  | Not(p) -&gt; not(eval p v)\n  | And(p,q) -&gt; (eval p v) &amp; (eval q v)\n  | Or(p,q) -&gt; (eval p v) or (eval q v)\n  | Imp(p,q) -&gt; not(eval p v) or (eval q v)\n  | Iff(p,q) -&gt; (eval p v) = (eval q v);;\n</code></pre>\n"}, {"tags": ["haskell", "types", "compiler-errors", "pointfree", "partial-application"], "answers": [{"comments": [{"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 1, "creation_date": 1562684316, "post_id": 56955300, "comment_id": 100449180, "body": "Fantastic answer as always Willem - appreciate it!"}, {"owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1562684389, "post_id": 56955300, "comment_id": 100449228, "body": "Ah, this is the infix function application operator? I have seen it all over the place but never understood it, so this is like saying &quot;Apply the function (that is the current element in my list of partially applied functions that I&#39;m mapping over) to the value 4?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "edited": false, "score": 0, "creation_date": 1562687336, "post_id": 56955300, "comment_id": 100451031, "body": "@ThomasCook: the infix operator sectioning, specifies that <code>($ 4)</code> is equivalent to <code>\\x -&gt; ($) x 4</code>, since <code>($)</code> is implemented as <code>($) f x = f x</code>, it is thus equivalent to <code>\\x -&gt; x 4</code>"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 8, "last_activity_date": 1562683947, "creation_date": 1562683947, "answer_id": 56955300, "question_id": 56955169, "link": "https://stackoverflow.com/questions/56955169/haskell-non-type-variable-argument-in-the-constraint/56955300#56955300", "title": "Haskell &quot;Non type-variable argument in the constraint&quot;", "body": "<blockquote>\n  <p>However, I thought it would then follow that I could write:</p>\n\n<pre><code>let results = map (4) listOfPartiallyAppliedFunctions\n</code></pre>\n</blockquote>\n\n<p>No, if you would have performed <code>\\x -&gt; 4 x</code>, you could replace it with <code>4</code>. But since <code>4</code> means it is a <code>Num</code> instance, and you likely did not make a function <code>a -&gt; b</code> an instance of <code>Num</code>,  the compiler can not solve this. The compiler thus says that it does not find a way to convert the number <code>4</code> into a function, and definitely not a function that takes as input a function <code>Num a =&gt; a -&gt; a</code>, and then converts this to a <code>b</code>.</p>\n\n<p>You can however write the above as just:</p>\n\n<pre><code>let results = map <b>($ 4)</b> listOfPartiallyAppliedFunctions</code></pre>\n\n<p>Here we thus perform a <a href=\"https://wiki.haskell.org/Section_of_an_infix_operator\" rel=\"noreferrer\">sectioning of an infix operator [Haskell-wiki]</a> on the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-36-\" rel=\"noreferrer\"><strong><code>($) :: (a -&gt; b) -&gt; a -&gt; b</code></strong></a> function.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 8, "last_activity_date": 1562686634, "creation_date": 1562686634, "answer_id": 56956132, "question_id": 56955169, "link": "https://stackoverflow.com/questions/56955169/haskell-non-type-variable-argument-in-the-constraint/56956132#56956132", "title": "Haskell &quot;Non type-variable argument in the constraint&quot;", "body": "<p><a href=\"https://stackoverflow.com/a/13147064/849891\">Three \"laws\" of operator sections</a> are</p>\n\n<pre><code>(a `op` b)  =  (a `op`) b  =  (`op` b) a  =  op a b\n</code></pre>\n\n<p>(the missing argument goes into the free slot near the operator),</p>\n\n<p>or with <code>$</code>,</p>\n\n<pre><code>a b  =  (a $ b)  =  (a $) b  =  ($ b) a  =  ($) a b\n</code></pre>\n\n<p>Thus</p>\n\n<pre><code>(\\ x -&gt; x 4) = (\\ x -&gt; x $ 4) = (\\ x -&gt; ($ 4) x)\n</code></pre>\n\n<p>and that, by eta-reduction, is</p>\n\n<pre><code>($ 4) \n</code></pre>\n"}], "owner": {"reputation": 2771, "user_id": 5963279, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/10207102799463401/picture?type=large", "display_name": "Thomas Cook", "link": "https://stackoverflow.com/users/5963279/thomas-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 1, "accepted_answer_id": 56955300, "answer_count": 2, "score": 6, "last_activity_date": 1562706364, "creation_date": 1562683541, "last_edit_date": 1562706364, "question_id": 56955169, "link": "https://stackoverflow.com/questions/56955169/haskell-non-type-variable-argument-in-the-constraint", "title": "Haskell &quot;Non type-variable argument in the constraint&quot;", "body": "<p>I've created a list of partially applied functions in my REPL like so:</p>\n\n<pre><code>listOfPartiallyAppliedFunctions = map (*) [1..100]\n</code></pre>\n\n<p>I would then like to create the list of results from completing the function application, which I can easily do by providing a lambda to the map function like so:</p>\n\n<pre><code>let results = map (\\x -&gt; x 4) listOfPartiallyAppliedFunctions\n</code></pre>\n\n<p>Which basically means map the function x applied to 4 over the list of partially applied functions, where x is each partially applied function from the list. </p>\n\n<p>However, I thought it would then follow that I could write:</p>\n\n<pre><code>let results = map (4) listOfPartiallyAppliedFunctions\n</code></pre>\n\n<p>As there shouldn't be a need to provide a lambda to the map function as it should know to apply 4 to the partially applied functions contained in the <code>listOfPartiallyAppliedFunctions</code>.</p>\n\n<p>However, I am getting this error:</p>\n\n<pre><code>\u2022 Non type-variable argument in the constraint: Num ((a -&gt; a) -&gt; b)\n  (Use FlexibleContexts to permit this)\n\u2022 When checking the inferred type\n    it :: forall a b. (Num a, Num ((a -&gt; a) -&gt; b), Enum a) =&gt; [b]\n</code></pre>\n\n<p>Can someone help me parse this error? I thought <code>4</code> was an instance of type constructor Num?</p>\n"}, {"tags": ["haskell", "yesod"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1562680941, "post_id": 56954130, "comment_id": 100446997, "body": "That&#39;s not an error. It just is a redirection. This is likely because your <code>GetBanksR a</code> will make changes to the db, and make a redirect (usually a succesful post should redirect), due to the <a href=\"https://en.wikipedia.org/wiki/Post/Redirect/Get\" rel=\"nofollow noreferrer\"><i>Post/Redirect/Get</i> pattern</a>."}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562683022, "post_id": 56954130, "comment_id": 100448336, "body": "Thanks for the explanation , I think worded the question wrong , I understand its redirecting , but instead of redirecting to the url (a rest api not google auth) I want it to go to , it goes to the authR handler , I want to disable this behaviour ,So i basically want to understand which piece of code in the scaffolded yesod website is actually responsible for this."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562683083, "post_id": 56954130, "comment_id": 100448378, "body": "normally there should be a function named <code>postGetBanksR</code> that handles the request, and thus might/might not return the 303."}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562683319, "post_id": 56954130, "comment_id": 100448529, "body": "my postBankR is basically , Call a url , format the data returned by the url ,return the formatted data, in the call url step ,as soon as it tries to call the url ,it gets kicked into  GET auth/login , maybe becuase I dont have the authentication token  present in the session,  I want to stop yesod from doing that verification . I don&#39;t want it to verify whether the request is authenticated or not"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562683393, "post_id": 56954130, "comment_id": 100448581, "body": "if you set to <code>return Authorized</code>(and there is no clause above that one that matches), then Yesod will just allow it. Perhaps it is the URL you trigger that is authorizing?"}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562683525, "post_id": 56954130, "comment_id": 100448671, "body": "from the docs &quot;Yesod Middleware allows you to run code before and after each handler function &quot; . can it be that the middle ware is trying to authenticate request &quot;leaving&quot; as it is the requests &quot;coming in&quot;"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562683689, "post_id": 56954130, "comment_id": 100448784, "body": "the <code>defaultYesodMiddleware</code> adds some headers and makes an <code>isAuthorized</code> check, the one you just have set to <code>return Authorized</code>, in that case it will leave it. If it was  (src: <a href=\"https://hackage.haskell.org/package/yesod-core-1.6.14/docs/src/Yesod.Core.Class.Yesod.html#defaultYesodMiddleware\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/yesod-core-1.6.14/docs/src/&hellip;</a>)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562683740, "post_id": 56954130, "comment_id": 100448810, "body": "you can however just specify the <code>yesodMiddleware</code> as <code>yesodMiddleware = id</code>, to circumvent that."}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562683936, "post_id": 56954130, "comment_id": 100448941, "body": "it didn&#39;t solve it , my external call basically looks like r &lt;- liftIO $ Wreq.post submitForSignUrl (toJSON Arguments)  , is there something wrong with the way I am calling it ?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562684048, "post_id": 56954130, "comment_id": 100449019, "body": "well if I understand it correctly, you just return the result of that call. So it looks like you did not submit the credentials in the POST call your Yesod server made to a web service. You should consult the specs of the <code>submitForSignUrl</code> endpoint and see how you should add a usertoken/(other form of authentication)..."}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562685186, "post_id": 56954130, "comment_id": 100449768, "body": "the submitfor Sign url doesnt expect any authentication , moreover I run into this problem only when I use POST request , so getBankR works with the same exact piece of code , but postBankR doesnt."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562687193, "post_id": 56954130, "comment_id": 100450968, "body": "but do you make a POST request to the <code>submitForSignUrl</code> in your GET handler as well?"}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562690772, "post_id": 56954130, "comment_id": 100452759, "body": "yes , I just copied the code from the POST to GET ,exact same code , only difference is , the GET i can test from my browser so it has the session , the POST I am testing through a client so there is no session there , Thats why I added the return Authorized so that session doesnt create an issue."}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562691369, "post_id": 56954130, "comment_id": 100453017, "body": "I even added a   isAuthorized (_) _           = return Authorized  ,it still redirects to auth/login"}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1562694216, "post_id": 56954130, "comment_id": 100454167, "body": "Please do not put your code, or question in the comments."}, {"owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562698959, "post_id": 56954130, "comment_id": 100456183, "body": "@WillemVanOnsem , I got the thing resolved, the posttosign method basically had a call to the function requireAuthPair , commenting that fixed it for me .I think it was redirecting to the authRoute since the authPair was not present in the session . I guess I should change that to maybeAuthpair"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1562682304, "last_edit_date": 1562682304, "creation_date": 1562681407, "answer_id": 56954504, "question_id": 56954130, "link": "https://stackoverflow.com/questions/56954130/calling-a-rest-api-from-a-yesod-handler/56954504#56954504", "title": "Calling a rest API from a yesod handler", "body": "<p><strong>Short answer</strong>: successful POST requests frequently return a 303 response when it is successful. Error codes are in the 400-599 range (with 400-499 for client errors, and 500-599 for server errors). Status codes in the 300-399 range are used to redirect to another endpoint.</p>\n\n<blockquote>\n  <p>the post requests me an error when I try to test it</p>\n\n<pre><code>Status: 303 See Other 0.000248996s\n</code></pre>\n</blockquote>\n\n<p>This is <em>not</em> an error. A POST with correct data will, usually, return a redirect. This is due to the <a href=\"https://en.wikipedia.org/wiki/Post/Redirect/Get\" rel=\"nofollow noreferrer\"><em>Post/Redirect/Get</em> architectural pattern [wiki]</a>.</p>\n\n<p>In case the request is valid, the POST request will likely make changes to the database. If you would not make a redirect, then refreshing the page on the browser would result in another POST request (some browsers will first warn the user about that). A second POST could result in creating a second record, making a second payment, ordering a second item, etc. This is usually not what a user wants.</p>\n\n<p>This behavior is documented in <a href=\"https://tools.ietf.org/html/rfc2616#section-10.3.4\" rel=\"nofollow noreferrer\"><strong>RFC 2612</strong> about the <em>HTTP 1.1</em> protocol [ietf.org]</a>:</p>\n\n<blockquote>\n  <p>This method exists primarily to allow the <strong>output of a POST-activated\n  script to redirect the user agent to a selected resource</strong>. The new\n  URI is not a substitute reference for the originally requested\n  resource.</p>\n</blockquote>\n\n<p>We find a similar result on <a href=\"https://restfulapi.net/http-status-codes/\" rel=\"nofollow noreferrer\">The <em>HTTP Response Codes</em> page on <em>REST API Tutorial</em> [restfulapi.net]</a>:</p>\n\n<blockquote>\n  <p><strong>303 (See Other)</strong></p>\n  \n  <p>A <strong>303 response indicates that a controller resource has finished its\n  work</strong>, but instead of sending a potentially unwanted response body,\n  it sends the client the URI of a response resource. This can be the\n  URI of a temporary status message, or the URI to some already\n  existing, more permanent, resource.</p>\n  \n  <p>Generally speaking, the 303 status code <strong>allows a REST API to send a\n  reference to a resource without forcing the client to download its\n  state</strong>. Instead, the client may send a GET request to the value of\n  the Location header.</p>\n  \n  <p>The 303 response MUST NOT be cached, but the response to the second\n  (redirected) request might be cacheable.</p>\n</blockquote>\n"}], "owner": {"reputation": 505, "user_id": 6621898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/10204980448310749/picture?type=large", "display_name": "Tanmay Bhattacharya", "link": "https://stackoverflow.com/users/6621898/tanmay-bhattacharya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1562685206, "creation_date": 1562680198, "last_edit_date": 1562685206, "question_id": 56954130, "link": "https://stackoverflow.com/questions/56954130/calling-a-rest-api-from-a-yesod-handler", "title": "Calling a rest API from a yesod handler", "body": "<p>I have yesod webserver ,with oauth implemented using the standard procedure in the yesodBook.\nOne of my POST handlers calls a rest api ,in a different webserver .\nTo rest using using postman . I made the following changes so that it works.\nCommented out </p>\n\n<pre><code>-- yesodMiddleware :: ToTypedContent res =&gt; Handler res -&gt; Handler res\n-- yesodMiddleware = defaultYesodMiddleware\n</code></pre>\n\n<p>and </p>\n\n<pre><code>isAuthorized (postBanksR a) _ = return Authorized \n</code></pre>\n\n<p>the post requests me an error when I try to test it</p>\n\n<pre><code>Status: 303 See Other 0.000248996s\n</code></pre>\n\n<p>Basically it redirects to auth/google .\nHowever if I use GET it works.</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1562673938, "post_id": 56952194, "comment_id": 100442800, "body": "Init runs in <i>O(n)</i> given you fully expand it. Since Haskell is lazy, the function call itself runs in <i>O(1)</i>, but evaluating it to a &quot;materialized&quot; list, will require <i>O(n)</i>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1562674123, "post_id": 56952194, "comment_id": 100442905, "body": "@WillemVanOnsem seems like that&#39;s all there is to answer here..."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1562688976, "post_id": 56952194, "comment_id": 100451903, "body": "Lists are shaped like Russian nesting dolls. What&#39;s the time complexity to remove the innermost doll? Be sure to click through to implementations of functions from the haddocks. Almost everything in Prelude and Data.List are simple 2 to 3 line haskell functions."}], "answers": [{"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1562689066, "post_id": 56952299, "comment_id": 100451958, "body": "maybe add that &quot;<code>init</code> is productive&quot;? laziness alone doesn&#39;t account for the behavior you describe so that might be confusing"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 9, "last_activity_date": 1562674198, "creation_date": 1562674198, "answer_id": 56952299, "question_id": 56952194, "link": "https://stackoverflow.com/questions/56952194/time-complexity-of-init-function/56952299#56952299", "title": "Time Complexity of init function", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:init\" rel=\"noreferrer\"><strong><code>init :: [a] -&gt; [a]</code></strong></a> is <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/GHC.List.html#init\" rel=\"noreferrer\">implemented as [src]</a>:</p>\n\n<blockquote><pre><code>init [] =  errorEmptyList &quot;init&quot;\ninit (x:xs) =  init' x xs\n  where init' _ [] = []\n        init' y (z:zs) = y : init' z zs</code></pre></blockquote>\n\n<p>In order to generate a list, it will thus iterate over the source list, each time looking one element ahead and emitting the previous one, given the tail is not the empty list.</p>\n\n<p>This thus means that for a list of <em>n</em> elements, it will take <em>O(n)</em> time to calculate the <code>init</code> of that list.</p>\n\n<p>In Haskell function calls are however lazy. If you are, for example, only interested in taking the first <code>k</code> elements, it will run in <em>O(</em> min(<em>n</em>, <em>k</em>) <em>)</em>.</p>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 56952299, "answer_count": 1, "score": 1, "last_activity_date": 1562681214, "creation_date": 1562673847, "last_edit_date": 1562681214, "question_id": 56952194, "link": "https://stackoverflow.com/questions/56952194/time-complexity-of-init-function", "title": "Time Complexity of init function", "body": "<p>I am trying to remove the last element of a list in Haskell and have found out about the <code>init</code> function. Since the function that I am using it in has to be O(n) I would like to know what the time complexity of <code>init</code> is.</p>\n"}, {"tags": ["haskell", "smallcheck"], "comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1562678894, "post_id": 56951986, "comment_id": 100445742, "body": "<code>series = (cons0 $ const $ pure $ B &quot;Xyz&quot;) \\&#47; (cons0 $ const $ pure $ A) \\&#47; (cons0 $ \\n -&gt; pure $ C $ someLogicOverDepArg n)</code> for <code>Serial m (Int -&gt; m D)</code>. if it is needed variability on <code>B</code> then first component should be changed to be series of String."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 1, "creation_date": 1562686318, "post_id": 56951986, "comment_id": 100450437, "body": "Please do not put code in the comments"}], "answers": [{"tags": [], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "is_accepted": false, "score": 0, "last_activity_date": 1562737701, "creation_date": 1562737701, "answer_id": 56964083, "question_id": 56951986, "link": "https://stackoverflow.com/questions/56951986/how-to-write-serial-instance-for-this-function/56964083#56964083", "title": "How to write Serial instance for this function?", "body": "<p>As example:</p>\n\n<pre><code>newtype MyFun m = MyFun (Int -&gt; m D)\n\ninstance (Monad m, Monad n) =&gt; Serial m (MyFun n) where\n  series = MyFun &lt;$&gt; (cons0 $ const $ pure $ A)\n                 \\/  (cons0 $ const $ pure $ B \"XXX\")\n                 -- it shows how to depend on another field sample\n                 \\/  (cons0 $ \\p -&gt; pure $ C $ show p)\n</code></pre>\n\n<p>And <code>y</code> field of <code>TestIt</code> should be changed to <code>MyFun m</code>.</p>\n\n<p>Then <code>Serial</code> instance of <code>TestIt</code> becomes trivial.</p>\n\n<p><code>B</code> is using with some constant string, <code>C</code> - with parameter, which can be got from sample of <code>x</code> field (this shows \"dependency\" between randomizing samples where one of them is a function):</p>\n\n<pre><code>testProperty \"diffProcResult\" $\n   \\(t::TestIt Identity) -&gt;\n     let (MyFun f) = y t\n         yVal = f $ x t\n     in ...\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1562737701, "creation_date": 1562673167, "question_id": 56951986, "link": "https://stackoverflow.com/questions/56951986/how-to-write-serial-instance-for-this-function", "title": "How to write Serial instance for this function?", "body": "<p>Suppose, I have types like</p>\n\n<pre><code>data D = A | B String | C String\ndata TestIt m = TestIt {\n   x :: m Int\n , y :: Int -&gt; m D\n}\n</code></pre>\n\n<p>and I am writing SmallCheck test, so I need <code>Serial</code> instance on <code>TestIt</code>:</p>\n\n<pre><code>instance Monad m =&gt; Serial m (TestIt m) where\n  series = TestIt &lt;$&gt; (pure &lt;$&gt; series) &lt;~&gt; xxx\n</code></pre>\n\n<p>How to write this <code>xxx</code>? I understand that it maybe needs <code>CoSerial</code> like function, but 1) I am not sure 2) I don't know how to write it. When I see <code>CoSerial</code> documentation, I see that my <code>CoSerial</code> will have <code>Int</code> and not <code>D</code> in its definition:</p>\n\n<pre><code>instance (CoSerial m a) =&gt; CoSerial m (Int a) where\n  coseries rs = ???\n</code></pre>\n\n<p>so I can not get idea of <code>CoSerial</code>s and how to use them to make <code>Serial</code> for <code>Int -&gt; m D</code>.</p>\n\n<p><strong>Also I want to have dependent serial for <code>y</code> field</strong>. I mean if <code>x</code> has sample 0 then serial of <code>y</code> should get <code>0</code> as argument. Is it possible?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 2, "last_activity_date": 1562670039, "creation_date": 1562670039, "answer_id": 56951076, "question_id": 56950911, "link": "https://stackoverflow.com/questions/56950911/is-there-a-better-way-to-add-attribute-field-into-ast-in-haskell/56951076#56951076", "title": "Is there a better way to add attribute field into AST in Haskell?", "body": "<p>You could \"lift\" the type of the <code>Expr</code> for example like:</p>\n\n<pre><code>data Expr <b>e</b> = LitI Int | LitB Bool | Add <b>e</b> <b>e</b></code></pre>\n\n<p>Now we can define a data type like:</p>\n\n<pre><code>data ExprAttr a = ExprAttr {\n    expression :: Expr <b>(ExprAttr a)</b>,\n    attribute :: a\n  }</code></pre>\n\n<p>So here the <code>ExprAttr</code> has two parameters, the <code>expression</code>, which is thus an <code>Expr</code>ession that has <code>ExprAttr a</code>s in the tree, and <code>attribute</code> which is an <code>a</code>.</p>\n\n<p>You can thus process <code>ExprAttr</code>s, which is an AST of <code>ExprAttr</code>s. If you want to use a \"simple\" AST, you can define a type like:</p>\n\n<p><pre><code>newtype SimExpr = SimExpr (Expr SimExpr)</pre></code></p>\n"}, {"tags": [], "owner": {"reputation": 974, "user_id": 3829232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3d2de116df80bc024b799e84dcdbc97?s=128&d=identicon&r=PG", "display_name": "soupi", "link": "https://stackoverflow.com/users/3829232/soupi"}, "is_accepted": false, "score": 2, "last_activity_date": 1562700308, "creation_date": 1562700308, "answer_id": 56959381, "question_id": 56950911, "link": "https://stackoverflow.com/questions/56950911/is-there-a-better-way-to-add-attribute-field-into-ast-in-haskell/56959381#56959381", "title": "Is there a better way to add attribute field into AST in Haskell?", "body": "<p>You might want to take a look at <a href=\"https://hackage.haskell.org/package/free-5.1/docs/Control-Comonad-Cofree.html\" rel=\"nofollow noreferrer\"><code>Cofree</code></a> where <code>f</code> will be your recursive data type after abstracting the concept of recursion as an <a href=\"https://www.schoolofhaskell.com/user/bartosz/understanding-algebras\" rel=\"nofollow noreferrer\">f-algebra</a> and <code>a</code> will be the type of your annotation.</p>\n\n<p>Nate Faubion gave a very accesible talk about this and similar approaches and you can watch it here: <a href=\"https://www.youtube.com/watch?v=eKkxmVFcd74\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=eKkxmVFcd74</a></p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 56951076, "answer_count": 2, "score": 3, "last_activity_date": 1562700308, "creation_date": 1562669422, "question_id": 56950911, "link": "https://stackoverflow.com/questions/56950911/is-there-a-better-way-to-add-attribute-field-into-ast-in-haskell", "title": "Is there a better way to add attribute field into AST in Haskell?", "body": "<p>At first, I have a original AST definition like this:</p>\n\n<pre><code>data Expr = LitI Int | LitB Bool | Add Expr Expr\n</code></pre>\n\n<p>And I want to generalize it so that each AST node can contains some extra attributes:</p>\n\n<pre><code>data Expr a = LitI Int a | LitB Bool a | Add (Expr a) (Expr a) a\n</code></pre>\n\n<p>In this way, we can easily attach attribute into each node of the AST:</p>\n\n<pre><code>type ExprWithType = Expr TypeRep\ntype ExprWithSize = Expr Int\n</code></pre>\n\n<p>But this solution makes it hard to visit the attribute field, we must use pattern matching and process it case by case:</p>\n\n<pre><code>attribute :: Expr a -&gt; a\nattribute e = case e of\n    LitI _ a -&gt; a\n    LitB _ a -&gt; a\n    Add _ _ a -&gt; a\n</code></pre>\n\n<p>We can image that if we can define our AST via a product type of the original AST and the type variable indicating attribute:</p>\n\n<pre><code>type ExprWithType = (Expr, TypeRep)\ntype ExprWithSize = (Expr, Int)\n</code></pre>\n\n<p>Then we can simplify the attribute visiting function like this:</p>\n\n<pre><code>attribute = snd\n</code></pre>\n\n<p>But we know that, the attribute from the outmost product type will not recursively appears in the subtrees.</p>\n\n<p>So, is there a better solution for this problem?</p>\n\n<p>Generally speaking, When we want to extract common field of different cases of a recursive sum type, we met this problem.</p>\n"}, {"tags": ["haskell", "list-comprehension"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562657830, "post_id": 56947494, "comment_id": 100434324, "body": "The <code>x</code> will be a sublist."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1562658473, "post_id": 56947494, "comment_id": 100434641, "body": "BTW, the recommended way of writing this is <code>filter even &lt;$&gt; xxs</code>, no list comprehension needed."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1562658787, "creation_date": 1562658787, "answer_id": 56947806, "question_id": 56947494, "link": "https://stackoverflow.com/questions/56947494/need-explanation-for-list-comprehension-in-haskell/56947806#56947806", "title": "Need explanation for list comprehension in Haskell", "body": "<p><code>xss</code> is a list of <em>list</em>s of numbers. Let us assume it has type <code>[[Int]]</code> (the number type can be different, but that does not make any difference).</p>\n\n<p>This means that if we define a generator <code>xs &lt;- xxs</code>, then <code>xs</code> will have the type of the elements of that list, so <code>[Int]</code>. An <code>[Int]</code> is <em>not</em> an <code>Integral</code> type, so we can not check if a list of <code>Int</code>s is <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:even\" rel=\"noreferrer\"><strong><code>even :: Integral a =&gt; a -&gt; Bool</code></strong></a>.</p>\n\n<p>We can however process that sublist <code>xs</code> further. For example with another list comprehension, like <code>[ x | x &lt;- xs, even x ]</code> that filter the sublist.</p>\n\n<p>It might however be more clear what you do with:</p>\n\n<pre><code>[ <b>filter even xs</b> | xs &lt;- xss ]</code></pre>\n\n<p>or we can here convert the outer list comprehension to a simple <code>map</code>:</p>\n\n<pre><code>map (filter even) xss\n</code></pre>\n"}], "owner": {"reputation": 452, "user_id": 8466844, "user_type": "registered", "profile_image": "https://graph.facebook.com/479986619048559/picture?type=large", "display_name": "Nam V. Do", "link": "https://stackoverflow.com/users/8466844/nam-v-do"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 56947806, "answer_count": 1, "score": 5, "last_activity_date": 1562690341, "creation_date": 1562657657, "last_edit_date": 1562690341, "question_id": 56947494, "link": "https://stackoverflow.com/questions/56947494/need-explanation-for-list-comprehension-in-haskell", "title": "Need explanation for list comprehension in Haskell", "body": "<p>I'm just starting with functional programming and I am learning Haskell programming language. Due to the fact that I am just a beginner, I have a piece of code and I need an explanation about this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>ghci&gt; let xxs = [[1,3,5,2,3,1,2,4,5],[1,2,3,4,5,6,7,8,9],[1,2,4,2,1,6,3,1,3,2,3,6]]\nghci&gt; [ [ x | x &lt;- xs, even x ] | xs &lt;- xxs]\n-- Output: \n-- [[2,2,4],[2,4,6,8],[2,4,2,6,2,6]] \n</code></pre>\n\n<p>I see this code will produce the new list with the even numbers in each sub-list.</p>\n\n<p>But I don't know why <code>x &lt;- xs</code> and then <code>xs &lt;- xxs</code>, why can't we do <code>x &lt;- xxs</code> in the first place?</p>\n"}, {"tags": ["haskell", "servant"], "answers": [{"comments": [{"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1562712450, "post_id": 56951912, "comment_id": 100460503, "body": "That&#39;s fine. You solved the problem. Mark it correct. :)"}], "tags": [], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "is_accepted": true, "score": 1, "last_activity_date": 1562672965, "creation_date": 1562672965, "answer_id": 56951912, "question_id": 56946529, "link": "https://stackoverflow.com/questions/56946529/how-to-build-an-intuition-for-servants-type-errors/56951912#56951912", "title": "How to build an intuition for Servant&#39;s type-errors?", "body": "<p>Expletive! Expletive! Expletive!</p>\n\n<p>I was missing a <code>toServant</code> - </p>\n\n<pre><code>prodServer :: ServerT Routes (AppM '[] ())\nprodServer = (toServant $ Endpoint.AuditLog.server AppM.appRunners)\n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 56951912, "answer_count": 1, "score": 2, "last_activity_date": 1562672965, "creation_date": 1562654011, "question_id": 56946529, "link": "https://stackoverflow.com/questions/56946529/how-to-build-an-intuition-for-servants-type-errors", "title": "How to build an intuition for Servant&#39;s type-errors?", "body": "<p>I'm stuck with the following error, after a major code refactor:</p>\n\n<pre><code>    \u2022 Couldn't match type \u2018Endpoint.AuditLog.Routes\n                             (AsServerT (AppM '[] ()))\u2019\n      with\n\n      --\n      -- complete API type comes here\n      --\n\n      Expected type: ServerT Routes (AppM '[] ())\n        Actual type: Endpoint.AuditLog.Routes (AsServerT (AppM '[] ()))\n    \u2022 In the expression: (Endpoint.AuditLog.server appRunners)\n      In an equation for \u2018prodServer\u2019:\n          prodServer = (Endpoint.AuditLog.server appRunners)      \n</code></pre>\n\n<p>I've read, and re-read <a href=\"https://docs.servant.dev/en/stable/cookbook/generic/Generic.html\" rel=\"nofollow noreferrer\">the documentation</a>, but cannot seem to find where the error is. This code was working earlier, and I've changed <code>Endpoint.AuditLog.server :: Routes (AsServerT AppM)</code> to <code>Endpoint.AuditLog.server :: AppRunners m n -&gt; Routes (AsServerT n)</code> and confirmed that the type of the following expressions seems to be similar across the refactor; basically <code>Routes (AsServerT AppM)</code> has changed to <code>Routes (AsServerT (AppM '[] ()))</code></p>\n\n<pre><code>ghci&gt; :t (Endpoint.AuditLog.server AppM.appRunners)\n(Endpoint.AuditLog.server AppM.appRunners) :: Routes (AsServerT (AppM '[] ()))\n</code></pre>\n\n<p>The following snippet is also <em>structurally</em> the same across the refactor:</p>\n\n<pre><code>type Routes = (ToServant Endpoint.AuditLog.Routes AsApi)\n\nprodServer :: ServerT Routes (AppM '[] ())\nprodServer = (Endpoint.AuditLog.server AppM.appRunners)\n</code></pre>\n\n<p>How do I go about debugging this error? Since there are a lot of type-families involved, is there any way to see what the following type-level expressions simplify to:</p>\n\n<ul>\n<li><code>ServerT Routes (AppM '[] ())</code></li>\n<li><code>Endpoint.AuditLog.Routes (AsServerT (AppM '[] ()))</code></li>\n</ul>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 722106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d2658b9b692f11e9769d9f8ba0020dc?s=128&d=identicon&r=PG", "display_name": "digit", "link": "https://stackoverflow.com/users/722106/digit"}, "edited": false, "score": 0, "creation_date": 1562646094, "post_id": 56944826, "comment_id": 100430157, "body": "Ah, perfect, &amp; excelent choice of word.  And I see I wasnt as far of in my searches as I thought, with &quot;if any&quot;.  oh wait, let me see...     parse error (possibly incorrect indentation or mismatched brackets)"}, {"owner": {"reputation": 165, "user_id": 722106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d2658b9b692f11e9769d9f8ba0020dc?s=128&d=identicon&r=PG", "display_name": "digit", "link": "https://stackoverflow.com/users/722106/digit"}, "edited": false, "score": 0, "creation_date": 1562647173, "post_id": 56944826, "comment_id": 100430396, "body": "previous line&#39;s val     &quot;!leave&quot;               = write &quot;QUIT&quot; &quot;:Exiting&quot; &gt;&gt; io (exitWith ExitSuccess) didnt like being before that.  works with &quot;!leave&quot; after &quot;?&quot; somehow, but not other way around... anyways, that&#39;s my problem for another question.  yupyup, seems all good, works as intended, nicely done.  would still love to know more about how to better phrase the question."}], "tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 6, "last_activity_date": 1562676180, "last_edit_date": 1562676180, "creation_date": 1562642002, "answer_id": 56944826, "question_id": 56944717, "link": "https://stackoverflow.com/questions/56944717/how-can-i-make-the-target-of-a-conditional-be-any-of-many-search-for-any-of-a-l/56944826#56944826", "title": "how can i make the target of a conditional be any of many? search for any of a list of strings rather than just one string? In Haskell", "body": "<p>You want <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:any\" rel=\"nofollow noreferrer\"><code>any</code></a>:</p>\n\n<pre><code>interrogatives = [\"what\", \"who\", \"how\", \"why\", \"where\", \"when\"]\n\neval x | \"?\" `isSuffixOf` x = privmsg (\n  if any (`isInfixOf` x) interrogatives \n     then \"that would be an ecumenical matter\" \n     else \"yes\"\n  )\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 722106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d2658b9b692f11e9769d9f8ba0020dc?s=128&d=identicon&r=PG", "display_name": "digit", "link": "https://stackoverflow.com/users/722106/digit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 56944826, "answer_count": 1, "score": 0, "last_activity_date": 1562676180, "creation_date": 1562640843, "question_id": 56944717, "link": "https://stackoverflow.com/questions/56944717/how-can-i-make-the-target-of-a-conditional-be-any-of-many-search-for-any-of-a-l", "title": "how can i make the target of a conditional be any of many? search for any of a list of strings rather than just one string? In Haskell", "body": "<p>In:  </p>\n\n<pre><code>eval x | \"?\" `isSuffixOf` x = privmsg (if \"what\" `isPrefixOf` x then \"that would be an ecumenical matter\" else \"yes\")\n</code></pre>\n\n<p>How can I have \"what\" be any of \"what|who|how|why|where|when\"?</p>\n\n<p>I know it's not with | like that^, nor is it</p>\n\n<pre><code>eval x | \"?\" `isSuffixOf` x = privmsg (if \"what\" \"who\" \"how\" \"why\" \"where\" \"when\" `isInfixOf` x then \"that would be an ecumenical matter\" else \"yes\")\n</code></pre>\n\n<p>but I'm unsure of the logic of whatever syntactical fail I'm hitting upon, so everything else I'm trying are similar stabs in the dark, including searches.</p>\n\n<p>(And how can I phrase this question better than \"How can I make the target of a conditional be any of many?\"?  (As in, what are the terms I mean, that will better help me understand the situation and better form the search terms?)</p>\n"}, {"tags": ["c++", "haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 9, "creation_date": 1562622600, "post_id": 56942063, "comment_id": 100425926, "body": "Err... that&#39;s not how you eliminate a <code>switch</code>, even in C++. You&#39;d make two subclasses of <code>Message</code>, one with its <code>handle</code> method doing what <code>HandleType1</code> does, and one with its <code>handle</code> method doing what <code>HandleType2</code> does. Then you&#39;d dispense with the &quot;type&quot; stuff entirely and just write <code>m.handle()</code>. A similar thing can be done in Haskell, if you care, with typeclasses."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1562624550, "post_id": 56942063, "comment_id": 100426430, "body": "Your example doesn&#39;t yet provide a compelling argument for combining two functions <code>handleType1</code> and <code>handleType2</code> under one function. Who calls <code>createType</code>, and why wouldn&#39;t they just use <code>handleType1</code> and <code>handleType2</code> directly, instead of introducing the artificial tag type <code>Type</code>?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1562649351, "post_id": 56942063, "comment_id": 100430891, "body": "@DanielWagner how do you create your polymorphic message? How do you send one over a wire?"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1562649684, "post_id": 56942063, "comment_id": 100430988, "body": "@DanielWagner I followed the advice about using typeclasses, thanks so much"}, {"owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1562649730, "post_id": 56942063, "comment_id": 100431004, "body": "@n.m. I don&#39;t get the question, what do you mean &quot;over a wire&quot;? sorry I didn&#39;t understand quite well that part"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "reply_to_user": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "edited": false, "score": 0, "creation_date": 1562663476, "post_id": 56942063, "comment_id": 100437299, "body": "@DamianLattenero send it over the internet."}], "answers": [{"comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 4, "creation_date": 1562663988, "post_id": 56942150, "comment_id": 100437561, "body": "What exact benefit does a type class provide here? Why isn&#39;t <code>handleMsg</code> a function of type <code>Type -&gt; String -&gt; IO ()</code> ?"}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1562649634, "last_edit_date": 1562649634, "creation_date": 1562617704, "answer_id": 56942150, "question_id": 56942063, "link": "https://stackoverflow.com/questions/56942063/what-is-the-equivalent-pattern-in-haskell-for-replacing-conditionals-with-polymo/56942150#56942150", "title": "What is the equivalent pattern in haskell for replacing conditionals with polymorphism?", "body": "<p>You can do pattern matching on Int:</p>\n\n<pre><code>createType 1 = Type1\ncreateType 2 = Type2\ncreateType _ = error(\"error, unhandled message type\")\n\nhandleMessage n msg = handleType (createType n) msg\n\nhandleType Type1 msg = doSome...\nhandleType Type2 msg = doSome2...\n</code></pre>\n\n<p>But if you don't want to do that, you can directly do pattern matching on Types:</p>\n\n<pre><code>handleType Type1 msg = handle1 msg\nhandleType Type2 msg = handle2 msg\n</code></pre>\n\n<p>But even better would be using a type class:</p>\n\n<pre><code>class Handler a where\n  handleMsg :: a -&gt; String -&gt; IO ()\n\n\ndata Type = Type1 | Type2\n\ninstance Handler Type where\n  handleMsg Type1 = handle1\n  handleMsg Type2 = handle2\n\nhandle1 msg = putStrLn $ \"handle1 \" ++ msg\nhandle2 msg = putStrLn $ \"handle2 \" ++ msg \n\nmain = do\n  handleMsg Type1 \"error 1\"\n  handleMsg Type2 \"error 2\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 2, "last_activity_date": 1562663433, "creation_date": 1562663433, "answer_id": 56949106, "question_id": 56942063, "link": "https://stackoverflow.com/questions/56942063/what-is-the-equivalent-pattern-in-haskell-for-replacing-conditionals-with-polymo/56949106#56949106", "title": "What is the equivalent pattern in haskell for replacing conditionals with polymorphism?", "body": "<p>Your Haskell solutulion is a near copy of the first C++ fragment. It only looks better because of Haskell's terser syntax, but it does exactly the same thing. Actually an exact C++ equivalent would be</p>\n\n<pre><code>enum Type { Type1, Type2 };\n...\nType getType(int type) {\n  switch (type) {\n      case 1: return Type1;\n      case 2: return Type2;\n    ...\n ...\n switch (getType(type)) {\n     case Type1: // etc etc\n</code></pre>\n\n<p>As you can see there isn't too much of wonderful and exciting functional programming going on. Indeed, functional programming is about programming with <em>functions as first class values</em>. There ain't any in your example.</p>\n\n<p>Let's change it a bit.</p>\n\n<pre><code>....\nhandler Type1 = handleType1\nhandler Type2 = handleType2\n</code></pre>\n\n<p>So now <code>handler</code> is a primitive higher-order function. It gets a Type and returns another function. This still isn't much, but this translates to C++ this way:</p>\n\n<pre><code>void handleType1(Message);\nvoid handleType2(Message);\n\nauto getHandler(Type type) {\n  switch(type) {\n      case Type1: return handleType1;\n      case Type2: return handleType2;\n    ....\n</code></pre>\n\n<p>So instead of returning an object, you return a function. This is not a coimcidence. <em>An object is just a bunch of functions</em> (its methods). An object with one method is just a function!</p>\n\n<p>Wait, what about data? Isn't an object made up of methods <em>and data</em>? It is, but its data can be bound in a function (think lambda or std::bind). Normal C++ functions (function pointers) cannot capture context, but you just use lambdas and std::function.</p>\n\n<p>So I guess this example doesn't bring too much insight to the table in the end. Instead of objects,use functions, that's all.</p>\n"}], "owner": {"reputation": 47, "user_id": 6041445, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JN0PbN0lJ7U/AAAAAAAAAAI/AAAAAAAAAxw/4aBwiUlfJPI/photo.jpg?sz=128", "display_name": "dreum", "link": "https://stackoverflow.com/users/6041445/dreum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1562763127, "creation_date": 1562617231, "last_edit_date": 1562763127, "question_id": 56942063, "link": "https://stackoverflow.com/questions/56942063/what-is-the-equivalent-pattern-in-haskell-for-replacing-conditionals-with-polymo", "title": "What is the equivalent pattern in haskell for replacing conditionals with polymorphism?", "body": "<p>I've been exploring Haskell to get some functional programming experience. I'm hoping to find patterns that bring some insight so I can write better c++. For instance, I find the normal implementation of converting a switch statement to polymorphic code unsatisfying. </p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>void HandleMessage(int type, Message m)\n{\n   switch (type)\n   {\n   case 1:\n      HandleType1(m);\n      break;\n   case 2:\n      HandleType2(m);\n      break;\n   default:\n      Log(\"error, unhandled message type\")\n   }\n}\n</code></pre>\n\n<p>becomes:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>void HandleMessage(Type t, Message m)\n{\n   std::unique_ptr&lt;HandlerInterface&gt; handler = HandlerFactory.GetHandler(t);\n   handler.handleMessage(m);\n}\n\nstd::unique_ptr&lt;HandlerInterface&gt; HandlerFactory::GetHandler(Type t)\n{\n   switch (t)\n   {\n   case 1:\n      return std::make_unique&lt;HandlerType1&gt;();\n   case 2:\n      return std::make_unique&lt;HandlerType2&gt;();\n   default:\n      return std::make_unique&lt;DefaultHandler&gt;();\n   }\n}\n</code></pre>\n\n<p>This just pushes the switch to the factory. It's probably better than the first solution, but it just feels like there should be something better.</p>\n\n<p>I was wondering if a better pattern exists in Haskell. I know you can use guards:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>handleMessage t msg\n   | t == 1 = handleType1 msg\n   | t == 2 = handleType2 msg\n</code></pre>\n\n<p>But this doesn't seem that much more elegant. You could switch the types as ints to a proper type and do pattern matching:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Type = Type1 | Type2\n\ncreateType t\n   | t == 1 = Type1\n   | t == 2 = Type2\n\nhandleMessage Type1 msg = handleType1 msg\nhandleMessage Type2 msg = handleType2 msg\n</code></pre>\n\n<p>Again, we can push the switch around, but I'm not really seeing something elegant. I'm hoping for several things:</p>\n\n<ol>\n<li>Cohesion: code is bundled together well.</li>\n<li>Adding a new handle requires little boilerplate. None would be preferred!</li>\n<li>Nice to have: Missing a handler for a particular type would be a compilation error.</li>\n</ol>\n"}, {"tags": ["haskell", "record"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1562602161, "post_id": 56938762, "comment_id": 100417817, "body": "Nowhere in your code do you call <code>print</code>, as indicated by the error message. I suspect, though, that you are trying something like <code>print hours x</code> instead of <code>print (hours x)</code>, since <code>hours</code> (and <code>mins</code>, for that matter) is a function of type <code>Clock -&gt; Int</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1562602264, "post_id": 56938762, "comment_id": 100417861, "body": "Your definition of <code>clockDecons</code> should probably also be applying <code>hours</code> and <code>mins</code> to <code>clock</code>. It also has the problem that <code>(hs, ms)</code> is a tuple, not a <code>String</code>."}, {"owner": {"reputation": 3922, "user_id": 1198582, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/02d3e1025aed5f061c481871986c45b1?s=128&d=identicon&r=PG", "display_name": "Michael Litchard", "link": "https://stackoverflow.com/users/1198582/michael-litchard"}, "edited": false, "score": 0, "creation_date": 1562602380, "post_id": 56938762, "comment_id": 100417919, "body": "Please include the code that generates the error. You can help us help you by reducing the amount of guesswork we have to make."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1562602656, "post_id": 56938762, "comment_id": 100418063, "body": "@chepner, Michael: posted the entire piece of code now. Not calling show or print anywhere (yet) so I really don&#39;t get it."}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1562602907, "post_id": 56938762, "comment_id": 100418175, "body": "@Carcigenicate: correct. Tried <code>clockDecons Clock {hours=22,mins=10}</code> and that triggers the error. But it should not considering I am asking <code>Int</code> in return. In a tuple, yes, but still an <code>Int</code>"}, {"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1562603095, "post_id": 56938762, "comment_id": 100418249, "body": "Is that simply because I want to have something shown in GHCi? As a beginner I like GHCi just for verifying that it all works and of course for studying Haskell. In this case by the way it is <code>stack ghci src&#47;Clock.hs</code>  Tips &amp; Trics are welcome as always ;-)"}], "answers": [{"comments": [{"owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "edited": false, "score": 0, "creation_date": 1562604328, "post_id": 56939251, "comment_id": 100418834, "body": "it is what I wanted, not what I meant, but it works and I can take it from there. Just shows me there&#39;s still a lot to learn. Anyway: got my answer."}], "tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": true, "score": 5, "last_activity_date": 1562603983, "creation_date": 1562603983, "answer_id": 56939251, "question_id": 56938762, "link": "https://stackoverflow.com/questions/56938762/haskell-exercise-deconstructing-record-syntax/56939251#56939251", "title": "Haskell Exercise deconstructing record syntax", "body": "<p>You probably meant</p>\n\n<pre><code>clockDecons :: Clock -&gt; (Int, Int)\nclockDecons clock = (hours clock, mins clock) \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1562612134, "creation_date": 1562612134, "answer_id": 56941012, "question_id": 56938762, "link": "https://stackoverflow.com/questions/56938762/haskell-exercise-deconstructing-record-syntax/56941012#56941012", "title": "Haskell Exercise deconstructing record syntax", "body": "<p>Alternative:</p>\n\n<pre><code>clockDecons :: Clock -&gt; (Int, Int)\nclockDecons (Clock hs ms) = (hs, ms) \n</code></pre>\n\n<p>Alternative:</p>\n\n<pre><code>clockDecons :: Clock -&gt; (Int, Int)\nclockDecons Clock{hours=hs, mins=ms} = (hs, ms) \n</code></pre>\n\n<p>Alternative: don't use any <code>clockDecons</code> at all. You are essentially unwrapping two integers under the <code>Clock</code> constructor to rewrap them under the <code>(,)</code> constructor of pairs. This is not a <code>decons</code>. Keep the clock value wrapped until you actually need to deconstruct it.</p>\n"}], "owner": {"reputation": 999, "user_id": 8604871, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/36382829e5be7f6da95308288d976949?s=128&d=identicon&r=PG&f=1", "display_name": "Madderote", "link": "https://stackoverflow.com/users/8604871/madderote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 56939251, "answer_count": 2, "score": 1, "last_activity_date": 1562612134, "creation_date": 1562602065, "last_edit_date": 1562602924, "question_id": 56938762, "link": "https://stackoverflow.com/questions/56938762/haskell-exercise-deconstructing-record-syntax", "title": "Haskell Exercise deconstructing record syntax", "body": "<p>Starting Exercise to brush up on learned Haskell skills. </p>\n\n<pre><code>module Clock (addDelta, fromHourMin, clockDecons) where\n\ndata Clock = Clock { hours :: Int \n                   , mins  :: Int \n                   } deriving Show \n\nfromHourMin :: Int -&gt; Int -&gt; Clock\nfromHourMin hour min = Clock {hours = hour, mins = min}\n\n-- toString :: Clock -&gt; String\nclockDecons clock = (hs,ms) \n  where hs = hours \n        ms = mins\n\naddDelta :: Int -&gt; Int -&gt; Clock -&gt; Clock\naddDelta hour min clock = undefined\n</code></pre>\n\n<p>Maybe a bit clouded after a complete day, but why do I get: </p>\n\n<pre><code>&lt;interactive&gt;:15:1: error:\n    \u2022 No instance for (Show (Clock -&gt; Int))\n        arising from a use of \u2018print\u2019\n        (maybe you haven't applied a function to enough arguments?)\n    \u2022 In a stmt of an interactive GHCi command: print it\n</code></pre>\n\n<p>I haven't even begun to create string instances of the clock. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562600163, "post_id": 56938188, "comment_id": 100416839, "body": "That&#39;s not a list of types."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1562601222, "creation_date": 1562601222, "answer_id": 56938558, "question_id": 56938188, "link": "https://stackoverflow.com/questions/56938188/how-to-access-data-in-list-of-elements-of-custom-type/56938558#56938558", "title": "How to access data in list of elements of custom type?", "body": "<p>An empty or singleton list is clearly valid:</p>\n\n<pre><code>validTrip :: [Ticket] -&gt; Bool\nvalidTrip [] = True\nvalidTrip [_] = True\n</code></pre>\n\n<p>With two or more tickets, the trip is valid if the first and second tickets \"fit\", and the rest of the list is also valid.</p>\n\n<pre><code>validTrip (x:y:rest) = cityDestination x == cityOrin y &amp;&amp; validTrip (y:rest)\n</code></pre>\n\n<p><code>cityDestination</code> and <code>cityOrin</code> are both simply functions of type <code>Ticket -&gt; String</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 1, "last_activity_date": 1562603278, "last_edit_date": 1562603278, "creation_date": 1562602481, "answer_id": 56938877, "question_id": 56938188, "link": "https://stackoverflow.com/questions/56938188/how-to-access-data-in-list-of-elements-of-custom-type/56938877#56938877", "title": "How to access data in list of elements of custom type?", "body": "<p>It's a simple one-liner:</p>\n\n<pre><code>validTrip :: [Ticket] -&gt; Bool\nvalidTrip b = \n    and [ cityDestination t == cityOrigin t2 | (t,t2) &lt;- zip b (drop 1 b)]\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 7722311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cd990772a41631e0b2287dbf8c1363f?s=128&d=identicon&r=PG&f=1", "display_name": "rodrigo ferreira", "link": "https://stackoverflow.com/users/7722311/rodrigo-ferreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1562603498, "creation_date": 1562599732, "last_edit_date": 1562603498, "question_id": 56938188, "link": "https://stackoverflow.com/questions/56938188/how-to-access-data-in-list-of-elements-of-custom-type", "title": "How to access data in list of elements of custom type?", "body": "<p>There is a data type <code>Ticket</code> with four attributes and then i created <code>Trip</code> that is a list of <code>Ticket</code>s. I want to check if a trip is valid by checking if for any consecutive tickets the destination city of the first ticket is same as the departure for the second ticket.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Ticket = Ticket {\n    typeBilhete :: String\n    , typeClass :: String\n    , cityOrin :: String\n    , cityDestination :: String\n} deriving (Show)\n\ndata Trip = Trip [Ticket]\n\nvalidTrip :: [Bilhete] -&gt; Bool\nvalidTrip b = \n    if head b == \"Recife\" = then True\n    else False\n</code></pre>\n\n<p>My problem is to how access elements like <code>cityOrigin</code> and <code>cityDestination</code>? so i can compare then in <code>validTrip</code> func.</p>\n"}, {"tags": ["security", "haskell", "http-headers", "yesod"], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1562589542, "creation_date": 1562589542, "answer_id": 56935155, "question_id": 56934917, "link": "https://stackoverflow.com/questions/56934917/how-can-i-add-an-header-to-all-endpoints-in-yesod-appication/56935155#56935155", "title": "How can I add an header to all endpoints in Yesod appication?", "body": "<p>You can alter the <a href=\"https://hackage.haskell.org/package/yesod-core-1.6.14/docs/Yesod-Core.html#v:yesodMiddleware\" rel=\"nofollow noreferrer\"><strong><code>yesodMiddleware :: Yesod site =&gt; HandlerFor site res -&gt; HandlerFor site res</code></strong></a> field in the <code>instance Yesod App</code> of your <code>App</code>. For example with:</p>\n\n<pre><code>instance Yesod App where\n    -- ...\n    <b>yesodMiddleware</b> handler = do\n        <b>addHeader \"X-Frame-Options\" \"sameorigin\"</b>\n        defaultYesodMiddleware handler</code></pre>\n\n<p>The <code>yesodMiddleware</code> is thus functionality that is \"wrapped around\" the target handler. You can do tasks before you query the handler, and after the handler (for example to postprocess the result).</p>\n"}], "owner": {"reputation": 2352, "user_id": 4518180, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/HQeHB.png?s=128&g=1", "display_name": "mkUltra", "link": "https://stackoverflow.com/users/4518180/mkultra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 56935155, "answer_count": 1, "score": 1, "last_activity_date": 1562590165, "creation_date": 1562588727, "last_edit_date": 1562590165, "question_id": 56934917, "link": "https://stackoverflow.com/questions/56934917/how-can-i-add-an-header-to-all-endpoints-in-yesod-appication", "title": "How can I add an header to all endpoints in Yesod appication?", "body": "<p>I have an <a href=\"/questions/tagged/yesod\" class=\"post-tag\" title=\"show questions tagged &#39;yesod&#39;\" rel=\"tag\">yesod</a> application.\nI need to add an specific header to all responses.\nIt's clear how to do it with an specific endpoint using <a href=\"https://hackage.haskell.org/package/yesod-core-1.6.14/docs/Yesod-Core-Handler.html#v:addHeader\" rel=\"nofollow noreferrer\">addHeader</a>.</p>\n\n<p>Let's say this one: <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\" rel=\"nofollow noreferrer\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options</a></p>\n\n<p><strong>Question:</strong></p>\n\n<p>How can I configure an header once for all endpoints?</p>\n"}, {"tags": ["haskell", "type-inference", "type-level-computation", "data-kinds", "singleton-type"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562580477, "post_id": 56932204, "comment_id": 100405895, "body": "That&#39;s a long question. Before I read it in full: are you sure you&#39;re not making this unnecessarily complicated? It seems what you&#39;re trying to do is not so much a list (i.e. free monoid) as a free semigroupoid. Wouldn&#39;t it help to start from that angle?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562580631, "post_id": 56932204, "comment_id": 100405980, "body": "@leftaroundabout: I don&#39;t think that would change anything -- my problem is with the slack in the middle, not slack at the beginning."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562580701, "post_id": 56932204, "comment_id": 100406025, "body": "But perhaps there&#39;s a functional dependency <code>beginning end -&gt; middle</code>?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562580865, "post_id": 56932204, "comment_id": 100406103, "body": "I&#39;m not seeing it. In <code>example2</code>, there is slack at the beginning and also between the first and the second step. That is real slack, i.e. that really should be represented as <code>Nothing</code>s in the result of <code>collapse</code>; propagating the <code>before</code> ending of step 3 into step 1 would mean that <code>collapse</code> gives an un-true answer."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1562583786, "post_id": 56932204, "comment_id": 100407521, "body": "@leftroundabout it&#39;s a long question because I&#39;m worried it&#39;s actually an XY problem."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1562599828, "post_id": 56932204, "comment_id": 100416694, "body": "This is very Atkey-style; I wonder if you should take a page from McBride. You don&#39;t seem to necessarily want those singletons always, or for the endpoints to match exactly. You want some (possibly trivial) relationship between endpoints."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 2, "creation_date": 1562600272, "post_id": 56932204, "comment_id": 100416907, "body": "To be more concrete: I think the right way too not care about a particular endpoint is to not force it to have a singleton."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1562638150, "post_id": 56932204, "comment_id": 100428770, "body": "@dfeuer: I&#39;m afraid you will have to be more concrete than that, since if there are no singletons, I don&#39;t see how to reify those endings in <code>collapse</code>."}], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1562578944, "creation_date": 1562578944, "question_id": 56932204, "link": "https://stackoverflow.com/questions/56932204/defaulting-intermediate-type-variables", "title": "Defaulting intermediate type variables", "body": "<p>I'd like to represent a list of <code>(before, during, after)</code> pairs such that <code>all (\\(_, _, after), (before, _, _) -&gt; after == before) $ zip xs (tail xs)</code>; in other words, such that neighbouring pairs match on their ends. The end goal is to extract a collapsed list of <code>(before, [(during, after)]</code>.</p>\n\n<p>We can implement that easily using a <a href=\"https://github.com/agda/agda-stdlib/blob/master/src/Data/Star.agda\" rel=\"nofollow noreferrer\"><code>Star</code></a>-like structure to enforce matching ends:</p>\n\n<pre><code>{-# LANGUAGE GADTs, PolyKinds, DataKinds, KindSignatures, TypeApplications, ScopedTypeVariables #-}\n\nimport Data.Singletons\n\ndata Step a (before :: ending) (after :: ending) where\n    Step :: (SingI before, SingI after) =&gt; a -&gt; Step a before after\n\ninfixr 5 :&gt;\ndata Steps a (first :: ending) where\n    Nil :: Steps a first\n    (:&gt;) :: Step a before after -&gt; Steps a after -&gt; Steps a before\n\nbefore :: forall ending a (before :: ending) (after :: ending). (SingKind ending) =&gt; Step a before after -&gt; Demote ending\nbefore Step{} = FromSing (sing @before)\n\nafter :: forall ending a (before :: ending) (after :: ending). (SingKind ending) =&gt; Step a before after -&gt; Demote ending\nafter Step{} = FromSing (sing @after)\n\ncollapse :: forall ending a (first :: ending). (SingKind ending) =&gt; Steps a first -&gt; (Maybe (Demote ending), [(a, Demote ending)])\ncollapse Nil = (Nothing, [])\ncollapse xs@(x :&gt; _) = (Just $ before x, go xs)\n  where\n    go :: Steps a whatever -&gt; [(a, Demote ending)]\n    go Nil = []\n    go (s@(Step x) :&gt; xs) = (x, after s) : go xs\n</code></pre>\n\n<p>An example of usage:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, PatternSynonyms, TypeFamilies, StandaloneDeriving #-}\nimport Data.Singletons.TH\n\n$(singletons [d|\n  data Ending = A | B | C\n  |])\nderiving instance Show Ending\n\nfoo :: Steps Int A\nfoo =\n    Step @A @B 1 :&gt;\n    Step @B @C 2 :&gt;\n    Nil\n</code></pre>\n\n<blockquote>\n<pre><code>&gt; collapse foo\n(Just A,[(1,B),(2,C)])\n</code></pre>\n</blockquote>\n\n<p>So far so good.</p>\n\n<p>But now, let's say some of those <code>Step</code>s don't really care about their endings. While we can let type inference fill them in where they are unambiguous, e.g. </p>\n\n<pre><code>example1 :: Steps Int A\nexample1 =\n    Step 1 :&gt;\n    Step @B @C 2 :&gt;\n    Nil\n</code></pre>\n\n<p>But this breaks down if there are not enough constraints to resolve ambiguity, e.g. this fails:</p>\n\n<pre><code>example2 :: Steps Int A\nexample2 =\n    Step 1 :&gt;\n    Step 2 :&gt;\n    Step @B @C 3 :&gt;\n    Nil\n</code></pre>\n\n<blockquote>\n  <p>Ambiguous type variable <code>after0</code> arising from a use of <code>Step</code>\n       prevents the constraint <code>(SingI after0)</code> from being solved.</p>\n</blockquote>\n\n<p>It is understandable that this can't be made to work; for example, there would be no place from which we can pull the <code>ending</code> we put in the <code>collapse</code>d list.</p>\n\n<p>We can, instead, make \"not caring\" explicit by using a <code>Maybe ending</code> on both sides:</p>\n\n<pre><code>data Step a (before :: Maybe ending) (after :: Maybe ending) where\n    Step :: (SingI before, SingI after) =&gt; a -&gt; Step a before after\n\ndata Steps a (first :: Maybe ending) where\n    Nil :: Steps a first\n    (:&gt;) :: Step a before after -&gt; Steps a after -&gt; Steps a before\ninfixr 5 :&gt;\n\nbefore :: forall ending a (before :: Maybe ending) (after :: Maybe ending). (SingKind ending) =&gt; Step a before after -&gt; Maybe (Demote ending)\nbefore Step{} = FromSing (sing @before)\n\nafter :: forall ending a (before :: Maybe ending) (after :: Maybe ending). (SingKind ending) =&gt; Step a before after -&gt; Maybe (Demote ending)\nafter Step{} = FromSing (sing @after)\n\ncollapse :: forall ending a (first :: Maybe ending) . (SingKind ending) =&gt; Steps a first -&gt; (Maybe (Demote ending), [(a, Maybe (Demote ending))])\ncollapse Nil = (Nothing, [])\ncollapse xs@(x :&gt; _) = (before x, go xs)\n  where\n    go :: Steps a whatever -&gt; [(a, Maybe (Demote ending))]\n    go Nil = []\n    go (s@(Step x) :&gt; xs) = (x, after s) : go xs\n</code></pre>\n\n<p>and then model the relationship between <code>Nothing</code> and <code>Just ending</code> explicitly, weakening where necessary:</p>\n\n<pre><code>type family Meet (a :: Maybe k) (b :: Maybe k) where\n    Meet Nothing  b        = b\n    Meet a        Nothing  = a\n    Meet (Just a) (Just a) = Just a\n\ninfixr 5 &gt;:&gt;\n(&gt;:&gt;) :: forall before after after' meet a. (Meet after after' ~ meet, SingI meet) =&gt; Step a before after -&gt; Steps a after' -&gt; Steps a before\nStep x &gt;:&gt; xs = Step x :&gt; xs'\n  where\n    xs' :: Steps a meet\n    xs' = case xs of\n        Nil -&gt; Nil\n        Step y :&gt; ys -&gt; Step y :&gt; ys\n</code></pre>\n\n<p>This allows us to rewrite <code>example2</code> using <code>Nothing</code>s to represent endings \nwith no constraints:</p>\n\n<pre><code>example2 :: Steps Int (Just A)\nexample2 =\n    Step @(Just A) @Nothing 1 &gt;:&gt;\n    Step @Nothing  @Nothing 2 &gt;:&gt;\n    Step @(Just B) @(Just C) 3 &gt;:&gt;\n    nil\n</code></pre>\n\n<blockquote>\n<pre><code>&gt; collapse example2\n(Just A,[(1,Nothing),(2,Just B),(3,Just C)])\n</code></pre>\n</blockquote>\n\n<p><strong>So now for my question</strong></p>\n\n<p>Is it possible to remove the need for the explicit <code>@Nothing</code> type applications? That is, is there some infrastructure I could add that would make the following mean the same as <code>example2</code> above:</p>\n\n<pre><code>example2' :: Steps Int (Just A)\nexample2' =\n    Step @(Just A) 1 &gt;:&gt;\n    Step 2 &gt;:&gt;\n    Step @(Just B) @(Just C) 3 &gt;:&gt;\n    nil\n</code></pre>\n\n<p>?</p>\n"}, {"tags": ["haskell", "monads", "typeclass", "servant", "rank-n-types"], "answers": [{"tags": [], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "is_accepted": false, "score": 0, "last_activity_date": 1562648495, "creation_date": 1562648495, "answer_id": 56945625, "question_id": 56931757, "link": "https://stackoverflow.com/questions/56931757/struggling-with-wiring-up-a-pair-of-type-class-constrained-monads-within-servant/56945625#56945625", "title": "Struggling with wiring-up a pair of type-class constrained monads within servant", "body": "<p>Although my <strong>entire codebase</strong> has not yet compiled, I <em>may</em> have a possible answer that uses <code>RankNTypes</code>:</p>\n\n<pre><code>type HasApp m = (HasDatabase m, HasSmtp m)\n\ntype UserRunner m n = (forall perms a . Proxy (perms :: [Permission]) -&gt; UserId -&gt; (HasApp (m perms) =&gt; m perms a) -&gt; n a)\n\nserver :: UserRunner m n -&gt; Routes (AsServerT n)\nserver runForUid = Routes\n  { rFetchOrder = \\uid orderId -&gt; runForUid fetchOrderPerms uid $ fetchOrderById orderId\n  , rDeleteOrder = \\uid orderId -&gt; runForUid deleteOrderPerms uid $ deleteOrderById orderId\n  } \n</code></pre>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1562648495, "creation_date": 1562577385, "last_edit_date": 1562582601, "question_id": 56931757, "link": "https://stackoverflow.com/questions/56931757/struggling-with-wiring-up-a-pair-of-type-class-constrained-monads-within-servant", "title": "Struggling with wiring-up a pair of type-class constrained monads within servant", "body": "<blockquote>\n  <p>Please scroll-down to read an important edit to this question</p>\n</blockquote>\n\n<h3>Original (long-winded) question</h3>\n\n<p>My web-app's code is written in a type-class constrained monad, which looks something like this:</p>\n\n<pre><code>fetchOrderById :: (HasDatabase m) =&gt; Args -&gt; m Result\n\nsendConfirmationMail :: (HasSmtp m) =&gt; Args -&gt; m EmailId\n</code></pre>\n\n<p>Each module has it's own <code>server</code> block, which looks like this:</p>\n\n<pre><code>data Routes route = Routes\n  { rFetchOrder :: route :- CustomAuth :&gt; \"orders\" :&gt; Capture \"OrderId\" OrderId :&gt; Get '[JSON] Order\n  , rDeleteOrder :: route :- CustomAuth :&gt; \"deleteOrder\" :&gt; Capture \"OrderId\" OrderId :&gt; Delete '[JSON] ()\n  }\n\n--\n-- NOTE: This type-signature WILL NOT compile...\n--\nserver :: Routes (AsServerT m)\nserver = Routes\n  { rFetchOrder = \\userId orderId -&gt; runForUser fetchOrderPerms userId $ fetchOrderById orderId\n  , rDeleteOrder = \\userId orderId -&gt; runForUser deleteOrderPerms userId $ deleteOrderById orderId\n  }\n\nfetchOrderPerms :: Proxy '[ 'PermissionFetchOrder]\nfetchOrderPerms = Proxy\n\ndeleteOrderPerms :: Proxy '[ 'PermissionDeleteOrder]\ndeleteOrderPerms = Proxy\n\n</code></pre>\n\n<p>Now, the <code>runForUser</code> function is where the \"pair\" of monads comes in. I want <code>runForUser</code> to have the following type-sig, where it transforms the \"inner monad\" <code>n</code> to the outer monad <code>m</code> WITHOUT making either of them concrete:</p>\n\n<pre><code>runForUser :: UserId -&gt; n a -&gt; m a\n</code></pre>\n\n<p>This \"type-class magic\" is required to not commit to a concrete monad as long as possible, which will, hopefully, allow me to write tests.</p>\n\n<p>When finally wired-up for the production app, here's what <code>runForUid</code> will transform:</p>\n\n<pre><code>AppM '[PermissionFetchOrder] a -&gt; ServantM a\n\nAppM '[PermissionDeleteOrder] a -&gt; ServantM a\n\n-- and so on...\n</code></pre>\n\n<p>And when wired-up for tests:</p>\n\n<pre><code>TestM '[PermissionFetchOrder] a -&gt; TestServantM a\n\nTestM '[PermissionDeleteOrder] a -&gt; TestServantM a\n\n-- and so on...\n</code></pre>\n\n<p>I'm struggling with writing a type-class for the <code>runForUid</code> function. I've tried various techniques, and the closest that I've gotten is the following:</p>\n\n<pre><code>-- \n-- This compiles...\n--\nclass (HasDatabase (InnerMonad m), HasSmtp (InnerMonad m)) =&gt; RunForUser m where\n  type InnerMonad m :: * -&gt; *\n\n  runForUser :: Proxy (p :: [Permission]) -&gt;  UserId -&gt; (InnerMonad m) a -&gt; m a\n\n\n--\n-- Even this compiles...\n--\nserver :: (RunForUser m) =&gt; Routes (ServerT m)\nserver = Route\n  { rFetchOrder = \\uid orderId -&gt; runForUser fetchOrderPerms userId $ fetchOrderById orderId\n  , rDeleteOrder = ...\n  }\n\n-- \n-- And this is where it gets stuck, because the compiler \n-- doesn't know how to deal with `perms` as it is not in \n-- scope\n--\ninstance (HasDatabase (AppM perms), HasSmtp (AppM perms)) =&gt; RunForUser ServantM where\n  type InnerMonad ServantM = AppM (perms :: [Permission])\n\n  runForUser permProxy userId action = ...\n</code></pre>\n\n<p>If the solution that I have presented above, is on the right track, then my question is - how do I tell the compiler to not worry about <code>perms</code>? That is a job for the implementation of <code>runForUser</code>. Can I use <code>RankNTypes</code> in any way and stick a <code>forall perms</code> somewhere and get this to work?</p>\n\n<p>On the other hand, if the approach given above is complete garbage, what is a better way to get this done?</p>\n\n<h3>Edit</h3>\n\n<p>I <em>may</em> have found an acceptable solution, but I'm still looking for a better way to avoid the type-related boilerplate.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, RankNTypes, PartialSignature, ScopedTypeVariables -#}\n\ntype HasApp m = (HasDatabase m, HasSmtp m)\n\nclass HasServant ...\n\nclass (HasApp m, HasServant n) =&gt; RunForUser m n where\n  runForUser :: Proxy (perms :: [Permission]) -&gt; UserId -&gt; m a -&gt; n a\n\nserver :: forall m n . (RunForUser m n, HasApp m) =&gt; Routes (AsServerT n)\nserver = Routes\n  { rFetchOrder = \\userId orderId -&gt; \n      runForUser fetchOrderPerms userId \n        --\n        -- NOTE: Had to manually annotate the type `m a` and had\n        -- to use PartialTypeSignatures to avoid having to specify\n        -- the type `a` again.\n        --\n        (fetchOrderById orderId :: m _)\n  , ...\n  }\n\n</code></pre>\n"}, {"tags": ["haskell", "singleton", "dependent-type", "data-kinds"], "answers": [{"comments": [{"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1562654367, "post_id": 56946517, "comment_id": 100432570, "body": "Thank you, yet again, for the insightful comment. I&#39;ve already ordered a print of the paper (or was it a PhD thesis), titled <code>Dependent Types In Haskell: Theory and Practice</code> (by Richard A. Eisenberg, who I believe, is the author of the <code>singletons</code> library). The paper that you&#39;ve linked to, is much shorted and I&#39;ll definitely give it a read. In the meantime, is my intuition correct: a singleton is a type with exactly one value. So, if you know the value (at runtime), you also know the type."}, {"owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1562654850, "post_id": 56946517, "comment_id": 100432814, "body": "I think I&#39;m unable to appreciate/understand the following: <code>That is, fromSing and toSing don&#39;t convert between values and types, they convert between values and singletons. You typically use toSing when you have a function that&#39;s been written to require a singleton:</code> Why would one want to work with <code>SValue value</code> or <code>SomeSing k</code>? Is it to write functions that can accept <i>any</i> singleton? For example, <code>data Perms = Perm1 | Perm2 ; data Features = Feature1 | Feature2</code>, and I want to write a function that can work with a <code>x :: Perms</code> kind OR <code>y :: Features</code> kind?"}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1562655865, "post_id": 56946517, "comment_id": 100433358, "body": "The type <code>SValue value</code> can have one of two values: <code>SValue1</code> or <code>SValue2</code>, and similarly <code>SomeSing Value</code> can only be <code>SomeSing SValue1</code> or <code>SomeSing SValue2</code>, so you work with those when you want to write a function to accept a singleton for types of kind <code>Value</code>."}, {"owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "reply_to_user": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "edited": false, "score": 0, "creation_date": 1562684821, "post_id": 56946517, "comment_id": 100449531, "body": "Re: your intuition. Yes, that&#39;s true, though &quot;know&quot; is a pretty vague term, so it might be more accurate to say: if you inspect (pattern match) the value at the term level, you make type information (type equality constraints) available at the type level."}], "tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 3, "last_activity_date": 1562653979, "creation_date": 1562653979, "answer_id": 56946517, "question_id": 56929442, "link": "https://stackoverflow.com/questions/56929442/how-to-use-tosing-from-singletons-library/56946517#56946517", "title": "How to use toSing from singletons library?", "body": "<p>If you compile the code:</p>\n\n<pre><code>{-# OPTIONS_GHC -Wall #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE TypeFamilies #-}\n\nmodule SingletonExample where\nimport Data.Singletons.TH\nsingletons [d| data Value = Value1 | Value2 |]\n</code></pre>\n\n<p>with the flags <code>-ddump-splices -dsuppress-uniques</code>, you can see the actual code the <code>singletons</code> library is generating via Template Haskell.  In particular, the generated <code>SingKind</code> instance is:</p>\n\n<pre><code>instance SingKind Value where\n  type Demote Value = Value\n  fromSing SValue1 = Value1\n  fromSing SValue2 = Value2\n  toSing Value1 = SomeSing SValue1\n  toSing Value2 = SomeSing SValue2\n</code></pre>\n\n<p>So, <code>fromSing</code> and <code>toSing</code> are just boilerplate conversion functions from (runtime) values to (runtime) singletons and back.</p>\n\n<p>That is, <code>fromSing</code> and <code>toSing</code> don't convert between values and types, they convert between values and singletons.  You typically use <code>toSing</code> when you have a function that's been written to require a singleton:</p>\n\n<pre><code>g :: SValue value -&gt; String\ng SValue1 = \"one\"\ng SValue2 = \"two\"\n</code></pre>\n\n<p>but all you have is an associated value.  In this case, you can use the somewhat awkward construct:</p>\n\n<pre><code>f :: Value -&gt; String\nf v = case toSing v of SomeSing sv -&gt; g sv\n</code></pre>\n\n<p>to call <code>g</code> with the requisite singleton.</p>\n\n<p>It turns out that for the usual use cases for singletons, there are only a few situations where this works and/or is helpful.  As a result, it's actually pretty rare to see <code>toSing</code> used in singleton code.  And, in particular, it's neither necessary nor very often particularly useful to use <code>toSing</code> when working with types that are runtime-dependent.</p>\n\n<p>Ultimately, if you want to learn/understand the <code>singletons</code> library, you need to understand when and why singletons are useful (and the complex and subtle sense in which they are runtime representations of types), not how to convert back and forth between them and their associated values.  To that end, I suggest reading the <a href=\"https://personal.cis.strath.ac.uk/conor.mcbride/pub/hasochism.pdf\" rel=\"nofollow noreferrer\">Hasochism</a> paper, <a href=\"https://cs.brynmawr.edu/~rae/papers/2012/singletons/paper.pdf\" rel=\"nofollow noreferrer\">Dependently Typed Programming with Singletons</a>, searching for \"dependently typed programming in haskell\" and or \"haskell singletons\" and reading every blog post you see.  Weirich has some <a href=\"https://www.youtube.com/results?search_query=stephanie+weirich\" rel=\"nofollow noreferrer\">YouTube videos</a> that would be worth checking out, too.</p>\n"}], "owner": {"reputation": 5657, "user_id": 534481, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/60df8c1a366ab1bf4378154e71a93367?s=128&d=identicon&r=PG", "display_name": "Saurabh Nanda", "link": "https://stackoverflow.com/users/534481/saurabh-nanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1562653979, "creation_date": 1562567452, "question_id": 56929442, "link": "https://stackoverflow.com/questions/56929442/how-to-use-tosing-from-singletons-library", "title": "How to use toSing from singletons library?", "body": "<p>I'm a newbie when it comes to the <code>singleton</code> library, and <em>may</em> have bitten off more than I can chew here.</p>\n\n<p>I've managed to use <code>fromSing</code> successfully to convert a \"singleton type\" to a \"value-level term\" (is my terminology correct?) However, I'm unable to understand how to use <code>toSing</code> and <em>conceptually</em> how it would convert a value <strong>at run-time</strong> to a type?</p>\n\n<p>Here's what the docs for <a href=\"https://www.stackage.org/haddock/lts-12.1/singletons-2.4.1/Data-Singletons.html#v:toSing\" rel=\"nofollow noreferrer\"><code>toSing</code></a> say, which I don't really understand...</p>\n\n<pre><code>-- Convert an unrefined type to an existentially-quantified singleton type.\ntoSing :: Demote k -&gt; SomeSing k\n</code></pre>\n\n<p>Here's what <code>SomeSing</code> says:</p>\n\n<pre><code>-- An existentially-quantified singleton. This type is useful \n-- when you want a singleton type, but there is no way of knowing, \n-- at compile-time, what the type index will be. To make use of this \n-- type, you will generally have to use a pattern-match:\n\nfoo :: Bool -&gt; ...\nfoo b = case toSing b of\n          SomeSing sb -&gt; {- fancy dependently-typed code with sb -}\n</code></pre>\n\n<p>Does this mean that <em>conceptually</em>, <code>fromSing</code> is basically doing the following:</p>\n\n<pre><code>data RuntimeValue = Value1 | Value2\n\nsomeFunction :: RuntimeValue -&gt; UnifiedType a\ncase runtimeValue of\n  Value1 -&gt; someAction (Proxy :: Proxy 'Value1)\n  Value2 -&gt; someAction (Proxy :: Proxy 'Value2)\n</code></pre>\n\n<p>And that is the best that one can expect from Haskell, as of today? i.e. we need to pattern-match on the runtime value, run functions that can be of different types, but ultimately they should unify to a single type?</p>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1562555373, "post_id": 56927423, "comment_id": 100397111, "body": "<code>case snd x of R n -&gt; ...</code>?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1562591976, "post_id": 56927423, "comment_id": 100411857, "body": "<code>let (R rotation) = snd x in ...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": true, "score": 5, "last_activity_date": 1562550350, "creation_date": 1562550350, "answer_id": 56927480, "question_id": 56927423, "link": "https://stackoverflow.com/questions/56927423/haskell-pattern-matching-with-custom-data-types/56927480#56927480", "title": "Haskell: Pattern matching with custom data types", "body": "<p><code>R</code> is a constructor of the <code>Special</code> data type. In order to extract <code>Rotation</code> from <code>R</code> you need to write the following function:</p>\n\n<pre><code>unsafeExtractRotation :: Special -&gt; Rotation\nunsafeExtractRotation (R rotation) = rotation\n</code></pre>\n\n<p>However, this function is <em>unsafe</em> (as its name suggests) because it is partial: it doesn't handle all cases. According to the function type, it should work with any value of the <code>Special</code> data type, so it's possible to pass <code>L</code> constructor to this function, and it will crash and later down the road it can be very problematic to figure out the source of such error.</p>\n\n<p>Safer function can look like this:</p>\n\n<pre><code>extractRotation :: Special -&gt; Maybe Rotation\nextractRotation (R rotation) = Just rotation\nextractRotation _ = Nothing\n</code></pre>\n\n<p>It won't crash. Instead, it forces you to deal explicitly with the cases where you passed different constructor.</p>\n"}, {"comments": [{"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1562579954, "post_id": 56927861, "comment_id": 100405630, "body": "#3 subsumes both #1 and #2: <code>fromMaybe 0 . specialToRotation3</code> and <code>fromJust . specialToRotation3</code> respectively."}], "tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 1, "last_activity_date": 1562554459, "creation_date": 1562554459, "answer_id": 56927861, "question_id": 56927423, "link": "https://stackoverflow.com/questions/56927423/haskell-pattern-matching-with-custom-data-types/56927861#56927861", "title": "Haskell: Pattern matching with custom data types", "body": "<p>With the info you provided, I can come up with three ideas, one from Shersh, but you could use the one that fits more with your code:</p>\n\n<pre><code>-- If is not of Rotation type, value is 0\nspecialToRotation (R n) = n\nspecialToRotation _     = 0\n\n-- If not of Rotation type, pattern matching failure\nspecialToRotation2 (R n) = n\n\n-- If not of Rotation type, value is Nothing\n\nspecialToRotation3 (R n) = Just n\nspecialToRotation3 _     = Nothing\n</code></pre>\n\n<p>The option 2) is not entirely wrong, a lot of functions are partial in Haskell, think in <code>head</code> and <code>tail</code> from list api. Both has no definition for empty list. So maybe you could use it.</p>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "accepted_answer_id": 56927480, "answer_count": 2, "score": 1, "last_activity_date": 1562554459, "creation_date": 1562549855, "last_edit_date": 1562550290, "question_id": 56927423, "link": "https://stackoverflow.com/questions/56927423/haskell-pattern-matching-with-custom-data-types", "title": "Haskell: Pattern matching with custom data types", "body": "<p>I have the following custom data type:</p>\n\n<pre><code>type Length = Integer \ntype Rotation = Integer \ndata Colour = Colour { red, green, blue, alpha :: Int }\n            deriving (Show, Eq)\n\ndata Special \n  = L Length \n  | R Rotation\n  | Col Colour  \n  deriving (Show, Eq) \n</code></pre>\n\n<p>Say that I have a tuple of the following form:</p>\n\n<pre><code>let x = (\"Jump\", R 90)\n</code></pre>\n\n<p>And I extract the second value in the tuple using:</p>\n\n<pre><code>snd x = R 90\n</code></pre>\n\n<p>Is there any way that I can use pattern matching to get the Rotation value 90 from R 90 so that I can use it in another area of code? When I use <code>snd x</code>, the type of the result is of type Special but I would just like to get the Rotation value. Any insights are appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1562520010, "post_id": 56924244, "comment_id": 100390782, "body": "Weird. I added the obvious injectivity axiom (<code>type family Opp (n :: Parity) = (n&#39; :: Parity) | n&#39; -&gt; n</code>), and the error I get is &quot;Could not deduce <code>p1 ~ p</code> from the context <code>Opp p ~ Opp p1</code>&quot;. Isn&#39;t that exactly the deduction that the injectivity axiom is supposed to let you make??"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1562522358, "post_id": 56924244, "comment_id": 100391386, "body": "@DanielWagner Injectivity annotations are not exploited by GHC for anything except for allowing some types that would be otherwise considered ambiguous. Only for that. They are not used, as one would expect, to infer a ~ b from F a ~ F b. Personally, I consider them to be nearly useless, in their current form."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1562522530, "post_id": 56924244, "comment_id": 100391423, "body": "I don&#39;t know how to write <code>pred</code> with that type. I think an additional singleton argument for <code>p</code> is needed."}, {"owner": {"reputation": 85, "user_id": 3006285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/159d010ec4ec207c91312e0ff1ec3f26?s=128&d=identicon&r=PG", "display_name": "mitchellvitez", "link": "https://stackoverflow.com/users/3006285/mitchellvitez"}, "edited": false, "score": 0, "creation_date": 1562522792, "post_id": 56924244, "comment_id": 100391485, "body": "I&#39;m happy to write it with a different type as long as the parity checking is preserved (and of course it does what <code>pred</code> is supposed to do). How would such an argument work?"}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 3006285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/159d010ec4ec207c91312e0ff1ec3f26?s=128&d=identicon&r=PG", "display_name": "mitchellvitez", "link": "https://stackoverflow.com/users/3006285/mitchellvitez"}, "edited": false, "score": 0, "creation_date": 1562523086, "post_id": 56924797, "comment_id": 100391553, "body": "This along with @danidiaz &#39;s suggestion to change the order to <code>pred :: Natural p -&gt; Natural (Opp p)</code> did the trick! Thanks!"}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 5, "last_activity_date": 1562522733, "creation_date": 1562522733, "answer_id": 56924797, "question_id": 56924244, "link": "https://stackoverflow.com/questions/56924244/how-can-i-find-the-predecessor-of-a-natural-with-type-level-parity-checking/56924797#56924797", "title": "How can I find the predecessor of a Natural with type-level parity checking?", "body": "<p>As @chi indicated,</p>\n\n<blockquote>\n  <p>Injectivity annotations are not exploited by GHC for anything except for allowing some types that would be otherwise considered ambiguous. Only for that. They are not used, as one would expect, to infer <code>a ~ b</code> from <code>F a ~ F b</code>. Personally, I consider them to be nearly useless, in their current form.</p>\n</blockquote>\n\n<p>So you have to define <code>Natural</code> a bit differently:</p>\n\n<pre><code>data Natural :: Parity -&gt; * where\n  Zero :: Natural 'Even\n  Succ :: (p ~ Opp s, s ~ Opp p) =&gt; Natural p -&gt; Natural s\n</code></pre>\n\n<p>Now you can get both of the things you need.</p>\n"}, {"tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 4, "last_activity_date": 1562526573, "last_edit_date": 1562526573, "creation_date": 1562522876, "answer_id": 56924814, "question_id": 56924244, "link": "https://stackoverflow.com/questions/56924244/how-can-i-find-the-predecessor-of-a-natural-with-type-level-parity-checking/56924814#56924814", "title": "How can I find the predecessor of a Natural with type-level parity checking?", "body": "<p>How about this slightly different formulation. Notice the change in the position of <code>Opp</code>:</p>\n\n<pre><code>data Parity = Even | Odd\n\ntype family Opp (n :: Parity) = (m :: Parity) | m -&gt; n where\n    Opp 'Even = 'Odd\n    Opp 'Odd  = 'Even\n\ndata Natural :: Parity -&gt; * where\n  Zero :: Natural 'Even\n  Succ :: Natural (Opp p) -&gt; Natural p\n\npred :: Natural p -&gt; Natural (Opp p)\npred (Succ n) = n\n</code></pre>\n\n<p>This makes <code>pred</code> \"go with the grain\". The compiler doesn't need to \"undo\" the <code>Opp</code> application, is just \"works forward\".</p>\n\n<p>But wait, doesn't this shift the problem to the <code>Succ</code> constructor? Actually, yes, if I remove the injectivity annotation, the type of terms like</p>\n\n<pre><code>ghci&gt; Succ (Succ Zero)\n</code></pre>\n\n<p>fails to be inferred. But why the injectivity annotation wasn't sufficient before, but it is now? I don't know.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1562526206, "post_id": 56925013, "comment_id": 100392274, "body": "Richard Eisenberg has suggested a &quot;safer&quot; version, where you prove <code>oppInj</code> legitimately and then use <code>RULES</code> to rewrite to <code>unsafeCoerce</code>. But since even the legit <code>oppInj</code> is O(1), you don&#39;t really even <i>need</i> to erase!"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1562527240, "post_id": 56925013, "comment_id": 100392527, "body": "Oh, I guess you want erasure to avoid cluttering the <code>Succ</code> constructor... That&#39;s reasonable."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1562529613, "post_id": 56925013, "comment_id": 100393055, "body": "I&#39;ve said this before, but I avoid using <code>RULES</code> for that purpose because they just don&#39;t erase far enough, as you&#39;ve noticed."}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": false, "score": 6, "last_activity_date": 1562524508, "creation_date": 1562524508, "answer_id": 56925013, "question_id": 56924244, "link": "https://stackoverflow.com/questions/56924244/how-can-i-find-the-predecessor-of-a-natural-with-type-level-parity-checking/56925013#56925013", "title": "How can I find the predecessor of a Natural with type-level parity checking?", "body": "<p>Given singletons for <code>Parity</code>:</p>\n\n<pre><code>data SParity :: Parity -&gt; Type where\n  SEven :: SParity Even\n  SOdd :: SParity Odd\n</code></pre>\n\n<p>We can prove the injectivity of <code>Opp</code></p>\n\n<pre><code>oppInj' :: Opp p ~ Opp q =&gt; SParity p -&gt; SParity q -&gt; p :~: q\noppInj' SEven SEven = Refl\noppInj' SOdd SOdd = Refl\n</code></pre>\n\n<p>Now we can define:</p>\n\n<pre><code>data Natural' :: Parity -&gt; Type where\n  Zero' :: Natural' Even\n  Succ' :: SParity p -&gt; Natural' p -&gt; Natural' (Opp p)\npred' :: SParity p -&gt; Natural' (Opp p) -&gt; Natural' p\npred' p (Succ' q n) = case oppInj' p q of Refl -&gt; n\n</code></pre>\n\n<p>You may safely perform erasure to get rid of all the singleton junk:</p>\n\n<pre><code>-- for maximum symmetry, instead of relying on type applications we could\n-- just substitute Proxy# in place of SParity everywhere, but meh\noppInj :: forall p q. Opp p ~ Opp q =&gt; p :~: q\noppInj = unsafeCoerce Refl -- we know this is OK because oppInj' exists\ndata Natural :: Parity -&gt; Type where\n  Zero :: Natural Even\n  Succ :: Natural p -&gt; Natural (Opp p)\npred :: forall p. Natural (Opp p) -&gt; Natural p\npred (Succ (n :: Natural q)) = case oppInj @p @q of Refl -&gt; n\n</code></pre>\n\n<p>This pattern, doing something with singletons and then erasing them for an improvement in space and time (here it's just a constant factor) is common when doing dependently typed programming in Haskell. Normally, you wouldn't write <code>Natural'</code> or <code>pred'</code>, but they are useful as guides for writing the erased versions.</p>\n\n<p>PS: Make sure to handle the <code>Zero</code> case!</p>\n"}], "owner": {"reputation": 85, "user_id": 3006285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/159d010ec4ec207c91312e0ff1ec3f26?s=128&d=identicon&r=PG", "display_name": "mitchellvitez", "link": "https://stackoverflow.com/users/3006285/mitchellvitez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 1, "accepted_answer_id": 56924797, "answer_count": 3, "score": 6, "last_activity_date": 1562526573, "creation_date": 1562518526, "last_edit_date": 1562522353, "question_id": 56924244, "link": "https://stackoverflow.com/questions/56924244/how-can-i-find-the-predecessor-of-a-natural-with-type-level-parity-checking", "title": "How can I find the predecessor of a Natural with type-level parity checking?", "body": "<p>I've been working with natural numbers with additional type-level parity information. <code>succ</code> has been successfully implemented in the most straightforward way:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>succ :: Natural p -&gt; Natural (Opp p)\nsucc = Succ\n</code></pre>\n\n<p>However, I'm still struggling with getting <code>pred</code> to typecheck. A minimal example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE TypeFamilyDependencies #-}\n\ndata Parity = Even | Odd\n\ntype family Opp (p :: Parity) = (r :: Parity) | r -&gt; p where\n  Opp 'Odd = 'Even\n  Opp 'Even = 'Odd\n\ndata Natural :: Parity -&gt; * where\n  Zero :: Natural 'Even\n  Succ :: Natural p -&gt; Natural (Opp p)\n\npred :: Natural (Opp p) -&gt; Natural p\npred (Succ n) = n\n</code></pre>\n\n<p>What can I do to successfully implement <code>pred</code>? Right now I'm getting many different large and complicated type errors, especially <code>could not deduce Opp p ~ p1</code>.</p>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching", "algebraic-data-types", "custom-data-type"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 3, "creation_date": 1562505819, "post_id": 56922525, "comment_id": 100387416, "body": "What do you mean by &quot;extract the value&quot;? This is what&#39;s called a &quot;sum type&quot; - so it consists of a value <i>one of</i> those types, not a collection of them. Concretely, an element might be <code>L 1</code> or <code>R 42</code> - neither of these can have a <code>Colour</code> extracted from them. It may be you want a &quot;product type&quot; instead, which would be <code>data Special = Special Length Rotation Colour</code> - where each value of that type has <code>Length</code>, <code>Rotation</code> and <code>Colour</code> values that can be extracted."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562505912, "post_id": 56922525, "comment_id": 100387434, "body": "You can just unpack the data constructor."}, {"owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "reply_to_user": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1562506049, "post_id": 56922525, "comment_id": 100387467, "body": "@RobinZigmond I don&#39;t think I want the data type to be a product data type since I want Special to be either one of Length, Rotation or Colour."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 1, "creation_date": 1562506190, "post_id": 56922525, "comment_id": 100387505, "body": "@ceno980 - thanks for clarifying, in that case your type is indeed correct. But in that case it&#39;s not clear what you mean by &quot;extract&quot;, since each value will only be able to extract <i>one</i> of the three components. If you want to match which one of the constructors it uses, you can do this with pattern matching, or a <code>case</code> expression. Regarding your recent edit, in the expression <code>L length</code> then <code>length</code> must be a <code>Length</code> (ie an <code>Integer</code>), due to how you defined the constructor."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 5, "last_activity_date": 1562507012, "creation_date": 1562507012, "answer_id": 56922698, "question_id": 56922525, "link": "https://stackoverflow.com/questions/56922525/haskell-understanding-custom-data-types/56922698#56922698", "title": "Haskell: Understanding custom data types", "body": "<p>For the expression <code>L length</code> to be valid, <code>length</code> would have to be a <code>Length</code> (because  <code>L :: Length -&gt; Special</code>).</p>\n\n<pre><code>takeL (x:xs)\n      | x == (L length) = length\n</code></pre>\n\n<p>is not valid. Unless you've redefined <code>length</code> somewhere, <code>length</code> is a function <code>[a] -&gt; Int</code> from the standard library, so <code>L length</code> is a type error.</p>\n\n<p>I think what you're trying to do here is just pattern matching:</p>\n\n<pre><code>takeL (L length : xs) = length\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1562840394, "last_edit_date": 1562840394, "creation_date": 1562509446, "answer_id": 56922982, "question_id": 56922525, "link": "https://stackoverflow.com/questions/56922525/haskell-understanding-custom-data-types/56922982#56922982", "title": "Haskell: Understanding custom data types", "body": "<p>The data type definition</p>\n\n<pre><code>data Special  = \n</code></pre>\n\n<p>reads: <code>Special</code> is a new <em>type</em> such that to create a <em>value</em> of type <code>Special</code>, </p>\n\n<pre><code>                  L Length \n</code></pre>\n\n<ul>\n<li><p>call <code>L   l</code> where <code>l</code> is a value of type <code>Length</code>; or</p>\n\n<pre><code>            | R Rotation \n</code></pre></li>\n<li><p>call <code>R   r</code> where <code>r</code> is a value of type <code>Rotation</code>; or</p>\n\n<pre><code>            | Col Colour  \n</code></pre></li>\n<li><p>call <code>Col c</code> where <code>c</code> is a value of type <code>Colour</code>.</p></li>\n</ul>\n\n<hr>\n\n<p>To analyze a value of type <code>Special</code>, there are three cases to consider:</p>\n\n<pre><code>foo :: Special -&gt; ...\nfoo val = \n    case val of\n        L   l -&gt; ...  \n</code></pre>\n\n<ul>\n<li><p><code>l</code> is a value of type <code>Length</code>, in the case <code>val</code> was actually <code>L   l</code>; or</p>\n\n<pre><code>    R   r -&gt; ... \n</code></pre></li>\n<li><p><code>r</code> is a value of type <code>Rotation</code>, in the case <code>val</code> was actually <code>R   r</code>; or</p>\n\n<pre><code>    Col c -&gt; ...  \n</code></pre></li>\n<li><p><code>c</code> is a value of type <code>Colour</code>, in the case <code>val</code> was actually <code>Col c</code>.</p></li>\n</ul>\n\n<p>The <code>case</code> syntax in function definitions can also be expressed with the pattern based clauses:</p>\n\n<pre><code>foo :: Special -&gt; ...\nfoo (L   l) = ...\nfoo (R   r) = ...\nfoo (Col c) = ...\n</code></pre>\n"}], "owner": {"reputation": 1905, "user_id": 8713450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed61e21ec072346277da9569f1c9f966?s=128&d=identicon&r=PG&f=1", "display_name": "ceno980", "link": "https://stackoverflow.com/users/8713450/ceno980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1532, "favorite_count": 0, "accepted_answer_id": 56922698, "answer_count": 2, "score": 4, "last_activity_date": 1562840394, "creation_date": 1562505684, "last_edit_date": 1562515011, "question_id": 56922525, "link": "https://stackoverflow.com/questions/56922525/haskell-understanding-custom-data-types", "title": "Haskell: Understanding custom data types", "body": "<p>I am trying to make my own custom data type in Haskell.</p>\n\n<p>I have the following data types:</p>\n\n<pre><code>type Length = Integer \ntype Rotation = Integer \ndata Colour = Colour { red, green, blue, alpha :: Int }\n            deriving (Show, Eq)\n</code></pre>\n\n<p>I am trying to make a custom data type that can be either one of the data types above. I have the following:</p>\n\n<pre><code>data Special \n  = L Length \n  | R Rotation \n  | Col Colour  \n  deriving (Show, Eq) \n</code></pre>\n\n<p>However, I would like to be able to extract the <code>Length</code>, <code>Rotation</code> and <code>Colour</code> value if I have an instance of the <code>Special</code> data type. </p>\n\n<p>If I had:</p>\n\n<pre><code>L length\n</code></pre>\n\n<p>Would <code>length</code> here be of type <code>Special</code> or of type <code>Length</code>? If <code>length</code> is of type <code>Special</code> is there any way to extract it so it's of type <code>Length</code>?</p>\n\n<p>For example, is the following code valid?</p>\n\n<pre><code>takeL (x:xs)\n      | x == (L length) = length\n</code></pre>\n\n<p>Any insights are appreciated.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562505604, "post_id": 56922503, "comment_id": 100387356, "body": "Likely your <code>interprete s x</code> is supposed to return an <code>[a]</code>, not a <code>Maybe [a]</code>."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1562505640, "post_id": 56922503, "comment_id": 100387368, "body": "is that the entire <code>interprete</code> function? It looks like you gave it a return type of the form <code>[a]</code> rather than <code>Maybe [a]</code>, but without more context it&#39;s not clear what the &quot;best&quot; way to fix the problem is."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1562505646, "post_id": 56922503, "comment_id": 100387369, "body": "Note that <code>x `elem` [&quot;swap&quot;]</code> is equivalent to <code>x == &quot;swap&quot;</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562506425, "post_id": 56922503, "comment_id": 100387545, "body": "The error is not the input type of <code>swap_first_two_elements</code>, but the <i>output</i> type, it is (likely) not compatible with the output type of <code>interprete</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1562570921, "post_id": 56922503, "comment_id": 100401250, "body": "<code>drop (length s) s == drop 1 (take 1 $ undefined : s) == [] `asTypeOf` s</code>."}], "answers": [{"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 3, "last_activity_date": 1562510143, "creation_date": 1562510143, "answer_id": 56923082, "question_id": 56922503, "link": "https://stackoverflow.com/questions/56922503/couldnt-match-expected-type-a-with-actual-type-maybea/56923082#56923082", "title": "Couldn&#39;t match expected type [a] with actual type Maybe[a]", "body": "<p>So you have</p>\n\n<pre><code>interprete s x\n  | x `elem` [\"pop\"]  =   tail s\n  | x `elem` [\"swap\"] =   swap_first_two_elements s\n</code></pre>\n\n<p>Now,</p>\n\n<pre><code>tail                    :: [a] -&gt;       [a]\n</code></pre>\n\n<p>but</p>\n\n<pre><code>swap_first_two_elements :: [a] -&gt; Maybe [a]\n</code></pre>\n\n<p>and of course those are two different types altogether.</p>\n\n<p>You can't return a value of one type in some case, and of another type altogether in some other cases. All cases in a function definition must return values of the <em>same</em> type.</p>\n\n<p>A function goes from a type to a <em>type</em>, not to <em>types</em>.</p>\n\n<p>You can fix your definition by wrapping all the other cases' values in a <code>Just</code>, like so:</p>\n\n<pre><code>  | x `elem` [\"pop\"]  =   Just (tail s)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14537, "user_id": 7128034, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/T8aRg.jpg?s=128&g=1", "display_name": "Dami&#225;n Rafael Lattenero", "link": "https://stackoverflow.com/users/7128034/dami%c3%a1n-rafael-lattenero"}, "is_accepted": false, "score": 0, "last_activity_date": 1562648519, "creation_date": 1562648519, "answer_id": 56945631, "question_id": 56922503, "link": "https://stackoverflow.com/questions/56922503/couldnt-match-expected-type-a-with-actual-type-maybea/56945631#56945631", "title": "Couldn&#39;t match expected type [a] with actual type Maybe[a]", "body": "<p>Just for your code to have more sense, I think you need to spread the Maybe all over the sub-functions, for example in operate, and pop and all other \"unsafe\" functions, you can take advantage of Maybe type, like divide by 0:</p>\n\n<pre><code>interprete s x\n                | x `elem` [\"+\",\"-\",\"*\",\"/\",\"^\"] = operate x s\n                | x `elem` [\"inc\",\"dec\",\"sqrt\",\"sin\",\"cos\",\"inv\"] = Just (operate2 x s)\n                | x `elem` [\"+all\"] =  Just([sum s])\n                | x `elem` [\"dup\"] = dup s\n                | x `elem` [\"pop\"] = pop s \n                | x `elem` [\"swap\"] = swap_first_two_elements s\n                | x `elem` [\"clear\"] = Just []\n                | x `elem` [\"*all\"] = Just([product s])\n                | otherwise = Just(read x:s)\n\npop [] = Nothing\npop (x:xs) = Just xs\n\ndup [] = Nothing\ndup s@(x:xs) = Just (x:s) \n\noperate op (x:y:s) = case op of\n  \"+\" -&gt; Just(x + y:s)\n  \"-\" -&gt; Just(y - x:s)\n  \"*\" -&gt; Just( x * y:s)\n  \"/\" -&gt; case x of \n        0  -&gt; Nothing\n        n  -&gt; Just(y / x:s)\n  \"^\" -&gt; Just(y ** x:s)\noperate _ _ = Nothing\n\nswap_first_two_elements :: [a] -&gt; Maybe [a]\nswap_first_two_elements (x:y:xs)  = Just (y:x:xs)\nswap_first_two_elements _ = Nothing\n\noperate2 = undefined\n</code></pre>\n\n<p>I don't know what operate2 does, so, I leave it to you. But by sure, it has type [a] -> Maybe [a], so please, make it return a Maybe [a], please.</p>\n"}], "owner": {"reputation": 6287, "user_id": 203175, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/cDYBi.jpg?s=128&g=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/203175/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1562648519, "creation_date": 1562505485, "last_edit_date": 1562515290, "question_id": 56922503, "link": "https://stackoverflow.com/questions/56922503/couldnt-match-expected-type-a-with-actual-type-maybea", "title": "Couldn&#39;t match expected type [a] with actual type Maybe[a]", "body": "<p>please pardon for very beginner level quesion.</p>\n\n<p>I am now trying to introduce Maybe into my previous helper function (which swaps the first two elements of the list) to enable empty list error handling:</p>\n\n<p>...haskell</p>\n\n<pre><code>-- | the helper funtion to only swap the first two elements.\nswap_first_two_elements :: [a] -&gt; Maybe [a]\nswap_first_two_elements list = case list of\n  x:y:xs -&gt; Just (y:x:xs)\n  _      -&gt; Nothing\n</code></pre>\n\n<p>and invoking it in </p>\n\n<pre><code> interprete s x\n\n  | x `elem` [\"+\",\"-\",\"*\",\"/\",\"^\"] = operate x s\n  | x `elem` [\"inc\",\"dec\",\"sqrt\",\"sin\",\"cos\",\"inv\"] =  operate2 x s\n  | x `elem` [\"+all\"] =  [sum s]\n  | x `elem` [\"dup\"] =  (head s) :s\n  | x `elem` [\"pop\"] =   tail s\n  | x `elem` [\"swap\"] =    swap_first_two_elements s\n  | x `elem` [\"clear\"] =  drop (length s) s\n  | x `elem` [\"*all\"] =  [product s]\n  | otherwise = read x:s\n  where\n    operate op (x:y:s) = case op of\n      \"+\" -&gt; x + y:s\n      \"-\" -&gt; y - x:s\n      \"*\" -&gt; x * y:s\n      \"/\" -&gt; y / x:s\n      \"^\" -&gt; y ** x:s\n</code></pre>\n\n<p>But I am getting an error like </p>\n\n<pre><code>  Couldn't match expected type [a] with actual type Maybe[a]\n</code></pre>\n\n<p>I read other related posts and modified it like:</p>\n\n<pre><code>  | x `elem` [\"swap\"] =   swap_first_two_elements Just(s)\n</code></pre>\n\n<p>Still got error. Could experts offer where I go wrong? Thank you.</p>\n"}, {"tags": ["haskell", "haskell-stack", "haskell-turtle"], "answers": [{"comments": [{"owner": {"reputation": 155, "user_id": 1626022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fa95f10d1947f140a3e324576fea114?s=128&d=identicon&r=PG", "display_name": "tomphp", "link": "https://stackoverflow.com/users/1626022/tomphp"}, "edited": false, "score": 1, "creation_date": 1562527448, "post_id": 56922932, "comment_id": 100392588, "body": "The <code>getScriptPath</code> function from that package worked perfectly; the docs say it&#39;s experimental but it did exactly what I was hoping for. Thank you for your reply!"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 2, "last_activity_date": 1562508996, "creation_date": 1562508996, "answer_id": 56922932, "question_id": 56921430, "link": "https://stackoverflow.com/questions/56921430/get-the-source-directory-of-a-haskell-stack-turtle-script-from-within-the-scri/56922932#56922932", "title": "Get the source directory of a Haskell Stack &amp; Turtle script from within the script itself", "body": "<p>I think you can use the <code>executable-path</code> package to get this information:</p>\n\n<p><a href=\"https://www.stackage.org/haddock/nightly-2019-07-07/executable-path-0.0.3.1/System-Environment-Executable.html\" rel=\"nofollow noreferrer\">https://www.stackage.org/haddock/nightly-2019-07-07/executable-path-0.0.3.1/System-Environment-Executable.html</a></p>\n"}], "owner": {"reputation": 155, "user_id": 1626022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fa95f10d1947f140a3e324576fea114?s=128&d=identicon&r=PG", "display_name": "tomphp", "link": "https://stackoverflow.com/users/1626022/tomphp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1562508996, "creation_date": 1562496125, "question_id": 56921430, "link": "https://stackoverflow.com/questions/56921430/get-the-source-directory-of-a-haskell-stack-turtle-script-from-within-the-scri", "title": "Get the source directory of a Haskell Stack &amp; Turtle script from within the script itself", "body": "<p>I've created a <a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#script-interpreter\" rel=\"nofollow noreferrer\">stack interpreted script</a> using <a href=\"http://hackage.haskell.org/package/turtle\" rel=\"nofollow noreferrer\">Turtle</a> and I want to be able to get the directory where the script is (regardless of where it's been called from).</p>\n\n<p>This can be done in Bash by parsing <code>$0</code> or <code>$BASH_SOURCE[0]</code> (as described <a href=\"https://stackoverflow.com/questions/59895/get-the-source-directory-of-a-bash-script-from-within-the-script-itself\">here</a>, however, I can't work out how to do it with Stack/Turtle?</p>\n\n<p>I've tried the <a href=\"http://hackage.haskell.org/package/FindBin\" rel=\"nofollow noreferrer\">FindBin</a> library but it didn't work (it just returned the current working directory).</p>\n\n<p>My script is currently defined like so:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>#!/usr/bin/env stack\n{- stack --resolver lts-13.3 script\n    --package turtle\n    --package text\n-}\n</code></pre>\n\n<p>Is this possible with a stack script?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1562492094, "post_id": 56920926, "comment_id": 100384385, "body": "I do not see any use of <code>Either</code> here? Only of <code>Maybe</code>."}, {"owner": {"reputation": 136, "user_id": 11750068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5bfo27INeHw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcQi-WJomjZ4H810IlOkgJyfMERJg/photo.jpg?sz=128", "display_name": "youngseok jeon", "link": "https://stackoverflow.com/users/11750068/youngseok-jeon"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562492351, "post_id": 56920926, "comment_id": 100384446, "body": "I have made an edit and added Left and Right."}, {"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 3, "creation_date": 1562492612, "post_id": 56920926, "comment_id": 100384501, "body": "If you return <code>String</code> instead of <code>Either String Code</code> then how will the caller know if the lockerLookup was successful? Maybe good enough if you are only printing that String and let a human deal with the output, but if there is any logic supposed to happen, you need do know if it was &quot;right&quot; or &quot;left&quot;."}, {"owner": {"reputation": 136, "user_id": 11750068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5bfo27INeHw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcQi-WJomjZ4H810IlOkgJyfMERJg/photo.jpg?sz=128", "display_name": "youngseok jeon", "link": "https://stackoverflow.com/users/11750068/youngseok-jeon"}, "reply_to_user": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 1, "creation_date": 1562493108, "post_id": 56920926, "comment_id": 100384605, "body": "@Thilo Can I think of &quot;Either&quot; as a way to give meanings to what the output of the string is? if Left : error, Right: fine"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1562493157, "post_id": 56920926, "comment_id": 100384620, "body": "@youngseokjeon: this is indeed a popular use case. Another one is just a &quot;tagged union&quot;."}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 3, "creation_date": 1562493946, "post_id": 56920926, "comment_id": 100384761, "body": "You\u2019re just about to stumble across the fact that <code>Either String String</code> (a + a) is equivalent to <code>(Bool, String)</code> (2 &#215; a) in the algebra of Algebraic Data Types\u2014in both cases, there\u2019s a string tagged with whether it indicates an error or success"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 8, "last_activity_date": 1562493120, "creation_date": 1562493120, "answer_id": 56921062, "question_id": 56920926, "link": "https://stackoverflow.com/questions/56920926/what-is-the-use-of-either-type-constructor-in-hakell/56921062#56921062", "title": "what is the use of &quot;either&quot; type constructor in hakell", "body": "<p><code>Either</code> is a <a href=\"https://en.wikipedia.org/wiki/Tagged_union\" rel=\"noreferrer\"><em>tagged union</em> [wiki]</a>. It means it can take values from (in this case) two types. If <code>Code</code> is for example <em>not</em> a string, your function will need some sort of sum type. How will it otherwise communicate a <code>Code</code> or a <code>String</code>? <code>Either</code> is thus for example used in a list that can contain <code>Int</code>s and <code>String</code>s: <code>[Either Int String]</code>.</p>\n\n<p><code>Either</code> is frequently used to encapsulate a computation that could fail. The <code>Left</code> constructor then stores an error message/exception parameters, whereas the <code>Right</code> data constructor stores the result of a successful computation.</p>\n\n<p>This logic is encoded in the <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/src/Data.Either.html#line-155\" rel=\"noreferrer\"><code>instance Monad Either</code> [src]</a>, indeed:</p>\n\n<blockquote><pre><code>instance Monad (Either e) where\n    Left  l &gt;&gt;= _ = Left l\n    Right r &gt;&gt;= k = k r</code></pre></blockquote>\n\n<p>So here we can define a computation like:</p>\n\n<pre><code>some_computation :: Val<sub>1</sub> -> Either Err Val<sub>4</sub>\nsome_computation v<sub>1</sub> = do\n    v<sub>2</sub> &lt;- some_computation_that_can_fail<sub>1</sub> v<sub>1</sub>\n    v<sub>3</sub> &lt;- some_computation_that_can_fail<sub>1</sub> v<sub>2</sub>\n    some_computation_that_can_fail v<sub>2</sub> v<sub>3</sub></code></pre>\n\n<p>In this hypothetical example, the functions have as type <code>some_computation_that_can_fail<sub>1</sub> :: Val<sub>1</sub> -&gt; Either Err Val<sub>2</sub></code>, <code>some_computation_that_can_fail<sub>2</sub> :: Val<sub>2</sub> -&gt; Either Err Val<sub>3</sub></code> and <code>some_computation_that_can_fail<sub>1</sub> :: Val<sub>2</sub> -&gt; Val<sub>3</sub> -&gt; Either Err Val<sub>4</sub></code>.</p>\n\n<p>Here if <code>some_computation_that_can_fail<sub>1</sub> v<sub>1</sub></code> returns a <code>Left err</code>, then the <code>some_computation v<sub>1</sub></code> will return that <code>Left err</code>. If on the other hand, it returns a <code>Right result</code>, then <code>v<sub>2</sub></code> will access that result, and thus you can further process the <code>result</code> in the <code>some_computation_that_can_fail<sub>2</sub> v<sub>2</sub></code>, and so on.</p>\n"}], "owner": {"reputation": 136, "user_id": 11750068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5bfo27INeHw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcQi-WJomjZ4H810IlOkgJyfMERJg/photo.jpg?sz=128", "display_name": "youngseok jeon", "link": "https://stackoverflow.com/users/11750068/youngseok-jeon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1562515510, "creation_date": 1562491996, "last_edit_date": 1562515510, "question_id": 56920926, "link": "https://stackoverflow.com/questions/56920926/what-is-the-use-of-either-type-constructor-in-hakell", "title": "what is the use of &quot;either&quot; type constructor in hakell", "body": "<p>While studying haskell's type system, I came across the type constructor called \"Either\". One use case was the code below </p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import qualified Data.Map as Map  \n\ndata LockerState = Taken | Free deriving (Show, Eq)  \ntype Code = String  \ntype LockerMap = Map.Map Int (LockerState, Code)  \n\n\nlockerLookup :: Int -&gt; LockerMap -&gt; Either String Code  \nlockerLookup lockerNumber map =   \n    case Map.lookup lockerNumber map of   \n        Nothing            -&gt; Left $ \"Locker number \" \n                                ++ show lockerNumber ++ \" doesn't exist!\"  \n        Just (state, code) -&gt; if state /= Taken   \n                                then Right code  \n                                else Left $ \"Locker \" ++ show lockerNumber \n                                       ++ \" is already taken!\"  \n\n\nlockers :: LockerMap  \nlockers = Map.fromList   \n    [(100,(Taken,\"ZD39I\"))  \n    ,(101,(Free,\"JAH3I\"))  \n    ,(103,(Free,\"IQSA9\"))  \n    ,(105,(Free,\"QOTSA\"))  \n    ,(109,(Taken,\"893JJ\"))  \n    ,(110,(Taken,\"99292\"))  \n    ]  \n</code></pre>\n\n<p>with an example function call:</p>\n\n<pre><code>&gt; lockerLookup 101 lockers\n</code></pre>\n\n<p>I wonder why not just remove <code>Left</code> and <code>Right</code> value constructors. The code will still work fine while still being able to print out values we want.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 2, "creation_date": 1562479594, "post_id": 56915365, "comment_id": 100382047, "body": "Especially for beginners, I think it\u2019s worth noting that this is the same as <code>calcK x = show (calc x)</code>."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1562541615, "post_id": 56915365, "comment_id": 100395132, "body": "Right, I didn\u2019t see that."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1562441137, "last_edit_date": 1562441137, "creation_date": 1562426296, "answer_id": 56915365, "question_id": 56915280, "link": "https://stackoverflow.com/questions/56915280/how-to-change-the-function-signature/56915365#56915365", "title": "How to change the function signature", "body": "<p>The only problem is that you are trying to show the <code>calc</code> function, not its <em>result</em>.</p>\n\n<pre><code>calcK :: String -&gt; String\ncalcK = show . calc\n</code></pre>\n\n<p>You want to compose <code>show</code> and <code>calc</code>, letting <code>calc</code> produce a <code>[Double]</code> which is then passed to <code>show</code>.</p>\n"}], "owner": {"reputation": 6287, "user_id": 203175, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/cDYBi.jpg?s=128&g=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/203175/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 56915365, "answer_count": 1, "score": 2, "last_activity_date": 1562515672, "creation_date": 1562425618, "last_edit_date": 1562515672, "question_id": 56915280, "link": "https://stackoverflow.com/questions/56915280/how-to-change-the-function-signature", "title": "How to change the function signature", "body": "<p>I am a beginner to Haskell and is now trying to develop a postfix calculator.\nBelow is my code so far:</p>\n\n<pre><code>calcK :: String -&gt; String\ncalcK =  show calc\n\ncalc :: String -&gt; [Double]\ncalc = foldl interprete [] . words\n\ninterprete s x\n  | x `elem` [\"+\",\"-\",\"*\",\"/\",\"^\"] = operate x s\n  | x `elem` [\"inc\",\"dec\",\"sqrt\",\"sin\",\"cos\",\"inv\"] =  operate2 x s\n  | x `elem` [\"+all\"] =  [sum s]\n  | x `elem` [\"*all\"] =  [product s]\n  | otherwise = read x:s\n  where\n    operate op (x:y:s) = case op of\n      \"+\" -&gt; x + y:s\n      \"-\" -&gt; y - x:s\n      \"*\" -&gt; x * y:s\n      \"/\" -&gt; y / x:s\n      \"^\" -&gt; y ** x:s\n    operate2 op (x:s) = case op of\n      \"inc\" -&gt;1 + x:s\n      \"dec\" -&gt; (-1) + x:s\n      \"sqrt\" -&gt; sqrt x:s\n      \"sin\" -&gt; sin x:s\n      \"cos\" -&gt; cos x:s\n      \"inv\" -&gt; 1 / x:s\n</code></pre>\n\n<p>It works just for basic operations. However, I came to realize that I need to have the signature defined as</p>\n\n<pre><code>   String -&gt; String\n</code></pre>\n\n<p>not <code>String -&gt; [Double]</code>. So the calculation result for <code>\"1 2 +\"</code> should be </p>\n\n<pre><code>  \"[3.0]\"\n</code></pre>\n\n<p>instead of </p>\n\n<pre><code>   [3.0]\n</code></pre>\n\n<p>As you can see, I've tried to do a <code>show</code> at the top but it does not seem to be working. I've tried adding <code>show</code> to other places of the code but still no luck.</p>\n\n<p>Would be grateful if experts could offer some advice on this. Thanks in advance!</p>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1562423641, "post_id": 56911322, "comment_id": 100372810, "body": "There is no reason for <code>DivisibleBy</code> to be a subclass of <code>IsEven</code>. The <i>opposite</i> relation is reasonable, as is making the two classes independent. Just because using <code>divisibleBy</code> is <i>one</i> way to define <code>isEven</code> doesn&#39;t mean an <code>IsEven</code> instance should be <i>required</i>."}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 4991111, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207168442153952/picture?type=large", "display_name": "David Abrahams", "link": "https://stackoverflow.com/users/4991111/david-abrahams"}, "edited": false, "score": 0, "creation_date": 1562389772, "post_id": 56911369, "comment_id": 100366739, "body": "hm, but what if then there is some other type class which also has enough functionality to implement <code>isEven</code>? It seems like doing it this way requires the superclass to &quot;know about&quot; its subclass. In Scala, for example, you can subclass any typeclass and provide implementations for the superclasses methods. Eg, <code>Applicative</code> can implement <code>Functor</code>&#39;s <code>map</code> using <code>ap</code>: <a href=\"https://github.com/typelevel/cats/blob/master/core/src/main/scala/cats/Applicative.scala#L48\" rel=\"nofollow noreferrer\">github.com/typelevel/cats/blob/master/core/src/main/scala/ca&zwnj;&#8203;ts/&hellip;</a> Is there a way to achieve something similar in Haskell? In Scala, if there is an <code>Applicative</code> in scope, you get a <code>Functor</code> for free."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 161, "user_id": 4991111, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207168442153952/picture?type=large", "display_name": "David Abrahams", "link": "https://stackoverflow.com/users/4991111/david-abrahams"}, "edited": false, "score": 0, "creation_date": 1562389899, "post_id": 56911369, "comment_id": 100366751, "body": "@DavidAbrahams I don&#39;t believe that Haskell currently has any equivalent to that functionality."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": false, "score": 7, "last_activity_date": 1562389373, "creation_date": 1562389373, "answer_id": 56911369, "question_id": 56911322, "link": "https://stackoverflow.com/questions/56911322/how-to-extend-classes-in-haskell/56911369#56911369", "title": "How to &quot;extend&quot; classes in Haskell", "body": "<p>You can't redefine a method in a new class and have it affect the one in the old class. If you want methods to work like this, the parent class has to reference the child class.</p>\n\n<p>You need <a href=\"https://downloads.haskell.org/~ghc/8.6.5/docs/html/users_guide/glasgow_exts.html#extension-DefaultSignatures\" rel=\"noreferrer\">the <code>DefaultSignatures</code> extension</a> to make this work. Turn it on and then change your classes to this:</p>\n\n<pre><code>class IsEven a where\n  isEven :: a -&gt; Bool\n  default isEven :: DivisibleBy a =&gt; a -&gt; Bool\n  isEven a = divisibleBy a 2\n\nclass IsEven a =&gt; DivisibleBy a where\n  divisibleBy :: a -&gt; Int -&gt; Bool\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1562410962, "post_id": 56911377, "comment_id": 100369996, "body": "It might be worth it to explicitly note that the <code>liftM</code> idiom (in this case, defining <code>isEvenDivisible :: DivisibleBy a =&gt; a -&gt; Bool</code> for the sake of writing boilerplate <code>IsEven</code> instances) might make the Haskell 98 solution slightly more comfortable. (Ultimately, I guess, it is a matter of how many extra names is one willing to tolerate, versus how often one can stand rewriting the full boilerplate implementation.)"}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 13, "last_activity_date": 1562390200, "last_edit_date": 1562390200, "creation_date": 1562389582, "answer_id": 56911377, "question_id": 56911322, "link": "https://stackoverflow.com/questions/56911322/how-to-extend-classes-in-haskell/56911377#56911377", "title": "How to &quot;extend&quot; classes in Haskell", "body": "<p>As far as I know, the closest you can get in standard Haskell is</p>\n\n<pre><code>instance IsEven Int where\n  isEven n = n `divisibleBy` 2\n\ninstance DivisibleBy Int where\n  divisibleBy a i = a `mod` i == 0\n</code></pre>\n\n<p>You don't have to duplicate the logic (indeed, you can implement <code>isEven</code> in terms of <code>divisibleBy</code>), but you still need to provide an explicit definition.</p>\n\n<p>You would have to repeat this pattern for every type you want to make an instance of <code>DivisibleBy</code>.</p>\n\n<p>Using the <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#default-method-signatures\" rel=\"noreferrer\"><code>DefaultSignatures</code> language extension</a> you can also do the following:</p>\n\n<pre><code>{-# LANGUAGE DefaultSignatures #-}\n\nclass IsEven a where\n  isEven :: a -&gt; Bool\n  default isEven :: (DivisibleBy a) =&gt; a -&gt; Bool\n  isEven n = n `divisibleBy` 2\n\nclass (IsEven a) =&gt; DivisibleBy a where\n  divisibleBy :: a -&gt; Int -&gt; Bool\n\ninstance IsEven Int\ninstance DivisibleBy Int where\n  divisibleBy a i = a `mod` i == 0\n</code></pre>\n\n<p>This moves the default implementation to the class itself. Now you can indeed just say <code>instance IsEven Int</code> without providing an instance body. The disadvantage is that now <code>IsEven</code> has to know about <code>DivisibleBy</code>, and you can only provide one <code>default</code> implementation.</p>\n"}, {"comments": [{"owner": {"reputation": 161, "user_id": 4991111, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207168442153952/picture?type=large", "display_name": "David Abrahams", "link": "https://stackoverflow.com/users/4991111/david-abrahams"}, "edited": false, "score": 0, "creation_date": 1562449553, "post_id": 56913699, "comment_id": 100378445, "body": "Ah this is neat! I actually don&#39;t think we need <code>DivisibleBy</code> to extend <code>isEven</code> in this case, correct? (It compiles without it)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 161, "user_id": 4991111, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207168442153952/picture?type=large", "display_name": "David Abrahams", "link": "https://stackoverflow.com/users/4991111/david-abrahams"}, "edited": false, "score": 1, "creation_date": 1562450021, "post_id": 56913699, "comment_id": 100378521, "body": "@DavidAbrahams We don&#39;t, indeed. I have updated the answer to reflect that. (While here I&#39;m primarily dealing with the typeclass mechanics, <a href=\"https://stackoverflow.com/questions/56911322/how-to-extend-classes-in-haskell/56913699?noredirect=1#comment100372810_56911322\">chepner does have a point</a> about this specific example, so dropping the relationship looks like a net gain as far as this answer is concerned.)"}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1562682598, "post_id": 56913699, "comment_id": 100448056, "body": "I always wanted <code>unsafe via</code> to bypass the role system, it would use <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Unsafe-Coerce.html#v:unsafeCoerce\" rel=\"nofollow noreferrer\"><code>unsafeCoerce</code></a> instead of <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Coerce.html#v:coerce\" rel=\"nofollow noreferrer\"><code>coerce</code></a>"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 0, "creation_date": 1562688494, "post_id": 56913699, "comment_id": 100451629, "body": "@Iceland_jack Tangential question: will the <code>QuantifiedConstraints</code> approach discussed <a href=\"https://gitlab.haskell.org/ghc/ghc/issues/14070\" rel=\"nofollow noreferrer\">in this ticket</a> allow deriving <code>Traversable</code> and <code>Distributive</code>? Though I might well be reading the situation wrongly, it looks like that would demand coercing under an arbitrary functor that the instance implementer has no control over."}, {"owner": {"reputation": 3603, "user_id": 165806, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c889e0a95a3bb07f90ab28ad442f1127?s=128&d=identicon&r=PG", "display_name": "Iceland_jack", "link": "https://stackoverflow.com/users/165806/iceland-jack"}, "edited": false, "score": 1, "creation_date": 1562696293, "post_id": 56913699, "comment_id": 100455068, "body": "Not as smoothly as <code>join</code>, requires big changes but I think it is the best path forward, the <code>forall f a b. Applicative f =&gt;</code> quantification appears in the type of <code>traverse @t @f @a..</code>, we can only work with <code>t</code>. Either strengthen <code>Applicative f</code> with <code>Representational1</code> or decree all <code>Functor</code>s be representational in their first arg by making <code>class Representational1 f =&gt; Functor f</code> a superclass. Ryan explains better: <a href=\"https://ryanglscott.github.io/2018/06/22/quantifiedconstraints-and-the-trouble-with-traversable/\" rel=\"nofollow noreferrer\"><b><code>QuantifiedConstraints</code> and the trouble with <code>Traversable</code></b></a>."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 5, "last_activity_date": 1562450097, "last_edit_date": 1562450097, "creation_date": 1562412653, "answer_id": 56913699, "question_id": 56911322, "link": "https://stackoverflow.com/questions/56911322/how-to-extend-classes-in-haskell/56913699#56913699", "title": "How to &quot;extend&quot; classes in Haskell", "body": "<p>With GHC 8.6 and above, this can also be achieved through <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#deriving-via\" rel=\"nofollow noreferrer\"><code>DerivingVia</code></a>:</p>\n\n<pre><code>{-# LANGUAGE DerivingVia #-}\n{-# LANGUAGE GeneralisedNewtypeDeriving #-}\n{-# LANGUAGE StandaloneDeriving #-}\n\n-- Class definitions:\n\nclass IsEven a where\n  isEven :: a -&gt; Bool\n\n-- Note that we don't need to have IsEven as a superclass.\nclass DivisibleBy a where\n  divisibleBy :: a -&gt; Int -&gt; Bool\n\n\n-- Boilerplate that only needs to be written once:\n\n-- Boilerplate DivisibleBy instance generated with GeneralisedNewtypeDeriving.\nnewtype WrappedDivisibleBy a = WrapDivisibleBy { unwrapDivisibleBy :: a }\n  deriving DivisibleBy\n\ninstance DivisibleBy a =&gt; IsEven (WrappedDivisibleBy a) where\n  isEven n = n `divisibleBy` 2 \n\n\n-- Instance example:\n\ninstance DivisibleBy Int where\n  divisibleBy a i = a `mod` i == 0\n\n-- Boilerplate IsEven instance generated with DerivingVia \n-- (and StandaloneDeriving, as we aren't defining Int here).\nderiving via (WrappedDivisibleBy Int) instance IsEven Int\n</code></pre>\n\n<p><code>DerivingVia</code> is not always an option (in the case of classes like <code>Traversable</code>, which have an extra type constructor wrapping things in the type signature, it clashes with the role system); when it works, though, it is very neat.</p>\n"}], "owner": {"reputation": 161, "user_id": 4991111, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207168442153952/picture?type=large", "display_name": "David Abrahams", "link": "https://stackoverflow.com/users/4991111/david-abrahams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 872, "favorite_count": 0, "answer_count": 3, "score": 11, "last_activity_date": 1562450097, "creation_date": 1562388752, "last_edit_date": 1562444919, "question_id": 56911322, "link": "https://stackoverflow.com/questions/56911322/how-to-extend-classes-in-haskell", "title": "How to &quot;extend&quot; classes in Haskell", "body": "<p>I want to create two typeclasses, <code>A</code> and <code>B</code>, where <code>A</code> is a superclass of <code>B</code>. The functions defined in <code>B</code> are sufficient to implement those in <code>A</code>. Then, if I have a function with the constraint <code>fun :: (A thing) =&gt; ...</code> an instance of <code>B</code> for, say, <code>Int</code>, I'd like to be able to pass an <code>Int</code> to <code>fun</code> without creating a duplicate instance <code>A</code> for <code>Int</code>.</p>\n\n<p>For example, let's say I have a type class which can check if value is \"even\". Then, I have another type class which can check if a value is divisible by some number. The second type class is powerful enough to implement the functions in the first, and any function which only requires \"even-checking\" capabilities should be able to accept an argument which has \"divisible-by\" abilities.</p>\n\n<p>Here's what I think it would look like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class IsEven a where\n  isEven :: a -&gt; Bool\n\nclass (IsEven a) =&gt; DivisibleBy a where\n  divisibleBy :: a -&gt; Int -&gt; Bool\n  isEven :: a -&gt; Bool\n  isEven a = divisibleBy a 2\n\nprintIsEven :: (IsEven a) =&gt; a -&gt; IO ()\nprintIsEven a = putStrLn (show (IsEven.isEven a))\n\ninstance IsEven Int  -- I need to do this or I cannot create a DivisibleBy instance\ninstance DivisibleBy Int where\n  divisibleBy a i = a `mod` i == 0\n\nmyint :: Int\nmyint = 2\n\nmain :: IO ()\nmain = printIsEven myint\n</code></pre>\n\n<p>However, at compile time this produces the warning:</p>\n\n<pre><code>[2 of 2] Compiling Main             ( Foo.hs, Foo.o )\n\nFoo.hs:11:10: warning: [-Wmissing-methods]\n    \u2022 No explicit implementation for\n        \u2018IsEven.isEven\u2019\n    \u2022 In the instance declaration for \u2018IsEven Int\u2019\n   |\n11 | instance IsEven Int\n   |          ^^^^^^^^^^\nLinking Foo ...\n</code></pre>\n\n<p>and at runtime, the program fails:</p>\n\n<pre><code>Foo: Foo.hs:11:10-19: No instance nor default method for class operation isEven\n</code></pre>\n\n<p>How can I achieve this subtyping effect without duplicating logic into an <code>instance IsEven</code>?</p>\n"}, {"tags": ["haskell", "haskell-lens"], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 6, "last_activity_date": 1568301574, "last_edit_date": 1568301574, "creation_date": 1562381007, "answer_id": 56910834, "question_id": 56909497, "link": "https://stackoverflow.com/questions/56909497/lens-modifying-with-failure/56910834#56910834", "title": "Lens modifying with failure", "body": "<p>I don't see anything like that. <code>ASetter</code> is defined</p>\n\n<pre><code>type ASetter s t a b = (a -&gt; Identity b) -&gt; s -&gt; Identity t\n</code></pre>\n\n<p>so it's not powerful enough for the job (and <code>Setter</code> can't do it either). It turns out, on the other hand, that a <code>Lens</code> is a bit stronger than necessary. Let's consider, then, how to do it with a <code>Traversal</code>.</p>\n\n<pre><code>type Traversal s t a b =\n  forall f. Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t\n</code></pre>\n\n<p>So</p>\n\n<pre><code>Traversal s s a b =\n  forall f. Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f s\n</code></pre>\n\n<p>Which <code>Applicative</code> do we want? <code>m</code> seems like the obvious one to try. When we pass the traversal <code>a -&gt; m b</code>, we get back <code>s -&gt; m s</code>. Great! As usual for <code>lens</code>, we'll actually only require the user to provide an <code>ATraversal</code>, which we can clone.</p>\n\n<pre><code>modifyingM\n  :: MonadState s m\n  =&gt; ATraversal s s a b\n  -&gt; (a -&gt; m b) -&gt; m ()\nmodifyingM t f = do\n  s &lt;- get\n  s' &lt;- cloneTraversal t f s\n  put s'\n</code></pre>\n\n<p>That's nice because it only traverses the state once.</p>\n\n<p>Even that is overkill, really. The most natural thing is actually</p>\n\n<pre><code>modifyingM\n  :: MonadState s m\n  =&gt; LensLike m s s a b\n  -&gt; (a -&gt; m b) -&gt; m ()\nmodifyingM t f = do\n  s &lt;- get\n  s' &lt;- t f s\n  put s'\n</code></pre>\n\n<p>You can apply that directly to a <code>Traversal</code>, <code>Lens</code>, <code>Iso</code>, or <code>Equality</code>, or use <code>cloneTraversal</code>, <code>cloneLens</code>, <code>cloneIso</code>, or (in <code>lens-4.18</code> or later) <code>cloneEquality</code> to apply it to the monomorphic variants.</p>\n"}], "owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 56910834, "answer_count": 1, "score": 4, "last_activity_date": 1568301574, "creation_date": 1562362724, "last_edit_date": 1562367064, "question_id": 56909497, "link": "https://stackoverflow.com/questions/56909497/lens-modifying-with-failure", "title": "Lens modifying with failure", "body": "<p>In <code>Control.Lens.Lens</code>, there is a function</p>\n\n<pre><code>modifying :: MonadState s m =&gt; ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()\n</code></pre>\n\n<p>which allows the value under a lens on the <code>MonadState</code> state to be transformed by a pure function <code>(a -&gt; b)</code>.</p>\n\n<p>However, we may want to allow the transform function to fail in <code>m</code>, requiring it to have type <code>(a -&gt; m b)</code>.</p>\n\n<p>I've looked through the lens library for such a function, but I can't find one, so I implemented:</p>\n\n<pre><code>modifyingM l f = use l &gt;&gt;= f &gt;&gt;= assign l\n</code></pre>\n\n<p>Which does the trick, but I was wondering if there is a function already in the lens library that will do this.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 4, "last_activity_date": 1562362627, "creation_date": 1562362627, "answer_id": 56909486, "question_id": 56909466, "link": "https://stackoverflow.com/questions/56909466/how-to-create-data-out-of-two-other-data/56909486#56909486", "title": "How to create data out of two other data?", "body": "<p>Yes, you just got the syntax slightly wrong.</p>\n\n<p>Just write</p>\n\n<pre><code>data Card = Card CardValue Suit\n</code></pre>\n\n<p>instead (note that the second \"Card\" in the above code could also be called something else; The left side names the type, the right side is a name for <em>values</em> of type card), and then you can write your show instance as</p>\n\n<pre><code>instance Show Card where\n    show (Card v s) = show v ++ \" of \" ++ show s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "edited": false, "score": 0, "creation_date": 1562363098, "post_id": 56909496, "comment_id": 100363456, "body": "That is a good suggestion with the repr because I was just treating show as a sort of print function but this is much smarter."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 2, "last_activity_date": 1562362724, "creation_date": 1562362724, "answer_id": 56909496, "question_id": 56909466, "link": "https://stackoverflow.com/questions/56909466/how-to-create-data-out-of-two-other-data/56909496#56909496", "title": "How to create data out of two other data?", "body": "<p>Since you use <code>data</code> you define a new data type. You thus will need to specify a data constructor. You can <em>not</em> use the tuple data constructor <code>(,)</code> here.</p>\n\n<p>You thus can define:</p>\n\n<pre><code>data Card = <b>Card</b> CardValue Suit</code></pre>\n\n<p>Then you can for example implement an instance of <code>Show</code>:</p>\n\n<pre><code>instance Show Card where\n    show (Card v s) = show v ++ \" of \" ++ show s</code></pre>\n\n<p>That being said, <code>Show</code> is usually supposed to generate output that is Haskell code (so you can for example inject it back in the interpreter).</p>\n\n<p>It might be better to define a class:</p>\n\n<pre><code>class Representable a where\n    repr :: a -&gt; String</code></pre>\n\n<p>and thus implement this for <code>Card</code> as:</p>\n\n<pre><code>instance Representable Card where\n    repr (Card v s) = show v ++ \" of \" ++ show s</code></pre>\n"}], "owner": {"reputation": 657, "user_id": 11672176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RJ2UolcBU3Y/AAAAAAAAAAI/AAAAAAAABb4/PR3tZ6Jz7Bw/photo.jpg?sz=128", "display_name": "BryceTheGrand", "link": "https://stackoverflow.com/users/11672176/brycethegrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 56909486, "answer_count": 2, "score": 2, "last_activity_date": 1562362724, "creation_date": 1562362456, "question_id": 56909466, "link": "https://stackoverflow.com/questions/56909466/how-to-create-data-out-of-two-other-data", "title": "How to create data out of two other data?", "body": "<p>I am trying to make a Card data type. The problem I am having is that I currently have the cards set up as a \"CardValue\" and a \"Suit\" data type which are each separate, and then I was trying to make a \"Card\" data type that is essentially just (CardValue, Suit). I need the \"Card\" data to be data and not type so that I can make it an instance of show, but I do not know if this is possible the way I am doing this. Is there a way to make a single Card data that would have every possible card in a deck without going \"data Card = AceHeart | AceSpade | AceClub ... etc.\"?</p>\n\n<p>Here is what I have so far:</p>\n\n<pre><code>data CardValue = Ace | Two | Three\n               | Four | Five | Six \n               | Seven | Eight | Nine \n               | Ten | Jack | Queen \n               | King deriving (Bounded, Enum, Show, Eq, Ord)\n\ndata Suit = Clubs | Spades | Hearts | Diamonds deriving (Show, Eq)\n\ndata Card = (CardValue, Suit)\n\ninstance Show Card where\n    show (v, s) = show v ++ \" of \" ++ show s\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1562331397, "post_id": 56903126, "comment_id": 100351708, "body": "This looks basically as a <i>map/dictionary</i> if I understand it correctly?"}], "answers": [{"tags": [], "owner": {"reputation": 14543, "user_id": 235908, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rTstt.jpg?s=128&g=1", "display_name": "Simon Shine", "link": "https://stackoverflow.com/users/235908/simon-shine"}, "is_accepted": true, "score": 2, "last_activity_date": 1562333910, "creation_date": 1562333910, "answer_id": 56904182, "question_id": 56903126, "link": "https://stackoverflow.com/questions/56903126/how-to-convert-data-text-internal-text-data-text-internal-text-text/56904182#56904182", "title": "How to convert [(Data.Text.Internal.Text,Data.Text.Internal.Text)] -&gt; Text", "body": "<p>If I understand correctly, this list of pairs is meant to convert <code>\"ararat\"</code> into <code>\"Ararat\"</code> to compensate for the user's lack of Title Case, while the server you communicate with only accepts one capitalisation of a given city name.</p>\n\n<p>But I could be wrong in this understanding.</p>\n\n<p>You could use <a href=\"https://hackage.haskell.org/package/text/docs/Data-Text.html#v:toTitle\" rel=\"nofollow noreferrer\"><code>Data.Text.toTitle</code></a>:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>do cityFromUser &lt;- T.toTitle &lt;$&gt; TIO.getLine\n   ...\n</code></pre>\n\n<p>Since you're dealing with input sanitation, you may also want to <a href=\"https://hackage.haskell.org/package/text/docs/Data-Text.html#v:strip\" rel=\"nofollow noreferrer\"><code>T.strip</code></a> leading and trailing whitespace from what the user entered. With <code>T.toTitle</code> you could instead of a list of pairs use a <a href=\"http://hackage.haskell.org/package/containers/docs/Data-Set.html\" rel=\"nofollow noreferrer\"><code>Data.Set</code></a> of valid city names for the server:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import           Data.Set (Set)\nimport qualified Data.Set as Set\n\ntype CityName = Text\n\nvalidCityNames :: Set CityName\nvalidCityNames = Set.fromList\n  [ \"Aragatsotn\"\n  , \"Ararat\"\n  , \"Armavir\"\n  , \"Dilijan\"\n  , \"Gegharkunik\"\n  , \"Gyumri\"\n  , \"Kotayk\"\n  , \"Shirak\"\n  , \"Syunik\"\n  , \"Vanadzor\"\n  , \"Yerevan\"\n  , ...\n  ]\n\ngetValidCityNameFromUser :: IO (Maybe CityName)\ngetValidCityNameFromUser = do\n  cityNameFromUser &lt;- T.toTitle . T.strip &lt;$&gt; TIO.getLine\n  if Set.member cityNameFromUser validCityNames\n    then return (Just cityNameFromUser)\n    else do\n      TIO.putStrLn $ messageErrorWrongCity phrasesForUser\n      exitFailure\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 8109702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46bbf7a408772a1409342f01f864d00?s=128&d=identicon&r=PG&f=1", "display_name": "Ashot Bes", "link": "https://stackoverflow.com/users/8109702/ashot-bes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 56904182, "answer_count": 1, "score": -1, "last_activity_date": 1562333910, "creation_date": 1562329915, "last_edit_date": 1562332679, "question_id": 56903126, "link": "https://stackoverflow.com/questions/56903126/how-to-convert-data-text-internal-text-data-text-internal-text-text", "title": "How to convert [(Data.Text.Internal.Text,Data.Text.Internal.Text)] -&gt; Text", "body": "<p>I make a weather program whose essence is very simple: the user enters the language in which the program will work, the city and date, and then I check it all. But when the user enters the correct city but with a small letter, the program gives an error, although the city is entered correctly </p>\n\n<p>I now about <code>toLower</code> function, but i can't use it because of i get a pair of cities in type <code>[(Text,Text)]</code></p>\n\n<pre><code>    let pairsOfCityNames  = [ let names = T.splitOn (\",\") twoNames\n                                    [nameForHuman, nameForServer] = L.filter (not . T.null) (names)\n                               in (nameForHuman, nameForServer)\n                             | twoNames &lt;- cityNames \n                             ]\n          (allNamesForHumans, _) = unzip pairsOfCityNames\n</code></pre>\n\n<p>And i get something like:</p>\n\n<pre><code>[ (\"Aragatsotn\", \"Aragatsotn\")\n, (\"Ararat\", \"Ararat\")\n, (\"Armavir\", \"Armavir\")\n, (\"Dilijan\", \"Dilijan\")\n, (\"Gegharkunik\", \"Gegharkunik\")\n, (\"Gyumri\", \"Gyumri\")\n, (\"Kotayk\", \"Kotayk\")\n, (\"Shirak\", \"Shirak\")\n, (\"Syunik\", \"Syunik\")\n, (\"Vanadzor\", \"Vanadzor\")\n, (\"Yerevan\", \"Yerevan\")\n]\n</code></pre>\n\n<p>I want when the user enters the correct city but with a small letter, the program works</p>\n\n<p>And how i check it: </p>\n\n<pre><code>  cityFromUser &lt;- TIO.getLine\n  let lovercaseForCity = T.toLower cityFromUser\n  cityNameForServer &lt;- case L.lookup lovercaseForCity pairsOfCityNames of \n        Nothing -&gt; do\n            TIO.putStrLn $ messageErrorWrongCity phrasesForUser\n            exitFailure \n        Just cityNameForServer -&gt; return cityNameForServer\n    TIO.putStrLn cityNameForServer \n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 3, "creation_date": 1562333359, "post_id": 56898610, "comment_id": 100352755, "body": "I don&#39;t see any problem with it. <code>Main</code> is a module, just one that the runtime looks for."}], "answers": [{"tags": [], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "is_accepted": false, "score": 1, "last_activity_date": 1562334936, "last_edit_date": 1562334936, "creation_date": 1562318784, "answer_id": 56900258, "question_id": 56898610, "link": "https://stackoverflow.com/questions/56898610/best-way-to-test-functions-defined-in-main-hs/56900258#56900258", "title": "Best way to test functions defined in Main.hs?", "body": "<p>In order to test functions, you need to put them inside your library, not executable. So in your <code>test-suite</code> you can depend on your library and test it. If you don't want to expose this function as a part of your public interface, you can introduce an <a href=\"https://www.haskell.org/cabal/users-guide/developing-packages.html#sublibs\" rel=\"nofollow noreferrer\">internal library</a>.</p>\n\n<p>Similar questions:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/51220260/how-should-i-go-about-testing-a-monolithic-executable-package/51220392#51220392\">How should I go about testing a monolithic executable package?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/48227751/depend-on-test-from-bench\">Depend on test from bench</a></li>\n</ul>\n"}], "owner": {"reputation": 1185, "user_id": 3228230, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/m9lny.jpg?s=128&g=1", "display_name": "paperduck", "link": "https://stackoverflow.com/users/3228230/paperduck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1562334936, "creation_date": 1562312320, "last_edit_date": 1562326126, "question_id": 56898610, "link": "https://stackoverflow.com/questions/56898610/best-way-to-test-functions-defined-in-main-hs", "title": "Best way to test functions defined in Main.hs?", "body": "<p>I'm setting up some <a href=\"https://hspec.github.io/getting-started.html\" rel=\"nofollow noreferrer\">Hspec</a> test cases for my Haskell program. It looks like I import the functions I want, then write test functions for each one. </p>\n\n<p>Although I have extracted some of my utility functions, I still have functions defined in <code>Main.hs</code>. When I write the test module(s), is it okay to do named imports directly from <code>Main.hs</code>?</p>\n\n<p>Export from <code>Main.hs</code>:</p>\n\n<pre><code>module Main \n(main                                                                                                                                                                                                 \n,awesomeFunction\n)where\n</code></pre>\n\n<p>Import into <code>MyTests.hs</code>:</p>\n\n<pre><code>import Main\n\n-- test for `awesomeFunction` goes here\n</code></pre>\n\n<p>It just doesn't feel like \"best practice\".</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1326, "user_id": 6092420, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/24e00c77fc8fc5f977da388a142bf9a6?s=128&d=identicon&r=PG&f=1", "display_name": "absolutelydevastated", "link": "https://stackoverflow.com/users/6092420/absolutelydevastated"}, "edited": false, "score": 0, "creation_date": 1562287479, "post_id": 56895331, "comment_id": 100336799, "body": "Where is the function type declaration for your method?"}, {"owner": {"reputation": 137, "user_id": 4254882, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dxet2.png?s=128&g=1", "display_name": "jackrabbithanna", "link": "https://stackoverflow.com/users/4254882/jackrabbithanna"}, "reply_to_user": {"reputation": 1326, "user_id": 6092420, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/24e00c77fc8fc5f977da388a142bf9a6?s=128&d=identicon&r=PG&f=1", "display_name": "absolutelydevastated", "link": "https://stackoverflow.com/users/6092420/absolutelydevastated"}, "edited": false, "score": 0, "creation_date": 1562288896, "post_id": 56895331, "comment_id": 100336967, "body": "There is none. Should there be? Starting with the simplest possible and working my way up."}, {"owner": {"reputation": 1326, "user_id": 6092420, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/24e00c77fc8fc5f977da388a142bf9a6?s=128&d=identicon&r=PG&f=1", "display_name": "absolutelydevastated", "link": "https://stackoverflow.com/users/6092420/absolutelydevastated"}, "edited": false, "score": 0, "creation_date": 1562289346, "post_id": 56895331, "comment_id": 100337023, "body": "Iirc there should be one. Like <code>hypothenuse :: Floating -&gt; Floating -&gt; Floating</code>"}, {"owner": {"reputation": 137, "user_id": 4254882, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dxet2.png?s=128&g=1", "display_name": "jackrabbithanna", "link": "https://stackoverflow.com/users/4254882/jackrabbithanna"}, "reply_to_user": {"reputation": 1326, "user_id": 6092420, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/24e00c77fc8fc5f977da388a142bf9a6?s=128&d=identicon&r=PG&f=1", "display_name": "absolutelydevastated", "link": "https://stackoverflow.com/users/6092420/absolutelydevastated"}, "edited": false, "score": 0, "creation_date": 1562290471, "post_id": 56895331, "comment_id": 100337195, "body": "Using this Atom editor, with several haskell plugins. When I over over it, it shows me: hypotenuse :: Floating a =&gt; a -&gt; a -&gt; a  now hypotenuse :: Floating x =&gt; x -&gt; x -&gt; x works just as well, however hypothenuse :: Floating -&gt; Floating -&gt; Floating shows an error"}, {"owner": {"reputation": 1326, "user_id": 6092420, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/24e00c77fc8fc5f977da388a142bf9a6?s=128&d=identicon&r=PG&f=1", "display_name": "absolutelydevastated", "link": "https://stackoverflow.com/users/6092420/absolutelydevastated"}, "edited": false, "score": 0, "creation_date": 1562292921, "post_id": 56895331, "comment_id": 100337560, "body": "Perhaps there&#39;s some syntax issues. Anyway, if you&#39;re trying to learn functional programming, calling built-in functions isn&#39;t the best way to go about doing it. You want to work with pattern matching, recursion, folds and all. Good luck!"}, {"owner": {"reputation": 137, "user_id": 4254882, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dxet2.png?s=128&g=1", "display_name": "jackrabbithanna", "link": "https://stackoverflow.com/users/4254882/jackrabbithanna"}, "reply_to_user": {"reputation": 1326, "user_id": 6092420, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/24e00c77fc8fc5f977da388a142bf9a6?s=128&d=identicon&r=PG&f=1", "display_name": "absolutelydevastated", "link": "https://stackoverflow.com/users/6092420/absolutelydevastated"}, "edited": false, "score": 0, "creation_date": 1562296117, "post_id": 56895331, "comment_id": 100338030, "body": "@peer helped me out good...Thanks everyone. <a href=\"https://github.com/jackrabbithanna/haskell-pythagorean-theorem\" rel=\"nofollow noreferrer\">github.com/jackrabbithanna/haskell-pythagorean-theorem</a>"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1562341511, "post_id": 56895331, "comment_id": 100356700, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/1970484/no-instance-for-floating-int\">No instance for (Floating Int)</a>"}, {"owner": {"reputation": 137, "user_id": 4254882, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dxet2.png?s=128&g=1", "display_name": "jackrabbithanna", "link": "https://stackoverflow.com/users/4254882/jackrabbithanna"}, "edited": false, "score": 0, "creation_date": 1562386392, "post_id": 56895331, "comment_id": 100366468, "body": "Obviously the question I asked is more than No instance for (Floating int) ... if someone was searching for the question asked in the title, they would get the answer straight away.."}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 4254882, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dxet2.png?s=128&g=1", "display_name": "jackrabbithanna", "link": "https://stackoverflow.com/users/4254882/jackrabbithanna"}, "edited": false, "score": 0, "creation_date": 1562291352, "post_id": 56895355, "comment_id": 100337305, "body": "Thank you! You helped me figure out my first Haskell program! In high school I wrote an numerical expression evaluator with order of operations and parentheses, in C, with recursion, with 100 lines of code or something . My goal is to reason out the shortest code way to do that in Haskell as a way to learn."}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "reply_to_user": {"reputation": 137, "user_id": 4254882, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dxet2.png?s=128&g=1", "display_name": "jackrabbithanna", "link": "https://stackoverflow.com/users/4254882/jackrabbithanna"}, "edited": false, "score": 0, "creation_date": 1562299530, "post_id": 56895355, "comment_id": 100338571, "body": "@jackrabbithanna If that\u2019s your goal, then it may be of use to you to have a look at the <code>megaparsec</code> library for parsing, along with <a href=\"https://markkarpov.com/learn-haskell.html#megaparsec-tutorials\" rel=\"nofollow noreferrer\">its tutorials</a>. Haskell has lots of libraries for this sort of thing \u2014 you\u2019ll almost certainly be able to write that program in &lt;100 lines in Haskell."}], "tags": [], "owner": {"reputation": 2966, "user_id": 3014199, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=128&d=identicon&r=PG", "display_name": "peer", "link": "https://stackoverflow.com/users/3014199/peer"}, "is_accepted": true, "score": 6, "last_activity_date": 1562287925, "last_edit_date": 1562287925, "creation_date": 1562287423, "answer_id": 56895355, "question_id": 56895331, "link": "https://stackoverflow.com/questions/56895331/how-to-input-two-integers-from-command-line-and-return-square-root-of-sum-of-squ/56895355#56895355", "title": "How to input two integers from command line and return square root of sum of squares", "body": "<p><code>sqrt</code> expects input of type class <code>Floating</code> but you provide <code>Int</code>s which do not instantiate <code>Floating</code>.\nIn ghci you can see the type signature of <code>sqrt</code> with <code>:t sqrt</code>. It is <code>sqrt :: Floating a =&gt; a -&gt; a</code>.<br>\n<code>Int</code> implements several type classes as can be seen with <code>:info Int</code>:</p>\n\n<pre><code>instance Eq Int -- Defined in \u2018GHC.Classes\u2019\ninstance Ord Int -- Defined in \u2018GHC.Classes\u2019\ninstance Show Int -- Defined in \u2018GHC.Show\u2019\ninstance Read Int -- Defined in \u2018GHC.Read\u2019\ninstance Enum Int -- Defined in \u2018GHC.Enum\u2019\ninstance Num Int -- Defined in \u2018GHC.Num\u2019\ninstance Real Int -- Defined in \u2018GHC.Real\u2019\ninstance Integral Int -- Defined in \u2018GHC.Real\u2019\ninstance Bounded Int -- Defined in \u2018GHC.Enum\u2019\n</code></pre>\n\n<p>but <code>Floating</code> is not among them.<br>\nTry <code>read</code>ing as <code>Double</code> or converting the <code>Int</code>s with <code>fromIntegral</code>.</p>\n\n<p>Both ways in the code:</p>\n\n<pre><code>module Main where\n\nhypotenuse a b = sqrt $ a * a + b * b\nmain :: IO ()\nmain = do\n  input1 &lt;- getLine\n  input2 &lt;- getLine\n  let a = read input1 :: Double\n  let b = read input2 :: Int\n  print $ hypotenuse a (fromIntegral b)\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 4254882, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dxet2.png?s=128&g=1", "display_name": "jackrabbithanna", "link": "https://stackoverflow.com/users/4254882/jackrabbithanna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 56895355, "answer_count": 1, "score": 2, "last_activity_date": 1562338549, "creation_date": 1562287015, "last_edit_date": 1562338549, "question_id": 56895331, "link": "https://stackoverflow.com/questions/56895331/how-to-input-two-integers-from-command-line-and-return-square-root-of-sum-of-squ", "title": "How to input two integers from command line and return square root of sum of squares", "body": "<p>I'm trying to start learning Haskell. I want to enter two numbers from the command line and and return the sqrt root of the sum of the square of each number. This is the Pythagorean Theorem</p>\n\n<p>Surely I thought I'd find an example somewhere, so I could wrap my head around taking some input, passing the input to a function, returning it, and printing the result out. Trying to work through this simple case. PHP / Javascript programmer, wanting to learn functional programming, so like I'm learning Martian at this point. Sorry if this question's been asked or is too simple. Surely I'm close, but I don't understand what I'm missing. I understand the sqrt would return a floating point number.</p>\n\n<pre><code>module Main where\n\nhypotenuse a b = sqrt $ a * a + b * b\nmain :: IO ()\nmain = do\n  input1 &lt;- getLine\n  input2 &lt;- getLine\n  let a = read input1 :: Int\n  let b = read input2 :: Int\n  print $ hypotenuse a b\n</code></pre>\n\n<p>This returns an error:</p>\n\n<blockquote>\n  <p>No instance for (Floating Int) arising from a use of \u2018hypotenuse',\n  line 10, character 11</p>\n</blockquote>\n\n<p>the 'h' in hypotenuse is highlighted in my Atom editor IDE. with the ghc-mod plugin to check.</p>\n\n<p>UPDATE:\n@peers answer solved my problem ...</p>\n\n<p>Thanks stackoverflow.com, my first haskell program <a href=\"https://github.com/jackrabbithanna/haskell-pythagorean-theorem\" rel=\"nofollow noreferrer\">https://github.com/jackrabbithanna/haskell-pythagorean-theorem</a></p>\n"}, {"tags": ["haskell", "hspec"], "answers": [{"comments": [{"owner": {"reputation": 26441, "user_id": 202168, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/481f8ec4fe0149f2b3851eee91c23b8e?s=128&d=identicon&r=PG", "display_name": "Anentropic", "link": "https://stackoverflow.com/users/202168/anentropic"}, "edited": false, "score": 0, "creation_date": 1562317072, "post_id": 56895969, "comment_id": 100344850, "body": "Thank you very much, that fixed it! (I would never have guessed, it seemed obvious that <code>Test.Hspec.Discover</code> would be part of <code>hspec-discover</code>)"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 2, "last_activity_date": 1562295096, "creation_date": 1562295096, "answer_id": 56895969, "question_id": 56894959, "link": "https://stackoverflow.com/questions/56894959/could-not-find-module-test-hspec-discover/56895969#56895969", "title": "Could not find module \u2018Test.Hspec.Discover\u2019", "body": "<p>Doing a <a href=\"https://www.stackage.org/lts-13.27/hoogle?q=Test.Hspec.Discover\" rel=\"nofollow noreferrer\">Hoogle search</a> for that module name shows that it is in hspec, not hspec-discover. Please try adding a test suite dependency on hspec.</p>\n"}], "owner": {"reputation": 26441, "user_id": 202168, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/481f8ec4fe0149f2b3851eee91c23b8e?s=128&d=identicon&r=PG", "display_name": "Anentropic", "link": "https://stackoverflow.com/users/202168/anentropic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 529, "favorite_count": 0, "accepted_answer_id": 56895969, "answer_count": 1, "score": -1, "last_activity_date": 1562295096, "creation_date": 1562281410, "question_id": 56894959, "link": "https://stackoverflow.com/questions/56894959/could-not-find-module-test-hspec-discover", "title": "Could not find module \u2018Test.Hspec.Discover\u2019", "body": "<p>I am a noob.</p>\n\n<p>I have tried to copy and paste a single Hspec/QuickCheck test out of a bigger project into my own so I can tweak it and see how it behaves.</p>\n\n<p>I have a structure like:</p>\n\n<pre><code>myproject/test/Spec.hs\nmyproject/test/mytest.hs\n</code></pre>\n\n<p>Copying from the other project my <code>Spec.hs</code> just has:</p>\n\n<pre><code>{-# OPTIONS_GHC -F -pgmF hspec-discover #-}\n</code></pre>\n\n<p>This is exactly the same as the example shown in the docs: <a href=\"http://hspec.github.io/hspec-discover.html\" rel=\"nofollow noreferrer\">http://hspec.github.io/hspec-discover.html</a></p>\n\n<p>Additionally I have in my <code>package.yml</code>:</p>\n\n<pre><code>tests:\n  myproject-test:\n    main:                Spec.hs\n    source-dirs:         test\n    ghc-options:\n    - -threaded\n    - -rtsopts\n    - -with-rtsopts=-N\n    dependencies:\n    - myproject\n    - QuickCheck\n    - hspec-megaparsec\n    - hspec-discover\n</code></pre>\n\n<p>When I run <code>stack test</code> I get the following error:</p>\n\n<pre><code>$ stack test\nhspec-discover  &gt; configure\nhspec-discover  &gt; Configuring hspec-discover-2.6.1...\nhspec-discover  &gt; build\nhspec-discover  &gt; Preprocessing library for hspec-discover-2.6.1..\nhspec-discover  &gt; Building library for hspec-discover-2.6.1..\nhspec-discover  &gt; [1 of 4] Compiling Paths_hspec_discover\nhspec-discover  &gt; [2 of 4] Compiling Test.Hspec.Discover.Config\nhspec-discover  &gt; [3 of 4] Compiling Test.Hspec.Discover.Sort\nhspec-discover  &gt; [4 of 4] Compiling Test.Hspec.Discover.Run\nhspec-discover  &gt; Preprocessing executable 'hspec-discover' for hspec-discover-2.6.1..\nhspec-discover  &gt; Building executable 'hspec-discover' for hspec-discover-2.6.1..\nhspec-discover  &gt; [1 of 2] Compiling Main\nhspec-discover  &gt; [2 of 2] Compiling Paths_hspec_discover\nhspec-discover  &gt; Linking .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/hspec-discover/hspec-discover ...\nhspec-discover  &gt; copy/register\nhspec-discover  &gt; Installing library in /Users/anentropic/.stack/snapshots/x86_64-osx/9ea21a5325b81a2dfa4286ce80451092e847f54dde50f04e1f7e952425f2d334/8.6.5/lib/x86_64-osx-ghc-8.6.5/hspec-discover-2.6.1-GcEMs7l4z3NWJQPD5eMXU\nhspec-discover  &gt; Installing executable hspec-discover in /Users/anentropic/.stack/snapshots/x86_64-osx/9ea21a5325b81a2dfa4286ce80451092e847f54dde50f04e1f7e952425f2d334/8.6.5/bin\nhspec-discover  &gt; Registering library for hspec-discover-2.6.1..\nBuilding all executables for `myproject' once. After a successful build of all of them, only specified executables will be rebuilt.\nmyproject&gt; configure (lib + exe + test)\nConfiguring myproject-0.1.0.0...\nmyproject&gt; build (lib + exe + test)\nPreprocessing library for myproject-0.1.0.0..\nBuilding library for myproject-0.1.0.0..\n[1 of 2] Compiling Lib\n[2 of 2] Compiling Paths_waterloo_haskell\nPreprocessing executable 'myproject-exe' for myproject-0.1.0.0..\nBuilding executable 'myproject-exe' for myproject-0.1.0.0..\n[1 of 2] Compiling Main\n[2 of 2] Compiling Paths_waterloo_haskell\nLinking .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/myproject-exe/myproject-exe ...\nPreprocessing test suite 'myproject-test' for myproject-0.1.0.0..\nBuilding test suite 'myproject-test' for myproject-0.1.0.0..\n[1 of 2] Compiling Main\n\n/Users/anentropic/Documents/Dev/Personal/waterloo/myproject/test/Spec.hs:3:1: error:\n    Could not find module \u2018Test.Hspec.Discover\u2019\n    Perhaps you meant\n      Test.Hspec.Discover.Run (from hspec-discover-2.6.1)\n      Test.Hspec.Discover.Sort (from hspec-discover-2.6.1)\n    Use -v to see a list of the files searched for.\n\n\n--  While building package myproject-0.1.0.0 using:\n      /Users/anentropic/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-osx/Cabal-2.4.0.1 build lib:myproject exe:myproject-exe test:myproject-test --ghc-options \" -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\nProgress 2/3\n</code></pre>\n\n<p>There's a lot I don't understand. But the main puzzle here is the output appears to show that <code>hspec-discover-2.6.1</code> was successfully installed.</p>\n\n<p>I have not written <code>Test.Hspec.Discover</code> anywhere in my bits of code so I have to assume the error comes from <code>{-# OPTIONS_GHC -F -pgmF hspec-discover #-}</code> (also the error message points to <code>Spec.hs</code> as the source).</p>\n\n<p>Um, what am I doing wrong? <code>hspec-discover</code> can't find itself?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 2, "creation_date": 1562255034, "post_id": 56891178, "comment_id": 100329075, "body": "You need to install <code>xz</code>, for example with <code>brew install xz</code>."}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 5, "last_activity_date": 1562255302, "creation_date": 1562255302, "answer_id": 56891239, "question_id": 56891178, "link": "https://stackoverflow.com/questions/56891178/couldnt-install-ghcup-installer-for-haskell-on-my-macos-machine/56891239#56891239", "title": "Couldn&#39;t install ghcup installer for Haskell on my MacOS machine", "body": "<p><a href=\"https://en.wikipedia.org/wiki/Xz\" rel=\"noreferrer\"><strong><code>xz</code></strong> [wiki]</a> is a (de)compression tool. It is sometimes used to send data in a compressed form over a network.</p>\n\n<p>You can install <code>xz</code> on a Mac OS X system with:</p>\n\n<pre><code>brew install xz\n</code></pre>\n\n<p>Given of course you first <a href=\"https://brew.sh/\" rel=\"noreferrer\">installed <code>brew</code> on your machine [brew.sh]</a>.</p>\n"}], "owner": {"reputation": 452, "user_id": 8466844, "user_type": "registered", "profile_image": "https://graph.facebook.com/479986619048559/picture?type=large", "display_name": "Nam V. Do", "link": "https://stackoverflow.com/users/8466844/nam-v-do"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1410, "favorite_count": 0, "accepted_answer_id": 56891239, "answer_count": 1, "score": 3, "last_activity_date": 1562255302, "creation_date": 1562255005, "question_id": 56891178, "link": "https://stackoverflow.com/questions/56891178/couldnt-install-ghcup-installer-for-haskell-on-my-macos-machine", "title": "Couldn&#39;t install ghcup installer for Haskell on my MacOS machine", "body": "<p>Currently, I'm trying to learn pure functional programming language, which is Haskell. I'm trying to install Haskell compiler, I have followed the instructions to install <code>ghcup</code> on my MacOS by following command: \n<code>curl https://get-ghcup.haskell.org -sSf | sh</code>\nBut I couldn't install it, it prompted errors like these: </p>\n\n<p><code>Following commands are required, but missing, please install:  xz\n\"ghcup upgrade\" failed!</code></p>\n\n<p><code>Following commands are required, but missing, please install:  xz</code></p>\n\n<p>I hope somebody picks up this question and helps me get this out, thanks a lot.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1562231878, "post_id": 56883596, "comment_id": 100316536, "body": "<code>where read = Atom</code>... more probably <code>readsPrec</code> because <code>read</code> is not visible method of &#39;Read&#39;. OK, utility is not to put such value to the console/file but to read string/line without quotes, so it seems strange that Haskell has not such type, it&#39;s typical for most FP languages, except Haskell"}], "tags": [], "owner": {"reputation": 1275, "user_id": 11571245, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vkCkX.png?s=128&g=1", "display_name": "typedfern", "link": "https://stackoverflow.com/users/11571245/typedfern"}, "is_accepted": false, "score": 3, "last_activity_date": 1562228549, "creation_date": 1562228549, "answer_id": 56883596, "question_id": 56883287, "link": "https://stackoverflow.com/questions/56883287/is-any-atom-data-type-in-haskell/56883596#56883596", "title": "Is any Atom data type in Haskell?", "body": "<p>Since <code>Read</code> and <code>Show</code> are for converting data to/from strings, you can just use the <code>id</code> function :)</p>\n\n<p>But seriously, a String is already the output of its own <code>read</code> or <code>show</code>, if you don't want it quoted.</p>\n\n<p>Say, for example, to print any other value (or a String, if you want it to appear quoted), you do:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>putStrLn (show \"Hello\") -- prints \"Hello\", with quotes.\n</code></pre>\n\n<p>whereas, to print a string unquoted, you can simply do:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>putStrLn \"Hello\" -- prints Hello, unquoted.\n</code></pre>\n\n<p>Because of this, I don't think there is any utility for this (it is trivial, after all); in fact, your Atom instances would simply be:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Read Atom where read = Atom\ninstance Show Atom where show (Atom s) = s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1562232045, "post_id": 56884482, "comment_id": 100316628, "body": "hm, may be you are write about &quot;always yield valid Haskell code&quot;. But if I need to read anything which can be read PLUS such atom, if I&#39;ll follow those requirement then I should create own type class or to produce other boilerplate code... Interesting dilemma."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "edited": false, "score": 0, "creation_date": 1562232312, "post_id": 56884482, "comment_id": 100316785, "body": "Well, if you know you&#39;ll have <code>String</code> values then you don&#39;t need any typeclass at all, just pass the strings right away. If you have values of different type and want to display them really compactly, then <code>String</code> as the output type is likely not practical anyway, you should look into something that generates HTML or LaTeX."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 6, "last_activity_date": 1562231541, "creation_date": 1562231541, "answer_id": 56884482, "question_id": 56883287, "link": "https://stackoverflow.com/questions/56883287/is-any-atom-data-type-in-haskell/56884482#56884482", "title": "Is any Atom data type in Haskell?", "body": "<p><strong>No.</strong> If you find yourself wanting this, it means you're using <code>Show</code> in an unintended way. The idea of <code>show</code> is that is should <em>always yield valid Haskell code</em>. The <code>Show String</code> instance guarantees this, by safely quoting and escaping the contents. Short of that, you would of course in general <em>not</em> get Haskell code. Now, sure there are applications where you want to display something and don't care about whether it's Haskell code, but that shouldn't be <code>show</code> then.</p>\n\n<p>Usually, if you have a string anyway, you should just use <code>putStrLn</code> directly.</p>\n"}, {"tags": [], "owner": {"reputation": 516, "user_id": 8909756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3da2f45be132bea17b96c011c36b1013?s=128&d=identicon&r=PG&f=1", "display_name": "Steven Fontanella", "link": "https://stackoverflow.com/users/8909756/steven-fontanella"}, "is_accepted": false, "score": 0, "last_activity_date": 1613377425, "creation_date": 1613377425, "answer_id": 66204710, "question_id": 56883287, "link": "https://stackoverflow.com/questions/56883287/is-any-atom-data-type-in-haskell/66204710#66204710", "title": "Is any Atom data type in Haskell?", "body": "<p>Depending on what you're doing, you may want to inspect the type and use <code>print</code> for non-strings and <code>putStrLn</code> for strings like this:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Typeable\n\nprintAny :: (Show a, Typeable a) =&gt; a -&gt; IO ()\nprintAny a = case cast a of\n  Just str -&gt; putStrLn str\n  Nothing  -&gt; print a\n</code></pre>\n<p>Then, as desired:</p>\n<pre><code>*Main&gt; printAny &quot;no quotes&quot;\nno quotes\n*Main&gt; printAny (10 :: Int)\n10\n</code></pre>\n"}], "owner": {"reputation": 2196, "user_id": 1980863, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a9248211c4148f5d7df2269aa711e2e?s=128&d=identicon&r=PG", "display_name": "RandomB", "link": "https://stackoverflow.com/users/1980863/randomb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 56884482, "answer_count": 3, "score": 0, "last_activity_date": 1613377425, "creation_date": 1562227301, "question_id": 56883287, "link": "https://stackoverflow.com/questions/56883287/is-any-atom-data-type-in-haskell", "title": "Is any Atom data type in Haskell?", "body": "<p>When I read/show <code>String</code> I get/expect the result to be quoted. If I want to omit quotes, I can implement some type like:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Atom = Atom String deriving (Eq, Ord)\ninstance Read Atom where ...\ninstance Show Atom where ...\n</code></pre>\n\n<p>But my question is: does such type already exist somewhere in libraries, in the base, may be? I just found some <code>Data.Atom</code> but seems it something different (XML, etc).</p>\n"}, {"tags": ["haskell", "parsec", "megaparsec"], "comments": [{"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 1, "creation_date": 1562201474, "post_id": 56879365, "comment_id": 100307328, "body": "It&#39;s possible, but it needs <i>far</i> more information than you&#39;ve provided. Can you ask a concrete question? Something along the lines of &quot;this is a small self-contained representative of the code I&#39;m having trouble with, these are the exact problems I&#39;m having.&quot;"}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "edited": false, "score": 1, "creation_date": 1562231016, "post_id": 56879365, "comment_id": 100316042, "body": "You could parse raw syntax &amp; have a typechecking phase afterwards."}, {"owner": {"reputation": 205, "user_id": 9725978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e07d302414b4f9bcd4aa5face22e07e1?s=128&d=identicon&r=PG", "display_name": "Mark Wildon", "link": "https://stackoverflow.com/users/9725978/mark-wildon"}, "edited": false, "score": 0, "creation_date": 1562261083, "post_id": 56879365, "comment_id": 100331108, "body": "One simple way to do it is to make String an instance of the Num class and define the class method (+) to be (++). But then the compiler will expect implementations of all the methods of Num. Also a quick test showed that you need to turn on &#39;Flexible Instances&#39;. I&#39;m not an expert, but it feels very unnatural to me."}], "answers": [{"tags": [], "owner": {"reputation": 34158, "user_id": 7203016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ybAMw.png?s=128&g=1", "display_name": "K. A. Buhr", "link": "https://stackoverflow.com/users/7203016/k-a-buhr"}, "is_accepted": false, "score": 1, "last_activity_date": 1562267972, "creation_date": 1562267972, "answer_id": 56893338, "question_id": 56879365, "link": "https://stackoverflow.com/questions/56879365/how-to-overload-operator-in-parsec-megaparsec/56893338#56893338", "title": "How to overload operator in Parsec/Megaparsec?", "body": "<p>Start by writing your compiler to use a different operator for string concatenation, like <code>@</code>.  When you've got it running and well tested, take a look at your code.  You'll probably discover that one of two things has happened, depending on the language you're parsing and the compiler architecture you've used.</p>\n\n<p>The <strong>first</strong> possibility is that the part of your parser that parses <code>+</code> is completely separate from the part of the parser that parses <code>@</code> (e.g., they are in two different parser functions, one for parsing numeric expressions and a separate one for parsing string expressions).  If this has happened, congratulations, you just need to replace <code>\"@\"</code> with <code>\"+\"</code>, run a few tests, and you should be good to go.</p>\n\n<p>The <strong>second</strong> possibility is that <code>+</code> and <code>@</code> are parsed in the same place and produce AST nodes with different constructors:</p>\n\n<pre><code>data Expr ... =\n  ...\n  | Plus Expr Expr     -- the '+' operator\n  | Concat Expr Expr   -- the '@' operator\n  ...\n</code></pre>\n\n<p>In this case, you probably also have some part of your compiler that's generating code (and hopefully some type information):</p>\n\n<pre><code>codeGen (Plus e1 e2)\n  = do (code1, typ1) &lt;- codeGen e1\n       (code2, typ2) &lt;- codeGen e2\n       if (typ1 == Num &amp;&amp; typ2 == Num)\n         then genPlus code1 code2\n         else typeError \"'+' needs numbers\"\ncodeGen (Concat e1 e2)\n  = do (code1, typ1) &lt;- codeGen e1\n       (code2, typ2) &lt;- codeGen e2\n       if (typ1 == Str &amp;&amp; typ2 == Str)\n         then genConcat code1 code2\n         else typeError \"'@' needs strings\"\n</code></pre>\n\n<p>In this case, you should modify the parser/AST to collapse the AST to just one shared constructor:</p>\n\n<pre><code>data Expr ... =\n  ...\n  | ConcatPlus Expr Expr     -- the '+' operator for numbers and strings\n  ...\n</code></pre>\n\n<p>and handle both cases in the code generator, depending on available type information:</p>\n\n<pre><code>codeGen (ConcatPlus e1 e2)\n  = do (code1, typ1) &lt;- codeGen e1\n       (code2, typ2) &lt;- codeGen e2\n       case (typ1, typ2) of\n           (Num, Num) -&gt; genPlus code1 code2\n           (Str, Str) -&gt; genConcat code1 code2\n           _ -&gt; typeError \"'+' arguments must have same type (numbers or strings)\"\n</code></pre>\n\n<p>If your compiler doesn't look like these examples, you'll have to post some code so we know what it <strong>does</strong> look like.</p>\n"}], "owner": {"reputation": 962, "user_id": 490815, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/366f7b0d571e7811680c53984c34c966?s=128&d=identicon&r=PG", "display_name": "sinoTrinity", "link": "https://stackoverflow.com/users/490815/sinotrinity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1562267972, "creation_date": 1562200329, "last_edit_date": 1562201238, "question_id": 56879365, "link": "https://stackoverflow.com/questions/56879365/how-to-overload-operator-in-parsec-megaparsec", "title": "How to overload operator in Parsec/Megaparsec?", "body": "<p>I am implementing a compiler using <a href=\"https://jakewheat.github.io/intro_to_parsing/\" rel=\"nofollow noreferrer\">Parsec/Megaparsec as parser</a>. I can't find a way to overload operator <code>+</code>, which I want to use for both integer addition and string concatenation. Is it possible?</p>\n"}, {"tags": ["haskell", "typeclass", "type-families", "type-level-computation", "sbv"], "comments": [{"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 0, "creation_date": 1562200907, "post_id": 56879364, "comment_id": 100307240, "body": "I don\u2019t know many of the details of this part of Haskell, but couldn\u2019t you just make two instances: <code>instance SymVal a =&gt; SymVal (Vec a Z)</code>, and <code>instance SymVal (Vec a n) =&gt; SymVal (Vec a (S n))</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 5, "last_activity_date": 1562201085, "creation_date": 1562201085, "answer_id": 56879422, "question_id": 56879364, "link": "https://stackoverflow.com/questions/56879364/asserting-that-typeclass-holds-for-all-results-of-type-family-application/56879422#56879422", "title": "Asserting that typeclass holds for all results of type family application", "body": "<p>Can't be done. You just gotta put the constraint everywhere. It's a real bummer.</p>\n"}, {"comments": [{"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 0, "creation_date": 1562206407, "post_id": 56879549, "comment_id": 100308071, "body": "This is awesome! What is <code>Dict</code>? Is it a built-in for passing around typeclass instances explicitly?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 1, "creation_date": 1562212339, "post_id": 56879549, "comment_id": 100309006, "body": "@jmite It&#39;s &quot;lore&quot;: <code>data Dict con = con =&gt; Dict</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 1, "creation_date": 1562212571, "post_id": 56879549, "comment_id": 100309043, "body": "Can you not say <code>type family Pred (n :: Nat) :: Nat where Pred (S n) = n</code> and then get rid of all those cases? <code>deduceSymVal SZ Dict = Dict; deduceSymVal (SS m) Dict = case deduceSymVal @a @(Pred n) m of Dict -&gt; Dict</code>. It&#39;s not a generic solution like the <code>case</code>s or type application patterns would be (thanks for the pattern though, I&#39;ll be stealing it), but it works out in this case."}, {"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 1, "creation_date": 1562286503, "post_id": 56879549, "comment_id": 100336675, "body": "Using the singleton Nat as a dynamic witness was exactly what I needed. Thanks!"}], "tags": [], "owner": {"reputation": 739, "user_id": 198277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cfe3de23679d68748d82750de1b88dc?s=128&d=identicon&r=PG", "display_name": "Sam Derbyshire", "link": "https://stackoverflow.com/users/198277/sam-derbyshire"}, "is_accepted": true, "score": 4, "last_activity_date": 1562203446, "last_edit_date": 1562203446, "creation_date": 1562202936, "answer_id": 56879549, "question_id": 56879364, "link": "https://stackoverflow.com/questions/56879364/asserting-that-typeclass-holds-for-all-results-of-type-family-application/56879549#56879549", "title": "Asserting that typeclass holds for all results of type family application", "body": "<p>I don't know the precise context in which you require these <code>SymVal (Vec a n)</code> instances, but generally speaking if you have a piece of code that requires the instance <code>SymVal (Vec a n)</code> then you should add it as a context:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foo :: forall (a :: Type) (n :: Nat). SymVal (Vec a n) =&gt; ...\n</code></pre>\n\n<p>When <code>foo</code> is called with a specific <code>n</code>, the constraint solver will reduce the type family application and use the instances</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance ( SymVal p, SymVal q ) =&gt; SymVal (p,q)\n</code></pre>\n\n<p>At the end of that process, the constraint solver will want an instance for <code>SymVal a</code>. So you'll be able to call <code>foo</code>:</p>\n\n<ul>\n<li>if you specify a given value for <code>n</code>, allowing the type family applications to fully reduce, and use a type <code>a</code> which has an instance for <code>SymVal</code>:</li>\n</ul>\n\n<pre class=\"lang-hs prettyprint-override\"><code>bar :: forall (a :: Type). SymVal a =&gt; ...\nbar = ... foo @a @(S (S (S Z))) ...\n\nbaz :: ...\nbaz = ... foo @Float @(S Z) ... -- Float has a SymVal instance\n</code></pre>\n\n<ul>\n<li>defer instance search by providing the same context:</li>\n</ul>\n\n<pre class=\"lang-hs prettyprint-override\"><code>quux :: forall (a :: Type) (n :: Nat). SymVal (Vec a n) =&gt; ...\nquux = ... foo @a @n ...\n</code></pre>\n\n<p>GHC can't automatically deduce <code>SymVal (Vec a n)</code> from <code>SymVal a</code>, because without further context it cannot reduce the type family application, and thus doesn't know which instance to choose. If you want GHC to be able to perform this deduction, you would have to pass <code>n</code> explicitly as an argument. This can be emulated with singletons :</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>deduceSymVal :: forall (a :: Type) (n :: Nat). Sing n -&gt; Dict (SymVal a) -&gt; Dict (SymVal (Vec a n))\ndeduceSymVal sz@SZ Dict =\n  case sz of\n    ( _ :: Sing Z )\n      -&gt; Dict\ndeduceSymVal ( ss@(SS sm) ) Dict\n  = case ss of\n      ( _ :: Sing (S m) ) -&gt;\n        case deduceSymVal @a @m sm Dict of\n          Dict -&gt; Dict\n</code></pre>\n\n<p>(Note that these obnoxious case statements would be eliminated with type applications in patterns, mais c'est la vie.)</p>\n\n<p>You can then use this function to allow GHC to deduce a <code>SymVal (Vec a n)</code> constraint from a <code>SymVal a</code> constraint, as long as you are able to provide a singleton for <code>n</code> (which amounts to passing <code>n</code> explicitly as opposed to being parametric over it):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>flob :: forall (a :: Type) (n :: Nat). (SymVal a, SingI n) =&gt; ...\nflob = case deduceSymVal @a (sing @n) Dict of\n  Dict -- matching on 'Dict' provides a `SymVal (Vec a n)` instance\n    -&gt; ... foo @a @n ...\n</code></pre>\n"}], "owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 1, "accepted_answer_id": 56879549, "answer_count": 2, "score": 6, "last_activity_date": 1562203446, "creation_date": 1562200307, "question_id": 56879364, "link": "https://stackoverflow.com/questions/56879364/asserting-that-typeclass-holds-for-all-results-of-type-family-application", "title": "Asserting that typeclass holds for all results of type family application", "body": "<p>I've got a type family defined as follows:</p>\n\n<pre><code>type family Vec a (n :: Nat) where\n  Vec a Z = a\n  Vec a (S n) = (a, Vec a n)\n</code></pre>\n\n<p>I'd like to assert that the result of applying this type family always fulfills the SymVal class constraint from the SBV package:</p>\n\n<pre><code>forall a . (SymVal a) =&gt; SymVal (Vec a n)\n</code></pre>\n\n<p>There is <code>SymVal</code> instances <code>a,b</code>, so whenever <code>SymVal a</code> holds, then <code>SymVal (Vec a n)</code> should hold, for any value of <code>n</code>. How can I ensure GHC sees that <code>SymVal</code> is always implemented for the result of the type family application?</p>\n\n<p>However, I don't know how to express this. Do I write an instance? A deriving clause? I'm not creating a new type, simply mapping numbers to existing ones. </p>\n\n<p>Or am I totally on the wrong track? Should I be using a data family, or functional dependencies?</p>\n"}]