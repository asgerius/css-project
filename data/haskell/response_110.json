[{"tags": ["haskell", "functional-programming", "zip", "applicative"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1487199234, "post_id": 42261264, "comment_id": 71680907, "body": "Hint: write some <code>x -&gt; y</code> as <code>((-&gt;) x) y</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1487199579, "post_id": 42261264, "comment_id": 71681061, "body": "<code>ap</code> (or <code>&lt;*&gt;</code>) actually expects <code>f (a-&gt;b)</code> and returns <code>f a -&gt; f b</code>. So <code>ap</code> can take <code>[a-&gt;b]</code> or even <code>c -&gt; a -&gt; b</code>. So, any binary function is OK, just like <code>zip</code>."}], "answers": [{"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": true, "score": 7, "last_activity_date": 1487201311, "last_edit_date": 1487201311, "creation_date": 1487199660, "answer_id": 42261721, "question_id": 42261264, "link": "https://stackoverflow.com/questions/42261264/partially-applying-with-zip/42261721#42261721", "title": "Partially applying &lt;*&gt; with zip", "body": "<p>Let's work out the types by hand. First, what are the types of the relevant expressions?</p>\n\n<pre><code>(&lt;*&gt;) :: Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b\nzip :: [a] -&gt; [b] -&gt; [(a, b)]\n</code></pre>\n\n<p>Now, we need to unify the type of <code>zip</code> with the type of the first argument to <code>(&lt;*&gt;)</code>. Let's rename the unrelated <code>a</code>s and <code>b</code>s:</p>\n\n<pre><code>Applicative f =&gt; f (a -&gt; b)\n                 [c] -&gt; [d] -&gt; [(c, d)]\n</code></pre>\n\n<p>First, what is <code>f</code>? What Applicative are we working in? The type of the bottom half is a function, so <code>f</code> must be <code>((-&gt;) [c])</code>, or \"functions taking a list of <code>c</code> as input\". And once we've done that, we can see that:</p>\n\n<pre><code>f ~ ((-&gt;) [c])\na ~ [d]\nb ~ [(c, d)]\n</code></pre>\n\n<p>Now that we've got the types to match up, we can look up the definition of <code>(&lt;*&gt;)</code> for functions:</p>\n\n<pre><code>instance Applicative ((-&gt;) a) where\n    pure = const\n    (&lt;*&gt;) f g x = f x (g x)\n</code></pre>\n\n<p>Substituting <code>zip</code> for <code>f</code> here, and rewriting as a lambda, yields:</p>\n\n<pre><code>(&lt;*&gt;) zip = \\g x -&gt; zip x (g x)\n</code></pre>\n\n<p>So, this needs a function from <code>[a] -&gt; [b]</code> and an <code>[a]</code>, and zips the input list with the result of calling the function on it.</p>\n\n<p>That makes sense mechanically, but why? What more general understanding can lead us to this conclusion without having to work everything out by hand? I'm not sure my own explanation of this will be useful, so you may want to study the instances for <code>((-&gt;) t)</code> yourself if you don't understand what's going on. But in case it is useful, here is a handwavy expanation.</p>\n\n<p>The Functor, Applicative, and Monad instances for <code>((-&gt;) t)</code> are the same as Reader t: \"functions which have implicit access to a value of type <code>t</code>\". <code>(&lt;*&gt;)</code> is about calling a function inside of an Applicative wrapper, which for functions is a two-argument function. It arranges that the \"implicit\" argument be passed to <code>f</code>, yielding another function, and calls that function with the value obtained by passing the implicit argument to <code>g</code> as well. So, <code>(&lt;*&gt;) f</code>, for some <code>f</code>, is \"Give me another function, and a value <code>x</code>, and I'll pass <code>x</code> to both <code>f</code> and the other function\".</p>\n"}], "owner": {"reputation": 1277, "user_id": 974790, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/84927d0a1eee5f4388297a45d16ef0f2?s=128&d=identicon&r=PG", "display_name": "DennisVDB", "link": "https://stackoverflow.com/users/974790/dennisvdb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 42261721, "answer_count": 1, "score": 3, "last_activity_date": 1487201311, "creation_date": 1487197540, "question_id": 42261264, "link": "https://stackoverflow.com/questions/42261264/partially-applying-with-zip", "title": "Partially applying &lt;*&gt; with zip", "body": "<p>I started to look at some <code>Haskell</code> code and found:</p>\n\n<pre><code>foo :: ([a] -&gt; [b]) -&gt; [a] -&gt; [(a, b)]\nlet foo = (&lt;*&gt;) zip\n</code></pre>\n\n<p>I don't understand how this works, <code>ap</code> expects a <code>f (a -&gt; b) -&gt; f a</code> but <code>zip</code> is of type <code>[a] -&gt; [b] -&gt; ([a, b])</code>. I understand that <code>f a -&gt; f b</code> would match <code>[a] -&gt; [b]</code>, but not <code>f (a -&gt; b)</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 3, "creation_date": 1487193058, "post_id": 42260045, "comment_id": 71677878, "body": "Is it the complete code ? I&#39;m not sure to understand what you did, but <code>f x y = f y x</code> can make sense only if <code>x</code> and <code>y</code> have the same type. This explains <code>a -&gt; a</code>."}, {"owner": {"reputation": 83, "user_id": 7519086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62d51672ccf81597ea02e16869fe1df1?s=128&d=identicon&r=PG&f=1", "display_name": "user1299292", "link": "https://stackoverflow.com/users/7519086/user1299292"}, "reply_to_user": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1487193337, "post_id": 42260045, "comment_id": 71678040, "body": "Yes this is the complete code. :t f gives me t1 -&gt; t1 -&gt; t. What you say was also my thought but GHCI says something else"}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1487193550, "post_id": 42260045, "comment_id": 71678162, "body": "You say <code>a -&gt; a -&gt; b</code> in your OP and now you say <code>t1 -&gt; t1 -&gt; t</code>. I don&#39;t follow you. Anyway <code>a</code> denotes an arbitrary type, like <code>t1</code>. This is the same. And you say &quot;GHCI says something else&quot;. I&#39;m lost."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1487193600, "post_id": 42260045, "comment_id": 71678187, "body": "And your code is not complete since you didn&#39;t type <code>:t f</code> in your OP. We have to guess what you mean..."}, {"owner": {"reputation": 46777, "user_id": 1100107, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8789d3da0b482bcd8e562bfdf3687c74?s=128&d=identicon&r=PG", "display_name": "St&#233;phane Laurent", "link": "https://stackoverflow.com/users/1100107/st%c3%a9phane-laurent"}, "edited": false, "score": 0, "creation_date": 1487193987, "post_id": 42260045, "comment_id": 71678363, "body": "Or you mean <code>b</code> ? <code>a</code> is the type of <code>x</code>, <code>a</code> is the type of <code>y</code>, and <code>b</code> is the type of <code>f x y</code>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 1, "creation_date": 1487269742, "post_id": 42260286, "comment_id": 71720361, "body": "The deduced return type of <code>f</code> is not determined independent of the argument types because of yieldless infinite recursion. In <code>f x y = f x y</code>, <code>f :: a -&gt; b -&gt; c</code> because no type coercions can be inferred. In <code>f x y = f y x</code>, <code>f :: a -&gt; a -&gt; b</code> because the argument type <code>a</code> is logically coerced, and the return type <code>b</code> is not."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "edited": false, "score": 0, "creation_date": 1487270694, "post_id": 42260286, "comment_id": 71720933, "body": "<code>f x y = x + f x y</code> for example never terminates, but is of the constrained type <code>Num a =&gt; a -&gt; b -&gt; a</code>. Using <code>(+) :: Int -&gt; Int -&gt; Int</code>, <code>f :: Int -&gt; a  -&gt; Int</code>, with a specific return type <code>Int</code>."}], "tags": [], "owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "is_accepted": true, "score": 10, "last_activity_date": 1487193619, "creation_date": 1487193619, "answer_id": 42260286, "question_id": 42260045, "link": "https://stackoverflow.com/questions/42260045/haskell-finding-general-type/42260286#42260286", "title": "Haskell - Finding general type", "body": "<p>If it's OK to use both <code>x</code> (on the left) and <code>y</code> (on the right) for the first argument of <code>f</code>, they must be the same type. So that's where the <code>a -&gt; a</code> comes from.</p>\n\n<p>Your function will infinitely recurse without returning anything, so you can correctly claim that it has an arbitrary return type because there's no situation where that will be falsified by it returning a value of another type, as it never returns. This is where the arbitrary <code>b</code> comes from.</p>\n"}], "owner": {"reputation": 83, "user_id": 7519086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62d51672ccf81597ea02e16869fe1df1?s=128&d=identicon&r=PG&f=1", "display_name": "user1299292", "link": "https://stackoverflow.com/users/7519086/user1299292"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "accepted_answer_id": 42260286, "answer_count": 1, "score": 2, "last_activity_date": 1487193619, "creation_date": 1487192770, "last_edit_date": 1487192888, "question_id": 42260045, "link": "https://stackoverflow.com/questions/42260045/haskell-finding-general-type", "title": "Haskell - Finding general type", "body": "<p>I am new in Haskell and I have problems with finding the type of</p>\n\n<pre><code>f x y = f y x\n</code></pre>\n\n<p>GHCI gives me: a->a->b</p>\n\n<p>But I don't understand why. Can someone explain it to me?</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1487185907, "post_id": 42258088, "comment_id": 71673966, "body": "Isn&#39;t the third <code>print</code> causing problems? Here you provide a <code>4</code> and a <code>Cons 5 Empy</code>, so you apply <code>(Cons 5 Empty)</code> on <code>4</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487186023, "post_id": 42258088, "comment_id": 71674043, "body": "I get a different error message when trying to run your code as posted here. That&#39;s because there is a typo: in the third line of the do-block, you meant to write <code>print $ 4 `Cons` (5 `Cons` Empty)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1487185969, "creation_date": 1487185969, "answer_id": 42258141, "question_id": 42258088, "link": "https://stackoverflow.com/questions/42258088/no-instance-for-show-a0-arising-from-a-use-of-print-in-haskell/42258141#42258141", "title": "No instance for (Show a0) arising from a use of `print&#39; in Haskell", "body": "<p><code>Empty</code> can be any type of <code>List</code>, and although it happens to be the case that <code>show Empty</code> will be <code>\"Empty\"</code> in all cases where <code>show</code> works at all, the compiler doesn't really know that. (For a real-life example where things could differ by type, compare <code>show ([] :: [Int])</code> and <code>show ([] :: [Char])</code> in ghci.) So it demands that you pick a type to use to help it decide how to run <code>show Empty</code>. Pretty easy fix:</p>\n\n<pre><code>main = do\n    print $ (Empty :: List Int)\n    ...\n</code></pre>\n\n<p>Don't forget to add a <code>Cons</code> to the <code>4 (Cons 5 Empty)</code> line, too!</p>\n"}], "owner": {"reputation": 309, "user_id": 2372684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AW7Sa.jpg?s=128&g=1", "display_name": "bling5630", "link": "https://stackoverflow.com/users/2372684/bling5630"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1014, "favorite_count": 0, "accepted_answer_id": 42258141, "answer_count": 1, "score": 3, "last_activity_date": 1487192299, "creation_date": 1487185780, "last_edit_date": 1487192299, "question_id": 42258088, "link": "https://stackoverflow.com/questions/42258088/no-instance-for-show-a0-arising-from-a-use-of-print-in-haskell", "title": "No instance for (Show a0) arising from a use of `print&#39; in Haskell", "body": "<p>I am new in Haskell. The topic is from Learn you Haskell book \"recursive data structures\"</p>\n\n<p>Here is my code</p>\n\n<pre><code>data List a = Empty | Cons a (List a) deriving (Show, Read, Eq, Ord) \n\nmain = do\n    print $ Empty\n    print $ 5 `Cons` Empty \n    print $ 4 (Cons 5 Empty)  \n    print $ 3 `Cons` (4 `Cons` (5 `Cons` Empty))\n</code></pre>\n\n<p>and here is the error message I get</p>\n\n<pre><code>No instance for (Show a0) arising from a use of `print'\nThe type variable `a0' is ambiguous\nPossible fix: add a type signature that fixes these type variable(s)\nNote: there are several potential instances:\n  instance Show a =&gt; Show (List a)\n</code></pre>\n"}, {"tags": ["haskell", "github", "oauth", "oauth-2.0", "yesod"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1487189816, "post_id": 42256444, "comment_id": 71676125, "body": "Can you see what is in the session &quot;_ID&quot; ? That is likely to contain &quot;access_token&quot; information serialized within it."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7531219"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1487246711, "post_id": 42256444, "comment_id": 71702925, "body": "Its the GitHub user ID, no token. It gets returned in the session at present along with nothing else. I figure there is someway of configuring YesodAuth to return more in the session but I&#39;ve yet to find a way."}], "owner": {"user_type": "does_not_exist", "display_name": "user7531219"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487180261, "creation_date": 1487180261, "question_id": 42256444, "link": "https://stackoverflow.com/questions/42256444/yesod-handling-session-data-within-simple-project", "title": "Yesod: Handling session data within simple project", "body": "<p>I'm looking to authenticate a user using GitHub as an oauth2 endpoint and get some session data. </p>\n\n<p>I've got the whole authentication working but I want to be able to get some more useful info from the session beyond the user ID such as the session token for instance so I can make GitHub API calls on their behalf. </p>\n\n<p>I'm ignorant to how and instance of YesodAuth can be manipulated and how the whole plugin architecture works within Yesod so any advice there would be awesome. </p>\n\n<p>Here's where I'm at right now:</p>\n\n<p><strong>Foundation.hs</strong></p>\n\n<pre><code>instance YesodAuth App where\n  type AuthId App = Text\n  getAuthId = return . Just . credsIdent\n\n  loginDest _ = HomeR\n  logoutDest _ = HomeR\n\n  authPlugins _ =\n    [ -- authBrowserId def,\n      oauth2Github clientId clientSecret\n    ]\n\n  authHttpManager = appHttpManager\n\n  -- Session functions here\n  -- ???\n  maybeAuthId = lookupSession \"_ID\"\n</code></pre>\n\n<p><strong>Home.hs</strong></p>\n\n<pre><code>getHomeR :: Handler Html \ngetHomeR = do\n    --(formWidget, formEnctype) &lt;- generateFormPost sampleForm\n    --let submission = Nothing :: Maybe FileForm\n    --    handlerName = \"getHomeR\" :: Text\n\n    maid &lt;- maybeAuthId\n\n    -- Getting nothing for all of these\n    sess &lt;- getSession\n    let access_token = lookup \"access_token\" sess\n        user_name = lookup \"login\" sess\n</code></pre>\n\n<p><a href=\"https://github.com/StarStuffSteve/CS7009\" rel=\"nofollow noreferrer\">Link to my project code</a></p>\n"}, {"tags": ["html", "css", "haskell", "ghcjs"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1487177088, "post_id": 42254610, "comment_id": 71668246, "body": "It is not clear what you are referring to. <a href=\"https://github.com/ghcjs/ghcjs\" rel=\"nofollow noreferrer\">GHCJS</a> is a Haskell-to-JavaScript compiler, and not e.g. a DOM manipualtion library."}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487177228, "post_id": 42254610, "comment_id": 71668356, "body": "@duplode if you are compiling to JavaScript presumably it is for the web? or for JS backend (such as node)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487178551, "post_id": 42254610, "comment_id": 71669368, "body": "Yup -- arbitrary Haskell as input, JavaScript as output. A suitable JavaScript foreign function interface is provided so that communicating with the browser is possible for your code and/or the for libraries that require that."}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487178813, "post_id": 42254610, "comment_id": 71669540, "body": "@duplode can you point to where ghcjs communicates with the Browser? i am just trying to build a responsive website"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487180372, "post_id": 42254610, "comment_id": 71670597, "body": "Examples: <a href=\"https://github.com/ghcjs/ghcjs-dom-hello\" rel=\"nofollow noreferrer\"><i>js-dom-hello</i></a>; <a href=\"https://github.com/ghcjs/ghcjs-examples\" rel=\"nofollow noreferrer\"><i>ghcjs-examples</i></a>; <a href=\"https://github.com/agrafix/react-flux-example\" rel=\"nofollow noreferrer\"><i>react-flux-example</i></a>; <a href=\"https://bitbucket.org/wuzzeb/react-flux/src/tip/example/\" rel=\"nofollow noreferrer\">examples in the <i>react-flux</i> repository</a>. API docs: <a href=\"https://hackage.haskell.org/package/ghcjs-dom-jsffi-0.7.0.1\" rel=\"nofollow noreferrer\"><i>ghcjs-dom-jsffi</i></a>; <a href=\"https://hackage.haskell.org/package/react-flux\" rel=\"nofollow noreferrer\"><i>react-flux</i></a>."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487180382, "post_id": 42254610, "comment_id": 71670603, "body": "(Sorry for the above being just a list of links; I&#39;m not familiar enough with GHCJS to tell for sure what would be the easiest path for a beginner.)"}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487180613, "post_id": 42254610, "comment_id": 71670742, "body": "@duplode thank you so much for trying. ghcjs is very new -- and people are still figuring it out.  perhaps give someone else a turn?"}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1487199044, "post_id": 42254610, "comment_id": 71680842, "body": "@johnmangual ghcjs isn&#39;t new at all, and people have already figured it out. Are you perhaps trying to say &quot;I&#39;m very new to ghcjs, and am still trying to figure out how it works&quot;?"}], "answers": [{"comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "reply_to_user": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 4, "creation_date": 1487199113, "post_id": 42259659, "comment_id": 71680874, "body": "@johnmangual It sounds like you&#39;re confused about what ghcjs <i>is</i>. Things are rarely useful until you understand what they are."}], "tags": [], "owner": {"reputation": 1369, "user_id": 509928, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57d816a396798416d079c92adbabdbf3?s=128&d=identicon&r=PG", "display_name": "Dave Compton", "link": "https://stackoverflow.com/users/509928/dave-compton"}, "is_accepted": false, "score": 1, "last_activity_date": 1487195046, "last_edit_date": 1487195046, "creation_date": 1487191451, "answer_id": 42259659, "question_id": 42254610, "link": "https://stackoverflow.com/questions/42254610/how-to-code-h1-tags-with-ghcjs/42259659#42259659", "title": "how to code &lt;h1&gt; tags with ghcjs", "body": "<p>You can use <code>ghcjs</code> with the library <code>ghcjs-dom</code> to work with the <code>DOM</code> .</p>\n\n<p>From the title of your question, <code>\"how to code &lt;h1&gt; tags with ghcjs\"</code>, and some of your comments, it looks like you are looking for a simple ghcjs/ghcjs-dom example that includes a few <code>HTML</code> tags.  This program will generate your <code>HTML</code> and respond to a click on the <code>h1</code> element:</p>\n\n<pre><code>import GHCJS.DOM (runWebGUI, webViewGetDomDocument)\nimport GHCJS.DOM.Document (getBody, createElement)\nimport GHCJS.DOM.Element (click, setInnerHTML)\nimport GHCJS.DOM.HTMLHeadingElement (castToHTMLHeadingElement)\nimport GHCJS.DOM.HTMLParagraphElement (castToHTMLParagraphElement)\nimport GHCJS.DOM.Node (appendChild)\nimport GHCJS.DOM.EventM (on)\n\nmain = runWebGUI $ \\win -&gt; do\n        Just doc &lt;- webViewGetDomDocument win\n        Just body &lt;- getBody doc\n\n        Just h1 &lt;- fmap castToHTMLHeadingElement &lt;$&gt; createElement doc (Just \"h1\")\n        appendChild body $ Just h1\n        setInnerHTML h1 (Just \"Hello World\")\n        on h1 click $ setInnerHTML h1 (Just \"Clicked\")\n\n        Just p &lt;- fmap castToHTMLParagraphElement &lt;$&gt; createElement doc (Just \"p\")\n        appendChild body $ Just p\n        setInnerHTML p (Just \"This is my test document.\")\n\n        return ()\n</code></pre>\n\n<p>This project: <a href=\"https://github.com/dc25/stackOverflow__how-to-code-h1-tags-with-ghcjs\" rel=\"nofollow noreferrer\">https://github.com/dc25/stackOverflow__how-to-code-h1-tags-with-ghcjs</a> contains the above code.  Here is a link to a browser based demo:  <a href=\"https://dc25.github.io/stackOverflow__how-to-code-h1-tags-with-ghcjs/\" rel=\"nofollow noreferrer\">https://dc25.github.io/stackOverflow__how-to-code-h1-tags-with-ghcjs/</a>  The page changes if you click the \"Hello World\" header.</p>\n\n<p>The <code>ghcjs</code> compiler output includes an <code>index.html</code> page.   Ghcjs will not overwrite that page if it already exists so you can safely edit it after it is created.  This allows you to directly include your <code>css</code> file.</p>\n\n<p>Regarding documentation, this page: <a href=\"https://hackage.haskell.org/package/jsaddle-dom-0.4.0.1/docs/\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/jsaddle-dom-0.4.0.1/docs/</a> contains useful links related to <code>ghcjs-dom</code> functionality. </p>\n"}, {"comments": [{"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 0, "creation_date": 1487204626, "post_id": 42262597, "comment_id": 71682678, "body": "i am extremely confused about what it is and what it does.  i have misunderstood something essential about ghcjs"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 0, "creation_date": 1487204704, "post_id": 42262597, "comment_id": 71682704, "body": "so why did you down-vote the answer - is it making it more unclear?"}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 0, "creation_date": 1487204851, "post_id": 42262597, "comment_id": 71682745, "body": "your answer makes clear that Haskell is not a good solution for front-end web development when there are much simpler tools"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 0, "creation_date": 1487205005, "post_id": 42262597, "comment_id": 71682780, "body": "on the contrary - if you have a simple task use simple tools (html/css) but if you want a interactive, complex front end I would use it - though for production stuff you get a big chunk of js - that might be a problem if you are targetting mobile devices"}, {"owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 0, "creation_date": 1487205182, "post_id": 42262597, "comment_id": 71682840, "body": "these docs are atrocious"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "edited": false, "score": 2, "creation_date": 1487205547, "post_id": 42262597, "comment_id": 71682953, "body": "GHCJS is an open source project - if you are not happy with it, file bugs or even better try to expand the docs yourself, there are plenty of people happy to help, also go to the IRC and/or mailinglist. I think stackoverflow is not the right place to complain about lacking/bad documentation"}], "tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 1, "last_activity_date": 1487205426, "last_edit_date": 1487205426, "creation_date": 1487204519, "answer_id": 42262597, "question_id": 42254610, "link": "https://stackoverflow.com/questions/42254610/how-to-code-h1-tags-with-ghcjs/42262597#42262597", "title": "how to code &lt;h1&gt; tags with ghcjs", "body": "<p>First of all - as @Cubic already said - I think you are confused what GHCJS is.</p>\n\n<p>GHCJS is a Compiler that lets you compile Haskell code to Javascript - rendering a simple page of html/css is not the task it was designed for. It is \"Mit Kanonen auf Spatzen schie\u00dfen\" as we say in German - or shorter overkill.</p>\n\n<p>So what would I use it for writing a front-end to a given haskell backend is really nice, you can share all your existing types and get all the maintainability and safety you have in the haskell eco-system.</p>\n\n<p>But even if you don't have a haskell backend and you strife for novelty and good ideas - GHCJS might interest you, I myself am quite new to functional reactive programming, and having tried purescript(with pux) before now learning reflex/reflex-dom (my choice of front-end dsl) is a challenge for my brain and a delight - I know this paragraph is quite opinionated, but the abstractions presented in reflex seem right and seem to make clear some of the shortcomings of other functional reactive frameworks\u2026</p>\n\n<p>So how would one render the above in with the aforementioned libraries:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings   #-}\nimport           Reflex\nimport           Reflex.Dom\n\nmain :: IO ()\nmain = mainWidgetWithCss \"h1 {font-family: Helvetica;} p {font-family: Helvetica; color: blue;}\" $ do\n  el \"h1\" $ text \"Hello World!\"\n  el \"p\" $ text \"This is my test document\"\n</code></pre>\n\n<p>This is - as I said - overkill - you get a full run-time, a big chunk of js when some plain html/css would have sufficed. But for generating a complex UI in reusable components GHCJS might be the right choice.</p>\n\n<p>The following is one of the more complex components I have yet written - it models a list of buttons that I can expand when clicking on the rightmost button, or shrink to the size of one of the other buttons (i use this for something like a \"rate this X stars\" but the stars can be arbitrary many).</p>\n\n<pre><code>listWidget :: MonadWidget t m =&gt; Int -&gt; m (Event t Int)\nlistWidget n = leftmost &lt;$&gt; traverse button' [(-1)..(n+1)]\n\nlistWidget2 :: MonadWidget t m =&gt; m ()\nlistWidget2 = mdo\n  clicked &lt;- switchPromptlyDyn &lt;$&gt; widgetHold (listWidget (-1))\n                                              (listWidget &lt;$&gt; clicked)\n  return ()\n\nbutton' :: (MonadWidget t m, Show a) =&gt; a -&gt; m (Event t a)\nbutton' val = (fmap $ const val) &lt;$&gt; button (text . pack $ show val)\n</code></pre>\n\n<h2>UPDATE:</h2>\n\n<p>The problem that plain Javascript has is scalability if you have a large amount of Javascript maintaining and changing code gets error prone and tedious because of the lacking type system and the dynamic nature. To remedy these problems there have come up a vast number of \"compile-to-JS\" languages - Haskell with GHCJS being one of them.</p>\n"}], "owner": {"reputation": 6238, "user_id": 737051, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4cbfcdd51d0ec56844b3540f62d06af3?s=128&d=identicon&r=PG", "display_name": "john mangual", "link": "https://stackoverflow.com/users/737051/john-mangual"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "closed_date": 1487372649, "answer_count": 2, "score": 0, "last_activity_date": 1487205426, "creation_date": 1487175318, "question_id": 42254610, "link": "https://stackoverflow.com/questions/42254610/how-to-code-h1-tags-with-ghcjs", "closed_reason": "Needs details or clarity", "title": "how to code &lt;h1&gt; tags with ghcjs", "body": "<p>I have found the ghcjs documentation very limited.  Here is this basic HTML document.  </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-css lang-css prettyprint-override\"><code>h1 { font-family: Helvetica; }\r\n\r\np {font-family: Helvetica; color: blue; }</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;h1&gt;\r\nHello World\r\n&lt;/h1&gt;\r\n&lt;p&gt;\r\nThis is my test document.\r\n&lt;/p&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Is ghcjs just a combinator, basically typing the HTML as an output string?  Or does Haskell store a model of DOM somewhere?</p>\n\n<p>My question is about all html tags and CSS, but maybe other tags have different features.</p>\n"}, {"tags": ["haskell", "io-monad"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1487171236, "post_id": 42253027, "comment_id": 71663588, "body": "Why not just call <code>readLn</code> 3 times in a do-block? Or use a map with side effects, map over a length-3 range, and call <code>readLn</code> inside the function. That would return a list of 3 ints."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1487171351, "post_id": 42253027, "comment_id": 71663673, "body": "Do you want to read 3 integers from a single line? Input is usually line-buffered - what if there are 4 integers on the single line?  What if there are only 2?"}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1487171367, "post_id": 42253027, "comment_id": 71663690, "body": "Oh, you want to read a single line? Why not just read that in then split on spaces?"}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1487172421, "post_id": 42253027, "comment_id": 71664579, "body": "@Carcigenicate Yes, from a single line. If they are on multiple lines indeed your solution is easy and perfect."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1487174833, "post_id": 42253027, "comment_id": 71666521, "body": "Keep in mind you <i>never</i> read 3 integers; you <i>always</i> read one string. That string then needs to be parsed, which can range from trivial (if you are only expecting a single value of a type with a <code>Read</code> instance) to complex."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1487290907, "post_id": 42253027, "comment_id": 71730915, "body": "You write an IO action that reads one Integer and run it three times. That is how such problems are solved."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487171889, "post_id": 42253177, "comment_id": 71664133, "body": "This doesn&#39;t read 3 integers from stdin, this simply grabs a line, tries to read it all, and fails with a pattern match error if there aren&#39;t exactly three. (&quot;Also, it does not allow me to state that I want to read three integers, it will attempt to read any amount of integers from stdin.&quot;)"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487172059, "post_id": 42253177, "comment_id": 71664286, "body": "@user2407038: no it does not per se tries to read it all since <code>map</code> is lazy (and <code>f x</code> on an element of <code>map</code> is lazy as well), and furthermore with a tiny bit of <i>creativity</i> you could of course implement scenarios with two, four or an arbitrary amount of integers :)."}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "edited": false, "score": 0, "creation_date": 1487173610, "post_id": 42253177, "comment_id": 71665506, "body": "How to use this properly in a pattern match? When trying to use <code>case convert line of</code>, I always get a <code>*** Exception: user error (Prelude.readIO: no parse)</code>"}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "edited": false, "score": 1, "creation_date": 1487184822, "post_id": 42253177, "comment_id": 71673367, "body": "The problem I was encountering was related to something else in my code"}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1487172135, "last_edit_date": 1487172135, "creation_date": 1487171573, "answer_id": 42253177, "question_id": 42253027, "link": "https://stackoverflow.com/questions/42253027/how-to-read-three-consecutive-integers-from-stdin-in-haskell/42253177#42253177", "title": "How to read three consecutive integers from stdin in Haskell?", "body": "<p>What about converting the string like:</p>\n\n<pre><code>convert :: Read a =&gt; String -&gt; [a]\nconvert = map read . words\n</code></pre>\n\n<p><code>words</code> splits the given string into a list of strings (the \"words\") and then we perform a <code>read</code> on every element using <code>map</code>.</p>\n\n<p>and for instance use it like:</p>\n\n<pre><code>main = do\n    line &lt;- getLine\n    let [a,b,c] = convert line :: [Int] in putStrLn (show (c,a,b))\n</code></pre>\n\n<p>or if you for instance want to read the first three elements and don't care about the rest (yes this apparently requires <em>super</em>-creativity skills):</p>\n\n<pre><code>main = do\n    line &lt;- getLine\n    let (a:b:c:_) = convert line :: [Int] in putStrLn (show (c,a,b))\n</code></pre>\n\n<p>I here returned a tuple that is rotated one place to the right to show parsing is done.</p>\n"}], "owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1124, "favorite_count": 0, "accepted_answer_id": 42253177, "answer_count": 1, "score": 3, "last_activity_date": 1487172135, "creation_date": 1487171172, "question_id": 42253027, "link": "https://stackoverflow.com/questions/42253027/how-to-read-three-consecutive-integers-from-stdin-in-haskell", "title": "How to read three consecutive integers from stdin in Haskell?", "body": "<p>I want to read an input like <code>12 34 56</code> into three integers using Haskell.</p>\n\n<p>For a single integer, one might use <code>myInteger &lt;- readLn</code>. But for this case, I have not found any solution, except the one of first reading a line, then replacing all spaces with <code>,</code>, (using something like:</p>\n\n<pre><code>spaceToCommas str =\n  let repl ' ' = ','\n      repl  c =   c\n  in map repl str\n</code></pre>\n\n<p>) and then calling <code>read '[' ++ str ++ ']'</code> which feels very hackish. Also, it does not allow me to state that I want to read <em>three</em> integers, it will attempt to read <em>any</em> amount of integers from stdin.</p>\n\n<p>There has to be a better way.</p>\n\n<p>Note that I would like a solution that does <em>not</em> rely on external packages. Using e.g. Parsec is of course great, but this simple example should not require the use of a full-fledged Parser Combinator framework, right?</p>\n"}, {"tags": ["macos", "haskell"], "comments": [{"owner": {"reputation": 1979, "user_id": 1757268, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1001c187fb680a13c262b47d9e7aa9bd?s=128&d=identicon&r=PG", "display_name": "NatureShade", "link": "https://stackoverflow.com/users/1757268/natureshade"}, "edited": false, "score": 1, "creation_date": 1487172419, "post_id": 42249597, "comment_id": 71664578, "body": "Have you tried the workarounds here: <a href=\"https://github.com/haskell-opengl/GLUT/issues/19\" rel=\"nofollow noreferrer\">github.com/haskell-opengl/GLUT/issues/19</a>"}], "owner": {"reputation": 293, "user_id": 5846939, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/3f615365cdfd3144347c977c2a902b47?s=128&d=identicon&r=PG&f=1", "display_name": "user5846939", "link": "https://stackoverflow.com/users/5846939/user5846939"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1321, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1487168779, "creation_date": 1487162092, "last_edit_date": 1495539926, "question_id": 42249597, "link": "https://stackoverflow.com/questions/42249597/how-do-i-solve-unknown-glut-entry-glutinit-while-trying-to-run-a-gloss-progr", "title": "How do I solve &quot;(unknown GLUT entry glutInit)&quot; while trying to run a Gloss program?", "body": "<p>I am new to haskell but I'm trying to run a program with the Gloss library. I have installed it the library and all its dependencies with no problems, can compile a file with the Gloss library imported, but when I try to actually run a test program like this one (my typing \"main\" in ghci after the file is loaded):</p>\n\n<pre><code>-- | Display \"Hello World\" in a window.\n--\nimport Graphics.Gloss\n\nmain    \n = display \n        (InWindow\n           \"Hello World\"     -- window title\n        (400, 150)   -- window size\n        (10, 10))    -- window position\n    white            -- background color\n    picture          -- picture to display\n\npicture \n    = Translate (-170) (-20) -- shift the text to the middle of the window\n    $ Scale 0.5 0.5      -- display it half the original size\n    $ Text \"Hello World\"     -- text to display\n</code></pre>\n\n<p>I end up getting the following text in ghci (version 8.0.1):</p>\n\n<pre><code>*** Exception: user error (unknown GLUT entry glutInit)\n</code></pre>\n\n<p>I have googled this problem but all solutions seems to be <a href=\"https://stackoverflow.com/questions/20038674/cant-run-opengl-on-haskell\">if you are on windows you should add some dll file glut32.dll</a>. But I'm on OS X Mavericks so what do I do to make it work? Can anyone help with getting Gloss programs to run on OS X? I don't even understand what \"unknown GLUT entry glutInit\" means. Thanks a lot!</p>\n"}, {"tags": ["performance", "haskell", "linked-list", "fold", "any"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1487161783, "post_id": 42248592, "comment_id": 71656809, "body": "If you want to reason about the performance of the code on this level, you probably should look at the core. The performance gap has nothing to do with asymptotics (how could it? your functions are clearly O(n) as well) - my guess is it would be due to lack of inlining in <code>Foldable</code> functions. All your functions are equivalent to <code>foldr f z</code> for some <code>f</code>, <code>z</code>, and <code>List.foldr</code> would probably inline even when <code>Foldable.foldr</code> doesn&#39;t."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487163126, "post_id": 42248592, "comment_id": 71657753, "body": "Could you share your benchmarks?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1487163850, "post_id": 42248592, "comment_id": 71658208, "body": "I&#39;m failing to reproduce this with simple <code>all</code> / <code>forall</code> . Unsurprisingly, where fusible operations are involved it is no contest: <a href=\"http://sprunge.us/RQdO\" rel=\"nofollow noreferrer\">sprunge.us/RQdO</a> Of course you could write fusion rules for <code>forall</code> and company."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1487168084, "post_id": 42248592, "comment_id": 71661197, "body": "@Michael I get results similar to those of Georg with <code>-O0</code>, and similar to yours with <code>-O2</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487168252, "post_id": 42248592, "comment_id": 71661318, "body": "@duplode which begs the question: did Georg use optimization?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487172675, "post_id": 42248592, "comment_id": 71664776, "body": "@duplode thanks that explains it. The bench context made me take it for granted we were turning up optimization."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1487177376, "post_id": 42248592, "comment_id": 71668457, "body": "please read the haskell tag info section re performance questions"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1487219595, "post_id": 42248592, "comment_id": 71686900, "body": "You should also try out <code>-O</code>. It compiles <i>much</i> faster than <code>-O2</code>, and the code it produces is often quite good enough."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1487219835, "post_id": 42248592, "comment_id": 71686981, "body": "Also, note that basically all the <code>Foldable</code> functions can have serious performance problems when used with the &quot;wrong&quot; containers. <code>Foldable</code> is a &quot;leaky&quot; abstraction: you really have to think about what you&#39;re using it with. Some people are trying to improve matters, but it seems inherently difficult."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1487254185, "post_id": 42248592, "comment_id": 71708665, "body": "@dfeuer it is so in general, but as it happens the program I linked I cannot observe to take more time with -O2 than  -O but sometimes less."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1487254388, "post_id": 42248592, "comment_id": 71708834, "body": "@dfeuer the advice is good for libraries, but if it is just a question of compiling a Main module, a habit of using -O2 seems to me to have all arguments in its favor, and so it is for standard uses of <code>criterion</code>"}], "answers": [{"tags": [], "owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "is_accepted": true, "score": 9, "last_activity_date": 1487179646, "creation_date": 1487179646, "answer_id": 42256254, "question_id": 42248592, "link": "https://stackoverflow.com/questions/42248592/haskell-ghc-performance-of-any-all/42256254#42256254", "title": "Haskell/GHC performance of `any`/`all`", "body": "<p>I find it instructive to re-implement <code>any</code> in the various ways:</p>\n\n<pre><code>import Prelude hiding (any)\nimport Criterion.Main\nimport Data.Foldable (foldMap)\nimport Data.Monoid\n</code></pre>\n\n<p>Your <code>exists</code>:</p>\n\n<pre><code>exists :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nexists _ [] = False\nexists pred (x : xs)\n    = if pred x\n      then True\n      else exists pred xs\n</code></pre>\n\n<p>A version using <code>(||)</code>:</p>\n\n<pre><code>existsOr :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nexistsOr _ [] = False\nexistsOr pred (x : xs) = pred x || existsOr pred xs\n</code></pre>\n\n<p>Using <code>foldr</code>:</p>\n\n<pre><code>any :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nany pred = foldr ((||) . pred) False\n</code></pre>\n\n<p>Using <code>foldr</code> and <code>Any</code>:</p>\n\n<pre><code>anyF :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nanyF pred = getAny . foldr (mappend . (Any . pred)) mempty\n</code></pre>\n\n<p>Using <code>foldMap</code> and <code>Any</code>:</p>\n\n<pre><code>anyFM :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nanyFM pred = getAny . foldMap (Any . pred)\n</code></pre>\n\n<p>Benchmarks with <code>ghc -O0</code>:</p>\n\n<pre><code>benchmarking exists\ntime                 1.552 \u03bcs   (1.504 \u03bcs .. 1.593 \u03bcs)\n                     0.989 R\u00b2   (0.983 R\u00b2 .. 0.993 R\u00b2)\nmean                 1.482 \u03bcs   (1.427 \u03bcs .. 1.545 \u03bcs)\nstd dev              196.1 ns   (168.8 ns .. 229.2 ns)\nvariance introduced by outliers: 93% (severely inflated)\n\nbenchmarking existsOr\ntime                 2.699 \u03bcs   (2.616 \u03bcs .. 2.768 \u03bcs)\n                     0.992 R\u00b2   (0.988 R\u00b2 .. 0.995 R\u00b2)\nmean                 2.629 \u03bcs   (2.554 \u03bcs .. 2.704 \u03bcs)\nstd dev              277.8 ns   (235.8 ns .. 351.1 ns)\nvariance introduced by outliers: 89% (severely inflated)\n\nbenchmarking any\ntime                 5.551 \u03bcs   (5.354 \u03bcs .. 5.777 \u03bcs)\n                     0.990 R\u00b2   (0.986 R\u00b2 .. 0.995 R\u00b2)\nmean                 5.553 \u03bcs   (5.395 \u03bcs .. 5.750 \u03bcs)\nstd dev              584.2 ns   (447.5 ns .. 835.5 ns)\nvariance introduced by outliers: 88% (severely inflated)\n\nbenchmarking anyF\ntime                 7.330 \u03bcs   (7.081 \u03bcs .. 7.612 \u03bcs)\n                     0.988 R\u00b2   (0.982 R\u00b2 .. 0.994 R\u00b2)\nmean                 7.502 \u03bcs   (7.272 \u03bcs .. 7.762 \u03bcs)\nstd dev              848.2 ns   (712.6 ns .. 1.022 \u03bcs)\nvariance introduced by outliers: 89% (severely inflated)\n\nbenchmarking anyFM\ntime                 5.668 \u03bcs   (5.451 \u03bcs .. 6.008 \u03bcs)\n                     0.987 R\u00b2   (0.975 R\u00b2 .. 0.996 R\u00b2)\nmean                 5.807 \u03bcs   (5.659 \u03bcs .. 5.975 \u03bcs)\nstd dev              542.5 ns   (446.4 ns .. 721.8 ns)\nvariance introduced by outliers: 86% (severely inflated)\n</code></pre>\n\n<p>Your version (<code>exists</code>) is indeed the fastest, and the <code>foldr</code> versions are rather slow.</p>\n\n<p>With <code>ghc -O2</code>, your version (<code>exists</code>) is the slowest, and all other functions are nearly equally fast to each other:</p>\n\n<pre><code>benchmarking exists\ntime                 753.5 ns   (725.4 ns .. 779.9 ns)\n                     0.990 R\u00b2   (0.986 R\u00b2 .. 0.995 R\u00b2)\nmean                 762.4 ns   (737.0 ns .. 787.0 ns)\nstd dev              82.47 ns   (66.79 ns .. 105.1 ns)\nvariance introduced by outliers: 91% (severely inflated)\n\nbenchmarking existsOr\ntime                 491.5 ns   (478.2 ns .. 503.2 ns)\n                     0.994 R\u00b2   (0.992 R\u00b2 .. 0.996 R\u00b2)\nmean                 494.5 ns   (481.1 ns .. 512.9 ns)\nstd dev              54.97 ns   (42.54 ns .. 80.34 ns)\nvariance introduced by outliers: 92% (severely inflated)\n\nbenchmarking any\ntime                 461.2 ns   (442.0 ns .. 479.7 ns)\n                     0.989 R\u00b2   (0.985 R\u00b2 .. 0.993 R\u00b2)\nmean                 456.0 ns   (439.3 ns .. 476.3 ns)\nstd dev              60.04 ns   (47.27 ns .. 89.47 ns)\nvariance introduced by outliers: 94% (severely inflated)\n\nbenchmarking anyF\ntime                 436.9 ns   (415.8 ns .. 461.0 ns)\n                     0.978 R\u00b2   (0.967 R\u00b2 .. 0.988 R\u00b2)\nmean                 450.8 ns   (430.1 ns .. 472.6 ns)\nstd dev              70.64 ns   (57.04 ns .. 85.92 ns)\nvariance introduced by outliers: 96% (severely inflated)\n\nbenchmarking anyFM\ntime                 438.9 ns   (426.9 ns .. 449.5 ns)\n                     0.993 R\u00b2   (0.989 R\u00b2 .. 0.996 R\u00b2)\nmean                 435.8 ns   (421.4 ns .. 447.6 ns)\nstd dev              45.32 ns   (36.73 ns .. 58.74 ns)\nvariance introduced by outliers: 90% (severely inflated)\n</code></pre>\n\n<p>If one looks into the simplified Core code (<code>ghc -O2 -ddump-simpl</code>), one sees that there are no <code>foldr</code>s anymore (with <code>-O0</code>, everything is still in there, <code>fold</code>s included).</p>\n\n<p>I would thus venture to say that your code is faster (in the un-optimized version, <code>-O0</code>) than the library code, because it is simpler (for the potential price of being less general). The optimized library code is faster than your version, since it is written in a way that its optimization potential is recognized by the compiler. (admittedly, this is a bit of guess work)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6428287"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "accepted_answer_id": 42256254, "answer_count": 1, "score": 4, "last_activity_date": 1525970977, "creation_date": 1487159419, "last_edit_date": 1525970977, "question_id": 42248592, "link": "https://stackoverflow.com/questions/42248592/haskell-ghc-performance-of-any-all", "title": "Haskell/GHC performance of `any`/`all`", "body": "<p>I wrote quantification functions <code>exists</code>, <code>forall</code>, and <code>none</code> for Haskell's build-in <code>[]</code> list data type. On multiple occasions, these seemed to prove much more efficient than <code>Prelude</code>/<code>Data.List</code>s <code>any</code> and <code>all</code>. I naively suspect that this performance is due to <code>any</code> and <code>all</code> being implemented using \u0398(n) folds. Since I am relatively new to Haskell, I think I must be mistaken, or that there would be a good reason for this phenomenon.</p>\n\n<p>From <code>Data.Foldable</code>:</p>\n\n<pre><code>-- | Determines whether any element of the structure satisfies the predicate.\nany :: Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool\nany p = getAny #. foldMap (Any #. p)\n\n-- | Determines whether all elements of the structure satisfy the predicate.\nall :: Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool\nall p = getAll #. foldMap (All #. p)\n</code></pre>\n\n<p>My implementations:</p>\n\n<pre><code>exists :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\nexists _    []                   = False\nexists pred (x : xs) | pred x    = True\n                     | otherwise = exists pred xs\n</code></pre>\n\n<p>and</p>\n\n<pre><code>forall pred  =  not . exists (not . pred)\nnone pred  =  not . exists pred  =  forall (not . pred)\n</code></pre>\n\n<p>Eliminating boolean inversions:</p>\n\n<pre><code>forall, none :: (a -&gt; Bool) -&gt; [a] -&gt; Bool\n\nforall _    []                   = True\nforall pred (x : xs) | pred x    = forall pred xs\n                     | otherwise = False\n\nnone _    []                   = True\nnone pred (x : xs) | pred x    = False\n                   | otherwise = none pred xs\n</code></pre>\n\n<p><code>all</code>:</p>\n\n<pre><code>time                 327.8 \u03bcs   (322.4 \u03bcs .. 333.0 \u03bcs)\n                     0.997 R\u00b2   (0.996 R\u00b2 .. 0.998 R\u00b2)\nmean                 328.7 \u03bcs   (324.1 \u03bcs .. 334.2 \u03bcs)\nstd dev              16.95 \u03bcs   (14.63 \u03bcs .. 22.02 \u03bcs)\n</code></pre>\n\n<p>and <code>forall</code>:</p>\n\n<pre><code>time                 113.2 \u03bcs   (111.2 \u03bcs .. 115.0 \u03bcs)\n                     0.997 R\u00b2   (0.996 R\u00b2 .. 0.998 R\u00b2)\nmean                 112.0 \u03bcs   (110.0 \u03bcs .. 113.9 \u03bcs)\nstd dev              6.333 \u03bcs   (5.127 \u03bcs .. 7.896 \u03bcs)\n</code></pre>\n\n<p>Performance measured using criterion's <code>nf</code>.</p>\n\n<hr>\n\n<p>As anticipated, I did not reinvent the fold, but had underestimated compiler flags, and naively did not expect <code>-O2</code> to make such drastic overall difference compared to default optimization level performance, nor the optimization effectiveness disparity between the individual custom-wrote and library formulations. Many highly effective specialized standard function optimizations evidently kick in only when explicitly enabled.</p>\n\n<p>The \"performance\" section of the Haskell tag info emphasizes importance of optimization level compiler flags when testing code efficiency. It is generally advised to trust the sophistication of library function implementations, and, rather than rewire <code>RULES</code> pragmas or reformulate basic forms, to try exploiting already cultivated optimization potential.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1487159477, "post_id": 42248561, "comment_id": 71655263, "body": "Because of the dot operator?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1487182898, "post_id": 42248561, "comment_id": 71672161, "body": "I feel like the extant answers don&#39;t actually address your question straight on: they say &quot;how to fix it&quot; but not &quot;why it&#39;s wrong&quot;. The one-sentence answer to that part is pretty simple: function application has higher precedence than any infix operator, including <code>(.)</code>. (I don&#39;t really think this one sentence adds enough value to warrant putting in yet another answer, though.)"}], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 7, "last_activity_date": 1487159555, "creation_date": 1487159555, "answer_id": 42248642, "question_id": 42248561, "link": "https://stackoverflow.com/questions/42248561/haskell-function-return-values/42248642#42248642", "title": "Haskell function return values", "body": "<p>The <code>.</code> function is defined as this:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>The function composed by the <code>.</code> operator must accept an argument. Therefore,</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>dotEx1 = map(+3) . filter (&gt;100)\n</code></pre>\n\n<p>Is the same as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>dotEx1 xs = (map(+3) . filter (&gt;100)) xs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1487160116, "last_edit_date": 1487160116, "creation_date": 1487159744, "answer_id": 42248711, "question_id": 42248561, "link": "https://stackoverflow.com/questions/42248561/haskell-function-return-values/42248711#42248711", "title": "Haskell function return values", "body": "<p>The dot operator has signature:</p>\n\n<pre><code>(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c\n</code></pre>\n\n<p>here the operator is used <em>infix</em>. So in your first statement you have actually written:</p>\n\n<pre><code>dotEx1 = (.) (map (+3)) (filter (&gt;100))\n</code></pre>\n\n<p>And that makes sense since <code>filter (&gt;100)</code> has signature: <code>(Num n,Ord n) =&gt; [n] -&gt; [n]</code> and <code>map (+3)</code> has signature <code>Num n =&gt; [n] -&gt; [n]</code>. If you however write:</p>\n\n<pre><code>dotEx1 xs = (.) (map (+3)) (filter (&gt;100) xs)\n</code></pre>\n\n<p>then <code>filter (&gt;100) xs</code> has signature <code>(Num n,Ord n) =&gt; [n]</code> and so this is a value (not a function, or perhaps a function with no arguments). So the dot operator cannot be used (the types do not match).</p>\n\n<p>Informally the dot operator should be given two functions <code>f</code> and <code>g</code> and it generates a function where <code>f</code> is applied <em>after</em> <code>g</code> is applied on the input. But <code>g</code> thus has to be a function taking one argument.</p>\n"}, {"tags": [], "owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "is_accepted": false, "score": 3, "last_activity_date": 1487160862, "creation_date": 1487160862, "answer_id": 42249127, "question_id": 42248561, "link": "https://stackoverflow.com/questions/42248561/haskell-function-return-values/42249127#42249127", "title": "Haskell function return values", "body": "<p>The dot operator has low precedence because you want to partially apply functions. That is, </p>\n\n<pre><code>map (+3) . filter (&gt;100)\n</code></pre>\n\n<p>is read as</p>\n\n<pre><code>(map (+3)) . (filter (&gt;100))\n</code></pre>\n\n<p>By extension you get</p>\n\n<pre><code>dotEx1 xs = (map (+3)) . (filter (&gt;100) xs)\n</code></pre>\n\n<p>instead of </p>\n\n<pre><code>dotEx1 xs = (map (+3) . filter (&gt;100)) xs\n</code></pre>\n\n<p>A more readable version that also works:</p>\n\n<pre><code>dotEx1 xs = map (+3) . filter (&gt;100) $ xs\n</code></pre>\n"}], "owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1487161032, "creation_date": 1487159331, "question_id": 42248561, "link": "https://stackoverflow.com/questions/42248561/haskell-function-return-values", "title": "Haskell function return values", "body": "<p>what is the difference between</p>\n\n<pre><code>dotEx1 = map(+3) . filter (&gt;100)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>dotEx1 xs = map(+3) . filter (&gt;100) xs\n</code></pre>\n\n<p>since </p>\n\n<pre><code>myFilter xs = filter (&gt;100) xs \n</code></pre>\n\n<p>and </p>\n\n<pre><code>myFilter = filter (&gt;100) \n</code></pre>\n\n<p>are the same why isn't </p>\n\n<pre><code>dotEx1 = map(+3) . filter (&gt;100)\n</code></pre>\n\n<p>and </p>\n\n<pre><code>dotEx1 xs = map(+3) . filter (&gt;100) xs\n</code></pre>\n\n<p>the same?</p>\n"}, {"tags": ["haskell", "generics", "types", "type-level-computation"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487155370, "post_id": 42244147, "comment_id": 71652408, "body": "1. <code>ScopedTypeVariables</code> 2. One example doesn&#39;t define a semantics."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487155842, "post_id": 42244147, "comment_id": 71652745, "body": "Thanks for 1. I am surprised the compiler did not warned me about that (I thought I had it defined at the package level, which is not the case), but I know understand I did not understand this flag!"}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487156075, "post_id": 42244147, "comment_id": 71652908, "body": "@user2407038 I agree with 2. but it the semantics seems to me pretty clear: <code>graft</code> is used to update some element in a tree structure in a &quot;generic&quot; way, e.g. without having to define explicit update functions (or lenses). As I mention at the beginning of this question, the underlying motivation is to handle migration of getters for data structures in a way that ensures all previous versions are taken care of and produce the correct data."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487158034, "post_id": 42244147, "comment_id": 71654317, "body": "GHC could not possibly know the programmers intent, so it couldn&#39;t possibly know that you need ScopedTypeVariables, in particular since enabling this extension may cause type correct code to no longer type check. Your semantics are stated entirely in terms of what you abstractly hope to achieve, but there is a huge gulf between abstract semantics and concrete semantics. It is entirely unclear what <code>obj</code> and <code>idx</code> are meant to represent, and what part of your code represents the &#39;history of the type&#39;, or even how to represent any particular type, at least to me."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487164114, "post_id": 42244147, "comment_id": 71658382, "body": "As already said: It appears I did not understand <code>ScopedTypeVariables</code> and I owe you this enlightenment, hence my remark which should be understood sequentially: First I read your comment, which fixes my issue. Then I am surprised the compiler did not warn me about this missing extension. Finally, I understand this extension did not mean what I initially thought it meant which caused my initial surprise... Hope this clarifies 1st point."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487165078, "post_id": 42244147, "comment_id": 71659029, "body": "@user2407038 Thanks for your Socratic questions which give me the incentive to try to clarify my thoughts and goal"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487168953, "post_id": 42244147, "comment_id": 71661809, "body": "I think I understand now - <code>Ap F1 ((12 :: Int):-: (&quot;bar&quot; :: Text))</code> is supposed to represent something like <code>data F1 = F1 Int Text</code>. I don&#39;t think you need to represent the actual value of the data at the type level, just the shape of it. (trying to do this will make your code much more complex and also severely restrict what you can do). Furthermore, there is no way for you to produce the type <code>&quot;foo&quot;</code> from the value <code>&quot;foo&quot;</code> (at best you can get an existentially quantified Symbol, but this isn&#39;t a real issue - the &quot;foo&quot; arg could just be a type level arg)."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487169103, "post_id": 42244147, "comment_id": 71661947, "body": "Most importantly, your 2nd point is not even true! <code>obj = Ap Obj3 (Ap F1 ((12 :: Int):-: (&quot;bar&quot; :: Text)) :-: Ap F2 (&quot;baz&quot; :: Text))</code> is a value, not a type, so you do not have &quot;types instead of values as nodes&quot;. (this is the advantage of clearly stating the semantics - without such a statement it&#39;s not possible to tell if you have made a mistake in implementation or I simply don&#39;t understand what you want to do)"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487169394, "post_id": 42244147, "comment_id": 71662149, "body": "And finally, it seems like you are just trying to recreating lenses, but without referring to the actual type in the implementation of the lens, instead to the &#39;representation&#39; of the type (for which you are probably best off using some existing generic mechanism instead of trying to roll your own). Why do lenses not satisfy your requirements? You can still use <code>Nat</code> indices to denote the &#39;position&#39; in the type, but the underlying semantics seems to me to be just that of lenses."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487178530, "post_id": 42244147, "comment_id": 71669356, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/135790/discussion-between-insitu-and-user2407038\">continue this discussion in chat</a>."}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1487165014, "creation_date": 1487147311, "last_edit_date": 1495542838, "question_id": 42244147, "link": "https://stackoverflow.com/questions/42244147/how-to-generically-replace-some-part-of-a-haskell-data-structure", "title": "How to generically replace some part of a Haskell data structure?", "body": "<p>This post is a follow-up to a <a href=\"https://stackoverflow.com/questions/42179682/how-to-handle-data-structure-migration-in-a-compositional-way-in-haskell\">previous post</a>...</p>\n\n<p>I am trying to handle the sub-problem of updating a structure in a generic way, with the ultimate goal of being able to write something like that:</p>\n\n<pre><code> g = graft idx \"foo\" obj\n   where\n     idx = Proxy :: Proxy '[1,0]\n     obj = Ap Obj3 (Ap F1 ((12 :: Int):-: (\"bar\" :: Text)) :-: Ap F2 (\"baz\" :: Text))\n</code></pre>\n\n<p>Here are some clarifications upon the intended \"semantics\" of <code>graft</code>:</p>\n\n<ol>\n<li><code>obj</code> is meant to be a multiway tree representing some data structure in a generic way. It is expected to be constructed with 2 elements: Nested pairs represent (horizontal) sequences of nodes, <code>Ap f a</code> represents suspended application of some function <code>f</code> to some argument <code>a</code>, where <code>a</code> can be a sequence of arguments as mentioned, </li>\n<li>Each \"instance\" of <code>obj</code> has a type which mimics the tree structure of the values, but of course with types instead of values as nodes,</li>\n<li><code>idx</code> represents a <em>path</em> in the multiway tree <code>obj</code> as a sequence of indices to reach some point in the tree</li>\n<li><code>graft</code> then replaces the element from <code>obj</code> at <code>path</code> with some other value (in the case of the example, <code>\"foo\"</code>). The idea is that <code>graft</code> works recursively from the root of the tree, following each segment of <code>path</code> until it finds the node and replaces the value with <code>a</code>, all in a type-safe way: The replacement value <code>a</code> should have the same type than the node at <code>path</code> in the grafted tree.</li>\n</ol>\n\n<p>In the case of the given example, when <code>g</code> is evaluated, it should yield the following structure: </p>\n\n<pre><code> obj = Ap Obj3 (Ap F1 (12 :-: \"bar\") :-: Ap F2 \"foo\")\n</code></pre>\n\n<p>I have tried to define the <code>Graft</code> typeclass to handle traversing a data structure given some path:</p>\n\n<pre><code> class Graft a path b where\n   graft :: path -&gt; a -&gt; b -&gt; b\n</code></pre>\n\n<p>then instances are defined using type-level lists of <code>Nat</code>s:</p>\n\n<pre><code> type a :-: b = (a, b)\n infixr 5 :-:\n\n pattern (:-:) :: a -&gt; b -&gt; (a ,b)\n pattern a :-: b = (a ,b)\n\n instance Graft a (Proxy '[0]) (a :-: b) where\n   graft _ a (_ :-: b) = a :-: b\n\n instance Graft a (Proxy '[]) a where\n   graft _ a _ = a\n</code></pre>\n\n<p>Things go awry when I try to apply <code>graft</code> recursively. The following instance do not compile</p>\n\n<pre><code> instance (Graft a (Proxy k) b) =&gt; Graft a (Proxy (0 ': k)) (b :-: c) where\n   graft _ a (b :-: c) = graft p a b :-: c\n     where\n       p = Proxy :: Proxy k\n</code></pre>\n\n<p>yielding the message:</p>\n\n<pre><code>  error:\n      \u2022 Could not deduce (Graft a (Proxy k4) b)\n          arising from a use of \u2018graft\u2019\n        from the context: Graft a (Proxy k) b\n          bound by the instance declaration\n          at /Users/arnaud/projects/gorillaspace/gorilla-space/hevents/.stack-work/intero/intero398uMH.hs:65:10-68\n        The type variable \u2018k4\u2019 is ambiguous\n        Relevant bindings include\n          b :: b\n            (bound at /Users/arnaud/projects/gorillaspace/gorilla-space/hevents/.stack-work/intero/intero398uMH.hs:66:14)\n          a :: a\n            (bound at /Users/arnaud/projects/gorillaspace/gorilla-space/hevents/.stack-work/intero/intero398uMH.hs:66:11)\n          graft :: Proxy (0 : k) -&gt; a -&gt; b :-: c -&gt; b :-: c\n            (bound at /Users/arnaud/projects/gorillaspace/gorilla-space/hevents/.stack-work/intero/intero398uMH.hs:66:3)\n      \u2022 In the first argument of \u2018(:-:)\u2019, namely \u2018graft p a b\u2019\n        In the expression: graft p a b :-: c\n        In an equation for \u2018graft\u2019:\n            graft _ a (b :-: c)\n              = graft p a b :-: c\n              where\n                  p = Proxy :: Proxy k\n</code></pre>\n\n<p>The following instances which complete the traversals do not compile either, yielding the same kind of error:</p>\n\n<pre><code> instance (Graft a (Proxy (n-1 : k)) c) =&gt; Graft a (Proxy (n ': k)) (b :-: c) where\n   graft _ a (b :-: c) = b :-:  graft p a c\n     where\n       p = Proxy :: Proxy (n-1 : k)\n\n instance (Graft a (Proxy k) b) =&gt; Graft a (Proxy (0 ': k)) (Ap f b c) where\n   graft _ a (Ap f b) = Ap f (graft p a b)\n     where\n       p = Proxy :: Proxy k\n</code></pre>\n\n<p>So it seems the destructured type-level variables <code>k</code> is not \"visible\" in the recursive call to <code>graft</code>, a problem which I don't know how to fix.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 1, "creation_date": 1487148348, "post_id": 42244334, "comment_id": 71647225, "body": "You could go into the depths of  <code>applyTwice (\\x -&gt; [x])</code> and what language extensions are required there..."}, {"owner": {"reputation": 1250, "user_id": 2451480, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/95e45762c034523ac9d3948ba3b15bb9?s=128&d=identicon&r=PG", "display_name": "TFuto", "link": "https://stackoverflow.com/users/2451480/tfuto"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1611686943, "post_id": 42244334, "comment_id": 116529674, "body": "@Franky: I don&#39;t understand this comment, but I am very interested. What do you mean by this?"}], "tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": true, "score": 4, "last_activity_date": 1487148339, "last_edit_date": 1487148339, "creation_date": 1487147890, "answer_id": 42244334, "question_id": 42243902, "link": "https://stackoverflow.com/questions/42243902/haskell-function-type-clarification/42244334#42244334", "title": "Haskell function type clarification", "body": "<p>We have:</p>\n\n<pre><code>applyTwice f x = f(f x)\n</code></pre>\n\n<p>This would make sense only if the types of <code>x</code> and <code>f x</code> were equivalent (else how would you be able to pass <code>f x</code> to a function that takes <code>x</code>?). Therefore, you could say that <code>applyTwice</code> takes 2 input arguments:</p>\n\n<ul>\n<li>A function that takes a type t and returns the same type t</li>\n<li>An input of some type</li>\n</ul>\n\n<p>Now this input could be of any type, say t1. But you also have to be able to apply the function to this input, and so the type of the input must also be t. Put together, we get the signature:</p>\n\n<pre><code>applyTwice :: (t -&gt; t) -&gt; t -&gt; t\n</code></pre>\n\n<p>Remember that only the last term is the return type, and all others are types of the inputs.</p>\n\n<p>Now consider:</p>\n\n<pre><code>applyOnce f x = f x\n</code></pre>\n\n<p>Simplistically, all it says about the function f is that it should be able to accept an input x of any type. There is nothing about what type the function should return <strong>except</strong> that <code>applyOnce</code> should also return that same type. Hence, we end up with the signature you see:</p>\n\n<pre><code>applyOnce :: (t1 -&gt; t) -&gt; t1 -&gt; t\n</code></pre>\n\n<p>where t1 could be any type and t could be any type (same or different from t1), but requiring that the return type of <code>f</code> matches the return type of <code>applyOnce</code>, represented by t here.</p>\n\n<p>TL;DR: Your function signature for a function with n inputs will always have (n+1) terms, and the last term will be the return type of the function. </p>\n\n<p>However, you should note that this is not actually how things work under the hood. All functions in Haskell actually take one argument i.e. they are <em>curried</em>. You can read more about this <a href=\"https://wiki.haskell.org/Currying\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1487154940, "post_id": 42244435, "comment_id": 71652091, "body": "Thanks for the explanation. In (applyTwice :: (t1 -&gt; t) -&gt; t1 -&gt; t), the third argument (t1) mentions the type of the output of the intermediate value. But in (applyOnce :: (t1 -&gt; t) -&gt; t1 -&gt; t) does the third argument simply just mean that (t1) is of the same type as input passed to the function. The reason why it is confusing is that in applyOnce there are only 3 parties 1. Function, 2. Input type and 3 Output type. Why do we have 4 types in the type declaration?"}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1487243322, "post_id": 42244435, "comment_id": 71700392, "body": "@Srinivas The type declaration of <code>f</code> is only expressible in 2 types: The input type and the output type. So you need 2 types to specify <code>f</code>, one type to specify the input and one type for the output, which equals four types. You are correct in the assumption that <code>t1</code> is the type of the second argument to <code>applyOnce</code> <i>as well as</i> the first argument of <code>f</code>."}, {"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1487265310, "post_id": 42244435, "comment_id": 71717638, "body": "Thanks for the clarification"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 1, "last_activity_date": 1487148246, "creation_date": 1487148246, "answer_id": 42244435, "question_id": 42243902, "link": "https://stackoverflow.com/questions/42243902/haskell-function-type-clarification/42244435#42244435", "title": "Haskell function type clarification", "body": "<h3>Return types</h3>\n\n<p>What arguments a function takes and what a function returns is quite a tricky question in Haskell, because of special stuff like partial application.</p>\n\n<p>The <code>map</code> function looks like it takes an <code>f :: a -&gt; b</code>, the transformation function and a list <code>xs :: [a]</code> and returns a list of <code>ys :: [b]</code> with each element of <code>xs</code> transformed per <code>f</code>. But <code>map</code> can also be seen as a function which takes a simple function <code>f</code> and returns <em>another</em> function, which acts upon lists and returns lists.</p>\n\n<p>What I do to help me reason about arguments is first separate all types delimited by top level <code>-&gt;</code>s. For example <code>map</code>:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n-- gives us\n-- (a -&gt; b) and [a] and [b]\n</code></pre>\n\n<p>The rightmost type is what is traditionally called the \"return type\" when map is called with all its arguments provided. The other types are the arguments I have to use, for example in the function definition.</p>\n\n<p>Take this with a grain of salt, as you will see plenty of examples of definitions of functions which do not use all arguments explicitly to define the function.</p>\n\n<hr>\n\n<p>Coming to your second question, you apparently mix up the arguments and the function body. Taking <code>applyTwice</code>:</p>\n\n<pre><code>applyTwice f x = f (f x)\n</code></pre>\n\n<p><code>f</code> and <code>x</code> are the arguments to <code>applyTwice</code> and <code>f (f x)</code> is the function body. Now <code>f</code> must be a function, since it is applied to an argument <code>x</code>. <code>x</code>'s type can be anything, let's call it <code>t</code>. Now f must go from <code>t</code>, the type of <code>x</code> to something else, call it <code>s</code>. But now <code>f x</code>, which has type <code>s</code> is an argument to <code>f</code> again, so the compiler can deduce that <code>s ~ t</code>. Now <code>f (f x)</code> is again of type <code>s</code>, which must be the same as <code>t</code>, which means you end up with:</p>\n\n<pre><code>applyTwice :: (t -&gt; t) -&gt; t -&gt; t\n</code></pre>\n\n<p>Analogously you can try this for <code>applyOnce</code> and see that its type is <code>(t -&gt; s) -&gt; t -&gt; s</code>, which is just <code>$</code> from the <code>Prelude</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1487153723, "post_id": 42244479, "comment_id": 71651119, "body": "Thanks for the explanation, In"}, {"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1487156113, "post_id": 42244479, "comment_id": 71652930, "body": "In (applyTwice :: (t1 -&gt; t) -&gt; t1 -&gt; t), the third argument (t1) mentions the type of the output of the intermediate value. But in (applyOnce :: (t1 -&gt; t) -&gt; t1 -&gt; t) does the third argument simply just mean that (t1) is of the same type as input passed to the function? The reason why it is confusing is that in applyOnce there are only 3 parties 1. Function, 2. Input type and 3 Output type. Why do we have 4 types in the type declaration?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 1, "creation_date": 1487163693, "post_id": 42244479, "comment_id": 71658107, "body": "@Srinivas Because 1. is not just &quot;Function&quot; (<code>-&gt;</code>) but &quot;Function from Input type to Output type&quot; (<code>t1 -&gt; t</code>). If you want to add redundant parentheses, you can see the three parties in <code>(t1 -&gt; t) -&gt; (t1) -&gt; (t)</code> -- now each party has its parentheses."}, {"owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "edited": false, "score": 0, "creation_date": 1487265391, "post_id": 42244479, "comment_id": 71717696, "body": "Thanks for the explanation"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1487312839, "post_id": 42244479, "comment_id": 71737441, "body": "Fixed an error (should&#39;ve been <b>applyTwice</b>) in the explanation of the first type"}], "tags": [], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "is_accepted": false, "score": 1, "last_activity_date": 1487312796, "last_edit_date": 1487312796, "creation_date": 1487148387, "answer_id": 42244479, "question_id": 42243902, "link": "https://stackoverflow.com/questions/42243902/haskell-function-type-clarification/42244479#42244479", "title": "Haskell function type clarification", "body": "<p>Let's translate Haskell to English.</p>\n\n<p><code>applyTwice :: (t -&gt; t) -&gt; t -&gt; t</code> means that <strong>applyTwice</strong> accepts a function from a <code>t</code> to a <code>t</code> and a value <code>t</code> and returns a <code>t</code>. Indeed, if we look at the definition, we see that it applies a function <code>f</code> to a value <code>x</code> and feeds the result into <code>f</code> once more. This implies - as indicated by the type signature - that <code>f</code> and <code>f x</code> must have the same type <code>t</code> (since <code>f</code> only accepts a <code>t</code> as an argument).</p>\n\n<p>In contrast, <code>applyOnce :: (t1 -&gt; t) -&gt; t1 -&gt; t</code> allows for <code>f x</code> and <code>x</code> to have different types (<code>t</code> and <code>t1</code> respectively), since this function doesn't feed the output of <code>f</code> (of type <code>t</code>) back into <code>f</code>.</p>\n\n<p>I think the confusion stems from the fact that you fail to distinguish between <code>f</code> (the function) and <code>f x</code> (the result of the function).</p>\n\n<p>Lastly, the type you suggest for <code>applyOnce</code> (namely <code>(t1 -&gt; t) -&gt; t</code>) implies (nay <em>affirms</em>) that you can get the result of a function without providing an argument; remember that <code>(t1 -&gt; t)</code> is the input type (a function) and <code>t</code> is the output type. How do you calculate <code>f(x)</code> without an <code>x</code>?</p>\n"}], "owner": {"reputation": 1627, "user_id": 5964853, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/502f299d16be599d15334e99a5581705?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas", "link": "https://stackoverflow.com/users/5964853/srinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 2, "accepted_answer_id": 42244334, "answer_count": 3, "score": 2, "last_activity_date": 1487312796, "creation_date": 1487146514, "last_edit_date": 1487149345, "question_id": 42243902, "link": "https://stackoverflow.com/questions/42243902/haskell-function-type-clarification", "title": "Haskell function type clarification", "body": "<p>I am trying to understand Haskell type variables for functions. I wrote a function:</p>\n\n<pre><code>applyTwice f x = f(f x)\n</code></pre>\n\n<p>I tried to understand the type variables for this function, so I did a <code>:t applyTwice</code>. This is how Haskell interprets the types:</p>\n\n<pre><code>applyTwice :: (t -&gt; t) -&gt; t -&gt; t\n</code></pre>\n\n<p>Then I created another function:</p>\n\n<pre><code>applyOnce f x = f x\n</code></pre>\n\n<p>This time for <code>:t</code> Haskell returns</p>\n\n<pre><code>applyOnce :: (t1 -&gt; t) -&gt; t1 -&gt; t\n</code></pre>\n\n<p>My questions are </p>\n\n<ol>\n<li><p>How do we read/understand what these functions take and return?  </p></li>\n<li><p>This is for <code>applyTwice</code>. If they say anything left side of the <code>-&gt;</code> is what the function takes and right hand side is what it returns then should it not be \n<code>applyTwice :: ((t -&gt; t) -&gt; t) -&gt; t</code>? <code>(t -&gt; t)</code> for <code>(f x)</code> and <code>((t -&gt; t) -&gt; t)</code> for <code>f (f x)</code> and the return type being <code>t</code>.  </p></li>\n<li>This is for <code>applyOnce</code>. Why is the function's type interpreted as <code>applyOnce :: (t1 -&gt; t) -&gt; t1 -&gt; t</code>? because we only take a function and return it's value. Should it not be <code>applyOnce :: (t1 -&gt; t) -&gt; t1</code>?</li>\n</ol>\n\n<p>As a beginner in Haskell I would like any advice in this. </p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1487140993, "post_id": 42242084, "comment_id": 71643235, "body": "In general, you can&#39;t do anything to &#39;throw away&#39; the effect of a monadic action. If you actually want to keep both effects, then your function is <code>\\x f -&gt; x &gt;&gt;= \\a -&gt; f a &gt;&gt; return a</code>."}, {"owner": {"reputation": 649, "user_id": 2998746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fc15b842026d8a039ffdd1b2a528aec?s=128&d=identicon&r=PG&f=1", "display_name": "Euge", "link": "https://stackoverflow.com/users/2998746/euge"}, "edited": false, "score": 1, "creation_date": 1487160908, "post_id": 42242084, "comment_id": 71656192, "body": "In the most general case, the <i>result</i> given by a monadic function depends on its <i>efect</i> (or its secret), so I don&#39;t think you can just avoid the efect of some chosen monadic function. (I&#39;m thinking about IO... what if <code>m a</code> takes the <code>a</code> from the standard input?)"}], "answers": [{"comments": [{"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 2, "creation_date": 1487141538, "post_id": 42242424, "comment_id": 71643503, "body": "An example of why you don&#39;t want <code>ma &gt;&gt;= f &gt;&gt; ma</code>: that does something very different in <code>IO</code> when <code>ma</code> is something like <code>spendMoney</code>! :-)  Or more prosaically: <code>getLine &gt;&gt;= print &gt;&gt; getLine</code> reads in two lines, <code>keepValue getLine print</code> reads in only one."}], "tags": [], "owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "is_accepted": false, "score": 1, "last_activity_date": 1487141308, "creation_date": 1487141308, "answer_id": 42242424, "question_id": 42242084, "link": "https://stackoverflow.com/questions/42242084/haskell-run-two-monads-keep-the-result-of-the-first-one/42242424#42242424", "title": "Haskell: Run two monads, keep the result of the first one", "body": "<p>This structure looks a lot like the definition of <code>&gt;&gt;=</code>/<code>&gt;&gt;</code> for <code>Monad Maybe</code>.</p>\n\n<pre><code>case foo of\n    Nothing -&gt; Nothing\n    Just _ -&gt; bar\n\nfoo &gt;&gt;= \\_ -&gt; bar\nfoo &gt;&gt; bar\n</code></pre>\n\n<p>so your original expression could be simplified to</p>\n\n<pre><code>ma &gt;&gt;= f &gt;&gt; ma\n</code></pre>\n\n<p>and this works for other monads.</p>\n\n<p>However, I don't think this is actually what you want, as you can see <code>ma</code> occurring twice. Instead, take the value from the first <code>ma &gt;&gt;=</code> bind, and carry it through to the end of the computation.</p>\n\n<pre><code>keepValue ma f =\n    ma &gt;&gt;= \\a -&gt;\n    f a &gt;&gt;\n    return a\n</code></pre>\n\n<p>or in <code>do</code>-notation</p>\n\n<pre><code>keepValue ma f = do\n    a &lt;- ma\n    f a\n    return a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "edited": false, "score": 3, "creation_date": 1487144110, "post_id": 42242450, "comment_id": 71644870, "body": "You mean <code>import Control.Arrow; keepValue ma f = ma &gt;&gt;= uncurry (&gt;&gt;) . (f &amp;&amp;&amp; return)</code> doesn&#39;t count as a nice trick? ;-P"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 179940, "user_id": 20713, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/09b9758a4a83cc25547eb93891f19df7?s=128&d=identicon&r=PG", "display_name": "ephemient", "link": "https://stackoverflow.com/users/20713/ephemient"}, "edited": false, "score": 4, "creation_date": 1487144262, "post_id": 42242450, "comment_id": 71644936, "body": "@ephemient: I prefer <code>(. ((&lt;$) &lt;*&gt;)) . (&gt;&gt;=)</code>, personally :-)  Or <code>ma &gt;&gt;= (&lt;$) &lt;*&gt; f</code>, if you really like variable names!"}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1487148771, "post_id": 42242450, "comment_id": 71647462, "body": "These are the times when even perl coders get pale with envy of us haskellers, because when our cats walk over the keyboard it is type checked"}], "tags": [], "owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "is_accepted": true, "score": 11, "last_activity_date": 1487141440, "creation_date": 1487141440, "answer_id": 42242450, "question_id": 42242084, "link": "https://stackoverflow.com/questions/42242084/haskell-run-two-monads-keep-the-result-of-the-first-one/42242450#42242450", "title": "Haskell: Run two monads, keep the result of the first one", "body": "<p>Let's walk through this!</p>\n\n<pre><code>keepValue :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m a\nkeepValue ma f = _\n</code></pre>\n\n<p>So what do we want <code>keepValue</code> to do?  Well, the first thing we should do is use <code>ma</code>, so we can connect it to <code>f</code>.</p>\n\n<pre><code>keepValue :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m a\nkeepValue ma f = do\n  a &lt;- ma\n  _\n</code></pre>\n\n<p>Now we have a value <code>va</code> of type <code>a</code>, so we can pass it to <code>f</code>.</p>\n\n<pre><code>keepValue :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m a\nkeepValue ma f = do\n  va &lt;- ma\n  vb &lt;- f va\n  _\n</code></pre>\n\n<p>And finally, we want to produce <code>va</code>, so we can just do that:</p>\n\n<pre><code>keepValue :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m a\nkeepValue ma f = do\n  va &lt;- ma\n  vb &lt;- f va\n  return va\n</code></pre>\n\n<p>This is how I'd walk through writing the first draft of any monadic function like this.  Then, I'd clean it up.  First, some small things: since <code>Applicative</code> is a superclass of <code>Monad</code>, I prefer <code>pure</code> to <code>return</code>; we didn't use <code>vb</code>; and I'd drop the <code>v</code> in the names.  So for a <code>do</code>-notation based version of this function, I think the best option is</p>\n\n<pre><code>keepValue :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m a\nkeepValue ma f = do\n  a &lt;- ma\n  _ &lt;- f a\n  pure a\n</code></pre>\n\n<p>Now, however, we can start to make the implementation better.  First, we can replace <code>_ &lt;- f va</code> with an explicit call to <code>(&gt;&gt;)</code>:</p>\n\n<pre><code>keepValue :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m a\nkeepValue ma f = do\n  a &lt;- ma\n  f a &gt;&gt; pure a\n</code></pre>\n\n<p>And now, we can apply a simplification.  You may know that we can always replace <code>(&gt;&gt;=)</code> plus <code>pure</code>/<code>return</code> with <code>fmap</code>/<code>(&lt;$&gt;)</code>: any of <code>pure . f =&lt;&lt; ma</code>, <code>ma &gt;&gt;= pure . f</code>, or <code>do a &lt;- ma ; pure $ f a</code> (all of which are equivalent) can be replaced by <code>f &lt;$&gt; ma</code>.  However, the <code>Functor</code> type class has another, less-well-known method, <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Functor.html#v:-60--36-\"><code>(&lt;$)</code></a>:</p>\n\n<blockquote>\n  <p><code>(&lt;$) :: a -&gt; f b -&gt; f a</code><br>\n  Replace all locations in the input with the same value. The default definition is <code>fmap . const</code>, but this may be overridden with a more efficient version.</p>\n</blockquote>\n\n<p>So we have a similar replacement rule for <code>(&lt;$)</code>: we can always replace <code>ma &gt;&gt; pure b</code> or <code>do ma ; pure b</code> with <code>b &lt;$ ma</code>.  This gives us</p>\n\n<pre><code>keepValue :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m a\nkeepValue ma f = do\n  a &lt;- ma\n  a &lt;$ f a\n</code></pre>\n\n<p>And I think this is the shortest reasonable version of this function!  There aren't any nice point-free tricks to make this cleaner; one indicator of that is the multiple use of <code>a</code> on the second line of the <code>do</code> block.</p>\n\n<hr>\n\n<p>Incidentally, a terminology note: you're running two <em>monadic actions</em>, or two <em>monadic values</em>; you're not running *\"two monads\".  A monad is something like <code>Maybe</code> \u2013 a type constructor which supports <code>(&gt;&gt;=)</code> and <code>return</code>.  Don't mix the values up with the types \u2013 this sort of terminological distinction helps keep things clearer!</p>\n"}, {"tags": [], "owner": {"reputation": 406, "user_id": 1611356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76c330d7f0f21c0b2519a3c675b870fe?s=128&d=identicon&r=PG", "display_name": "Paul Gardiner", "link": "https://stackoverflow.com/users/1611356/paul-gardiner"}, "is_accepted": false, "score": 1, "last_activity_date": 1547072928, "creation_date": 1547072928, "answer_id": 54119337, "question_id": 42242084, "link": "https://stackoverflow.com/questions/42242084/haskell-run-two-monads-keep-the-result-of-the-first-one/54119337#54119337", "title": "Haskell: Run two monads, keep the result of the first one", "body": "<p>You could define:</p>\n\n<pre><code>passThrough f = (&gt;&gt;) &lt;$&gt; f &lt;*&gt; pure\n</code></pre>\n\n<p>and then inplace of</p>\n\n<pre><code>keepValue ma f\n</code></pre>\n\n<p>write</p>\n\n<pre><code>ma &gt;&gt;= passThrough f\n</code></pre>\n\n<p>Then to read a line and print it twice (say) would be</p>\n\n<pre><code>getLine &gt;&gt;= passThrough putStrLn &gt;&gt;= putStrLn\n</code></pre>\n"}], "owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 584, "favorite_count": 0, "accepted_answer_id": 42242450, "answer_count": 3, "score": 5, "last_activity_date": 1547072928, "creation_date": 1487139912, "question_id": 42242084, "link": "https://stackoverflow.com/questions/42242084/haskell-run-two-monads-keep-the-result-of-the-first-one", "title": "Haskell: Run two monads, keep the result of the first one", "body": "<p>Playing with Haskell and now I try to create a function like</p>\n\n<pre><code>keepValue :: (Monad m) =&gt; m a -&gt; (a -&gt; m b) -&gt; m a\n</code></pre>\n\n<p>with following semantic: it should apply monad value to a function, which return the second monad, and <em>keep the <strong>result</strong> of the first monad, but the <strong>effect</strong> of the second one</em></p>\n\n<p>I have a working function in case of <code>Maybe</code> monad:</p>\n\n<pre><code>keepValueMaybe :: Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe a\n\nkeepValue ma f = case ma &gt;&gt;= f of\n    Nothing -&gt; Nothing\n    Just _ -&gt; ma\n</code></pre>\n\n<p>So if the first value is <code>Nothing</code>, the function is not run (so no second side-effect), but if the first value is <code>Just</code>, then, the function is run (with side effect). I keep <strong>effect</strong> of the second computation (e.g., <code>Nothing</code> makes the whole expression <code>Nothing</code>), but the original value.</p>\n\n<p>Now I wonder. Can it work for any monad?</p>\n\n<p>It looks kinda built-in <code>&gt;&gt;</code>, but I couldn't find anything in standard library.</p>\n"}, {"tags": ["haskell", "recursion-schemes", "corecursion"], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 2, "last_activity_date": 1487159448, "last_edit_date": 1487159448, "creation_date": 1487155935, "answer_id": 42247265, "question_id": 42240809, "link": "https://stackoverflow.com/questions/42240809/unfolding-non-empty-structures-to-lists/42247265#42247265", "title": "Unfolding non-empty structures to lists", "body": "<p>You've answered your own question: this operation is naturally structured as an apomorphism, not an anamorphism.</p>\n\n<p>You can, of course, implement <code>apo</code> in terms of <code>ana</code>:</p>\n\n<pre><code>apo :: Functor f =&gt; (a -&gt; f (Either (Fix f) a)) -&gt; a -&gt; Fix f\napo f = ana (either (fmap Left . unFix) f) . Right\n</code></pre>\n\n<p>(I came up with this by dualising \"<code>para</code> in terms of <code>cata</code>\": <code>para f = snd . cata (Fix . fmap fst &amp;&amp;&amp; f)</code>.)</p>\n\n<p>You can just plug your <code>coalg6</code> into this and get a coalgebra which does the same thing when given to <code>ana</code>:</p>\n\n<pre><code>ana5 = ana coalg5 . Right\n    where coalg5 = either (fmap Left . unFix) coalg6\n</code></pre>\n"}], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 42247265, "answer_count": 1, "score": 6, "last_activity_date": 1487159448, "creation_date": 1487133174, "last_edit_date": 1487137196, "question_id": 42240809, "link": "https://stackoverflow.com/questions/42240809/unfolding-non-empty-structures-to-lists", "title": "Unfolding non-empty structures to lists", "body": "<p>I want to write <code>Foldable.toList</code> for a non-empty rose tree using an anamorphism, but it seems impossible to extract the last element:</p>\n\n<pre><code>import Data.Functor.Foldable\n\ndata RoseTree a = RoseNode a [RoseTree a]\n\nana5 :: RoseTree a -&gt; [a]\nana5 = ana coalg5\n\ncoalg5 :: RoseTree a -&gt; ListF a (RoseTree a)\ncoalg5 (RoseNode a []) = Nil\ncoalg5 (RoseNode a (RoseNode b1 b2:t)) = Cons a $ RoseNode b1 (b2 ++ t)\n</code></pre>\n\n<p>Is it indeed impossible and does it generalize to all non-empty structures?</p>\n\n<p>Also (it's sort of an optional bonus question) is there a general rule to determine when <code>Fix f -&gt; Fix g</code> can be implemented using f-algebras but not g-coalgebras?</p>\n\n<p>Btw apomorphism worked:</p>\n\n<pre><code>coalg6 (RoseNode a []) = Cons a $ Left []\ncoalg6 (RoseNode a (RoseNode b1 b2:t)) = Cons a $ Right $ RoseNode b1 (b2 ++ t)\n</code></pre>\n\n<p><code>apo coalg6</code> has the same type as <code>ana5</code> but doesn't lose one element</p>\n"}, {"tags": ["haskell", "dependent-type", "type-families"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1487138594, "post_id": 42240533, "comment_id": 71642208, "body": "You should probably post your edit as an answer (and roll-back the edit)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487149891, "post_id": 42240533, "comment_id": 71648222, "body": "The general issue seems to be that, while GADT pattern matching provides equality constraints, it never provides inequality constraints, so we can&#39;t convince GHC that the first clause of the closed type family is not taken. We probably need more support from GHC to do that in the future, AFAICS."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1487154013, "post_id": 42240533, "comment_id": 71651337, "body": "Ugh, you can tell just from looking at the type that this isn&#39;t going to be easy to prove, even with an inductive <code>Nat</code> (rather than the broken one in <code>GHC.TypeLits</code>). How did you manage to paint yourself into this particular corner? We might be able to advise you on how to redesign your program so that you don&#39;t need such gnarly proofs."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1487166831, "post_id": 42240533, "comment_id": 71660290, "body": "@BenjaminHodgson I &#39;ve been rewriting this over and over for a few days so suggestions are indeed welcome. I am building a <code>Generic1</code> typeclass that should have the structure <code>E s = E0 s | E1 O1 (E s) | E2 O2 (E s) | ...</code> I have implemented various generic functionalities over this so it seems to be working. I want a safe way to extract the <code>Oi</code>s from a given arity <code>i</code> in a type safe way. So (for some notion of <code>i :: Nat</code>) <code>getOp :: Proxy i -&gt; e s -&gt; Maybe (OpType i e)</code>. Since <code>i</code> is known at compile time GHC can (and does) infer what the exact type of the above signature on each call site is."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1487167826, "post_id": 42240533, "comment_id": 71661022, "body": "@BenjaminHodgson so here is the problem: I need to traverse the tree with type level <code>Nat</code> (which can be easily converted from arity to tree depth) because GHC needs to be able to typecheck each step, so I need to tell her (I see it as a mother fiure) how to figure out the types."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1487168345, "post_id": 42240533, "comment_id": 71661372, "body": "@BenjaminHodgson The heart of the problem is when traversing the (roughly) <code>(Op :*: recur) :+: rest</code> whose type is derived from <code>If (c==n) Op (OpType&#39; (c+1) n rest)</code>. <code>c</code> is the current depth, n is the target depth, I keep track of <code>n</code> and increment <code>c</code> instead of decrementing <code>n</code> because I feel more comfortable incrementing than decrementing GHC&#39;s notion of naturals. In the <code>c==n</code> case GHC can figure out that the type is <code>Op</code> and typecheck everything. Otherwise she can&#39;t prove that <code>c==n</code> and complains about typechecking."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1487168447, "post_id": 42240533, "comment_id": 71661450, "body": "Maybe I should edit the question with all this info but I think it&#39;s context that is not really central to the question itself."}], "answers": [{"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1487170551, "post_id": 42249596, "comment_id": 71663059, "body": "Thanks a lot! Is <code>%:==</code> undocumented? I can&#39;t find it."}, {"owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "reply_to_user": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 1, "creation_date": 1487171860, "post_id": 42249596, "comment_id": 71664105, "body": "<code>Data.Singletons.Prelude</code> re-exports <code>Data.Singletons.Prelude.Eq</code> where you can find <a href=\"https://hackage.haskell.org/package/singletons-2.2/docs/Data-Singletons-Prelude-Eq.html#v:-37-:-61--61-\" rel=\"nofollow noreferrer\"><code>(%:==)</code></a>"}], "tags": [], "owner": {"reputation": 11001, "user_id": 727667, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2e2cbd3a202d8d1cfe0cc2a9fff86733?s=128&d=identicon&r=PG", "display_name": "gallais", "link": "https://stackoverflow.com/users/727667/gallais"}, "is_accepted": true, "score": 2, "last_activity_date": 1487162092, "creation_date": 1487162092, "answer_id": 42249596, "question_id": 42240533, "link": "https://stackoverflow.com/questions/42240533/infer-constraints-for-both-if-and-else-of-type-equality/42249596#42249596", "title": "Infer constraints for both if and else of type equality", "body": "<p>One possible solution is to use the <a href=\"https://hackage.haskell.org/package/singletons\" rel=\"nofollow noreferrer\">singletons</a> library to get term-level functions representing the type-level ones (or vice-versa).</p>\n\n<p>The gist of it is:</p>\n\n<pre><code>import Data.Singletons.Prelude\n</code></pre>\n\n<p>(...)</p>\n\n<pre><code>case (sing :: Sing a) %:== (sing :: Sing b) of\n  STrue  -&gt; Left Refl\n  SFalse -&gt; Right Refl\n</code></pre>\n\n<p>I've put up a <a href=\"https://gist.github.com/gallais/df9f598e576caadf1321275cacf996f7\" rel=\"nofollow noreferrer\">self-contained file</a> with all the imports and language extensions too.</p>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 42249596, "answer_count": 1, "score": 2, "last_activity_date": 1487162092, "creation_date": 1487131442, "last_edit_date": 1487154098, "question_id": 42240533, "link": "https://stackoverflow.com/questions/42240533/infer-constraints-for-both-if-and-else-of-type-equality", "title": "Infer constraints for both if and else of type equality", "body": "<p>I am trying to fill the hole in the following snippet</p>\n\n<pre><code>import Data.Proxy\nimport GHC.TypeLits\nimport Data.Type.Equality\nimport Data.Type.Bool\nimport Unsafe.Coerce\n\nifThenElse :: forall (a :: Nat) (b :: Nat) x l r.\n  (KnownNat a, KnownNat b, x ~ If (a==b) l r) =&gt;\n  Proxy a -&gt; Proxy b -&gt; Either (x :~: l) (x :~: r)\nifThenElse pa pb = case sameNat pa pb of\n  Just Refl -&gt; Left Refl\n  Nothing -&gt; Right $ unsafeCoerce Refl -- This was the hole\n</code></pre>\n\n<p>Is it possible?</p>\n\n<p>Edit: Checked the source of <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-TypeLits.html#v:sameNat\" rel=\"nofollow noreferrer\"><code>sameNat</code></a> and it turns out they use <code>unsafeCoerce</code>. I edited the code above accordingly.</p>\n"}, {"tags": ["haskell", "vector", "linear-algebra", "ghc", "haskell-linear"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487122673, "post_id": 42238952, "comment_id": 71637744, "body": "You shouldn&#39;t use the <code>V</code> constructor directly, as you can easily violate the invariant that the vector length and the type level index indicating the length do not match. Use <code>Linear.V.fromVector (fromList [1..5]) :: V 5 Double</code> - note that here if you specify the wrong length at the type level then this function gives you <code>Nothing</code>, and with this type <code>dim</code> will be able to satisfy the <code>Dim n</code> (<code>Dim 5</code> in this case) constraint. If you actually want the type <code>exists length . V length X</code> then that type is precisely <code>Vector X</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487124418, "post_id": 42238952, "comment_id": 71638185, "body": "Hmm. @user2407038 is right, but there is something fishy about <code>trace</code> - for some reason I can&#39;t seem to convince GHC that the <code>Trace</code> constraint is satisfied..."}], "answers": [{"comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1487125106, "post_id": 42239535, "comment_id": 71638342, "body": "<code>Trace (V 5)</code> isn&#39;t satisfied because the kinds are wrong, the instance is actually <code>Dim * n =&gt; Trace (V * n)</code> but you would need <code>Dim Nat n =&gt; Trace (V Nat n)</code> or more generally <code>Dim k n =&gt; Trace (V k n)</code>. Presumably this is just a bug, but you could still declare the appropriate instance yourself as a quick fix."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487125758, "post_id": 42239535, "comment_id": 71638487, "body": "@user2407038 Ah yes. Nice catch - I suspected something of the sort but hadn&#39;t quite gotten there. I&#39;ll edit the answer and maybe also open a bug."}, {"owner": {"reputation": 42290, "user_id": 3757, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/886cefc5134a9df362fe871b0ab71d38?s=128&d=identicon&r=PG", "display_name": "Christian Oudard", "link": "https://stackoverflow.com/users/3757/christian-oudard"}, "edited": false, "score": 0, "creation_date": 1487137286, "post_id": 42239535, "comment_id": 71641658, "body": "I&#39;m shocked I actually stumbled on a bug in this. I was sure I just was doing it wrong. Thanks so much!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1487230993, "last_edit_date": 1487230993, "creation_date": 1487124626, "answer_id": 42239535, "question_id": 42238952, "link": "https://stackoverflow.com/questions/42238952/how-do-i-use-variable-size-vectors-in-edward-kmetts-linear-library/42239535#42239535", "title": "How do I use variable size vectors in Edward Kmett&#39;s &quot;Linear&quot; library?", "body": "<p>Because Haskell is not dependently typed, it can't lift to the type level the length of a list it might be getting only at runtime. With that said, the purpose of the <code>n</code> is that you can make code that is polymorphic over the size of the vectors (for example you can make sure your aren't taking the dot product of vector that have different lengths). <strong>But</strong> you still need to explicitly specify the length of your actual vectors at compile time, if you want to use that information.</p>\n\n<p>What <code>linear</code> <em>does</em> give you is <a href=\"https://hackage.haskell.org/package/linear-1.20.5/docs/Linear-V.html#v:fromVector\" rel=\"nofollow noreferrer\"><code>fromVector</code></a> which performs at runtime a check that the vector you gave matches the type you specified. For example,</p>\n\n<pre><code>ghci&gt; :set +t -XDataKinds -XOverloadedLists\nghci&gt; import Linear\nghci&gt; import Linear.V\nghci&gt; fromVector [1,2,3] :: Maybe (V 3 Int)\nJust (V {toVector = [1,2,3]})\nit :: Maybe (V 3 Int)\nghci&gt; fromVector [1,2,3] :: Maybe (V 2 Int)\nNothing\nit :: Maybe (V 3 Int)\n</code></pre>\n\n<p>So, in your case, you should probably be doing something like the following:</p>\n\n<pre><code>ghci&gt; Just v = fromVector [1..5]           :: Maybe (V 5 Double)\nv :: V 5 Double\nghci&gt; Just w = fromVector [2, 3, 5, 7, 11] :: Maybe (V 5 Double)\nw :: V 5 Double\nghci&gt; dim v\n5\nit :: Int\nghci&gt; m = outer v w\nm :: V 5 (V 5 Double)\nghci&gt; trace m\n&lt;interactive&gt;:44:1: error:\n   \u2022 No instance for (Trace (V 5)) arising from a use of \u2018trace\u2019\n   \u2022 In the expression: trace m\n     In an equation for \u2018it\u2019: it = trace m\n</code></pre>\n\n<p>...annnnd yeah -  I think the last interaction is a bug (unless someone can see something I'm missing). The <code>Trace (V 5)</code> variant should be satisfiable though the <code>Dim n =&gt; Trace (V n)</code> instance but for some reason it isn't.</p>\n\n<h1>EDIT</h1>\n\n<p>As @user2407038 has pointed out, the problem is that the <code>Dim n =&gt; Trace (V n)</code> I mentioned above is not polykinded - it only works for <code>n :: *</code> while we would like it to work for any kind (specifically <code>n :: Nat</code> in this case). There isn't really any reason for this restriction, so we can go ahead and define our own version of the instance</p>\n\n<pre><code>ghci&gt; :set -XPolyKinds\nghci&gt; instance Dim n =&gt; Trace (V n)\nghci&gt; trace m\n106.0\n</code></pre>\n\n<p>I've opened an <a href=\"https://github.com/ekmett/linear/issues/121\" rel=\"nofollow noreferrer\">issue</a>.</p>\n\n<h1>EDIT 2</h1>\n\n<p>The issue is now fixed. I reckon it should probably make it into the next release of <code>linear</code>.</p>\n\n<hr>\n\n<p>As a side note, I use <code>-XDataKinds</code> so that I am allowed to write type-level literals (which have kind <code>GHC.TypeLits.Nat</code> - they are special and hardwired into GHC) and <code>-XOverloadedLists</code> so I can write <code>[1..5] :: Vector Int</code>.</p>\n"}], "owner": {"reputation": 42290, "user_id": 3757, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/886cefc5134a9df362fe871b0ab71d38?s=128&d=identicon&r=PG", "display_name": "Christian Oudard", "link": "https://stackoverflow.com/users/3757/christian-oudard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 42239535, "answer_count": 1, "score": 6, "last_activity_date": 1563317458, "creation_date": 1487119983, "last_edit_date": 1563317458, "question_id": 42238952, "link": "https://stackoverflow.com/questions/42238952/how-do-i-use-variable-size-vectors-in-edward-kmetts-linear-library", "title": "How do I use variable size vectors in Edward Kmett&#39;s &quot;Linear&quot; library?", "body": "<p>I'm trying to use ekmett's linear library, and I'm having some trouble with variable length vectors, in Linear.V. How do I use the <code>dim</code> function to get the size of a vector? How do I use <code>trace</code> on a large square matrix made of nested <code>V</code>s ? I get errors in both of these cases.</p>\n\n<p>Minimal code:</p>\n\n<pre><code>import qualified Data.Vector as Vector\nimport Linear.V (V(V), dim)\nimport Linear.Vector (outer)\nimport Linear.Matrix (trace)\n\nv, w :: V n Double -- What do I do here?\nv = V $ Vector.fromList [1..5]\nw = V $ Vector.fromList [2, 3, 5, 7, 11]\n\nd = dim v\nm = outer v w\nt = trace m\n</code></pre>\n\n<p>It gives these errors which I don't understand:</p>\n\n<pre><code>\u2022 Ambiguous type variable \u2018n0\u2019 arising from a use of \u2018dim\u2019\n  prevents the constraint \u2018(Linear.V.Dim n0)\u2019 from being solved.\n  Probable fix: use a type annotation to specify what \u2018n0\u2019 should be.\n  These potential instances exist:\n    two instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n\u2022 In the expression: dim v\n  In an equation for \u2018d\u2019: d = dim v\n\n\u2022 Ambiguous type variable \u2018n1\u2019 arising from a use of \u2018trace\u2019\n  prevents the constraint \u2018(Linear.V.Dim n1)\u2019 from being solved.\n  Probable fix: use a type annotation to specify what \u2018n1\u2019 should be.\n  These potential instances exist:\n    two instances involving out-of-scope types\n    (use -fprint-potential-instances to see them all)\n\u2022 In the expression: trace m\n  In an equation for \u2018t\u2019: t = trace m\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487102955, "post_id": 42235133, "comment_id": 71629957, "body": "This can only work if the compiler compiles the whole program and libraries in a single gulp, or forbidding orphan instances. Incremental compilation pretty much copes with that, since the compiler does not know if another module will define a <code>Display</code> instance."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1487103902, "post_id": 42235133, "comment_id": 71630461, "body": "I reckon the best way to convince you <i>not</i> to try this is to show you <a href=\"https://wiki.haskell.org/GHC/AdvancedOverlap\" rel=\"nofollow noreferrer\">what it involves</a>. And even that solution suffers from a couple really unpleasant problems."}, {"owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487109241, "post_id": 42235133, "comment_id": 71633309, "body": "@Alec any idea so it doesn&#39;t involve instantiating my typeclass for each Haskell type?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1487109552, "post_id": 42235133, "comment_id": 71633456, "body": "@NikitaTchayka The best approach (which I would&#39;ve suggested if this question had not been closed) is to make a <code>default</code> signature for <code>Display</code> with a <code>Show</code> constraint. Then, if you automatically derive <code>Display</code> you end up with the <code>Show</code> variant, but you can still customize the output with hand written <code>Display</code> variants if you want."}], "owner": {"reputation": 533, "user_id": 3847023, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mUqNl.jpg?s=128&g=1", "display_name": "Nick Tchayka", "link": "https://stackoverflow.com/users/3847023/nick-tchayka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "closed_date": 1487103072, "answer_count": 0, "score": 0, "last_activity_date": 1487102416, "creation_date": 1487102416, "question_id": 42235133, "link": "https://stackoverflow.com/questions/42235133/default-to-a-typeclass-when-a-data-type-does-not-instantiate-it", "closed_reason": "Duplicate", "title": "Default to a typeclass when a data type does not instantiate it", "body": "<p>Imagine that we are defining a custom <code>Display</code> typeclass that acts like <code>Show</code> but with a prettier formatting:</p>\n\n<pre><code>class Display a where\n    display :: a -&gt; PrettyFormat\n</code></pre>\n\n<p>Would it be possible to make a simple function <code>prettyPrint</code> that calls <code>display</code> if the <code>Display</code> type class is instantiated for the data type, and <code>show</code> if it's not?</p>\n"}, {"tags": ["haskell", "vector", "monads"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487103774, "post_id": 42234977, "comment_id": 71630413, "body": "I&#39;m not sure I understand what you are looking for (or what I&#39;m supposed to be looking for in your code sample). Could you add some type signatures (possibly tentative) of things you are looking for?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487103902, "post_id": 42234977, "comment_id": 71630462, "body": "You should be able to do this by converting to boxed vectors first. If you need the raw performance of never leaving unboxed-land, you&#39;re probably going to need to patch the library yourself."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487104094, "post_id": 42234977, "comment_id": 71630575, "body": "@Alec added the type signature of the function I&#39;m looking for"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487104428, "post_id": 42234977, "comment_id": 71630771, "body": "@DanielWagner how would using boxed vectors allow me to do in comparison to unboxed?"}], "answers": [{"comments": [{"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1487105179, "post_id": 42235746, "comment_id": 71631191, "body": "Pretend for a moment that the <code>mate</code> function was not monadic, e.g. it had type sig <code>(Int, Int) -&gt; m (VU.Vector Int)</code> so that using <code>concatMap</code> was possible. Would the big-o runtime be different from your case, assuming boxed vectors in both cases?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1487105599, "post_id": 42235746, "comment_id": 71631405, "body": "@tsorn Do you mean <code>(Int, Int) -&gt; (VU.Vector Int)</code>? Isn&#39;t <code>(Int, Int) -&gt; m (VU.Vector Int)</code> the type it currently has?"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1487106062, "post_id": 42235746, "comment_id": 71631652, "body": "Yes, sorry, that&#39;s what I meant"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 1, "creation_date": 1487106329, "post_id": 42235746, "comment_id": 71631799, "body": "@tsorn Without optimizations, the asymptotic complexity would be the same. That said, the <code>vector</code> package is well-known for aggressively using rewrite rules and the non-monadic version would be more susceptible to this, so it could end up getting fused into something that is <i>much</i> faster."}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1487106730, "post_id": 42235746, "comment_id": 71632031, "body": "Very helpful answers. I can&#39;t find the runtime for concatMap or deduce it for your <code>concatMapM</code>. Would that be something like O(n+m) where n is input length and m is output length? Assuming <code>f</code> is constant."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 1, "creation_date": 1487106954, "post_id": 42235746, "comment_id": 71632158, "body": "@tsorn I think it is indeed O(n+m) for some fixed <code>f</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 5, "last_activity_date": 1487106389, "last_edit_date": 1487106389, "creation_date": 1487104705, "answer_id": 42235746, "question_id": 42234977, "link": "https://stackoverflow.com/questions/42234977/monadic-concatmap-for-data-vector/42235746#42235746", "title": "Monadic concatMap for Data.Vector?", "body": "<p><code>Monad m =&gt; (a -&gt; m (Vector b)) -&gt; Vector a -&gt; m (Vector b)</code> is not too difficult - we can rely on the <code>Functor</code>, <code>Monad</code>, and <code>Traversable</code> instances of <code>Vector</code>. The big caveat is you will need to use a regular (not unboxed) <code>Vector</code>.</p>\n\n<pre><code>import Data.Vector (Vector)\nimport Control.Monad (join)\n\nconcatMapM :: Monad m =&gt; (a -&gt; m (Vector b)) -&gt; Vector a -&gt; m (Vector b)\nconcatMapM f v = join &lt;$&gt; sequence (fmap f v)\n</code></pre>\n\n<p>The problem with doing this for unboxed vectors is that in the intermediate <code>fmap f v</code> step I have a <code>Vector (m (Vector b))</code> and there is no reasonable <code>data instance</code> for that (nor the required corresponding <code>Monad m =&gt; Vector Vector (m (Vector b))</code> class instance).</p>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "accepted_answer_id": 42235746, "answer_count": 1, "score": 1, "last_activity_date": 1487106848, "creation_date": 1487101845, "last_edit_date": 1487106848, "question_id": 42234977, "link": "https://stackoverflow.com/questions/42234977/monadic-concatmap-for-data-vector", "title": "Monadic concatMap for Data.Vector?", "body": "<p>I'm looking for something from the Data.Vector package which works like <code>concatMap</code> but works with monads. <code>concatMap</code> has type...</p>\n\n<pre><code>(a -&gt; Vector b) -&gt; Vector a -&gt; Vector b \n</code></pre>\n\n<p>but I'm looking for something with type... </p>\n\n<pre><code>(Monad m) =&gt; (a -&gt; m (Vector b)) -&gt; Vector a -&gt; m (Vector b)\n</code></pre>\n\n<p>... or, in particular, either one of: </p>\n\n<pre><code>(MonadRandom m) =&gt; ((Int, Int) -&gt; m (Vector Int)) \n                -&gt; Vector (Int, Int) -&gt; m (Vector Int)\n\n(MonadRandom m) =&gt; (Int -&gt; Int -&gt; m (Vector Int))\n                -&gt; Vector (Int, Int) -&gt; m (Vector Int)\n</code></pre>\n\n<p>The code below should give an idea of what I'm trying to do but produces the error</p>\n\n<blockquote>\n  <p>Couldn't match type <code>VU.Vector Int</code> with <code>Int</code><br>\n  Expected type: <code>m (VU.Vector Int)</code><br>\n  Actual type: <code>m (VU.Vector (VU.Vector Int))</code><br>\n  In the expression: <code>return $ VU.concatMap mate mates</code></p>\n</blockquote>\n\n<pre><code>import           Control.Monad\nimport           Control.Monad.Random \nimport qualified Data.Vector.Unboxed  as VU\n\ntestReprod :: IO()\ntestReprod = do\n  let parents = VU.fromList [1::Int,2,3,4,5,6,7,8,9,10]\n  children &lt;- reproduce parents\n  print children\n\n-- concat monadic\nreproduce :: (MonadRandom m) =&gt; (VU.Vector Int) -&gt; m (VU.Vector Int)\nreproduce parents = return $ VU.concatMap mate mates\n    where\n  half = VU.length parents `div` 2\n  mates = VU.zip (VU.take half parents) (VU.drop half parents)\n  mate :: (MonadRandom m) =&gt; (Int, Int) -&gt; m (VU.Vector Int)\n  mate (a, b) = do\n    r1 &lt;- getRandomR(0,5)\n    r2 &lt;- getRandomR(0,5)\n    return $ VU.fromList [a+r1, b+r2]\n</code></pre>\n\n<p>While the <code>mate</code> function in the example does not actually rely on getting a tuple of values, the actual code from which the example is based on does.</p>\n"}, {"tags": ["haskell", "types", "ghci", "monomorphism-restriction"], "comments": [{"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1487096970, "post_id": 42233527, "comment_id": 71626719, "body": "I think your first guess is pretty close, <code>ma</code>&#39;s type isn&#39;t fixed to be <code>Int</code> until later so <code>le</code> is using <code>ma :: Bounded a =&gt; a</code> which defaults to <code>()</code> in the show. If you do it again with <code>ma = maxBound :: Int</code> it should give you 19."}, {"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1487097013, "post_id": 42233527, "comment_id": 71626748, "body": "how can it be that the type is not fixed?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1487098874, "post_id": 42233527, "comment_id": 71627734, "body": "Any behavior can be confusing when you expect the opposite behavior."}], "answers": [{"comments": [{"owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1487097222, "post_id": 42233666, "comment_id": 71626863, "body": "I thought that this might be due to <code>MonomorphismRestriction</code> but I tried to <code>-XNoMono...</code> - which is already the default setting in GHCi, and got the incorrect result again"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 3, "creation_date": 1487097312, "post_id": 42233666, "comment_id": 71626914, "body": "@epsilonhalbe This is one of the only questions I have answered on SO where someone actually wanted to have the <code>MonomorphismRestriction</code> (as opposed to the other way around). :)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "edited": false, "score": 0, "creation_date": 1487150706, "post_id": 42233666, "comment_id": 71648778, "body": "It is probably worth remarking this sort of thing is why the monomorphism restriction is in general a good idea - unless you provide a more general signature or you explicitly have a function (i.e. there are arguments to the left of the <code>=</code>), you probably aren&#39;t going to expect your <code>let</code> binding to be polymorphic. In this case, you don&#39;t expect <code>mi</code> or <code>ma</code> to be polymorphic because of this."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "edited": false, "score": 0, "creation_date": 1487188043, "post_id": 42233666, "comment_id": 71675107, "body": "This confusion might also be avoided with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#let-generalisation\" rel=\"nofollow noreferrer\"><code>MonoLocalBinds</code></a>, which prevents <code>let</code>-generalization.  Two different anti-confusion solutions to the same problem."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 13, "last_activity_date": 1487097381, "last_edit_date": 1487097381, "creation_date": 1487097043, "answer_id": 42233666, "question_id": 42233527, "link": "https://stackoverflow.com/questions/42233527/ghci-defaulting-confusion/42233666#42233666", "title": "ghci - defaulting confusion", "body": "<p>Confusingly, this is still the monomorphism restriction at play (or rather the lack thereof when in GHCi). Since GHCi doesn't have the monomorphism restriction enabled, your definitions of <code>mi</code> and <code>ma</code> don't get specialized to <code>Int</code> as you think they will - instead they stay general as <code>mi, ma :: Bounded a =&gt; a</code> and the <code>a</code> variable gets instantiated twice</p>\n\n<ul>\n<li>once as <code>()</code> in <code>fromIntegral $ length $ show ma</code> (as you observed, this is a default)</li>\n<li>once as <code>Int</code> in <code>[mi,ma,le] :: [Int]</code></li>\n</ul>\n\n<p>If you want <code>mi</code> and <code>ma</code> to actually be of type <code>Int</code>, annotate them as such directly</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| let mi, ma :: Int\nPrelude|     mi = minBound\nPrelude|     ma = maxBound\nPrelude|     le = fromIntegral $ length $ show ma\nPrelude|  in [mi,ma,le]\nPrelude| :}\n[-9223372036854775808,9223372036854775807,19]\n</code></pre>\n\n<p>Or turn on the monormorphism restriction manually in GHCi</p>\n\n<pre><code>Prelude&gt; :set -XMonomorphismRestriction\nPrelude&gt; :{\nPrelude| let mi = minBound\nPrelude|     ma = maxBound\nPrelude|     le = fromIntegral $ length $ show ma\nPrelude| in [mi,ma,le] :: [Int]\nPrelude| :}\n[-9223372036854775808,9223372036854775807,19]\n</code></pre>\n"}], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 42233666, "answer_count": 1, "score": 5, "last_activity_date": 1487111418, "creation_date": 1487096552, "last_edit_date": 1487111418, "question_id": 42233527, "link": "https://stackoverflow.com/questions/42233527/ghci-defaulting-confusion", "title": "ghci - defaulting confusion", "body": "<p>I happened to see some strange behaviour during checking the size (<code>minBound</code>,<code>maxBound</code>) and \"length in decimal representation\" of different integral types.</p>\n\n<p>Using GHCi:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| let mi = minBound\nPrelude|     ma = maxBound\nPrelude|     le = fromIntegral $ length $ show ma\nPrelude|  in [mi,ma,le] :: [Int]\nPrelude| :}\n[-9223372036854775808,922372036854775807,2]\n                                         ^\n</code></pre>\n\n<p>in the last place I would expect <code>19</code>.</p>\n\n<p>My first guess is that <code>maxBound</code> defaults to <code>()</code> and thus yields <code>2</code>, but I don't understand that because <code>ma</code> should be an <code>Int</code> by the explicit type annotation (<code>:: [Int]</code>) - and by referential transparency all symbols named <code>ma</code> should be equal.</p>\n\n<p>If I put the statement above in a file and load it into GHCi, I get the correct result.</p>\n\n<p>So why do I get a wrong result?</p>\n"}, {"tags": ["list", "function", "haskell", "char"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487095586, "post_id": 42233064, "comment_id": 71625949, "body": "The error says that the function expects a list of strings (list-of-lists-of-chars), but you do not pass one."}], "answers": [{"tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 2, "last_activity_date": 1487099050, "last_edit_date": 1487099050, "creation_date": 1487095559, "answer_id": 42233230, "question_id": 42233064, "link": "https://stackoverflow.com/questions/42233064/error-while-passing-strings-in-functions-in-haskell/42233230#42233230", "title": "Error while passing strings in functions in Haskell", "body": "<p>Look closely at the type of <code>wantGifts</code>, it requires a List of List of Chars. But <code>\"no I dont\"</code> is of type <code>String</code> which is just <code>[Char]</code>. With your current construction, you have to use:</p>\n\n<pre><code>wantGifts [\"no I dont\"]\n</code></pre>\n\n<p>There are several ways to improve this, best is to use <a href=\"https://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text.html\" rel=\"nofollow noreferrer\"><code>Text</code></a>. </p>\n\n<pre><code>import Data.Text (Text)\nimport qualified Data.Text as T\nwantGifts :: Text -&gt; Text \nwantGifts txt = if (T.isInfixOf \"no\" . T.toLower) txt then \"No gifts given\" else \"But why\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 125, "user_id": 2902072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1779e19d7cc6b655bae88aad1a58889?s=128&d=identicon&r=PG", "display_name": "Sudhanshu", "link": "https://stackoverflow.com/users/2902072/sudhanshu"}, "edited": false, "score": 0, "creation_date": 1487097469, "post_id": 42233236, "comment_id": 71627003, "body": "Thanks, I would be thankful if you could explain that \\w and any part."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 125, "user_id": 2902072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1779e19d7cc6b655bae88aad1a58889?s=128&d=identicon&r=PG", "display_name": "Sudhanshu", "link": "https://stackoverflow.com/users/2902072/sudhanshu"}, "edited": false, "score": 1, "creation_date": 1487097853, "post_id": 42233236, "comment_id": 71627194, "body": "That is lambda syntax for anonymous functions. <a href=\"https://wiki.haskell.org/Anonymous_function\" rel=\"nofollow noreferrer\">Here is a good explanation</a>."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "reply_to_user": {"reputation": 125, "user_id": 2902072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1779e19d7cc6b655bae88aad1a58889?s=128&d=identicon&r=PG", "display_name": "Sudhanshu", "link": "https://stackoverflow.com/users/2902072/sudhanshu"}, "edited": false, "score": 1, "creation_date": 1487098495, "post_id": 42233236, "comment_id": 71627521, "body": "@Sudhanshu <a href=\"http://learnyouahaskell.com/higher-order-functions\" rel=\"nofollow noreferrer\">LearnYouAHaskell</a> is also an excellent resource to learn from."}, {"owner": {"reputation": 125, "user_id": 2902072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1779e19d7cc6b655bae88aad1a58889?s=128&d=identicon&r=PG", "display_name": "Sudhanshu", "link": "https://stackoverflow.com/users/2902072/sudhanshu"}, "reply_to_user": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1487099758, "post_id": 42233236, "comment_id": 71628206, "body": "@jkeuhlen Its my primary resource for learning haskell and it surely is a good one!"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1487095571, "creation_date": 1487095571, "answer_id": 42233236, "question_id": 42233064, "link": "https://stackoverflow.com/questions/42233064/error-while-passing-strings-in-functions-in-haskell/42233236#42233236", "title": "Error while passing strings in functions in Haskell", "body": "<p>You have defined <code>wantGifts</code> as taking a list of strings. <code>[[Char]]</code> is equivalent to <code>[String]</code>. In the REPL, you are passing it a single string.</p>\n\n<p>If you instead did this, it would compile:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>wantGifts [\"no I dont\"]\n</code></pre>\n\n<p>However, I have a hunch this isn't what you want.</p>\n\n<p>If you were trying to detect whether the word <code>\"no\"</code> was anywhere in the string, you could use the <code>words</code> function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>containsNo :: String -&gt; Bool\ncontainsNo = any (\\w -&gt; w == \"no\" || w == \"No\") . words\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 2902072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1779e19d7cc6b655bae88aad1a58889?s=128&d=identicon&r=PG", "display_name": "Sudhanshu", "link": "https://stackoverflow.com/users/2902072/sudhanshu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 635, "favorite_count": 0, "accepted_answer_id": 42233230, "answer_count": 2, "score": 0, "last_activity_date": 1487099050, "creation_date": 1487095079, "question_id": 42233064, "link": "https://stackoverflow.com/questions/42233064/error-while-passing-strings-in-functions-in-haskell", "title": "Error while passing strings in functions in Haskell", "body": "<p>So I tried the following code in haskell where I try to detect if the user has entered a \"no\" or \"No\" in the string. Also I tried replacing [[Char]] with Strings but it gives compilation errors.</p>\n\n<pre><code>  wantGifts :: [[Char]] -&gt; [[Char]]\n  wantGifts st = [if (x == \"No\" || x== \"no\") then \"No gifts given\" else \"But why\" | x &lt;-  st, x == head st]\n</code></pre>\n\n<p>The above code compiles but when I pass a string to it, it returns an error message: </p>\n\n<pre><code>*Main&gt; wantGifts \"no I dont\"\n\n&lt;interactive&gt;:8:11:\n    Couldn't match type \u2018Char\u2019 with \u2018[Char]\u2019\n    Expected type: [[Char]]\n      Actual type: [Char]\n    In the first argument of \u2018wantGifts\u2019, namely \u2018\"no I dont\"\u2019\n    In the expression: wantGifts \"no I dont\"\n    In an equation for \u2018it\u2019: it = wantGifts \"no I dont\"\n</code></pre>\n"}, {"tags": ["haskell", "text-processing"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1487093447, "post_id": 42232207, "comment_id": 71624679, "body": "Perhaps because it wouldn&#39;t be very clear how lazy the lazy bytestring was. You can just convert your strict bytestrings to lazy bytestrings."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1487094630, "post_id": 42232207, "comment_id": 71625386, "body": "Probably no good reason; I would guess someone forgot. <a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.1/docs/src/Data-ByteString-Lazy.html#unzip\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/bytestring-0.10.8.1/docs/src/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1487096940, "creation_date": 1487096940, "answer_id": 42233636, "question_id": 42232207, "link": "https://stackoverflow.com/questions/42232207/why-doesnt-haskell-data-bytestring-lazy-char8-have-an-unzip-function/42233636#42233636", "title": "Why doesn&#39;t Haskell Data.ByteString.Lazy.Char8 have an unzip function?", "body": "<p>At first glance, <code>unzip</code> for lazy bytestrings boils down to using <code>pack</code> on both halves of a pair of \"byte\" lists:</p>\n\n<pre><code>import Data.Bifunctor\nimport qualified Data.ByteString.Lazy.Char8 as C\n\nunzipLazy :: [(Char, Char)] -&gt; (C.ByteString, C.ByteString)\nunzipLazy = bimap C.pack C.pack . unzip\n</code></pre>\n\n<p>That can catch you off guard, though -- as Reid Barton notes, \"[it isn't] very clear how lazy the lazy bytestring [is]\". For instance, this...</p>\n\n<pre><code>print . fst . unzipLazy $ repeat ('a', 'b')\n</code></pre>\n\n<p>... doesn't run in constant memory. (By the way, the same happens with the existing <a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString-Lazy.html#g:21\" rel=\"nofollow noreferrer\"><code>Data.ByteString.Lazy.unzip</code></a> that jberryman mentions.)</p>\n\n<p>P.S.: In any case, I'm not sure if lazy bytestrings actually gain you much in this situation, as <code>last . C.group</code> brings the whole first bytestring into memory from the outset.</p>\n"}], "owner": {"reputation": 5679, "user_id": 1878788, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fc54887ecbaba35e17251129e5b78c9a?s=128&d=identicon&r=PG", "display_name": "bli", "link": "https://stackoverflow.com/users/1878788/bli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 42233636, "answer_count": 1, "score": 2, "last_activity_date": 1487096940, "creation_date": 1487092393, "question_id": 42232207, "link": "https://stackoverflow.com/questions/42232207/why-doesnt-haskell-data-bytestring-lazy-char8-have-an-unzip-function", "title": "Why doesn&#39;t Haskell Data.ByteString.Lazy.Char8 have an unzip function?", "body": "<p>I want to remove trailing characters 'T' from a string, and at the same time shorten an associated string by the same number of characters that are removed from the first string.</p>\n\n<p>I tried as follows:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nimport qualified Data.ByteString.Lazy.Char8 as C\nzipTrim s q\n    | C.null s = (C.empty, C.empty)\n    | C.head (last $ C.group s) == 'T' =\n        unzip (C.zip (C.concat $ init $ C.group s) q)\n    | otherwise = (s, q)\n</code></pre>\n\n<p>However, the <code>unzip</code> returns me a pair of <code>[Char]</code> instead of a pair of <code>Bytestring</code>.</p>\n\n<p>The non-lazy version has an unzip function that returns a pair of <code>Bytestring</code>:\n<a href=\"https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString-Char8.html#v:unzip\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/bytestring-0.10.8.1/docs/Data-ByteString-Char8.html#v:unzip</a></p>\n\n<p><strong>Why isn't there a similar function for the lazy version?</strong></p>\n\n<p>(Feel free to suggest better solutions to my co-trimming problem. I would like to have something not too slow.)</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1487089797, "post_id": 42231115, "comment_id": 71622181, "body": "Have you tried using the <code>MonadState</code> and similar type classes?"}, {"owner": {"reputation": 13, "user_id": 268846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d842c0abf1f05f872649d564ff80e66c?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/268846/chris"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1487092278, "post_id": 42231115, "comment_id": 71623924, "body": "Not so far but the example from Michael below gives me a place to start, thanks for the reply. As I mentioned below I need to do some reading to better understand what this is and how it compares with what I had been doing."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 268846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d842c0abf1f05f872649d564ff80e66c?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/268846/chris"}, "edited": false, "score": 0, "creation_date": 1487092160, "post_id": 42231977, "comment_id": 71623834, "body": "Thanks very much this is exactly the sort of thing I was hoping for. I need to do some reading to better understand the difference."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 13, "user_id": 268846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d842c0abf1f05f872649d564ff80e66c?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/268846/chris"}, "edited": false, "score": 0, "creation_date": 1487092592, "post_id": 42231977, "comment_id": 71624144, "body": "@Chris I added a version using &#39;hoist&#39; &#39;lift&#39; etc as you originally intended so you could see how it works. It&#39;s a different approach that just uses the transformer types and no classes (which are in mtl)  It unfortunately isn&#39;t a real option here because <code>RandT</code> doesn&#39;t have an <code>MFunctor</code> instance."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 13, "user_id": 268846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d842c0abf1f05f872649d564ff80e66c?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/268846/chris"}, "edited": false, "score": 0, "creation_date": 1487093662, "post_id": 42231977, "comment_id": 71624803, "body": "@Chris the first is the natural solution when you are using state, reader, writer, random and a few other &#39;effects&#39;. With things like <code>conduit</code> or <code>pipes</code> you are dealing with a monad transformer that can&#39;t be represented so easily by an &quot;mtl style&quot; class and then the direct <code>lift</code> and <code>hoist</code> approach becomes more natural. The latter approach tends to give clearer error messages since it doesn&#39;t use type classes, but the <code>mtl</code> route is less verbose."}, {"owner": {"reputation": 13, "user_id": 268846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d842c0abf1f05f872649d564ff80e66c?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/268846/chris"}, "edited": false, "score": 0, "creation_date": 1487094255, "post_id": 42231977, "comment_id": 71625151, "body": "Thanks again this is awesome!"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 13, "user_id": 268846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d842c0abf1f05f872649d564ff80e66c?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/268846/chris"}, "edited": false, "score": 1, "creation_date": 1487097437, "post_id": 42231977, "comment_id": 71626982, "body": "I just noticed <code>mapRandT</code> so actually you can do this the &#39;MFunctor&#39; way, and edited to reflect this. I could have used <code>mapRandT</code> directly, but defined <code>hoistRandT</code> to match the type that <code>hoist</code> would have."}], "tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 3, "last_activity_date": 1487099200, "last_edit_date": 1487099200, "creation_date": 1487091688, "answer_id": 42231977, "question_id": 42231115, "link": "https://stackoverflow.com/questions/42231115/how-do-you-call-a-function-that-use-a-subset-of-the-current-monad-stack/42231977#42231977", "title": "How do you call a function that use a subset of the current monad stack?", "body": "<p>The obvious solution here is not to use concrete transformer types like those from  <code>StateT</code> from <code>transformers</code> and <code>RandT</code> from <code>MonadRandom</code> until the end, but to build up the parts using \"<code>mtl</code>-style\" classes. Your <code>test</code> is sort of a textbook case for that:</p>\n\n<pre><code>module Test.State where\n\nimport Control.Monad \nimport Control.Monad.State\nimport Control.Monad.Random  \nimport System.Random \n\ntype MyState = Int\n\nsomethingThatModifiesState :: MonadState MyState m =&gt; Int -&gt; m ()\nsomethingThatModifiesState x = do\n  put x\n  return ()\n\nsomethingThatUsesIO :: MonadIO m =&gt; Int -&gt; m ()\nsomethingThatUsesIO x = liftIO $ print x\n\nsomethingInRandom :: (MonadIO m , MonadRandom m) =&gt; m Int\nsomethingInRandom =  getRandomR (0,10)\n\nsomethingInStateAndRand :: (MonadState MyState m, MonadRandom m) =&gt; m Int\nsomethingInStateAndRand = do\n  y &lt;- getRandomR (0,10)\n  put y\n  return y\n\n  -- this type is inferred\ntest :: (MonadRandom m, MonadIO m, MonadState MyState m) =&gt; m ()\ntest = do\n  x  &lt;- somethingInRandom            -- fail :(\n  _  &lt;- somethingThatModifiesState x -- fail :(\n  _  &lt;- somethingInStateAndRand      -- fail :(\n  s  &lt;- get -- ok!\n  somethingThatUsesIO s -- ok!\n  return()\n\nmyState :: Int\nmyState = 17\n\nrun = do\n  g &lt;- getStdGen\n  runRandT (runStateT test myState) g\n\n-- &gt;&gt;&gt;  run\n-- 4\n-- (((),4),787162639 1655838864)\n</code></pre>\n\n<p>Edit added:</p>\n\n<p>You can work directly with the transformers in such cases using <code>hoist</code>. Unfortunately <code>RandT</code> doesn't have an <code>MFunctor</code> instance. <code>Control.Monad.Trans.Random</code> does export a <code>mapRandT</code> which can do the work. Below I define <code>hoistRandT</code> so its type is uniform with the one <code>hoist</code> would have (this requires <code>RankNTypes</code>).  </p>\n\n<pre><code>{-#LANGUAGE RankNTypes #-}\nmodule Test.State where\n\nimport Control.Monad\nimport Control.Monad.Identity\nimport Control.Monad.Morph\nimport Control.Monad.Trans.Class\nimport Control.Monad.Trans.State\nimport Control.Monad.Random\nimport Control.Monad.Trans.Random\n\nimport Data.Functor.Identity\nimport Data.Monoid\nimport System.Random  \n\nhoistRandT :: (forall r . m r -&gt; n r) -&gt; RandT s m a -&gt; RandT s n a\nhoistRandT = mapRandT\n\ntype MyState = Int\n\nsomethingThatModifiesState :: Int -&gt; State MyState ()\nsomethingThatModifiesState x = do\n  put x\n  return ()\n\nsomethingThatUsesIO :: Int -&gt; IO ()\nsomethingThatUsesIO x = print x\n\nsomethingInRandom :: RandT StdGen Identity Int\nsomethingInRandom = getRandomR (0,10)\n\nsomethingInStateAndRand :: StateT MyState (RandT StdGen Identity) Int\nsomethingInStateAndRand = do\n  y &lt;- getRandomR (0,10)\n  put y\n  return y \n\ntest :: StateT MyState (RandT StdGen IO) ()\ntest = do\n  x  &lt;- lift $ hoistRandT generalize somethingInRandom \n  _  &lt;- hoist generalize $ somethingThatModifiesState x \n  _  &lt;- hoist (hoistRandT generalize) somethingInStateAndRand\n  s  &lt;- get\n  liftIO $ somethingThatUsesIO s\n  return()\n\nmyState :: Int\nmyState = 17\n\nrun = do\n  g &lt;- getStdGen\n  runRandT (runStateT test myState) g\n</code></pre>\n\n<p>The main business is happening in <code>test</code> where I carefully tune each 'action' so that it snaps into place. This is actually pretty easy and has a certain charm but takes a little getting used to. <code>generalize</code> is just </p>\n\n<pre><code>return . runIdentity :: Monad m =&gt; Identity a -&gt; m a\n</code></pre>\n\n<p>Notice that no signature in the second module uses a class constraint.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 268846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d842c0abf1f05f872649d564ff80e66c?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/268846/chris"}, "edited": false, "score": 1, "creation_date": 1487098899, "post_id": 42232279, "comment_id": 71627741, "body": "Thanks very much!"}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 0, "last_activity_date": 1487098945, "last_edit_date": 1495541349, "creation_date": 1487092603, "answer_id": 42232279, "question_id": 42231115, "link": "https://stackoverflow.com/questions/42231115/how-do-you-call-a-function-that-use-a-subset-of-the-current-monad-stack/42232279#42232279", "title": "How do you call a function that use a subset of the current monad stack?", "body": "<p>Two options, plus a bonus one:</p>\n\n<ol>\n<li><p>A basic solution would be generalising your types from <code>State</code> and <code>Rand</code> to <code>StateT</code> and <code>RandT</code>. Remember that <code>State s</code> is just a synonym for <code>StateT s Identity</code>, and analogously for <code>Rand</code>:</p>\n\n<pre><code>somethingInRandom :: Monad m =&gt; RandT StdGen m Int\nsomethingThatModifiesState :: Monad m =&gt; Int -&gt; StateT MyState m ()\nsomethingInStateAndRand :: Monad m =&gt; StateT MyState (RandT StdGen m) Int\n</code></pre>\n\n<p>You don't need to change the body of your computations, as you have implemented them in terms of methods of <code>MonadState</code> and <code>MonadRandom</code>, which work out of the box for all monads built with <code>StateT</code> and <code>RandT</code> respectively. When using <code>somethingInRandom</code>, though, you need to slip in a <code>lift</code> to promote it to your <code>StateT</code>-transformed monad:</p>\n\n<pre><code>test :: StateT MyState (RandT StdGen IO) ()\ntest = do\n    x  &lt;- lift somethingInRandom\n    _  &lt;- somethingThatModifiesState x\n    _  &lt;- somethingInStateAndRand\n    -- etc.\n</code></pre></li>\n<li><p>There is a nicer alternative, though: Since, as I mentioned above, your implementations are in terms of the <code>MonadState</code> and <code>MonadRandom</code>, you can, as bheklilr suggests, generalise the types in terms of those classes. That has two advantages over the first solution: you don't need the <code>lift</code> for <code>somethingInRandom</code> any longer, and your code will need no further changes if you, for instance, stack another transformer layer atop <code>StateT</code> or switch to a <code>MonadRandom</code> instance other than <code>RandT</code>:</p>\n\n<pre><code>somethingInRandom :: MonadRandom m =&gt; m Int\nsomethingThatModifiesState :: MonadState MyState m =&gt; m ()\nsomethingInStateAndRand :: (MonadRandom m, MonadState MyState m) =&gt; m Int\n</code></pre></li>\n<li><p>Since you mentioned <em>mmorph</em>: if changing the signatures weren't an option for whatever reason (e.g. if you were using someone else's code), you would have to unwrap the <code>State</code>/<code>Rand</code> computations, slip in a <code>return . runIdentity</code> to change their inner monad and rewrap them. Since <code>return . runIdentity</code> is a monad morphism, there is a more convenient way to do that in the case of <code>StateT</code>, which has a <a href=\"https://hackage.haskell.org/package/mmorph-1.0.9/docs/Control-Monad-Morph.html#v:hoist\" rel=\"nofollow noreferrer\"><code>MFunctor</code></a> instance:</p>\n\n<pre><code>test = do\n    -- etc.\n    _  &lt;- hoist generalize (somethingThatModifiesState x)\n    -- etc.\n</code></pre>\n\n<p><code>generalize</code> from <code>Control.Monad.Morph</code> is literally <code>return . runIdentity</code>. There is further discussion of this trick in <a href=\"https://hackage.haskell.org/package/mmorph-1.0.9/docs/Control-Monad-Morph.html#g:4\" rel=\"nofollow noreferrer\"><em>mmorph</em>'s documentation</a>.</p></li>\n</ol>\n\n<p><a href=\"https://stackoverflow.com/a/42231977/2751851\">Michael's answer</a> demonstrates solutions #2 and #3.</p>\n"}], "owner": {"reputation": 13, "user_id": 268846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d842c0abf1f05f872649d564ff80e66c?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/268846/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 42231977, "answer_count": 2, "score": 1, "last_activity_date": 1487099200, "creation_date": 1487089090, "question_id": 42231115, "link": "https://stackoverflow.com/questions/42231115/how-do-you-call-a-function-that-use-a-subset-of-the-current-monad-stack", "title": "How do you call a function that use a subset of the current monad stack?", "body": "<p>I have been dabbling with a text based application as a way to learn haskell. In the main part of my application I am using a combination of state, rand, and IO like this:</p>\n\n<pre><code>test :: StateT MyState (RandT StdGen IO) () \n</code></pre>\n\n<p>I've already written some functions that I now want to stitch together but those functions were defined only with the monad(s) they needed opposed to the full stack. I'd like to avoid using the full set everywhere if I can help it.</p>\n\n<p>Here is an example that shows the different cases I am trying to work out:</p>\n\n<pre><code>module Test.State where\n\nimport Control.Monad\nimport Control.Monad.Identity\nimport Control.Monad.Morph\nimport Control.Monad.Trans.Class\nimport Control.Monad.State\nimport Control.Monad.Random\nimport Data.Functor.Identity\nimport Data.Monoid\nimport System.Random \n\ntype MyState = Int\n\nsomethingThatModifiesState :: Int -&gt; State MyState ()\nsomethingThatModifiesState x = do\n  put x\n  return ()\n\nsomethingThatUsesIO :: Int -&gt; IO ()\nsomethingThatUsesIO x = print x\n\nsomethingInRandom :: Rand StdGen Int\nsomethingInRandom = getRandomR (0,10)\n\nsomethingInStateAndRand :: StateT MyState (Rand StdGen) Int\nsomethingInStateAndRand = do\n  y &lt;- getRandomR (0,10)\n  put y\n  return y\n\ntest :: StateT MyState (RandT StdGen IO) ()\ntest = do\n  x  &lt;- somethingInRandom            -- fail :(\n  _  &lt;- somethingThatModifiesState x -- fail :(\n  _  &lt;- somethingInStateAndRand      -- fail :(\n  s  &lt;- get -- ok!\n  liftIO $ somethingThatUsesIO s -- ok!\n  return()\n\nmyState :: Int\nmyState = 17\n\nrun = do\n  g &lt;- getStdGen\n  runRandT (runStateT test myState) g\n</code></pre>\n\n<p>Googling has landed me in the Control.Monad.Morph module which seems to do the sort of things I want but I haven't been able to get a combination that works so far.</p>\n\n<p>I've also been looking at the types to get some hints but it is a bit beyond what I understand at the moment.</p>\n\n<p>Any suggestions are greatly appreciated!</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1487087585, "post_id": 42229668, "comment_id": 71620540, "body": "It might be worth mentioning that this <code>alpha</code> is available as <code>maybeToList</code> from <code>Data.Maybe</code>."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": true, "score": 20, "last_activity_date": 1487093183, "last_edit_date": 1487093183, "creation_date": 1487085166, "answer_id": 42229668, "question_id": 42229584, "link": "https://stackoverflow.com/questions/42229584/haskell-do-notation-and-return-in-monads/42229668#42229668", "title": "Haskell: do notation and return in Monads", "body": "<pre><code>do {x &lt;- (Just 3); y &lt;- (Just 5); return (x:y:[])}\n</code></pre>\n\n<p>desugars to</p>\n\n<pre><code>Just 3 &gt;&gt;= \\x -&gt; Just 5 &gt;&gt;= \\y -&gt; return $ x:y:[]\n</code></pre>\n\n<p>Since the type of <code>&gt;&gt;=</code> is <code>Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b</code> and per argument <code>Just 3</code> (alternatively <code>Just 5</code>) we have <code>m ~ Maybe</code>, the return type of the expression must be some <code>Maybe</code> type.</p>\n\n<hr>\n\n<p>There is a possibility to make this return <code>[[3, 5]]</code> using something called <a href=\"https://ncatlab.org/nlab/show/natural+transformation\" rel=\"noreferrer\">natural transformations</a> from <a href=\"https://en.wikipedia.org/wiki/Category_theory\" rel=\"noreferrer\">category theory</a>. Because there exists a natural transformation from <code>Maybe a</code> to <code>[a]</code>, namely</p>\n\n<pre><code>alpha :: Maybe a -&gt; [a]\nalpha Nothing  = []\nalpha (Just a) = [a]\n</code></pre>\n\n<p>we have that your desired function is simply the natural transformation applied to the result:</p>\n\n<pre><code>alpha (Just 3 &gt;&gt;= \\x -&gt; Just 5 &gt;&gt;= \\y -&gt; return $ x:y:[])\n-- returns [[3, 5]]\n</code></pre>\n\n<p>Since this is a natural transformation, you can also apply <code>alpha</code> first and your function second:</p>\n\n<pre><code>alpha (Just 3) &gt;&gt;= \\x -&gt; alpha (Just 5) &gt;&gt;= \\y -&gt; return $ x:y:[]\n-- returns [[3, 5]]\n</code></pre>\n\n<p>As @duplode pointed out, you can find <code>alpha</code> in the package <code>Data.Maybe</code> as <code>maybeToList</code>.</p>\n"}], "owner": {"reputation": 681, "user_id": 6692318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef3d4764458022d20b0d15c2c7fd3c96?s=128&d=identicon&r=PG&f=1", "display_name": "Atin", "link": "https://stackoverflow.com/users/6692318/atin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 0, "accepted_answer_id": 42229668, "answer_count": 1, "score": 7, "last_activity_date": 1487093183, "creation_date": 1487084930, "question_id": 42229584, "link": "https://stackoverflow.com/questions/42229584/haskell-do-notation-and-return-in-monads", "title": "Haskell: do notation and return in Monads", "body": "<p>Suppose I have following code</p>\n\n<pre><code>do {x &lt;- (Just 3); y &lt;- (Just 5); return (x:y:[])}\n</code></pre>\n\n<p>Which outputs <code>Just [3,5]</code></p>\n\n<p>How does haskell know that output value should be in <code>Maybe</code> monad? I mean <code>return</code> could output <code>[[3, 5]]</code>. </p>\n"}, {"tags": ["haskell", "typeclass", "non-exhaustive-patterns", "type-promotion"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 5, "creation_date": 1487082959, "post_id": 42228609, "comment_id": 71617110, "body": "No, because all types are inhabited by stuck type families, so the claim that the kind <code>Nat</code> is inhabited only by <code>&#39;Z</code> and <code>&#39;S n</code> where <code>n :: Nat</code> is patently false - <code>Any :: Nat</code> and <code>Any Any :: Nat</code>, ad infinitum. Furthermore, the need for the explicit constraint could never go away - the constraint is what is actually allowing you to do type level computation. <code>dumb</code> works because you have an instance <code>C1 a</code> for every type <code>a</code> without any constraint on that type."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487083788, "post_id": 42228609, "comment_id": 71617689, "body": "I understand, thank you for your answer. So is there a way to trick the type system using IncoherentInstances (see edit)?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487084145, "post_id": 42228609, "comment_id": 71617952, "body": "You get an exception because <code>noGreet</code> contains a type error, so <code>noGreet anything</code> will always be a type error as well. <code>IncoherentInstances</code> doesn&#39;t have any clearly defined semantics, so you shouldn&#39;t expect it to be of any help, ever."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 4, "last_activity_date": 1487086018, "creation_date": 1487086018, "answer_id": 42229988, "question_id": 42228609, "link": "https://stackoverflow.com/questions/42228609/exhaustiveness-check-in-typeclasses-for-promoted-types/42229988#42229988", "title": "Exhaustiveness check in typeclasses for promoted types", "body": "<pre><code>noGreet :: forall a . a -&gt; Maybe a\n</code></pre>\n\n<p>Parametricity says the only definable values of this type are things like</p>\n\n<pre><code>noGreet x = Just x\nnoGreet x = Nothing\nnoGreet x = undefined\nnoGreet x = x `seq` Just x\n...\n</code></pre>\n\n<p>We can't make any choices that depend on the type <code>a</code>, like \"<code>Nothing</code> if <code>a</code> is <code>Char</code> otherwise <code>Just x</code>\".</p>\n\n<p>\"Tricking the type checker\" is a red herring, since what is preventing you from writing such a function is not the type checker, but the fact that information about the type <code>a</code> is simply not available at all at runtime.</p>\n\n<hr>\n\n<p>When you used <code>IncoherentInstances</code> in</p>\n\n<pre><code>noGreet :: forall a . a -&gt; Maybe a\nnoGreet x = f (NProxy :: NProxy (GetNum a)) x\n</code></pre>\n\n<p>the compiler had to choose which <code>C</code> instance to use for the call to <code>f</code>, since there is no context provided in the type of <code>noGreet</code>. Naturally the only one that applied was</p>\n\n<pre><code>instance C n b where f = error \"This should not have been reached using GetNum.\"\n</code></pre>\n\n<p>as the other two instances are too specific to use when we know nothing about <code>a</code>.</p>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1487086018, "creation_date": 1487082204, "last_edit_date": 1487083607, "question_id": 42228609, "link": "https://stackoverflow.com/questions/42228609/exhaustiveness-check-in-typeclasses-for-promoted-types", "title": "Exhaustiveness check in typeclasses for promoted types", "body": "<p>I have promoted type <code>Nat = Suc Nat | Zero</code> and I want to make a typeclass <code>class C (a :: Nat) b</code>. Is there a way to convince GHC that <code>instance C Zero b</code> and <code>instance C (Seq x) b</code> covers all cases and therefore I don't need to explicitly declare <code>C</code> as a constraint whenever I use the class' methods. Here is some code:</p>\n\n<pre><code>{-# LANGUAGE TypeFamilies #-}\n{-# LANGUAGE IncoherentInstances #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE FlexibleInstances #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE GADTs #-}\n{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE FlexibleContexts #-}\n-- Some of these may not be necessary for the particular snippet.\n\ndata Nat = Zero | Suc Nat\n-- TypeApplications, I know. I am traditional.\ndata NProxy :: Nat -&gt; * where\n  NProxy :: NProxy n\n\nclass C (a :: Nat) b where\n  f :: NProxy a -&gt; b -&gt; Maybe b\n\ninstance C Zero b where\n  f _ _ = Nothing\ninstance C (Suc a) b where\n  f _ = Just\n-- instance C n b where\n--   f = error \"This should not have been reached using GetNum.\"\n\n\nclass C1 a where\n  f1 :: a -&gt; Maybe a\n\ninstance C1 a where\n  f1 = Just\n\ntype family GetNum a :: Nat where\n  GetNum Char = (Suc Zero)\n  GetNum Int = Suc (Suc Zero)\n  GetNum [x] = Suc (GetNum x)\n  GetNum a = Suc Zero\n\n-- Error:\n-- \u2022 No instance for (C (GetNum a) a) arising from a use of \u2018f\u2019\n-- \u2022 In the expression: f (NProxy :: NProxy (GetNum a)) x\n--   In an equation for \u2018noGreet\u2019:\n--       noGreet x = f (NProxy :: NProxy (GetNum a)) x\nnoGreet :: forall a . a -&gt; Maybe a\nnoGreet x = f (NProxy :: NProxy (GetNum a)) x\n\n-- This one works fine though.\ndumb :: a -&gt; Maybe a\ndumb = f1\n</code></pre>\n\n<p>Edit: A related question would be, given the commented out instance if <code>C</code>, why is it when I say <code>noGreet \"hi\"</code> to the repl I get an exception and not <code>Just \"hi\"</code>.</p>\n"}, {"tags": ["haskell", "void", "type-families"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487081859, "post_id": 42228336, "comment_id": 71616306, "body": "You cannot define such a function (well, you can simply have <code>Just x = error ..</code> but I suppose you are looking for a type safe way of doing this) because you cannot pattern match on a type. At least you would need <code>Typeable (IfEq n m o) =&gt; Maybe (IfEq n m o) -&gt; Maybe o</code>. The general strategy is to use singletons."}], "answers": [{"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1487087793, "post_id": 42228594, "comment_id": 71620687, "body": "I didn&#39;t think it was important but I had rolled my own <code>data Nat = Suc Nat | Zero</code>. Is it possible to infer <code>KnownNat a =&gt; KnownNat (1 + a)</code>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1487088080, "post_id": 42228594, "comment_id": 71620935, "body": "@fakedrake I think your actual issue is that, at runtime, the type-level naturals <code>n,m</code> are not stored in memory, so we can&#39;t use them. We need them to be present at runtime, either through a typeclass dictionary, or through an explicit singleton argument. (About <code>KnownNat</code>, I don&#39;t know how it works in precise terms)"}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1487088403, "post_id": 42228594, "comment_id": 71621199, "body": "Well that is exactly the point, I expect those numbers to be calculated at compile time and then use them to compute the correct types. All relevant info must be available at compile time. Is it unreasonable to think that if I know <code>a :: Nat</code> at compile time I can also know <code>1 + a</code>?"}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1487088835, "post_id": 42228594, "comment_id": 71621508, "body": "To provide some context (which is much too large to fit in detail in this question), I have a class of recursive generic types that have the form <code>Expr a = Expr0 a | Expr1 Op1 (Expr a) | Expr2 Op2 (Expr a) (Expr a) | ... deriving Generic1</code> and the end goal is to generate polymorphic functions to extract the operator if it&#39;s there <code>getOp :: (Algebra expr, KnownNat arity) =&gt; (arity :: Nat) -&gt; expr a -&gt; Maybe (OpAtArity arity (expr a))</code>."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 1, "creation_date": 1487091152, "post_id": 42228594, "comment_id": 71623089, "body": "Turns out GHC can actually infer <code>KnownNat (1 + n)</code> but you need to explicitly ask for it. I also found a <a href=\"https://hackage.haskell.org/package/ghc-typelits-knownnat\" rel=\"nofollow noreferrer\">GHC plugin</a> that removes that overhead."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1487082158, "creation_date": 1487082158, "answer_id": 42228594, "question_id": 42228336, "link": "https://stackoverflow.com/questions/42228336/convincing-ghc-that-maybe-void-is-a-unit-type/42228594#42228594", "title": "Convincing GHC that `Maybe Void` is a unit type", "body": "<p>Try something like</p>\n\n<pre><code>foo :: forall n m o . (KnownNat n, KnownNat m) =&gt;\n       IfEq n m o -&gt; Maybe o\nfoo x = case sameNat (Proxy :: Proxy n) (Proxy :: Proxy m) of\n   Just Refl -&gt; Just x\n   Nothing -&gt; Nothing\n</code></pre>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1487089346, "creation_date": 1487081362, "last_edit_date": 1487089346, "question_id": 42228336, "link": "https://stackoverflow.com/questions/42228336/convincing-ghc-that-maybe-void-is-a-unit-type", "title": "Convincing GHC that `Maybe Void` is a unit type", "body": "<p>I have a type family <code>IfEq (n :: Nat) (m :: Nat) o</code> that evaluates to <code>o</code> or <code>Void</code> depending on wether <code>n :== m</code>. Since <code>Maybe Void</code> is only inibited by <code>Nothing</code> I should be able to define a function <code>Maybe (IfEq n m o) -&gt; Maybe o</code> but I can't figure it out.</p>\n\n<p>Follow up: Can this generalized from the <code>Maybe</code> monad to a more general type? (eg. all <code>MonadPlus</code>s)</p>\n\n<p>EDIT: I had initially rolled my own <code>Nat</code> but (thank's to @chi) with the GHC <code>Nat</code> kind <code>KnownNat</code> constrait it pretty straightforward to do what I describe above. However GHC can not infer <code>KnownNat a =&gt; KnownNat (1+a)</code> which is imperative to me so I am back at square 1.</p>\n"}, {"tags": ["haskell", "optimization", "ghc"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1487073134, "post_id": 42222998, "comment_id": 71610511, "body": "Lot of questions concerning inlining lately\u2026"}], "answers": [{"comments": [{"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1487074647, "post_id": 42223511, "comment_id": 71611479, "body": "anything with <code>fix</code> is beautiful."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1487079793, "post_id": 42223511, "comment_id": 71614881, "body": "@WillNess Definitely. Yet, this kind of code is easier to write than to read, IMO. ;-)"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 7, "last_activity_date": 1487067654, "creation_date": 1487067654, "answer_id": 42223511, "question_id": 42222998, "link": "https://stackoverflow.com/questions/42222998/keeping-the-potential-for-inlining-when-there-are-some-recursive-cases/42223511#42223511", "title": "Keeping the potential for inlining when there are some recursive cases", "body": "<p>I have no elegant solution, but perhaps something like this could work. Untested.</p>\n\n<pre><code>{-# INLINE toString #-}\ntoString x = go (fix go)  -- equivalent to (fix go), but unrolled once\n  where\n  {-# INLINE go #-}\n  go _ (D1 x) -&gt; intShow x\n  go _ (D2 x) -&gt; strShow x\n  go k (DJ x y) -&gt; \"(\" ++ k x ++ \",\" ++ k y ++ \")\"\n  intShow x = \"Int: show x\"\n  strShow x = \"String: show x\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 1, "last_activity_date": 1487088077, "creation_date": 1487088077, "answer_id": 42230768, "question_id": 42222998, "link": "https://stackoverflow.com/questions/42222998/keeping-the-potential-for-inlining-when-there-are-some-recursive-cases/42230768#42230768", "title": "Keeping the potential for inlining when there are some recursive cases", "body": "<p>I think you've correctly identified the issue and what has to be done to solve it, the usual (and I agree not super satisfying):</p>\n\n<ul>\n<li>mark <code>INLINE</code></li>\n<li>eta fiddling so that the left-hand side is fully applied at the call site</li>\n<li>add a trivial layer of indirection so that the function is not recursive</li>\n</ul>\n\n<p>But something like this should be sufficient here I <em>think</em>:</p>\n\n<pre><code>{-# INLINE toString #-}\ntoString x = go x where\n go case x of\n  (D1 x) -&gt; \"Int: show x\"\n  (D2 x) -&gt; \"String: show x\"\n  (DJ x y) -&gt; \"(\" ++ go x ++ \",\" ++ go y ++ \")\"\n</code></pre>\n\n<p>As chi points out in their answer it seems what you're doing here is a manual single level of loop unrolling; it's easy to see why this would be faster for, say:</p>\n\n<pre><code>(DJ (D1 0) (D2 \"zero\"))\n</code></pre>\n\n<p>But less obvious how much better this would be when you had deeply nested <code>DJ</code>s for instance. I would be curious to know, and to see how you're benchmarking.</p>\n\n<p>Most of the time we care about inlining in this way because our <code>x</code> is polymorphic and we would like a function we call on <code>x</code> in the body to be specialized. Or we want the result to stay an unboxed type.</p>\n"}, {"tags": [], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "is_accepted": false, "score": 1, "last_activity_date": 1487096991, "last_edit_date": 1495539970, "creation_date": 1487096991, "answer_id": 42233651, "question_id": 42222998, "link": "https://stackoverflow.com/questions/42222998/keeping-the-potential-for-inlining-when-there-are-some-recursive-cases/42233651#42233651", "title": "Keeping the potential for inlining when there are some recursive cases", "body": "<p>I've given @chi above the tick mark for his great <a href=\"https://stackoverflow.com/a/42223511/525980\">answer</a> involving <code>fix</code> which did do the job. But was a bit fiddly because in my case my recursion is polymorphic (which <code>fix</code> monomorphises) so I had to roll my own <code>fix</code>. </p>\n\n<p>I also feared that by passing the recursive argument in instead of calling it directly might further confuse the compiler for the recursive cases.</p>\n\n<p>But inspired by @chi's answer, and thinking that I basically want two functions the same, a non-recursive one and a recursive one, I've then realised I can do that, like so:</p>\n\n<pre><code>import Data.Proxy (Proxy(Proxy))\n\ntoString x = go' (Proxy :: Proxy True)\n  {-# SPECIALISE INLINE go' :: Proxy True -&gt; String #-}\n  go' :: (Proxy a) -&gt; String\n  go' _ = case x of\n    (D1 x) -&gt; \"Int: show x\"\n    (D2 x) -&gt; \"String: show x\"\n    (DJ x y) -&gt; \"(\" ++ go x ++ \",\" ++ go y ++ \")\"\n  go = go' (Proxy :: Proxy False)\n</code></pre>\n\n<p>Because of the specialisation for <code>go'</code>, the compiler will emit two <code>go'</code> functions, one for when the <code>Proxy</code> argument is <code>True</code>, and another for when it it <code>False</code>. </p>\n\n<p>The first, when it is <code>True</code>, is not recursive, it never calls itself (it only calls the <code>False</code> version). So if we make a specialisation of this, it's inlinable. As <code>go' (True)</code> is not recursive, so is <code>toString</code>, as all <code>toString</code> does is call <code>go' (True)</code>, so <code>toString</code> is then inlinable.</p>\n\n<p>This approach needs a little boilerplate but at least the length of the boilerplate is constant, it doesn't increase with the number of constructors you need to deal with.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 42223511, "answer_count": 3, "score": 3, "last_activity_date": 1487096991, "creation_date": 1487066334, "last_edit_date": 1487077672, "question_id": 42222998, "link": "https://stackoverflow.com/questions/42222998/keeping-the-potential-for-inlining-when-there-are-some-recursive-cases", "title": "Keeping the potential for inlining when there are some recursive cases", "body": "<p>Consider the following data type, which is only intended to be illistrative:</p>\n\n<pre><code>data D where\n  D1 :: Int -&gt; D\n  D2 :: String -&gt; D\n  DJ :: D -&gt; D -&gt; D\n</code></pre>\n\n<p>And perhaps a function on it, say <code>toString</code>:</p>\n\n<pre><code>{-# INLINE toString #-}\ntoString x = case x of\n  (D1 x) -&gt; \"Int: show x\"\n  (D2 x) -&gt; \"String: show x\"\n  (DJ x y) -&gt; \"(\" ++ toString x ++ \",\" ++ toString y ++ \")\"\n</code></pre>\n\n<p>(It's worth noting what I'm doing has nothing to do with printing, this is just an illustrative example)</p>\n\n<p>So what I find is that by defining <code>toString</code> like this makes my program 15 times faster:</p>\n\n<pre><code>{-# INLINE toString #-}\ntoString x = case x of\n  (D1 x) -&gt; \"Int: show x\"\n  (D2 x) -&gt; \"String: show x\"\n  (DJ x y) -&gt; undefined\n</code></pre>\n\n<p>What's happened is that <code>toString</code> is now able to be inlined by GHC. This allows for a whole lot of optimisations down the road. The <code>DJ</code> case is what was causing problems. So then I tried this:</p>\n\n<pre><code>{-# INLINE toString #-}\ntoString x = case x of\n  (D1 x) -&gt; intShow x\n  (D2 x) -&gt; strShow x\n  _ -&gt; go x\n  where\n    go (D1 x) -&gt; intShow x\n    go (D2 x) -&gt; strShow x\n    go (DJ x y) -&gt; \"(\" ++ go x ++ \",\" ++ go y ++ \")\"\n    intShow x = \"Int: show x\"\n    strShow x = \"String: show x\"\n</code></pre>\n\n<p>This actually means it compiles fast. The reason is (I'm pretty sure anyway) because <code>toString</code> is no longer recursive. <code>go</code> is, but <code>toString</code> isn't. So the compiler will happily inline <code>toString</code>, allowing for more optimisations down the road. </p>\n\n<p>But the above code, in my opinion, is ugly.</p>\n\n<p>Like I said, the function I have is more complex than this, and this sort of issue occurs throughout my code. I've got a data type with lots of constructors, some simple and some recursive. Whenever I define a recursive case however, it slows down even the simple cases. Is there a way to keep the top function inlining without uglifing the code like I have above?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 1, "creation_date": 1487075977, "post_id": 42222980, "comment_id": 71612390, "body": "Add it your cabal dependencies, and stack should tell you what to do."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1487077342, "post_id": 42222980, "comment_id": 71613198, "body": "<a href=\"https://docs.haskellstack.org/en/stable/yaml_configuration/\" rel=\"nofollow noreferrer\">Read the docs</a> - in particular you will probably want to specify the dependencies in the <code>extra-deps</code> field."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1487122726, "post_id": 42222980, "comment_id": 71637769, "body": "thx, but after add all the dependencies step by step, it still failed at last ..."}], "answers": [{"comments": [{"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1530533628, "post_id": 42279601, "comment_id": 89256011, "body": "<code>Clear the extra-deps list in stack-yaml</code>, you mean the <code>stack.yaml</code> of global project?"}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1530533858, "post_id": 42279601, "comment_id": 89256159, "body": "I&#39;m not install this package as a dependency of my package,  I&#39;m installing it as a command line tool. What should I do to install it as a command line tool without <code>stack new</code> an empty project?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1530538418, "post_id": 42279601, "comment_id": 89258832, "body": "(1) Yup -- I did mean <code>stack.yaml</code> (the hyphen was a typo), and the global project file is the relevant one if you aren&#39;t working in the context of a project. (2) If <i>SourceGraph</i> were in Stackage, something like <code>stack install SourceGraph --resolver lts-3.2.2</code> would work. As it is not, I suggest <code>stack unpack SourceGraph</code> (to get the source tree of the package), followed by <code>stack init</code> (to create a <code>stack.yaml</code> file), then by fixing the resolver and dependencies as suggested above, and finally <code>stack install</code>. (I will look into tweaking this answer later on.)"}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1530574277, "post_id": 42279601, "comment_id": 89273961, "body": "I&#39;m using <code>stack init --solver</code> and it failed with the deps version confliction, and the stack.yaml is not generated, so there is no pos I can add <code>allow-newer</code> option, and I tried <code>stack init --solver --allow-newer</code> but now working."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1530590171, "post_id": 42279601, "comment_id": 89276977, "body": "@luochen1990 If you haven&#39;t tried it yet, I suggest <code>stack init --solver --resolver lts-3.2.2</code>."}, {"owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1530600644, "post_id": 42279601, "comment_id": 89280390, "body": "I tried <code>stack init --solver --resolver lts-3.22</code> , and an error contains <code>Unable to start C:\\Users\\Luo\\AppData\\Local\\Programs\\stack\\x86_64-windows\\ghc&zwnj;&#8203;-7.10.2\\mingw\\bin&#47;re&zwnj;&#8203;algcc.exe (error code: 2)</code> is reported"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "edited": false, "score": 0, "creation_date": 1530673173, "post_id": 42279601, "comment_id": 89313602, "body": "@luochen1990 That appears to be an unrelated issue. <a href=\"https://github.com/commercialhaskell/stack/issues/3189\" rel=\"nofollow noreferrer\">Stack issue #3189</a> seems relevant."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 1, "last_activity_date": 1530537711, "last_edit_date": 1530537711, "creation_date": 1487262639, "answer_id": 42279601, "question_id": 42222980, "link": "https://stackoverflow.com/questions/42222980/how-to-install-a-package-in-stack-which-is-not-currently-in-any-lts-snapshots/42279601#42279601", "title": "How to install a package in stack which is not currently in any LTS snapshots?", "body": "<p>Clear the <code>extra-deps</code> list in <code>stack.yaml</code>, change the resolver to <code>lts-3.22</code>, run <code>stack solver --update-config</code> (which should automatically add <em>vacuum-cairo</em>, <em>SourceGraph</em> and possibly a few other packages to the <code>extra-deps</code>) and run <code>stack build</code> for your project (assuming the dependencies in your .cabal file are correctly declared, there is no need to run a separate <code>stack install $PACKAGE</code>). That will likely do it.</p>\n\n<p>The set of packages provided in coordination (i.e. per-user, as opposed to per-project, and with compatibility guarantees) by <code>ghc-*</code> resolvers is much smaller than that of snapshot resolvers (be them LTS or nightly), which makes them unnecessarily inconvenient. Broadly speaking, the only good reason for using a <code>ghc-*</code> resolver is if there is no snapshot resolver with the version of GHC you want to use, which is not the case here.</p>\n\n<p>I picked the somewhat old <code>lts-3.22</code> because it is the last resolver offering <em>Cabal</em> 1.22 and <em>haskell-src-exts</em> 1.16, versions required by <em>SourceGraph</em>. (In principle, you could try using a custom version of <em>SourceGraph</em> with more liberal version bounds, or give the <code>allow-newer</code> option of Stack a shot, but I guess that in this specific case the odds of failure are high, as given the package description <em>SourceGraph</em> is probably quite sensitive to changes in GHC.) I found the versions of the packages offered by the snapshot by going to <a href=\"https://www.stackage.org/lts-3.22\" rel=\"nofollow noreferrer\">its page in the Stackage site</a>.</p>\n"}], "owner": {"reputation": 3074, "user_id": 1608276, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/XiZ2q.jpg?s=128&g=1", "display_name": "luochen1990", "link": "https://stackoverflow.com/users/1608276/luochen1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1530537711, "creation_date": 1487066293, "last_edit_date": 1487123381, "question_id": 42222980, "link": "https://stackoverflow.com/questions/42222980/how-to-install-a-package-in-stack-which-is-not-currently-in-any-lts-snapshots", "title": "How to install a package in stack which is not currently in any LTS snapshots?", "body": "<p>I'm trying to install the fallowing packages, but both failed.</p>\n\n<ul>\n<li><a href=\"https://www.stackage.org/package/vacuum-cairo\" rel=\"nofollow noreferrer\">https://www.stackage.org/package/vacuum-cairo</a></li>\n<li><a href=\"https://www.stackage.org/package/SourceGraph\" rel=\"nofollow noreferrer\">https://www.stackage.org/package/SourceGraph</a></li>\n</ul>\n\n<p>I'm running <code>stack Version 1.3.2, Git revision 3f675146590da4f3edf768b89355f798229da2a5 x86_64 hpack-0.15.0</code> on windows 10.</p>\n\n<p>I tried <code>resolver: ghc-8.0.2</code> and <code>resolver: ghc-7.8.4</code>, but none of them works.</p>\n\n<p>PS: I have tried to add extra-deps step by step, and still failed at last, the <code>stack.yaml</code> file and the error message is noted <a href=\"https://gist.github.com/luochen1990/4a50c5c10e521939cf8806dc39b1265b\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": ["haskell", "tuples"], "comments": [{"owner": {"reputation": 1513, "user_id": 6624417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a73a12db09cb90a99be14fa2bb7b6096?s=128&d=identicon&r=PG&f=1", "display_name": "E4z9", "link": "https://stackoverflow.com/users/6624417/e4z9"}, "edited": false, "score": 2, "creation_date": 1487065452, "post_id": 42222479, "comment_id": 71605290, "body": "This works, so the error is probably in code that you didn&#39;t show us. What is <code>Mary</code> ?"}, {"owner": {"reputation": 1513, "user_id": 6624417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a73a12db09cb90a99be14fa2bb7b6096?s=128&d=identicon&r=PG&f=1", "display_name": "E4z9", "link": "https://stackoverflow.com/users/6624417/e4z9"}, "edited": false, "score": 7, "creation_date": 1487065506, "post_id": 42222479, "comment_id": 71605336, "body": "Did you type <code>(Mary, Mary, 1)</code> instead of <code>(&quot;Mary&quot;, &quot;Mary&quot;, 1)</code> ?"}, {"owner": {"reputation": 1513, "user_id": 6624417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a73a12db09cb90a99be14fa2bb7b6096?s=128&d=identicon&r=PG&f=1", "display_name": "E4z9", "link": "https://stackoverflow.com/users/6624417/e4z9"}, "edited": false, "score": 3, "creation_date": 1487076370, "post_id": 42222479, "comment_id": 71612658, "body": "<code>get3rd (&quot;Mary&quot;, &quot;Mary&quot;, 1)</code> works fine here both with <code>get3rd :: (String, String, Int) -&gt; Int</code> and also with inferred type (<code>get3rd :: (t, t1, t2) -&gt; t2</code>) (and so it should :) ). So, if you still have issues, you probably have to provide us with a minimal working example (i.e. full contents of a <code>.hs</code> file with a <code>main :: IO ()</code>, that does not compile for you)."}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "edited": false, "score": 1, "creation_date": 1487086137, "post_id": 42222479, "comment_id": 71619477, "body": "Just wanted to add that generally if you find yourself using &gt;2 element tuples, it might be worth creating a new data type."}, {"owner": {"reputation": 2970, "user_id": 2928766, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3c5d36ca80eccb125ee34991165d481e?s=128&d=identicon&r=PG", "display_name": "Rodrigo Ribeiro", "link": "https://stackoverflow.com/users/2928766/rodrigo-ribeiro"}, "edited": false, "score": 1, "creation_date": 1487106774, "post_id": 42222479, "comment_id": 71632055, "body": "Could you post the complete code, please?"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1487680980, "post_id": 42222479, "comment_id": 71885032, "body": "Variable names cannot start with a capital letter. Haskell interprets those as constructors, types or typeclasses. try renaming <code>Mary</code> to <code>mary</code>"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1487709092, "post_id": 42367883, "comment_id": 71903674, "body": "Right, but I doubt it&#39;s clear to someone at the level of this question what you mean."}], "tags": [], "owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "is_accepted": false, "score": 1, "last_activity_date": 1487755508, "last_edit_date": 1487755508, "creation_date": 1487681585, "answer_id": 42367883, "question_id": 42222479, "link": "https://stackoverflow.com/questions/42222479/accessing-third-element-in-triple-tuple/42367883#42367883", "title": "Accessing third element in triple tuple", "body": "<p>If you don't need to do it often, this</p>\n\n<pre><code>let (_,_,x) = someTuple\nin doSomething x\n</code></pre>\n\n<p>or this</p>\n\n<pre><code>doSomething x\nwhere (_,_,x) = someTuple\n</code></pre>\n\n<p>is pretty much equivalent to this</p>\n\n<pre><code>get3rd (_,_,x) = x\n...\ndoSomething (get3rd someTuple)\n</code></pre>\n\n<p>but if you're dealing with something like nested tuples, it might get messy</p>\n"}], "owner": {"reputation": 197, "user_id": 6498369, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0940eeee1b9093031291a16199eaf8ed?s=128&d=identicon&r=PG&f=1", "display_name": "MandyLB", "link": "https://stackoverflow.com/users/6498369/mandylb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3358, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1487755508, "creation_date": 1487065013, "last_edit_date": 1487079438, "question_id": 42222479, "link": "https://stackoverflow.com/questions/42222479/accessing-third-element-in-triple-tuple", "title": "Accessing third element in triple tuple", "body": "<p>I'm looking to access the 3rd element in a Haskell tuple. The tuple is of type (String, String, Int) and I want the Int. I've tried creating my own in ways I've seen online, mainly:</p>\n\n<pre><code>get3rd (_,_,x) = x\n</code></pre>\n\n<p>*I've also tried using a type declaration: (String, String, Int) -> Int and by creating a custom type for the tuple and using that.</p>\n\n<p>This works if the tuple I input is all made up of integers, but once I put the strings in I get this error:  Data constructor not in scope: Mary :: String\n*Mary is an arbitrary String, I get an error for both strings inputted. Any help would be great on solving this!</p>\n"}, {"tags": ["haskell", "functional-programming", "pattern-matching"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1487062705, "post_id": 42221433, "comment_id": 71603514, "body": "Those are not <i>type</i> constructors, they are <i>value</i> constructors, or simply &quot;constructors&quot;. Type constructors are <code>Maybe, Either, IO, State, ...</code> which are things of kind <code>*-&gt;*-&gt;....-&gt;*</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1487062798, "post_id": 42221433, "comment_id": 71603572, "body": "I think that&#39;s an answer, @kosmikus. And chi has a point: <code>Left</code> is a value constructor, not a type."}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "reply_to_user": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 0, "creation_date": 1487064697, "post_id": 42221433, "comment_id": 71604769, "body": "@kosmikus Isn&#39;t syb deprecated?"}, {"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 0, "creation_date": 1487067167, "post_id": 42221433, "comment_id": 71606440, "body": "@arrowd &quot;Deprecated&quot; sounds harsh. I personally think there are better options. But it works, is still widely used, and as far as I know, it&#39;s perfectly well maintained."}], "answers": [{"tags": [], "owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "is_accepted": false, "score": 3, "last_activity_date": 1487067269, "creation_date": 1487067269, "answer_id": 42223358, "question_id": 42221433, "link": "https://stackoverflow.com/questions/42221433/can-we-deconstruct-arbitrary-data-constructors/42223358#42223358", "title": "Can we deconstruct arbitrary data constructors?", "body": "<p>Not directly, primarily because the arguments of constructors will generally be of different types.</p>\n\n<p>You can achieve similar things using various generic programming libraries. For example <code>gfoldl</code>, <code>gmapT</code>, <code>gmapQ</code> from <a href=\"https://hackage.haskell.org/package/syb\" rel=\"nofollow noreferrer\">syb</a> let you operate on subterms uniformly, and in <a href=\"https://hackage.haskell.org/package/generics-sop\" rel=\"nofollow noreferrer\">generics-sop</a>, you can represent the arguments of a constructor as a heterogeneous list.</p>\n"}], "owner": {"reputation": 1322, "user_id": 6695164, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/962eb413ea9e37b168cb950cfd4211ab?s=128&d=identicon&r=PG&f=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/6695164/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1487067269, "creation_date": 1487061886, "last_edit_date": 1487062781, "question_id": 42221433, "link": "https://stackoverflow.com/questions/42221433/can-we-deconstruct-arbitrary-data-constructors", "title": "Can we deconstruct arbitrary data constructors?", "body": "<p>In Haskell, or any other programming language supporting pattern matching, can we achieve the following:</p>\n\n<p>Given a data constructor e.g. <code>Left :: a -&gt; Either a b</code> I can extract its argument with</p>\n\n<pre><code>let f (Left x) = [x]\n</code></pre>\n\n<p>Is there any way to achieve the same thing for any data constructor, something like an operator (<code>*</code>) to lift <code>Left x</code> to <code>Apply (\u03bba.Left a) [x]</code> or <code>BinTree x y</code> to <code>Apply (\u03bba,b.BinTree a b) [x,y]</code>, so we could do</p>\n\n<pre><code>let extract x = case *x of Apply _ xs -&gt; xs\n</code></pre>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487052310, "post_id": 42218951, "comment_id": 71598524, "body": "<code>map sum</code> should be enough..."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487053401, "post_id": 42218951, "comment_id": 71598968, "body": "A heads-up: I have changed the title to better reflect the underlying problem, and to mention the error which (I presume) you saw. (In such cases, it is always a good idea to quote the errors you get.)"}], "answers": [{"comments": [{"owner": {"reputation": 197, "user_id": 6498369, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0940eeee1b9093031291a16199eaf8ed?s=128&d=identicon&r=PG&f=1", "display_name": "MandyLB", "link": "https://stackoverflow.com/users/6498369/mandylb"}, "edited": false, "score": 0, "creation_date": 1487052739, "post_id": 42218969, "comment_id": 71598692, "body": "Woooow, ok, I can&#39;t believe the square brackets were what was messing it up. I knew the concept was right. Ok. Thank you.  Question though, why is it that just x works, but [x] or [[x]] doesn&#39;t?"}, {"owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "edited": false, "score": 1, "creation_date": 1487053275, "post_id": 42218969, "comment_id": 71598917, "body": "<code>[[x]]</code> is a pattern for a list containing exactly one list, just as <code>[x]</code> is a list with exactly one element. Just <code>x</code> is any input of any shape"}, {"owner": {"reputation": 197, "user_id": 6498369, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0940eeee1b9093031291a16199eaf8ed?s=128&d=identicon&r=PG&f=1", "display_name": "MandyLB", "link": "https://stackoverflow.com/users/6498369/mandylb"}, "edited": false, "score": 0, "creation_date": 1487055589, "post_id": 42218969, "comment_id": 71599866, "body": "Another question. Would the code need to change at all to have output of [[6],[7],[13]] instead of [6,7,13]?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 197, "user_id": 6498369, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0940eeee1b9093031291a16199eaf8ed?s=128&d=identicon&r=PG&f=1", "display_name": "MandyLB", "link": "https://stackoverflow.com/users/6498369/mandylb"}, "edited": false, "score": 1, "creation_date": 1487056327, "post_id": 42218969, "comment_id": 71600219, "body": "@MandyLB You would have to compose <code>sum</code> with a function that makes a single element list. It would become <code>map ((\\x -&gt; [x]) . sum)</code>, or simply <code>map ((:[]) . sum)</code>. (In any case, do keep in mind that <code>6</code> and <code>[6]</code> are very different things indeed.)"}], "tags": [], "owner": {"reputation": 44721, "user_id": 546084, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/wMoWk.jpg?s=128&g=1", "display_name": "Chris Taylor", "link": "https://stackoverflow.com/users/546084/chris-taylor"}, "is_accepted": false, "score": 2, "last_activity_date": 1487052570, "last_edit_date": 1487052570, "creation_date": 1487052220, "answer_id": 42218969, "question_id": 42218951, "link": "https://stackoverflow.com/questions/42218951/non-exhaustive-patterns-error-when-summing-a-list-of-lists/42218969#42218969", "title": "&quot;Non-exhaustive patterns&quot; error when summing a list of lists", "body": "<p>You could use</p>\n\n<pre><code>sumSubsets x = map sum x\n</code></pre>\n\n<p>or even </p>\n\n<pre><code>sumSubsets = map sum\n</code></pre>\n\n<p>Your previous code,</p>\n\n<pre><code>sumSubsets [[x]] = map sum [[x]]\n</code></pre>\n\n<p>First performs a <em>pattern match</em> using <code>[[x]]</code> which matches a list containing a single element, which is itself a list containing a single element. Therefore it would work correctly on <code>[[3]]</code></p>\n\n<pre><code>&gt;&gt; sumSubsets [[3]]\n[3]\n</code></pre>\n\n<p>but not on <code>[[1,2,3]]</code> or <code>[[1],[2]]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "is_accepted": false, "score": 0, "last_activity_date": 1487204055, "creation_date": 1487204055, "answer_id": 42262516, "question_id": 42218951, "link": "https://stackoverflow.com/questions/42218951/non-exhaustive-patterns-error-when-summing-a-list-of-lists/42262516#42262516", "title": "&quot;Non-exhaustive patterns&quot; error when summing a list of lists", "body": "<p>I think your problem stems primarily from mixing up types and values, which can happen easily to the beginner, in particular on lists. The whole confusion probably comes from the fact that in Haskell, <code>[]</code> is used as a data constructor as well as a type constructor.</p>\n\n<p>For example, <code>[Int]</code> means \"a list of Ints\" (a type), but <code>[1]</code> means \"the list that contains one element, namely the number 1\" (a value -- meaning, the whole list is the value). Both things together:</p>\n\n<pre><code>xs :: [Int]\nxs = [1]\n</code></pre>\n\n<p>When you write polymorphic functions, you abstract from something like the <code>Int</code>. For example, if you want to get the first element of a list, you can define a function that does that for any kind of list -- may they be lists of integers or lists of characters or even lists of lists:</p>\n\n<pre><code>firstElement :: [a] -&gt; a\nfirstElement (x:xs) = x\n</code></pre>\n\n<p><code>[a]</code> means \"a list with elements of type a\" (a type), and the <code>a</code> alone means \"something of type a\". <code>firstElement</code> is a function from a list with elements of type a to something of type a. <code>a</code> is a type variable. Since you're not saying what <code>a</code> should be, the function works for all kinds of lists:</p>\n\n<pre><code>*Main&gt; firstElement [1,2,3]\n1\n\n*Main&gt; firstElement ['a','b']\n'a'\n\n*Main&gt; firstElement [[1,2],[3,4]]\n[1,2]\n</code></pre>\n\n<p>When you wrote <code>[[x]]</code> you were perhaps thinking of the type of the first argument of the function, which would be a list of lists of elements of some type x (<code>x</code> is a type variable). You can still use that, but you have to put it into the type signature of your function (the line that contains the double colon):</p>\n\n<pre><code>sumSubsets :: Num a =&gt; [[a]] -&gt; [a]\nsumSubsets xs = map sum xs\n</code></pre>\n\n<p>I've used <code>a</code> here instead of <code>x</code>, since it's more commonly done, but you could use <code>x</code>, too. Unfortunately, the whole thing gets a bit complicated with the <code>Num a</code> which describes additional requirements on the type <code>a</code> (that it belongs to the numbers, since for other things, <code>sum</code> is not defined). To simplify matters, you could write:</p>\n\n<pre><code>sumSubsetsInts :: [[Int]] -&gt; [Int]\nsumSubsetsInts xs = map sum xs\n</code></pre>\n"}], "owner": {"reputation": 197, "user_id": 6498369, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0940eeee1b9093031291a16199eaf8ed?s=128&d=identicon&r=PG&f=1", "display_name": "MandyLB", "link": "https://stackoverflow.com/users/6498369/mandylb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1487204055, "creation_date": 1487052106, "last_edit_date": 1487053229, "question_id": 42218951, "link": "https://stackoverflow.com/questions/42218951/non-exhaustive-patterns-error-when-summing-a-list-of-lists", "title": "&quot;Non-exhaustive patterns&quot; error when summing a list of lists", "body": "<p>All I'm trying to do is sum a list of lists. Example of what I want to do:</p>\n\n<p><strong>Input</strong>: <code>[[1,2,3],[2,5],[6,7]]</code></p>\n\n<p><strong>Output</strong>: <code>[6,7,13]</code></p>\n\n<p>The amount of lists inside the outer list can vary, and the amount of integers in each inner list can vary. I've tried a multitude of things, and this is the last one I tried but it doesn't work:</p>\n\n<pre><code>sumSubsets [[x]] = map sum [[x]]\n</code></pre>\n\n<p>Also, I wanted a base case of sumSubsets <code>[] = [[]]</code> but that causes errors as well. Any help would be appreciated.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1487064816, "creation_date": 1487064816, "answer_id": 42222397, "question_id": 42218679, "link": "https://stackoverflow.com/questions/42218679/how-to-get-ghc-command-as-issued-by-cabal-stack/42222397#42222397", "title": "How to get GHC command as issued by Cabal/Stack?", "body": "<p>Turning on verbosity should give you the information you're looking for:</p>\n\n<pre><code>stack build --verbose --cabal-verbose\n</code></pre>\n"}], "owner": {"reputation": 2567, "user_id": 3780203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3f3f9ab585dc56fa27e203ce4eb27fd?s=128&d=identicon&r=PG&f=1", "display_name": "ephrion", "link": "https://stackoverflow.com/users/3780203/ephrion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 42222397, "answer_count": 1, "score": 2, "last_activity_date": 1487064816, "creation_date": 1487050844, "question_id": 42218679, "link": "https://stackoverflow.com/questions/42218679/how-to-get-ghc-command-as-issued-by-cabal-stack", "title": "How to get GHC command as issued by Cabal/Stack?", "body": "<p>GHC can be used as a linter for the Neovim plugin <a href=\"https://github.com/w0rp/ale\" rel=\"nofollow noreferrer\">ale</a>. The configuration uses the following command to lint a file:</p>\n\n<pre><code>stack ghc -- -fno-code -v0 %t\n</code></pre>\n\n<p>where <code>%t</code> is the file in question. This is fast and pretty great, however, it doesn't recognize any of the options specified in the Cabal file, and it fails to run if there are internal modules referenced in the file.</p>\n\n<p>Is it possible somehow to get the GHC command that would be issued by <code>cabal build</code> or <code>stack build</code>, so that we can get the extensions/references/etc necessary to get this working?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "edited": false, "score": 1, "creation_date": 1487038607, "post_id": 42216356, "comment_id": 71594759, "body": "You talk about matching a List to a List of a List but your examples are matching a Tuple to a List of Tuples (with differing Tuple length), i.e. <code>(String, String) -&gt; [(String, String, Int)] -&gt; Bool</code>."}, {"owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "reply_to_user": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "edited": false, "score": 0, "creation_date": 1487039190, "post_id": 42216356, "comment_id": 71594925, "body": "@dave my bad, I do want to match a tuple with a list of tuples."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1487045195, "post_id": 42216356, "comment_id": 71596343, "body": "Both your examples indicate a <code>False</code> result; what would produce a <code>True</code> result?"}, {"owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "edited": false, "score": 0, "creation_date": 1487045333, "post_id": 42216356, "comment_id": 71596375, "body": "For example: [(&quot;Tuesday&quot;,&quot;Friday&quot;,10),(&quot;Tuesday&quot;,&quot;Sunday&quot;,20), (&quot;Wednesday&quot;, &quot;Friday&quot;, 22)]. In other words, there can&#39;t be a tuple where the first two elements are Monday and Tuesday ( or Tuesday and Monday)"}, {"owner": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "edited": false, "score": 0, "creation_date": 1487046253, "post_id": 42216356, "comment_id": 71596577, "body": "@K.U: can you update your question with when the function is meant to return <code>True</code> and when it is meant to return <code>False</code> because at the moment you say you have to &quot;return a bool if&quot; but you <i>always</i> have to return a <code>Bool</code> the question is when.  Alternatively, if you can write a function that returns the correct result for one tuple then you can use my answer to make it work on a list trivially (and perhaps the others similarly)."}], "answers": [{"tags": [], "owner": {"reputation": 19480, "user_id": 2491900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8FMW.jpg?s=128&g=1", "display_name": "shree.pat18", "link": "https://stackoverflow.com/users/2491900/shree-pat18"}, "is_accepted": false, "score": 1, "last_activity_date": 1487040549, "creation_date": 1487040549, "answer_id": 42217022, "question_id": 42216356, "link": "https://stackoverflow.com/questions/42216356/check-if-a-list-is-in-a-list-of-tuples/42217022#42217022", "title": "Check if a list is in a list of tuples", "body": "<p>Here's one way using a fold:</p>\n\n<pre><code>matching (p,q) lst = foldl (\\acc (x,y,_) -&gt; if (x == p) &amp;&amp; (y==q) then True || acc else False || acc) False lst\n</code></pre>\n\n<p>Basically, do a pattern match of input against the tuples in the list. If at least one match is found, the accumulator will be set to True.</p>\n"}, {"tags": [], "owner": {"reputation": 4426, "user_id": 450609, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6708bd9ccabfcb1cf6863fb32f32d1de?s=128&d=identicon&r=PG", "display_name": "dave", "link": "https://stackoverflow.com/users/450609/dave"}, "is_accepted": true, "score": 3, "last_activity_date": 1487048428, "last_edit_date": 1487048428, "creation_date": 1487041769, "answer_id": 42217194, "question_id": 42216356, "link": "https://stackoverflow.com/questions/42216356/check-if-a-list-is-in-a-list-of-tuples/42217194#42217194", "title": "Check if a list is in a list of tuples", "body": "<p>Let's see what you want to do:</p>\n\n<ol>\n<li>You have to match a tuple to a tuple of another length, returning <code>True</code> if they match or <code>False</code> otherwise.</li>\n<li>Apply this to our list and return <code>True</code> if there are any matches and <code>False</code> if there aren't.</li>\n</ol>\n\n<p>Are there any standard functions that help?\n<a href=\"https://www.haskell.org/hoogle\" rel=\"nofollow noreferrer\">Hoogle</a> is the resource to use to try and find functions that help.  Of course there's a learning curve in knowing what to search for.</p>\n\n<p>I tried <code>(a -&gt; b -&gt; Bool) -&gt; a -&gt; [b] -&gt; Bool</code> which is the type of your function where <code>a</code> is the Tuple you want to match and <code>b</code> is the Tuple in your list.  This didn't get any useful matches.  But then I tried <code>(b -&gt; Bool) -&gt; [b] -&gt; Bool</code> results are <a href=\"https://www.haskell.org/hoogle/?hoogle=%28b+-%3E+Bool%29+-%3E+%5Bb%5D+-%3E+Bool\" rel=\"nofollow noreferrer\">here</a>, and the second match is a function called <code>any</code> (the first function is <code>all</code> which is useful but doesn't do what you want!).</p>\n\n<p>Now all we need is a function that takes in the Tuple and returns true if they match.</p>\n\n<p>Using your tuples I tried <code>(a,b) -&gt; (a,b,c) -&gt; Bool</code> and ... found no matches!  Looks like we are going to have to write that ourselves.</p>\n\n<p>Something like this should work:\n<code>compareTuples a b = fst a == fst b &amp;&amp; snd a == snd b</code>\nor <code>compareTuples (a,b) (c,d, _) = a == c &amp;&amp; b == d</code>.</p>\n\n<p>Hmm, this function has the type <code>(a -&gt; b -&gt; Bool)</code> but <code>any</code> takes <code>(b -&gt; Bool)</code>, so how can we make that work?  By partial application of course!</p>\n\n<p><code>matching t xs = any (compareTuples t) xs</code></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user3970496"}, "is_accepted": false, "score": 1, "last_activity_date": 1487046295, "last_edit_date": 1487046295, "creation_date": 1487043176, "answer_id": 42217405, "question_id": 42216356, "link": "https://stackoverflow.com/questions/42216356/check-if-a-list-is-in-a-list-of-tuples/42217405#42217405", "title": "Check if a list is in a list of tuples", "body": "<p>It's simple if you use <a href=\"https://hackage.haskell.org/package/lens-4.15.1\" rel=\"nofollow noreferrer\">lenses</a>:</p>\n\n<pre><code>matching a bs = not . any (\\b -&gt; (a^._1 == b^._1 &amp;&amp; a^._2 == b^._2)\n                              || (a^._1 == b^._2 &amp;&amp; a^._2 == b^._1) ) $ bs\n</code></pre>\n\n<p>Which can be further simplified using eta reduction:</p>\n\n<pre><code>matching a = not . any (\\b -&gt; (a^._1 == b^._1 &amp;&amp; a^._2 == b^._2)\n                           || (a^._1 == b^._2 &amp;&amp; a^._2 == b^._1) )\n</code></pre>\n"}], "owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 950, "favorite_count": 0, "accepted_answer_id": 42217194, "answer_count": 3, "score": 0, "last_activity_date": 1487048428, "creation_date": 1487035712, "last_edit_date": 1487045467, "question_id": 42216356, "link": "https://stackoverflow.com/questions/42216356/check-if-a-list-is-in-a-list-of-tuples", "title": "Check if a list is in a list of tuples", "body": "<p>I'm trying to write a function where I have to match a tuple to a list of tuples and  return a bool if the two elements of my first tuple appear in any tuples of the later list. So far i have try to use <code>elem</code> (only works if my first list have the same number of element with the sublist) and <code>isInfixOf</code> (variable not in scope). Any hints to go about this?</p>\n\n<pre><code>matching (\"Monday\",\"Tuesday\") [(\"Monday\",\"Tuesday\",10),(\"Tuesday\",\"Sunday\",20), (\"Wednesday\", \"Friday\", 22)] -&gt; False\nmatching (\"Monday\",\"Tuesday\") [(\"Tuesday\",\"Monday\",10),(\"Tuesday\",\"Sunday\",20), (\"Wednesday\", \"Friday\", 22)] -&gt; False\n</code></pre>\n"}, {"tags": ["arrays", "haskell", "repa"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487082738, "post_id": 42215376, "comment_id": 71616942, "body": "I&#39;ve never used yarr but at a glance the interface seems very similair to repa. As far as repa goes, it has an extremely general mechanism for taking slices of arrays. &quot;I never did find a nice way of doing this in Repa either.&quot; - then you should show your &#39;not nice&#39; code and state why you believe it isn&#39;t nice, or at the very least why the &#39;slice&#39; functionality which exists in either of these two libraries is not satisfactory. As it stands, this is much too broad."}, {"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487085324, "post_id": 42215376, "comment_id": 71618863, "body": "The slice functionality in these libraries may be satisfactory. As it stands, it is my understanding of their capabilities which is lacking - I believe I have stated that, but I&#39;ll review my question and try and narrow its scope."}], "answers": [{"comments": [{"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "edited": false, "score": 0, "creation_date": 1487369812, "post_id": 42252765, "comment_id": 71771668, "body": "I&#39;d be very interested to see an example of how you&#39;d apply a column  wise operator to a 2D array (or more generally, a nD operator on a mD array, where n &lt; m)"}], "tags": [], "owner": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "is_accepted": false, "score": 1, "last_activity_date": 1487170520, "creation_date": 1487170520, "answer_id": 42252765, "question_id": 42215376, "link": "https://stackoverflow.com/questions/42215376/yarr-slice-usage/42252765#42252765", "title": "Yarr slice usage", "body": "<p>I maintain yarr but sadly I only have intermittent access to the Internet for the next few weeks. I did write this comparison of yarr and repa some time ago: <a href=\"https://idontgetoutmuch.wordpress.com/2013/08/06/planetary-simulation-with-excursions-in-symplectic-manifolds-6/\" rel=\"nofollow noreferrer\">https://idontgetoutmuch.wordpress.com/2013/08/06/planetary-simulation-with-excursions-in-symplectic-manifolds-6/</a>. I am surprised that you can't do slices with yarr without type coercion. I will try and take a look over the next few days.</p>\n"}], "owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1487369688, "creation_date": 1487028590, "last_edit_date": 1487369688, "question_id": 42215376, "link": "https://stackoverflow.com/questions/42215376/yarr-slice-usage", "title": "Yarr slice usage", "body": "<p>I've been exploring the Data.Yarr Array library, as a possible replacement for some code I have in Repa. It seems fully featured, and the benchmarks - if correct suggest a performance improvement may be had.</p>\n\n<p>I'm interested in the correct use of the slices function.</p>\n\n<p>Say I had a 2D ForeignPtr backed matrix of Complex Floats, in row-major format</p>\n\n<pre><code>matrix2D :: UArray F L DIM2 (Complex Float)\n</code></pre>\n\n<p>How would I go about extracting a vector of slices of columns, and / or rows? </p>\n\n<p>A motivating example? Lets say I wish to permute the columns, multiply each element wise with another set of slices, then perform a 1D FFT on each slice.</p>\n\n<p>This seems a very common thing to want to do (in my world of signal processing). What is the idiomatic way of doing this?</p>\n\n<p>Edited: to reduce scope of question.</p>\n"}, {"tags": ["json", "haskell", "mustache"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 2, "creation_date": 1487037952, "post_id": 42215023, "comment_id": 71594603, "body": "Which mustache library do you use? mustache or stache?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1487064648, "post_id": 42215023, "comment_id": 71604743, "body": "I&#39;m using mustache 2.1.2"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1487071897, "post_id": 42215023, "comment_id": 71609703, "body": "I can&#39;t reproduce your output \u2013 the first line is missing. Can you fix that?"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "reply_to_user": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 1, "creation_date": 1487074933, "post_id": 42215023, "comment_id": 71611665, "body": "Apologies, I added an extra print and forgot to update the code. It should now produce the output as stated (from within GHCi)."}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1487087604, "post_id": 42215023, "comment_id": 71620556, "body": "I think this could be a bug in mustache. I suggest you open an issue."}], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1487091904, "post_id": 42231876, "comment_id": 71623634, "body": "I incorrectly assumed the JSON functionality had to do with rendering JSON values."}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": true, "score": 1, "last_activity_date": 1487091953, "last_edit_date": 1495540471, "creation_date": 1487091445, "answer_id": 42231876, "question_id": 42215023, "link": "https://stackoverflow.com/questions/42215023/mustache-not-rendering-json-value-as-json-encoded-string/42231876#42231876", "title": "Mustache not rendering JSON value as JSON encoded string", "body": "<p>Mustache doesn't seem to support straight substitution of JSON objects. Setting up a similar example <a href=\"http://mustache.github.io/#demo\" rel=\"nofollow noreferrer\">here</a>, I receive </p>\n\n<blockquote>\n  <p>[object Object]</p>\n</blockquote>\n\n<p>as output. Not identical to yours, but it indicates that the issue is not necessarily with the Haskell implementation.</p>\n\n<p>In other words, I believe the issue is with your template <code>{{{jsonData}}}</code>. </p>\n\n<p>If you change it to <code>{{{jsonData.somethingElse}}}</code>, it works fine (I know this is not what you want).</p>\n\n<p>Alternatively, encode the JSON data as text prior to passing it to the substitution function as suggested <a href=\"https://stackoverflow.com/questions/34721836/using-mustache-js-to-embed-raw-json\">here</a>. Basically something like this:</p>\n\n<pre><code>substituteValue x (Text.Mustache.object [\"jsonData\" ~= (encodeToLazyText jsonData)])\n</code></pre>\n\n<p>This results in your desired output. <code>encodeToLazyText</code> is found in <code>Data.Aeson.Text</code>.</p>\n\n<p>Working code:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport           Data.Aeson ((.=))\nimport qualified Data.Aeson as A\nimport           Data.Aeson.Text (encodeToLazyText)\nimport           Text.Mustache ((~=))\nimport qualified Text.Mustache as M\nimport qualified Text.Mustache.Types as M\n\nmain :: IO ()\nmain = do\n  print . A.encode $ jsonData\n  putStrLn \"Start\"\n  case M.compileTemplate \"\" \"in mustache: {{{jsonData}}}\" of\n    Right template -&gt;\n      print (M.substituteValue template mustacheVals)\n    Left e -&gt; \n      error . show $ e\n\njsonData :: A.Value\njsonData = \n  A.object\n    [ \"key\" .= (5 :: Integer)\n    , \"somethingElse\" .= (2 :: Integer)\n    ]\n\nmustacheVals :: M.Value\nmustacheVals =\n  M.object\n    [ \"jsonData\" ~= encodeToLazyText jsonData\n    ]\n</code></pre>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 0, "accepted_answer_id": 42231876, "answer_count": 1, "score": 1, "last_activity_date": 1492632456, "creation_date": 1487026518, "last_edit_date": 1492632456, "question_id": 42215023, "link": "https://stackoverflow.com/questions/42215023/mustache-not-rendering-json-value-as-json-encoded-string", "title": "Mustache not rendering JSON value as JSON encoded string", "body": "<p>The full example is here:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\nmodule Test2 where\n\nimport Data.Aeson\nimport Text.Mustache\n\nmain :: IO ()\nmain = do\n  let example = Data.Aeson.object [ \"key\" .= (5 :: Integer), \"somethingElse\" .= (2 :: Integer) ]\n  print . encode $ example\n  print (\"Start\" :: String)\n  case compileTemplate \"\" \"{{{jsonData}}}\" of\n    Right x -&gt; do\n      print $ substituteValue x (Text.Mustache.object [\"jsonData\" ~= example])\n    Left e -&gt; error . show $ e\n</code></pre>\n\n<p>The above produces the following output:</p>\n\n<pre><code>\"{\\\"somethingElse\\\":2,\\\"key\\\":5}\"\n\"Start\"\n\"fromList [(\\\"somethingElse\\\",2.0),(\\\"key\\\",5.0)]\"\n</code></pre>\n\n<p>My expectation is it would produce:</p>\n\n<pre><code>\"{\\\"somethingElse\\\":2,\\\"key\\\":5}\"\n\"Start\"\n\"{\\\"somethingElse\\\":2,\\\"key\\\":5}\"\n</code></pre>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1487023355, "post_id": 42214305, "comment_id": 71590060, "body": "<a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#v:readLn\" rel=\"nofollow noreferrer\"><code>readLn</code></a> might help."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 7559973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15ff7ffbd5dee68290cb41b5cf6827b5?s=128&d=identicon&r=PG&f=1", "display_name": "delta1020", "link": "https://stackoverflow.com/users/7559973/delta1020"}, "edited": false, "score": 1, "creation_date": 1487025072, "post_id": 42214447, "comment_id": 71590877, "body": "Thank you very much, it served me perfect"}], "tags": [], "owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "is_accepted": true, "score": 10, "last_activity_date": 1487025113, "last_edit_date": 1487025113, "creation_date": 1487023669, "answer_id": 42214447, "question_id": 42214305, "link": "https://stackoverflow.com/questions/42214305/how-to-input-an-integer-in-haskell-input-in-console/42214447#42214447", "title": "How to input an integer in haskell? (input in console)", "body": "<p>Use <code>getLine</code> or <code>readLn</code> and then parse the input value to the type you need it to be like so :</p>\n\n<pre><code>mayor :: Int -&gt; Int -&gt; Double\nmayor x y =\n    if  x &lt; y \n    then 0.1\n        else 0.3\n\n\ncompra :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Double\ncompra n v u iva p vp =\n    let valor_compra = (fromIntegral v) * (fromIntegral n) * (1 - mayor n u)\n        valor_iva = valor_compra * (fromIntegral iva) / 100\n        valor_puntos = fromIntegral (p * vp)\n        efectivo = if (valor_puntos &lt; valor_compra) then valor_compra-valor_puntos else 0\n    in  valor_iva + efectivo\n\nmain = do\n       putStrLn \"enter value for x: \"\n       input1 &lt;- getLine\n       putStrLn \"enter value for y: \" \n       input2 &lt;- getLine \n       let x = (read input1 :: Int)\n       let y = (read input2 :: Int)\n       print (compra x y 7 14 10 1500)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133, "user_id": 2159471, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6ba03bcf5c19e5dd23f98da34fc17348?s=128&d=identicon&r=PG", "display_name": "user2159471", "link": "https://stackoverflow.com/users/2159471/user2159471"}, "is_accepted": false, "score": 1, "last_activity_date": 1528433565, "creation_date": 1528433565, "answer_id": 50753580, "question_id": 42214305, "link": "https://stackoverflow.com/questions/42214305/how-to-input-an-integer-in-haskell-input-in-console/50753580#50753580", "title": "How to input an integer in haskell? (input in console)", "body": "<p>If the integers are entered on same line, we can do something like below. The below program reads two numbers separated by space and prints their sum.</p>\n\n<pre><code>main :: IO()\nmain = do\n    line &lt;- getLine\n    let a = (read (takeWhile (/= ' ') line) :: Int)\n    let b = (read (drop 1 (dropWhile (/= ' ') line)) :: Int)\n    putStrLn (show (a+b)) \n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 7559973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15ff7ffbd5dee68290cb41b5cf6827b5?s=128&d=identicon&r=PG&f=1", "display_name": "delta1020", "link": "https://stackoverflow.com/users/7559973/delta1020"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14721, "favorite_count": 2, "accepted_answer_id": 42214447, "answer_count": 2, "score": 10, "last_activity_date": 1528433565, "creation_date": 1487023091, "last_edit_date": 1487078269, "question_id": 42214305, "link": "https://stackoverflow.com/questions/42214305/how-to-input-an-integer-in-haskell-input-in-console", "title": "How to input an integer in haskell? (input in console)", "body": "<p>How can I enter an integer in the console, store it in a variable and then pass it as a parameter of a function that I have created?</p>\n\n<p>So far so that it works I had to do as follows:</p>\n\n<p>In the last line you can see how I have been applying the function, what I want to do is to ask for the variables by console to be applied as integers to the function and then print the result.</p>\n\n<pre><code>    mayor :: Int -&gt; Int -&gt; Double\n    mayor x y =\n        if  x &lt; y \n        then 0.1\n            else 0.3\n\n\n    compra :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; Double\n    compra n v u iva p vp =\n        let valor_compra = (fromIntegral v) * (fromIntegral n) * (1 - mayor n u)\n            valor_iva = valor_compra * (fromIntegral iva) / 100\n            valor_puntos = fromIntegral (p * vp)\n            efectivo = if (valor_puntos &lt; valor_compra) then valor_compra-valor_puntos else 0\n        in  valor_iva + efectivo\n\n    main = do\n    print (compra 20 2000 7 14 10 1500)\n</code></pre>\n\n<p>The way I do it gives me as a result\n16920.0</p>\n"}, {"tags": ["loops", "haskell", "while-loop", "monads", "io-monad"], "comments": [{"owner": {"reputation": 2838, "user_id": 3614521, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AR81q.png?s=128&g=1", "display_name": "Mephy", "link": "https://stackoverflow.com/users/3614521/mephy"}, "edited": false, "score": 0, "creation_date": 1487021854, "post_id": 42213986, "comment_id": 71589349, "body": "Does <a href=\"http://stackoverflow.com/questions/17719620/while-loop-in-haskell-with-a-condition\">this question</a> help?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1487021943, "post_id": 42213986, "comment_id": 71589394, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/17719620/while-loop-in-haskell-with-a-condition\">While loop in Haskell with a condition</a>"}, {"owner": {"reputation": 499, "user_id": 2499255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4e7eadea443aa4826cbd8bff34168551?s=128&d=identicon&r=PG", "display_name": "domoremath", "link": "https://stackoverflow.com/users/2499255/domoremath"}, "edited": false, "score": 0, "creation_date": 1487022078, "post_id": 42213986, "comment_id": 71589458, "body": "I already saw that but is there one even simpler where I can easily tell what the program is trying to compute immediately."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 5, "creation_date": 1487022677, "post_id": 42213986, "comment_id": 71589769, "body": "Do you have an example of an imperative while loop that you can&#39;t convert?"}, {"owner": {"reputation": 499, "user_id": 2499255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4e7eadea443aa4826cbd8bff34168551?s=128&d=identicon&r=PG", "display_name": "domoremath", "link": "https://stackoverflow.com/users/2499255/domoremath"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1487024386, "post_id": 42213986, "comment_id": 71590556, "body": "@Lee Say something very simple like if some condition is satisfied, you keep printing &quot;satisfied&quot; while updating the condition. I don&#39;t want a straightforward recursion but something using monads."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1487024893, "creation_date": 1487024893, "answer_id": 42214704, "question_id": 42213986, "link": "https://stackoverflow.com/questions/42213986/example-of-while-loop-in-haskell-using-monads/42214704#42214704", "title": "Example of while loop in Haskell using monads", "body": "<p>Below there's a horrible example. You have been warned.</p>\n\n<p>Consider the pseudocode:</p>\n\n<pre><code>var x = 23\nwhile (x != 0) {\n   print \"x not yet 0, enter an adjustment\"\n   x = x + read()\n}\nprint \"x reached 0! Exiting\"\n</code></pre>\n\n<p>Here's its piece-by-piece translation in Haskell, using an imperative style as much as possible.</p>\n\n<pre><code>import Data.IORef\n\nmain :: IO ()\nmain = do\n   x &lt;- newIORef (23 :: Int)\n   let loop = do\n          v &lt;- readIORef x\n          if v == 0\n          then return ()\n          else do\n             putStrLn \"x not yet 0, enter an adjustment\"\n             a &lt;- readLn\n             writeIORef x (v+a)\n             loop\n   loop\n   putStrLn \"x reached 0! Exiting\"\n</code></pre>\n\n<p>The above is indeed horrible Haskell. It simulates the while loop using the recursively-defined <code>loop</code>, which is not too bad. But it uses IO everywhere, including for mimicking imperative-style mutable variables.</p>\n\n<p>A better approach could be to remove those <code>IORef</code>s.</p>\n\n<pre><code>main = do\n   let loop 0 = return ()\n       loop v = do\n          putStrLn \"x not yet 0, enter an adjustment\"\n          a &lt;- readLn\n          loop (v+a)\n   loop 23\n   putStrLn \"x reached 0! Exiting\"\n</code></pre>\n\n<p>Not elegant code by any stretch, but at least the \"while guard\" now does not do unnecessary IO.</p>\n\n<p>Usually, Haskell programmers strive hard to separate pure computation from IO as much as possible. This is because it often leads to better, simpler and less error-prone code.</p>\n"}], "owner": {"reputation": 499, "user_id": 2499255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4e7eadea443aa4826cbd8bff34168551?s=128&d=identicon&r=PG", "display_name": "domoremath", "link": "https://stackoverflow.com/users/2499255/domoremath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1297, "favorite_count": 0, "accepted_answer_id": 42214704, "answer_count": 1, "score": 0, "last_activity_date": 1487087177, "creation_date": 1487021705, "last_edit_date": 1487087177, "question_id": 42213986, "link": "https://stackoverflow.com/questions/42213986/example-of-while-loop-in-haskell-using-monads", "title": "Example of while loop in Haskell using monads", "body": "<p>I want to write a loop in haskell using monads but I am having a hard time understanding the concept.</p>\n\n<p>Could someone provide me with one simple example of a while loop while some conditions is satisfied that involves IO action? I don't want an abstract example but a real concrete one that works.</p>\n"}, {"tags": ["haskell", "functional-programming", "idris", "ethereum", "smartcontracts"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1487026262, "post_id": 42213854, "comment_id": 71591352, "body": "&quot;[The event-sourcing style] would allow one to define any arbitrary contract that doesn&#39;t involve sending/receiving money.&quot; Why can&#39;t event sourcing cope with sending and receiving money?"}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1487028983, "post_id": 42213854, "comment_id": 71592207, "body": "@BenjaminHodgson if it used the type I posted here, how would the compiled contract be able to send/receive money from the host blockchain? It isn&#39;t specified anywhere on the definition how to deal with incoming Ether nor under which circumstances the contract should send Ether out..."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 31, "creation_date": 1487037739, "post_id": 42213854, "comment_id": 71594547, "body": "Have you read Pettersson and Edstrom&#39;s Master&#39;s thesis <a href=\"https://publications.lib.chalmers.se/records/fulltext/234939/234939.pdf\" rel=\"nofollow noreferrer\"><i>Safer smart contracts through type-driven development</i></a>? It describes an embedding of Ethereum contracts into Idris, using its effects system."}, {"owner": {"reputation": 467, "user_id": 12097191, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b9pw0.jpg?s=128&g=1", "display_name": "MJimitater", "link": "https://stackoverflow.com/users/12097191/mjimitater"}, "edited": false, "score": 4, "creation_date": 1581452656, "post_id": 42213854, "comment_id": 106436618, "body": "Perhaps the <a href=\"https://bitcoin.stackexchange.com\">bitcoin community</a> has more ideas on this"}, {"owner": {"reputation": 961, "user_id": 6338725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef4feaacbcbd03edc4fb721854ad3f75?s=128&d=identicon&r=PG", "display_name": "Rodrigo de Azevedo", "link": "https://stackoverflow.com/users/6338725/rodrigo-de-azevedo"}, "edited": false, "score": 0, "creation_date": 1616519848, "post_id": 42213854, "comment_id": 118026077, "body": "You may want to take a look at <a href=\"https://www.microsoft.com/en-us/research/publication/composing-contracts-an-adventure-in-financial-engineering\" rel=\"nofollow noreferrer\">Composing contracts: an adventure in financial engineering</a> (2000)."}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2689, "favorite_count": 27, "answer_count": 0, "score": 155, "last_activity_date": 1609105525, "creation_date": 1487021160, "last_edit_date": 1609105525, "question_id": 42213854, "link": "https://stackoverflow.com/questions/42213854/what-is-an-appropriate-type-for-smart-contracts", "title": "What is an appropriate type for smart contracts?", "body": "<p>I'm wondering what is the best way to express smart contracts in typed languages such as Haskell or Idris (so you could, for example, compile it to run on the Ethereum network). My main concern is: what is the type that captures everything that a contract could do?</p>\n<h3>Naive solution: EthIO</h3>\n<p>A naive solution would be to define a contract as a member of an <code>EthIO</code> type. Such type would be like Haskell's <code>IO</code>, but instead of enabling system calls, it would include blockchain calls, i.e., it would enable reading from and writing to the blockchain's state, calling other contracts, getting block data and so on.</p>\n<pre><code>-- incrementer.contract\n\nmain: EthIO\nmain = do\n   x &lt;- SREAD 0x123456789ABCDEF\n   SSTORE (x + 1) 0x123456789ABCDEF\n</code></pre>\n<p>This is clearly sufficient to implement any contract, but:</p>\n<ol>\n<li><p>Would be too powerful.</p>\n</li>\n<li><p>Would be very coupled to the Ethereum blockchain specifically.</p>\n</li>\n</ol>\n<h3>Conservative solution: event sourcing pattern</h3>\n<p>Under that idea, a contract would be defined as fold over a list of actions:</p>\n<pre><code>type Contract action state = {\n    act  : UserID -&gt; action -&gt; state -&gt; state,\n    init : state\n}\n</code></pre>\n<p>So, a program would look like:</p>\n<pre><code>incrementer.contract\n\nmain : Contract\nmain = {\n    act _ _ state = state + 1,\n    init          = 0\n}\n</code></pre>\n<p>That is, you define an initial state, a type of action, and how that state changes when a user submits an action. That would allow one to define any arbitrary contract that doesn't involve sending/receiving money. Most blockchains have some kind of currency and most useful contracts involve money somehow, so that type would be way too restrictive.</p>\n<h3>Less conservative solution: events + currency</h3>\n<p>We can make the type above aware of currencies by hardcoding a currency logic into the type above. We'd, thus, get something like:</p>\n<pre><code>type Contract action state = {\n    act        : UserID -&gt; action -&gt; state -&gt; state,\n    init       : state,\n    deposit    : UserID -&gt; Amount -&gt; state -&gt; state,\n    withdrawal : UserID -&gt; Amount -&gt; state -&gt; Maybe state\n}\n</code></pre>\n<p>I.e., the contract developer would need to explicitly define how to deal with monetary deposits and withdrawals. That type would be enough to define any self-contained contract which can interact with the host blockchain's currency. Sadly, <strong>such a contract wouldn't be able to interact with other contracts</strong>. In practice, contracts often interact with each other. An Exchange, for example, needs to communicate with its exchanged Token contracts to query balances and so on.</p>\n<h3>Generalization: global state?</h3>\n<p>So, let's take a step back and rewrite the conservative solution as this:</p>\n<pre><code>type Contract = {\n    act  : UserID -&gt; Action -&gt; Map ContractID State -&gt; State,\n    init : State\n}\n</code></pre>\n<p>Under this definition, the <code>act</code> function would have access not only to the contract's own state but the state of every other contract on the same blockchain. Since every contract can read each other's state, one could easily implement a communication protocol on top of this, and, thus, such type is sufficient to implement arbitrarily interacting contracts. Also, if the blockchain's currency was itself implemented as a contract (possibly using a wrapper), then that type would also be sufficient to deal with money, despite not having it hardcoded on the type. But that solution has 2 problems:</p>\n<ol>\n<li><p>Peeking at the other contract's state looks like a very &quot;hacky&quot; way to enable communication;</p>\n</li>\n<li><p>A contract defined this way wouldn't be able to interact with existing contracts which aren't aware of that solution.</p>\n</li>\n</ol>\n<h3>What now?</h3>\n<p>Now I'm in the dark. I know I'm not in the right abstraction for this problem, but I'm not sure what it would be. <em>It looks like the root of the problem is that I'm not able to capture the phenomenon of cross-contract communications properly.</em> What concrete type would be more suitable to define arbitrary smart-contracts?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 7, "last_activity_date": 1487018378, "creation_date": 1487018378, "answer_id": 42213127, "question_id": 42213017, "link": "https://stackoverflow.com/questions/42213017/comparing-elements-at-the-same-index/42213127#42213127", "title": "Comparing elements at the same index", "body": "<p>You could use <code>zip3</code> and <code>[0..]</code> to include an index as the first item of a tuple of size three:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>compare l1 l2 = map (\\(i, _, _) -&gt; i) . filter (\\(_, x,y) -&gt; x == y) $ zip3 [0..] l1 l2\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 1, "creation_date": 1487027393, "post_id": 42213763, "comment_id": 71591770, "body": "It is a matter of habit and style. I would have written <code>compare&#39; xs ys = map fst . filter snd . zip [0..] $ zipWith (==) xs ys</code>"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1487020808, "creation_date": 1487020808, "answer_id": 42213763, "question_id": 42213017, "link": "https://stackoverflow.com/questions/42213017/comparing-elements-at-the-same-index/42213763#42213763", "title": "Comparing elements at the same index", "body": "<p>A list comprehension makes Chad Gilbert's answer a little cleaner.</p>\n\n<pre><code>compare l1 l2 = [i | (i, x, y) &lt;- zip3 [0..] l1 l2, x == y]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 4, "last_activity_date": 1487027831, "creation_date": 1487027831, "answer_id": 42215256, "question_id": 42213017, "link": "https://stackoverflow.com/questions/42213017/comparing-elements-at-the-same-index/42215256#42215256", "title": "Comparing elements at the same index", "body": "<p>Use the <code>findIndices</code> function from <code>Data.List</code>. In ghci:</p>\n\n<pre><code>Data.List&gt; findIndices id $ zipWith (==) [1,2,3,4,5] [1,2,3,7,8,9,11,5]\n[0,1,2]\n</code></pre>\n"}], "owner": {"reputation": 273, "user_id": 6569748, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ae79ffd5f41cf29f3600ed54e0e1ba2c?s=128&d=identicon&r=PG&f=1", "display_name": "K.U", "link": "https://stackoverflow.com/users/6569748/k-u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 42213127, "answer_count": 3, "score": 2, "last_activity_date": 1487027831, "creation_date": 1487017990, "question_id": 42213017, "link": "https://stackoverflow.com/questions/42213017/comparing-elements-at-the-same-index", "title": "Comparing elements at the same index", "body": "<p>I'm trying to compare element at the same index of two lists in haskell. If the two elements are equal an at the same index then I have to return that index. \ni know how to compare two function using filter and zip, but my function return the value instead of the index.</p>\n\n<pre><code> compare l1 l2 = map fst . filter (\\(x,y) -&gt; x == y) $ zip l1 l2\n</code></pre>\n\n<p>When I run it with ghci i have</p>\n\n<pre><code>compare [1,2,3,4,5] [1,2,3,7,8,9,11,5]\n[1,2,3]\n</code></pre>\n\n<p>I want to have <code>[0,1,2]</code> instead. Can anybody give me hints how to go about this? </p>\n"}, {"tags": ["list", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": false, "score": 8, "last_activity_date": 1487013070, "creation_date": 1487013070, "answer_id": 42211716, "question_id": 42211647, "link": "https://stackoverflow.com/questions/42211647/custom-list-definition/42211716#42211716", "title": "Custom list definition", "body": "<p><code>Link</code> is the second constructor of your <code>List a</code> type. It is defined here:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>data List \u03b1 = EndOfList\n            | Link \u03b1 (List \u03b1) -- this line defines the Link constructor\n</code></pre>\n\n<p>It is used in your second code snippet to create values of type <code>List String</code>.</p>\n"}], "owner": {"reputation": 151, "user_id": 5293973, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f1eaae0559197cfe5639f6a3879d6d27?s=128&d=identicon&r=PG&f=1", "display_name": "Atir", "link": "https://stackoverflow.com/users/5293973/atir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1487144411, "creation_date": 1487012784, "last_edit_date": 1487144411, "question_id": 42211647, "link": "https://stackoverflow.com/questions/42211647/custom-list-definition", "title": "Custom list definition", "body": "<p>given (from Haskell Amuse Bouche Lectures)</p>\n\n<pre><code>module Part2a where\n\n    data List \u03b1 = EndOfList\n                | Link \u03b1 (List \u03b1)\n        deriving Show   -- makes printing out results possible\n</code></pre>\n\n<p>Usage Examples:</p>\n\n<pre><code>empty = EndOfList\noneWord = Link \"apple\" EndOfList\ntwoWords = Link \"banana\" (Link \"cantaloupe\" EndOfList)\n</code></pre>\n\n<p>Question:\n Where is the \"Link\" function is defined?</p>\n\n<p>I searched everywhere and could not find it.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 3, "last_activity_date": 1487016310, "last_edit_date": 1487016310, "creation_date": 1487015921, "answer_id": 42212486, "question_id": 42211074, "link": "https://stackoverflow.com/questions/42211074/weird-freer-type-error-when-combining-state-and-io-effects/42212486#42212486", "title": "Weird `freer` type error when combining State and IO effects", "body": "<p>I think it's in this signature </p>\n\n<pre><code>runStateIO :: (Member (State s) r, Member IO r) =&gt; IORef s -&gt; Eff (State s ': r) a -&gt; Eff r (a,s)\n</code></pre>\n\n<p>You shouldn't have <code>Member (State s) r</code> in the constraint, since you are directly talking about <code>State s ': r</code>. So if you write</p>\n\n<pre><code>runStateIO :: ( Member IO r) =&gt; IORef s -&gt; Eff (State s ': r) a -&gt; Eff r (a,s)\n</code></pre>\n\n<p>then the signature you want in <code>main</code> should work</p>\n\n<pre><code>let stateful_fac = statefulFac 5 :: Eff '[State Int, IO] ()\n</code></pre>\n\n<p>The compiler was still looking to find a way for <code>State Int</code> to be a member of r after <code>State Int</code> had been 'interpreted'.  So if I use the signature above for <code>stateful_fac</code> the compiler complains: </p>\n\n<pre><code>\u2022 Couldn't match type \u2018'[]\u2019 with \u2018r'0 : rs'0\u2019\n    arising from a use of \u2018runStateIO\u2019\n</code></pre>\n\n<p>rightly, since it knows there must be another element in there.</p>\n"}], "owner": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 42212486, "answer_count": 1, "score": 2, "last_activity_date": 1487016310, "creation_date": 1487010856, "question_id": 42211074, "link": "https://stackoverflow.com/questions/42211074/weird-freer-type-error-when-combining-state-and-io-effects", "title": "Weird `freer` type error when combining State and IO effects", "body": "<p>I'm trying to run this freer code:</p>\n\n<pre><code>{-# LANGUAGE DataKinds        #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE GADTs            #-}\n{-# LANGUAGE TupleSections    #-}\n{-# LANGUAGE TypeOperators    #-}\n\nmodule Lib where\n\nimport           Control.Monad.Freer\nimport           Control.Monad.Freer.Internal\nimport           Control.Monad.Freer.State\nimport           Data.IORef\n\nrunStateIO :: (Member (State s) r, Member IO r) =&gt; IORef s -&gt; Eff (State s ': r) a -&gt; Eff r (a,s)\nrunStateIO ref = loop\n  where\n    loop (Val v) = (v,) &lt;$&gt; send (readIORef ref)\n    loop (E u q) =\n      case decomp u of\n        Right Get     -&gt; send (readIORef ref) &gt;&gt;= loop . qApp q\n        Right (Put s) -&gt; send (writeIORef ref s) &gt;&gt; loop (qApp q ())\n        Left u'       -&gt; E u' (tsingleton (loop . qApp q))\n\nstatefulFac :: Member (State Int) r =&gt; Int -&gt; Eff r ()\nstatefulFac 1 = return ()\nstatefulFac n = do\n    a &lt;- get\n    put (n * a)\n    statefulFac (n - 1)\n\nrunStatefulFac_IO :: Int -&gt; IO Int\nrunStatefulFac_IO n = do\n    ref &lt;- newIORef 1 :: IO (IORef Int)\n\n    let\n      -- none of these work:\n      -- stateful_fac :: (Member (State Int) r, Member IO r) =&gt; Eff r ()\n      -- stateful_fac :: Eff '[IO, State Int] ()\n      -- stateful_fac :: Eff '[State Int, IO] ()\n      stateful_fac = statefulFac 5\n\n      r = runStateIO ref stateful_fac\n\n    -- runM r\n    undefined\n\nrunStatefulFac_pure :: Int -&gt; Int\nrunStatefulFac_pure n = snd (run (runState (statefulFac n) 1))\n</code></pre>\n\n<p>This is using stock <code>freer</code>, except I exported constructors of <code>State</code> effect to be able to run <code>runStateIO</code> interpreter. The problem is it's failing with</p>\n\n<pre><code>example.hs:42:11: error:\n    \u2022 Ambiguous type variable \u2018r0\u2019 arising from a use of \u2018runStateIO\u2019\n      prevents the constraint \u2018(Data.Open.Union.Internal.Member'\n                                  (State Int)\n                                  r0\n                                  (Data.Open.Union.Internal.FindElem\n                                     (State Int) r0))\u2019 from being solved.\n      Relevant bindings include\n        r :: Eff r0 ((), Int) (bound at example.hs:42:7)\n        stateful_fac :: Eff (State Int : r0) () (bound at example.hs:40:7)\n      Probable fix: use a type annotation to specify what \u2018r0\u2019 should be.\n      These potential instances exist:\n        two instances involving out-of-scope types\n          instance [safe] (r ~ (t' : r' : rs'),\n                           Data.Open.Union.Internal.Member' t (r' : rs') n) =&gt;\n                          Data.Open.Union.Internal.Member'\n                            t r ('Data.Open.Union.Internal.S n)\n            -- Defined in \u2018Data.Open.Union.Internal\u2019\n          instance [safe] r ~ (t : r') =&gt;\n                          Data.Open.Union.Internal.Member' t r 'Data.Open.Union.Internal.Z\n            -- Defined in \u2018Data.Open.Union.Internal\u2019\n    \u2022 In the expression: runStateIO ref stateful_fac\n      In an equation for \u2018r\u2019: r = runStateIO ref stateful_fac\n      In the expression:\n        do { ref &lt;- newIORef 1 :: IO (IORef Int);\n             let stateful_fac = statefulFac 5\n                 r = runStateIO ref stateful_fac;\n             undefined }\n</code></pre>\n\n<p>I'm wondering (1) what is this message trying to say (2) what's wrong with this code and how do I fix it? Thanks.</p>\n"}, {"tags": ["algorithm", "list", "haskell", "optimization", "np-hard"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1487012838, "post_id": 42211066, "comment_id": 71584486, "body": "I&#39;m not sure, but in this case you could also probably say something about &quot;cardinality&quot;, e.g. &quot;the sequence whose alphabet has lowest cardinality&quot;. But I guess that&#39;s worse than &quot;contains the most duplicates&quot;..."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1487013000, "post_id": 42211066, "comment_id": 71584575, "body": "I wrote an answer proposing &quot;multiplicity&quot;, but then realized I don&#39;t really understand the question. (e.g. does <code>[1,4,1,4]</code> have more &quot;duplicates&quot; than <code>[1,1,1,4]</code>? Why (not)?) Even so you might enjoy reading about that word on e.g. Wikipedia to see if it sounds relevant to you."}, {"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1487019119, "post_id": 42211066, "comment_id": 71587931, "body": "@jberryman In a way that&#39;s actually better, since it positively emphasizes the property I am after. When you said &quot;alphabet&quot; I also realized that one could speak in terms of operations on the list. I might want to use the term &quot;projection&quot;."}, {"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487019718, "post_id": 42211066, "comment_id": 71588283, "body": "@DanielWagner &quot;Multiplicity&quot; sounds catchy. If I interpret my lists as multisets, it&#39;s a very close fit I think. <code>[1,4,1,4]</code> is as good as <code>[1,1,1,4]</code> (their <code>nub</code>s have the same length), so I would be after something like &quot;total multiplicity&quot;. More specifically about the why: I am using this in the generation of certain graphs in which I want to merge as many identical nodes as possible."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1487032230, "post_id": 42211066, "comment_id": 71593101, "body": "&quot;homogeneity&quot; ? Or entropy, like defined by Shannon, if you consider a list as the possible values of a variable."}, {"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "reply_to_user": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1487081649, "post_id": 42211066, "comment_id": 71616192, "body": "@Jean-BaptistePotonnier <code>[1,4,1,4]</code> and <code>[1,1,1,4]</code> would have different entropies, although I consider them equal."}], "answers": [{"comments": [{"owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "edited": false, "score": 0, "creation_date": 1487029888, "post_id": 42211670, "comment_id": 71592446, "body": "Brilliant. From the Wikipedia link I understand that my function is actually solving the <b>hitting set problem</b> which is achieved by interchanging sets and universe from the minimum-set-cover problem. Which is exactly what you&#39;re doing here."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1487027104, "last_edit_date": 1487027104, "creation_date": 1487012876, "answer_id": 42211670, "question_id": 42211066, "link": "https://stackoverflow.com/questions/42211066/what-do-you-call-the-property-of-a-list-that-describes-the-degree-to-which-it-co/42211670#42211670", "title": "What do you call the property of a list that describes the degree to which it contains duplicates?", "body": "<p>I believe your function is computing a <a href=\"https://en.wikipedia.org/wiki/Set_cover_problem\" rel=\"nofollow noreferrer\">minimum set cover</a>:</p>\n\n<blockquote>\n  <p>Given a set of elements { 1 , 2 , . . . , n } (called the universe) and a collection S of sets whose union equals the universe, the set cover problem is to identify the smallest sub-collection of S whose union equals the universe.</p>\n</blockquote>\n\n<p>In your case, n is <code>length xss</code>. There is one set in S for each distinct element <code>x</code> of <code>concat xss</code>, namely the set { <code>i</code> | <code>x `elem` (xss !! i)</code> } of all indices that <code>x</code> occurs in. The minimum set cover then tells you which <code>x</code> to choose from each list in <code>xss</code> (sometimes giving you multiple choices; any choice will produce the same final nubbed length).</p>\n\n<p>Here is a worked example for your <code>[[1,2,3],[4],[1,5]]</code>:</p>\n\n<p>The universe is {1,2,3}.</p>\n\n<p>There are five sets in the collection S; I'll name them S_1 through S_5:</p>\n\n<ul>\n<li>S_1 = {1,3} because the first and third lists contain 1.</li>\n<li>S_2 = {1} because the first list contains 2.</li>\n<li>S_3 = {1} because the first list contains 3.</li>\n<li>S_4 = {2} because the second list contains 4.</li>\n<li>S_5 = {3} because the third list contains 5.</li>\n</ul>\n\n<p>A minimum set cover for this is {S_1, S_4}. Because this is a set cover, this means every list contains either <code>1</code> or <code>4</code>. Because it is minimal, no other choice of sets produces a smaller final collection of values. So, we can choose either <code>1</code> or <code>4</code> from each list to produce a final answer. As it happens, no list contains both <code>1</code> and <code>4</code> so there is only one choice, namely <code>[1,4,1]</code>.</p>\n"}], "owner": {"reputation": 160, "user_id": 7559168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a0e9b0b9b87cc41ad8b1e17bf7265c?s=128&d=identicon&r=PG&f=1", "display_name": "marc_r", "link": "https://stackoverflow.com/users/7559168/marc-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 42211670, "answer_count": 1, "score": 3, "last_activity_date": 1487082048, "creation_date": 1487010819, "last_edit_date": 1487082048, "question_id": 42211066, "link": "https://stackoverflow.com/questions/42211066/what-do-you-call-the-property-of-a-list-that-describes-the-degree-to-which-it-co", "title": "What do you call the property of a list that describes the degree to which it contains duplicates?", "body": "<p>I have a function that selects Cartesian products of lists such that the number of duplicate elements is highest:</p>\n\n<pre><code>import Data.List (nub)\n\nf :: Eq a =&gt; [[a]] -&gt; [[a]]\nf xss = filter ((==) minLength . length . nub) cartProd\n  where\n    minLength = minimum (map (length . nub) cartProd)\n    cartProd = sequence xss\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>*Main&gt; f [[1,2,3],[4],[1,5]]\n[[1,4,1]]\n</code></pre>\n\n<p>But:</p>\n\n<pre><code>*Main&gt; sequence [[1,2,3],[4],[1,5]]\n[[1,4,1],[1,4,5],[2,4,1],[2,4,5],[3,4,1],[3,4,5]]\n</code></pre>\n\n<p>Is there a name for the property that the result of my function f has?</p>\n"}, {"tags": ["algorithm", "haskell"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1487012802, "post_id": 42211011, "comment_id": 71584474, "body": "That&#39;s the usual definition of perm, right? <code>perm :: {1,2...,N} -&gt; {1,2...,N}</code> a bijection and so on. A O(N^2) algorithm should be rather simple, but your input in <code>(1 n 2)</code> is a rotational one, not a bijection. So decide: what&#39;s your actual input?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1487014490, "post_id": 42211011, "comment_id": 71585435, "body": "@Zeta Whenever <code>n</code> is bigger than <code>3</code>, <code>(1 n 2)</code> is a bijection that maps <code>1 |-&gt; n</code>, <code>n |-&gt; 2</code>, <code>2 |-&gt; 1</code>, and all other values to themselves."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1487014930, "post_id": 42211011, "comment_id": 71585698, "body": "@DanielWagner which is what I meant with &quot;rotational one&quot; :). I don&#39;t recall the correct term for that kind of writing a permutation."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1487033692, "post_id": 42212296, "comment_id": 71593500, "body": "It would probably be nicer to have some sort of <code>[a] -&gt; [a]</code> new type to represent your permutation since then you could compose permutations. Something allowing (more or less) <code>cycle [1,2,3] . cycle [3,7] $ [1..10]</code>."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487045063, "post_id": 42212296, "comment_id": 71596315, "body": "@Alec What&#39;s wrong with <code>[1,2,3] * [3,7] * [1..10]</code>?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487045414, "post_id": 42212296, "comment_id": 71596395, "body": "@Alec (Or, if you really must, <code>cycle = (*)</code>, and then your syntax works just fine with no further newtypes nonsense.)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1487048304, "post_id": 42212296, "comment_id": 71597128, "body": "Ah yes. With your last fixity update, <code>cycle = (*)</code> is a clever idea."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 2, "last_activity_date": 1487045304, "last_edit_date": 1487045304, "creation_date": 1487015181, "answer_id": 42212296, "question_id": 42211011, "link": "https://stackoverflow.com/questions/42211011/permutations-acting-on-lists-of-length-n/42212296#42212296", "title": "permutations acting on lists of length n", "body": "<p>I would use the input permutation to build a map from old indices to new indices.</p>\n\n<pre><code>import Prelude hiding ((*))\nimport qualified Data.Map as M\n\ninfixr 5 * -- right-associative so we can compose permutations conveniently\n\n(*) :: [Int] -&gt; [a] -&gt; [a]\nperm * xs = zipWith (\\i _ -&gt; xs !! M.findWithDefault i i ixMap) [0..] xs\n    where ixMap = M.fromList (zip perm (drop 1 perm ++ take 1 perm))\n</code></pre>\n\n<p>You can see it in action in the ghci prompt (though as usual in programming it uses 0-based rather than 1-based indexing):</p>\n\n<pre><code>&gt; [0,1] * \"xyz\"\n\"yxz\"\n&gt; [0,4,1] * \"abcde\"\n\"eacdb\"\n</code></pre>\n\n<p>This costs O(n^2 log m) where n is the length of <code>xs</code> and m is the length of <code>perm</code>. You can reduce this to O(n log(nm)) by switching from <code>(!!)</code> to <code>M.lookup</code> for the indexing into <code>xs</code>, too.</p>\n"}], "owner": {"reputation": 932, "user_id": 730606, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/6c007d88f3e1d6ddac17f453d2962c13?s=128&d=identicon&r=PG", "display_name": "Polymer", "link": "https://stackoverflow.com/users/730606/polymer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 42212296, "answer_count": 1, "score": 0, "last_activity_date": 1487045304, "creation_date": 1487010639, "question_id": 42211011, "link": "https://stackoverflow.com/questions/42211011/permutations-acting-on-lists-of-length-n", "title": "permutations acting on lists of length n", "body": "<p>In math, when I want to rearrange a list of length n, I'll act on the list with a permutation. For example:</p>\n\n<pre><code>(1 2) * (x, y, z) = (y, x, z)\n(1 n 2) * (v[1], v[2], ..., v[n]) = (v[n], v[1], ..., v[2])\nperm * (v[1], v[2], ..., v[n]) = ( v[perm(1)], v[perm(2)], ..., v[perm(n)] )\n</code></pre>\n\n<p>How would I do this in Haskell?</p>\n"}, {"tags": ["haskell", "time-complexity", "space-complexity"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1487004656, "post_id": 42209200, "comment_id": 71579754, "body": "There&#39;s not much step-by-step to be done here \u2013 this function simply has the max complexity of <code>sum</code> and <code>zipWith</code>. Both are <i>O</i> (<i>n</i>) in space and time (<code>zipWith</code> only if you actually force the entire result, but <code>sum</code> does this anyway)."}, {"owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1487005441, "post_id": 42209200, "comment_id": 71580225, "body": "@leftaroundabout Ok, suppose I have another function that uses innerProduct as: matrixMult xs ys = [ [ ( innerProduct x y ) | x &lt;- xs ] | y &lt;- transpose ys ], the complexity will be O(n)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 4, "creation_date": 1487006730, "post_id": 42209200, "comment_id": 71580954, "body": "nothing precludes a clever implementation from fusing <code>sum</code> and <code>zipWith (*)</code> into one O(1)-space loop (as  described  by Daniel P. Friedman and David S. Wise in 1974 TR19: &quot;Unwinding Structured Recursions into Iterations&quot;). Haskell the <i>language</i> doesn&#39;t say one way or the other."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 1, "creation_date": 1487074504, "post_id": 42209200, "comment_id": 71611371, "body": "There cannot be a general step-by-step analysis that assesses complexity, because even deciding termination is not possible, for bounded recursion of course, but in general no, so be a bit more specific about what classes of programs you care about."}], "owner": {"reputation": 555, "user_id": 5973371, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/57038c49f6bb5b7ab57269bc1f00ab93?s=128&d=identicon&r=PG", "display_name": "Zubin Kadva", "link": "https://stackoverflow.com/users/5973371/zubin-kadva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 422, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1487004331, "creation_date": 1487004331, "question_id": 42209200, "link": "https://stackoverflow.com/questions/42209200/how-to-find-complexity-of-haskell-code", "title": "How to find complexity of Haskell code", "body": "<p>I am new to analysis of algorithms. I have a fair understanding of functional languages. I would like to know how to calculate <strong>time and space</strong> complexity of a given Haskell program.</p>\n\n<p>eg. </p>\n\n<pre><code>innerProduct :: Num a =&gt; [a] -&gt; [a] -&gt; a\ninnerProduct x y = sum (zipWith (*) x y)\n</code></pre>\n\n<p>I need a step by step analysis so that I can understand better.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "edited": false, "score": 1, "creation_date": 1487004375, "post_id": 42208744, "comment_id": 71579592, "body": "Oh, and binding with <code>&lt;-</code> desugars into a case statement with mfail as default branch, for lists the same as guard. That also clears up some misconceptions I had about how let bindings in do notation desugar, thanks!"}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 6, "last_activity_date": 1487002810, "creation_date": 1487002810, "answer_id": 42208744, "question_id": 42208385, "link": "https://stackoverflow.com/questions/42208385/pattern-guards-and-lets/42208744#42208744", "title": "Pattern guards and lets", "body": "<p>The <code>let</code> binding in your second example is never evaluated because its value is never used. It is the same as writing:</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>sundays = length $ do\n  year &lt;- [1901..2000]\n  month &lt;- [1..12]\n  return ()\n</code></pre>\n\n<p>If you wanted to expand the second example, I'd suggest using <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad.html#v:guard\"><code>guard</code></a> from <code>Control.Monad</code>, which will effectively filter the results as expected:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sundays2 = length $ do\n  year &lt;- [1901..2000]\n  month &lt;- [1..12]\n  let (_, _, day) = toWeekDate $ fromGregorian year month 1\n  guard $ day == 7\n  return ()\n</code></pre>\n\n<p><code>guard</code> is what is used behind the scenes in list comprehension. Your code above could be written in list comprehension form like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>sundays3 = length $ [ () | year &lt;- [1901..2000]\n                         , month &lt;- [1..12]\n                         , let (_, _, day) = toWeekDate $ fromGregorian year month 1\n                         , day == 7 ]\n</code></pre>\n"}], "owner": {"reputation": 654, "user_id": 7501619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dfb3e55ff104cf8485859d00fc6ecbcb?s=128&d=identicon&r=PG&f=1", "display_name": "Taren", "link": "https://stackoverflow.com/users/7501619/taren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 42208744, "answer_count": 1, "score": 2, "last_activity_date": 1487002827, "creation_date": 1487001809, "question_id": 42208385, "link": "https://stackoverflow.com/questions/42208385/pattern-guards-and-lets", "title": "Pattern guards and lets", "body": "<p>While working through the first couple exercises of project euler I was surprised by the way haskell handles failed let bindings within do notation.<br>\nI intended to do the equivalent of:</p>\n\n<pre><code>sundays = length $ do\n  year &lt;- [1901..2000]\n  month &lt;- [1..12]\n  (_, _, 7) &lt;- return . toWeekDate $ fromGregorian year month 1\n  return ()\n</code></pre>\n\n<p>That is, check how often the first day of the month within a certain time range is a Sunday. This works and doing this with a case binding works as well. The let binding which seems like it ought to do the same thing always passes, though:</p>\n\n<pre><code>sundays = length $ do\n  year &lt;- [1901..2000]\n  month &lt;- [1..12]\n  let (_, _, 7) = toWeekDate $ fromGregorian year month 1\n  return ()\n</code></pre>\n\n<p>What causes this behavior?</p>\n"}, {"tags": ["haskell", "monads", "composition", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487019252, "post_id": 42213268, "comment_id": 71588002, "body": "When you say not every transformed monad is a monad, do you mean even for meaningful monad transformer or simply that the signature of monad trans does not guarantee the result to be a monad (because that is obvious, but there often are additional laws to everything so that alone would not be a real problem). Why would something be called monad transformer if it produces bogus results when applied to monads :)"}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487019610, "post_id": 42213268, "comment_id": 71588220, "body": "I mean that &quot;the signature of monad trans does not guarantee the result to be a monad&quot;."}, {"owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487020381, "post_id": 42213268, "comment_id": 71588631, "body": "One would need a bunch of extensions to make it work. <code>GADTs</code>, <code>ScopedTypeVariables</code>, <code>KindSignatures</code> and <code>InstanceSigs</code>, to be exact."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487023465, "post_id": 42213268, "comment_id": 71590114, "body": "That is not surprising at all that <code>(* -&gt; *) -&gt; * -&gt; *</code> does not necessarily produce a monad, in that sense not even every <code>Monad</code> is <code>Functor</code>... just a bogus <code>Monad</code> not abiding the laws can just as well violate <code>Functor</code> laws..."}], "tags": [], "owner": {"reputation": 1679, "user_id": 1722752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef35ad86b627ba3176b6aea8a184f51c?s=128&d=identicon&r=PG", "display_name": "MigMit", "link": "https://stackoverflow.com/users/1722752/migmit"}, "is_accepted": false, "score": 3, "last_activity_date": 1487020204, "last_edit_date": 1487020204, "creation_date": 1487018926, "answer_id": 42213268, "question_id": 42207476, "link": "https://stackoverflow.com/questions/42207476/precomposing-monad-transformers/42213268#42213268", "title": "Precomposing monad transformers", "body": "<p>First of all: what you want is impossible. You've correctly identified the problem: even if <code>m</code> is a monad, and <code>t</code> \u2014 a transformer, nobody guarantees that <code>t m</code> would be a monad.</p>\n\n<p>On the other hand, it usually is. But \u2014 at least theoretically \u2014 not always, so, you'd have to somehow mark the occasions when it is. Which means marking it with an instance of another typeclass that you'd have to define yourself. Let's see how it works.</p>\n\n<p>We'll start with a name for our new class:</p>\n\n<pre><code>class MonadTrans t =&gt; MonadTransComposeable t where\n</code></pre>\n\n<p>Now, <code>where</code> what? We want to generate a <code>Monad (t m)</code> instance. Unfortunately, it's not something we can do. Class instances, while being just data, are not considered the same kind of data as everything else; we can't make a function that generates them. So, we have to work around this somehow. But if we have such a thing, then the class is pretty simple</p>\n\n<pre><code>class MonadTrans t =&gt; MonadTransComposeable t where\n    transformedInstance :: Monad m =&gt; MonadInstance (t m)\n</code></pre>\n\n<p>Let's define <code>MonadInstance</code> now. We want to make sure that if there is <code>MonadInstance n</code>, then <code>n</code> is a monad. <code>GADT</code>s come to the rescue:</p>\n\n<pre><code>data MonadInstance n where MonadInstance :: Monad n =&gt; MonadInstance n\n</code></pre>\n\n<p>Notice that the <code>MonadInstance</code> constructor has a context, which guarantees that we can't make <code>MonadInstance n</code> without <code>n</code> being a <code>Monad</code>.</p>\n\n<p>We can define instances of <code>MonadTransComposeable</code> now:</p>\n\n<pre><code>instance MonadTransComposeable (StateT s) where\n    transformedInstance = MonadInstance\n</code></pre>\n\n<p>It would work, since it's already established in the <code>transformers</code> package that whenever <code>m</code> is a monad, <code>StateT m</code> is a monad too. Therefore, <code>MonadInstance</code> constructor makes sense.</p>\n\n<p>Now we can compose <code>MonadTrans</code> and <code>MonadTransComposeable</code>. Using your own definition</p>\n\n<pre><code>newtype X t1 (t2 :: (* -&gt; *) -&gt; (* -&gt; *)) m a = X { x :: t1 (t2 m) a }\n</code></pre>\n\n<p>we can define an instance. We now can prove that <code>t2 m</code> is a monad; it's not automatic, and we have to tell Haskell which <code>transformedInstance</code> to use, but it's not hard:</p>\n\n<pre><code>instance (MonadTrans t1, MonadTransComposeable t2) =&gt; MonadTrans (X t1 t2) where\n  lift :: forall m a. (Monad m) =&gt; m a -&gt; X t1 t2 m a\n  lift ma =\n    case transformedInstance :: MonadInstance (t2 m) of\n      MonadInstance -&gt; X (lift (lift ma))\n</code></pre>\n\n<hr>\n\n<p>Now, let's do something fun. Let's tell Haskell, that whenever <code>t1</code> and <code>t2</code> are \"good\" (composeable) monad transformers, <code>X t1 t2</code> is too.</p>\n\n<p>As before, it's quite easy:</p>\n\n<pre><code>instance (MonadTransComposeable t1, MonadTransComposeable t2) =&gt; MonadTransComposeable (X t1 t2) where\n  transformedInstance = MonadInstance\n</code></pre>\n\n<p>Same as with <code>StateT</code>. The catch is that now Haskell would complain that it can't know if <code>X t1 t2 m</code> is really a monad. Which is fair \u2014 we didn't define an instance. Let's do that.</p>\n\n<p>We will use the fact that <code>t1 (t2 m)</code> is a monad. So, we make this explicit:</p>\n\n<pre><code>transformedInstance2 :: forall t1 t2 m. (MonadTransComposeable t1, MonadTransComposeable t2, Monad m) =&gt; MonadInstance (t1 (t2 m))\ntransformedInstance2 =\n  case transformedInstance :: MonadInstance (t2 m) of\n    MonadInstance -&gt; transformedInstance\n</code></pre>\n\n<p>Now, we'll define a <code>Monad (X t1 t2 m)</code> instance. Because of a stupid decision to make <code>Monad</code> a subclass of <code>Applicative</code>, we can't do this in one statement, but have to go through <code>Functor</code> and <code>Applicative</code>, but it's not hard:</p>\n\n<pre><code>instance (MonadTransComposeable t1, MonadTransComposeable t2, Monad m) =&gt; Functor (X t1 t2 m) where\n  fmap h (X ttm) =\n    case transformedInstance2 :: MonadInstance (t1 (t2 m)) of\n      MonadInstance -&gt; X (fmap h ttm)\n\ninstance (MonadTransComposeable t1, MonadTransComposeable t2, Monad m) =&gt; Applicative (X t1 t2 m) where\n  pure a =\n    case transformedInstance2 :: MonadInstance (t1 (t2 m)) of\n      MonadInstance -&gt; X (pure a)\n  (X ttf) &lt;*&gt; (X tta) =\n    case transformedInstance2 :: MonadInstance (t1 (t2 m)) of\n      MonadInstance -&gt; X (ttf &lt;*&gt; tta)\n</code></pre>\n\n<p>and, finally</p>\n\n<pre><code>instance (MonadTransComposeable t1, MonadTransComposeable t2, Monad m) =&gt; Monad (X t1 t2 m) where\n  X tta &gt;&gt;= f =\n    case transformedInstance2 :: MonadInstance (t1 (t2 m)) of\n      MonadInstance -&gt; X (tta &gt;&gt;= \\a -&gt; case f a of X ttb -&gt; ttb)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487027653, "post_id": 42215178, "comment_id": 71591846, "body": "Thank you! Any chance of ever being added?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487027788, "post_id": 42215178, "comment_id": 71591878, "body": "@jd823592 I doubt it. It&#39;d break too much code - every <code>MonadTrans</code> instance in the world, including those in third-party closed-source codebases, would have to be changed to implement the <code>transform</code> member, which is not always trivial - and in practice <code>transform</code> doesn&#39;t really turn out to be all that useful so the benefits don&#39;t outweigh the costs. (I&#39;ve updated my answer.)"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487029019, "post_id": 42215178, "comment_id": 71592217, "body": "But since no code really uses the feature cant there be default definition of <code>transform</code> which would fail. Since it is not being used it wouldn&#39;t break code, and transformers used to break stuff from one version to next, that&#39;s what versioning is good for :) so even then, no <code>transform</code> for transformers :&#39;( :)? Of course standard transformers would get proper implementation."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487030737, "post_id": 42215178, "comment_id": 71592676, "body": "@jd823592 As soon as you try to do something interesting with <code>transform</code>, eg, <a href=\"https://gist.github.com/benjamin-hodgson/dad9ba2292aed0f0724ae9526f8a00f1\" rel=\"nofollow noreferrer\">talking about monad transformer stacks as first class citizens</a>, you need every transformer you&#39;re interested in to have a working <code>transform</code>, not just the ones in <code>transformers</code>. If some transformer <code>MyT</code> has <code>transform = undefined</code> then I can&#39;t use <code>ReaderT r :.: MyT</code> as a transformer because <code>lift</code> and <code>&gt;&gt;=</code> will blow up. (<code>transform</code> contains actual useful runtime data, namely (a way to get) an implementation of <code>&gt;&gt;=</code> and <code>return</code>.)"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487031739, "post_id": 42215178, "comment_id": 71592974, "body": "I don&#39;t see how <code>lift</code> depends on <code>transform</code>, especially as in current code it doesn&#39;t"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487031830, "post_id": 42215178, "comment_id": 71592994, "body": "@jd823592 <a href=\"https://gist.github.com/benjamin-hodgson/dad9ba2292aed0f0724ae9526f8a00f1#file-transformerstacks-hs-L37-L39\" rel=\"nofollow noreferrer\">I need it to tell the elaborator where to dispatch the calls to <code>lift</code>.</a>"}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487032236, "post_id": 42215178, "comment_id": 71593102, "body": "But <code>transform</code> is being used only in context that wasn&#39;t possible with transformers-0.5 so why should it blow up for all code? Sorry I am dumb."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "edited": false, "score": 0, "creation_date": 1487032277, "post_id": 42215178, "comment_id": 71593118, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/135637/discussion-between-benjamin-hodgson-and-jd823592\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1487034225, "last_edit_date": 1487034225, "creation_date": 1487027384, "answer_id": 42215178, "question_id": 42207476, "link": "https://stackoverflow.com/questions/42207476/precomposing-monad-transformers/42215178#42215178", "title": "Precomposing monad transformers", "body": "<blockquote>\n  <p>[C]an a valid monad transformer produce a non-monad when applied to a monad?</p>\n</blockquote>\n\n<p>No. A monad transformer is a type constructor <code>t :: (* -&gt; *) -&gt; (* -&gt; *)</code> which takes a monad as an argument and produces a new monad.</p>\n\n<p>While I'd like to see it more explicitly stated, <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Class.html\" rel=\"nofollow noreferrer\">the <code>transformers</code> documentation</a> does say \"A monad transformer makes a new monad out of an existing monad\", and it's implied by <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Class.html#t:MonadTrans\" rel=\"nofollow noreferrer\">the <code>MonadTrans</code> laws</a>:</p>\n\n<pre><code>lift . return = return\nlift (m &gt;&gt;= f) = lift m &gt;&gt;= (lift . f)\n</code></pre>\n\n<p>Obviously these laws only make sense if <code>lift m</code> is indeed a monadic computation. As you pointed out in the comments, all bets are off if we have non-lawful instances to contend with. This is Haskell, not Idris, so we're used to asking politely for laws to be satisfied using documentation, rather than requiring it by force using types.</p>\n\n<p>A more \"modern\" <code>MonadTrans</code> might require explicit proof that <code>t m</code> is a monad whenever <code>m</code> is. Here I'm using <a href=\"https://hackage.haskell.org/package/constraints-0.9/docs/Data-Constraint.html#t::-45-\" rel=\"nofollow noreferrer\">the \"entailment\" operator <code>:-</code></a> from <a href=\"https://hackage.haskell.org/package/constraints\" rel=\"nofollow noreferrer\">Kmett's <code>constraints</code> library</a> to say that <code>Monad m</code> implies <code>Monad (t m)</code>:</p>\n\n<pre><code>class MonadTrans t where\n    transform :: Monad m :- Monad (t m)\n    lift :: Monad m =&gt; m a -&gt; t m a\n</code></pre>\n\n<p>(This is more or less the same idea that @MigMit developed in his answer, but using off-the-shelf components.)</p>\n\n<p>Why doesn't the <code>MonadTrans</code> in <code>transformers</code> feature the <code>transform</code> member? When it was written GHC didn't support the <code>:-</code> operator (the <code>ConstraintKinds</code> extension hadn't been invented). There's lots and lots of code in the world which depends on the <code>MonadTrans</code> without <code>transform</code>, so we can't really go back and add it in without <a href=\"https://wiki.haskell.org/Functor-Applicative-Monad_Proposal\" rel=\"nofollow noreferrer\">a really good reason</a>, and in practice the <code>transform</code> method doesn't really buy you much.</p>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 1, "last_activity_date": 1487081220, "creation_date": 1487081220, "answer_id": 42228280, "question_id": 42207476, "link": "https://stackoverflow.com/questions/42207476/precomposing-monad-transformers/42228280#42228280", "title": "Precomposing monad transformers", "body": "<p>There is a well known theory which says that monads are not generally composable. That is, given any two arbitrary monads, <code>t</code>, and <code>u</code> there is no guarantee that <code>t</code> &#9675; <code>u</code> is a monad, where (<code>t</code> &#9675; <code>u</code>) <code>a</code> = <code>t (u a)</code>. This seems to be the ultimate reason why this precomposition is not available. </p>\n\n<p>The rational is simple. First, notice that any monad can be written as a transform of the identity monad.  Then, any two monads can be translated to the form of <code>X</code>. This corresponds to their composition, which isn't generally allowed, so we know that <code>X</code> shouldn't generally be allowed. </p>\n\n<p>Let <code>Id</code> be the identity monad,</p>\n\n<pre><code>newtype Id a = Id a\n</code></pre>\n\n<p>and let composition be given by:</p>\n\n<pre><code>newtype t \u25cb u a = Comp (t (u a))\n</code></pre>\n\n<p>Also let, for any monad <code>t</code>, the composition with <code>Id</code> is equal to <code>t</code>.</p>\n\n<pre><code>t \u25cb Id ~ t ~ Id \u25cb t\n</code></pre>\n\n<p>Then, we investigate the case of <code>X t u m a</code> wherein <code>t</code> <code>u</code> are compositions with <code>Id</code>. The type and construction are given by</p>\n\n<pre><code>X (t \u25cb) (Id \u25cb (u \u25cb)) (Id \u25cb m) a \n  = X ((t \u25cb) (Id \u25cb (u \u25cb (Id \u25cb m)) a)\n</code></pre>\n\n<p>And the RHS constructor is equivalent to</p>\n\n<pre><code>  ~ X ((t \u25cb) (u \u25cb m) a)\n</code></pre>\n\n<p>Which has the type</p>\n\n<pre><code>X (t \u25cb) (u \u25cb) m a\n</code></pre>\n\n<p>And so the partial application <code>X (t \u25cb) (u \u25cb)</code> corresponds to the composition of any two monads, which isn't allowed.</p>\n\n<p>All this isn't to say that we can't compose monads, but rather an explanation of why we need methods such as <code>transform</code> or <code>MonadTransComposable</code> from Benjamin Hodgson and MigMit, respectively.</p>\n\n<p>I've made this a community wiki, as I expect the above, fast-and-loose proof can be greatly improved by people who actually know what they're doing.</p>\n"}], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 42215178, "answer_count": 3, "score": 5, "last_activity_date": 1487081220, "creation_date": 1486999154, "last_edit_date": 1487003741, "question_id": 42207476, "link": "https://stackoverflow.com/questions/42207476/precomposing-monad-transformers", "title": "Precomposing monad transformers", "body": "<p>Suppose I have two monad transformers</p>\n\n<pre><code>T1 :: (* -&gt; *) -&gt; * -&gt; *\nT2 :: (* -&gt; *) -&gt; * -&gt; *\n</code></pre>\n\n<p>with instances</p>\n\n<pre><code>instance MonadTrans T1\ninstance MonadTrans T2\n</code></pre>\n\n<p>and some</p>\n\n<pre><code>X :: (((* -&gt; *) -&gt; * -&gt; *) -&gt; ((* -&gt; *) -&gt; * -&gt; *) -&gt; * -&gt; *)\n</code></pre>\n\n<p>such as</p>\n\n<pre><code>newtype X t1 t2 a b = X { x :: t1 (t2 a) b }\n</code></pre>\n\n<p>for which I would like to define something along the lines</p>\n\n<pre><code>instance (MonadTrans t1, MonadTrans t2) =&gt; MonadTrans (X t1 t2) where\n    lift = X . lift . lift\n</code></pre>\n\n<p>so that I can use <code>lift</code> to lift <code>m a</code> into <code>X T1 T2 m a</code>?</p>\n\n<p>The problem here seems to be that the <code>lift</code>s act on some monad <code>Monad m =&gt; m a</code> which I cannot guarantee to be produce in the intermediate steps. But this is confusing for me. I am providing an implementation of <code>lift</code> so I can assume I have <code>Monad m =&gt; m a</code>, so I apply the rightmost <code>lift</code> and get <code>T1 m a</code> that I know nothing about, but shouldn't it be implied that <code>T1 m</code> is a <code>Monad</code>? If not why cannot I simply add this to the constraint of my instance</p>\n\n<pre><code>instance ( MonadTrans t1\n         , MonadTrans t2\n         , Monad (t2 m) ) =&gt; MonadTrans (X t1 t2) where ...\n</code></pre>\n\n<p>This does not work either. I have an intuition that by the above I am saying \"should there be <code>t1</code>, <code>t2</code>, <code>m</code> such that ...\" which is too weak to prove that <code>X t1 t2</code> is a transformer (works for any/all <code>Monad m</code>). But it still doesn't make much sense to me, can a valid monad transformer produce a non-monad when applied to a monad? If not, I should be able to get away with the instance of <code>MonadTrans (X t1 t2)</code>.</p>\n\n<p>Is there a trick to do it that just eludes me or is there a reason why it cannot be done (theoretical or a limitation of what current compilers support).</p>\n\n<p>Would the implication correspond to anything other than</p>\n\n<pre><code>instance (MonadTrans t, Monad m) =&gt; Monad (t m) where\n    return  = lift . return\n    a &gt;&gt;= b = ... # no sensible generic implementation\n</code></pre>\n\n<p>which would overlap other instances / could not provide the specific bind? Couldn't this be worked around with some indirection? Making <code>returnT :: Monad m =&gt; a -&gt; t m a</code> and <code>bindT :: Monad m =&gt; t m a -&gt; (a -&gt; t m b) -&gt; t m b</code> part of <code>MonadTrans</code> so that one can then write</p>\n\n<pre><code>instance MonadTrans (StateT s) where\n    lift = ...\n    returnT = ...\n    bindT = ...\n\n...\n\ninstance (MonadTrans t, Monad m) =&gt; Monad (t m) where\n    return  = returnT\n    a &gt;&gt;= b = a `bindT` b\n</code></pre>\n\n<p>This kind of instances is not currently valid due to overlapping, would they however be feasible, useful?</p>\n"}, {"tags": ["haskell", "arrows"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1486999572, "post_id": 42207457, "comment_id": 71576419, "body": "I&#39;m pretty sure this isn&#39;t possible, at least not without some audacious infinite knot tying or unsafe use of bottom values. It could very well be done under some extra constraints though \u2013 what&#39;s your actual use case?"}, {"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1486999750, "post_id": 42207457, "comment_id": 71576537, "body": "I&#39;ve a configurable set of encoding / decoding operators, each of which has type (a,b) -&gt; (a&#39;, b&#39;). I can tie them together manually, but pipes seemed a good fit. It would be perfect, except the encoding pipeline needs to be composed left to light, and the decode right to left."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 1, "creation_date": 1487000897, "post_id": 42207457, "comment_id": 71577336, "body": "Why not just split the tuples and then compose?"}, {"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "edited": false, "score": 0, "creation_date": 1487001072, "post_id": 42207457, "comment_id": 71577471, "body": "Well yes: that&#39;s what I&#39;ve implemented for the time being. I was just wondering if it could be done more elegantly. Its got to be a common pattern. Many (most?) encoding pipelines tend to come with an inverse, and composing a list of bi directional operations with a fold is very elegant."}, {"owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "edited": false, "score": 0, "creation_date": 1487002580, "post_id": 42207457, "comment_id": 71578398, "body": "@OllieB No idea if this helps with your problem, but have you seen <a href=\"https://hackage.haskell.org/package/invertible-0.2.0/docs/Control-Invertible-BiArrow.html\" rel=\"nofollow noreferrer\">Control.Invertible.BiArrow</a>?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1487009882, "post_id": 42207457, "comment_id": 71582796, "body": "Maybe your are looking for something like <code>Product (-&gt;) (Op (-&gt;))</code>, exploiting <code>Data.Category</code>?"}, {"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "edited": false, "score": 0, "creation_date": 1487012232, "post_id": 42207457, "comment_id": 71584153, "body": "I&#39;ll have to study these in more detail."}, {"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "edited": false, "score": 0, "creation_date": 1487025945, "post_id": 42207457, "comment_id": 71591235, "body": "BiArrows definitely capture the spirit of what I intended. Its not quite the same idea, and I&#39;ll leave the question open for a while to see if anything else turns up"}, {"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487026066, "post_id": 42207457, "comment_id": 71591282, "body": "@chi I&#39;m afraid I don&#39;t grok your comment. Could you elaborate? (I don&#39;t have a higher education in category theory <i>or</i> computer science)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1487026964, "post_id": 42207457, "comment_id": 71591615, "body": "Basically, <code>Op (-&gt;)</code> is flipped <code>(-&gt;)</code>, i.e. <code>Op (-&gt;) a b</code> is actually <code>b -&gt; a</code> (function going &quot;backward&quot;). Then the category <code>Product (-&gt;) (Op (-&gt;))</code> composes a morphism in <code>(-&gt;)</code> (forward function) and one in <code>Op (-&gt;)</code> (backward function). Hence, <code>&gt;&gt;&gt;</code> in this category should work as you want."}, {"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "edited": false, "score": 0, "creation_date": 1487027958, "post_id": 42207457, "comment_id": 71591922, "body": "Thank you. I&#39;ll explore that more tomorrow."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1487028454, "post_id": 42207457, "comment_id": 71592047, "body": "@OllieB My notation was a bit off in my comments above. My answer below should have the correct notation -- at least I tested it :P"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1487029545, "last_edit_date": 1487029545, "creation_date": 1487028370, "answer_id": 42215331, "question_id": 42207457, "link": "https://stackoverflow.com/questions/42207457/bidirectional-arrow/42215331#42215331", "title": "Bidirectional Arrow", "body": "<p>Here's an example of a category involving pairs of forward and backwards functions.</p>\n\n<pre><code>{-# LANGUAGE TypeOperators, GADTs #-}\n\nimport Prelude hiding ((.))\nimport Data.Category\nimport Data.Category.Product\n\ntype C = (-&gt;) :**: (Op (-&gt;))\n</code></pre>\n\n<p>The above states that <code>C (a,b) (c,d)</code> is isomorphic to a pair <code>(a-&gt;c, d-&gt;b)</code>. Pairs \"compose\" in the category in the natural way: the forward functions are composed forwards, the backwards functions are composed backwards.</p>\n\n<p>Here are two examples:</p>\n\n<pre><code>f :: C (String, Bool) (Int, Char)\nf = length :**: Op (=='a')\n</code></pre>\n\n<p>Note how the backwards function has to be wrapped in an <code>Op</code> (belongs to the \"opposite\" category).</p>\n\n<pre><code>g :: C (Int, Char) ([Int], Maybe Char)\ng = (\\x-&gt;[x,x]) :**: Op (maybe 'X' id)\n</code></pre>\n\n<p>Note how the \"source\" of <code>g</code> is the \"target\" of <code>f</code>. This ensures composition is possible.</p>\n\n<pre><code>composed :: C (String, Bool) ([Int], Maybe Char)\ncomposed = g . f\n\ntest :: ([Int], Bool)\ntest = case composed of\n   (forward :**: Op backward) -&gt; (forward \"abcde\", backward Nothing)\n-- result: ([5,5],False)\n</code></pre>\n\n<p>On a more practical side, note that <code>Data.Category</code> and <code>Control.Category</code> are different beasts :-( and that the <code>Control.Arrow</code> library mentioned in the question uses the latter.</p>\n\n<p>Still, it should be possible to define <code>Op</code> and <code>:**:</code> for <code>Control.Category</code> as well. Maybe it's already on hackage somewhere (?).</p>\n"}, {"tags": [], "owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "is_accepted": false, "score": 2, "last_activity_date": 1487088670, "last_edit_date": 1487088670, "creation_date": 1487073213, "answer_id": 42225481, "question_id": 42207457, "link": "https://stackoverflow.com/questions/42207457/bidirectional-arrow/42225481#42225481", "title": "Bidirectional Arrow", "body": "<p>Some further approaches, best recorded as a separate answer. </p>\n\n<p>The first imposes the additional constraint of an <code>ArrowLoop</code>, and is defined using a recursive arrow <code>do</code> notation.</p>\n\n<p>From a data flow viewpoint however, no recursion is taking place.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(&lt;-&gt;) \u2237 (ArrowLoop a) \u21d2 a (b,f) (c,g) \u2192 a (c,e) (d,f) \u2192 a (b,e) (d,g)\n(&lt;-&gt;) f1 f2 = proc (b, e) \u2192 do\n  rec\n    (c,g) \u2190 f1 \u21a2 (b,f)\n    (d,f) \u2190 f2 \u21a2 (c,e)\n  returnA \u21a2 (d,g)\n</code></pre>\n\n<p>It could equally be defined as</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(&lt;-&gt;) \u2237 (ArrowLoop a) \u21d2 a (b,f) (c,g) \u2192 a (c,e) (d,f) \u2192 a (b,e) (d,g)\n(&lt;-&gt;) f1 f2 = proc (b, e) \u2192 do\n  rec\n    (d,f) \u2190 f2 \u21a2 (c,e)\n    (c,g) \u2190 f1 \u21a2 (b,f)\n  returnA \u21a2 (d,g)\n</code></pre>\n\n<p>The second approach does not: I've yet to work out if this is a sane thing to do.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>(&lt;-&gt;) \u2237 (Arrow a) \u21d2 a (b,f) (c,g) \u2192 a (c,e) (d,f) \u2192 a (b,e) (d,g)\n(&lt;-&gt;) f1 f2 = proc (b, e) \u2192 do\n  (c,_) \u2190 f1 \u21a2 (b,undefined)\n  (d,_) \u2190 f2 \u21a2 (c,undefined)\n  (_,f) \u2190 f2 \u21a2 (undefined,e)\n  (_,g) \u2190 f1 \u21a2 (undefined,f)\n  returnA \u21a2 (d,g)\n</code></pre>\n\n<p>The following is the same as the second approach, but defined explicitly in terms of composition functions.</p>\n\n<pre><code>(&lt;-&gt;) \u2237 (Arrow a) \u21d2 a (b,f) (c,g) \u2192 a (c,e) (d,f) \u2192 a (b,e) (d,g)\n(&lt;-&gt;) f g =\n  let toFst x = (x,undefined)\n      toSnd x = (undefined,x)\n  in\n    (arr toFst \u22d9 f \u22d9 arr fst \u22d9 arr toFst \u22d9 g \u22d9 arr fst) \u2042\n    (arr snd \u22d8 f \u22d8 arr toSnd \u22d8 arr snd \u22d8 g \u22d8 arr toSnd)\n</code></pre>\n"}], "owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 42215331, "answer_count": 2, "score": 4, "last_activity_date": 1487088670, "creation_date": 1486999092, "question_id": 42207457, "link": "https://stackoverflow.com/questions/42207457/bidirectional-arrow", "title": "Bidirectional Arrow", "body": "<p>I'm trying to capture a symmetrical data processing pipeline using arrows, and was wondering if bidirectional composition is possible.</p>\n\n<p>Control.Arrow exposes the following</p>\n\n<pre><code>-- | Left to right composition\n(&gt;&gt;&gt;) :: Category cat =&gt; cat a b -&gt; cat b c -&gt; cat a c \n\n-- | Right to left composition\n(&lt;&lt;&lt;) :: Category cat =&gt; cat b c -&gt; cat a b -&gt; cat a c \n</code></pre>\n\n<p>what I'd like, but cannot work out how to express is <strong>bidirectional composition of pairs</strong>. The type is something like.</p>\n\n<pre><code>(&lt;^&gt;) :: Category cat =&gt; cat (a,y) (b,z) -&gt; cat (b,x) (c,y) -&gt; cat (a,x) (c,z) \n</code></pre>\n\n<p>where the first element of each pair is to composed left-to-right, and the second to be composed right-to-left.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 2, "creation_date": 1486999228, "post_id": 42207335, "comment_id": 71576186, "body": "There&#39;s <a href=\"http://learnyouahaskell.com/\" rel=\"nofollow noreferrer\">learnyouahaskell.com</a> and <a href=\"http://haskellbook.com/\" rel=\"nofollow noreferrer\">haskellbook.com</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4071, "user_id": 3806046, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5fedf50ce7cd2659bca902e9a2969158?s=128&d=identicon&r=PG&f=1", "display_name": "jkeuhlen", "link": "https://stackoverflow.com/users/3806046/jkeuhlen"}, "is_accepted": true, "score": 3, "last_activity_date": 1487001763, "last_edit_date": 1487001763, "creation_date": 1487001261, "answer_id": 42208187, "question_id": 42207335, "link": "https://stackoverflow.com/questions/42207335/how-to-find-and-or-delete-an-element-in-a-list-of-tuples-in-haskell/42208187#42208187", "title": "How to find and/or delete an element in a List of tuples in Haskell", "body": "<p><a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html\" rel=\"nofollow noreferrer\">Lists</a> in Haskell have a few built in functions to make this easier. One way to do this, is to use the <code>filter</code> function:</p>\n\n<pre><code>find :: String -&gt; [(String, a)] -&gt; a\nfind y xs = snd . head $ filter (((==) y) . fst) xs\n\ndelete :: String -&gt; [(String, a)] -&gt; [(String,a)]\ndelete y xs = filter (not . ((==) y) . fst) xs\n</code></pre>\n\n<p><a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-List.html#v:filter\" rel=\"nofollow noreferrer\"><code>filter</code></a> takes a predicate function (which is your search function of type <code>String -&gt; Bool</code>) and a list and returns all of the elements of the list that satisfy the predicate. So for delete, we simply ask for all elements of our list that are not the one we are looking for. For find, we ask for all elements of our list that match, and then get the <code>snd</code> element of the first result of the list.</p>\n\n<p>Fair warning, since <code>find</code> here uses <code>head</code>, if you're element is not in the list, it will throw an exception and if there is more than one matching result, it will return the first one.</p>\n"}], "owner": {"reputation": 66, "user_id": 7104323, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5bc022e9bf1b3ac824be6c1f41c11f97?s=128&d=identicon&r=PG&f=1", "display_name": "Markeazy", "link": "https://stackoverflow.com/users/7104323/markeazy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1777, "favorite_count": 0, "accepted_answer_id": 42208187, "answer_count": 1, "score": 0, "last_activity_date": 1487003335, "creation_date": 1486998789, "last_edit_date": 1487003335, "question_id": 42207335, "link": "https://stackoverflow.com/questions/42207335/how-to-find-and-or-delete-an-element-in-a-list-of-tuples-in-haskell", "title": "How to find and/or delete an element in a List of tuples in Haskell", "body": "<p>I have to write two functions: \"find\" and \"delete\". I need to use them to search through a List of tuples (pairs), and match the first element in each pair to a String. If the element matches the String, the \"find\" function should output the second element in the pair, and the \"delete\" function should delete that pair from the list. </p>\n\n<p>I am unsure of how to recurse and search through a List in Haskell, how may I get started writing these functions? </p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 2, "creation_date": 1487022654, "post_id": 42206711, "comment_id": 71589753, "body": "It might be better to reverse the order of the arguments, since then <code>sublistSum n</code> could be used in a sequence of operations like <code>sort . sublistSum 2 . filter (not . even) $ [1..10]</code>"}, {"owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "reply_to_user": {"reputation": 2638, "user_id": 7208029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QxbAJ.png?s=128&g=1", "display_name": "Chai T. Rex", "link": "https://stackoverflow.com/users/7208029/chai-t-rex"}, "edited": false, "score": 0, "creation_date": 1487023420, "post_id": 42206711, "comment_id": 71590087, "body": "Interesting...I&#39;ll keep it in mind, thanks"}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "edited": false, "score": 0, "creation_date": 1487001070, "post_id": 42206887, "comment_id": 71577468, "body": "Thank you so much for the answer.  I&#39;ll see what I can work with that."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "edited": false, "score": 0, "creation_date": 1487001250, "post_id": 42206887, "comment_id": 71577570, "body": "Take a look at the implementation of <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/Data.OldList.html#subsequences\" rel=\"nofollow noreferrer\"><code>subsequences</code></a> for inspiration"}, {"owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "edited": false, "score": 0, "creation_date": 1487020977, "post_id": 42206887, "comment_id": 71588926, "body": "I figured it out! Thank you and please have my upvote."}], "tags": [], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "is_accepted": true, "score": 6, "last_activity_date": 1486997411, "creation_date": 1486997411, "answer_id": 42206887, "question_id": 42206711, "link": "https://stackoverflow.com/questions/42206711/finding-sublists-with-a-specified-sum/42206887#42206887", "title": "Finding sublists with a specified sum", "body": "<p>You could first produce a list of all possible sublists using the function <code>subsequences</code> from <code>Data.List</code>. Then it is just a matter of filtering the list by their sum.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.List\n\nsublistSum :: [Int] -&gt; Int -&gt; [[Int]]\nsublistSum list target =\n    filter (\\x -&gt; sum x == target) $ subsequences list\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 7031986, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1fa54805ea5add8d5ba4ef94df6b674e?s=128&d=identicon&r=PG&f=1", "display_name": "RosaryLightning X", "link": "https://stackoverflow.com/users/7031986/rosarylightning-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 42206887, "answer_count": 1, "score": 1, "last_activity_date": 1487080716, "creation_date": 1486996887, "last_edit_date": 1487080716, "question_id": 42206711, "link": "https://stackoverflow.com/questions/42206711/finding-sublists-with-a-specified-sum", "title": "Finding sublists with a specified sum", "body": "<p>I'm working on a function in Haskell where it receives a list of Ints and an Int.</p>\n\n<pre><code>sublistSum :: [Ints] -&gt; Int -&gt; [[Ints]]\n</code></pre>\n\n<p>What it returns is a sublist containing lists of numbers in the original list that adds up to the Int.</p>\n\n<p>For example:</p>\n\n<pre><code>sublistSums [1, 5, -2, 4, 3, 2] 2\n[[1,-2,3],[-2,4],[2]]\n</code></pre>\n\n<p>What I worked up to:</p>\n\n<pre><code>sublistSums [] num = []\nsublistSums (x:xs) num  \n    | findSum x xs num == num = findSum x xs num 0 : sublistSums (x:xs) num\n    | otherwise = sublistSums xs num\n\nfindSum x [] num count = []\nfindSum x (y:ys) num count\n    | ...\n</code></pre>\n\n<p>so <code>findSum</code> is a helper function I made that should return a list of such numbers (that add up to the number).</p>\n\n<p>I'm a bit confused up to this point.  How can I mark it so that <code>findSum</code> doesn't repeatedly give me the same list of numbers over and over again?</p>\n"}, {"tags": ["java", "haskell", "java-8", "completable-future"], "comments": [{"owner": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "edited": false, "score": 3, "creation_date": 1486994272, "post_id": 42205595, "comment_id": 71572787, "body": "You&#39;re saying that using Java to write Haskell doesn&#39;t end up being readable? ;)"}, {"owner": {"reputation": 9895, "user_id": 452775, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/88963e7cc58eabf150447e7b78a24793?s=128&d=identicon&r=PG", "display_name": "Lii", "link": "https://stackoverflow.com/users/452775/lii"}, "edited": false, "score": 1, "creation_date": 1487002167, "post_id": 42205595, "comment_id": 71578139, "body": "Are you sure that the Haskell code and the Java code are equivalent? To me it look like that in the Haskell code makeSomeA will finish evaluating before makeSomeB can start evaluating. (But I&#39;m not an expert in Haskell concurrency.)"}, {"owner": {"reputation": 1967, "user_id": 1410434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1a25416629621ccc7bdf78c32a17233?s=128&d=identicon&r=PG", "display_name": "Jerome", "link": "https://stackoverflow.com/users/1410434/jerome"}, "edited": false, "score": 0, "creation_date": 1487002685, "post_id": 42205595, "comment_id": 71578464, "body": "Lii, that&#39;s the beauty of haskell: what looks like imperative code is not. I cannot explain this simply as I don&#39;t fully grasp it myself, but I encourage you to read some resource about haskell that will help you get this."}], "answers": [{"comments": [{"owner": {"reputation": 1967, "user_id": 1410434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1a25416629621ccc7bdf78c32a17233?s=128&d=identicon&r=PG", "display_name": "Jerome", "link": "https://stackoverflow.com/users/1410434/jerome"}, "edited": false, "score": 0, "creation_date": 1486996489, "post_id": 42206284, "comment_id": 71574310, "body": "I like the Function.identity() approach as it is going to work whatever the signature of <code>makeSomeC</code> is. What do you think of <code>return cFuture.join()</code> ?"}, {"owner": {"reputation": 13143, "user_id": 525036, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/2cb78e30e3a47ab2311e1ccb83f5ee88?s=128&d=identicon&r=PG", "display_name": "Didier L", "link": "https://stackoverflow.com/users/525036/didier-l"}, "reply_to_user": {"reputation": 1967, "user_id": 1410434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1a25416629621ccc7bdf78c32a17233?s=128&d=identicon&r=PG", "display_name": "Jerome", "link": "https://stackoverflow.com/users/1410434/jerome"}, "edited": false, "score": 2, "creation_date": 1486996696, "post_id": 42206284, "comment_id": 71574441, "body": "<code>cFuture.join()</code> will wait for the result of <code>makeSomeC()</code> (i.e. the combination itself), and thus as well for the results of both A and B futures. However you might consider passing the futures as arguments to <code>makeSomeC()</code> so that you can call it directly instead."}, {"owner": {"reputation": 1967, "user_id": 1410434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1a25416629621ccc7bdf78c32a17233?s=128&d=identicon&r=PG", "display_name": "Jerome", "link": "https://stackoverflow.com/users/1410434/jerome"}, "edited": false, "score": 0, "creation_date": 1486997053, "post_id": 42206284, "comment_id": 71574712, "body": "That&#39;s precisely what I want to avoid. <code>makeSomeC</code> could be called from outside of doStuff, and I don&#39;t want to force the callers to pass something else than the actual object. Haskell does that perfectly, and that&#39;s what I&#39;m trying to replicate. CompletableFuture being a monad and all..."}, {"owner": {"reputation": 1967, "user_id": 1410434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1a25416629621ccc7bdf78c32a17233?s=128&d=identicon&r=PG", "display_name": "Jerome", "link": "https://stackoverflow.com/users/1410434/jerome"}, "edited": false, "score": 0, "creation_date": 1486997879, "post_id": 42206284, "comment_id": 71575298, "body": "about <code>cFuture.join()</code>: when <code>cFuture</code> is a <code>CompletableFuture&lt;CompletableFuture&lt;C&gt;&gt;</code> the <code>join</code> call is going to return almost immediately. In term of functionnality, it&#39;s going to be equivalent to the identity composition (I think). I&#39;d say the identity approach is more function oriented, and the join approach just barely more readable. Thanks for your input !"}, {"owner": {"reputation": 13143, "user_id": 525036, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/2cb78e30e3a47ab2311e1ccb83f5ee88?s=128&d=identicon&r=PG", "display_name": "Didier L", "link": "https://stackoverflow.com/users/525036/didier-l"}, "reply_to_user": {"reputation": 1967, "user_id": 1410434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1a25416629621ccc7bdf78c32a17233?s=128&d=identicon&r=PG", "display_name": "Jerome", "link": "https://stackoverflow.com/users/1410434/jerome"}, "edited": false, "score": 2, "creation_date": 1487000421, "post_id": 42206284, "comment_id": 71577007, "body": "These approaches are not equivalent. <code>join()</code> will return <i>almost immediately</i> if that future completes <i>almost immediately</i>\u2026 which is the case only if the 2 combined futures complete <i>almost immediately</i>, and the combiner returns <i>almost immediately</i> as well. Calling <code>join()</code> is more equivalent to calling <code>makeSomeC()</code> directly while joining on the 2 first completable futures."}, {"owner": {"reputation": 1967, "user_id": 1410434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1a25416629621ccc7bdf78c32a17233?s=128&d=identicon&r=PG", "display_name": "Jerome", "link": "https://stackoverflow.com/users/1410434/jerome"}, "edited": false, "score": 0, "creation_date": 1487003086, "post_id": 42206284, "comment_id": 71578731, "body": "maybe nitpicking here. in my java code makeSomeC uses a A and a B, not CompletableFutures. It does however return a CompletableFuture. That&#39;s why makeSomeC(a,b).join() (which returns a C) will take time. Howvere in first method doStuff, cFuture is a CompletableFuture&lt;CompletableFuture&lt;C&gt;&gt;. calling join on this is just going to execute the task submission (quick) and should return almost immediately"}], "tags": [], "owner": {"reputation": 13143, "user_id": 525036, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/2cb78e30e3a47ab2311e1ccb83f5ee88?s=128&d=identicon&r=PG", "display_name": "Didier L", "link": "https://stackoverflow.com/users/525036/didier-l"}, "is_accepted": false, "score": 6, "last_activity_date": 1486996409, "last_edit_date": 1486996409, "creation_date": 1486995609, "answer_id": 42206284, "question_id": 42205595, "link": "https://stackoverflow.com/questions/42205595/double-composition-with-completablefuture/42206284#42206284", "title": "&quot;Double&quot; composition with CompletableFuture", "body": "<p>I guess the simplest solution is just to apply a <code>thenCompose(identity())</code> afterwards:</p>\n\n<pre><code>public CompletableFuture&lt;C&gt; doStuff() {\n    CompletableFuture&lt;A&gt; aFuture = makeSomeA();\n    CompletableFuture&lt;B&gt; bFuture = makeSomeB();\n    CompletableFuture&lt;CompletableFuture&lt;C&gt;&gt; cFuture = aFuture.thenCombine(bFuture, this::makeSomeC);\n    return cFuture.thenCompose(Function.identity());\n}\n</code></pre>\n\n<p>Alternatively, introduce a simple <code>Pair</code> class to combine the results of A and B and use <code>thenCompose()</code>:</p>\n\n<pre><code>public CompletableFuture&lt;C&gt; doStuff() {\n    CompletableFuture&lt;A&gt; aFuture = makeSomeA();\n    CompletableFuture&lt;B&gt; bFuture = makeSomeB();\n    CompletableFuture&lt;Pair&lt;A, B&gt;&gt; cFuture = aFuture.thenCombine(bFuture, Pair::new);\n    return cFuture.thenCompose(p -&gt; makeSomeC(p.a, p.b));\n}\n\nprivate static class Pair&lt;A, B&gt; {\n    A a;\n    B b;\n\n    public Pair(A a, B b) {\n        this.a = a;\n        this.b = b;\n    }\n}\n</code></pre>\n\n<p>And a third alternative without <code>Pair</code>:</p>\n\n<pre><code>public CompletableFuture&lt;C&gt; doStuff() {\n    CompletableFuture&lt;A&gt; aFuture = makeSomeA();\n    CompletableFuture&lt;B&gt; bFuture = makeSomeB();\n    CompletableFuture&lt;Void&gt; cFuture = CompletableFuture.allOf(aFuture, bFuture);\n    return cFuture.thenCompose(__ -&gt; makeSomeC(aFuture.join(), bFuture.join()));\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1967, "user_id": 1410434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1a25416629621ccc7bdf78c32a17233?s=128&d=identicon&r=PG", "display_name": "Jerome", "link": "https://stackoverflow.com/users/1410434/jerome"}, "edited": false, "score": 0, "creation_date": 1487003230, "post_id": 42208070, "comment_id": 71578831, "body": "That&#39;s it, that&#39;s the bind equivalent I&#39;m looking for. Too bad there&#39;s no do-notation in Java and things are less readable than in haskell. Hard to hit a nail with a screwdriver I guess :) My haskell code actually does nothing, but depending on how the Monad instance would be implemented for CompletableFuture, it could act either sync or async."}, {"owner": {"reputation": 13143, "user_id": 525036, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/2cb78e30e3a47ab2311e1ccb83f5ee88?s=128&d=identicon&r=PG", "display_name": "Didier L", "link": "https://stackoverflow.com/users/525036/didier-l"}, "edited": false, "score": 3, "creation_date": 1487064340, "post_id": 42208070, "comment_id": 71604536, "body": "Now I regret I didn&#39;t think about this solution first :-) In fact, the answer was in the question title!"}, {"owner": {"reputation": 9895, "user_id": 452775, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/88963e7cc58eabf150447e7b78a24793?s=128&d=identicon&r=PG", "display_name": "Lii", "link": "https://stackoverflow.com/users/452775/lii"}, "reply_to_user": {"reputation": 13143, "user_id": 525036, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/2cb78e30e3a47ab2311e1ccb83f5ee88?s=128&d=identicon&r=PG", "display_name": "Didier L", "link": "https://stackoverflow.com/users/525036/didier-l"}, "edited": false, "score": 1, "creation_date": 1487064801, "post_id": 42208070, "comment_id": 71604850, "body": "@DidierL: Yeah, there is only a small step from your solution to mine... At first I though about making a comment your solution instead of posting my own. But I also wanted to add more details and discussion so I made a separate answer instead."}], "tags": [], "owner": {"reputation": 9895, "user_id": 452775, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/88963e7cc58eabf150447e7b78a24793?s=128&d=identicon&r=PG", "display_name": "Lii", "link": "https://stackoverflow.com/users/452775/lii"}, "is_accepted": true, "score": 7, "last_activity_date": 1487073527, "last_edit_date": 1487073527, "creation_date": 1487000917, "answer_id": 42208070, "question_id": 42205595, "link": "https://stackoverflow.com/questions/42205595/double-composition-with-completablefuture/42208070#42208070", "title": "&quot;Double&quot; composition with CompletableFuture", "body": "<p>To me it looks like <code>thenCompose</code> is the direct equivalent of the Haskell <code>Monad.bind</code>.</p>\n\n<p><code>thenCompose</code> can be nested in the same way as Haskell monad bind, which is also the result of a do-expression in Haskell. Using that your problem can be solved like this:</p>\n\n<pre><code>public CompletableFuture&lt;C&gt; doStuff() {\n    CompletableFuture&lt;A&gt; aFuture = makeSomeA();\n    CompletableFuture&lt;B&gt; bFuture = makeSomeB();\n    return aFuture.thenCompose(a -&gt; bFuture.thenCompose(b -&gt; makeSomeC(a, b)));\n}\n</code></pre>\n\n<hr>\n\n<h3>Explanation of the types</h3>\n\n<p>This can be seen by inspecting the types of the functions.</p>\n\n<p>Monad bind -- which is written <code>&gt;&gt;=</code> in Haskell -- has the following type:</p>\n\n<pre><code>(&gt;&gt;=) :: Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p><code>thenCompose</code> in Java has the following signature:</p>\n\n<pre><code>public &lt;U&gt; CompletionStage&lt;U&gt; thenCompose(Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn)\n</code></pre>\n\n<p>The above converted to Haskell syntax, with an extra parameter as an explicit <code>this</code>, looks like this:</p>\n\n<pre><code>thenCompose :: CompletionStage T -&gt; (T -&gt; CompletionStage U) -&gt; CompletionStage U  \n</code></pre>\n\n<p>We can see that this has the same structure as the Haskell type. The difference is the names, and the fact Haskell's support for higher-kinded is not exactly expressed by Java interfaces.</p>\n\n<hr>\n\n<h3>Note on the Haskell code in the question</h3>\n\n<p>But I am a bit puzzled by your Haskell code. To me it looks like your Haskell code is doing the following:</p>\n\n<pre><code>public CompletableFuture&lt;C&gt; doStuff() {\n    return makeSomeA().thenCompose(a -&gt; makeSomeB().thenCompose(b -&gt; makeSomeC(a, b)));\n}\n</code></pre>\n\n<p>That is, waiting until the <code>makeSomeA</code> operation has completed before starting on <code>makeSomeB</code>. The Java code on the other hand starts the two operations in parallel, then waits for the result before starting on C. But maybe it is a laziness thing.</p>\n"}], "owner": {"reputation": 1967, "user_id": 1410434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f1a25416629621ccc7bdf78c32a17233?s=128&d=identicon&r=PG", "display_name": "Jerome", "link": "https://stackoverflow.com/users/1410434/jerome"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2193, "favorite_count": 2, "accepted_answer_id": 42208070, "answer_count": 2, "score": 8, "last_activity_date": 1487073527, "creation_date": 1486993633, "last_edit_date": 1486995734, "question_id": 42205595, "link": "https://stackoverflow.com/questions/42205595/double-composition-with-completablefuture", "title": "&quot;Double&quot; composition with CompletableFuture", "body": "<p>I'm trying to avoid nesting <code>CompletableFuture</code> when combining 2 independent ones with a <code>BiFunction</code> that returns a third one.\nCurrently, using <code>thenCombine()</code> does not cut it:</p>\n\n<pre><code>// What I have\npublic CompletableFuture&lt;CompletableFuture&lt;C&gt;&gt; doStuff() {\n    CompletableFuture&lt;A&gt; aFuture = makeSomeA();\n    CompletableFuture&lt;B&gt; bFuture = makeSomeB();\n    CompletableFuture&lt;CompletableFuture&lt;C&gt;&gt; cFuture = aFuture.thenCombine(bFuture, this::makeSomeC);\n    return cFuture;\n}\n\n// What I want\npublic CompletableFuture&lt;C&gt; doStuff() {\n    CompletableFuture&lt;A&gt; aFuture = makeSomeA();\n    CompletableFuture&lt;B&gt; bFuture = makeSomeB();\n    // obv this method does not exist\n    CompletableFuture&lt;C&gt; c = aFuture.thenBicompose(bFuture, this::makeSomeC);\n} \n\nprivate CompletableFuture&lt;A&gt; makeSomeA() {...}\nprivate CompletableFuture&lt;B&gt; makeSomeB() {...}\nprivate CompletableFuture&lt;C&gt; makeSomeC(A a, B b) {...}\n</code></pre>\n\n<p>I'm basically trying to find a way that looks like haskell if there was a <code>CompletableFuture</code> monad:</p>\n\n<pre><code>doStuff :: CompletableFuture C\ndoStuff = do\n    a &lt;- makeSomeA\n    b &lt;- makeSomeB\n    makeSomeC a b\n\nmakeSomeA :: CompletableFuture A\nmakeSomeB :: CompletableFuture B\nmakeSomeC :: A -&gt; B -&gt; CompletableFuture C\n</code></pre>\n\n<p>I read somewhere that <code>join()</code> is the <code>flatMap</code> of Completable future, so I think I could use this method to do something like <code>aFuture.thenCombine(bFuture, ((Function&lt;CompletableFuture&lt;C&gt;,C&gt;) CompletableFuture::join).compose(this::makeSomeC)</code> but I'm not sure this is the proper/advised way to go. And I cannot say that this help readability in any way...</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1486987047, "post_id": 42203439, "comment_id": 71568146, "body": "It is usually used for <i>strict</i> evaluation (in contrast to <i>lazy evaluation</i>) so the operands are evaluated before the function is called."}, {"owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1486987270, "post_id": 42203439, "comment_id": 71568292, "body": "@WillemVanOnsem, I remember one exclamation mark (!) can make the operands strict, does double exclamations do the same?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1486987582, "post_id": 42203439, "comment_id": 71568496, "body": "<a href=\"http://hackage.haskell.org/package/bytestring-0.10.8.1/docs/src/Data-ByteString-Internal.html#ByteString\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/bytestring-0.10.8.1/docs/src/&hellip;</a> - where did you see your code?"}, {"owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1486987888, "post_id": 42203439, "comment_id": 71568689, "body": "@melpomene From an old version <a href=\"http://hackage.haskell.org/package/bytestring-0.9.1.4/docs/Data-ByteString-Internal.html#t%3AByteString\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/bytestring-0.9.1.4/docs/&hellip;</a>. Is that an outdated usage?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1486988100, "post_id": 42203439, "comment_id": 71568838, "body": "@hliu Looks like a rendering bug in haddock; see <a href=\"http://hackage.haskell.org/package/bytestring-0.9.1.4/docs/src/Data-ByteString-Internal.html#ByteString\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/bytestring-0.9.1.4/docs/src/&hellip;</a> for the actual source."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 7, "last_activity_date": 1486988536, "creation_date": 1486988536, "answer_id": 42203951, "question_id": 42203439, "link": "https://stackoverflow.com/questions/42203439/whats-the-usage-of-the-double-exclamations/42203951#42203951", "title": "What&#39;s the usage of the double exclamations?", "body": "<p>This is not part of the actual Haskell source but an (undocumented) feature of how Haddock renders unboxed data types. See <a href=\"https://mail.haskell.org/pipermail/haskell-cafe/2009-January/054135.html\">https://mail.haskell.org/pipermail/haskell-cafe/2009-January/054135.html</a>:</p>\n\n<blockquote>\n  <p>2009/1/21 Stephan Friedrichs &lt;...>:</p>\n  \n  <blockquote>\n    <p>Hi,</p>\n    \n    <p>using haddock-2.4.1 and this file:</p>\n    \n    <blockquote>\n<pre><code>module Test where\n\ndata Test\n    = NonStrict Int\n    | Strict !Int\n    | UnpackedStrict {-# UNPACK #-} !Int\n</code></pre>\n    </blockquote>\n    \n    <p>The generated documentation looks like this:</p>\n\n<pre><code>data Test\nConstructors\n NonStrict Int\n Strict !Int\n UnpackedStrict !!Int\n</code></pre>\n    \n    <p>Note the double '!' in the last constructor. This is not intended\n    behaviour, is it?</p>\n  </blockquote>\n  \n  <p>This is the way GHC pretty prints unboxed types, so I thought Haddock\n  should follow the same convention. Hmm, perhaps Haddock should have a\n  chapter about language extensions in its documentation, with a\n  reference to the GHC documentation. That way the language used is at\n  least documented. Not sure if it helps in this case though, since \"!!\"\n  is probably not documented there.</p>\n  \n  <p>Perhaps we should not display unbox annotations at all since they are\n  an implementation detail, right? We could display one \"!\" instead,\n  indicating that the argument is strict.</p>\n  \n  <p>David</p>\n</blockquote>\n"}], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 515, "favorite_count": 0, "accepted_answer_id": 42203951, "answer_count": 1, "score": 7, "last_activity_date": 1486988536, "creation_date": 1486986926, "question_id": 42203439, "link": "https://stackoverflow.com/questions/42203439/whats-the-usage-of-the-double-exclamations", "title": "What&#39;s the usage of the double exclamations?", "body": "<p>In the Data.ByteString.Internal, the ByteString has constructor </p>\n\n<pre><code>PS !!(ForeignPtr Word8) !!Int !!Int \n</code></pre>\n\n<p>What does these double exclamations mean here? I searched and just got that (!!) can be used to index a list <code>(!!) :: [a] -&gt; Int -&gt; a</code>.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1486984843, "post_id": 42202766, "comment_id": 71566867, "body": "<code>m (Vector Int)</code> is not a vector or data structure. Why do you have that <code>m</code> in there?"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1486985064, "post_id": 42202766, "comment_id": 71567021, "body": "If I don&#39;t I get type-errors when calling <code>randVector</code> in <code>newObj</code>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1486985231, "post_id": 42202766, "comment_id": 71567114, "body": "<code>newObj n vecLen = do { vec &lt;- randVector vecLen; return (Obj n vec) }</code>"}, {"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1486985691, "post_id": 42202766, "comment_id": 71567358, "body": "So using the do-notation kinda moves the MonadRandom out to top level?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1486986009, "post_id": 42202766, "comment_id": 71567540, "body": "Correct. A rather handwavy rule: As long as you&#39;re dealing with data structures, you don&#39;t want <code>m Anything</code> as function parameter or as part of a data structure. <code>m</code> should only appear in the result of actions such as <code>newObj</code> or <code>randVector</code> (and you can locally remove <code>m</code> by using <code>&lt;-</code> within a <code>do</code> block)."}], "answers": [{"comments": [{"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1487018805, "post_id": 42204484, "comment_id": 71587764, "body": "Regarding the last point. Is that only possible when an <code>m Obj</code> has been bound inside a monadic function? If not then how do I know that a function does not know that it operates in <code>MonadRandom</code>? Because I can&#39;t seem to be able to remove <code>MonadRandom m</code> from the type signature of <code>randVector</code>, even though the function itself does not use anything from <code>MonadRandom</code>."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 4, "last_activity_date": 1486990190, "creation_date": 1486990190, "answer_id": 42204484, "question_id": 42202766, "link": "https://stackoverflow.com/questions/42202766/data-structures-with-monads/42204484#42204484", "title": "Data structures with monads", "body": "<pre><code>newObj     :: (MonadRandom m) =&gt; Int -&gt; Int -&gt; Obj m\nnewObj 1 4 :: (MonadRandom m) =&gt;               Obj m\nevalRandIO ::                                  Rand StdGen a -&gt; IO a                                    \nevalRandIO (newObj 1 4) :: -- ?????????\n</code></pre>\n\n<p>The problem is that <code>Obj m</code> isn't <code>Rand StdGen a</code>. Therefore you cannot use <code>evalRandIO</code>.</p>\n\n<p>However, it doesn't really make sense to put the <code>m</code> inside <code>Obj</code>. It's possible, but not really handy. We could fix your code if we've used</p>\n\n<pre><code>evalObj :: Obj m -&gt; IO (Int, (VU.Vector Int))\nevalObj (Obj a mvec) = do\n   uvec &lt;- evalRandIO mvec\n   return (a, uvec)\n</code></pre>\n\n<p>But that's still not easy to use. Instead, let us simplify <code>Obj</code>:</p>\n\n<pre><code>data Obj = Obj { oNum :: Int, oVec :: VU.Vector Int } deriving (Eq, Show)\n</code></pre>\n\n<p>Now let's rewrite <code>newObj</code>, so that it returns <code>m Obj</code>:</p>\n\n<pre><code>newObj :: (MonadRandom m) =&gt; Int -&gt; Int -&gt; m Obj\nnewObj num len = Obj num `fmap` randVector len\n\n-- alternatively, but does the same:\nnewObj num len = do\n   vec &lt;- randVector len\n   return (Obj num vec)\n</code></pre>\n\n<p>And everything is fine. This also makes it possible to use your <code>Obj</code> in functions that don't know that you operate in a <code>MonadRandom</code>, e.g.</p>\n\n<pre><code>sqObj :: Obj -&gt; Obj\nsqObj (Obj a v) = Obj (a * a) (VU.map (^2) v)\n</code></pre>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 42204484, "answer_count": 1, "score": 0, "last_activity_date": 1486990190, "creation_date": 1486984671, "question_id": 42202766, "link": "https://stackoverflow.com/questions/42202766/data-structures-with-monads", "title": "Data structures with monads", "body": "<pre><code>import           Control.Monad\nimport           Control.Monad.Random        as MR\nimport           Control.Monad.ST\nimport qualified Data.Vector.Unboxed         as VU\nimport qualified Data.Vector.Unboxed.Mutable as VUM\nimport qualified Data.Vector                 as V\nimport qualified Data.Vector.Generic         as VG\nimport           Data.Vector.Generic.Mutable as VGM\nimport qualified Data.Vector.Unboxed         as VU\n\n\ndata Obj m = Obj\n    { aNum :: Int\n    , vec  :: m (VU.Vector Int)\n    }\n\ninstance Show (Obj m) where\n   show Obj{ aNum = a\n           , vec = v\n           } = show a ++ show v -- 'show v' not OK\n\nmain :: IO()\nmain = do\n  rVec &lt;- evalRandIO (randVector 5) -- OK\n  obj &lt;- evalRandIO (newObj 1 5) -- Not OK\n  print $ show rVec\n  print $ show obj\n\nnewObj :: (MonadRandom m) =&gt; Int -&gt; Int -&gt; Obj m\nnewObj aNum' vecLen = Obj aNum' $ randVector vecLen\n\nrandVector :: (MonadRandom m) =&gt; Int -&gt; m (VU.Vector Int)\nrandVector len = randSample (VU.enumFromN 0 len) $ VG.length vec\n\n-- Fisher-yates shuffle\nrandSample :: (MonadRandom m, (VG.Vector v a)) =&gt; v a -&gt; Int -&gt; m (v a)\nrandSample vec len = do\n  let getR i = do\n          r &lt;- getRandomR (i, (VG.length vec)-1)\n          return (i, r)\n\n  swaps &lt;- mapM getR [0..len-1]\n\n  let vec_rands = runST $ do\n          vec_mut &lt;- VG.thaw vec\n          forM_ swaps $ \\(i, j) -&gt; do\n              VGM.swap vec_mut i j\n          vec_rands' &lt;- VG.unsafeFreeze vec_mut\n          return vec_rands'\n\n  return $ VG.take len vec_rands\n</code></pre>\n\n<p>I'm having some trouble creating data structures with monads. In particular, the data structure contains a random vector and some other fields which are not random. Using <code>evalRandIO</code> works when the whole type is a monad but not when just some part of the data structure is a monad. </p>\n\n<p>I get the feeling that I should use <code>fmap</code> or something of the sort, but they give different errors. I also have some trouble converting a random vector to string in order to print it to screen. I'm unsure of the difference between <code>Rand g</code> and <code>MonadRandom m</code>, and which one I should use. The latter seem to work but all examples online seem to use <code>Rand g</code> instead.\nFurthermore. general code review is also appreciated. </p>\n\n<blockquote>\n<pre><code>* Couldn't match type `Obj m1'\n                 with `RandT StdGen Data.Functor.Identity.Identity a0'\n  Expected type: Rand StdGen a0\n    Actual type: Obj m1\n* In the first argument of `evalRandIO', namely `(newObj 1 5)'\n  In a stmt of a 'do' block: obj &lt;- evalRandIO (newObj 1 5)\n  In the expression:\n    do { rVec &lt;- evalRandIO (randVector 5);\n         obj &lt;- evalRandIO (newObj 1 5);\n         print $ show rVec }\n</code></pre>\n</blockquote>\n"}, {"tags": ["haskell", "cabal", "haskell-stack"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1486982311, "post_id": 42201587, "comment_id": 71565339, "body": "<code>sudo apt-get install cabal-install cabal update</code> failing isn\u2019t weird. The command is <code>cabal update</code>; it has nothing to do with apt-get."}, {"owner": {"reputation": 499, "user_id": 2499255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4e7eadea443aa4826cbd8bff34168551?s=128&d=identicon&r=PG", "display_name": "domoremath", "link": "https://stackoverflow.com/users/2499255/domoremath"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1486982789, "post_id": 42201587, "comment_id": 71565663, "body": "@Ryan, I just tried &quot;cabal update &amp;&amp; cabal install cabal-install&quot; and it still didn&#39;t work."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1486983040, "post_id": 42201587, "comment_id": 71565813, "body": "<a href=\"https://docs.haskellstack.org/en/stable/GUIDE/#adding-dependencies\" rel=\"nofollow noreferrer\">docs.haskellstack.org/en/stable/GUIDE/#adding-dependencies</a>. <code>stack install</code> might work, too."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 2, "creation_date": 1486984690, "post_id": 42201587, "comment_id": 71566756, "body": "You didn&#39;t give the command used to get the first error message. But does <code>stack ghci --package random</code> fix it?"}, {"owner": {"reputation": 499, "user_id": 2499255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4e7eadea443aa4826cbd8bff34168551?s=128&d=identicon&r=PG", "display_name": "domoremath", "link": "https://stackoverflow.com/users/2499255/domoremath"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1486985091, "post_id": 42201587, "comment_id": 71567034, "body": "@MichaelSnoyman. Yes it did, thanks! As a followup, is stack functioning correctly? Is it supposed to be able to load a program File.hs when I type &quot;stack ghci File.hs&quot; or is my stack behaving the proper way by not loading and only going into prelude?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1486986094, "post_id": 42201587, "comment_id": 71567577, "body": "I honestly don&#39;t know, I almost never use the ghci command."}], "answers": [{"tags": [], "owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "is_accepted": true, "score": 6, "last_activity_date": 1487081757, "last_edit_date": 1487081757, "creation_date": 1487080609, "answer_id": 42228040, "question_id": 42201587, "link": "https://stackoverflow.com/questions/42201587/how-to-install-system-random-maybe-cabal-issue-in-version-8-of-stack/42228040#42228040", "title": "How to install system.random. Maybe cabal issue in version 8 of stack", "body": "<p>If you want to use <code>stack</code>, and assume you have a working <code>stack</code>, you don't have to install anything via <code>apt-get</code>.</p>\n\n<p>First, update your <code>stack</code></p>\n\n<pre><code>stack update\n</code></pre>\n\n<p>Make sure you having the right <code>resolver</code> <a href=\"https://www.stackage.org/lts-8.0/package/random-1.1\" rel=\"noreferrer\">version number</a> for your packages</p>\n\n<ul>\n<li>If you want to use stack globally ,i.e., <code>stack ghci &lt;source.hs&gt;</code>. Check <code>~/.stack/global-project/stack.yaml</code>. </li>\n<li>If you manage your project using <code>stack</code>, i.e,. <code>stack new &lt;project&gt;</code>, <code>stack build</code>. Check project's stack.yaml</li>\n</ul>\n\n<p>To use <code>stack</code> globally (anywhere)</p>\n\n<ul>\n<li>install random by <code>stack install random</code></li>\n<li>using GHCi by <code>stack ghci</code> and <code>:load &lt;source.hs&gt;</code></li>\n<li>compile source by <code>stack ghc &lt;source.hs&gt;</code></li>\n<li>run your program by <code>stack exec &lt;executable_name&gt;</code></li>\n</ul>\n\n<p>You can force stack to use specific resolver by using <code>--resolver=</code>.</p>\n\n<p>Example: using latest lts </p>\n\n<pre><code>$ stack --resolver=lts setup\n$ stack --resolver=lts install random\n$ stack --resolver=lts ghci\n</code></pre>\n\n<p>To use <code>stack</code> in a project directory (<code>stack.yaml</code> exists), you don't need to install package manually; <code>stack</code> will install it for you, if needed, when <code>stack build</code>. But you have to edit <code>&lt;project.cabal&gt;</code></p>\n\n<pre><code>build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , random\n</code></pre>\n"}], "owner": {"reputation": 499, "user_id": 2499255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4e7eadea443aa4826cbd8bff34168551?s=128&d=identicon&r=PG", "display_name": "domoremath", "link": "https://stackoverflow.com/users/2499255/domoremath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10895, "favorite_count": 0, "accepted_answer_id": 42228040, "answer_count": 1, "score": 2, "last_activity_date": 1487081757, "creation_date": 1486980956, "last_edit_date": 1487020422, "question_id": 42201587, "link": "https://stackoverflow.com/questions/42201587/how-to-install-system-random-maybe-cabal-issue-in-version-8-of-stack", "title": "How to install system.random. Maybe cabal issue in version 8 of stack", "body": "<p>I am working on Ubuntu 16.04 with stack ghci version 8. I want to import System.Random in Haskell but it seems I am having trouble that may involve Cabal. I have seen similar posts on this website but they usually say it is because of an older version but I am using version 8.</p>\n\n<p>I get the error:</p>\n\n<pre><code>Failed to load interface for \u2018System.Random\u2019\nUse -v to see a list of the files searched for.\n</code></pre>\n\n<p>which tells me I have problems with System.Random. Looking online, I found that I need to first install Cabal.</p>\n\n<p>When I type </p>\n\n<pre><code>Cabal --version\n</code></pre>\n\n<p>I get </p>\n\n<pre><code>cabal-install version 1.22.6.0\nusing version 1.22.5.0 of the Cabal library \n</code></pre>\n\n<p>which tells me I already have it. So when I try to update with</p>\n\n<pre><code>sudo apt-get install cabal-install cabal update\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>Reading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nE: Unable to locate package cabal\nE: Unable to locate package update\n</code></pre>\n\n<p>which is weird. If I ignore it and try to install random anyways through</p>\n\n<pre><code>cabal install random\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>Resolving dependencies...\nAll the requested packages are already installed:\nrandom-1.1\nUse --reinstall if you want to reinstall anyway.\n</code></pre>\n\n<p>So it seems I also have the random package of cabal. But I can't load a program with the </p>\n\n<pre><code>import System.Random\n</code></pre>\n\n<p>command. </p>\n\n<p>EDIT: It seems I have stack ghci version 8.0.1 and ghci version 7.10.3.\nThe System.random loads in ghci but not stack ghci.</p>\n\n<p>I also get the following when I try to load a file in stack. Entering</p>\n\n<pre><code>stack ghci R.hs\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>Warning: Couldn't find a component for file target /home/aa/workspace/share/haskell/chenw/hw4/R.hs. Attempting to load anyway.\nConfiguring GHCi with the following packages: \nGHCi, version 8.0.1: http://www.haskell.org/ghc/  :? for help\nLoaded GHCi configuration from /home/aa/.ghc/ghci.conf\nLoaded GHCi configuration from /tmp/ghci19674/ghci-script\n</code></pre>\n\n<p>Does this mean there is something wrong with my install of stack?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487019923, "post_id": 42203391, "comment_id": 71588371, "body": "&quot;Please take this just as an example, <code>IO</code> itself is stateful so I do not deny the example is a bit too much&quot; -- I don&#39;t think <code>StateT</code> over <code>IO</code> is excessive. There is nothing wrong with keeping a layer of pure state apart from <code>IO</code>, and it tends to be more pleasant than juggling mutable references around."}, {"owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1487026836, "post_id": 42203391, "comment_id": 71591570, "body": "You are right, thats why I put it there anyway, it is just a contrived example as I didn&#39;t think of real use case"}], "tags": [], "owner": {"reputation": 2231, "user_id": 1027321, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/KkFZC.jpg?s=128&g=1", "display_name": "jakubdaniel", "link": "https://stackoverflow.com/users/1027321/jakubdaniel"}, "is_accepted": false, "score": 1, "last_activity_date": 1486991792, "last_edit_date": 1486991792, "creation_date": 1486986762, "answer_id": 42203391, "question_id": 42200878, "link": "https://stackoverflow.com/questions/42200878/uses-and-examples-of-monad-transformers/42203391#42203391", "title": "Uses and examples of monad transformers?", "body": "<p>Different monads give different \"effects\" such as state or nondeterminism. But if you want more of these in a monad you need to either implement such a monad from scratch (which would be tedious) or stack the monads somehow. Transformers are there to allow stacking the effects of various monads. Transformers are often obtained by generalisation from a monad that provides the effect you are interested in, extracting the effect while making it possible to plug another monad inside. It is sort of a decoration for other monads that adds your desired state/nondet/... effect to them. Look at hackage at the package <code>transformers</code> to see some common <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-State-Strict.html#t:StateT\" rel=\"nofollow noreferrer\">examples</a>.</p>\n\n<p>Transformer captures the effect of the associated monad but leaves room for you to put another monad in, as in the definition of bind (<code>&gt;&gt;=</code>) for <code>StateT</code>:</p>\n\n<pre><code>(&gt;&gt;=) :: StateT s m a -&gt; (a -&gt; StateT s m b) -&gt; StateT s m b\nm &gt;&gt;= k = StateT $ \\ s -&gt; do\n    (a, s') &lt;- runStateT m s\n    runStateT (k a) s'\n</code></pre>\n\n<p>the <code>do</code> block \"runs\" in the underlying monad (<code>m</code>, the lines are chained via the bind operator <code>&gt;&gt;=</code> of <code>m</code>), and thus \"does its own thing\", while <code>StateT</code> maintains the state on the side.</p>\n\n<p>This way you can stack more effects, each transformer taking care of one, and get a monad that has all these effects.</p>\n\n<pre><code>ExceptT e (StateT s (ListT IO))\n</code></pre>\n\n<p>Here you express the effects of \"throwing exception\" in a \"stateful\" and \"nondeterministic\" computation in the \"realworld\" environment provided by <code>IO</code>. Please take this just as an example, <code>IO</code> itself is stateful so I do not deny the example is a bit too much.</p>\n\n<p>Just a note: concrete monads can then often be expressed as transformations of the simplest monad <code>Identity</code> which does nothing interesting on its own, just as <code>State s</code> is implemented in terms of <code>StateT s Identity</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 3, "last_activity_date": 1487000173, "last_edit_date": 1487000173, "creation_date": 1486994591, "answer_id": 42205935, "question_id": 42200878, "link": "https://stackoverflow.com/questions/42200878/uses-and-examples-of-monad-transformers/42205935#42205935", "title": "Uses and examples of monad transformers?", "body": "<p>Monads, are any of the polymorphic data types <code>m a</code>, that implement the monad operations, <code>return</code> and <code>&gt;&gt;=</code>, and obey the monad laws.</p>\n\n<p>Some monads have a special form, in that <code>m</code> can be written as a polymorphic  <code>mT m'</code>, and will be a monad as long as the parameter <code>m'</code> is a monad. Monads that we can split like this are monad transformers. The outer monad <code>mT</code>, adds a monadic effect to the inner monad. We can nest unlimited amounts of monads, since the inner <code>m'</code>, may itself be a monad transformer. </p>\n\n<p>Since Maybe is one of the simplest monads, I'll repost code from <a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/src/Control.Monad.Trans.Maybe.html#MaybeT\" rel=\"nofollow noreferrer\">Transformers</a>.</p>\n\n<p>The definition shows that the monad, <code>MaybeT m</code>, is mostly a wrapper around the monad <code>m</code>. However, <code>m</code> is no longer a \"pure\" monad, but with a type parameter tainted by the Maybe effect.</p>\n\n<pre><code>newtype MaybeT m a = MaybeT { runMaybeT :: m (Maybe a) }\n</code></pre>\n\n<p>Now the definition of the Monad instance.</p>\n\n<pre><code>instance (Monad m) =&gt; Monad (MaybeT m) where\n    return = lift . return\n    x &gt;&gt;= f = MaybeT $ do\n        v &lt;- runMaybeT x\n        case v of\n            Nothing -&gt; return Nothing\n            Just y  -&gt; runMaybeT (f y)\n</code></pre>\n\n<p>Looking at the bind operation <code>&gt;&gt;=</code>, it's important to note that the do notation following the <code>$</code> takes place in the <code>m</code> monad. The inner monad is recovered via <code>runMaybeT x</code>, and the monadic value is bound to <code>v</code>, triggering the <code>m</code> effect. Then, the <code>Maybe</code> state is evaluated, <code>f</code> is applied to a value (if existing) and wrapped appropriately.</p>\n\n<p>One source of confusion for me is the terminology for inner and outer monad--and I wouldn't be surprised if I had it backwards. The transformed monad <code>mT</code> is actually projecting itself inside the inner monad, <code>m</code>.</p>\n\n<p>The question asks about <code>lift</code>, which corresponds to the ability to run the inner monad in the pure context of the outer monad. Note that <code>lift</code> or MonadTrans doesn't define the transformer, but says that if a monad <code>(t m)</code> is a transformer, then you should be able to lift <code>m a</code> into a pure <code>(t m) a</code></p>\n\n<p>For my example, the below is a mockup of some program where users \nask for some resource. The function, <code>userGetResource</code> asks for the user's name, then queries that name against some registry, if the name is found, it will attempt to get permission for the user, if permission is given for the user it will return the resource. There are a series of IO actions which may fail with <code>Nothing</code>. MaybeT helps write the function so that it is a little more friendly to read and maintain. Note especially the use of <code>lift</code> in the <code>userGetResource</code> function. Since it will always return a string (baring catastrophe), this function is lifted into the pure <code>Just</code> form of MaybeT.</p>\n\n<pre><code>import Data.List(find)\nimport Control.Monad (liftM)\nimport Control.Monad.Trans.Maybe\nimport Control.Monad.Trans.Class(lift)\n\ndata User = User { userName :: String, hasCredentials :: Credentials }\ntype Credentials = Bool\ntype Token = ()\ntype UserReg = [User]\ndata Resource = Resource deriving Show\n\nuserGetResource :: IO (Maybe Resource)\nuserGetResource = runMaybeT $ do\n  str &lt;- lift $ do putStrLn \"Who are you\"\n                   getLine\n  usr &lt;- MaybeT $ getUser str\n  tok &lt;- MaybeT $ getPermission usr\n  MaybeT $ getResource tok\n\n\ngetResource :: Token -&gt; IO (Maybe Resource)\ngetResource _ = return (Just Resource)\n\nuserRegistry :: IO UserReg\nuserRegistry = return [User \"Alice\" True, User \"Bob\" False]\n\nlookupUser :: String -&gt; UserReg -&gt; Maybe User\nlookupUser name = find ((name==) . userName)\n\ngetUser :: String -&gt; IO (Maybe User)\ngetUser str = do\n  reg &lt;- userRegistry\n  return $ lookupUser str reg\n\ngetPermission :: User -&gt; IO (Maybe Token)\ngetPermission usr\n  | hasCredentials usr = do\n     tok &lt;- generateToken\n     return (Just tok)\n  | otherwise          = return Nothing\n\ngenerateToken :: IO Token\ngenerateToken = doSomeUsefulIO\n  where\n    doSomeUsefulIO = return () \n</code></pre>\n\n<p>And here is the output of several calls to <code>userGetResource</code></p>\n\n<p>Fails, \"Sam\" not in userReg</p>\n\n<pre><code>*MaybeTrans&gt; userGetResource\nWho are you\nSam\nNothing\n</code></pre>\n\n<p>Succeeds, \"Alice\" in registry and has permission.</p>\n\n<pre><code>*MaybeTrans&gt; userGetResource \nWho are you\nAlice\nJust Resource\n</code></pre>\n\n<p>Fails. \"Bob\" is in registry, but no permission.</p>\n\n<pre><code>*MaybeTrans&gt; userGetResource\nWho are you\nBob\nNothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 4, "last_activity_date": 1487029329, "last_edit_date": 1487029329, "creation_date": 1487023618, "answer_id": 42214434, "question_id": 42200878, "link": "https://stackoverflow.com/questions/42200878/uses-and-examples-of-monad-transformers/42214434#42214434", "title": "Uses and examples of monad transformers?", "body": "<p>I find it helpful to understand the kinds that are at play here.</p>\n\n<p>Firstly, as you know, a <em>monad</em> is a <em>type constructor</em> <code>m :: * -&gt; *</code> paired with two operations, <code>return :: a -&gt; m a</code> and <code>(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b</code>.</p>\n\n<pre><code>class Monad (m :: * -&gt; *) where\n    return :: a -&gt; m a\n    (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>The idea of <em>monad transformers</em> is that they're a sort of type-level function that turns a monad into another monad. So given that a monad is a single-parameter type constructor <code>* -&gt; *</code>, a monad transformer must be a type of kind <code>(* -&gt; *) -&gt; (* -&gt; *)</code>, or <code>(* -&gt; *) -&gt; * -&gt; *</code> once you remove the parentheses. A monad transformer is a <em>two-parameter</em>  type, whose first parameter is a monad and whose second parameter is a value.</p>\n\n<p>More concretely, a monad transformer is a type <code>t :: (* -&gt; *) -&gt; * -&gt; *</code>, such that whenever <code>m</code> is a monad <code>t m</code> is also a monad. We also require that <code>t m</code> be a <em>larger</em> monad than <code>m</code>, in the sense that any action in <code>m</code> can be embedded in <code>t m</code>.</p>\n\n<pre><code>class MonadTrans t where\n    transform :: Monad m :- Monad (t m)\n    lift :: Monad m =&gt; m a -&gt; t m a\n</code></pre>\n\n<p>I'm using <a href=\"https://hackage.haskell.org/package/constraints-0.9/docs/Data-Constraint.html#t::-45-\" rel=\"nofollow noreferrer\">the \"entailment\" operator <code>:-</code></a> from <a href=\"https://hackage.haskell.org/package/constraints-0.9\" rel=\"nofollow noreferrer\">Kmett's <code>constraints</code> package</a> in the definition of <code>transform</code>; <code>transform</code> is a proof that <code>m</code> being a <code>Monad</code> implies that <code>t m</code> is a <code>Monad</code>. (<a href=\"https://hackage.haskell.org/package/transformers-0.5.2.0/docs/Control-Monad-Trans-Class.html#t:MonadTrans\" rel=\"nofollow noreferrer\">The version of <code>MonadTrans</code> in <code>transformers</code></a> omits the <code>transform</code> member because when it was written GHC didn't support the <code>:-</code> operator.)</p>\n\n<p>Importantly, <code>t m a</code> (aka <code>(t m) a</code>) means something different than <code>t (m a)</code>. The former is a two-parameter type <code>t</code> applied to <code>m</code> and <code>a</code>. The latter is a one-parameter type <code>t</code> applied to <code>m a</code>.</p>\n\n<p>A very simple - because I'm on my phone - example of what a definition of a monad transformer looks like:</p>\n\n<pre><code>newtype IdentityT m a = IdentityT { runIdentityT :: m a }\n\ninstance Monad m =&gt; Monad (IdentityT m) where\n    return = IdentityT . return\n    IdentityT m &gt;&gt;= f = IdentityT $ m &gt;&gt;= (runIdentityT . f)\n\ninstance MonadTrans IdentityT where\n    transform = Sub Dict\n    lift = IdentityT\n</code></pre>\n\n<p>Note that <code>IdentityT</code> is a two-parameter datatype; the first parameter <code>m :: * -&gt; *</code> is a monad and the second parameter <code>a :: *</code> is a regular type.</p>\n\n<pre><code>ghci&gt; :k IdentityT\nIdentityT :: (* -&gt; *) -&gt; * -&gt; *\n</code></pre>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 4, "accepted_answer_id": 42214434, "answer_count": 3, "score": 4, "last_activity_date": 1487029329, "creation_date": 1486978715, "question_id": 42200878, "link": "https://stackoverflow.com/questions/42200878/uses-and-examples-of-monad-transformers", "title": "Uses and examples of monad transformers?", "body": "<p>I'm going over Monad Transformers and I understand their main role is to provide a monadic container to hold monads, of different types, which provides a common interface from which to manipulate the 'nested' monads within a computation.</p>\n\n<p>I've attempted to implement my own transformer: </p>\n\n<pre><code>data CustomTransformer a = CustomTransformer\n\nclass TransformerClass m a where\n  lift :: m a -&gt; CustomTransformer (m a)\n\ninstance TransformerClass Maybe a where\n lift (Just a) = CustomerTransformer (Just a)\n</code></pre>\n\n<p>Going through <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=7F9022E04C0AE213B74964BA29E2E69D?doi=10.1.1.39.8039&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">this</a> paper, I understand that this is incorrect. Their example shows:</p>\n\n<pre><code>class MonadTrans r where\n  lift :: Monad m =&gt; m a -&gt; (r m) a\n</code></pre>\n\n<p>This nests the action <code>a</code> in the monad transformer <code>r m</code>.</p>\n\n<p>I don't understand <em>how</em> using a monad transformer aids in dealing with multiple monadic types within a computation? Can anyone provide a simple explanation and example? </p>\n"}, {"tags": ["haskell", "optimization", "ghc"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1486974938, "post_id": 42199585, "comment_id": 71560878, "body": "You&#39;ve got a list like class? Or a list-like data type? If it&#39;s an instance of some classes, it&#39;s the latter. If those classes are a superclass, it&#39;s the first. Also, show some of those rules, and tell us which version of GHC you&#39;ve used. Depending on what you&#39;ve done, you might need a finer phase-control."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1486986940, "post_id": 42199585, "comment_id": 71568073, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/32130011/how-do-you-write-rewrite-rules-for-typeclass-methods\">How do you write rewrite rules for typeclass methods?</a>"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1486975278, "creation_date": 1486974325, "last_edit_date": 1486975278, "question_id": 42199585, "link": "https://stackoverflow.com/questions/42199585/rules-firing-on-class-methods", "title": "Rules firing on class methods", "body": "<p>My apologies if this is a somewhat vague question, I just want to know I'm heading in the right direction. (GHC 8.0.2)</p>\n\n<p>I've got a \"list like\" data type, lets call it <code>T a</code>. For example it's an instance of <code>Foldable</code>, <code>Functor</code> and <code>Monoid</code>. </p>\n\n<p>There's a few rules I'd like to put into place, for example (roughly speaking, not using exact syntax here):</p>\n\n<ol>\n<li><p>You can fold two lists appended just by folding the first then folding the second (there's no need to actually append the lists):</p>\n\n<p>foldl' f z (x ++ y) -> foldl' f (foldl' f z x) y</p></li>\n<li><p>If you're folding a list that's been mapped, you can just drag the map function into the fold, eliminating the map:</p>\n\n<p>foldl' f z (fmap x) -> let h x y = f x (g y) in foldl h z x</p></li>\n<li><p>If you want to map appended lists, just map the individual ones then append them:</p>\n\n<p>fmap (x ++ y) -> fmap x ++ fmap y</p></li>\n</ol>\n\n<p>How should I be doing this? What I've currently done is have my instance methods call a top level method, like <code>fmap'</code>, which does all the work, and then I've applied the rules to these methods. However <code>-ddump-rule-rewrites</code> doesn't seem to show my rules firing, but there are a lot of <code>Class op *</code> rules firing, like <code>Class op fmap</code> and <code>Class op foldl'</code></p>\n\n<p>Should I be:</p>\n\n<p>a. Doing what I'm doing?\nb. Apply my rules on the class methods directly?\nc. The standard class rules should cover the situations for my data type, there's no need to do anything? OR\nd. Some combination of the above, involving a mixture of <code>INLINE</code> and <code>NOINLINE</code> pragmas at the appropriate state (please detail).</p>\n\n<p>I suspect the answer is (d), I'd just like some guidance to get started.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1486994564, "post_id": 42198779, "comment_id": 71572987, "body": "Scoping issues aside, using <code>==</code> would introduce an <code>Eq</code> constraint that isn&#39;t necessary."}], "answers": [{"tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": false, "score": 4, "last_activity_date": 1486971904, "creation_date": 1486971904, "answer_id": 42198934, "question_id": 42198779, "link": "https://stackoverflow.com/questions/42198779/pattern-matching-against-just-containing-a-pair/42198934#42198934", "title": "Pattern matching against Just containing a pair", "body": "<p>You can use <a href=\"https://www.haskell.org/tutorial/patterns.html\" rel=\"nofollow noreferrer\">case expressions</a></p>\n\n<pre><code>g :: Int -&gt; Maybe Int\ng x =\n  case f x of\n    Nothing -&gt; Nothing\n    Just (r,s) -&gt; Just r\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1486973518, "post_id": 42198941, "comment_id": 71560215, "body": "<i>&quot;Because the guard expression\u2026&quot;</i>. What about <code>g x | Just (r,s) &lt;- u = \u2026</code>? You can bind/match in a guard. You just have to use the correct syntax. <code>==</code> isn&#39;t correct."}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1486980545, "post_id": 42198941, "comment_id": 71564228, "body": "@Zeta I just didn&#39;t know that <code>PatternGuard</code> is default as of Haskell2010. Thanks for notification. I&#39;ll leave my answer for Haskell98 case and your answer already posted."}], "tags": [], "owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "is_accepted": true, "score": 6, "last_activity_date": 1486971917, "creation_date": 1486971917, "answer_id": 42198941, "question_id": 42198779, "link": "https://stackoverflow.com/questions/42198779/pattern-matching-against-just-containing-a-pair/42198941#42198941", "title": "Pattern matching against Just containing a pair", "body": "<p>Because the guard expression can't do pattern matching.</p>\n\n<p>Guard expression is just like a boolean expression, it can't do binding. It just uses the binding before <code>|</code>, in this case <code>x</code>.</p>\n\n<p>So working solution will be like this.</p>\n\n<pre><code>g :: Int -&gt; Maybe Int\ng x = case f x of\n  Nothing -&gt; Nothing\n  Just (r,_) -&gt; Just r\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": false, "score": 7, "last_activity_date": 1486973874, "creation_date": 1486973874, "answer_id": 42199467, "question_id": 42198779, "link": "https://stackoverflow.com/questions/42198779/pattern-matching-against-just-containing-a-pair/42199467#42199467", "title": "Pattern matching against Just containing a pair", "body": "<p>If you want to pattern match in a guard, you have to use a <a href=\"https://wiki.haskell.org/Pattern_guard\">pattern guard</a>:</p>\n\n<pre><code>g :: Int -&gt; Maybe Int\ng x\n  | Just (r,_) &lt;- u = Just r\n  | otherwise       = Nothing \n  where \n   u = f x\n</code></pre>\n\n<p>After all, <code>(==)</code> is a regular function, you need values on both sides to use it. Since <code>r</code> and <code>s</code> aren't known in <code>u == Just (r,s)</code>, the compiler gives you your error message.</p>\n\n<p>By the way, taking a <code>Maybe</code> and return <code>Nothing</code> if the value was <code>Nothing</code> or <code>Just (h x)</code> for a function <code>h</code> and <code>Just x</code> is so common, it forms a pattern: <code>fmap</code>. You can write </p>\n\n<pre><code>g :: Int -&gt; Maybe Int\ng x = fmap fst (f x)\n</code></pre>\n"}], "owner": {"reputation": 5008, "user_id": 5762796, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/b3acb5c2021f4c279f29d61481b28e15?s=128&d=identicon&r=PG&f=1", "display_name": "Aleph0", "link": "https://stackoverflow.com/users/5762796/aleph0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 42198941, "answer_count": 3, "score": 2, "last_activity_date": 1486973874, "creation_date": 1486971415, "question_id": 42198779, "link": "https://stackoverflow.com/questions/42198779/pattern-matching-against-just-containing-a-pair", "title": "Pattern matching against Just containing a pair", "body": "<p>I'm experimenting with Haskell and I'm wondering why I couldn't match against a Just containing a pair. I have little experience with this language and I'm completely lost.</p>\n\n<pre><code>f :: Int -&gt; Maybe (Int, [Int])\nf 100 = Nothing\nf x = Just (x,[x])\n\ng :: Int -&gt; Maybe Int\ng x\n | u==Nothing = Nothing\n | u==(Just (r,s)) = Just r\n where \n  u=f x\n</code></pre>\n\n<p>So what is wrong with this code. GHC says that <code>r</code> and <code>s</code> are not in scope.</p>\n"}, {"tags": ["haskell", "partial-application", "automatic-differentiation", "rank-n-types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486967128, "post_id": 42197566, "comment_id": 71557463, "body": "What is the library your are using? I suspect there is some terrible misunderstanding here - this looks much more complicated than it should be. :)"}, {"owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486967337, "post_id": 42197566, "comment_id": 71557552, "body": "For autodiff, this library: <a href=\"https://hackage.haskell.org/package/ad\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/ad</a> You can find the type of <code>grad</code> here: <a href=\"https://hackage.haskell.org/package/ad-4.3.2.1/docs/Numeric-AD.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/ad-4.3.2.1/docs/Numeric-AD.html</a> (and I certainly hope the problem is easier than I think it is!)"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1486970440, "post_id": 42197566, "comment_id": 71558760, "body": "Well, why don&#39;t you simply use <code>realToFrac</code> to generalize the input? <code>:t map realToFrac [1.0 :: Double, 2.0, 3.0]  :: Fractional b =&gt; [b]</code> so when you partially apply <code>f</code> instead of doing <code>f listOfDoubles</code> you could do <code>f (map realToFrac listOfDoubles)</code>."}, {"owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1487053537, "post_id": 42197566, "comment_id": 71599024, "body": "@Bakuriu thanks, that worked! I didn&#39;t know that function existed. Guess I should&#39;ve Hoogled more thoroughly :-)"}, {"owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "edited": false, "score": 0, "creation_date": 1487684837, "post_id": 42197566, "comment_id": 71887706, "body": "Is there any reason to specifically include the <code>forall</code> keywords in the type contexts? I thought those were implicit."}, {"owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "edited": false, "score": 0, "creation_date": 1487732624, "post_id": 42197566, "comment_id": 71912781, "body": "Yes, it&#39;s implicit, but I wanted to emphasize the <code>forall</code> because it becomes explicit when I need to accept a function containing a <code>forall</code> as an argument to another function (as in the type of <code>f</code>)."}], "owner": {"reputation": 463, "user_id": 7342065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a47003905491d69d47a261235044a44?s=128&d=identicon&r=PG&f=1", "display_name": "kye", "link": "https://stackoverflow.com/users/7342065/kye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1486965825, "creation_date": 1486965825, "question_id": 42197566, "link": "https://stackoverflow.com/questions/42197566/how-to-partially-apply-a-function-to-yield-a-polymorphic-rank-1-type", "title": "How to partially apply a function to yield a polymorphic rank-1 type?", "body": "<p>I want to partially apply a function <code>f :: T</code> to a value <code>x :: [Double]</code> to get a resulting function <code>f' :: forall a . Floating a =&gt; [a] -&gt; a</code>. What should <code>T</code> be? I can't figure it out.</p>\n\n<p>One difficulty is that, inside <code>f</code>, I need to combine <code>x :: [Double]</code> with the first parameter of <code>f'</code> (let's call it <code>y</code>) via some math (e.g. adding each element of the lists). </p>\n\n<p>I know that internally, <code>x</code> and <code>y</code> will both be <code>Double</code>s, so I ended up using the type <code>f :: forall a . Floating a =&gt; [a] -&gt; (forall b . Floating b =&gt; [b] -&gt; b)</code>, and using <code>unsafeCoerce</code> (I know, I know...) inside <code>f</code> whenever a value of type <code>a</code> is combined with type <code>b</code>.</p>\n\n<p>Any thoughts on a better type for <code>f</code>?</p>\n\n<p>Context: I'm forced to produce the more general <code>forall a . Floating a =&gt; [a] -&gt; a</code> type after partially applying <code>f</code> because I need to take the gradient of the resulting function using the Haskell autodiff library <code>ad</code>. The function <code>grad</code> in that library requires that its input function have that general type.</p>\n\n<p>(Why do I need to partially apply an objective function? You can imagine that such a function would have internal constants that should not be treated by the optimizer as part of a changing state vector. A hack might be to treat the constants as part of the state and just not update the constants, but in that case the norm of the gradient wouldn't go to zero at the local minima, and other things might go wrong.)</p>\n"}, {"tags": ["haskell", "ghc-mod", "hlint"], "answers": [{"comments": [{"owner": {"reputation": 1581, "user_id": 2319806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4aeddf919979c1ade0de68de94fc3b88?s=128&d=identicon&r=PG", "display_name": "ericky", "link": "https://stackoverflow.com/users/2319806/ericky"}, "edited": false, "score": 0, "creation_date": 1487003772, "post_id": 42198670, "comment_id": 71579202, "body": "thank you for your help. I used &quot;stack install ghc-mod&quot; to get ghc mod. I have: &quot;ghc-mod version 5.6.0.0 compiled by GHC 8.0.1&quot;. Could you tell me how to build from Github master like you did? Thank you."}, {"owner": {"reputation": 1581, "user_id": 2319806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4aeddf919979c1ade0de68de94fc3b88?s=128&d=identicon&r=PG", "display_name": "ericky", "link": "https://stackoverflow.com/users/2319806/ericky"}, "edited": false, "score": 0, "creation_date": 1487026374, "post_id": 42198670, "comment_id": 71591392, "body": "Great - thanks! One last question: does it make a difference which directory I clone the repo into?"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "reply_to_user": {"reputation": 1581, "user_id": 2319806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4aeddf919979c1ade0de68de94fc3b88?s=128&d=identicon&r=PG", "display_name": "ericky", "link": "https://stackoverflow.com/users/2319806/ericky"}, "edited": false, "score": 0, "creation_date": 1487030084, "post_id": 42198670, "comment_id": 71592484, "body": "@ericky I think not"}], "tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 1, "last_activity_date": 1487021837, "last_edit_date": 1487021837, "creation_date": 1486970970, "answer_id": 42198670, "question_id": 42196771, "link": "https://stackoverflow.com/questions/42196771/proper-way-to-pass-hlint-arguments-to-ghc-mod/42198670#42198670", "title": "Proper Way To Pass hlint Arguments to ghc-mod?", "body": "<p>It seems that it is a bug of ghc-mod:</p>\n\n<p>Issue: <a href=\"https://github.com/DanielG/ghc-mod/issues/826\" rel=\"nofollow noreferrer\">https://github.com/DanielG/ghc-mod/issues/826</a></p>\n\n<p>It's already fixed and merged to master, but not yet released.</p>\n\n<p>Since the issue's milestone is <code>v5.8.0.0</code>, it may be fixed in that release.</p>\n\n<p>I built the <code>ghc-mod</code> from latest <code>master</code> branch from Github, and confirmed that following command works:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ ghc-mod lint src/Borrower.hs  --hlintOpt='--hint=Generalise.hs'\nsrc/Borrower.hs:1:8: Suggestion: Use mappendFound:  getName br ++    \" (\" `mappend` show (getMaxBooks br) `mappend` \" books)\"Why not:  getName br `Data.Monoid.mappend`    (\" (\" `mappend` show (getMaxBooks br) `mappend` \" books)\"\n</code></pre>\n\n<p>Here's the step that I executed to build latest <code>ghc-mod</code> from Github.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ git clone https://github.com/DanielG/ghc-mod\n$ cd ghc-mod\n$ stack init --ignore-subdirs --solver\n$ stack build\n</code></pre>\n"}], "owner": {"reputation": 1581, "user_id": 2319806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4aeddf919979c1ade0de68de94fc3b88?s=128&d=identicon&r=PG", "display_name": "ericky", "link": "https://stackoverflow.com/users/2319806/ericky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "accepted_answer_id": 42198670, "answer_count": 1, "score": 1, "last_activity_date": 1487021837, "creation_date": 1486960768, "question_id": 42196771, "link": "https://stackoverflow.com/questions/42196771/proper-way-to-pass-hlint-arguments-to-ghc-mod", "title": "Proper Way To Pass hlint Arguments to ghc-mod?", "body": "<p>I'm trying to lint a file with ghc-mod. I know ghc-mod uses hlint for this and I know that hlint accepts arguments to modify the suggestions it reports. For instance, this works just fine:</p>\n\n<pre><code>eric@linux-epth:total-beginner-haskell$ hlint src/Borrower.hs --hint=Generalise\nsrc/Borrower.hs:44:3: Suggestion: Use mappend\nFound:\ngetName br ++\n\" (\" `mappend` show (getMaxBooks br) `mappend` \" books)\"\nWhy not:\ngetName br `Data.Monoid.mappend`\n(\" (\" `mappend` show (getMaxBooks br) `mappend` \" books)\")\n\n1 hint\n</code></pre>\n\n<p>Here's the format ghc-mod requires for passing arguments to hlint:</p>\n\n<pre><code>Usage: ghc-mod lint [-h|--hlintOpt ARG] FILE\n</code></pre>\n\n<p>But none of the variations below produce the hint shown above:</p>\n\n<pre><code>eric@linux-epth:total-beginner-haskell$ ghc-mod lint -h hint=Generalise src/Borrower.hs\neric@linux-epth:total-beginner-haskell$ ghc-mod lint --hlintOpt hint=Generalise src/Borrower.hs\neric@linux-epth:total-beginner-haskell$ ghc-mod lint --hlintOpt \"--hint=Generalise\" src/Borrower.hs\neric@linux-epth:total-beginner-haskell$ ghc-mod lint --hlintOpt '--hint=Generalise' src/Borrower.hs\n</code></pre>\n\n<p>What is the correct format to use with ghc-mod to pass arguments through it to hlint?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["csv", "haskell", "conduit"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1486957173, "post_id": 42195555, "comment_id": 71554636, "body": "The library already defines an instance <code>(FromNamedRecord a, ToNamedRecord a, CSV s (MapRow ByteString)) =&gt; CSV s (Named a)</code> - <code>Named</code> is just the identity, and you have the <code>{To&#47;From}NamedRecord</code> instances, so you don&#39;t need to write this instance yourself - just use the <code>Named</code> instance. If you really want, you can define your <code>CSV ByteString StockInfo</code> instance in terms of the generic one provided by the library."}, {"owner": {"reputation": 591, "user_id": 3193258, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8b158023d77fa2e80005150fc6caeb7b?s=128&d=identicon&r=PG&f=1", "display_name": "anthonybrice", "link": "https://stackoverflow.com/users/3193258/anthonybrice"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486960797, "post_id": 42195555, "comment_id": 71555508, "body": "Got it! I thought that didn&#39;t make sense, but it was the best understanding I had."}], "answers": [{"tags": [], "owner": {"reputation": 591, "user_id": 3193258, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8b158023d77fa2e80005150fc6caeb7b?s=128&d=identicon&r=PG&f=1", "display_name": "anthonybrice", "link": "https://stackoverflow.com/users/3193258/anthonybrice"}, "is_accepted": true, "score": 5, "last_activity_date": 1486961422, "last_edit_date": 1486961422, "creation_date": 1486960891, "answer_id": 42196782, "question_id": 42195555, "link": "https://stackoverflow.com/questions/42195555/parse-csv-file-into-custom-data-type-with-csv-conduit/42196782#42196782", "title": "Parse CSV file into custom data type with csv-conduit", "body": "<p>Here's what I should have done:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings     #-}\n\nmodule Lib\n    ( readStocks\n    ) where\n\nimport           Data.ByteString\nimport           Data.Conduit\nimport           Data.Conduit.Binary\nimport           Data.CSV.Conduit\nimport           Data.CSV.Conduit.Conversion\nimport           Data.Text                   (Text)\nimport           Data.Vector\nimport           System.IO\n\nreadStocks :: FilePath -&gt; IO (Vector (Named StockInfo))\nreadStocks fp = readCSVFile defCSVSettings fp\n\ndata StockInfo = StockInfo\n  { date     :: !String\n  , open     :: !Double\n  , high     :: !Double\n  , low      :: !Double\n  , close    :: !Double\n  , volume   :: !Integer\n  , adjClose :: !Double\n  } deriving (Show, Eq, Read)\n\ninstance FromNamedRecord StockInfo where\n  parseNamedRecord m =\n    StockInfo &lt;$&gt;\n    m .: \"Date\" &lt;*&gt;\n    m .: \"Open\" &lt;*&gt;\n    m .: \"High\" &lt;*&gt;\n    m .: \"Low\" &lt;*&gt;\n    m .: \"Close\" &lt;*&gt;\n    m .: \"Volume\" &lt;*&gt;\n    m .: \"Adj Close\"\n\ninstance ToNamedRecord StockInfo where\n  toNamedRecord (StockInfo date open high low close volume adjClose) =\n    namedRecord [ \"Date\" .= date\n                , \"Open\" .= open\n                , \"High\" .= high\n                , \"Low\" .= low\n                , \"Close\" .= close\n                , \"Volume\" .= volume\n                , \"Adj Close\" .= adjClose\n                ]\n</code></pre>\n"}], "owner": {"reputation": 591, "user_id": 3193258, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8b158023d77fa2e80005150fc6caeb7b?s=128&d=identicon&r=PG&f=1", "display_name": "anthonybrice", "link": "https://stackoverflow.com/users/3193258/anthonybrice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 2, "accepted_answer_id": 42196782, "answer_count": 1, "score": 1, "last_activity_date": 1486961422, "creation_date": 1486951058, "question_id": 42195555, "link": "https://stackoverflow.com/questions/42195555/parse-csv-file-into-custom-data-type-with-csv-conduit", "title": "Parse CSV file into custom data type with csv-conduit", "body": "<p>I'm pretty confused about how to use csv-conduit with custom data types. I'd like to take a row of stock data such as this one:</p>\n\n<pre><code>Date,Open,High,Low,Close,Volume,Adj Close\n2017-02-10,2312.27002,2319.22998,2311.100098,2316.100098,3475020000,2316.100098\n</code></pre>\n\n<p>and parse that into the <code>StockInfo</code> type I have declared in my MWE below. I've gathered from the documentation that I need to make my <code>StockInfo</code> an instance of <code>FromNamedRecord</code>, <code>ToNamedRecord</code>, and <code>CSV ByteString</code>. I believe I have done so for the first two, but I do not understand how to implement the necessary methods for <code>CSV ByteString</code>. Any help would be greatly appreciated.</p>\n\n<p>MWE:</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE OverloadedStrings     #-}\n\nmodule Lib\n    ( readStocks\n    ) where\n\nimport           Data.ByteString\nimport           Data.Conduit\nimport           Data.Conduit.Binary\nimport           Data.Conduit.List           as CL\nimport           Data.CSV.Conduit\nimport           Data.CSV.Conduit.Conversion\nimport           Data.Text                   (Text)\nimport           Data.Vector\nimport           System.IO\n\nreadStocks :: FilePath -&gt; IO (Vector StockInfo)\nreadStocks fp = readCSVFile defCSVSettings fp\n\ndata StockInfo = StockInfo\n  { date     :: !String\n  , open     :: !Double\n  , high     :: !Double\n  , low      :: !Double\n  , close    :: !Double\n  , volume   :: !Integer\n  , adjClose :: !Double\n  }\n\ninstance FromNamedRecord StockInfo where\n  parseNamedRecord m =\n    StockInfo &lt;$&gt;\n    m .: \"Date\" &lt;*&gt;\n    m .: \"Open\" &lt;*&gt;\n    m .: \"High\" &lt;*&gt;\n    m .: \"Low\" &lt;*&gt;\n    m .: \"Close\" &lt;*&gt;\n    m .: \"Volume\" &lt;*&gt;\n    m .: \"Adj Close\"\n\ninstance ToNamedRecord StockInfo where\n  toNamedRecord (StockInfo date open high low close volume adjClose) =\n    namedRecord [ \"Date\" .= date\n                , \"Open\" .= open\n                , \"High\" .= high\n                , \"Low\" .= low\n                , \"Close\" .= close\n                , \"Volume\" .= volume\n                , \"Adj Close\" .= adjClose\n                ]\n\ninstance CSV ByteString StockInfo where\n    -- rowToStr = undefined\n    -- intoCSV = undefined\n    -- fromCSV = undefined\n</code></pre>\n"}, {"tags": ["haskell", "mustache", "haskell-stack"], "comments": [{"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "edited": false, "score": 0, "creation_date": 1486933090, "post_id": 42192180, "comment_id": 71548286, "body": "<a href=\"https://www.google.de/search?q=mustache+template+%22binary%22+file\" rel=\"nofollow noreferrer\">Googling</a> reveals that there is <a href=\"https://github.com/tests-always-included/mo#general-scripting-issues\" rel=\"nofollow noreferrer\">at least one mustache implementation that doesn&#39;t support binary files</a>. It does not reveal however if mustache in general doesn&#39;t allow embedding binary files."}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 1, "creation_date": 1486942875, "post_id": 42192180, "comment_id": 71551267, "body": "Isn&#39;t there <a href=\"https://github.com/commercialhaskell/stack-templates/blob/master/yesod-postgres.hsfiles#L8269\" rel=\"nofollow noreferrer\">a way</a> in <a href=\"https://github.com/commercialhaskell/stack-templates\" rel=\"nofollow noreferrer\">the link</a> you found?"}, {"owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "reply_to_user": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1486943672, "post_id": 42192180, "comment_id": 71551442, "body": "@jeiea Cheers! I hadn&#39;t seen that bit before and didn&#39;t realize that I could specify an encoding like in <code>{-# START_FILE BASE64 img.png #-}</code>."}, {"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1486947269, "post_id": 42192180, "comment_id": 71552288, "body": "Yeah then I&#39;ll add it as answer for completeness."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1486967758, "post_id": 42195142, "comment_id": 71557710, "body": "Link-only answers are generally discouraged here on SO. You can keep the link as suggested further reading, but please include the relevant information directly in your answer."}], "tags": [], "owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "is_accepted": true, "score": 2, "last_activity_date": 1486971358, "last_edit_date": 1486971358, "creation_date": 1486947554, "answer_id": 42195142, "question_id": 42192180, "link": "https://stackoverflow.com/questions/42192180/how-can-i-embed-a-png-image-in-a-stack-mustache-template/42195142#42195142", "title": "How can I embed a PNG image in a stack (mustache) template?", "body": "<p>You can specify base64 as content encoding like <a href=\"https://github.com/commercialhaskell/stack-templates/blob/master/yesod-postgres.hsfiles#L8269\" rel=\"nofollow noreferrer\">this</a>.</p>\n\n<pre><code>{-# START_FILE BASE64 static/fonts/glyphicons-halflings-regular.eot #-}\nb08AABFOAAACAAIABAAAAAAABQAAAAAAAAABAJABAAAEAExQAAAAAAAAAAAAAAAAAAAAAAEAAAAA\n</code></pre>\n\n<p>That feature is provided from this <a href=\"https://hackage.haskell.org/package/project-template\" rel=\"nofollow noreferrer\">stack's dependency</a>, although not directly documented.</p>\n"}], "owner": {"reputation": 3231, "user_id": 1013393, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7bca51e5ae3eb8dc24a98616b4e5d6fd?s=128&d=identicon&r=PG", "display_name": "sjakobi", "link": "https://stackoverflow.com/users/1013393/sjakobi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 42195142, "answer_count": 1, "score": 1, "last_activity_date": 1486971358, "creation_date": 1486927696, "last_edit_date": 1486929762, "question_id": 42192180, "link": "https://stackoverflow.com/questions/42192180/how-can-i-embed-a-png-image-in-a-stack-mustache-template", "title": "How can I embed a PNG image in a stack (mustache) template?", "body": "<p>My specific problem is that I want to create a <a href=\"https://github.com/commercialhaskell/stack-templates\" rel=\"nofollow noreferrer\">stack template</a> to replace the <code>hakyll-init</code> executable that is included in the <a href=\"http://hackage.haskell.org/package/hakyll-4.9.5.1\" rel=\"nofollow noreferrer\">hakyll</a> package.</p>\n\n<p>The problematic file is <a href=\"https://github.com/jaspervdj/hakyll/blob/ba272c9ba9cddb306cd30c976fb95a8ae7a06b85/data/example/images/haskell-logo.png\" rel=\"nofollow noreferrer\">haskell-logo.png</a>. How do I have to encode this file so it is recreated when I run <code>stack new my-project my-template.hsfiles</code>? </p>\n"}, {"tags": ["haskell", "reactive-banana"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1486933302, "post_id": 42191536, "comment_id": 71548375, "body": "The docs say: &quot;You can even do <b>IO actions</b> here, which is useful if you want to register additional event handlers dynamically. However, there is no guarantee about the order in which <b>the actions</b> are executed.&quot; (emphasis mine) - I think (pure speculation) it is referring to the order of &quot;IO actions&quot; i.e. <code>liftIO ... :: MomentIO X</code> - not to FRP &quot;primitives&quot; provided by the library (which, if they do IO, presumably they do so in a way that the library knows about and can handle properly)"}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486935073, "post_id": 42191536, "comment_id": 71549040, "body": "@user2407038 That&#39;s what I tried to describe. FRP structures created in the <code>MomentIO</code> monad usually are connected to some IO resources (e.g. widgets), which are usually set up in the same monad using liftIO. But if the ordering of those IO actions isn&#39;t guaranteed I can&#39;t be sure that my FRP structures actually mirror the currently rendered UI."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486936227, "post_id": 42191536, "comment_id": 71549393, "body": "My understanding is that if you create an FRP &#39;resource&#39; (like a widget), even it it &#39;lives&#39; inside IO, the event network will have knowledge of it and will be able to manage it appropriately. OTOH, if you read a file or connect to a database with <code>liftIO</code>, the event network will have no knowledge of those things, and would have no way to enforce &#39;ordering&#39; between them (e.g. an IO action may be &#39;guarded&#39; by an input which never occurs). (Of course my understanding could be wrong! I&#39;ve never run into this particular issue with FRP so I&#39;m not speaking from experience)"}, {"owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 2, "creation_date": 1486964322, "post_id": 42191536, "comment_id": 71556523, "body": "And I always thought that this is said about a situation when you have two events fired simultaneously. In this case there is no guarantee that they will be executed in order they were registered."}, {"owner": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "reply_to_user": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "edited": false, "score": 1, "creation_date": 1487241884, "post_id": 42191536, "comment_id": 71699349, "body": "Heinrich here. As @arrowd pointed out, the remark in the documentation was meant to highlight that when <code>execute</code> is used with different events that occur simultaneously, then the relative order between the IO actions in different <code>execute</code> is undefined. Within a single <code>execute</code>, IO occurs in sequence, as you would expect (and there is no way I could change that, actually). I should add an example to the documentation. Could you add an issue on github?"}, {"owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "reply_to_user": {"reputation": 11009, "user_id": 403805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bcf3c21ce05cfb6788e25dcc3821b3c7?s=128&d=identicon&r=PG", "display_name": "Heinrich Apfelmus", "link": "https://stackoverflow.com/users/403805/heinrich-apfelmus"}, "edited": false, "score": 0, "creation_date": 1549017620, "post_id": 42191536, "comment_id": 95762418, "body": "@HeinrichApfelmus I was just going over over my questions without an accepted answer. Maybe you would like to post your answer as such, so I can mark it as accepted?"}], "owner": {"reputation": 2319, "user_id": 2211273, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/6d55ba6b0f08aed750502866c7e7ee77?s=128&d=identicon&r=PG", "display_name": "Kritzefitz", "link": "https://stackoverflow.com/users/2211273/kritzefitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 130, "favorite_count": 1, "answer_count": 0, "score": 6, "last_activity_date": 1487257291, "creation_date": 1486924260, "last_edit_date": 1487257291, "question_id": 42191536, "link": "https://stackoverflow.com/questions/42191536/in-what-way-is-the-execution-order-of-reactiva-bananas-execute-not-guaranteed", "title": "In what way is the execution order of reactiva-banana&#39;s execute not guaranteed?", "body": "<p>The documentation for the <code>execute</code> function in <a href=\"https://hackage.haskell.org/package/reactive-banana-1.1.0.1/docs/Reactive-Banana-Frameworks.html\" rel=\"nofollow noreferrer\"><code>Reactive.Banana.Frameworks</code></a> says that \"there is no guarantee about the order in which the actions are executed.\"</p>\n\n<p>I'm not sure which ordering is meant here. As the event only fires one action at once, there isn't much of an order to guarantee here, so the most likely scenario I can imagine is this:</p>\n\n<pre><code>a :: MomentIO (Event t)\na = ...\n\nb :: MomentIO (Event t)\nb = ...\n\nmakeEvent :: MomentIO (Event (MomentIO (Event t))\nmakeEvent = fromAddHandler $ ... -- Some AddHandler that first fires a\n                                 -- and later fires b\n\nnetwork :: MomentIO ()\nnetwork = do\n  ...\n  newEvents &lt;- makeEvent\n  ts &lt;- execute newEvents &gt;&gt;= switchE\n  ...\n</code></pre>\n\n<p>The non-guarantee I can imagine here is that the execution order of <code>a</code> and <code>b</code> is switched, thus <code>b</code> gets executed first. If we assume that <code>a</code> and <code>b</code> both modify the behavior of some widget (using <code>liftIO</code>) and then register their corresponding event handler (unregistering the previously registered one), switching the execution order of <code>a</code> and <code>b</code> would be fatal as it would leave the widget in a state where it doesn't fire the handlers it supposed to fire. As I don't see for which use cases <code>execute</code> is still useful if my scenario is correct, I suppose the documentation actually means something else.</p>\n\n<p>Can someone please clarify what the documentation is trying to say here?</p>\n"}, {"tags": ["haskell", "type-systems", "type-level-computation", "clash"], "comments": [{"owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1487006097, "post_id": 42191163, "comment_id": 71580608, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/135612/discussion-between-lambdascientist-and-user2407038\">continue this discussion in chat</a>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1487970426, "post_id": 42191163, "comment_id": 72040166, "body": "What exactly are you trying to fill in (maybe the body of <code>generateBitonicSortN2</code>)? I&#39;m having a tough time seeing which functions you give are hard constraints, which functions are part of your proposed solution, and what the actual problem is."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 5, "last_activity_date": 1489395149, "last_edit_date": 1489395149, "creation_date": 1488874649, "answer_id": 42643335, "question_id": 42191163, "link": "https://stackoverflow.com/questions/42191163/creating-a-fold-that-allows-the-type-to-change-after-each-repeated-function-call/42643335#42643335", "title": "Creating a fold that allows the type to change after each repeated function call, in order to call a function n times without recursion", "body": "<p>Your <code>base</code> case was wrong; it should be</p>\n\n<pre><code>base :: (Ord a) =&gt; SplitHalf a @@ 0\nbase = (id, bitonicMerge id)\n</code></pre>\n\n<p>Putting it all together, here's a fully working version, tested on GHC 8.0.2 (but it should work all the same on a GHC 8.0.2-based CLaSH, modulo the <code>Prelude</code> import stuff). It turns out the <code>operationList</code> thing is not used except for its spine, so we can use a <code>Vec n ()</code> instead.</p>\n\n<pre><code>{-# LANGUAGE DataKinds, GADTs, KindSignatures #-}\n{-# LANGUAGE Rank2Types, ScopedTypeVariables  #-}\n{-# LANGUAGE TypeFamilies, TypeOperators, UndecidableInstances #-}\n\n{-# OPTIONS_GHC -fplugin GHC.TypeLits.Normalise -fplugin GHC.TypeLits.KnownNat.Solver #-}\n{-# OPTIONS_GHC -fno-warn-incomplete-patterns -fno-warn-redundant-constraints #-}\n\n{-# LANGUAGE NoImplicitPrelude #-}\nimport Prelude (Integer, (+), Num, ($), undefined, id, fst, Int, otherwise)\nimport CLaSH.Sized.Vector\nimport CLaSH.Promoted.Nat\nimport Data.Singletons\nimport GHC.TypeLits\nimport Data.Ord\n\ntype ExpVec k a = Vec (2 ^ k) a\n\ndata SplitHalf (a :: *) (f :: TyFun Nat *) :: *\ntype instance Apply (SplitHalf a) k = (ExpVec k a -&gt; ExpVec k a, ExpVec (k + 1) a -&gt; ExpVec (k + 1) a)\n\ngenerateBitonicSortN2 :: forall k a . (Ord a, KnownNat k) =&gt; SNat k -&gt; ExpVec k a -&gt; ExpVec k a\ngenerateBitonicSortN2 k = fst $ dfold (Proxy :: Proxy (SplitHalf a)) step base (replicate k ())\n  where\n    step :: SNat l -&gt; () -&gt; SplitHalf a @@ l -&gt; SplitHalf a @@ (l+1)\n    step SNat _ (sort, merge) = (bitonicSort sort merge, bitonicMerge merge)\n\n    base = (id, bitonicMerge id)\n</code></pre>\n\n<p>This works as expected, e.g.:</p>\n\n<pre><code>*Main&gt; generateBitonicSortN2  (snatProxy Proxy)  testVec2\n&lt;9,2&gt;\n*Main&gt; generateBitonicSortN2  (snatProxy Proxy)  testVec4\n&lt;9,8,6,2&gt;\n*Main&gt; generateBitonicSortN2  (snatProxy Proxy)  testVec8\n&lt;9,8,7,6,3,2,1,0&gt;\n*Main&gt; generateBitonicSortN2  (snatProxy Proxy)  testVec16\n&lt;9,8,8,7,7,6,6,5,4,3,3,2,2,1,0,0&gt;\n*Main&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 1, "last_activity_date": 1489030452, "last_edit_date": 1489030452, "creation_date": 1488986875, "answer_id": 42675349, "question_id": 42191163, "link": "https://stackoverflow.com/questions/42191163/creating-a-fold-that-allows-the-type-to-change-after-each-repeated-function-call/42675349#42675349", "title": "Creating a fold that allows the type to change after each repeated function call, in order to call a function n times without recursion", "body": "<blockquote>\n  <p>I am using CLaSH to synthesis this to VHDL, so I cannot use recursion to apply t times</p>\n</blockquote>\n\n<p>I don't understand this sentence, but other than that:</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, TypeFamilies, UndecidableInstances,\n      FlexibleInstances, FlexibleContexts, ConstraintKinds,\n      UndecidableSuperClasses, TypeOperators #-}\n\nimport GHC.TypeLits\nimport GHC.Exts (Constraint)\nimport Data.Proxy\n\ndata Peano = Z | S Peano\n\ndata SPeano n where\n  SZ :: SPeano Z\n  SS :: SPeano n -&gt; SPeano (S n)\n\ntype family PowerOfTwo p where\n  PowerOfTwo  Z    = 1\n  PowerOfTwo (S p) = 2 * PowerOfTwo p\n\ntype family KnownPowersOfTwo p :: Constraint where\n  KnownPowersOfTwo  Z    = ()\n  KnownPowersOfTwo (S p) = (KnownNat (PowerOfTwo p), KnownPowersOfTwo p)\n\ndata Vec (n :: Nat) a -- abstract\n\ntype OnVec n a = Vec n a -&gt; Vec n a\ntype GenBitonic n a = (OnVec n a, OnVec (2 * n) a)\n\ngenBitonic :: (Ord a, KnownNat n) =&gt; GenBitonic n a -&gt; GenBitonic (2 * n) a\ngenBitonic = undefined\n\nbitonicBase :: Ord a =&gt; GenBitonic 1 a\nbitonicBase = undefined\n\ngenBitonicN :: (Ord a, KnownPowersOfTwo p) =&gt; SPeano p -&gt; GenBitonic (PowerOfTwo p) a\ngenBitonicN  SZ    = bitonicBase\ngenBitonicN (SS p) = genBitonic (genBitonicN p)\n</code></pre>\n\n<p><code>genBitonicN</code> is defined by recursion on the peano number which represents a power. At each recursive step a new <code>KnownNat (PowerOfTwo p)</code> pops up (via the <code>KnownPowersOfTwo</code> type family). At the value level <code>genBitonicN</code> is trivial and just does what you want. However we need some additional machinery in order to define a convenient <code>bSortN</code>:</p>\n\n<pre><code>type family Lit n where\n  Lit 0 = Z\n  Lit n = S (Lit (n - 1))\n\nclass IPeano n where\n  speano :: SPeano n\n\ninstance IPeano Z where\n  speano = SZ\n\ninstance IPeano n =&gt; IPeano (S n) where\n  speano = SS speano\n\nclass (n ~ PowerOfTwo (PowerOf n), KnownPowersOfTwo (PowerOf n)) =&gt;\n         IsPowerOfTwo n where\n  type PowerOf n :: Peano\n  getPower :: SPeano (PowerOf n)\n\ninstance IsPowerOfTwo 1 where\n  type PowerOf 1 = Lit 0\n  getPower = speano\n\ninstance IsPowerOfTwo 2 where\n  type PowerOf 2 = Lit 1\n  getPower = speano\n\ninstance IsPowerOfTwo 4 where\n  type PowerOf 4 = Lit 2\n  getPower = speano\n\ninstance IsPowerOfTwo 8 where\n  type PowerOf 8 = Lit 3\n  getPower = speano\n\ninstance IsPowerOfTwo 16 where\n  type PowerOf 16 = Lit 4\n  getPower = speano\n\n-- more powers go here\n\nbSortN :: (IsPowerOfTwo n, Ord a) =&gt; OnVec n a\nbSortN = fst $ genBitonicN getPower\n</code></pre>\n\n<p>Here are some examples:</p>\n\n<pre><code>bSort1 :: Ord a =&gt; OnVec 1 a\nbSort1 = bSortN\n\nbSort2 :: Ord a =&gt; OnVec 2 a\nbSort2 = bSortN\n\nbSort4 :: Ord a =&gt; OnVec 4 a\nbSort4 = bSortN\n\nbSort8 :: Ord a =&gt; OnVec 8 a\nbSort8 = bSortN\n\nbSort16 :: Ord a =&gt; OnVec 16 a\nbSort16 = bSortN\n</code></pre>\n\n<p>I don't know whether we can avoid defining <code>IsPowerOfTwo</code> for each power of two.</p>\n\n<p>Update: here is another variant of <code>bSortN</code>:</p>\n\n<pre><code>pnatToSPeano :: IPeano (Lit n) =&gt; proxy n -&gt; SPeano (Lit n)\npnatToSPeano _ = speano\n\nbSortNP :: (IPeano (Lit p), KnownPowersOfTwo (Lit p), Ord a)\n        =&gt; proxy p -&gt; OnVec (PowerOfTwo (Lit p)) a\nbSortNP = fst . genBitonicN . pnatToSPeano\n</code></pre>\n\n<p>An example:</p>\n\n<pre><code>bSort16 :: Ord a =&gt; OnVec 16 a\nbSort16 = bSortNP (Proxy :: Proxy 4)\n</code></pre>\n"}], "owner": {"reputation": 435, "user_id": 7287132, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7330188252bcb217a107b1250ec120d?s=128&d=identicon&r=PG&f=1", "display_name": "LambdaScientist", "link": "https://stackoverflow.com/users/7287132/lambdascientist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 7, "accepted_answer_id": 42643335, "answer_count": 2, "score": 19, "last_activity_date": 1550764800, "creation_date": 1486922307, "last_edit_date": 1550764800, "question_id": 42191163, "link": "https://stackoverflow.com/questions/42191163/creating-a-fold-that-allows-the-type-to-change-after-each-repeated-function-call", "title": "Creating a fold that allows the type to change after each repeated function call, in order to call a function n times without recursion", "body": "<p>I am trying to use a dfold defined <a href=\"https://hackage.haskell.org/package/clash-prelude-0.11/docs/CLaSH-Sized-Vector.html#g:19\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>dfold \n    :: KnownNat k    \n    =&gt; Proxy (p :: TyFun Nat * -&gt; *)    \n    -&gt; (forall l. SNat l -&gt; a -&gt; (p @@ l) -&gt; p @@ (l + 1))  \n    -&gt; (p @@ 0) \n    -&gt; Vec k a  \n    -&gt; p @@ k\n</code></pre>\n\n<p>Basically it is a fold that allows you to return a new type after each cycle. </p>\n\n<p>I am trying to generalize the <strong>bitonicSort</strong> defined in this project: \n<a href=\"https://github.com/adamwalker/clash-utils/blob/master/src/Clash/Sort.hs\" rel=\"nofollow noreferrer\">https://github.com/adamwalker/clash-utils/blob/master/src/Clash/Sort.hs</a></p>\n\n<p>I two functions that are important for the types that the dfold with generate:</p>\n\n<pre><code>bitonicSort\n    :: forall n a. (KnownNat n, Ord a)\n    =&gt; (Vec n a -&gt; Vec n a)             -- ^ The recursive step\n    -&gt; (Vec (2 * n) a -&gt; Vec (2 * n) a) -- ^ Merge step\n    -&gt; Vec (2 * n) a                    -- ^ Input vector\n    -&gt; Vec (2 * n) a                    -- ^ Output vector\nbitonicMerge\n    :: forall n a. (Ord a , KnownNat n)\n    =&gt; (Vec n a -&gt; Vec n a) -- ^ The recursive step\n    -&gt; Vec (2 * n) a        -- ^ Input vector\n    -&gt; Vec (2 * n) a        -- ^ Output vector\n</code></pre>\n\n<p>The example used in the project mentioned above is:</p>\n\n<pre><code>bitonicSorterExample \n    :: forall a. (Ord a) \n    =&gt; Vec 16 a -- ^ Input vector\n    -&gt; Vec 16 a -- ^ Sorted output vector\nbitonicSorterExample = sort16\n    where\n    sort16 = bitonicSort sort8 merge16\n    merge16 = bitonicMerge merge8\n\n    sort8  = bitonicSort  sort4  merge8\n    merge8 = bitonicMerge merge4\n\n    sort4  = bitonicSort  sort2 merge4\n    merge4 = bitonicMerge merge2\n\n    sort2  = bitonicSort  id merge2\n    merge2 = bitonicMerge id \n</code></pre>\n\n<p>I went ahead and made a more general version.</p>\n\n<pre><code>genBitonic :: (Ord a, KnownNat n) =&gt;\n  (Vec n a -&gt; Vec n a, Vec (2 * n) a -&gt; Vec (2 * n) a)\n  -&gt; (Vec (2 * n) a -&gt; Vec (2 * n) a, Vec (4 * n) a -&gt; Vec (4 * n) a)\ngenBitonic (bSort,bMerge) = (bitonicSort bSort bMerge, bitonicMerge bMerge)\n\nbitonicBase :: Ord a =&gt;  (Vec 1 a -&gt; Vec 1 a, Vec 2 a -&gt; Vec 2 a)\nbitonicBase = (id, bitonicMerge id)\n</code></pre>\n\n<p>With this version I can quick make new Bitonic Sorts like so:</p>\n\n<pre><code>bSort16 :: Ord a =&gt; Vec 16 a -&gt; Vec 16 a\nbSort16 = fst $ genBitonic $ genBitonic $ genBitonic $ genBitonic bitonicBase\n\nbSort8 :: Ord a =&gt; Vec 8 a -&gt; Vec 8 a\nbSort8 = fst $ genBitonic $ genBitonic $ genBitonic bitonicBase\n\nbSort4 :: Ord a =&gt; Vec 4 a -&gt; Vec 4 a\nbSort4 = fst $ genBitonic $ genBitonic bitonicBase\n\nbSort2 :: Ord a =&gt; Vec 2 a -&gt; Vec 2 a\nbSort2 = fst $ genBitonic bitonicBase\n</code></pre>\n\n<p>Each Sort with work with a vector of the specified size. </p>\n\n<pre><code>testVec16 :: Num a =&gt; Vec 16 a\ntestVec16 =  9 :&gt; 2 :&gt; 8 :&gt; 6 :&gt; 3 :&gt; 7 :&gt; 0 :&gt; 1 :&gt; 4 :&gt; 5 :&gt; 2 :&gt; 8 :&gt; 6 :&gt; 3 :&gt; 7 :&gt; 0 :&gt; Nil\n\ntestVec8 :: Num a =&gt; Vec 8 a\ntestVec8 =  9 :&gt; 2 :&gt; 8 :&gt; 6 :&gt; 3 :&gt; 7 :&gt; 0 :&gt; 1 :&gt; Nil\n\ntestVec4 :: Num a =&gt; Vec 4 a\ntestVec4 =  9 :&gt; 2 :&gt; 8 :&gt; 6 :&gt; Nil\n\ntestVec2 :: Num a =&gt; Vec 2 a\ntestVec2 =  2 :&gt; 9 :&gt;  Nil\n</code></pre>\n\n<p><strong>Quick notes:</strong></p>\n\n<ul>\n<li><p>I am trying to the apply \"genBitonic\" to \"bitonicBase\" t times. </p></li>\n<li><p>I am using CLaSH to synthesis this to VHDL, so I cannot use recursion to apply t times</p></li>\n<li><p>We will always be sorting a vec size 2^t in to a vec of the same size</p></li>\n<li><p>\"Vec n a\"  is a vector of size n and type a</p></li>\n</ul>\n\n<p>I would like to make a function that generates the function for a given Vec. I believe using dfold or dtfold, is the correct path here. </p>\n\n<p>I wanted to do the fold with something like the function <code>genBitonic</code>.</p>\n\n<p>Then use <code>fst</code> to get the function I need for sorting. </p>\n\n<p>I had two possible designs:</p>\n\n<p><strong>One</strong>: Fold using composition to get a Function that that takes a base. </p>\n\n<pre><code>bSort8 :: Ord a =&gt; Vec 8 a -&gt; Vec 8 a\nbSort8 = fst $ genBitonic.genBitonic.genBitonic $ bitonicBase\n</code></pre>\n\n<p>Before the base was replied it would have resulted in something like</p>\n\n<pre><code>**If composition was performed three times**\n\nfoo3 ::\n  (Ord a, KnownNat n) =&gt;\n  (Vec n a -&gt; Vec n a, Vec (2 * n) a -&gt; Vec (2 * n) a)\n  -&gt; (Vec (2 * (2 * (2 * n))) a -&gt; Vec (2 * (2 * (2 * n))) a,\n      Vec (4 * (2 * (2 * n))) a -&gt; Vec (4 * (2 * (2 * n))) a)\n</code></pre>\n\n<p><strong>Two</strong>: \n Second idea was to use the bitonicBase as the value b to start accumulation on. This would have resulted directly in the form I need it in before I apply <code>fst</code>.</p>\n\n<p><strong>Edit</strong>\n<code>vecAcum</code> is just meant to be the value building up inside of the <code>dfold</code>. </p>\n\n<p>In the dfold example they fold using a <code>:&gt;</code> which is just the vector form of the list operator <code>:</code></p>\n\n<pre><code>&gt;&gt;&gt; :t (:&gt;)\n(:&gt;) :: a -&gt; Vec n a -&gt; Vec (n + 1) a\n</code></pre>\n\n<p>What I want to do is take a tuple of two functions like:</p>\n\n<pre><code>genBitonic :: (Ord a, KnownNat n) =&gt;\n  (Vec n a -&gt; Vec n a, Vec (2 * n) a -&gt; Vec (2 * n) a)\n  -&gt; (Vec (2 * n) a -&gt; Vec (2 * n) a, Vec (4 * n) a -&gt; Vec (4 * n) a)\n</code></pre>\n\n<p>And compose them. \nSo <code>genBitonic . genBitonic</code> would have type:</p>\n\n<pre><code>(Vec n a -&gt; Vec n a, Vec (2 * n) a -&gt; Vec (2 * n) a)\n-&gt; (Vec (2 * (2 * n)) a -&gt; Vec (2 * (2 * n)) a, Vec (4 * (2 * n)) a -&gt; Vec (4 * (2 * n)) a)\n</code></pre>\n\n<p>So then the base function would be what solidifies the types. \ne.g.</p>\n\n<pre><code>bitonicBase :: Ord a =&gt;  (Vec 1 a -&gt; Vec 1 a, Vec 2 a -&gt; Vec 2 a)\nbitonicBase = (id, bitonicMerge id)\nbSort4 :: Ord a =&gt; Vec 4 a -&gt; Vec 4 a\nbSort4 = fst $ genBitonic $ genBitonic bitonicBase\n</code></pre>\n\n<p>I am using the dfold to build the function for Vectors of length n that is equivalent to doing the recursion on a vector of length n. </p>\n\n<p><strong>I tried:</strong> </p>\n\n<p>I tried to follow the example listed under dfold</p>\n\n<pre><code>data SplitHalf (a :: *) (f :: TyFun Nat *) :: *\ntype instance Apply (SplitHalf a) l = (Vec (2^l) a -&gt; Vec (2^l) a, Vec (2 ^ (l + 1)) a -&gt; Vec (2 ^ (l + 1)) a)\n\ngenerateBitonicSortN2 :: forall k a . (Ord a, KnownNat k) =&gt; SNat k -&gt;  Vec (2^k) a -&gt; Vec (2^k) a\ngenerateBitonicSortN2 k =  fst $ dfold (Proxy :: Proxy (SplitHalf a)) vecAcum base vecMath\n  where\n    vecMath = operationList k\n\n\nvecAcum :: (KnownNat l, KnownNat gl,  Ord a) =&gt; SNat l\n                                -&gt; (SNat gl -&gt; SplitHalf a @@ gl -&gt; SplitHalf a @@ (gl+1))\n                                -&gt; SplitHalf a @@ l\n                                -&gt; SplitHalf a @@ (l+1)\nvecAcum l0 f acc = undefined --  (f l0) acc\n\nbase :: (Ord a) =&gt; SplitHalf a @@ 0\nbase = (id,id)\n\ngeneral :: (KnownNat l,  Ord a)\n        =&gt; SNat l\n        -&gt; SplitHalf a @@ l\n        -&gt; SplitHalf a @@ (l+1)\ngeneral _ (x,y) = (bitonicSort x y, bitonicMerge y )\n\noperationList :: (KnownNat k, KnownNat l, Ord a)\n              =&gt; SNat k\n              -&gt; Vec k\n                   (SNat l\n                 -&gt; SplitHalf a @@ l\n                 -&gt; SplitHalf a @@ (l+1))\noperationList k0 = replicate k0 general\n</code></pre>\n\n<p>I am using the extensions the dfold source code uses</p>\n\n<pre><code>{-# LANGUAGE BangPatterns         #-}\n{-# LANGUAGE DataKinds            #-}\n{-# LANGUAGE GADTs                #-}\n{-# LANGUAGE KindSignatures       #-}\n{-# LANGUAGE MagicHash            #-}\n{-# LANGUAGE PatternSynonyms      #-}\n{-# LANGUAGE Rank2Types           #-}\n{-# LANGUAGE ScopedTypeVariables  #-}\n{-# LANGUAGE TemplateHaskell      #-}\n{-# LANGUAGE TupleSections        #-}\n{-# LANGUAGE TypeApplications     #-}\n{-# LANGUAGE TypeFamilies         #-}\n{-# LANGUAGE TypeOperators        #-}\n{-# LANGUAGE UndecidableInstances #-}\n{-# LANGUAGE ViewPatterns         #-}\n\n{-# LANGUAGE Trustworthy #-}\n</code></pre>\n\n<p><strong>Error Messages:</strong></p>\n\n<pre><code>   Sort.hs:182:71: error:\n    * Could not deduce (KnownNat l) arising from a use of `vecAcum'\n      from the context: (Ord a, KnownNat k)\n        bound by the type signature for:\n                   generateBitonicSortN2 :: (Ord a, KnownNat k) =&gt;\n                                            SNat k -&gt; Vec (2 ^ k) a -&gt; Vec (2 ^ k) a\n        at Sort.hs:181:1-98\n      Possible fix:\n        add (KnownNat l) to the context of\n          a type expected by the context:\n            SNat l\n            -&gt; (SNat l0\n                -&gt; (Vec (2 ^ l0) a -&gt; Vec (2 ^ l0) a,\n                    Vec (2 ^ (l0 + 1)) a -&gt; Vec (2 ^ (l0 + 1)) a)\n                -&gt; (Vec (2 ^ (l0 + 1)) a -&gt; Vec (2 ^ (l0 + 1)) a,\n                    Vec (2 ^ ((l0 + 1) + 1)) a -&gt; Vec (2 ^ ((l0 + 1) + 1)) a))\n            -&gt; SplitHalf a @@ l\n            -&gt; SplitHalf a @@ (l + 1)\n    * In the second argument of `dfold', namely `vecAcum'\n      In the second argument of `($)', namely\n        `dfold (Proxy :: Proxy (SplitHalf a)) vecAcum base vecMath'\n      In the expression:\n        fst $ dfold (Proxy :: Proxy (SplitHalf a)) vecAcum base vecMath\n\nSort.hs:182:84: error:\n    * Could not deduce (KnownNat l0) arising from a use of `vecMath'\n      from the context: (Ord a, KnownNat k)\n        bound by the type signature for:\n                   generateBitonicSortN2 :: (Ord a, KnownNat k) =&gt;\n                                            SNat k -&gt; Vec (2 ^ k) a -&gt; Vec (2 ^ k) a\n        at Sort.hs:181:1-98\n      The type variable `l0' is ambiguous\n    * In the fourth argument of `dfold', namely `vecMath'\n      In the second argument of `($)', namely\n        `dfold (Proxy :: Proxy (SplitHalf a)) vecAcum base vecMath'\n      In the expression:\n        fst $ dfold (Proxy :: Proxy (SplitHalf a)) vecAcum base vecMath\nFailed, modules loaded: none.\n</code></pre>\n\n<p>** EDIT **\nAdded much more detail.</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 0, "creation_date": 1486922382, "post_id": 42191116, "comment_id": 71544168, "body": "Excellent. Double-space indentation tabs are really easy to miss. How come it&#39;s not necessary to lift <code>runST</code> into the random monad? Does return handle that?"}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "reply_to_user": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "edited": false, "score": 1, "creation_date": 1486922505, "post_id": 42191116, "comment_id": 71544206, "body": "<code>runST</code> returns a pure value (in this case your vector), and <code>return</code> &quot;puts&quot; the value into the monad."}, {"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1486943943, "post_id": 42191116, "comment_id": 71551514, "body": "Or forget the <code>do</code> entirely, since all it&#39;s doing is making you invent a name for the temporary vector: <code>return . runST $ VU.unsafeThaw (VU.enumFromN (1::Int) k) &gt;&gt;= VU.unsafeFreeze</code>"}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": true, "score": 2, "last_activity_date": 1486922103, "creation_date": 1486922103, "answer_id": 42191116, "question_id": 42190787, "link": "https://stackoverflow.com/questions/42190787/runst-inside-monadrandom/42191116#42191116", "title": "runST inside MonadRandom", "body": "<p>That error is usually related to indentation issues. If you indent the lines in the <code>runST</code> block a bit more, that error will go away.</p>\n\n<p>The next issue is that you're returning the wrong vector (forgot the <code>'</code>).</p>\n\n<p>Lastly, binding a value only to use it with the return function on the next line is redundant.</p>\n\n<p>Here is working code:</p>\n\n<pre><code>shuffle :: (MonadRandom m) =&gt; m (VU.Vector Int)\nshuffle = do\n  k &lt;- getRandomR (0::Int, 10::Int)\n  let vec = runST $ do\n              vector &lt;- VU.unsafeThaw (VU.enumFromN (1::Int) k)\n              VU.unsafeFreeze vector\n  return vec\n</code></pre>\n\n<p>Alternatively,</p>\n\n<pre><code>shuffle :: (MonadRandom m) =&gt; m (VU.Vector Int)\nshuffle = do\n  k &lt;- getRandomR (0::Int, 10::Int)\n  return $ runST $ do\n    vector &lt;- VU.unsafeThaw (VU.enumFromN (1::Int) k)\n    VU.unsafeFreeze vector\n</code></pre>\n"}], "owner": {"reputation": 2185, "user_id": 4129091, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f8076e78a95ed50b9ffbed42849d80e?s=128&d=identicon&r=PG&f=1", "display_name": "tsorn", "link": "https://stackoverflow.com/users/4129091/tsorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 42191116, "answer_count": 1, "score": 0, "last_activity_date": 1486922103, "creation_date": 1486920284, "question_id": 42190787, "link": "https://stackoverflow.com/questions/42190787/runst-inside-monadrandom", "title": "runST inside MonadRandom", "body": "<p>I want to do <code>runST</code> inside a Rand-monad, but I can't get the types right and the output from GHC is not particularly helpful:</p>\n\n<pre><code>import           Control.Monad\nimport           Control.Monad.Random as MR\nimport           Control.Monad.ST\nimport           Control.Monad.Trans\nimport qualified Data.Vector.Unboxed  as VU\n\nshuffle :: (MonadRandom m) =&gt; m (VU.Vector Int)\nshuffle = do\n  k &lt;- getRandomR (0::Int, 10::Int)\n  let vec = runST $ do\n    vector &lt;- VU.unsafeThaw (VU.enumFromN (1::Int) k)\n    vector' &lt;- VU.unsafeFreeze vector\n    return vector\n  return vec\n</code></pre>\n\n<blockquote>\n  <p>parse error on input `vector'</p>\n</blockquote>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486915342, "post_id": 42189666, "comment_id": 71541395, "body": "I&#39;m unsure, but you could try <code>(s :: &#39;[Symbol])</code> (additional single quote) and see what happens."}, {"owner": {"reputation": 85, "user_id": 7213147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34688e226d571c41a85ee5ca520893cc?s=128&d=identicon&r=PG&f=1", "display_name": "R Beckett", "link": "https://stackoverflow.com/users/7213147/r-beckett"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486916632, "post_id": 42189666, "comment_id": 71541859, "body": "@chi just tried it. Ghc asked me to enable <code>TypeInType</code>.  Then, it complained 2 errors.  - Expected a type, but \u2018&#39;[Symbol]\u2019 has kind \u2018[*]\u2019  and - Expected kind \u2018[Symbol]\u2019, but \u2018s\u2019 has kind \u2018&#39;[Symbol]\u2019."}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 7213147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34688e226d571c41a85ee5ca520893cc?s=128&d=identicon&r=PG&f=1", "display_name": "R Beckett", "link": "https://stackoverflow.com/users/7213147/r-beckett"}, "edited": false, "score": 2, "creation_date": 1486918643, "post_id": 42190272, "comment_id": 71542678, "body": "Thanks for suggestions. In fact, I have <code>{-# LANGUAGE OverloadedStrings #-}</code> and <code>import GHC.TypeLits</code> in my code and The <code>.cabal</code> included all the packages you suggest. But it didn&#39;t work. Btw, I use LTS haskell 7.19."}, {"owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "reply_to_user": {"reputation": 85, "user_id": 7213147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34688e226d571c41a85ee5ca520893cc?s=128&d=identicon&r=PG&f=1", "display_name": "R Beckett", "link": "https://stackoverflow.com/users/7213147/r-beckett"}, "edited": false, "score": 0, "creation_date": 1486918991, "post_id": 42190272, "comment_id": 71542811, "body": "Well if it helps to know I ran <code>stack</code> with a <code>simple</code> project and it compiled for me. Hope it helps! btw using <code>resolver: lts-8.0</code>."}, {"owner": {"reputation": 85, "user_id": 7213147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34688e226d571c41a85ee5ca520893cc?s=128&d=identicon&r=PG&f=1", "display_name": "R Beckett", "link": "https://stackoverflow.com/users/7213147/r-beckett"}, "edited": false, "score": 0, "creation_date": 1486965072, "post_id": 42190272, "comment_id": 71556763, "body": "It did work after changing from lts-7.19 to lts-8.0. Looks like some of ghc bugs was fixed on new version.."}], "tags": [], "owner": {"reputation": 2365, "user_id": 6682929, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/BuvWA.jpg?s=128&g=1", "display_name": "Jonathan Portorreal", "link": "https://stackoverflow.com/users/6682929/jonathan-portorreal"}, "is_accepted": true, "score": 5, "last_activity_date": 1486920371, "last_edit_date": 1486920371, "creation_date": 1486917554, "answer_id": 42190272, "question_id": 42189666, "link": "https://stackoverflow.com/questions/42189666/haskell-gogol-installed-application-credentials-example-couldnt-match-kind/42190272#42190272", "title": "haskell gogol - Installed Application Credentials example : Couldn&#39;t match kind \u2018[Symbol]\u2019 with \u2018*\u2019", "body": "<p>Works with <code>lts-8.0</code> and the right dependencies in <code>.cabal</code> </p>\n\n<pre><code> build-depends:    base\n                 , gogol\n                 , gogol-core\n                 , process\n                 , text\n</code></pre>\n\n<p>You need <code>{-# LANGUAGE OverloadedStrings #-}</code> and <code>import GHC.TypeLits</code> where <code>Symbol</code> is defined. </p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE KindSignatures    #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE DataKinds         #-}\n\nmodule Main where\n\nimport Network.Google.Auth\nimport GHC.TypeLits\n\nimport Data.Proxy     (Proxy (..))\nimport Data.Text      as T\nimport Data.Text.IO   as T\nimport System.Exit    (exitFailure)\nimport System.Info    (os)\nimport System.Process (rawSystem)\n\nredirectPrompt :: AllowScopes (s :: [Symbol]) =&gt; OAuthClient -&gt; proxy s -&gt; IO (OAuthCode s)\nredirectPrompt c p = do\n let url = formURL c p\n T.putStrLn $ \"Opening URL \" `T.append` url\n  _ &lt;- case os of\n        \"darwin\" -&gt; rawSystem \"open\"     [unpack url]\n        \"linux\"  -&gt; rawSystem \"xdg-open\" [unpack url]\n        _        -&gt; T.putStrLn \"Unsupported OS\" &gt;&gt; exitFailure\nT.putStrLn \"Please input the authorisation code: \"\nOAuthCode &lt;$&gt; T.getLine \n\nmain = print \"working\"\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 7213147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34688e226d571c41a85ee5ca520893cc?s=128&d=identicon&r=PG&f=1", "display_name": "R Beckett", "link": "https://stackoverflow.com/users/7213147/r-beckett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 42190272, "answer_count": 1, "score": 5, "last_activity_date": 1486965280, "creation_date": 1486914469, "last_edit_date": 1486965280, "question_id": 42189666, "link": "https://stackoverflow.com/questions/42189666/haskell-gogol-installed-application-credentials-example-couldnt-match-kind", "title": "haskell gogol - Installed Application Credentials example : Couldn&#39;t match kind \u2018[Symbol]\u2019 with \u2018*\u2019", "body": "<p>I'm trying the example of <a href=\"https://hackage.haskell.org/package/gogol-0.1.1/docs/Network-Google-Auth.html#t:Credentials\" rel=\"nofollow noreferrer\">installed application credentials</a>\n in <a href=\"https://hackage.haskell.org/package/gogol\" rel=\"nofollow noreferrer\">gogol package</a>.</p>\n\n<p>Here is the example(just copied from installed application credentials page):</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\nimport Data.Proxy     (Proxy (..))\nimport Data.Text      as T\nimport Data.Text.IO   as T\nimport System.Exit    (exitFailure)\nimport System.Info    (os)\nimport System.Process (rawSystem)\nredirectPrompt :: AllowScopes (s :: [Symbol]) =&gt; OAuthClient -&gt; proxy s -&gt; IO (OAuthCode s)\nredirectPrompt c p = do\n    let url = formURL c p\n    T.putStrLn $ \"Opening URL \" `T.append` url\n    _ &lt;- case os of\n        \"darwin\" -&gt; rawSystem \"open\"     [unpack url]\n        \"linux\"  -&gt; rawSystem \"xdg-open\" [unpack url]\n    _        -&gt; T.putStrLn \"Unsupported OS\" &gt;&gt; exitFailure\n    T.putStrLn \"Please input the authorisation code: \"\n    OAuthCode &lt;$&gt; T.getLine\n</code></pre>\n\n<p>While I compiled the code, I got the errors as follow:</p>\n\n<pre><code>Illegal kind signature: \u2018s\u2019\n  Perhaps you intended to use KindSignatures\nIn the type signature for \u2018redirectPrompt\u2019\n\nIllegal kind: \u2018[Symbol]\u2019 Perhaps you intended to use DataKinds\n</code></pre>\n\n<p>so I added these 2 lines in my code:</p>\n\n<pre><code>{-# LANGUAGE KindSignatures    #-}\n{-# LANGUAGE DataKinds         #-} \n</code></pre>\n\n<p>Then, compiled again. It shows the following error messages:</p>\n\n<pre><code>\u2022 Couldn't match kind \u2018[Symbol]\u2019 with \u2018*\u2019\n  When matching the kind of \u2018proxy\u2019\n\u2022 In the second argument of \u2018formURL\u2019, namely \u2018p\u2019\n  In the expression: formURL c p\n  In an equation for \u2018url\u2019: url = formURL c p\n\u2022 Relevant bindings include\n    p :: proxy s (bound at app/Main.hs:36:18)\n    redirectPrompt :: OAuthClient -&gt; proxy s -&gt; IO (OAuthCode s)\n      (bound at app/Main.hs:36:1)\n</code></pre>\n\n<p>I have no idea why it gets wrong.. The <code>p</code>'s type looks like as same as <code>formURL</code> require one.</p>\n\n<pre><code>-- https://hackage.haskell.org/package/gogol-0.1.1/docs/Network-Google-Auth.html#v:formURL\nformURL :: AllowScopes (s :: [Symbol]) =&gt; OAuthClient -&gt; proxy s -&gt; Text\n</code></pre>\n\n<p>Do I misunderstand something?</p>\n\n<p><strong>Updated</strong></p>\n\n<p>The version I used was lts-7.19.\nAfter changing from lts-7.19 to lts-8.0, it works.</p>\n\n<p>The ghc version of lts-7.19 is 8.0.1.\nThe lts-8.0 one is 8.0.2.\nHere is some notes of <a href=\"https://ghc.haskell.org/trac/ghc/blog/ghc-8.0.2-released\" rel=\"nofollow noreferrer\">ghc-8.0.2-released</a>.</p>\n"}, {"tags": ["haskell", "sublimetext"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1486909501, "post_id": 42188671, "comment_id": 71539319, "body": "How are you running the program? From an IDE/editor (which one?) or from the command line (which terminal emulator, OS etc.)? And when you say it blocks, that means that the program keeps running (i.e. it&#39;s not that the window (if there is one) just closes or you return to the command prompt), it just produces no output, right? Does the cursor move to the next line when you hit enter or is it as if you had never even pressed enter?"}, {"owner": {"reputation": 199, "user_id": 2145355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24288001975f1f4263d6beae7d4cfaab?s=128&d=identicon&r=PG", "display_name": "misja111", "link": "https://stackoverflow.com/users/2145355/misja111"}, "reply_to_user": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 0, "creation_date": 1486909971, "post_id": 42188671, "comment_id": 71539463, "body": "Thanks for asking, I should have mentioned it. I am running it from an IDE: Sublime"}], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 5, "last_activity_date": 1486910677, "last_edit_date": 1495542301, "creation_date": 1486910677, "answer_id": 42188967, "question_id": 42188671, "link": "https://stackoverflow.com/questions/42188671/haskell-does-not-return-from-getline/42188967#42188967", "title": "Haskell does not return from getLine", "body": "<p>After doing a quick search on how Sublime runs programs, I found <a href=\"https://youtu.be/hXDdhRH7J84?t=1m39s\" rel=\"nofollow noreferrer\">a youtube video</a> (edit: and <a href=\"https://stackoverflow.com/questions/10604409/sublime-text-2-console-input\">this SO post</a>) which says that Sublime's \"run program\" functionality can only show output and isn't capable of reading input.</p>\n\n<p>So it looks like you'll have to run your program from the command line or from within GHCi using <code>:main</code>. The latter might be the most convenient as Sublime actually supports a GHCi tab, so you can still do everything from within Sublime.</p>\n"}, {"tags": [], "owner": {"reputation": 27685, "user_id": 610979, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ku5ga.png?s=128&g=1", "display_name": "Frank Schmitt", "link": "https://stackoverflow.com/users/610979/frank-schmitt"}, "is_accepted": false, "score": 3, "last_activity_date": 1486910685, "creation_date": 1486910685, "answer_id": 42188969, "question_id": 42188671, "link": "https://stackoverflow.com/questions/42188671/haskell-does-not-return-from-getline/42188969#42188969", "title": "Haskell does not return from getLine", "body": "<p>This seems to be a limitation in Sublime's <code>Build</code> command (assuming that this is what you're using).</p>\n\n<p>Sublime executes the script using <code>runhaskell</code>, but apparently, it doesn't capture STDIN (which makes kind of sense - build results are usually read-only and not an interactive session).</p>\n\n<p>Workaround: run your script from the command line with</p>\n\n<pre><code>runhaskell script.hs\n</code></pre>\n\n<p>and everything works as expected</p>\n"}], "owner": {"reputation": 199, "user_id": 2145355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24288001975f1f4263d6beae7d4cfaab?s=128&d=identicon&r=PG", "display_name": "misja111", "link": "https://stackoverflow.com/users/2145355/misja111"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 42188967, "answer_count": 2, "score": 1, "last_activity_date": 1486910694, "creation_date": 1486909061, "last_edit_date": 1486910694, "question_id": 42188671, "link": "https://stackoverflow.com/questions/42188671/haskell-does-not-return-from-getline", "title": "Haskell does not return from getLine", "body": "<p>For some reason, Haskell on my machine does never return from any getLine call. For instance, I tried to run the following code straight from Learn You a Haskell for Great Good:</p>\n\n<pre><code>main = do  \n    putStrLn \"Hello, what's your name?\"  \n    name &lt;- getLine  \n    putStrLn (\"Hey \" ++ name ++ \", you rock!\")  \n</code></pre>\n\n<p>When I run it, the first line is printed, and I see my input when I type a name, however when I press Enter the program just blocks there and never prints the final line. </p>\n\n<p>How should I fix this?</p>\n\n<p>edit: I am running it from the Sublime IDE, maybe that has something to do with it</p>\n"}, {"tags": ["haskell", "list-comprehension"], "answers": [{"tags": [], "owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "is_accepted": true, "score": 4, "last_activity_date": 1486908709, "last_edit_date": 1486908709, "creation_date": 1486908302, "answer_id": 42188513, "question_id": 42188380, "link": "https://stackoverflow.com/questions/42188380/list-comprehension-in-haskell/42188513#42188513", "title": "List Comprehension in haskell", "body": "<p>If <code>a = [1, 2, 3]</code> and <code>b = [4, 5, 6]</code>, you can do something like this:</p>\n\n<pre><code>map (\\x -&gt; a ++ [x]) b\n</code></pre>\n\n<p>For each element of <code>b</code>, <code>map</code> will apply the function <code>\\x -&gt; a ++ [x]</code>.\nThis function concatenates two lists, <code>a</code> and <code>[x]</code>.</p>\n\n<p>You can also write it as a list comprehension:</p>\n\n<pre><code>[a ++ [x] | x &lt;- b]\n</code></pre>\n"}], "owner": {"reputation": 235, "user_id": 3302146, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f8f6e1c1aeb2db9d8aca7bddb18ae8f2?s=128&d=identicon&r=PG&f=1", "display_name": "user3302146", "link": "https://stackoverflow.com/users/3302146/user3302146"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 1, "accepted_answer_id": 42188513, "answer_count": 1, "score": 1, "last_activity_date": 1486909224, "creation_date": 1486907556, "last_edit_date": 1486909224, "question_id": 42188380, "link": "https://stackoverflow.com/questions/42188380/list-comprehension-in-haskell", "title": "List Comprehension in haskell", "body": "<p>I am new to Haskell and learning about lists. I have the following list <code>[1, 2, 3]</code> and another list <code>[4, 5, 6]</code>. I am trying to find a way to get the following output:</p>\n\n<pre><code>[[1, 2, 3, 4], [1, 2, 3, 5], [1, 2, 3, 6]]\n</code></pre>\n\n<p>That is, for each element in the second list, I want to create a new list which is the first list with that element appended.</p>\n"}, {"tags": ["haskell", "exception", "exception-handling", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1486935079, "post_id": 42188338, "comment_id": 71549041, "body": "Of course it hangs! <code>E.catch</code> is defined in terms of <code>MonadCatch.catch</code> - you have a patently infinite loop. The <code>throw</code> function is fine because you are using <code>E.throwM :: Exception -&gt; IO a</code> whereas <code>E.catch</code> is used at the type <code>EventM n a -&gt; (Exception -&gt; EventM n a) -&gt; EventM n a</code>."}], "owner": {"reputation": 1593, "user_id": 2287402, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Q5Rvg.png?s=128&g=1", "display_name": "Elie G&#233;nard", "link": "https://stackoverflow.com/users/2287402/elie-g%c3%a9nard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1486909722, "creation_date": 1486907326, "last_edit_date": 1486909722, "question_id": 42188338, "link": "https://stackoverflow.com/questions/42188338/exception-handling-and-monad-transformers", "title": "Exception handling and monad transformers", "body": "<p>I'm writing an application with a text-based user interface using <a href=\"https://hackage.haskell.org/package/brick\" rel=\"nofollow noreferrer\">brick</a>.\nI'm trying to add exception handling to my event loop without success.\nI'd like that when an action fails in my app, an exception is thrown, caught, and a notification displayed in some kind of modal, explaining the reason of the failure.</p>\n\n<p>My event handling function, which is called every time there is a keyboard event like a key pressed, looks like this:</p>\n\n<pre><code>appEvent :: AppState UIName -&gt; BrickEvent UIName MPDEvent -&gt; EventM UIName (Next (AppState UIName))\nappEvent state event = E.catchAny (handleAppEvent state event) (handleException state)\n</code></pre>\n\n<p>And this is how I handle events and exceptions:</p>\n\n<pre><code>handleAppEvent :: AppState UIName -&gt; BrickEvent UIName MPDEvent -&gt; EventM UIName (Next (AppState UIName))\nhandleAppEvent state event = case event of\n    VtyEvent (Vty.EvKey (Vty.KChar 'e') []) -&gt; liftIO $ E.throwM MPDException\n    e -&gt; handleViewEvent state e\n\nhandleException :: AppState n -&gt; SomeException -&gt; EventM n (Next (AppState n))\nhandleException state ex =  M.continue $ state &amp; notificationState %~ (Notification.setNotification \"Excpetion\")\n</code></pre>\n\n<p>I had to write the following instances for my program to compile:</p>\n\n<pre><code>import qualified Control.Exception.Safe as E\nimport Control.Monad.Catch (MonadCatch(..))\n\ninstance E.MonadThrow (EventM n) where\n  throwM e = liftIO $ E.throwM e\n\n\ninstance E.MonadCatch (EventM n) where\n  catch = E.catch\n</code></pre>\n\n<p><a href=\"https://github.com/jtdaugherty/brick/blob/master/src/Brick/Types.hs#L116-L119\" rel=\"nofollow noreferrer\">EventM</a> is this:</p>\n\n<pre><code>newtype EventM n a =\n    EventM { runEventM :: ReaderT (EventRO n) (StateT (EventState n) IO) a\n           }\n    deriving (Functor, Applicative, Monad, MonadIO)\n</code></pre>\n\n<p>Now my program compiles but doesn't work correctly. It shows the starting screen but I can't do anything, as if the <code>handleAppEvent</code> function wasn't run.</p>\n"}, {"tags": ["list", "haskell", "recursion"], "answers": [{"tags": [], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "is_accepted": false, "score": 2, "last_activity_date": 1568184560, "last_edit_date": 1568184560, "creation_date": 1486912518, "answer_id": 42189287, "question_id": 42188328, "link": "https://stackoverflow.com/questions/42188328/list-definition-by-repeated-entry-iteration/42189287#42189287", "title": "List definition by repeated entry/iteration", "body": "<p>Following is code in Racket, another functional programming language, using the steps listed in the question. </p>\n\n<pre><code>(define (f n)\n\n  (define (invert s) ; sub-function to invert the numbers\n    (list-&gt;string\n     (for/list ((i (string-&gt;list s)))\n       (if (equal? i #\\0) #\\1 #\\0))))\n\n  (let loop ((c 1)\n             (s \"0\")) ; starting string is \"0\"\n    (if (&gt; c n)\n        s\n        (loop (add1 c)\n              (string-append s (invert s))))))\n</code></pre>\n\n<p>Testing: </p>\n\n<pre><code>(f 1)\n(f 2)\n(f 3)\n(f 4)\n(f 5)\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>\"01\"\n\"0110\"\n\"01101001\"\n\"0110100110010110\"\n\"01101001100101101001011001101001\"\n</code></pre>\n\n<p>For infinite series: </p>\n\n<pre><code>(define (f)\n  (define (invert s)\n    (list-&gt;string\n     (for/list ((i (string-&gt;list s)))\n       (if (equal? i #\\0) #\\1 #\\0))))\n\n  (let loop ((s \"0\"))\n    (define ss (string-append s (invert s)))\n    (println ss)\n    (loop ss)))\n</code></pre>\n\n<p>To run: </p>\n\n<pre><code>(f)\n</code></pre>\n\n<p>This may give some ideas regarding a Haskell solution to this problem.</p>\n"}, {"tags": [], "owner": {"reputation": 6779, "user_id": 1342941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a77b35477fab1e681d7e14f7ea78b178?s=128&d=identicon&r=PG", "display_name": "happydave", "link": "https://stackoverflow.com/users/1342941/happydave"}, "is_accepted": true, "score": 3, "last_activity_date": 1486917042, "creation_date": 1486917042, "answer_id": 42190171, "question_id": 42188328, "link": "https://stackoverflow.com/questions/42188328/list-definition-by-repeated-entry-iteration/42190171#42190171", "title": "List definition by repeated entry/iteration", "body": "<p>As you noted, you can't do the recursive call immediately - you first need to return the next result, and then recursively call, as in your last try:</p>\n\n<pre><code>Prelude&gt; reenter prev_list = inverted_prev_list ++ reenter (prev_list ++ inverted_prev_list) where inverted_prev_list = map (1-) prev_list\nPrelude&gt; f = [0] ++ reenter [0]\nPrelude&gt; take 20 f\n[0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1]\n</code></pre>\n"}], "owner": {"reputation": 3350, "user_id": 6112457, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ZRj0Z.jpg?s=128&g=1", "display_name": "Zoey Hewll", "link": "https://stackoverflow.com/users/6112457/zoey-hewll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 42190171, "answer_count": 2, "score": 3, "last_activity_date": 1568184560, "creation_date": 1486907271, "question_id": 42188328, "link": "https://stackoverflow.com/questions/42188328/list-definition-by-repeated-entry-iteration", "title": "List definition by repeated entry/iteration", "body": "<p>I want to define the <a href=\"https://en.wikipedia.org/wiki/Thue%E2%80%93Morse_sequence\" rel=\"nofollow noreferrer\">Thue-Morse Sequence</a> (or the <a href=\"https://youtu.be/prh72BLNjIk\" rel=\"nofollow noreferrer\">fair-sharing sequence</a>) in terms of an initial element, <code>0</code>, and the rule defining the next section of the list in terms of the entire list up until this point. i.e.</p>\n\n<pre><code>fair 0 = [0]\n--fair 1 = [0,1]\n--fair 2 = [0,1,1,0]\n--fair 3 = [0,1,1,0,1,0,0,1]\nfair n = fair (n - 1) ++ map (1-) (fair (n - 1))\n</code></pre>\n\n<p>This works fine to generate the list up to any predefined length, but it seems ineffective to not just define the entire list at once, and use <code>take</code> if I need a predefined amount.</p>\n\n<p>My first attempt at defining the entire list was <code>fair = 0 : map (1-) fair</code> but of course, this populates the list as it goes, so it doesn't ever (need to) reenter the list (and returns <code>[0,1,0,1,0,1...]</code>). What I want is some way to define the list so that when it reaches a not-yet-defined element in the list, it defines the next 'chunk' by reentering the list <strong>only until that point</strong>, (rather than the computation 'chasing' the new values as they're produced), so the steps in computing the list would be akin to this procedure:</p>\n\n<ul>\n<li>begin with initial list, <code>[0]</code></li>\n<li>map <code>(1-)</code> over the existing list, producing <code>[1]</code></li>\n<li>append this to the existing list, producing <code>[0,1]</code></li>\n<li>map <code>(1-)</code> over the existing list, producing <code>[1,0]</code></li>\n<li>append this to the existing list, producing <code>[0,1,1,0]</code></li>\n<li>map <code>(1-)</code> over the existing list, producing <code>[1,0,0,1]</code></li>\n<li>append this to the existing list, producing <code>[0,1,1,0,1,0,0,1]</code></li>\n</ul>\n\n<p>The <a href=\"https://en.wikipedia.org/wiki/Thue%E2%80%93Morse_sequence\" rel=\"nofollow noreferrer\">Wikipedia article</a> I linked above has a <a href=\"https://upload.wikimedia.org/wikipedia/commons/f/f1/Morse-Thue_sequence.gif\" rel=\"nofollow noreferrer\">helpful gif</a> to illustrate this process.</p>\n\n<p>As I presume you can see, this would continue indefinitely as new elements are needed. However, I can't for the life of me find a way to successfully encode this in a recursive function. </p>\n\n<p>I have tried </p>\n\n<pre><code>reenter f xs = reenter f (xs ++ map f xs)\nfair = reenter (1-) [0]\n</code></pre>\n\n<p>But while the logic seems correct, it hangs without producing anything, probably due to the immediate recursive call (though I thought haskell's lazy evaluation might take care of that, despite it being a rather complex case).</p>\n"}, {"tags": ["haskell", "types", "io"], "comments": [{"owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "edited": false, "score": 4, "creation_date": 1486904315, "post_id": 42187771, "comment_id": 71537675, "body": "Try adding parens around the read statement."}, {"owner": {"reputation": 558, "user_id": 1457136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1f8148bbb8ea15c4b7c02893c99cab?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Potonnier", "link": "https://stackoverflow.com/users/1457136/jean-baptiste-potonnier"}, "edited": false, "score": 0, "creation_date": 1486904684, "post_id": 42187771, "comment_id": 71537776, "body": "<code>print (read &quot;Person {firstName =\\&quot;Michael\\&quot;, lastName =\\&quot;Diamond\\&quot;, age = 43}&quot; :: Person)</code> works. I hope someone will explain why it is not equivalent to your <code>$</code> version ! I guess the scope of type annotation is syntactic."}, {"owner": {"reputation": 309, "user_id": 2372684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AW7Sa.jpg?s=128&g=1", "display_name": "bling5630", "link": "https://stackoverflow.com/users/2372684/bling5630"}, "edited": false, "score": 0, "creation_date": 1486913099, "post_id": 42187771, "comment_id": 71540564, "body": "hi Jean-Baptiste, thanks, and yes, works, Tamas"}], "answers": [{"comments": [{"owner": {"reputation": 309, "user_id": 2372684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AW7Sa.jpg?s=128&g=1", "display_name": "bling5630", "link": "https://stackoverflow.com/users/2372684/bling5630"}, "edited": false, "score": 0, "creation_date": 1486913376, "post_id": 42188154, "comment_id": 71540667, "body": "hello Zeta, thanks for the comment, the example is clear, Tamas"}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1486906333, "creation_date": 1486906333, "answer_id": 42188154, "question_id": 42187771, "link": "https://stackoverflow.com/questions/42187771/couldnt-match-expected-type-person-with-actual-type-io/42188154#42188154", "title": "Couldn&#39;t match expected type Person with actual type IO ()", "body": "<pre><code>main = \n  print $ read \"Person {firstName =\\\"Michael\\\", lastName =\\\"Diamond\\\", age = 43}\" :: Person\n</code></pre>\n\n<p>is parsed as</p>\n\n<pre><code>main = \n  (print $ read \"Person {firstName =\\\"Michael\\\", lastName =\\\"Diamond\\\", age = 43}\") :: Person\n</code></pre>\n\n<p>whereas you've meant</p>\n\n<pre><code>main = \n  print (read \"Person {firstName =\\\"Michael\\\", lastName =\\\"Diamond\\\", age = 43}\" :: Person )\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 2372684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AW7Sa.jpg?s=128&g=1", "display_name": "bling5630", "link": "https://stackoverflow.com/users/2372684/bling5630"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "closed_date": 1486940025, "accepted_answer_id": 42188154, "answer_count": 1, "score": 1, "last_activity_date": 1486906333, "creation_date": 1486903889, "last_edit_date": 1486904495, "question_id": 42187771, "link": "https://stackoverflow.com/questions/42187771/couldnt-match-expected-type-person-with-actual-type-io", "closed_reason": "Not suitable for this site", "title": "Couldn&#39;t match expected type Person with actual type IO ()", "body": "<p>I have started learning Haskell, and reading Learn You Haskell. Chapter 8 dealing with \"making our own types and typeclasses\" and I have a error message which is a problem for me. Probably the solution is a tiny thing, but I couldn't find it, so please reveal the hint and or help me out an explanation.</p>\n\n<pre><code>data Person = Person { firstName :: String  \n                     , lastName :: String  \n                     , age :: Int  \n                     } deriving (Eq, Show, Read)  \n\nmikeD = Person {firstName = \"Michael\", lastName = \"Diamond\", age = 43}  \n\nmain = print $ read \"Person {firstName =\\\"Michael\\\", lastName =\\\"Diamond\\\", age = 43}\" :: Person\n</code></pre>\n\n<p>This is the error message I get</p>\n\n<pre><code>Couldn't match expected type `Person' with actual type `IO ()'\nIn a stmt of a 'do' block:\n    print\n    $ read\n        \"Person {firstName =\\\"Michael\\\", lastName =\\\"Diamond\\\", age = 43}\" ::\n      Person\nIn the expression:\n  do { print\n       $ read\n           \"Person {firstName =\\\"Michael\\\", lastName =\\\"Diamond\\\", age = 43}\" ::\n         Person }\nIn an equation for `main':\n    main\n      = do { print\n             $ read\n                 \"Person {firstName =\\\"Michael\\\", lastName =\\\"Diamond\\\", age = 43}\" ::\n               Person }\n</code></pre>\n\n<p>Thanks in advance :)</p>\n"}, {"tags": ["haskell", "quickcheck"], "answers": [{"comments": [{"owner": {"reputation": 1813, "user_id": 721506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOKfE.jpg?s=128&g=1", "display_name": "Larry LIU Xinyu", "link": "https://stackoverflow.com/users/721506/larry-liu-xinyu"}, "edited": false, "score": 0, "creation_date": 1486896446, "post_id": 42186107, "comment_id": 71535399, "body": "Thanks. I created a Sample data type, and provided the arbitrary function. like this: <a href=\"https://github.com/liuxinyu95/AlgoXY/blob/algoxy/others/problems/miss-dup/MissDup.hs\" rel=\"nofollow noreferrer\">github.com/liuxinyu95/AlgoXY/blob/algoxy/others/problems/&hellip;</a>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1486899610, "post_id": 42186107, "comment_id": 71536319, "body": "Or you use <code>quickCheck $ forAll (myTest 10) $ \\x -&gt; ...</code>."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": true, "score": 2, "last_activity_date": 1486917074, "last_edit_date": 1486917074, "creation_date": 1486892673, "answer_id": 42186107, "question_id": 42186029, "link": "https://stackoverflow.com/questions/42186029/how-to-generate-test-data-with-shuffle-in-quickceck/42186107#42186107", "title": "How to generate test data with shuffle in QuickCeck", "body": "<p>The <code>Gen</code> monad in QuickCheck is basically a state monad with a random number generator as its state. So when you see</p>\n\n<pre><code>shuffle :: [a] -&gt; Gen [a]\n</code></pre>\n\n<p>That means that this argument takes a list and returns a shuffled list \"in\" the <code>Gen</code> monad.</p>\n\n<p>Because its a monad you can put it inside a <code>do</code> clause. Its not quite clear what you are asking for, but I think its something like this:</p>\n\n<pre><code>myTest :: Integer -&gt; Gen [Integer]\nmyTest 0 = return []\nmyTest n = do\n   ns &lt;- shuffle [1..n]\n   x &lt;- choose (0,n-1)\n   y &lt;- choose (1,n)\n   let (ns1,ns2) = splitAt x ns\n   return $ ns1 ++ [y] ++ drop 1 ns2`\n</code></pre>\n\n<p>You can run an action in the Gen monad using <code>generate</code>, which returns a value in <code>IO</code>, or you can set up a new type for your test data and make it an instance of <code>Arbitrary</code>, which contains the function</p>\n\n<pre><code>arbitrary :: Gen a\n</code></pre>\n\n<p><strong>Edit:</strong> Or as Zeta pointed out in the comments you can use <code>forAll</code>:</p>\n\n<pre><code>quickCheck $ forAll (myTest 10) $ \\x -&gt; ....\n</code></pre>\n"}], "owner": {"reputation": 1813, "user_id": 721506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOKfE.jpg?s=128&g=1", "display_name": "Larry LIU Xinyu", "link": "https://stackoverflow.com/users/721506/larry-liu-xinyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 42186107, "answer_count": 1, "score": 0, "last_activity_date": 1486917074, "creation_date": 1486892101, "question_id": 42186029, "link": "https://stackoverflow.com/questions/42186029/how-to-generate-test-data-with-shuffle-in-quickceck", "title": "How to generate test data with shuffle in QuickCeck", "body": "<p>For a given list [1..n], where n is a random positive integer, I want to generate the test data with 2 steps: </p>\n\n<ol>\n<li>Shuffle the list, xs = shuffle [1..n];</li>\n<li>Random mutate a number x in xs to y, where 1 &lt;= y &lt;= n;</li>\n</ol>\n\n<p>After these 2 steps, the new list is denoted as ys.</p>\n\n<p>I wrote a program. It takes ys, and outputs (x, y), the function prototype is like this:</p>\n\n<pre><code>solve :: [a] -&gt; (a, a)\n</code></pre>\n\n<p>I want to use Test.QuickCheck to test my program. How to generate such test data? I see there is a function in QuickCheck</p>\n\n<pre><code>shuffle :: [a] -&gt; Gen [a]\n</code></pre>\n\n<p>But I have no idea about how to use it.</p>\n"}, {"tags": ["haskell", "syntax", "typeclass", "functional-dependencies"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1486889413, "post_id": 42185687, "comment_id": 71533634, "body": "This is saying that <code>Monad m</code> must always hold when <code>MonadReader r m</code> holds. <code>Monad m</code> is a superclass of <code>MonadReader r m</code> (although I&#39;m not sure the word <i>superclass</i> was ever really meant to scale to multi-param type classes like <code>MonadReader</code>)."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1486889475, "post_id": 42185687, "comment_id": 71533646, "body": "<code>Monad m =&gt;</code> can be read as <i>&quot;when m is a Monad&quot;</i>, both in a function definition and in a class definition. In the latter case it does establish a relationship between Monad and MonadReader. Namely, every instance of <code>MonadReader r</code> is necessarily an instance of <code>Monad</code>. IOW it makes <code>MonadReader r</code> a <i>subclass</i> of <code>Monad</code> (if you can ever apply this notion to multiparameter type classes)."}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 3, "last_activity_date": 1506552930, "last_edit_date": 1506552930, "creation_date": 1486898991, "answer_id": 42187028, "question_id": 42185687, "link": "https://stackoverflow.com/questions/42185687/typeclass-confusions-when-using-operator/42187028#42187028", "title": "Typeclass confusions when using `=&gt;` operator?", "body": "<p>In</p>\n\n<pre><code>class Monad m =&gt; MonadReader r m | m -&gt; r where\n</code></pre>\n\n<p>we have</p>\n\n<ol>\n<li><p>The superclass constraint <code>Monad m</code>, which means that two given types <code>r</code> and <code>m</code> can be made instances of <code>MonadReader r m</code> if they not only implement the methods enumerated in <code>MonadReader</code>'s definition, but also the constraint <code>Monad m</code> holds, i.e. <code>m</code> is an instance of the <code>Monad</code> typeclass.</p></li>\n<li><p>There is a functional dependency determining <code>r</code> from <code>m</code>, i.e. for any two <code>instance</code>s of <code>MonadReader r1 m1</code> and <code>MonadReader r2 m2</code>, if <code>m1 ~ m2</code> then <code>r1 ~ r2</code>. </p></li>\n</ol>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 42187028, "answer_count": 1, "score": 1, "last_activity_date": 1506552930, "creation_date": 1486888890, "last_edit_date": 1486899009, "question_id": 42185687, "link": "https://stackoverflow.com/questions/42185687/typeclass-confusions-when-using-operator", "title": "Typeclass confusions when using `=&gt;` operator?", "body": "<p>I have a basic typeclass:</p>\n\n<pre><code>class MyClass a where\n  (-+) :: a -&gt; a -&gt; a\n\ninstance MyClass Int where\n  e1 -+ e2 = e1 + e2 * 100\n\nmyFunction :: MyClass a =&gt; a -&gt; a -&gt; a\nmyFunction e1 e2 = e1 -+ e2\n</code></pre>\n\n<p>I understand how the above works.</p>\n\n<p>However, I don't understand the use of the <code>=&gt;</code> operator in this typeclass declaration:</p>\n\n<pre><code>class Monad m =&gt; MonadReader r m | m -&gt; r where\n</code></pre>\n\n<p>Is this making MonadReader class related to the Monad class? Why is this used?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1486877111, "post_id": 42184307, "comment_id": 71531486, "body": "I voted to close because, in effect, your question is &quot;I don&#39;t understand X.  Educate me.&quot;.  In order to educate someone it is necessary to have an idea what they already know and, in this situation, what specifically is confusing."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1486877163, "post_id": 42184307, "comment_id": 71531499, "body": "In this situation I would bet you don&#39;t understand the <code>foldr</code> function.  So why not look at the source code to <code>foldr</code> and get an understanding of that?  Once you have that (or fail to have that) you should be able to make a more specific question."}, {"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1486907361, "post_id": 42184307, "comment_id": 71538591, "body": "@ThomasM.DuBuisson the source code for <code>foldr</code> looks like this:  <code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b</code> <code>foldr f z t = appEndo (foldMap (Endo #. f) t) z</code>  How would a newbie even know where to start with that?"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1486919492, "post_id": 42184307, "comment_id": 71542999, "body": "@LIbby Not the generic code, the instance for lists.  <code>foldr k z = go where go []     = z ;  go (y:ys) = y `k` go ys</code>"}, {"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1486922137, "post_id": 42184307, "comment_id": 71544059, "body": "@ThomasM.DuBuisson If a newbie doesn&#39;t understand <code>foldr</code>, they aren&#39;t likely to know to look for the <code>Foldable</code> instance for lists rather than the generic definition that comes up in Hoogle."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "edited": false, "score": 0, "creation_date": 1486932983, "post_id": 42184307, "comment_id": 71548241, "body": "@Libby I&#39;m not interested in debating how newbies go about searching the internet.  There are many ways they might do it and many of them, such as obvious google searches, lead to code from the Haskell Report or the <a href=\"https://wiki.haskell.org/Foldr_Foldl_Foldl&#39;\" rel=\"nofollow noreferrer\">wiki foldr</a>.  I think we both agree the code you pointed to, found through one reasonable means, is not newbie friendly.  My main point is that it would help if the asker provided more direction and context with the question."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1486892852, "post_id": 42184550, "comment_id": 71534448, "body": "Actually, in <code>foldr</code> it is the last element of the list which is used together with <code>0</code>, and here <code>f</code> returns <code>1</code>. Then, the next-to-last with <code>1</code>, producing <code>2</code>. And so on."}, {"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486907131, "post_id": 42184550, "comment_id": 71538521, "body": "ha, this is why I shouldn&#39;t try to SO in the middle of the night. Thanks."}, {"owner": {"reputation": 11, "user_id": 7552311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e990a45982af920bb1d3bd065c051615?s=128&d=identicon&r=PG&f=1", "display_name": "Dayanand Chaudhary", "link": "https://stackoverflow.com/users/7552311/dayanand-chaudhary"}, "edited": false, "score": 0, "creation_date": 1486910711, "post_id": 42184550, "comment_id": 71539749, "body": "Thanks for helping me out LIbby Now I have a better understanding of foldr function , this was my first question on stackoverflow and I got 4 downvotes honestly speaking that was heartbreaking  for a newbie like me. Maybe It happened because my question was foolish"}, {"owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "reply_to_user": {"reputation": 11, "user_id": 7552311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e990a45982af920bb1d3bd065c051615?s=128&d=identicon&r=PG&f=1", "display_name": "Dayanand Chaudhary", "link": "https://stackoverflow.com/users/7552311/dayanand-chaudhary"}, "edited": false, "score": 2, "creation_date": 1486912045, "post_id": 42184550, "comment_id": 71540204, "body": "@DayanandChaudhary Your question wasn&#39;t foolish. Folds are an abstract concept and the official documentation for <code>foldr</code> isn&#39;t very newbie-friendly. However, it&#39;s true that on stackoverflow, <i>how</i> you ask is at least as important as <i>what</i> you ask. It was hard to answer this question because I wasn&#39;t sure exactly what you were confused about or what you already knew. This is a good resource on asking good questions: <a href=\"http://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 11, "user_id": 7552311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e990a45982af920bb1d3bd065c051615?s=128&d=identicon&r=PG&f=1", "display_name": "Dayanand Chaudhary", "link": "https://stackoverflow.com/users/7552311/dayanand-chaudhary"}, "edited": false, "score": 1, "creation_date": 1486913322, "post_id": 42184550, "comment_id": 71540647, "body": "@DayanandChaudhary Usually in SO, under the haskell tag, it is rare to see so many downvotes -- the haskell community here is usually very friendy. I was surprised as well. I guess the main issue is that your question did not show any effort and it was very generic. I mean, any tutorial on Haskell should cover <code>foldr</code>. If you did find a problem with any specific part of a tutorial, and asked about that, I guess the community here would be more open. Don&#39;t be discouraged -- next time, try to show you did attempt to solve your problem, and be more specific."}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1486924843, "post_id": 42184550, "comment_id": 71545122, "body": "@chi: the question is very worthy of downvotes, and I have only refrained because -4 probably makes the point well. Expending little/no effort, asking an unclear question, not formatting code and using please-help-me pleading in the title is like painting a target on a question. I&#39;d add that downvotes should not be seen as unfriendly, in the main - they are simple messages that offer feedback about quality."}], "tags": [], "owner": {"reputation": 1227, "user_id": 5053374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe57f0998df065470ff42c938f781cf?s=128&d=identicon&r=PG", "display_name": "Libby", "link": "https://stackoverflow.com/users/5053374/libby"}, "is_accepted": false, "score": 2, "last_activity_date": 1486907308, "last_edit_date": 1486907308, "creation_date": 1486877792, "answer_id": 42184550, "question_id": 42184307, "link": "https://stackoverflow.com/questions/42184307/how-to-understand-the-execution-of-this-haskell-program/42184550#42184550", "title": "How to understand the execution of this Haskell program?", "body": "<p>This function will be executed when you call it with a list of numbers. <code>myLength [1,2,3]</code> should return <code>3</code>.</p>\n\n<p><code>foldr</code> takes three arguments. The first is a function: here it's <code>f</code>. The second is a starting value, the same type as you want the whole thing to return. The last argument is the list that you're going to fold up.</p>\n\n<p><code>foldr</code> works (kinda) like this: the function <code>f</code> is going to get called for every element of the list, the last element first. The first time, it gets called the last element of the list and <code>0</code>, returning <code>1</code>. Then it gets called with the second-to-last element of the list and <code>1</code> (the result of the previous call). So the result of <code>f</code> each time is the length of the list so far. When there's nothing left of the list, it returns that value it's accumulated so far (the length of the list).</p>\n\n<p>A nice exercise is to try to write a fold yourself with a recursive definition. That may help you understand it better.</p>\n"}], "owner": {"reputation": 11, "user_id": 7552311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e990a45982af920bb1d3bd065c051615?s=128&d=identicon&r=PG&f=1", "display_name": "Dayanand Chaudhary", "link": "https://stackoverflow.com/users/7552311/dayanand-chaudhary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "closed_date": 1486883570, "answer_count": 1, "score": -3, "last_activity_date": 1489274689, "creation_date": 1486874785, "last_edit_date": 1489274689, "question_id": 42184307, "link": "https://stackoverflow.com/questions/42184307/how-to-understand-the-execution-of-this-haskell-program", "closed_reason": "Needs details or clarity", "title": "How to understand the execution of this Haskell program?", "body": "<p>While I was studying the <code>foldr</code> function in Haskell I came across this program and I am not able to figure out how it is executing.</p>\n\n<pre><code>mylength :: [Int] -&gt; Int\nmylength l = foldr f 0 l\n  where \n    f x y = y + 1\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486870764, "post_id": 42183960, "comment_id": 71530443, "body": "Unfortunately, the newest version of GHC does let you omit the <code>let</code>, so each line overshadows the previous one"}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486870855, "post_id": 42183960, "comment_id": 71530453, "body": "@Alec: TIL. Thanks!"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486879085, "post_id": 42183960, "comment_id": 71531777, "body": "Note that you not only corrected the syntax errors, but also corrected the code. OPs function still throws an error when defined in a file because there is no <code>merge (x:xs) (y:ys) = .. </code> case"}, {"owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486882940, "post_id": 42183960, "comment_id": 71532405, "body": "@user2407038: Right. Actually, I originally only intended to fix the problem with the interactive session, but then I couldn&#39;t help myself and wrote the correct version of <code>merge</code> en passant."}], "tags": [], "owner": {"reputation": 15683, "user_id": 46571, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/79eede5b02caa81db17f34026b24a734?s=128&d=identicon&r=PG", "display_name": "pyon", "link": "https://stackoverflow.com/users/46571/pyon"}, "is_accepted": true, "score": 7, "last_activity_date": 1486882917, "last_edit_date": 1495540393, "creation_date": 1486870617, "answer_id": 42183960, "question_id": 42183896, "link": "https://stackoverflow.com/questions/42183896/yet-another-non-exhaustive-patterns-in-function/42183960#42183960", "title": "Yet another &#39;Non-exhaustive patterns in function&#39;", "body": "<p>There are two separate issues here.</p>\n\n<p><strike>You couldn't possibly have defined <code>merge</code> that way in GHCi.</strike> (Thanks for the correction, Alec!)</p>\n\n<p>The first issue, which only happens in the interactive session, is that you are defining <em>three</em> separate functions called <code>merge</code>, each of which <em>shadows</em> the previous one. See <a href=\"https://stackoverflow.com/q/26054046/46571\">here</a> for someone who had a very similar problem to yours.</p>\n\n<p>To enter a single multiline definition, you must use <code>:{</code> and <code>:}</code>:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| merge [] [] = []\nPrelude| merge (x:xs) [] = x:xs\nPrelude| merge [] (y:ys) = y:ys\nPrelude| -- merge (x:xs) (y:ys)\nPrelude| :}\nPrelude&gt; \n</code></pre>\n\n<p>However, in general, entering multiline definitions into GHCi is rather unpleasant, so you are better off storing your definitions into a normal <code>.hs</code> file and then loading this file into GHCi.</p>\n\n<hr>\n\n<p>The second issue, which happens both in the interactive session and in the non-interactive program, is that your definition of <code>merge</code> isn't exhaustive: the case when both list arguments are nonempty isn't handled. Note that:</p>\n\n<ul>\n<li>If either list argument is empty, <code>merge</code> must return the other list.</li>\n<li>If both lists are nonempty, <code>merge</code> must extract the smallest head element (in either list), and then recursively merge the rest.</li>\n</ul>\n\n<p>Thus, the correct definition of <code>merge</code> is:</p>\n\n<pre><code>Prelude&gt; :{\nPrelude| merge xs [] = xs\nPrelude| merge [] ys = ys\nPrelude| merge xxs@(x:xs) yys@(y:ys)\nPrelude|   | x &lt;= y    = x : merge xs yys\nPrelude|   | otherwise = y : merge xxs ys\nPrelude| :}\nPrelude&gt; merge [1,3..9] [2,4..10]\n[1,2,3,4,5,6,7,8,9,10]\nPrelude&gt; \n</code></pre>\n\n<p>Or, non-interactively:</p>\n\n<pre><code>merge xs [] = xs\nmerge [] ys = ys\nmerge xxs@(x:xs) yys@(y:ys)\n  | x &lt;= y    = x : merge xs yys\n  | otherwise = y : merge xxs ys\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 3318776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3eb0645a257e90f913207d0a149ddd?s=128&d=identicon&r=PG&f=1", "display_name": "Rifti", "link": "https://stackoverflow.com/users/3318776/rifti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 603, "favorite_count": 0, "accepted_answer_id": 42183960, "answer_count": 1, "score": 2, "last_activity_date": 1486882917, "creation_date": 1486869874, "last_edit_date": 1495540393, "question_id": 42183896, "link": "https://stackoverflow.com/questions/42183896/yet-another-non-exhaustive-patterns-in-function", "title": "Yet another &#39;Non-exhaustive patterns in function&#39;", "body": "<p>Begginer Haskell Question.\nActually I found very similiar question <a href=\"https://stackoverflow.com/questions/11615031/haskell-error-non-exhaustive-patterns\">Haskell error: &quot;non-exhaustive patterns&quot;</a></p>\n\n<p>Interactive shell:</p>\n\n<pre><code>Prelude&gt; merge [] [] = []\nPrelude&gt; merge (x:xs) [] = x:xs\nPrelude&gt; merge [] (y:ys) = y:ys\nPrelude&gt; -- merge (x:xs) (y:ys)\n\nPrelude&gt; merge [][]\nException\nPrelude&gt; merge [0][]\nException: &lt;interactive&gt;:3:1-22: Non-exhaustive patterns in function merge\n\nPrelude&gt; merger [][0]\nOK\n</code></pre>\n\n<p>In fact exceptions exist also in non-interactive mode</p>\n\n<pre><code>main = do\n   print (merge [1,2,3] [])\n   print (merge [] [1,2,3])\n   print (merge [] [])\n\n\nmerge :: (Ord a) =&gt; [a] -&gt; [a] -&gt; [a]\nmerge (x:xs) [] = x:xs\nmerge [] (y:ys) = y:ys\nmerge [][] = []\n</code></pre>\n\n<p>However it depends on order of particulas special cases of merge where error appears. \nI dont't really know why this happens. Thanks in advance.</p>\n"}, {"tags": ["algorithm", "haskell", "data-structures", "lazy-evaluation"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486851849, "post_id": 42181855, "comment_id": 71526575, "body": "&quot;while current size is greater than predefined limit&quot; did you mean &quot;while current size is <b>not</b> greater than predefined limit&quot;"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486852445, "post_id": 42181855, "comment_id": 71526748, "body": "@Alec thanks! My English is far from good. I rewrote that sentence to make it more clear."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486852487, "post_id": 42181855, "comment_id": 71526758, "body": "&quot;Limit by total size of all elements like 2Mb&quot; what about sharing or laziness? How are you going to measure size?"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486852875, "post_id": 42181855, "comment_id": 71526859, "body": "@Alec In my current implementation I&#39;m using <code>Text</code> data type, it seems not difficult for me to measure size (it will be even enough for me to use <code>length</code> as not so bad approximation of memory size). But I can imagine some API where you give <code>value -&gt; Word64</code> function which tells you how to measure size. Or maybe there are even exist some tricks aka <code>sizeof</code> in <i>Haskell</i>. Regarding sharing or laziness: I agree, it&#39;s very difficult to calculate such values in general case."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1486853401, "post_id": 42181855, "comment_id": 71527002, "body": "My point is that sometimes it makes no sense. If I have a giant byte string and I add to your queue slices of it, what is the size of the queue? What about an unevaluated thunk? But yes, the question becomes solvable if you give a &#39;size&#39; function. I&#39;m not sure the output will be useful though."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486857570, "post_id": 42181855, "comment_id": 71528043, "body": "You point to <code>lrucache</code> and say that it cannot limit the queue by size, but the <a href=\"http://hackage.haskell.org/package/lrucache-1.2.0.0/docs/src/Data-Cache-LRU-Internal.html#newLRU\" rel=\"nofollow noreferrer\">newLRU</a> function which says &quot;If a size limit is specified, the LRU is guaranteed to not grow above the specified number of entries.&quot; - does this not meet requirement 1? (Note: the 3rd requirement will absolutely be the hardest to fulfill - unevaluated thunks can be arbitrarily large, so you&#39;ll at least need to use <code>DeepSeq</code> as well as writing your <code>sizeof</code> function)"}, {"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486858825, "post_id": 42181855, "comment_id": 71528354, "body": "@user2407038 Yes, number of entries is not enough. Because entries can have arbitrary size in my case and I don&#39;t want overall size be too large. Regarding <i>unevaluated thunks</i>: yes, I agreed this is non-trivial. But I&#39;m okay with <code>DeepSeq</code> solution, because forcing evaluation won&#39;t happen too often."}], "owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 186, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1486852391, "creation_date": 1486851308, "last_edit_date": 1486852391, "question_id": 42181855, "link": "https://stackoverflow.com/questions/42181855/queue-with-memory-limited-size", "title": "Queue with memory limited size", "body": "<p>I need a queue with next properties and supported operations:</p>\n\n<ul>\n<li>Push element in the beginning, automatically popping out from the end until size of queue become not greater than predefined limit.</li>\n<li>Take <strong>N</strong> elements from beginning lazily and not traversing whole queue.</li>\n<li>Limit by total size of all elements like 2Mb.</li>\n</ul>\n\n<p>I know I can implement this by myself as a wrapper aroud <code>Data.Sequence</code>, or something else (according to <a href=\"https://www.reddit.com/r/haskell/comments/4lipsr/recommended_queue_package_xpost_from/\" rel=\"nofollow noreferrer\">mentioned implementations</a>). Also found <a href=\"https://www.well-typed.com/blog/2016/01/efficient-queues/\" rel=\"nofollow noreferrer\">this blog post</a> from <em>Well Typed</em>. I just wonder is this already implemented somewhere?</p>\n\n<p>And if there is no standard implementation with desired behaviour, it would be nice to hear recommendations which standard data structure to use to implement such queue.</p>\n\n<p>There is <a href=\"http://hackage.haskell.org/package/lrucache-1.2.0.0/docs/Data-Cache-LRU.html\" rel=\"nofollow noreferrer\"><code>lrucache</code></a> library which has almost anything I want except it limits it's size by number of elements in queue.</p>\n"}, {"tags": ["c", "haskell", "c-preprocessor"], "comments": [{"owner": {"reputation": 1361, "user_id": 7304770, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c7a710fcb5ccb500839c6e4819efb4b0?s=128&d=identicon&r=PG&f=1", "display_name": "Sabrina", "link": "https://stackoverflow.com/users/7304770/sabrina"}, "edited": false, "score": 0, "creation_date": 1486854533, "post_id": 42181630, "comment_id": 71527319, "body": "You did not mention which command have you used for preprocessing your file ?"}, {"owner": {"reputation": 483, "user_id": 7208967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5042326d29e031e894c5631cc5184?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfram", "link": "https://stackoverflow.com/users/7208967/wolfram"}, "reply_to_user": {"reputation": 1361, "user_id": 7304770, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c7a710fcb5ccb500839c6e4819efb4b0?s=128&d=identicon&r=PG&f=1", "display_name": "Sabrina", "link": "https://stackoverflow.com/users/7304770/sabrina"}, "edited": false, "score": 0, "creation_date": 1486854996, "post_id": 42181630, "comment_id": 71527433, "body": "@Sabrina This is not &quot;my file&quot;, this is the official source of a Haskell module. I didn&#39;t preprocessed it and I didn&#39;t got your question. I was just interested what is this comment in the source about."}, {"owner": {"reputation": 1361, "user_id": 7304770, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c7a710fcb5ccb500839c6e4819efb4b0?s=128&d=identicon&r=PG&f=1", "display_name": "Sabrina", "link": "https://stackoverflow.com/users/7304770/sabrina"}, "edited": false, "score": 0, "creation_date": 1486856368, "post_id": 42181630, "comment_id": 71527774, "body": "backslash-newline when it is at the end of the line it is mainly used to join the current line with the following line creating a source logical line. In your example they added a haskell comment so to prevent that from happening. The good thing here is that comment in haskell is different from  C, objective C and C++ ; CPP here is not going to interpret it as comment but as preprocessing tokens. In this case, \\\\ will be considered as a an escape sequence character and not backslash-newline."}], "answers": [{"comments": [{"owner": {"reputation": 483, "user_id": 7208967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5042326d29e031e894c5631cc5184?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfram", "link": "https://stackoverflow.com/users/7208967/wolfram"}, "edited": false, "score": 0, "creation_date": 1486850765, "post_id": 42181748, "comment_id": 71526229, "body": "Okay, but why it says that the backslash-newline is at the end of file? This line is obviously not the end of file."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 483, "user_id": 7208967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5042326d29e031e894c5631cc5184?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfram", "link": "https://stackoverflow.com/users/7208967/wolfram"}, "edited": false, "score": 0, "creation_date": 1486850927, "post_id": 42181748, "comment_id": 71526278, "body": "@Wolfram you&#39;re right, my test was incomplete, edited."}, {"owner": {"reputation": 483, "user_id": 7208967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5042326d29e031e894c5631cc5184?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfram", "link": "https://stackoverflow.com/users/7208967/wolfram"}, "edited": false, "score": 1, "creation_date": 1486851129, "post_id": 42181748, "comment_id": 71526343, "body": "Ah, got it, it eats backslash because a single backslash is reserved for line gluing, so to make a real backslash at the end of a line we need to escape it. But if the backslash isn&#39;t in the end of a line, it is not eaten. Didn&#39;t know that, thanks)"}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 483, "user_id": 7208967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5042326d29e031e894c5631cc5184?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfram", "link": "https://stackoverflow.com/users/7208967/wolfram"}, "edited": false, "score": 0, "creation_date": 1486851160, "post_id": 42181748, "comment_id": 71526349, "body": "exactly! very refreshing question I have to say :)"}, {"owner": {"reputation": 306, "user_id": 7101622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/eccbc68666a56d817e81984983bedce1?s=128&d=identicon&r=PG&f=1", "display_name": "hm1912", "link": "https://stackoverflow.com/users/7101622/hm1912"}, "edited": false, "score": 1, "creation_date": 1486851297, "post_id": 42181748, "comment_id": 71526389, "body": "That&#39;s why ending C single line comments with ??/ is dangerous as well. It&#39;s a trigraph that is replaced with a simple backslash \\."}, {"owner": {"reputation": 483, "user_id": 7208967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5042326d29e031e894c5631cc5184?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfram", "link": "https://stackoverflow.com/users/7208967/wolfram"}, "reply_to_user": {"reputation": 306, "user_id": 7101622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/eccbc68666a56d817e81984983bedce1?s=128&d=identicon&r=PG&f=1", "display_name": "hm1912", "link": "https://stackoverflow.com/users/7101622/hm1912"}, "edited": false, "score": 0, "creation_date": 1486851645, "post_id": 42181748, "comment_id": 71526501, "body": "@Xeneda, I thought trigraphs are not enabled by default in gcc."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1486851679, "post_id": 42181748, "comment_id": 71526511, "body": "actually you get a warning like this: so no they&#39;re not enabled: <code>trigraph ??&#47; ignored, use -trigraphs to enable [-Wtrigraphs]</code>"}, {"owner": {"reputation": 1361, "user_id": 7304770, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c7a710fcb5ccb500839c6e4819efb4b0?s=128&d=identicon&r=PG&f=1", "display_name": "Sabrina", "link": "https://stackoverflow.com/users/7304770/sabrina"}, "edited": false, "score": 0, "creation_date": 1486855992, "post_id": 42181748, "comment_id": 71527691, "body": "trigraph useless feature for you maybe but for some implementations  it is a great feature."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 1361, "user_id": 7304770, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c7a710fcb5ccb500839c6e4819efb4b0?s=128&d=identicon&r=PG&f=1", "display_name": "Sabrina", "link": "https://stackoverflow.com/users/7304770/sabrina"}, "edited": false, "score": 0, "creation_date": 1486887887, "post_id": 42181748, "comment_id": 71533319, "body": "@Sabrina: that was just my opinion. I&#39;d like to know where it is used"}, {"owner": {"reputation": 306, "user_id": 7101622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/eccbc68666a56d817e81984983bedce1?s=128&d=identicon&r=PG&f=1", "display_name": "hm1912", "link": "https://stackoverflow.com/users/7101622/hm1912"}, "edited": false, "score": 0, "creation_date": 1486889921, "post_id": 42181748, "comment_id": 71533744, "body": "Oh well, I thought they were enabled by default. @Jean-Fran&#231;oisFabre: Some keyboards (especially older ones) are missing some keys or it is harder to write some signs. For example, the QWERTZ-keyboard used in Austria and in Germany makes it a bit harder to write some signs, e.g. for <code>^</code> (xor) you need to type another character after it to be written. <code>[, ], {, }</code> are <code>Alt-Gr</code>-combinations. I always hit <code>Alt-Gr</code> with my right thumb. If you lost your right thumb in an accident or something, you might prefer using trigraphs for those characters."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1486890260, "post_id": 42181748, "comment_id": 71533842, "body": "ok, now if you lose your thumb or missing keys on keyboard, this isn&#39;t good a reason enough to start using those. I can&#39;t imagine contributing to a major project (with more than 1 people) using these. Copy/paste of existing symbols is your friend in those cases."}, {"owner": {"reputation": 483, "user_id": 7208967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5042326d29e031e894c5631cc5184?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfram", "link": "https://stackoverflow.com/users/7208967/wolfram"}, "reply_to_user": {"reputation": 306, "user_id": 7101622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/eccbc68666a56d817e81984983bedce1?s=128&d=identicon&r=PG&f=1", "display_name": "hm1912", "link": "https://stackoverflow.com/users/7101622/hm1912"}, "edited": false, "score": 0, "creation_date": 1486898379, "post_id": 42181748, "comment_id": 71535960, "body": "@Xeneda That&#39;s not a valid reason to make your code less readable. Copypasting is tedious, but today one can easily configure automatic replacement of certain combinations by desirable symbols with AutoHotKey (Windows) or AutoKey/xbindkeys/etc. (Linux). Trigraphs are just a legacy, imho."}, {"owner": {"reputation": 306, "user_id": 7101622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/eccbc68666a56d817e81984983bedce1?s=128&d=identicon&r=PG&f=1", "display_name": "hm1912", "link": "https://stackoverflow.com/users/7101622/hm1912"}, "edited": false, "score": 0, "creation_date": 1486899291, "post_id": 42181748, "comment_id": 71536238, "body": "I don&#39;t use them. I just told @Jean-Fran&#231;oisFabre what they <b>can</b> be used for. Not when they <b>should</b> be used. :)"}, {"owner": {"reputation": 1361, "user_id": 7304770, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c7a710fcb5ccb500839c6e4819efb4b0?s=128&d=identicon&r=PG&f=1", "display_name": "Sabrina", "link": "https://stackoverflow.com/users/7304770/sabrina"}, "edited": false, "score": 0, "creation_date": 1486919707, "post_id": 42181748, "comment_id": 71543091, "body": "For @Jean-Fran&#231;oisFabre sthg that he did not used is useless."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 1361, "user_id": 7304770, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c7a710fcb5ccb500839c6e4819efb4b0?s=128&d=identicon&r=PG&f=1", "display_name": "Sabrina", "link": "https://stackoverflow.com/users/7304770/sabrina"}, "edited": false, "score": 0, "creation_date": 1486920346, "post_id": 42181748, "comment_id": 71543346, "body": "@Sabrina. as I said in a further comment, only my opinion. I&#39;ve been coding C for more than 25 years and I never got to use that."}], "tags": [], "owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "is_accepted": true, "score": 13, "last_activity_date": 1486850908, "last_edit_date": 1486850908, "creation_date": 1486850567, "answer_id": 42181748, "question_id": 42181630, "link": "https://stackoverflow.com/questions/42181630/how-does-the-line-with-two-backslashes-fool-c-preprocessor/42181748#42181748", "title": "How does the line with two backslashes fool C preprocessor?", "body": "<p>If you put simply this:</p>\n\n<pre><code>infix 5 \\\\\n</code></pre>\n\n<p>the C preprocessor issues the following message when the line is at the end of the file:</p>\n\n<pre><code>infix 5 \\foo.c:8:10: warning: backslash-newline at end of file\n</code></pre>\n\n<p>And if it's not at the end of the file (thanks @commenter), it just \"eats\" one backslash (to associate it with the following newline) and the output is incorrect on the Haskell side:</p>\n\n<pre><code>infix 5 \\\n</code></pre>\n\n<p>BUT if you add an Haskell-type comment afterwards, Haskell ignores it (obviously!), and it isn't a problem for the C preprocessor since <code>\\</code> isn't at the end of the line:</p>\n\n<pre><code>infix 5 \\\\ -- comment\n</code></pre>\n\n<p>cpp issues the exact same text and Haskell can parse the interesting part, stripping the --` comment.</p>\n\n<p>(note that it is never valid C, but the preprocessor doesn't mind)</p>\n\n<p>Note: the problem is similar if you want to end your C/C++ <code>//</code> comment line with <code>\\</code>: you can't without it continuing the comment on the next line: not what you want.</p>\n"}], "owner": {"reputation": 483, "user_id": 7208967, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5042326d29e031e894c5631cc5184?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfram", "link": "https://stackoverflow.com/users/7208967/wolfram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 431, "favorite_count": 2, "accepted_answer_id": 42181748, "answer_count": 1, "score": 16, "last_activity_date": 1486850908, "creation_date": 1486849755, "question_id": 42181630, "link": "https://stackoverflow.com/questions/42181630/how-does-the-line-with-two-backslashes-fool-c-preprocessor", "title": "How does the line with two backslashes fool C preprocessor?", "body": "<p>I decided to take a look into the source of a standard Haskell module <a href=\"https://hackage.haskell.org/package/base-4.3.1.0/docs/src/Data-List.html\" rel=\"noreferrer\">Data.List</a> an found something interesting. The code is obviously firstly processed by C preprocessor, as a bunch of <code>#ifdef</code>s suggest, and only after that is compiled by Haskell compiler. However, C preprocessor is not very friendly to the source code different from C itself, as pointed out in the <a href=\"https://gcc.gnu.org/onlinedocs/cpp/Overview.html#Overview\" rel=\"noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>The C preprocessor is intended to be used only with C, C++, and Objective-C source code. In the past, it has been abused as a general text processor. It will choke on input which does not obey C's lexical rules. For example, apostrophes will be interpreted as the beginning of character constants, and cause errors. Also, you cannot rely on it preserving characteristics of the input which are not significant to C-family languages. If a Makefile is preprocessed, all the hard tabs will be removed, and the Makefile will not work. </p>\n</blockquote>\n\n<p>But somehow Haskell code is still preserved under C preprocessing? Probably this snippet gives a clue:</p>\n\n<pre><code>#ifdef __GLASGOW_HASKELL__\nimport GHC.Num\nimport GHC.Real\nimport GHC.List\nimport GHC.Base\n#endif\n\ninfix 5 \\\\ -- comment to fool cpp\n\n-- -----------------------------------------------------------------------------\n-- List functions\n</code></pre>\n\n<p>How does this <code>comment to fool cpp</code> work? Looks like an interesting hack, but I could not google anything on the topic. In Haskell this line declares an infix operator <code>\\\\</code> with priority 5, and all the text after <code>--</code> is ignored. But what does it do with C preprocessor and in which way is it actually \"fooled\"?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "edited": false, "score": 0, "creation_date": 1486849041, "post_id": 42181512, "comment_id": 71525794, "body": "I&#39;m using top - down approach so I haven&#39;t written the code for validVals (although I do know what it will do and what are it&#39;s inputs and outputs)"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 1, "creation_date": 1486849353, "post_id": 42181512, "comment_id": 71525875, "body": "Given that there are no uses of <code>head</code> in your code, the error you are getting must have come from somewhere else, and your question is currently unanswerable. Post the piece of the code where the error is coming from, which must involve some use of the <code>head</code> function."}, {"owner": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1486849555, "post_id": 42181512, "comment_id": 71525929, "body": "@AlexisKing I tested the sudoku function seperately and it wasn&#39;t giving me an error so I assumed the error was in the other function."}, {"owner": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "reply_to_user": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "edited": false, "score": 0, "creation_date": 1486851743, "post_id": 42181512, "comment_id": 71526528, "body": "I edited the code and the error is still there"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "edited": false, "score": 1, "creation_date": 1486879883, "post_id": 42183174, "comment_id": 71531921, "body": "Thank you for responding. I tried what you said it is still showing an error (exception: allboards returned an empty list). I can provide the whole code if that will help you help me ( code is not complete though)"}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "reply_to_user": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "edited": false, "score": 0, "creation_date": 1486903085, "post_id": 42183174, "comment_id": 71537295, "body": "Yes, please provide enough code for it to compile and I&#39;d be happy to help."}, {"owner": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "edited": false, "score": 0, "creation_date": 1486904544, "post_id": 42183174, "comment_id": 71537738, "body": "I&#39;ve posted the complete code and explain it in the description"}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "reply_to_user": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "edited": false, "score": 1, "creation_date": 1486910138, "post_id": 42183174, "comment_id": 71539527, "body": "By calling <code>sudokuElements</code> with the first argument always being a list of length 1, and the second argument being a list of length 30, and based on the recursive scheme of the function, it is <i>not possible</i> that that function will ever return anything except an empty list. Consequently, calling <code>head</code> on the result will <i>always</i> cause an exception. It&#39;s very difficult for me to follow the logic of the program, but I also suspect there could be something going wrong with the logic of the <code>validVals</code> function."}, {"owner": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "edited": false, "score": 0, "creation_date": 1486914501, "post_id": 42183174, "comment_id": 71541083, "body": "what do you mean by the first argument always being a list of length 1 and the second a list of length 30?"}, {"owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "reply_to_user": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "edited": false, "score": 0, "creation_date": 1486914743, "post_id": 42183174, "comment_id": 71541175, "body": "When you do this: <code>sudokuElements [bde] cd</code>, the list <code>[bde]</code> is a single element list, and <code>cd</code> has I think ~30 elements in it."}], "tags": [], "owner": {"reputation": 936, "user_id": 4884579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fca1fac3b94fed8f0291116e9b4ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Erik", "link": "https://stackoverflow.com/users/4884579/erik"}, "is_accepted": false, "score": 3, "last_activity_date": 1486861961, "creation_date": 1486861961, "answer_id": 42183174, "question_id": 42181512, "link": "https://stackoverflow.com/questions/42181512/exception-prelude-head-empty-list-in-haskell/42183174#42183174", "title": "Exception: Prelude.head: empty list in Haskell", "body": "<p>The issue is that <code>allBoards</code>/the call to <code>sudokuElements</code> is returning an empty list.</p>\n\n<p>Without seeing the entire program, it's hard to give you an exact reason why this might be.</p>\n\n<p>I recommend avoiding the use of <code>head</code> in general as it is a partial function. Instead, use pattern matching.</p>\n\n<p>In your case, this</p>\n\n<pre><code>fromElements (head allBoards)\n</code></pre>\n\n<p>can be rewritten as</p>\n\n<pre><code>case allBoards of\n  [] -&gt; error \"allBoards returned an empty list.\" -- Or whatever\n  (first:_) -&gt; fromElements first\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6296498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5de6938552f2ad49613d89674b95808b?s=128&d=identicon&r=PG&f=1", "display_name": "CS.R", "link": "https://stackoverflow.com/users/6296498/cs-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 895, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486904502, "creation_date": 1486848943, "last_edit_date": 1486904502, "question_id": 42181512, "link": "https://stackoverflow.com/questions/42181512/exception-prelude-head-empty-list-in-haskell", "title": "Exception: Prelude.head: empty list in Haskell", "body": "<p>I can't figure out why I'm getting this error. I have already read all the questions already asked about this error and I don't have any of those issues. Can someone please help. The comments are the hard code for the given example so we can use a top-down approach. When I get done with a function I comment out the hard code. I have only implemented the first 2 functions. In ghci when you run the file, type 'main', if it prints true the code is working. When I test both functions separately they return true but together they return the above error.</p>\n\n<pre><code>import Data.List ((\\\\), sort)\n\ntype Board = [[Int]]\n\ninputBoard :: Board\ninputBoard = \n    [[5,3,0, 0,7,0, 0,0,0],\n     [6,0,0, 1,9,5, 0,0,0],\n     [0,9,8, 0,0,0, 0,6,0],\n     [8,0,0, 0,6,0, 0,0,3],\n     [4,0,0, 8,0,3, 0,0,1],\n     [7,0,0, 0,2,0, 0,0,6],\n     [0,6,0, 0,0,0, 2,8,0],\n     [0,0,0, 4,1,9, 0,0,5],\n     [0,0,0, 0,8,0, 0,7,9]]\n\nsolvedBoard :: Board\nsolvedBoard = \n    [[5,3,4, 6,7,8, 9,1,2],\n     [6,7,2, 1,9,5, 3,4,8],\n     [1,9,8, 3,4,2, 5,6,7],\n     [8,5,9, 7,6,1, 4,2,3],\n     [4,2,6, 8,5,3, 7,9,1],\n     [7,1,3, 9,2,4, 8,5,6],\n     [9,6,1, 5,3,7, 2,8,4],\n     [2,8,7, 4,1,9, 6,3,5],\n     [3,4,5, 2,8,6, 1,7,9]]\n\ntype Coords = (Int,Int)\ntype BoardElement = (Coords,Int)\n\ninputBoardElements :: [BoardElement]\ninputBoardElements = \n    [((0,0),5),((0,1),3),((0,4),7),((1,0),6),((1,3),1),((1,4),9),((1,5),5),\n     ((2,1),9),((2,2),8),((2,7),6),((3,0),8),((3,4),6),((3,8),3),((4,0),4),\n     ((4,3),8),((4,5),3),((4,8),1),((5,0),7),((5,4),2),((5,8),6),((6,1),6),\n     ((6,6),2),((6,7),8),((7,3),4),((7,4),1),((7,5),9),((7,8),5),((8,4),8),\n     ((8,7),7),((8,8),9)]\n\ninputBoardEmpty :: [Coords]\ninputBoardEmpty = \n    [(0,2),(0,3),(0,5),(0,6),(0,7),(0,8),(1,1),(1,2),(1,6),(1,7),(1,8),\n     (2,0),(2,3),(2,4),(2,5),(2,6),(2,8),(3,1),(3,2),(3,3),(3,5),(3,6),\n     (3,7),(4,1),(4,2),(4,4),(4,6),(4,7),(5,1),(5,2),(5,3),(5,5),(5,6),\n     (5,7),(6,0),(6,2),(6,3),(6,4),(6,5),(6,8),(7,0),(7,1),(7,2),(7,6),\n     (7,7),(8,0),(8,1),(8,2),(8,3),(8,5),(8,6)]\n\nsolvedBoardElements :: [BoardElement]\nsolvedBoardElements = \n    [((0,0),5),((0,1),3),((0,2),4),((0,3),6),((0,4),7),((0,5),8),((0,6),9),\n     ((0,7),1),((0,8),2),((1,0),6),((1,1),7),((1,2),2),((1,3),1),((1,4),9),\n     ((1,5),5),((1,6),3),((1,7),4),((1,8),8),((2,0),1),((2,1),9),((2,2),8),\n     ((2,3),3),((2,4),4),((2,5),2),((2,6),5),((2,7),6),((2,8),7),((3,0),8),\n     ((3,1),5),((3,2),9),((3,3),7),((3,4),6),((3,5),1),((3,6),4),((3,7),2),\n     ((3,8),3),((4,0),4),((4,1),2),((4,2),6),((4,3),8),((4,4),5),((4,5),3),\n     ((4,6),7),((4,7),9),((4,8),1),((5,0),7),((5,1),1),((5,2),3),((5,3),9),\n     ((5,4),2),((5,5),4),((5,6),8),((5,7),5),((5,8),6),((6,0),9),((6,1),6),\n     ((6,2),1),((6,3),5),((6,4),3),((6,5),7),((6,6),2),((6,7),8),((6,8),4),\n     ((7,0),2),((7,1),8),((7,2),7),((7,3),4),((7,4),1),((7,5),9),((7,6),6),\n     ((7,7),3),((7,8),5),((8,0),3),((8,1),4),((8,2),5),((8,3),2),((8,4),8),\n     ((8,5),6),((8,6),1),((8,7),7),((8,8),9)]\n\nmain :: IO ()\nmain = print (sudoku inputBoard == solvedBoard)  \n\nsudoku :: Board -&gt; Board\nsudoku [] = []\nsudoku b =\n    let bde = fst (toElements b)\n        cd = snd (toElements b)\n        allboards = sudokuElements [bde] cd\n    in fromElements (head allboards)\n\n--sudoku b \n    --| b == inputBoard = solvedBoard\n    --| otherwise = error \"sudoku not implemented\"\n\nsudokuElements :: [[BoardElement]] -&gt; [Coords] -&gt; [[BoardElement]]\nsudokuElements a [] = a\nsudokuElements [] _ = []\nsudokuElements (be:bes) (cd:cds) =\n    let xs = validVals be cd\n        temp = [[(cd,x)] | x &lt;- xs]\n    in sudokuElements temp cds\n\n-- | head bes == inputBoardElements &amp;&amp; empty == inputBoardEmpty = \n--     [solvedBoardElements]\n-- | otherwise = error \"sudokuElements not implemented\"\n\nvalidVals :: [BoardElement] -&gt; Coords -&gt; [Int]\nvalidVals bes rc\n    | bes == tail solvedBoardElements &amp;&amp; rc==(8,6) = [1]\n    | bes \\\\ solvedBoardElements == [] = [1..9]\n    | otherwise = []\n\ntoElements :: Board -&gt; ([BoardElement],[Coords])\ntoElements b \n    | b==inputBoard = (inputBoardElements, inputBoardEmpty)    \n    | otherwise = error \"toElements not implemented\"\n\n\nfromElements :: [BoardElement] -&gt; Board\nfromElements bes \n    | sort bes == solvedBoardElements = solvedBoard\n    | otherwise = error \"fromElements not implemented\"\n</code></pre>\n"}, {"tags": ["haskell", "lazy-evaluation", "strictness"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486848947, "post_id": 42181348, "comment_id": 71525766, "body": "If the compiler decides to inline <code>id</code> to form <code>seq a (\\x-&gt;x)</code> then it can also see that <code>\\x -&gt; x</code> is in WHNF so <code>seq a (\\x-&gt;x)</code> could be &#39;optimized&#39; to just <code>a</code>. <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Conc.Sync.html#pseq\" rel=\"nofollow noreferrer\"><code>pseq</code></a> is actually implemented in terms of <code>seq</code> and <a href=\"https://www.stackage.org/haddock/lts-7.19/ghc-prim-0.5.0.0/src/GHC-Magic.html#lazy\" rel=\"nofollow noreferrer\"><code>lazy</code></a>, which is a &#39;deeply magical&#39; identity function which the compiler knows to never inline during strictness analysis."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486849151, "post_id": 42181348, "comment_id": 71525822, "body": "The magic you are looking for is really in <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-Exts.html#v:lazy\" rel=\"nofollow noreferrer\"><code>lazy</code></a>."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486849564, "post_id": 42181348, "comment_id": 71525932, "body": "@user2407038 Turning <code>seq a (\\x-&gt;x)</code> into <code>a</code> is a type error. Even if it inlines <code>id</code>, it would still have to return <code>\\x-&gt;x</code> (and force <code>a</code>). That&#39;s exactly what I want, isn&#39;t it?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1486850409, "post_id": 42181348, "comment_id": 71526138, "body": "@melpomene Sorry, I meant that <code>seq a (\\x-&gt;x) b</code> can become <code>seq a ((\\x-&gt;x) b)</code> - in general <code>seq a y o</code> could become <code>seq a (y o)</code> if <code>y</code> is in WHNF. Whether the compiler would ever perform such an optimization, I don&#39;t know, but it certainly <i>could</i>. I believe that in terms of &#39;raw operational semantics&#39; (i.e. pretending the compiler never changes your code at all) your function is correct - it just breaks down in the presence of optimizations. (indeed, <code>lazy</code> is denotationally equal to <code>id</code> - so your <code>xseq</code> is denotationally equal to <code>pseq</code>, and both to <code>seq</code>, just not operationally)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1486851701, "post_id": 42181348, "comment_id": 71526517, "body": "You seem to assume that <code>f x</code> must evaluate <code>f</code> first to WHNF, but this might not be the case. If the strictness analyzer proves <code>f</code> strict, I think the runtime could evaluate <code>x</code> first to WHNF without changing the semantics. I&#39;m unsure about whether this actually happens in the GHC optimizer."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1535363482, "post_id": 42181348, "comment_id": 91023537, "body": "I see that five people have downvoted this question so far. I&#39;d be interested to know why."}], "answers": [{"comments": [{"owner": {"reputation": 4416, "user_id": 2108477, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f30268b2a1d0a8a18012e602cd3cb783?s=128&d=identicon&r=PG", "display_name": "Ignat Insarov", "link": "https://stackoverflow.com/users/2108477/ignat-insarov"}, "edited": false, "score": 0, "creation_date": 1570901363, "post_id": 54356427, "comment_id": 103066461, "body": "This is a beautiful question and answer."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 2, "last_activity_date": 1548369599, "creation_date": 1548369599, "answer_id": 54356427, "question_id": 42181348, "link": "https://stackoverflow.com/questions/42181348/can-pseq-be-defined-in-terms-of-seq/54356427#54356427", "title": "Can pseq be defined in terms of seq?", "body": "<p>The answer seems to be \"no, at least not without additional magic\".</p>\n\n<p>The problem with</p>\n\n<pre><code>xseq a b = (seq a id) b\n</code></pre>\n\n<p>is that the compiler can see that the result of <code>seq a id</code> is <code>id</code>, which is strict everywhere. Function application is allowed to evaluate the argument first if the function is strict, because then doing so does not change the semantics of the expression. Therefore an optimizing compiler could start evaluating <code>b</code> first because it knows it will eventually need it.</p>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1598547443, "post_id": 63608651, "comment_id": 112501807, "body": "Any implementation whose <code>-O0</code> does not perform strictness analysis should let you define an inefficient version of <code>lazy</code> in its own module. <code>lazy :: a -&gt; a; lazy x = x {-# NOINLINE lazy #-}</code>. As long as the module doesn&#39;t reveal that <code>lazy</code> is actually strict in its argument, and doesn&#39;t produce an unfolding for it, you should be good. The GHC special is inlining it in Core Prep, right at the end of the core-to-core compilation pipeline."}], "tags": [], "owner": {"reputation": 243, "user_id": 13679816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b02acae66c6a347786eb93e8cbead85?s=128&d=identicon&r=PG", "display_name": "atravers", "link": "https://stackoverflow.com/users/13679816/atravers"}, "is_accepted": false, "score": 0, "last_activity_date": 1598498239, "creation_date": 1598498239, "answer_id": 63608651, "question_id": 42181348, "link": "https://stackoverflow.com/questions/42181348/can-pseq-be-defined-in-terms-of-seq/63608651#63608651", "title": "Can pseq be defined in terms of seq?", "body": "<blockquote>\n<p>Can <code>pseq</code> be defined in terms of <code>seq</code>?</p>\n</blockquote>\n<p>In GHC - yes.</p>\n<p>As noted by Alec, you'll also need the mirror-smoke <code>lazy</code>:</p>\n<pre><code> -- for GHC 8.6.5\nimport Prelude(seq)\nimport GHC.Base(lazy)\n\ninfixr 0 `pseq`\npseq :: a -&gt; b -&gt; b\npseq x y = x `seq` lazy y\n</code></pre>\n<p>the definition matching its counterpart in the GHC sources; the imports are\nvery different.</p>\n<p>For other Haskell implementations, this <em>may</em> work:</p>\n<pre><code>import Prelude(seq)\n\ninfixr 0 `pseq`\npseq :: a -&gt; b -&gt; b\npseq x y = x `seq` (case x of _ -&gt; y)\n</code></pre>\n<p><em>possibly</em> in conjunction with - at the very least - the equivalent of:</p>\n<pre><code> -- for GHC 8.6.5\n{-# NOINLINE pseq #-}\n</code></pre>\n<p>I'll let melpomene decide if that also qualifies as mirror-smoke...</p>\n"}], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 2, "accepted_answer_id": 54356427, "answer_count": 2, "score": 1, "last_activity_date": 1598498239, "creation_date": 1486847903, "question_id": 42181348, "link": "https://stackoverflow.com/questions/42181348/can-pseq-be-defined-in-terms-of-seq", "title": "Can pseq be defined in terms of seq?", "body": "<p>As far as I know, <code>seq a b</code> evaluates (forces) <code>a</code> and <code>b</code> before returning <code>b</code>. It does not guarantee that <code>a</code> is evaluated first.</p>\n\n<p><code>pseq a b</code> evaluates <code>a</code> first, then evaluates/returns <code>b</code>.</p>\n\n<p>Now consider the following:</p>\n\n<pre><code>xseq a b = (seq a id) b\n</code></pre>\n\n<p>Function application needs to evaluate the left operand first (to get a lambda form), and it can't blindly evaluate the right operand before entering the function because that would violate Haskell's non-strict semantics.</p>\n\n<p>Therefore <code>(seq a id) b</code> must evaluate <code>seq a id</code> first, which forces <code>a</code> and <code>id</code> (in some unspecified order (but evaluating <code>id</code> does nothing)), then returns <code>id b</code> (which is <code>b</code>); therefore <code>xseq a b</code> evaluates <code>a</code> before <code>b</code>.</p>\n\n<p>Is <code>xseq</code> a valid implementation of <code>pseq</code>? If not, what's wrong with the above argument (and is it possible to define <code>pseq</code> in terms of <code>seq</code> at all)?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486847550, "post_id": 42181129, "comment_id": 71525418, "body": "Yes, it has to keep all stdin in memory. I can&#39;t see how a fix would be possible: do you want your program to discard data and still have it available later? Maybe you are looking for something like <code>do x &lt;- getContents ; y &lt;- useMyDataSomehow x ; useMoreData y</code> ? Anyway your problem might be solved by the pipes/conduit libraries (at the cost of writing your program in the style required by those libraries)"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1486847677, "post_id": 42181129, "comment_id": 71525454, "body": "You have it exactly right <code>do {cs &lt;- getContents; putStrLn cs}</code> uses basically no memory,  <code>do {cs &lt;- getContents; putStrLn cs; putStrLn cs}</code> accumulates all of <code>cs</code> the first time around. How you &#39;get around&#39; this will depend on what you are doing. Do you literally want to <code>putStrLn</code> twice? Or e.g record length and print, or what?"}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1486848288, "post_id": 42181129, "comment_id": 71525593, "body": "Roughly speaking, I am looking to use Haskell to implement UNIX <code>tee</code> command or a variant of it."}], "answers": [{"comments": [{"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1486855145, "post_id": 42181555, "comment_id": 71527467, "body": "Thanks. I can see how your example works. But I probably need something more complex than the synchronized handlers here. For example, if I need to <code>reverse</code> or <code>sort</code> the stream in the second round? I guess somewhere down the line, it will break."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "reply_to_user": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1486855667, "post_id": 42181555, "comment_id": 71527619, "body": "@tinlyx <code>reverse</code> and <code>sort</code> will force all the input to be accumulated, they are text-book non-streaming operations. Things like <code>length</code> or word count etc. will work."}, {"owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "edited": false, "score": 0, "creation_date": 1486856143, "post_id": 42181555, "comment_id": 71527721, "body": "Thanks for the clarification. Do you think if I use e.g. <code>reverse</code> on a big stream, I&#39;ll get the same memory issue anyways, regardless of whether it&#39;s used on a second round?"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1486856304, "post_id": 42181555, "comment_id": 71527757, "body": "Yes. Just <code>do {cs &lt;- getContents; putStrLn (reverse cs)}</code> and anything like it will have to accumulate the whole input, even without a second use. Similarly <code>sort</code> can&#39;t proceed until it knows it has the smallest element, which might be the last."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 2, "last_activity_date": 1486849224, "creation_date": 1486849224, "answer_id": 42181555, "question_id": 42181129, "link": "https://stackoverflow.com/questions/42181129/how-to-reuse-efficiently-input-from-stdin-in-haskell/42181555#42181555", "title": "How to reuse efficiently input from stdin in Haskell", "body": "<p>Yes, your understanding is correct: If you reuse <code>x</code>, ghc has to keep it all in memory.</p>\n\n<p>I think a possible fix is to consume it lazily (once).</p>\n\n<p>Let's say you want to output <code>x</code> to several output handles <code>hdls :: [Handle]</code>. The naive approach is:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    x &lt;- getContents\n    forM_ hdls $ \\hdl -&gt; do\n        hPutStr hdl x\n</code></pre>\n\n<p>This will read <code>stdin</code> into <code>x</code> as the first <code>hPutStr</code> traverses the string (at least for unbuffered handles, <code>hPutStr</code> is simply a loop that calls <code>hPutChar</code> for each character in the string). From then on it'll be kept in memory for all following <code>hdl</code>s.</p>\n\n<p>Alternatively:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    x &lt;- getContents\n    forM_ x $ \\c -&gt; do\n        forM_ hdls $ \\hdl -&gt; do\n            hPutChar hdl c\n</code></pre>\n\n<p>Here we've transposed the loops: Instead of iterating over the handles (and for each handle iterating over the input characters), we iterate over the input characters, and for each character, we print it to each handle.</p>\n\n<p>I haven't tested it, but this form should guarantee that we don't need a lot of memory because each input character <code>c</code> is used once and then discarded.</p>\n"}], "owner": {"reputation": 18780, "user_id": 683218, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/7Vy7c.png?s=128&g=1", "display_name": "tinlyx", "link": "https://stackoverflow.com/users/683218/tinlyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 42181555, "answer_count": 1, "score": 1, "last_activity_date": 1486854847, "creation_date": 1486846550, "last_edit_date": 1495542822, "question_id": 42181129, "link": "https://stackoverflow.com/questions/42181129/how-to-reuse-efficiently-input-from-stdin-in-haskell", "title": "How to reuse efficiently input from stdin in Haskell", "body": "<p>I understand that I should not try to re-read from <code>stdin</code> because of errors about <a href=\"https://stackoverflow.com/q/18160807/683218\">Haskell IO - handle closed</a>\nFor example, in below:</p>\n\n<pre><code>main = do\n  x &lt;- getContents\n  putStrLn $ map id x\n  x &lt;- getContents     --problem line\n  putStrLn x\n</code></pre>\n\n<p>the second call  <code>x &lt;- getContents</code> will cause the error:</p>\n\n<pre><code>test: &lt;stdin&gt;: hGetContents: illegal operation (handle is closed)\n</code></pre>\n\n<p>Of course, I can omit the second line to read from <code>getContents</code>. </p>\n\n<pre><code>main = do\n  x &lt;- getContents\n  putStrLn $ map id x\n  putStrLn x\n</code></pre>\n\n<p>But will this become a performance/memory issue? Will GHC have to keep all of the contents read from <code>stdin</code> in the main memory?</p>\n\n<p>I imagine the first time around when <code>x</code> is consumed, GHC can throw away the portions of <code>x</code> that are already processed. So theoretically, GHC could only use a small amount of constant memory for the processing. But since we are going to use <code>x</code> again (and again), it seems that GHC cannot throw away anything. (Nor can it read again from <code>stdin</code>).</p>\n\n<p>Is my understanding about the memory implications here correct? And if so, is there a fix?</p>\n"}, {"tags": ["parsing", "haskell", "parsec"], "comments": [{"owner": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1486846559, "post_id": 42180282, "comment_id": 71525107, "body": "How about inserting <code>spaces</code> after <code>reserved &quot;prefix&quot;</code>?"}, {"owner": {"reputation": 123, "user_id": 5931939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/681e5cb3394a3dccd07b910c7162e2b0?s=128&d=identicon&r=PG&f=1", "display_name": "hexhex", "link": "https://stackoverflow.com/users/5931939/hexhex"}, "reply_to_user": {"reputation": 1106, "user_id": 4197293, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd3542179c9735316f934724992b7ce?s=128&d=identicon&r=PG", "display_name": "jeiea", "link": "https://stackoverflow.com/users/4197293/jeiea"}, "edited": false, "score": 0, "creation_date": 1486847935, "post_id": 42180282, "comment_id": 71525513, "body": "We never come this far, the parser only looks in the first do. If we change the order of the rules, the statement is correctly parsed. This only works in this simple case though, if we have more rules like the first one, the trick does not work anymore."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486849649, "post_id": 42180282, "comment_id": 71525958, "body": "It doesn&#39;t work because <code>many alphaNum</code> consumes &quot;prefix&quot; but then fails - once a parser has failed after consuming input, it will not try another alternative (given by <code>&lt;|&gt;</code> or <code>choice</code>, etc). You need a <code>try</code> on the first parser. (I think you have misunderstood parsec - you are expecting automatic backtracking, but parsec simply doesn&#39;t do this. There are other parser libraries which do, I believe)"}, {"owner": {"reputation": 123, "user_id": 5931939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/681e5cb3394a3dccd07b910c7162e2b0?s=128&d=identicon&r=PG&f=1", "display_name": "hexhex", "link": "https://stackoverflow.com/users/5931939/hexhex"}, "edited": false, "score": 0, "creation_date": 1486850065, "post_id": 42180282, "comment_id": 71526061, "body": "Thanks a lot, that&#39;s the trick!"}], "answers": [{"tags": [], "owner": {"reputation": 123, "user_id": 5931939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/681e5cb3394a3dccd07b910c7162e2b0?s=128&d=identicon&r=PG&f=1", "display_name": "hexhex", "link": "https://stackoverflow.com/users/5931939/hexhex"}, "is_accepted": true, "score": 1, "last_activity_date": 1486850186, "creation_date": 1486850186, "answer_id": 42181688, "question_id": 42180282, "link": "https://stackoverflow.com/questions/42180282/parsing-operation-without-prefix-in-parsec/42181688#42181688", "title": "Parsing operation without prefix in Parsec", "body": "<p>As pointed out by user2407038 in the comments, the problem is that <code>x &lt;- many alphaNum</code> consumes <code>prefix</code> and thus, the second rule cannot be applied. The solution is to put <code>try</code> in front of the block, this rewinds consumed parts of the stream.</p>\n"}], "owner": {"reputation": 123, "user_id": 5931939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/681e5cb3394a3dccd07b910c7162e2b0?s=128&d=identicon&r=PG&f=1", "display_name": "hexhex", "link": "https://stackoverflow.com/users/5931939/hexhex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 42181688, "answer_count": 1, "score": 2, "last_activity_date": 1486872062, "creation_date": 1486841424, "last_edit_date": 1486872062, "question_id": 42180282, "link": "https://stackoverflow.com/questions/42180282/parsing-operation-without-prefix-in-parsec", "title": "Parsing operation without prefix in Parsec", "body": "<p>I'm trying to parse a simple language with Parsec. There can either be assignments \"x=y\" or prefixed stuff like \"prefix test\". However, the parsing rule for assignments is greedy and does not fail if there is no \"=\". For example,</p>\n\n<pre><code>parse tp \"\" \"prefix foo\"\n</code></pre>\n\n<p>leads to a parsing error. The corresponding code:</p>\n\n<pre><code>module Test where\nimport Text.ParserCombinators.Parsec\nimport Text.ParserCombinators.Parsec.Language\nimport Text.ParserCombinators.Parsec.Expr\nimport qualified Text.ParserCombinators.Parsec.Token as P\n\nlexer = haskell\nreserved   = P.reserved lexer\nreservedOp = P.reservedOp lexer\n\ndata Term = Term String\n  deriving (Show)\n\nterm :: Parser Term\nterm = do { x &lt;- many alphaNum\n          ; reservedOp \"=\"\n          ; y &lt;- many alphaNum\n          ; return (Term (x++y))\n          }\n   &lt;|&gt; do { reserved \"prefix\"\n          ; x &lt;- many alphaNum\n          ; return (Term x)\n          }\n\ntp = do { e&lt;-term; return e }\n</code></pre>\n\n<p>What am I missing? Is my approach even possible, or did I misunderstand Parsec?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 0, "last_activity_date": 1486840719, "creation_date": 1486840719, "answer_id": 42180168, "question_id": 42180045, "link": "https://stackoverflow.com/questions/42180045/what-is-haskells-arrow-associativity/42180168#42180168", "title": "What is haskell&#39;s arrow associativity?", "body": "<p>Your intuition is correct: <code>(Int -&gt; Int) -&gt; (Int -&gt; Int)</code> is indeed <code>Endo (Endo Int)</code>.</p>\n\n<p>Just recall that <code>-&gt;</code> associates on the right, i.e.</p>\n\n<pre><code>a -&gt; b -&gt; c     means    a -&gt; (b -&gt; c)\n</code></pre>\n\n<p>Given that, you should now be able to solve the exercise.</p>\n"}, {"tags": [], "owner": {"reputation": 14111, "user_id": 1126943, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yeuHw.png?s=128&g=1", "display_name": "zch", "link": "https://stackoverflow.com/users/1126943/zch"}, "is_accepted": true, "score": 4, "last_activity_date": 1486840737, "creation_date": 1486840737, "answer_id": 42180170, "question_id": 42180045, "link": "https://stackoverflow.com/questions/42180045/what-is-haskells-arrow-associativity/42180170#42180170", "title": "What is haskell&#39;s arrow associativity?", "body": "<p>It is right associative in Haskell, so following are equivalent:</p>\n\n<pre><code>a -&gt; b -&gt; c\na -&gt; (b -&gt; c)\n</code></pre>\n\n<p>Function that takes arguments a and b is equivalent to function that given argument a returns function that takes argument b.</p>\n\n<p>It is not left associative.</p>\n\n<p>So the answer is first two.</p>\n"}], "owner": {"reputation": 681, "user_id": 6692318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef3d4764458022d20b0d15c2c7fd3c96?s=128&d=identicon&r=PG&f=1", "display_name": "Atin", "link": "https://stackoverflow.com/users/6692318/atin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 796, "favorite_count": 0, "accepted_answer_id": 42180170, "answer_count": 2, "score": 0, "last_activity_date": 1486840737, "creation_date": 1486840016, "question_id": 42180045, "link": "https://stackoverflow.com/questions/42180045/what-is-haskells-arrow-associativity", "title": "What is haskell&#39;s arrow associativity?", "body": "<p>I am currently learning haskell and struggling with the following test :\nSuppose we have such a type : </p>\n\n<pre><code>type Endo a = a -&gt; a\n</code></pre>\n\n<p>I have to choose all types that are equivalent to  <code>Endo (Endo Int)</code></p>\n\n<pre><code>(Int -&gt; Int) -&gt; (Int -&gt; Int)\n(Int -&gt; Int) -&gt; Int -&gt; Int\nInt\nInt -&gt; Int\nInt -&gt; Int -&gt; Int -&gt; Int\n(Int -&gt; Int) -&gt; Int\nInt -&gt; Int -&gt; (Int -&gt; Int)\nInt -&gt; (Int -&gt; Int)\nInt -&gt; Int -&gt; Int\n</code></pre>\n\n<p>Since the type of <code>Endo Int</code> is <code>Int -&gt; Int</code> I understand that type I need  has 4 Ints such as <code>(Int -&gt; Int) -&gt; (Int -&gt; Int)</code>.\nBut I do not really understand which parenthesis are unnecessary </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 2, "creation_date": 1486845475, "post_id": 42179783, "comment_id": 71524797, "body": "You could use Template Haskell to introduce syntax to expand repeated application."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 1, "creation_date": 1486848577, "post_id": 42179783, "comment_id": 71525673, "body": "@JoachimBreitner just finished doing that. Had to learn Template Haskell. Still testing my answer, but it seems a lot faster (similar to the other question)."}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": false, "score": 4, "last_activity_date": 1486838919, "creation_date": 1486838919, "answer_id": 42179848, "question_id": 42179783, "link": "https://stackoverflow.com/questions/42179783/is-there-any-way-to-inline-a-recursive-function/42179848#42179848", "title": "Is there any way to inline a recursive function?", "body": "<p>No.</p>\n\n<p>You could write</p>\n\n<pre><code>{-# INLINE nTimes #-}\nnTimes :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a\nnTimes n f x = go n\n  where go 0 = x\n        go n = f (go (n-1))\n</code></pre>\n\n<p>and GHC would inline <code>nTimes</code>, and likely specialize the recursive <code>go</code> to your particular arguments <code>incAll</code> and <code>array</code>, but it would not unroll the loop.</p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1486894960, "post_id": 42181495, "comment_id": 71535015, "body": "Note: the solution is <a href=\"https://codereview.stackexchange.com/questions/155144/execute-a-function-n-times-where-n-is-known-at-compile-time\">up for code review</a>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1488723761, "post_id": 42181495, "comment_id": 72348330, "body": "Hey just coming back to let you know this is a brilliant answer in most aspects, thank you."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 27, "last_activity_date": 1487000765, "last_edit_date": 1487000765, "creation_date": 1486848870, "answer_id": 42181495, "question_id": 42179783, "link": "https://stackoverflow.com/questions/42179783/is-there-any-way-to-inline-a-recursive-function/42181495#42181495", "title": "Is there any way to inline a recursive function?", "body": "<p>No, but you can use better functions. I'm not talking about <code>V.map (+64)</code>, which would make things certainly a lot faster, but about <code>nTimes</code>. We have three candidates that already do what <code>nTimes</code> does:</p>\n\n<pre><code>{-# INLINE nTimesFoldr #-}\nnTimesFoldr :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a    \nnTimesFoldr n f x = foldr (.) id (replicate n f) $ x\n\n{-# INLINE nTimesIterate #-}\nnTimesIterate :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a    \nnTimesIterate n f x = iterate f x !! n\n\n{-# INLINE nTimesTail #-}\nnTimesTail :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a    \nnTimesTail n f = go n\n  where\n    {-# INLINE go #-}\n    go n x | n &lt;= 0 = x\n    go n x          = go (n - 1) (f x)\n</code></pre>\n\n<p>All versions take around 8 seconds, compared to the 40 seconds your versions take. Joachim's version also takes 8 seconds, by the way. Note that the <code>iterate</code> version takes more memory on my system. While there is an <a href=\"https://github.com/thoughtpolice/unroll-ghc-plugin\">unroll plugin</a> for GHC, it hasn't been updated in the last five years (it uses custom ANNotations).</p>\n\n<h1>No unroll at all?</h1>\n\n<p>However, before we despair, how well does GHC actually try to inline everything? Let's use <code>nTimesTail</code> and <code>nTimes 1</code>:</p>\n\n<pre><code>module Main where\nimport qualified Data.Vector.Unboxed as V\n\n{-# INLINE incAll #-}\nincAll :: V.Vector Int -&gt; V.Vector Int\nincAll = V.map (+ 1)\n\n{-# INLINE nTimes #-}\nnTimes :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a    \nnTimes n f = go n\n  where\n    {-# INLINE go #-}\n    go n x | n &lt;= 0 = x\n    go n x          = go (n - 1) (f x)\n\nmain :: IO ()\nmain = do\n  let size = 100000000 :: Int\n  let array = V.replicate size 0 :: V.Vector Int\n  print $ V.sum (nTimes 1 incAll array)\n</code></pre>\n\n\n\n<pre><code>$ stack ghc --package vector -- -O2 -ddump-simpl -dsuppress-all SO.hs\n</code></pre>\n\n\n\n<pre><code>main2 =\n  case (runSTRep main3) `cast` ...\n  of _ { Vector ww1_s9vw ww2_s9vx ww3_s9vy -&gt;\n  case $wgo 1 ww1_s9vw ww2_s9vx ww3_s9vy\n  of _ { (# ww5_s9w3, ww6_s9w4, ww7_s9w5 #) -&gt;\n</code></pre>\n\n<p>We can stop right there. <code>$wgo</code> is the <code>go</code> defined above. Even with <code>1</code> GHC does not unroll the loop. It's disturbing since <code>1</code> is a constant.</p>\n\n<h1>Templates to the rescue</h1>\n\n<p>But alas, it's not all for naught. If C++ programmers are able to do the following for compile time constants, so should we, right?</p>\n\n<pre><code>template &lt;int N&gt;\nstruct Call{\n    template &lt;class F, class T&gt;\n    static T call(F f, T &amp;&amp; t){\n        return f(Call&lt;N-1&gt;::call(f,std::forward&lt;T&gt;(t)));\n    }\n};\ntemplate &lt;&gt;\nstruct Call&lt;0&gt;{\n    template &lt;class F, class T&gt;\n    static T call(F f, T &amp;&amp; t){\n        return t;\n    }  \n};\n</code></pre>\n\n<p>And sure enough, we can, with <a href=\"https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#template-haskell\">TemplateHaskell</a><sup>*</sup>:</p>\n\n<pre><code>-- Times.sh\n{-# LANGUAGE TemplateHaskell #-}\nmodule Times where\n\nimport Control.Monad (when)\nimport Language.Haskell.TH\n\nnTimesTH :: Int -&gt; Q Exp\nnTimesTH n = do\n  f &lt;- newName \"f\"\n  x &lt;- newName \"x\"\n\n  when (n &lt;= 0) (reportWarning \"nTimesTH: argument non-positive\")\n\n  let go k | k &lt;= 0 = VarE x\n      go k          = AppE (VarE f) (go (k - 1))\n  return $ LamE [VarP f,VarP x] (go n)\n</code></pre>\n\n<p>What does <code>nTimesTH</code> do? It creates a new function where the first name <code>f</code> is going to be applied to the second name <code>x</code> for a total of <code>n</code> times. <code>n</code> now needs to be a compile-time constant, which suits us, since loop-unrolling is only possible with compile-time constants:</p>\n\n<pre><code>$(nTimesTH 0) = \\f x -&gt; x\n$(nTimesTH 1) = \\f x -&gt; f x\n$(nTimesTH 2) = \\f x -&gt; f (f x)\n$(nTimesTH 3) = \\f x -&gt; f (f (f x))\n...\n</code></pre>\n\n<p>Does it work? And is it fast? How fast compared to <code>nTimes</code>? Let's try another <code>main</code> for that:</p>\n\n<pre><code>-- SO.hs\n{-# LANGUAGE TemplateHaskell #-}\nmodule Main where\nimport Times\nimport qualified Data.Vector.Unboxed as V\n\n{-# INLINE incAll #-}\nincAll :: V.Vector Int -&gt; V.Vector Int\nincAll = V.map (+ 1)\n\n{-# INLINE nTimes #-}\nnTimes :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a    \nnTimes n f = go n\n  where\n    {-# INLINE go #-}\n    go n x | n &lt;= 0 = x\n    go n x          = go (n - 1) (f x)\n\nmain :: IO ()\nmain = do\n  let size = 100000000 :: Int\n  let array = V.replicate size 0 :: V.Vector Int\n  let vTH   = V.sum ($(nTimesTH 64) incAll array)\n  let vNorm = V.sum (nTimes 64 incAll array)\n  print $ vTH == vNorm\n</code></pre>\n\n<pre class=\"lang-sh prettyprint-override\"><code>stack ghc --package vector -- -O2 SO.hs &amp;&amp; SO.exe +RTS -t\n</code></pre>\n\n\n\n<pre><code>True\n&lt;&lt;ghc: 52000056768 bytes, 66 GCs, 400034700/800026736 avg/max bytes residency (2 samples), 1527M in use, 0.000 INIT (0.000 elapsed), 8.875 MUT (9.119 elapsed), 0.000 GC (0.094 elapsed) :ghc&gt;&gt;\n</code></pre>\n\n<p>It yields the correct result. How fast is it? Let's use another <code>main</code> again:</p>\n\n<pre><code>main :: IO ()\nmain = do\n  let size = 100000000 :: Int\n  let array = V.replicate size 0 :: V.Vector Int\n  print $ V.sum ($(nTimesTH 64) incAll array)\n</code></pre>\n\n\n\n<pre><code>     800,048,112 bytes allocated in the heap                                         \n           4,352 bytes copied during GC                                              \n          42,664 bytes maximum residency (1 sample(s))                               \n          18,776 bytes maximum slop                                                  \n             764 MB total memory in use (0 MB lost due to fragmentation)             \n\n                                     Tot time (elapsed)  Avg pause  Max pause        \n  Gen  0         1 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s        \n  Gen  1         1 colls,     0 par    0.000s   0.049s     0.0488s    0.0488s        \n\n  INIT    time    0.000s  (  0.000s elapsed)                                         \n  MUT     time    0.172s  (  0.221s elapsed)                                         \n  GC      time    0.000s  (  0.049s elapsed)                                         \n  EXIT    time    0.000s  (  0.049s elapsed)                                         \n  Total   time    0.188s  (  0.319s elapsed)                                         \n\n  %GC     time       0.0%  (15.3% elapsed)                                           \n\n  Alloc rate    4,654,825,378 bytes per MUT second                                   \n\n  Productivity 100.0% of total user, 58.7% of total elapsed        \n</code></pre>\n\n<p>Well, compare that to the 8s. So for a <strong>TL;DR</strong>: if you have compile-time constants, and you want to create and/or modify your code based on that constants, consider Template Haskell.</p>\n\n<p><sub>* Please note that this is my first Template Haskell code I've ever written. Use with care. Don't use too large <code>n</code>, or you might end up with a messed up function.</sub></p>\n"}, {"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1486998840, "post_id": 42206868, "comment_id": 71575931, "body": "Nice, although if you want to use <code>nTimes 64</code>, the term <code>Proxy :: Proxy (S(S(S(S\u2026(S Z)\u2026)</code> will be rather\u2026 interesting to write. I&#39;d use this with type level arithmetic, though. Someting like <code>Proxy (Ten :*: Six :+: Four)</code>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1488723991, "post_id": 42206868, "comment_id": 72348419, "body": "I still can&#39;t get those typeclass programming shenanigans, anyone who does that is clearly a wizard to me."}], "tags": [], "owner": {"reputation": 756, "user_id": 3710751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46c92104b92f86f29098c11fa44b6cdd?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew Pickering", "link": "https://stackoverflow.com/users/3710751/matthew-pickering"}, "is_accepted": false, "score": 16, "last_activity_date": 1486997373, "creation_date": 1486997373, "answer_id": 42206868, "question_id": 42179783, "link": "https://stackoverflow.com/questions/42179783/is-there-any-way-to-inline-a-recursive-function/42206868#42206868", "title": "Is there any way to inline a recursive function?", "body": "<p>There is a little known trick which Andres has told me before where you can actually get GHC to inline recursive functions by using type classes.</p>\n\n<p>The idea is that instead of writing a function normally where you perform structural recursion on a value. You define your function using type classes and perform structural recursion on a type argument. In this example, type-level natural numbers.</p>\n\n<p>GHC will happily inline each recursive call and produce efficient code as each recursive call is at a different type. </p>\n\n<p>I didn't benchmark this or look at the core but it is noticeably faster.</p>\n\n<pre><code>{-# LANGUAGE DataKinds #-}\n{-# LANGUAGE KindSignatures #-}\n{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE ScopedTypeVariables #-}\nmodule Main where\n\nimport qualified Data.Vector.Unboxed as V\n\ndata Proxy a = Proxy\n\n{-# INLINE incAll #-}\nincAll :: V.Vector Int -&gt; V.Vector Int\nincAll = V.map (+ 1)\n\noldNTimes :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a\noldNTimes 0 f x = x\noldNTimes n f x = f (oldNTimes (n-1) f x)\n\n-- New definition\n\ndata N = Z | S N\n\nclass Unroll (n :: N) where\n    nTimes :: Proxy n -&gt; (a -&gt; a) -&gt; a -&gt; a\n\ninstance Unroll Z where\n    nTimes _ f x = x\n\ninstance Unroll n =&gt; Unroll (S n) where\n    nTimes p f x =\n        let Proxy :: Proxy (S n) = p\n        in f (nTimes (Proxy :: Proxy n) f x)\n\nmain :: IO ()\nmain = do\n  let size = 100000000 :: Int\n  let array = V.replicate size 0 :: V.Vector Int\n  print $ V.sum (nTimes (Proxy :: Proxy (S (S (S (S (S (S (S (S (S (S (S Z)))))))))))) incAll array)\n  print $ V.sum (oldNTimes 11 incAll array)\n</code></pre>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3827, "favorite_count": 6, "accepted_answer_id": 42181495, "answer_count": 3, "score": 18, "last_activity_date": 1487000765, "creation_date": 1486838639, "last_edit_date": 1495540436, "question_id": 42179783, "link": "https://stackoverflow.com/questions/42179783/is-there-any-way-to-inline-a-recursive-function", "title": "Is there any way to inline a recursive function?", "body": "<p>This is a follow-up to my <a href=\"https://stackoverflow.com/questions/42178164/why-this-program-seems-not-to-be-fusing-properly?noredirect=1#comment71521653_42178164\">previous question</a> on which I asked why stream fusion wasn't kicking in a certain program. Turns out the problem was that certain functions weren't inlined, and an <code>INLINE</code> flag improved the performance by about <code>17x</code> (which showcases the importance of inlining!). </p>\n\n<p>Now, notice that, on the original question, I hardcoded <code>64</code> calls of <code>incAll</code> at once. Now, suppose that, instead, I create an <code>nTimes</code> function, which calls a function repeatedly:</p>\n\n<pre><code>module Main where\n\nimport qualified Data.Vector.Unboxed as V\n\n{-# INLINE incAll #-}\nincAll :: V.Vector Int -&gt; V.Vector Int\nincAll = V.map (+ 1)\n\n{-# INLINE nTimes #-}\nnTimes :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a\nnTimes 0\u00a0f x = x\nnTimes n f x = f (nTimes (n-1) f x)\n\nmain :: IO ()\nmain = do\n  let size = 100000000 :: Int\n  let array = V.replicate size 0 :: V.Vector Int\n  print $ V.sum (nTimes 64 incAll array)\n</code></pre>\n\n<p>In this case, just adding an <code>INLINE</code> pragma to <code>nTimes</code> won't help, because AFAIK GHC doesn't inline recursive functions. Is there any trick to force GHC to expand <code>nTimes</code> at compile time and, thus, recover expected performance?</p>\n"}, {"tags": ["haskell", "serialization", "types"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486842195, "post_id": 42179682, "comment_id": 71523749, "body": "This is a pretty neat idea, but I don&#39;t think I&#39;ve fully understood the motivation. Why not just have functions that translate from one version to the next (<i>not</i> in the complex <code>Versioned</code> format)? Otherwise, I recommend you look at how <code>Generic</code> is defined. You might even want to use it instead since you get conversion to and from datatypes for free with <code>DeriveGeneric</code>."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486855728, "post_id": 42179682, "comment_id": 71527634, "body": "The motivation for having an explicit &quot;generic&quot; form to manipulate is to remove a lot of boilerplate. Say I have a datatype  <code>T</code> which is a record with 10 fields: Each time I change one of those fields, I need to either 1/ store an old version of <code>T</code> which is 90% identical to the previous version, or 2/ write a deserialisation function that is 90% identical to the previous, save for one of the fields. Hence the idea of using &quot;patches&quot; to represent the various versions..."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486856084, "post_id": 42179682, "comment_id": 71527709, "body": "What you are describing sounds like a use case for storing your data in JSON and then having a more flexible deserializer. Having mucked around with <code>Generic</code>, I can tell you it is at once brilliant and very tough to get to work properly - hardly something you would want to have to go through every time you tweak your model."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486856873, "post_id": 42179682, "comment_id": 71527872, "body": "@insitu If datatype <code>T</code> changes, could you not simply change the code for that type? This amounts to changing code for a single field, if a single field has changed. If you are keeping the old function <code>f :: T -&gt; A</code> when <code>T</code> changes to <code>T&#39;</code> you need to keep the <code>T</code> type as well (but this contradicts your third point) for <code>f</code> to remain well-typed after the change. <code>f</code> must have a type like <code>GenericRep T -&gt; A</code> to continue working if you change <code>T</code>; but the type must not actually mention <code>T</code>, only the generic representation of <code>T</code>. Depending on your use case, this may be simple or impossible."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486891097, "post_id": 42179682, "comment_id": 71534029, "body": "@alec I used to use JSON for storing data, which has its advantages (legibility in plain text) and disadvantages (very redundant information). I agree it is easier to work with than <code>Generic</code> or byte-level data, but I think what I am looking for is somehow independent of the underlying representation."}, {"owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486891289, "post_id": 42179682, "comment_id": 71534075, "body": "@user2407038 actually no, because if <code>T</code> changes, I still have to take care of old versions of <code>T</code> which have been stored before I introduce the change. The upside is that they are stored in a serialized form, so I can tweak the deserialization process to get a (new) <code>T</code> from an old version. safecopy works by keep old definitions of <code>T</code> around, which obviously works well and allows defining functions like <code>migrate : T@v1 -&gt; T@v2</code> very easily, but imagine 1 year down the road, if I have to maintain 20 versions of T..."}], "owner": {"reputation": 3794, "user_id": 137871, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/48469162d45686615c6bf0eb4304bf26?s=128&d=identicon&r=PG", "display_name": "insitu", "link": "https://stackoverflow.com/users/137871/insitu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 2, "answer_count": 0, "score": 5, "last_activity_date": 1487019525, "creation_date": 1486838110, "last_edit_date": 1487019525, "question_id": 42179682, "link": "https://stackoverflow.com/questions/42179682/how-to-handle-data-structure-migration-in-a-compositional-way-in-haskell", "title": "How to handle data structure migration in a compositional way in Haskell?", "body": "<p>I am trying to implement (de)serialization of data structures in Haskell in a way that:</p>\n\n<ol>\n<li>Takes care of evolving schema of the data structure,</li>\n<li>Allows safe reading of past versions if provided some \"patching\" code exists,</li>\n<li>Does not need to keep old versions of data type definition around (as is the case with <a href=\"https://github.com/acid-state/safecopy/\" rel=\"nofollow noreferrer\">safecopy</a></li>\n</ol>\n\n<p>I have implemented this mechanism in the past in a way that I find unsatisfying: There is much repetition in the code as it needs to traverse whole structure even if only a leaf changes, and the code to handle various versions is not composable. </p>\n\n<p>What I am looking for is something that would work like a stream of patches in a VCS: At each version change, I need only to write the code to handle the specific change (e.g. some field is transformed from <code>Text</code> to <code>Int</code>, there is a new field, some field is deleted...) and given some serialized chunk of bytes at a known version, the <code>load</code> function applies all patches to retrieve a valid data structure.</p>\n\n<p>I have tried to write some code along those lines but cannot get something that's composable in the way I am looking for (and I did not even tackled the issue of sum types...). Here is my attempt:</p>\n\n<pre><code>data Versioned (v :: Nat) a where\n  (:$:) ::             (a -&gt; b) -&gt; Versioned v a -&gt; Versioned v b\n  (:*:) :: Versioned v (a -&gt; b) -&gt; Versioned v a -&gt; Versioned v b\n  Atom  :: Get a                                 -&gt; Versioned v a\n  Cast  :: Versioned v' a                        -&gt; Versioned v a\n</code></pre>\n\n<p>The idea was to reify an applicative structure in such a way it becomes possible to apply minimal changes. </p>\n\n<p>This seems only doable using some form of <code>Generic</code> deserialization mechanism: Deserialize the bytes to a generic form then apply a chain of transformator to reach a shape that satisfies current.</p>\n\n<p>Any hint towards a solution would be most helpful.</p>\n\n<p><strong>2017-02-13</strong></p>\n\n<p>My problem can be split in two sub-problems:</p>\n\n<ol>\n<li>How to ensure statically there exist deserialization functions for each version, up to some (statically) known version?</li>\n<li>How to handle migration of data structure in a safe and minimally invasive way?</li>\n</ol>\n\n<p>Problem 1. yields the following (non compiling code):</p>\n\n<pre><code>  -- | A class instantiating a serializer/deserializer for some version\n  class Versionable (v :: Nat) a where\n    reader :: Proxy v -&gt; Get a\n    writer :: Proxy v -&gt; a -&gt; Put\n\n  -- | Current version is a \"global\" constraint\n  type family CurrentVersion :: Nat\n\n  class VersionUpTo (v :: Nat) a\n\n  instance (Versionable 1 a) =&gt; VersionUpTo 1 a\n  instance (Versionable v  a, VersionUpTo (v - 1) a) =&gt; VersionUpTo v a\n\n  load :: (VersionUpTo CurrentVersion a) =&gt; ByteString -&gt; Either String [a]\n  load = runGet loadGetter\n    where\n      loadGetter = sequence $ repeat $ do\n        v &lt;- getInt32be\n        case v of\n          1 -&gt; reader (Proxy :: Proxy 1)\n          2 -&gt; reader (Proxy :: Proxy 2)\n          3 -&gt; reader (Proxy :: Proxy 3)\n</code></pre>\n\n<p>The problem is, of course, the value of <code>v</code> to dispatch on depends on <code>CurrentVersion a</code>, which raises the following issue:</p>\n\n<ol>\n<li>How to write a generic <code>load</code> function that will read the version from underlying byte stream and dispatch to the correct reader function, without resorting to explicitly enumerate all cases?</li>\n</ol>\n\n<p>Even if <code>CurrentVersion</code> is not statically at call site of <code>load</code>, it is not known at definition site hence it is not possible to enumerate all valid cases. It seems the only option would be to somehow generate the cases using TH...</p>\n\n<p>Problem 2. is orthogonal to 1. Here the problem is that a data structure typed <code>T</code> evolves over time but we need to take care of old representations: We should be able to deserialize any version <code>v</code> of <code>T</code> up to the <code>CurrentVersion</code>. This is easily done by defining a <code>Versionable n T</code> for each target version, but this introduces a lot of redundancy given the changes between versions <code>n</code> and <code>n+1</code> are usually limited to one part of the structure. </p>\n\n<p>I think that the metaphor of a stream of patches does not work because it actually goes backward: The starting point is the current data structure and we need to adapt the past representations to the current version. Here are 3 versions of the same object:</p>\n\n<pre><code> instance Versionable 1 Obj3 where\n   reader _ = doGet $ Obj3 :$: (fromInt :$: getint) :*: (fromText :$: Atom get)\n\n instance Versionable 2 Obj3 where\n   reader _ = doGet $ Obj3 :$: Atom get :*: (fromText :$: Atom get)\n\n instance Versionable 3 Obj3 where\n    reader _          = doGet $ Obj3 :$: Atom get :*: getf2 F2\n    writer _ Obj3{..} = put f31 &gt;&gt; put f32\n</code></pre>\n\n<p>There is some regularity as we see each past version is an adaptation of the current version.</p>\n\n<p>Hence the idea of representing <code>reader</code> as a reified <code>Applicative</code> (or maybe <code>Monad</code>ic) functor to which can be applied surgical updates to cope with older versions. But then I am stuck with how to select some node deep in the tree of current deserialisers to apply some change in a typesafe way...</p>\n\n<p><strong>2017-02-13</strong></p>\n\n<p>Point 2. above seems to lead to nothing but convoluted code, involving a lot of type-level wizardry for a minor benefit. Consider the aforementioned 3 versions of <code>Obj3</code>, ideally I would like to find a way to write:</p>\n\n<pre><code> geto3 = Obj3 :$: Atom get :*: getf2 F2\n\n instance Versionable 2 Obj3 where\n   reader _ = doGet $ _replaceAt (0,1) (fromText :$: Atom get) get03\n\n instance Versionable 3 Obj3 where\n    reader _          = doGet $ get03\n    writer _ Obj3{..} = put f31 &gt;&gt; put f32\n</code></pre>\n\n<p>where <code>_replaceAt :: (Int, Int) -&gt; Versioned a -&gt; Versioned b -&gt; Versioned b</code> means that we want to replace some subtree at index <code>(x,y)</code> in the deserializer for <code>b</code>, whose type is <code>Versioned a</code>, with the second argument. It seems doable to express that in type-safe way but this requires exposing the structure of <code>Obj3</code> as a type <code>T</code> in <code>Versioned T</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1486834468, "post_id": 42178878, "comment_id": 71521118, "body": "Terminology nitpick: <code>Person</code> is a product type, not a sum type. (A sum type would be <code>data Person = PersonName String | PersonId Int</code>.)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1486834571, "post_id": 42178878, "comment_id": 71521158, "body": "What is &quot;the Enum part of the sum type <code>Person</code>&quot;?"}, {"owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1486834596, "post_id": 42178878, "comment_id": 71521166, "body": "@duplode Well, is it? Isn&#39;t it equal to a tagged union, where there is only possible Enum value?"}, {"owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1486834654, "post_id": 42178878, "comment_id": 71521194, "body": "@DanielWagner By Enum part I mean (Person _ _), i.e. the first value in the sum type. I think in a very C kind of way (sum type as implemented by an enum and a union), that may be the root of some confusion."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1486835268, "post_id": 42178878, "comment_id": 71521380, "body": "Now I see what you mean, but the terminology mismatch does make things a bit confusing. The usual term for what you call &quot;Enum part&quot; is &quot;constructor&quot; (in Haskell, &quot;Enum&quot; usually refers to the <code>Enum</code> type class), and a &quot;sum type&quot; is one with two or more constructors."}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "edited": false, "score": 0, "creation_date": 1486835921, "post_id": 42178878, "comment_id": 71521605, "body": "I can&#39;t tell what the actual question here is.  Are you asking why the constructor is necessary when the type is known?  That&#39;s my best guess, but I&#39;m not very confident in it."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1486836897, "creation_date": 1486836897, "answer_id": 42179463, "question_id": 42178878, "link": "https://stackoverflow.com/questions/42178878/is-there-any-point-in-using-the-constructor-after-construction-when-there-is-onl/42179463#42179463", "title": "Is there any point in using the constructor after construction when there is only one possible type", "body": "<p>Your question, with a few terminology tweaks:</p>\n\n<blockquote>\n  <p>Is there any point in ever [specifying the constructor] <code>Person</code> [...]? You can't add any variants anyway.</p>\n</blockquote>\n\n<p>In this case, given that there is just one constructor <em>and</em> that you have specified the type of <code>ofLegalAge</code>'s argument, specifying the constructor indeed is, in principle, redundant. In practice, though, there is no syntax for ommiting constructors in such a way. One alternative, which works very well for single-constructor types, is using record syntax:</p>\n\n<pre><code>data Person = Person\n    { name :: String\n    , age :: Int\n    }\n\nofLegalAge :: Person -&gt; Bool\nofLegalAge person\n  | age person &gt;= 18 = True\n  | age person &lt; 18  = False\n</code></pre>\n\n<p>Here, <code>age</code> is a <code>Person -&gt; Int</code> function that gives access to the relevant field.</p>\n\n<hr>\n\n<p>Tangential note: your function can be written more simply as...</p>\n\n<pre><code>ofLegalAge :: Person -&gt; Bool\nofLegalAge person\n  | age person &gt;= 18 = True\n  | otherwise = False\n</code></pre>\n\n<p>... and even more simply as:</p>\n\n<pre><code>ofLegalAge :: Person -&gt; Bool\nofLegalAge person = age person &gt;= 18\n</code></pre>\n"}], "owner": {"reputation": 4639, "user_id": 3986708, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/g0JCF.jpg?s=128&g=1", "display_name": "hgiesel", "link": "https://stackoverflow.com/users/3986708/hgiesel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 42179463, "answer_count": 1, "score": 0, "last_activity_date": 1486836897, "creation_date": 1486833858, "question_id": 42178878, "link": "https://stackoverflow.com/questions/42178878/is-there-any-point-in-using-the-constructor-after-construction-when-there-is-onl", "title": "Is there any point in using the constructor after construction when there is only one possible type", "body": "<p>Considering</p>\n\n<pre><code>data Person = Person String Int\nlet p = Person \"Jim\" 23\n\nlet ofLegalAge :: Person -&gt; Bool\n    ofLegalAge (_ _ age) -- (instead of (Person _ age))\n      | age &gt;= 18 = True\n      | age &lt; 18  = False\n</code></pre>\n\n<p>Is there any point in ever using the <em>Enum</em> part of the sum type <code>Person</code> over the type of the sum type itself?\nYou can't add any variants anyway.</p>\n"}, {"tags": ["haskell", "optimization", "vector"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1486830923, "post_id": 42178164, "comment_id": 71519890, "body": "Not very educated guess: isn&#39;t it because stream fusion fuses the vectors and the <code>map</code>s, but not the mapped functions? (I suppose allocation stats for your program might disprove my guess.)"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1486836034, "post_id": 42178164, "comment_id": 71521653, "body": "@duplode <code>incAll</code> doesn&#39;t get inlined, since it&#39;s used at too many call sites. The <code>V.map (+1) . V.map (+1) . ...</code> would fuse fine, but since <code>incAll</code> doesn&#39;t get inlined, the fusion cannot fire. If you do inline <code>incAll</code> however, the <code>V.map (+1) . V.map (+1) ...</code> lead to (+1 (+1 (+1 (+1 ...))))<code>, which gets optimized after the simplifier to a single </code>(+32)`."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1486837243, "post_id": 42178164, "comment_id": 71522070, "body": "@Zeta Thanks for correcting my fuzzy guess -- and for the excellent answer as well!"}], "answers": [{"comments": [{"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1486836631, "post_id": 42179269, "comment_id": 71521857, "body": "I should invest some time into understanding the core output."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1486837303, "post_id": 42179269, "comment_id": 71522089, "body": "@MaiaVictor think of it as Haskell, but limited to <code>case \u2026 of \u2026</code>, <code>let ... in ...</code> (for non-recursive bindings) and <code>letrec ... in ...</code> (for recursive bindings). And then get used to very, <i>very</i> ugly variable names :/. See also <a href=\"https://stackoverflow.com/questions/6121146/reading-ghc-core\">stackoverflow.com/questions/6121146/reading-ghc-core</a>."}, {"owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "edited": false, "score": 0, "creation_date": 1486838687, "post_id": 42179269, "comment_id": 71522596, "body": "thank you very much... letting you know I posted a follow-up question just in case..."}], "tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1486836236, "last_edit_date": 1486836236, "creation_date": 1486835922, "answer_id": 42179269, "question_id": 42178164, "link": "https://stackoverflow.com/questions/42178164/why-this-program-seems-not-to-be-fusing-properly/42179269#42179269", "title": "Why this program seems not to be fusing properly?", "body": "<p><sup>Note: I'm using GHC 7.10.3 and stack 1.1.2 on Windows (x64), so your times might differ.</sup></p>\n\n<h1>TL;DR</h1>\n\n<p>Make sure to inline your functions if you want to use stream fusion.</p>\n\n<h1>How to fuse a stream</h1>\n\n<p>The stream fusion relies heavily on the optimizer and rewrite rules, at least with the vector package. So let's check which versions of your program are optimized well.</p>\n\n<h2>Minimal version (1 <code>incAll</code>)</h2>\n\n<p>Let's start simple. We start by reducing the program to the minimum:</p>\n\n<pre><code>-- SOBase.hs\nmodule Main where\n\nimport qualified Data.Vector.Unboxed as V\n\nmain :: IO ()\nmain = do\n\n  let size = 100000000 :: Int\n  let array = V.replicate size 0 :: V.Vector Int\n  let incAll = V.map (+ 1)\n\n  print \n    . V.sum     \n    . incAll    \n    $ array\n</code></pre>\n\n<p>Let's compile it and dump GHC's generated core:</p>\n\n<pre><code>$ stack ghc --package vector -- -O2 SOBase.hs -ddump-simpl -dsuppress-all\n\nmain2\nmain2 =\n  case (runSTRep main3) `cast` ...\n  of _ { Vector ipv_s6b2 ipv1_s6b3 ipv2_s6b4 -&gt;\n  letrec {\n    $s$wfoldlM'_loop_s9wM\n    $s$wfoldlM'_loop_s9wM =\n      \\ sc_s9wK sc1_s9wL -&gt;\n        case tagToEnum# (&gt;=# sc1_s9wL ipv1_s6b3) of _ {\n          False -&gt;\n            case indexIntArray# ipv2_s6b4 (+# ipv_s6b2 sc1_s9wL)\n            of wild_a5ju { __DEFAULT -&gt;\n            $s$wfoldlM'_loop_s9wM (+# sc_s9wK (+# wild_a5ju 1)) (+# sc1_s9wL 1)\n            };\n          True -&gt; sc_s9wK\n        }; } in\n  case $s$wfoldlM'_loop_s9wM 0 0 of ww_s94k { __DEFAULT -&gt;\n  case $wshowSignedInt 0 ww_s94k ([])\n  of _ { (# ww5_a5fH, ww6_a5fI #) -&gt;\n  : ww5_a5fH ww6_a5fI\n  }\n  }\n  }\n</code></pre>\n\n<p>Let's make that a little bit prettier:</p>\n\n<pre><code>main2 = let foldLoop s n \n              | n &lt; size  = foldLoop (s + (vec ! n + 1)) (n + 1)\n              | otherwise = s\n        in print (foldLoop 0 0)\n</code></pre>\n\n<p>The <code>incAll</code> has been inlined into the function:</p>\n\n<pre><code>case indexIntArray# ipv2_s6b4 (+# ipv_s6b2 sc1_s9wL)\n                of wild_a5ju { __DEFAULT -&gt;\n                $s$wfoldlM'_loop_s9wM (+# sc_s9wK (+# wild_a5ju 1)) (+# sc1_s9wL 1)\n                                                  ^^^^^^^^^^^^^^^^\n</code></pre>\n\n<h2>More calls (3 <code>incAll</code>s)</h2>\n\n<p>Let's use <code>incAll</code> more often:</p>\n\n<pre><code> -- SO3.hs\nmodule Main where\n\nimport qualified Data.Vector.Unboxed as V\n\nmain :: IO ()\nmain = do\n\n  let size = 100000000 :: Int\n  let array = V.replicate size 0 :: V.Vector Int\n  let incAll = V.map (+ 1)\n\n  print\n    . V.sum\n\n    . incAll\n    . incAll\n    . incAll\n\n    $ array\n</code></pre>\n\n<p>What does our core contain now?</p>\n\n<pre><code>$wincAll\n$wincAll =\n  \\ ww_s999 ww1_s99a ww2_s99b -&gt;\n    runSTRep\n      (\\ @ s_a4Rs s1_a4Rt -&gt;\n         case tagToEnum# (&lt;# ww1_s99a 0) of _ {\n           False -&gt;\n             case divInt# 9223372036854775807 8 of ww4_a5fa { __DEFAULT -&gt;\n             case tagToEnum# (&gt;# ww1_s99a ww4_a5fa) of _ {\n               False -&gt;\n                 case newByteArray# (*# ww1_s99a 8) (s1_a4Rt `cast` ...)\n                 of _ { (# ipv_a5dy, ipv1_a5dz #) -&gt;\n                 letrec {\n                   $s$wa_s9DR\n                   $s$wa_s9DR =\n                     \\ sc_s9DN sc1_s9DO sc2_s9DQ -&gt;\n                       case tagToEnum# (&gt;=# sc1_s9DO ww1_s99a) of _ {\n                         False -&gt;\n                           case indexIntArray# ww2_s99b (+# ww_s999 sc1_s9DO)\n                           of wild_a5jF { __DEFAULT -&gt;\n                           case writeIntArray#\n                                  ipv1_a5dz sc_s9DN (+# wild_a5jF 1) (sc2_s9DQ `cast` ...)\n                           of s'#_a6Cg { __DEFAULT -&gt;\n                           $s$wa_s9DR (+# sc_s9DN 1) (+# sc1_s9DO 1) (s'#_a6Cg `cast` ...)\n                           }\n                           };\n                         True -&gt; (# sc2_s9DQ, I# sc_s9DN #)\n                       }; } in\n                 case $s$wa_s9DR 0 0 (ipv_a5dy `cast` ...)\n                 of _ { (# ipv6_a4Nw, ipv7_a4Nx #) -&gt;\n                 case ipv7_a4Nx of _ { I# dt4_a5gC -&gt;\n                 case unsafeFreezeByteArray# ipv1_a5dz (ipv6_a4Nw `cast` ...)\n                 of _ { (# ipv2_a52B, ipv3_a52C #) -&gt;\n                 (# ipv2_a52B `cast` ...,\n                    (Vector 0 dt4_a5gC ipv3_a52C) `cast` ... #)\n                 }\n                 }\n                 }\n                 };\n               True -&gt; case main4 ww1_s99a of wild_00 { }\n             }\n             };\n           True -&gt; case main3 ww1_s99a of wild_00 { }\n         })\n\n....\n\nmain2\nmain2 =\n  case (runSTRep main5) `cast` ...\n  of _ { Vector ww1_s991 ww2_s992 ww3_s993 -&gt;\n  case ($wincAll ww1_s991 ww2_s992 ww3_s993) `cast` ...\n--      ^^^^^^^^ oh\n  of _ { Vector ww5_X99T ww6_X99V ww7_X99X -&gt;\n  case ($wincAll ww5_X99T ww6_X99V ww7_X99X) `cast` ...\n--      ^^^^^^^^ oh\n  of _ { Vector ww9_X99Y ww10_X9a0 ww11_X9a2 -&gt;\n  case ($wincAll ww9_X99Y ww10_X9a0 ww11_X9a2) `cast` ...\n--      ^^^^^^^^ oh\n  of _ { Vector ipv_s6cG ipv1_s6cH ipv2_s6cI -&gt;\n  letrec {\n    $s$wfoldlM'_loop_s9Du\n    $s$wfoldlM'_loop_s9Du =\n      \\ sc_s9Ds sc1_s9Dt -&gt;\n        case tagToEnum# (&gt;=# sc1_s9Dt ipv1_s6cH) of _ {\n          False -&gt;\n            case indexIntArray# ipv2_s6cI (+# ipv_s6cG sc1_s9Dt)\n            of wild_a5jx { __DEFAULT -&gt;\n            $s$wfoldlM'_loop_s9Du (+# sc_s9Ds wild_a5jx) (+# sc1_s9Dt 1)\n            };\n          True -&gt; sc_s9Ds\n        }; } in\n  case $s$wfoldlM'_loop_s9Du 0 0 of ww12_s99s { __DEFAULT -&gt;\n  case $wshowSignedInt 0 ww12_s99s ([])\n  of _ { (# ww14_a5fK, ww15_a5fL #) -&gt;\n  : ww14_a5fK ww15_a5fL\n  }\n  }\n  }\n  }\n  }\n  }\n</code></pre>\n\n<p>The function is not inlined anymore! Since it isn't inlined, the stream fusion cannot kick in. </p>\n\n<h2>Inlining the function (3 <code>incAll</code>s)</h2>\n\n<p>Let's add an INLINE pragma:</p>\n\n<pre><code>-- SO3I.hs\nmodule Main where\n\nimport qualified Data.Vector.Unboxed as V\n\nmain :: IO ()\nmain = do\n\n  let size = 100000000 :: Int\n  let array = V.replicate size 0 :: V.Vector Int\n  let {-# INLINE incAll #-}\n      incAll = V.map (+1)\n  print \n    . V.sum \n\n    . incAll \n    . incAll \n    . incAll \n\n    $ array\n</code></pre>\n\n\n\n<pre><code>stack ghc --package vector -- -O2 -ddump-simpl SO3I.hs\n</code></pre>\n\n<p>How does the <code>main</code> now look like?</p>\n\n<pre><code>main2                                                                         \nmain2 =                                                                       \n  case (runSTRep main3) `cast` ...                                            \n  of _ { Vector ipv_s6bG ipv1_s6bH ipv2_s6bI -&gt;                               \n  letrec {                                                                    \n    $s$wfoldlM'_loop_s9z7                                                     \n    $s$wfoldlM'_loop_s9z7 =                                                   \n      \\ sc_s9z5 sc1_s9z6 -&gt;                                                   \n        case tagToEnum# (&gt;=# sc1_s9z6 ipv1_s6bH) of _ {                       \n          False -&gt;                                                            \n            case indexIntArray# ipv2_s6bI (+# ipv_s6bG sc1_s9z6)              \n            of wild_a5jC { __DEFAULT -&gt;                                       \n            $s$wfoldlM'_loop_s9z7                                             \n              (+# sc_s9z5 (+# (+# (+# wild_a5jC 1) 1) 1)) (+# sc1_s9z6 1)     \n            };                                                                \n          True -&gt; sc_s9z5                                                     \n        }; } in                                                               \n  case $s$wfoldlM'_loop_s9z7 0 0 of ww_s96F { __DEFAULT -&gt;                    \n  case $wshowSignedInt 0 ww_s96F ([])                                         \n  of _ { (# ww5_a5fP, ww6_a5fQ #) -&gt;                                          \n  : ww5_a5fP ww6_a5fQ                                                         \n  }                                                                           \n  }                                                                           \n  }                                                                           \n</code></pre>\n\n<p>Great. <code>incAll</code> has been inlined, as can be seen here:</p>\n\n<pre><code>(+# sc_s9z5 (+# (+# (+# wild_a5jC 1) 1) 1)) (+# sc1_s9z6 1)     \n                                  ^  ^  ^\n</code></pre>\n\n<p>So the problem was that <code>incAll</code> wasn't inlined, therefore you didn't end up with</p>\n\n<pre><code>V.sum . V.map (+1) . V.map (+1) . V.map (+1)\n</code></pre>\n\n<h2>Your original program (now inlined, 32 <code>incAll</code>s)</h2>\n\n<p>Last but not least, let's try your original program again, this time with inline. Is everything fixed? Let's have a look at the core:</p>\n\n<pre><code>main2\nmain2 =\n  case (runSTRep main3) `cast` ...\n  of _ { Vector ipv_s6xF ipv1_s6xG ipv2_s6xH -&gt;\n  letrec {\n    $s$wfoldlM'_loop_sajT\n    $s$wfoldlM'_loop_sajT =\n      \\ sc_sajR sc1_sajS -&gt;\n        case tagToEnum# (&gt;=# sc1_sajS ipv1_s6xG) of _ {\n          False -&gt;\n            case indexIntArray# ipv2_s6xH (+# ipv_s6xF sc1_sajS)\n            of wild_a5mq { __DEFAULT -&gt;\n            $s$wfoldlM'_loop_sajT\n              (+#\n                 sc_sajR\n                 (+#\n                    (+#\n                       (+#\n                          (+#\n                             (+#\n                                (+#\n                                   (+#\n                                      (+#\n                                         (+#\n                                            (+#\n                                               (+#\n                                                  (+#\n                                                     (+#\n                                                        (+#\n                                                           (+#\n                                                              (+#\n                                                                 (+#\n                                                                    (+#\n                                                                       (+#\n                                                                          (+#\n                                                                             (+#\n                                                                                (+#\n                                                                                   (+#\n                                                                                      (+#\n                                                                                         (+#\n                                                                                            (+#\n                                                                                               (+#\n                                                                                                  (+#\n                                                                                                     (+#\n                                                                                                        (+#\n                                                                                                           (+#\n                                                                                                              (+#\n                                                                                                                 wild_a5mq\n                                                                                                                 1)\n                                                                                                              1)\n                                                                                                           1)\n                                                                                                        1)\n                                                                                                     1)\n                                                                                                  1)\n                                                                                               1)\n                                                                                            1)\n                                                                                         1)\n                                                                                      1)\n                                                                                   1)\n                                                                                1)\n                                                                             1)\n                                                                          1)\n                                                                       1)\n                                                                    1)\n                                                                 1)\n                                                              1)\n                                                           1)\n                                                        1)\n                                                     1)\n                                                  1)\n                                               1)\n                                            1)\n                                         1)\n                                      1)\n                                   1)\n                                1)\n                             1)\n                          1)\n                       1)\n                    1))\n              (+# sc1_sajS 1)\n            };\n          True -&gt; sc_sajR\n        }; } in\n  case $s$wfoldlM'_loop_sajT 0 0 of ww_s9Rr { __DEFAULT -&gt;\n  case $wshowSignedInt 0 ww_s9Rr ([])\n  of _ { (# ww5_a5iD, ww6_a5iE #) -&gt;\n  : ww5_a5iD ww6_a5iE\n  }\n  }\n  }\n</code></pre>\n\n<p>Well, yes. But GHC isn't smart enough to put <code>(+1) . (+1)</code> to <code>(+2)</code> and so on. Is it actually faster?</p>\n\n<pre><code>$ stack ghc --package vector -- -O2 SO.hs &amp;&amp; SO.exe +RTS -s\n  26,400,052,464 bytes allocated in the heap                                             \n           9,736 bytes copied during GC                                                  \n     800,026,736 bytes maximum residency (2 sample(s))                                   \n          61,328 bytes maximum slop                                                      \n            1527 MB total memory in use (0 MB lost due to fragmentation)                 \n\n                                     Tot time (elapsed)  Avg pause  Max pause            \n  Gen  0        32 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s            \n  Gen  1         2 colls,     0 par    0.000s   0.089s     0.0446s    0.0890s            \n\n  INIT    time    0.000s  (  0.000s elapsed)                                             \n  MUT     time    4.453s  (  4.616s elapsed)                                             \n  GC      time    0.000s  (  0.090s elapsed)                                             \n  EXIT    time    0.000s  (  0.089s elapsed)                                             \n  Total   time    4.453s  (  4.795s elapsed)                                             \n\n  %GC     time       0.0%  (1.9% elapsed)                                                \n\n  Alloc rate    5,928,432,834 bytes per MUT second                                       \n\n  Productivity 100.0% of total user, 92.9% of total elapsed                              \n</code></pre>\n\n<p>\n4 seconds for your original program. And for the inlined one?</p>\n\n<pre><code>$ stack ghc --package vector -- -O2 SOFixed.hs &amp;&amp; SOFixed.exe +RTS -s\n3200000000\n     800,048,112 bytes allocated in the heap\n           4,352 bytes copied during GC\n          42,664 bytes maximum residency (1 sample(s))\n          18,776 bytes maximum slop\n             764 MB total memory in use (0 MB lost due to fragmentation)\n\n                                     Tot time (elapsed)  Avg pause  Max pause\n  Gen  0         1 colls,     0 par    0.000s   0.000s     0.0000s    0.0000s\n  Gen  1         1 colls,     0 par    0.000s   0.045s     0.0452s    0.0452s\n\n  INIT    time    0.000s  (  0.000s elapsed)\n  MUT     time    0.188s  (  0.224s elapsed)\n  GC      time    0.000s  (  0.045s elapsed)\n  EXIT    time    0.000s  (  0.045s elapsed)\n  Total   time    0.188s  (  0.315s elapsed)\n\n  %GC     time       0.0%  (14.4% elapsed)\n\n  Alloc rate    4,266,923,264 bytes per MUT second\n\n  Productivity 100.0% of total user, 59.6% of total elapsed\n</code></pre>\n\n<p>0.1 seconds. Great! By the way, all the <code>(+1)</code> calls get optimized into a single <code>addq $32,...</code> down the line.</p>\n"}], "owner": {"reputation": 44680, "user_id": 1031791, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/fb710534fda446d2286074bb7692e65a?s=128&d=identicon&r=PG", "display_name": "MaiaVictor", "link": "https://stackoverflow.com/users/1031791/maiavictor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 1, "accepted_answer_id": 42179269, "answer_count": 1, "score": 5, "last_activity_date": 1486842490, "creation_date": 1486829924, "last_edit_date": 1486842490, "question_id": 42178164, "link": "https://stackoverflow.com/questions/42178164/why-this-program-seems-not-to-be-fusing-properly", "title": "Why this program seems not to be fusing properly?", "body": "<p>I was under suspect that a given program wasn't fusing as it would and made this test to confirm:</p>\n\n<pre><code>module Main where\n\nimport qualified Data.Vector.Unboxed as V\n\nmain :: IO ()\nmain = do\n\n  let size = 100000000 :: Int\n  let array = V.replicate size 0 :: V.Vector Int\n  let incAll = V.map (+ 1)\n\n  print \n    . V.sum \n\n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n\n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n    . incAll \n\n    $ array\n</code></pre>\n\n<p>The more <code>incAll</code>s you add, the less efficient the program becomes, which, I believe, means stream fusion isn't kicking in. I'm using GHC 8.0.1, building it with stack, and I've included <code>-O2</code> on <code>.cabal</code>'s <code>ghc-options</code>. Am I missing something?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 1, "creation_date": 1486826121, "post_id": 42177265, "comment_id": 71518240, "body": "It might be a buffering problem. Try disabling buffering with <code>hSetBuffering</code> on stdin and stdout, see if the problem is fixed."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1486829386, "post_id": 42177265, "comment_id": 71519333, "body": "Use <code>putStrLn</code> instead of <code>putStr</code> for your prompt?"}, {"owner": {"reputation": 1232, "user_id": 7453707, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh4.googleusercontent.com/-ga6gJDP75pc/AAAAAAAAAAI/AAAAAAAAAO0/pIEgPij3PqU/photo.jpg?sz=128", "display_name": "ShocKwav3_", "link": "https://stackoverflow.com/users/7453707/shockwav3"}, "reply_to_user": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1486829449, "post_id": 42177265, "comment_id": 71519362, "body": "@Michail, it works after setting it. Thanks !"}], "answers": [{"tags": [], "owner": {"reputation": 20350, "user_id": 411944, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7bf057b98d0652db34842d1817234853?s=128&d=identicon&r=PG", "display_name": "Reactormonk", "link": "https://stackoverflow.com/users/411944/reactormonk"}, "is_accepted": false, "score": 1, "last_activity_date": 1486826126, "creation_date": 1486826126, "answer_id": 42177463, "question_id": 42177265, "link": "https://stackoverflow.com/questions/42177265/messages-printed-at-the-wrong-moment-with-putstr/42177463#42177463", "title": "Messages printed at the wrong moment with putStr", "body": "<p>Try this:</p>\n\n<pre><code>import Control.Monad\nimport Data.Char\n\nmain = forever $ do\n    putStrLn \"Give me some input: \"\n    l &lt;- getLine\n    putStrLn $ map toUpper l\n</code></pre>\n\n<p>The issue here is that <code>putStr</code> doesn't write a newline. And the output buffer only gets flushed on a newline.</p>\n"}, {"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 4, "last_activity_date": 1486829703, "last_edit_date": 1495542329, "creation_date": 1486828382, "answer_id": 42177897, "question_id": 42177265, "link": "https://stackoverflow.com/questions/42177265/messages-printed-at-the-wrong-moment-with-putstr/42177897#42177897", "title": "Messages printed at the wrong moment with putStr", "body": "<p>As <a href=\"https://stackoverflow.com/users/6564029/michail\">Michail</a> points out, it is a buffering issue, which can be solved with <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#v:hSetBuffering\" rel=\"nofollow noreferrer\"><code>hSetBuffering</code></a> for <code>stdout</code>:</p>\n\n<pre><code>import Control.Monad\nimport Data.Char\nimport System.IO\n\nmain = do\n    hSetBuffering stdout NoBuffering\n    forever $ do\n    putStr \"Give me some input: \"\n    l &lt;- getLine\n    putStrLn $ map toUpper l\n</code></pre>\n\n<p>If for whatever reason you don't want to change the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#t:BufferMode\" rel=\"nofollow noreferrer\">buffer mode</a> for the whole program, you can use <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO.html#v:hFlush\" rel=\"nofollow noreferrer\"><code>hFlush</code></a> to do an extra flushing of the buffer exactly where you need it:</p>\n\n<pre><code>import Control.Monad\nimport Data.Char\nimport System.IO\n\nmain = do\n    forever $ do\n    putStr \"Give me some input: \"\n    hFlush stdout\n    l &lt;- getLine\n    putStrLn $ map toUpper l\n</code></pre>\n"}], "owner": {"reputation": 1232, "user_id": 7453707, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh4.googleusercontent.com/-ga6gJDP75pc/AAAAAAAAAAI/AAAAAAAAAO0/pIEgPij3PqU/photo.jpg?sz=128", "display_name": "ShocKwav3_", "link": "https://stackoverflow.com/users/7453707/shockwav3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 42177897, "answer_count": 2, "score": 1, "last_activity_date": 1486831087, "creation_date": 1486824845, "last_edit_date": 1486831087, "question_id": 42177265, "link": "https://stackoverflow.com/questions/42177265/messages-printed-at-the-wrong-moment-with-putstr", "title": "Messages printed at the wrong moment with putStr", "body": "<pre><code>import Control.Monad\nimport Data.Char\n\nmain = forever $ do\n    putStr \"Give me some input: \"\n    l &lt;- getLine\n    putStrLn $ map toUpper l\n</code></pre>\n\n<p>I have been learning Haskell from learn you haskell. When i try to run this code it does not behave like it should.</p>\n\n<pre><code>l\nGive me some input: L\nabc\nGive me some input: ABC\n</code></pre>\n\n<p>When i run this it doesn't print the string first and i can input. After providing some input, in this case <code>l</code> it returns me like this : <code>Give me some input: L</code>.</p>\n\n<p>What it should do is, ask for input by printing <code>Give me some input:</code> and after putting the input it shall return the input in uppercase.</p>\n\n<p>How can i fix this?</p>\n"}, {"tags": ["haskell", "typeclass"], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 2016120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54e834725f57b7ec0ae835d2727b9a84?s=128&d=identicon&r=PG", "display_name": "rodic", "link": "https://stackoverflow.com/users/2016120/rodic"}, "edited": false, "score": 0, "creation_date": 1486818297, "post_id": 42175627, "comment_id": 71515768, "body": "thanks @chi. makes sense when you put it that way :) so <code>1 :: Num a =&gt; a</code> holds true for any <code>a</code> that&#39;s instance of <code>Num</code>, but <code>1.0</code> doesn&#39;t."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 415, "user_id": 2016120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54e834725f57b7ec0ae835d2727b9a84?s=128&d=identicon&r=PG", "display_name": "rodic", "link": "https://stackoverflow.com/users/2016120/rodic"}, "edited": false, "score": 2, "creation_date": 1486819123, "post_id": 42175627, "comment_id": 71516050, "body": "@rodic Yes. Theoretically, the designers of Haskell could have mandated that <code>1.0</code> be handled as if it were <code>1</code>, but in practice it would be terribly confusing to discover that, in a given context, <code>1.0</code> type checks but <code>1.5</code> does not. So, <code>1.0</code> was allowed only to represent values of types in the <code>Fractional</code> typeclass."}, {"owner": {"reputation": 415, "user_id": 2016120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54e834725f57b7ec0ae835d2727b9a84?s=128&d=identicon&r=PG", "display_name": "rodic", "link": "https://stackoverflow.com/users/2016120/rodic"}, "edited": false, "score": 0, "creation_date": 1486819293, "post_id": 42175627, "comment_id": 71516103, "body": "yeah, i had any float on mind when i wrote 1.0. but now i realize my original question could be rewritten like, why <code>1 :: a</code> doesn&#39;t compile. thanks a lot for the help."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 5, "last_activity_date": 1486814565, "creation_date": 1486814565, "answer_id": 42175627, "question_id": 42175311, "link": "https://stackoverflow.com/questions/42175311/setting-type-of-fractional-to-num/42175627#42175627", "title": "Setting type of fractional to num", "body": "<p>If we have</p>\n\n<pre><code>x :: Num a =&gt; a\n</code></pre>\n\n<p>the user of <code>x</code> can pick <code>a</code> as wanted. E.g.</p>\n\n<pre><code>x :: Int\n</code></pre>\n\n<p>What would this evaluate to if <code>x = 1.5</code> ?</p>\n\n<p>For this reason a floating point literal can't be given the polytype <code>Num a =&gt; a</code>, since its value won't (in general) fit all <code>Num</code>eric types.</p>\n\n<p>Integral literals instead fit every numeric type, so they are allowed.</p>\n"}, {"tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": false, "score": 3, "last_activity_date": 1486817868, "creation_date": 1486817868, "answer_id": 42176129, "question_id": 42175311, "link": "https://stackoverflow.com/questions/42175311/setting-type-of-fractional-to-num/42176129#42176129", "title": "Setting type of fractional to num", "body": "<p>The superclass relationship between type classes does <strong>not</strong> establish relationships between types. It tells us only that if type <em>t</em> is a member of type class <em>C</em>, and <em>B</em> is a super class of <em>C</em>, then <em>t</em> will also be member of <em>B</em>. </p>\n\n<p>It <strong>doesn't</strong> say that each value <em>v::t</em> can be used at any type that is also member of <em>B</em>. But this is what you are stating with:</p>\n\n<pre><code>3.14159 :: Num a =&gt; a\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 415, "user_id": 2016120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54e834725f57b7ec0ae835d2727b9a84?s=128&d=identicon&r=PG", "display_name": "rodic", "link": "https://stackoverflow.com/users/2016120/rodic"}, "edited": false, "score": 0, "creation_date": 1486825589, "post_id": 42176384, "comment_id": 71518077, "body": "got it. num is not a type like in oo, but set of types and in order for a val to be polymorphic it must be able to instantiate to any num type, any other rule would lead to absurd situations as you guys showed."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 3, "last_activity_date": 1486820093, "last_edit_date": 1486820093, "creation_date": 1486819586, "answer_id": 42176384, "question_id": 42175311, "link": "https://stackoverflow.com/questions/42175311/setting-type-of-fractional-to-num/42176384#42176384", "title": "Setting type of fractional to num", "body": "<p>It's important to distinguish between polymorphism in OO languages and polymorphism in Haskell. <a href=\"https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)\" rel=\"nofollow noreferrer\">OO polymorphism is covariant, while Haskell's <em>parametric polymorphism</em> is co<strong>ntra</strong>variant</a>.</p>\n\n<p>What this means is: in an OO language, if you have</p>\n\n<pre><code>class A {...}\nclass B: A {...}\n</code></pre>\n\n<p>i.e. <code>A</code> is a superclass of <code>B</code>, then any value of type <code>B</code> is also a value of type <code>A</code>. (Note that any particular <em>value</em> is actually not polymorphic but has a concrete type!) Thus, if you had</p>\n\n<pre><code>class Num {...}\nclass Fractional: Num {...}\n</code></pre>\n\n<p>then a <code>Fractional</code> value could indeed be used as a <code>Num</code> value. That's roughly what covariant means: any subclass value <a href=\"https://en.wikipedia.org/wiki/Liskov_substitution_principle\" rel=\"nofollow noreferrer\">is also a superclass value</a>; the values hierarchy goes the same direction as the type hierarchy.</p>\n\n<p>In Haskell, <code>class</code>es are different. There is no such thing as a \u201cvalue of type <code>Num</code>\u201d, only values of concrete types <code>a</code>. That <em>type</em> may be in the <code>Num</code> class.</p>\n\n<p>Unlike in OO languages, a value like <code>1 :: Num a =&gt; a</code> <em>is</em> polymorphic: it can take on whatever type the environment demands, provided the type is in the <code>Num</code> class. (Actually that syntax is just shorthand for <code>1 :: \u2200 a . Num a =&gt; a</code>, to be read as \u201cfor all types <code>a</code>, you can have a value <code>1</code> of type <code>a</code>.) For example,</p>\n\n<pre><code>Prelude&gt; let x = 1 :: Num a =&gt; a\nPrelude&gt; x :: Int\n1\nPrelude&gt; x :: Double\n1.0\n</code></pre>\n\n<p>You can also give <code>x</code> a more specific constraint of <code>Fractional</code>, since that's a subclass of <code>Num</code>. That just restricts what type the polymorphic value can be instantiated to:</p>\n\n<pre><code>Prelude&gt; let x = 1 :: Fractional a =&gt; a\nPrelude&gt; x :: Int\n\n&lt;interactive&gt;:6:1:\n    No instance for (Fractional Int) arising from a use of \u2018x\u2019\n    ...\nPrelude&gt; x :: Double\n1.0\n</code></pre>\n\n<p>because <code>Int</code> is not a fractional type.</p>\n\n<p>Thus, Haskell's polymorphism is contravariant: polymorphic values restricted to a superclass can also be restricted to a subclass instead, but not the other way around. In particular, you can obviously have</p>\n\n<pre><code>Prelude&gt; let y = 1.0 :: Fractional a =&gt; a\n</code></pre>\n\n<p>(<code>y</code> is the same as <code>x'</code>), but you can not generalise this to <code>y' = 1.0 :: Num a =&gt; a</code>. Which is a good thing as Ingo remarked since otherwise it would be possible to do</p>\n\n<pre><code>Prelude&gt; 3.14159 :: Int\n  ????\n</code></pre>\n"}], "owner": {"reputation": 415, "user_id": 2016120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54e834725f57b7ec0ae835d2727b9a84?s=128&d=identicon&r=PG", "display_name": "rodic", "link": "https://stackoverflow.com/users/2016120/rodic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 42175627, "answer_count": 3, "score": 1, "last_activity_date": 1486820093, "creation_date": 1486812452, "last_edit_date": 1486818205, "question_id": 42175311, "link": "https://stackoverflow.com/questions/42175311/setting-type-of-fractional-to-num", "title": "Setting type of fractional to num", "body": "<p>Could someone please explain why this compiles</p>\n\n<pre><code>Prelude&gt; 1 :: Num a =&gt; a\n</code></pre>\n\n<p>and this doesn't</p>\n\n<pre><code>Prelude&gt; 1.0 :: Num a =&gt; a\n</code></pre>\n\n<p>Second example would work with <code>Fractional</code>, but <code>Num</code> is superclass of <code>Fractional</code>. Just like it's superclass of <code>Integral</code>.</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "edited": false, "score": 0, "creation_date": 1486813939, "post_id": 42175048, "comment_id": 71514576, "body": "Good point re: no backtracking in instance search. Implementing transformers in addition to mtl-style classes seem to work (and I actually hinted at this solution in my question), but can I make this work using Eff too? Thanks btw."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "edited": false, "score": 1, "creation_date": 1486860144, "post_id": 42175048, "comment_id": 71528621, "body": "@sinan Making it work with extensible effects is not too hard once you already have this code, since regular <code>Monad</code>s are effects: e.g. <code>Eff &#39;[ LoggerT IO, DbT IO, IO] x</code> is a valid effect. Your &#39;runners&#39; for these effects (i.e. effects which use <code>IO</code> or any other monad which isn&#39;t a transformer as a &#39;base&#39; monad) can have type <code>Member IO r =&gt; Eff (M &#39;: r) x -&gt; Eff r x</code> instead of <code>Eff &#39;[ M ] x -&gt; m x</code>. This ends up &#39;pushing&#39; all of the effects into <code>Eff &#39;[ IO ] x</code> which you can run to get <code>IO x</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486860565, "post_id": 42175048, "comment_id": 71528691, "body": ".. in particular <a href=\"https://hackage.haskell.org/package/freer-0.2.4.1/docs/Control-Monad-Freer.html#v:runNat\" rel=\"nofollow noreferrer\">this</a> effects library has a function <code>runNat</code> which builds &#39;runners&#39; with these types: <code>\\x -&gt; runNat (flip runDbT x) :: Member m r =&gt; Eff (DbT m &#39;: r) x -&gt; Eff r x</code>"}, {"owner": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486883498, "post_id": 42175048, "comment_id": 71532496, "body": "@user2407038 can you add your comments as an answer so that I can try and accept it?"}, {"owner": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1486884388, "post_id": 42175048, "comment_id": 71532684, "body": "@user2407038 I&#39;m wondering if this is possible using <code>extensible-effects</code> library. As far as I can see, it doesn&#39;t provide anything like Freer&#39;s <code>runM</code> or <code>runNat</code>."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "edited": false, "score": 0, "creation_date": 1486932738, "post_id": 42175048, "comment_id": 71548152, "body": "@sinan <code>extensible-effects</code> essentially has the same interface as <code>freer</code>, just fewer &#39;helper&#39; functions. I believe that you can write <code>runM</code> with <code>decomp</code> and <code>run</code> and you can write <a href=\"https://hackage.haskell.org/package/freer-0.2.4.1/docs/src/Control-Monad-Freer.html#runNat\" rel=\"nofollow noreferrer\"><code>runNat</code></a> with <code>handleRelay</code> (exactly how it&#39;s done in freer) - note that <code>handleRelay</code> have slightly different types between the two libraries. I&#39;ve never actually used <code>extensible-effects</code> so I can&#39;t be sure. (if you want to accept an answer, accept this one, and perhaps edit my comment into the end if you like :))"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 5, "last_activity_date": 1486897680, "last_edit_date": 1486897680, "creation_date": 1486810693, "answer_id": 42175048, "question_id": 42174785, "link": "https://stackoverflow.com/questions/42174785/multiple-io-effects-in-eff-or-other-ways-for-composable-effects/42175048#42175048", "title": "Multiple IO effects in Eff (or other ways for composable effects)", "body": "<p>I think your <code>instance</code> declaration is a mistake.</p>\n\n<pre><code>instance (MonadReader SqlBackend m, MonadIO m, Monad m) =&gt; ReadDb m\n</code></pre>\n\n<p>This instance will match <em>all</em> type constructors <code>m :: * -&gt; *</code>, and then later fail if the <code>m</code> in question doesn't fit the instance context. There's no backtracking in instance search. In other words, you can't change out instances of <code>ReadDb</code> (like, if you need to mock out the database during testing). It also leads to your problem with overlapping superclasses.</p>\n\n<p>It's better to structure your program as a monad transformer stack, using <code>newtype</code>s as usual. So I'm going to write down a custom monad transformer:</p>\n\n<pre><code>data SqlConfig = SqlConfig { connectionString :: String }\n\nnewtype DbT m a = DbT (ReaderT SqlConfig m a) deriving (\n    Functor,\n    Applicative,\n    Alternative,\n    Monad,\n    MonadTrans,\n    MonadPlus,\n    MonadFix,\n    MonadIO,\n    MonadWriter w,\n    MonadState s,\n    MonadError e,\n    MonadCont\n    )\nrunDbT :: DbT m a -&gt; SqlConfig -&gt; m a\nrunDbT (DbT m) = runReaderT m\n</code></pre>\n\n<p>I'm using <code>GeneralizedNewtypeDeriving</code> to derive the <code>mtl</code> classes <em>except for <code>MonadReader</code></em>. (These instances also require <code>UndecidableInstances</code> because they fail the coverage condition.) I don't want to lift the <code>MonadReader</code> instance from the <code>ReaderT</code> inside the <code>DbT</code>, I want to lift it from the base monad. <code>DbT</code> is not <code>ReaderT</code>, it just happens to be implemented using <code>ReaderT</code>.</p>\n\n<pre><code>mapDbT :: (m a -&gt; n b) -&gt; DbT m a -&gt; DbT n b\nmapDbT f (DbT m) = DbT $ mapReaderT f m\ninstance MonadReader r m =&gt; MonadReader r (DbT m) where\n    ask = lift ask\n    local = mapDbT . local\n</code></pre>\n\n<p>And I can implement your classes using <code>DbT</code> as long as we have access to <code>IO</code>:</p>\n\n<pre><code>instance MonadIO m =&gt; MonadReadDb (DbT m) where\n    getUsers = DbT $ ask &gt;&gt;= (liftIO . query \"select * from Users\")\n    getUserByName name = DbT $ ask &gt;&gt;= (liftIO . query \"select * from Users where Name = @name\")\n\ninstance MonadIO m =&gt; MonadWriteDb (DbT m) where\n    addUser u = DbT $ ask &gt;&gt;= (liftIO . query \"insert Users (Name) values @name\")\n    removeUser u = DbT $ ask &gt;&gt;= (liftIO . query \"delete Users where Name = @name\")\n</code></pre>\n\n<p>Likewise, I can set up a logging monad transformer:</p>\n\n<pre><code>data LoggingConfig = LoggingConfig { filePath :: String }\n\nnewtype LoggerT m a = LoggerT (ReaderT LoggingConfig m a) deriving (\n    Functor,\n    Applicative,\n    Alternative,\n    Monad,\n    MonadTrans,\n    MonadPlus,\n    MonadFix,\n    MonadIO,\n    MonadWriter w,\n    MonadState s,\n    MonadError e,\n    MonadCont\n    )\nrunLoggerT :: LoggerT m a -&gt; LoggingConfig -&gt; m a\nrunLoggerT (LoggerT m) = runReaderT m\n\ninstance MonadIO m =&gt; MonadLogger (LoggerT m) where\n    log msg = LoggerT $ do\n        config &lt;- ask\n        liftIO $ writeFile (filePath config) msg\n\n-- MonadReader instance omitted. It's identical to the DbT instance\n</code></pre>\n\n<p>Annoyingly - and this is the main downside of the <code>mtl</code> approach - you have to write O(n^2) instances to make these types compose nicely.</p>\n\n<pre><code>instance MonadLogger m =&gt; MonadLogger (DbT m) where\n    log = lift . log\n\ninstance MonadReadDb m =&gt; MonadReadDb (LoggerT m) where\n    getUsers = lift getUsers\n    getUserByName = lift . getUserByName\n\ninstance MonadWriteDb m =&gt; MonadWriteDb (LoggerT m) where\n    addUser = lift . addUser\n    removeUser = lift . removeUser\n\n-- and a bunch of identical instances for all the types in transformers\n</code></pre>\n\n<p>You can write monadic programs using your three classes, as usual:</p>\n\n<pre><code>myProgram :: (MonadLogger m, MonadReadDb m, MonadWriteDb m) =&gt; m ()\nmyProgram = do\n    us &lt;- getUsers\n    log $ \"removing \" ++ show (length us) ++ \" users\"\n    void $ traverse removeUser us\n</code></pre>\n\n<p>Then at the entry point to your program, when you build and run your monad transformer stack, you just unwrap your <code>LoggerT</code> and <code>DbT</code> newtypes and supply the required config.</p>\n\n<pre><code>runProgram :: LoggerT (DbT IO) a -&gt; LoggingConfig -&gt; SqlConfig -&gt; IO a\nrunProgram m l s = runDbT (runLoggerT m l) s\n\nghci&gt; :t runProgram myProgram\nrunProgram myProgram :: LoggingConfig -&gt; SqlConfig -&gt; IO ()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "is_accepted": true, "score": 1, "last_activity_date": 1486890819, "creation_date": 1486890819, "answer_id": 42185894, "question_id": 42174785, "link": "https://stackoverflow.com/questions/42174785/multiple-io-effects-in-eff-or-other-ways-for-composable-effects/42185894#42185894", "title": "Multiple IO effects in Eff (or other ways for composable effects)", "body": "<p>Benjamin's answer shows how to do this with mtl, which is helpful, but I actually asked for an <code>Eff</code> solution, so here it is:</p>\n\n<p>(code inspired by the answer given in <code>freer</code> issue tracker: <a href=\"https://gitlab.com/queertypes/freer/issues/7\" rel=\"nofollow noreferrer\">https://gitlab.com/queertypes/freer/issues/7</a>)</p>\n\n<p>We have 4 type of effects:</p>\n\n<ul>\n<li>Write output to stdout</li>\n<li>Read input from stdin</li>\n<li>Read a db</li>\n<li>Log to a handle</li>\n</ul>\n\n<p>Here's a solution that uses <code>extensible-effects</code>:</p>\n\n<pre><code>{-# LANGUAGE DataKinds             #-}\n{-# LANGUAGE DeriveDataTypeable    #-}\n{-# LANGUAGE DeriveFunctor         #-}\n{-# LANGUAGE FlexibleContexts      #-}\n{-# LANGUAGE GADTs                 #-}\n{-# LANGUAGE LambdaCase            #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeOperators         #-}\n\nmodule GetlinePutline where\n\n--------------------------------------------------------------------------------\nimport           Control.Eff\nimport           Control.Eff.Lift\nimport           Data.Typeable\nimport           Prelude          hiding (log)\n--------------------------------------------------------------------------------\n\n--------------------------------------------------------------------------------\n\ndata Getline v = Getline (String -&gt; v)\n  deriving (Typeable, Functor)\n\ngetline :: Member Getline r =&gt; Eff r String\ngetline = send (inj (Getline id))\n\nrunGetline :: (SetMember Lift (Lift IO) r) =&gt; Eff (Getline :&gt; r) w -&gt; Eff r w\nrunGetline = freeMap return (\\u -&gt; handleRelay u runGetline (\\(Getline k) -&gt; lift getLine &gt;&gt;= runGetline . k))\n\n--------------------------------------------------------------------------------\n\ndata Putline v = Putline String (() -&gt; v)\n  deriving (Typeable, Functor)\n\nputline :: Member Putline r =&gt; String -&gt; Eff r ()\nputline s = send (inj (Putline s id))\n\nrunPutline :: (SetMember Lift (Lift IO) r) =&gt; Eff (Putline :&gt; r) w -&gt; Eff r w\nrunPutline = freeMap return (\\u -&gt; handleRelay u runPutline (\\(Putline s k) -&gt; lift (putStrLn s) &gt;&gt;= runPutline . k))\n\n--------------------------------------------------------------------------------\n\n-- Similar to Putline, but we provide a logger when running\n\ndata Logger\n\ndefaultLogger :: Logger\ndefaultLogger = undefined\n\nlogToHandle :: Logger -&gt; String -&gt; IO ()\nlogToHandle _ s = putStrLn (\"logging: \" ++ show s)\n\n-- Log using a logger\ndata Log v = Log String (() -&gt; v)\n  deriving (Typeable, Functor)\n\nlog :: Member Log r =&gt; String -&gt; Eff r ()\nlog s = send (inj (Log s id))\n\nrunLog :: SetMember Lift (Lift IO) r =&gt; Logger -&gt; Eff (Log :&gt; r) w -&gt; Eff r w\nrunLog logger = freeMap return (\\u -&gt; handleRelay u (runLog logger) (\\(Log s k) -&gt; lift (logToHandle logger s) &gt;&gt;= runLog logger . k))\n\n--------------------------------------------------------------------------------\n\n-- Database read\n\ndata User = User { username :: String }\n  deriving (Show)\n\ndata ReadDb v\n  = GetUsers ([User] -&gt; v)\n  | GetUserByUsername String (Maybe User -&gt; v)\n  deriving (Typeable, Functor)\n\ngetUsers :: Member ReadDb r =&gt; Eff r [User]\ngetUsers = send (inj (GetUsers id))\n\ngetUserByUsername :: Member ReadDb r =&gt; String -&gt; Eff r (Maybe User)\ngetUserByUsername uname = send (inj (GetUserByUsername uname id))\n\ndata SqlBackend = SqlBackend\n\ngetUsers_db :: SqlBackend -&gt; IO [User]\ngetUsers_db _ = return [User \"user1\"]\n\ngetUserByUsername_db :: SqlBackend -&gt; String -&gt; IO (Maybe User)\ngetUserByUsername_db _ uname = return (Just (User uname))\n\nrunReadDb :: SetMember Lift (Lift IO) r =&gt; SqlBackend -&gt; Eff (ReadDb :&gt; r) w -&gt; Eff r w\nrunReadDb db = freeMap return (\\u -&gt; handleRelay u (runReadDb db) (\\case GetUsers k -&gt; lift (getUsers_db db) &gt;&gt;= runReadDb db . k\n                                                                         GetUserByUsername s k -&gt; lift (getUserByUsername_db db s) &gt;&gt;= runReadDb db . k))\n\n--------------------------------------------------------------------------------\n\nmyEff :: (Member Log r, Member Putline r, Member Getline r, Member ReadDb r) =&gt; Eff r ()\nmyEff = do\n  ln &lt;- getline\n  putline ln\n  putline \"done\"\n  log \"logging stuff\"\n  putline \"reading db\"\n  users &lt;- getUsers\n  log (show users)\n\nmain :: IO ()\nmain = runLift $ runLog defaultLogger $ runPutline $ runGetline $ runReadDb SqlBackend myEff\n</code></pre>\n\n<p>Solution using <code>freer</code>:</p>\n\n<pre><code>-- originally posted to https://gitlab.com/queertypes/freer/issues/7\n-- modified to remove IO from myEff\n\n{-# OPTIONS_GHC -Wall #-}\n\n{-# LANGUAGE DataKinds             #-}\n{-# LANGUAGE FlexibleContexts      #-}\n{-# LANGUAGE GADTs                 #-}\n{-# LANGUAGE MultiParamTypeClasses #-}\n{-# LANGUAGE TypeOperators         #-}\n\nmodule GetlinePutline where\n\n--------------------------------------------------------------------------------\nimport           Control.Monad.Freer\nimport           Control.Monad.Freer.Internal\nimport           Prelude                      hiding (log)\n--------------------------------------------------------------------------------\n\ndoIO :: Member IO r =&gt; IO a -&gt; Eff r a\ndoIO = send\n\n--------------------------------------------------------------------------------\n\ndata Getline a where\n  Getline :: Getline String\n\ngetline :: Member Getline r =&gt; Eff r String\ngetline = send Getline\n\nrunGetline :: Member IO r =&gt; Eff (Getline ': r) w -&gt; Eff r w\nrunGetline (Val x) = return x\nrunGetline (E u q) = case decomp u of\n  Right Getline -&gt; doIO getLine &gt;&gt;= runGetline . qApp q\n  Left u1       -&gt; E u1 (tsingleton (runGetline . qApp q))\n\n--------------------------------------------------------------------------------\n\ndata Putline a where\n  Putline :: String -&gt; Putline ()\n\nrunPutline :: Member IO r =&gt; Eff (Putline ': r) w -&gt; Eff r w\nrunPutline (Val x) = return x\nrunPutline (E u q) = case decomp u of\n  Right (Putline s) -&gt; doIO (putStrLn s) &gt;&gt; runPutline (qApp q ())\n  Left u1           -&gt; E u1 (tsingleton (runPutline . qApp q))\n\nputline :: Member Putline r =&gt; String -&gt; Eff r ()\nputline = send . Putline\n\n--------------------------------------------------------------------------------\n\n-- Similar to Putline, but we provide a logger when running\n\ndata Logger\n\ndefaultLogger :: Logger\ndefaultLogger = undefined\n\nlogToHandle :: Logger -&gt; String -&gt; IO ()\nlogToHandle _ s = putStrLn (\"logging: \" ++ show s)\n\n-- Log using a logger\ndata Log a where\n  Log :: String -&gt; Log ()\n\nlog :: Member Log r =&gt; String -&gt; Eff r ()\nlog = send . Log\n\nrunLog :: Member IO r =&gt; Logger -&gt; Eff (Log ': r) w -&gt; Eff r w\nrunLog _      (Val x) = return x\nrunLog logger (E u q) = case decomp u of\n  Right (Log s) -&gt; doIO (logToHandle logger s) &gt;&gt; runLog logger (qApp q ())\n  Left u1       -&gt; E u1 (tsingleton (runLog logger . qApp q))\n\n--------------------------------------------------------------------------------\n\n-- Database read\n\ndata User = User { username :: String }\n  deriving (Show)\n\ndata ReadDb a where\n  GetUsers          :: ReadDb [User]\n  GetUserByUsername :: String -&gt; ReadDb (Maybe User)\n\ngetUsers :: Member ReadDb r =&gt; Eff r [User]\ngetUsers = send GetUsers\n\ngetUserByUsername :: Member ReadDb r =&gt; String -&gt; Eff r (Maybe User)\ngetUserByUsername = send . GetUserByUsername\n\ndata SqlBackend = SqlBackend\n\ngetUsers_db :: SqlBackend -&gt; IO [User]\ngetUsers_db _ = return [User \"user1\"]\n\ngetUserByUsername_db :: SqlBackend -&gt; String -&gt; IO (Maybe User)\ngetUserByUsername_db _ uname = return (Just (User uname))\n\nrunReadDb :: Member IO r =&gt; SqlBackend -&gt; Eff (ReadDb ': r) w -&gt; Eff r w\nrunReadDb _  (Val x) = return x\nrunReadDb db (E u q) = case decomp u of\n  Right GetUsers -&gt; doIO (getUsers_db db) &gt;&gt;= runReadDb db . qApp q\n  Right (GetUserByUsername uname) -&gt; doIO (getUserByUsername_db db uname) &gt;&gt;= runReadDb db . qApp q\n  Left u1 -&gt; E u1 (tsingleton (runReadDb db . qApp q))\n\n--------------------------------------------------------------------------------\n\nmyEff :: (Member Log r, Member Putline r, Member Getline r, Member ReadDb r) =&gt; Eff r ()\nmyEff = do\n  ln &lt;- getline\n  putline ln\n  putline \"done\"\n  log \"logging stuff\"\n  putline \"reading db\"\n  users &lt;- getUsers\n  log (show users)\n\nmain :: IO ()\nmain = runM $ runLog defaultLogger $ runPutline $ runGetline $ runReadDb SqlBackend myEff\n</code></pre>\n"}], "owner": {"reputation": 6262, "user_id": 691032, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04fa8b0cca5a7dfef2d281be67a2b7a2?s=128&d=identicon&r=PG", "display_name": "sinan", "link": "https://stackoverflow.com/users/691032/sinan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 1, "accepted_answer_id": 42185894, "answer_count": 2, "score": 2, "last_activity_date": 1486897680, "creation_date": 1486808744, "question_id": 42174785, "link": "https://stackoverflow.com/questions/42174785/multiple-io-effects-in-eff-or-other-ways-for-composable-effects", "title": "Multiple IO effects in Eff (or other ways for composable effects)", "body": "<p>I want to restrict effects of functions in my program as much as possible so that\ne.g. if I have a function that's supposed to query a DB I know it won't be\nprinting stuff for deleting my files.</p>\n\n<p>As a concrete example let's say I have a database with a \"users\" table.</p>\n\n<p>Some of the functions only read this table, some of the functions read and write.</p>\n\n<p>With mtl and transformers I can try something like this:</p>\n\n<pre><code>data User = User { username :: String }\n  deriving (Show)\n\nclass Monad m =&gt; ReadDb m where\n  getUsers      :: m [User]\n  getUserByName :: String -&gt; m (Maybe User)\n\nclass Monad m =&gt; WriteDb m where\n  addUser    :: String -&gt; m ()\n  removeUser :: String -&gt; m Bool\n</code></pre>\n\n<p>However implementing the instances I need is tricky, if not impossible. To be\nable to access the DB I need a <code>SqlBackend</code> and IO:</p>\n\n<pre><code>data SqlBackend\n\ninstance (MonadReader SqlBackend m, MonadIO m, Monad m) =&gt; ReadDb m where\n  getUsers = undefined\n  getUserByName = undefined\n\ninstance (MonadReader SqlBackend m, MonadIO m, Monad m) =&gt; WriteDb m where\n  addUser = undefined\n  removeUser = undefined\n</code></pre>\n\n<p>With <code>UndecidableInstances</code> this works fine. However, let's say I also need\nlogging, and no, I won't collect log strings in a <code>[String]</code> or anything like\nthat. The logger should efficiently log, and logging messages should appear in\nreal time.</p>\n\n<p>So I may do something like this:</p>\n\n<pre><code>class Monad m =&gt; Log m where\n  log :: String -&gt; m ()\n</code></pre>\n\n<p>Logging needs a <code>Logger</code>, so I may define an instance like</p>\n\n<pre><code>data Logger\n\ninstance (MonadReader Logger m, MonadIO m, Monad m) =&gt; Log m where\n  log = undefined\n</code></pre>\n\n<p>Now a function that reads the db and logs would look like this:</p>\n\n<pre><code>logUsers :: (ReadDb m, Log m) =&gt; m ()\nlogUsers = getUsers &gt;&gt;= log . show\n</code></pre>\n\n<p>But unfortunately I can't really run this because I need to provide\n<code>MonadReader SqlBackend m</code> and <code>MonadReader Logger m</code>, which is not possible\nbecause of the functional dependency <code>MonadReader r m | m -&gt; r</code>.</p>\n\n<p>There are workarounds (like implementing a different typeclass just to get\n<code>Logger</code> and <code>SqlBackend</code>), but they involve too much boilerplate.</p>\n\n<p>As an alternative I wanted to try Oleg's extensible effect library (the Eff\nmonad, implemented here <a href=\"http://okmij.org/ftp/Haskell/extensible/Eff.hs\" rel=\"nofollow noreferrer\">http://okmij.org/ftp/Haskell/extensible/Eff.hs</a>). The\ntrouble is, as far as I understand, multiple effects that need to be handled in\nIO can't be implemented in a composable way in <code>Eff</code>. For example, the <code>Trace</code>\neffect in the library is implemented like this:</p>\n\n<pre><code>data Trace\n\nrunTrace :: Eff (Trace :&gt; Void) w -&gt; IO w\n</code></pre>\n\n<p><code>Void</code> part is the problem here. In my example I want to handle read, write and\nlogging operations separately, and functions should be able to have\nfine-grained types that allow any subset of these effects.</p>\n\n<p>One thing comes to mind here is <code>Free</code>, but I'm not sure how to define functors\nfor these effects, and then compose them so that for example a function that\nlogs will be able to call another function that doesn't log but otherwise has\nsame effects.</p>\n\n<p>So my question is: How do I get fine-grained effect types in my program, with\neffect handlers that actually compose. Effect handlers should be able to run in\nIO. Let's say performance is not a concern (so <code>Free</code> etc. is OK).</p>\n"}, {"tags": ["haskell", "frege"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1486801288, "post_id": 42173776, "comment_id": 71511563, "body": "You may need to add parens around the <code>(baz, zab):foobar</code> pattern. Something like <code>foo bar ((baz, zab):foobar)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 469, "user_id": 929708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b27508cc9f5781c1b9e836733a5ed9?s=128&d=identicon&r=PG", "display_name": "JJ Brown", "link": "https://stackoverflow.com/users/929708/jj-brown"}, "edited": false, "score": 0, "creation_date": 1487393973, "post_id": 42174927, "comment_id": 71777141, "body": "That makes so much sense. Thank you for the detailed answer!"}], "tags": [], "owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "is_accepted": true, "score": 2, "last_activity_date": 1486809839, "creation_date": 1486809839, "answer_id": 42174927, "question_id": 42173776, "link": "https://stackoverflow.com/questions/42173776/how-to-define-multiple-patterns-in-frege/42174927#42174927", "title": "How to define multiple patterns in Frege?", "body": "<p>This is a pure syntactical problem that affects newcomers to languages of the Haskell family. It won't take too long until you internalize the  rule that function application has higher precedence than infix expression.</p>\n\n<p>This has consequences:</p>\n\n<ul>\n<li>Complex arguments of function application need parentheses.</li>\n<li>In infix expressions, function applications on either side of the operator do not need parentheses (however, individual components of function application may still need them).</li>\n</ul>\n\n<p>In Frege, in addition, the following rule holds:</p>\n\n<blockquote>\n  <p>The syntax of function application and infix expressions on the left hand side of a definition is identical to the one on the right hand side as far as lexemes allowed on both sides are concerned. (This holds in Haskell only when <code>@</code> and <code>~</code> are not used.)</p>\n</blockquote>\n\n<p>This is so you can define an addition function like this:</p>\n\n<pre><code>data Number = Z | Succ Number\n\na + Z      = a\na + Succ b = Succ a + b\n</code></pre>\n\n<p>Hence, when you apply this to your example, you see that syntactically, you're going to redefine the <code>:</code> operator. To achieve what you want, you need to write it thus:</p>\n\n<pre><code>foo bar ((baz, zab):foobar) = ....\n--      ^                 ^\n</code></pre>\n\n<p>This corresponds to the situation where you apply <code>foo</code> to a list you are constructing:</p>\n\n<pre><code>foo 42 (x:xs)\n</code></pre>\n\n<p>When you write</p>\n\n<pre><code>foo 42 x:xs\n</code></pre>\n\n<p>this means</p>\n\n<pre><code>(foo 42 x):xs\n</code></pre>\n"}], "owner": {"reputation": 469, "user_id": 929708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5b27508cc9f5781c1b9e836733a5ed9?s=128&d=identicon&r=PG", "display_name": "JJ Brown", "link": "https://stackoverflow.com/users/929708/jj-brown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 42174927, "answer_count": 1, "score": 1, "last_activity_date": 1486809839, "creation_date": 1486801007, "question_id": 42173776, "link": "https://stackoverflow.com/questions/42173776/how-to-define-multiple-patterns-in-frege", "title": "How to define multiple patterns in Frege?", "body": "<p>I'm having some trouble defining a function in <a href=\"https://github.com/Frege/frege\" rel=\"nofollow noreferrer\">Frege</a> that uses multiple patterns. Basically, I'm defining a mapping by iterating through a list of tuples. I've simplified it down to the following:</p>\n\n<pre><code>foo :: a -&gt; [(a, b)] -&gt; b\nfoo _ [] = [] --nothing found\nfoo bar (baz, zab):foobar\n | bar == baz = zab\n | otherwise  = foo bar foobar\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>E morse.fr:3: redefinition of `foo` introduced line 2\n</code></pre>\n\n<p>I've seen other examples like <a href=\"https://github.com/Dierk/Real_World_Frege/blob/master/src/main/frege/realworld/experiments/Oopsie.fr\" rel=\"nofollow noreferrer\">this</a> that do use multiple patterns in a function definition, so I don't know what I'm doing wrong. Why am I getting an error here? I'm new to Frege (and new to Haskell), so there may be something simple I'm missing, but I really don't think this should be a problem.</p>\n\n<p>I'm compiling with version 3.24-7.100.</p>\n"}, {"tags": ["haskell", "monads", "lazy-evaluation", "conduit", "strictness"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1486792757, "post_id": 42172611, "comment_id": 71509916, "body": "In general, this is a tough problem. For random numbers in particular, there is an easy way out: <code>randoms &lt;$&gt; newStdGen :: Random a =&gt; IO [a]</code> is an infinite random list of whatever you want (that is <code>Random</code>)."}, {"owner": {"reputation": 163, "user_id": 6537490, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bsZw5ZZcyZ4/AAAAAAAAAAI/AAAAAAAADmE/v8mpEJ7ks_o/photo.jpg?sz=128", "display_name": "Douglas Vieira", "link": "https://stackoverflow.com/users/6537490/douglas-vieira"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486793596, "post_id": 42172611, "comment_id": 71510065, "body": "@Alec Thanks for the comment. I am using <code>randomIO</code> here just for simplicity of the examples. In practice, I would like to process messages received via sockets."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486793645, "post_id": 42172611, "comment_id": 71510075, "body": "So something like the infinite list of messages received from a socket?"}, {"owner": {"reputation": 163, "user_id": 6537490, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bsZw5ZZcyZ4/AAAAAAAAAAI/AAAAAAAADmE/v8mpEJ7ks_o/photo.jpg?sz=128", "display_name": "Douglas Vieira", "link": "https://stackoverflow.com/users/6537490/douglas-vieira"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486795042, "post_id": 42172611, "comment_id": 71510323, "body": "@Alec Exactly. More specifically, instead of <code>randomIO</code>, I am using <code>receive sock</code> where <code>sock</code> is a ZeroMQ <code>Socket z</code> monad (see <a href=\"https://hackage.haskell.org/package/zeromq4-haskell-0.6.5/docs/System-ZMQ4-Monadic.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/zeromq4-haskell-0.6.5/docs/&hellip;</a> )"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1486857394, "post_id": 42172611, "comment_id": 71528001, "body": "@DouglasVieira in the <code>conduit</code> program, shouldn&#39;t you be using <code>take</code> inside the conduit? <code>&gt;&gt;&gt; runConduit $ sourceRandom .| takeC 5 .| sinkList :: IO [Bool]</code> gives me <code>[False,False,False,False,True]</code> Here <code>sourceRandom</code> is standing in for your stream of messages, but the pure case works as well. Really a list shouldn&#39;t be constructed, you should do whatever you were going to do with it inside the conduit."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1486892153, "post_id": 42172611, "comment_id": 71534281, "body": "I don&#39;t think lazyiness can explain this, by the way. <code>Maybe</code> is lazy, but <code>take 5 &lt;$&gt; sequence (repeat $ Just 1) :: Maybe [Int]</code> also hangs since if the zillionth element of the list were <code>Nothing</code>, it would return <code>Nothing</code>. Similarly <code>take 5 &lt;$&gt; sequence (repeat  [1]) :: [[Int]]</code> would be <code>[]</code> if somewhere in the list of lists there&#39;s an empty list."}, {"owner": {"reputation": 163, "user_id": 6537490, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bsZw5ZZcyZ4/AAAAAAAAAAI/AAAAAAAADmE/v8mpEJ7ks_o/photo.jpg?sz=128", "display_name": "Douglas Vieira", "link": "https://stackoverflow.com/users/6537490/douglas-vieira"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1486918472, "post_id": 42172611, "comment_id": 71542609, "body": "@Michael Regarding your first comment, see my comment on @duplode&#39;s answer. Regarding your second comment, I do not see exactly the point. For the <code>Maybe</code> monad, I guess the problem is that only possible fixed point in the monadic context (between <code>Just a</code> or <code>Nothing</code>) is <code>Nothing</code>, so <code>sequence</code>ing an infinite list of <code>Just a</code>s will just hang forever. <code>Identity a</code> does not have this issue because the fixed point of the monadic context is already <code>Identity a</code> (the same intuitively would also apply for <code>IO a</code> if there were no side-effects)."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 1, "creation_date": 1486920717, "post_id": 42172611, "comment_id": 71543494, "body": "My point was about strict v lazy. Identity is by the way maximally strict since it is a newtype. I think you just have to work through the definition of <code>sequence</code> i.e. <code>foldr (\\m ms -&gt; (:) &lt;$&gt; m &lt;*&gt; ms) (pure [])</code> together with the monad (applicative) implementation in each concrete case to see why in <code>Identity</code> things go so swimmingly and in <code>IO</code> (so often) badly.  It is basically to avoid <code>sequence</code> that we have the streaming libraries. From the point of view of the streaming libraries, <code>sequence</code>  <code>mapM</code> <code>replicateM</code> etc. for IO + lists are the fundamental red flags."}, {"owner": {"reputation": 163, "user_id": 6537490, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bsZw5ZZcyZ4/AAAAAAAAAAI/AAAAAAAADmE/v8mpEJ7ks_o/photo.jpg?sz=128", "display_name": "Douglas Vieira", "link": "https://stackoverflow.com/users/6537490/douglas-vieira"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1486926131, "post_id": 42172611, "comment_id": 71545617, "body": "@Michael Now I see, good point! Some examples illustrates the strictness property that you mentioned: <code>seq (return undefined :: Identity ()) ()</code>, <code>seq (return undefined :: Maybe ()) ()</code>, <code>seq (return undefined :: IO ()) ()</code>. As you pointed out, the case with <code>Identity</code> throws an error, as it is defined as a newtype. Interestingly, the case with <code>IO</code> does not throw an error, although <code>print 1 &gt;&gt; return ()</code> does print <code>1</code> in the terminal. In <a href=\"http://stackoverflow.com/a/14496898/6537490\">John L&#39;s answer</a>, he mentions the strictness of <code>(&gt;&gt;=)</code>, which is the one that plays a role here."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1486927583, "post_id": 42172611, "comment_id": 71546162, "body": "With  <code>Control.Monad.Trans.State.Lazy</code> if I write <code>a = take 5 &lt;$&gt; sequence (repeat $ return 1) :: StateT () Identity [Int]</code> I can write <code>&gt;&gt;&gt; evalStateT a ()</code> and manage to get <code>Identity [1,1,1,1,1]</code> with <code>&gt;&gt;&gt; runStateT a ()</code> I get <code>Identity ([1,1,1,1,1], </code> and it pauses while it tries to get the () at the end of the rainbow - so there comes a stack overflow.  With <code>Control.Monad.Trans.State.Strict</code> both end up in a stack overflow. <code>sequence</code> is really pretty toxic for lists, though there are uses of course."}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 6537490, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bsZw5ZZcyZ4/AAAAAAAAAAI/AAAAAAAADmE/v8mpEJ7ks_o/photo.jpg?sz=128", "display_name": "Douglas Vieira", "link": "https://stackoverflow.com/users/6537490/douglas-vieira"}, "edited": false, "score": 0, "creation_date": 1486796139, "post_id": 42173117, "comment_id": 71510554, "body": "Thanks a lot for this explanation. Could you elaborate more on: 1. How to address this issue for a general monad transformed from <code>IO</code>? 2. Why the <code>mdo</code> approach gave repeated values?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 163, "user_id": 6537490, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bsZw5ZZcyZ4/AAAAAAAAAAI/AAAAAAAADmE/v8mpEJ7ks_o/photo.jpg?sz=128", "display_name": "Douglas Vieira", "link": "https://stackoverflow.com/users/6537490/douglas-vieira"}, "edited": false, "score": 1, "creation_date": 1486797064, "post_id": 42173117, "comment_id": 71510760, "body": "@DouglasVieira 1. I don&#39;t think you can in general - monads are meant to encode that nature of sequencing 2. <code>mdo</code> desugars to use <code>fixIO</code> and <code>fixIO</code> confusingly only evaluates its action <i>once</i> (looking at the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/System.IO.html#fixIO\" rel=\"nofollow noreferrer\">source</a> may be helpful). Even if you had managed to write something that really should have returned a list, you would have hit your head against an even more confusing <code>MVar</code> related error message (or worse yet - a hanging program)."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 163, "user_id": 6537490, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bsZw5ZZcyZ4/AAAAAAAAAAI/AAAAAAAADmE/v8mpEJ7ks_o/photo.jpg?sz=128", "display_name": "Douglas Vieira", "link": "https://stackoverflow.com/users/6537490/douglas-vieira"}, "edited": false, "score": 0, "creation_date": 1486797227, "post_id": 42173117, "comment_id": 71510802, "body": "@DouglasVieira With respect to 1. - I see that the package you linked also exposes <code>IO</code> functions. You could use those and <code>unsafeInterleaveIO</code> to get your list, then <code>liftIO</code> back into your desired monad."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1486796960, "last_edit_date": 1486796960, "creation_date": 1486795227, "answer_id": 42173117, "question_id": 42172611, "link": "https://stackoverflow.com/questions/42172611/operating-infinite-lists-with-strict-monads/42173117#42173117", "title": "Operating infinite lists with strict monads", "body": "<blockquote>\n  <p>I am using randomIO here just for simplicity of the examples. In practice, I would like to process messages received via sockets</p>\n</blockquote>\n\n<p><em>That</em> is not possible without <code>unsafeInterleaveIO</code>. The problem at the end of the day is that <code>IO</code> actions must be sequenced. While the order of evaluation for referentially transparent values doesn't matter, that of <code>IO</code> actions may. If you want a lazy infinite list of all the messages received over a socket, you have to inform Haskell a priori where in the sequence of <code>IO</code> actions this fits (unless you use <code>unsafeInterleaveIO</code>).</p>\n\n<p>The <code>Arrow</code> abstraction you are seeking is called <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Arrow.html#t:ArrowLoop\" rel=\"nofollow noreferrer\"><code>ArrowLoop</code></a>, but it too has a problem with the <em>right tightening law</em> for strict monads.</p>\n\n<p>At first sight, it may look like <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Control-Monad-Fix.html\" rel=\"nofollow noreferrer\"><code>MonadFix</code></a> (manifested via <code>mdo</code> or <code>mfix</code>) is a solution too, but digging a bit deeper <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/src/System.IO.html#fixIO\" rel=\"nofollow noreferrer\">shows that <code>fixIO</code> has problems</a>, just like <code>loop</code> from <code>ArrowLoop</code>.</p>\n\n<p>However, sometimes the restriction that <code>IO</code> actions must be run one after another is a bit excessive and that is what <code>unsafeInterleaveIO</code> is for. Quoting the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/System-IO-Unsafe.html#v:unsafeInterleaveIO\" rel=\"nofollow noreferrer\">docs</a></p>\n\n<blockquote>\n  <p><code>unsafeInterleaveIO</code> allows <code>IO</code> computation to be deferred lazily. When passed a value of type <code>IO a</code>, the <code>IO</code> will only be performed when the value of the <code>a</code> is demanded.</p>\n</blockquote>\n\n<hr>\n\n<p>Now, even if you explicitly said that you <em>didn't</em> want an <code>unsafeInterleaveIO</code> solution, as I have hopefully managed to convince you it is the way to go, here it is:</p>\n\n<pre><code>interweavingRepeatM :: IO a -&gt; IO [a]\ninterweavingRepeatM action = unsafeInterleaveIO ((:) &lt;$&gt; action &lt;*&gt; interweavingRepeatM action)\n</code></pre>\n\n<p>And here is is working for random numbers:</p>\n\n<pre><code>ghci&gt; import System.Random\nghci&gt; sourceOfRandomness &lt;- interweavingRepeatM randomIO :: IO [Integer]\nghci&gt; take 10 sourceOfRandomness\n[-2002742716261662204,7803971943047671004,-8395318556488893887,-7372674153585794391,5906750628663631621,6428130029392850107,6453903217221537923,-8966011929671667536,6419977320189968675,-1842456468700051776]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 163, "user_id": 6537490, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bsZw5ZZcyZ4/AAAAAAAAAAI/AAAAAAAADmE/v8mpEJ7ks_o/photo.jpg?sz=128", "display_name": "Douglas Vieira", "link": "https://stackoverflow.com/users/6537490/douglas-vieira"}, "edited": false, "score": 0, "creation_date": 1486913450, "post_id": 42183883, "comment_id": 71540693, "body": "Thanks for the clarification regarding <code>Conduit</code>. The problem, however, is that is that I want a solution to work on an arbitrary function <code>f :: [a] -&gt; b</code> that really operates on (infinite) lists. Therefore, as you pointed out, <code>Conduit</code> is not the solution I am looking for. Even worse, as pointed out by @Alec, there is no solution to the general case. To give more context, I was trying to work on a simple implementation of Functional Reactive Programming, where the primitive type <code>Event :: Ord t =&gt; [(t, a)]</code> is an infinite list ordered by time (i.e. I actually wanted <code>f :: Event -&gt; b</code>)."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1486921840, "post_id": 42183883, "comment_id": 71543957, "body": "The functions <code>f</code> that you actually mention - &quot;(e.g. take 5, takeWhile (&lt; 100) . scanl (+) 0 and so on)&quot; - are elementary stream transformations that all really operate on infinite streams. You haven&#39;t given a reason why you are using infinite lists rather than streams, which support almost the whole api of <code>Data.List</code> without needing <code>sequence</code> and co. That sequence can&#39;t be salvaged &#39;in the general case&#39; is the whole point."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": false, "score": 3, "last_activity_date": 1486870671, "last_edit_date": 1592644375, "creation_date": 1486869769, "answer_id": 42183883, "question_id": 42172611, "link": "https://stackoverflow.com/questions/42172611/operating-infinite-lists-with-strict-monads/42183883#42183883", "title": "Operating infinite lists with strict monads", "body": "<p><a href=\"https://stackoverflow.com/a/42173117/2751851\">Alec's answer</a> covers your general question. What follows is specifically about <em>conduit</em> and similar streaming libraries.</p>\n<blockquote>\n<p>I also tried a <code>Conduit</code> approach which did not work either even in the <code>Identity</code> case:</p>\n<pre><code>import Conduit\n\nrunConduitPure $ yieldMany [1..] .| sinkList &gt;&gt;= return . take 5\n</code></pre>\n</blockquote>\n<p>While streaming libraries are commonly used to avoid the sort of difficulty you mention (cf. the opening remarks of <a href=\"https://hackage.haskell.org/package/pipes-4.3.2/docs/Pipes-Tutorial.html\" rel=\"nofollow noreferrer\"><code>Pipes.Tutorial</code></a>), they assume you will use their stream types <em>instead of</em> lists. Consider, for instance, how <a href=\"https://hackage.haskell.org/package/conduit-combinators-1.1.0/docs/Conduit.html#v:sinkList\" rel=\"nofollow noreferrer\"><code>sinkList</code></a> is described by the <code>Conduit</code> documentation:</p>\n<blockquote>\n<p>Consume all values from the stream and return as a list. Note that this will pull all values into memory.</p>\n</blockquote>\n<p>That means using <code>sinkMany</code> immediately after <code>yieldMany</code> brings you back to square one: bringing all values into memory is precisely what makes the combination of <code>sequence</code>, <code>IO</code> and infinite lists unusable. What you should do instead is using the infrastructure of the streaming library to build the stages of your pipeline. Here are a few simple examples using mostly ready-made things from <em>conduit</em> and <em>conduit-combinators</em>:</p>\n<pre><code>GHCi&gt; import Conduit\nGHCi&gt; runConduitPure $ yieldMany [1..] .| takeC 5 .| sinkList\n[1,2,3,4,5]\nGHCi&gt; runConduit $ yieldMany [1..] .| takeC 5 .| printC -- try it without takeC\n1\n2\n3\n4\n5\nGHCi&gt; runConduit $ yieldMany [1..] .| takeC 5 .| scanlC (+) 0 .| printC\n0\n1\n3\n6\n10\n15\nGHCi&gt; :{\nGHCi| runConduit $ yieldMany [1..] .| takeC 5\nGHCi|     .| awaitForever (\\x -&gt; liftIO (print (2*x)) &gt;&gt; yield x)\nGHCi|     .| printC\nGHCi| :}\n2\n1\n4\n2\n6\n3\n8\n4\n10\n5\nGHCi&gt; runConduit $ (sourceRandom :: Producer IO Int) .| takeC 5 .| printC \n1652736016140975126\n5518223062916052424\n-1236337270682979278\n8079753510915129274\n-609160753105692151\n</code></pre>\n<p>(Thanks <a href=\"https://stackoverflow.com/users/183792/michael\">Michael</a> for making me notice <code>sourceRandom</code> -- at first I had rolled my own with <code>repeatMC randomIO</code>.)</p>\n"}], "owner": {"reputation": 163, "user_id": 6537490, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bsZw5ZZcyZ4/AAAAAAAAAAI/AAAAAAAADmE/v8mpEJ7ks_o/photo.jpg?sz=128", "display_name": "Douglas Vieira", "link": "https://stackoverflow.com/users/6537490/douglas-vieira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "accepted_answer_id": 42173117, "answer_count": 2, "score": 3, "last_activity_date": 1486870671, "creation_date": 1486791169, "last_edit_date": 1495540902, "question_id": 42172611, "link": "https://stackoverflow.com/questions/42172611/operating-infinite-lists-with-strict-monads", "title": "Operating infinite lists with strict monads", "body": "<p>I have a function <code>f :: [a] -&gt; b</code> that operates on infinite lists (e.g. <code>take 5</code>, <code>takeWhile (&lt; 100) . scanl (+) 0</code> and so on). I want to feed this function with values generated by strict monadic actions (e.g. <code>randomIO</code>).</p>\n\n<p>From <a href=\"https://stackoverflow.com/questions/14494648/why-the-haskell-sequence-function-cant-be-lazy-or-why-recursive-monadic-functio\">this question</a>, I've learned that the <code>repeat</code> and <code>sequence</code> trick approach does not work for strict monads, as the example below show:</p>\n\n<pre><code>import Control.Monad.Identity\n\ntake 5 &lt;$&gt; sequence (repeat $ return 1) :: Identity [Int]\n-- returns `Identity [1,1,1,1,1]`\n-- works because Identity is non-strict\n\ntake 5 &lt;$&gt; sequence (repeat $ return 1) :: IO [Int]\n -- returns `*** Exception: stack overflow`\n -- does not work because IO is strict\n</code></pre>\n\n<p>So, instead, I thought about using the function \"inside\" the monadic context. I was inspired by this <a href=\"https://ocharles.org.uk/blog/posts/2014-12-09-recursive-do.html\" rel=\"nofollow noreferrer\">circular programming example</a> and tried:</p>\n\n<pre><code>let loop = do\n       x &lt;- return 1\n       (_, xs) &lt;- loop\n       return (take 5 xs, x:xs)\nin  fst loop :: Identity [Int]\n-- Overflows the stack\n</code></pre>\n\n<p>and</p>\n\n<pre><code>import Control.Monad.Fix\n\nfst &lt;$&gt; mfix (\\(_, xs) -&gt; do\n   x &lt;- return 1\n   return (take 5 xs, x:xs)) :: Identity [Int]\n-- Overflows the stack\n</code></pre>\n\n<p>and even</p>\n\n<pre><code>{-# LANGUAGE RecursiveDo #-}\nimport System.Random\n\nloop' = mdo\n   (xs', xs) &lt;- loop xs\n   return xs'\nwhere loop xs = do\n      x &lt;- randomIO\n      return (take 5 xs, x:xs)\n\nprint $ loop'\n-- Returns a list of 5 identical values\n</code></pre>\n\n<p>But none of these works. I also tried a <code>Conduit</code> approach which did not work either even in the <code>Identity</code> case:</p>\n\n<pre><code>import Conduit\n\nrunConduitPure $ yieldMany [1..] .| sinkList &gt;&gt;= return . take 5\n</code></pre>\n\n<p>Therefore I would like to know:</p>\n\n<ol>\n<li><p>Why none of the \"circular\" approaches above work?</p></li>\n<li><p>If there exists a solution to this that does not involve <code>unsafeInterleaveIO</code>. (maybe <code>iteratee</code>s, <code>Arrow</code>s?)</p></li>\n</ol>\n"}, {"tags": ["haskell", "dictionary"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486790311, "post_id": 42172366, "comment_id": 71509464, "body": "A <code>HashMap</code> key doesn&#39;t need <code>Ord</code> - only a <code>Map</code>. What are you actually trying to do?"}], "answers": [{"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1486792620, "post_id": 42172659, "comment_id": 71509884, "body": "Why I did not consider forwarding to the type&#39;s own <code>Eq</code> I do not know.... sometimes we&#39;re too attached to something being hard"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 1, "creation_date": 1486793102, "post_id": 42172659, "comment_id": 71509975, "body": "@luqui Been there too. :) On a separate note, <code>hetero-map</code>  is pretty neat. Nice use of rank 2 types."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 5, "last_activity_date": 1486792923, "last_edit_date": 1486792923, "creation_date": 1486791547, "answer_id": 42172659, "question_id": 42172366, "link": "https://stackoverflow.com/questions/42172366/can-i-use-unsafecorce-as-hashkey-comaprison-key-for-existential-typeclass/42172659#42172659", "title": "Can I use unsafecorce as hashkey/comaprison key for existential typeclass?", "body": "<p>It isn't clear to me what you are looking for (and it may not be either to you). Here is how you can implement <code>Eq</code> and <code>Hashable</code> for your existential datatype.</p>\n\n<p>You will need to add a <code>Hashable</code>, <code>Typeable</code>, and <code>Eq</code> constraint to the existential (in addition to whatever other constraints you wanted there in the first place - I'll use <code>Show</code>).</p>\n\n<pre><code>import Data.Typeable\nimport Data.Hashable\n\ndata SomeId = forall a. (Show a, Hashable a, Eq a, Typeable a) =&gt; SomeId a\n\n-- This instance uses the fact 'SomeId' wraps types that have and 'Eq' and \n-- a 'Typeable' constraint\ninstance Eq SomeId where\n  SomeId a == SomeId b = maybe False (a ==) (cast b)\n\n-- This instance uses the fact 'SomeId' wraps types that have 'Hashable' constraints\ninstance Hashable SomeId where\n  hashWithSalt s (SomeId a) = 0xdeadbeef * hashWithSalt s a\n</code></pre>\n\n<p>And, for debugging purposes:</p>\n\n<pre><code>instance Show SomeId where\n  show (SomeId x) = show x\n</code></pre>\n\n<p>Now, I can use <code>SomeId</code> as the key in a <code>HashMap</code>. For example,</p>\n\n<pre><code>ghci&gt; import qualified Data.HashMap.Strict as H\nghci&gt; hashMap = H.fromList [(SomeId 1, \"one\"), (SomeId (), \"unit\"), (SomeId \"s\", \"string\")]\nghci&gt; H.lookup (SomeId 1) hashMap\nJust \"one\"\nghci&gt; H.lookup (SomeId ()) hashMap\nJust \"unit\"\nghci&gt; H.lookup (SomeId \"s\") hashMap\nJust \"string\nghci&gt; H.lookup (SomeId 2) hashMap\nNothing\nghci&gt; H.lookup (SomeId True) hashMap\nNothing\n</code></pre>\n\n<p>As a final remark: note that of the initial constraints you are putting on <code>SomeId</code>, <code>Typeable</code> and <code>Eq</code> are both derivable so satisfying those bounds isn't nearly as difficult as it may seem initially.</p>\n\n<hr>\n\n<p>In case it isn't clear, I am showing you an alternative to your <code>unsafeCoerce</code>. That approach is... not advisable. In particular, it</p>\n\n<ul>\n<li>violates referential transparency in general</li>\n<li>completely disregards all of the laws for <code>Eq</code> and <code>Ord</code></li>\n</ul>\n\n<p>In short - it won't work, and even if it did it would create a whole host of difficult to replicate and confusing errors.</p>\n"}, {"tags": [], "owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "is_accepted": false, "score": 4, "last_activity_date": 1486792348, "last_edit_date": 1486792348, "creation_date": 1486791645, "answer_id": 42172675, "question_id": 42172366, "link": "https://stackoverflow.com/questions/42172366/can-i-use-unsafecorce-as-hashkey-comaprison-key-for-existential-typeclass/42172675#42172675", "title": "Can I use unsafecorce as hashkey/comaprison key for existential typeclass?", "body": "<p>This is awful and you absolutely should not do this.  The <code>unsafeCoerce</code> here could return different values depending on whether the expression has been evaluated yet, if GC decides to move the object (and GHC has a compacting collector AFAIK, so that will happen all the time), maybe even depend on objects that have nothing to do with it by reading past the end.  Terrible, terrible idea, this.</p>\n\n<p>Referential equality tests, like you see in most imperative languages</p>\n\n<pre><code>var foo = Object();\nvar bar = Object();\nfoo === foo   // true\nfoo === bar   // false\n</code></pre>\n\n<p>are not possible in Haskell, because of <em>referential transparency</em>, which says that you can always substitute a variable with its definition and nothing will change.  If the language which shall not be named had referential transparency, you could replace that code with:</p>\n\n<pre><code> Object() === Object()  // true\n Object() === Object()  // false\n</code></pre>\n\n<p>which is clearly a contradiction.  Referential transparency is one of the things that makes Haskell so nice to work with, but unfortunately, if I'm inferring what you're trying to do, it's going to make it impossible.  I recommend against circumventing referential transparency (which you can do using <code>unsafePerformIO</code>) -- Haskell is <em>extremely</em> hard to reason about without it -- the whole language is built around that assumption.</p>\n\n<p>So with that caveat, here are some notes anyhow for funzies, since I have been down this particular rabbit hole.</p>\n\n<p>It looks to me like you're modeling a map from <code>Id</code>s to the objects they refer to, and this map can be polymorphic.  I.e. maybe you want functions like:</p>\n\n<pre><code>insert :: SomeClass a =&gt; a -&gt; MyMap -&gt; (SomeId, MyMap)\nlookup :: MyMap -&gt; SomeId -&gt; ???\n</code></pre>\n\n<p>with some suitable value of <code>???</code> which is impossible because we have forgotten the type information.  You could use <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Dynamic.html\" rel=\"nofollow noreferrer\"><code>Data.Dynamic</code></a>, I suppose:</p>\n\n<pre><code>lookup :: MyMap -&gt; SomeId -&gt; Maybe Dynamic\n</code></pre>\n\n<p>Depending on what you want to do.  This is going to involve a lot of casting and you are basically throwing static type safety out the window by doing this.</p>\n\n<p>Maybe you want to consider typed identifiers?</p>\n\n<pre><code>insert :: SomeClass a =&gt; a -&gt; MyMap -&gt; (SomeId a, MyMap)\nlookup :: MyMap -&gt; SomeId a -&gt; Maybe a\n</code></pre>\n\n<p>If you have <code>SomeClass</code> require some <em>unique</em> \"hash\" generation function (and it is really guaranteed to be unique even across types) then you can make this API work.  If there is a collision, then you get a bad <code>unsafeCoerce</code> error (e.g. try <code>unsafeCoerce 42 \"foo\" :: String</code> in ghci).  You can ease some of that pain by adding a <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Typeable.html#t:TypeRep\" rel=\"nofollow noreferrer\"><code>TypeRep</code></a> into your Id type, but you'll still have to decide how to hash the values yourself. </p>\n\n<p>You could pair the value with a freshly generated <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Unique.html\" rel=\"nofollow noreferrer\"><code>Unique</code></a> when you make the key, using <code>unsafePerformIO</code>, but you will violate referential transparency if you do this, since if you generate two keys with the same value, they will compare different, which is nonsense in a pure language.</p>\n\n<p>Basically, the whole idea of a heterogeneous map is fraught with difficulty. </p>\n\n<p>I wrote <a href=\"https://hackage.haskell.org/package/hetero-map\" rel=\"nofollow noreferrer\"><code>hetero-map</code></a> which implements a type-safe heterogeneous map, more as an art piece about how frivolous the idea is than a useful module.   But hey, let me know if you find use out of it. ;-)</p>\n\n<p>Maybe you should take a step back and describe the larger problem you are trying to solve such that you feel you need this.  I assure you there is a better way.</p>\n"}], "owner": {"reputation": 456, "user_id": 2899125, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d598986370ac4fc07224de45128ad429?s=128&d=identicon&r=PG&f=1", "display_name": "darwinsenior", "link": "https://stackoverflow.com/users/2899125/darwinsenior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1486792923, "creation_date": 1486788667, "question_id": 42172366, "link": "https://stackoverflow.com/questions/42172366/can-i-use-unsafecorce-as-hashkey-comaprison-key-for-existential-typeclass", "title": "Can I use unsafecorce as hashkey/comaprison key for existential typeclass?", "body": "<p>So, if I want to create a hashmap key for example with the existential type like</p>\n\n<pre><code>data SomeId = forall a. SomeClass a =&gt; SomeId a\n</code></pre>\n\n<p>So, if I want to create a map I need to implement <code>Ord</code> myself. Is there a way to just store the value? And in this case, is <code>unsafeCooerce</code> to Int permanent or is there any caveat?</p>\n\n<p>Like this?</p>\n\n<pre><code>instance Ord SomeId where\n    compare (Id a) (Id b) = compare (unsafeCoerce a)::Int (unsafeCoerce b)::Int\n</code></pre>\n\n<p>Is there a better way to do this?</p>\n"}, {"tags": ["list", "haskell", "partitioning"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1486771951, "post_id": 42170632, "comment_id": 71506177, "body": "What about <code>transpose . groupEvery n</code> ? Does order matter or list elements can be treated as sets?"}, {"owner": {"reputation": 373, "user_id": 2487254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0287a6e43f477fca396ef20389bd316c?s=128&d=identicon&r=PG", "display_name": "Jxek", "link": "https://stackoverflow.com/users/2487254/jxek"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486772841, "post_id": 42170632, "comment_id": 71506364, "body": "No, order doesn&#39;t matter to me, so that actually does it I think. Thanks! Though I would like to see an order-matters solution for curiosity and generality&#39;s sake."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486783759, "post_id": 42171710, "comment_id": 71508369, "body": "Nice. I was looking for this (splitPlaces). Can&#39;t believe I missed it."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1486782225, "creation_date": 1486782225, "answer_id": 42171710, "question_id": 42170632, "link": "https://stackoverflow.com/questions/42170632/partitioning-a-list-fairly/42171710#42171710", "title": "Partitioning a list fairly", "body": "<p>You can use the <code>split</code> package's <a href=\"http://hackage.haskell.org/package/split-0.2.3.1/docs/Data-List-Split.html#v:splitPlaces\" rel=\"nofollow noreferrer\"><code>splitPlaces</code></a> function for this.</p>\n\n<pre><code>import Data.List.Split\n\nfairPartition n xs = case length xs `quotRem` n of\n    (q, r) -&gt; splitPlaces (replicate r (q+1) ++ replicate (n-r) q) xs\n</code></pre>\n"}], "owner": {"reputation": 373, "user_id": 2487254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0287a6e43f477fca396ef20389bd316c?s=128&d=identicon&r=PG", "display_name": "Jxek", "link": "https://stackoverflow.com/users/2487254/jxek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 42171710, "answer_count": 1, "score": 2, "last_activity_date": 1486782225, "creation_date": 1486771489, "question_id": 42170632, "link": "https://stackoverflow.com/questions/42170632/partitioning-a-list-fairly", "title": "Partitioning a list fairly", "body": "<p>I'm sure this is a reasonably common thing but I can't find anything on it (my internet-search-fu is not strong).</p>\n\n<p>I have a function that can group a list into a list of lists of N elements each, with the final sublist being smaller than N if the length of the list is not evenly divisible by N. Some examples:</p>\n\n<pre><code>groupEvery 2 [1,2,3,4]              = [[1,2],[3,4]]\ngroupEvery 4 [1,2,3,4,5,6,7,8,9,10] = [[1,2,3,4], [5,6,7,8], [9,10]]\n</code></pre>\n\n<p>What I want is to take a list and a positive integer <em>n</em> (in the above examples <em>n</em> could be said to be 2 and 3) and partition it into a new list of <em>n</em> lists. It should work on a list of any type, and produce sublists whose sizes differ as little as possible.</p>\n\n<p>So I would like to have:</p>\n\n<pre><code>fairPartition 3 [1,2,3,4,5,6,7,8,9,10] = [[1,2,3,4], [5,6,7], [8,9,10]]\n</code></pre>\n\n<p>Or any combination of sublists as long as there are two of length 3 and one of length 4.</p>\n\n<p>A naive attempt using groupEvery:</p>\n\n<pre><code>fairPartition :: Int -&gt; [a] -&gt; [[a]]\nfairPartition n xs = groupEvery ((length xs `div` n) + 1) xs\n\nfairPartition 4 [1..10] = [[1,2,3],[4,5,6],[7,8,9],[10]]\n</code></pre>\n\n<p>but as you can see (3,3,3,1) is not a fair distribution of lengths, and for lists of smaller lengths it doesn't even return the right number of sublists:</p>\n\n<pre><code># Haskell, at GHCi\n*Main&gt; let size = 4 in map (\\l -&gt; length . fairPartition 4 $ [1..l]) [size..25]\n[2,3,3,4,3,3,4,4,3,4,4,4,4,4,4,4,4,4,4,4,4,4]\n</code></pre>\n\n<p>I would like a {pseudo,actual}-code function or explanation that is easily translatable to Haskell (the identity translation would be the best!).</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 6, "creation_date": 1486769074, "post_id": 42170307, "comment_id": 71505364, "body": "Hint: what is the type of <code>f</code>?"}, {"owner": {"reputation": 40537, "user_id": 465378, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c03b8d34978563858020eff0d14cc17b?s=128&d=identicon&r=PG", "display_name": "Alexis King", "link": "https://stackoverflow.com/users/465378/alexis-king"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 1, "creation_date": 1486769181, "post_id": 42170307, "comment_id": 71505405, "body": "To add to @duplode\u2019s hint, if <code>&gt;&gt;=</code> were implemented the way you suggest, it would be no different from <code>flip fmap</code>. In fact, this is <i>precisely</i> the difference in power between <code>&gt;&gt;=</code> and <code>fmap</code>."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1486769437, "post_id": 42170307, "comment_id": 71505479, "body": "in other words: <code>f</code> already takes care of that - it creates a value of  type <code>Maybe b</code>, i.e. <code>Just (y::b)</code> or <code>Nothing</code>. If it isn&#39;t, the code won&#39;t typecheck."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1486778372, "post_id": 42170328, "comment_id": 71507443, "body": "Welcome to StackOverflow!"}], "tags": [], "owner": {"reputation": 153, "user_id": 7469141, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qcch8.jpg?s=128&g=1", "display_name": "Hackerman", "link": "https://stackoverflow.com/users/7469141/hackerman"}, "is_accepted": true, "score": 9, "last_activity_date": 1486769863, "last_edit_date": 1486769863, "creation_date": 1486769130, "answer_id": 42170328, "question_id": 42170307, "link": "https://stackoverflow.com/questions/42170307/should-bind-result-in-a-monad/42170328#42170328", "title": "Should bind result in a Monad?", "body": "<p>Yes! You're right about the result being a monad, but remember the type of the <code>&gt;&gt;=</code> operator: <code>m a -&gt; (a -&gt; m b) -&gt; m b</code>. Then, we guess that <code>f</code> has type <code>a -&gt; m b</code>, so applying <code>f</code> to <code>x</code> returns a monad as a result.</p>\n"}], "owner": {"reputation": 8074, "user_id": 339681, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89b183dc01ffd787cbd140a0aac9f91e?s=128&d=identicon&r=PG", "display_name": "cammil", "link": "https://stackoverflow.com/users/339681/cammil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 42170328, "answer_count": 1, "score": 4, "last_activity_date": 1486769863, "creation_date": 1486769004, "question_id": 42170307, "link": "https://stackoverflow.com/questions/42170307/should-bind-result-in-a-monad", "title": "Should bind result in a Monad?", "body": "<p>The following is an example from a <a href=\"http://learnyouahaskell.com/a-fistful-of-monads\" rel=\"nofollow noreferrer\" title=\"Haskell tutorial\">Haskell tutorial</a></p>\n\n<pre><code>instance Monad Maybe where  \n    return x = Just x  \n    Nothing &gt;&gt;= f = Nothing  \n    Just x &gt;&gt;= f  = f x  \n    fail _ = Nothing  \n</code></pre>\n\n<p>However, I am confused by the <code>Just x...</code> line. Should the result not be a monad? I would expect the line to be</p>\n\n<pre><code>Just x &gt;&gt;= f = Just (f x)\n</code></pre>\n"}, {"tags": ["python", "haskell", "asynchronous", "exception-handling"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 1, "creation_date": 1486757856, "post_id": 42167862, "comment_id": 71500851, "body": "I think you pretty much have to install your own signal handler for Ctrl-C if you want to do this."}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1486767983, "post_id": 42169799, "comment_id": 71505016, "body": "Can the <code>__exit__</code> method be interrupted if a further exception happens?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1486769118, "post_id": 42169799, "comment_id": 71505382, "body": "@DanielWagner My vague memory from way back when I wrote Python: exceptions that occur during <code>__exit__</code> interrupt the <code>__exit__</code> method as normal; the exception that prompted the <code>__exit__</code> block becomes the later exception&#39;s <code>__cause__</code>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1486776303, "post_id": 42169799, "comment_id": 71507056, "body": "You do have to install a signal handler yourself, but the <code>__exit__</code> method provides a convenient scope for that: install the handler immediately upon entering the method, and restore the previous handler before exiting it."}, {"owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "edited": false, "score": 0, "creation_date": 1486843151, "post_id": 42169799, "comment_id": 71524066, "body": "Same question: Can the execution of a signal handler be interrupted by another signal?"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 3, "last_activity_date": 1486766400, "creation_date": 1486766400, "answer_id": 42169799, "question_id": 42167862, "link": "https://stackoverflow.com/questions/42167862/does-python-have-an-equivalent-to-haskells-mask-or-bracket-functions/42169799#42169799", "title": "Does Python have an equivalent to Haskell&#39;s &#39;mask&#39; or &#39;bracket&#39; functions?", "body": "<p>This is what context managers are for.</p>\n\n<pre><code>with acquire() as x:\n    do_something(x)\n</code></pre>\n\n<p><code>acquire</code> returns an object whose type defines an <code>__enter__</code> method, which returns the value bound to <code>x</code>, and an <code>__exit__</code> method, which is executed at the end of the <code>with</code> statement regardless of how the statement is exited.</p>\n"}], "owner": {"reputation": 28488, "user_id": 402884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35583fe46c2cde92467710cc7ceff266?s=128&d=identicon&r=PG", "display_name": "Chris Martin", "link": "https://stackoverflow.com/users/402884/chris-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 1, "answer_count": 1, "score": 12, "last_activity_date": 1486844104, "creation_date": 1486757399, "last_edit_date": 1592644375, "question_id": 42167862, "link": "https://stackoverflow.com/questions/42167862/does-python-have-an-equivalent-to-haskells-mask-or-bracket-functions", "title": "Does Python have an equivalent to Haskell&#39;s &#39;mask&#39; or &#39;bracket&#39; functions?", "body": "<p>In Haskell we have asynchronous exceptions; we can use <a href=\"https://www.stackage.org/haddock/lts-7.19/base-4.9.0.0/Control-Concurrent.html#v:throwTo\" rel=\"noreferrer\"><code>throwTo</code></a> to raise any exception in another thread:</p>\n<blockquote>\n<pre><code>throwTo :: Exception e =&gt; ThreadId -&gt; e -&gt; IO ()\n</code></pre>\n<p><code>throwTo</code> raises an arbitrary exception in the target thread (GHC only).</p>\n</blockquote>\n<p>To be able to write code with guarantees like &quot;will always release a lock after acquiring it&quot;, we have <a href=\"https://www.stackage.org/haddock/lts-7.19/base-4.9.0.0/Control-Exception.html#v:mask\" rel=\"noreferrer\"><code>mask</code></a> to run code in which asynchronous exceptions may only be received while the computation is blocking:</p>\n<blockquote>\n<pre><code>mask :: ((forall a. IO a -&gt; IO a) -&gt; IO b) -&gt; IO b\n</code></pre>\n<p>Executes an IO computation with asynchronous exceptions <em>masked</em>. That is, any thread which attempts to raise an exception in the current thread with <code>throwTo</code> will be blocked until asynchronous exceptions are unmasked again.</p>\n</blockquote>\n<p>and a stronger <a href=\"https://www.stackage.org/haddock/lts-7.19/base-4.9.0.0/Control-Exception.html#v:uninterruptibleMask\" rel=\"noreferrer\"><code>uninterruptibleMask</code></a> in which async exceptions will not be raised <em>at all</em> during a masked computation:</p>\n<blockquote>\n<pre><code>uninterruptibleMask :: ((forall a. IO a -&gt; IO a) -&gt; IO b) -&gt; IO b\n</code></pre>\n<p>Like <code>mask</code>, but the masked computation is not interruptible</p>\n</blockquote>\n<p>Masking is used to implement higher-level abstractions like <a href=\"https://www.stackage.org/haddock/lts-7.19/base-4.9.0.0/Control-Exception.html#v:bracket\" rel=\"noreferrer\"><code>bracket</code></a>:</p>\n<blockquote>\n<pre><code>bracket\n    :: IO a         -- computation to run first (&quot;acquire resource&quot;)\n    -&gt; (a -&gt; IO b)  -- computation to run last (&quot;release resource&quot;)\n    -&gt; (a -&gt; IO c)  -- computation to run in-between\n    -&gt; IO c         -- returns the value from the in-between computation\n</code></pre>\n<p>When you want to acquire a resource, do some work with it, and then release the resource, it is a good idea to use <code>bracket</code>, because <code>bracket</code> will install the necessary exception handler to release the resource in the event that an exception is raised during the computation. If an exception is raised, then <code>bracket</code> will re-raise the exception (after performing the release).</p>\n</blockquote>\n<p>If I understand correctly, Python has a (less general) form of asynchronous exceptions, with the most notable manifestation being <a href=\"https://docs.python.org/3/library/exceptions.html#KeyboardInterrupt\" rel=\"noreferrer\"><code>KeyboardInterrupt</code></a>:</p>\n<blockquote>\n<p>Raised when the user hits the interrupt key (normally <kbd>Control</kbd>-<kbd>C</kbd> or <kbd>Delete</kbd>). During execution, a check for interrupts is made regularly.</p>\n</blockquote>\n<p>The documentation is imprecise about when the &quot;check for interrupts&quot; may occur, but it seems to imply that a <code>KeyboardInterrupt</code> may be raised at <em>any</em> point in a program's execution. So it seems, then, that Python's async exceptions come with all the same subtle difficulties of maintaining correctness.</p>\n<p>For example, consider a pattern like this:</p>\n<pre><code>x = None\ntry:\n    x = acquire()\n    do_something(x)    # (1)\nfinally:\n    if x is not None:  # (2)\n        release(x)\n</code></pre>\n<p>If any exception is raised during <code>(1)</code>, then we are assured that the contents of the <a href=\"https://docs.python.org/3/reference/compound_stmts.html#finally\" rel=\"noreferrer\"><code>finally</code></a> block will be executed. But what happens if a <code>KeyboardInterrupt</code> is during <code>(2)</code>?</p>\n<p>It seems fundamentally impossible to guarantee resource cleanup in the presence of asyc exceptions without a way to mask them. Is there some facility for this, or do we rely on the <a href=\"https://en.wikipedia.org/wiki/Ostrich_algorithm\" rel=\"noreferrer\">ostrich algorithm</a>?</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1486752794, "post_id": 42166512, "comment_id": 71498195, "body": "Are you looking for <code>state e1 &gt;&gt; state e2 &gt;&gt; state e3</code>?"}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1486753073, "post_id": 42166512, "comment_id": 71498354, "body": "@Zeta I&#39;ve added to my question for clarity"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1486753489, "post_id": 42166512, "comment_id": 71498556, "body": "Err, <code>state e1</code> is <b>not</b> a <code>State Bool Int</code>, but a <code>State Int Bool</code>."}], "answers": [{"tags": [], "owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "is_accepted": true, "score": 5, "last_activity_date": 1486812413, "last_edit_date": 1486812413, "creation_date": 1486753344, "answer_id": 42166819, "question_id": 42166512, "link": "https://stackoverflow.com/questions/42166512/binding-computations-with-the-state-monad/42166819#42166819", "title": "Binding computations with the State monad?", "body": "<p>If you use <code>state :: (s -&gt; (a, s)) -&gt; State s a</code> on <code>e1</code>, you end up with a <code>State Int Bool</code>:</p>\n\n<pre><code>state e1 :: State Int Bool\n</code></pre>\n\n<p>That is something that acts over a state (in this case an <code>Int</code>) and yields a <code>Bool</code> as a result of using that state. So if we want to use <code>e1</code>, <code>e2</code> and <code>e3</code> after each other in a stateful computation, we could use them with <code>do</code>-notation:</p>\n\n<pre><code>allThree :: State Int ()\nallThree = do\n  firstBool  &lt;- state e1\n  secondBool &lt;- state e2\n  thirdBool  &lt;- state e3\n  return thirdBool\n</code></pre>\n\n<p>However, if we ignore the first two <code>Bool</code>s, we can just remove the bindings:</p>\n\n<pre><code>allThree :: State Int Bool\nallThree = do\n  state e1\n  state e2\n  state e3\n</code></pre>\n\n<p>And now we can rewrite <code>do</code>-notation with <code>&gt;&gt;</code> and <code>&gt;&gt;=</code>. We end up with</p>\n\n<pre><code>allThree :: State Int Bool\nallThree = state e1 &gt;&gt; state e2 &gt;&gt; state e3\n</code></pre>\n\n<p>As for how this works, let's have a look at <code>&gt;&gt;=</code></p>\n\n<pre><code>  m &gt;&gt;= k = state $ \\s -&gt; let (a, s') = runState m s \n                          in runState (k a) \n</code></pre>\n\n<p>And <code>m &gt;&gt; k</code> is <code>m &gt;&gt;= const k</code>. So let's check what <code>state e1 &gt;&gt; state 2</code> does:</p>\n\n<pre><code> state e1 &gt;&gt; state e2 \n   = state e1 &gt;&gt;= const (state e2)\n   = state $ \\s -&gt; let (a, s') = runState (state e1) s in runState (const (state e2) a) s'\n     -- simplify runState (state e1) s to e1 s\n   = state $ \\s -&gt; let (a, s') = e1 s in runState (const (state e2) a) s'\n     -- use \"const\"\n   = state $ \\s -&gt; let (a, s') = e1 s in runState (state e2) s'\n     -- again simplify runState (state e2) s' to e2 s'\n   = state $ \\s -&gt; let (a, s') = e1 s in e2 s'\n</code></pre>\n\n<p>Therefore, the following terms are the same:</p>\n\n<pre><code>stateful  s = runState (state e1 &gt;&gt; state e2) s -- use above to show that\nstateless s = let (_, s') = e1 s \n              in e2 s'\n</code></pre>\n\n<p>Now, why was I able to use change <code>runState (state f)</code> to <code>f</code>? Because the definition of <code>State</code> is rather boring:</p>\n\n<pre><code>-- simplified, modern versions use a more sophisticated approach!\nnewtype State s a = State { runState :: s -&gt; (a, s) }\n</code></pre>\n\n<p>That is, a <code>State</code>ful action is something that takes a state and returns a new one along to the value. The <code>state</code> function is thus rather simple:</p>\n\n<pre><code>state :: (s -&gt; (a, s)) -&gt; State s a\nstate = State\n</code></pre>\n\n<p>And since <code>runState (State f)</code> is <code>f</code>, <code>runState (state f)</code> is also `f\u00b4.</p>\n\n<p>Therefore, we could write the <code>Monad</code> instance a little bit different:</p>\n\n<pre><code>instance Monad (State s) where\n  (State e1) &gt;&gt;= f = State e3\n     where  \n       e3 s = let (a, s')    = e s\n                  (State e2) = f a\n              in e2 s'\n</code></pre>\n\n<p>Remember, <code>&gt;&gt;=</code> expects a function that takes something and returns another action, whereas the  <code>&gt;&gt;</code> can be used to chain actions after each other.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 1, "accepted_answer_id": 42166819, "answer_count": 1, "score": 2, "last_activity_date": 1486812413, "creation_date": 1486752212, "last_edit_date": 1486753093, "question_id": 42166512, "link": "https://stackoverflow.com/questions/42166512/binding-computations-with-the-state-monad", "title": "Binding computations with the State monad?", "body": "<p>I'm looking to pass a State monad through the following functions:</p>\n\n<pre><code>e1 :: Int -&gt; (Bool, Int)\ne1 el \n  | el &gt; 100           = (True, el)\n  | otherwise          = (False, 0)\n\ne2 :: Int -&gt; (Bool, Int)\ne2 el \n  | el &gt; 200           = (True, el)\n  | otherwise          = (False, 0)\n\ne3 :: Int -&gt; (Bool, Int)\ne3 el \n  | el &gt; 300           = (True, el)\n  | otherwise          == (False, 0)\n\nimplementor :: State Bool Int\nimplementor = state e1 ...\n\nmain = do \n  print $ runState implementor 10 \n</code></pre>\n\n<p>Currently <code>runState</code> is passed an <code>State s a</code> (<code>implementor</code>) and a value (10), and then returning the tuple from <code>e1</code>.</p>\n\n<p>However I'd like to bind these operations together, such as:</p>\n\n<pre><code>state e1 &gt;&gt;= e2 &gt;&gt;= e3  \n</code></pre>\n\n<p><code>e1</code> would pass its <code>State Bool Int</code> to <code>e2</code>, which would operate on the <code>Int</code> (through <code>el</code>), then pass it's resulting <code>State Bool Int</code> to <code>e3</code> which, again, would operate on the <code>Int</code> in this incoming State.  </p>\n\n<p>I've found the instance of Monad State very confusing, following <a href=\"http://brandon.si/code/the-state-monad-a-tutorial-for-the-confused/\" rel=\"nofollow noreferrer\">this</a> guide:</p>\n\n<pre><code>instance Monad (State s) where\n   return :: state $ \\s -&gt; (s, a)--this is returning a State which contains function (s -&gt; (s, a))\n   m &gt;&gt;= k = state $ \\s -&gt; let (a, s') = runState m s --? \n                     in runState (k a) s' \n</code></pre>\n\n<p>I don't understand what this instance of bind is doing and how to use this to bind <code>e1</code>, <code>e2</code> and <code>e3</code> together?  </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 1, "creation_date": 1486750157, "post_id": 42165521, "comment_id": 71496801, "body": "Could you please elaborate on what exactly the function should be doing? Your expected output with given <code>listA</code> and <code>listZ</code> isn&#39;t quite what I would expect from merging two lists."}, {"owner": {"reputation": 31, "user_id": 7528431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd349292f82143a23bb0a385a7c0b0cb?s=128&d=identicon&r=PG&f=1", "display_name": "Xui", "link": "https://stackoverflow.com/users/7528431/xui"}, "reply_to_user": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1486750663, "post_id": 42165521, "comment_id": 71497088, "body": "Perhaps merging is not the adequate word. For every (second) element in ListA existing in the original ListZ write the element following it."}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 1, "creation_date": 1486751313, "post_id": 42165521, "comment_id": 71497416, "body": "You should probably edit this into the question itself."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1486752167, "post_id": 42165521, "comment_id": 71497844, "body": "Could you give a better example without pairs? At the moment, your, your example doesn&#39;t really make sense. The second element in <code>listA</code> is <code>(&#39;b&#39;,1)</code>. It exists in <code>listZ</code>, so the following element is <code>(&#39;z&#39;,1)</code>. However, now there&#39;s apparently another <code>(&#39;a&#39;,1)</code> in your expected output, but it doesn&#39;t exist in the second list at all, and doesn&#39;t come up in the first list twice."}, {"owner": {"reputation": 604, "user_id": 1264345, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a815668d20d49da314fed5cfe32c04e6?s=128&d=identicon&r=PG", "display_name": "wardva", "link": "https://stackoverflow.com/users/1264345/wardva"}, "edited": false, "score": 0, "creation_date": 1486753989, "post_id": 42165521, "comment_id": 71498837, "body": "Maybe you are calling the wrong function?  <code>concatTupleList</code> \u2260 <code>mergeTupleList</code>"}, {"owner": {"reputation": 31, "user_id": 7528431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd349292f82143a23bb0a385a7c0b0cb?s=128&d=identicon&r=PG&f=1", "display_name": "Xui", "link": "https://stackoverflow.com/users/7528431/xui"}, "reply_to_user": {"reputation": 604, "user_id": 1264345, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a815668d20d49da314fed5cfe32c04e6?s=128&d=identicon&r=PG", "display_name": "wardva", "link": "https://stackoverflow.com/users/1264345/wardva"}, "edited": false, "score": 0, "creation_date": 1486755302, "post_id": 42165521, "comment_id": 71499600, "body": "@WardVa, err sorry, I fixed the name. I renamed the function before posting."}, {"owner": {"reputation": 31, "user_id": 7528431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd349292f82143a23bb0a385a7c0b0cb?s=128&d=identicon&r=PG&f=1", "display_name": "Xui", "link": "https://stackoverflow.com/users/7528431/xui"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1486756112, "post_id": 42165521, "comment_id": 71499987, "body": "That a look at the question, I edited another example. We take the same <code>(&#39;a&#39;,1)</code> because there are two <code>(&#39;b&#39;,1)</code> in <code>ListZ</code>. Imagine it as <code>(&#39;a&#39;,1)</code> goes to <code>(&#39;z&#39;,1)</code> through <code>(&#39;b&#39;,1)</code> but <code>(&#39;a&#39;,1)</code> also goes to  <code>(&#39;z&#39;,2)</code> through <code>(&#39;b&#39;,1)</code>. @Zeta"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 1, "creation_date": 1486756135, "post_id": 42165521, "comment_id": 71499999, "body": "Please correct me if I&#39;m wrong: you&#39;re trying to traverse your lists from left to right, and if a traversed element of <code>listA</code> is not in <code>listZ</code>, retain it, otherwise retain the corresponding element of <code>listZ</code>. Is this what you&#39;re trying to do?"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1486756751, "post_id": 42165521, "comment_id": 71500298, "body": "You seem to scan ListA and listZ in lockstep, so the number of elements in the result is the same as for the source list(s). Your examples show that you have to re-scan ListZ from start for each second element of ListA."}, {"owner": {"reputation": 31, "user_id": 7528431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd349292f82143a23bb0a385a7c0b0cb?s=128&d=identicon&r=PG&f=1", "display_name": "Xui", "link": "https://stackoverflow.com/users/7528431/xui"}, "edited": false, "score": 0, "creation_date": 1486756871, "post_id": 42165521, "comment_id": 71500367, "body": "If this was a graph I want to show that there is a way from <code>(&#39;a&#39;,1)</code> to <code>(&#39;z&#39;,1)</code> but I also want to show that there is a way from <code>(&#39;a&#39;,1)</code> to <code>(&#39;z&#39;,2)</code> since all three are connected to <code>(&#39;b&#39;,1)</code> ; <code>(&#39;b&#39;,1)</code> is the connector from one list to another . Traverse <code>listA</code> from left to right yes, if a traversed element of <code>listA</code> is not in <code>listZ</code> do nothing. If it is, retain it&#39;s precursor in <code>ListA</code> + it&#39;s follower in <code>listZ</code>"}, {"owner": {"reputation": 31, "user_id": 7528431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd349292f82143a23bb0a385a7c0b0cb?s=128&d=identicon&r=PG&f=1", "display_name": "Xui", "link": "https://stackoverflow.com/users/7528431/xui"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1486757036, "post_id": 42165521, "comment_id": 71500447, "body": "Yes, I understood this but I don&#39;t know how... @9000"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1486757328, "post_id": 42165521, "comment_id": 71500580, "body": "To traverse two lists at once one can <code>zip</code> them together and then work with the result. If you need to access also previous/next elements, zip the list with itself with one element added/dropped respectively."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 7528431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd349292f82143a23bb0a385a7c0b0cb?s=128&d=identicon&r=PG&f=1", "display_name": "Xui", "link": "https://stackoverflow.com/users/7528431/xui"}, "edited": false, "score": 0, "creation_date": 1486759710, "post_id": 42168017, "comment_id": 71501721, "body": "Thanks, you saved me again! Actually I had no idea what I was doing with <code>:[ ] ++</code>"}], "tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": true, "score": 1, "last_activity_date": 1486758039, "creation_date": 1486758039, "answer_id": 42168017, "question_id": 42165521, "link": "https://stackoverflow.com/questions/42165521/merging-lists-on-matching-element/42168017#42168017", "title": "Merging lists on matching element", "body": "<p>I have a series of solutions for you. First, the following produces the desired output. I think this is as specified, but note that <code>mergeTupleList'</code>\nno longer returns the bList in it's first line. That wasn't performing as expected, although your description leads me to believe that you do want that.</p>\n\n<p>The secret to this solution is the inclusion of the subfunction <code>tupleAB</code>, which does all the tupling for the first <code>a:ab</code>, consuming the entire <code>bs</code> list before evaluating the next <code>ab</code> pair for the whole <code>bs</code> list.</p>\n\n<pre><code>mergeTupleList' [] _ = []\nmergeTupleList' alist [] = []\nmergeTupleList' (a:ab:as) bbnbs =\n  let\n    tupleAB (b:bn:bs) = \n      if ab == b\n         then a:[] ++ bn:[] ++ tupleAB bs \n         else [] ++ tupleAB bs \n    tupleAB _ = []\n  in tupleAB bbnbs ++ mergeTupleList' as bbnbs \n</code></pre>\n\n<p>Next is a slight cleanup of all those naughty <code>:[] ++</code></p>\n\n<pre><code>mergeTupleList'' [] _ = []\nmergeTupleList'' alist [] = []\nmergeTupleList'' (a:ab:as) bbnbs =\n  let\n    tupleAB (b:bn:bs) = \n      if ab == b\n         then a : bn : tupleAB bs \n         else tupleAB bs \n    tupleAB _ = []\n  in tupleAB bbnbs ++ mergeTupleList'' as bbnbs \n</code></pre>\n\n<p>The above solutions have some dangling case expressions. What do we do in the case where one of the lists isn't even numbered? If we instead turn each first two terms into a pair, we have lists of pairs (of pairs). This conversion function changes your lists.</p>\n\n<pre><code>pairListCvt :: [a] -&gt; [(a,a)]\npairListCvt (a:b:cs) = (a,b) : pairListCvt cs\npairListCvt (a:[]) = [] --maybe should be error?\npairListCvt _ = []\n\nlistACvt = pairListCvt listA \nlistZCvt = pairListCvt listZ\n</code></pre>\n\n<p>Now, rewritten again, we have less unmatched patterns, and so probably less chance for error. This is an example of selecting a type to provide a bit of safety; type safety.</p>\n\n<pre><code>mergeTupleList''' [] _ = []\nmergeTupleList''' alist [] = []\nmergeTupleList''' ((a,ab):as) bbnbs =\n  let\n    tupleAB ((b,bn):bs) = \n      if ab == b\n         then (a , bn) : tupleAB bs \n         else mergeTupleList''' as ((b,bn):bs)\n    tupleAB _ = []\n  in tupleAB bbnbs ++ mergeTupleList''' as bbnbs \n</code></pre>\n\n<p>Next, since we are using each term in <code>alist</code> to create terms from <code>blist</code>,\nI use a <code>map</code> here.</p>\n\n<pre><code>mergeTupleList'''' as bbns = \n  let\n    tupleAB ((b,bn):bs) (a,ab) = \n      if ab == b\n         then (a, bn) : tupleAB bs (a,ab)\n         else tupleAB bs (a,ab)\n    tupleAB [] _ = []\n  in concat $ map (tupleAB bbns) as\n</code></pre>\n\n<p>Finally, the inner <code>tupleAB</code> can be formulated as a <code>fold</code>; something that incrementally builds a data structure through an element-by-element decomposition of the list. The core logic of that fold is now held in <code>f</code>.</p>\n\n<pre><code>mergeTupleList''''' as bbns = \n  let\n    tupleAB bs aab = foldr (f aab) [] bs\n    f (a,ab) (b,bn) acc\n       | ab == b        = (a,bn) : acc\n       | otherwise      = acc\n  in concat $ map (tupleAB bbns) as\n</code></pre>\n\n<p>I prefer where bindings to let bindings, stylistically. Alghouth there are memory performance issues I don't understand concerning the choice.</p>\n\n<pre><code>mergeTupleListW as bbns = concat $ map (tupleAB bbns) as\n  where\n    tupleAB bs aab = foldr (f aab) [] bs\n    f (a,ab) (b,bn) acc\n       | ab == b        = (a,bn) : acc\n       | otherwise      = acc\n</code></pre>\n\n<p>Extra Credit. He is the function written as a List monad.</p>\n\n<pre><code>mergeTupleListM as bbns = \n  do a &lt;- as\n     tupleAB bbns a\n  where\n    tupleAB bs aab = foldr (f aab) [] bs\n    f (a,ab) (b,bn) acc\n       | ab == b        = (a,bn) : acc\n       | otherwise      = acc\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 7528431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd349292f82143a23bb0a385a7c0b0cb?s=128&d=identicon&r=PG&f=1", "display_name": "Xui", "link": "https://stackoverflow.com/users/7528431/xui"}, "is_accepted": false, "score": 0, "last_activity_date": 1486760583, "creation_date": 1486760583, "answer_id": 42168640, "question_id": 42165521, "link": "https://stackoverflow.com/questions/42165521/merging-lists-on-matching-element/42168640#42168640", "title": "Merging lists on matching element", "body": "<p>This question has already been answered but here is what I figured out, with help from the comments. \nFirst we create a <code>groupByTwo</code>  function to break <code>listA</code> in lists containing each two elements.</p>\n\n<pre><code>groupByTwo [] = []\ngroupByTwo list = \n (take 2 list) : (groupByTwo (drop 2 list))\n</code></pre>\n\n<p>Then we create a <code>mergeTupleList'</code> function to run the simple <code>mergeTupleList</code> on each element of the list of lists.</p>\n\n<pre><code>mergeTupleList' [] _ = []\nmergeTupleList' (a:as) list2 =\n  mergeTupleList a list2 ++ mergeTupleList' as list2\n</code></pre>\n\n<p>Finally a third function called <code>groupTupleMerge</code> to make life easier.</p>\n\n<pre><code>groupTupleMerge list1 list2 =\n    mergeTupleList' (groupByTwo list1) list2\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 7528431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd349292f82143a23bb0a385a7c0b0cb?s=128&d=identicon&r=PG&f=1", "display_name": "Xui", "link": "https://stackoverflow.com/users/7528431/xui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 42168017, "answer_count": 2, "score": 0, "last_activity_date": 1486760583, "creation_date": 1486748535, "last_edit_date": 1486755911, "question_id": 42165521, "link": "https://stackoverflow.com/questions/42165521/merging-lists-on-matching-element", "title": "Merging lists on matching element", "body": "<p>I wrote a function to merge two pair lists, in this case each element containing a character and a number. </p>\n\n<pre><code>mergeTupleList [] blist = blist\nmergeTupleList alist [] = []\nmergeTupleList (a:ab:as) (b:bn:bs) =\n    if ab == b\n        then a:[] ++ bn:[] ++ mergeTupleList (a:ab:as) (bs)\n        else [] ++ mergeTupleList (as) (b:bn:bs)\n\nlistA = [('a',1),('b',1),('a',2),('b',1)] \nlistZ = [('b',1),('z',1),('b',1),('z',2)]\n</code></pre>\n\n<p>It seems that in the 'else' case (b:bn:bs) is not the whole pair list loaded in the beginning, but the short version (bs) because it has been filtered by the 'then' condition. \nI'm looking for a way to transmit the original (b:bn:bs) list to this function.</p>\n\n<p>input and output:</p>\n\n<pre><code>*Main&gt; mergeTupleList ListA ListZ\n[('a',1),('z',1),('a',1),('z',2)]\n</code></pre>\n\n<p>expected output:</p>\n\n<pre><code>[('a',1),('z',1),('a',1),('z',2),('a',2),('z',1),('a',2),('z',2)]\n</code></pre>\n\n<p>For clarification : </p>\n\n<blockquote>\n  <p>Perhaps merging is not the adequate word. For every (second) element in <code>ListA</code> existing in the original <code>ListZ</code> write the element following it.</p>\n</blockquote>\n\n<p>Another example:</p>\n\n<pre><code>ListA = [1,0,3,0]\nListZ = [0,8,0,9]\n\n*Main&gt; mergeTupleList listA listZ \n[1,8,1,9]\n</code></pre>\n\n<p>expected output:\n<code>[1,8,1,9,3,8,3,9]</code></p>\n"}, {"tags": ["json", "haskell", "persistent", "haskell-lens"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 2, "creation_date": 1486746682, "post_id": 42160251, "comment_id": 71494738, "body": "There is no specific option for that (only for <a href=\"https://www.stackage.org/haddock/lts-7.19/persistent-template-2.5.1.6/Database-Persist-TH.html#v:mpsPrefixFields\" rel=\"nofollow noreferrer\">the opposite move</a> i.e. removing the &quot;book&quot; prefix from the lenses), but it seems you can write custom <code>toJSON</code> and <code>fromJSON</code> functions that suit your purposes and use them instead of the default ones through the <a href=\"https://www.stackage.org/haddock/lts-7.19/persistent-template-2.5.1.6/Database-Persist-TH.html#v:mpsEntityJSON\" rel=\"nofollow noreferrer\"><code>mpsEntityJSON</code> setting</a>."}], "owner": {"reputation": 293, "user_id": 1685973, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/962f0817c36a6dab53fb76c6a9fa78df?s=128&d=identicon&r=PG", "display_name": "gueux", "link": "https://stackoverflow.com/users/1685973/gueux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 192, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1486732271, "creation_date": 1486732271, "question_id": 42160251, "link": "https://stackoverflow.com/questions/42160251/is-it-possible-to-customize-persistent-to-have-the-same-field-names-for-json-and", "title": "Is it possible to customize persistent to have the same field names for json and lenses?", "body": "<p>Given this:</p>\n\n<pre><code>import           Database.Persist.TH\n\nshare [mkPersist sqlSettings  { mpsGenerateLenses = True }] [persistLowerCase|\nBook json\n    title String\n    pages Int\n    deriving Eq Read Show Generic\n|]\n</code></pre>\n\n<p>I get JSON like this:</p>\n\n<pre><code>{ \"title\": \"Persistent book\", \"pages\": 50 }\n</code></pre>\n\n<p>and I can use lenses like this:</p>\n\n<pre><code>book ^. bookTitle\n</code></pre>\n\n<p>Is it possible to tell <code>persistent</code> to automatically generate JSON like this:</p>\n\n<pre><code>{ \"_bookTitle\": \"Persistent book\", \"_bookPages\": 50 }\n</code></pre>\n\n<p>to match the model lenses?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1486731261, "post_id": 42159877, "comment_id": 71484785, "body": "<code>\\[a,b,c] -&gt; Object a b c</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 1, "creation_date": 1486744792, "post_id": 42160703, "comment_id": 71493586, "body": "It isn&#39;t <i>necessarily</i> partial but that is the most obvious solution.  He could also define <code>createObject _ = Object &quot;&quot; &quot;&quot; &quot;&quot;</code> or other variants."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1486749008, "post_id": 42160703, "comment_id": 71496168, "body": "Good point. That affects my point #1 as well; I&#39;ll think about how to best revise my answer."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1486754248, "last_edit_date": 1592644375, "creation_date": 1486733764, "answer_id": 42160703, "question_id": 42159877, "link": "https://stackoverflow.com/questions/42159877/haskell-how-to-create-data-from-a-list/42160703#42160703", "title": "Haskell - How to create data from a list", "body": "<p>You have to define the function explicitly, and it is necessarily a partial function.</p>\n<pre><code>createObject [x,y,z] = Object x y z\n</code></pre>\n<p>Haskell doesn't provide any special syntax for this because the number of cases where it would apply is relatively small.</p>\n<ol>\n<li><p>The input list has to have the exact number of elements required by the product type. You could argue that the function could simply ignore elements from a longer list, but you can't return a partially applied <code>Object</code>: <code>Object x y</code> has type <code>String -&gt; Object</code>, not <code>Object</code>.</p>\n<p>With dependent types, though, you could define <code>createObject</code> to take lists of exactly the right length, somewhat negating this point.</p>\n</li>\n<li><p>The product type is limited to products of the same type. (No list could be used to create something of type <code>data Foo = Foo {a ::Int, b::String}</code>, for example.)</p>\n</li>\n</ol>\n<hr />\n<p>Update:</p>\n<p>Point 1 is a little weak; you could define a total function like</p>\n<pre><code>createObject (x:y:z:_) = Object x y z\ncreateObject [x,y] = Object x y &quot;&quot;\ncreateObject [x] = Object x &quot;&quot; &quot;&quot;\ncreateObject [] = Object &quot;&quot; &quot;&quot; &quot;&quot;\n</code></pre>\n<p>which would ignore extra input items and specify a default value for missing items.</p>\n"}], "owner": {"reputation": 101, "user_id": 1851256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b36251177627154cac48507dae41ca2?s=128&d=identicon&r=PG", "display_name": "Nicky Ng", "link": "https://stackoverflow.com/users/1851256/nicky-ng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 874, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486754248, "creation_date": 1486731162, "question_id": 42159877, "link": "https://stackoverflow.com/questions/42159877/haskell-how-to-create-data-from-a-list", "title": "Haskell - How to create data from a list", "body": "<p>If I have some kind of data structure:</p>\n\n<pre><code>data Object = Object { a :: String, b :: String, c :: String }\n</code></pre>\n\n<p>How can I create a function such that it takes a list of strings and creates the object, where the first element is a, second element is b... etc assuming the list is the right size and in the right order></p>\n\n<pre><code>createObject :: [String] -&gt; Object\n</code></pre>\n"}, {"tags": ["haskell", "types", "ghc", "proof", "dependent-type"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1486717660, "post_id": 42151927, "comment_id": 71476366, "body": "\u201csince <code>:~:</code> has exactly one inhabitant (<code>Refl</code>), GHC could optimize <code>gcastWith commutativity e \u21d2 e</code>\u201d \u2013 first, I reckon GHC does already do that in some cases (if it specialises to concrete <code>n</code> and <code>m</code>)? \u2014 In general though, I doubt this kind of totality analysis would really help much performance-wise, since the power of dependently-typed proofs is really their constructive nature, and the work in constructing equalities etc. can&#39;t in general be _O_(1) at runtime."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1486718235, "post_id": 42151927, "comment_id": 71476729, "body": "@leftaroundabout I buy that GHC can make optimizations for concrete <code>n</code> and <code>m</code>, but that seems a bit of a brittle mechanism. I reckon most of my (current) use cases for proofs would be O(1) optimizable... Do you have an example of a dependently-typed proof that can&#39;t in general be O(1)? I don&#39;t doubt they exist - I&#39;d just like an example to think about. Thanks!"}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1486718265, "post_id": 42151927, "comment_id": 71476745, "body": "@leftaroundabout: Re. constructivity: not quite; you&#39;re confusing &quot;constructive proof&quot; and &quot;computational content&quot;.  Since <code>a :~: b</code> only has one non-\u22a5 inhabitant, if we were in a total setting, we could say that proofs of <code>a :~: b</code> had no computational content; we know that <code>castWith :: (a :~: b) -&gt; a -&gt; b</code> must be computationally equivalent to <code>const id</code> (given totality).  In a homotopy type theory setting, it&#39;s true that equalities have computational content, so you&#39;d have to do the work \u2013 but in that setting, <code>refl</code> <i>isn&#39;t</i> the only inhabitant of <code>a = b</code>!"}, {"owner": {"reputation": 42094, "user_id": 828361, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6a82397672dcc1fca31c32508ef0798b?s=128&d=identicon&r=PG", "display_name": "pigworker", "link": "https://stackoverflow.com/users/828361/pigworker"}, "edited": false, "score": 16, "creation_date": 1486719464, "post_id": 42151927, "comment_id": 71477466, "body": "A web server isn&#39;t supposed to terminate. Moreover, it&#39;s supposed to <i>respond</i>, and that (a.k.a. &quot;productivity&quot;) is the form of totality that pertains to <i>co</i>induction. The you-can&#39;t-write-a-total-server myth is one of the poorer excuses for retaining general recursion. I agree that a checkably total fragment of Haskell would be valuable (I once called it &quot;Ask&quot;, because you can, with confidence, and because it&#39;s the part of Haskell that isn&#39;t &quot;Hell&quot;). The proof erasure motivation (cf Coq&#39;s Extraction) is good. Distinguishing data from codata (tricky in Haskell) would be a big help."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1486720549, "post_id": 42151927, "comment_id": 71478100, "body": "@leftaroundabout As Antal mentions above, one can build optimized O(1) proofs for single-nonbottom-value types, like <code>a:~:b</code>. Everytime one has <code>e :: a:~:b</code> and a termination checker ensures <code>e</code> is non bottom, once can optimize it with <code>unsafeCoerce Refl</code>. The tricky part is proving totality on Haskell codata, where induction is not enough. Maybe we could restrict this to &quot;data&quot;-only types/kinds, like e.g. <code>data Nat = O | S !Nat</code>, where induction could be sound. I am not terribly confident about this, though."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486720788, "post_id": 42151927, "comment_id": 71478234, "body": "@Alec A proof for <code>Either (n :~: m) ((n :~: m) -&gt; Void)</code> (for Peano naturals <code>n,m</code>) can not be O(1), I think. At runtime we need to check whether the runtime values are equal or not. For single-value types, it should be always O(1) I guess."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486721663, "post_id": 42151927, "comment_id": 71478733, "body": "@chi Sure! I was only thinking about single-value types like <code>:~:</code> or <code>()</code>. Otherwise, I agree all bets are off (I reckon something could be worked out with refinement types here, but that is a bit out of scope and nowhere in sight of GHC)."}, {"owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "edited": false, "score": 1, "creation_date": 1486965134, "post_id": 42151927, "comment_id": 71556781, "body": "Since <code>:~:</code> is a boxed type, it has 2 inhabitants: <code>Refl</code> and <code>_|_</code>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "edited": false, "score": 0, "creation_date": 1487008030, "post_id": 42151927, "comment_id": 71581686, "body": "@Heimdell That&#39;s the point of this question - if the function producing the <code>:~:</code> is total, it cannot be <code>_|_</code>."}, {"owner": {"reputation": 607, "user_id": 2436412, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07531356cc096dc9551e1ac5983f651d?s=128&d=identicon&r=PG", "display_name": "Heimdell", "link": "https://stackoverflow.com/users/2436412/heimdell"}, "edited": false, "score": 1, "creation_date": 1488117796, "post_id": 42151927, "comment_id": 72079596, "body": "@Alec if you wan something in haskell to be total, it should be unboxed. And ypu will get problems with the unboxed things, since they are of different kind from boxed ones."}], "answers": [{"comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 3, "creation_date": 1486747613, "post_id": 42158168, "comment_id": 71495306, "body": "What sort of limitations are there to this being part of GHC? AFAICT, LH is just a sort of advanced linter - it won&#39;t optimize away total values of types with only one inhabitant. Thanks!"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 2, "creation_date": 1486751816, "post_id": 42158168, "comment_id": 71497671, "body": "@Alec Section 8.4 of Richard A. Eisenberg&#39;s thesis <a href=\"https://arxiv.org/abs/1610.07978\" rel=\"nofollow noreferrer\">arxiv.org/abs/1610.07978</a> has some suggestions on how something like Liquid Haskell might be incorporated in a future dependently-typed Haskell."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 3, "creation_date": 1486752063, "post_id": 42158168, "comment_id": 71497796, "body": "@danidiaz Funny you bring this up: that section was actually one of the reasons I asked this question. I&#39;m trying to scope out what exactly is the work that would go into such a GHC plugin. I was hoping more for a discussion on the details of data/codata (and the nasty in-between stuff)..."}], "tags": [], "owner": {"reputation": 5668, "user_id": 89574, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fed2705cf484a7ffbc3d44a742b686e5?s=128&d=identicon&r=PG", "display_name": "Christopher Done", "link": "https://stackoverflow.com/users/89574/christopher-done"}, "is_accepted": false, "score": 20, "last_activity_date": 1486725726, "last_edit_date": 1592644375, "creation_date": 1486725726, "answer_id": 42158168, "question_id": 42151927, "link": "https://stackoverflow.com/questions/42151927/what-is-haskell-missing-for-totality-checking/42158168#42158168", "title": "What is Haskell missing for totality checking?", "body": "<p><a href=\"https://ucsd-progsys.github.io/liquidhaskell-blog/\" rel=\"noreferrer\">Liquid Haskell</a> has totality checking: <a href=\"https://github.com/ucsd-progsys/liquidhaskell#termination-check\" rel=\"noreferrer\">https://github.com/ucsd-progsys/liquidhaskell#termination-check</a></p>\n<p><a href=\"https://i.stack.imgur.com/yp2Wo.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/yp2Wo.png\" alt=\"Screenshot from homepage\" /></a></p>\n<blockquote>\n<p>By default a termination check is performed on all recursive functions.</p>\n<p>Use the no-termination option to disable the check</p>\n<p>liquid --no-termination test.hs</p>\n<p>In recursive functions the first algebraic or integer argument should be decreasing.</p>\n<p>The default decreasing measure for lists is length and Integers its value.</p>\n</blockquote>\n<p>(I included screenshot and quote for posterity.)</p>\n<p>Similar to in Agda or other languages with totality checking, the arguments to the function must become structurally smaller over time to reach the base case. Combined with a totality checker, this makes for a reliable check for a number of functions. LH also supports helping the checker along by indicating how things decrease, which you could do with an abstract data type that's opaque or from an FFI. It's really quite practical.</p>\n"}], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3147, "favorite_count": 14, "answer_count": 1, "score": 37, "last_activity_date": 1486725726, "creation_date": 1486703391, "last_edit_date": 1486714261, "question_id": 42151927, "link": "https://stackoverflow.com/questions/42151927/what-is-haskell-missing-for-totality-checking", "title": "What is Haskell missing for totality checking?", "body": "<p>A total (functional) language is one in which everything can be shown to terminate. Obviously, there are lots of places where I don't want this - throwing exceptions is sometimes handy, a web-server isn't supposed to terminate, etc. But sometimes, I would like a local totality check to enable certain optimizations. For example, if I have a provably-total function</p>\n\n<pre><code>commutativity :: forall (n :: Nat) (m :: Nat). n + m :~: m + n\ncommutativity = ...\n</code></pre>\n\n<p>then, since <a href=\"https://hackage.haskell.org/package/base/docs/Data-Type-Equality.html\"><code>:~:</code> has exactly one inhabitant (<code>Refl</code>)</a>, GHC could optimize</p>\n\n<pre><code>gcastWith (commutativity @n @m) someExpression\n  ==&gt;\nsomeExpression\n</code></pre>\n\n<p>And my proof of commutativity goes from having an <code>O(n)</code> runtime cost to being free. So, now for my question:</p>\n\n<h3>What are some of the subtle difficulties in making a totality checker for Haskell?</h3>\n\n<p>Obviously, such a checker is conservative so whenever GHC isn't sure something is total (or is to lazy to check) it could assume it isn't... Seems to me it might not be too difficult to cobble together a not-so-smart checker that would <em>still</em> be very useful (at least it should be straightforward to eliminate all my arithmetic proofs). Yet, I can't seem to find any efforts to build such a thing into GHC, so obviously I'm missing some pretty big constraints. Go ahead SO, crush my dreams. :)</p>\n\n<hr>\n\n<p>Relevant but not recent: <a href=\"http://ndmitchell.com/downloads/paper-qualifying_dissertation-30_jun_2005.pdf\"><em>Unfailing Haskell</em> by Neil Mitchell, 2005</a>.</p>\n"}, {"tags": ["haskell", "recursion", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": true, "score": 12, "last_activity_date": 1486697804, "creation_date": 1486697804, "answer_id": 42151076, "question_id": 42150614, "link": "https://stackoverflow.com/questions/42150614/why-is-the-lazy-pattern-match-version-of-splitat-function-faster/42151076#42151076", "title": "Why is the lazy pattern match version of splitAt function faster?", "body": "<p>There are a bunch of differences.</p>\n\n<p>Let's look into the operational difference between the variants with and without the <code>~</code> on line 11.</p>\n\n<p>Evaluation in GHC Haskell is driven by pattern-matching.  When a pattern is matched in a case expression or the LHS of a function definition, it requires that the constructors in the pattern be evaluated.  (Patterns in let and where bindings are treated as lazy pattern matches.)  So that means evaluating <code>splitAt 1000000 (repeat 'a')</code> depends on matching the <code>(,)</code> constructor resulting from the recursive call to <code>splitAt 999999 ...</code>, and so on, all the way down to the final call of <code>splitAt 0 ...</code>.  This requires stack space to evaluate.  Quite a lot of it, in fact.  It's very possible the stack has to be grown several times to avoid crashing.</p>\n\n<p>In addition, the entire result string <code>\"aaaaa...\"</code> is built on the heap while this is happening, before <code>length</code> ever starts to process it. (Due to optimizations in <code>repeat</code>, the second element of the result is actually a circularly linked list which never allocates anything new in the whole recursive evaluation.)</p>\n\n<p>When the pattern match is made lazy, things change.  The return value from <code>splitAt 1000000 (repeat 'a')</code> is evaluated to be <code>('a':_thunk1, _thunk2)</code> without ever making a recursive call to <code>splitAt</code>.  This is a pattern known as guarded corecursion. The further evaluation is hidden behind data constructors like <code>(,)</code> and <code>(:)</code>, and so only performed if demanded by another case expression.</p>\n\n<p>The call to <code>fst</code> throws away <code>_thunk2</code>, so it won't ever be evaluated.  The call to <code>length</code> starts by consuming the first <code>(:)</code> constructor, throwing out the <code>'a'</code> value, and then making a recursive call on <code>_thunk1</code>.  At this point, nothing in memory is still referring to the <code>(:)</code> constructor, so the garbage collector is free to reclaim it when it runs next. (The <code>'a'</code> value is shared, so there are still pointers to it, so it neither gets collected nor allocated during this process.)</p>\n\n<p>What happens when <code>_thunk1</code> is evaluated is a bit subtle. It makes the recursive call to <code>splitAt 999999 ...</code>.  It results in <code>('a':_thunk3, _thunk4)</code>.  Nothing is holding on to <code>_thunk4</code>, so it's free to be garbage collected whenever.  Evaluation of <code>length</code> proceeds as above.  The <code>(:)</code> constructor is no longer held in memory, and is free to be collected.</p>\n\n<p>Evaluation proceeds that way, only ever holding on to a single <code>(:)</code> constructor on the heap at a time, and without burning any stack space at all.  And GHC's garbage collector's run time depends on the size of the resident set.  As there is at most one <code>(:)</code> constructor resident, it goes <em>really</em> fast in this case.</p>\n\n<p>I suspect in this case, that's the speed difference you're seeing.  You should try running the two programs with the argument <code>+RTS -s</code> and looking at stats regarding maximum resident size and garbage collector run time.</p>\n\n<p>It's possible GHC is being <em>really</em> clever in optimization, though.  I haven't checked it out, but I know in some cases it can rewrite algorithms in terms of explicit <code>(:)</code> application in terms of the <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/GHC-Exts.html#v:build\"><code>build</code></a> function. If it were to do so, it would allow foldr/build fusion to remove the allocation of the <code>(:)</code> constructors entirely.  (Yes, <code>length</code> is defined in terms of <code>foldr</code> via some really cool tricks for efficiency, mostly to allow foldr/build fusion to work.)</p>\n\n<p>If that's the case, you'd find even less allocation taking place in the lazy case - but the strict case would be just as bad.  I don't think that's likely to be happening here, but I'm not sure, as I haven't tested.</p>\n"}], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 412, "favorite_count": 1, "accepted_answer_id": 42151076, "answer_count": 1, "score": 8, "last_activity_date": 1486697804, "creation_date": 1486694563, "question_id": 42150614, "link": "https://stackoverflow.com/questions/42150614/why-is-the-lazy-pattern-match-version-of-splitat-function-faster", "title": "Why is the lazy pattern match version of splitAt function faster?", "body": "<p>The <code>splitAt</code> function can be implemented as following (<a href=\"https://wiki.haskell.org/Lazy_pattern_match\" rel=\"noreferrer\">https://wiki.haskell.org/Lazy_pattern_match</a>):</p>\n\n<pre><code>import Prelude hiding (splitAt)\nsplitAt :: Int -&gt; [a] -&gt; ([a], [a])\nsplitAt n xs =\n  if n&lt;=0\n     then ([], xs)\n     else\n        case xs of\n          [] -&gt; ([], [])\n          y:ys -&gt;\n            case splitAt (n-1) ys of\n              ~(prefix, suffix) -&gt; (y : prefix, suffix) -- Here using lazy pattern match\n\nmain :: IO ()\nmain = do\n  let r = splitAt 1000000 $ repeat 'a'\n  print $ length $ fst r\n</code></pre>\n\n<p>And using the strict pattern match can slow the speed very much.</p>\n\n<pre><code>time ./lazy     -- 0.04s user 0.00s system 90% cpu 0.047 total\ntime ./strict   -- 0.12s user 0.02s system 96% cpu 0.147 total\n</code></pre>\n\n<p>I cannot get the reason. According to the article, the strict version may need more memory and all recursive calls to check whether the pattern fits. But I think the lazy version also needs all recursive calls and needs memory to contain the result of recursive function calls. What makes that differences?</p>\n"}, {"tags": ["haskell", "types", "proof", "dependent-type"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486685381, "post_id": 42148901, "comment_id": 71464875, "body": "It looks possible but it seems to require proving that by induction on <code>x</code>, and probably defining and using a singleton for <code>x</code> somewhere. Further, this machinery unfortunately won&#39;t get erased at runtime, so we will waste O(n) steps only to produce a single <code>Refl</code>. (I really wish GHC will optimize this to O(1) someday... :) )"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1486686232, "post_id": 42148901, "comment_id": 71465167, "body": "@chi You&#39;ve mentioned this sort of GHC optimization several times (that I can recall) and I&#39;m really starting to wish it existed too. Are there any existing efforts for this that you know of?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1486720087, "post_id": 42148901, "comment_id": 71477816, "body": "@Alec I&#39;m sorry for my prolonged rant/wish, I can&#39;t help it :) I&#39;m not following GHC development, so I can&#39;t comment on whether there are some plans for that."}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 7542694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b2193f301bde2c186abfff758eac53e?s=128&d=identicon&r=PG&f=1", "display_name": "Levi Roth", "link": "https://stackoverflow.com/users/7542694/levi-roth"}, "edited": false, "score": 0, "creation_date": 1486742360, "post_id": 42149329, "comment_id": 71492129, "body": "Thanks, this is definitely what I was looking for \u2014 though, as you noted, I&#39;ll have to do some reading before I fully understand what&#39;s going on here."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 123, "user_id": 7542694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b2193f301bde2c186abfff758eac53e?s=128&d=identicon&r=PG&f=1", "display_name": "Levi Roth", "link": "https://stackoverflow.com/users/7542694/levi-roth"}, "edited": false, "score": 0, "creation_date": 1486833071, "post_id": 42149329, "comment_id": 71520623, "body": "@Levi Roth, you don&#39;t need any proofs to define this function: see <a href=\"https://www.reddit.com/r/haskell/comments/2tmxsv/a_type_safe_reverse_or_some_hasochism/\" rel=\"nofollow noreferrer\">this</a> post."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1486841012, "post_id": 42149329, "comment_id": 71523394, "body": "@user3237465 Are you suggesting we just bypass the proofs manually using unsafeCoerce (because we already know are non-bottom)?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1486886550, "post_id": 42149329, "comment_id": 71533068, "body": "@user3237465 Ah yes! That is a clever trick I have yet to master. Would this work for the <code>aux</code> function OP was asking about? (Note that <code>rev</code> doesn&#39;t need any proofs here either - but it is much less efficient that the version you linked)."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1486907281, "post_id": 42149329, "comment_id": 71538562, "body": "Yes, it works for <code>aux</code> too. Looks something like <a href=\"http://ideone.com/1FoqwG\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1486927741, "post_id": 42149329, "comment_id": 71546223, "body": "@user3237465 What is the intuition behind making these auxiliary newtypes? I sort of see how they work but I wouldn&#39;t be able to come up with one..."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1487008266, "post_id": 42149329, "comment_id": 71581825, "body": "@Alec, it&#39;s a way to get type-level lambda to handle polymorphic recursion. E.g. in the definition of <code>foldlVec</code> in the recursive case <code>p</code> becomes <code>\\n -&gt; p (S n)</code>, but we don&#39;t have type-level lambdas and hence write <code>Compose p S</code>. In <code>aux</code> I just expressed <code>\\n -&gt; (a, List a (n + S m))</code> via the <code>Aux</code> wrapper which can be partially applied just like <code>Compose</code>, so we can instantiate <code>p</code> with it. It&#39;s a purely mechanical process."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 8, "last_activity_date": 1486697876, "last_edit_date": 1486697876, "creation_date": 1486685483, "answer_id": 42149329, "question_id": 42148901, "link": "https://stackoverflow.com/questions/42148901/using-the-type-system-to-check-length-of-output-vs-input-list/42149329#42149329", "title": "Using the type system to check length of output vs. input list", "body": "<p>First, some imports and language extensions:</p>\n\n<pre><code>{-# LANGUAGE GADTs, TypeInType, RankNTypes, TypeOperators, TypeFamilies, TypeApplications, AllowAmbiguousTypes #-}\n\nimport Data.Type.Equality\n</code></pre>\n\n<p>We now have <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#datatype-promotion\"><code>DataKinds</code> (or <code>TypeInType</code>)</a> which allows us to promote <em>any</em> data to the type level (with its own kind), so the type level naturals really deserve to be defined as a regular <code>data</code> (heck, this is <em>exactly</em> the motivating examples the previous link to the GHC docs give!). Nothing changes with your <code>List</code> type, but <code>(:+:)</code> really should be a <em>closed</em> type family (now over things of kind <code>Nat</code>).</p>\n\n<pre><code>-- A natural number type (that can be promoted to the type level)\ndata Nat = Z | S Nat\n\n-- A List of length 'n' holding values of type 'a'\ndata List a n where\n  Nil  :: List a Z\n  Cons :: a -&gt; List a m -&gt; List a (S m)\n\ntype family (+) (a :: Nat) (b :: Nat) :: Nat where\n  Z + n = n\n  S m + n = S (m + n)\n</code></pre>\n\n<p>Now, in order to make the proofs work for <code>aux</code>, it is useful to define <a href=\"https://typesandkinds.wordpress.com/tag/singletons/\">singleton types</a> for natural numbers.</p>\n\n<pre><code>-- A singleton type for `Nat`\ndata SNat n where\n  SZero :: SNat Z\n  SSucc :: SNat n -&gt; SNat (S n)\n\n-- Utility for taking the predecessor of an `SNat`\nsub1 :: SNat (S n) -&gt; SNat n\nsub1 (SSucc x) = x\n\n-- Find the size of a list\nsize :: List a n -&gt; SNat n\nsize Nil = SZero\nsize (Cons _ xs) = SSucc (size xs)\n</code></pre>\n\n<p>Now, we are in shape to start proving some stuff. From <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Type-Equality.html\"><code>Data.Type.Equality</code></a>, <code>a :~: b</code> represents a proof that <code>a ~ b</code>. We need to prove one simple thing about arithmetic.</p>\n\n<pre><code>-- Proof that     n + (S m) == S (n + m)\nplusSucc :: SNat n -&gt; SNat m -&gt; (n + S m) :~: S (n + m)\nplusSucc SZero _ = Refl\nplusSucc (SSucc n) m = gcastWith (plusSucc n m) Refl\n</code></pre>\n\n<p>Finally, we can use <a href=\"https://hackage.haskell.org/package/base-4.9.1.0/docs/Data-Type-Equality.html#v:gcastWith\"><code>gcastWith</code></a> to use this proof in <code>aux</code>. Oh and you were missing the <code>Ord a</code> constraint. :)</p>\n\n<pre><code>aux :: Ord a =&gt; List a n -&gt; a -&gt; List a m -&gt; List a (n + S m)\naux Nil prev acc = Cons prev acc\naux (Cons hd tl) prev acc = gcastWith (plusSucc (size tl) (SSucc (size acc)))\n                                      aux tl hd (Cons (max hd prev) acc)\n\n-- append to a list\n(|&gt;) :: List a n -&gt; a -&gt; List a (S n)\nNil |&gt; y = Cons y Nil\n(Cons x xs) |&gt; y = Cons x (xs |&gt; y)\n\n-- reverse 'List'\nrev :: List a n -&gt; List a n\nrev Nil = Nil\nrev (Cons x xs) = rev xs |&gt; x\n</code></pre>\n\n<hr>\n\n<p>Let me know if this answers your question - getting started with this sort of thing involves a lot of new stuff.</p>\n"}], "owner": {"reputation": 123, "user_id": 7542694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b2193f301bde2c186abfff758eac53e?s=128&d=identicon&r=PG&f=1", "display_name": "Levi Roth", "link": "https://stackoverflow.com/users/7542694/levi-roth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "accepted_answer_id": 42149329, "answer_count": 1, "score": 12, "last_activity_date": 1486697876, "creation_date": 1486682988, "last_edit_date": 1495542310, "question_id": 42148901, "link": "https://stackoverflow.com/questions/42148901/using-the-type-system-to-check-length-of-output-vs-input-list", "title": "Using the type system to check length of output vs. input list", "body": "<p>Suppose a list L, with length <em>n</em>, is interleaved in list J, with length <em>n + 1</em>. \nWe'd like to know, for each element of J, which of its neighbors from L is the greater.\nThe following function takes L as its input, and produces a list K, also of length\n<em>n + 1</em>, such that the <em>i</em>th element of K is the desired neighbor of the <em>i</em>th element of J.</p>\n\n<pre><code>aux [] prev acc = prev:acc\naux (hd:tl) prev acc = aux tl hd ((max hd prev):acc)\n\nexpand row = reverse (aux row 0 [])\n</code></pre>\n\n<p>I can prove to myself, informally, that the length of the result of this function (which I\noriginally wrote in Ocaml) is one greater than the length of the input. But I\nhopped over to Haskell (a new language for me) because I got interested in being\nable to prove via the type system that this invariant holds. With the help\nof <a href=\"https://stackoverflow.com/a/32570481/7542694\">this previous answer</a>, I was\nable to get as far as the following:</p>\n\n<pre><code>{-# LANGUAGE GADTs, TypeOperators, TypeFamilies #-}\n\ndata Z\ndata S n\n\ntype family (:+:) a b :: *\ntype instance (:+:) Z n = n\ntype instance (:+:) (S m) n = S (m :+: n)\n\n-- A List of length 'n' holding values of type 'a'\ndata List a n where\n    Nil  :: List a Z\n    Cons :: a -&gt; List a m -&gt; List a (S m)\n\naux :: List a n -&gt; a -&gt; List a m -&gt; List a (n :+: (S m))\naux Nil prev acc = Cons prev acc\naux (Cons hd tl) prev acc = aux tl hd (Cons (max hd prev) acc)\n</code></pre>\n\n<p>However, the last line produces the following error: </p>\n\n<pre><code>* Could not deduce: (m1 :+: S (S m)) ~ S (m1 :+: S m)\n  from the context: n ~ S m1\n    bound by a pattern with constructor:\n               Cons :: forall a m. a -&gt; List a m -&gt; List a (S m),\n             in an equation for `aux'\n    at pyramid.hs:23:6-15\n  Expected type: List a (n :+: S m)\n    Actual type: List a (m1 :+: S (S m))\n* In the expression: aux tl hd (Cons (max hd prev) acc)\n  In an equation for `aux':\n      aux (Cons hd tl) prev acc = aux tl hd (Cons (max hd prev) acc)\n* Relevant bindings include\n    acc :: List a m (bound at pyramid.hs:23:23)\n    tl :: List a m1 (bound at pyramid.hs:23:14)\n    aux :: List a n -&gt; a -&gt; List a m -&gt; List a (n :+: S m)\n      (bound at pyramid.hs:22:1)\n</code></pre>\n\n<p>It seems that what I need to do is teach the compiler that <code>(x :+: (S y)) ~ S (x :+: y)</code>. Is this possible?</p>\n\n<p>Alternatively, are there better tools for this problem than the type system?</p>\n"}, {"tags": ["haskell", "recursion-schemes"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1486746724, "post_id": 42148749, "comment_id": 71494762, "body": "Seems like you could use a catamorphism to get a map of lists, and then just <code>fmap</code> a catamorphism (a fold, really) for each group."}, {"owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "reply_to_user": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 0, "creation_date": 1486747893, "post_id": 42148749, "comment_id": 71495482, "body": "A more modular way to apply <code>valueAlgebra</code>? Seems a good idea. Now I pass the algebra to <code>alter</code>, which accepts its church-encoded version. And the decoding is painful."}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1486767904, "last_edit_date": 1486767904, "creation_date": 1486752617, "answer_id": 42166626, "question_id": 42148749, "link": "https://stackoverflow.com/questions/42148749/ramdajs-reduceby-in-haskell-using-recursion-schemes/42166626#42166626", "title": "RamdaJS reduceBy() in Haskell using recursion-schemes", "body": "<p>I don't see anything wrong with your approach. The arguments to <code>alter</code> are not too pleasant to look at, but that's mostly beacues <code>alter</code> is a little clumsy to use. Since you don't need to remove elements from the map, it is possible to rewrite <code>fooAlgebra</code> using <code>insertWith</code> rather than <code>alter</code>...</p>\n\n<pre><code>fooAlgebra\n  :: Ord k =&gt;\n     (ListF t a -&gt; a) -&gt; (t -&gt; k) -&gt; ListF t (M.Map k a) -&gt; M.Map k a\nfooAlgebra valueAlgebra keyFn = \\case\n    Nil -&gt; M.empty\n    Cons elt acc -&gt; M.insertWith\n         (\\_ grpAcc -&gt; valueAlgebra (Cons elt grpAcc))\n         (keyFn elt)\n         (valueAlgebra (Cons elt (valueAlgebra Nil)))\n         acc\n</code></pre>\n\n<p>... which you may or may not find an improvement.</p>\n\n<p>As for using a catamorphism, it feels like a natural thing to do, as you are destroying the original structure to produce a group-wise summary of the elements. (It is also worth noting that if <code>keyFn</code> is a constant function then <code>reduceBy</code> becomes, in essence, a plain old fold of all elements with <code>valueAlgebra</code>.) The refactoring that danidiaz suggests (i.e. separating the <code>valueAlgebra</code> catamorphism from the grouping one) arguably makes that more evident:</p>\n\n<pre><code>reduceBy valueAlgebra keyFn =\n    fmap (cata valueAlgebra) . cata (groupAlgebra keyFn)\n\ngroupAlgebra\n  :: Ord k =&gt; (t -&gt; k) -&gt; ListF t (M.Map k [t]) -&gt; M.Map k [t]\ngroupAlgebra keyFn = \\case\n    Nil -&gt; M.empty\n    Cons elt acc -&gt; M.alter\n         (Just . (elt :) . fromMaybe [])\n         (keyFn elt)\n         acc\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "is_accepted": false, "score": 2, "last_activity_date": 1486865551, "last_edit_date": 1486865551, "creation_date": 1486772499, "answer_id": 42170753, "question_id": 42148749, "link": "https://stackoverflow.com/questions/42148749/ramdajs-reduceby-in-haskell-using-recursion-schemes/42170753#42170753", "title": "RamdaJS reduceBy() in Haskell using recursion-schemes", "body": "<p>My own attempt based on all the advices so far:</p>\n\n<pre><code>type ListAlgebra a b = ListF a b -&gt; b\n\nreduceBy :: Ord k =&gt; ListAlgebra t b -&gt; (t -&gt; k) -&gt; [t] -&gt; M.Map k b\nreduceBy valueAlgebra keyFn x = cata valueAlgebra &lt;$&gt; cata groupAlgebra x where\n    groupAlgebra = \\case\n        Nil -&gt; M.empty\n        Cons elt acc -&gt; M.alter (Just . maybe [elt] (elt:)) (keyFn elt) acc\n</code></pre>\n\n<p>Another direction of attack is to notice that <code>keyFn</code> can be factored out of the <code>groupAlgebra</code>, so it becomes <code>groupAlgebra' :: ListAlgebra (k, v) (M.Map k [v])</code>. In this form it's exactly an <code>embed</code>, albeit somewhat exotic:</p>\n\n<pre><code>newtype XMap k v = XMap { unXMap :: M.Map k [v] }\ntype instance Base (XMap k v) = ListF (k, v)\ninstance Ord k =&gt; Corecursive (XMap k v) where\n    embed = \\case\n        Nil -&gt; XMap M.empty\n        Cons (key,elt) acc -&gt; XMap $ M.alter (Just . maybe [elt] (elt:)) key $ unXMap acc\n</code></pre>\n\n<p>No fixpoints were harmed during creation of this instance. Our <code>reduceBy</code> now can be constructed with a <code>refix</code> \"cast\" (a hylomorphism that gets its algebra and coalgebra from <code>(Co)recursive</code> instances):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>reduceBy :: Ord k =&gt; ListAlgebra t b -&gt; (t -&gt; k) -&gt; [t] -&gt; M.Map k b\nreduceBy valueAlgebra keyFn =\n    fmap (cata valueAlgebra) . unXMap . refix . map (keyFn &amp;&amp;&amp; id)\n</code></pre>\n\n<p>Note that the approach is completely modular: you can easily tear the function apart into independent combinators, and also can construct the maps flexibly using anamorphisms and other unfolds instead of just consuming lists. </p>\n"}], "owner": {"reputation": 13121, "user_id": 805266, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/eabce8cd59f72d8f9e7db06a0343bdb1?s=128&d=identicon&r=PG", "display_name": "nponeccop", "link": "https://stackoverflow.com/users/805266/nponeccop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 1, "accepted_answer_id": 42166626, "answer_count": 2, "score": 4, "last_activity_date": 1486865551, "creation_date": 1486682244, "question_id": 42148749, "link": "https://stackoverflow.com/questions/42148749/ramdajs-reduceby-in-haskell-using-recursion-schemes", "title": "RamdaJS reduceBy() in Haskell using recursion-schemes", "body": "<p>I have the following code using <code>recursion-schemes</code> library:</p>\n\n<pre><code>{-# LANGUAGE LambdaCase #-}\n{-# LANGUAGE TypeFamilies #-}\nimport Data.Functor.Foldable\nimport Data.Maybe\n\nimport qualified Data.Map as M\n\nreduceBy valueAlgebra keyFn = cata $ fooAlgebra valueAlgebra keyFn\n\nfooAlgebra\n  :: Ord k =&gt;\n     (ListF t a -&gt; a) -&gt; (t -&gt; k) -&gt; ListF t (M.Map k a) -&gt; M.Map k a   \nfooAlgebra valueAlgebra keyFn = \\case\n    Nil -&gt; M.empty\n    Cons elt acc -&gt; M.alter \n         (Just . (valueAlgebra . Cons elt) . fromMaybe (valueAlgebra Nil)) \n         (keyFn elt)\n         acc\n</code></pre>\n\n<p>Use as <code>let countBy = reduceBy (\\case Nil -&gt; 0 ; Cons a b -&gt; succ b) id in countBy [42,5,5,8,8,8]</code>. The code mimics <a href=\"http://ramdajs.com/docs/#reduceBy\" rel=\"nofollow noreferrer\">http://ramdajs.com/docs/#reduceBy</a></p>\n\n<p>Is there a better way to implement <code>reduceBy</code> using <code>recursion-schemes</code>? The <code>alter</code> arguments seem fragile, and is <code>cata</code> really appropriate there? I heard that some things are implementable both as <code>ana</code> and <code>cata</code>.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 3, "creation_date": 1486682468, "post_id": 42148504, "comment_id": 71463896, "body": "They are -- <code>:i</code> is reliable, they are listed as instances of <code>Floating</code> (which has <code>Fractional</code> as superclass), and if you go to the <a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/src/GHC.Float.html#line-466\" rel=\"nofollow noreferrer\">source code for <code>Double</code>&#39;s <code>Floating</code> instance</a> you will find the <code>Fractional</code> one a few lines above. This does look like a  documentation/Haddock bug of some sort, though -- the instances should have been listed there."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1486684988, "post_id": 42148504, "comment_id": 71464745, "body": "(This seems to be a known Haddock bug -- cf. <a href=\"https://github.com/haskell/haddock/issues/372\" rel=\"nofollow noreferrer\">Haddock issue #372</a>.)"}], "answers": [{"tags": [], "owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "is_accepted": true, "score": 10, "last_activity_date": 1527302251, "last_edit_date": 1527302251, "creation_date": 1486682430, "answer_id": 42148791, "question_id": 42148504, "link": "https://stackoverflow.com/questions/42148504/are-float-and-double-instances-of-fractional/42148791#42148791", "title": "Are Float and Double instances of Fractional?", "body": "<ul>\n<li><code>Double</code> and <code>Float</code> are a part of <code>RealFloat</code>, \n\n<ul>\n<li>which extends <code>RealFrac</code> and <code>Floating</code>;\n\n<ul>\n<li>both of which extend <code>Fractional</code>. </li>\n</ul></li>\n</ul></li>\n</ul>\n"}], "owner": {"reputation": 951, "user_id": 6253996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/XUk8U.jpg?s=128&g=1", "display_name": "bzim", "link": "https://stackoverflow.com/users/6253996/bzim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 468, "favorite_count": 1, "accepted_answer_id": 42148791, "answer_count": 1, "score": 6, "last_activity_date": 1528426594, "creation_date": 1486681096, "last_edit_date": 1528426594, "question_id": 42148504, "link": "https://stackoverflow.com/questions/42148504/are-float-and-double-instances-of-fractional", "title": "Are Float and Double instances of Fractional?", "body": "<p>If I enter \":i Double\" or \":i Float\" in ghci, it says that Double and Float are instances of Fractional. But in the Haskell docs it says that they aren't. So are they or not?\n<a href=\"http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:Fractional\" rel=\"noreferrer\">http://hackage.haskell.org/package/base-4.9.1.0/docs/Prelude.html#t:Fractional</a></p>\n"}]