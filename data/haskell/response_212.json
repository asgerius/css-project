[{"tags": ["list", "haskell", "lambda", "higher-order-functions", "fold"], "comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1548894937, "post_id": 54451094, "comment_id": 95711731, "body": "It&#39;s hard for me to follow most of the details (I&#39;m barely beyond beginner at Haskell myself), but I can offer some pointers. Firstly, <code>foldTest</code> has its last 2 arguments flipped in comparison to <code>foldl</code>, and then the final argument (the initial accumulator, of type <code>b</code>) has been &quot;left out&quot; - so it&#39;s given in a form where it takes a fold function and a list, and results in a <code>b -&gt; b</code> function. And it constructs this function by (right) folding over the list - so the initial accumulator value must itself be a function, which is what <code>r</code> is in the lambda. And <code>b</code> is its argument."}, {"owner": {"reputation": 1963, "user_id": 2840542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eO77F.jpg?s=128&g=1", "display_name": "AntC", "link": "https://stackoverflow.com/users/2840542/antc"}, "edited": false, "score": 1, "creation_date": 1548936072, "post_id": 54451094, "comment_id": 95728174, "body": "Um, I&#39;m getting <code>foldlTest (-) [1,2,3] 10 = 4</code> (positive). Same result from <code>foldl (-) 10 [1, 2, 3]</code>, and <code>foldr (flip (-)) 10 [1, 2, 3]</code>. And in general (for finite lists) <code>foldl f z xs = foldr (flip f) z xs</code>. Note <code>(flip (flip f)) === f</code>."}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1548903311, "post_id": 54452629, "comment_id": 95713600, "body": "I realise I&#39;ve been a bit circular here, in that I&#39;ve worked backwards from the implementation of the lambda to what its type must be, then tried to imagine what the implementation might be based on the type. So really you can (and arguably should!) ignore that particular section where I say there are only 2 non-trivial ways to implement it, and skip to the details as to how the actual lambda given implements <code>foldl</code>. I did say this would be rambling!"}], "tags": [], "owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "is_accepted": false, "score": 5, "last_activity_date": 1548903603, "last_edit_date": 1548903603, "creation_date": 1548903182, "answer_id": 54452629, "question_id": 54451094, "link": "https://stackoverflow.com/questions/54451094/writing-foldl-as-foldr-confusion/54452629#54452629", "title": "Writing foldl as foldr confusion", "body": "<p>OK, since none of our resident Haskell experts has yet stepped up to explain this, I thought I'd have a go. Please everyone, feel free to correct anything you see wrong, because I'm really just feeling my way towards the answer here, and the following will by its very nature be a bit rambling.</p>\n\n<p>First, as always in Haskell, it's a good idea to look at the types:</p>\n\n<pre><code>Prelude&gt; :t foldl\nfoldl :: Foldable t =&gt; (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b\n</code></pre>\n\n<p>Since we're just interested in lists here, and not generic <code>Foldable</code>s, let's specialise this to:</p>\n\n<pre><code>foldl ::  (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\n</code></pre>\n\n<p>and compare with the function you've been given:</p>\n\n<pre><code>foldlTest:: (b -&gt; a -&gt; b) -&gt; [a] -&gt; (b -&gt; b)\n</code></pre>\n\n<p>Since Haskell functions are curried, which is another way of saying that <code>-&gt;</code> arrows in type signatures are right associative, the last pair of parentheses there is unnecessary, so this is the same as:</p>\n\n<pre><code>foldlTest:: (b -&gt; a -&gt; b) -&gt; [a] -&gt; b -&gt; b\n</code></pre>\n\n<p>Comparing with that for <code>foldl</code> above, we see that they're identical except for the fact that the last two parameters - the <code>[a]</code> and the <code>b</code> - have been flipped over.</p>\n\n<p>So we can already observe that, while the library function <code>foldl</code> takes a fold function, a starting accumulator, and a list to fold, to produce a new accumulator, the <code>foldlTest</code> version takes a fold function, a list to fold, and a starting accumulator, to produce a new accumulator. That sounds like the exact same thing, which it is, but if we now reintroduce the pair of brackets which I took off a few steps ago, we see that <code>foldlTest</code>, in the form you've shown, can be thought of as:</p>\n\n<p><em>taking a fold function and a list, and producing a function <code>b -&gt; b</code> which describes how folding over the list transforms the initial accumulator into the final result</em>.</p>\n\n<p>Note in particular that what it returns, in this formulation, is indeed a function.</p>\n\n<p>So now we're ready to look at the actual implementation that you've seen:</p>\n\n<pre><code>foldlTest f xs = foldr (\\x r b -&gt; r (f b x))\n                (\\b -&gt; b)\n                xs\n</code></pre>\n\n<p>I'll be the first to admit that this is rather complicated, even confusing. As ever, lets examine the types.</p>\n\n<p>The input types are easy. We know from the above discussion that <code>f</code> has type <code>b -&gt; a -&gt; b</code>, and <code>xs</code> has type <code>[a]</code>.</p>\n\n<p>OK, what about that lambda? Let's take it in stages:</p>\n\n<ul>\n<li>It takes 3 arguments, <code>x</code>, <code>r</code> and <code>b</code>, in that order.</li>\n<li>The result of the function call is <code>r (f b x)</code>. This already tells us a lot, if we sit down and think about it!</li>\n<li>For one, we know <code>f</code> has type <code>b -&gt; a -&gt; b</code>, so from <code>f b x</code> we know that <code>b</code> has type <code>b</code> and <code>x</code> has type <code>a</code>.</li>\n<li>As for <code>r</code>, we see that it must be a function, because it's applied to <code>f b x</code>. And we know the latter has type <code>b</code> (from the type signature of <code>f</code>). So <code>r</code> has type <code>b -&gt; c</code>, for some type <code>c</code>.</li>\n<li>Therefore our complicated lambda function has the type <code>a -&gt; (b -&gt; c) -&gt; b -&gt; c</code>, where <code>c</code> is some type we haven't yet determined.</li>\n<li>Now comes a key point. This lambda is presented as the first argument (the fold function) to the <code>foldr</code> function. Therefore it must have the type <code>d -&gt; e -&gt; e</code>, for some types <code>d</code> and <code>e</code>.</li>\n<li>Remember that functions are curried, and although it seems like the lambda's signature takes 3 arguments, we can reduce it to 2 by rewriting as <code>a -&gt; (b -&gt; c) -&gt; (b -&gt; c)</code>. That's an exact match for the signature we know <code>foldr</code> is looking for, with <code>d</code> equal to <code>a</code> and <code>e</code> equal to <code>b -&gt; c</code>.</li>\n</ul>\n\n<p>And it we specialise <code>foldr</code>'s signature so that it accepts this type of function, we find that it is:</p>\n\n<pre><code>foldr :: (a -&gt; (b -&gt; c) -&gt; (b -&gt; c)) -&gt; (b -&gt; c) -&gt; [a] -&gt; (b -&gt; c)`\n</code></pre>\n\n<p>We still don't know what <code>c</code> is - but we don't have to wonder much longer. The above is the signature for a fold which goes over a list of <code>a</code>s, and produces a <em>function</em> from <code>b</code> to <code>c</code>. The next argument to <code>foldr</code>, which is of type <code>b -&gt; c</code>, is given (by the implementation we're trying to decipher) as <code>\\b -&gt; b</code>. This is just the identity function, of course, and crucially it is a function from a type to itself. So the <code>b -&gt; c</code> type must actually be <code>b -&gt; b</code>, or in other words <code>c</code> was the same as <code>b</code> all along!</p>\n\n<p>So that lambda must have the following type:</p>\n\n<pre><code>a -&gt; (b -&gt; b) -&gt; (b -&gt; b)\n</code></pre>\n\n<p>It takes an <code>a</code>, and an endomorphism on <code>b</code> (that just means a function from <code>b</code> to itself), and returns another endomorphism on <code>b</code>. And this is the function we will fold the list of <code>a</code>s with, taking the identity function as a starting point, to produce the endomorphism <code>b -&gt; b</code> that will implement the left fold we're after.</p>\n\n<p>The above type signature on its own doesn't give us much clue of how to implement it, given that <code>a</code> and <code>b</code> could be anything. However, we do have our function <code>f</code> that relates them - recall it takes a <code>b</code> and an <code>a</code>, and produces a <code>b</code>. Given that (by undoing the currying again), the above function requires us, given an <code>a</code>, a <code>b -&gt; b</code> function, and a <code>b</code>, to produce another <code>b</code>, I can only see two non-trivial ways to do it:</p>\n\n<ul>\n<li>apply the function to the <code>b</code>, then apply <code>f</code> to the <code>a</code> and the result.</li>\n<li>apply <code>f</code> to the <code>a</code> and the <code>b</code>, then apply the <code>b -&gt; b</code> function to the result</li>\n</ul>\n\n<p>The second of these two is exactly what that lambda you are asking about does, as hopefully is now obvious from looking at it. (The first option would be written <code>\\x r b -&gt; f (r b) x</code>. I'm not actually sure what overall effect this would produce, although I haven't thought about it much.)</p>\n\n<p>I've covered a lot of ground, although it feels like more than it really is, because I've tried to be very painstaking. To recap, what the <code>foldlTest</code> function does is, given a list of <code>a</code>s and a function <code>f :: b -&gt; a -&gt; b</code>, produces a function <code>b -&gt; b</code> that is built by starting with the identity function, and walking right-to-left along the list, changing the current function <code>r :: b -&gt; b</code> to the one that sends <code>b</code> to <code>r (f b x)</code> - where <code>x :: a</code> is the element of the list we are currently at.</p>\n\n<p>That's a rather algorithmic description of what <code>foldlTest</code> does. Let's try to see what it does to an actual list - not a concrete one, but let's say a 3-element list <code>[a1, a2, a3]</code>. We start with the identity function <code>\\b -&gt; b</code>, and successively transform it into:</p>\n\n<ul>\n<li><code>b -&gt; f b a3</code> (recall that <code>r</code> starts as the identity function)</li>\n<li><code>b -&gt; f (f b a2) a3</code> (this is just substituting the previous function as <code>r</code> into <code>\\b -&gt; r (f b x)</code>, with <code>a2</code> now playing the role of <code>x</code>)</li>\n<li><code>b -&gt; f (f (f b a1) a2) a3</code></li>\n</ul>\n\n<p>I hope you can now see that this looks an awful lot like folding the list from the left with the same function <code>f</code>. And by \"looks an awful lot like\", I actually mean it's identical! (If you haven't seen or tried it before, try to write out the successive stages of <code>foldl f b [a1, a2, a3]</code> and you'll see the identical pattern.)</p>\n\n<p>So apologies again that this has been a bit rambling, but I hope this has given you enough information to answer the questions you asked. And don't worry if it makes your brain hurt a bit - it does mine too! :)</p>\n"}, {"tags": [], "owner": {"reputation": 1677, "user_id": 4105099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/383350df3cda0186e32237dfc271490e?s=128&d=identicon&r=PG&f=1", "display_name": "jan.vogt", "link": "https://stackoverflow.com/users/4105099/jan-vogt"}, "is_accepted": false, "score": 0, "last_activity_date": 1548946383, "last_edit_date": 1548946383, "creation_date": 1548942970, "answer_id": 54462157, "question_id": 54451094, "link": "https://stackoverflow.com/questions/54451094/writing-foldl-as-foldr-confusion/54462157#54462157", "title": "Writing foldl as foldr confusion", "body": "<p>The answer you've been given (not the one on SO, the one you cited in your question) seems to be more difficult than necessary. I assume it is intended to teach you some aspects of folds, but apparently this is not working well. I try to show what's happening and in the process answer your questions.</p>\n\n<h3>3) What exactly does the lambda function do and how is it different from a regular foldr?</h3>\n\n<p>The whole thing just builds a left fold (<code>foldl</code>) out of a right fold (<code>foldr</code>) and flips the last two arguments. It is equivalent to</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>foldTest f = flip (foldr (flip f))\nfoldTest f = flip (foldl f)\n</code></pre>\n\n<p>and it does so in a rather obscure way, by accumulating a function and does the flipping via a lambda.</p>\n\n<h3>1) Does the 10 take the place of the b in b -> b? (then the b would be the initial accumulator value) What I don't understand is what the (\\x r b -> r (f b x)) part does.</h3>\n\n<p>Yes, correct. The 10 takes to role of the initial accumulator of a left fold.</p>\n\n<h3>2) What is the value of each of the variables? I am very confused about this lambda function.</h3>\n\n<p>To get an intuition as to what is happening, I find it helpful to do the actual lambda calculus step by step:</p>\n\n<pre><code>foldTest (-) [1,2,3] 10\nfoldTest (-) (1:(2:(3:[]))) 10\n\n-- remember the definition of foldTest which is given in a point-free way\nfoldlTest f xs = foldr (\\x r b -&gt; r (f b x)) (\\b -&gt; b) xs\n\n-- add the hidden parameter and you get\nfoldlTest f xs b' = (foldr (\\x r b -&gt; r (f b x)) (\\b -&gt; b) xs) b'\n\n-- apply that definition with f = (-), xs = (1:(2:(3:[]))), b' = 10\n(foldr (\\x r b -&gt; r ((-) b x)) (\\b -&gt; b) (1:(2:(3:[])))) 10\n(foldr (\\x r b -&gt; r (b - x)) (\\b -&gt; b) (1:(2:(3:[])))) 10\n\n-- the inner lambda function is curried, thus we can write it as\n-- \\x r (\\b -&gt; r (b - x)), which is equivalent but will be handy later on.\n(\n  foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) (1:(2:(3:[])))\n) 10\n\n-- keep in mind foldr is defined as\nfoldr f' b'' []      = b''\nfoldr f' b'' (x:xs') = f' x (foldr f' b'' xs')\n\n-- apply second row of foldr with f' = (\\x r -&gt; (\\b -&gt; r (b - x))),\n-- b'' = (\\b -&gt; b), x = 1 and xs' = (2:(3:[]))\n(\n  (\\x r -&gt; (\\b -&gt; r (b - x))) 1 (foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) (2:(3:[])))\n) 10\n\n-- apply accumulation lambda for the first time with x = 1,\n-- r = foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) (2:(3:[])) gives\n(\n  \\b -&gt; (foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) (2:(3:[]))) (b - 1)\n) 10\n\n-- now we repeat the process for the inner folds\n(\n  \\b -&gt; (\n    foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) (2:(3:[]))\n  ) (b - 1)\n) 10\n(\n  \\b -&gt; (\n    (\\x r -&gt; (\\b -&gt; r (b - x))) 2 (foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) (3:[]))\n  ) (b - 1)\n) 10\n(\n  \\b -&gt; (\n    \\b -&gt; (foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) (3:[])) (b - 2)\n  ) (b - 1)\n) 10\n(\n  \\b -&gt; (\n    \\b -&gt; (\n      foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) (3:[])\n    ) (b - 2)\n  ) (b - 1)\n) 10\n(\n  \\b -&gt; (\n    \\b -&gt; (\n      (\\x r -&gt; (\\b -&gt; r (b - x))) 3 (foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) [])\n    ) (b - 2)\n  ) (b - 1)\n) 10\n(\n  \\b -&gt; (\n    \\b -&gt; (\n      \\b -&gt; (foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) [])) (b - 3)\n    ) (b - 2)\n  ) (b - 1)\n) 10\n(\n  \\b -&gt; (\n    \\b -&gt; (\n      \\b -&gt; (\n        foldr (\\x r -&gt; (\\b -&gt; r (b - x))) (\\b -&gt; b) []\n      ) (b - 3)\n    ) (b - 2)\n  ) (b - 1)\n) 10\n\n-- Now the first line of foldr's definition comes in to play\n(\n  \\b -&gt; (\n    \\b -&gt; (\n      \\b -&gt; (\n        \\b -&gt; b\n      ) (b - 3)\n    ) (b - 2)\n  ) (b - 1)\n) 10\n\n-- applying those lambdas gives us\n(\n  \\b -&gt; (\n    \\b -&gt; (\n      \\b -&gt; (\n        \\b -&gt; b\n      ) (b - 3)\n    ) (b - 2)\n  ) (b - 1)\n) 10\n\n-- So we can see that the foldTest function built another function\n-- doing what we want:\n(\\b -&gt; (\\b -&gt; (\\b -&gt; (\\b -&gt; b) (b - 3)) (b - 2)) (b - 1)) 10\n(\\b -&gt; (\\b -&gt; (\\b -&gt; b) (b - 3)) (b - 2)) (10 - 1)\n(\\b -&gt; (\\b -&gt; b) (b - 3)) ((10 - 1) - 2)\n(\\b -&gt; b) (((10 - 1) - 2) - 3)\n(((10 - 1) - 2) - 3)\n((9 - 2) - 3)\n(7 - 3)\n4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "is_accepted": false, "score": 0, "last_activity_date": 1548963617, "last_edit_date": 1548963617, "creation_date": 1548961359, "answer_id": 54467548, "question_id": 54451094, "link": "https://stackoverflow.com/questions/54451094/writing-foldl-as-foldr-confusion/54467548#54467548", "title": "Writing foldl as foldr confusion", "body": "<p>By the definition of <em><code>foldlTest</code></em>, we have</p>\n\n<pre><code>foldlTest (-) xs b = foldr g n xs b\n    where\n    n     b = b\n    g x r b = r (b - x)\n</code></pre>\n\n<p>By the definition of <em><code>foldr</code></em>, we have</p>\n\n<pre><code>foldr  g  n  [x,y,z]     =  g x (foldr  g  n  [y,z])\n</code></pre>\n\n<p>but also</p>\n\n<pre><code>foldr  g  n  [x,y,z]  b  =  g x (foldr  g  n  [y,z])  b      -- (1)\n                                 ---- r -----------\n                         =       foldr  g  n  [y,z]  (b-x)\n</code></pre>\n\n<p>(when used \"inside\" the <code>foldlTest</code>), and so, by repeated application of <code>(1)</code>,</p>\n\n<pre><code>                         =  g y (foldr  g  n  [z])   (b-x)\n                         =       foldr  g  n  [z]   ((b-x)-y)\n                         =  g z (foldr  g  n  [] )  ((b-x)-y)\n                         =       foldr  g  n  []   (((b-x)-y)-z)\n                         =                 n       (((b-x)-y)-z)\n                         =                         (((b-x)-y)-z)\n</code></pre>\n\n<p>Thus an expression which is equivalent to the left fold is built by the right fold straight up, because <code>g</code> is tail recursive. And thus</p>\n\n<pre><code>foldlTest (-)  [1,2,3]  10\n--             [x,y,z]  b\n==\n(((10 - 1) - 2) - 3)) \n==\nfoldl  (-)  10  [1,2,3]\n</code></pre>\n\n<p>and so we see that <strong><em>no</em></strong>, the <code>b</code> in the <code>n = (\\b -&gt; b)</code> does <strong><em>not</em></strong> accept the <code>10</code>, but rather it accepts <strong><em>the whole expression</em></strong> equivalent to the <strong><em>left fold</em></strong> that has been built by the <em>right fold</em>. </p>\n\n<p>But yes, <code>10</code> <em>is</em> the initial accumulator value in the expression equivalent of the left fold, as intended, that has been built by the right fold.</p>\n"}], "owner": {"reputation": 2181, "user_id": 7058735, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GxhO2.png?s=128&g=1", "display_name": "K Split X", "link": "https://stackoverflow.com/users/7058735/k-split-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 596, "favorite_count": 2, "answer_count": 3, "score": 5, "last_activity_date": 1548963617, "creation_date": 1548890691, "last_edit_date": 1548963510, "question_id": 54451094, "link": "https://stackoverflow.com/questions/54451094/writing-foldl-as-foldr-confusion", "title": "Writing foldl as foldr confusion", "body": "<p>I know there are other posts about this, but mine is slightly different.</p>\n\n<p>I have a function that performs the task of <code>foldl</code>, using <code>foldr</code>. I have the solution given to me, but would like help understanding.</p>\n\n<p><code>foldlTest:: (b -&gt; a -&gt; b) -&gt; [a] -&gt; (b -&gt; b)</code></p>\n\n<pre><code>foldlTest f xs = foldr (\\x r b -&gt; r (f b x))\n                (\\b -&gt; b)\n                xs\n</code></pre>\n\n<p>And It is called using something like this:</p>\n\n<p><code>foldlTest (-) [1,2,3] 10 = -4</code></p>\n\n<hr>\n\n<p>First thing I understand is that my function takes in 2 arguments, but 3 are given in the above test case. This means that the <code>10</code> will take part in a lambda expression I assume.</p>\n\n<p>1) Does the <code>10</code> take the place of the <code>b</code> in <code>b -&gt; b</code>? (then the b would be the initial accumulator value)</p>\n\n<p>What I don't understand is what the <code>(\\x r b -&gt; r (f b x))</code> part does.</p>\n\n<p>2) What is the value of each of the variables? I am very confused about this lambda function.</p>\n\n<p>3) What exactly does the lambda function do and how is it different from a regular <code>foldr</code>?</p>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 4, "creation_date": 1548882559, "post_id": 54449481, "comment_id": 95707875, "body": "Standard Haskell as defined in the Haskell 2010 report requires the restrictions mentioned in the error message. Note that <code>String</code> is not a type variable. You have left off a key part of the error message which tells you that if you enable the <code>FlexibleInstances</code> extension (you can put <code>{-# LANGUAGE FlexibleInstances #-}</code> at the top of your file, then it should work."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 10, "last_activity_date": 1548882766, "last_edit_date": 1548882766, "creation_date": 1548882463, "answer_id": 54449555, "question_id": 54449481, "link": "https://stackoverflow.com/questions/54449481/how-or-why-is-data-set-string-not-a-single-type/54449555#54449555", "title": "How (or why) is `Data.Set String` not a single type?", "body": "<p>The crucial part is</p>\n\n<pre><code>of the form (T a1 ... an) where a1 ... an are *distinct type variables*,\n</code></pre>\n\n<p>Your type is <code>Set String</code>, so <code>T = Set</code> and <code>a1 = String</code> (and <code>n=1</code>). But <code>String</code> is a type, not a type variable. A compliant instance would instead have been</p>\n\n<pre><code>instance (....) =&gt; Semiring (Set a) where\n   ...\n</code></pre>\n\n<p>Anyway, this is an ancient restriction of Haskell2010, which you can ignore. In modern GHC Haskell, you can turn on the <code>FlexibleInstances</code> extension, and use your own instance without issues. GHC itself should suggest to turn this on in the error message.</p>\n\n<p>Note that nowadays almost nobody programs in strict Haskell2010: there are so many extensions which have become too commonly used. Arguably, there should be a revision of the Report, say Haskell2020, where most of the common harmless extensions are included for the great good. Still, until someone actually does that, we will need to turn on extensions frequently.</p>\n"}, {"comments": [{"owner": {"reputation": 15131, "user_id": 166838, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0c01a983961c34967d0ccedda9eb7d49?s=128&d=identicon&r=PG", "display_name": "Elf Sternberg", "link": "https://stackoverflow.com/users/166838/elf-sternberg"}, "edited": false, "score": 0, "creation_date": 1548949211, "post_id": 54449982, "comment_id": 95736373, "body": "Yes, yes it would.  I haven&#39;t gotten that far into Learn You a Haskell yet, though... :-)  (Yes, I&#39;m trying to write an advanced regular expression engine in Haskell without, you know, actually knowing enough Haskell...)"}], "tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 17, "last_activity_date": 1548953590, "last_edit_date": 1548953590, "creation_date": 1548884525, "answer_id": 54449982, "question_id": 54449481, "link": "https://stackoverflow.com/questions/54449481/how-or-why-is-data-set-string-not-a-single-type/54449982#54449982", "title": "How (or why) is `Data.Set String` not a single type?", "body": "<p>chi's answer describes how to do this by turning on an extension, which is perfectly fine. But if you wonder how anyone could get by without this extension, there are a couple approaches. </p>\n\n<p>The simplest change would be to introduce a newtype wrapper, to explicitly get rid of the type variable yourself before defining an instance.</p>\n\n<pre><code>newtype StringSet = StringSet (Set String)\ninstance Semiring StringSet where {...}\n</code></pre>\n\n<p>But of course this feels somewhat clunky and primitive. </p>\n\n<p>Alternatively, it seems to me that you don't need to be so specific as String: your instance would work for any Monoid type, wouldn't it?</p>\n\n<pre><code>instance (Ord a, Monoid a) =&gt; Semiring (Set a) where\n  zero = empty\n  one = singleton mempty\n  add = union\n  mul a b = Data.Set.map (uncurry (&lt;&gt;)) $ cartesianProduct a b\n</code></pre>\n"}], "owner": {"reputation": 15131, "user_id": 166838, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0c01a983961c34967d0ccedda9eb7d49?s=128&d=identicon&r=PG", "display_name": "Elf Sternberg", "link": "https://stackoverflow.com/users/166838/elf-sternberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 54449555, "answer_count": 2, "score": 4, "last_activity_date": 1548953590, "creation_date": 1548882136, "question_id": 54449481, "link": "https://stackoverflow.com/questions/54449481/how-or-why-is-data-set-string-not-a-single-type", "title": "How (or why) is `Data.Set String` not a single type?", "body": "<p>I am studying Haskell the hard way, by trying to write something I find interesting, and right now I'm trying to figure out how to derive a Semiring in Haskell for a specific set of parsing problems:</p>\n\n<pre><code>class Semiring s where\n    zero, one :: s\n    mul, add  :: s -&gt; s -&gt; s\n\ninstance Semiring Bool where\n    zero = False\n    one = True\n    add = (||)\n    mul = (&amp;&amp;)\n\ninstance Semiring (Set String) where\n    zero    = empty \n    one     = singleton \"\"\n    add a b = union a b\n    mul a b = Data.Set.map (\\(c, d) -&gt; c ++ d) $ cartesianProduct a b\n</code></pre>\n\n<p>The Bool ({true, false}, \u2228, \u2227, false, true) version works great.  So does an Int version.  The last one is called a <em>Parse Forest</em>, and its representation is (E, \u222a, \u00b7, \u2205, {&lt;>}), where E is a set of strings and the {&lt;>} is the set of the empty string.  </p>\n\n<p>When I try to compile this, I get:</p>\n\n<pre><code>Rigge\u2026   115  10 error           \u2022 Illegal instance declaration for \u2018Semiring (Set String)\u2019\n(All instance types must be of the form (T a1 ... an)\nwhere a1 ... an are *distinct type variables*,\nand each type variable appears at most once in the instance head.\n</code></pre>\n\n<p>Which doesn't make that much sense to me.  <code>Set String</code> is a distinct type, right, and all of the operations of the <code>class Semiring</code> should be expressible purely in terms of sets of strings.</p>\n\n<p>If you want context, the project is at <a href=\"https://github.com/elfsternberg/riggedregex\" rel=\"nofollow noreferrer\">Rigged Regular Expressions</a>.  The Bool version merely reports back that the regex matched; an Int version reports back the number of different ways a regex could have matched (i.e <code>\"a\" ~ /(a|a*)/</code> will return <code>2</code> because two distinct and unique subexpressions match); the ParseForest should return not the number of ways, but the set of all possible ways\u2014 but it can't, because I don't understand why I can't use a concrete data type, <code>Set String</code>, where another concrete data type like <code>Int</code> or <code>Bool</code> worked okay.</p>\n"}, {"tags": ["haskell", "generic-programming"], "comments": [{"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 3, "creation_date": 1548867351, "post_id": 54444559, "comment_id": 95700545, "body": "As far as <code>Data</code> is concerned, a list <code>[&#39;a&#39;, &#39;b&#39;]</code> is really nested pairs <code>(&#39;a&#39; : (&#39;b&#39; : []))</code> so that the duplication you see can be explained as <code>typeReps</code> &quot;accounting&quot; for these nested pairs. Do you mean to make a special case for <code>[]</code>, or do you have a higher level description of what you want to do that would make the result <code>[[Char], Char, Char]</code>?"}, {"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1548867948, "post_id": 54444559, "comment_id": 95700874, "body": "Oh, that explains it! I would basically like to count the types of the values that occur in a structure, to have a measure of its size. So for instance, I&#39;d expect <code>Foo [1, 2] (&#39;a&#39;, &#39;b&#39;)</code> to return something like <code>[Foo, [Int], Int, Int, (Char, Char), Char, Char]</code>. I don&#39;t know if I defining my problem clearly or properly."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1548868361, "post_id": 54444559, "comment_id": 95701102, "body": "I think you might be better off hard coding special cases for recursive structures, unless you have a lot of them."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1548873731, "post_id": 54446912, "comment_id": 95703784, "body": "Does that also work on <code>Foo [] (&#39;a&#39;, &#39;b&#39;)</code> ? I ask because of the special case for the empty list."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1548876029, "post_id": 54446912, "comment_id": 95704932, "body": "@chi Yep it does: <code>[Foo,[Int],(Char,Char),Char,Char]</code>. The special case for the lists only treats the <i>subterms</i> specially."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1548871660, "creation_date": 1548871660, "answer_id": 54446912, "question_id": 54444559, "link": "https://stackoverflow.com/questions/54444559/get-all-the-typereps-in-a-value-using-generic-programming/54446912#54446912", "title": "Get all the TypeRep&#39;s in a value using generic programming", "body": "<p>As suggested in the comments, it looks like you are not taking into account that <code>[1,2,3]</code> is actually <code>1 : 2 : 3 : []</code> (where <em>each</em> tail subterm has type <code>[Int]</code>). You can just add a special case for lists:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\n\nimport Data.Data\n\n-- | Returns 'Just' only for lists\n--\n-- This can surely be done more efficiently, but it does the job.\nlistTypeReps :: Data a =&gt; a -&gt; Maybe [TypeRep]\nlistTypeReps x\n\n  | typeRepTyCon (typeOf x) == listTyCon\n  , toConstr x == toConstr ([] :: [()])   -- empty list\n  = Just []\n\n  | typeRepTyCon (typeOf x) == listTyCon\n  , toConstr x == toConstr [()]           -- cons\n  , [headTs, _] &lt;- gmapQ typeReps x\n  , [_, Just tailTs] &lt;- gmapQ listTypeReps x\n  = Just (headTs ++ tailTs)\n\n  | otherwise\n  = Nothing\n\nlistTyCon :: TyCon\nlistTyCon = typeRepTyCon (typeOf ([] :: [()]))\n\n-- | Get the types of subterms\ntypeReps :: Data a =&gt; a -&gt; [TypeRep]\ntypeReps x = typeOf x : case listTypeReps x of\n                          Just ts -&gt; ts\n                          Nothing -&gt; concat (gmapQ typeReps x) \n</code></pre>\n\n<p>Try it out:</p>\n\n<pre><code>ghci&gt; :set -XDeriveDataTypeable\nghci&gt; data Foo = Foo [Int] (Char,Char) deriving (Data,Typeable)\nghci&gt; typeReps $ Foo [1, 2] ('a', 'b')\n[Foo,[Int],Int,Int,(Char,Char),Char,Char]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "is_accepted": false, "score": 0, "last_activity_date": 1548947167, "last_edit_date": 1548947167, "creation_date": 1548943312, "answer_id": 54462258, "question_id": 54444559, "link": "https://stackoverflow.com/questions/54444559/get-all-the-typereps-in-a-value-using-generic-programming/54462258#54462258", "title": "Get all the TypeRep&#39;s in a value using generic programming", "body": "<p>Thank you so much for your help! Just in case somebody is interested in solving this using <code>Generics</code>, here's the solution I found with this mechanism:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class Typeable a =&gt; HasTypeReps a where\n  typeReps :: a -&gt; [TypeRep]\n\n  default typeReps :: (Generic a, GHasTypeReps (Rep a)) =&gt; a -&gt; [TypeRep]\n  typeReps a = typeOf a: gTypeReps (from a)\n\nclass GHasTypeReps f where\n  gTypeReps :: f a -&gt; [TypeRep]\n\ninstance GHasTypeReps U1 where\n  gTypeReps U1 = []\n\ninstance (GHasTypeReps a, GHasTypeReps b) =&gt; GHasTypeReps (a :*: b) where\n  gTypeReps (a :*: b) = gTypeReps a ++ gTypeReps b\n\ninstance (GHasTypeReps a, GHasTypeReps b) =&gt; GHasTypeReps (a :+: b) where\n  gTypeReps (L1 a) = gTypeReps a\n  gTypeReps (R1 b) = gTypeReps b\n\n-- | We do need to do anything for the metadata.\ninstance (GHasTypeReps a) =&gt; GHasTypeReps (M1 i c a) where\n    gTypeReps (M1 x) = gTypeReps x\n\n-- | And the only interesting case, get the type of a type constructor\ninstance (HasTypeReps a) =&gt; GHasTypeReps (K1 i a) where\n    gTypeReps (K1 x) = typeReps x\n\ninstance HasTypeReps a =&gt; HasTypeReps [a] where\n  typeReps xs = typeOf xs: concatMap typeReps xs\n\ninstance (HasTypeReps a, HasTypeReps b) =&gt; HasTypeReps (a, b) where\n  typeReps t@(a, b) = typeOf t: (typeReps a ++ typeReps b)\n\ninstance HasTypeReps Char where\n  typeReps x = [typeOf x]\n\ninstance HasTypeReps Int where\n  typeReps x = [typeOf x]\n\n</code></pre>\n\n<p>As pointed out in the <a href=\"https://stackoverflow.com/a/54446912/2289983\">other answer</a>, and by <a href=\"https://stackoverflow.com/questions/54444559/get-all-the-typereps-in-a-value-using-generic-programming?noredirect=1#comment95701102_54444559\">Li-yao</a> this also requires handling lists in a special way, plus defining several other instances, which adds some boilerplate.</p>\n\n<p>Example:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&gt;&gt;&gt; typeReps ['a']\n[[Char],Char]\n\n&gt;&gt;&gt; :set -XDeriveGeneric\n&gt;&gt;&gt; data Foo = Foo [Int] (Char, Char) deriving (Generic)\n&gt;&gt;&gt; instance HasTypeReps Foo\n&gt;&gt;&gt; typeReps $ Foo [1, 2] ('a', 'b')\n[Foo,[Int],Int,Int,(Char,Char),Char,Char]\n</code></pre>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 1, "accepted_answer_id": 54446912, "answer_count": 2, "score": 1, "last_activity_date": 1548947167, "creation_date": 1548863761, "last_edit_date": 1548866305, "question_id": 54444559, "link": "https://stackoverflow.com/questions/54444559/get-all-the-typereps-in-a-value-using-generic-programming", "title": "Get all the TypeRep&#39;s in a value using generic programming", "body": "<p>Is there a way to get a list of all the <code>TypeRep</code>'s inside a value using generic programming?</p>\n\n<p>For instance, could one define a function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>typeReps :: (Data a, Typeable a) =&gt; a -&gt; [TypeRep]\n</code></pre>\n\n<p>in such a way that:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&gt;&gt;&gt; typeReps (1 :: Int, 'a')\n[(Int, Char), Int, Char]\n\n&gt;&gt;&gt; typeReps (Foo ['a', 'b'])\n[Foo, [Char], Char, Char]\n</code></pre>\n\n<p>I've tried</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE RankNTypes #-}\n\nmodule Example where\n\nimport Data.Data\nimport Data.Typeable\n\ntypeReps :: (Data a, Typeable a) =&gt; a -&gt; TypeReps a\ntypeReps a = gfoldl step fcstr a\n  where\n    step :: forall d b. (Typeable d, Data d) =&gt;  TypeReps (d -&gt; b) -&gt; d -&gt; TypeReps b\n    step tot d = tot &lt;++&gt; typeReps d\n\n    fcstr :: forall g . g -&gt; TypeReps g\n    fcstr g  = TypeReps [typeOf a]\n</code></pre>\n\n<p>However this seems to duplicate the type <code>TypeRep</code>s in the result:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>&gt;&gt;&gt; typeReps ['a']\nTypeReps {getTypes = [[Char],Char,[Char]]}\n</code></pre>\n\n<p>Furthermore, it looks a bit backwards that I'm not using <code>g</code> but <code>a</code> in the <code>fsctr</code> function above (and I cannot since I cannot constrain <code>g</code> to be <code>Typeable</code>).</p>\n\n<p>I don't know if this can be solved in this way, and if not, I wonder whether there are other ways of approaching it.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548851839, "post_id": 54435165, "comment_id": 95690653, "body": "Something as simple as <code>type Shape = Either Tri Quad</code> might suffice."}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 10, "last_activity_date": 1549121766, "last_edit_date": 1549121766, "creation_date": 1548833223, "answer_id": 54435288, "question_id": 54435165, "link": "https://stackoverflow.com/questions/54435165/haskell-data-type-containing-other-data-types/54435288#54435288", "title": "Haskell: Data type containing other Data Types", "body": "<p>You have to give names to data constructors:</p>\n\n<pre><code>data Shape = ShapeTri  { shapeTri  :: Tri }\n           | ShapeQuad { shapeQuad :: Quad } \n                 deriving Show\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1548851241, "post_id": 54435405, "comment_id": 95690351, "body": "The reason I wanted to keep them separate is because I wanted to write different instances for them. Is there a better way for that?"}, {"owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "reply_to_user": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1548862637, "post_id": 54435405, "comment_id": 95697630, "body": "Might I ask what instances you are writing for <code>Tri</code> and <code>Quad</code>?"}, {"owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "edited": false, "score": 0, "creation_date": 1548867638, "post_id": 54435405, "comment_id": 95700716, "body": "to be honest that is not the actual code, I just used those as an example. The last example you wrote seems the easiest to use"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1548872989, "post_id": 54435405, "comment_id": 95703365, "body": "I definitely recommend against combining them. All the record accessors <code>a</code>, <code>b</code>, ... become partial functions that blow up if you use them on the wrong constructor"}], "tags": [], "owner": {"reputation": 1197, "user_id": 4051020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42660a4e623fd8d2c850081291bcb585?s=128&d=identicon&r=PG&f=1", "display_name": "dopamane", "link": "https://stackoverflow.com/users/4051020/dopamane"}, "is_accepted": false, "score": 5, "last_activity_date": 1548833692, "creation_date": 1548833692, "answer_id": 54435405, "question_id": 54435165, "link": "https://stackoverflow.com/questions/54435165/haskell-data-type-containing-other-data-types/54435405#54435405", "title": "Haskell: Data type containing other Data Types", "body": "<p>@talex's answer is correct. Here are some variations (mainly just different syntax).</p>\n\n<p>Without record syntax:</p>\n\n<pre><code>data Shape = ShapeTri Tri | ShapeQuad Quad \n  deriving Show\n</code></pre>\n\n<p>It may make more sense to combine Shape, Tri, and Quad:</p>\n\n<pre><code>data Shape = Tri  {a :: Int, b :: Int , c :: Int} \n           | Quad {w :: Int, x :: Int, y :: Int, z :: Int}\n  deriving Show\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5200466, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/abb1362cec6e1f0a2416a6d98a93cd6c?s=128&d=identicon&r=PG&f=1", "display_name": "matt", "link": "https://stackoverflow.com/users/5200466/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1549121766, "creation_date": 1548832680, "question_id": 54435165, "link": "https://stackoverflow.com/questions/54435165/haskell-data-type-containing-other-data-types", "title": "Haskell: Data type containing other Data Types", "body": "<p>if I have two data structures </p>\n\n<pre><code>data Tri = Tri {a :: Int, b :: Int , c :: Int} deriving Show\ndata Quad = Quad {w :: Int, x :: Int, y :: Int, z :: Int} deriving Show\n</code></pre>\n\n<p>how do I create another data structure made up of those two? ie something alon the lines of: </p>\n\n<pre><code>data Shape = Tri | Quad derivng Show\n</code></pre>\n"}, {"tags": ["haskell", "ncurses", "type-signature"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548887662, "post_id": 54432940, "comment_id": 95709799, "body": "You say, &quot;I seem to pick up the same events regardless of what window I pass&quot;. I guess by this you mean that if you replace <code>getEvent foo</code> everywhere in your program with <code>getEvent bar</code>, nothing changes. But what if you change only some occurrences of <code>getEvent foo</code> to <code>getEvent bar</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 2, "creation_date": 1548864199, "post_id": 54433002, "comment_id": 95698524, "body": "I&#39;m not really familiar with OO so I think a little bit of this goes over my head.  If it is a scoping issue isn&#39;t the <code>Maybe Integer -&gt; Update (Maybe Event)</code> more appropriate?  I&#39;m really wondering why the actions taken with the window are not appropriate for a <code>Update</code> monad."}, {"owner": {"reputation": 2692, "user_id": 448858, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c225e2d1fd51a59a99e735963041243d?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/448858/chris"}, "reply_to_user": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "edited": false, "score": 0, "creation_date": 1548904363, "post_id": 54433002, "comment_id": 95713823, "body": "Ah, okay I understand now. As @1000000000 mentioned, I don&#39;t think one is intrinsically better than the other -- it&#39;s an API design decision. I tend to opt for &quot;flatter&quot; designs. If I can get away with using a record of functions, I&#39;ll do that.  I think of <code>Reader</code>-based solutions as being for global config. As an example, when starting a web app, the database connection pool goes into a <code>ReaderT</code> as part of an <code>App</code> monad transformer stack."}], "tags": [], "owner": {"reputation": 2692, "user_id": 448858, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c225e2d1fd51a59a99e735963041243d?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/448858/chris"}, "is_accepted": false, "score": 2, "last_activity_date": 1548819350, "creation_date": 1548819350, "answer_id": 54433002, "question_id": 54432940, "link": "https://stackoverflow.com/questions/54432940/why-is-the-type-signature-of-getevent-what-it-is/54433002#54433002", "title": "Why is the type signature of getEvent what it is?", "body": "<p>In general, Haskell wants all of a function's \"dependencies\" to be passed in as arguments. Within the body of <code>getEvent</code> it is using the passed in <code>win</code> argument a few times.</p>\n\n<p>The OO analogy would be <code>window.getEvent(timeout)</code>. In FP though, aside from the ordering of the parameters to a function, there's nothing special about the first argument.</p>\n\n<p>As to what would happen if you passed a different window, the docs say:</p>\n\n<blockquote>\n  <p>Get the next 'Event' from a given window.</p>\n</blockquote>\n\n<p>So, presumably, you're getting events scoped to the particular window that was passed as an argument. To analogize with OO further, that's the difference between:</p>\n\n<pre><code>myMainWindow.getEvent(100)\npopupWindow.getEvent(250)\n</code></pre>\n\n<p>That is to say, different <em>instances</em> of <code>window</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 632, "user_id": 2341449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15e3f14d66ce1f2dca5ca0a02aea25b2?s=128&d=identicon&r=PG", "display_name": "1000000000", "link": "https://stackoverflow.com/users/2341449/1000000000"}, "is_accepted": true, "score": 2, "last_activity_date": 1548874423, "creation_date": 1548874423, "answer_id": 54447629, "question_id": 54432940, "link": "https://stackoverflow.com/questions/54432940/why-is-the-type-signature-of-getevent-what-it-is/54447629#54447629", "title": "Why is the type signature of getEvent what it is?", "body": "<h2>The <code>getEvent</code> function <em>needs</em> a window</h2>\n\n<p>The Haskell NCurses library is written on top of the GNU ncurses library, a C library.\nSince the GNU ncurses library has separate input queues for each window, the <code>getEvent</code> function will need to know which window to get the input from when it makes calls to the appropriate GNU ncurses routines. The need for windows to have separate input queues is probably more apparent when input is not processed as soon as it is received.</p>\n\n<h2><code>Update</code> monad vs. <code>Window</code> argument? Arbitrary</h2>\n\n<p>The <code>UI.NCurses</code> package contains an unexported function</p>\n\n<pre><code>withWindow :: (Window -&gt; IO a) -&gt; Update a\n</code></pre>\n\n<p>that, as its type suggests, can be used to easily convert a function that takes a <code>Window</code> as input to one that returns its result wrapped in the <code>Update</code> monad.\nIt seems like the people who developed the Haskell NCurses library just thought that <code>getEvent</code> would work better in most cases taking a <code>Window</code> as an argument instead of using the <code>Update</code> monad.</p>\n"}], "owner": {"reputation": 3085, "user_id": 4040600, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/B4ER6.png?s=128&g=1", "display_name": "&#201;amonn Olive", "link": "https://stackoverflow.com/users/4040600/%c3%89amonn-olive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 54447629, "answer_count": 2, "score": 2, "last_activity_date": 1548874423, "creation_date": 1548818758, "last_edit_date": 1548863614, "question_id": 54432940, "link": "https://stackoverflow.com/questions/54432940/why-is-the-type-signature-of-getevent-what-it-is", "title": "Why is the type signature of getEvent what it is?", "body": "<p>The type signature for <code>getEvent</code> from the <a href=\"https://hackage.haskell.org/package/ncurses-0.2.16/docs/UI-NCurses.html\" rel=\"nofollow noreferrer\"><code>UI.NCurses</code></a> library has the type signature</p>\n\n<pre><code>Window -&gt; Maybe Integer -&gt; Curses (Maybe Event)\n</code></pre>\n\n<p>However having used this function a bunch I am still not quite sure what the <code>Window</code> is used for.  The documentation says that it</p>\n\n<blockquote>\n  <p>Get[s] the next Event from a given window.</p>\n</blockquote>\n\n<p>But that doesn't really enlighten me very much (and reading the source code is similarly unenlightening for me). It would seem to me that if an event like a keypress happens it doesn't happen within a window.  And experimentation supports this hypothesis, I seem to pick up the same events regardless of what window I pass. If I have several windows open what difference does it make if I pass one or the other?</p>\n\n<p>And if it does in fact use the window why is the type signature not the more natural</p>\n\n<pre><code>Maybe Integer -&gt; Update (Maybe Event)\n</code></pre>\n"}, {"tags": ["haskell", "ubuntu-16.04", "cabal-install"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1548824349, "post_id": 54432924, "comment_id": 95676637, "body": "Just a guess, but I bet you need a newer version of cabal-install. I&#39;m guessing yours is lacking support for custom-setup stanzas."}, {"owner": {"reputation": 153, "user_id": 10879021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/527815cd2cc54044c9e86df2216891cd?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Cuffaro", "link": "https://stackoverflow.com/users/10879021/matt-cuffaro"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1548856181, "post_id": 54432924, "comment_id": 95693244, "body": "@MichaelSnoyman following your advice, I ran <code>cabal install Cabal cabal-install</code> but I&#39;m encountering the same error."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1548864694, "post_id": 54432924, "comment_id": 95698839, "body": "Are you sure you&#39;re running the newly installed binary?  Correct paths? <code>hash -r</code>?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1548864769, "post_id": 54432924, "comment_id": 95698891, "body": "What does cabal --version say?"}, {"owner": {"reputation": 153, "user_id": 10879021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/527815cd2cc54044c9e86df2216891cd?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Cuffaro", "link": "https://stackoverflow.com/users/10879021/matt-cuffaro"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1548865081, "post_id": 54432924, "comment_id": 95699083, "body": "@MichaelSnoyman cabal --version cabal-install version 1.22.6.0 using version 1.22.5.0 of the Cabal library  @ThomasM.DuBuisson <code>hash -r</code> does not seem to resolve anything. I&#39;ll need to deliberate a little more, but I think my paths are correct. What more specific information would be helpful?"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1548865335, "post_id": 54432924, "comment_id": 95699253, "body": "Looks like your PATH doesn&#39;t include the install location."}, {"owner": {"reputation": 153, "user_id": 10879021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/527815cd2cc54044c9e86df2216891cd?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Cuffaro", "link": "https://stackoverflow.com/users/10879021/matt-cuffaro"}, "edited": false, "score": 0, "creation_date": 1548876092, "post_id": 54432924, "comment_id": 95704970, "body": "I know this may be a rudimentary question, but how can I determine the install location to test this as a solution? I&#39;m new"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1548957912, "post_id": 54432924, "comment_id": 95741285, "body": "@MattCuffaro If you installed via <code>cabal install</code> then the location should be <code>$HOME&#47;.cabal&#47;bin</code> which you can, arguably should, include in your PATH.  For a quick test you could make sure that binary is what&#39;s expected <code>$HOME&#47;.cabal&#47;bin&#47;cabal --version</code>"}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1549300735, "post_id": 54432924, "comment_id": 96514124, "body": "If you&#39;re still having trouble, you could also try using Stack. (Note: biased recommendation, I&#39;m one of the authors.) There are instructions available at: <a href=\"https://haskell-lang.org/get-started/linux\" rel=\"nofollow noreferrer\">haskell-lang.org/get-started/linux</a> I&#39;d also recommend checking out the &quot;next steps&quot; section for how to get started using Stack. Also, there&#39;s a Gitter channel where you can ask follow up questions at: <a href=\"https://gitter.im/commercialhaskell/stack\" rel=\"nofollow noreferrer\">gitter.im/commercialhaskell/stack</a>"}, {"owner": {"reputation": 153, "user_id": 10879021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/527815cd2cc54044c9e86df2216891cd?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Cuffaro", "link": "https://stackoverflow.com/users/10879021/matt-cuffaro"}, "edited": false, "score": 0, "creation_date": 1549306324, "post_id": 54432924, "comment_id": 96514125, "body": "I appreciate you following up. I had updated to the most recent Ubuntu (18.04) and it worked (updating resolved another python issue I was having)."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1549342317, "post_id": 54432924, "comment_id": 96514126, "body": "Awesome, thanks for letting me know!"}], "answers": [{"tags": [], "owner": {"reputation": 153, "user_id": 10879021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/527815cd2cc54044c9e86df2216891cd?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Cuffaro", "link": "https://stackoverflow.com/users/10879021/matt-cuffaro"}, "is_accepted": false, "score": 2, "last_activity_date": 1549306370, "creation_date": 1549306370, "answer_id": 54522550, "question_id": 54432924, "link": "https://stackoverflow.com/questions/54432924/cabal-2-4-1-0-failed-during-the-configure-step-when-trying-to-install-gtk2hs-b/54522550#54522550", "title": "&quot;Cabal-2.4.1.0 failed during the configure step&quot; when trying to install gtk2hs-buildtools", "body": "<p>My resolution was to update to 18.04. No issues now.</p>\n"}], "owner": {"reputation": 153, "user_id": 10879021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/527815cd2cc54044c9e86df2216891cd?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Cuffaro", "link": "https://stackoverflow.com/users/10879021/matt-cuffaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549306370, "creation_date": 1548818641, "question_id": 54432924, "link": "https://stackoverflow.com/questions/54432924/cabal-2-4-1-0-failed-during-the-configure-step-when-trying-to-install-gtk2hs-b", "title": "&quot;Cabal-2.4.1.0 failed during the configure step&quot; when trying to install gtk2hs-buildtools", "body": "<p>I'm trying to <code>cabal install gtk2hs-buildtools</code> but I'm receiving the error in a 'ParseResult.hs' file. I'm not sure if this is a bug or a local error. </p>\n\n<p>I've ensured that the rc file has been properly updated to have <code>export PATH=$HOME/.cabal/bin:$PATH</code></p>\n\n<p>(the large spaces are from the formatting)</p>\n\n<pre><code>cabal install gtk2hs-buildtools\nResolving dependencies...\nConfiguring Cabal-2.4.1.0...\nFailed to install Cabal-2.4.1.0\nBuild log ( /home/cuffaro/.cabal/logs/Cabal-2.4.1.0.log ):\ncabal: Error: some packages failed to install:\nCabal-2.4.1.0 failed during the configure step. The exception was:\nuser error ('/usr/bin/ghc' exited with an error:\n\n/tmp/cabal-tmp-6517/Cabal-                2.4.1.0/Distribution/Parsec/ParseResult.hs:32:0:\nerror: missing binary operator before token \"(\"\n#if MIN_VERSION_base(4,10,0)\n^\n\n/tmp/cabal-tmp-6517/Cabal-      2.4.1.0/Distribution/Parsec/ParseResult.hs:88:0:\nerror: missing binary operator before token \"(\"\n#if MIN_VERSION_base(4,10,0)\n^\n)\ngtk2hs-buildtools-0.13.4.0 depends on Cabal-2.4.1.0 which failed to    install.\n</code></pre>\n"}, {"tags": ["haskell", "recursion", "combinatorics"], "comments": [{"owner": {"reputation": 141, "user_id": 10986828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8dcb2233628e65b82ef56ecd92cca?s=128&d=identicon&r=PG&f=1", "display_name": "user100106", "link": "https://stackoverflow.com/users/10986828/user100106"}, "reply_to_user": {"reputation": 2131, "user_id": 2343935, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/li569.png?s=128&g=1", "display_name": "grooveplex", "link": "https://stackoverflow.com/users/2343935/grooveplex"}, "edited": false, "score": 0, "creation_date": 1548816024, "post_id": 54432538, "comment_id": 95674852, "body": "I thought of something of the form [ (n-i):sumToLists i] | i &lt;-[1...n-1] ] but I am not sure if I can apply &quot;:&quot; to add the head element n-i inside a list by comprehension. This is the only thing I came up with so far."}], "answers": [{"tags": [], "owner": {"reputation": 15567, "user_id": 3656904, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8dbd58d3b477ad0e5889bc60625e7e8?s=128&d=identicon&r=PG&f=1", "display_name": "talex", "link": "https://stackoverflow.com/users/3656904/talex"}, "is_accepted": false, "score": 2, "last_activity_date": 1548820550, "creation_date": 1548820550, "answer_id": 54433146, "question_id": 54432538, "link": "https://stackoverflow.com/questions/54432538/define-function-of-list-of-integers-such-that-their-sum-is-n/54433146#54433146", "title": "Define function of list of integers such that their sum is n", "body": "<pre><code>sumToLists 0 = [[]]\nsumToLists n = [ i: xs | i &lt;- [1..n], xs &lt;- sumToLists (n - i) ] \n</code></pre>\n\n<p>you need special case for <code>0</code> because default will return <code>[]</code> not <code>[[]]</code>.</p>\n"}], "owner": {"reputation": 141, "user_id": 10986828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8dcb2233628e65b82ef56ecd92cca?s=128&d=identicon&r=PG&f=1", "display_name": "user100106", "link": "https://stackoverflow.com/users/10986828/user100106"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1548820550, "creation_date": 1548815173, "last_edit_date": 1548817738, "question_id": 54432538, "link": "https://stackoverflow.com/questions/54432538/define-function-of-list-of-integers-such-that-their-sum-is-n", "title": "Define function of list of integers such that their sum is n", "body": "<p>I am trying to solve the following problem with Haskell:</p>\n\n<p><strong>Problem</strong></p>\n\n<p>Define the function <code>sumToLists :: Int -&gt; [[Int]]</code> that, given a natural number <code>n</code>, it returns all the lists of positive numbers such that their sum is <code>n</code>.</p>\n\n<p>I am pretty lost at this problem, maybe using recursion could yield up a solution but I have no clue how to attack this. Any suggestions would be greatly appreciated</p>\n"}, {"tags": ["parsing", "haskell", "parsec", "megaparsec"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1548802080, "post_id": 54430701, "comment_id": 95671414, "body": "You could just <code>getState</code> and include the state in the result of the parser."}, {"owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1548802373, "post_id": 54430701, "comment_id": 95671495, "body": "I had this idea, but I would like the state of the parser to be returned when the subparser fail (to push the errors messages to the main parser)."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1548803758, "post_id": 54430701, "comment_id": 95671877, "body": "<code>megaparsec</code> does have <code>runParser&#39;</code> which returns the state."}, {"owner": {"reputation": 100768, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1548806934, "post_id": 54430701, "comment_id": 95672646, "body": "@JeanJouX If you only care about simple error messages, maybe the ParserError is enough? The parser user state is meant to backtrack on failure. If you want some state/output to collect state/data that does not backtrack, chances are you should keep that outside of Parsec (e.g. stacking a ParserT on a WriterT)."}], "answers": [{"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1548810013, "post_id": 54431284, "comment_id": 95673452, "body": "I agree, it seems like OP is trying to do too much inside the parser when it would be better to keep the parser simple and if there are any semantic errors those can still be handled after parsing."}], "tags": [], "owner": {"reputation": 98, "user_id": 10973392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81846965a4a1788d7a880f0320bb5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Kr&#252;ger", "link": "https://stackoverflow.com/users/10973392/hans-kr%c3%bcger"}, "is_accepted": true, "score": 4, "last_activity_date": 1548805741, "last_edit_date": 1548805741, "creation_date": 1548805073, "answer_id": 54431284, "question_id": 54430701, "link": "https://stackoverflow.com/questions/54430701/how-to-make-a-sub-parser-with-parsec/54431284#54431284", "title": "How to make a sub parser with Parsec?", "body": "<p>Not a complete answer, more a question for clarification:</p>\n\n<p>Is it necessary to build a list of strings?\nI would prefer to parse the input and convert it into a more special datatype. By that you can use the type guarantees of haskell.</p>\n\n<p>I would begin by defining a datatype for my commands:</p>\n\n<pre><code>data Command = Command1 Argtype1 \n               | Command2 Argtype2\n               | Command3 Argtype1 Argtype2\n\ndata Argtype1 = Arg1 | Arg2 | ArgX\ndata Argtype2 = Arg2_1 | Arg2_2 \n</code></pre>\n\n<p>After that you can parse the input and put it in datatypes.</p>\n\n<p>At the end of the parsing you can <code>mappend</code> the results (that is for lists adding at the front with operation (:)).</p>\n\n<p>You end up with a datatype of [Command]. \nWith that you can work further.</p>\n\n<p>For parsing the text you can follow the introduction to the package megaparsec at\n(<a href=\"https://markkarpov.com/megaparsec/parsing-simple-imperative-language.html\" rel=\"nofollow noreferrer\">https://markkarpov.com/megaparsec/parsing-simple-imperative-language.html</a>)</p>\n\n<hr>\n\n<p>Or do you mean something completly different? Perhaps that <em>every line</em> (containing some commands) is as it whole shall be <em>one</em> input of a state machine and the state machine changes in relation to the commands? Then I wonder why the state machine shall be implemented as a parser. </p>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 2, "last_activity_date": 1548862862, "creation_date": 1548862862, "answer_id": 54444281, "question_id": 54430701, "link": "https://stackoverflow.com/questions/54430701/how-to-make-a-sub-parser-with-parsec/54444281#54444281", "title": "How to make a sub parser with Parsec?", "body": "<p>As a starting point, the simplest answer to \"How to make a sub parser\" is using the monadic bind, applicative <code>&lt;*&gt;</code>, alternative <code>&lt;|&gt;</code>, and the combinators provided by the library. Assuming that each command belongs to a single type (as in Hans Kruger's answer), and with arbitrary number of columns, the below might make a good template.</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.Char\nimport Data.List(transpose)\n\ncmdFileParser :: Parsec s u [[CommandType]] \ncmdFileParser = sepBy sepParser cmdLineParser\n   where\n     sepParser = newline --From Text.Parsec.Char\n\ncmdLineParser :: Parsec s u [CommandType]\ncmdLineParser = sepBy sepParser cmdParser\n   where\n     sepParser = tab\n\n\ncmdParser :: Parsec s u CommandType\ncmdParser =   parseCommand1\n              &lt;|&gt; parseCommand2\n              &lt;|&gt; parseCommand3 \n              &lt;|&gt; etc \n</code></pre>\n\n<p>Then, after the the parsing, transpose the <code>[[CommandType]]</code> to group commands by column</p>\n\n<pre><code>main = do\n  ...\n  let ret = runParser cmdFileParser \n                       \"debug string telling what was parsed\" \n                       stringToParse\n  case ret of\n    Left e -&gt; putStrLn \"wasn't parsed\"\n    Right cmds -&gt; doSomethingWith (transpose cmds)\n</code></pre>\n\n<p>I would say that the above is a typical approach. There are variations of course. For instance if you know there should be only three columns, you might have instead of the above <code>cmdLineParser</code> the below</p>\n\n<pre><code>cmdLineParser :: Parsec s u (CommandType,CommandType,CommandType)\ncmdLineParser = (\\a b c -&gt; (a,b,c)) &lt;$&gt; ct &lt;*&gt; ct &lt;*&gt; cmdParser\n   where\n     ct = cmdParser &lt;* tab\n</code></pre>\n\n<p>I would say that using <code>getState</code> is atypical. When I first started using Parsec, I remember getting something like what I think you are after working, but it wasn't pretty. Of course, if you really want to just return the strings you can always parse for any char except your newlines and tabs.</p>\n\n<pre><code>cmdParser :: Parsec s u String\ncmdParser = many (noneOf \"\\n\\t\")\n</code></pre>\n\n<p>Although, careful of using the above. I've been burned in my use of <code>many</code> before, where it takes too much or always succeeds. So I don't have high confidence that that exact formulation will get you the command string. Also, if you just parse that command as a string, then reparse the command in your <code>main</code>, you will be parsing twice!  </p>\n"}], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 54431284, "answer_count": 2, "score": 2, "last_activity_date": 1548862862, "creation_date": 1548801612, "question_id": 54430701, "link": "https://stackoverflow.com/questions/54430701/how-to-make-a-sub-parser-with-parsec", "title": "How to make a sub parser with Parsec?", "body": "<p>I would like to parse several lists of commands indented or formated as array with <code>Parsec</code>. As example, my lists will be formated like this:</p>\n\n<pre><code>Command1 arg1 arg2       Command1 arg1 arg2         Command1 arg1 arg2\nCommand2 arg1                                       Command3 arg1 arg2 arg3\n                         Command3 arg1 arg2 arg3\n                                                    Command4\nCommand3 arg1 arg2 arg3  Command2 arg1\n                         Command4\nCommand4\nCommand5 arg1                                       Command2 arg1\n</code></pre>\n\n<p>These commands are supposed to be parsed column by column with state changes in the parser.</p>\n\n<p>My idea is to gather the commands into separated list of string and parse these strings into a subparser (executed inside the main parser).</p>\n\n<p>I inspected the API of the Parsec library but I didn't find a function to do that.</p>\n\n<p>I considered using <a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Prim.html#v:runParser\" rel=\"nofollow noreferrer\"><code>runParser</code></a> but this function only extract the results of the parser and not its state.</p>\n\n<p>I also considered making a function inspired by <a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Prim.html#v:runParsecT\" rel=\"nofollow noreferrer\"><code>runParsecT</code></a> and <a href=\"https://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Prim.html#v:mkPT\" rel=\"nofollow noreferrer\"><code>mkPT</code></a> to make my own parser, but the constructors <code>ParsecT</code> or <code>initialPos</code> are not available (not exported by the library)</p>\n\n<p><strong>Is it possible to run a subparser inside a parser with <code>Parsec</code>?</strong></p>\n\n<p><strong>If not, does a library such as <a href=\"http://hackage.haskell.org/package/megaparsec\" rel=\"nofollow noreferrer\">megaparsec</a> can solve my problem?</strong></p>\n"}, {"tags": ["haskell", "megaparsec"], "answers": [{"tags": [], "owner": {"reputation": 2273, "user_id": 4407321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/KHKUZ.png?s=128&g=1", "display_name": "Allan W", "link": "https://stackoverflow.com/users/4407321/allan-w"}, "is_accepted": true, "score": 0, "last_activity_date": 1549318917, "creation_date": 1549318917, "answer_id": 54525191, "question_id": 54430335, "link": "https://stackoverflow.com/questions/54430335/errorbundles-after-parsing-with-megaparsec/54525191#54525191", "title": "Errorbundles after parsing with megaparsec", "body": "<p>This was answered by the megaparsec developer <a href=\"https://github.com/mrkkrp/megaparsec/issues/343#issuecomment-460415982\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>To summarize, parsers have a <code>getOffset</code> function that returns the current char index. You can use that along with an initial <code>PosState</code> to create an error bundle which you can later pretty print.</p>\n\n<p>I have a sample project <a href=\"https://github.com/mrkkrp/megaparsec/issues/343#issuecomment-460434723\" rel=\"nofollow noreferrer\">within the github thread</a>, and pasted again here:</p>\n\n<pre><code>module TestParser where\n\nimport           Data.List.NonEmpty as NonEmpty\nimport qualified Data.Maybe         as Maybe\nimport qualified Data.Set           as Set\nimport           Data.Void\nimport           Parser\nimport           Text.Megaparsec\n\ndata Sample\n  = Test Int\n         String\n  | TestBlock [Sample]\n  | TestBlank\n  deriving (Show, Eq)\n\nsampleParser :: Parser Sample\nsampleParser = do\n  l &lt;- many testParser\n  return $ f l\n  where\n    f []  = TestBlank\n    f [s] = s\n    f p   = TestBlock p\n\ntestParser :: Parser Sample\ntestParser = do\n  offset &lt;- getOffset\n  test &lt;- symbol \"test\"\n  return $ Test offset test\n\nfullTestParser :: Parser Sample\nfullTestParser = baseParser testParser\n\ntestParse :: String -&gt; Maybe (ParseErrorBundle String Void)\ntestParse input =\n  case parse (baseParser sampleParser) \"\" input of\n    Left e -&gt; Just e\n    Right x -&gt; do\n      (offset, msg) &lt;- testVerify x\n      let initialState =\n            PosState\n              { pstateInput = input\n              , pstateOffset = 0\n              , pstateSourcePos = initialPos \"\"\n              , pstateTabWidth = defaultTabWidth\n              , pstateLinePrefix = \"\"\n              }\n      let errorBundle =\n            ParseErrorBundle\n              { bundleErrors = NonEmpty.fromList [TrivialError offset Nothing Set.empty]\n                            -- ^ A collection of 'ParseError's that is sorted by parse error offsets\n              , bundlePosState = initialState\n                            -- ^ State that is used for line\\/column calculation\n              }\n      return errorBundle\n\n-- Sample verify; throw an error on the second test key\ntestVerify :: Sample -&gt; Maybe (Int, String)\ntestVerify tree =\n  case tree of\n    TestBlock [_, Test a _, _] -&gt; Just (a, \"Bad\")\n    _                          -&gt; Nothing\n\ntestMain :: IO ()\ntestMain = do\n  testExample \"test test test\"\n  putStrLn \"Done\"\n\ntestExample :: String -&gt; IO ()\ntestExample input =\n  case testParse input of\n    Just error -&gt; putStrLn (errorBundlePretty error)\n    Nothing    -&gt; putStrLn \"pass\"\n</code></pre>\n\n<p>Some parts are from other files, but the important parts are in the code.</p>\n"}], "owner": {"reputation": 2273, "user_id": 4407321, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/KHKUZ.png?s=128&g=1", "display_name": "Allan W", "link": "https://stackoverflow.com/users/4407321/allan-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 54525191, "answer_count": 1, "score": 2, "last_activity_date": 1549318917, "creation_date": 1548799558, "question_id": 54430335, "link": "https://stackoverflow.com/questions/54430335/errorbundles-after-parsing-with-megaparsec", "title": "Errorbundles after parsing with megaparsec", "body": "<p>I currently have a working parser in megaparsec, where I build an AST for my program. I now want to do some weeding operations on my AST, while being able to use the same kind of pretty errors as the parser. While this stage is after parsing, I'm wondering if there are general practices for megaparsec in doing so. Is there a way for me to extract every line and comment (used in the bundle) and add it to each item in my AST? Is there any other way that people tackle this problem?</p>\n\n<p>Apologies in advance if this sounds open ended, but I'm mainly wondering is there are some better ideas than getting the line numbers and creating bundles myself. I'm still new to haskell so I haven't been able to navigate properly through all the source code.</p>\n"}, {"tags": ["json", "haskell", "aeson", "lenses"], "comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 1, "creation_date": 1548797735, "post_id": 54429130, "comment_id": 95669969, "body": "If I am not mistaken your question is just about how to efficiently extract those values from the JSON type (using lens). In that case I think you should remove the whole web request part from your question as it is not relevant."}], "answers": [{"comments": [{"owner": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "edited": false, "score": 0, "creation_date": 1548846062, "post_id": 54430961, "comment_id": 95687265, "body": "Hi Alec, thank you very much for this solution! It feels much cleaner than mine. I observed that the type of <code>weatherService</code> is not correct <code>Couldn&#39;t match type \u2018Value\u2019 with \u2018Data.ByteString.Lazy.Internal.ByteString\u2019</code>. When I remove the type declaration ghci inference works it out correctly and the program compiles. But, I&#39;m wondering which part I should adopt to explicitly state the type of <code>weatherService</code>: (a) adopt <code>weatherService :: Fold ...ByteString ...</code> or should I (b) transform the <code>body</code> into a <code>Value</code>? Thanks in advance for any help and suggestions!"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "edited": false, "score": 1, "creation_date": 1548864925, "post_id": 54430961, "comment_id": 95698986, "body": "Oops! You should transform the body into a <code>Value</code>. I&#39;m not longer sure how the code in your question compiles though... Isn&#39;t <code>response</code> there just a bytestring too? Perhaps you&#39;ve elided some parsing? :D"}, {"owner": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "edited": false, "score": 0, "creation_date": 1548926249, "post_id": 54430961, "comment_id": 95722236, "body": "Allright, I think I am able to decode the JSON, unfortunately this gives me another Case-Match (json decoding may fail) [see updated question] I try to get my head around all the concepts I&#39;m learning; but I&#39;m not able to flatten out the structure into a flat case match; Do you have an idea / help for me?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "edited": false, "score": 1, "creation_date": 1548927894, "post_id": 54430961, "comment_id": 95723222, "body": "You can flatten a <code>Maybe (Maybe a)</code> with <code>Control.Monad.join</code>. However, in your case, I&#39;d prefer to leave the two cases separate a give them different error messages; one case indicates invalid JSON, the other indicates JSON not matching the expected schema."}, {"owner": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "edited": false, "score": 0, "creation_date": 1548938764, "post_id": 54430961, "comment_id": 95729763, "body": "Sounds reasonable, thank you very much for your help!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 1, "last_activity_date": 1548803093, "creation_date": 1548803093, "answer_id": 54430961, "question_id": 54429130, "link": "https://stackoverflow.com/questions/54429130/optimize-lens-based-json-handling/54430961#54430961", "title": "Optimize lens based JSON handling", "body": "<p>As @jpath point out, the real problem you have here is one about <code>lens</code> and JSON handling. The crux of the issue seems to be that you want to do the lens operation all at once. For that, check out the handy <a href=\"https://hackage.haskell.org/package/lens-4.17/docs/Control-Lens-Combinators.html#t:ReifiedFold\" rel=\"nofollow noreferrer\"><code>ReifiedFold</code></a>: the \"parallel\" functionality you want is packed into the <code>Applicative</code> instance.</p>\n\n<pre><code>import Control.Lens\nimport Data.Aeson\nimport Data.Aeson.Lens\nimport Data.Text.Lens ( unpacked )\n\n-- | Extract a `WeatherService` from a `Value` if possible\nweatherService :: Fold Value WeatherService\nweatherService = runFold $ GetCityWeather\n  &lt;$&gt; Fold (key \"name\" . _String . unpacked)\n  &lt;*&gt; Fold (key \"main\" . key \"temp\" . _Double))\n</code></pre>\n\n<p>Then, you can try to get your <code>WeatherService</code> all at once:</p>\n\n<pre><code>...\n-- work thru the response\nlet body = responseBody r\nreturn $ case body ^? weatherService of\n  Just wr -&gt; Right wr\n  Nothing -&gt; Left (SimpleServiceError (\"borked data &gt;:( \" ++ show body))\n</code></pre>\n\n<p>However, for the sake of error messages, it might be a better idea to take advantage of <code>aeson</code>'s <code>ToJSON</code>/<code>FromJSON</code> if you plan on scaling this more.</p>\n"}], "owner": {"reputation": 2331, "user_id": 2072459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JBWNH.jpg?s=128&g=1", "display_name": "Nicolas Heimann", "link": "https://stackoverflow.com/users/2072459/nicolas-heimann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 54430961, "answer_count": 1, "score": 0, "last_activity_date": 1548938823, "creation_date": 1548793871, "last_edit_date": 1548938823, "question_id": 54429130, "link": "https://stackoverflow.com/questions/54429130/optimize-lens-based-json-handling", "title": "Optimize lens based JSON handling", "body": "<p>In my current \"learning haskell\" project I try to fetch weather data from a third party api. I want to extract the <code>name</code> and <code>main.temp</code> value from the following response body: </p>\n\n<pre><code>{\n  ...\n  \"main\": {\n    \"temp\": 280.32,\n    ...\n  },\n  ...\n  \"name\": \"London\",\n  ...\n}\n</code></pre>\n\n<p>I wrote a <code>getWeather</code> service to perform IO and transform the response to construct <code>GetCityWeather</code> data: </p>\n\n<pre><code>....\n\ndata WeatherService = GetCityWeather String Double\n    deriving (Show)\n\n....\n\ngetWeather :: IO (ServiceResult WeatherService)\ngetWeather = do\n  ...\n\n  response &lt;- httpLbs request manager\n\n  ...\n\n  -- work thru the response\n  return $ case ((maybeCityName response, maybeTemp response)) of\n    (Just name, Just temp) -&gt; success name temp\n    bork                   -&gt; err (\"borked data &gt;:( \" ++ show bork))\n\n  where\n    showStatus r    = show $ statusCode $ responseStatus r\n    maybeCityName r = (responseBody r)^?key \"name\"._String\n    maybeTemp r     = (responseBody r)^?key \"main\".key \"temp\"._Double\n    success n t     = Right (GetCityWeather (T.unpack n) t)\n    err e           = Left (SimpleServiceError e)\n</code></pre>\n\n<p>I stuck optimizing the JSON parsing part in <code>maybeCityName</code>, and <code>maybeTemp</code>, my thoughts are:</p>\n\n<ol>\n<li>Currently the JSON is parsed twice (I apply <code>^?</code> two times on the raw response <code>responseBody r</code>).</li>\n<li>I would like to get the data in \"one shot\". <code>?..</code> is able to get a list of values. But I extract different types (<code>String</code>, <code>Double</code>) so the <code>?..</code> does not fit here.</li>\n</ol>\n\n<p>I'm looking for more elegant / more natural ways to safely parse JSON, read desired the values and apply them to the data constructor <code>GetCityWeather</code>. Thanks in advance for any help and feedback.</p>\n\n<p>Update: using Folds I am able to solve the problem with two case matches</p>\n\n<pre><code>getWeather :: IO (ServiceResult WeatherService)\ngetWeather = do\n  ...\n  let value = decode $ responseBody response\n  return $ case value of\n    Just v -&gt; case (v ^? weatherService) of \n        Just wr -&gt; Right wr\n        Nothing -&gt; err \"incompatible data\"\n    Nothing     -&gt; err \"bad json\"\n\n  where\n     err t = Left (SimpleServiceError t)\n\nweatherService :: Fold Value WeatherService\nweatherService = runFold $ GetCityWeather\n  &lt;$&gt; Fold (key \"name\" . _String . unpacked)\n  &lt;*&gt; Fold (key \"main\" . key \"temp\" . _Double)\n</code></pre>\n"}, {"tags": ["function", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 7, "creation_date": 1548793267, "post_id": 54428941, "comment_id": 95668113, "body": "You do not flip twice, you flip the <code>flip</code> function."}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 0, "creation_date": 1549101268, "post_id": 54428941, "comment_id": 95789598, "body": "And just for fun, try <code>flip flip flip</code>."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 10986828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8dcb2233628e65b82ef56ecd92cca?s=128&d=identicon&r=PG&f=1", "display_name": "user100106", "link": "https://stackoverflow.com/users/10986828/user100106"}, "edited": false, "score": 1, "creation_date": 1548795246, "post_id": 54429044, "comment_id": 95668927, "body": "Thanks for your succint answer. I realized I don&#39;t quite get one thing still (sorry if this question sound pretty trivial but I am completely new to Haskell). Why did you match &quot; b = b&#39; &quot; and not &quot; b = (b&#39;-&gt;a&#39;) &quot; and then &quot; c = c&#39; &quot; ? Why is the first association the valid one and not the other I gave ?"}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 141, "user_id": 10986828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8dcb2233628e65b82ef56ecd92cca?s=128&d=identicon&r=PG&f=1", "display_name": "user100106", "link": "https://stackoverflow.com/users/10986828/user100106"}, "edited": false, "score": 2, "creation_date": 1548795690, "post_id": 54429044, "comment_id": 95669093, "body": "Because of the right-associativity of the <code>-&gt;</code> syntax. Spelled out explicitly, the type is <code>((a -&gt; (b -&gt; (c))) -&gt; (b -&gt; (a -&gt; (c))))</code>. All functions in Haskell are unary in fact (taking only a single argument), they just might return another function that again takes another argument. The type <code>(b&#39; -&gt; (a&#39; -&gt; c&#39;))</code> is different from <code>((b&#39; -&gt; a&#39;) -&gt; c&#39;)</code>, they just don&#39;t match."}], "tags": [], "owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 10, "last_activity_date": 1548824103, "last_edit_date": 1548824103, "creation_date": 1548793412, "answer_id": 54429044, "question_id": 54428941, "link": "https://stackoverflow.com/questions/54428941/haskell-applying-flip-twice-type-of-flip-flip/54429044#54429044", "title": "Haskell: applying flip twice (type of flip flip)", "body": "<p>Flipping twice would be <code>\\f -&gt; flip (flip f)</code>, or <code>flip . flip</code>. This would indeed have the type <code>(a -&gt; b -&gt; c) -&gt; (a -&gt; b -&gt; c)</code>.</p>\n\n<p>What you are doing here instead is applying <code>flip</code> on the <code>flip</code> function, i.e. flipping <code>flip</code>'s argument order. So if we start with</p>\n\n<pre><code>flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\n-- and, as the type of the argument\nflip :: (a' -&gt; b' -&gt; c') -&gt; b' -&gt; a' -&gt; c'\n</code></pre>\n\n<p>then if we match the types</p>\n\n<pre><code>a = (a' -&gt; b' -&gt; c')\nb = b'\nc = a' -&gt; c'\n</code></pre>\n\n<p>we get the result</p>\n\n<pre><code>flip flip :: b' -&gt; (a' -&gt; b' -&gt; c') -&gt; (a' -&gt; c')\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 4, "last_activity_date": 1548793967, "creation_date": 1548793967, "answer_id": 54429150, "question_id": 54428941, "link": "https://stackoverflow.com/questions/54428941/haskell-applying-flip-twice-type-of-flip-flip/54429150#54429150", "title": "Haskell: applying flip twice (type of flip flip)", "body": "<p>You do <em>not</em> apply the <code>flip</code> function twice. If you want to apply <code>flip</code> twice, you are looking for:</p>\n\n<pre><code><b>flip . flip</b> :: (b -&gt; a -&gt; c) -&gt; b -&gt; a -&gt; c</code></pre>\n\n<p>What you here do is <em>flipping</em> the <code>flip</code> function. So it takes <code>flip</code> as the function to <code>flip</code>.</p>\n\n<p>We can resolve the type of <code>flip<sub>1</sub> flip<sub>2</sub></code> (I here use subscripts to make it clear to which <code>flip</code> we are referring) as:</p>\n\n<pre><code>flip<sub>1</sub> :: (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c\nflip<sub>2</sub> :: (d -&gt; e -&gt; f) -&gt; e -&gt; d -&gt; f</code></pre>\n\n<p>Since <code>flip<sub>2</sub></code> is the parameter of <code>flip<sub>1</sub></code>, so that means that the type of <code>flip<sub>2</sub></code> is the same type of the parameter of <code>flip<sub>1</sub></code>, so that means that:</p>\n\n<pre><code>        a       -&gt; (b -&gt;    c    )\n~ (d -> e -> f) -> (e -> (d -> f))</code></pre>\n\n<p>Hence that means that <code>a ~ (d -&gt; e -&gt; f)</code> (the type <code>a</code> is the same as <code>d -&gt; e -&gt; f</code>), <code>b ~ e</code> and <code>c ~ (d -&gt; e)</code>. So the type of the function <code>flip<sub>1</sub> flip<sub>2</sub></code> is the type of the output type of <code>flip<sub>1</sub></code>, but with the equivalences, so that means that:</p>\n\n<pre><code>flip<sub>1</sub> flip<sub>2</sub> :: b -&gt; a -&gt; c\nflip<sub>1</sub> flip<sub>2</sub> :: e -&gt; (d -> e -> f) -&gt; (d -> e)</code></pre>\n\n<p>We basically thus made a function that first takes the second parameter, then takes the function, and then the first parameter, and then calls that function with the flipped parameters. So if <code>flip2 = flip flip</code>, it is implemented like:</p>\n\n<pre><code>flip2 :: e -&gt; (d -&gt; e -&gt; f) -&gt; (d -&gt; e)\nflip2 y f x = f x y</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": false, "score": 6, "last_activity_date": 1548793984, "creation_date": 1548793984, "answer_id": 54429157, "question_id": 54428941, "link": "https://stackoverflow.com/questions/54428941/haskell-applying-flip-twice-type-of-flip-flip/54429157#54429157", "title": "Haskell: applying flip twice (type of flip flip)", "body": "<p>Let's look at the types:</p>\n\n<pre><code>flip :: (a -&gt; b -&gt; c) -&gt; b -&gt; (a -&gt; c)\nflip :: (d            -&gt; e -&gt;  f     ) -&gt; e -&gt;  d            -&gt;  f\nflip flip ::                              b -&gt; (a -&gt; b -&gt; c) -&gt; (a -&gt; c)\n</code></pre>\n\n<p>In other words, <code>flip</code> reverses the first two arguments of its argument, and the first two arguments of <code>flip</code> are the function to flip and the second argument to that function. So instead of taking arguments in the order 'function', 'second argument', 'first argument', the order becomes 'second argument', 'function', 'first argument' when you flip it.</p>\n\n<p>If you want to flip, and then flip back, you do something like this:</p>\n\n<pre><code>doubleflip x = flip (flip x)\n</code></pre>\n\n<p>Or equivalently:</p>\n\n<pre><code>doubleflip = flip . flip\n</code></pre>\n\n<p>The <code>(.)</code> operator feeds the output of the right-hand side into the left-hand side.</p>\n"}], "owner": {"reputation": 141, "user_id": 10986828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79b8dcb2233628e65b82ef56ecd92cca?s=128&d=identicon&r=PG&f=1", "display_name": "user100106", "link": "https://stackoverflow.com/users/10986828/user100106"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 54429044, "answer_count": 3, "score": 3, "last_activity_date": 1548824103, "creation_date": 1548792958, "question_id": 54428941, "link": "https://stackoverflow.com/questions/54428941/haskell-applying-flip-twice-type-of-flip-flip", "title": "Haskell: applying flip twice (type of flip flip)", "body": "<p>I am learning Haskell along some basic functions. I was doing some exercises with Flip, which takes a function of two arguments and evaluates the result flipping the order of the arguments. Consider the function <strong>flip flip</strong>, I would have thought, following the definition of flip, that it flipped the arguments twice, evaluating the original function with the parameters in the original order. When I checked this assumption with ghci checking the function type, it yielded:</p>\n\n<p>flip flip :: b -> (a -> b -> c) -> a -> c</p>\n\n<p>I don't understand why this is the function type of flip flip. It takes parameter b and parameter (a -> b -> c) and yields a function a -> c. Why is this the case ? I would really appreciate an explanation since I am at lost with this. Thanks in advance</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 2, "creation_date": 1548785695, "post_id": 54427156, "comment_id": 95664564, "body": "Can you show your full attempt? EDIT: And the error, if any."}, {"owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "edited": false, "score": 0, "creation_date": 1548874592, "post_id": 54427156, "comment_id": 95704224, "body": "[ d | e &lt;- &quot;abc.def.h i j&quot;, d &lt;- if elem e [&#39;a&#39;..&#39;z&#39;] then [1] else [0]] .... [1,1,1,0,1,1,1,0,1,0,1,0,1]"}], "answers": [{"tags": [], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "is_accepted": true, "score": 3, "last_activity_date": 1548786102, "creation_date": 1548786102, "answer_id": 54427355, "question_id": 54427156, "link": "https://stackoverflow.com/questions/54427156/map-each-char-in-a-string-to-a-1-or-a-0/54427355#54427355", "title": "Map each char in a string to a 1 or a 0", "body": "<p>I am assuming your are using <code>Data.Char.isLetter</code>. In that case, your are almost right, you just have to convert your <code>Bool</code> into <code>Int</code> using <code>fromEnum</code></p>\n\n<pre><code>mapbinary :: String -&gt; [Int]\nmapbinary x = map (fromEnum . isLetter) x  -- Point-free-versi\u00f3n = map $ fromEnum . isLetter \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "is_accepted": false, "score": 2, "last_activity_date": 1548786399, "creation_date": 1548786399, "answer_id": 54427427, "question_id": 54427156, "link": "https://stackoverflow.com/questions/54427156/map-each-char-in-a-string-to-a-1-or-a-0/54427427#54427427", "title": "Map each char in a string to a 1 or a 0", "body": "<p>You're on the right track.</p>\n\n<pre><code>map      :: (a    -&gt; b    ) -&gt; [a] -&gt; [b]\nisLetter ::  Char -&gt; Bool\n</code></pre>\n\n<p>You can combine these immediately to make:</p>\n\n<pre><code>map isLetter :: [Char] -&gt; [Bool]\nmap isLetter :: String -&gt; [Bool] -- equivalently\n</code></pre>\n\n<p>This is very close to what you're looking for, the only difference is that it returns <code>True</code> and <code>False</code>, instead of <code>1</code> and <code>0</code> respectively. So you'll also need to do something about that.</p>\n\n<p>We can define a function <code>boolToInt</code> that does this:</p>\n\n<pre><code>boolToInt :: Bool -&gt; Int\nboolToInt False = 0\nboolToInt True = 1\n</code></pre>\n\n<p>However, it happens that the Prelude function <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:fromEnum\" rel=\"nofollow noreferrer\"><code>fromEnum</code></a> does the same thing in this case.</p>\n\n<pre><code>map fromEnum . map isLetter :: String -&gt; [Int]\n</code></pre>\n\n<p>Or, equivalently:</p>\n\n<pre><code>map (fromEnum.isLetter) :: String -&gt; [Int]\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9259126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f0eef3e15ab16b9923552be4e2552b0?s=128&d=identicon&r=PG&f=1", "display_name": "John Weeeek", "link": "https://stackoverflow.com/users/9259126/john-weeeek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 54427355, "answer_count": 2, "score": 1, "last_activity_date": 1548786399, "creation_date": 1548785271, "last_edit_date": 1548785598, "question_id": 54427156, "link": "https://stackoverflow.com/questions/54427156/map-each-char-in-a-string-to-a-1-or-a-0", "title": "Map each char in a string to a 1 or a 0", "body": "<pre><code>mapbinary :: String -&gt; [Int]\n</code></pre>\n\n<p>I am trying to use this function to convert a string to a list with <code>1</code>'s and <code>0</code>'s.\nMy thinking is that I should be mapping each char that returns true with isLetter to 1, and all others to 0.</p>\n\n<p>I've been trying something like <code>map (isLetter x)</code>, but I have no idea where to start.</p>\n"}, {"tags": ["haskell", "nix", "leksah"], "comments": [{"owner": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1548773616, "post_id": 54419308, "comment_id": 95657479, "body": "One of the following files should have a line of code which &quot;sources&quot; <code>~&#47;.nix-profile&#47;etc&#47;profile.d&#47;nix.sh</code>: .bash_profile, .bash_login and .profile  Have you tried opening a new terminal and trying to run <code>nix-build --help</code>?"}, {"owner": {"reputation": 6569, "user_id": 6220759, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/0yuve.jpg?s=128&g=1", "display_name": "Josh Friedlander", "link": "https://stackoverflow.com/users/6220759/josh-friedlander"}, "reply_to_user": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1548774037, "post_id": 54419308, "comment_id": 95657819, "body": "Hi, and thanks. My <code>bash_profile</code> does contain this line: <code>if [ -e &#47;Users&#47;joshfriedlander&#47;.nix-profile&#47;etc&#47;profile.d&#47;nix.sh ]; then . &#47;Users&#47;joshfriedlander&#47;.nix-profile&#47;etc&#47;profile.d&#47;nix.sh; fi # added by Nix installer</code>. And the <code>nix.sh</code> script does exist there."}, {"owner": {"reputation": 6569, "user_id": 6220759, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/0yuve.jpg?s=128&g=1", "display_name": "Josh Friedlander", "link": "https://stackoverflow.com/users/6220759/josh-friedlander"}, "reply_to_user": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1548774445, "post_id": 54419308, "comment_id": 95658088, "body": "Hang on, I think just <code>touch</code>ing my <code>.bash_profile</code> may have changed something - the script is running now. Will update or possibly delete the question. Thanks again!"}, {"owner": {"reputation": 6569, "user_id": 6220759, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/0yuve.jpg?s=128&g=1", "display_name": "Josh Friedlander", "link": "https://stackoverflow.com/users/6220759/josh-friedlander"}, "reply_to_user": {"reputation": 9137, "user_id": 5171219, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G5x4vEoGRJc/AAAAAAAAAAI/AAAAAAAAENA/5wwtFtwYH3Q/photo.jpg?sz=128", "display_name": "Emmanuel Rosa", "link": "https://stackoverflow.com/users/5171219/emmanuel-rosa"}, "edited": false, "score": 0, "creation_date": 1548786827, "post_id": 54419308, "comment_id": 95665111, "body": "Yup, looks like that did it."}], "owner": {"reputation": 6569, "user_id": 6220759, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/0yuve.jpg?s=128&g=1", "display_name": "Josh Friedlander", "link": "https://stackoverflow.com/users/6220759/josh-friedlander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1548758845, "creation_date": 1548758845, "question_id": 54419308, "link": "https://stackoverflow.com/questions/54419308/installing-leksah-with-nix-on-os-x", "title": "Installing Leksah with Nix on OS X", "body": "<p>I've installed Haskell using the \"batteries included\" <a href=\"https://www.haskell.org/platform/\" rel=\"nofollow noreferrer\">official version</a>, which includes GHCi and Cabal. I then followed the <a href=\"https://github.com/leksah/leksah#getting-leksah\" rel=\"nofollow noreferrer\">recommended guidelines</a> for installing Leksah, first installing Nix (with <code>curl</code>, <a href=\"https://nixos.org/nix/\" rel=\"nofollow noreferrer\">as recommended</a>), then downloading Leksah from the Git repository and running <code>./leksah-nix.sh ghc843</code>. Basically, I've done nothing unusual, but I get this error:</p>\n\n<pre><code>joshf:leksah joshfriedlander$ ./leksah-nix.sh ghc843\n./leksah-nix.sh: line 20: nix-build: command not found\n./leksah-nix.sh: line 21: /bin/ghc: No such file or directory\n./leksah-nix.sh: line 22: nix-build: command not found\n./leksah-nix.sh: line 48: /bin/launch-leksah: No such file or directory\n</code></pre>\n\n<p>Is it not finding <code>nix-build</code>? Should I move it? Is there something obvious I'm missing?</p>\n\n<p>Specs: I'm using an MBP with Mojave 10.14.2.</p>\n"}, {"tags": ["docker", "haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "edited": false, "score": 0, "creation_date": 1548838128, "post_id": 54423045, "comment_id": 95682300, "body": "it&#39;s minimal enough for me :-) can&#39;t we control the version of stack installed ? I&#39;m going to try &quot;stack upgrade --binary-version 1.9.3&quot; ...."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 4, "last_activity_date": 1548771475, "creation_date": 1548771475, "answer_id": 54423045, "question_id": 54417952, "link": "https://stackoverflow.com/questions/54417952/up-to-date-lts-13-0-minimal-base-docker-image-for-haskell-stack/54423045#54423045", "title": "Up to date (lts-13.0) minimal base docker image for haskell/stack?", "body": "<p><code>stack-build</code> is as large as it is, because it contains the required system dependencies of <em>all</em> packages on Stackage.</p>\n\n<p>I am using the following base image for building and deploying:</p>\n\n<pre><code>FROM ubuntu:18.04\n\nRUN apt-get update\n\n# Build dependencies\nRUN apt-get install --assume-yes curl\nRUN curl -sSL https://get.haskellstack.org/ | sh\nRUN apt-get install --assume-yes libtinfo-dev\n\n# Without this haddock crashes for modules containing\n# non-ASCII characters.\nENV LANG C.UTF-8\n</code></pre>\n\n<p>It's not really minimal if you just want to use the image during runtime as you wouldn't need stack in that case.</p>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1549233643, "creation_date": 1549233643, "answer_id": 54508307, "question_id": 54417952, "link": "https://stackoverflow.com/questions/54417952/up-to-date-lts-13-0-minimal-base-docker-image-for-haskell-stack/54508307#54508307", "title": "Up to date (lts-13.0) minimal base docker image for haskell/stack?", "body": "<p>Firstly, that image might only be necessary to <strong>build</strong> the excutable, once you have it built you could use a multistage docker build or just copy the executable directly to a more slim image.</p>\n\n<hr>\n\n<p>The dockerfile is available here: <a href=\"https://github.com/commercialhaskell/stack/blob/master/etc/dockerfiles/stack-build/lts-13.0/Dockerfile\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/blob/master/etc/dockerfiles/stack-build/lts-13.0/Dockerfile</a></p>\n\n<p>You could remove these commands (which probably add up to the bulk of the size):</p>\n\n<pre><code># Use Stackage's debian-bootstrap.sh script to install system libraries and\n# tools required to build any Stackage package.\n#\n\nRUN apt-get update &amp;&amp; \\\n    apt-get install -y wget &amp;&amp; \\\n    wget -qO- https://raw.githubusercontent.com/fpco/stackage/$BOOTSTRAP_COMMIT/debian-bootstrap.sh | bash &amp;&amp; \\\n    rm -rf /var/lib/apt/lists/*\n</code></pre>\n"}], "owner": {"reputation": 2970, "user_id": 1298865, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hOaaf.png?s=128&g=1", "display_name": "Nicolas Henin", "link": "https://stackoverflow.com/users/1298865/nicolas-henin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 54423045, "answer_count": 2, "score": 4, "last_activity_date": 1549233643, "creation_date": 1548754766, "question_id": 54417952, "link": "https://stackoverflow.com/questions/54417952/up-to-date-lts-13-0-minimal-base-docker-image-for-haskell-stack", "title": "Up to date (lts-13.0) minimal base docker image for haskell/stack?", "body": "<p>I'm would like to deploy my haskell application on docker and the base image fco/stack-build that I've found takes 9GB ! Do you know a base image more minimal than that ??</p>\n"}, {"tags": ["haskell", "infinite", "fold"], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "edited": false, "score": 0, "creation_date": 1548787823, "post_id": 54417114, "comment_id": 95665639, "body": "It would be great if there were a click-through tool to aid in the expansions.  The expansions are purely mechanical, but can be a little daunting.  Thanks all."}], "tags": [], "owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "is_accepted": false, "score": 3, "last_activity_date": 1548752060, "creation_date": 1548752060, "answer_id": 54417114, "question_id": 54416727, "link": "https://stackoverflow.com/questions/54416727/haskell-foldr-over-infinite-list-using-head/54417114#54417114", "title": "Haskell foldr over infinite list, using head", "body": "<p>From <code>f 0 $ f 1 $ foldr f undefined [2..]</code>, continue for one more iteration, then simply inline the definition of <code>f</code>:  </p>\n\n<pre><code>f 0 $ f 1 $ foldr f undefined [2..]\nf 0 $ f 1 $ f 2 $ foldr f undefined [3..] -- below let rest = foldr f undefined [3..]\nf 0 $ f 1 $ f 2 $ rest\nf 0 $ f 1 $ (\\n acc -&gt; ([length $ head acc] ++ (take n $ repeat n)) : acc) 2 $ rest\nf 0 $ f 1 $ (([length $ head rest] ++ (take 2 $ repeat 2)) : rest)\nf 0 $ f 1 $ (([length $ head rest] ++ [2,2]) : rest)\nf 0 $ f 1 $ ([length $ head rest,2,2] : rest)\nf 0 $ (\\n acc -&gt; ([length $ head acc] ++ (take n $ repeat n)) : acc) 1 $ ([length $ head rest,2,2] : rest)\nf 0 $ (([length $ head ([length $ head rest,2,2] : rest)] ++ (take 1 $ repeat 1)) : [length $ head rest,2,2] : rest)\nf 0 $ (([length $ [length $ head rest,2,2]] ++ [1]) : [length $ head rest,2,2] : rest) \n-- this is the crux, we don't need to evaluate rest to evaluate the length here\nf 0 $ (([3] ++ [1]) : [length $ head rest,2,2] : rest)\nf 0 $ ([3,1] : [length $ head rest,2,2] : rest)\n((\\n acc -&gt; ([length $ head acc] ++ (take n $ repeat n)) : acc) 0 $ ([3,1] : [length $ head rest,2,2] : rest)\n([length $ head ([3,1] : [length $ head rest,2,2] : rest)] ++ (take 0 $ repeat 0)) : [3,1] : [length $ head rest,2,2] : rest\n([length $ [3,1]] ++ []) : [3,1] : [length $ head rest,2,2] : rest\n[length $ [3,1]] : [3,1] : [length $ head rest,2,2] : rest\n[2] : [3,1] : [length $ head rest,2,2] : rest\n</code></pre>\n\n<p>Now since we only want the first two element (<code>take 2</code>), we get<br>\n<code>[[2],[3,1]]</code></p>\n"}, {"tags": [], "owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "is_accepted": false, "score": 4, "last_activity_date": 1548752062, "creation_date": 1548752062, "answer_id": 54417116, "question_id": 54416727, "link": "https://stackoverflow.com/questions/54416727/haskell-foldr-over-infinite-list-using-head/54417116#54417116", "title": "Haskell foldr over infinite list, using head", "body": "<p>You will never see anything interesting if you only expand <code>foldr</code> calls. Once a call to <code>f</code> is the head of your expression, expand <code>f</code> instead. That expansion will require some amount of information from its <code>acc</code>, which is the trailing <code>foldr</code> call, but it won't need <em>all</em> of it, so you'll be able to make progress.</p>\n\n<pre><code>...\nf 0 $ \n([length $ head (foldr f undefined [1..])] ++ (take 0 $ repeat 0)) : foldr f undefined [1..]\n...\n</code></pre>\n\n<p>Here I've repeated <code>foldr f undefined [1..]</code> twice because <code>acc</code> is used twice, but of course you need only expand it once, using the same result in both places.</p>\n"}], "owner": {"reputation": 307, "user_id": 2840838, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d7c45dc364cff6e3f55935b9894edf92?s=128&d=identicon&r=PG&f=1", "display_name": "Lo HaBuyshan", "link": "https://stackoverflow.com/users/2840838/lo-habuyshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1548752062, "creation_date": 1548750573, "question_id": 54416727, "link": "https://stackoverflow.com/questions/54416727/haskell-foldr-over-infinite-list-using-head", "title": "Haskell foldr over infinite list, using head", "body": "<pre><code>f :: Int -&gt; [[Int]] -&gt; [[Int]]\nf n acc = ([length $ head acc] ++ (take n $ repeat n)) : acc\n</code></pre>\n\n<p>I am trying to understand how</p>\n\n<pre><code>take 2 $ foldr f undefined [0..]\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>[[2],[3,1]]\n</code></pre>\n\n<p>I am able to transform up to here, and then get stuck</p>\n\n<pre><code>foldr f undefined [0..]\nfoldr f undefined ([0:[1..])\nf 0 $ foldr f undefined [1..]\nf 0 $ foldr f undefined (1: [2..])\nf 0 $ f 1 $ foldr f undefined [2..]\nf 0 $ f 1 $\n</code></pre>\n"}, {"tags": ["haskell", "hxt"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1548774383, "creation_date": 1548774383, "answer_id": 54423963, "question_id": 54415998, "link": "https://stackoverflow.com/questions/54415998/pattern-match-on-hxt-does-not-work-as-expected/54423963#54423963", "title": "Pattern match on HXT does not work as expected", "body": "<p>Don't use <code>show</code> in the logic of your program. You can use <code>mkName</code> to convert a <code>String</code> to a <code>QName</code>.</p>\n\n<pre><code>defShow :: NTree XNode -&gt; String\ndefShow (NTree (XTag div' _) contents)\n  | div' == mkName \"div\" = intercalate \"\\n\" $ map defShow contents\ndefShow p@(NTree (XTag p' []) _)\n  | p' == mkName \"p\" = show p\ndefShow x = \"\"\n</code></pre>\n"}], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1548774383, "creation_date": 1548747449, "question_id": 54415998, "link": "https://stackoverflow.com/questions/54415998/pattern-match-on-hxt-does-not-work-as-expected", "title": "Pattern match on HXT does not work as expected", "body": "<p>For example, I have a <code>div</code> containing a few <code>p</code>s and others, and I want to map the <code>p</code>s with show.</p>\n\n<pre><code>defShow :: NTree XNode -&gt; String\ndefShow (NTree (XTag div' _) contents)\n  | show div' == \"div\" = intercalate \"\\n\" $ map defShow contents\ndefShow p@(NTree (XTag p' []) _)\n  | show p' == \"p\" = show p\ndefShow x = error $ show x\n</code></pre>\n\n<p>But with testing data as following, this does not work. I mean the whole node, not just the <code>p</code> node.</p>\n\n<pre><code>NTree (XTag \"div\" [NTree (XAttr \"class\") [NTree (XText \"refsect2\") []]])\n      [ NTree (XText \"\\n\") []\n      , NTree (XTag \"p\" []) [SOME_TEXT_NODE] ]\n</code></pre>\n"}, {"tags": ["json", "haskell"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1548737475, "post_id": 54413809, "comment_id": 95638417, "body": "Aeson seems to have good interface which can discover json: <a href=\"http://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson.html#g:3\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/aeson-1.4.2.0/docs/&hellip;</a>"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548772700, "post_id": 54413809, "comment_id": 95656845, "body": "As an aside, JSON doesn&#39;t allow single quotes. Use <code>&quot;{\\&quot;a\\&quot;: 1}&quot;</code> instead."}], "answers": [{"comments": [{"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1548738633, "post_id": 54414071, "comment_id": 95638710, "body": "Thanks!  If I already have Text.JSON loaded, is there an easy way to hide its decode function so I can use the aeson one?  <code>&lt;interactive&gt;:69:5: error:     Ambiguous occurrence \u2018decode\u2019     It could refer to either \u2018Data.Aeson.decode\u2019,                              imported from \u2018Data.Aeson\u2019                           or \u2018Text.JSON.decode\u2019, imported from \u2018Text.JSON\u2019 </code>"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 2, "creation_date": 1548738778, "post_id": 54414071, "comment_id": 95638734, "body": "@Mittenchops Just don&#39;t use <code>json</code>/<code>Text.JSON</code> at all. <code>aeson</code> is a much more polished library. :) otherwise, note you can always refer to something qualified (eg: <code>Data.Aeson.decode</code> instead of <code>decode</code>)."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1548819612, "post_id": 54414071, "comment_id": 95675584, "body": "I know Stackoverflow closes questions that ask for software recommendations, but I appreciate this comment as a software recommendation.  This is a very helpful opinion."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1548737748, "creation_date": 1548737748, "answer_id": 54414071, "question_id": 54413809, "link": "https://stackoverflow.com/questions/54413809/easiest-way-to-enter-a-json-literal-in-haskell-ghci/54414071#54414071", "title": "Easiest way to enter a JSON literal in Haskell ghci", "body": "<p>There sure is! The type of a raw JSON value is <a href=\"https://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson.html#t:Value\" rel=\"nofollow noreferrer\"><code>Value</code></a>. With that in mind, here's a couple of ways of constructing a <code>Value</code> in GHCi:</p>\n\n<ul>\n<li><p><strong>with <code>parseJSON</code></strong>: since <code>Value</code> also has a <code>FromJSON</code> instance, you can use <a href=\"https://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson.html#v:decode\" rel=\"nofollow noreferrer\"><code>decode :: FromJSON a =&gt; ByteString -&gt; Maybe a</code></a> on it. Note that <code>aeson</code> is encouraging you to use <code>ByteString</code> instead of the inefficient default <code>String</code>. You can gloss over this detail by making string literals be overloaded by turning on <code>-XOverloadedStrings</code>:</p>\n\n<pre><code>ghci&gt; import Data.ByteString\nghci&gt; import Data.Aeson\nghci&gt; :set -XOverloadedStrings\nghci&gt; x = decode \"{}\" :: Maybe Value\nx :: Maybe Value\nghci&gt; y = decode \"{\\\"a\\\" : 1}\" :: Maybe Value    -- note: single quotes won't work\ny :: Maybe Value\n</code></pre></li>\n<li><p><strong>with quasiquotes</strong>: you can also make use of the <a href=\"https://hackage.haskell.org/package/aeson-1.4.2.0/docs/Data-Aeson-QQ-Simple.html#v:aesonQQ\" rel=\"nofollow noreferrer\"><code>aesonQQ</code></a> quasiquoter to get compile time JSON literals (this won't matter much in the REPL, beyond looking nicer, but in real code it means no actual parsing at runtime):</p>\n\n<pre><code>ghci&gt; import Data.Aeson.QQ.Simple\nghci&gt; :set -XQuasiQuotes\nghci&gt; x = [aesonQQ| {} |]\nx :: Value\nghci&gt; y = [aesonQQ| {\"a\" : 1} |]\ny :: Value\n</code></pre></li>\n</ul>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 54414071, "answer_count": 1, "score": 1, "last_activity_date": 1548737748, "creation_date": 1548735689, "question_id": 54413809, "link": "https://stackoverflow.com/questions/54413809/easiest-way-to-enter-a-json-literal-in-haskell-ghci", "title": "Easiest way to enter a JSON literal in Haskell ghci", "body": "<p>I'm testing out some functions in ghci before I put them into a project, and I'm straining to find the simplest way to enter json literals in the ghci without a ton of boilerplate</p>\n\n<p>For example, I'd like to try out:</p>\n\n<pre><code>myFuncThatTakesAJson\n</code></pre>\n\n<p>on inputs</p>\n\n<pre><code>x = {}\ny = {\"a\": 1}\n</code></pre>\n\n<p>But when I try entering these:</p>\n\n<pre><code>import Text.JSON\n\nPrelude&gt; x = parseJSON \"{}\"\nPrelude&gt; y = parseJSON \"{'a' : 1}\"\n</code></pre>\n\n<p>I see errors like:</p>\n\n<pre><code>&lt;interactive&gt;:17:5: error:\n    Variable not in scope: parseJSON :: [Char] -&gt; t\n\ny = fromJSON \"{'a' : 1}\"\n\n&lt;interactive&gt;:20:5: error:\n    Data constructor not in scope: FromJSON :: [Char] -&gt; t\n</code></pre>\n\n<p>Is there any way to allow json objects to be entered as strings without defining full data types with custom FromJSON instances?</p>\n"}, {"tags": ["haskell", "record"], "answers": [{"comments": [{"owner": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "edited": false, "score": 0, "creation_date": 1548782655, "post_id": 54413596, "comment_id": 95663074, "body": "What is the <code>f x | Just i &lt;- myGetter x</code> syntax called? Is it composable with another boolean condition with <code>&amp;&amp;</code>?"}, {"owner": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "edited": false, "score": 0, "creation_date": 1548783064, "post_id": 54413596, "comment_id": 95663260, "body": "<code>ViewPatterns</code> is great. It allows my consuming code to pattern match on whatever it wants which is simpler than asking my producing code on all my types to define a pattern with <code>PatternSynonyms</code>."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "edited": false, "score": 2, "creation_date": 1548806608, "post_id": 54413596, "comment_id": 95672577, "body": "@Calebmer It&#39;s <code>PatternGuards</code>. It&#39;s either a part of the new standard or it&#39;s just a on-by-default extension. You compose guards with <code>,</code>, not <code>&amp;&amp;</code>."}, {"owner": {"reputation": 34864, "user_id": 237428, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ThNhZ.jpg?s=128&g=1", "display_name": "Antal Spector-Zabusky", "link": "https://stackoverflow.com/users/237428/antal-spector-zabusky"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1548902282, "post_id": 54413596, "comment_id": 95713368, "body": "@HTNW <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch3.html#dx8-46011\" rel=\"nofollow noreferrer\">Yes, pattern guards were added to Haskell 2010!</a>"}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 2, "last_activity_date": 1548734582, "last_edit_date": 1548734582, "creation_date": 1548734049, "answer_id": 54413596, "question_id": 54413440, "link": "https://stackoverflow.com/questions/54413440/haskell-private-records-like-in-ocaml/54413596#54413596", "title": "Haskell private records like in OCaml", "body": "<p>In your module:</p>\n\n<pre><code>module MyMod (MyType(), myGetter, j, n) where -- the key is that MyData is not exported\n\ndata MyType = MyData (Maybe Int) String\n\nmyGetter (MyData x _) = x\n\nj = MyData (Just 5) \"abc\"\n\nn = MyData Nothing \"abc\"\n</code></pre>\n\n<p>Elsewhere, to do the pattern matching:</p>\n\n<pre><code>f x | Just i &lt;- myGetter x = show i\n    | otherwise            = \"nope\"\n</code></pre>\n\n<p>Now <code>f j</code> will be <code>\"5\"</code> and <code>f n</code> will be <code>\"nope\"</code>.</p>\n\n<p>Alternatively, with the <code>ViewPatterns</code> extension:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\nf (myGetter -&gt; Just i) = show i\nf _                    = \"nope\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1548735316, "post_id": 54413696, "comment_id": 95637956, "body": "Wow it never occurred to me that exporting a field would allow record update.  Yikes."}, {"owner": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "edited": false, "score": 0, "creation_date": 1548782122, "post_id": 54413696, "comment_id": 95662827, "body": "I frequently use the pattern <code>module MyModule (Monotype, monotypeDescription)</code> to export an accessor but I had assumed that would not allow my consumer to update the record. Is that not true?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 1, "creation_date": 1548782239, "post_id": 54413696, "comment_id": 95662883, "body": "That is not true. \u2018m { monotypeDescription = d1 }\u2019 updates m even though it\u2019s constructor is not exported."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 7, "last_activity_date": 1548734793, "creation_date": 1548734793, "answer_id": 54413696, "question_id": 54413440, "link": "https://stackoverflow.com/questions/54413440/haskell-private-records-like-in-ocaml/54413696#54413696", "title": "Haskell private records like in OCaml", "body": "<p>You can't match against the fields without also allowing at least record update (you either import the field or not). I think the restriction is more because there isn't an obvious syntax for importing only accessors...</p>\n\n<p>The proper solution is really to use <code>PatternSynonyms</code>. You'll want a uni-directional pattern:</p>\n\n<pre><code>{-# LANGUAGE PatternSynonyms #-}\nmodule MyModule ( Monotype(Monotype) ) where\n\nimport Data.Set\n\ndata Monotype = MT (Set String) String\n\npattern Monotype :: Set String -&gt; String -&gt; Monotype\npattern Monotype { monotype_free_variables, monotype_description }\n  &lt;- MT monotype_free_variables monotype_description\n</code></pre>\n\n<p>Now, you can match against <code>Monotype { monotype_free_variables, monotype_description }</code> but you can't construct it:</p>\n\n<pre><code>\u03bb&gt; Monotype { monotype_free_variables = f1, monotype_description = f2 } = m1\n\u03bb&gt; Monotype f1 f2 = m1\n\u03bb&gt; m3 = Monotype { monotype_free_variables = mempty, monotype_description = \"\" }\n&lt;interactive&gt;:3:6: error:\n    \u2022 non-bidirectional pattern synonym \u2018Monotype\u2019 used in an expression\n    \u2022 In the expression:\n        Monotype\n          {monotype_free_variables = mempty, monotype_description = \"\"}\n      In an equation for \u2018m3\u2019:\n          m3\n            = Monotype\n                {monotype_free_variables = mempty, monotype_description = \"\"}\n\u03bb&gt; m3 = Monotype mempty \"\"\n\n&lt;interactive&gt;:4:6: error:\n    \u2022 non-bidirectional pattern synonym \u2018Monotype\u2019 used in an expression\n    \u2022 In the expression: Monotype mempty \"\"\n      In an equation for \u2018m3\u2019: m3 = Monotype mempty \"\"\n</code></pre>\n"}], "owner": {"reputation": 2197, "user_id": 1568890, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e1743a48fc43aeab957da6d5d53e36c5?s=128&d=identicon&r=PG", "display_name": "Calebmer", "link": "https://stackoverflow.com/users/1568890/calebmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 54413596, "answer_count": 2, "score": 4, "last_activity_date": 1548764622, "creation_date": 1548732545, "last_edit_date": 1548764622, "question_id": 54413440, "link": "https://stackoverflow.com/questions/54413440/haskell-private-records-like-in-ocaml", "title": "Haskell private records like in OCaml", "body": "<p>In an OCaml module signature I can write:</p>\n\n<pre><code>type monotype = private {\n  monotype_free_variables: StringSet.t Lazy.t;\n  monotype_description: monotype_description;\n}\n</code></pre>\n\n<p>(Note the use of <code>private</code>.)</p>\n\n<p>This allows the code importing my module to pattern match against fields like <code>monotype_description</code> but will not allow code importing my module to construct the record.</p>\n\n<p>Can I write code with similar access permission in Haskell? I\u2019d like to pattern match against a <code>monotypeDescription</code> field without allowing record construction.</p>\n\n<p>I\u2019m aware that a <code>PatternSynonyms</code> language extension exists, but I don\u2019t know how to use it. I\u2019d also prefer a simpler solution if available.</p>\n"}, {"tags": ["haskell", "quickcheck", "property-based-testing", "haskell-hedgehog"], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1548764883, "post_id": 54413276, "comment_id": 95651749, "body": "I really appreciate the time you took to write such a detailed (and helpful answer)!  This seems to clarify why if I would change <code>Gen.element &quot;yx&quot;</code> to <code>Gen.element &quot;xy&quot;</code> I will most of the times get a singleton tree (however I&#39;m still puzzled as to why I don&#39;t <i>always</i> get a singleton tree, but that&#39;s probably a different question)."}], "tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1548765323, "last_edit_date": 1548765323, "creation_date": 1548731217, "answer_id": 54413276, "question_id": 54412108, "link": "https://stackoverflow.com/questions/54412108/why-the-does-this-shrink-tree-looks-the-way-it-does-when-using-filter/54413276#54413276", "title": "Why the does this shrink tree looks the way it does when using filter", "body": "<p><code>Gen</code> is essentially a composition of a probability monad and a tree monad, and the behavior you observe mostly arises from the tree monad and the definition of <a href=\"http://hackage.haskell.org/package/hedgehog-0.6/docs/src/Hedgehog.Internal.Gen.html#filter\" rel=\"nofollow noreferrer\"><code>Gen.filter</code></a>.</p>\n\n<p>Basically, <code>Gen.filter p g</code> is a simple monadic loop, <code>try 0</code> where:</p>\n\n<pre><code>-- simplified body of filter\ntry k =\n  if k &gt; 100 then\n    discard  -- empty tree\n  else do\n    x &lt;- g\n    if p x then\n      pure x  -- singleton tree\n    else\n      try (k + 1)  -- keep looping\n</code></pre>\n\n<p>So to understand the tree you got, you must understand the tree monad under the <code>do</code> notation here.</p>\n\n<h1>The tree monad</h1>\n\n<p>The <a href=\"http://hackage.haskell.org/package/hedgehog-0.6/docs/Hedgehog-Internal-Tree.html#t:Tree\" rel=\"nofollow noreferrer\"><code>Tree</code> type in hedgehog</a> that is internally used by <code>Gen</code> looks roughly like this (if you are looking at the linked implementation in hedgehog, set <code>m ~ Maybe</code>):</p>\n\n<pre><code>data Tree a = Empty | Node a [Tree a]  -- node label and children\n</code></pre>\n\n<p>There are many other <code>Tree</code>-like types that are monads, and the monadic bind <code>(&gt;&gt;=)</code> generally takes the form of a tree substitution.</p>\n\n<p>Say you have a tree <code>t = Node x [t1, t2, ...] :: Tree a</code>, and a continuation/substitution <code>k :: a -&gt; Tree b</code>, which replaces every node/variable <code>x :: a</code> with the tree <code>k x :: Tree b</code>. We can describe <code>t &gt;&gt;= k</code> in two steps, <code>fmap</code> then <code>join</code>, as follows. First the <code>fmap</code> applies the substitution on every node label. So we obtain a tree where every node is labeled by another tree. For concreteness, say <code>k x = Node y [u1, u2, ...]</code>:</p>\n\n<pre><code>fmap k t\n=\nNode\n  (k x)                        -- node label\n  [fmap k t1, fmap k t2, ...]  -- node children\n=\nNode\n  (Node y [u1, u2, ...])       -- node label\n  [fmap k t1, fmap k t2, ...]  -- node children\n</code></pre>\n\n<p>Then the <code>join</code> step flattens the nested tree structure, concatenating the children from inside the label with those outside:</p>\n\n<pre><code>t &gt;&gt;= k\n=\njoin (fmap k t)\n=\nNode\n  y\n  ([join (fmap k t1), join (fmap k t2), ...] ++ [u1, u2, ...])\n</code></pre>\n\n<p>To complete the <code>Monad</code> instance, note that we have <code>pure x = Node x []</code>.</p>\n\n<h1>The try loop</h1>\n\n<p>Now that we have some intuition for the tree monad we can turn to your particular generator. We want to evaluate <code>try k</code> above, where <code>p = (== 'x')</code> and <code>g = elements \"yx\"</code>. I'm waving my hands here, but you should imagine that <code>g</code> evaluates randomly to either the tree <code>Node 'y' []</code> (generate <code>'y'</code> with no shrinkings), aka. <code>pure 'y'</code>, or <code>Node 'x' [Node 'y' []]</code> (generate <code>'x'</code> and shrink to <code>'y'</code>; indeed, \"<code>elements</code> shrinks to the left\"), and that every occurence of <code>g</code> is independent from others, so we get a different result when we retry.</p>\n\n<p>Let's examine each case separately. What happens if <code>g = pure 'y'</code>? Assume <code>k &lt;= 100</code> so we're in the <code>else</code> branch of the toplevel <code>if</code>, already simplified away below:</p>\n\n<pre><code>-- simplified body of filter\ntry k = do\n    c &lt;- pure 'y'     -- g = pure 'y'\n    if c == 'x' then  -- p c = (c == 'x')\n      pure c\n    else\n      try (k + 1)\n\n-- since   (do c &lt;- pure 'y' ; s c) = s 'y'  (monad law)   and   ('y' == 'x') = False\n\ntry k = try (k + 1)\n</code></pre>\n\n<p>So all the times where <code>g</code> evaluates to <code>pure 'y'</code> end up simplified away as the recursive term <code>try (k + 1)</code>, and we are left with the cases where <code>g</code> evaluates to the other tree <code>Node 'x' [Node 'y' []]</code>:</p>\n\n<pre><code>try k = do\n  c &lt;- Node 'x' [Node 'y' []]  -- g\n  if c == 'x' then\n    pure c\n  else\n    try (k + 1)\n</code></pre>\n\n<p>As illustrated in the previous section, the monadic bind is equivalent to the following, and we finish with some equational reasoning.</p>\n\n<pre><code>try k = join (Node (s 'x') [Node (s 'y') []])\n  where\n    s c = if c == 'x' then pure c else try (k + 1)\n\ntry k = join (Node (pure 'x') [Node (try (k + 1)) []])\ntry k = join (Node (pure 'x') [pure (try (k + 1))]  -- simplifying join\ntry k = Node 'x' [join (pure (try (k + 1)))]        -- join . pure = id\ntry k = Node 'x' [try (k + 1)]\n</code></pre>\n\n<p>In summary, starting from <code>try 0</code>, with half probability <code>try k = try (k + 1)</code>, and with the other half <code>try k = Node 'x' [try (k + 1)]</code>, finally we stop at <code>try 100</code>. This explains the tree you observe.</p>\n\n<pre><code>try 0 = Node 'x' [Node 'x' [ ... ]]  -- about 50 nodes\n</code></pre>\n\n<hr>\n\n<p>(I believe this also provides at least a partial answer to <a href=\"https://stackoverflow.com/questions/54411983/example-that-shows-the-limitations-of-integrated-shrinking\">your other question</a>, since this shows how shrinking a <code>Gen.filter</code> often amounts to rerunning the generator from scratch.)</p>\n"}, {"comments": [{"owner": {"reputation": 4446, "user_id": 72821, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/1660573d78cb34c65c58890efe9ee039?s=128&d=identicon&r=PG", "display_name": "Jacob Stanley", "link": "https://stackoverflow.com/users/72821/jacob-stanley"}, "edited": false, "score": 2, "creation_date": 1556583466, "post_id": 55898080, "comment_id": 98479395, "body": "A fix has been merged <a href=\"https://github.com/hedgehogqa/haskell-hedgehog/pull/282\" rel=\"nofollow noreferrer\">github.com/hedgehogqa/haskell-hedgehog/pull/282</a>, it will be in the next Hackage release"}], "tags": [], "owner": {"reputation": 1628, "user_id": 742991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35321bca9b305c30f2b18a2efdd2df5e?s=128&d=identicon&r=PG", "display_name": "edsko", "link": "https://stackoverflow.com/users/742991/edsko"}, "is_accepted": false, "score": 1, "last_activity_date": 1556519538, "creation_date": 1556519538, "answer_id": 55898080, "question_id": 54412108, "link": "https://stackoverflow.com/questions/54412108/why-the-does-this-shrink-tree-looks-the-way-it-does-when-using-filter/55898080#55898080", "title": "Why the does this shrink tree looks the way it does when using filter", "body": "<p>While <a href=\"https://stackoverflow.com/users/6863749/li-yao-xia\">Li-yao Xia</a>'s detailed answer correctly describes <em>how</em> this happens, it doesn't address the <em>why</em>; <em>why</em> does it re-run the generator after each shrink? The answer is that it shouldn't; this is a bug. See bug report <a href=\"https://github.com/hedgehogqa/haskell-hedgehog/issues/281\" rel=\"nofollow noreferrer\">Improve Filter</a> on GitHub.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 1, "accepted_answer_id": 54413276, "answer_count": 2, "score": 2, "last_activity_date": 1556519538, "creation_date": 1548720679, "last_edit_date": 1548757236, "question_id": 54412108, "link": "https://stackoverflow.com/questions/54412108/why-the-does-this-shrink-tree-looks-the-way-it-does-when-using-filter", "title": "Why the does this shrink tree looks the way it does when using filter", "body": "<p>I'm trying to understand what is the effect that filter has in the shrink tree of a generator when using <code>hedgehog</code> <em>integrated shrinking</em>.</p>\n\n<p>Consider the following function:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Hedgehog\nimport qualified Hedgehog.Gen as Gen\n\naFilteredchar:: Gen Char\naFilteredchar =\n  Gen.filter (`elem` (\"x\" :: String)) (Gen.element \"yx\")\n\n</code></pre>\n\n<p>When a print the shrink tree:</p>\n\n<pre><code>&gt;&gt;&gt;  Gen.printTree aFilteredchar\n</code></pre>\n\n<p>I'd get shrink trees that look as follow:</p>\n\n<pre><code>'x'\n \u2514\u257c'x'\n    \u2514\u257c'x'\n       \u2514\u257c'x'\n               ...\n\n                   \u2514\u257c&lt;discard&gt;\n</code></pre>\n\n<p>this is, a very deep tree containing only <code>x</code>'s, and a <code>discard</code> at the end.</p>\n\n<p>Why does the shrink function keeps on returning <code>x</code>'s, instead of an empty list, which signals that there are no further shrinks possible?</p>\n"}, {"tags": ["haskell", "quickcheck", "property-based-testing", "haskell-hedgehog"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1548722316, "post_id": 54411983, "comment_id": 95635284, "body": "How does <code>hedgehog</code> search the space of lists? I would expect it not to take the naive monadic approach (for precisely the reason you point out)."}], "answers": [{"tags": [], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "is_accepted": true, "score": 2, "last_activity_date": 1548722707, "creation_date": 1548722707, "answer_id": 54412355, "question_id": 54411983, "link": "https://stackoverflow.com/questions/54411983/example-that-shows-the-limitations-of-integrated-shrinking/54412355#54412355", "title": "Example that shows the limitations of integrated shrinking", "body": "<p>In calculus terms, the problem is that you aren't following the negative gradient (steepest descent), instead you're minimizing along 1 axis first and then minimizing along the other axis. Based on this analogy, it is easy to come up with at least a contrived example - consider the function</p>\n\n<pre><code>-- f x y = ((x^2 - 1)^2 - 0.2*x) * ((y^2 - 1/2)^2 - 0.1*y)\nf x y = (x^4 - 2.2*x^2 + 1) * (y^4 - 1.1*y^2 + 1/4)\n</code></pre>\n\n<p><a href=\"https://www.wolframalpha.com/input/?i=(x+%5E+4+-+2.2+x+%5E+2+%2B+1)+*+(y+%5E+4+-+1.1+y+%5E+2+%2B+1%2F4)\" rel=\"nofollow noreferrer\">See plot on WolframAlpha</a>.</p>\n\n<p>and we're testing it for the property <code>f x y &gt; 0</code>, and let's say a minimal example would have a point closest to the origin <code>(0, 0)</code>. Depending on where you first start shrinking, it is entirely possible that you end up close to <code>(\u00b11, 0)</code> because you adjust <code>x</code> first and then don't allow <code>y</code> to change much. However, in an ideal situation, you'd want to end up somewhere close to <code>(0, \u00b11/2)</code> to satisfy the minimality criterion.</p>\n"}, {"tags": [], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "is_accepted": false, "score": 0, "last_activity_date": 1548795200, "last_edit_date": 1548795200, "creation_date": 1548794379, "answer_id": 54429236, "question_id": 54411983, "link": "https://stackoverflow.com/questions/54411983/example-that-shows-the-limitations-of-integrated-shrinking/54429236#54429236", "title": "Example that shows the limitations of integrated shrinking", "body": "<p>Just for reference here is an example that involves lists:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Main where\n\nimport Hedgehog\nimport qualified Hedgehog.Gen as Gen\nimport qualified Hedgehog.Range as Range\n\nnotLargeOrBothNotEmpty :: Property\nnotLargeOrBothNotEmpty = property $ do\n  xs &lt;- forAll randomIntLists\n  ys &lt;- forAll randomIntLists\n  assert $ length xs &lt; 4 &amp;&amp; (xs /= [] &amp;&amp; ys /=[])\n  where\n    randomIntLists = Gen.frequency\n      [ (1, Gen.list (Range.constant 0 1) randomInt)\n      , (10, Gen.list (Range.constant 1 100) randomInt)\n      ]\n    randomInt = Gen.integral (Range.constat 1 10)\n\nmain :: IO Bool\nmain = checkParallel $ \n  Group \"Test.Example\" [(\"Produce a minimal counter-example\", notLargeOrBothNotEmpty)]\n\n</code></pre>\n\n<p>So hedgehog sometimes will return as a counterexample the lists <code>( [ 1 , 1 , 1 , 1 ], [])</code>. However <code>([], [])</code> is a smaller counterexample (which sometimes is also reported by <code>hedgehog</code>).\n\ufffc</p>\n\n<p>In this case, the condition that violates the property is:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>4 &lt;= length xs || (xs == [] &amp;&amp; ys == [])\n</code></pre>\n\n<p>If initially a counterexample is found, where <code>ys /= []</code> and <code>4 &lt;= length xs</code>, the integrated shrinking approach will try to shrink <code>xs</code> first, and then will proceed shrinking <code>ys</code> keeping <code>xs</code> constant, as described in the post I cited in my original question.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 54412355, "answer_count": 2, "score": 1, "last_activity_date": 1548795200, "creation_date": 1548719588, "question_id": 54411983, "link": "https://stackoverflow.com/questions/54411983/example-that-shows-the-limitations-of-integrated-shrinking", "title": "Example that shows the limitations of integrated shrinking", "body": "<p>I just watched <a href=\"https://www.youtube.com/watch?v=AIv_9T0xKEo\" rel=\"nofollow noreferrer\">a video</a> that presents the notion of <em>integrated shrinking</em> for property based tests. The approach seems to have some advantages over <em>type directed shrinking</em>, however it was pointed out in <a href=\"https://www.reddit.com/r/haskell/comments/646k3d/ann_hedgehog_property_testing/\" rel=\"nofollow noreferrer\">this reddit thread</a> that the integrated shrinking approach does not fit well in the case of monadic generators:</p>\n\n<blockquote>\n  <p>Doing shrinking in your way does not fit well with a monadic style for generators. Here is an example, consider generating an arbitrary list (ignore termination for now):</p>\n\n<pre><code>do x &lt;- arbitrary\n   xs &lt;- arbitrary\n   return (x:xs)\n</code></pre>\n  \n  <p>Now, the default behavior of your shrinking would first shrink x (holding xs constant), and then shrink xs (holding x constant), which severely limits the shrinking (the concept of local minimum is now a lot less strong).</p>\n</blockquote>\n\n<p>I read the above comment as \"integrated shrinking might fail to provide a global minimum counter example\". However, since <a href=\"http://hackage.haskell.org/package/hedgehog-0.6/docs/Hedgehog.html\" rel=\"nofollow noreferrer\"><code>hedgehog</code></a> seems to be able to find minimal counter examples for failed properties on lists, I was wondering if there is an example that could show the drawback pointed out in the quote above.</p>\n"}, {"tags": ["windows", "haskell", "haskell-stack"], "answers": [{"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": true, "score": 3, "last_activity_date": 1548713163, "creation_date": 1548713163, "answer_id": 54410985, "question_id": 54410721, "link": "https://stackoverflow.com/questions/54410721/how-can-i-clear-console-before-build-using-stack-with-file-watch/54410985#54410985", "title": "How can I clear console before build using stack with file watch", "body": "<p>Try <a href=\"https://github.com/ndmitchell/ghcid\" rel=\"nofollow noreferrer\"><code>ghcid</code></a>. It's a program which does exactly what you want: run the appropriate command when a file changes, clearing the screen between changes. Have a look at <a href=\"https://www.parsonsmatt.org/2018/05/19/ghcid_for_the_win.html\" rel=\"nofollow noreferrer\">this tutorial</a> for more details. Plus, it looks like there's even a <a href=\"https://marketplace.visualstudio.com/items?itemName=ndmitchell.haskell-ghcid\" rel=\"nofollow noreferrer\">Visual Studio Code</a> extension which runs it directly in the IDE!</p>\n"}, {"tags": [], "owner": {"reputation": 5755, "user_id": 394253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985ef765f821b00d3b41ac5ca8aef6a0?s=128&d=identicon&r=PG", "display_name": "Ed&#39;ka", "link": "https://stackoverflow.com/users/394253/edka"}, "is_accepted": false, "score": 1, "last_activity_date": 1548715781, "creation_date": 1548715781, "answer_id": 54411417, "question_id": 54410721, "link": "https://stackoverflow.com/questions/54410721/how-can-i-clear-console-before-build-using-stack-with-file-watch/54411417#54411417", "title": "How can I clear console before build using stack with file watch", "body": "<p>There are a few extensions for VSCode which compile open files on the fly and populate <code>PROBLEMS</code> window with errors and warnings. From my personal experience I'd recommend <a href=\"https://marketplace.visualstudio.com/items?itemName=dramforever.vscode-ghc-simple\" rel=\"nofollow noreferrer\">Simple GHC</a> which just works out of the box and quite stable.</p>\n"}], "owner": {"reputation": 371, "user_id": 5589037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8e0afcaf170b7c13a53093cf2f5f84c?s=128&d=identicon&r=PG&f=1", "display_name": "John Walker", "link": "https://stackoverflow.com/users/5589037/john-walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 1, "accepted_answer_id": 54410985, "answer_count": 2, "score": 2, "last_activity_date": 1583635065, "creation_date": 1548711877, "last_edit_date": 1583635065, "question_id": 54410721, "link": "https://stackoverflow.com/questions/54410721/how-can-i-clear-console-before-build-using-stack-with-file-watch", "title": "How can I clear console before build using stack with file watch", "body": "<p>When doing significant refactoring using VSCode I have found running:</p>\n\n<p><code>stack build --file-watch</code></p>\n\n<p>in the integrated Powershell terminal invaluable. I was wondering if there was a way to somehow prepend a clear terminal command so I only see the last batch of errors.</p>\n\n<p>Something like:</p>\n\n<p><code>stack build --exec-before \"cmd cls\" --file-watch</code></p>\n\n<p><em>Note exe-before is not a real stack command</em></p>\n"}, {"tags": ["haskell", "yesod", "haskell-stack", "nix"], "comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1549325340, "post_id": 54410662, "comment_id": 95854485, "body": "Seems similar to my issue here: <a href=\"https://unix.stackexchange.com/questions/498435/how-do-i-diagnose-a-failing-nix-build/498695#498695\" title=\"how do i diagnose a failing nix build\">unix.stackexchange.com/questions/498435/&hellip;</a>"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1549325355, "post_id": 54410662, "comment_id": 95854487, "body": "Try <code>nix-build --debug</code>."}], "answers": [{"tags": [], "owner": {"reputation": 128, "user_id": 3403345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cd85d61f9bbf36329060421662a9b82?s=128&d=identicon&r=PG&f=1", "display_name": "snawster", "link": "https://stackoverflow.com/users/3403345/snawster"}, "is_accepted": false, "score": 0, "last_activity_date": 1549852075, "creation_date": 1549852075, "answer_id": 54623204, "question_id": 54410662, "link": "https://stackoverflow.com/questions/54410662/how-create-a-nix-package-with-haskell-stack/54623204#54623204", "title": "How create a nix package with haskell stack", "body": "<p>If you want a quick fix, the following should work:</p>\n\n<pre><code>{ nixpkgs ? import (builtins.fetchTarball {\n    url = \"https://github.com/NixOS/nixpkgs/archive/d42ef371c9b1b532400b0f2820885e575f4f1617.tar.gz\";\n    sha256 = \"0irb4zb6hdgaah238244jk2xf63xfb20xy3plb1194pd4xbgdr3r\";\n  }) {}\n, ghc ? nixpkgs.ghc\n}:\n\nwith nixpkgs;\n\nhaskell.lib.buildStackProject {\n   name =\"TesteYesod\";\n   src = ./.;\n   buildInputs = [ postgresql ];\n   inherit ghc;\n}\n</code></pre>\n\n<p>What's the problem? It seems that in the current 18.09 release, <a href=\"https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/haskell-modules/generic-stack-builder.nix\" rel=\"nofollow noreferrer\"><code>buildStackProject</code></a> is broken. The non-existent error message is caused by a subtly failing <code>preConfigure</code> script, which contains the following:</p>\n\n<pre><code>    addStackArgsHook = ''\nfor pkg in ''${pkgsHostHost[@]} ''${pkgsHostBuild[@]} ''${pkgsHostTarget[@]}\ndo\n  [ -d \"$pkg/lib\" ] &amp;&amp; \\\n    export STACK_IN_NIX_EXTRA_ARGS+=\" --extra-lib-dirs=$pkg/lib\"\n  [ -d \"$pkg/include\" ] &amp;&amp; \\\n    export STACK_IN_NIX_EXTRA_ARGS+=\" --extra-include-dirs=$pkg/include\"\ndone\n    '';\n</code></pre>\n\n<p>In your case, <code>stack</code> is the last dependency to be processed in the loop (and perhaps in all <code>buildStackProject</code> invocations in 18.09, I'm not sure), but it contains no <code>/lib</code> or <code>/include</code> directory, so the exit code with which the <code>preConfigure</code> script exits is <code>1</code>, and so the whole build process quits. This is just because of the shorthand <code>&amp;&amp;</code>, it would work if there was a proper <code>if</code>.</p>\n\n<p>It is however fixed in <code>master</code> already (<a href=\"https://github.com/NixOS/nixpkgs/pull/53618\" rel=\"nofollow noreferrer\">https://github.com/NixOS/nixpkgs/pull/53618</a>), so simply using a newer nixpkgs should fix that problem. Pinning the nixpkgs is something you want to do anyway if you want to use Nix's replicability guarantees to the fullest, as you can't know you're using the same nixpkgs commit, so you may be using different versions of system packages.</p>\n\n<p>(If you want to know how I debugged this - it seemed the problem was in the <code>preConfigure</code> step, so I took a look at the code in <code>generic-stack-builder.nix</code>, saw that <code>preConfigure</code> was overridable, copy-pasted the code from there into <code>default.nix</code> and added a <code>set -x</code> at the top. That showed me the problem above, and prompted me to go look at that file in master to see if there weren't changes since 18.09. Another workaround could be simply adding <code>true</code> to the <code>preConfigure</code> script if it wasn't already fixed in <code>master</code>, but that wasn't necessary.)</p>\n\n<p>(Also, I've opened <a href=\"https://github.com/NixOS/nixpkgs/issues/55548\" rel=\"nofollow noreferrer\">https://github.com/NixOS/nixpkgs/issues/55548</a> to backport the fix to 18.09.)</p>\n"}], "owner": {"reputation": 71, "user_id": 8845822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79e57160de098048b3dd66e69166ef77?s=128&d=identicon&r=PG&f=1", "display_name": "Rodolpho Pueyrred&#243;n", "link": "https://stackoverflow.com/users/8845822/rodolpho-pueyrred%c3%b3n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 349, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1570437218, "creation_date": 1548711610, "last_edit_date": 1570437218, "question_id": 54410662, "link": "https://stackoverflow.com/questions/54410662/how-create-a-nix-package-with-haskell-stack", "title": "How create a nix package with haskell stack", "body": "<p>I need to create the nix package from a project stack with postgres template.</p>\n\n<p>Basically it is the following: I have a virtual machine with NixOS and I need to portlet my project to another one with NixOS. For this I will use the nix copy command, but before I need to somehow \"install\" my project so that it is in /nix/store.</p>\n\n<p>I tried to do the same looking at another issue posted \"Generating a Nix package from a stack project\".</p>\n\n<p>come on. What I did was:</p>\n\n<pre><code>cd /home/ProjetoApp\nstack new TesteYesod yesod-postgres\ncd TestYesod\nstack init --resolver lts-11.22\nstack install yesod-bin --install-ghc\n</code></pre>\n\n<p>I added in stack.yaml:</p>\n\n<pre><code>nix\npure: true\nenable: true\npackages: [postgresql]\n</code></pre>\n\n<p>So far so good. I can compile and execute only stack. Then I was trying to generate a nix package. In stack.yaml I did:</p>\n\n<pre><code>nix\npure: true\nenable: true\nshell-file: default.nix\n</code></pre>\n\n<p>And in default.nix I did:</p>\n\n<pre><code>{nixpkgs ? import &lt;nixpkgs&gt; { }, ghc ? nixpkgs.ghc}:\n\nwith nixpkgs;\n\nhaskell.lib.buildStackProject {\n   name =\"teste-yesod-1.0.0\";\n   src = ./.;\n   buildInputs = [ postgresql ];\n   inherit ghc;\n}\n</code></pre>\n\n<p>If I do:</p>\n\n<pre><code>nix build\n</code></pre>\n\n<p>Occurs:</p>\n\n<pre><code>builder for '/nix/store/rckhmkgrkb6nzn7dkqqldfdm8cilpya2-teste-yesod \n1.0.0.drv' failed with exit code 1; last 5 log lines:\nunpacking sources\nunpacking source archive /nix/store/ \nn62hzn4igi1b7khksa6sp3cq8gk4h344-TesteYesod\nsource root is TestYesod\npatching sources\nconfiguring\n[0 built (1 failed), 0.0 MiB DL]\nerror: build of '/nix/store/rckhmkgrkb6nzn7dkqqldfdm8cilpya2-teste-yesod- \n1.0.0.drv' failed\n</code></pre>\n\n<p>If. How to instruct nix that the source is spread across multiple directories?</p>\n"}, {"tags": ["list", "function", "haskell", "list-comprehension", "trigonometry"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548704903, "post_id": 54409219, "comment_id": 95629310, "body": "Well <code>abs cos &gt; 0.001</code> is a <i>filter</i> it is <i>not</i> a stop condition, this will keep yielding values, but only remove those once <code>abs cos &gt; 0.001</code> so you will get stuck in an infinite loop anyway?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548705065, "post_id": 54409219, "comment_id": 95629384, "body": "Your current approach won&#39;t terminate; it will try values of <code>k</code> forever looking for values of <code>cos</code> that are big enough, without knowing that it will never find another one. You&#39;ll need to use <code>takeWhile</code>."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548705536, "post_id": 54409219, "comment_id": 95629603, "body": "@codingbudgie: I think it might be better to use a <code>takeWhile</code>, and to use some list processing functions, not list comprehension"}, {"owner": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1548719343, "post_id": 54409219, "comment_id": 95634647, "body": "Hmmm... Taylor series expansion. Homework problem?"}, {"owner": {"reputation": 71, "user_id": 10903940, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L1adn.jpg?s=128&g=1", "display_name": "codingbudgie", "link": "https://stackoverflow.com/users/10903940/codingbudgie"}, "reply_to_user": {"reputation": 978, "user_id": 1902082, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f46590cf12954aeab118e32b10f0ed97?s=128&d=identicon&r=PG", "display_name": "scooter me fecit", "link": "https://stackoverflow.com/users/1902082/scooter-me-fecit"}, "edited": false, "score": 0, "creation_date": 1548741257, "post_id": 54409219, "comment_id": 95639417, "body": "@scootermefecit No, I&#39;m trying to practice as much as possible. Writing my exam on programming on saturday :)"}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 10903940, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L1adn.jpg?s=128&g=1", "display_name": "codingbudgie", "link": "https://stackoverflow.com/users/10903940/codingbudgie"}, "edited": false, "score": 0, "creation_date": 1548706924, "post_id": 54409421, "comment_id": 95630265, "body": "Thank you so much it works! Haha I don&#39;t know whether your last comment is a joke :D I&#39;m so bad at haskell..but trying my best ;)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 71, "user_id": 10903940, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L1adn.jpg?s=128&g=1", "display_name": "codingbudgie", "link": "https://stackoverflow.com/users/10903940/codingbudgie"}, "edited": false, "score": 0, "creation_date": 1548707514, "post_id": 54409421, "comment_id": 95630567, "body": "@codingbudgie It is no joke. Maybe it won&#39;t be easy -- but I do think you can do it!"}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 6, "last_activity_date": 1548705998, "last_edit_date": 1548705998, "creation_date": 1548705689, "answer_id": 54409421, "question_id": 54409219, "link": "https://stackoverflow.com/questions/54409219/implement-the-law-of-cosine-in-haskell/54409421#54409421", "title": "Implement the law of cosine in Haskell?", "body": "<p>There are basically two problems here:</p>\n\n<ul>\n<li><code>div</code> is for integer division (i.e. takes integral inputs, and produces an integral output by rounding down) only. You want <code>(/)</code> for floating-point division.</li>\n<li><code>fac</code> returns an <code>Int</code>, which you must explicitly convert to a floating-point number before using in division. (Many languages auto-convert from integral types to floating-point types, but Haskell does not.) You can use <code>fromIntegral</code> to convert.</li>\n</ul>\n\n<p>Fixing these two things but nothing else, we get:</p>\n\n<pre><code>fac :: Int -&gt; Int\nfac n = if (n == 0) then 1 else n * fac (n-1)\n\ncos :: Double -&gt; Double\ncos x = sum [cos| k &lt;- [0..],\n                  let cos = (-1) * (x^(2*k) / fromIntegral (fac (2*k))) , \n                  abs (cos) &gt; 0.001]\n</code></pre>\n\n<p>This type-checks, though it has several other problems, in order from most important to least:</p>\n\n<ul>\n<li>You were probably hoping that Haskell would somehow magically know that once <code>abs cos &lt;= 0.001</code> in one iteration, it will continue to be that for all future iterations, and stop iterating. But it doesn't. You said to draw <code>k</code> from <code>[0..]</code>, and so it will draw <code>k</code> from that entire list -- never finishing. You might like <code>takeWhile</code> instead.</li>\n<li>You've lost the exponent <code>k</code> on <code>-1</code>!</li>\n<li>Even setting aside whether this is the most efficient formula to start from, your implementation repeats a lot of work. Each call to <code>fac (2*k)</code> must recompute all the previous factorials it had done as intermediate results; and your <code>x^(2*k)</code> repeats some work (though to a much lesser extent).</li>\n<li>Reusing the name <code>cos</code> is pretty confusing. Although it doesn't technically make the program <em>wrong</em>, I'd avoid it.</li>\n</ul>\n\n<p>I leave it to you to have fun exploring Haskell and learning how to fix these problems yourself -- I think it's well within the abilities you've shown here!</p>\n"}], "owner": {"reputation": 71, "user_id": 10903940, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L1adn.jpg?s=128&g=1", "display_name": "codingbudgie", "link": "https://stackoverflow.com/users/10903940/codingbudgie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 327, "favorite_count": 0, "accepted_answer_id": 54409421, "answer_count": 1, "score": 1, "last_activity_date": 1548735114, "creation_date": 1548704753, "last_edit_date": 1548735114, "question_id": 54409219, "link": "https://stackoverflow.com/questions/54409219/implement-the-law-of-cosine-in-haskell", "title": "Implement the law of cosine in Haskell?", "body": "<p>So I want to create my own cosine function using this formula: <a href=\"https://i.stack.imgur.com/sl15S.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sl15S.png\" alt=\"enter image description here\"></a></p>\n\n<p>The function should return the value as long as its absolute value is greater than 0.001.</p>\n\n<p>However, my code seems to have some type errors that I just don't know how to fix. I've already tried changing all types to Double, but it still doesn't work.</p>\n\n<pre><code>fac :: Int -&gt; Int\nfac n = if (n == 0) then 1 else n * fac (n-1)\n\ncos :: Double -&gt; Double\ncos x = sum [cos| k &lt;- [0..],\n                  let cos = (-1) * (x^(2*k) `div` fac (2*k)) , \n                  abs (cos) &gt; 0.001]\n</code></pre>\n\n<p>This is the error:</p>\n\n<p>\u2022 Couldn't match expected type \u2018Double\u2019 with actual type \u2018Int\u2019</p>\n\n<p>\u2022 In the second argument of \u2018div\u2019, namely \u2018fac (2 * k)\u2019</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 11, "creation_date": 1548672194, "post_id": 54399308, "comment_id": 95611101, "body": "Why is this a <code>class</code> at all as opposed to, say, <code>data ScrapeJob = ScrapeJob { adapter :: Text, desc :: Text, process :: ExceptT AdapterError IO ([Article], [ScrapeJob]) }</code>? If you use a <code>data</code> instead of a <code>class</code>, then you can simply close over whatever additional data is necessary, e.g. <code>filesystemJob :: FilePath -&gt; ScrapeJob</code>, <code>webJob :: Password -&gt; ScrapeJob</code>, etc."}, {"owner": {"reputation": 5748, "user_id": 767442, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d26ad3fe7caf43447e39cd2307b515d7?s=128&d=identicon&r=PG&f=1", "display_name": "jforberg", "link": "https://stackoverflow.com/users/767442/jforberg"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548686777, "post_id": 54399308, "comment_id": 95619354, "body": "@DanielWagner Thanks, that does seem simpler! I will try it out."}, {"owner": {"reputation": 798, "user_id": 9223023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/RTmMa.png?s=128&g=1", "display_name": "Petras Purlys", "link": "https://stackoverflow.com/users/9223023/petras-purlys"}, "edited": false, "score": 0, "creation_date": 1548928015, "post_id": 54399308, "comment_id": 95723308, "body": "Also, ScrapeJob feels very much like a function with a signature looking something like this <code>ScrapeJob :: Text -&gt; Text -&gt; j -&gt; ScrapeResult j</code>"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1549150956, "post_id": 54399308, "comment_id": 95802217, "body": "I wouldn\u2019t recommend sticking with existential polymorphism here\u2014a plain record is simpler\u2014but for future reference, you can express \u201cthese types are the same, but opaque from the outside\u201d with an existential: <code>data Do a = Do (a -&gt; Int); data With a = With a; data DoWith = forall a. DW (Do a) (With a)</code>. When you pattern-match on this, you get a proof in scope that the <code>a</code>s are the same, so you can use them together, with no knowledge of the concrete type: if <code>run :: DoWith -&gt; Int; run (DW (Do f) (With x)) = f x</code>, then <code>run (DW (Do length) (With &quot;hello&quot;)) == 5</code>."}], "owner": {"reputation": 5748, "user_id": 767442, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d26ad3fe7caf43447e39cd2307b515d7?s=128&d=identicon&r=PG&f=1", "display_name": "jforberg", "link": "https://stackoverflow.com/users/767442/jforberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1548669088, "creation_date": 1548669088, "question_id": 54399308, "link": "https://stackoverflow.com/questions/54399308/instance-private-typed-context-in-haskell", "title": "Instance-private, typed context in Haskell", "body": "<p>I'm writing a sort of scraper or data miner in Haskell. It consists of a main loop and other shared logic, along with a number of \"adapters\" each of which is designed to scrape a particular type of resource (not only web pages but possibly filesystem objects as well). The adapters all produce the same type of result but I would like them to be independent otherwise. Also, I would like them to share the main loop and other logic.</p>\n\n<p>This is what I have so far, using ExistentialQuantification to hide the adapter affiliation of a scraping job. My idea is that the main loop processes a sequence of jobs, dispatching on the \"process\" method to find the right adapter implementation.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE ExistentialQuantification #-}\n\nimport Control.Monad.Trans.Except\nimport Data.Text (Text)\nimport qualified Data.Text as T\n\n-- Metadata about an article\ndata Article = Article\n    { articleSource :: Text\n    , articleTitle :: Text\n    , articleUrl :: Text\n    , articleText :: Text\n    , articleDate :: Maybe Text\n    }\n    deriving (Show)\n\n-- Adapter for scraping a certain type of resource.\n--\n-- The adapter provides a seed job constructor which samples the current config\n-- and creates a seed job to be run first. The seed job then generates all\n-- other jobs, e.g. by scraping an index page.\n--\n--- Each adapter module exports a value of this type, and nothing else.\ndata Adapter = Adapter\n    { adapterName :: Text\n    , adapterSeedJob :: ScraperConfig -&gt; AnyJob\n    }\n\n-- Each scrape operation produces zero or more articles, and zero or more\n-- new scrape jobs.\ntype ScrapeResult j = ExceptT AdapterErr IO ([Article], [j])\n\n-- Specification of a resource to be scraped by a certain adapter.\n--\n-- Each adapter defines its own job type, containing the necessary information.\nclass ScrapeJob j where\n    jobAdapter :: j -&gt; Text\n    jobDesc :: j -&gt; Text\n    jobProcess :: j -&gt; ScrapeResult j\n\n-- Opaque type encapsulating any adapter's job type, used outside the adapter.\ndata AnyJob = forall j. ScrapeJob j =&gt; AnyJob j\n\ninstance ScrapeJob AnyJob where\n    jobAdapter (AnyJob j) = jobAdapter j\n    jobDesc (AnyJob j) = jobDesc j\n    jobProcess (AnyJob j) = wrap &lt;$&gt; jobProcess j\n        where wrap (as, js) = (as, AnyJob &lt;$&gt; js)\n\n-- Global configuration, such as which passwords to use\ndata ScraperConfig = ScraperConfig\n    { -- ...\n    }\n</code></pre>\n\n<p>My problem is that each adapter also has some context attached to it. One example would be that most adapters need to perform some kind of login procedure before it can access any data. I would like this to be handled separately from the scraping itself if possible, but I can't use the trick with AnyJob for \"AnyContext\" (I think) since there would be no way for the main loop of guaranteeing that the types of the AnyJob and AnyContext match up correctly.</p>\n\n<p>My current ideas, neither of which I'm really satisfied with, are:</p>\n\n<ol>\n<li><p>Fix the type of the context to a \"bag of data\" such as Map Text Text and add a special setup method to each adpater which creates this context.</p></li>\n<li><p>Add the required context as a field of every ScrapeJob instance, and copy it along explicitly whenever a new job is created.</p></li>\n<li><p>Turn the design upside down, letting each adapter run its own main loop using shared functions defined in a utility module.</p></li>\n</ol>\n\n<p>Is there something I'm missing here? Any advice on how to improve on this design would be appreciated.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "typeclass", "aeson", "gadt"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": true, "score": 3, "last_activity_date": 1548633383, "creation_date": 1548633383, "answer_id": 54394038, "question_id": 54393198, "link": "https://stackoverflow.com/questions/54393198/how-can-i-implement-fromjson-on-a-gadt-with-custom-type-class-constraints/54394038#54394038", "title": "How can I implement fromJSON on a GADT with custom type class constraints?", "body": "<p>Existential types are an antipattern, especially if you need to do deserialization. StartRun should contain a concrete type instead. Deserialization requires a concrete type anyway, hence you might as well specialize StartRun to it. </p>\n"}], "owner": {"reputation": 371, "user_id": 5589037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8e0afcaf170b7c13a53093cf2f5f84c?s=128&d=identicon&r=PG&f=1", "display_name": "John Walker", "link": "https://stackoverflow.com/users/5589037/john-walker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 54394038, "answer_count": 1, "score": 1, "last_activity_date": 1548633383, "creation_date": 1548625705, "last_edit_date": 1548626092, "question_id": 54393198, "link": "https://stackoverflow.com/questions/54393198/how-can-i-implement-fromjson-on-a-gadt-with-custom-type-class-constraints", "title": "How can I implement fromJSON on a GADT with custom type class constraints?", "body": "<p>I have the following GADT:</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\n\ndata LogProtocol a where\n  Message :: String -&gt; LogProtocol String\n  StartRun :: forall rc. (Show rc, Eq rc, Titled rc, ToJSON rc, FromJSON rc) \n   =&gt; rc -&gt; LogProtocol rc\n  ... and many more...\n</code></pre>\n\n<p>toJSON is straight forward and not shown. \nfromJSON implementation is based on:</p>\n\n<p><a href=\"https://stackoverflow.com/a/41207422/5589037\">This SO Question</a> and\n  <a href=\"https://medium.com/@jonathangfischoff/existential-quantification-patterns-and-antipatterns-3b7b683b7d71\" rel=\"nofollow noreferrer\">This Blog Post - pattern 2</a></p>\n\n<p>and is as follows:</p>\n\n<pre><code>{-# LANGUAGE PolyKinds #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE LambdaCase #-}\n{-# LANGUAGE TemplateHaskell #-}\n\n-- tag type is used in to/ from JSON to reduce the use of magic strings\ndata LPTag = MessageT |\n             StartRunT |\n             ... and many more...\n             deriving (Show, Eq, Enum)\n\ntagList :: Enum a =&gt; [a]\ntagList = enumFrom $ toEnum 0\n\n$(deriveJSON defaultOptions ''LPTag) \n\n-- a wrapper to hide the a type param in the GADT\ndata Some (t :: k -&gt; *) where\n  Some :: t x -&gt; Some t\n\ninstance FromJSON (Some LogProtocol) where\n\nparseJSON :: Value -&gt; Parser (Some LogProtocol)\nparseJSON v@(Object o) =\n  let \n    tag :: Maybe LPTag \n    tag = do \n      t &lt;- (HML.lookup \"type\" o) \n      parseMaybe parseJSON t \n\n    failMessage :: [Char]\n    failMessage = toS $ \"Could not parse LogProtocol no type field or type field value is not a member of specified in: \" \n                    &lt;&gt; (show(tagList :: [LPTag])) \n                    &lt;&gt; show v\n\n  in \n    maybe  \n      (fail failMessage )\n      (\n        \\case \n          MessageT -&gt; Some &lt;$&gt; (Message &lt;$&gt; o .: \"txt\")    \n          StartRunT -&gt; Some &lt;$&gt; (StartRun &lt;$&gt; o .: \"runConfig\")\n      )\n      tag        \n\nparseJSON wrng = typeMismatch \"LogProtocol\" wrng\n</code></pre>\n\n<p>The case for '''Message''' is fine. The problem I am having are errors such as:</p>\n\n<pre><code>* No instance for (Titled x2) arising from a use of `StartRun'\n* In the first argument of `(&lt;$&gt;)', namely `StartRun'\n  In the second argument of `(&lt;$&gt;)', namely\n    `(StartRun &lt;$&gt; o .: \"runConfig\")'\n  In the expression: Some &lt;$&gt; (StartRun &lt;$&gt; o .: \"runConfig\")\n</code></pre>\n\n<p>Anywhere I have my own type class constraints (such as Titled) \nin the data constructor the compiler says \"No\". \nIs there a way to resolve this?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1548622743, "post_id": 54392767, "comment_id": 95597325, "body": "Can&#39;t you just derive an <code>Ord</code> instance for your newtype?"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548622856, "post_id": 54392767, "comment_id": 95597358, "body": "If you want such constraint, you can define it as <code>class X a =&gt; Y a where ...</code>, so now all types <code>a</code> that implement <code>Y</code>, should implement <code>X</code> as well. But perhaps I&#39;m misunderstanding it."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1548623040, "post_id": 54392767, "comment_id": 95597406, "body": "@melpomene I think my quick experimentation suggested that if I have <code>newtype Foo a = Foo a</code>, then if I derive <code>instance Ord (Foo a)</code>, while I could use <code>Ord</code> functions on <code>Foo a</code> values, I can&#39;t use them directly on values of type <code>a</code>."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548623135, "post_id": 54392767, "comment_id": 95597432, "body": "@WillemVanOnsem I think that what you suggest is going in the other direction; I want, given class definition <code>Y</code>, for all <code>a</code> satisfying <code>Y a</code>, to also have an <code>X a</code> (without the implementer of the <code>a</code> type needing to do any additional work)."}], "answers": [{"comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1548623668, "post_id": 54392859, "comment_id": 95597577, "body": "This is nice, thanks. I was able to avoid the record syntax in my case as well, eg.g just <code>WrapY a</code> for the newtype."}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 1, "creation_date": 1548625554, "post_id": 54392859, "comment_id": 95598011, "body": "@bbarker Don&#39;t do that. It would be very unusual to have a <code>newtype</code> like this that isn&#39;t a record. After defining it as a record, you can choose to use it in both record syntax and normal syntax. Very importantly, the accessor doesn&#39;t have to be defined explicitly, either. If you look through the <code>base</code> package you&#39;ll see find a <i>ton</i> of <code>newtype</code>s that don&#39;t outright <i>need</i> to be records but are."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1548631542, "post_id": 54392859, "comment_id": 95599415, "body": "@HTNW could you elaborate on why/how it is useful to have a <code>newtype</code> defined without an explicit constructor in record syntax, or maybe a particular link to to source in <code>base</code> where it is happening? And also maybe on why it is a bad idea to not use record syntax in this case, though maybe the first question will answer the latter."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 1, "creation_date": 1548634838, "post_id": 54392859, "comment_id": 95599994, "body": "@bbarker I think the point that @HTNW is trying to make is that the <i>convention</i> is to use record syntax and that if you intend on having other people read this code, they&#39;ll probably have an easier time if you follow that convention. It&#39;s purely a point about style. As for a link, <code>WrappedMonoid</code> from my post is an example in <code>base</code>. Ditto far any of the other <code>Wrapped*</code> types."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 2, "creation_date": 1548680837, "post_id": 54392859, "comment_id": 95615730, "body": "@bbarker I suspect the misunderstanding here is this: you think that data types declared with record syntax must then always use record syntax. But it is not so. Even using Alec&#39;s definition from this answer, <code>WrapY &quot;hi&quot;</code> is a perfectly good value of type <code>WrappedY String</code>, and <code>f (WrapY x) = x ++ &quot;foo&quot;</code> is a perfectly good pattern match, producing a function of type <code>WrappedY String -&gt; String</code>, even though neither of these used explicit record syntax. So using record syntax in the data declaration gives you an unwrapping function for free, and doesn&#39;t prevent any otherwise valid uses."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 9, "last_activity_date": 1548623060, "creation_date": 1548623060, "answer_id": 54392859, "question_id": 54392767, "link": "https://stackoverflow.com/questions/54392767/is-it-possible-to-provide-default-instances-of-some-type-class-x-for-my-type-cla/54392859#54392859", "title": "Is it possible to provide default instances of some type class X for my type class Y?", "body": "<p>The usual trick here is to define a <code>newtype</code> wrapper with the instance you want. See <a href=\"https://hackage.haskell.org/package/base-4.10.0.0/docs/Data-Semigroup.html#t:WrappedMonoid\" rel=\"noreferrer\"><code>WrappedMonoid</code></a> for an example of this. In your case:</p>\n\n<pre><code>newtype WrappedY a = WrapY { unwrapY :: a }\n\ninstance Y a =&gt; X (WrappedY a) where \n  -- your default implementation here\n</code></pre>\n\n<p>Then, a type that has an instance of <code>Y</code> can derive its instance of <code>X</code> using the new <code>DerivingVia</code> extension. </p>\n\n<pre><code>{-# LANGUAGE DerivingVia #-}\n\ndata SomeType = ...\n  deriving X via WrappedY SomeType\n\ninstance Y SomeType where\n  -- your implementation here\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1915, "user_id": 2682729, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PZlkg.gif?s=128&g=1", "display_name": "typesanitizer", "link": "https://stackoverflow.com/users/2682729/typesanitizer"}, "is_accepted": false, "score": 4, "last_activity_date": 1548623750, "creation_date": 1548623750, "answer_id": 54392942, "question_id": 54392767, "link": "https://stackoverflow.com/questions/54392767/is-it-possible-to-provide-default-instances-of-some-type-class-x-for-my-type-cla/54392942#54392942", "title": "Is it possible to provide default instances of some type class X for my type class Y?", "body": "<p>The newtype wrapper + DerivingVia suggestion in Alec's answer works nicely if your user has GHC 8.6+ available (<code>DerivingVia</code> is a fairly new extension). In case that isn't an option, you can do something like -</p>\n\n<ol>\n<li><p>Provide a method like <code>implXViaY</code> which provides a method implementation for <code>X</code> via <code>Y</code>. For example, this is sometimes done with Applicative instances in the form of <code>(&lt;*&gt;) = ap</code> where <code>ap</code> is based on the implementation of <code>&gt;&gt;=</code> from Monad, or with Functor with <code>fmap = liftA</code> where <code>liftA</code> is based on the implementation of <code>(&lt;*&gt;)</code> in Applicative. This requires no extensions.</p></li>\n<li><p>Provide a Template Haskell function to automatically use the default definitions in case the type class has a lot of methods (this is basically an extension of 1). So something like <code>makeXviaY ''MyType</code> for the user. This requires the client to enable TemplateHaskell.</p></li>\n</ol>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 54392859, "answer_count": 2, "score": 3, "last_activity_date": 1548623750, "creation_date": 1548622367, "question_id": 54392767, "link": "https://stackoverflow.com/questions/54392767/is-it-possible-to-provide-default-instances-of-some-type-class-x-for-my-type-cla", "title": "Is it possible to provide default instances of some type class X for my type class Y?", "body": "<p>To elaborate, it is often possible to provide default implementations for type class instance functions, but I wonder if it is also possible to provide default implementations for type class instances of other type classes. </p>\n\n<p>For instance, say I'm implementing type class <code>Y</code> and I want all instances <code>a</code> of <code>Y</code> to satisfy <code>X a</code> for some other type class <code>X</code>. Initially I was trying to do this by writing <code>instance Y a =&gt; X a where ...</code>, but saw this was not really possible (<a href=\"https://stackoverflow.com/questions/7198907/haskell-constraint-is-no-smaller-than-the-instance-head\">Haskell Constraint is no smaller than the instance head</a>). However, unlike in the more general case described in the other question where there might be more than one type class constraint, I've just got one class constraint in my case, so I figure there might be a way to do this at the class definition level, maybe using a Haskell language extension. </p>\n\n<p>The method described in the other question doesn't seem to work too smoothly - let's say <code>X</code> is actually <code>Ord</code>. Wrapping <code>Ord</code> by some <code>newtype</code> prevents direct usage of <code>Ord</code> functions on the original type.</p>\n"}, {"tags": ["haskell", "ghc", "cabal"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548614867, "post_id": 54391655, "comment_id": 95595118, "body": "Does the module contains all the required &quot;ingredients&quot;? WHat if you write <code>import Text.Regex.Base.RegexLike(RegexOptions(..),RegexMaker(..),Re&zwnj;&#8203;gexContext(..),Match&zwnj;&#8203;Array)</code> on the shell (in case the package is too old/young, that can fail)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5775230"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548615107, "post_id": 54391655, "comment_id": 95595216, "body": "Yes,  that command also works in GHCi"}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1548676147, "post_id": 54391655, "comment_id": 95613188, "body": "Is it <a href=\"https://hackage.haskell.org/package/regex-posix-0.95.2\" rel=\"nofollow noreferrer\">this</a> one? Why do you want to <code>install</code> it? Does it provide a binary for running or you just want to use it in your code? If it is the later case (using in code) you might want to use <code>cabal</code> or <code>stack</code> to manage dependency of the project instead of <code>install</code> it globally."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 1, "creation_date": 1548681433, "post_id": 54391655, "comment_id": 95616085, "body": "This looks like a linking issue. For example, some distributions like Arch use dynamic linking by default, without static libraries, but without additional configuration, <code>cabal</code> tries to link statically, which results in the kind of message you are seeing. For more information: <a href=\"https://wiki.archlinux.org/index.php/Haskell\" rel=\"nofollow noreferrer\">wiki.archlinux.org/index.php/Haskell</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5775230"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1548693024, "post_id": 54391655, "comment_id": 95623391, "body": "@Li-yaoXia I am using Arch.  I was able to get it to work by uncommenting <code>ibrary-vanilla: False shared: True executable-dynamic: True</code> in my config, but am am now having similar issues with a different library <code>Graphics&#47;HGL&#47;Internals&#47;Events.hs:23:68: error:     Module \u2018Control.Concurrent.Chan\u2019 does not export \u2018isEmptyChan\u2019</code> ... any suggestions how to resolve these linking errors ?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1548693621, "post_id": 54391655, "comment_id": 95623800, "body": "@Li-yaoXia You should make that an answer!"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548693630, "post_id": 54391655, "comment_id": 95623806, "body": "@WarrickMacmillan That second one sounds significantly different. Worth a fresh question with  full details."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1548694474, "post_id": 54391655, "comment_id": 95624276, "body": "base-4.11 removed <code>isEmptyChan</code> so you need to fix the version bounds of the hgl package to account for that."}, {"owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "edited": false, "score": 0, "creation_date": 1548695372, "post_id": 54391655, "comment_id": 95624813, "body": "and more importantly, use an older version of GHC. You could also try to update hgl to a modern version but that may be a less trivial task."}], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1548694382, "creation_date": 1548694382, "answer_id": 54406741, "question_id": 54391655, "link": "https://stackoverflow.com/questions/54391655/how-to-use-cabal-install-for-regular-expression-package-installation/54406741#54406741", "title": "How to use cabal install for regular expression package installation?", "body": "<p>This is a linking issue. For example, some distributions like Arch use dynamic linking by default, without static libraries, but without additional configuration, cabal tries to link statically, which results in the kind of message you are seeing. For more information: <a href=\"https://wiki.archlinux.org/index.php/Haskell\" rel=\"nofollow noreferrer\">https://wiki.archlinux.org/index.php/Haskell</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5775230"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1548694382, "creation_date": 1548614718, "last_edit_date": 1548615369, "question_id": 54391655, "link": "https://stackoverflow.com/questions/54391655/how-to-use-cabal-install-for-regular-expression-package-installation", "title": "How to use cabal install for regular expression package installation?", "body": "<p>Am working through Real World Haskell and am trying to install regex-posix-0.95.2 from an untar[ed] package by simplying running</p>\n\n<pre><code>cabal install\n</code></pre>\n\n<p>I then see: </p>\n\n<pre><code>Text/Regex/Posix/Wrap.hsc:141:1: error:\n    Could not find module \u2018Text.Regex.Base.RegexLike\u2019\n    There are files missing in the \u2018regex-base-0.93.2\u2019 package,\n    try running 'ghc-pkg check'.\n    Use -v to see a list of the files searched for.\n    |\n141 | import Text.Regex.Base.RegexLike(RegexOptions(..),RegexMaker(..),RegexContext(..),MatchArray)                     \n</code></pre>\n\n<p>Despite the fact that I can load this in ghci with </p>\n\n<pre><code>Prelude&gt; :module Text.Regex.Base.RegexLike\nPrelude Text.Regex.Base.RegexLike&gt; \n</code></pre>\n\n<pre><code>Prelude&gt; import Text.Regex.Base.RegexLike(RegexOptions(..),RegexMaker(..),RegexContext(..),MatchArray)\nPrelude Text.Regex.Base.RegexLike&gt; \n</code></pre>\n\n<p>and see it in the module-system.                </p>\n\n<pre><code>[warrick@warrick-pc regex-posix-0.95.2]$ ghc-pkg find-module Text.Regex.Base.RegexLike\n/usr/lib/ghc-8.6.2/package.conf.d\n    regex-base-0.93.2\n</code></pre>\n\n<p>Why is this failing?  </p>\n\n<p>What are some more general tips and tricks when trying to debug cabal failures you'd recommend (as this is one instance of many issues I'm consistently having with Cabal)?</p>\n"}, {"tags": ["haskell", "functional-programming", "tuples"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9156598"}, "edited": false, "score": 0, "creation_date": 1548613115, "post_id": 54391277, "comment_id": 95594526, "body": "Not sure how to use the last one (the parameter it needs and where to use it), however  I used the first option you said and It works and makes sense. Thanks a lot !"}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 5, "creation_date": 1548613220, "post_id": 54391277, "comment_id": 95594561, "body": "@Hammad: due to <i>eta-reductions</i>, you don&#39;t need to mention that parameter. If you define <code>f y = g x y</code>, then that is equivalent to <code>f = g x</code>, so you simply define it as <code>unique = filter (uncurry (&#47;=))</code>, and than that function has type <code>Eq a =&gt; [(a,a)] -&gt; [(a,a)]</code>, so you can use it exactly the same way (like <code>unique [(1,2), (2,2), (3,4), (4,3), (4,4)]</code>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 7, "last_activity_date": 1548612880, "last_edit_date": 1548612880, "creation_date": 1548612493, "answer_id": 54391277, "question_id": 54391239, "link": "https://stackoverflow.com/questions/54391239/removing-tuples-that-have-the-same-pair-of-values-from-a-list/54391277#54391277", "title": "Removing tuples that have the same pair of values from a list", "body": "<p>Because your <code>else</code> case says:</p>\n\n<pre><code>unique [] = []\nunique (x:xs) = if (fst x) == (snd x) then unique (xs) else <b>x:[]</b></code></pre>\n\n<p>It thus says if <code>fst x</code> is <em>not</em> equal to <code>snd x</code>, then we return <code>x : []</code> (or shorter <code>[x]</code>), and we are done. So it does <em>not</em> perform recursion on the rest of the list.</p>\n\n<p>We can solve this by adding recursion on the rest of the list, like:</p>\n\n<pre><code>unique [] = []\nunique (x:xs) = if fst x == snd x then unique xs else x <b>: unique xs</b></code></pre>\n\n<p>That being said, we can use a filter here, like:</p>\n\n<pre><code>unique :: Eq a =&gt; [(a, a)] -&gt; [(a, a)]\nunique = filter <b>(\\(x, y) -&gt; x /= y)</b></code></pre>\n\n<p>or even shorter:</p>\n\n<pre><code>unique :: Eq a =&gt; [(a, a)] -&gt; [(a, a)]\nunique = filter <b>(uncurry (/=))</b></code></pre>\n\n<p>We thus retain all elements for which the first element <code>x</code> is <em>not</em> equal to the second element <code>y</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9156598"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 54391277, "answer_count": 1, "score": 2, "last_activity_date": 1548612880, "creation_date": 1548612289, "last_edit_date": 1548612630, "question_id": 54391239, "link": "https://stackoverflow.com/questions/54391239/removing-tuples-that-have-the-same-pair-of-values-from-a-list", "title": "Removing tuples that have the same pair of values from a list", "body": "<p>I want to remove all the tuples that have the same pair of values, e.g. <code>[(1,1), (2,3), (2,2), (3,4)]</code> I want <code>[(2, 3), (3, 4)]</code>. I am working in Haskell. This is what I tried:</p>\n\n<pre><code>unique [] = []\nunique (x:xs) = if (fst x) == (snd x) then unique (xs) else x:[]\n</code></pre>\n\n<p>And the output was:</p>\n\n<pre><code>[(2,3)]\n</code></pre>\n\n<p>I am confused on why <code>(3, 4)</code> did not appear.</p>\n"}, {"tags": ["parsing", "haskell", "parser-combinators", "trifecta"], "answers": [{"comments": [{"owner": {"reputation": 195, "user_id": 10891762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a71b4e51a1e940199e9f59075f2e997?s=128&d=identicon&r=PG&f=1", "display_name": "Nirvin M", "link": "https://stackoverflow.com/users/10891762/nirvin-m"}, "edited": false, "score": 0, "creation_date": 1548870871, "post_id": 54390199, "comment_id": 95702380, "body": "Thanks. TIL &lt;?&gt; function."}], "tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 4, "last_activity_date": 1548609470, "last_edit_date": 1548609470, "creation_date": 1548605874, "answer_id": 54390199, "question_id": 54388464, "link": "https://stackoverflow.com/questions/54388464/failure-handling-in-a-parser-function/54390199#54390199", "title": "Failure handling in a Parser function", "body": "<p>Failure is encoded by the absence of a successful parser. Trifecta will track the expected tokens for you, but you do have to tell it what they are called using <code>&lt;?&gt;</code>. So you would do</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fractionOrDecimal :: Parser DoubleOrRational\nfractionOrDecimal =\n        (Left  &lt;$&gt; try parseDecimal  &lt;?&gt; \"Decimal\")\n    &lt;|&gt; (Right &lt;$&gt; try parseFraction &lt;?&gt; \"Fractional\")\n</code></pre>\n\n<p>We now get errors like this:</p>\n\n<pre><code>&gt;&gt;&gt; parseTest fractionalOrDecimal \"neither fractional nor decimal\"\nerror: expected: Decimal, Fractional\nneither fractional nor decimal&lt;EOF&gt; \n^                       \n</code></pre>\n"}], "owner": {"reputation": 195, "user_id": 10891762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a71b4e51a1e940199e9f59075f2e997?s=128&d=identicon&r=PG&f=1", "display_name": "Nirvin M", "link": "https://stackoverflow.com/users/10891762/nirvin-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 54390199, "answer_count": 1, "score": 0, "last_activity_date": 1548609470, "creation_date": 1548594609, "question_id": 54388464, "link": "https://stackoverflow.com/questions/54388464/failure-handling-in-a-parser-function", "title": "Failure handling in a Parser function", "body": "<p>I'm learning Parser Combinators with <a href=\"https://hackage.haskell.org/package/trifecta-2\" rel=\"nofollow noreferrer\">Trifecta</a> library. I was introduced to <a href=\"https://hackage.haskell.org/package/base-4.11.1.0/docs/Control-Applicative.html#t:Alternative\" rel=\"nofollow noreferrer\">Alternative</a> typeclass and it's &lt;|> function.</p>\n\n<p>I got a Parser function in my code whose definition is</p>\n\n<pre><code>fractionOrDecimal :: Parser DoubleOrRational\nfractionOrDecimal =\n        (Left &lt;$&gt; try parseDecimal)                  -- A\n    &lt;|&gt; (Right &lt;$&gt; try parseFraction)                -- B\n    &lt;|&gt; (fail  \"Expected Fraction or Decimal.\")      -- Err\n</code></pre>\n\n<p>which attempts to parse the input as either decimal or fraction and fail if nothing worked. Is this approach correct or should I encode the failure <em>(fail)</em> differently rather than being part of the &lt;|> operation.</p>\n"}, {"tags": ["haskell", "ubuntu-18.04"], "comments": [{"owner": {"reputation": 166, "user_id": 3413039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33307c80f028ab6739893d8bcf73e9d4?s=128&d=identicon&r=PG&f=1", "display_name": "aviaviavi", "link": "https://stackoverflow.com/users/3413039/aviaviavi"}, "edited": false, "score": 0, "creation_date": 1569598581, "post_id": 54388423, "comment_id": 102661699, "body": "I had the same error on a different package, and the accepted answer worked for me. <code>apt install libtinfo-dev</code>"}], "answers": [{"comments": [{"owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "edited": false, "score": 0, "creation_date": 1548594734, "post_id": 54388473, "comment_id": 95588963, "body": "What is <code>libtinfo-dev</code>? And how to install it?"}], "tags": [], "owner": {"reputation": 19532, "user_id": 570689, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4eed5285039322bafbeee9102367b0a4?s=128&d=identicon&r=PG", "display_name": "\u0414\u041c\u0418\u0422\u0420\u0418\u0419 \u041c\u0410\u041b\u0418\u041a\u041e\u0412", "link": "https://stackoverflow.com/users/570689/%d0%94%d0%9c%d0%98%d0%a2%d0%a0%d0%98%d0%99-%d0%9c%d0%90%d0%9b%d0%98%d0%9a%d0%9e%d0%92"}, "is_accepted": true, "score": 4, "last_activity_date": 1569605704, "last_edit_date": 1569605704, "creation_date": 1548594643, "answer_id": 54388473, "question_id": 54388423, "link": "https://stackoverflow.com/questions/54388423/can-not-install-ghc-exactprint/54388473#54388473", "title": "can not install ghc-exactprint", "body": "<p>Looks like that <code>libtinfo-dev</code> package need to be installed via <code>apt</code> or whatever package manager is used.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 54388473, "answer_count": 1, "score": -1, "last_activity_date": 1569605704, "creation_date": 1548594310, "question_id": 54388423, "link": "https://stackoverflow.com/questions/54388423/can-not-install-ghc-exactprint", "title": "can not install ghc-exactprint", "body": "<p>I tried to install several packages as following:</p>\n\n<pre><code>stack install apply-refact hlint stylish-haskell hasktags hoogle\n</code></pre>\n\n<p>and I've got the following error: </p>\n\n<pre><code>ghc-exactprint-0.5.8.2: configure\nghc-exactprint-0.5.8.2: build\nProgress 1/2\n\n--  While building package ghc-exactprint-0.5.8.2 using:\n      /home/developer/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.3 --builddir=.stack-work/dist/x86_64-linux/Cabal-2.4.0.1 build --ghc-options \" -ddump-hi -ddump-to-file -fdiagnostics-color=always\"\n    Process exited with code: ExitFailure 1\n    Logs have been written to: /home/developer/.stack/global-project/.stack-work/logs/ghc-exactprint-0.5.8.2.log\n\n    Configuring ghc-exactprint-0.5.8.2...\n    Preprocessing library for ghc-exactprint-0.5.8.2..\n    Building library for ghc-exactprint-0.5.8.2..\n    [ 1 of 13] Compiling Language.Haskell.GHC.ExactPrint.Types ( src/Language/Haskell/GHC/ExactPrint/Types.hs, .stack-work/dist/x86_64-linux/Cabal-2.4.0.1/build/Language/Haskell/GHC/ExactPrint/Types.o )\n    [ 2 of 13] Compiling Language.Haskell.GHC.ExactPrint.Lookup ( src/Language/Haskell/GHC/ExactPrint/Lookup.hs, .stack-work/dist/x86_64-linux/Cabal-2.4.0.1/build/Language/Haskell/GHC/ExactPrint/Lookup.o )\n    [ 3 of 13] Compiling Language.Haskell.GHC.ExactPrint.AnnotateTypes ( src/Language/Haskell/GHC/ExactPrint/AnnotateTypes.hs, .stack-work/dist/x86_64-linux/Cabal-2.4.0.1/build/Language/Haskell/GHC/ExactPrint/AnnotateTypes.o )\n    &lt;command line&gt;: can't load .so/.DLL for: libtinfo.so (libtinfo.so: cannot open shared object file: No such file or directory)\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1548593453, "post_id": 54388239, "comment_id": 95588628, "body": "Relevant Reddit thread: <a href=\"https://www.reddit.com/r/haskell/comments/74r611/deriving_is_functions/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/74r611/deriving_is_functions</a>. Although\u2026 I\u2019m not sure what about those makes the library you\u2019ve already found out of date?"}, {"owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1548594306, "post_id": 54388239, "comment_id": 95588856, "body": "The fact that its build status is &#39;failed&#39; and the comment right beneath that. Maybe it is not accurate to call it &quot;out of date&quot; tough, I&#39;m not sure."}, {"owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1548595499, "post_id": 54388239, "comment_id": 95589167, "body": "This looks interesting: <a href=\"https://hackage.haskell.org/package/is-0.4/docs/Data-Generics-Is-TH.html\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/is-0.4/docs/&hellip;</a>"}, {"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1548599712, "post_id": 54388239, "comment_id": 95590363, "body": "Would it help if you would write it this way: <code>data MyData = A (Int, Int, String, Float, Int, (Char, Char)) | B (Int, String, Float, (Char, String), String)</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 4, "creation_date": 1548599971, "post_id": 54388239, "comment_id": 95590445, "body": "Tangential note: while this is an entirely reasonable question, you might want to double-check whether and how often you actually need the boolean tests. For instance, an <code>if isA x -- etc.</code> check can generally be replaced with pattern matching on <code>x</code> (say, with a <code>case</code> expression)."}, {"owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1548600456, "post_id": 54388239, "comment_id": 95590600, "body": "@duplode That&#39;s fair. However, I personally don&#39;t like to write a lot of &quot;_&quot; when pattern machting types with multiple records and this would be a way around that."}, {"owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1548600665, "post_id": 54388239, "comment_id": 95590689, "body": "@Elmex80s Not really, the example is just chosen to illustrate that I have data types with many records that are annoying to pattern mach."}], "answers": [{"comments": [{"owner": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1548599624, "post_id": 54388864, "comment_id": 95590337, "body": "What is the benefit of this over using your original <code>isA :: MyData -&gt; Bool</code> function?"}, {"owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "reply_to_user": {"reputation": 3248, "user_id": 5707684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wrGFn.jpg?s=128&g=1", "display_name": "Elmex80s", "link": "https://stackoverflow.com/users/5707684/elmex80s"}, "edited": false, "score": 0, "creation_date": 1548600321, "post_id": 54388864, "comment_id": 95590552, "body": "2 advantages: First, you don&#39;t need to manually define a function for each type (A, B and what not) and second when you add/remove a record of a type later on you won&#39;t need to add/remove a &quot;_&quot; in the corresponding type check function."}], "tags": [], "owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "is_accepted": false, "score": 0, "last_activity_date": 1548597218, "creation_date": 1548597218, "answer_id": 54388864, "question_id": 54388239, "link": "https://stackoverflow.com/questions/54388239/how-to-avoid-writing-trivial-data-type-check-functions/54388864#54388864", "title": "How to avoid writing trivial data type check functions", "body": "<p>So one way that circumvents the mindless writing of a lot of type check functions is to use <a href=\"https://hackage.haskell.org/package/is-0.4/\" rel=\"nofollow noreferrer\">this library</a> (found in the Reddit <a href=\"https://stackoverflow.com/users/707111/ry\">Ry</a> posted - thanks!).</p>\n\n<p>Example code:</p>\n\n<pre><code>import Data.Generics.Is.TH\n\n-- Cumbersome\nprintType (A _ _ _ _ _ _) = putStrLn \"Is A\"\nprintType (B _ _ _ _ _) = putStrLn \"Is B\"\n\n-- With library\nprintType x\n  | $(is 'A) x = putStrLn \"Is A\"\n  | $(is 'B) x = putStrLn \"Is B\"\n</code></pre>\n\n<p>Instead of <code>isA</code> and <code>isB</code> you would simply write <code>$(is 'A)</code> or <code>$(is 'B)</code> which works fine for me.</p>\n"}, {"comments": [{"owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "edited": false, "score": 0, "creation_date": 1548611036, "post_id": 54390436, "comment_id": 95593903, "body": "Okay, then maybe I&#39;ll try to avoid this altogether, thanks for clarifying."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 9, "last_activity_date": 1548614849, "last_edit_date": 1548614849, "creation_date": 1548607494, "answer_id": 54390436, "question_id": 54388239, "link": "https://stackoverflow.com/questions/54388239/how-to-avoid-writing-trivial-data-type-check-functions/54390436#54390436", "title": "How to avoid writing trivial data type check functions", "body": "<p>Record syntax can be exploited for this.</p>\n\n<pre><code>isA :: MyData -&gt; Bool\nisA A{} = True\nisA _   = False\n</code></pre>\n\n<p>This requires no extensions, and works regardless of the number of parameters constructor <code>A</code> takes.</p>\n\n<p>(That being said, I don't think such functions are that useful in Haskell. Beware of \"boolean blindness\" -- i.e., of reducing information to booleans when you do not need to.)</p>\n"}], "owner": {"reputation": 152, "user_id": 1935301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a80cd7bdb07f8b6d39385943c0f6fb4?s=128&d=identicon&r=PG", "display_name": "ryan91", "link": "https://stackoverflow.com/users/1935301/ryan91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 54390436, "answer_count": 2, "score": 3, "last_activity_date": 1548614849, "creation_date": 1548593142, "last_edit_date": 1548596567, "question_id": 54388239, "link": "https://stackoverflow.com/questions/54388239/how-to-avoid-writing-trivial-data-type-check-functions", "title": "How to avoid writing trivial data type check functions", "body": "<p>Some of my data types in Haskell end up having quite a few records, for example</p>\n\n<pre><code>data MyData\n  = A Int Int String Float Int (Char, Char)\n  | B Int String Float (Char, String) String\n</code></pre>\n\n<p>and to check what type it is I end up writing functions like</p>\n\n<pre><code>isA :: MyData -&gt; Bool\nisA (A _ _ _ _ _ _) = True\nisA _ = False\n\n-- isB and so on\n</code></pre>\n\n<p>Now this gets cumbersome fairly quickly so I searched how to use <code>derive</code> or something similar to auto-generate those and I found <a href=\"https://stackoverflow.com/questions/6088935/checking-for-a-particular-data-constructor\">this</a>. However, the <a href=\"http://hackage.haskell.org/package/derive\" rel=\"nofollow noreferrer\">library</a> proposed in that question seems to be out of date due to the introduction of <a href=\"https://wiki.haskell.org/GHC.Generics\" rel=\"nofollow noreferrer\">ghc generics</a> and the related <a href=\"https://hackage.haskell.org/package/generic-deriving\" rel=\"nofollow noreferrer\">generic-deriving library</a>. I've taken a look at these but they seem to be very powerful and I don't quite know where to start.</p>\n\n<p>So my question is: How can you (if possible) get around having to manually write <code>isA</code> and <code>isB</code> for <code>MyData</code>?</p>\n"}, {"tags": ["haskell", "binary-tree", "list-comprehension"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548583995, "post_id": 54387009, "comment_id": 95586173, "body": "You create two trees <code>x</code> and <code>y</code> with size <code>i</code>, so unless these sum up to <code>n-1</code>, the constraint is <i>never</i> satisfied."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1548584190, "post_id": 54387009, "comment_id": 95586209, "body": "Yeah, the second <code>allTreesN</code> should probably have <code>(n - 1 - i)</code> instead of <code>i</code>?"}, {"owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "edited": false, "score": 1, "creation_date": 1548588306, "post_id": 54387009, "comment_id": 95587241, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/54383876/create-random-data-from-custom-type\" title=\"create random data from custom type\">stackoverflow.com/questions/54383876/&hellip;</a>? (Although it isn&#39;t exactly the same question)"}], "answers": [{"tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": true, "score": 4, "last_activity_date": 1548603700, "last_edit_date": 1548603700, "creation_date": 1548584453, "answer_id": 54387082, "question_id": 54387009, "link": "https://stackoverflow.com/questions/54387009/generate-all-binary-trees-with-size-n/54387082#54387082", "title": "generate all binary trees with size n", "body": "<p>You basically generate <em>all</em> trees of size <code>i</code> both for <code>x</code> and <code>y</code>, and then aim to construct a tree of size <code>n</code>. This will only work if <code>i = 2 *n</code>. But now a second problem occurs: we can never generate a tree of size <code>1</code> here, since <code>1</code> can not be divided by two. Since we can not generate a tree of size <code>1</code>, we thus can not generate trees of size <code>2</code>, and so on.</p>\n\n<p>We thus need to make sure we generate trees of the correct size. We can do that by generating a tree of size <code>i</code>, and another one of size <code>n-i-1</code>. If we construct a node of that size, we know for sure that the size of a node carrying these subtrees has size <code>n</code>, so we can even omit the check.</p>\n\n<p>So a correct implementation is:</p>\n\n<pre><code>allTreesN :: Int -&gt; a -&gt; [Tree a]\nallTreesN 0 _ = [Leaf]\nallTreesN n v = [Node l v r | i &lt;- [0..n-1],\n                              l &lt;- allTreesN i v,\n                              r &lt;- allTreesN <b>(n-1-i)</b> v]</code></pre>\n\n<p>For example:</p>\n\n<pre><code>Prelude&gt; allTreesN 0 'a'\n[Leaf]\nPrelude&gt; allTreesN 1 'a'\n[Node Leaf 'a' Leaf]\nPrelude&gt; allTreesN 2 'a'\n[Node Leaf 'a' (Node Leaf 'a' Leaf),Node (Node Leaf 'a' Leaf) 'a' Leaf]\nPrelude&gt; allTreesN 3 'a'\n[Node Leaf 'a' (Node Leaf 'a' (Node Leaf 'a' Leaf)),Node Leaf 'a' (Node (Node Leaf 'a' Leaf) 'a' Leaf),Node (Node Leaf 'a' Leaf) 'a' (Node Leaf 'a' Leaf),Node (Node Leaf 'a' (Node Leaf 'a' Leaf)) 'a' Leaf,Node (Node (Node Leaf 'a' Leaf) 'a' Leaf) 'a' Leaf]\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 6209441, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/36a02632e6afdaafe57afd9be71017e0?s=128&d=identicon&r=PG&f=1", "display_name": "hhwwww", "link": "https://stackoverflow.com/users/6209441/hhwwww"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "accepted_answer_id": 54387082, "answer_count": 1, "score": 2, "last_activity_date": 1548603700, "creation_date": 1548583901, "question_id": 54387009, "link": "https://stackoverflow.com/questions/54387009/generate-all-binary-trees-with-size-n", "title": "generate all binary trees with size n", "body": "<p>I'd like to write a function which returns all possible binary trees for any given size. </p>\n\n<p>Unfortunately I have no clue, why my solution always returns an empty list, except for size 1. </p>\n\n<pre><code>allTreesN :: Int -&gt; t -&gt; [Tree t]\nallTreesN n t \n    | n == 0 = [ Leaf ]\n    | otherwise = [(Node x t y) | i &lt;- [0..n-1], x &lt;- (allTreesN i t),y &lt;- (allTreesN i t), size (Node x t y) == n]\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1548564049, "post_id": 54384656, "comment_id": 95582880, "body": "Are you using <code>type Parser = Parsec Void Text</code>?"}, {"owner": {"reputation": 98, "user_id": 10973392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81846965a4a1788d7a880f0320bb5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Kr&#252;ger", "link": "https://stackoverflow.com/users/10973392/hans-kr%c3%bcger"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1548661114, "post_id": 54384656, "comment_id": 95605626, "body": "Yes, I&#39;m using exactly that type."}], "answers": [{"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": true, "score": 0, "last_activity_date": 1548632912, "last_edit_date": 1548632912, "creation_date": 1548612153, "answer_id": 54391219, "question_id": 54384656, "link": "https://stackoverflow.com/questions/54384656/how-to-combine-megaparsec-with-text-read-derived-read-instance/54391219#54391219", "title": "How to combine Megaparsec with Text.Read (derived Read instance)", "body": "<p>You can use <code>getInput :: MonadParsec e s m =&gt; m s</code> and <code>setInput :: MonadParsec e s m =&gt; s -&gt; m ()</code> together with <code>reads :: Read a =&gt; String -&gt; [(a, String)]</code> for that. <code>getInput</code> and <code>setInput</code> just get and set the input stream the parser is working on and <code>reads</code> takes a string and returns a list of possible parses together with the remaining unconsumed portions of the input. We also need to tell the parser the new offset in the input, otherwise error locations are wrong. We can do that using <code>getOffset</code> and <code>setOffset</code>.</p>\n\n<pre><code>-- For equality constraint (~)\n{-# LANGUAGE TypeFamilies #-}\n\nimport Text.Megaparsec\nimport Text.Read       (reads)\n\nreadableDatatype :: (Read a, MonadParsec e s m, s ~ String) =&gt; m a\nreadableDatatype = do\n  input  &lt;- getInput\n  offset &lt;- getOffset\n  choice $ \n    (\\(a, input') -&gt; a &lt;$ setInput input'\n                       &lt;* setOffset (offset + length input - length input'))\n    &lt;$&gt; reads input\n\n</code></pre>\n\n<p>If your input is something other than <code>String</code> you will have to convert between that and <code>String</code> after <code>getInput</code> and before <code>setInput</code>.</p>\n\n<p>The following is about performance concerns, so not really relevant to your problem, but maybe it is educational and it may be useful to others who may need a solution with good performance.</p>\n\n<p>Converting the whole input between <code>String</code> and some other type all the time during parsing is a rather big performance bottleneck for larger input. Furthermore using <code>length</code> to calculate the new offset here is not very performant either.</p>\n\n<p>To solve both of these problems need some way to be able to know how much of the input was actually consumed by the Read-parser, so that we can just drop that part from the original input instead of having to convert the whole unconsumed part back to the original input type. But the <code>Read</code> class does not have that. One could try to parse incrementally longer prefixes of the input, which may be faster in cases where the parses done using <code>Read</code> are short compared to the length of the entire input. You could also use <code>unsafePerformIO</code> to write to an <code>IORef</code> how much of the input was actually forced by the Read-parser which would be the fastest but not so pretty solution.</p>\n\n<p>I implemented the latter <a href=\"https://gist.github.com/janpath/282e337c39d486d7561c9efd1edfa654\" rel=\"nofollow noreferrer\">here</a>. Feel free to use it, but be aware that it is not very well tested. It does however solve all the problems with the above approach.</p>\n"}, {"comments": [{"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1548765822, "post_id": 54411539, "comment_id": 95652336, "body": "You can get rid of the unknown parse error using <code>(&lt;?&gt;)</code>. E.g. <code>readableDatatype @Int &lt;?&gt; &quot;Int&quot;</code> would at least tell you that it expected an <code>Int</code>. But yes, <code>reads</code> does not give us a list of possible expected tokens, so we do loose some quality in error messages."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1548766063, "post_id": 54411539, "comment_id": 95652478, "body": "For very simple types that are just a list of constructors without arguments you could also derive <code>Enum</code>, <code>Bounded</code> and <code>Show</code>. Then <code>[minBound..]</code> would give you a list of all possible values, which you can then <code>show</code>. Now you have a list of all possible values together with a string representation of them, which you could easily make into a parser."}, {"owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1548766097, "post_id": 54411539, "comment_id": 95652499, "body": "I am not really sure what you mean by \u201cdefining the constructors as strings\u201d."}, {"owner": {"reputation": 98, "user_id": 10973392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81846965a4a1788d7a880f0320bb5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Kr&#252;ger", "link": "https://stackoverflow.com/users/10973392/hans-kr%c3%bcger"}, "reply_to_user": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "edited": false, "score": 0, "creation_date": 1548802158, "post_id": 54411539, "comment_id": 95671436, "body": "\u201cdefining the constructors as strings\u201d just should mean that I parse the constructor e.g. &quot;TI_I_Signal1 activated&quot;  as two strings one after the other. The definition is normal: <code>data TI_I = TI_I_Signal1 Activation | TI_I_Signal2 SomethingOther</code>"}], "tags": [], "owner": {"reputation": 98, "user_id": 10973392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81846965a4a1788d7a880f0320bb5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Kr&#252;ger", "link": "https://stackoverflow.com/users/10973392/hans-kr%c3%bcger"}, "is_accepted": false, "score": 0, "last_activity_date": 1548716486, "creation_date": 1548716486, "answer_id": 54411539, "question_id": 54384656, "link": "https://stackoverflow.com/questions/54384656/how-to-combine-megaparsec-with-text-read-derived-read-instance/54411539#54411539", "title": "How to combine Megaparsec with Text.Read (derived Read instance)", "body": "<p>That did it. Thank you! In the meantime I made a \"conservative\" solution of the problem by defining the constructors as strings and parsing them, without using read. That has the advantage, that you got the impressive error message of megaparsec, that tell you what symbols are missing. </p>\n\n<p>Example with <code>read</code>:</p>\n\n<pre><code>1:8:\n  |\n1 | digiIn TI_I_Signal1 DirA Dectivated\n  |        ^\nunknown parse error\n</code></pre>\n\n<p>(only  a 'a' was missing in \"Deactivated\")</p>\n\n<p>example with an hand written parser for the datatype:</p>\n\n<pre><code>1:19:\n  |\n1 | digiIn TI_I_Signal1 Dectivated\n  |                     ^^^^^^^^\nunexpected \"Dectivat\"\nexpecting \"active\", \"inactive\", '0', or '1'\n</code></pre>\n\n<p>I think I will use your code block in future datatypes.\nThank you very much!</p>\n"}], "owner": {"reputation": 98, "user_id": 10973392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a81846965a4a1788d7a880f0320bb5b6?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Kr&#252;ger", "link": "https://stackoverflow.com/users/10973392/hans-kr%c3%bcger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 54391219, "answer_count": 2, "score": 2, "last_activity_date": 1548716486, "creation_date": 1548557342, "question_id": 54384656, "link": "https://stackoverflow.com/questions/54384656/how-to-combine-megaparsec-with-text-read-derived-read-instance", "title": "How to combine Megaparsec with Text.Read (derived Read instance)", "body": "<p>I want to use the derived instances of Read in the megaparsec module.\nHow can I use 'Text.Read.read' or 'Text.Read.readEither' in a 'Parser a' ?</p>\n\n<p>It needs not to be fast, but easy to maintain and to extend.\nThe megaparsec module is for testing my application via CLI, so many different datatypes must be parsed.</p>\n\n<p>It shall work in the following way:</p>\n\n<pre><code>import Text.Megaparsec\n\nreadableDatatype :: Read a =&gt; Parser a\nreadableDatatype = \n  -- This is wrong, but describes how it shall work\n  -- liftA read chunkToTokens\n\nexpr' :: Parser UserControlExpr\nexpr' = timeExpr\n  &lt;|&gt; timeEventExpr\n  &lt;|&gt; digiInExpr\n  &lt;|&gt; quitExpr\n\ndigiInExpr :: Parser UserControlExpr\ndigiInExpr = do\n  cmdword \"digiIn\"\n  inElement &lt;- (readableDatatype  :: Parser TI_I)\n  return $ UserDigiIn inElement\n</code></pre>\n\n<p>What do I have to write, so that the three functions typecheck, especially <code>readableDataype</code> ?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 4, "creation_date": 1548547120, "post_id": 54383876, "comment_id": 95580699, "body": "This is I think a library recommendation question, or at least the answer is: use <code>smallcheck</code>, or <code>quickcheck</code>, or something else shinier. If you want to do this task yourself as a learning experience, then I would ask what you&#39;ve tried so far and where you&#39;re stuck"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548608032, "post_id": 54383876, "comment_id": 95592957, "body": "If you create a truly random tree, how will you know what the depth of the tree is so that you&#39;ll know if <code>depth</code> is returning the correct answer? You want <i>deterministic</i> input for your tests."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 6112831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qsXkq.jpg?s=128&g=1", "display_name": "paquechee", "link": "https://stackoverflow.com/users/6112831/paquechee"}, "edited": false, "score": 0, "creation_date": 1548649033, "post_id": 54384415, "comment_id": 95602282, "body": "This looks quite like what I want,the only problem is that my <code>depth</code> function requires a <code>Tree</code> not a <code>IO Tree</code>. Which is the correct way to work around this?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 31, "user_id": 6112831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qsXkq.jpg?s=128&g=1", "display_name": "paquechee", "link": "https://stackoverflow.com/users/6112831/paquechee"}, "edited": false, "score": 0, "creation_date": 1548790996, "post_id": 54384415, "comment_id": 95667166, "body": "In <code>GHCi</code> (or in your <code>main</code> function&#39;s <code>do</code>-block) <code>trees &lt;- Control.Monad.replicateM numberOfTrees (arbitraryTree myDepth)</code>. Then, <code>trees :: [Tree]</code>."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 1, "last_activity_date": 1548553604, "creation_date": 1548553604, "answer_id": 54384415, "question_id": 54383876, "link": "https://stackoverflow.com/questions/54383876/create-random-data-from-custom-type/54384415#54384415", "title": "Create random data from custom type", "body": "<p>Think of it as a simple recursive problem. The only complication is that getting a random number requires either threading through explicitly a generator, or working within <code>IO</code>. For simplicity, I'll stick with the latter.</p>\n\n<pre><code>import System.Random\n\ndata Tree = Empty | Node Tree Tree\n\n-- | Generate a tree of the given size\narbitraryTree :: Int -&gt; IO Tree\narbitraryTree treeSize\n  | treeSize &lt;= 1 = pure Empty  -- base case, tree of size 1\n  | otherwise = do\n      leftSize &lt;- randomRIO (0,treeSize - 1)\n      let rightSize = treeSize - 1 - leftSize\n\n      leftSubtree &lt;- arbitraryTree leftSize\n      rightSubtree &lt;- arbitraryTree rightSize\n\n      pure (Node leftSubtree rightSubtree)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7817, "user_id": 7345298, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9477d048c5c29b16307b3356146d497a?s=128&d=identicon&r=PG&f=1", "display_name": "bradrn", "link": "https://stackoverflow.com/users/7345298/bradrn"}, "is_accepted": false, "score": 0, "last_activity_date": 1548553624, "creation_date": 1548553624, "answer_id": 54384419, "question_id": 54383876, "link": "https://stackoverflow.com/questions/54383876/create-random-data-from-custom-type/54384419#54384419", "title": "Create random data from custom type", "body": "<p>Interesting question! This problem is best approached in two parts: generating a list of <code>Tree</code>s with the required amount of nodes, and then selecting one value at random from that list.</p>\n\n<p>We'll start with the first problem: given a number <em>n</em>, generate a list of all <code>Tree</code>s with <em>n</em> <code>Node</code>s. But how would we do this? Let's try out a few simple cases for small <em>n</em>s. For <em>n</em> = 0, we have only one choice: <code>Empty</code>. (From now on, I'll abbreviate <code>Node</code> and <code>Empty</code> as <code>N</code> and <code>E</code> respectfully to reduce the amount of typing.) For <em>n</em> = 1, we also have only one choice: <code>N E E</code>. For <em>n</em> = 2, we have two cases, which we can generate from the <em>n</em> = 1 case by replacing one <code>E</code> with <code>N E E</code>:</p>\n\n<pre><code>N (N E E) E\nN E (N E E)\n</code></pre>\n\n<p>For <em>n</em> = 3, we can repeat the same procedure, substituting each <code>E</code> in turn in each case with <code>N E E</code> to find all the possible places we can add an extra node:</p>\n\n<pre><code>N (N (N E E) E) E\nN (N E (N E E)) E\nN (N E E) (N E E)\nN E (N (N E E) E)\nN E (N E (N E E))\n</code></pre>\n\n<p>We can do this via a recursive function:</p>\n\n<pre><code>allWithNum :: Int -&gt; [Tree]\nallWithNum 0 = [Empty]\nallWithNum n = nub $ concatMap subWithNode (allWithNum $ n-1)\n  where\n    subWithNode = fmap snd . filter fst . go False\n      where\n        go False Empty = [(True,Node Empty Empty),(False,Empty)]\n        go True  Empty = [(True,Empty)]\n        go hasSubdNode (Node x y) = do\n            (subdX, newX) &lt;- go hasSubdNode x\n            (subdY, newY) &lt;- go subdX y\n            return (subdY, Node newX newY)\n</code></pre>\n\n<p>(Note that this uses <code>nub</code> from <code>Data.List</code>, and also requires <code>Tree</code> to have an <code>Eq</code> instance.)</p>\n\n<p>Most of the work here is done in <code>go</code>, which moves along a <code>Tree</code> substituting <code>Node Empty Empty</code> into each <code>Empty</code> in turn, keeping track in its first argument of whether a substitution has been made yet.</p>\n\n<p>Now for the second problem: how do we choose a random element from this list? This may be done using the functions in the <a href=\"https://hackage.haskell.org/package/random-1.1/docs/System-Random.html\" rel=\"nofollow noreferrer\"><code>System.Random</code></a> module from the <code>random</code> package, by using <code>choose (0, length_of_list)</code> to choose an index and then getting the value at that index using <code>(!!)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 120535, "user_id": 123109, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/157c96de3d125abc1c363ff25c20dfaf?s=128&d=identicon&r=PG", "display_name": "Greg Bacon", "link": "https://stackoverflow.com/users/123109/greg-bacon"}, "is_accepted": false, "score": 0, "last_activity_date": 1549574346, "creation_date": 1549574346, "answer_id": 54582454, "question_id": 54383876, "link": "https://stackoverflow.com/questions/54383876/create-random-data-from-custom-type/54582454#54582454", "title": "Create random data from custom type", "body": "<p><a href=\"http://hackage.haskell.org/package/QuickCheck\" rel=\"nofollow noreferrer\">QuickCheck</a> is your friend. Now is a great time to begin learning it.</p>\n\n<p>You asked about generating random trees. In QuickCheck terms, we generate <em>arbitrary</em> trees using the typeclass <a href=\"http://www.cse.chalmers.se/~rjmh/QuickCheck/manual_body.html#18\" rel=\"nofollow noreferrer\"><code>Arbitrary</code></a>.</p>\n\n<pre><code>class Arbitrary a where\n  arbitrary   :: Gen a\n  coarbitrary :: a -&gt; Gen b -&gt; Gen b\n</code></pre>\n\n<p><a href=\"http://www.cse.chalmers.se/~rjmh/QuickCheck/manual_body.html#13\" rel=\"nofollow noreferrer\"><code>Gen</code></a> is a typeclass for test data generators.</p>\n\n<blockquote>\n  <h3>Test Data Generators: The Type Gen</h3>\n  \n  <p>Test data is produced by test data generators. QuickCheck defines\n  default generators for most types, but you can use your own with\n  <code>forAll</code>, and will need to define your own generators for any new\n  types you introduce.</p>\n  \n  <p>Generators have types of the form <code>Gen a</code>; this is a generator for\n  values of type <code>a</code>. The type <code>Gen</code> is a monad, so Haskell's <code>do</code>\n  syntax and standard monadic functions can be used to define\n  generators.</p>\n  \n  <p>Generators are built up on top of the function</p>\n\n<pre><code>choose :: Random a =&gt; (a, a) -&gt; Gen a\n</code></pre>\n  \n  <p>which makes a random choice of a value from an interval, with a\n  uniform distribution. For example, to make a random choice between the\n  elements of a list, use</p>\n\n<pre><code>do i &lt;- choose (0, length xs-1)\n   return (xs !! i)\n</code></pre>\n</blockquote>\n\n<p>In your question, you say you want to generate trees with a certain number of nodes. An <code>Arbitrary</code> instance for that is</p>\n\n<pre><code>instance Arbitrary Tree where\n  arbitrary = sized tree'\n    where tree' 0 = return Empty\n          tree' n | n &gt; 0 = do\n            lsize &lt;- choose (0, n - 1)\n            l &lt;- tree' lsize\n            r &lt;- tree' (n - lsize - 1)\n            return $ Node l r\n</code></pre>\n\n<p>This instance respects an external size parameter thanks to <a href=\"http://www.cse.chalmers.se/~rjmh/QuickCheck/manual_body.html#15\" rel=\"nofollow noreferrer\"><code>sized</code></a>.</p>\n\n<blockquote>\n  <h3>The Size of Test Data</h3>\n  \n  <p>Test data generators have an implicit <code>size</code> parameter; quickCheck\n  begins by generating small test cases, and gradually increases the\n  size as testing progresses. Different test data generators interpret\n  the size parameter in different ways: some ignore it, while the list\n  generator, for example, interprets it as an upper bound on the length\n  of generated lists. You are free to use it as you wish to control your\n  own test data generators. You can obtain the value of the size\n  parameter using</p>\n\n<pre><code>sized :: (Int -&gt; Gen a) -&gt; Gen a\n</code></pre>\n  \n  <p><code>sized g</code> calls <code>g</code>, passing it the current size as a parameter. For\n  example, to generate natural numbers in the range 0 to n, use</p>\n\n<pre><code>sized $ \\n -&gt; choose (0, n)\n</code></pre>\n</blockquote>\n\n<p>The internal <code>tree'</code> generator takes the number of nodes remaining and creates a tree by creating <code>Empty</code> when the parameter is zero or else creating a <code>Node</code> whose left subtree has size between 0 and <code>n</code> - 1 (less 1 to account for the node itself) and whose right subtree gets the remaining elements.</p>\n\n<p>Say you have a function</p>\n\n<pre><code>nodes Empty = 0\nnodes (Node l r) = 1 + nodes l + nodes r\n</code></pre>\n\n<p>and we want to see that it correctly counts nodes in 10-node trees. After defining the property</p>\n\n<pre><code>prop_nodes_count = forAll (resize 10 arbitrary) (\\t -&gt; nodes t == 10)\n</code></pre>\n\n<p>we successfully test it in GHCi with</p>\n\n<pre><code>\u03bb&gt; quickCheck prop_nodes_count\n+++ OK, passed 100 tests.\n</code></pre>\n\n<p>The code above uses <code>resize</code> to force the size of the generated trees.</p>\n\n<p>To demonstrate that you can generate a pure list of trees, <em>i.e.</em>, <code>[Tree]</code> rather than <code>IO [Tree]</code>, we\u2019ll use a simple standin.</p>\n\n<pre><code>print_trees :: [Tree] -&gt; IO ()\nprint_trees = print\n</code></pre>\n\n<p>Ultimately, QuickCheck generators are random and therefore stateful, so generating them from your <code>main</code> action is an easy approach.</p>\n\n<pre><code>main :: IO ()\nmain = do\n  trees &lt;- sample' (resize 0 arbitrary)\n  print_trees $ take 1 trees\n  trees' &lt;- sample' (resize 1 arbitrary)\n  print_trees $ take 1 trees'\n  trees'' &lt;- sample' (resize 2 arbitrary)\n  print_trees $ take 2 trees''\n</code></pre>\n\n<p>Doing the work here is <code>sample'</code> that has type <code>Gen a -&gt; IO [a]</code>. That is, when run inside an <code>IO</code> action, <code>sample'</code> produces a list of whatever it is you want to generate, arbitrary trees in this case. The related function <code>sample</code> has type <code>Show a =&gt; Gen a -&gt; IO ()</code>, which means it goes ahead an prints the generated test data.</p>\n\n<p>The output of the above program after adding <code>deriving Show</code> to your definition of <code>Tree</code> is</p>\n\n<pre><code>[Empty]\n[Node Empty Empty]\n[Node (Node Empty Empty) Empty,Node Empty (Node Empty Empty)]\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6112831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qsXkq.jpg?s=128&g=1", "display_name": "paquechee", "link": "https://stackoverflow.com/users/6112831/paquechee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1549574346, "creation_date": 1548546459, "last_edit_date": 1548649336, "question_id": 54383876, "link": "https://stackoverflow.com/questions/54383876/create-random-data-from-custom-type", "title": "Create random data from custom type", "body": "<p>I have the following custom type defined</p>\n\n<pre><code>data Tree = Empty | Node Tree Tree\n</code></pre>\n\n<p>I want to create random <code>Tree</code>s with a given number of nodes <code>n</code> that I can then pass to another function which calculates the depth of the tree</p>\n\n<pre><code>depth :: Tree -&gt; Int\ndepth Empty = 0\ndepth Node t1 t2 = (maximum [depth t1, depth t2]) + 1\n</code></pre>\n\n<p>Which is the easiest way to achieve this?</p>\n\n<p>EDIT: I have tried with an approach similar to that of Alec in an answer below, which returns a random <code>IO Tree</code>. However, there are several other functions I need to pass this random <code>Tree</code>s to, over which I have no control. These require an argument of type <code>Tree</code>, not <code>IO Tree</code> so this solution doesn`t quite work for my purposes.</p>\n"}, {"tags": ["function", "haskell", "functional-programming"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1548539755, "post_id": 54383159, "comment_id": 95579186, "body": "<code>Int b</code> isn&#39;t a valid constraint, because <code>Int</code> is a type, not a type class."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 1, "creation_date": 1548539813, "post_id": 54383159, "comment_id": 95579192, "body": "A <code>C a =&gt;</code> does <i>not</i> mean that <code>a</code> is the <code>C</code> type, it means that <code>a</code> is an <i>instance</i> of the <code>C</code> <i>typeclass</i>. You can see typeclasses as a &quot;group of types&quot; that all implement a collection of functions (this is an oversimplification however)."}], "answers": [{"comments": [{"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 1, "creation_date": 1548539995, "post_id": 54383186, "comment_id": 95579235, "body": "A good way to discover this sort of thing is to just remove the type annotation and then inspect the inferred type."}, {"owner": {"reputation": 61, "user_id": 1925052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ltq1U.jpg?s=128&g=1", "display_name": "FabolousPotato", "link": "https://stackoverflow.com/users/1925052/fabolouspotato"}, "edited": false, "score": 0, "creation_date": 1548540184, "post_id": 54383186, "comment_id": 95579276, "body": "Thanks this helps!"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 5, "last_activity_date": 1548540000, "last_edit_date": 1548540000, "creation_date": 1548539874, "answer_id": 54383186, "question_id": 54383159, "link": "https://stackoverflow.com/questions/54383159/why-arent-those-two-expressions-equivalent-and-one-gives-an-error/54383186#54383186", "title": "Why aren&#39;t those two expressions equivalent and one gives an error?", "body": "<p><code>Int</code> is a type, not a type class, so <code>Int b</code> is not a valid constraint. What constraint <em>do</em> you need on <code>b</code>?</p>\n\n<ol>\n<li>You use <code>b</code> with both <code>&lt;=</code> and <code>&gt;=</code>, so <code>b</code> has to have an <code>Ord</code> constraint.</li>\n<li>You use <code>b - 1</code>, so <code>b</code> has to have a <code>Num</code> constraint.</li>\n</ol>\n\n<p>However, since <code>b-1</code> is the second argument to <code>(!!) :: [a] -&gt; Int -&gt; a</code>, you don't really have any leeway in what type <code>b</code> can be: <code>b - 1</code> has to be an <code>Int</code>, and so does <code>b</code>. Thus, the type should simply be</p>\n\n<pre><code>elementAt ::  [a] -&gt; Int -&gt; a\n</code></pre>\n\n<p>Since <code>Int</code> has both <code>Num</code> and <code>Ord</code> instances, the requirements listed above are satisfied.</p>\n"}], "owner": {"reputation": 61, "user_id": 1925052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ltq1U.jpg?s=128&g=1", "display_name": "FabolousPotato", "link": "https://stackoverflow.com/users/1925052/fabolouspotato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "closed_date": 1548544183, "answer_count": 1, "score": 0, "last_activity_date": 1548540000, "creation_date": 1548539677, "last_edit_date": 1548539855, "question_id": 54383159, "link": "https://stackoverflow.com/questions/54383159/why-arent-those-two-expressions-equivalent-and-one-gives-an-error", "closed_reason": "Duplicate", "title": "Why aren&#39;t those two expressions equivalent and one gives an error?", "body": "<pre><code>--Find kth element of list\nelementAt :: (Int b) =&gt; [a] -&gt; b -&gt; a\nelementAt a b = case a of [] -&gt; error \"Empty List\"\n                          a -&gt; if (length a) &lt;= b &amp;&amp; b&gt;=1 then a !! (b- 1) else error \"Wrong index\"\n</code></pre>\n\n<p>Gives an error <code>Expected kind -&gt; constraint but Int has kind *</code>.</p>\n\n<p>Compared to:</p>\n\n<pre><code>elementAt :: [a] -&gt; Int -&gt; a\nelementAt a b = case a of [] -&gt; error \"Empty List\"\n                          a -&gt; if (length a) &lt;= b &amp;&amp; b&gt;=1 then a !! (b- 1) else error \"Wrong index\"\n</code></pre>\n\n<p>Which doesn't give an error.\nWhy is that ?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 4, "creation_date": 1548523777, "post_id": 54380680, "comment_id": 95574998, "body": "<code>module</code> <i>defines</i> a module, and you are missing the <code>where</code> keyword, which produces the parse error."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 9, "last_activity_date": 1548522921, "creation_date": 1548522921, "answer_id": 54380733, "question_id": 54380680, "link": "https://stackoverflow.com/questions/54380680/importing-a-module-in-haskell-makes-the-code-not-compile/54380733#54380733", "title": "Importing a module in haskell makes the code not compile", "body": "<p><code>module</code> does not import modules; <code>import</code> does:</p>\n\n<pre><code>import Data.Char\n</code></pre>\n"}], "owner": {"reputation": 2876, "user_id": 716445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64e1926c8b065cd82ea46e3be38f97f4?s=128&d=identicon&r=PG", "display_name": "saeedn", "link": "https://stackoverflow.com/users/716445/saeedn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "closed_date": 1548538079, "accepted_answer_id": 54380733, "answer_count": 1, "score": -2, "last_activity_date": 1548522921, "creation_date": 1548522610, "question_id": 54380680, "link": "https://stackoverflow.com/questions/54380680/importing-a-module-in-haskell-makes-the-code-not-compile", "closed_reason": "Not suitable for this site", "title": "Importing a module in haskell makes the code not compile", "body": "<p>I wrote the following haskell code for test. It compiles fine with <code>ghc</code> (version 8.0.2), and prints 20, as expected.</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>f x = x * 2\n\nmain = print $ f 10\n</code></pre>\n\n<p>But when I import <code>Char</code> module like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>module Data.Char\n\nf x = x * 2\n\nmain = print $ f 10\n</code></pre>\n\n<p>it gives me this error: <code>test.hs:3:1: error: parse error on input \u2018f\u2019</code>.</p>\n\n<p>Does haskell change the environment when a module is imported? What is the difference and am I importing the module wrong?</p>\n"}, {"tags": ["haskell", "hakyll"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1548521484, "post_id": 54380492, "comment_id": 95574335, "body": "It probably nails down the type of <code>posts</code>."}, {"owner": {"reputation": 484, "user_id": 5587299, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/68b696bfe3bdb63c600cdf67bf2983e6?s=128&d=identicon&r=PG", "display_name": "aryndin", "link": "https://stackoverflow.com/users/5587299/aryndin"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1548522169, "post_id": 54380492, "comment_id": 95574542, "body": "@melpomene but type can&#39;t be changed since data is immutable in haskell, isn&#39;t it?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 3, "creation_date": 1548522861, "post_id": 54380492, "comment_id": 95574741, "body": "Consider <code>main = do { x &lt;- readLn; let { dummy = length &quot;hello&quot; + x }; return () }</code>. Without the <code>let</code>, the type of <code>x</code> is ambiguous."}], "owner": {"reputation": 484, "user_id": 5587299, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/68b696bfe3bdb63c600cdf67bf2983e6?s=128&d=identicon&r=PG", "display_name": "aryndin", "link": "https://stackoverflow.com/users/5587299/aryndin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1548521278, "creation_date": 1548521278, "question_id": 54380492, "link": "https://stackoverflow.com/questions/54380492/hakyll-snippet-doesnt-compile-when-let-statement-used", "title": "Hakyll snippet doesn&#39;t compile when let statement used", "body": "<p>I'm playing around with Hakyll and try to understand why it doesn't compile whet I use let statement in the following code snippet:</p>\n\n<pre><code>main :: IO ()\nmain = hakyll $ do\n   -- some other matches\n\n    match \"index.html\" $ do\n      route idRoute\n      compile $ do\n        posts &lt;- recentFirst =&lt;&lt; loadAll \"index.html\"\n        let indexCtx =\n              listField \"posts\" postCtx (return posts) &lt;&gt;\n              constField \"title\" \"Home\"                &lt;&gt;\n              defaultContext\n        getResourceBody\n          &gt;&gt;= applyAsTemplate defaultContext\n          &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n          &gt;&gt;= relativizeUrls\n</code></pre>\n\n<p>What do I try to do here is just to compile simple index.html template. And thing that seems strange to me is that it doesn't compile when I drop let statement. GHCi then starts to complain that:</p>\n\n<pre><code>    \u2022 No instance for (base-4.12.0.0:Data.Typeable.Internal.Typeable\n                         a0)\n        arising from a use of \u2018loadAll\u2019\n    \u2022 In the second argument of \u2018(=&lt;&lt;)\u2019, namely \u2018loadAll \"index.html\"\u2019\n      In a stmt of a 'do' block:\n        posts &lt;- recentFirst =&lt;&lt; loadAll \"index.html\"\n      In the second argument of \u2018($)\u2019, namely\n        \u2018do posts &lt;- recentFirst =&lt;&lt; loadAll \"index.html\"\n            getResourceBody &gt;&gt;= applyAsTemplate defaultContext\n              &gt;&gt;= loadAndApplyTemplate \"templates/default.html\" defaultContext\n              &gt;&gt;= relativizeUrls\u2019\n</code></pre>\n\n<p>As far as I know, let statement shouldn't infer to behavior in any ways since <code>indexCtx</code> is not even used elsewhere. </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1548513985, "post_id": 54379452, "comment_id": 95572340, "body": "You can make use of the <a href=\"https://ghc.haskell.org/trac/ghc/wiki/TypeApplication\" rel=\"nofollow noreferrer\"><code>TypeApplications</code> extension</a>, or specify the signature of <code>baz</code> when you use it."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 5, "creation_date": 1548514012, "post_id": 54379452, "comment_id": 95572343, "body": "<code>baz :: (X -&gt; Int, X -&gt; Int)</code>"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548514773, "post_id": 54379452, "comment_id": 95572571, "body": "@WillemVanOnsem - great, that seems to work, if you want to propose that as an answer."}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1548513866, "creation_date": 1548513866, "question_id": 54379452, "link": "https://stackoverflow.com/questions/54379452/is-it-possible-to-refer-to-a-specific-instance-function-in-haskell", "title": "Is it possible to refer to a specific instance function in Haskell?", "body": "<p>Given the following type class, I would like for some instance <code>Foo X</code>, to be able to refer to <code>baz</code> directly. Since <code>baz</code> doesn't (directly) take an argument of type <code>a</code>, I don't know how to do this. </p>\n\n<pre><code>class Foo a where\n  bar :: a -&gt; Int\n  baz :: (a -&gt; Int, a -&gt; Int)\n  baz =  ((\\x -&gt; 1), (\\x -&gt; 2))\n</code></pre>\n\n<p>I can easily do <code>bar x</code> if <code>x :: X</code>. But if I try to do a qualified import of the module that <code>Foo X</code> is in, call it <code>FooX</code>, and do <code>FooX.baz</code> I'll get a <code>Not in scope: FooX.baz</code> message.</p>\n"}, {"tags": ["haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 0, "creation_date": 1548524438, "post_id": 54380584, "comment_id": 95575187, "body": "This seems to work for a string like <code>abc</code> however it does not seem to work  in a specific context relating to <code>choice</code> and parsing for <code>macro</code>, and having an input such as <code>macabc</code>... Hmm perhaps better suited for a new question though.   The error is: ``` unexpected &quot;a&quot; expecting &quot;macro&quot; ```"}, {"owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "edited": false, "score": 2, "creation_date": 1548525613, "post_id": 54380584, "comment_id": 95575511, "body": "Nevermind it just seems like &#39;choice` does not backtrace. Thanks for the explanation!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 4, "last_activity_date": 1548521956, "creation_date": 1548521956, "answer_id": 54380584, "question_id": 54379342, "link": "https://stackoverflow.com/questions/54379342/parsec-negative-match/54380584#54380584", "title": "Parsec negative match", "body": "<p>You almost have it:</p>\n\n<pre><code>import Text.Parsec\nimport Text.Parsec.Char\nimport Text.Parsec.String\nimport Control.Monad\n\nparseIdent :: Parser (String)\nparseIdent = try $ do\n  x &lt;- many1 alphaNum\n  void $ optional endOfLine &lt;|&gt; eof\n  case x of\n    \"macro\" -&gt; fail \"illegal\"\n    _ -&gt; pure x\n</code></pre>\n\n<p>So, why didn't your code work?</p>\n\n<ul>\n<li>the <code>try</code> is in the wrong spot. The real backtracking piece here is backtracking after you've gotten back your alphanumeric word <em>and</em> checked it isn't <code>\"macro\"</code></li>\n<li><code>lookAhead</code> has no business here. If you end up with the word you wanted, you <em>do</em> want the word to be consumed from the input. <code>try</code> already takes care of resetting your input stream to its previous state</li>\n</ul>\n"}], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 54380584, "answer_count": 1, "score": 3, "last_activity_date": 1548521956, "creation_date": 1548513165, "question_id": 54379342, "link": "https://stackoverflow.com/questions/54379342/parsec-negative-match", "title": "Parsec negative match", "body": "<pre><code>parseIdent :: Parser (String)\nparseIdent = do\n  x &lt;- lookAhead $ try $ many1 (choice [alphaNum])\n  void $ optional endOfLine &lt;|&gt; eof\n  case x of\n    \"macro\" -&gt; fail \"illegal\"\n    _ -&gt; pure x\n</code></pre>\n\n<p>I'm trying to parse an alphanumeric string that only succeeds if it does not match a predetermined value (<code>macro</code> in this case).</p>\n\n<hr>\n\n<p>However the following is giving me an error of:</p>\n\n<pre><code>*** Exception: Text.ParserCombinators.Parsec.Prim.many: combinator 'many' is applied to a parser that accepts an empty string.\n</code></pre>\n\n<p>Which does not make sense, how does <code>many1 (choice [alphaNum])</code> accept an empty string?</p>\n\n<hr>\n\n<p>This error goes away if i remove the <code>lookAhead $ try</code>. But it 'fails' with <code>illegal</code>:</p>\n\n<pre><code>...\n*** Exception: (line 6, column 36):\nunexpected \" \"\nexpecting letter or digit or new-line\nillegal\n</code></pre>\n\n<hr>\n\n<p>Am I going about this correctly? Or is there another technique to implement a negative search?</p>\n"}, {"tags": ["haskell", "io-monad"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1548513666, "post_id": 54379258, "comment_id": 95572237, "body": "No danger. Just can&#39;t be done. <a href=\"https://stackoverflow.com/q/9243215/791604\">Possible duplicate.</a>"}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548523606, "post_id": 54379258, "comment_id": 95574951, "body": "What cannot be done? Having <code>IO a</code> in negative position? I might be wording the question incorrectly. I upvoted that answer as it helped me a bit but I couldn&#39;t understand it."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548524276, "post_id": 54379258, "comment_id": 95575143, "body": "No, generalizing a term which has a type that mentions <code>IO</code> in a negative position to a type that works for any <code>MonadIO</code> instance is what cannot be done."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548524400, "post_id": 54379258, "comment_id": 95575177, "body": "But I don&#39;t want to generalize. I want to keep <code>IO a</code> in negative position and I&#39;m asking why it seems to be discouraged."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548524869, "post_id": 54379258, "comment_id": 95575287, "body": "Nothing discouraged about that. You&#39;ve misunderstood the commentary."}], "answers": [{"comments": [{"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1548524287, "post_id": 54380856, "comment_id": 95575147, "body": "Suppose I don&#39;t want to generalize and keep <code>IO a</code>. So far, it seems that it can do things that <code>MonadIO</code> version cannot. Why is that important?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1548524405, "post_id": 54380856, "comment_id": 95575179, "body": "@sevo I&#39;m not sure I understand. &quot;it seems that it can do things that MonadIO version cannot&quot; sounds like you are comparing to something that <i>is</i> generalized. Do you have a more concrete example in mind?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 1, "creation_date": 1548524972, "post_id": 54380856, "comment_id": 95575320, "body": "@sevo I think i understand now: using <code>IO a</code> in a negative position is <i>not</i> discouraged. Snoyman and Kmett both care about writing code that works over monad transformers, so they care about being able to write the generalized versions of functions, and that isn&#39;t really possible without some stronger abstraction than <code>MonadIO</code>."}, {"owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 0, "creation_date": 1548526606, "post_id": 54380856, "comment_id": 95575762, "body": "That makes sense! But! Are we opting for less general abstraction because of language deficiency or because it&#39;s the right thing to do? Snoyman seems to argue for the latter."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "edited": false, "score": 1, "creation_date": 1548526813, "post_id": 54380856, "comment_id": 95575819, "body": "@sevo Bit of both. Here&#39;s <a href=\"https://www.reddit.com/r/haskell/comments/67tc1w/monadio_vs_monadbase_io_in_library_apis/dgt5eiu/\" rel=\"nofollow noreferrer\">Snoyman laying it out</a>. <code>MonadBaseControl</code> uses type families and multi parameter type classes. <code>MonadIO</code> is plain old Haskell98."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": true, "score": 3, "last_activity_date": 1548523757, "creation_date": 1548523757, "answer_id": 54380856, "question_id": 54379258, "link": "https://stackoverflow.com/questions/54379258/can-io-action-in-negative-position-give-unexpected-results/54380856#54380856", "title": "Can IO action in negative position give unexpected results?", "body": "<blockquote>\n  <p>Is there danger in such functions that programmers should know about? </p>\n</blockquote>\n\n<p>There is not danger. Quite the opposite, the point Snoyman and Kmett are making is that <code>Monad IO</code> doesn't let you lift through things with <code>IO</code> in a negative positive.</p>\n\n<p>Suppose you want to generalize <code>putStrLn :: String -&gt; IO ()</code>. You can, because the <code>IO</code> is in a positive position:</p>\n\n<pre><code>putStrLn' :: MonadIO m =&gt; String -&gt; m ()\nputStrLn' str = liftIO (putStrLn str)\n</code></pre>\n\n<p>Now, suppose you want to generalize <code>handle :: Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a</code>. You can't (at least not with just <code>MonadIO</code>):</p>\n\n<pre><code>handle' :: (MonadIO m, Exception e) =&gt; (e -&gt; m a) -&gt; m a -&gt; m a\nhandle' handler act = liftIO (handle (handler . unliftIO) (unliftIO act))\n\nunliftIO :: MonadIO m =&gt; m a -&gt; IO a\nunliftIO = error \"MonadIO isn't powerful enough to make this implementable!\"\n</code></pre>\n\n<p>You need something more. If you're curious about how you'd do that, take a look at the implementation of functions in <code>lifted-base</code>. For instance: <a href=\"https://hackage.haskell.org/package/lifted-base-0.2.3.12/docs/Control-Exception-Lifted.html#v:handle\" rel=\"nofollow noreferrer\"><code>handle :: (MonadBaseControl IO m, Exception e) =&gt; (e -&gt; m a) -&gt; m a -&gt; m a</code></a>.</p>\n"}], "owner": {"reputation": 4471, "user_id": 3858142, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4c27dead2edf0b6dc28833a694c42ba1?s=128&d=identicon&r=PG&f=1", "display_name": "sevo", "link": "https://stackoverflow.com/users/3858142/sevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 54380856, "answer_count": 1, "score": 2, "last_activity_date": 1548523757, "creation_date": 1548512607, "question_id": 54379258, "link": "https://stackoverflow.com/questions/54379258/can-io-action-in-negative-position-give-unexpected-results", "title": "Can IO action in negative position give unexpected results?", "body": "<p>There seems to be some undocumented knowledge about the difference between <code>Monad IO</code> and <code>IO</code>. Remarks <a href=\"https://www.yesodweb.com/blog/2016/03/why-i-prefer-typeclass-based-libraries\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://old.reddit.com/r/haskell/comments/1jjkbr/is_there_any_reason_to_use_io_over_monadio_m_m/cbfq50q/\" rel=\"nofollow noreferrer\">here</a>) hint that <code>IO a</code> can be used in negative position but may have unintended consequences:</p>\n\n<p>Citing Snoyman <a href=\"https://www.yesodweb.com/blog/2016/03/why-i-prefer-typeclass-based-libraries\" rel=\"nofollow noreferrer\">1</a>:</p>\n\n<blockquote>\n  <p>However, we know that some control flows (such as exception handling)\n  are not being used, since they are not compatible with MonadIO.\n  (Reason: MonadIO requires that the IO be in positive, not negative,\n  position.) This lets us know, for example, that foo is safe to use in\n  a continuation-based monad like ContT or Conduit.</p>\n</blockquote>\n\n<p>And Kmett <a href=\"https://old.reddit.com/r/haskell/comments/1jjkbr/is_there_any_reason_to_use_io_over_monadio_m_m/cbfq50q/\" rel=\"nofollow noreferrer\">2</a>:</p>\n\n<blockquote>\n  <p>I tend to export functions with a MonadIO constraint... whenever it\n  doesn't have to take an IO-like action in negative position (as an\n  argument).</p>\n  \n  <p>When my code does have to take another monadic action as an argument,\n  then I usually have to stop and think about it.</p>\n</blockquote>\n\n<p>Is there danger in such functions that programmers should know about? </p>\n\n<p>Does it for example mean that running arbitrary continuation-based action may redefine control flow giving unexpected results in ways that <code>Monad IO</code> based interface are safe from?</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548514595, "post_id": 54378823, "comment_id": 95572523, "body": "@chepner thanks, fixed, i think"}, {"owner": {"reputation": 249, "user_id": 4376453, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-LvhFFca8O_8/AAAAAAAAAAI/AAAAAAAAAFo/11B5JshO4o4/photo.jpg?sz=128", "display_name": "Eliza Brandt", "link": "https://stackoverflow.com/users/4376453/eliza-brandt"}, "edited": false, "score": 0, "creation_date": 1548528464, "post_id": 54378823, "comment_id": 95576312, "body": "if you want a generalization, you&#39;d need heterogenous lists, assuming you have <code>(a -&gt; b_1, a -&gt; b_2..., a -&gt; b_n) -&gt; a -&gt; (b_1, b_2,.., b_n)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 8, "last_activity_date": 1548509757, "creation_date": 1548509757, "answer_id": 54378874, "question_id": 54378823, "link": "https://stackoverflow.com/questions/54378823/how-to-create-an-fmap-that-can-take-a-tuple-of-functions-instead-of-just-a-singl/54378874#54378874", "title": "How to create an fmap that can take a tuple of functions instead of just a single function?", "body": "<p>You could use <code>uncurry (&amp;&amp;&amp;)</code>, as follows:</p>\n\n<pre><code>&gt; import Control.Arrow\n&gt; f :: Int-&gt;Int ; f x = 2*x\n&gt; g :: Int-&gt;String ; g x = show x\n&gt; h = (f, g)\n&gt; uncurry (&amp;&amp;&amp;) h 5\n(10,\"5\")\n</code></pre>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 54378874, "answer_count": 1, "score": 1, "last_activity_date": 1548514581, "creation_date": 1548509364, "last_edit_date": 1548514581, "question_id": 54378823, "link": "https://stackoverflow.com/questions/54378823/how-to-create-an-fmap-that-can-take-a-tuple-of-functions-instead-of-just-a-singl", "title": "How to create an fmap that can take a tuple of functions instead of just a single function?", "body": "<p>This could be a way of constructing</p>\n\n<p>Is there a (ideally standard) way of accomplishing </p>\n\n<pre><code> f :: Int -&gt; Int\n f x = 2*x\n g :: Int -&gt; String\n g x = show x\n h = (f, g)\n fmap h 5 -- results in: (10, \"5\")\n</code></pre>\n\n<p>In general, for functions going from A->T_i for some variable types T_i and a fixed type A, I think this would just be a simplification of a <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Bifunctor.html\" rel=\"nofollow noreferrer\">BiFunctor</a>, at lease for a 2-tuple of 1-argument functions - it would be great to see a generalization going beyond 2-tuples.</p>\n"}, {"tags": ["haskell", "binary", "decimal"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1548503537, "post_id": 54378081, "comment_id": 95569731, "body": "Please don&#39;t use <code>do</code>&#39;s. <code>do</code>s are used for monads. Although lists are instances of the <code>Monad</code> typeclass, here these are <i>not</i> necessary. Another problem is that you use <code>n&#47;2</code> which means that <code>n</code> should be <code>Fractional</code>, to perform integer division, use <code>div</code>."}, {"owner": {"reputation": 49, "user_id": 10693224, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N_a1QX2Y-sk/AAAAAAAAAAI/AAAAAAAAADY/UN58W7nkt4I/photo.jpg?sz=128", "display_name": "disccco", "link": "https://stackoverflow.com/users/10693224/disccco"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548503848, "post_id": 54378081, "comment_id": 95569799, "body": "So this would be fine without do as well?"}, {"owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "edited": false, "score": 0, "creation_date": 1548503964, "post_id": 54378081, "comment_id": 95569825, "body": "<code>do</code> for lists is OK. Not ok is using <code>do</code> for single expressions, it is totally redundant"}, {"owner": {"reputation": 22266, "user_id": 649287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0ea0055b84020bf860c05f53ba53d5?s=128&d=identicon&r=PG", "display_name": "augustss", "link": "https://stackoverflow.com/users/649287/augustss"}, "edited": false, "score": 1, "creation_date": 1548507220, "post_id": 54378081, "comment_id": 95570606, "body": "Please don\u2019t call it decimal-to-binary.  There\u2019s nothing decimal specific here."}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 10693224, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N_a1QX2Y-sk/AAAAAAAAAAI/AAAAAAAAADY/UN58W7nkt4I/photo.jpg?sz=128", "display_name": "disccco", "link": "https://stackoverflow.com/users/10693224/disccco"}, "edited": false, "score": 0, "creation_date": 1548506429, "post_id": 54378169, "comment_id": 95570400, "body": "The result of the first and last function is 1,0,1,1,0 for the input 13 what is not 1101."}, {"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "reply_to_user": {"reputation": 49, "user_id": 10693224, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N_a1QX2Y-sk/AAAAAAAAAAI/AAAAAAAAADY/UN58W7nkt4I/photo.jpg?sz=128", "display_name": "disccco", "link": "https://stackoverflow.com/users/10693224/disccco"}, "edited": false, "score": 0, "creation_date": 1548506664, "post_id": 54378169, "comment_id": 95570446, "body": "@disccco: for reasons mentioned in the answer: because your function (both in Java and Haskell if we correct it), produces a binary representation where the <i>most</i> significant bit is positioned as last element. The last solution however, reverses that (which is a more natural way to write it). But this is a bit related to <i>big endian</i> vs <i>little endian</i>."}], "tags": [], "owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "is_accepted": false, "score": 8, "last_activity_date": 1548504227, "creation_date": 1548504227, "answer_id": 54378169, "question_id": 54378081, "link": "https://stackoverflow.com/questions/54378081/haskell-decimal-to-binary/54378169#54378169", "title": "Haskell Decimal to Binary", "body": "<p>There are some problems with your solution. First of all, I advise <em>not</em> to use <code>do</code> <em>at all</em>, until you understand what <code>do</code> does. Here we do not need <code>do</code> at all.</p>\n\n<blockquote>\n  <p>Unfortunately other than in java it is not possible to divide an int by two in haskell.</p>\n</blockquote>\n\n<p>It actually is, but the <code>/</code> operator (which is in fact the <code>(/)</code> function), has type <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:-47-\" rel=\"noreferrer\"><strong><code>(/) :: Fractional a =&gt; a -&gt; a -&gt; a</code></strong></a>. An <code>Int</code> is not <code>Fractional</code>. You can perform integer division with <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:div\" rel=\"noreferrer\"><strong><code>div :: Integral a =&gt; a -&gt; a -&gt; a</code></strong></a>.</p>\n\n<p>So then the code looks like:</p>\n\n<pre><code>fromDecimal :: Int -&gt; [Int]\nfromDecimal 0 = [0]\nfromDecimal n = if (mod n 2 == 0) then 0:fromDecimal (<b>div</b> n 2) else 1:fromDecimal (<b>div</b> n 2)</code></pre>\n\n<p>But we can definitely make this more elegant. <code>mod n 2</code> can only result in two outcomes: <code>0</code> and <code>1</code>, and these are exactly the ones that we use at the left side of the <code>(:)</code> operator.</p>\n\n<p>So we do not need to use an <code>if</code>-<code>then</code>-<code>else</code> at all:</p>\n\n<pre><code>fromDecimal :: Int -&gt; [Int]\nfromDecimal 0 = [0]\nfromDecimal n = <b>mod n 2</b> : fromDecimal (div n 2)</code></pre>\n\n<p>Likely this is still not exactly what you want: here we write the binary value such that the last element, is the most significant one. This function will add a <em>tailing</em> zero, which does not make a semantical difference (due to that order), but it is not elegant either.</p>\n\n<p>We can define an function <code>go</code> that omits this zero, if the given value is not zero, like:</p>\n\n<pre><code>fromDecimal :: Int -&gt; [Int]\nfromDecimal 0 = [0]\nfromDecimal n = go n\n    where go 0 = []\n          go k = mod k 2 : go (div k 2)</code></pre>\n\n<p>If we however want to write the most significant bit first (so in the same order as we write decimal numbers), then we have to reverse the outcome. We can do this by making use of an <em>accumulator</em>:</p>\n\n<pre><code>fromDecimal :: Int -&gt; [Int]\nfromDecimal 0 = [0]\nfromDecimal n = go n []\n    where go 0 r = r\n          go k rs = go (div k 2) (mod k 2:rs)</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "is_accepted": false, "score": 4, "last_activity_date": 1548504523, "creation_date": 1548504523, "answer_id": 54378209, "question_id": 54378081, "link": "https://stackoverflow.com/questions/54378081/haskell-decimal-to-binary/54378209#54378209", "title": "Haskell Decimal to Binary", "body": "<p>You cannot <code>/</code> integers in Haskell \u2013 division is not defined in terms of integral numbers! For integral division use <code>div</code> function, but in your case more suitable would be <code>divMod</code> that comes with <code>mod</code> gratis.</p>\n\n<p>Also, you are going to get reversed output, so you can <code>reverse</code> manually it after that, or use more memory-efficient version with accumulator:</p>\n\n<pre><code>decToBin :: Int -&gt; [Int]\ndecToBin = go [] where\n   go acc 0 = acc\n   go acc n = let (d, m) = n `divMod` 2 in go (m : acc) d\n</code></pre>\n\n<p><code>go</code> will give you an empty list for <code>0</code>. You may add it manually if the list is empty:</p>\n\n<pre><code>decToBin = (\\l -&gt; if null l then [0] else l) . go [] where ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 120535, "user_id": 123109, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/157c96de3d125abc1c363ff25c20dfaf?s=128&d=identicon&r=PG", "display_name": "Greg Bacon", "link": "https://stackoverflow.com/users/123109/greg-bacon"}, "is_accepted": false, "score": 1, "last_activity_date": 1548695877, "creation_date": 1548695877, "answer_id": 54407158, "question_id": 54378081, "link": "https://stackoverflow.com/questions/54378081/haskell-decimal-to-binary/54407158#54407158", "title": "Haskell Decimal to Binary", "body": "<p>Think through how your algorithm will work. It starts from 2\u2070, so it will generate bits backward from how we ordinarily think of them, i.e., least-significant bit first. Your algorithm can represent non-negative binary integers only.</p>\n\n<pre><code>fromDecimal :: Int -&gt; [Int]\nfromDecimal d | d &lt; 0     = error \"Must be non-negative\"\n              | d == 0    = [0]\n              | otherwise = reverse (go d)\n  where go 0 = []\n        go d = d `rem` 2 : go (d `div` 2)\n</code></pre>\n\n<p>In Haskell, when we generate a list in reverse, go ahead and do so but then <code>reverse</code> the result at the end. The reason for this is consing up a list (gluing new items at the head with <code>:</code>) has a constant cost and the <code>reverse</code> at the end has a linear cost \u2014 but appending with <code>++</code> has a quadratic cost.</p>\n\n<p>Common Haskell style is to have a private inner loop named <code>go</code> that the outer function applies when it\u2019s happy with its arguments. The base case is to terminate with the empty list when <code>d</code> reaches zero. Otherwise, we take the current remainder modulo 2 and then proceed with <code>d</code> halved and truncated.</p>\n\n<p>Without the special case for zero, <code>fromDecimal 0</code> would be the empty list rather than <code>[0]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 570, "user_id": 3295004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IGNvT.jpg?s=128&g=1", "display_name": "fp_mora", "link": "https://stackoverflow.com/users/3295004/fp-mora"}, "is_accepted": false, "score": 1, "last_activity_date": 1549212807, "last_edit_date": 1549212807, "creation_date": 1548717033, "answer_id": 54411614, "question_id": 54378081, "link": "https://stackoverflow.com/questions/54378081/haskell-decimal-to-binary/54411614#54411614", "title": "Haskell Decimal to Binary", "body": "<p>The binary numbers are usually strings and not really used in calculations.\nStrings are also less complicated.</p>\n\n<p>The pattern of binary numbers is like any other. It repeats but at a faster clip.\nOnly a small set is necessary to generate up to 256 (0-255) binary numbers.\nThe pattern can systematically be expanded for more.\nThe starting pattern is 4, 0-3</p>\n\n<pre><code>bd = [\"00\",\"01\",\"10\",\"11\"]\n</code></pre>\n\n<p>The function to combine them into larger numbers is</p>\n\n<pre><code>d2b n = head.drop n $ [ d++e++f++g | d &lt;- bd, e &lt;- bd, f &lt;- bd, g &lt;- bd]\n\nd2b 125\n</code></pre>\n\n<p>\"01111101\"</p>\n\n<p>If it's not obvious how to expand, then</p>\n\n<pre><code>bd = [\"000\",\"001\",\"010\",\"011\",\"100\",\"101\",\"110\",\"111\"]\n</code></pre>\n\n<p>Will give you up to 4096 binary digits (0-4095). All else stays the same.</p>\n\n<p>If it's not obvious, the <code>db2</code> function uses 4 pairs of binary numbers so 4 of the set. (2^8) - 1 or (2^12) - 1 is how many you get.</p>\n\n<p>By the way, list comprehension are sugar coated <code>do</code> structures.</p>\n\n<p>Generate the above patterns with</p>\n\n<pre><code>[ a++b | a &lt;- [\"0\",\"1\"], b &lt;- [\"0\",\"1\"] ]\n</code></pre>\n\n<p>[\"00\",\"01\",\"10\",\"11\"]</p>\n\n<p>and</p>\n\n<pre><code>[ a++b++c | a &lt;- [\"0\",\"1\"], b &lt;- [\"0\",\"1\"], c &lt;- [\"0\",\"1\"] ]\n</code></pre>\n\n<p>[\"000\",\"001\",\"010\",\"011\",\"100\",\"101\",\"110\",\"111\"]</p>\n\n<p>More generally, one pattern and one function may serve the purpose</p>\n\n<pre><code>b2 = [\"0\",\"1\"]\nb4 = [ a++b++c++d | a &lt;- b2, b &lt;- b2, c &lt;- b2, d &lt;- b2]\nb4\n</code></pre>\n\n<p>[\"0000\",\"0001\",\"0010\",\"0011\",\"0100\",\"0101\",\"0110\",\"0111\",\"1000\",\"1001\",\"1010\",\"1011\",\"1100\",\"1101\",\"1110\",\"1111\"]</p>\n\n<pre><code>bb n = head.drop n $ [ a++b++c++d | a &lt;- b4, b &lt;- b4, c &lt;- b4, d &lt;- b4]\nbb 32768\n</code></pre>\n\n<p>\"1000000000000000\"</p>\n\n<pre><code>bb 65535\n</code></pre>\n\n<p>\"1111111111111111\"</p>\n\n<p>To calculate binary from decimal directly in Haskell using subtraction</p>\n\n<pre><code>cvtd n (x:xs) | x&gt;n  = 0:(cvtd  n xs)\n              | n&gt;x  = 1:(cvtd (n-x) xs)\n              | True = 1:[0|f&lt;-xs]\n</code></pre>\n\n<p>Use any number of bits you want, for example 10 bits.</p>\n\n<pre><code>cvtd 639 [2^e|e&lt;-[9,8..0]]\n</code></pre>\n\n<p>[1,0,0,1,1,1,1,1,1,1]</p>\n"}, {"comments": [{"owner": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "edited": false, "score": 2, "creation_date": 1576679134, "post_id": 59393493, "comment_id": 104977449, "body": "Welcome to Stack Overflow. It would be helpful if you could explain why your code would solve the problem."}, {"owner": {"reputation": 1, "user_id": 12559102, "user_type": "registered", "profile_image": "https://graph.facebook.com/2866014413431280/picture?type=large", "display_name": "\u0410\u043b\u0435\u043a\u0441\u0435\u0439 \u0421\u043e\u043b\u043e\u043c\u0438\u043d", "link": "https://stackoverflow.com/users/12559102/%d0%90%d0%bb%d0%b5%d0%ba%d1%81%d0%b5%d0%b9-%d0%a1%d0%be%d0%bb%d0%be%d0%bc%d0%b8%d0%bd"}, "reply_to_user": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "edited": false, "score": 0, "creation_date": 1576786794, "post_id": 59393493, "comment_id": 105020162, "body": "Hi, @AdrianMole! I use divMod with unfoldr (from Data.List) for get sequence mods from divide begin value on 2,  binstr for convert number to char and reverse for get correct result (from beginning he getting as backward)."}, {"owner": {"reputation": 1, "user_id": 12559102, "user_type": "registered", "profile_image": "https://graph.facebook.com/2866014413431280/picture?type=large", "display_name": "\u0410\u043b\u0435\u043a\u0441\u0435\u0439 \u0421\u043e\u043b\u043e\u043c\u0438\u043d", "link": "https://stackoverflow.com/users/12559102/%d0%90%d0%bb%d0%b5%d0%ba%d1%81%d0%b5%d0%b9-%d0%a1%d0%be%d0%bb%d0%be%d0%bc%d0%b8%d0%bd"}, "reply_to_user": {"reputation": 29641, "user_id": 10871073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ddBW9.png?s=128&g=1", "display_name": "Adrian Mole", "link": "https://stackoverflow.com/users/10871073/adrian-mole"}, "edited": false, "score": 0, "creation_date": 1576787604, "post_id": 59393493, "comment_id": 105020460, "body": "For example: divMod 125 2 -&gt; (62,1) divMod 62 2 -&gt; (31,0) divMod 31 2 -&gt; (15,1) divMod 15 2 -&gt; (7,1) divMod 7 2 -&gt; (3,1) divMod 3 2 -&gt; (1,1) divMod 1 2 -&gt; (0,1) 0 as answer - &gt; exit from cycle. For cycle creat i use function unfoldr which decompose begin value (See unfoldr in Data.List)."}], "tags": [], "owner": {"reputation": 1, "user_id": 12559102, "user_type": "registered", "profile_image": "https://graph.facebook.com/2866014413431280/picture?type=large", "display_name": "\u0410\u043b\u0435\u043a\u0441\u0435\u0439 \u0421\u043e\u043b\u043e\u043c\u0438\u043d", "link": "https://stackoverflow.com/users/12559102/%d0%90%d0%bb%d0%b5%d0%ba%d1%81%d0%b5%d0%b9-%d0%a1%d0%be%d0%bb%d0%be%d0%bc%d0%b8%d0%bd"}, "is_accepted": false, "score": 0, "last_activity_date": 1576677116, "creation_date": 1576677116, "answer_id": 59393493, "question_id": 54378081, "link": "https://stackoverflow.com/questions/54378081/haskell-decimal-to-binary/59393493#59393493", "title": "Haskell Decimal to Binary", "body": "<pre>\nimport Data.List\n\n\ndec2bin x =\n  reverse $ binstr $ unfoldr ndiv x\n  where\n    binstr = map (\\x -> \"01\" !! x)\n    exch (a,b) = (b,a)\n    ndiv n =\n      case n of\n        0 -> Nothing\n        _ -> Just $ exch $ divMod n 2\n</pre>\n"}], "owner": {"reputation": 49, "user_id": 10693224, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N_a1QX2Y-sk/AAAAAAAAAAI/AAAAAAAAADY/UN58W7nkt4I/photo.jpg?sz=128", "display_name": "disccco", "link": "https://stackoverflow.com/users/10693224/disccco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2460, "favorite_count": 0, "answer_count": 5, "score": 4, "last_activity_date": 1576677116, "creation_date": 1548503339, "last_edit_date": 1548503827, "question_id": 54378081, "link": "https://stackoverflow.com/questions/54378081/haskell-decimal-to-binary", "title": "Haskell Decimal to Binary", "body": "<p>I am trying to build  a function that converts a Decimal(Int) into a Binary number.\nUnfortunately other than in java it is not possible to divide an int by two in haskell.\nI am very new to functional programming so the problem could be something trivial.\nSo far I could not find another solution to this problem but \nhere is my first try :</p>\n\n<pre><code> fromDecimal :: Int -&gt; [Int]\n\nfromDecimal 0 = [0]\nfromDecimal n = if (mod n 2 == 0) then \n                do\n\n                0:fromDecimal(n/2) \n\n                else \n                do  \n                1:fromDecimal(n/2) \n</code></pre>\n\n<p>I got an java implementation here which I did before : </p>\n\n<pre><code>   public void fromDecimal(int decimal){\n    for (int i=0;i&lt;values.length;i++){\n\n        if(decimal % 2 = 0)\n        values[i]=true ; \n        decimal = decimal/ 2;\n        else {values[i]= false;\n        }       }\n}\n</code></pre>\n\n<p>Hopefully this is going to help to find a solution!</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers", "reader-monad", "st-monad"], "answers": [{"tags": [], "owner": {"reputation": 24509, "user_id": 6863749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UyoQv.jpg?s=128&g=1", "display_name": "Li-yao Xia", "link": "https://stackoverflow.com/users/6863749/li-yao-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1548506948, "creation_date": 1548506948, "answer_id": 54378494, "question_id": 54378041, "link": "https://stackoverflow.com/questions/54378041/modify-st-dependent-environment-in-readert-problem-with-local-function/54378494#54378494", "title": "Modify ST dependent environment in ReaderT \u2013&#160;problem with `local` function", "body": "<p>The scope parameter <code>s</code> of <code>ST</code> should remain outside:</p>\n\n<pre><code>newtype Comp s a = Comp (ReaderT (Env s) (ST s) a)\n</code></pre>\n\n<p>The only place where you need a higher-rank type is when calling <code>runST</code>.</p>\n\n<pre><code>runComp :: (forall s. Comp s a) -&gt; a\nrunComp = runST $ do\n  ds &lt;- HT.new\n  runReaderT c (Env ds empty)\n</code></pre>\n\n<p>Everywhere else you can simply be parametric in <code>s</code>.</p>\n\n<pre><code>doStuff :: Comp s Bool\ndoMoreStuff :: Comp s Int\n</code></pre>\n\n<p>Then the <code>MonadReader</code> instance can be written:</p>\n\n<pre><code>instance MonadReader (Env s) (Comp s) where\n  ...\n</code></pre>\n"}], "owner": {"reputation": 4072, "user_id": 4400060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9g6QZ.png?s=128&g=1", "display_name": "radrow", "link": "https://stackoverflow.com/users/4400060/radrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1548506948, "creation_date": 1548502896, "question_id": 54378041, "link": "https://stackoverflow.com/questions/54378041/modify-st-dependent-environment-in-readert-problem-with-local-function", "title": "Modify ST dependent environment in ReaderT \u2013&#160;problem with `local` function", "body": "<p>This question is a sequel of this thread: <a href=\"https://stackoverflow.com/a/54317095/4400060\">https://stackoverflow.com/a/54317095/4400060</a></p>\n\n<p>I was asking there about carrying <code>STRef</code> in <code>ReaderT</code>'s environment and performing ST-actions under it. My setup now looks like:</p>\n\n<pre><code>import Data.HashTable.ST.Cuckoo as HT\n\n-- |Environment for Comp\nnewtype Env s = Env { dataspace :: HashTable s Int Data\n                    , namespace :: Map Name Int }\n\n-- |Main computation monad\nnewtype Comp a = Comp (forall s. ReaderT (Env s) (ST s) a)\n\n\n-- |Evaluate computation\nrunComp (Comp c) = runST $ do\n    ds &lt;- HT.new\n    runReaderT c (Env ds empty)\n\n\n-- |Perform an action on `dataspace` hashmap\nonDataspace :: (forall s. HashTable s Int Data -&gt; ST s a) -&gt; Comp a\nonDataspace f = Comp $ asks dataspace &gt;&gt;= lift . f\n</code></pre>\n\n<p>And it works cool in general \u2013 I can access or modify <code>dataspace</code> in place freely. However, when I have added immutable <code>namespace</code> I started to struggle. Feature I need is running <code>Comp</code> action with updated <code>namespace</code> in the way that it won't affect further computations' namespaces \u2013 exactly what <code>local</code> does.</p>\n\n<p>First of all I wanted to write <code>MonadReader</code> instance for <code>Comp</code>, however I faced the <code>ST</code>'s phantom type and got <code>illegal instance</code> error:</p>\n\n<pre><code>instance MonadReader (Env s) Comp where {}\ninstance MonadReader (forall s. Env s) Comp where {}\ninstance forall s. MonadReader (Env s) Comp where {}\n</code></pre>\n\n<p>Full error message:</p>\n\n<pre><code>Illegal instance declaration for\n     \u2018MonadReader (EvalEnv s) Evaluator\u2019\n     The coverage condition fails in class \u2018MonadReader\u2019\n       for functional dependency: \u2018m -&gt; r\u2019\n     Reason: lhs type \u2018Evaluator\u2019\n       does not determine rhs type \u2018EvalEnv s\u2019\n     Un-determined variable: s\n</code></pre>\n\n<p>I understand this error, but I see no way bypassing it. To be honest I don't really require full <code>local</code> function. I only need to be able to run <code>Comp</code> with different <code>namespace</code>, but same <code>dataspace</code>.</p>\n\n<p>The best solution would be to provide full <code>MonadReader</code> instance. I am aware that it might not be possible, so as a workaround I would like to have a function</p>\n\n<pre><code>withNs :: Map Name Int -&gt; Comp a -&gt; Comp a\n</code></pre>\n\n<hr>\n\n<p>Summarizing: I want to be able to run <code>Comp</code> with modified <code>namespace</code> while leaving <code>dataspace</code> unchanged as a reference keeping all changes under it.</p>\n\n<p>How to do that? I can accept modifying my initial setup if needed. </p>\n"}, {"tags": ["haskell", "combinatory-logic"], "comments": [{"owner": {"reputation": 19084, "user_id": 1482749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff9982206dde8c2bbb151a7305c00f3?s=128&d=identicon&r=PG", "display_name": "kosmikus", "link": "https://stackoverflow.com/users/1482749/kosmikus"}, "edited": false, "score": 3, "creation_date": 1548487744, "post_id": 54376342, "comment_id": 95566853, "body": "I don&#39;t understand the question. With your definition, e.g. <code>eval (App (App I I) I)</code> yields <code>I</code> and not <code>App (App I I) I</code> ... So how do you get the idea that the <code>App x y</code> case doesn&#39;t do anything?"}, {"owner": {"reputation": 188, "user_id": 5772563, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DVfEl50m8KI/AAAAAAAAAAI/AAAAAAAAADk/gmX7V01d4u8/photo.jpg?sz=128", "display_name": "Adrian Legaspi", "link": "https://stackoverflow.com/users/5772563/adrian-legaspi"}, "edited": false, "score": 1, "creation_date": 1548493482, "post_id": 54376342, "comment_id": 95567812, "body": "This doesn&#39;t seem redundant to me since there are different cases for <code>App</code> to be matched on and thus identifying all of them and extracting the needed data for processing."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 3, "creation_date": 1548495470, "post_id": 54376342, "comment_id": 95568154, "body": "you should include your data types definition(s) and some sample expressions."}, {"owner": {"reputation": 175, "user_id": 10832310, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BTRsOLhbuYY/AAAAAAAAAAI/AAAAAAAAAAA/sZXLwRw5JZ0/photo.jpg?sz=128", "display_name": "Jung", "link": "https://stackoverflow.com/users/10832310/jung"}, "edited": false, "score": 0, "creation_date": 1548518883, "post_id": 54376342, "comment_id": 95573649, "body": "sorry you are right . `data Expr = App Expr Expr | S | K | I | Var String | Lam String Expr deriving (Show,Eq)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1549441616, "post_id": 54376342, "comment_id": 95898723, "body": "I didn&#39;t see that you made the edit. Only saw it now by chance. BTW on SO we can use @ to notify someone. you type @, then type first letter of their name, and SO suggests matching names; then you press tab for completion. :)"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1549442740, "post_id": 54376342, "comment_id": 95899243, "body": "why do you have <code>Lam</code> terms at all? the whole point of SKI calculus is not to have named variables at all. are you treating them as values?"}], "owner": {"reputation": 175, "user_id": 10832310, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BTRsOLhbuYY/AAAAAAAAAAI/AAAAAAAAAAA/sZXLwRw5JZ0/photo.jpg?sz=128", "display_name": "Jung", "link": "https://stackoverflow.com/users/10832310/jung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1548522158, "creation_date": 1548485912, "last_edit_date": 1548522158, "question_id": 54376342, "link": "https://stackoverflow.com/questions/54376342/understanding-the-eval-function-used-to-define-combinators-and-expression-lambd", "title": "Understanding the eval function used to define combinators and expression (Lambda) in Haskell", "body": "<p>I find the use of pattern matching for <code>eval (App x y)</code> redundant since both cases would return <code>App x y</code>. I wonder if <code>eval (App x y)</code> is needed at all because we have <code>eval x = x</code> at the end, which should also include <code>eval (App x y)</code></p>\n\n<pre><code>data Expr = App Expr Expr | S | K | I | Var String | Lam String Expr deriving (Show,Eq)\neval :: Exp -&gt; Exp\neval (App I x) = eval x \neval (App (App K x) y) = eval x\neval (App (App (App S f) g) x) = eval (App (App f x) (App g x))\neval (App x y)\n | evalx == x  = (App evalx (eval y)) --test if x is a Lam (not other possible values of Exp)\n | otherwise = eval (App evalx y)\n     where evalx = eval x\neval (Var x) = (Var x)\neval x = x  \n</code></pre>\n"}, {"tags": ["haskell", "functional-programming", "lambda-calculus", "combinatory-logic"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1548475638, "post_id": 54375546, "comment_id": 95565365, "body": "Perhaps one place to start is to work out what types they have to have.  It turns out that for the expression to make sense, they have to have polymorphic types, which can tell you a lot about possible implementations."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 4, "creation_date": 1548475645, "post_id": 54375546, "comment_id": 95565366, "body": "Let <code>f</code> be <code>id</code> and <code>g</code> be any function. <code>id g = g = id . g</code>."}], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 1, "creation_date": 1548685714, "post_id": 54376019, "comment_id": 95618642, "body": "0^0 isn&#39;t indeterminate here, it is 1 (check for yourself that it is <code>id</code>). This is because we are in a discrete situation here rather than a continuous one."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "reply_to_user": {"reputation": 189, "user_id": 8179137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b43fe26a1b6191280614f56683525d?s=128&d=identicon&r=PG&f=1", "display_name": "Potato44", "link": "https://stackoverflow.com/users/8179137/potato44"}, "edited": false, "score": 0, "creation_date": 1548696226, "post_id": 54376019, "comment_id": 95625258, "body": "@Potato44 yeah; I guess I meant that it&#39;s indeterminate in general, and happens to evaluate to 1 in the Church encoding."}], "tags": [], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "is_accepted": true, "score": 9, "last_activity_date": 1548481885, "creation_date": 1548481885, "answer_id": 54376019, "question_id": 54375546, "link": "https://stackoverflow.com/questions/54375546/find-haskell-functions-f-g-such-that-f-g-f-g/54376019#54376019", "title": "Find Haskell functions f, g such that f g = f . g", "body": "<p>I discovered that it's possible to find a family of solutions by considering Church numeral calculation. In the Church encoding, multiplication is performed by composing the Church numerals, and exponentiation is performed by applying the base to the exponent. Thus, if <code>f</code> is the Church encoding of some number <code>x</code>, and <code>g</code> is the Church encoding of some number <code>y</code>, then <code>f g = f . g</code> implies <code>y^x = x*y</code>. Any nonnegative integer solutions to this equation translate to solutions to the original problem. Examples:</p>\n\n<ul>\n<li><code>x=1, y=0, f=id, g=const id</code></li>\n<li><code>x=1, y=1, f=id, g=id</code></li>\n<li><code>x=1, y=2, f=id, g=join (.)</code></li>\n<li>Since <code>y^1 = y = 1*y</code> for all <code>y</code>, it makes sense that <code>f=id</code> works for all Church numerals <code>g</code>. This is indeed the case, and in fact, as Rein Henrichs pointed out, it's true for all <code>g</code>, and this is easily verifiable by inspection.</li>\n<li><code>x=2, y=0, f=join (.), g=const id</code></li>\n<li><code>x=2, y=2, f=join (.), g=join (.)</code></li>\n<li><code>x=3, y=0, f=(.) &lt;*&gt; join (.), g=const id</code></li>\n<li>Since <code>0^x = 0 = x*0</code> for all positive <code>x</code>, it makes sense that <code>g=const id</code> works for all positive Church numerals <code>f</code>. (It does not work for <code>f=const id</code>, Church numeral 0, which makes sense since <code>0^0</code> is an indeterminate form.)</li>\n</ul>\n"}], "owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 1, "accepted_answer_id": 54376019, "answer_count": 1, "score": 7, "last_activity_date": 1548481885, "creation_date": 1548474936, "question_id": 54375546, "link": "https://stackoverflow.com/questions/54375546/find-haskell-functions-f-g-such-that-f-g-f-g", "title": "Find Haskell functions f, g such that f g = f . g", "body": "<p>While learning Haskell, I came across a challenge to find two functions <code>f</code> and <code>g</code>, such that <code>f g</code> and <code>f . g</code> are equivalent (and total, so things like <code>f = undefined</code> or <code>f = (.) f</code> don't count). The given solution is that <code>f</code> and <code>g</code> are both equal to <code>\\x -&gt; x . x</code> (or <code>join (.)</code>).</p>\n\n<p>(I note that this isn't Haskell-specific; it can be expressed in pure combinatory logic as \"find <code>f</code> and <code>g</code> such that <code>f g = B f g</code>\", and the given solution would then translate to <code>f = g = W B</code>.)</p>\n\n<p>I understand why the given solution works when I expand it out, but I don't understand how you'd ever find it if you didn't already know it. Here's how far I can get:</p>\n\n<ul>\n<li><code>f g = f . g</code> (given)</li>\n<li><code>f g z = (f . g) z</code> (eta-expansion of both sides)</li>\n<li><code>f g z = f (g z)</code> (simplify the RHS)</li>\n</ul>\n\n<p>And I don't know how to proceed from there. What would I do next in trying to find a solution?</p>\n"}, {"tags": ["haskell", "common-lisp"], "comments": [{"owner": {"reputation": 23808, "user_id": 2382734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d80069e46785505b443aa9d1dd9eb3a3?s=128&d=identicon&r=PG", "display_name": "Renzo", "link": "https://stackoverflow.com/users/2382734/renzo"}, "edited": false, "score": 1, "creation_date": 1548486746, "post_id": 54375478, "comment_id": 95566696, "body": "Common Lisp was deliberately designed to accomodate at least imperative programming, functional programming, object-oriended programming. The way in which you use it depends from you, of course. If you write programs without any kind of side-effect you will produce a program with referential transparency (in other words, in the language <a href=\"http://www.lispworks.com/documentation/HyperSpec/Front/index.htm\" rel=\"nofollow noreferrer\">specification</a> the possible side effects of the operators are well documented)."}, {"owner": {"reputation": 127093, "user_id": 69545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OXXbv.jpg?s=128&g=1", "display_name": "Rainer Joswig", "link": "https://stackoverflow.com/users/69545/rainer-joswig"}, "edited": false, "score": 5, "creation_date": 1548492878, "post_id": 54375478, "comment_id": 95567717, "body": "Learning Common Lisp like it is kind of a Haskell with parentheses isn&#39;t really that useful, because Common Lisp is a vastly different language and eco-system. &#39;when in Rome, do as the Romans do&#39;."}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 1, "creation_date": 1548500081, "post_id": 54375478, "comment_id": 95568997, "body": "You say <i>It&#39;s well discussed that CL is &quot;not a functional language&quot;</i>, but my interpretation is that it is not <i>only</i> a functional language. If Lisp isn&#39;t a functional language, what is?"}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 1, "creation_date": 1548500431, "post_id": 54375478, "comment_id": 95569085, "body": "See e.g. <a href=\"https://github.com/danlentz/cl-ctrie\" rel=\"nofollow noreferrer\">github.com/danlentz/cl-ctrie</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 127093, "user_id": 69545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OXXbv.jpg?s=128&g=1", "display_name": "Rainer Joswig", "link": "https://stackoverflow.com/users/69545/rainer-joswig"}, "edited": false, "score": 1, "creation_date": 1548507061, "post_id": 54375478, "comment_id": 95570568, "body": "@RainerJoswig isn&#39;t it part of the Lisp philosophy though that <i>the language should adapt to the use case</i>, rather than enforcing everybody to use it in the same manner?"}, {"owner": {"reputation": 127093, "user_id": 69545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OXXbv.jpg?s=128&g=1", "display_name": "Rainer Joswig", "link": "https://stackoverflow.com/users/69545/rainer-joswig"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1548509373, "post_id": 54375478, "comment_id": 95571124, "body": "@leftaroundabout : why ignore the existing Common Lisp language with 1000+ operators, data types, control structures, variables, ... probably better than being disappointed that CL is not Haskell and only a bad Haskell substitute. Also keep in mind that shaping a language to support side-effect free programming in an efficient way might not be a beginner task without some deeper knowledge of the language..."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1548523371, "post_id": 54375478, "comment_id": 95574888, "body": "&quot;a way to use [anything] in an immutable manner&quot; is to always mutate a <i>copy</i>, never an original. -- CL is an imperative language, IMO. Any imperative language can be used to code functionally (e.g. C). The separate evaluation rules and namespace for functions will make it feel very alien, I think, compared to Haskell. But anything is possible in CL."}, {"owner": {"reputation": 6145, "user_id": 9690090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/280beabfb095bdf65a194d15dded9b8a?s=128&d=identicon&r=PG&f=1", "display_name": "Gwang-Jin Kim", "link": "https://stackoverflow.com/users/9690090/gwang-jin-kim"}, "edited": false, "score": 0, "creation_date": 1548631475, "post_id": 54375478, "comment_id": 95599397, "body": "I would say CL&#39;s strength is that it is multiparadigm. Sure, you could mold the language to your will and wish. But also as well a part of CL&#39;s philosophy is to use the different paradigms (FP, OOP, imperative, logical programming, ...) for the proper parts of the program. And in terms of performance it will be very efficient to use mutation - but in a restricted way."}], "answers": [{"tags": [], "owner": {"reputation": 46737, "user_id": 31615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1127d0098e693682f382758abd9f6c76?s=128&d=identicon&r=PG", "display_name": "Svante", "link": "https://stackoverflow.com/users/31615/svante"}, "is_accepted": false, "score": 14, "last_activity_date": 1548509988, "creation_date": 1548509988, "answer_id": 54378903, "question_id": 54375478, "link": "https://stackoverflow.com/questions/54375478/can-lisp-be-easily-used-in-an-immutable-functional-manner/54378903#54378903", "title": "Can Lisp be easily used in an immutable, functional manner?", "body": "<p>Yes, of course, but depending on how much you want restrictions to be enforced, your mileage may vary.</p>\n\n<h1>Just don't mutate</h1>\n\n<p>You can simply avoid <code>setf</code> and all the places machinery.  If you have to use hash-tables or vectors, you will be copying a lot, but for many applications, the garbage collection overhead can be still manageable.  In many places, you can use alists or plists, which can be handled almost like functional data structures.  Some useful utilities are in <code>alexandria</code>, e. g. <code>copy-hash-table</code>, which has a <code>key</code> argument to actually do something like a hypothetical <code>map-hash-table</code>.  All the other functional goodness, like higher order functions, <code>map</code>, <code>reduce</code>, <code>remove</code> etc. are available in many flavours.  Also, certain use cases can be solved quite declaratively in <code>loop</code>.</p>\n\n<p>There are also libraries that make this style explicitly easier, e. g. <a href=\"https://github.com/smithzvk/modf\" rel=\"noreferrer\">modf</a>.</p>\n\n<p>This can take you quite far.  I perceive it as easy to see where you break referential transparency and avoid that.</p>\n\n<h1>Use functional data structures</h1>\n\n<p>There is <a href=\"https://github.com/slburson/fset\" rel=\"noreferrer\">FSet</a>, which gives you a lot of functional data structures, and there is <a href=\"https://github.com/ndantam/sycamore\" rel=\"noreferrer\">sycamore</a>, which gives some more.</p>\n\n<h1>Use transducers</h1>\n\n<p><a href=\"https://www.cliki.net/Series\" rel=\"noreferrer\">SERIES</a> appeared in CLtL2 in 1990 and almost made it into the standard in 1994.  There is also <a href=\"https://github.com/mikelevins/taps\" rel=\"noreferrer\">taps</a>, which adds some useful functionality.</p>\n\n<h1>Meditate</h1>\n\n<p>Personally, I am not so hard after purity any more.  Sometimes, mutating a place in a loop is easier to understand than juggling multiple bindings in different extents.  I just keep the mutation confined; this is similar to a data ownership concept.  However, I like to have purity on a larger scale, both in memory and on disk, e. g. append-only logs, databases (bknr.datastore).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8370684"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 587, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1548509988, "creation_date": 1548473882, "last_edit_date": 1548492717, "question_id": 54375478, "link": "https://stackoverflow.com/questions/54375478/can-lisp-be-easily-used-in-an-immutable-functional-manner", "title": "Can Lisp be easily used in an immutable, functional manner?", "body": "<p>I come from a background in Haskell, and I want to learn Common Lisp. </p>\n\n<p>It's well discussed that CL is \"not a functional language\", but I would like to know whether it can be used as a functional language.</p>\n\n<p>For example, is it possible to use all of the data types in an immutable manner? Common Lisp hash-tables seem to be set using <code>setf</code>, which is decidedly of the mutable orientation. Is there a way to use it in an immutable manner? </p>\n\n<p>Aside from the \"IO\" aspect of Common Lisp (the \"purely\" aspect of Haskell) where I interact with files, networks, etc., can I comfortably write code in Lisp and be assured that the code will have referential transparency?</p>\n\n<p>Can I expect these kinds of properties from the popular libraries available in Common Lisp? </p>\n\n<p>Are there common idioms or aspects of the language that will make these difficult?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 4, "creation_date": 1548457603, "post_id": 54373918, "comment_id": 95562365, "body": "You can <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:uncurry\" rel=\"nofollow noreferrer\"><code>uncurry :: (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c</code></a> the functions."}, {"owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "reply_to_user": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 0, "creation_date": 1548458977, "post_id": 54373918, "comment_id": 95562696, "body": "Thanks, but I am aware of the uncurry function. What I was interested in was if there was a way to achieve the same effect without having to wrap the function in an uncurry first."}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 3, "creation_date": 1548460260, "post_id": 54373918, "comment_id": 95562965, "body": "That&#39;s really the only way to do it. Why don&#39;t you want to do it that way?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1548465417, "post_id": 54373918, "comment_id": 95563966, "body": "Neither <code>f</code> or <code>g</code> take more than one argument (<i>all</i> functions take exactly one argument); currying along with left-associative function application just provides the illusion of multi-argument functions. You can&#39;t package the parameters, you can only define new functions, which is what <code>uncurry</code> does."}, {"owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1548465902, "post_id": 54373918, "comment_id": 95564067, "body": "@Joseph Sible I was curious."}, {"owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548466024, "post_id": 54373918, "comment_id": 95564091, "body": "@chepner that makes sense"}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": true, "score": 2, "last_activity_date": 1548572212, "creation_date": 1548572212, "answer_id": 54385802, "question_id": 54373918, "link": "https://stackoverflow.com/questions/54373918/grouping-parameters/54385802#54385802", "title": "Grouping parameters", "body": "<p>The only way to do <em>exactly</em> what you\u2019re asking is to use <code>uncurry</code>:</p>\n\n<pre><code>let\n  x = (a, b)\nin uncurry f x == uncurry g x\n</code></pre>\n\n<p>(Or <code>uncurry<em>N</em></code> for <code><em>N</em></code> arguments.)</p>\n\n<p>However, instead of packaging the arguments in a tuple, you could use the <code>(-&gt;) x</code> instance of <code>Applicative</code> (i.e., functions taking <code>x</code> as input) to implicitly \u201cspread\u201d the arguments to the parameters of both functions, so at least you only have to mention them once. This instance is commonly used in point-free code.</p>\n\n<p>For example, using <code>liftA2</code> specialised to this instance:</p>\n\n<pre><code>-- General type:\nliftA2 :: Applicative f =&gt; (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c\n\n-- Specialised to \u2018(-&gt;) x\u2019 (using TypeApplications syntax):\nliftA2 @((-&gt;) _) :: (a -&gt; b -&gt; c) -&gt; (x -&gt; a) -&gt; (x -&gt; b) -&gt; (x -&gt; c)\n</code></pre>\n\n<p>You get this pattern:</p>\n\n<pre><code>liftA2 h f g x\n-- =\n(h &lt;$&gt; f &lt;*&gt; g) x\n-- =\nh (f x) (g x)\n</code></pre>\n\n<p>To lift more arguments, you add another <code>liftA2</code> or <code>\u2026 &lt;$&gt; \u2026 &lt;*&gt; \u2026</code>:</p>\n\n<pre><code>liftA2 (liftA2 h) f g x y\n-- =\n(liftA2 h &lt;$&gt; f &lt;*&gt; g) x y\n-- =\nh (f x y) (g x y)\n</code></pre>\n\n<p>So in a case like yours:</p>\n\n<pre><code>f, g :: Int -&gt; Char -&gt; Bool\nf i c = chr i == c\ng i c = i == ord c\n\n(liftA2 . liftA2) (==) f g :: Int -&gt; Char -&gt; Bool\n-- =\nliftA2 (liftA2 (==)) f g\n-- =\n(\\ x y -&gt; f x y == g x y)\n</code></pre>\n\n<p>The <code><em>N</em></code> in <code>liftA<em>N</em></code> corresponds to the number of <em>functions</em>; the number of <code>liftA<em>N</em></code> calls corresponds to the number of arguments.</p>\n"}], "owner": {"reputation": 328, "user_id": 9801788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38c4d65bb8eb9216158702949a00454c?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/9801788/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 54385802, "answer_count": 1, "score": -2, "last_activity_date": 1548572212, "creation_date": 1548457254, "question_id": 54373918, "link": "https://stackoverflow.com/questions/54373918/grouping-parameters", "title": "Grouping parameters", "body": "<p>Say I have functions which accept the same parameters and I want to test if their outputs are equivalent for the same input.</p>\n\n<pre><code>f :: a -&gt; b -&gt; c\ng :: a -&gt; b -&gt; c\nf a b == g a b\n</code></pre>\n\n<p>How can I package the parameters a and b in x so I can write the following instead.</p>\n\n<pre><code>f x == g x\n</code></pre>\n\n<p>What are the best ways to accomplish this without needing to wrap the functions themselves?</p>\n"}, {"tags": ["haskell", "functional-programming", "ghc", "dependent-type", "higher-kinded-types"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1548449661, "post_id": 54371716, "comment_id": 95559657, "body": "How is <code>DoorState</code> defined?"}], "answers": [{"comments": [{"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "edited": false, "score": 0, "creation_date": 1548455619, "post_id": 54372996, "comment_id": 95561761, "body": "What? No. Kinds are types. Values have types. Types also have types. Note that <code>Type :: Type</code>. If a type is the type of a type, then we sometimes call it a &quot;kind&quot; in the simple cases where the distinction is convenient. <code>~</code> constraints are value level. &quot;Inside&quot; a <code>~</code>, I believe, lies a type level coercion, but you can&#39;t unpack a value-level argument to a function inside its type to get to it."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 2, "last_activity_date": 1548451576, "creation_date": 1548451576, "answer_id": 54372996, "question_id": 54371716, "link": "https://stackoverflow.com/questions/54371716/how-do-i-show-relationships-between-type-variables/54372996#54372996", "title": "How do I show relationships between type variables", "body": "<p>Haskell has separate namespaces for computations, types, and kinds. When you write</p>\n\n<pre><code>forall (ds :: t). ...\n</code></pre>\n\n<p>the variable <code>t</code> is the kind-level variable, but when you write</p>\n\n<pre><code>t ~ DoorState =&gt; ...\n</code></pre>\n\n<p>the variable <code>t</code> is the type-level variable <code>t</code>, a completely unrelated variable. Indeed, all type equalities are at the type-level only; as far as I know there is no way to express kind equalities as constraints at all in current GHC Haskell.</p>\n"}, {"comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1548460351, "post_id": 54373730, "comment_id": 95562979, "body": "&quot;The constraints on a type are value-level&quot; - things that live in a type signature are by definition not &quot;value-level&quot;, right? So what do you mean?"}, {"owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1548463275, "post_id": 54373730, "comment_id": 95563539, "body": "@jberryman In <code>a ~ b =&gt; ()</code>, the <code>a ~ b</code> is value-level in the same way as the <code>DoorState</code> in <code>DoorState -&gt; ()</code>."}, {"owner": {"reputation": 1891, "user_id": 45160, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9fe6d04c7c6a357a92a2b05efd0d09bc?s=128&d=identicon&r=PG", "display_name": "Vanson Samuel", "link": "https://stackoverflow.com/users/45160/vanson-samuel"}, "edited": false, "score": 0, "creation_date": 1548626321, "post_id": 54373730, "comment_id": 95598237, "body": "Thanks!  I ended up going with this: <a href=\"https://gist.github.com/binq/89999480859905af982b45c8a9df2ed4\" rel=\"nofollow noreferrer\">gist.github.com/binq/89999480859905af982b45c8a9df2ed4</a>"}], "tags": [], "owner": {"reputation": 22091, "user_id": 5684257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea5090cde8ea066a1fda67ed52dd5084?s=128&d=identicon&r=PG&f=1", "display_name": "HTNW", "link": "https://stackoverflow.com/users/5684257/htnw"}, "is_accepted": true, "score": 2, "last_activity_date": 1548463641, "last_edit_date": 1548463641, "creation_date": 1548455933, "answer_id": 54373730, "question_id": 54371716, "link": "https://stackoverflow.com/questions/54371716/how-do-i-show-relationships-between-type-variables/54373730#54373730", "title": "How do I show relationships between type variables", "body": "<p>The thing you have written is indeed nonsense. The constraints on the LHS of a <code>=&gt;</code> exist only on the value-level, in the same way things on the LHS of a <code>-&gt;</code> exist only on the value-level. More specifically (though this is a faint memory), an instance of <code>a ~ b</code> \"contains\" within it a primitive type of kind <code>a ~# b</code> (in the same way a <code>data Showable = forall s. Show s =&gt; Showable s</code> holds a type of kind <code>Type</code>). You need the <code>a ~# b</code> to actually get anything done, but you'd need to unpack the <code>a ~ b</code> to get it. You cannot talk about the <code>a ~ b</code>, a value-level argument, in a type, though, in the same way you cannot talk about the <code>DoorState</code> in <code>DoorState -&gt; Door _can'tTalkAboutTheDoorState</code>.</p>\n\n<p>What you can do is this. Define</p>\n\n<pre><code>type family Cast (x :: (a :: Type)) :: (b :: Type) where\n   Cast x = x\n-- this seems strange, but realize the equation is actually\n-- Cast @a @a (x :: a) = (x :: a)\n-- Cast-ing some type from one kind to another only goes through\n-- when they're actually the same kind\n-- can make a, b, or both explicit instead of implicit\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>appendHallway :: forall t (ds :: t) (dsl :: [t]).\n                 (t ~ DoorState) =&gt;\n                 Door (Cast ds) -&gt;\n                 Hallway (Cast dsl) -&gt;\n                 Hallway (Cast ds : Cast dsl)\nappendHallway d rest = Section d rest\n</code></pre>\n\n<p>Whenever <code>t ~ DoorState</code> is known, the type family applications <code>Cast @t @DoorState ds</code> and <code>Cast @[t] @[DoorState] dsl</code> reduce to <code>ds</code> and <code>dsl</code> respectively.</p>\n"}], "owner": {"reputation": 1891, "user_id": 45160, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9fe6d04c7c6a357a92a2b05efd0d09bc?s=128&d=identicon&r=PG", "display_name": "Vanson Samuel", "link": "https://stackoverflow.com/users/45160/vanson-samuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 54373730, "answer_count": 2, "score": 1, "last_activity_date": 1548627025, "creation_date": 1548444641, "last_edit_date": 1548627025, "question_id": 54371716, "link": "https://stackoverflow.com/questions/54371716/how-do-i-show-relationships-between-type-variables", "title": "How do I show relationships between type variables", "body": "<p>For the types <code>Door</code> and <code>Hallway</code>:</p>\n\n<pre><code> data DoorState :: Type where\n   Opened :: DoorState\n   Closed :: DoorState\n   Locked :: DoorState\n   deriving (Bounded, Enum, Eq, Ord, Show)\n\n data Door :: DoorState -&gt; Type where\n   Door :: {material :: String} -&gt; Door s\n   deriving (Show)\n\n data Hallway :: [DoorState] -&gt; Type where\n   Origin :: Hallway '[]\n   Section :: Door ds -&gt; Hallway dsl -&gt; Hallway (ds : dsl)\n</code></pre>\n\n<p>This definition of <code>appendHallway</code> works:</p>\n\n<pre><code> appendHallway :: forall (ds :: DoorState) (dsl :: [DoorState]). Door ds -&gt; Hallway dsl -&gt; Hallway (ds : dsl)\n appendHallway d rest = Section d rest\n</code></pre>\n\n<p>However this definition for <code>appendHallway</code> where the relationship between <code>ds</code> and <code>dsl</code> is being explicitly indicated in the <code>forall</code> section does not work:</p>\n\n<pre><code> appendHallway :: forall t (ds :: t) (dsl :: [t]). (t ~ DoorState) =&gt; Door ds -&gt; Hallway dsl -&gt; Hallway (ds : dsl)\n appendHallway d rest = Section d rest\n</code></pre>\n\n<p>The error that is returned is as follows:</p>\n\n<pre><code> error:\n     \u2022 Expected kind \u2018DoorState\u2019, but \u2018ds\u2019 has kind \u2018t\u2019\n     \u2022 In the first argument of \u2018Door\u2019, namely \u2018ds\u2019\n       In the type signature:\n         appendHallway :: forall t (ds :: t) (dsl :: [t]).\n                          (t ~ DoorState) =&gt; Door ds -&gt; Hallway dsl -&gt; Hallway (ds : dsl)\n     |\n 351 | appendHallway :: forall t (ds :: t) (dsl :: [t]). (t ~ DoorState) =&gt; Door ds -&gt; Hallway dsl -&gt; Hallway (ds : dsl)\n     |                                                                           ^^\n</code></pre>\n\n<p>The example above may be a little contrived, but there might be situations where indicating relationships between higher kinded type variables would be helpful or even necessary.  Is this error a limitation of the current version of GHC or is the above nonsensical even in a future version of GHC?  Is there another way to express the relationship between <code>ds</code> and <code>dsl</code> that would be accepted by GHC?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 5, "creation_date": 1548437740, "post_id": 54369864, "comment_id": 95554647, "body": "Do you understand what it means for <code>Expr</code> to <i>have</i> a <code>Functor</code> instance? If not, I wouldn&#39;t worry about understanding the actual instance just yet."}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1548486520, "post_id": 54369864, "comment_id": 95566663, "body": "I think <code>Expr a</code> is too complex to be a good example. Maybe you could try to understand <a href=\"https://hackage.haskell.org/package/base/docs/src/GHC.Base.html#line-836\" rel=\"nofollow noreferrer\">Maybe</a> first. (pun intended)"}], "answers": [{"tags": [], "owner": {"reputation": 188, "user_id": 5772563, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DVfEl50m8KI/AAAAAAAAAAI/AAAAAAAAADk/gmX7V01d4u8/photo.jpg?sz=128", "display_name": "Adrian Legaspi", "link": "https://stackoverflow.com/users/5772563/adrian-legaspi"}, "is_accepted": false, "score": 1, "last_activity_date": 1548494890, "creation_date": 1548494890, "answer_id": 54377156, "question_id": 54369864, "link": "https://stackoverflow.com/questions/54369864/exercise-with-functor-applicative-and-monads-in-haskell/54377156#54377156", "title": "Exercise with functor, applicative and monads in Haskell", "body": "<p>To understand the solution, you need to get an intuition over a <code>Functor</code>, an <code>Applicative</code> and a <code>Monad</code>.</p>\n\n<p>That being said <code>fmap</code>, <code>&lt;*&gt;</code> and <code>&gt;&gt;=</code> is just a way for one to be able to transform a data within an arbitrary <code>F</code> in your case that's an <code>Expr</code> from <code>a -&gt; b</code></p>\n\n<p>Take a look at the Type class definitions of <code>Functor</code>, <code>Applicative</code> and <code>Monad</code> for example.</p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; f a -&gt; f b\n\nclass Functor f =&gt; Applicative f where\n    &lt;*&gt; :: f (a -&gt; b) -&gt; f a -&gt; f b\n\nclass Applicative m =&gt; Monad m where\n    &gt;&gt;= :: m a -&gt; (a -&gt; m b) -&gt; m b\n</code></pre>\n\n<p>Though on the bigger picture, these functions also execute effects of the algebraic datatype that have the type class instances for it.</p>\n\n<p>For example, I will provide the rough definition of the <code>Maybe</code> monad.</p>\n\n<pre><code>instance Monad Maybe where\n    (Just something) &gt;&gt;= f = f something\n    Nothing          &gt;&gt;= _ = Nothing\n</code></pre>\n\n<p>In this context, the bind or <code>&gt;&gt;=</code> combinator returns <code>Nothing</code> if there is <code>Nothing</code> for the input else it applies the arbitrary <code>f</code> on <code>something</code> such that <code>f</code> is a transformation from <code>a -&gt; Maybe b</code> which satisfies the definition of the <code>&gt;&gt;=</code> combinator which is <code>m a -&gt; (a -&gt; m b) -&gt; m b</code> where <code>m</code> is the <code>Maybe</code> datatype.</p>\n"}], "owner": {"reputation": 1, "user_id": 10968550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a438100a2c5820f7890284c2a0dd816?s=128&d=identicon&r=PG&f=1", "display_name": "mek", "link": "https://stackoverflow.com/users/10968550/mek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1548494890, "creation_date": 1548436174, "question_id": 54369864, "link": "https://stackoverflow.com/questions/54369864/exercise-with-functor-applicative-and-monads-in-haskell", "title": "Exercise with functor, applicative and monads in Haskell", "body": "<p>I'm doing exercises from the book \"Programming in Haskell (2nd Edition)\" and I have some problems in understanding the following:</p>\n\n<p>\"Given the following type of expressions</p>\n\n<pre><code>data Expr a = Var a | Val Int | Add (Expr a) (Expr a)\nderiving Show\n</code></pre>\n\n<p>that contain variables of some type <code>a</code>, show how to make this type into instances of the <em>Functor</em>, <em>Applicative</em> and <em>Monad</em> classes. With the aid of an example, explain what the <code>&gt;&gt;=</code> operator for this type does.\"</p>\n\n<p>I found a solution to the first question, which is the same as here: <a href=\"https://github.com/evturn/programming-in-haskell/blob/master/12-monads-and-more/12.05-exercises.hs\" rel=\"nofollow noreferrer\">https://github.com/evturn/programming-in-haskell/blob/master/12-monads-and-more/12.05-exercises.hs</a> (ex. 7), that is type correct.</p>\n\n<p>The problem is that I cannot find out the sense of this exercise and the meaning of what this solution actually does.</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1548441272, "post_id": 54369376, "comment_id": 95556328, "body": "Sorry for obvious question, but this isn&#39;t an operator precedence issue between .| and &amp;, is it? From the formatting, it seems maybe the three &amp; on the last line are meant to be groupped... put in parentheses?"}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "reply_to_user": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "edited": false, "score": 0, "creation_date": 1548450560, "post_id": 54369376, "comment_id": 95560055, "body": "Good question - I still don&#39;t trust myself remembering these things, so I usually check. I double checked just now, and indeed I do get the same errors using: <code>runIdentity $ runConduitPure $ replicateC</code>; there are only two &amp; and I couldn&#39;t find a good way to group them using parentheses that didn&#39;t generate a more serious-looking type error, i.e. using <code>.| sinkVector &amp; (runConduitPure &amp; runIdentity)</code>."}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1548435421, "creation_date": 1548434181, "last_edit_date": 1548435421, "question_id": 54369376, "link": "https://stackoverflow.com/questions/54369376/why-can-one-sometimes-get-no-instance-for-csv-text-text-arising-from-a-use-of", "title": "Why can one sometimes get &quot;No instance for CSV Text Text arising from a use of `intoCSV`&quot; when using csv-conduit?", "body": "<p>My function is relatively simple and using fairly standard libraries:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Foo where\n\nimport           Conduit\nimport           Data.CSV.Conduit\n\ntextToCSV :: Text -&gt; Vector (MapRow Text)\ntextToCSV txt = replicateC 1 txt\n  .| intoCSV defCSVSettings\n  .| sinkVector &amp; runConduitPure &amp; runIdentity\n</code></pre>\n\n<p>I'd like to understand why I'm getting these type errors, and a solution would be great too:</p>\n\n<pre><code>    * No instance for (CSV Text (Vector (MapRow Text)))\n        arising from a use of `intoCSV'\n    * In the first argument of `(.|)', namely `intoCSV defCSVSettings'\n      In the second argument of `(.|)', namely\n        `intoCSV defCSVSettings .| sinkVector'\n      In the first argument of `(&amp;)', namely\n        `replicateC 1 txt .| intoCSV defCSVSettings .| sinkVector'\n    |\n156 |   .| intoCSV defCSVSettings\n    |      ^^^^^^^^^^^^^^^^^^^^^^\n\n\n    * No instance for (Data.Vector.Generic.Base.Vector\n                         Identity (Vector (MapRow Text)))\n        arising from a use of `sinkVector'\n    * In the second argument of `(.|)', namely `sinkVector'\n      In the second argument of `(.|)', namely\n        `intoCSV defCSVSettings .| sinkVector'\n      In the first argument of `(&amp;)', namely\n        `replicateC 1 txt .| intoCSV defCSVSettings .| sinkVector'\n    |\n157 |   .| sinkVector &amp; runConduitPure &amp; runIdentity\n    |      ^^^^^^^^^^\n</code></pre>\n\n<p>Certainly, I can agree that an instance of <code>CSV Text Text</code> doesn't exist. But compared to what I'm doing, the typical usage using <code>sourceFile</code> seems to have a very <a href=\"https://hackage.haskell.org/package/csv-conduit\" rel=\"nofollow noreferrer\">similar usage</a>. I'm just as confused about the second error regarding vectors.</p>\n\n<p><strong>Possible workaround</strong>:</p>\n\n<p>Not really an answer to the question, but a workaround I found (that is also more succinct) was to replace my <code>textToCSV</code> function and several other auxiliary functions in the construction of my <code>processCSV</code> conduit:</p>\n\n<pre><code>processCSV :: (MonadResource m, MonadThrow m, PrimMonad m) =&gt;\n  ConduitT FilePath Void m (Vector (Vector (MapRow Text)))\nprocessCSV = mapMC (readCSVFile defCSVSettings) .| sinkVector\n</code></pre>\n"}, {"tags": ["scala", "haskell", "functional-programming", "scalaz", "comonad"], "comments": [{"owner": {"reputation": 135502, "user_id": 334519, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bf774a4e24c33e4bb6d19ea1939f01a2?s=128&d=identicon&r=PG", "display_name": "Travis Brown", "link": "https://stackoverflow.com/users/334519/travis-brown"}, "edited": false, "score": 1, "creation_date": 1548434006, "post_id": 54368676, "comment_id": 95552738, "body": "It&#39;s worth noting that in Cats for example <code>Store</code> is formally just a specialized <code>RepresentableStore</code> (where the representable functor is <code>I =&gt; _</code>). I don&#39;t know the details of the Haskell situation, but I&#39;d guess the only reasons that <code>adjunction</code> and <code>comonad</code> don&#39;t do the same are historical."}, {"owner": {"reputation": 2568, "user_id": 5826349, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-laGg4SzRy9M/AAAAAAAAAAI/AAAAAAAAAFw/M9PUdwczB-c/photo.jpg?sz=128", "display_name": "Valy Dia", "link": "https://stackoverflow.com/users/5826349/valy-dia"}, "reply_to_user": {"reputation": 135502, "user_id": 334519, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bf774a4e24c33e4bb6d19ea1939f01a2?s=128&d=identicon&r=PG", "display_name": "Travis Brown", "link": "https://stackoverflow.com/users/334519/travis-brown"}, "edited": false, "score": 1, "creation_date": 1548436577, "post_id": 54368676, "comment_id": 95554024, "body": "Thanks @TravisBrown! By the way, there is a discussion in Cats on a <a href=\"https://github.com/typelevel/cats/pull/2704\" rel=\"nofollow noreferrer\">PR</a> to introduce the IndexedStore, and whether or not it should be built on top of the <code>RepresentableStore</code>, you might have some useful input..."}, {"owner": {"reputation": 135502, "user_id": 334519, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bf774a4e24c33e4bb6d19ea1939f01a2?s=128&d=identicon&r=PG", "display_name": "Travis Brown", "link": "https://stackoverflow.com/users/334519/travis-brown"}, "edited": false, "score": 0, "creation_date": 1548436977, "post_id": 54368676, "comment_id": 95554237, "body": "Thanks for the pointer, I hadn&#39;t seen the PR!"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 4, "last_activity_date": 1548441497, "last_edit_date": 1548441497, "creation_date": 1548433348, "answer_id": 54369164, "question_id": 54368676, "link": "https://stackoverflow.com/questions/54368676/what-is-the-difference-between-the-store-comonad-and-a-representable-store-comon/54369164#54369164", "title": "What is the difference between the Store Comonad and a Representable Store Comonad in functional programming?", "body": "\n\n<p>For reference, here's a quick recap on what they are:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>class {- ... =&gt; -} Representable f where\n    type Key f\n    -- ...\n\ndata RepStore f a = RepStore (Key f) (f    a)\ndata    Store s a =    Store s       (s -&gt; a)\n</code></pre>\n\n<p>Note that in particular</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>instance Representable (s -&gt; a) where\n    type Key (s -&gt; a) = s\n    -- ...\n</code></pre>\n\n<p>and so we have directly that <code>Store s</code> and <code>RepStore (s -&gt;)</code> are pretty much completely interchangeable. In the other direction, category theory teaches us that all <code>Representable</code> functors are isomorphic to functions (with their <code>Key</code> as the domain), hence <code>RepStore f</code> and <code>Store (Key f -&gt;)</code> are isomorphic.</p>\n\n<p>In summary: in most cases, it doesn't really matter which you choose. If you plan to use it only on functions anyway, you might as well use <code>Store</code> and benefit from its syntactic lightness; if you wish to use some representable functor that isn't exactly functions (say, memoized functions or something like that), then <code>RepStore</code> is an appropriate generalization.</p>\n"}], "owner": {"reputation": 2568, "user_id": 5826349, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-laGg4SzRy9M/AAAAAAAAAAI/AAAAAAAAAFw/M9PUdwczB-c/photo.jpg?sz=128", "display_name": "Valy Dia", "link": "https://stackoverflow.com/users/5826349/valy-dia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 54369164, "answer_count": 1, "score": 3, "last_activity_date": 1548441520, "creation_date": 1548431403, "last_edit_date": 1548441520, "question_id": 54368676, "link": "https://stackoverflow.com/questions/54368676/what-is-the-difference-between-the-store-comonad-and-a-representable-store-comon", "title": "What is the difference between the Store Comonad and a Representable Store Comonad in functional programming?", "body": "<p>The Representable Store Comonad and the Store Comonad offers similar features... When should we use one over the other, and what are the benefits?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 208, "user_id": 9252109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beeb1e77101c576b7428ac0692f5c679?s=128&d=identicon&r=PG&f=1", "display_name": "atmostmediocre", "link": "https://stackoverflow.com/users/9252109/atmostmediocre"}, "edited": false, "score": 0, "creation_date": 1548429589, "post_id": 54367853, "comment_id": 95550138, "body": "If you&#39;re trying just to print a nth Fibonacci number, just define <code>fibs</code> as <code>fibs = 0 : 1 : zipWith (+) fibs (tail fibs)</code> and use <code>(!!)</code> when you need it. Be careful though, this has <code>O(n)</code> complexity if I&#39;m not mistaken."}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1548429612, "post_id": 54367853, "comment_id": 95550155, "body": "<code>fib n = fib !! n does not work</code> - this is the right approach though, the only reason it doesn&#39;t work is that you can&#39;t use the name <code>fib</code> for both the infinite list of Fibonacce numbers and the function."}], "answers": [{"tags": [], "owner": {"reputation": 311, "user_id": 8627223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c2215fe47f643d6a6e3dcbb26fa2bc6?s=128&d=identicon&r=PG&f=1", "display_name": "James Birch", "link": "https://stackoverflow.com/users/8627223/james-birch"}, "is_accepted": true, "score": 8, "last_activity_date": 1548429801, "creation_date": 1548429801, "answer_id": 54368204, "question_id": 54367853, "link": "https://stackoverflow.com/questions/54367853/how-to-pass-an-argument-to-calculator/54368204#54368204", "title": "How to pass an argument to calculator?", "body": "<p>You can't use <code>fib</code> as the name of the function that gets the nth Fibonacci number and the name of the generating list.</p>\n\n<p>This should work:</p>\n\n<p><code>fibList = 0:1:zipWith (+) fibList (tail fibList)</code></p>\n\n<p><code>fib n = fibList !! n</code></p>\n"}], "owner": {"reputation": 33, "user_id": 9259126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f0eef3e15ab16b9923552be4e2552b0?s=128&d=identicon&r=PG&f=1", "display_name": "John Weeeek", "link": "https://stackoverflow.com/users/9259126/john-weeeek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "closed_date": 1575344078, "accepted_answer_id": 54368204, "answer_count": 1, "score": -1, "last_activity_date": 1575323410, "creation_date": 1548428568, "last_edit_date": 1575323410, "question_id": 54367853, "link": "https://stackoverflow.com/questions/54367853/how-to-pass-an-argument-to-calculator", "closed_reason": "Needs more focus", "title": "How to pass an argument to calculator?", "body": "<p>I am trying to speed up my calculator. How would i got about that?</p>\n"}, {"tags": ["haskell", "concurrency"], "comments": [{"owner": {"reputation": 2585, "user_id": 8491228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5T09.jpg?s=128&g=1", "display_name": "Mor A.", "link": "https://stackoverflow.com/users/8491228/mor-a"}, "edited": false, "score": 3, "creation_date": 1548419256, "post_id": 54364469, "comment_id": 95544332, "body": "I&#39;m pretty sure the text doesn&#39;t mention those two lookups happening concurrently, it only shows how the functions defined are used to illustrate wrapping immutable structures in mutable variables to achieve mutable state in an IO setting"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1548419470, "post_id": 54364469, "comment_id": 95544446, "body": "The first <code>main</code> is not concurrent: it performs the lookups in sequence."}, {"owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1548421356, "post_id": 54364469, "comment_id": 95545383, "body": "@chi From the book: <i>The following example models a phone book as a piece of mutable state that may be concurrently modified and inspected by multiple threads</i>. I was assuming the <code>main</code> to be concurrent, but as @M.Aroosi pointed out, probably the intention is to ilustrate mutable state that <i>&quot;may be&quot;</i> concurrent."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1548425828, "post_id": 54364469, "comment_id": 95547965, "body": "Yes, that&#39;s likely it. The book shows a basic use of <code>MVar</code>s in plain sequential code. Then one can add <code>forkIO</code>s to make it concurrent. In more complex scenarios, you have many threads taking/putting distinct <code>MVar</code>s to synchronize. (Of course, a badly designed program may still even lead to deadlock, starvation, and other &quot;usual&quot; issues in concurrent programming, depending on how the <code>MVar</code>s are used.)"}], "owner": {"reputation": 2623, "user_id": 9271266, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2K9ibxquX4/AAAAAAAAAAI/AAAAAAAAABU/Jq4JVvo766Q/photo.jpg?sz=128", "display_name": "lsmor", "link": "https://stackoverflow.com/users/9271266/lsmor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 172, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1548415856, "creation_date": 1548415856, "question_id": 54364469, "link": "https://stackoverflow.com/questions/54364469/why-is-this-haskell-program-actually-concurrent", "title": "Why is this Haskell program actually concurrent?", "body": "<p>I am learning about simple uses of <code>forkIO</code> and <code>Mvar</code> from Marlow's book: <a href=\"https://www.oreilly.com/library/view/parallel-and-concurrent/9781449335939/ch07.html\" rel=\"nofollow noreferrer\">Parallel and Concurrent Programming in Haskell</a>. I the section <em>MVar as a Container for Shared State</em> the following code is exposed:</p>\n\n<pre><code>-- Creates a new Map within an MVar\nnew :: IO PhoneBookState\nnew = do\n  m &lt;- newMVar Map.empty\n  return (PhoneBookState m)\n\n-- Inserts a Key, Value in the Map, locking the MVar\ninsert :: PhoneBookState -&gt; Name -&gt; PhoneNumber -&gt; IO ()\ninsert (PhoneBookState m) name number = do\n  book &lt;- takeMVar m\n  putMVar m (Map.insert name number book)\n\n-- Retrieves the Map, locking the MVar briefly\nlookup :: PhoneBookState -&gt; Name -&gt; IO (Maybe PhoneNumber)\nlookup (PhoneBookState m) name = do\n  book &lt;- takeMVar m\n  putMVar m book\n  return (Map.lookup name book)\n</code></pre>\n\n<p>Where <code>PhoneBookState</code> holds an <code>MVar (Map Name PhoneNumber)</code>. My problem comes in the <code>main</code> function</p>\n\n<pre><code>main = do\n  s &lt;- new\n  sequence_ [ insert s (\"name\" ++ show n) (show n) | n &lt;- [1..10000] ]\n  lookup s \"name999\" &gt;&gt;= print\n  lookup s \"unknown\" &gt;&gt;= print\n</code></pre>\n\n<p>The idea is both lookups happening concurrently, but in such a case, shouldn't it be something like </p>\n\n<pre><code>main = do\n  s &lt;- new\n  sequence_ [ insert s (\"name\" ++ show n) (show n) | n &lt;- [1..10000] ]\n  forkIO(lookup s \"name999\" &gt;&gt;= print)\n  lookup s \"unknown\" &gt;&gt;= print\n</code></pre>\n\n<p>What am I missing? </p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1548416145, "post_id": 54364124, "comment_id": 95542820, "body": "Note that the expression <code>if a == c then (a,d):r else (a,b):updRel r c d</code> implicit that <code>d</code> and <code>b</code> must be same type."}, {"owner": {"reputation": 147, "user_id": 6838782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356f31873735c15aaa2421c68c5a2df1?s=128&d=identicon&r=PG", "display_name": "Dortmunder", "link": "https://stackoverflow.com/users/6838782/dortmunder"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1548416528, "post_id": 54364124, "comment_id": 95543012, "body": "Oh okay. so that won&#39;t work. How else can I change the value of the tuple without the tuple constructor (,)"}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1548417292, "post_id": 54364124, "comment_id": 95543364, "body": "Yes, for the edited question, the type of <code>mult</code> function should be <code>mult :: Int -&gt; Int -&gt; (String,())</code> not <code>(String, Int)</code>. What does the <code>Int</code> value you want put to second element of the tuple?"}, {"owner": {"reputation": 147, "user_id": 6838782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356f31873735c15aaa2421c68c5a2df1?s=128&d=identicon&r=PG", "display_name": "Dortmunder", "link": "https://stackoverflow.com/users/6838782/dortmunder"}, "reply_to_user": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1548417936, "post_id": 54364124, "comment_id": 95543688, "body": "The type is given and can&#39;t be changed. The second parameter is the result of the mulitplikation. Can&#39;t say why, it just needs to be there."}, {"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 0, "creation_date": 1548419813, "post_id": 54364124, "comment_id": 95544612, "body": "Okay, the variable in Haskell is immutable, you can&#39;t change it. The only way to construct a <code>(String, Int)</code> pair, you have to create an new one."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1548426550, "post_id": 54364124, "comment_id": 95548322, "body": "Which <code>Int</code> is <code>mult</code> supposed to include in its return value?"}], "answers": [{"tags": [], "owner": {"reputation": 1104, "user_id": 9769772, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Koralp Catalsakal", "link": "https://stackoverflow.com/users/9769772/koralp-catalsakal"}, "is_accepted": false, "score": 0, "last_activity_date": 1548419896, "creation_date": 1548419896, "answer_id": 54365501, "question_id": 54364124, "link": "https://stackoverflow.com/questions/54364124/how-to-make-string-int-from-string/54365501#54365501", "title": "How to make (String,Int) from (String,())?", "body": "<p>I couldn't find a method that directly updates the values in a tuple without using the constructor, so I had to write it in an inefficient way. But this one does not use the tuple constructor: </p>\n\n<pre><code>mult m1 m2 = head $ zip [fst $ logOp m1 m2 (m1*m2) \"*\"] [m1*m2]\n</code></pre>\n\n<p>So the <code>zip</code> function creates list of tuples out of two lists and then using the <code>head</code> function we extract the first element as a tuple and the <code>fst</code> function extracts the String from (String,()) pair.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 1, "last_activity_date": 1548421435, "creation_date": 1548421435, "answer_id": 54365889, "question_id": 54364124, "link": "https://stackoverflow.com/questions/54364124/how-to-make-string-int-from-string/54365889#54365889", "title": "How to make (String,Int) from (String,())?", "body": "<p>Usually, when dealing with monads, one uses the monadic functions <code>return</code> and <code>(&gt;&gt;=)</code>. You are already using <code>(&gt;&gt;=)</code> implicitly in your <code>do</code> block.</p>\n\n<p>For <code>mult</code>, you can try using a <code>do</code> and use <code>return</code> inside that. In this very specific case, you can assume that <code>return</code> is defined as</p>\n\n<pre><code>return :: Int -&gt; (String, Int)\nreturn x = (\"\", x)\n</code></pre>\n\n<p>(In the general case, it's polymorphic: <code>return :: a -&gt; (String, a)</code>)</p>\n"}], "owner": {"reputation": 147, "user_id": 6838782, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356f31873735c15aaa2421c68c5a2df1?s=128&d=identicon&r=PG", "display_name": "Dortmunder", "link": "https://stackoverflow.com/users/6838782/dortmunder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1548421435, "creation_date": 1548414603, "last_edit_date": 1548417086, "question_id": 54364124, "link": "https://stackoverflow.com/questions/54364124/how-to-make-string-int-from-string", "title": "How to make (String,Int) from (String,())?", "body": "<p>For an exercise on WriterMonads I need to make a function that logs what it does. I mustn't use the tuple constructor (,).</p>\n\n<p>I have an log function already with the result type (String,())\nNow I need to use this one but with the result type (String,Int)</p>\n\n<p>But i don't get how to make a (String,()) tuple to (String,Int) </p>\n\n<pre><code>logMsg :: String -&gt; (String,())\nlogMsg  msg = (msg,()) -- Durch L\u00f6sung ersetzen.\n\nlogOp :: Int -&gt; Int -&gt; Int -&gt; String -&gt; (String,())\nlogOp v1 v2 res math = do\n    logMsg \"The value of \"\n    logMsg $ show v1\n    logMsg  math\n    logMsg $ show v2\n    logMsg \" is \"\n    logMsg $ show res\n    logMsg \".\\n\"\n\n\nmult :: Int -&gt; Int -&gt; (String,Int)\nmult m1 m2 = logOp m1 m2 (m1*m2) \"*\"\n</code></pre>\n\n<p>I tested that </p>\n\n<pre><code>logOp m1 m2 (m1*m2) \"*\"\n</code></pre>\n\n<p>does the right result of type (String,())</p>\n\n<p>I have no idea, any hints?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "edited": false, "score": 2, "creation_date": 1548394920, "post_id": 54359356, "comment_id": 95533460, "body": "You need to give <code>else</code> part for <code>if (there + 1) &lt;= 2 then 3</code> expression. In Haskell, <code>if</code> expression must have <code>then</code> and <code>else</code>."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "reply_to_user": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1548397932, "post_id": 54359356, "comment_id": 95534455, "body": "It&#39;s a good attempt, thank you for including code.  @wizzup Why was the provided code not a MCVE in your view?  It was the code used, it has a syntax error that believably causes the parse error.  Given the asker&#39;s clear misunderstandings any further attempt to minimize probably changed the error and added to the confusion."}, {"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1548399579, "post_id": 54359356, "comment_id": 95535014, "body": "@ThomasM.DuBuisson, A simple re-indent show me that last <code>if</code> has no <code>else</code>. <a href=\"https://pastebin.com/BeeGWP9i\" rel=\"nofollow noreferrer\">pastebin.com/BeeGWP9i</a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1548408905, "post_id": 54359356, "comment_id": 95539016, "body": "I&#39;d tend to avoid using both <code>let</code> and <code>where</code>, when possible. In the code above, I&#39;d put both definitions inside the <code>let</code> (provided you actually need those definitions)."}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1549128573, "post_id": 54359356, "comment_id": 95796588, "body": "disregarding the actual code errors in your question, purely indentation-based errors are fixed with the use of explicit markings like <code>{</code>, <code>;</code>, <code>|</code>, <code>}</code>, making the code wholly space-insensitive again."}], "answers": [{"comments": [{"owner": {"reputation": 2181, "user_id": 7058735, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GxhO2.png?s=128&g=1", "display_name": "K Split X", "link": "https://stackoverflow.com/users/7058735/k-split-x"}, "edited": false, "score": 0, "creation_date": 1548420342, "post_id": 54360002, "comment_id": 95544871, "body": "Thanks for the code, explanation, and link. I will check it out and understand further misunderstanding. Thanks again"}], "tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 8, "last_activity_date": 1548397682, "creation_date": 1548397682, "answer_id": 54360002, "question_id": 54359356, "link": "https://stackoverflow.com/questions/54359356/how-to-fix-indentation-problem-with-haskell-if-statement/54360002#54360002", "title": "How to fix indentation problem with haskell if statement", "body": "<p>You have a few misunderstandings in here.  Let's step through them starting from your original code:</p>\n\n<pre><code>f x =\n</code></pre>\n\n<p>A function definition, but the function never uses the parameter <code>x</code>.  Strictly speaking this is a warning and not an error, but most code bases will use <code>-Werror</code> so consider omitting the parameter or using <code>_</code> to indicate you are explicitly ignoring the variable.</p>\n\n<pre><code>  let var1 = there in\n</code></pre>\n\n<p>This is unnecessary - again you are not using <code>var1</code> (the below used <code>there</code>) so why have it?</p>\n\n<pre><code>  case (there) of\n</code></pre>\n\n<p>Sure.  Or just <code>case there of</code>, not need for excessive parens cluttering up the code.</p>\n\n<pre><code>    12 -&gt; 0\n</code></pre>\n\n<p>Here <code>12</code> is a pattern match, and it's fine.</p>\n\n<pre><code>    otherwise -&gt;\n</code></pre>\n\n<p>Here you used the variable name <code>otherwise</code> as a pattern which will uncondtionally match the value <code>there</code>.  This is another warning: <code>otherwise</code> is a global value equal to <code>True</code> so it can be used in guards, such as <code>function foo | foo &lt; 1 = expr1  ; | otherwise = expr2</code>.  Your use is not like that, using <code>otherwise</code> as a pattern shadows the global value.  Instead consider the catch all pattern with underscore:</p>\n\n<pre><code>_ -&gt; if (there - 1) &gt;= 4\n         then 2\n         else if (there + 1) &lt;= 2\n                 then 3\n  where there = 6\n</code></pre>\n\n<p>Ok... what if <code>there</code> was equal to 3?  <code>3-1</code> is not greater than 4.  <code>3+1</code> is not less than 2.  You always need an <code>else</code> with your if statement.  There is no <code>if {}</code> in Haskell instead there is <code>if ... else ...</code> much like the ternary operator in C, as <a href=\"https://wiki.haskell.org/Common_Misunderstandings#If_.2F_Then_.2F_Else\" rel=\"noreferrer\">explained in the Haskell wiki</a>.</p>\n"}], "owner": {"reputation": 2181, "user_id": 7058735, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GxhO2.png?s=128&g=1", "display_name": "K Split X", "link": "https://stackoverflow.com/users/7058735/k-split-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 54360002, "answer_count": 1, "score": 0, "last_activity_date": 1548397682, "creation_date": 1548393708, "question_id": 54359356, "link": "https://stackoverflow.com/questions/54359356/how-to-fix-indentation-problem-with-haskell-if-statement", "title": "How to fix indentation problem with haskell if statement", "body": "<p>I have the following Haskell code:</p>\n\n<pre><code>f :: Int -&gt; Int\nf x =\n  let var1 = there in\n  case (there) of\n    12 -&gt; 0 \n    otherwise | (there - 1) &gt;= 4 -&gt; 2\n              | (there + 1) &lt;= 2 -&gt; 3\n\n  where there = 6\n</code></pre>\n\n<p>The function alone is garbage, ignore what exactly it does.</p>\n\n<p>I want to replace the guards with if</p>\n\n<pre><code>f x =\n  let var1 = there in\n  case (there) of\n    12 -&gt; 0 \n    otherwise -&gt; if (there - 1) &gt;= 4 then 2\n                    else if (there + 1) &lt;= 2 then 3\n\n  where there = 6\n</code></pre>\n\n<p>I tried moving the if to the next line, the then to the next line, lining them up, unlining them, but nothing seems to work.</p>\n\n<p>I get a parsing error and I don't know how to fix it:</p>\n\n<pre><code>    parse error (possibly incorrect indentation or mismatched brackets)\n   |\n40 |   where there = 6\n   |   ^\n</code></pre>\n"}, {"tags": ["haskell", "conduit"], "answers": [{"tags": [], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "is_accepted": false, "score": 0, "last_activity_date": 1548437794, "last_edit_date": 1548437794, "creation_date": 1548436440, "answer_id": 54369926, "question_id": 54357690, "link": "https://stackoverflow.com/questions/54357690/how-to-fix-this-conduit-code-invovling-the-appearance-of-a-list-type-where-i-do/54369926#54369926", "title": "How to fix this Conduit code invovling the appearance of a list type where I do not expect one?", "body": "<p>I came up with a solution after getting some sleep and spending some more time on it. I still don't quite understand why some things I tried didn't work, but I'm reasonably happy with the end result (if not the path I took to get there, but <a href=\"https://www.psychologytoday.com/us/blog/memory-medic/201106/learning-no-pain-no-gain\" rel=\"nofollow noreferrer\">learning is pain</a>, at least sometimes). The major difference here is that I decided re-use the <code>sourceDirectoryDeep</code> conduit (<code>files</code> now) instead of trying to turn it into a vector directly. I also had to be a little more clever with how I wrote <code>processCSV</code>, which did involve one false turn that still confuses me (<a href=\"https://stackoverflow.com/questions/54369376/why-can-one-sometimes-get-no-instance-for-csv-text-text-arising-from-a-use-of\">Why can one sometimes get &quot;No instance for CSV Text Text arising from a use of `intoCSV`&quot; when using csv-conduit?</a>).</p>\n\n<pre><code>retrieveSmaXtec :: Path Abs Dir -&gt; IO (Vector SxRecord)\nretrieveSmaXtec sxDir = do\n  csvRows &lt;- getCsvRows\n  fnameRows &lt;- getFileNameRows\n  rows &lt;- return $ pairFill fnameRows csvRows &amp; fmap (uncurry DM.union)\n  print rows\n  rows &amp; fmap fromRow &amp; catMaybes &amp; return\n  where\n    getCsvRows :: IO (Vector (Vector (MapRow Text)))\n    getCsvRows = files .| processCSV &amp; runConduitRes\n\n    getFileNameRows :: IO (Vector (MapRow Text))\n    getFileNameRows = files .| processFileName &amp; runConduitRes\n\n    files :: MonadResource m =&gt; ConduitT () FilePath m ()\n    files = sourceDirectoryDeep False (fromAbsDir sxDir)\n\n    expandZip :: MapRow Text -&gt; Vector (MapRow Text) -&gt; Vector (MapRow Text, MapRow Text)\n    expandZip one many_ = zip (replicate mlen one) many_\n      where\n        mlen = length many_\n\n    pairFill :: Vector (MapRow Text) -&gt; Vector (Vector (MapRow Text)) -&gt; Vector (MapRow Text, MapRow Text)\n    pairFill ones manies = join $ fmap (uncurry expandZip) (zip ones manies)\n\n    processCSV :: (MonadResource m, MonadThrow m, PrimMonad m) =&gt;\n      ConduitT FilePath Void m (Vector (Vector (MapRow Text)))\n    processCSV = mapMC (readCSVFile defCSVSettings) .| sinkVector\n\n    processFileName :: (MonadResource m, MonadThrow m, PrimMonad m) =&gt;\n      ConduitT FilePath Void m (Vector (MapRow Text))\n    processFileName = mapC go\n      .| sinkVector\n      where\n        go :: FilePath -&gt; MapRow Text\n        go fp = takeFileName fp\n          &amp; takeWhile (/= '.')\n          &amp; splitOn \"_\"\n          &amp; fmap Txt.pack\n          &amp; zip colNames\n          &amp; DM.fromList\n        colNames = [markKey, idKey]\n</code></pre>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1548437794, "creation_date": 1548378817, "question_id": 54357690, "link": "https://stackoverflow.com/questions/54357690/how-to-fix-this-conduit-code-invovling-the-appearance-of-a-list-type-where-i-do", "title": "How to fix this Conduit code invovling the appearance of a list type where I do not expect one?", "body": "<p>I've been struggling with this Conduit code for a while, any help would be extremely appreciated. It is sort of like this code has been evolving by random mutation while the type checker is enforcing natural selection. Here is one of the fittest candidates I have so far:</p>\n\n<pre><code>import           Conduit\nimport qualified Data.Conduit.Combinators       as DCC\nimport           Data.CSV.Conduit\nimport           Data.Function                  ((&amp;))\nimport           Data.List.Split                (splitOn)\nimport           Data.Map                       as DM\nimport           Data.Text                      (Text)\nimport qualified Data.Text                      as Txt\nimport qualified Data.Text.IO                   as DTIO\nimport           Data.Vector                    (Vector)\nimport qualified Data.Vector                    as DV\nimport           Path\nimport           System.FilePath.Posix\n\nretrieveSmaXtec :: Path Abs Dir -&gt; IO (Vector (MapRow Text))\nretrieveSmaXtec sxDir = do\n  files &lt;- sourceDirectoryDeep False (fromAbsDir sxDir) &amp; return\n  fileVector &lt;- return $ runConduit $ files .| sinkVector\n  csvRowsByFile &lt;- runConduit ((yieldM fileVector) .| DCC.mapM processCSV .| sinkVector)\n  fNameRows &lt;- readFnameData $ yieldM fileVector\n  (pairFill fNameRows csvRowsByFile)\n    &amp; fmap (uncurry DM.union)\n    &amp; return\n  where\n    fileList :: Path Abs Dir -&gt; IO (Vector FilePath)\n    fileList dir = sourceDirectoryDeep False (fromAbsDir sxDir) .| sinkVector &amp; runConduit\n\n    expandZip :: MapRow Text -&gt; Vector (MapRow Text) -&gt; Vector (MapRow Text, MapRow Text)\n    expandZip one many = zip (replicate mlen one) many\n      where\n        mlen = length many\n\n    pairFill :: Vector (MapRow Text) -&gt; Vector (Vector (MapRow Text)) -&gt; Vector (MapRow Text, MapRow Text)\n    pairFill ones manies = join $ fmap (uncurry expandZip) (zip ones manies)\n\n    processCSV :: FilePath -&gt; IO (Vector (MapRow Text))\n    processCSV fp = sourceFile fp\n      .| intoCSV defCSVSettings\n      .| sinkVector\n      &amp; runConduitRes\n    readFnameData :: (MonadThrow m, MonadResource m, PrimMonad m) =&gt; ConduitT () FilePath m () -&gt; m (Vector (MapRow Text))\n    readFnameData files = runConduit $ files .| processFileName .| sinkVector\n\n    processFileName :: (MonadResource m, MonadThrow m, PrimMonad m) =&gt;\n      ConduitT FilePath (MapRow Text) m ()\n    processFileName = mapC go\n      where\n        go :: FilePath -&gt; MapRow Text\n        go fp = takeFileName fp\n          &amp; takeWhile (/= '.')\n          &amp; splitOn \"_\"\n          &amp; fmap Txt.pack\n          &amp; zip colNames\n          &amp; DM.fromList\n        colNames = [markKey, idKey]\n</code></pre>\n\n<p>The current point of confusion that occurs in both errors below is that <code>[FilePath]</code> is popping up, when I expect everything to just be <code>FilePath</code>. Now, even if this is fixed, I wouldn't doubt other errors could pop up, so if there's a solution for getting this going that involves a bit of a rework, I'd be happy to try it.</p>\n\n<pre><code>    * Couldn't match type `Char' with `[Char]'\n      Expected type: ConduitM\n                       [FilePath] Void IO (Vector (Vector (MapRow Text)))\n        Actual type: ConduitM\n                       FilePath Void IO (Vector (Vector (MapRow Text)))\n    * In the second argument of `(.|)', namely\n        `DCC.mapM processCSV .| sinkVector'\n      In the first argument of `runConduit', namely\n        `((yieldM fileVector) .| DCC.mapM processCSV .| sinkVector)'\n      In a stmt of a 'do' block:\n        csvRowsByFile &lt;- runConduit\n                           ((yieldM fileVector) .| DCC.mapM processCSV .| sinkVector)\n   |\n40 |   csvRowsByFile &lt;- runConduit ((yieldM fileVector) .| DCC.mapM processCSV .| sinkVector)\n   |                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n    * Couldn't match type `[Char]' with `Char'\n      Expected type: ConduitT () FilePath IO ()\n        Actual type: ConduitT () [FilePath] IO ()\n    * In the second argument of `($)', namely `yieldM fileVector'\n      In a stmt of a 'do' block:\n        fNameRows &lt;- readFnameData $ yieldM fileVector\n      In the expression:\n        do files &lt;- sourceDirectoryDeep False (fromAbsDir sxDir) &amp; return\n           fileVector &lt;- return $ runConduit $ files .| sinkVector\n           csvRowsByFile &lt;- runConduit\n                              ((yieldM fileVector) .| DCC.mapM processCSV .| sinkVector)\n           fNameRows &lt;- readFnameData $ yieldM fileVector\n           ....\n   |\n41 |   fNameRows &lt;- readFnameData $ yieldM fileVector\n   |                                ^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>This question started in an alternative form at <a href=\"https://stackoverflow.com/questions/54348243/how-to-merge-one-to-one-and-one-to-many-inputoutput-relationships-in-conduit\">How to merge one-to-one and one-to-many input:output relationships in conduit?</a> but now I'm just trying to get it to work, <em>somehow</em>, <em>anyhow</em>.</p>\n"}, {"tags": ["haskell", "haskell-lens", "impredicativetypes"], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 3190654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c321c5241605255cae9ecf3fb2dffc0b?s=128&d=identicon&r=PG", "display_name": "bergey", "link": "https://stackoverflow.com/users/3190654/bergey"}, "is_accepted": false, "score": 2, "last_activity_date": 1548367391, "creation_date": 1548367391, "answer_id": 54356000, "question_id": 54355538, "link": "https://stackoverflow.com/questions/54355538/hold-a-lens-in-a-record/54356000#54356000", "title": "Hold a lens in a record", "body": "<p>I believe the usual solution are rank-1 types like <a href=\"https://hackage.haskell.org/package/lens-4.17/docs/Control-Lens-Lens.html#t:ALens\" rel=\"nofollow noreferrer\">ALens</a>.  I don't know if the <code>microlens</code> family provides something similar.</p>\n\n<p>The <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#impredicative-polymorphism\" rel=\"nofollow noreferrer\">GHC manual</a> explains the problem &amp; the solution.  It begins:</p>\n\n<blockquote>\n  <p>In general, GHC will only instantiate a polymorphic function at a monomorphic type (one with no foralls). [...] The definition of foo is rejected because one would have to instantiate id\u2018s type with <code>b := (forall s. ST s a) -&gt; a</code>, and that is not allowed. Instantiating polymorphic type variables with polymorphic types is called impredicative polymorphism.</p>\n</blockquote>\n"}], "owner": {"reputation": 3874, "user_id": 3699131, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mCbVB.jpg?s=128&g=1", "display_name": "F. B&#246;ller", "link": "https://stackoverflow.com/users/3699131/f-b%c3%b6ller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1548367391, "creation_date": 1548365170, "question_id": 54355538, "link": "https://stackoverflow.com/questions/54355538/hold-a-lens-in-a-record", "title": "Hold a lens in a record", "body": "<p>I have a record <code>MyRecord</code> for which I create lenses with <code>makeLenses</code>.\nI would like to have a field in that record which holds itself a lens but that is also accessible with a lens like the other fields.</p>\n\n<p>This is my code to achieve this:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell #-}\n{-# LANGUAGE RankNTypes #-}\n\nmodule Check where\n\nimport Lens.Micro ( Lens' )\nimport Lens.Micro.TH ( makeLenses )\n\ndata MyRecord a = \n  MyRecord { _normalField :: Int\n           , _myField :: Lens' (String, String) a \n           }\n\nmakeLenses ''MyRecord\n</code></pre>\n\n<p>The code compiles fine if I write <code>myField</code> instead of <code>_myField</code> but this way no lens would be generated for it.</p>\n\n<p>For the given code <code>ghc</code> outputs</p>\n\n<pre><code>/home/fabian/src/code-editor/app/Check.hs:11:1: error:\n    \u2022 Illegal polymorphic type: Lens' (String, String) a2\n      GHC doesn't yet support impredicative polymorphism\n    \u2022 In the type signature:\n        myField :: forall a_a5c6 a_a8tU.\n                   Lens.Micro.Type.Lens (MyRecord a_a5c6) (MyRecord a_a8tU) (Lens' (String,\n                                                                                    String) a_a5c6) (Lens' (String,\n                                                                                                            String) a_a8tU)\n   |\n11 | makeLenses ''MyRecord\n\n</code></pre>\n\n<p>Can someone briefly explain what is going on here and if there is a nice solution to this?</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1548364180, "post_id": 54354800, "comment_id": 95525806, "body": "Tthe issue maybe be related to the fact that runConduit requires unit (<code>()</code>) for the input field of <code>ConduitT</code>, and for some reason, <code>sinkVector</code> is returning a non-unit field here (not sure why). In particular it is <code>MapRow Text</code> instead of <code>()</code>."}], "answers": [{"tags": [], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "is_accepted": false, "score": 0, "last_activity_date": 1548365943, "creation_date": 1548365943, "answer_id": 54355691, "question_id": 54354800, "link": "https://stackoverflow.com/questions/54354800/why-do-i-get-a-non-vector-type-when-using-sinkvector-runconduit/54355691#54355691", "title": "Why do I get a non-vector type when using sinkVector &amp; runConduit?", "body": "<p>I can corrected the intermediate functions to be</p>\n\n<pre><code>readFnameData2 ::MonadResource m =&gt; ConduitT () FilePath m ()\n  -&gt; ConduitT () Void m (Vector (MapRow Text))\nreadFnameData2 files = files\n    .| processFileName\n    .| sinkVector\n\nreadFnameData3 ::MonadResource m =&gt; ConduitT () FilePath m ()\n  -&gt; m (Vector (MapRow Text))\nreadFnameData3 files = runConduit (readFnameData2 files)\n</code></pre>\n\n<p>The issue here was that <code>files</code> should have had the unit input type, being a source!</p>\n\n<pre><code>readFnameData ::MonadResource m =&gt; ConduitT () FilePath m () -&gt; m (Vector (MapRow Text))\nreadFnameData files = runConduit $ files .| processFileName .| sinkVector\n</code></pre>\n"}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1548365943, "creation_date": 1548361567, "last_edit_date": 1548364706, "question_id": 54354800, "link": "https://stackoverflow.com/questions/54354800/why-do-i-get-a-non-vector-type-when-using-sinkvector-runconduit", "title": "Why do I get a non-vector type when using sinkVector &amp; runConduit?", "body": "<p>I have a conduit with this type signature:</p>\n\n<pre><code>processFileName :: (MonadResource m, MonadThrow m, PrimMonad m) =&gt;\n  ConduitT FilePath (MapRow Text) m ()\n</code></pre>\n\n<p>The following conduit constructor that uses it type checks:</p>\n\n<pre><code>readFnameData2 ::MonadResource m =&gt; ConduitT (MapRow Text) FilePath m ()\n  -&gt; ConduitT (MapRow Text) Void m (Vector (MapRow Text))\nreadFnameData2 files = files\n    .| processFileName\n    .| sinkVector\n</code></pre>\n\n<p>However, when I try to modify this to actually return a <code>Vector</code> in the <code>IO</code> monad, I get an unexpected result:</p>\n\n<pre><code>readFnameData ::MonadResource m =&gt; ConduitT (MapRow Text) FilePath m () -&gt; IO (Vector (MapRow Text))\nreadFnameData files = do\n  fNameRows &lt;- files\n   .| processFileName\n   .| sinkVector\n  fNameRows &amp; runConduit\n</code></pre>\n\n<p>yields the error:</p>\n\n<pre><code>    * Couldn't match type `Map Text Text' with `Vector (MapRow Text)'\n      Expected type: IO (Vector (MapRow Text))\n        Actual type: IO (MapRow Text)\n    * In a stmt of a 'do' block: fNameRows &amp; runConduit\n      In the expression:\n        do fNameRows &lt;- files .| processFileName .| sinkVector\n           fNameRows &amp; runConduit\n      In an equation for `readFnameData':\n          readFnameData files\n            = do fNameRows &lt;- files .| processFileName .| sinkVector\n                 fNameRows &amp; runConduit\n   |\n70 |       fNameRows &amp; runConduit\n   |       ^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I feel I must be missing something basic here, but not sure what to look at to uncover the mystery.</p>\n\n<p><strong>Update:</strong> To elaborate on my first comment below, we can see the intermediate <code>ConduitT</code> error:</p>\n\n<pre><code>    readFnameData3 ::MonadResource m =&gt; ConduitT (MapRow Text) FilePath m ()\n      -&gt; IO (Vector (MapRow Text))\n    readFnameData3 files = runConduit (readFnameData2 files)\n\n    * Couldn't match type `Map Text Text' with `()'\n      Expected type: ConduitT () Void m (Vector (MapRow Text))\n        Actual type: ConduitT (MapRow Text) Void m (Vector (MapRow Text))\n    * In the first argument of `runConduit', namely\n        `(readFnameData2 files)'\n      In the expression: runConduit (readFnameData2 files)\n      In an equation for `readFnameData3':\n          readFnameData3 files = runConduit (readFnameData2 files)\n   |\n67 |     readFnameData3 files = runConduit (readFnameData2 files)      \n   |                                        ^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>This shows a mismatch in type for the first field of <code>ConduitT</code>. Not sure why <code>sinkVector</code> is not returning a unit type for this, since all the  <code>runConduit*</code> seem to have unit in this position, and as it is a sink, it can't accept further meaningful inputs, so I guess it would sort of make sense for this to be <code>()</code> - though not sure why <code>Void</code> isn't a better option.</p>\n"}, {"tags": ["function", "haskell", "recursion", "functional-programming"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 6, "creation_date": 1548356613, "post_id": 54353665, "comment_id": 95522466, "body": "what did you try? What did not work?"}, {"owner": {"reputation": 27561, "user_id": 214446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5deb6b87326686b1f2e9fdb37ceac210?s=128&d=identicon&r=PG", "display_name": "mb21", "link": "https://stackoverflow.com/users/214446/mb21"}, "edited": false, "score": 3, "creation_date": 1548357394, "post_id": 54353665, "comment_id": 95522815, "body": "you could do it with list comprehension: <a href=\"http://learnyouahaskell.com/starting-out\" rel=\"nofollow noreferrer\">learnyouahaskell.com/starting-out</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9156598"}, "edited": false, "score": 0, "creation_date": 1548357865, "post_id": 54353665, "comment_id": 95523032, "body": "Just edited it and added what I tried.  The list comprehension is x such that x is in a and x is in b. Not sure why I get this output"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1548358418, "post_id": 54353665, "comment_id": 95523277, "body": "You can&#39;t extract the same <code>x</code> twice in Haskell. You can, however, extract <code>y</code> from the second list and then require <code>x==y</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9156598"}, "edited": false, "score": 0, "creation_date": 1548358709, "post_id": 54353665, "comment_id": 95523395, "body": "Thanks, just tried [(x, y) | x &lt;- a, y &lt;- b, x == y] however it doesn&#39;t deal with the repetitions. Thanks, I can manage it know"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1548359297, "post_id": 54353665, "comment_id": 95523684, "body": "I think the easiest solution here is using the <code>Set</code> type (in <code>Data.Set</code>)."}, {"owner": {"reputation": 28376, "user_id": 5743988, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/IeSSM.jpg?s=128&g=1", "display_name": "4castle", "link": "https://stackoverflow.com/users/5743988/4castle"}, "edited": false, "score": 0, "creation_date": 1548363094, "post_id": 54353665, "comment_id": 95525367, "body": "<code>length (filter (`elem` a) b)</code>"}, {"owner": {"reputation": 893, "user_id": 6248287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tPegr.jpg?s=128&g=1", "display_name": "\u019b\u019b\u019b", "link": "https://stackoverflow.com/users/6248287/%c6%9b%c6%9b%c6%9b"}, "edited": false, "score": 3, "creation_date": 1548367767, "post_id": 54353665, "comment_id": 95527256, "body": "here are the functions you can use:  nub: <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:nub\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>  intersect: <a href=\"http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-List.html#v:intersect\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.12.0.0/docs/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 0, "creation_date": 1548365910, "post_id": 54354744, "comment_id": 95526519, "body": "I don&#39;t think this exactly matches what the OP is after. It&#39;s fine in the examples you give, but if <code>a</code> contains duplicate elements, your function will also duplicate them in the output. (See the example they gave of <code>f [1, 2, 4, 2] [2, 3, 4, 4] returning 2</code>.) This is why I suggested using <code>Set</code>s. (An alternative would be using your solution alongside <code>nub</code>, but I think that is much less efficient if the lists become larger.)"}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 2, "last_activity_date": 1548361350, "creation_date": 1548361350, "answer_id": 54354744, "question_id": 54353665, "link": "https://stackoverflow.com/questions/54353665/how-many-elements-from-one-list-are-present-in-the-other-list/54354744#54354744", "title": "How many elements from one list are present in the other list", "body": "<p>You don't want to extract an <code>x</code> from both lists; extract from <em>one</em> list, and check if it is present in the other.</p>\n\n<pre><code>&gt; a = [1,2,3]\n&gt; b = [4,3,2]\n&gt; [x | x &lt;- a, x `elem` b]\n[2,3]\n&gt; [x | x &lt;- b, x `elem` a]\n[3,2]\n</code></pre>\n\n<p>Note that the order in which items appear in the result depends on the order in which they appear in the list you pull from.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9156598"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 54354744, "answer_count": 1, "score": -2, "last_activity_date": 1548380615, "creation_date": 1548356551, "last_edit_date": 1548380615, "question_id": 54353665, "link": "https://stackoverflow.com/questions/54353665/how-many-elements-from-one-list-are-present-in-the-other-list", "title": "How many elements from one list are present in the other list", "body": "<p>I can't seem to be able to create a function that takes two lists as arguments and returns how many elements there are common in both lists.\ne.g. f [1, 2, 4, 2] [2, 3, 4, 4] returning 2 (repetitions are ignored).\nAny suggestions? I tried this</p>\n\n<pre><code>*Main&gt; a = [1, 2, 3]\n*Main&gt; b = [2, 3, 4]\n*Main&gt; [x | x &lt;- a, x &lt;- b]\n[2,3,4,2,3,4,2,3,4]\n</code></pre>\n\n<p>Then I was planning to use the length function to know how many item there are in common.</p>\n"}, {"tags": ["haskell", "z3", "sbv"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1548366589, "post_id": 54352167, "comment_id": 95526819, "body": "You can make an <code>SBool</code> for each pair of people that represents whether one is an ancestor of the other, constrain them recursively, and use <code>sat</code> to get the values. But that doesn&#39;t really get you where you want to go (namely using symbolic people in a meaningful way). But... why do you want to involve a SAT solver at all if you already have a non-symbolic program which computes the thing you care about (namely, <code>getAncestors</code>)?"}, {"owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548401817, "post_id": 54352167, "comment_id": 95535892, "body": "@DanielWagner I want to solve this problem using sbv (smt/sat) because it is part of a larger csp - my goal is to formulate the whole problem compositionaly in sbv&#39;s Symbolic Monad. Can you please explain why the formulation of the problem above does not work? I assume it has something to do with sbv trying to merge / unify the results of the call to &#39;getAncestors&#39; but I don&#39;t understand why such a merge would be necessary in the first place (as all the values in the list should all be symbolic constants) ..."}], "answers": [{"comments": [{"owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "edited": false, "score": 0, "creation_date": 1548523591, "post_id": 54374534, "comment_id": 95574947, "body": "Thank you for taking the time to write this detailed and understandable answer - and for putting so much work and knowledge into SBV! It&#39;s highly appreciated ..."}], "tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": true, "score": 3, "last_activity_date": 1548489374, "last_edit_date": 1548489374, "creation_date": 1548462341, "answer_id": 54374534, "question_id": 54352167, "link": "https://stackoverflow.com/questions/54352167/trying-to-solve-constraint-over-ancestor-relation-with-sbv/54374534#54374534", "title": "Trying to solve Constraint over Ancestor Relation with SBV", "body": "<p>The error message you get from SBV is truly cryptic, which doesn't really help, unfortunately. I've just pushed a patch to github, and the new error message is, I hope, a little better:</p>\n\n<pre><code>*** Exception:\n*** Data.SBV.Mergeable: Cannot merge instances of lists.\n*** While trying to do a symbolic if-then-else with incompatible branch results.\n***\n*** Branches produce different sizes: 1 vs 0\n***\n*** Hint: Use the 'SList' type (and Data.SBV.List routines) to model fully symbolic lists.\n</code></pre>\n\n<p>What SBV is trying to tell you is that when you have a symbolic if-then-else (as in your <code>getSAncestor</code> function) which returns a <em>Haskell</em> list of <code>SBV Person</code>'s, then it cannot merge those branches unless each branch of the <code>ite</code> has exactly the same number of elements.</p>\n\n<h1>The problem</h1>\n\n<p>You might, of course, ask why there is such a restriction. Consider the following expression:</p>\n\n<pre><code>ite cond [s0, s1] [s2, s3, s4]\n</code></pre>\n\n<p>Intuitively, this should mean:</p>\n\n<pre><code>[ite cond s0 s2, ite cond s1 s3, ite cond ??? s4]\n</code></pre>\n\n<p>Unfortunately, there's nothing for SBV to substitute for the <code>???</code>, and hence the error message. I hope that makes sense!</p>\n\n<h1>Two kinds of lists</h1>\n\n<p>SBV actually has two kinds of ways to represent a list of symbolic items. One is a good old Haskell <em>list</em> of symbolic values, as you were using; which is subject to the cardinality constraint I described above for each symbolic ite. The other is the fully symbolic list, that map to SMTLib sequences. Note that in both cases the size of the list is arbitrary but finite, but there's a difference in whether we treat the spine of the list symbolically or not.</p>\n\n<h2>Spine concrete symbolic lists</h2>\n\n<p>When you use a type like <code>[SBV a]</code>, you are essentially saying \"spine of this list is concrete, while the elements themselves are symbolic.\" This data type is most suitable when you know exactly how many elements you will have at each branch and they all have exactly the same size.</p>\n\n<p>These lists map to a much simpler representation through the backend, essentially the \"list\" part is all handled in Haskell and elements are symbolically represented pointwise. This allows many SMT solvers to be used, even those that don't understand symbolic sequences. On the flip side, you cannot have a symbolic spine as you found out.</p>\n\n<h2>Spine symbolic lists</h2>\n\n<p>The second kind, as you can guess, is the kind of list that the spine itself is symbolic, and thus can support arbitrary ite conditions with no cardinality constraints. These map directly to SMTLib sequences, and are much more flexible. The down side is, not all SMT solvers support sequences, and the sequence logic is not decidable in general, so solvers might respond <code>unknown</code>, if it happens that the query falls outside of what their algorithms can handle. (Another down side is that sequence logic, as supported by z3 and cvc4, is rather immature, so solvers themselves might have bugs. But those are always reportable!)</p>\n\n<h1>The solution</h1>\n\n<p>To address your problem, you simply need to use SBV's spine symbolic lists, known as <code>SList</code>. The modifications needed for your example program are relatively simple:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE TemplateHaskell     #-}\n{-# LANGUAGE StandaloneDeriving  #-}\n{-# LANGUAGE DeriveDataTypeable  #-}\n{-# LANGUAGE DeriveAnyClass      #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n\nimport Data.SBV\n\nimport Data.List\n\nimport Data.SBV.List as L\n\ndata Person\n  = Mary\n  | Richard\n  | Claudia\n  | Christian\n  | Stephen\n\nmkSymbolicEnumeration ''Person\n\n-- symbolic shorthands for person constructors\n[mary, richard, claudia, christian, stephen] =\n  map literal [Mary, Richard, Claudia, Christian, Stephen]\n\nchildOf :: [(Person, Person)]\nchildOf = [\n    (Mary, Richard) ,\n    (Richard, Christian),\n    (Christian, Stephen)]\n\ngetAncestors :: Person -&gt; [Person]\ngetAncestors p = go childOf p []\n  where\n    go [] _ acc = nub acc\n    go ((p1, p2): rels) a acc\n      | p1 == p = go rels p (p2:acc) ++ getAncestors p2\n      | otherwise = go rels a acc\n\n-- symbolic version of getAncestors\ngetSAncestors :: SBV Person -&gt; SList Person\ngetSAncestors p = ite (p .== mary)      (literal (getAncestors Mary))\n                $ ite (p .== richard)   (literal (getAncestors Richard))\n                $ ite (p .== claudia)   (literal (getAncestors Claudia))\n                $ ite (p .== christian) (literal (getAncestors Christian))\n                                        (literal (getAncestors Stephen))\n\ncspAncestors :: IO AllSatResult\ncspAncestors = allSat $ do\n  (person :: SBV Person) &lt;- free \"person\"\n  constrain $ sNot $ L.singleton stephen `L.isInfixOf` (getSAncestors person)\n</code></pre>\n\n<p>(Note: I had to change <code>bnot</code> to <code>sNot</code> since I'm using SBV 8.0 available from hackage; which had that name change. If you're using 7.12, you should keep the <code>bnot</code>. Also note the use of <code>SList Person</code> as opposed to <code>[SBV Person]</code>, which tells SBV to use spine symbolic lists.)</p>\n\n<p>When I run this, I get:</p>\n\n<pre><code>*Main&gt; cspAncestors\nSolution #1:\n  person = Claudia :: Person\nSolution #2:\n  person = Stephen :: Person\nFound 2 different solutions.\n</code></pre>\n\n<p>I haven't really checked whether the answer is correct, but I trust it should be! (If not, please report.)</p>\n\n<p>I hope that gives an overview of the problem and how to address it. While an SMT solver cannot beat a custom CSP solver, I think it can be a great alternative when you don't have a dedicated algorithm. Hopefully Haskell/SBV makes it easier to use!</p>\n"}], "owner": {"reputation": 1795, "user_id": 1839343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b26d97dd045ce61904e7c6d1a9775e0c?s=128&d=identicon&r=PG", "display_name": "jules", "link": "https://stackoverflow.com/users/1839343/jules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 54374534, "answer_count": 1, "score": 3, "last_activity_date": 1548489374, "creation_date": 1548350361, "question_id": 54352167, "link": "https://stackoverflow.com/questions/54352167/trying-to-solve-constraint-over-ancestor-relation-with-sbv", "title": "Trying to solve Constraint over Ancestor Relation with SBV", "body": "<p>I'm trying to solve the following csp involing an ancestor relation in Haskell using the <a href=\"http://hackage.haskell.org/package/sbv-7.12\" rel=\"nofollow noreferrer\">SBV Library</a> (Version 7.12):</p>\n\n<p><strong>Give me the set of all persons who don't descend from <em>Stephen</em>.</strong></p>\n\n<p>My solution (see below) gets the following exception </p>\n\n<pre><code>*** Exception: SBV.Mergeable.List: No least-upper-bound for lists of differing size (1,0)\n</code></pre>\n\n<p>Question: Is it possible to solve constraints like this using SBV / using an SMT Solver and if - how do I need to formulate the problem?</p>\n\n<p>My attempt at a solution:</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell     #-}\n{-# LANGUAGE StandaloneDeriving  #-}\n{-# LANGUAGE DeriveDataTypeable  #-}\n{-# LANGUAGE DeriveAnyClass      #-}\n\nmodule Main where\n\nimport Data.SBV\n\ndata Person\n  = Mary\n  | Richard\n  | Claudia\n  | Christian\n  | Stephen\n\nmkSymbolicEnumeration ''Person\n\n-- symbolic shorthands for person constructors\n[mary, richard, claudia, christian, stephen] =\n  map literal [Mary, Richard, Claudia, Christian, Stephen]\n\nchildOf :: [(Person, Person)]\nchildOf = [\n    (Mary, Richard) ,\n    (Richard, Christian),\n    (Christian, Stephen)]\n\ngetAncestors :: Person -&gt; [Person]\ngetAncestors p = go childOf p []\n  where\n    go [] _ acc = nub acc\n    go ((p1, p2): rels) a acc\n      | p1 == p = go rels p (p2:acc) ++ getAncestors p2\n      | otherwise = go rels a acc\n\n-- symbolic version of getAncestors\ngetSAncestors :: SBV Person -&gt; [SBV Person]\ngetSAncestors p = ite (p .== mary) (map literal (getAncestors Mary))\n                $ ite (p .== richard) (map literal (getAncestors Richard))\n                $ ite (p .== claudia) (map literal (getAncestors Claudia))\n                $ ite (p .== christian) (map literal (getAncestors Christian))\n                                        (map literal (getAncestors Stephen))\n\ncspAncestors :: IO AllSatResult\ncspAncestors = allSat $ do\n  (person :: SBV Person) &lt;- free_\n  constrain $ bnot $ stephen `sElem` (getSAncestors person)\n</code></pre>\n\n<p>Many thanks in advance!</p>\n"}, {"tags": ["haskell", "haskell-stack", "nix"], "comments": [{"owner": {"reputation": 1177, "user_id": 456551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7024df9e050fec69022dbbb02c49e0?s=128&d=identicon&r=PG", "display_name": "tylerweir", "link": "https://stackoverflow.com/users/456551/tylerweir"}, "edited": false, "score": 2, "creation_date": 1548348301, "post_id": 54351314, "comment_id": 95518416, "body": "I believe this issue was the reason Cachix was created - <a href=\"https://cachix.org/\" rel=\"nofollow noreferrer\">cachix.org</a>"}, {"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 1, "creation_date": 1548443252, "post_id": 54351314, "comment_id": 95557153, "body": "Why are you removing <code>.stack-work</code> anyway? It shouldn\u2019t be necessary in normal circumstances."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 2, "last_activity_date": 1548351226, "creation_date": 1548351226, "answer_id": 54352402, "question_id": 54351314, "link": "https://stackoverflow.com/questions/54351314/how-to-cache-a-haskell-dependency-to-speed-up-compilation-time/54352402#54352402", "title": "How to Cache a Haskell Dependency to Speed Up Compilation Time?", "body": "<p>For the currently released Stack, the best way to make this happen is to put the extra-dep into a custom snapshot file instead of the <code>extra-deps</code> in the stack.yaml file. (The upcoming Stack release has a feature referred to as \"implicit snapshots\" which sidesteps this.) You can see an example of this in the Stack repo itself:</p>\n\n<ul>\n<li><a href=\"https://github.com/commercialhaskell/stack/blob/master/stack.yaml#L1\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/blob/master/stack.yaml#L1</a></li>\n<li><a href=\"https://github.com/commercialhaskell/stack/blob/master/snapshot.yaml\" rel=\"nofollow noreferrer\">https://github.com/commercialhaskell/stack/blob/master/snapshot.yaml</a></li>\n</ul>\n"}], "owner": {"reputation": 5821, "user_id": 1770201, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/46bcb5d2018194c9beb884b6797e57e0?s=128&d=identicon&r=PG", "display_name": "George", "link": "https://stackoverflow.com/users/1770201/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1548351226, "creation_date": 1548347453, "question_id": 54351314, "link": "https://stackoverflow.com/questions/54351314/how-to-cache-a-haskell-dependency-to-speed-up-compilation-time", "title": "How to Cache a Haskell Dependency to Speed Up Compilation Time?", "body": "<p><strong>Problem:</strong> I'm working on a Haskell project that uses stack (+ nix). We have a dependency that takes 10+ minutes to compile. Every time we clean our <code>.stack-work</code>, we have to wait for this huge package to compile, and it's really hurting our project's efficiency.  The package name is <code>godot-haskell</code>, and here is how the package is depended upon in our <code>stack.yaml</code>:</p>\n\n<pre><code>extra-deps:\n- godot-haskell-0.1.0.0@sha256:9d92ff27c7b6c6d2155286f04ba2c432f96460f448fd976654ef26a84f0e35a6,26290\n</code></pre>\n\n<p><strong>Question:</strong> Is there a way for us to somehow cache this package (in stack, or even in nix) so that it locally never has to get compiled (or has to get compiled at most once, even if the <code>.stack-work</code> directory is deleted)?</p>\n"}, {"tags": ["haskell", "conduit"], "comments": [{"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1548345697, "post_id": 54348243, "comment_id": 95516817, "body": "<a href=\"https://hackage.haskell.org/package/stm-conduit-4.0.1/docs/Data-Conduit-TMChan.html#v:mergeConduits\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/stm-conduit-4.0.1/docs/&hellip;</a> looks potentially useful but 1) I need to learn more about STM/channels, 2) it is deprecated and I don&#39;t see where it says why (<b>update</b>: apparently this is why: <a href=\"https://github.com/cgaebel/stm-conduit/issues/49\" rel=\"nofollow noreferrer\">github.com/cgaebel/stm-conduit/issues/49</a>), and 3) I still don&#39;t see where it is possible to define the behavior of <i>how</i> the merge happens, but maybe the implementation would be a good place to look for experimentation - but don&#39;t really have the time to create my own STM conduit API at the moment."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1548359866, "post_id": 54348243, "comment_id": 95523917, "body": "It seems Conduit is mainly made for non-forking (linear) pipelines, so I&#39;m currently trying to split things up to this end ... still a WIP."}, {"owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "edited": false, "score": 0, "creation_date": 1548437505, "post_id": 54348243, "comment_id": 95554525, "body": "I found a workaround: <a href=\"https://stackoverflow.com/a/54369926/3096687\">stackoverflow.com/a/54369926/3096687</a> Not very stream-like, unsure if it is a good conduit-like solution, but it works."}], "owner": {"reputation": 7711, "user_id": 3096687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/31c95c0c159392d4c16fca6b55b5848d?s=128&d=identicon&r=PG", "display_name": "bbarker", "link": "https://stackoverflow.com/users/3096687/bbarker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1548337973, "creation_date": 1548337973, "question_id": 54348243, "link": "https://stackoverflow.com/questions/54348243/how-to-merge-one-to-one-and-one-to-many-inputoutput-relationships-in-conduit", "title": "How to merge one-to-one and one-to-many input:output relationships in conduit?", "body": "<p>I've been struggling with this problem for a while now, though to be fair, I've learned a lot about Conduit, since previously I was mostly using canned examples with a few exceptions.</p>\n\n<p>The basic problem is framed like this for conduits <code>A</code>, <code>B</code>, and <code>C</code>; <code>A .| B</code> (<code>A</code> feeds into <code>B</code>) and <code>A .| C</code>, and finally I need to have a function that takes B and C and produces an intermediate Conduit, call it <code>Merge B C</code>, so that I can do <code>(Merge B C) .| D</code>. My experience in non Haskell languages with FRP/streaming libraries suggest that there are several different ways to go about doing a \"Merge\" (e.g. the zip family of operations \"sample on\" - only produce new elements for <code>D</code> when one or more selected input conduits have a new value, etc).  I think my trouble is understanding how to do that in Conduit, if it is supported. </p>\n\n<p>Even more specifically for my particular problem today, <code>B</code> has a 1:1 relationship with <code>A</code>, whereas <code>C</code> has a many:1 relationship with <code>A</code>, and ultimately in <code>D</code> I want repeated elements of <code>B</code> combined with the corresponding elements of <code>C</code>: if <code>a~b</code> and <code>a~c</code> for <code>a</code> in <code>A</code>, <code>b</code> in <code>B</code>, and <code>c</code> in <code>C</code>, then <code>(b,c)</code> are fed into <code>D</code>. So I was able to use <code>ZipSink</code> and the fact that it is actually a reasonable place to do a sink (performance aside, which I haven't looked at). Of course, as completely expected, <code>getZipSink</code> does not know anything about one to many relationships and how to deal with them; it has the widely defined behavior of zip to just cycle through input streams until  all input streams have been cycled through once.</p>\n\n<p>I suppose one way to do this might be to somehow change my one-to-many stream into a one-to-one stream by doing a fold into something like a list. But then I'd have to unpack it later outside of the conduit context. At this point, I just want to ask to see what is the recommended way(s).</p>\n\n<p>My actual code looks like (<code>A</code> is <code>sourceDirectoryDeep</code>, <code>B</code> is <code>processFileName</code>, <code>C</code> is <code>processCSV</code>, and <code>D</code> is (sort of, I suppose) <code>getZipSink</code>):</p>\n\n<pre><code>retrieveSmaXtec :: Path Abs Dir -&gt; IO (Vector SxRecord)\nretrieveSmaXtec sxDir = do\n  rows &lt;- sourceDirectoryDeep False (fromAbsDir sxDir)\n    .| getZipSink (combine &lt;$&gt; ZipSink processFileName &lt;*&gt; ZipSink processCSV )\n    &amp; runConduitRes\n  print rows\n  rows &amp; fmap fromRow &amp; catMaybes &amp; return\n  where\n    combine :: (Vector (MapRow Text)) -&gt; (Vector (MapRow Text)) -&gt; (Vector (MapRow Text))\n    combine v1 v2 = (uncurry DM.union) &lt;$&gt; (zip v1 v2)\n    processCSV :: (MonadResource m, MonadThrow m, PrimMonad m)=&gt;\n      ConduitT FilePath Void m (Vector ((MapRow Text)))\n    processCSV = mapMC (liftIO . DTIO.readFile)\n      .| intoCSV defCSVSettings\n      .| sinkVector\n    processFileName :: (MonadResource m, MonadThrow m, PrimMonad m) =&gt;\n      ConduitT FilePath Void m (Vector ((MapRow Text)))\n    processFileName = mapC go\n      .| sinkVector\n      where\n        go :: FilePath -&gt; MapRow Text\n        go fp = takeFileName fp\n          &amp; takeWhile (/= '.')\n          &amp; splitOn \"_\"\n          &amp; fmap Txt.pack\n          &amp; zip colNames\n          &amp; DM.fromList\n        colNames = [markKey, idKey]\n</code></pre>\n\n<p>The imports (some of which may be extraneous) are:</p>\n\n<pre><code>import           Conduit\nimport qualified Data.Conduit.Combinators       as DCC\nimport           Data.CSV.Conduit\nimport           Data.Function                  ((&amp;))\nimport           Data.List.Split                (splitOn)\nimport           Data.Map                       as DM\nimport           Data.Text                      (Text)\nimport qualified Data.Text                      as Txt\nimport qualified Data.Text.IO                   as DTIO\nimport           Data.Vector                    (Vector)\nimport           Path\nimport           System.FilePath.Posix\n</code></pre>\n"}, {"tags": ["haskell", "typeclass"], "comments": [{"owner": {"reputation": 3203, "user_id": 2622234, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a4b0faa804acdb74ea677bc421d5caac?s=128&d=identicon&r=PG", "display_name": "sara", "link": "https://stackoverflow.com/users/2622234/sara"}, "edited": false, "score": 5, "creation_date": 1548326141, "post_id": 54344550, "comment_id": 95504696, "body": "What concrete type do you propose <code>read &quot;5&quot;</code> should have? It&#39;s not so simple to say"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 1, "creation_date": 1548328063, "post_id": 54344550, "comment_id": 95505903, "body": "It&#39;s worse than that. Usually you don&#39;t use <code>read &quot;5&quot;</code>, because you&#39;d just write <code>5</code>. What concrete type should <code>read someUnknownString</code> have?"}, {"owner": {"reputation": 3392, "user_id": 7175117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tfz44.png?s=128&g=1", "display_name": "freestyle", "link": "https://stackoverflow.com/users/7175117/freestyle"}, "edited": false, "score": 0, "creation_date": 1548330363, "post_id": 54344550, "comment_id": 95507215, "body": "Error reading / parsing is the same result as success. For example, in cases where I expect a number, and the user has transmitted something else, then I would like to receive an parsing error, and not something else."}, {"owner": {"reputation": 13, "user_id": 10684634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85a6e97dc125d8249b1bb4509f6eb7c1?s=128&d=identicon&r=PG&f=1", "display_name": "Legaph", "link": "https://stackoverflow.com/users/10684634/legaph"}, "edited": false, "score": 0, "creation_date": 1548331575, "post_id": 54344550, "comment_id": 95507882, "body": "But then why the type signature of <code>read</code> is similar as the type signature of <code>show</code> if for <code>read</code> you implicitly need another parameter, the type to look for? Should not this difference be somehow explicitly shown in the type signature?"}, {"owner": {"reputation": 14030, "user_id": 8475054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edbf41c4b5aecb1a949936e06368a7c2?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Zigmond", "link": "https://stackoverflow.com/users/8475054/robin-zigmond"}, "edited": false, "score": 2, "creation_date": 1548334938, "post_id": 54344550, "comment_id": 95509886, "body": "The type signatures are not really similar at all. <code>show</code> is polymorphic in its argument type - which is something quite normal. But <code>read</code> is polymorphic in its <i>result</i> type, which means without either being told explicitly by a type signature, or inference from the other functions you use the result with, the compiler can&#39;t figure out what you want."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1548336159, "post_id": 54344550, "comment_id": 95510714, "body": "You say, &quot;Why is it necessary to provide a second value?&quot;. This question confuses me. It is not necessary -- and indeed, in most settings, not even <i>allowed</i> -- to provide a second value. For example, <code>read &quot;4&quot; 3</code> will give you a missing instance error (in the absence of certain very unorthodox additional code). Can you give an example of what you mean, since you don&#39;t seem to be using standard terminology here?"}, {"owner": {"reputation": 13, "user_id": 10684634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85a6e97dc125d8249b1bb4509f6eb7c1?s=128&d=identicon&r=PG&f=1", "display_name": "Legaph", "link": "https://stackoverflow.com/users/10684634/legaph"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548355235, "post_id": 54344550, "comment_id": 95521911, "body": "@DanielWagner What i meant is not literally that a second value is needed. In the reference <code>read &quot;5&quot; - 2</code> is working. Also the function <code>add1</code> proposed in one of the answers to this question by Marc Talbot. In this sense, what i meant by \u201csecond value\u201d is that <code>read</code> can resolve the type only if a kind of \u201ccontext\u201d is somehow provided, a \u201ccontext\u201d that for example <code>show</code> does not need. Maybe i am not still really getting what a type signature means, because i think the difference about <code>read</code> needing a context and <code>show</code> not needing a context should be reflected on the type signature, or not?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1548357611, "post_id": 54344550, "comment_id": 95522919, "body": "@Legaph Generally the argument to <code>show</code> itself is the context. Try putting e.g. <code>myShow=show;main=return()</code> in a file and compiling it -- you will see that without the context of its argument, <code>show</code> can have similar ambiguous type problems. (I am fudging a few details here in the name of pedagogy, but the top-level idea is right.)"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 10684634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85a6e97dc125d8249b1bb4509f6eb7c1?s=128&d=identicon&r=PG&f=1", "display_name": "Legaph", "link": "https://stackoverflow.com/users/10684634/legaph"}, "edited": false, "score": 0, "creation_date": 1548327076, "post_id": 54344660, "comment_id": 95505296, "body": "Well, maybe it is very naive but when the value of the <code>String</code> is &quot;4&quot;, all the potential types that <code>a</code> represents in the <code>read</code> signature are constrained. What i would expect is a list returning all possible types that could match: <code>Int</code>, <code>Float</code>..."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 13, "user_id": 10684634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85a6e97dc125d8249b1bb4509f6eb7c1?s=128&d=identicon&r=PG&f=1", "display_name": "Legaph", "link": "https://stackoverflow.com/users/10684634/legaph"}, "edited": false, "score": 3, "creation_date": 1548328252, "post_id": 54344660, "comment_id": 95506012, "body": "@Legaph What about <code>MyCustomTypeThatReadsFrom4</code>?"}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 2, "last_activity_date": 1548326353, "creation_date": 1548326353, "answer_id": 54344660, "question_id": 54344550, "link": "https://stackoverflow.com/questions/54344550/why-read-cannot-resolve-a-type-with-one-argument/54344660#54344660", "title": "Why read cannot resolve a type with one argument?", "body": "<blockquote>\n  <p>Wouldn't it be feasible to check a single value against all possible types of the Read typeclass?</p>\n</blockquote>\n\n<p>Doing that would yield the same result; <code>read \"4\"</code> can potentially be anything that can be read from a <code>String</code>, and that's what <code>ghci</code> reports:</p>\n\n<pre><code>Prelude&gt; :t read \"4\"\nread \"4\" :: Read a =&gt; a\n</code></pre>\n\n<p>Until you actually <em>do</em> the parsing, the <code>Read a =&gt; a</code> represents a <em>potential</em> parsing result. Remember that typeclasses being open means that this could potentially be any type, depending on the presence of the instances. </p>\n\n<p>It's also entirely possible that multiple types could share the same <code>Show</code>/<code>Read</code> textual representation, which brings me to my next point...</p>\n\n<p>If you wanted to check what type the string can be parsed as, that would at the very least require resolving the ambiguity between multiple types that could accept the given input; which means you'd need to know those types beforehand, which <code>Read</code> can't do. And even if you did that, how do you propose such value be then used? You'd need to pack it into something, which implies that you need a closed set again.</p>\n\n<p>All in all, <code>read</code> signature is as precise it can be, given the circumstances.</p>\n"}, {"comments": [{"owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "edited": false, "score": 2, "creation_date": 1548337952, "post_id": 54346757, "comment_id": 95511819, "body": "As the OP is beginner, let&#39;s also say that <code>Int</code> and <code>Integer</code> are two <b>diffferent</b> types. <code>Int</code> is the <code>int</code> we know in c/c++/java/c#, which will overflow if we get hight that <code>maxInt</code>. <code>Integer</code> is a boundless/limitless integer: it is less efficient, but cannot overflow, since it has no maximum number limit."}], "tags": [], "owner": {"reputation": 2031, "user_id": 670339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942f0170639d3fd6d2bd3a2ce057e3e7?s=128&d=identicon&r=PG", "display_name": "Marc Talbot", "link": "https://stackoverflow.com/users/670339/marc-talbot"}, "is_accepted": false, "score": 2, "last_activity_date": 1548333075, "creation_date": 1548333075, "answer_id": 54346757, "question_id": 54344550, "link": "https://stackoverflow.com/questions/54344550/why-read-cannot-resolve-a-type-with-one-argument/54346757#54346757", "title": "Why read cannot resolve a type with one argument?", "body": "<p>Not meant as an answer, but this wouldn't fit into a comment cleanly.</p>\n\n<p>In ghci, if you simply do a <code>read \"5\"</code>, then ghci is going to need some help figuring out what you want it to be.  However, if that result is being used somewhere, ghci (and Haskell in general) <em>can</em> figure out the type.  For (a silly) example:</p>\n\n<pre><code>add1 :: Int -&gt; Int\nadd1 i = i + 1\n\nfive = read \"5\"\n\nsix = add1 five\n</code></pre>\n\n<p>In that case, there's no need to annotate the read with a type signature, because ghc can infer it from the fact that <code>five</code> is being used in a function that only takes an Int.  If you added another function with a different signature that also tried to use <code>five</code>, you'd end up with a compile error:</p>\n\n<pre><code>-- Adding this to our code above\n-- Fails to compile\nadd1Integer :: Integer -&gt; Integer\nadd1Integer i = i + 1\n\nsixAsInteger = add1Integer five    \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 3, "last_activity_date": 1548339211, "creation_date": 1548339211, "answer_id": 54348617, "question_id": 54344550, "link": "https://stackoverflow.com/questions/54344550/why-read-cannot-resolve-a-type-with-one-argument/54348617#54348617", "title": "Why read cannot resolve a type with one argument?", "body": "<p>I think you have a (rather common among beginners - I had it myself) misunderstanding of what type classes are.  The way Haskell works is logically incompatible with \"check[ing] a single value against all possible types of the Read typeclass\".  Instance selection is based on types.  Only types.</p>\n\n<p>You should not think of <code>read</code> as a magical function that can return many types.  It's actually a huge family of functions, and the type is used to select which member of the family to use.  It's that direction of dependence that matters.  Classes create a case where values (usually functions, but not always) - the things that exist at run time - are chosen based on types - the things that exist at compile time.</p>\n\n<p>You're asking \"Why not the other direction? Why can't the type depend on the value?\", and the answer to that is that Haskell just doesn't work that way.  It wasn't designed to, and the theory it was based on doesn't allow it.  There is a theory for that (dependent types), and there are extensions being added to GHC that support an increasing set of feature that do some aspect of dependent typing, but it's not there yet. </p>\n\n<p>And even if it was, this example would still not work the way you want. Dependent types still need to know what type something is. You couldn't write a magical \"returns anything\" version of <code>read</code>.  Instead, the type for <code>read</code> would have to involve some function that calculates the type from the value, and inherently only works for the closed set of types that function can return.</p>\n\n<p>Those last two paragraphs are kind of an aside, though.  The important part is that classes are ways to go from types to values, with handy compiler support to automatically figure it out for you most of the time.  That's all they were designed to do, and it's all that they can do.  There are advantages to this design, in terms of ease of compilation, predictability of behavior (open world assumption), and ability to optimize at compile time.</p>\n"}], "owner": {"reputation": 13, "user_id": 10684634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85a6e97dc125d8249b1bb4509f6eb7c1?s=128&d=identicon&r=PG&f=1", "display_name": "Legaph", "link": "https://stackoverflow.com/users/10684634/legaph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1548339211, "creation_date": 1548325989, "question_id": 54344550, "link": "https://stackoverflow.com/questions/54344550/why-read-cannot-resolve-a-type-with-one-argument", "title": "Why read cannot resolve a type with one argument?", "body": "<p>The Haskell tutorial states that:</p>\n\n<ul>\n<li><p>by looking at the type signature of <code>read</code></p>\n\n<p>read :: Read a => String -> a</p></li>\n<li><p>it follows that GHCI has no way of knowing which type we want in return when running</p>\n\n<p>ghci> read \"4\"</p></li>\n</ul>\n\n<p>Why is it necessary to provide a second value from which GHCI can extract a type to compare with?</p>\n\n<p>Wouldn't it be feasible to check a single value against all possible types of the <code>Read</code> typeclass?</p>\n\n<p>Reference:\n<a href=\"http://learnyouahaskell.com/types-and-typeclasses\" rel=\"nofollow noreferrer\">http://learnyouahaskell.com/types-and-typeclasses</a></p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 4, "creation_date": 1548306363, "post_id": 54339424, "comment_id": 95495747, "body": "Hint: what&#39;s the type of <code>[ [], [[]], [[[]]], [[[[]]]], [[[[[ ]]]]], [[[[[True]]]]] ]</code>? Also, consider why <code>[True, []]</code> and <code>[True, [True]]</code> are ill-typed."}, {"owner": {"reputation": 117, "user_id": 8419779, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/821b497c875751967147fc97cb814f38?s=128&d=identicon&r=PG&f=1", "display_name": "csStudent", "link": "https://stackoverflow.com/users/8419779/csstudent"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1548307212, "post_id": 54339424, "comment_id": 95495963, "body": "I guess I&#39;m kind confused on the meaning of the syntax with all the brackets. The whole thing is a list with the elements a list, a list of lists and so on. I&#39;m not sure why it would take a list of lists of lists of lists of a list with a Bool, and not a list with a Bool. Also how can the whole list have a type [[[[[[]]]]]] when there is also a list and a lists of lists and so on inside the list. (I&#39;ve written list way too many times now)"}, {"owner": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1548307626, "post_id": 54339424, "comment_id": 95496061, "body": "Lists in Haskell have kind <code>* -&gt; *</code>, rather than <code>*</code> as types like Bool have. If you don&#39;t know what kinds are yet, here&#39;s the relevant consequence of that: No value in Haskell is just &quot;a list&quot;. Instead, values must be &quot;a list of ____s&quot;, where the blank must be filled in with something. For example, the type of <code>[True]</code> can be stated in words as &quot;a list of Bools&quot;, and the type of <code>[[True]]</code> can be stated as &quot;a list of lists of Bools&quot;. (Just &quot;a list of lists&quot; would not be valid, since the last &quot;list&quot; wouldn&#39;t be &quot;of&quot; anything.) Given this, can you figure out the types?"}, {"owner": {"reputation": 117, "user_id": 8419779, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/821b497c875751967147fc97cb814f38?s=128&d=identicon&r=PG&f=1", "display_name": "csStudent", "link": "https://stackoverflow.com/users/8419779/csstudent"}, "reply_to_user": {"reputation": 33166, "user_id": 7509065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Joseph Sible-Reinstate Monica", "link": "https://stackoverflow.com/users/7509065/joseph-sible-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1548309856, "post_id": 54339424, "comment_id": 95496733, "body": "Okay, so the examples you gave me are invalid because you can&#39;t have list of bools and then a list of lists of anything because you already have a list of bools, correct? Why then an we have a list that has a bunch of lists with empty lists at the center, and then have the final list have a True at the center? Shoudn&#39;t all the lists have a Bool at the center?"}, {"owner": {"reputation": 2026, "user_id": 1406083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1gC8p.jpg?s=128&g=1", "display_name": "Billy Brown", "link": "https://stackoverflow.com/users/1406083/billy-brown"}, "edited": false, "score": 0, "creation_date": 1548328819, "post_id": 54339424, "comment_id": 95506344, "body": "@csStudent Don&#39;t forget to separate the list types <code>[Bool]</code> and <code>[[Bool]]</code>, and the values <code>[True]</code>, <code>[[True]]</code>, etc. The value <code>[]</code> can be of type <code>[[Bool]]</code>, because it is an empty list of lists of bools. <code>[ [], [True] ]</code> is a list of lists of bools, where one value is empty and the other contains a single <code>True</code> value. <code>[ [False, False], [], [True] ]</code> has type <code>[[Bool]]</code>, as does <code>[]</code> and <code>[[True]]</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2194, "user_id": 7940614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b697c574cc5dfb3a4d5e4aff46a1721a?s=128&d=identicon&r=PG&f=1", "display_name": "assembly.jc", "link": "https://stackoverflow.com/users/7940614/assembly-jc"}, "is_accepted": true, "score": 7, "last_activity_date": 1548310435, "creation_date": 1548310435, "answer_id": 54340387, "question_id": 54339424, "link": "https://stackoverflow.com/questions/54339424/giving-types-for-expressions/54340387#54340387", "title": "giving types for expressions", "body": "<p>To understand why the expression: <code>[ [], [[]], [[[]]], [[[[]]]], [[[[[ ]]]]] ]</code> has type <code>[[[[[[a]]]]]]</code>, you need to understand what is the type of <code>[]</code> first. </p>\n\n<p>Actually, <code>[]</code> is equivalent to <code>[a']</code>, where <code>a'</code> is type variable without any constraint. That means <code>a'</code> can be any type. So, when a list is constructed, say, <code>[ [], [[]] ]</code>, it is legal to replace <code>a'</code> with <code>[a]</code> as: </p>\n\n<pre><code>[ [], [[]] ] ~ [ [a'] [[a]] ] ~ [ [[a]], [[a]] ] ~ [ [[a]] ]\n</code></pre>\n\n<p>The same reason why </p>\n\n<pre><code>[ [], [[]], [[[]]], [[[[]]]], [[[[[ ]]]]] ] ~  [ [[[[[a]]]]] ]\n</code></pre>\n\n<p>But when you constructs a list as <code>[ [True], [[]] ]</code>, there is no way to convert <code>True</code> to a list, even though <code>[a]</code> can be any type of list. The same reason why <code>[ [True], [[]], [[[]]], [[[[]]]], [[[[[]]]]] ]</code> is illegal.   </p>\n"}, {"tags": [], "owner": {"reputation": 2026, "user_id": 1406083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1gC8p.jpg?s=128&g=1", "display_name": "Billy Brown", "link": "https://stackoverflow.com/users/1406083/billy-brown"}, "is_accepted": false, "score": 3, "last_activity_date": 1548334800, "last_edit_date": 1548334800, "creation_date": 1548328505, "answer_id": 54345335, "question_id": 54339424, "link": "https://stackoverflow.com/questions/54339424/giving-types-for-expressions/54345335#54345335", "title": "giving types for expressions", "body": "<p>You have the value <code>[ [], [[]], [[[]]], [[[[]]]], [[[[[ ]]]]] ]</code>, which is a list of nested lists.</p>\n\n<ul>\n<li>The rightmost value is the most constrained: we know how deeply nested this list must be.</li>\n<li>The leftmost value is the least constrained: it is just an empty list, so it could be a list of anything.</li>\n</ul>\n\n<p>If we apply the least constraining type to each of these, we get:</p>\n\n<pre><code>[\n  [        ] -- [    a    ]\n, [[      ]] -- [[   b   ]]\n, [[[    ]]] -- [[[  c  ]]]\n, [[[[  ]]]] -- [[[[ d ]]]]\n, [[[[[]]]]] -- [[[[[e]]]]]\n]\n</code></pre>\n\n<p>The list must have a homogenous type, so we look at unifying them. If we try to unify the first two types, <code>[a]</code> and <code>[[b]]</code>, we see that <code>a</code> \u2287 <code>[b]</code>, so we now have:</p>\n\n<pre><code>[\n  [  ] -- [[b]]\n, [[]] -- [[b]]\n, ...\n]\n</code></pre>\n\n<p>If we continue this process up to <code>[[[[d]]]]</code> and <code>[[[[[e]]]]]</code>, we see that <code>d</code> \u2287 <code>[e]</code>, and so we end up with:</p>\n\n<pre><code>[\n  [        ] -- [[[[[e]]]]]\n, [[      ]] -- [[[[[e]]]]]\n, [[[    ]]] -- [[[[[e]]]]]\n, [[[[  ]]]] -- [[[[[e]]]]]\n, [[[[[]]]]] -- [[[[[e]]]]]\n]\n</code></pre>\n\n<p>And so finally, the overall list has type <code>[[[[[[e]]]]]]</code>.</p>\n\n<p>This is because the first element is an empty list of whatever, the second is a single-element list with an empty list of whatever, and so on. You could repeat this process <em>ad infinitum</em>, with nested singleton lists ending at a single empty list, and your type would be <code>[[...[a]...]]</code>.</p>\n\n<p>So now that you know how many levels of nesting there must be before you can introduce your own type (by replacing <code>e</code>), you should be able to see why <code>[ [True], [[]], [[[]]], [[[[]]]], [[[[[]]]]] ]</code> is not valid, but <code>[ [], [[]], [[[]]], [[[[]]]], [[[[[True]]]]] ]</code> is.</p>\n"}], "owner": {"reputation": 117, "user_id": 8419779, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/821b497c875751967147fc97cb814f38?s=128&d=identicon&r=PG&f=1", "display_name": "csStudent", "link": "https://stackoverflow.com/users/8419779/csstudent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 54340387, "answer_count": 2, "score": -1, "last_activity_date": 1548338257, "creation_date": 1548304548, "last_edit_date": 1548338257, "question_id": 54339424, "link": "https://stackoverflow.com/questions/54339424/giving-types-for-expressions", "title": "giving types for expressions", "body": "<p>So I'm being asked to \"Give possible types (not involving any type variables) for each\nof the following expressions (or else explain why you think the\nexpression is ill-typed)\"\nand I'm struggling with the expression \n<code>[ [], [[]], [[[]]], [[[[]]]], [[[[[    ]]]]] ]</code>.</p>\n\n<p>When I put <code>:t *the above expression*</code> into ghci it tells me that it has the type <code>[[[[[[a]]]]]]</code>. I'm confused what the expression is even saying and why it's giving me that type.</p>\n\n<p>Also <code>:t [ [True], [[]], [[[]]], [[[[]]]], [[[[[]]]]] ]</code> gives an error, and I don't know why it is ill typed. I think the answer to the first one will help me understand why the second expression fails.</p>\n"}, {"tags": ["haskell", "pandoc", "asciidoc", "hakyll"], "answers": [{"comments": [{"owner": {"reputation": 2141, "user_id": 1664572, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c2bee27fdb72050b60a3c6aae64b474f?s=128&d=identicon&r=PG", "display_name": "wizzup", "link": "https://stackoverflow.com/users/1664572/wizzup"}, "edited": false, "score": 0, "creation_date": 1548485537, "post_id": 54339271, "comment_id": 95566531, "body": "I have the same <a href=\"https://github.com/jaspervdj/hakyll/issues/600\" rel=\"nofollow noreferrer\">problem</a> long time ago. Keep waiting for <code>pandoc</code> to support <code>asciidoc</code> since then. Thank to you, now I can try using <code>asciidoc</code>"}, {"owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "edited": false, "score": 0, "creation_date": 1584158409, "post_id": 54339271, "comment_id": 107357748, "body": "<code>unixFilter</code>, brilliant! I doubt I&#39;d have been able to get asciidoc working without this helpful answer. Using <code>nixos</code> I additionally had to add <code>asciidoctor</code> to my nix packages in <code>stack.yaml</code>. Thank you!"}], "tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 9, "last_activity_date": 1548336935, "last_edit_date": 1548336935, "creation_date": 1548303360, "answer_id": 54339271, "question_id": 54338415, "link": "https://stackoverflow.com/questions/54338415/is-it-possible-to-use-asciidoc-with-hakyll/54339271#54339271", "title": "Is it possible to use asciidoc with hakyll?", "body": "<p>Current Pandoc can write Asciidoc but cannot read it: <a href=\"https://github.com/jgm/pandoc/issues/1456\" rel=\"noreferrer\">Issue</a>.</p>\n\n<p>Besides, there seems no Asciidoc parser written in Haskell, so there's no pure Haskell solution.</p>\n\n<p>However, Hakyll has <a href=\"http://hackage.haskell.org/package/hakyll-4.12.5.0/docs/Hakyll-Core-UnixFilter.html\" rel=\"noreferrer\">unixFilter</a> which can use any command which inputs from stdin and outputs to stdout. Therefore, you can call <code>asciidoctor</code> command for converting <code>.asciidoc</code> file.</p>\n\n<p>Here's the step:</p>\n\n<h3>1. Install asciidoctor</h3>\n\nUbuntu\n\n<p><code>$ apt-get install asciidoctor</code></p>\n\nFedora\n\n<p><code>$ dnf install asciidoctor</code></p>\n\nArch Linux\n\n<p><code>$ pacman -S asciidoctor</code></p>\n\nRuby Gem\n\n<p><code>$ gem install asciidoctor</code></p>\n\n<h3>2. Define pandocCompilerWithAsciidoctor</h3>\n\n<p>Add following code to <code>site.hs</code></p>\n\n<pre><code>pandocCompilerWithAsciidoctor :: Compiler (Item String)\npandocCompilerWithAsciidoctor = do\n  extension &lt;- getUnderlyingExtension\n  if extension == \".asciidoc\" then\n    getResourceString &gt;&gt;= withItemBody (unixFilter \"asciidoctor\" [\"-\"])\n  else\n    pandocCompiler\n</code></pre>\n\n<p>replace <code>pandocCompiler</code> in <code>site.hs</code> with <code>pandocCompilerWithAsciidoctor</code></p>\n\n<h3>3. Recompile</h3>\n\n<pre><code>$ stack build\n$ stack exec site rebuild\n</code></pre>\n\n<p>Note that filename have to be <code>2018-01-23-adoc-user-manual.asciidoc</code> instead of <code>2018-01-23_adoc-user-manual.asciidoc</code>, or you get error: <code>[ERROR] Missing field $date$ in context for item posts/2018-01-23_adoc-user-manual.asciidoc</code></p>\n"}], "owner": {"reputation": 4029, "user_id": 3224967, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/963b108f3bcde98ac96d09b04abbf63f?s=128&d=identicon&r=PG&f=1", "display_name": "mherzl", "link": "https://stackoverflow.com/users/3224967/mherzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 1, "accepted_answer_id": 54339271, "answer_count": 1, "score": 3, "last_activity_date": 1548336935, "creation_date": 1548295699, "last_edit_date": 1548303977, "question_id": 54338415, "link": "https://stackoverflow.com/questions/54338415/is-it-possible-to-use-asciidoc-with-hakyll", "title": "Is it possible to use asciidoc with hakyll?", "body": "<p>I followed <a href=\"https://jaspervdj.be/hakyll/tutorials/02-basics.html\" rel=\"nofollow noreferrer\">this tutorial</a> to create a basic static web page using hakyll. It includes a number of pages rendered from markdown in the <code>posts</code> directory, e.g. <code>2015-08-12-spqr.markdown</code>.</p>\n\n<p>I prefer asciidoc to markdown, and tried adding an asciidoc <code>2018-01-23_adoc-user-manual.asciidoc</code> to the <code>post</code> directory.\nHowever, <code>hakyll</code> throws an error when attempting to compile the page:</p>\n\n<pre><code>Initialising...\n  Creating store...\n  Creating provider...\n  Running rules...\nChecking for out-of-date items\nCompiling\n  updated templates/default.html\n  updated about.rst\n  updated templates/post.html\n  updated posts/2015-08-12-spqr.markdown\n  updated posts/2015-10-07-rosa-rosa-rosam.markdown\n  updated posts/2015-11-28-carpe-diem.markdown\n  updated posts/2015-12-07-tu-quoque.markdown\n  [ERROR] Hakyll.Web.readPandocWith: I don't know how to read a file of the type Binary for: posts/2018-01-23_adoc-user-manual.asciidoc\nCallStack (from HasCallStack):\n  error, called at lib/Hakyll/Web/Pandoc.hs:66:31 in hakyll-4.12.5.0-8ZITvFN5YREEKv6B76SCAd:Hakyll.Web.Pandoc\n</code></pre>\n\n<p>Is this problem that <a href=\"http://hackage.haskell.org/package/hakyll-4.12.5.0/docs/Hakyll-Web-Pandoc.html#v:pandocCompiler\" rel=\"nofollow noreferrer\"><code>pandocCompiler</code></a> cannot handle <code>asciidoc</code>?\nIs it possible to use <code>asciidoc</code> with <code>hakyll</code>?</p>\n"}]