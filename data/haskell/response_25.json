[{"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435851017, "post_id": 31171618, "comment_id": 50382561, "body": "Since when have you been able to use a list of type <code>[[[[[[[[[[....[[[[[[a]]]]]]....]]]]]]]]]]</code>? That&#39;s the type <code>a ~ [a]</code> that you&#39;re describing"}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1435858572, "post_id": 31171618, "comment_id": 50387160, "body": "Also, it is very unidomatic and error prone to use null in the fashion. Pattern matching is far superior."}], "answers": [{"tags": [], "owner": {"reputation": 45741, "user_id": 744178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3193139ea494c45e63752504f5ff1f2?s=128&d=identicon&r=PG", "display_name": "jwodder", "link": "https://stackoverflow.com/users/744178/jwodder"}, "is_accepted": false, "score": 9, "last_activity_date": 1435785184, "creation_date": 1435785184, "answer_id": 31171784, "question_id": 31171618, "link": "https://stackoverflow.com/questions/31171618/occurs-check-cannot-construct-the-infinite-type-t-t/31171784#31171784", "title": "Occurs check: cannot construct the infinite type: t ~ [t]", "body": "<p><code>reverse2 (tail lst)</code> is of type <code>[a]</code>, while <code>head lst</code> is type <code>a</code>.  Meanwhile, the <code>:</code> operator has type <code>a -&gt; [a] -&gt; [a]</code>.  When you try to do <code>reverse2 (tail lst) : (head lst)</code>, Haskell thinks that <code>head lst</code> is a list whose elements are the same type as <code>reverse2 (tail lst)</code> -- i.e., that <code>head lst :: [[a]]</code>.  However, <code>head lst</code> must also be the same type as the elements of <code>reverse2 (tail lst)</code>, which means <code>reverse2 (tail lst) :: [[[a]]]</code>, but then <code>head lst</code> has to be <code>[[[[a]]]]</code>, and then <code>reverse2 (tail lst)</code> has to be type <code>[[[[[a]]]]]</code>, and I think you can see where this is going.</p>\n\n<p>This problem happens because you're using <code>:</code> incorrectly.  If you want to append an element to a list, the simplest way is <code>reverse2 (tail lst) ++ [head lst]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 8542, "user_id": 768869, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9100b96db729677ff09702887be524ba?s=128&d=identicon&r=PG", "display_name": "Hugh", "link": "https://stackoverflow.com/users/768869/hugh"}, "is_accepted": false, "score": 0, "last_activity_date": 1435785281, "creation_date": 1435785281, "answer_id": 31171819, "question_id": 31171618, "link": "https://stackoverflow.com/questions/31171618/occurs-check-cannot-construct-the-infinite-type-t-t/31171819#31171819", "title": "Occurs check: cannot construct the infinite type: t ~ [t]", "body": "<p>Just as a note expanding on what jwodder wrote, if you explicitly type things you can get a more helpful error message:</p>\n\n<pre><code>Prelude&gt; let reverse2 :: [a] -&gt; [a]; reverse2 lst = if null lst then [] else (reverse2 (tail lst)) : (head lst)\n\n&lt;interactive&gt;:6:70:\n    Couldn't match expected type \u2018a\u2019 with actual type \u2018[a]\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for reverse2 :: [a] -&gt; [a] at &lt;interactive&gt;:6:17\n    Relevant bindings include\n      lst :: [a] (bound at &lt;interactive&gt;:6:38)\n      reverse2 :: [a] -&gt; [a] (bound at &lt;interactive&gt;:6:29)\n    In the first argument of \u2018(:)\u2019, namely \u2018(reverse2 (tail lst))\u2019\n    In the expression: (reverse2 (tail lst)) : (head lst)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 95, "user_id": 6037217, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7bec5c2aa08294dccdd1576495f8276d?s=128&d=identicon&r=PG&f=1", "display_name": "Ro&#228;c", "link": "https://stackoverflow.com/users/6037217/ro%c3%a4c"}, "edited": false, "score": 0, "creation_date": 1588776817, "post_id": 31171837, "comment_id": 109030305, "body": "I think this is indeed the correct answer, but I&#39;d consider adding the explanation @jwodder gave so this answer can be more complete. I&#39;d also suggest adding the pattern matching strategy as an alternative to the <code>if .. then ... else</code> (without removing that implementation) since it&#39;s a more standard definition for this kind of functions."}], "tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 5, "last_activity_date": 1435785352, "creation_date": 1435785352, "answer_id": 31171837, "question_id": 31171618, "link": "https://stackoverflow.com/questions/31171618/occurs-check-cannot-construct-the-infinite-type-t-t/31171837#31171837", "title": "Occurs check: cannot construct the infinite type: t ~ [t]", "body": "<p>So the immediate problem is that you're passing arguments of the wrong type to the <code>:</code> operator, and haskell is trying to make them be the right type, and its struggle to get them to be the right type leads to obscure error messages.</p>\n\n<p>As a general strategy, when weird error messages crop up like this, I start applying type signatures to the things it complains about so that haskell doesn't try to infer type signatures that are far away from what I intended.</p>\n\n<p>Doing that with your code, I'd start by adding this to <code>reverse2</code>:</p>\n\n<pre><code>reverse2 :: [t] -&gt; [t]\nreverse2 lst = if null lst\n           then []\n           else reverse2 (tail lst) : (head lst)\n</code></pre>\n\n<p>This changes the error message to:</p>\n\n<pre><code>Couldn't match expected type \u2018t\u2019 with actual type \u2018[t]\u2019\n      \u2018t\u2019 is a rigid type variable bound by\n          the type signature for reverse2 :: [t] -&gt; [t]\n          at /tmp/flycheck-stackov.hs:6:13\n    Relevant bindings include\n      lst :: [t] (bound at /tmp/flycheck-stackov.hs:7:10)\n      reverse2 :: [t] -&gt; [t] (bound at /tmp/flycheck-stackov.hs:7:1)\n    In the first argument of \u2018(:)\u2019, namely \u2018reverse2 (tail lst)\u2019\n    In the expression: reverse2 (tail lst) : (head lst)\n</code></pre>\n\n<p>Okay, now it's saying \"I expected type <code>t</code> but got type <code>[t]</code> when looking at the first argument to <code>:</code>\".</p>\n\n<p>And indeed, if we ask <code>ghci</code> what the type of <code>:</code> is, we see:</p>\n\n<pre><code>Prelude&gt; :t (:)\n(:) :: a -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>So the left argument to <code>:</code> needs to be a single item, and the right argument a list. You're using a list on the left, and a single item on the right.</p>\n\n<p>To concatenate the way you want, as the other answer says you should use <code>++</code>:</p>\n\n<pre><code>reverse2 :: [t] -&gt; [t]\nreverse2 lst = if null lst\n           then []\n           else reverse2 (tail lst) ++ [head lst]\n</code></pre>\n\n<p>(Also, you've got a type error in your <code>main</code> routine. You want to say <code>putStrLn $ reverse2 [2, 8, 7]</code> and not <code>putStrLn . reverse2 [2, 8, 7]</code>)</p>\n"}, {"tags": [], "owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "is_accepted": false, "score": 1, "last_activity_date": 1435785359, "creation_date": 1435785359, "answer_id": 31171841, "question_id": 31171618, "link": "https://stackoverflow.com/questions/31171618/occurs-check-cannot-construct-the-infinite-type-t-t/31171841#31171841", "title": "Occurs check: cannot construct the infinite type: t ~ [t]", "body": "<p>You should be able to fix it by:</p>\n\n<pre><code>reverse2 lst = if null lst\n   then []\n   else reverse2 (tail lst) ++ [head lst]\n</code></pre>\n\n<p>@jwodder already explained the more theoretical reasons this doesn't work.</p>\n\n<p>Note that the above implementation is quite inefficient because <code>++</code> traverses its first argument completely and does concatenation afterwards.</p>\n\n<p>A more sophisticated approach is the following</p>\n\n<pre><code>reverse3 lst = \n    let aux lst acc = if null lst then acc else aux (tail lst) (head lst : acc) \n    in aux lst []\n</code></pre>\n\n<p>It is often helpful to annotate types explicitly (i.e. you write <code>reverse2 :: [a] -&gt; [a]</code>.</p>\n"}], "owner": {"reputation": 673, "user_id": 5008381, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2395a2ebca93cd49b689c3d9245f491f?s=128&d=identicon&r=PG&f=1", "display_name": "vlad4378", "link": "https://stackoverflow.com/users/5008381/vlad4378"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2388, "favorite_count": 1, "accepted_answer_id": 31171837, "answer_count": 4, "score": 2, "last_activity_date": 1435785359, "creation_date": 1435784565, "last_edit_date": 1435785218, "question_id": 31171618, "link": "https://stackoverflow.com/questions/31171618/occurs-check-cannot-construct-the-infinite-type-t-t", "title": "Occurs check: cannot construct the infinite type: t ~ [t]", "body": "<p>I start learn Haskell. I'm trying run this code</p>\n\n<pre><code>-- Helpers.hs\nmodule Helpers\nwhere\n\nlst1 +++ lst2 = if null lst1\n            then lst2\n            else (head lst1) : (tail lst1 +++ lst2)\n\n\nreverse2 lst = if null lst\n           then []\n           else reverse2 (tail lst) : (head lst)\n</code></pre>\n\n\n\n<pre><code>-- Main.hs\nimport Helpers\n\nmain :: IO ()\nmain = putStrLn . reverse2 [2, 8, 7]\n</code></pre>\n\n<p>I getting this error:</p>\n\n<pre><code>D:\\Haskell\\project&gt;cabal configure\nResolving dependencies...\nConfiguring one-0.1.0.0...\n\nD:\\Haskell\\project&gt;cabal build\nBuilding one-0.1.0.0...\nPreprocessing executable 'one' for one-0.1.0.0...\n[1 of 2] Compiling Helpers          ( src\\Utils\\Helpers.hs, dist\\build\\one\\one-t\nmp\\Helpers.o )\n\nsrc\\Utils\\Helpers.hs:11:21:\n    Occurs check: cannot construct the infinite type: t ~ [t]\n    Relevant bindings include\n      lst :: [[t]] (bound at src\\Utils\\Helpers.hs:9:10)\n      reverse2 :: [[t]] -&gt; [t] (bound at src\\Utils\\Helpers.hs:9:1)\n    In the first argument of `(:)', namely `reverse2 (tail lst)'\n    In the expression: reverse2 (tail lst) : (head lst)\n</code></pre>\n\n<p>How I can fix it?</p>\n"}, {"tags": ["haskell", "luhn"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1435785074, "post_id": 31171567, "comment_id": 50351238, "body": "I would suggest writing some tests for each of those components (a good opportunity to learn quickcheck, if you have a little time)."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1435785273, "post_id": 31171567, "comment_id": 50351354, "body": "@BradyDean Your <code>sumDigits</code> function is wrong. Consider this example. <code>lastDigit 123</code> returns <code>3</code>. <code>dropLastDigit 123</code> returns <code>12</code>. However <code>3 + 12</code> is not equal to the sum of the digits (<code>1 + 2 + 3</code>)."}, {"owner": {"reputation": 2088, "user_id": 4281998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/q8Jvt.png?s=128&g=1", "display_name": "Brady Dean", "link": "https://stackoverflow.com/users/4281998/brady-dean"}, "edited": false, "score": 0, "creation_date": 1435785461, "post_id": 31171567, "comment_id": 50351451, "body": "The digits are being split up. <code>sumDigits [10, 5, 18, 4] = 1 + 0 + 5 + 1 + 8 + 4 = 19</code> is what I&#39;m going for"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1435787058, "post_id": 31171567, "comment_id": 50352169, "body": "@BradyDean You&#39;re only getting a correct result in your example because all integers happen to have no more than two digits. Try <code>sumDigits [1,100]</code>."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1435792236, "post_id": 31171567, "comment_id": 50353974, "body": "@Jubobs Only handling values with at most two digits is sufficient in this case since <code>doubleEveryOther</code> will never yield numbers &gt; 9*2."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1435825984, "post_id": 31171567, "comment_id": 50364909, "body": "@FrerichRaabe True; that&#39;s not even the problem, here. However, I find the name <code>sumDigits</code> misleading and I just wanted to point it out."}, {"owner": {"reputation": 81337, "user_id": 91757, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/afaf752cb41c3968dbd570c6f6fa0dc3?s=128&d=identicon&r=PG", "display_name": "Frerich Raabe", "link": "https://stackoverflow.com/users/91757/frerich-raabe"}, "edited": false, "score": 0, "creation_date": 1436221450, "post_id": 31171567, "comment_id": 50510212, "body": "For what it&#39;s worth, a very concise definition for <code>doubleEveryOther</code> would be <code>doubleEveryOther = zipWith ($) (cycle [id, (*2)])</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2088, "user_id": 4281998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/q8Jvt.png?s=128&g=1", "display_name": "Brady Dean", "link": "https://stackoverflow.com/users/4281998/brady-dean"}, "edited": false, "score": 0, "creation_date": 1435792235, "post_id": 31173091, "comment_id": 50353973, "body": "Wow I read over the code so many times and never noticed that. Code is working now with those changes."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 2088, "user_id": 4281998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/q8Jvt.png?s=128&g=1", "display_name": "Brady Dean", "link": "https://stackoverflow.com/users/4281998/brady-dean"}, "edited": false, "score": 1, "creation_date": 1435792605, "post_id": 31173091, "comment_id": 50354096, "body": "@BradyDean In my experience, you can&#39;t uncover bugs by reading code. And I didn&#39;t in this case, either; I ran snippets of your code on a your hand-crafted example to see what it would do, and whether that matched what I expected, looking for the smallest function that didn&#39;t match my expectations. This is a powerful technique that I encourage you to adopt."}, {"owner": {"reputation": 2088, "user_id": 4281998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/q8Jvt.png?s=128&g=1", "display_name": "Brady Dean", "link": "https://stackoverflow.com/users/4281998/brady-dean"}, "edited": false, "score": 0, "creation_date": 1435793961, "post_id": 31173091, "comment_id": 50354424, "body": "Yes I ran examples given in the course but I didn&#39;t have much to work with."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 1, "last_activity_date": 1435791812, "creation_date": 1435791812, "answer_id": 31173091, "question_id": 31171567, "link": "https://stackoverflow.com/questions/31171567/luhn-algorithm-implementation/31173091#31173091", "title": "Luhn algorithm implementation", "body": "<p>The snippet <code>x `div` 10 == 0</code> is not a correct check that <code>x</code> is divisible by ten; you should use <code>`mod`</code> instead. Also, this equation is incorrect:</p>\n\n<pre><code>sumDigits (x : [])    = x\n</code></pre>\n\n<p>(Try, e.g. <code>sumDigits [10]</code>.) It can be fixed, but deleting it is simpler and still correct.</p>\n"}], "owner": {"reputation": 2088, "user_id": 4281998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/q8Jvt.png?s=128&g=1", "display_name": "Brady Dean", "link": "https://stackoverflow.com/users/4281998/brady-dean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1193, "favorite_count": 0, "accepted_answer_id": 31173091, "answer_count": 1, "score": 1, "last_activity_date": 1529873809, "creation_date": 1435784353, "last_edit_date": 1529873809, "question_id": 31171567, "link": "https://stackoverflow.com/questions/31171567/luhn-algorithm-implementation", "title": "Luhn algorithm implementation", "body": "<p>I'm expecting <code>luhn 5594589764218858 = True</code> but it is always <code>False</code></p>\n\n<pre><code>-- Get the last digit from a number\nlastDigit :: Integer -&gt; Integer\nlastDigit 0 = 0\nlastDigit n = mod n 10\n\n-- Drop the last digit from a number\ndropLastDigit :: Integer -&gt; Integer\ndropLastDigit n = div n 10\n\ntoRevDigits :: Integer -&gt; [Integer]\ntoRevDigits n\n  | n &lt;= 0    = []\n  | otherwise = lastDigit n : toRevDigits (dropLastDigit n)\n\n-- Double every second number in a list starting on the left.\ndoubleEveryOther :: [Integer] -&gt; [Integer]\ndoubleEveryOther []       = []\ndoubleEveryOther (x : []) = [x]\ndoubleEveryOther (x : y : z) = x : (y * 2) : doubleEveryOther z\n\n-- Calculate the sum of all the digits in every Integer.\nsumDigits :: [Integer] -&gt; Integer\nsumDigits []          = 0\nsumDigits (x : [])    = x\nsumDigits (x : y)     = (lastDigit x) + (dropLastDigit x) + sumDigits y\n\n-- Validate a credit card number using the above functions.\nluhn :: Integer -&gt; Bool\nluhn n\n  | sumDigits (doubleEveryOther (toRevDigits n)) `div` 10 == 0 = True\n  | otherwise                                                  = False\n</code></pre>\n\n<p>I know it can be done easier but I'm following a Haskell <a href=\"https://web.archive.org/web/20160630034720/http://www.seas.upenn.edu/~cis194/hw/01-intro.pdf\" rel=\"nofollow noreferrer\">introductory</a>. I think my only problem is in the <code>luhn</code> function. The course mentions problems may occur because <code>toRevDigits</code> reverses the number but I think it should work anyways.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 54577, "user_id": 1339987, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/76aa5ba88e0d95b6480113239fe50008?s=128&d=identicon&r=PG", "display_name": "djechlin", "link": "https://stackoverflow.com/users/1339987/djechlin"}, "is_accepted": true, "score": 8, "last_activity_date": 1435782280, "last_edit_date": 1435782280, "creation_date": 1435778911, "answer_id": 31170033, "question_id": 31170014, "link": "https://stackoverflow.com/questions/31170014/remove-last-digit-from-number/31170033#31170033", "title": "Remove last digit from number", "body": "<p>Just divide the number by ten.</p>\n\n<pre><code>dropLastDigit :: Integer -&gt; Integer\ndropLastDigit n = div n 10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10220, "user_id": 2720372, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/olQxk.jpg?s=128&g=1", "display_name": "w.b", "link": "https://stackoverflow.com/users/2720372/w-b"}, "is_accepted": false, "score": 0, "last_activity_date": 1435779715, "last_edit_date": 1435779715, "creation_date": 1435779315, "answer_id": 31170139, "question_id": 31170014, "link": "https://stackoverflow.com/questions/31170014/remove-last-digit-from-number/31170139#31170139", "title": "Remove last digit from number", "body": "<pre><code>dropLastDigit :: Integer -&gt; Integer\ndropLastDigit n  \n        | (abs n) &lt; 10 = 0\n        | otherwise = read $ init $ show n\n</code></pre>\n"}], "owner": {"reputation": 2088, "user_id": 4281998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/q8Jvt.png?s=128&g=1", "display_name": "Brady Dean", "link": "https://stackoverflow.com/users/4281998/brady-dean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 717, "favorite_count": 0, "accepted_answer_id": 31170033, "answer_count": 2, "score": 0, "last_activity_date": 1435782280, "creation_date": 1435778865, "last_edit_date": 1435778917, "question_id": 31170014, "link": "https://stackoverflow.com/questions/31170014/remove-last-digit-from-number", "title": "Remove last digit from number", "body": "<p>I'm trying to write  <code>dropLastDigit :: Integer -&gt; Integer</code></p>\n\n<p>Eg <code>dropLastDigit 123 == 12</code> and <code>dropLastDigit</code> with any single digit returns 0</p>\n"}, {"tags": ["sorting", "haskell", "quicksort"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1435776787, "post_id": 31169262, "comment_id": 50346599, "body": "What leads you to believe that <code>qsrt</code> would sort the list? Which sorting algorithm are you trying to implement?"}, {"owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1435776931, "post_id": 31169262, "comment_id": 50346675, "body": "Well, I am only a novice. My thinking was, if I pattern match on (x:xs) extract the smallest element of that list and cons it with a recursion on the same function of the tail of the list I would eventually end up with a sorted list.. But the logic is clearly incorrect. None in particular. Just refactoring some functions myself for academic purposes."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1435776933, "post_id": 31169262, "comment_id": 50346677, "body": "<code>qsrt</code> takes the minimum element of <code>l</code> and then skips <code>x</code>, but <code>x</code> would only be the minimum element of <code>l</code> by accident so you&#39;re usually skipping the wrong element."}, {"owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "edited": false, "score": 0, "creation_date": 1435777070, "post_id": 31169262, "comment_id": 50346758, "body": "Doesnt l@(x:xs) represent the entire list?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1435777116, "post_id": 31169262, "comment_id": 50346787, "body": "<code>l</code> represents the entire list, <code>x</code> the head and <code>xs</code> the tail."}, {"owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1435777254, "post_id": 31169262, "comment_id": 50346889, "body": "@Rein Henrichs  I understand what you meant. How thick of me. x is not necessarily the smallest element in the list and I am completely removing it from the equation."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1435777450, "post_id": 31169262, "comment_id": 50347012, "body": "You&#39;re probably trying to implement <i>selection sort</i>. Try <code>let qsrt [] = []; qsrt l = let y = minimum&#39; l in y : qsrt (delete y l)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": true, "score": 6, "last_activity_date": 1435777418, "creation_date": 1435777418, "answer_id": 31169592, "question_id": 31169262, "link": "https://stackoverflow.com/questions/31169262/sorting-algorithm-in-haskell/31169592#31169592", "title": "Sorting algorithm in Haskell", "body": "<p>The logic error is that <code>qsrt</code> takes the minimum element of <code>l</code> and then skips <code>x</code>, but <code>x</code> would only be the minimum element of <code>l</code> by accident so you're usually skipping the wrong element.</p>\n"}, {"comments": [{"owner": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 1, "creation_date": 1435813693, "post_id": 31169865, "comment_id": 50358950, "body": "This will give wrong results if the list contains duplicate elements."}, {"owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "reply_to_user": {"reputation": 2179, "user_id": 412549, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a194a155579e30bda0926705aeb9d165?s=128&d=identicon&r=PG&f=1", "display_name": "Franky", "link": "https://stackoverflow.com/users/412549/franky"}, "edited": false, "score": 0, "creation_date": 1435851018, "post_id": 31169865, "comment_id": 50382565, "body": "@Franky Thanks for pointing it out. It should work as intended now."}], "tags": [], "owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "is_accepted": false, "score": 1, "last_activity_date": 1436198675, "last_edit_date": 1436198675, "creation_date": 1435778356, "answer_id": 31169865, "question_id": 31169262, "link": "https://stackoverflow.com/questions/31169262/sorting-algorithm-in-haskell/31169865#31169865", "title": "Sorting algorithm in Haskell", "body": "<p>Just as an addendum to Rein Henrichs's answer, I managed to craft a correct version of the above using a filter.</p>\n\n<pre><code>import Data.List\n\nminimum' :: (Ord a) =&gt; [a] -&gt; a\nminimum' (x:xs) = foldl' (\\ x y -&gt; if x &lt;= y then x else y) x xs\n\nsrt :: (Ord a) =&gt; [a] -&gt; [a]\nsrt [] = []\nsrt l = ml : srt (delete ml l)\n    where ml = minimum' l\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 662, "favorite_count": 0, "accepted_answer_id": 31169592, "answer_count": 2, "score": 1, "last_activity_date": 1436198675, "creation_date": 1435776311, "last_edit_date": 1435776795, "question_id": 31169262, "link": "https://stackoverflow.com/questions/31169262/sorting-algorithm-in-haskell", "title": "Sorting algorithm in Haskell", "body": "<p>I am trying to implement a very trivial sorting algorithm in Haskell. It compiles but keeps giving me incorrect outputs.</p>\n\n<p>Here is the code</p>\n\n<pre><code>import Data.List\n\nminimum' :: (Ord a) =&gt; [a] -&gt; a\nminimum' (x:xs) = foldr (\\ x y -&gt; if x &lt;= y then x else y) x xs\n\nqsrt :: (Ord a) =&gt; [a] -&gt; [a]\nqsrt [] = []\nqsrt l@(x:xs) = minimum' l : qsrt xs\n</code></pre>\n\n<p>Any thoughts?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1435776705, "post_id": 31169046, "comment_id": 50346552, "body": "<code>pipes</code> is a small library with composable abstractions that can be used to build lots of complex logics, so it&#39;s natural that heavy optimization pays off at the core library level. It also has nontrivial rewrite rules. In contrast, in normal production code we don&#39;t need to concern ourselves with manual worker-wrappers. GHC usually does that fine."}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 1, "creation_date": 1435778092, "post_id": 31169046, "comment_id": 50347375, "body": "Thank you. Thanks to your keywords &quot;fully applied&quot; I&#39;ve now stumbled upon this: <a href=\"http://stackoverflow.com/questions/11690146/why-does-ghc-consider-the-lhs-syntactically-when-inlining\" title=\"why does ghc consider the lhs syntactically when inlining\">stackoverflow.com/questions/11690146/&hellip;</a> which I hope will share a little more light on the issue for me. It is quite disappointing when you see all the other magic that haskell can achieve."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1435778459, "post_id": 31169046, "comment_id": 50347562, "body": "if it that easy to &quot;inline&quot; a recursive function, why is not GHC doing this trick itself ?"}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 1, "creation_date": 1435779223, "post_id": 31169046, "comment_id": 50347985, "body": "btw if it&#39;s the number of arguments that appear on the LHS that matter, could you write <code>runEffect = \\p -&gt; ...</code> and get the same performance characteristics? I think that would look much less ugly."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 1, "creation_date": 1435781680, "post_id": 31169046, "comment_id": 50349378, "body": "@EmmanuelTouzery &quot; could you write <code>runEffect = \\p -&gt; ...</code>&quot; yes that is commonly done for non-recursive functions."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "edited": false, "score": 0, "creation_date": 1435852647, "post_id": 31169046, "comment_id": 50383749, "body": "Just to make sure I understand: GHC can inline recursion? even with knowing it&#39;s beyond amazing, I would have never expected it to. If yes that&#39;s extremely impressive."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1435857474, "post_id": 31169046, "comment_id": 50386582, "body": "@mb14 <code>-fstatic-argument-transformation</code> does this, but I don&#39;t think it&#39;s on by default in <code>-O2</code> (see <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9374\" rel=\"nofollow noreferrer\">discussion</a>)  @MasterMastic no, I don&#39;t think it will in general. There are some optimisations in addition to <code>-fstatic-argument-transformation</code> that will transform recursive functions into non-recursive ones for you though"}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": true, "score": 7, "last_activity_date": 1435775580, "creation_date": 1435775580, "answer_id": 31169046, "question_id": 31168743, "link": "https://stackoverflow.com/questions/31168743/why-pipes-defines-inner-functions/31169046#31169046", "title": "why pipes defines inner functions", "body": "<p>GHC will only inline non-recursive functions, and only when they are \"fully applied\" from a syntactic point of view (i.e. at the call site they are applied to the number of arguments that appear in the left hand side in the definition).</p>\n\n<p>In the examples you posted there are no arguments, however the definitions are likely recursive and wouldn't be inlined. Doing this transformation probably allows the definitions to be inlined and specialized (for the concrete types of <code>m</code> etc.) at the call site.</p>\n\n<blockquote>\n  <p>Is this some trick to enable some optimizations? I find it ugly, if\n  it's some optimization trick I really wish the compiler could do it\n  without things like that.</p>\n</blockquote>\n\n<p>Yeah it's super lame.</p>\n"}], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 31169046, "answer_count": 1, "score": 5, "last_activity_date": 1435775901, "creation_date": 1435774509, "last_edit_date": 1435775901, "question_id": 31168743, "link": "https://stackoverflow.com/questions/31168743/why-pipes-defines-inner-functions", "title": "why pipes defines inner functions", "body": "<p>I'm looking at the <a href=\"https://github.com/Gabriel439/Haskell-Pipes-Library\" rel=\"nofollow\">pipes</a> library source code and for instance in the <a href=\"https://github.com/Gabriel439/Haskell-Pipes-Library/blob/master/src/Pipes/Core.hs\" rel=\"nofollow\">Core module</a> I don't understand why the author is all over the place using the pattern of defining functions like that:</p>\n\n<pre><code>runEffect = go\n  where\n    go p = ...\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>pull = go\n  where\n    go a' = ...\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>reflect = go\n  where\n    go p = ...\n</code></pre>\n\n<p>Is this some trick to enable some optimizations? I find it ugly, if it's some optimization trick I really wish the compiler could do it without things like that. But maybe there's another reason?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1435779457, "post_id": 31168729, "comment_id": 50348113, "body": "A conjecture: every extant language either allows you to do something that isn&#39;t useful, or is so restrictive that it is useless as a whole."}, {"owner": {"reputation": 7353, "user_id": 1378292, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bea4eb8581883ffd109fca9ab95fdb3a?s=128&d=identicon&r=PG", "display_name": "mjgpy3", "link": "https://stackoverflow.com/users/1378292/mjgpy3"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435780214, "post_id": 31168729, "comment_id": 50348530, "body": "@DanielWagner, I agree."}], "answers": [{"tags": [], "owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "is_accepted": true, "score": 9, "last_activity_date": 1491700957, "last_edit_date": 1491700957, "creation_date": 1435775244, "answer_id": 31168934, "question_id": 31168729, "link": "https://stackoverflow.com/questions/31168729/is-an-infinitely-recursive-type-useful/31168934#31168934", "title": "Is an infinitely recursive type useful?", "body": "<h2>An evaluation counter</h2>\n\n<p>You could, hypothetically, use <code>FooType</code> to optionally abort a recursive function early: For example, take this code:</p>\n\n<pre><code>foo _ 0 = 1\nfoo (Foo x) n = n * foo x (n-1)\n</code></pre>\n\n<p>If you call <code>foo allTheFoos</code>, then you get the plain factorial function. But you can pass a different value of type <code>FooType</code>, e.g.</p>\n\n<pre><code>atMostFiveSteps = Foo (Foo (Foo (Foo (Foo (error \"out of steps\")))))\n</code></pre>\n\n<p>and then <code>foo atMostFiveSteps</code> will only work for values smaller than 6.</p>\n\n<p>I\u2019m neither saying that this is particularly useful nor that this is the best way to implement such a feature...</p>\n\n<h2>A void type</h2>\n\n<p>BTW, there is a similar construction, namely</p>\n\n<pre><code>newtype FooType' = Foo' FooType'\n</code></pre>\n\n<p>which is useful: It is one way to define the void type that has no values besides \u22a5. You can still define</p>\n\n<pre><code>allTheFoos' = Foo' allTheFoos'\n</code></pre>\n\n<p>as before, but because operationally, <code>Foo</code> does nothing, this is equivalent to <code>x = x</code> and hence also \u22a5.</p>\n"}, {"comments": [{"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1435914110, "post_id": 31170306, "comment_id": 50408074, "body": "<code>allTheFoos</code> <i>is</i> the bottom, isn&#39;t it?"}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1435948315, "post_id": 31170306, "comment_id": 50426532, "body": "@ErikAllik: No, because pattern matching on it will always succeed."}, {"owner": {"reputation": 33184, "user_id": 247623, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9e67348d3e0e93ef12dd97c41a6c22?s=128&d=identicon&r=PG&f=1", "display_name": "Erik Kaplun", "link": "https://stackoverflow.com/users/247623/erik-kaplun"}, "edited": false, "score": 0, "creation_date": 1435949296, "post_id": 31170306, "comment_id": 50426835, "body": "oh right: just an infinite stream of a useless value."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 1, "last_activity_date": 1435780731, "last_edit_date": 1435780731, "creation_date": 1435779834, "answer_id": 31170306, "question_id": 31168729, "link": "https://stackoverflow.com/questions/31168729/is-an-infinitely-recursive-type-useful/31170306#31170306", "title": "Is an infinitely recursive type useful?", "body": "<pre><code>data FooType = Foo FooType\n\nallTheFoos = Foo allTheFoos\n</code></pre>\n\n<p>I think there are two useful ways to look at this type.</p>\n\n<p>First is the \"moral\" way\u2014the common approach where we pretend that Haskell types don't have \"bottom\" (non-terminating) values.  From this perspective, <code>FooType</code> is a <strong>unit type</strong>\u2014a type that has only one value, just like <code>()</code>.  This is because if you forbid bottoms, then the only value of type <code>Foo</code> is your <code>allTheFoos</code>.</p>\n\n<p>From the \"immoral\" perspective (where bottoms are allowed), <code>FooType</code> is either an infinite tower of <code>Foo</code> constructors, or a finite tower of <code>Foo</code> constructors with a bottom at the bottom.  This is similar to the \"moral\" interpretation of this type:</p>\n\n<pre><code>data Nat = Zero | Succ Nat\n</code></pre>\n\n<p>...but with bottom instead of zero, which means that you can't write functions like this one:</p>\n\n<pre><code>plus :: Nat -&gt; Nat -&gt; Nat\nplus Zero y = y\nplus (Succ x) y = Succ (x `plus` y)\n</code></pre>\n\n<p>Where does that leave us?  I think the conclusion is that <code>FooType</code> isn't really an useful type, because:</p>\n\n<ol>\n<li>If you look at it \"morally\" it's equivalent to <code>()</code>.</li>\n<li>If you look at it \"immorally\" it's similar to <code>Nat</code> but any functions that tries to match a \"zero\" is non-terminating.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5071146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ea5e1a5fff6f2a3b8bb716576a7cbb2?s=128&d=identicon&r=PG&f=1", "display_name": "asterione", "link": "https://stackoverflow.com/users/5071146/asterione"}, "is_accepted": false, "score": 1, "last_activity_date": 1435780019, "creation_date": 1435780019, "answer_id": 31170361, "question_id": 31168729, "link": "https://stackoverflow.com/questions/31168729/is-an-infinitely-recursive-type-useful/31170361#31170361", "title": "Is an infinitely recursive type useful?", "body": "<p>An extension of your FooType could be an abstract syntax tree. Taking a simple example language only having integers, sums and inverses, the type definition would be</p>\n\n<pre><code>data Exp = AnInt Integer\n         | AnInverse Exp\n         | ASum Exp Exp\n</code></pre>\n\n<p>All the following would be Exp instances:</p>\n\n<pre><code>AnInt 2  -- 2\nAnInverse ( AnInt 2 )  -- 1 / 2\nAnInverse ( ASum ( AnInt 2 ) ( AnInt 3 ) )  -- 1 / ( 2 + 3 )\nAnInverse ( ASum 1 ( AnInverse 2 ) )  -- 1 / ( 1 + 1 / 2 )\n</code></pre>\n\n<p>If we removed AnInt and ASum from the Exp definition, the type would be isomorphic to your FooType (with AnInverse replacing Foo).</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 4, "last_activity_date": 1435870692, "last_edit_date": 1495540953, "creation_date": 1435870692, "answer_id": 31194527, "question_id": 31168729, "link": "https://stackoverflow.com/questions/31168729/is-an-infinitely-recursive-type-useful/31194527#31194527", "title": "Is an infinitely recursive type useful?", "body": "<p>Let's just slightly extend your data type - let's wrap the recursion into a type parameters:</p>\n\n<pre><code>data FooType f = Foo (f (FooType f))\n</code></pre>\n\n<p>(so your original data type would be <code>FooType Identity</code>).</p>\n\n<p>Now we can modulate the recursive reference by any <code>f :: * -&gt; *</code>. But this extended type is extremely useful! In fact, it can be used to express any recursive data type using a non-recursive one. One well kwnown package where it's defined is <em>recursion-schemes</em>, as <a href=\"https://hackage.haskell.org/package/recursion-schemes-4.1.2/docs/Data-Functor-Foldable.html#v:Fix\" rel=\"nofollow noreferrer\"><code>Fix</code></a>:</p>\n\n<pre><code>newtype Fix f = Fix (f (Fix f))\n</code></pre>\n\n<p>For example, if we define</p>\n\n<pre><code>data List' a r = Cons' a r | Nil'\n</code></pre>\n\n<p>then <code>Fix (List' a)</code> is isomorphic to <code>[a]</code>:</p>\n\n<pre><code>nil :: Fix (List' a)\nnil = Fix Nil'\n\ncons :: a -&gt; Fix (List' a) -&gt; Fix (List' a)\ncons x xs = Fix (Cons' x xs)\n</code></pre>\n\n<p>Moreover, <code>Fix</code> allows us to define many generic operations on recursive data types such as folding/unfolding (<a href=\"https://stackoverflow.com/q/6941904/1333025\">catamorphisms/anamorphisms</a>).</p>\n"}, {"tags": [], "owner": {"reputation": 18055, "user_id": 936310, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/302ec54987694b9746abf8e2e0ad8caf?s=128&d=identicon&r=PG&f=1", "display_name": "alias", "link": "https://stackoverflow.com/users/936310/alias"}, "is_accepted": false, "score": 0, "last_activity_date": 1491701697, "creation_date": 1491701697, "answer_id": 43302113, "question_id": 31168729, "link": "https://stackoverflow.com/questions/31168729/is-an-infinitely-recursive-type-useful/43302113#43302113", "title": "Is an infinitely recursive type useful?", "body": "<p>The following type:</p>\n\n<pre><code>newtype H a b = Fn {invoke :: H b a -&gt; b}\n</code></pre>\n\n<p>while not exactly the same as yours but is in a similar spirit, have been shown by Launchbury, Krstic, and Sauerwein to have interesting uses regarding corouitining: <a href=\"https://arxiv.org/pdf/1309.5135.pdf\" rel=\"nofollow noreferrer\">https://arxiv.org/pdf/1309.5135.pdf</a> </p>\n"}], "owner": {"reputation": 7353, "user_id": 1378292, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bea4eb8581883ffd109fca9ab95fdb3a?s=128&d=identicon&r=PG", "display_name": "mjgpy3", "link": "https://stackoverflow.com/users/1378292/mjgpy3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 1, "accepted_answer_id": 31168934, "answer_count": 5, "score": 5, "last_activity_date": 1491701697, "creation_date": 1435774461, "last_edit_date": 1435774876, "question_id": 31168729, "link": "https://stackoverflow.com/questions/31168729/is-an-infinitely-recursive-type-useful", "title": "Is an infinitely recursive type useful?", "body": "<p>Lately I've been experimenting with the general question, <em>what will GHC allow me to do?</em> I was surprised to find, that it considers the following program as valid</p>\n\n<pre><code>module BrokenRecursiveType where\n\ndata FooType = Foo FooType\n\nmain = print \"it compiles!\"\n</code></pre>\n\n<p>At first I thought, <em>how is this useful?</em> Then I remembered that Haskell is lazy, so I could, perhaps, define a function like the following to use it</p>\n\n<pre><code>allTheFoos = Foo allTheFoos\n</code></pre>\n\n<p>Then I thought, <em>so how is this useful?</em></p>\n\n<p>Are there any valuable use cases (thought up or actually experienced) for types of similar form to <code>FooType</code>?</p>\n"}, {"tags": ["multithreading", "haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1435772964, "post_id": 31168062, "comment_id": 50344334, "body": "I don&#39;t really think there is a good way. We can recommend alternatives, but to do that well we need to know a bit of context about what you&#39;re trying to achieve. Probably the answer is &quot;just use <code>STM</code>&quot;, but it&#39;s really hard to give blind advice that&#39;s also good."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1435774142, "post_id": 31168062, "comment_id": 50344998, "body": "This is pretty much the exact problem that STM is supposed to solve. Use software transactions and you can trivially wait on multiple conditions simultaneously."}, {"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435774522, "post_id": 31168062, "comment_id": 50345201, "body": "@DanielWagner, @MathematicalOrchid <code>STM</code> only operates on memory, not external resources like files, window handles, GUI events, etc. How do I synchronize an existing source of events (e.g. a native GUI framework) using <code>STM</code>?"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1435774629, "post_id": 31168062, "comment_id": 50345272, "body": "You can either use <code>tryTakeMVar</code> (perhaps with a blocking <code>setTimeout</code>) or choose to block on a single <code>takeMVar</code>. Thirding the choice to use <code>STM</code> for at least part of your solution. You&#39;ve basically already imported that with <a href=\"http://hackage.haskell.org/package/async-2.0.2/docs/src/Control-Concurrent-Async.html#waitAny\" rel=\"nofollow noreferrer\"><code>waitAny</code></a>. Be aware that the semantics there are subtly different than what I think you want; your <code>takeAnyVar</code> will return the <i>leftmost</i> full variable, i.e. your function will be biased to the left rather than a round-robin type thing."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 3, "creation_date": 1435775147, "post_id": 31168062, "comment_id": 50345626, "body": "&quot;How do I synchronize an existing source of events (e.g. a native GUI framework) using STM&quot; The same way you&#39;d use <code>MVar</code> right? Have the file-handling or GUI bits of your code do a <code>atomically . putTMVar</code> or something."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1435778399, "post_id": 31168062, "comment_id": 50347528, "body": "Perhaps also of interest: <a href=\"http://stackoverflow.com/q/11744527/791604\">How do I watch multiple files/sockets to become readable/writable in Haskell?</a>. Note that the answer there doesn&#39;t involve <code>STM</code> at all, and is why I am hesitant to try to suggest an answer without understanding what concerns you are trying to address. Please give us further details about what you want to do. (Or, to use other jargon that you may be familiar with: this question reeks of an X/Y problem.)"}], "answers": [{"comments": [{"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 0, "creation_date": 1436208015, "post_id": 31170223, "comment_id": 50503394, "body": "If I use <code>readMVar</code> there is still a race condition, because another thread might have taken the <code>MVar</code> after the succeeding <code>readMVar</code> but before the <code>takeMVar</code> that empties it. This could block <code>takeAnyMVar</code> indefinitely even though some of the <code>MVar</code>s could be available. Your <code>STM</code> solution works, however."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 1, "creation_date": 1436212273, "post_id": 31170223, "comment_id": 50505793, "body": "@TobiasBrandt You&#39;re right, if you have multiple threads that consume the variables, it won&#39;t work - that&#39;s why I wrote <i>if your function is the only consumer</i> (I should better have written <i>if there is only one consuming thread</i>)."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 3, "last_activity_date": 1436286806, "last_edit_date": 1436286806, "creation_date": 1435779576, "answer_id": 31170223, "question_id": 31168062, "link": "https://stackoverflow.com/questions/31168062/how-to-wait-on-multiple-mvars/31170223#31170223", "title": "How to wait on multiple `MVar`s?", "body": "<p>If your function is the only consumer (and runs in just one thread), I guess that with <em>base-4.8</em> you could use <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Concurrent-MVar.html#v:takeMVar\" rel=\"nofollow\"><code>readMVar</code></a> in the threads and empty only the <code>TVar</code> that is being returned, keeping the others untouched.</p>\n\n<p>As suggested by @DanielWagner, <code>STM</code> would be much simpler.</p>\n\n<pre><code>import qualified Data.Foldable as F\nimport Data.List.NonEmpty\nimport Control.Concurrent.STM.TMVar\nimport Control.Monad\nimport Control.Monad.STM\n\ntakeAnyMVar :: NonEmpty (TMVar a) -&gt; STM (TMVar a, a)\ntakeAnyMVar = F.foldr1 orElse . fmap (\\t -&gt; liftM ((,) t) $ takeTMVar t)\n</code></pre>\n\n<p>Here we simply try to <code>takeTMVar</code> each of them, combined with <code>orElse</code>. If all are empty, <code>STM</code> will be smart enough to wait until one of them becomes full and then restart the transaction.</p>\n"}], "owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 405, "favorite_count": 0, "accepted_answer_id": 31170223, "answer_count": 1, "score": 3, "last_activity_date": 1436286806, "creation_date": 1435772141, "question_id": 31168062, "link": "https://stackoverflow.com/questions/31168062/how-to-wait-on-multiple-mvars", "title": "How to wait on multiple `MVar`s?", "body": "<p>I'd like a function</p>\n\n<pre><code>takeAnyMVar :: NonEmpty (MVar a) -&gt; IO (MVar a, a)\n</code></pre>\n\n<p>which waits on multiple <code>MVar</code>s simultaneously and returns the first <code>MVar</code> (and its value) that becomes available.</p>\n\n<p>In particular, it should only cause a single one of the <code>MVar</code>s in the input list to be in an empty state that wasn't empty before.</p>\n\n<hr>\n\n<p>I have an implementation, but it is both inefficient and incorrect:</p>\n\n<pre><code>import Data.List.NonEmpty          -- from semigroups\nimport Control.Concurrent.Async    -- from async\nimport Control.Concurrent.MVar\nimport Control.Applicative\nimport Data.Foldable\n\ntakeAnyMVar :: NonEmpty (MVar a) -&gt; IO (MVar a, a)\ntakeAnyMVar = runConcurrently . foldr1 (&lt;|&gt;) . fmap (Concurrently . takeMVar')\n    where\n        takeMVar' mvar = takeMVar mvar &gt;&gt;= \\val -&gt; return (mvar, val)\n</code></pre>\n\n<p>It's inefficient because it has to start a new thread for every <code>MVar</code> in the list.</p>\n\n<p>It is incorrect, because multiple threads might take their <code>MVar</code> and leave it in an empty state before they can be cancelled by the <code>(&lt;|&gt;)</code> operator (which calls <code>race</code> in the end). One of them will succeed and return its result, the others will discard their results but leave their <code>MVar</code>s empty.</p>\n\n<hr>\n\n<p>On Windows, there is the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms687025(v=vs.85).aspx\" rel=\"nofollow\">WaitForMultipleObjects</a> function, which allows to wait on multiple wait handles. I suspect there is something similar in other operating systems.</p>\n\n<p>Given that <code>MVar</code> is probably implemented in terms of OS primitives, it should be possible to write a function with the above sematics. But maybe you need access to the implementation of <code>MVar</code> in order to do that.</p>\n\n<p>The same applies to <code>Chan</code>, <code>QSem</code>, <code>MSem</code>, and other concurrency primitives.</p>\n"}, {"tags": ["arrays", "haskell", "vector", "repa"], "comments": [{"owner": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 1, "creation_date": 1435774059, "post_id": 31166615, "comment_id": 50344948, "body": "Why is it a 1D array in the first place? Where does the data come from?"}, {"owner": {"reputation": 63, "user_id": 2635997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673ce85d0506cfadc4aa78e2d0f6e19c?s=128&d=identicon&r=PG", "display_name": "Edward Lilley", "link": "https://stackoverflow.com/users/2635997/edward-lilley"}, "reply_to_user": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 0, "creation_date": 1435784943, "post_id": 31166615, "comment_id": 50351172, "body": "The data comes from a CSV file, with one (x,y,z,rho) tuple per line. (In theory it would come from an HDF5 file, but I couldn&#39;t find good enough Haskell support for HDF5; the record format would be the same in any case). I parse it with Data.Csv and Data.ByteString.Lex.Fractional into a Vector of Vectors, which is then loaded into a repa array. There is probably a better/faster way."}, {"owner": {"reputation": 63, "user_id": 2635997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673ce85d0506cfadc4aa78e2d0f6e19c?s=128&d=identicon&r=PG", "display_name": "Edward Lilley", "link": "https://stackoverflow.com/users/2635997/edward-lilley"}, "reply_to_user": {"reputation": 3291, "user_id": 1456761, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/gvNnG.png?s=128&g=1", "display_name": "Tobias Brandt", "link": "https://stackoverflow.com/users/1456761/tobias-brandt"}, "edited": false, "score": 0, "creation_date": 1435786550, "post_id": 31166615, "comment_id": 50351960, "body": "I realise that it might be better to store the table using a proper sparse array implementation. Is there a good Haskell sparse array library that supports parallelism, and can cope with ~millions of elements?"}, {"owner": {"reputation": 1593, "user_id": 1829442, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f1b88b650cc161e532273962f4017f75?s=128&d=identicon&r=PG", "display_name": "idontgetoutmuch", "link": "https://stackoverflow.com/users/1829442/idontgetoutmuch"}, "edited": false, "score": 0, "creation_date": 1436108026, "post_id": 31166615, "comment_id": 50461852, "body": "Did you manage to find a solution?"}, {"owner": {"reputation": 63, "user_id": 2635997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673ce85d0506cfadc4aa78e2d0f6e19c?s=128&d=identicon&r=PG", "display_name": "Edward Lilley", "link": "https://stackoverflow.com/users/2635997/edward-lilley"}, "edited": false, "score": 0, "creation_date": 1436121122, "post_id": 31166615, "comment_id": 50465914, "body": "Not really. I decided that a) indexing into a 1D Vector would be better (which I tried &amp; it basically worked, but is awkward because it all has to go through custom indexing and de-indexing functions); but also that b) I&#39;m approaching this problem (i.e. manipulating a list of sparsely sampled points that represent Voronoi cells from the output of a fluid dynamics simulation) the wrong way, and should rethink the whole thing. Unfortunately, everyone else in this research group uses IDL, so I&#39;m basically forced to go along with that."}, {"owner": {"reputation": 63, "user_id": 2635997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673ce85d0506cfadc4aa78e2d0f6e19c?s=128&d=identicon&r=PG", "display_name": "Edward Lilley", "link": "https://stackoverflow.com/users/2635997/edward-lilley"}, "edited": false, "score": 0, "creation_date": 1436125325, "post_id": 31166615, "comment_id": 50467221, "body": "Actually I did come up with an idiomatic repa solution, using fromFunction, but it was a bit slow and memory-hungry."}], "owner": {"reputation": 63, "user_id": 2635997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673ce85d0506cfadc4aa78e2d0f6e19c?s=128&d=identicon&r=PG", "display_name": "Edward Lilley", "link": "https://stackoverflow.com/users/2635997/edward-lilley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 312, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1435767915, "creation_date": 1435767270, "last_edit_date": 1435767915, "question_id": 31166615, "link": "https://stackoverflow.com/questions/31166615/haskell-build-a-three-dimensional-array-from-a-one-dimensional-list-of-coordin", "title": "Haskell - build a three-dimensional array from a one-dimensional list of coordinate-tuples", "body": "<p>I have a list of 3D coordinates (x,y,z) that specify a scalar value (rho) at each location, which I have loaded into a repa array:</p>\n\n<pre><code>a :: Array D DIM1 (Int, Int, Int, Double)\n</code></pre>\n\n<p>i.e. each array element is a 4-tuple, representing (x,y,z,rho). Also, I'm not tied to using repa.</p>\n\n<p>I would like to transform this into a DIM3 array, with each location containing the appropriate rho value (or a default value, or perhaps an interpolated value).</p>\n\n<p>I can't think of a way to do this with <code>traverse</code> (at least not efficiently), because <code>traverse</code> uses indices from the new array, not the source array. Is it possible at all with repa, or do I need to use a different array library (even a mutable one)?</p>\n"}, {"tags": ["haskell", "preprocessor"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1435762087, "post_id": 31164635, "comment_id": 50337635, "body": "If it&#39;s <code>#define</code> and similar that&#39;s causing you problems, you don&#39;t want <code>MagicHash</code>, you want <code>CPP</code>."}, {"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1435762127, "post_id": 31164635, "comment_id": 50337663, "body": "I tried only adding that also, didn&#39;t work"}], "answers": [{"tags": [], "owner": {"reputation": 7002, "user_id": 827593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d852cf0e1b0e4036e07754fc3925f46?s=128&d=identicon&r=PG", "display_name": "JP Moresmau", "link": "https://stackoverflow.com/users/827593/jp-moresmau"}, "is_accepted": true, "score": 5, "last_activity_date": 1435763260, "last_edit_date": 1495541647, "creation_date": 1435763260, "answer_id": 31165132, "question_id": 31164635, "link": "https://stackoverflow.com/questions/31164635/error-parsing-haskell-source-file-containing-c-preprocessor/31165132#31165132", "title": "Error parsing haskell source file containing # (c preprocessor)", "body": "<p>Haskell-src-exts doesn't support CPP natively (there is no issue in the GitHub issue tracker for that, but an old one on trac at <a href=\"http://trac.haskell.org/haskell-src-exts/ticket/27\" rel=\"nofollow noreferrer\">http://trac.haskell.org/haskell-src-exts/ticket/27</a>). </p>\n\n<p>You can look at <a href=\"https://stackoverflow.com/questions/9235688/solution-or-workarounds-for-haskell-src-exts-parsing-modules-with-cpp-failing\">solution or workarounds for haskell-src-exts parsing modules with CPP failing</a> for workarounds (using cpphs). </p>\n\n<p>There is also a package called hse-cpp (<a href=\"https://hackage.haskell.org/package/hse-cpp\" rel=\"nofollow noreferrer\">https://hackage.haskell.org/package/hse-cpp</a>) that looks like it can run cpphs for you, but I haven't used it, and it doesn't seem to get updated a lot.</p>\n"}], "owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 31165132, "answer_count": 1, "score": 1, "last_activity_date": 1435767302, "creation_date": 1435761967, "last_edit_date": 1435767302, "question_id": 31164635, "link": "https://stackoverflow.com/questions/31164635/error-parsing-haskell-source-file-containing-c-preprocessor", "title": "Error parsing haskell source file containing # (c preprocessor)", "body": "<p>When parsing haskell source files that contain <code>#define</code> and <code>#if</code>, <code>parseFileContentsWithMode</code> gets confused and throws an error about the hash. I tried to include <code>MagicHash</code> and <code>CPP</code> in the extension list (<code>extns</code>, see below) but that didn't work. I can't really change the source files because there are a lot of them. </p>\n\n<pre><code>getModule extns filePath program = fromParseResult $ parseFileContentsWithMode mode program\n                         where\n                                  bangPatternsExt = map parseExtension extns\n                                  mode = ParseMode filePath Haskell2010 bangPatternsExt False False \n</code></pre>\n\n<p>The parser failed at: </p>\n\n<pre><code>#if __GLASGOW_HASKELL__ &gt;= 612\n\ninstance Lift ModName where\n  lift = lift . modString\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "cabal", "haskell-platform"], "answers": [{"comments": [{"owner": {"reputation": 1106, "user_id": 298285, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d3611288bdc8ccb57fd22c2df61a967?s=128&d=identicon&r=PG", "display_name": "1111161171159459134", "link": "https://stackoverflow.com/users/298285/1111161171159459134"}, "edited": false, "score": 1, "creation_date": 1435771139, "post_id": 31165433, "comment_id": 50343391, "body": "Changing <code>hp_7_10_2</code> to <code>hp2015_2_0_0</code> in <code>src&#47;Main.hs</code> did it! +1 for that."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 1, "last_activity_date": 1435764861, "last_edit_date": 1435764861, "creation_date": 1435764048, "answer_id": 31165433, "question_id": 31164449, "link": "https://stackoverflow.com/questions/31164449/how-to-have-base-4-8-1-0-on-ghc-7-10-1/31165433#31165433", "title": "How to have base-4.8.1.0 on ghc-7.10.1?", "body": "<p>Searching in the <code>haskell-platform</code> repository for mentions of <code>base</code> constraints, I found in hptool/src/Releases2015.hs <a href=\"https://github.com/haskell/haskell-platform/blob/a2fe07c0665b1fa471e97b373fda5979990dee22/hptool/src/Releases2015.hs#L111\" rel=\"nofollow\">a <code>hp_7_10_2</code> value of type <code>Release</code> which seems to specify the 4.8.1.0 constraint</a>, as well as an analogous <code>hp2015_2_0_0</code> with a 4.8.0.0 constraint. That <code>hp_7_10_2</code> value is used to specify the release to install in <a href=\"https://github.com/haskell/haskell-platform/blob/a2fe07c0665b1fa471e97b373fda5979990dee22/hptool/src/Main.hs#L85\" rel=\"nofollow\">src/Main.hs</a>, so I guess if you change that line to use <code>hp2015_2_0_0</code> you will get dependencies that can be satisfied. The alternative would be installing GHC 7.10.2 (which includes <code>base</code> 4.8.1.0), which is still unreleased (however, there is a <a href=\"http://permalink.gmane.org/gmane.comp.lang.haskell.ghc.devel/9024\" rel=\"nofollow\">release candidate</a>, and the official release should happen soon).</p>\n"}], "owner": {"reputation": 1106, "user_id": 298285, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d3611288bdc8ccb57fd22c2df61a967?s=128&d=identicon&r=PG", "display_name": "1111161171159459134", "link": "https://stackoverflow.com/users/298285/1111161171159459134"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 0, "accepted_answer_id": 31165433, "answer_count": 1, "score": 0, "last_activity_date": 1435764861, "creation_date": 1435761514, "last_edit_date": 1592644375, "question_id": 31164449, "link": "https://stackoverflow.com/questions/31164449/how-to-have-base-4-8-1-0-on-ghc-7-10-1", "title": "How to have base-4.8.1.0 on ghc-7.10.1?", "body": "<p>Just installed ghc-7.10.1, followed by cabal-1.22.6 on Debian 7.8 (<em>from sources</em>). I'm following <em>minimal</em> installation of Haskell from <a href=\"http://www.extellisys.com/articles/haskell-on-debian-wheezy\" rel=\"nofollow noreferrer\">http://www.extellisys.com/articles/haskell-on-debian-wheezy</a> (I replaced 7.8.4 by 7.10.1, and downloaded latest <code>haskell-platform-master</code> from <a href=\"https://github.com/haskell/haskell-platform\" rel=\"nofollow noreferrer\">github</a>)</p>\n<p>But, whenever I try to install Haskell Platform, installation breaks minutes later at this point:</p>\n<pre><code>Building hptool-0.1...\nPreprocessing executable 'hptool' for hptool-0.1...\n***\n*** Running hptool\n***\n# cabal (for build/package/hscolour-1.23/deps)\nError when running Shake build system:\n* build-all\n* build-source\n* build/product/haskell-platform-7.10.2.tar.gz\n* build/lists/build.packages\n* build/package/hscolour-1.23/deps\nError computing dependencies of hscolour-1.23:\nResolving dependencies...\n\ncabal: Could not resolve dependencies:\ntrying: hscolour-1.23 (user goal)\nnext goal: base (dependency of hscolour-1.23)\nrejecting: base-4.8.0.0/installed-1b6..., 4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0,\n4.6.0.1, 4.6.0.0, 4.5.1.0, 4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0, 4.3.0.0,\n4.2.0.2, 4.2.0.1, 4.2.0.0, 4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global\nconstraint requires ==4.8.1.0)\nDependency tree exhaustively searched.\n</code></pre>\n<p>How to solve that? <br>\nHow to have base 4.8.1.0?</p>\n"}, {"tags": ["haskell", "pattern-matching", "symbols"], "comments": [{"owner": {"reputation": 865, "user_id": 3694032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/32d8fabde29edf207ac92275275af90a?s=128&d=identicon&r=PG&f=1", "display_name": "rem", "link": "https://stackoverflow.com/users/3694032/rem"}, "edited": false, "score": 0, "creation_date": 1435762428, "post_id": 31164074, "comment_id": 50337889, "body": "You can search for symbols on Hoogle <a href=\"https://www.haskell.org/hoogle/?hoogle=\" rel=\"nofollow noreferrer\">haskell.org/hoogle/?hoogle=</a>!"}], "answers": [{"tags": [], "owner": {"reputation": 777, "user_id": 3900056, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45ff0756018a3a41955b5d29e3ab63fb?s=128&d=identicon&r=PG&f=1", "display_name": "zcleghern", "link": "https://stackoverflow.com/users/3900056/zcleghern"}, "is_accepted": false, "score": 3, "last_activity_date": 1435760883, "creation_date": 1435760883, "answer_id": 31164180, "question_id": 31164074, "link": "https://stackoverflow.com/questions/31164074/what-do-and-mean/31164180#31164180", "title": "What do @ and ! mean?", "body": "<p>In Haskell, you can use an As Pattern to give an argument an alternative name by which you can refer to it. In your case, </p>\n\n<pre><code>xs@(_:xs')\n</code></pre>\n\n<p>allows you to use xs as an alternative name for the argument (_:xs').  Otherwise, you wouldn't be able to do this because _ matches any argument, but is unusable otherwise.</p>\n"}, {"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1435761306, "post_id": 31164215, "comment_id": 50337049, "body": "<code>!</code> is also used in other contexts than vector indexing."}], "tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": false, "score": 3, "last_activity_date": 1435760964, "creation_date": 1435760964, "answer_id": 31164215, "question_id": 31164074, "link": "https://stackoverflow.com/questions/31164074/what-do-and-mean/31164215#31164215", "title": "What do @ and ! mean?", "body": "<p>The <code>@</code> symbol is used to bind <code>xs</code> to the pattern that you have used (<code>_:xs')</code>, so <code>xs'</code> is bound to the tail of the list and <code>xs</code> is bound to the head consed onto the tail of the list.  The <code>!</code> used for O(1) constant time indexing of a vector.  See the documentation here: <a href=\"https://hackage.haskell.org/package/vector-0.9.1/docs/Data-Vector.html\" rel=\"nofollow\">https://hackage.haskell.org/package/vector-0.9.1/docs/Data-Vector.html</a></p>\n"}, {"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1435761258, "post_id": 31164321, "comment_id": 50337014, "body": "<code>!</code> is also used for strictness annotations, which are distinct from bang patterns."}, {"owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1435761772, "post_id": 31164321, "comment_id": 50337428, "body": "@jubobs Thanks for the clarification."}], "tags": [], "owner": {"reputation": 4681, "user_id": 1264328, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/786f8275d9fa334bc27630e0fc7f0d22?s=128&d=identicon&r=PG", "display_name": "bwroga", "link": "https://stackoverflow.com/users/1264328/bwroga"}, "is_accepted": false, "score": 8, "last_activity_date": 1435763264, "last_edit_date": 1435763264, "creation_date": 1435761194, "answer_id": 31164321, "question_id": 31164074, "link": "https://stackoverflow.com/questions/31164074/what-do-and-mean/31164321#31164321", "title": "What do @ and ! mean?", "body": "<p>The @ symbol allows you to pattern match and refer to the entire value you are pattern matching against. In your example you can refer to the whole list argument as xs (using the @ symbol) and the tail of the list as xs' (using pattern matching).</p>\n\n<p>The ! symbol can be used to force a value to be evaluated strictly instead of lazily (using bang patterns or strictness annotations).</p>\n"}, {"tags": [], "owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "is_accepted": false, "score": 2, "last_activity_date": 1435853881, "creation_date": 1435853881, "answer_id": 31189726, "question_id": 31164074, "link": "https://stackoverflow.com/questions/31164074/what-do-and-mean/31189726#31189726", "title": "What do @ and ! mean?", "body": "<p><strong>!</strong> can be a keyword in which case <a href=\"https://wiki.haskell.org/Keywords#.21\" rel=\"nofollow\">it may be a strictness annotation or bang pattern</a>.</p>\n\n<p><a href=\"http://hackage.haskell.org/packages/archive/array/latest/doc/html/Data-Array.html#v:-33-\" rel=\"nofollow\"><strong>!</strong> can also be a function name</a> defaulting to infix application (aka. an operator) of which there are many library examples including array indexing.</p>\n\n<p><a href=\"https://wiki.haskell.org/Keywords#.40\" rel=\"nofollow\"><strong>@</strong> is a keyword for an as pattern (aka. view pattern)</a>.  It can also be <a href=\"http://hackage.haskell.org/package/HUnit-1.2.5.2/docs/Test-HUnit-Base.html\" rel=\"nofollow\">part of a function name like it is for several HUnit assertions</a>.</p>\n\n<p><a href=\"https://www.fpcomplete.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/pattern-and-guard-extensions\" rel=\"nofollow\">Interesting uses of bang patterns and view patterns</a> are described at the School of Haskell.</p>\n"}], "owner": {"reputation": 51, "user_id": 4858160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4cb6b679effaf23c1e377532ce2eb2af?s=128&d=identicon&r=PG", "display_name": "Anthony", "link": "https://stackoverflow.com/users/4858160/anthony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 1, "answer_count": 4, "score": 4, "last_activity_date": 1435853881, "creation_date": 1435760594, "last_edit_date": 1435763122, "question_id": 31164074, "link": "https://stackoverflow.com/questions/31164074/what-do-and-mean", "title": "What do @ and ! mean?", "body": "<pre><code> suffixes :: [a] -&gt; [[a]]\n suffixes xs@(_:xs') = xs : suffixes xs'\n suffixes _          = []\n</code></pre>\n\n<p>I only know that @ here is called \"AsPattern\". But how does it actually work here ?\nIs there anyone can give me a analysis?</p>\n\n<p>And how does ! work in haskell.\nI can not give an example right now. But I am pretty sure it does occur in the haskell programming .</p>\n"}, {"tags": ["c#", "haskell"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1435752196, "post_id": 31160546, "comment_id": 50330031, "body": "Your Haskell version could just be <code>forM_ (filter odd [1..99]) (putStrLn . show)</code>."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 3, "creation_date": 1435752338, "post_id": 31160546, "comment_id": 50330147, "body": "@Lee: <code>mapM_ print [1,3..99]</code>"}, {"owner": {"reputation": 23, "user_id": 4136747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebbde580e2f55d41a0e530a306b7544a?s=128&d=identicon&r=PG&f=1", "display_name": "jaroslaw", "link": "https://stackoverflow.com/users/4136747/jaroslaw"}, "reply_to_user": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 0, "creation_date": 1435752772, "post_id": 31160546, "comment_id": 50330464, "body": "@Lee thanks, great solution! I&#39;m just starting with Haskell, I&#39;m not familiar with nuances yet, just trying to get the right output :P."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 2, "creation_date": 1435752906, "post_id": 31160546, "comment_id": 50330558, "body": "Are you sure a loop of 100 is big enough to do proper benchmarking without taking extra overheads into account ?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1435753476, "post_id": 31160546, "comment_id": 50330969, "body": "@jaroslaw: Hm, actually that changes the semantics: your variant creates a single string and prints that one, while I print every number. <code>putStrLn . unlines . map show $ [1,3..99]</code> matches your original behavior."}], "answers": [{"comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 2, "creation_date": 1435753381, "post_id": 31160864, "comment_id": 50330907, "body": "This variant is also a lot closer to the Haskell code, which builds the string first and then prints all at once."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1435753810, "post_id": 31160864, "comment_id": 50331204, "body": "that&#39;s one reason I did it that way - you could even make it almost the same (using LINQ stuff) but then it will get <b>a lot</b> slower (I add it for funs ... one moment)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 7, "last_activity_date": 1435754650, "last_edit_date": 1435754650, "creation_date": 1435752456, "answer_id": 31160864, "question_id": 31160546, "link": "https://stackoverflow.com/questions/31160546/haskell-processing-so-much-faster-than-c-codeeval/31160864#31160864", "title": "haskell processing so much faster than C# (codeeval)", "body": "<p>for C# it is your <code>Console.WriteLine</code>:</p>\n\n<p>this one:</p>\n\n<pre><code>    var timer = new Stopwatch();\n    timer.Start();\n    var sb = new StringBuilder();\n    for (int i = 1; i &lt;= 99; i++)\n    {\n        if (i%2 == 1) sb.AppendLine(i.ToString());\n    }\n    Console.Write(sb.ToString());\n    timer.Stop();\n    Console.WriteLine(\"took {0:0.0}ms\", timer.Elapsed.TotalMilliseconds);\n</code></pre>\n\n<p>takes 1-2ms on in release on my machine, yours take around 10ms</p>\n\n<p>For their site it might take even longer, depending on what they do with the output.</p>\n\n<p>Aside from this C#'s generated code will still be interpreted by some runtime, so you might even measure the initialization/startup as well </p>\n\n<p>Haskell might probably not (although they might just <code>runhaskell</code> as well ...(?))</p>\n\n<p>I guess you have to ask the support from CodeEval for details.</p>\n\n<hr>\n\n<h3>LINQ style</h3>\n\n<p>back to around 10ms but closer to Haskell</p>\n\n<pre><code>    var numbers =\n        String.Join(\"\\n\",\n        Enumerable\n            .Range(1, 99)\n            .Where(i =&gt; i%2 == 1)\n            .Select(i =&gt; i.ToString()));\n\n    Console.WriteLine(numbers);\n</code></pre>\n\n<hr>\n\n<h3>some fun / performance tests</h3>\n\n<p>I extended the range to 9999 with this in <em>eshell</em> <code>time ./prg.exe</code> (yeah I'm on windows right now :( ):</p>\n\n<ul>\n<li>your original Haskell version with <code>ghc -O2</code>: about <strong>0.72s</strong></li>\n<li>the <code>Stringbuilder</code> version I posted above compiled to release: around <strong>0.87</strong></li>\n</ul>\n\n<p>quite close <em>IMO</em></p>\n\n<p>here with 99999:</p>\n\n<ul>\n<li>C# <strong>8.2s</strong></li>\n<li>Haskell: <strong>8.2s</strong></li>\n</ul>\n\n<p>so no worry they seem to be very close ;)</p>\n\n<p>But I am not surprised at all - in the end all you do is print something to the console - so it should only depend on your OS/machine.</p>\n\n<p>The other problems might be more interesting but I am to lazy to write code for them</p>\n"}], "owner": {"reputation": 23, "user_id": 4136747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebbde580e2f55d41a0e530a306b7544a?s=128&d=identicon&r=PG&f=1", "display_name": "jaroslaw", "link": "https://stackoverflow.com/users/4136747/jaroslaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 31160864, "answer_count": 1, "score": 2, "last_activity_date": 1435754650, "creation_date": 1435751629, "question_id": 31160546, "link": "https://stackoverflow.com/questions/31160546/haskell-processing-so-much-faster-than-c-codeeval", "title": "haskell processing so much faster than C# (codeeval)", "body": "<p>I'm doing some challenges on codeeval and I was shocked when I saw results. Haskell results tend to be several times faster than C# solutions. I know both languages are different but can anyone explain to me (as simple as possible) why the difference is so big? Is it haskell superiority or just codeeval fault?</p>\n\n<p>Some examples:\nchallenge: odd numbers, time (ms): haskell -> 1, C# -> 123</p>\n\n<p>C#\n    using System;\n    using System.IO;</p>\n\n<pre><code>class Program\n{\n    static void Main(string[] args)\n    {\n         for(int i=1;i&lt;=99;i++)\n            {\n            if(i%2==1) Console.WriteLine(i);\n            }\n    }\n}\n</code></pre>\n\n<p>Haskell</p>\n\n<pre><code>main = do\n    putStrLn $ init . drop 1 . replace ',' '\\n' . show . filter odd $ [1..99]\n\n\nreplace :: Char -&gt; Char -&gt; String -&gt; String\nreplace c1 c2 line = map (\\letter -&gt; if letter==c1 then c2 else letter) line\n</code></pre>\n\n<p>challenge: reverse words, time: haskell -> 2, C# -> 166</p>\n\n<p>challenge: sum of digits, time: haskell -> 1, C# -> 168</p>\n\n<p>challenge: swap numbers, time: haskell -> 7, C# -> 355</p>\n"}, {"tags": ["haskell", "yesod", "hackage"], "answers": [{"tags": [], "owner": {"reputation": 1521, "user_id": 365807, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/8c9db2824164d60fe55d2b0c1c361f20?s=128&d=identicon&r=PG", "display_name": "Fraser", "link": "https://stackoverflow.com/users/365807/fraser"}, "is_accepted": true, "score": 2, "last_activity_date": 1435756670, "creation_date": 1435756670, "answer_id": 31162521, "question_id": 31160216, "link": "https://stackoverflow.com/questions/31160216/regular-expression-on-yesod-type-text/31162521#31162521", "title": "Regular Expression on Yesod type Text", "body": "<p>Have you taken a look at the <a href=\"http://hackage.haskell.org/package/regex-tdfa-text\" rel=\"nofollow\">regex-tdfa-text</a> package? It provides backend support for using the <code>regex-base</code> library with <code>Text</code> strings.</p>\n"}], "owner": {"reputation": 2323, "user_id": 1119141, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/07a90f05a88400f7b44f2ab637097996?s=128&d=identicon&r=PG", "display_name": "HHC", "link": "https://stackoverflow.com/users/1119141/hhc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 31162521, "answer_count": 1, "score": 1, "last_activity_date": 1435756670, "creation_date": 1435750696, "question_id": 31160216, "link": "https://stackoverflow.com/questions/31160216/regular-expression-on-yesod-type-text", "title": "Regular Expression on Yesod type Text", "body": "<p>Currently, I am changing my Text to String then using Text.Regex.Posix to do my matching.  Is there a idiomatic and efficient way to do regular expression in Yesod?</p>\n"}, {"tags": ["haskell", "type-families", "type-level-computation"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1435770695, "post_id": 31155186, "comment_id": 50343096, "body": "&quot;There is nothing holding you back from having types <code>f1</code> and <code>f2</code> such that <code>f1 -&gt;&gt; Val f1 ~ f2 -&gt;&gt; Val f2</code>.&quot; Actually, there is: <code>(-&gt;&gt;)</code> is closed, and <code>Val</code> is a data family (not a type family), hence injective. Unfortunately, GHC simply doesn&#39;t take advantage of the closedness of type families during any of its reasoning (yet?)."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 7, "last_activity_date": 1435736036, "creation_date": 1435736036, "answer_id": 31155186, "question_id": 31154107, "link": "https://stackoverflow.com/questions/31154107/convert-type-level-list-a-b-c-to-function-a-b-c/31155186#31155186", "title": "Convert type-level list &#39;[a,b,c,...] to function a-&gt;b-&gt;c-&gt;", "body": "<p>Your code fails to typecheck because <a href=\"https://wiki.haskell.org/GHC/Type_families#Injectivity.2C_type_inference.2C_and_ambiguity\">type families are not (necessarily) injective</a>. If you help out GHC by specifying the choice of <code>f</code> in <code>f -&gt;&gt; Val f</code>, then it works as expected:</p>\n\n<pre><code>{-# LANGUAGE KindSignatures, DataKinds, TypeOperators, \n             TypeFamilies, FlexibleInstances, PolyKinds #-}\n\nmodule Issue where\n\nimport Data.Proxy\n\ntype family (-&gt;&gt;) (l :: [*]) (y :: *) :: * where\n    '[]       -&gt;&gt; y = y\n    (x ': xs) -&gt;&gt; y = x -&gt; (xs -&gt;&gt; y)\n\nclass CVal (f :: [*]) where\n    data Val f :: *\n    construct :: proxy f -&gt; f -&gt;&gt; Val f\n\ninstance CVal '[Int, Float, Bool] where\n    data Val '[Int, Float, Bool] = Val2 Int Float Bool deriving Show\n    construct _ = Val2\n\nv :: Val '[Int, Float, Bool]\nv = construct (Proxy :: Proxy '[Int, Float, Bool]) 0 0 True\n</code></pre>\n\n<p>The key point is passing that <code>Proxy :: Proxy '[Int, Float, Bool]</code> argument to <code>construct</code>, thereby fixing the choice of <code>f</code>. That is because there is nothing holding you back from having types <code>f1</code> and <code>f2</code> such that <code>f1 -&gt;&gt; Val f1 ~ f2 -&gt;&gt; Val f2</code>.</p>\n\n<p>Don't worry, <a href=\"http://lambda.jstolarek.com/2015/05/injective-type-families-for-haskell/\">this shortcoming of the language is being looked at</a>.</p>\n"}], "owner": {"reputation": 1117, "user_id": 1641035, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b63d948c23003346549369112f336519?s=128&d=identicon&r=PG", "display_name": "Alexey Vagarenko", "link": "https://stackoverflow.com/users/1641035/alexey-vagarenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 1, "accepted_answer_id": 31155186, "answer_count": 1, "score": 5, "last_activity_date": 1435736149, "creation_date": 1435732532, "last_edit_date": 1435736149, "question_id": 31154107, "link": "https://stackoverflow.com/questions/31154107/convert-type-level-list-a-b-c-to-function-a-b-c", "title": "Convert type-level list &#39;[a,b,c,...] to function a-&gt;b-&gt;c-&gt;", "body": "<p>I have a data family indexed by type-level list, where types in a list correspond to parameters of a data instance.\nI want to write function that will have different arity and parameters depending on a data instance, so I could use it like synonym for every data instance in the family.</p>\n\n<pre><code>{-# LANGUAGE KindSignatures, DataKinds, TypeOperators, \n             TypeFamilies, FlexibleInstances, PolyKinds #-}\n\nmodule Issue where\n\n\ntype family (-&gt;&gt;) (l :: [*]) (y :: *) :: * where\n    '[]       -&gt;&gt; y = y\n    (x ': xs) -&gt;&gt; y = x -&gt; (xs -&gt;&gt; y)\n\nclass CVal (f :: [*]) where\n    data Val f :: *\n    construct :: f -&gt;&gt; Val f\n\ninstance CVal '[Int, Float, Bool] where\n    data Val '[Int, Float, Bool] = Val2 Int Float Bool\n    construct = Val2\n</code></pre>\n\n<p>This compiles fine. But when I try to apply <code>construct</code> function:</p>\n\n<pre><code>v :: Val '[Int, Float, Bool]\nv = construct 0 0 True\n</code></pre>\n\n<p>it produces error:</p>\n\n<pre><code>Couldn't match expected type `a0\n                              -&gt; a1 -&gt; Bool -&gt; Val '[Int, Float, Bool]'\n            with actual type `f0 -&gt;&gt; Val f0'\nThe type variables `f0', `a0', `a1' are ambiguous\nThe function `construct' is applied to three arguments,\nbut its type `f0 -&gt;&gt; Val f0' has none\nIn the expression: construct 0 0 True\nIn an equation for `v': v = construct 0 0 True\n</code></pre>\n"}, {"tags": ["haskell", "functor", "applicative"], "answers": [{"comments": [{"owner": {"reputation": 749, "user_id": 2748415, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d551faddd02dae2ef57874988c081ae?s=128&d=identicon&r=PG", "display_name": "rjs", "link": "https://stackoverflow.com/users/2748415/rjs"}, "edited": false, "score": 0, "creation_date": 1435723720, "post_id": 31152362, "comment_id": 50314342, "body": "Thanks a ton for this, this is exactly what I was looking for. I&#39;ll have to look more into Eta and Beta expansion and reduction for future reading. Even though <code>$</code> is right associative, it&#39;s being applied to a thunk (is it safe to call all the mapping happening left of the $ a thunk?) and therefore all of this gets evaluated, right?"}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 749, "user_id": 2748415, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d551faddd02dae2ef57874988c081ae?s=128&d=identicon&r=PG", "display_name": "rjs", "link": "https://stackoverflow.com/users/2748415/rjs"}, "edited": false, "score": 0, "creation_date": 1435723935, "post_id": 31152362, "comment_id": 50314398, "body": "@RJS You can think of <code>f $ a</code> &quot;acting like&quot; <code>(f) (a)</code> where <code>f</code> and <code>a</code> are bits of code that can have spaces (it&#39;s not quite like that all the time though, especially when <code>$</code>s are chained, but I often think of it like that). I added a little bit about fixity, I should probably expand on it. There is actually a (pretty good) argument for making <code>$</code> left associative, incidentally.  I&#39;m not sure how being a thunk is related. What do you mean by that?"}, {"owner": {"reputation": 749, "user_id": 2748415, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d551faddd02dae2ef57874988c081ae?s=128&d=identicon&r=PG", "display_name": "rjs", "link": "https://stackoverflow.com/users/2748415/rjs"}, "edited": false, "score": 0, "creation_date": 1435724367, "post_id": 31152362, "comment_id": 50314504, "body": "Ah just wrong semantics on my part; a poor assumption that all unevaluated arguments are thunks is all."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 749, "user_id": 2748415, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d551faddd02dae2ef57874988c081ae?s=128&d=identicon&r=PG", "display_name": "rjs", "link": "https://stackoverflow.com/users/2748415/rjs"}, "edited": false, "score": 1, "creation_date": 1435724483, "post_id": 31152362, "comment_id": 50314530, "body": "@RJS Well, it is correct that an unevaluated argument is a thunk (unless it is optimized out altogether, maybe). The fact that something is a thunk generally only matters when looking at performance, infinitely large structures, infinite loops or expressions that generate errors. In particular, in the absence of infinite things and errors/exceptions, thunks don&#39;t change the meaning of something (outside of performance characteristics)."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 749, "user_id": 2748415, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d551faddd02dae2ef57874988c081ae?s=128&d=identicon&r=PG", "display_name": "rjs", "link": "https://stackoverflow.com/users/2748415/rjs"}, "edited": false, "score": 1, "creation_date": 1435724854, "post_id": 31152362, "comment_id": 50314645, "body": "By the way, eta expansion/reduction and beta reduction are terms from lambda calculus. Essentially, eta expansion means taking an expression <code>f</code> (where <code>f</code> is a function) and turning it into <code>\\x -&gt; f x</code>. Eta reduction goes the other way. Beta reduction is reducing a function application: <code>(\\x -&gt; f x) a</code> gets turned into <code>f a</code>. There are subtleties related to variable capture, but that is most important when making a compiler or interpreter. It&#39;s just important to remember that, when you&#39;re doing it by hand, you should use fresh variables so that name conflicts don&#39;t occur."}, {"owner": {"reputation": 749, "user_id": 2748415, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d551faddd02dae2ef57874988c081ae?s=128&d=identicon&r=PG", "display_name": "rjs", "link": "https://stackoverflow.com/users/2748415/rjs"}, "edited": false, "score": 0, "creation_date": 1435726232, "post_id": 31152362, "comment_id": 50315068, "body": "I see where I was lead astray; step six and seven on your chart expand the curried variable into an explicit one (which I was forgetting). Since this is a great answer, maybe adding one more &#39;infix&#39; step for the prefixed <code>(+)</code> around step nine might be useful considering that you include infix steps for other parts...just a thought. Thanks again!"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1435777634, "post_id": 31152362, "comment_id": 50347136, "body": "The first &quot;Eta expand&quot; step also snuck in a &quot;definition of (.)&quot;, which you may want to make a separate step."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1435815063, "post_id": 31152362, "comment_id": 50359392, "body": "@ReinHenrichs Good catch. That should say &quot;Definition of (.)&quot;"}], "tags": [], "owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "is_accepted": true, "score": 16, "last_activity_date": 1435815020, "last_edit_date": 1435815020, "creation_date": 1435723480, "answer_id": 31152362, "question_id": 31152042, "link": "https://stackoverflow.com/questions/31152042/haskell-evaluation-of-3-100-5/31152362#31152362", "title": "Haskell - Evaluation of (+) &lt;$&gt; (+3) &lt;*&gt; (*100) $ 5", "body": "<p>Firstly, note that both <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> associate to the left. There's nothing magical happening internally and we can see the transformation with essentially a series of eta expansions and beta reductions. Step-by-step, it looks like this:</p>\n\n<pre><code>(((+) &lt;$&gt; (+3))         &lt;*&gt; (*100)) $ 5        -- Add parens\n((fmap (+) (+3))        &lt;*&gt; (*100)) $ 5        -- Prefix fmap\n(((+) . (+3))           &lt;*&gt; (*100)) $ 5        -- fmap = (.)\n((\\a -&gt; (+) ((+3) a))   &lt;*&gt; (*100)) $ 5        -- Definition of (.)\n((\\a -&gt; (+) (a+3))      &lt;*&gt; (*100)) $ 5        -- Infix +\n((\\a b -&gt; (+) (a+3) b)) &lt;*&gt; (*100)) $ 5        -- Eta expand\n(\\x -&gt; (\\a b -&gt; (+) (a+3) b) x ((*100) x)) $ 5 -- Definition of (&lt;*&gt;)\n(\\x -&gt; (\\a b -&gt; (+) (a+3) b) x (x*100)) $ 5    -- Infix *\n(\\a b -&gt; (+) (a + 3) b) 5 (5*100)              -- Beta reduce\n(\\a b -&gt; (a + 3) + b)   5 (5*100)              -- Infix +\n(5 + 3) + (5*100)                              -- Beta reduce (twice)\n508                                            -- Definitions of + and *\n</code></pre>\n\n<p>A bit confusingly, the fact that <code>$</code> associates to the right has less to do with what's happening here than the fact that its fixity is 0. We can see this if we define a new operator:</p>\n\n<pre><code>(#) :: (a -&gt; b) -&gt; a -&gt; b\nf # a = f a\ninfixl 0 #\n</code></pre>\n\n<p>and in GHCi:</p>\n\n<pre><code>\u03bb&gt; (+) &lt;$&gt; (+3) &lt;*&gt; (*100) # 5\n508\n</code></pre>\n"}], "owner": {"reputation": 749, "user_id": 2748415, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d551faddd02dae2ef57874988c081ae?s=128&d=identicon&r=PG", "display_name": "rjs", "link": "https://stackoverflow.com/users/2748415/rjs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 3, "accepted_answer_id": 31152362, "answer_count": 1, "score": 11, "last_activity_date": 1435815020, "creation_date": 1435721137, "last_edit_date": 1435723476, "question_id": 31152042, "link": "https://stackoverflow.com/questions/31152042/haskell-evaluation-of-3-100-5", "title": "Haskell - Evaluation of (+) &lt;$&gt; (+3) &lt;*&gt; (*100) $ 5", "body": "<p><a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\">From the chapter on Functors in Learn You a Haskell for Great Good</a>, Lipova\u010da states:</p>\n\n<blockquote>\n  <p>\"When we do <code>(+) &lt;$&gt; (+3) &lt;*&gt; (*100)</code>, we're making a function that will use <code>+</code> on the results of <code>(+3)</code> and <code>(*100)</code> and return that. To demonstrate on a real example, when we did <code>(+) &lt;$&gt; (+3) &lt;*&gt; (*100) $ 5</code>, the <code>5</code> first got applied to <code>(+3)</code> and <code>(*100)</code>, resulting in <code>8</code> and <code>500</code>. Then, <code>+</code> gets called with <code>8</code> and <code>500</code>, resulting in <code>508</code>.\"</p>\n</blockquote>\n\n<p>However, if I try to evaluate the function myself, considering this definition for Applicative on the functor ((->) r):</p>\n\n<pre><code>instance Applicative ((-&gt;) r) where  \n    pure x = (\\_ -&gt; x)  \n    f &lt;*&gt; g = \\x -&gt; f x (g x)  \n</code></pre>\n\n<p>I read the evaluation of the above expression as:</p>\n\n<p><code>(\\x -&gt; (3 + x) (100 * x)) $ 5</code></p>\n\n<p>But I don't see how we can compose two partially applied binary functions as a single lambda (in fact, GHCi throws an infinite type error trying to bind this to a variable). Furthermore, to a working interpretation, if we look at the type definition for <code>&lt;$&gt;</code> we get:</p>\n\n<p><code>(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</code></p>\n\n<p>or more specifically we can look at its lifting as:</p>\n\n<p><code>(&lt;$&gt;) :: Functor f =&gt; (a -&gt; b) -&gt; (f a -&gt; f b)</code></p>\n\n<p>Considering that our functor in this case is ((->) r), I can deduce that this is what transformation takes place on the previous evaluation (assuming that left associativity happens first, instead of the right associative application of <code>5</code>):</p>\n\n<p><code>(\\x -&gt; a + b)</code> where <code>a</code> = <code>(+ 3)</code> and <code>b</code> = <code>(* 100)</code>. This is the function that should be returned. However, am I correct in assuming that this is the final (rough) form?</p>\n\n<p><code>(\\x -&gt; (3 + x) + (100 * x)) $ 5</code></p>\n\n<p>...which yields 508.</p>\n\n<p>I find Lipova\u010da's description more comprehensible in terms of how the expression works, but my gut tells me isn't entirely true for the gorey details under the Haskell compiler hood. It is easier for me to think that the fmap of (+) happened first resulting in a function with two functors who are partially applied functions that take a shared input, and then we applied a value to it. We can do this because of lazy evaluation. Is this wrong?</p>\n"}, {"tags": ["haskell", "polymorphism", "lambda-calculus", "type-families"], "answers": [{"comments": [{"owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "edited": false, "score": 0, "creation_date": 1435764727, "post_id": 31154045, "comment_id": 50339514, "body": "Thanks for the explanation and helpful link to Conor&#39;s answer.  So my take away would be that lambda cube is merely a poset for different extensions to the base lambda calculus.  There are other extensions such as Fc [where type families somewhat resemble F\u03c9 but not quite], or subtype polymorphism in OO."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "edited": false, "score": 0, "creation_date": 1435767163, "post_id": 31154045, "comment_id": 50341103, "body": "In short, the lambda cube summarizes whether functions from X to Y are allowed, where X and Y can be &quot;types&quot; or &quot;terms&quot;. FYI, <a href=\"http://augustss.blogspot.dk/2007/10/simpler-easier-in-recent-paper-simply.html\" rel=\"nofollow noreferrer\">Here&#39;s</a> a neat tutorial implementation for the lambda cube, where you can easily move between the points of the cube by allowing/disallowing abstractions."}, {"owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "edited": false, "score": 0, "creation_date": 1435769919, "post_id": 31154045, "comment_id": 50342662, "body": "Thanks! I&#39;ll read it when I get home. So lambda cube actually doesn&#39;t have anything to do at the kind level and above, though that might not be necessary."}, {"owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "edited": false, "score": 0, "creation_date": 1435770706, "post_id": 31154045, "comment_id": 50343104, "body": "As for data families, even though they more resemble open GADTs indexed by types, how do you classify them? Given <code>data family DF t :: *</code>, due to injectivity, it is true that <code>DF :: * -&gt; *</code>.  So we can&#39;t say data families are different in the sense that type families are from (3).  I am stuck at the part where RHS of type families are themselves types, while RHS of data families are value constructors."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 4, "last_activity_date": 1435732307, "last_edit_date": 1495541447, "creation_date": 1435732307, "answer_id": 31154045, "question_id": 31151970, "link": "https://stackoverflow.com/questions/31151970/haskell-polymorphism-and-values-depending-on-types/31154045#31154045", "title": "Haskell - polymorphism and values depending on types", "body": "<p><strong>Terms indexed by types</strong></p>\n\n<p>In the lambda cube this is parametric polymorphism. </p>\n\n<p>In System F, polymorphic terms look like functions that take types as arguments and return terms.</p>\n\n<pre><code>id : \u2200 a. a -&gt; a\nid = \u039ba . \u03bbx : a . x    -- \u039b binds type args, \u03bb binds term args\n</code></pre>\n\n<p>They can be instantiated by explicitly applying them to types:</p>\n\n<pre><code>boolId : Bool -&gt; Bool\nboolId = id Bool\n</code></pre>\n\n<p>In Haskell, the user-facing language doesn't have explicit type application and abstraction, because type inference can fill in the details in most (but not all) cases. In contrast, GHC Core, the intermediate language for GHC Haskell, closely resembles System F and does have type application. </p>\n\n<p>Type erasure is orthogonal to whether we can index terms by types. It happens so that in Haskell types can be erased from runtime, but we could imagine other languages that don't have uniformly sized runtime objects, and thus they'd need to keep types (or size information) around. </p>\n\n<p><strong>Types indexed by types</strong></p>\n\n<p>In the lambda cube sense this means having functions from types and type constructors to types and type constructors. </p>\n\n<p>Haskell doesn't quite have an analogous feature. Type families come closest, but they are both <a href=\"https://stackoverflow.com/questions/21219773/are-ghcs-type-famlies-an-example-of-system-f-omega\">weaker and stronger.</a> </p>\n\n<p><strong>Type classes and the lambda cube</strong></p>\n\n<p>Type classes are strange beasts that aren't modeled in the lambda cube. In Haskell they desugar into functions and dictionary passing, so they don't even show up in GHC Core. They can be seen as some sort of preprocessing on programs that relies on the self-imposed uniqueness of instances to deterministically fill in details. </p>\n"}], "owner": {"reputation": 177, "user_id": 4483452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/058d2fbe4001171d5b2b81ccd80c9ffd?s=128&d=identicon&r=PG&f=1", "display_name": "gspindles", "link": "https://stackoverflow.com/users/4483452/gspindles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 0, "accepted_answer_id": 31154045, "answer_count": 1, "score": 3, "last_activity_date": 1435732307, "creation_date": 1435720605, "last_edit_date": 1495535248, "question_id": 31151970, "link": "https://stackoverflow.com/questions/31151970/haskell-polymorphism-and-values-depending-on-types", "title": "Haskell - polymorphism and values depending on types", "body": "<p>From reading Wikipedia entry for <a href=\"https://en.wikipedia.org/wiki/Lambda_cube\" rel=\"nofollow noreferrer\">lambda cube</a> and this <a href=\"https://stackoverflow.com/questions/9338709/what-is-dependent-typing\">thread</a>, when apply to Haskell, my understanding is that</p>\n\n<ol>\n<li>family of terms indexed by terms - typical function from value to value</li>\n<li>family of terms indexed by types - ??</li>\n<li>family of types indexed by types - parametric polymorphism in type constructors, type families</li>\n<li>family of types indexed by terms - pi types (in which you fake with singleton types in Haskell), sigma types, etc...</li>\n</ol>\n\n<p>Please correct me if I got the examples listed above wrong.  Quoting from that Wikipedia article:</p>\n\n<blockquote>\n  <ul>\n  <li>Terms depending on types, or polymorphism. System F, aka second order lambda calculus (written as \u03bb2 in the diagram), is obtained by imposing only this property.</li>\n  </ul>\n</blockquote>\n\n<p>I do not know how Haskell fits into this (2) from above.  Haskell has a strong distinction between terms and types, and type erasure, so you do not have reflection stuff in OOP such as <code>typeof(a)</code> or <code>b.GetType()</code>, and then proceed to return some value based on type information at run time.</p>\n\n<p>So the only thing I can think of in Haskell relating to (2) are maybe</p>\n\n<ul>\n<li>Return type polymorphism in say <code>mempty</code> in <code>Data.Monoid</code>, where the value depends on the instance type</li>\n<li>Data families where you take in types on the LHS and have value constructors on the RHS</li>\n</ul>\n\n<p>Would that be correct?  Though I feel like I didn't make all the connections...</p>\n\n<p>Would it be correct to say ad-hoc polymorphism satisfies (2) while parametric polymorphism satisfies (3)?  But then how does ad-hoc vs parametric relates to difference in RHS of type vs data families?</p>\n\n<p>One last thing, how would sum type values such as</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/22065358/what-is-the-type-of-nothing-in-haskell\"><code>Nothing :: forall a. Maybe a</code></a></li>\n<li><code>Right 3 :: forall a. Num b =&gt; Either a b</code></li>\n</ul>\n\n<p>when they lack type context fit into this picture?  My guess would be that this is an example of (2)?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "edited": false, "score": 1, "creation_date": 1435714939, "post_id": 31151121, "comment_id": 50312437, "body": "Are you sure loadEntities isn&#39;t something like  <code>loadEntities :: a -&gt; IO b</code>  You&#39;ll also probably need something like  <code>entities &lt;- liftIO $ loadEntites arg</code>"}, {"owner": {"reputation": 157, "user_id": 3342240, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7176b48e45597d3a8a206e2f358f497?s=128&d=identicon&r=PG&f=1", "display_name": "davenportw15", "link": "https://stackoverflow.com/users/3342240/davenportw15"}, "reply_to_user": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "edited": false, "score": 0, "creation_date": 1435716896, "post_id": 31151121, "comment_id": 50312911, "body": "loadEntities seems to be` IO [Entities]`, according to the compiler. liftIO worked! Is it needed because it takes place within an ActionT monad? And is the standard liftIO in the transformers library? Thanks."}, {"owner": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "edited": false, "score": 1, "creation_date": 1435717789, "post_id": 31151121, "comment_id": 50313110, "body": "Yes, the stand <code>liftIO</code> is the the transformers library under <code>Contol.Monad.Class.IO</code>."}], "answers": [{"tags": [], "owner": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "is_accepted": true, "score": 4, "last_activity_date": 1435717729, "creation_date": 1435717729, "answer_id": 31151646, "question_id": 31151121, "link": "https://stackoverflow.com/questions/31151121/monad-type-mismatch/31151646#31151646", "title": "Monad type mismatch", "body": "<p>Writing answer so people can see a better explanation.</p>\n\n<p>If you look at <code>get</code> it has the type.</p>\n\n<pre><code>get :: MonadIO m =&gt; SpockRoute -&gt; ActionT m () -&gt; SpockT m ()\n</code></pre>\n\n<p><code>ActionT</code> is a monad transformer and it requires in inner monad to have an instance of <code>MonadIO</code>. If we look at the typeclass <code>MonadIO</code> it has a function</p>\n\n<pre><code>liftIO :: IO a -&gt; m a\n</code></pre>\n\n<p>This means every that you call execute functions of the type <code>IO a</code> in that stack by using <code>liftIO</code>. <code>ActionT</code> has an instance of <code>MonadIO</code> also and which is the one you are using here to call your IO function. So to call <code>loadEntities</code> you had to</p>\n\n<pre><code>entities &lt;- liftIO loadEntities\n</code></pre>\n\n<p>If you end of calling a certain function like that a lot you can create a separate module import it qualified and export a more friendly one.</p>\n\n<pre><code>module Lifted (loadEntities) where\n\nimport qualified SomeModule as IO\n\nloadEntities :: MonadIO m =&gt; m Entities\nloadEntities = liftIO IO.loadEntities\n</code></pre>\n\n<p>This will make it so you don't always have you use <code>liftIO</code></p>\n"}], "owner": {"reputation": 157, "user_id": 3342240, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7176b48e45597d3a8a206e2f358f497?s=128&d=identicon&r=PG&f=1", "display_name": "davenportw15", "link": "https://stackoverflow.com/users/3342240/davenportw15"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 31151646, "answer_count": 1, "score": 1, "last_activity_date": 1435717729, "creation_date": 1435713788, "question_id": 31151121, "link": "https://stackoverflow.com/questions/31151121/monad-type-mismatch", "title": "Monad type mismatch", "body": "<p>I am attempting to use the IO monad in a Spock application. The following code does not compile:</p>\n\n<pre><code>get \"api/entities\" $ do\n  entities &lt;- loadEntities\n  let e1 : xs = entities\n  text $ note e1\n</code></pre>\n\n<p><code>loadEntities</code> has the type <code>IO [Entity]</code></p>\n\n<p>The error is <code>Couldn't match type \u2018ActionT IO ()\u2019 with \u2018t0 -&gt; IO b0\u2019</code></p>\n\n<p>Is Spock using a monad other than IO? If so, how do I get the result of loadEntities?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 3, "creation_date": 1435708171, "post_id": 31150370, "comment_id": 50310840, "body": "Hint: you have exactly the correct idea, except <code>dropWhile</code> is the wrong function. <code>dropWhile</code> removes every element of the list <i>until</i> it hits one that <code>== x</code>; you need something that removes every element like that instead."}, {"owner": {"reputation": 2139, "user_id": 116198, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HgA1y.png?s=128&g=1", "display_name": "Chris R. Timmons", "link": "https://stackoverflow.com/users/116198/chris-r-timmons"}, "edited": false, "score": 0, "creation_date": 1435709241, "post_id": 31150370, "comment_id": 50311151, "body": "There&#39;s a good discussion on this subject <a href=\"http://stackoverflow.com/questions/16108714/haskell-removing-duplicates-from-a-list\">here</a>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1435711196, "post_id": 31150370, "comment_id": 50311606, "body": "Note that there is a built-in named <code>nub</code> from <code>Data.List</code> module which does that."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 1, "creation_date": 1435738720, "post_id": 31150370, "comment_id": 50320945, "body": "@TikhonJelvis Are you sure? GHCi gives <code>dropWhile (==1) [1,1,1,2,3,1,4,5,6] ==&gt; [2,3,1,4,5,6]</code>."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 0, "creation_date": 1435764700, "post_id": 31150370, "comment_id": 50339496, "body": "@TikhonJelvis chi is right. You meant &quot;until it its one that <code>&#47;= x</code>&quot;."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "edited": false, "score": 2, "creation_date": 1435770995, "post_id": 31150370, "comment_id": 50343295, "body": "Oh yeah, totally got that backwards, sorry! Either way, <code>dropWhile</code> is not the right function."}], "answers": [{"comments": [{"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "edited": false, "score": 0, "creation_date": 1435708972, "post_id": 31150474, "comment_id": 50311063, "body": "The <b>base</b> library included with most Haskell implementations (certainly GHC) includes efficient Set data structures that do this as you add to them.  Combining <b>Data.Set.fromList</b> and <b>Data.Set.toList</b> would let you do this, but I don&#39;t think library use your intent here."}, {"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 2, "creation_date": 1435713581, "post_id": 31150474, "comment_id": 50312105, "body": "However, converting the list into a set will order the elements and require an Ord constraint. Nub only requires an Eq constraint and preserves the ordering. Of course, the set option is more efficient at O(n log n) vs O(n^2). The reordering and/or the additional constraint may not be desirable in this case."}, {"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "reply_to_user": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 0, "creation_date": 1435750450, "post_id": 31150474, "comment_id": 50328789, "body": "@fgv what do you think about my answer? I kept the Set suggestion as a comment because it really didn&#39;t seem to match the OP&#39;s intent."}, {"owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 1, "creation_date": 1435763387, "post_id": 31150474, "comment_id": 50338544, "body": "I think your answer steers the OP in the right direction. The idea of using set or map is good too from a performance standpoint, only that it will reorder elements and put that additional constraint, which the OP may not want..."}, {"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "reply_to_user": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "edited": false, "score": 0, "creation_date": 1435763786, "post_id": 31150474, "comment_id": 50338835, "body": "I completely agree.  I was apprehensive about posting the comment suggesting <b>Data.Set.fromList</b> based on library use, but your identification of output ordering and the <b>Ord</b> constraint on input are even more important considerations since they change the type of the OP&#39;s function."}], "tags": [], "owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "is_accepted": false, "score": 0, "last_activity_date": 1435708721, "creation_date": 1435708721, "answer_id": 31150474, "question_id": 31150370, "link": "https://stackoverflow.com/questions/31150370/haskell-remove-duplicates-from-list/31150474#31150474", "title": "Haskell Remove duplicates from list", "body": "<p><strong>foldr</strong> and <strong>map</strong> are very basic FP constructs.  However, they are very general and I found them a bit mind-bending to understand for a long time.  <a href=\"http://functionaltalks.org/2013/06/19/tony-morris-explain-list-folds-to-yourself/\" rel=\"nofollow\">Tony Morris' talk Explain List Folds to Yourself</a> helped me a lot.</p>\n\n<p>In your case an existing list function like <strong>filter :: (a -> Bool) -> [a] -> [a]</strong> with a predicate that exludes your duplicate could be used in lieu of <strong>dropWhile</strong>.</p>\n"}, {"tags": [], "owner": {"reputation": 785, "user_id": 3087558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a43d21bfa85dc7dc360cafa7f69ba3b1?s=128&d=identicon&r=PG&f=1", "display_name": "fgv", "link": "https://stackoverflow.com/users/3087558/fgv"}, "is_accepted": true, "score": 4, "last_activity_date": 1435713210, "creation_date": 1435713210, "answer_id": 31151043, "question_id": 31150370, "link": "https://stackoverflow.com/questions/31150370/haskell-remove-duplicates-from-list/31151043#31151043", "title": "Haskell Remove duplicates from list", "body": "<p>I think that the issue that you are referring to in your code is that your current implementation will only get rid of adjacent duplicates. As it was posted in a comment, the builtin function <em>nub</em> will eliminate every duplicate, even if it's not adjacent, and keep only the first occurrence of any element. But since you asked how to implement such a function with basic constructs, how about this?</p>\n\n<pre><code>myNub :: (Eq a) =&gt; [a] -&gt; [a]\nmyNub (x:xs) = x : myNub (filter (/= x) xs)\nmyNub [] = []\n</code></pre>\n\n<p>The only new function that I introduced to you there is <em>filter</em>, which filters a list based on a predicate (in this case, to get rid of every element present in the rest of that list matching the current element).</p>\n\n<p>I hope this helps.</p>\n"}, {"comments": [{"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "edited": false, "score": 0, "creation_date": 1435751349, "post_id": 31156216, "comment_id": 50329413, "body": "The OP&#39;s question was about implementing nub, not finding it in the library.  The discussion of the problems is interesting but not addressing that or the OP&#39;s confusion about folds and map."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1435739226, "creation_date": 1435739226, "answer_id": 31156216, "question_id": 31150370, "link": "https://stackoverflow.com/questions/31150370/haskell-remove-duplicates-from-list/31156216#31156216", "title": "Haskell Remove duplicates from list", "body": "<p>First of all, never simply state \"does not work\" in a question. This leaves to the reader to check whether it's a compile time error, run time error, or a wrong result.</p>\n\n<p>In this case, I am guessing it's a wrong result, like this:</p>\n\n<pre><code>&gt; compress [1,1,2,2,3,3,1]\n[1,2,3,1]\n</code></pre>\n\n<p>The problem with your code is that it removes <em>successive</em> duplicates, only. The first pair of <code>1</code>s gets compressed, but the last lone <code>1</code> is not removed because of that.</p>\n\n<p>If you can, sort the list in advance. That will make equal elements close, and then <code>compress</code> does the right job. The output will be in a different order, of course. There are ways to keep the order too if needed (start with <code>zip [0..] xs</code>, then sort, then ...).</p>\n\n<p>If you can not sort becuase there is really no practical way to define a comparison, but only an equality, then use <code>nub</code>. Be careful that this is much less efficient than sorting &amp; compressing. This loss of performance is intrinsic: without a comparator, you can only use an inefficient quadratic algorithm.</p>\n"}], "owner": {"reputation": 625, "user_id": 3970193, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c8603ff901556ada8180282750eda599?s=128&d=identicon&r=PG", "display_name": "Gaara", "link": "https://stackoverflow.com/users/3970193/gaara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7304, "favorite_count": 0, "accepted_answer_id": 31151043, "answer_count": 3, "score": 2, "last_activity_date": 1435739226, "creation_date": 1435708028, "question_id": 31150370, "link": "https://stackoverflow.com/questions/31150370/haskell-remove-duplicates-from-list", "title": "Haskell Remove duplicates from list", "body": "<p>I am new to Haskell and I am trying the below code to remove duplicates from a list. However it does not seem to work. </p>\n\n<pre><code>compress []     = []\ncompress (x:xs) = x : (compress $ dropWhile (== x) xs)\n</code></pre>\n\n<p>I have tried some search, all the suggestions use foldr/ map.head. Is there any implementation with basic constructs?</p>\n"}, {"tags": ["haskell", "yesod", "dropzone.js"], "answers": [{"comments": [{"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "edited": false, "score": 0, "creation_date": 1435854111, "post_id": 31150174, "comment_id": 50384671, "body": "I know this isn&#39;t a complete answer.  Can you comment on the request/response differences with and without Dropzone.js?  It may provide a fast path for others to give you the real answer."}], "tags": [], "owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "is_accepted": false, "score": 1, "last_activity_date": 1435706702, "creation_date": 1435706702, "answer_id": 31150174, "question_id": 31149466, "link": "https://stackoverflow.com/questions/31149466/yesod-and-dropzone-js/31150174#31150174", "title": "Yesod and Dropzone.js", "body": "<p>I don't how to solve this exact problem.  However, it has a more general solution.</p>\n\n<p>If you collect the request information (headers, POST body) for a bare file upload form and then for the Dropzone.js form you should see how Dropzone.js differs in it's preparation.</p>\n\n<p>I suspect Dropzone.js is missing the anti-CSRF tokens that Yesod uses so Yesod is ignoring the request.  It may be possible to get deeper logging from Yesod at that level.</p>\n"}], "owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1435706702, "creation_date": 1435702411, "question_id": 31149466, "link": "https://stackoverflow.com/questions/31149466/yesod-and-dropzone-js", "title": "Yesod and Dropzone.js", "body": "<p>I have been trying to integrate dropzone.js with Yesod time and time again only to miserably fail.\nHere is what I have</p>\n\n<pre><code>&lt;form method=post action=@{HomeR} enctype=#{formEncType} class=\"dropzone\"&gt;\n^{formWidget}\n    &lt;input type=\"submit\" value=\"Upload\"&gt;\n</code></pre>\n\n<p>No matter what I do i just can't get the dropzone form box to upload the files which I have dropped in there. It just seems as if Yesod doesn't even \"realize\" I have added a dropzone class to the form.</p>\n\n<p>Anyone care to help?</p>\n"}, {"tags": ["regex", "haskell", "haskell-platform"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435700352, "post_id": 31148848, "comment_id": 50308165, "body": "Could not reproduce; I get <code>True</code> for all four queries. Can you list the versions of things you&#39;re using? <code>ghc --version</code> and <code>ghc-pkg list regex-posix</code> should do, though take care if you are in a cabal sandbox or similar."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435700457, "post_id": 31148848, "comment_id": 50308219, "body": "Also, do you have <code>OverloadedStrings</code> turned on (or any other extensions)?"}, {"owner": {"reputation": 4285, "user_id": 894682, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4edaf2fa1d9d3f2ff26158fcbbf5a9e4?s=128&d=identicon&r=PG", "display_name": "Nixit Patel", "link": "https://stackoverflow.com/users/894682/nixit-patel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435700721, "post_id": 31148848, "comment_id": 50308317, "body": "edited my question and I am  not sure what is OverloadedStrings I am new to Haskell, how do I check"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435701281, "post_id": 31148848, "comment_id": 50308551, "body": "If you don&#39;t know what <code>OverloadedStrings</code> is, you probably haven&#39;t got it turned on (it&#39;s off by default). I see you&#39;re running on Windows; for what it&#39;s worth, when I run your queries in ghci-7.8.3 with regex-posix-0.95.2 on Linux I get the expected <code>True</code> for all four expressions."}, {"owner": {"reputation": 4285, "user_id": 894682, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4edaf2fa1d9d3f2ff26158fcbbf5a9e4?s=128&d=identicon&r=PG", "display_name": "Nixit Patel", "link": "https://stackoverflow.com/users/894682/nixit-patel"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435701454, "post_id": 31148848, "comment_id": 50308633, "body": "hmm, any idea how do I solve this issue other than switching to linux :D"}], "answers": [{"tags": [], "owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "is_accepted": true, "score": 1, "last_activity_date": 1435702158, "last_edit_date": 1435702158, "creation_date": 1435701851, "answer_id": 31149343, "question_id": 31148848, "link": "https://stackoverflow.com/questions/31148848/haskell-regex-strange-behaviour/31149343#31149343", "title": "Haskell - Regex Strange behaviour", "body": "<p>According to the Haskell Wiki (<a href=\"https://wiki.haskell.org/Regular_expressions#regex-base\" rel=\"nofollow\">https://wiki.haskell.org/Regular_expressions#regex-base</a>):</p>\n\n<blockquote>\n  <p>Executive summary: If you want a bug-free and/or portable POSIX extended regular expression library to use from Haskell, then regex-posix will not help you. You should use the regex-tdfa package instead.</p>\n</blockquote>\n\n<p>Try using the tdfa regex package from <a href=\"http://hackage.haskell.org/package/regex-tdfa\" rel=\"nofollow\">http://hackage.haskell.org/package/regex-tdfa</a>.  If you are not familiar with installing Haskell packages (and you have cabal installed), you can get the TDFA version by doing <code>cabal install regex-tdfa</code>.  </p>\n"}], "owner": {"reputation": 4285, "user_id": 894682, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4edaf2fa1d9d3f2ff26158fcbbf5a9e4?s=128&d=identicon&r=PG", "display_name": "Nixit Patel", "link": "https://stackoverflow.com/users/894682/nixit-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 31149343, "answer_count": 1, "score": 2, "last_activity_date": 1439504720, "creation_date": 1435699743, "last_edit_date": 1439504720, "question_id": 31148848, "link": "https://stackoverflow.com/questions/31148848/haskell-regex-strange-behaviour", "title": "Haskell - Regex Strange behaviour", "body": "<p>I am trying to use regex in haskell. but I noticed something strange. I am trying to put filter with the string which might contains one of this: sun.java, org.testng, sun.reflect, java.lang, and more\nmy regex for that is (sun.java|org.testng|sun.reflect|java.lang) and it works fine with the <a href=\"https://regex101.com\" rel=\"nofollow\">regex validator</a>  but when I do it in haskell: below is the result.</p>\n\n<p><strong>=></strong> </p>\n\n<pre><code>Prelude Text.Regex.Posix&gt; \" org.testng.Hello.world\" =~ \"(sun.java|org.testng|sun.reflect|java.lang)\" :: Bool\nTrue\nPrelude Text.Regex.Posix&gt; \" org.testng.Hello.world\" =~ \"(org.testng|sun.java|sun.reflect|java.lang)\" :: Bool\nFalse\n</code></pre>\n\n<p><strong>=></strong></p>\n\n<pre><code>Prelude Text.Regex.Posix&gt; \" sun.java.Hello.world\" =~ \"(sun.java|org.testng|sun.reflect|java.lang)\" :: Bool\nFalse\n\nPrelude Text.Regex.Posix&gt; \" sun.java.Hello.world\" =~ \"(org.testng|sun.java|sun.reflect|java.lang)\" :: Bool\nTrue\n</code></pre>\n\n<p>Am I doing something wrong here, since only second parameter from the regex is detected rest is giving false result.</p>\n\n<p><strong>EDIT</strong></p>\n\n<pre><code>H:\\&gt;ghc --version\nThe Glorious Glasgow Haskell Compilation System, version 7.8.3\n</code></pre>\n\n<p>and </p>\n\n<pre><code>H:\\&gt;ghc-pkg list regex-posix\nC:/Program Files/Haskell Platform/2014.2.0.0\\lib\\package.conf.d:\n    regex-posix-0.95.2\n\nC:\\Users\\nixitp\\AppData\\Roaming\\ghc\\x86_64-mingw32-7.8.3\\package.conf.d:\n    (no packages)\n</code></pre>\n\n<p><strong>EDIT2</strong>\nfor the first time running this I got this warning:</p>\n\n<pre><code>&lt;interactive&gt;: warning: isalpha from msvcrt is linked instead of __imp_isalpha\n</code></pre>\n"}, {"tags": ["haskell", "parser-combinators", "attoparsec"], "answers": [{"comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1435697909, "post_id": 31147513, "comment_id": 50307029, "body": "I guess I was too focused on implementing <code>takeWhileLo</code> as an applicative combinator. Your suggestion makes sense. Thanks."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1435698126, "post_id": 31147513, "comment_id": 50307137, "body": "Did you mean <code>mempty</code> instead of <code>empty</code>?"}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1435727384, "post_id": 31147513, "comment_id": 50315395, "body": "That also works. We have <code>Monoid</code>, <code>Alternative</code> and <code>MonadPlus</code> instances for <code>Parser</code>, and <code>mempty</code>, <code>empty</code> and <code>mzero</code> all express failure."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1435745382, "post_id": 31147513, "comment_id": 50325401, "body": "That makes sense. Thanks again."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": true, "score": 5, "last_activity_date": 1435694734, "creation_date": 1435694734, "answer_id": 31147513, "question_id": 31146547, "link": "https://stackoverflow.com/questions/31146547/how-can-i-write-a-more-general-but-efficient-version-of-attoparsecs-takewhile/31147513#31147513", "title": "How can I write a more general (but efficient) version of attoparsec&#39;s takeWhile1?", "body": "<p><code>Parser</code> is a monad, so you can just inspect the return value and fail if the length's not right:</p>\n\n<pre><code>takeWhileLo :: (Char -&gt; Bool) -&gt; Int -&gt; Parser Text\ntakeWhileLo f lo = do\n  text &lt;- takeWhile f\n  case T.compareLength text lo of\n    LT -&gt; empty\n    _  -&gt; return text\n</code></pre>\n\n<p><code>compareLength</code> is from the <code>text</code> package. It's more efficient than comparing <code>text</code>'s length, because <code>compareLength</code> may short-circuit.  </p>\n"}], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 31147513, "answer_count": 1, "score": 3, "last_activity_date": 1435694734, "creation_date": 1435691614, "last_edit_date": 1592644375, "question_id": 31146547, "link": "https://stackoverflow.com/questions/31146547/how-can-i-write-a-more-general-but-efficient-version-of-attoparsecs-takewhile", "title": "How can I write a more general (but efficient) version of attoparsec&#39;s takeWhile1?", "body": "<p><code>Data.Attoparsec.Text</code> exports <code>takeWhile</code> and <code>takeWhile1</code>:</p>\n<blockquote>\n<pre class=\"lang-hs prettyprint-override\"><code>takeWhile :: (Char -&gt; Bool) -&gt; Parser Text\n</code></pre>\n<p>Consume input as long as the predicate returns <code>True</code>, and return the consumed input.</p>\n<p>This parser does not fail. It will return an empty string if the predicate returns <code>False</code> on the first character of input.</p>\n<p>[...]</p>\n<pre class=\"lang-hs prettyprint-override\"><code>takeWhile1 :: (Char -&gt; Bool) -&gt; Parser Text\n</code></pre>\n<p>Consume input as long as the predicate returns <code>True</code>, and return the consumed input.</p>\n<p>This parser requires the predicate to succeed on at least one character of input: it will fail if the predicate never returns <code>True</code> or if there is no input left.</p>\n</blockquote>\n<p><code>attoparsec</code>'s documentation encourages the user to</p>\n<blockquote>\n<p>Use the <code>Text</code>-oriented parsers whenever possible, e.g. <code>takeWhile1</code> instead of <code>many1 anyChar</code>. There is about a factor of 100 difference in performance between the two kinds of parser.</p>\n</blockquote>\n<p>Those two parsers are very useful, but I keep feeling the need for a more general version of <code>takeWhile1</code>, more specifically, some hypothetical parser</p>\n<pre class=\"lang-hs prettyprint-override\"><code>takeWhileLo :: (Char -&gt; Bool) -&gt; Int -&gt; Parser Text\ntakeWhileLo f lo = undefined\n</code></pre>\n<p>that would parse <em>at least</em> <code>lo</code> characters satisfying predicate <code>f</code>, where <code>lo</code> is an arbitrary nonnegative integer.</p>\n<p>I had a look at <a href=\"https://hackage.haskell.org/package/attoparsec-0.10.2.0/docs/src/Data-Attoparsec-Text-Internal.html#takeWhile1\" rel=\"nofollow noreferrer\"><code>takeWhile1</code>'s implementation</a>, but it uses a bunch of functions private to <code>Data.Attoparsec.Text.Internal</code> and doesn't seem easily generalizable.</p>\n<p>I came up with the following applicative implementation:</p>\n<pre class=\"lang-hs prettyprint-override\"><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport           Prelude                  hiding ( takeWhile )\n\nimport           Control.Applicative             ( (&lt;*&gt;) )\nimport           Data.Text                       ( Text )\nimport qualified Data.Text           as T\n\nimport           Data.Attoparsec.Text\n\ntakeWhileLo :: (Char -&gt; Bool) -&gt; Int -&gt; Parser Text\ntakeWhileLo f lo =\n  T.append . T.pack &lt;$&gt; count lo (satisfy f) &lt;*&gt; takeWhile f\n</code></pre>\n<p>It works as advertised,</p>\n<pre class=\"lang-hs prettyprint-override\"><code>\u03bb&gt; parseOnly (takeWhileLo (== 'a') 4) &quot;aaa&quot;\nLeft &quot;not enough input&quot;\n\u03bb&gt; parseOnly (takeWhileLo (== 'a') 4) &quot;aaaa&quot;\nRight &quot;aaaa&quot;\n\u03bb&gt; parseOnly (takeWhileLo (== 'a') 4) &quot;aaaaaaaaaaaaa&quot;\nRight &quot;aaaaaaaaaaaaa&quot;\n</code></pre>\n<p>but the need for packing the intermediate list of results returned by <code>count</code> worries me, especially for cases where <code>lo</code> is large... It seems to go against the recommendation to</p>\n<blockquote>\n<p>use the <code>Text</code>-oriented parsers whenever possible [...]</p>\n</blockquote>\n<p>Am I missing something? Is there a more efficient/idiomatic way of implementing such a <code>takeWhileLo</code> combinator?</p>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435687994, "post_id": 31145309, "comment_id": 50301246, "body": "In Java, typeclasses might be seen as <i>interfaces</i>."}, {"owner": {"reputation": 123, "user_id": 4969529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/672770642854597/picture?type=large", "display_name": "Aneesh Dandime", "link": "https://stackoverflow.com/users/4969529/aneesh-dandime"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435688185, "post_id": 31145309, "comment_id": 50301366, "body": "@AJFarmar m not familiar with java sorry."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435688295, "post_id": 31145309, "comment_id": 50301442, "body": "Okay then, what if I said <i>abstract classes</i> from C++?"}, {"owner": {"reputation": 123, "user_id": 4969529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/672770642854597/picture?type=large", "display_name": "Aneesh Dandime", "link": "https://stackoverflow.com/users/4969529/aneesh-dandime"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435688397, "post_id": 31145309, "comment_id": 50301512, "body": "@AJFarmar that makes sense thank you!"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435688569, "post_id": 31145309, "comment_id": 50301628, "body": "Well, you just learnt some Haskell and Java concepts. Today is a good day."}, {"owner": {"reputation": 123, "user_id": 4969529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/672770642854597/picture?type=large", "display_name": "Aneesh Dandime", "link": "https://stackoverflow.com/users/4969529/aneesh-dandime"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435688622, "post_id": 31145309, "comment_id": 50301654, "body": "@AJFarmar also my question did not get downvoted, a good day indeed!"}], "answers": [{"comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 123, "user_id": 4969529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/672770642854597/picture?type=large", "display_name": "Aneesh Dandime", "link": "https://stackoverflow.com/users/4969529/aneesh-dandime"}, "edited": false, "score": 4, "creation_date": 1435689064, "post_id": 31145381, "comment_id": 50301886, "body": "@AneeshDandime Keep in mind that if you had something like <code>Eq a =&gt; [a]</code> (a list of values implementing <code>Eq</code>), the list is still homogeneous.  In OOP languages you can &quot;downcast&quot; different classes to the &quot;Eq interface&quot; and store them all in the same structure, but not in Haskell, downcasting has to be performed manually."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 6, "last_activity_date": 1435688093, "last_edit_date": 1435688093, "creation_date": 1435687781, "answer_id": 31145381, "question_id": 31145309, "link": "https://stackoverflow.com/questions/31145309/type-classes-brief-explanation/31145381#31145381", "title": "Type classes - Brief Explanation", "body": "<blockquote>\n  <p>Does it simply mean that t supports and implements the functions specified by Eq ?</p>\n</blockquote>\n\n<p>Yes, precisely.</p>\n\n<p>It simply means that there's an instance of <code>Eq t</code> which defines the operator <code>(==)</code>, as required by <code>Eq</code>. You can therefore use said operator on type <code>t</code> in your code.</p>\n\n<p>A silly example:</p>\n\n<pre><code>data MyPair = P Int String\n\ninstance Eq MyPair where\n   (P i1 s1) == (P i2 s2) =   -- we define equality ...\n      i1==i2 &amp;&amp; s1==S2        -- ... as component-wise equality\n\ntestTrue :: Bool\ntestTrue = (P (1+1) \"aa\") == (P 2 (\"a\"++\"a\"))\n</code></pre>\n\n<p>In the example above, the common idiom would actually be</p>\n\n<pre><code>data MyPair = P Int String deriving Eq\n</code></pre>\n\n<p>which automatically derives the instance -- so there's no need to write it explicitly.</p>\n"}], "owner": {"reputation": 123, "user_id": 4969529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/672770642854597/picture?type=large", "display_name": "Aneesh Dandime", "link": "https://stackoverflow.com/users/4969529/aneesh-dandime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 2, "accepted_answer_id": 31145381, "answer_count": 1, "score": 2, "last_activity_date": 1435688093, "creation_date": 1435687529, "question_id": 31145309, "link": "https://stackoverflow.com/questions/31145309/type-classes-brief-explanation", "title": "Type classes - Brief Explanation", "body": "<p>I am new to Haskell and i come from c++ background.</p>\n\n<p>I am having some trouble understanding the relation between types and type classes.</p>\n\n<p>From what i understand type classes specify a bunch of functions. Like the <code>Eq</code> type class specifies <code>==</code> and <code>/=</code>.</p>\n\n<p>But now suppose i have a type <code>t</code>, What does it mean when i say that <code>t</code> is an instance of <code>Eq</code> type class. Does it simply mean that <code>t</code> supports and implements the functions specified by <code>Eq</code> ?</p>\n"}, {"tags": ["haskell", "io"], "answers": [{"comments": [{"owner": {"reputation": 1028, "user_id": 1717752, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/59df9ec4676523399b240b7009f91413?s=128&d=identicon&r=PG", "display_name": "ominug", "link": "https://stackoverflow.com/users/1717752/ominug"}, "edited": false, "score": 0, "creation_date": 1435689806, "post_id": 31145261, "comment_id": 50302326, "body": "Thanks, but this only answers the first question. Is there a way to flush this laziness?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 1028, "user_id": 1717752, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/59df9ec4676523399b240b7009f91413?s=128&d=identicon&r=PG", "display_name": "ominug", "link": "https://stackoverflow.com/users/1717752/ominug"}, "edited": false, "score": 1, "creation_date": 1435690077, "post_id": 31145261, "comment_id": 50302505, "body": "@ominug, you should just not use <code>withFile</code> and <code>hGetContents</code> together. Use <code>readFile</code>, or <code>openFile</code> and <code>hGetContents</code>."}, {"owner": {"reputation": 1028, "user_id": 1717752, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/59df9ec4676523399b240b7009f91413?s=128&d=identicon&r=PG", "display_name": "ominug", "link": "https://stackoverflow.com/users/1717752/ominug"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1435690203, "post_id": 31145261, "comment_id": 50302589, "body": "@reid-barton But what can then be used with <code>withFile</code>?"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1435690409, "post_id": 31145261, "comment_id": 50302743, "body": "Strict IO functions like <code>hGetLine</code>."}, {"owner": {"reputation": 1028, "user_id": 1717752, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/59df9ec4676523399b240b7009f91413?s=128&d=identicon&r=PG", "display_name": "ominug", "link": "https://stackoverflow.com/users/1717752/ominug"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1435690547, "post_id": 31145261, "comment_id": 50302821, "body": "@reid-barton Ok. But <code>withFile</code> is just <code>openFile</code> and <code>hClose</code> around a lambda. I think this really breaks the notion of reproducible/constant values. So is there a recommendation to always handle <code>hGetContents</code> with care?"}, {"owner": {"reputation": 4328, "user_id": 1473927, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AO6Ui.jpg?s=128&g=1", "display_name": "Jonathan Cast", "link": "https://stackoverflow.com/users/1473927/jonathan-cast"}, "edited": false, "score": 2, "creation_date": 1435692305, "post_id": 31145261, "comment_id": 50303865, "body": "Lazy IO as implemented in Haskell is evil.  There&#39;s nothing about the concept of <code>hGetContents</code> that forces it to be implemented that way."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 3, "creation_date": 1435692346, "post_id": 31145261, "comment_id": 50303901, "body": "You should not manually close a handle (including via <code>withFile</code>) that you have passed to <code>hGetContents</code> (unless you are sure you have already consumed as much of the file as you will ever need). If you consume the entire file, <code>hGetContents</code> will close the file automatically for you."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1435694889, "last_edit_date": 1435694889, "creation_date": 1435687365, "answer_id": 31145261, "question_id": 31145142, "link": "https://stackoverflow.com/questions/31145142/withfile-handle-is-empty/31145261#31145261", "title": "withFile handle is empty", "body": "<p>TL;DR: Lazy IO is evil.</p>\n\n<p>What happens is that <code>hGetContents</code> returns an IO-lazy list of the file contents. This means that the file handle will be read only when said list is actually accessed. Then the control passes to <code>withFile</code> which closes the file handle. Finally, the result is printed, and the list is demanded: only now a read is performed on the handle. Alas, it's too late.</p>\n\n<p>As an ugly, manual \"flush\" of this laziness, you can try e.g.</p>\n\n<pre><code>hGetCont handle = do\n   c &lt;- hGetContents handle\n   length c `seq` return c\n</code></pre>\n\n<p>The above forces the length of the list to be computed, hence forcing the whole file to be read. Reid Barton below suggest more beautiful alternatives, which avoid the use of the horribly evil lazy IO.</p>\n"}], "owner": {"reputation": 1028, "user_id": 1717752, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/59df9ec4676523399b240b7009f91413?s=128&d=identicon&r=PG", "display_name": "ominug", "link": "https://stackoverflow.com/users/1717752/ominug"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "closed_date": 1435693689, "answer_count": 1, "score": 1, "last_activity_date": 1435694889, "creation_date": 1435687037, "question_id": 31145142, "link": "https://stackoverflow.com/questions/31145142/withfile-handle-is-empty", "closed_reason": "Duplicate", "title": "withFile handle is empty", "body": "<p>In my current working directory there is a file named <code>test.txt</code>, which contains <code>\"Test\\n\"</code>.</p>\n\n<p>With <code>System.IO.readFile</code>, GHCI returns the content:</p>\n\n<pre><code>Prelude System.IO&gt; readFile \"test.txt\"\n\"Test\\n\"\n</code></pre>\n\n<p>But not so with the following, which should be equal in my opinion:</p>\n\n<pre><code>Prelude System.IO&gt; withFile \"test.txt\" ReadMode hGetContents\n\"\"\n</code></pre>\n\n<p>Why is it not the case? How to get the whole file contents within the <code>withFile</code> <code>IO</code> action?</p>\n"}, {"tags": ["haskell", "ghc", "template-haskell"], "answers": [{"tags": [], "owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "is_accepted": false, "score": 1, "last_activity_date": 1445950782, "creation_date": 1445950782, "answer_id": 33368665, "question_id": 31143506, "link": "https://stackoverflow.com/questions/31143506/how-to-use-getq-and-putq-in-template-haskell/33368665#33368665", "title": "How to use getQ and putQ in template haskell?", "body": "<p>There's currently a bug in getQ: it was recently fixed and should be working in the next version of GHC.</p>\n"}], "owner": {"reputation": 71, "user_id": 4364722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2aa60da7dde1b66fb648e29cb4be0bbe?s=128&d=identicon&r=PG&f=1", "display_name": "kiripon", "link": "https://stackoverflow.com/users/4364722/kiripon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1445950782, "creation_date": 1435681404, "last_edit_date": 1435766752, "question_id": 31143506, "link": "https://stackoverflow.com/questions/31143506/how-to-use-getq-and-putq-in-template-haskell", "title": "How to use getQ and putQ in template haskell?", "body": "<p>I would like to handle states in Q monad with Template Haskell.\nAccording to some stack overflow's answers, there is a solution that uses <code>unsafePerformIO</code>, but I want to avoid using it as long as I can.</p>\n\n<p>I found <code>getQ</code> and <code>putQ</code> in the module <a href=\"https://hackage.haskell.org/package/template-haskell-2.10.0.0/docs/Language-Haskell-TH-Syntax.html\" rel=\"nofollow\"><code>Language.Haskell.TH.Syntax</code></a>. These functions handle states in Q monad shown by template-haskell 2.10 document.\nI tried to use this API, but <code>getQ</code> fails to get states.</p>\n\n<p>Following code is an example of my problem.\nI expects <code>x</code> to be bounded to <code>(Just B)</code>,but <code>x</code> is always <code>Nothing</code>.</p>\n\n<pre><code>-- X.hs\n{-# LANGUAGE DeriveDataTypeable #-}\nmodule X where\nimport Data.Typeable\ndata T = A | B | C deriving (Typeable,Show)\n\n\n-- Y.hs\n{-# LANGUAGE TemplateHaskell #-}\nmodule Y where\nimport X\nimport Language.Haskell.TH\nimport Language.Haskell.TH.Syntax\n-- splice for testing getQ and putQ\ndo\n  putQ B\n  x &lt;- getQ :: Q (Maybe T)\n  runIO $ print x -- prints Nothing\n  return []\n</code></pre>\n\n<p>as a result , I got following compile message.</p>\n\n<pre><code>$ ghc -fforce-recomp Y.hs\n[1 of 2] Compiling X                ( X.hs, X.o )\n[2 of 2] Compiling Y                ( Y.hs, Y.o )\nNothing\n</code></pre>\n\n<p>How to use <code>getQ</code> and <code>putQ</code>?</p>\n"}, {"tags": ["haskell", "drag-and-drop", "treeview", "gtk3", "gtk2hs"], "owner": {"reputation": 65, "user_id": 2241017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4813be3af707a2d008789930dbcf28da?s=128&d=identicon&r=PG", "display_name": "maaronking", "link": "https://stackoverflow.com/users/2241017/maaronking"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1435713903, "creation_date": 1435680805, "last_edit_date": 1495539837, "question_id": 31143312, "link": "https://stackoverflow.com/questions/31143312/in-haskell-how-can-you-drag-and-drop-tree-view-node-between-tree-views-in-gtk2h", "title": "In Haskell, how can you drag and drop tree view node between tree views in gtk2hs (Gtk3)?", "body": "<p>I have been trying to figure out how to drag a tree node (maintaining its path) between tree views on a single gtk application window.</p>\n\n<p>If I have the following in a TreeView...</p>\n\n<blockquote>\n  <ul>\n  <li>One\n  \n  <ul>\n  <li>A\n  \n  <ul>\n  <li>item 1A</li>\n  </ul></li>\n  <li>B\n  \n  <ul>\n  <li>item 1B</li>\n  </ul></li>\n  </ul></li>\n  <li>Two\n  \n  <ul>\n  <li>A\n  \n  <ul>\n  <li>item 2A</li>\n  </ul></li>\n  </ul></li>\n  </ul>\n</blockquote>\n\n<p>How can I drag 'item 1A' to another TreeView on the same window to get the following TreeView...</p>\n\n<blockquote>\n  <ul>\n  <li>One\n  \n  <ul>\n  <li>A\n  \n  <ul>\n  <li>item 1A</li>\n  </ul></li>\n  </ul></li>\n  </ul>\n</blockquote>\n\n<p>I have attempted to follow the <code>ListDND.hs</code> example in the demos directory of the gtk2hs source (which is very helpful); however, since I am using gtk3 the API has changed enough to make it not seem to be perfectly applicable.</p>\n\n<p>I have seen the answer here: <a href=\"https://stackoverflow.com/questions/10966397/could-someone-explain-gtk2hs-drag-and-drop-to-me-the-listdnd-hs-demo-just-isnt\">gtk2hs dnd explanation</a></p>\n\n<p>I thought about just using a string by putting the tree path and node text into a tuple and then calling <code>show</code> on the tuple and passing that as the selection in the <code>treeDragDestDragDataReceived</code> callback in the <code>DragDestIface</code> interface...but I can't seem to get that callback to be called.</p>\n\n<p>I did see the line about the Gtk bug in the <code>ListDND.hs</code> file.  So i tried including the following line in my own code but it didn't seem to work: </p>\n\n<pre><code>tl &lt;- targetListNew                       \ntreeViewEnableModelDragDest treeView tl []\n</code></pre>\n\n<p>...Where <code>treeView</code> is my drag source. </p>\n\n<p>Thank you in advance for your consideration.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1435684345, "post_id": 31143239, "comment_id": 50299189, "body": "Learn you a haskell: <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow noreferrer\">learnyouahaskell.com/functors-applicative-functors-and-monoi&zwnj;&#8203;ds</a>"}, {"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 2, "creation_date": 1435695103, "post_id": 31143239, "comment_id": 50305496, "body": "This isn&#39;t a super practical answer, but <a href=\"https://lukepalmer.wordpress.com/2013/03/12/constructions-on-typeclasses-part-1-f-algebras/\" rel=\"nofollow noreferrer\">F-algebras</a> provide a very regular structure for getting functions like <code>(+)</code> for free."}], "answers": [{"comments": [{"owner": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "edited": false, "score": 0, "creation_date": 1435681681, "post_id": 31143383, "comment_id": 50297738, "body": "Could you add an example of implemention? I wrote <a href=\"https://gist.github.com/anonymous/417585e7f6d54ddfc7fd\" rel=\"nofollow noreferrer\">this</a> par your suggestion, is this all right?"}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 1, "creation_date": 1435702735, "post_id": 31143383, "comment_id": 50309133, "body": "The <a href=\"https://github.com/agda/agda-stdlib/blob/master/src/Data/Vec.agda#L69\" rel=\"nofollow noreferrer\">default</a> <code>Applicative</code> instance for vectors encodes zipping. The translation to Haskell is straightforward."}], "tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": true, "score": 8, "last_activity_date": 1435681024, "creation_date": 1435681024, "answer_id": 31143383, "question_id": 31143239, "link": "https://stackoverflow.com/questions/31143239/zippable-class-for-haskell/31143383#31143383", "title": "&quot;Zippable&quot; class for haskell?", "body": "<p>You can't do much with just <code>Functor</code>, but with <code>Applicative</code> you can do</p>\n\n<pre><code>fzipWith f za zb = f &lt;$&gt; za &lt;*&gt; zb\n</code></pre>\n\n<p>The default instance for <code>Applicative []</code> won't do quite what you want; it will take <em>every</em> <code>a</code> with <em>every</em> <code>b</code>. But I believe there's a <code>ZipList</code> newtype somewhere that gives you an instance that zips the way you're expecting. (No, I don't know exactly where it lives.)</p>\n\n<p>Note that this generalises to <em>any</em> number of arguments:</p>\n\n<pre><code>f &lt;$&gt; za &lt;*&gt; zb &lt;*&gt; zc &lt;*&gt; zd\n</code></pre>\n\n<p>so you don't need the <code>zipWith</code>, <code>zipWith3</code>, <code>zipWith4</code>, etc functions.</p>\n"}, {"tags": [], "owner": {"reputation": 13699, "user_id": 11173, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b5276e65cb7a7417188c9a035953cee?s=128&d=identicon&r=PG", "display_name": "Doug McClean", "link": "https://stackoverflow.com/users/11173/doug-mcclean"}, "is_accepted": false, "score": 3, "last_activity_date": 1435681147, "creation_date": 1435681147, "answer_id": 31143422, "question_id": 31143239, "link": "https://stackoverflow.com/questions/31143239/zippable-class-for-haskell/31143422#31143422", "title": "&quot;Zippable&quot; class for haskell?", "body": "<p>See the adjunctions package, and in particular <a href=\"http://hackage.haskell.org/package/adjunctions-4.2.1/docs/Data-Functor-Rep.html#v:liftR2\" rel=\"nofollow\"><code>Data.Functor.Rep.liftR2</code></a>.</p>\n\n<p>Your <code>Matrix2</code> is a representable functor.</p>\n"}], "owner": {"reputation": 2024, "user_id": 3026489, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/42eefce716334b3baef26625220fb7a0?s=128&d=identicon&r=PG&f=1", "display_name": "Yosh", "link": "https://stackoverflow.com/users/3026489/yosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 1, "accepted_answer_id": 31143383, "answer_count": 2, "score": 6, "last_activity_date": 1435681147, "creation_date": 1435680528, "question_id": 31143239, "link": "https://stackoverflow.com/questions/31143239/zippable-class-for-haskell", "title": "&quot;Zippable&quot; class for haskell?", "body": "<p>In an attempt to get familiar with the great ideas such as <code>Foldable</code>, <code>Functor</code>, etc. I'm writing a data structure for 2*2 matrix. It isn't for real use, so I thought this naive implementation is a good start:</p>\n\n<pre><code>data Matrix2d a = M2 a a a a\n</code></pre>\n\n<p>I want this to be a <code>Num</code> instance</p>\n\n<pre><code>instance Num a =&gt; Num (Matrix2d a) where\n    (M2 a0 b0 c0 d0) + (M2 a1 b1 c1 d1) = M2 (a0+a1) (b0+b1) (c0+c1) (d0+d1)\n    -- ....\n</code></pre>\n\n<p>This does not seem right. I don't want to type <code>+</code> five times for this obvious definition. Certainly there's room for more abstraction. I'd prefer something like</p>\n\n<pre><code>(+) = fzipWith (+) -- f does not mean anything here\n</code></pre>\n\n<p>This is actually easy to implement:</p>\n\n<pre><code>class Zippable z where\n    fzipWith :: (a -&gt; b -&gt; c) -&gt; z a -&gt; z b -&gt; z c\n\ninstance Zippable Matrix2 where\n    fzipWith f (M2 x y z w) (M2 a b c d) = M2 (f x a) (f y b) (f z c) (f w d)\n</code></pre>\n\n<p>however, I couldn't find anything ready-to-use in hoogle. I find it odd because this kind of abstraction seems quite natural. There's <code>Foldable</code>, there's <code>Functor</code> --- why not <code>Zippable</code>?</p>\n\n<p>Questions:</p>\n\n<ul>\n<li>Is there any module that provides this functionality?</li>\n<li>If not (I believe this is the case), what options do I have? Is defining my own class the best choice, or is there any better alternative?</li>\n</ul>\n"}, {"tags": ["haskell", "genetic-algorithm"], "answers": [{"comments": [{"owner": {"reputation": 314, "user_id": 2032903, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/0xnps.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/2032903/robin"}, "edited": false, "score": 0, "creation_date": 1435681728, "post_id": 31142462, "comment_id": 50297761, "body": "This solution works as well but the other answer offers more information. Thank you very much!"}], "tags": [], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "is_accepted": false, "score": 4, "last_activity_date": 1435678123, "creation_date": 1435678123, "answer_id": 31142462, "question_id": 31142168, "link": "https://stackoverflow.com/questions/31142168/get-n-elements-of-list-having-the-highest-property/31142462#31142462", "title": "Get n elements of list having the highest property", "body": "<p>Use <a href=\"http://hackage.haskell.org/package/base/docs/Data-List.html#v:sortBy\" rel=\"nofollow\">sortBy</a> and <a href=\"http://hackage.haskell.org/package/base/docs/Data-Function.html#v:on\" rel=\"nofollow\">on</a>.</p>\n\n<pre><code>&gt; take 2 $ sortBy (flip compare `on` sum) [[1,2],[0,4],[1,1]]\n[[0,4],[1,2]]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 314, "user_id": 2032903, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/0xnps.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/2032903/robin"}, "edited": false, "score": 0, "creation_date": 1435681689, "post_id": 31142474, "comment_id": 50297740, "body": "Works as expected, perfect explanation even for a Haskell beginner like me (even having clean coding best practices!) Thank you!"}], "tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1435680239, "last_edit_date": 1435680239, "creation_date": 1435678164, "answer_id": 31142474, "question_id": 31142168, "link": "https://stackoverflow.com/questions/31142168/get-n-elements-of-list-having-the-highest-property/31142474#31142474", "title": "Get n elements of list having the highest property", "body": "<p>The best choice here is to use <code>sortBy</code> from <code>Data.List</code>:</p>\n\n<pre><code>sortBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]\n</code></pre>\n\n<p>The <code>sortBy</code> function is higher order, so it takes a function as one of its arguments.  The function it needs is one that takes two elements and returns a <code>Ordering</code> value (<code>LT</code>, <code>EQ</code> or <code>GT</code>).  You can write your own custom comparison function, but the <code>Data.Ord</code> module has <code>comparing</code>, which exists to help with writing these comparison functions:</p>\n\n<pre><code>comparing :: Ord b =&gt; (a -&gt; b) -&gt; (a -&gt; a -&gt; Ordering)\n</code></pre>\n\n<p>Hopefully you can see how <code>comparing</code> pairs with <code>sortBy</code>, you pass it a function to convert your type to a known comparable type, and then you have a function of the right type to pass to <code>sortBy</code>.  So in practice you can do</p>\n\n<pre><code>import Data.List (sortBy)\nimport Data.Ord (comparing)\n\n-- Some types to make things more readable\ntype Individual = [Int]\ntype Fitness = Int\n\n-- Here's our fitness function (change as needed)\nfitness :: Individual -&gt; Fitness\nfitness = sum\n\n-- Redefining so it can be used with `map`\nf :: Individual -&gt; (Individual, Fitness)\nf ind = (ind, fitness ind)\n\n-- If you do want to see the fitness of the top n individuals\nsolution1 :: Int -&gt; [Individual] -&gt; [(Individual, Fitness)]\nsolution1 n inds = take n $ sortBy (flip $ comparing snd) $ map f inds\n\n-- If you just want the top n individuals\nsolution2 :: Int -&gt; [Individual] -&gt; [Individual]\nsolution2 n inds = take n $ sortBy (flip $ comparing fitness) inds\n</code></pre>\n\n<p>The <code>flip</code> in the arguments to <code>sortBy</code> forces the sort to be descending instead of the default ascending, so the first <code>n</code> values returned from <code>sortBy</code> will be the <code>n</code> values with the highest fitness in descending order.  If you wanted to try out different fitness functions then you could do something like</p>\n\n<pre><code>fittestBy :: (Individual -&gt; Fitness) -&gt; Int -&gt; [Individual] -&gt; [Individual]\nfittestBy fit n = take n . sortBy (flip $ comparing fit)\n</code></pre>\n\n<p>Then you'd have</p>\n\n<pre><code>solution2 = fittestBy sum\n</code></pre>\n\n<p>But you could also have</p>\n\n<pre><code>solution3 = fittestBy product\n</code></pre>\n\n<p>if you wanted to change your fitness function to be the product rather than the sum.</p>\n"}], "owner": {"reputation": 314, "user_id": 2032903, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/0xnps.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/2032903/robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 31142474, "answer_count": 2, "score": 3, "last_activity_date": 1435680239, "creation_date": 1435677325, "question_id": 31142168, "link": "https://stackoverflow.com/questions/31142168/get-n-elements-of-list-having-the-highest-property", "title": "Get n elements of list having the highest property", "body": "<p>I'm new to Haskell and trying to implement some genetic algorithms.\nCurrently I fail with the selection of the n best element of a list of individuals (where each individual is a list for itself.\nAn individual is created as follows:</p>\n\n<pre><code>ind1 :: [Int]\nind1 = [1, 1, 1, 1, 1, 1, 1]\nind2 :: [Int]\nind2 = [0, 0, 0, 0, 0, 0, 0]\n</code></pre>\n\n<p>The appropriate population consists of a list of those individuals:</p>\n\n<pre><code>pop :: [[Int]]\npop = [ind1, ind2]\n</code></pre>\n\n<p>What I want to achieve is to get the best n individuals of the population, where the \"best\" is determined by the sum of its elements, e.g., </p>\n\n<pre><code>&gt; sum ind1\n7\n&gt; sum ind2\n0\n</code></pre>\n\n<p>I started creating a function for creating tuples with individual and its quality:</p>\n\n<pre><code>f x = [(ind, sum ind) | ind &lt;- x]\n</code></pre>\n\n<p>so at least I got something like this:</p>\n\n<pre><code>[([1, 1, 1, 1, 1, 1, 1], 7), ([0, 0, 0, 0, 0, 0, 0], 0)]\n</code></pre>\n\n<p>How do I get from here to the expected result? I do not even manage to get the \"fst\" of the tuple where \"snd == max\".\nI started with recursive approaches as seen in different topics, but unfortunately without reasonable result.\nAny suggestions, probably also where to read?\nThank you!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 20829, "user_id": 1030110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bsgx2.png?s=128&g=1", "display_name": "m0nhawk", "link": "https://stackoverflow.com/users/1030110/m0nhawk"}, "edited": false, "score": 0, "creation_date": 1435671272, "post_id": 31139692, "comment_id": 50290079, "body": "And what is that? A function that take function and return function? Did you really mean first argument will be <code>(a -&gt; b)</code>?"}, {"owner": {"reputation": 31, "user_id": 5065607, "user_type": "registered", "profile_image": "https://graph.facebook.com/563472407126201/picture?type=large", "display_name": "Jeremy  Bi", "link": "https://stackoverflow.com/users/5065607/jeremy-bi"}, "reply_to_user": {"reputation": 20829, "user_id": 1030110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bsgx2.png?s=128&g=1", "display_name": "m0nhawk", "link": "https://stackoverflow.com/users/1030110/m0nhawk"}, "edited": false, "score": 0, "creation_date": 1435671358, "post_id": 31139692, "comment_id": 50290149, "body": "Yes, it is a function that takes a function and returns another function, just reading from the type."}, {"owner": {"reputation": 20829, "user_id": 1030110, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bsgx2.png?s=128&g=1", "display_name": "m0nhawk", "link": "https://stackoverflow.com/users/1030110/m0nhawk"}, "edited": false, "score": 0, "creation_date": 1435671413, "post_id": 31139692, "comment_id": 50290184, "body": "Just the resulting type is completely pointless, cause you have some different functions there."}, {"owner": {"reputation": 552, "user_id": 4409863, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e96e35d48fcbde43780dd48a3e39b5f0?s=128&d=identicon&r=PG&f=1", "display_name": "Xaphanius", "link": "https://stackoverflow.com/users/4409863/xaphanius"}, "edited": false, "score": 0, "creation_date": 1435671509, "post_id": 31139692, "comment_id": 50290253, "body": "It is possible to a function in Haskell take another function as a parameter. Now, do you want to return a function to apply somewhere else?"}, {"owner": {"reputation": 31, "user_id": 5065607, "user_type": "registered", "profile_image": "https://graph.facebook.com/563472407126201/picture?type=large", "display_name": "Jeremy  Bi", "link": "https://stackoverflow.com/users/5065607/jeremy-bi"}, "edited": false, "score": 0, "creation_date": 1435671885, "post_id": 31139692, "comment_id": 50290527, "body": "I&#39;ve edited my question to give some background"}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1435672620, "post_id": 31139692, "comment_id": 50291157, "body": "Just a hint because I think it&#39;s all you&#39;ll need. You have options other than recursing on <code>tequal a c</code>, <code>tequal b d</code>. One of these options will give you pieces of the correct shape to compose to get <code>(a -&gt; b) -&gt; (c -&gt; d)</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1435675608, "post_id": 31139692, "comment_id": 50293598, "body": "What you are asking for in the first part is impossible (and could be proved through Curry-Howard). But the second part is solvable -- I strongly second the suggestion of @ReidBarton. You can be more creative in your recursive calls."}, {"owner": {"reputation": 1308, "user_id": 1147256, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/1I0s7.jpg?s=128&g=1", "display_name": "Mariya Davydova", "link": "https://stackoverflow.com/users/1147256/mariya-davydova"}, "edited": false, "score": 0, "creation_date": 1435676466, "post_id": 31139692, "comment_id": 50294265, "body": "After a quick look at the paper you&#39;ve mentioned I have another suggestion: probably, you should use another type for function representation? Anyway, all you need for the function type is to store the types of the domain and codomain, thus this type is very similar to the one for pair:     <code>RFun (Type a) (Type b)</code> Thus the <code>tequal</code> implementation will be quit trivial. As for your original question, I&#39;m totally agree with @max-taldykin, it&#39;s impossible."}], "answers": [{"tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": false, "score": 3, "last_activity_date": 1435678277, "last_edit_date": 1435678277, "creation_date": 1435673039, "answer_id": 31140501, "question_id": 31139692, "link": "https://stackoverflow.com/questions/31139692/how-to-compose-these-two-functions/31140501#31140501", "title": "How to compose these two functions", "body": "<p>This is impossible.</p>\n\n<p>Suppose you have desired function <code>f :: (a -&gt; b) -&gt; (c -&gt; d)</code>.</p>\n\n<p>You can simplify it's type to <code>(a -&gt; b) -&gt; c -&gt; d</code> (See <a href=\"https://wiki.haskell.org/Partial_application\" rel=\"nofollow\">why</a>).</p>\n\n<p>How could implementation of <code>f</code> look like? It has first argument of type <code>a -&gt; b</code> and second of type <code>c</code>:</p>\n\n<pre><code>f ab c = ...\n</code></pre>\n\n<p>What can you do with <code>ab</code>? It's a function but you can't apply it because you don't have anything of type <code>a</code> (except <code>_|_</code>). And even if you have functions <code>g :: a -&gt; c</code> and <code>h :: b -&gt; d</code> they are of no use because you don't have anything of type <code>a</code> or <code>b</code> and you can't compose them. </p>\n\n<p>So the only valid implementation is something like</p>\n\n<pre><code>f ab = undefined\n</code></pre>\n\n<p>or</p>\n\n<pre><code>f = undefined\n</code></pre>\n\n<hr>\n\n<p>Regarding second part of your question, it seems that you can recursively use <code>tequal</code> to check function type equality: types <code>a -&gt; c</code> and <code>b -&gt; d</code> are equal only if <code>a</code> = <code>b</code> and <code>c</code> = <code>d</code> (this is valid because toy type system from the paper don't have type variables).</p>\n\n<p>Here is a sketch of implementation:</p>\n\n<pre><code>tequal (RFun a c) (RFun b d)\n  = liftM2 func (tequal a b) (tequal c d)\n</code></pre>\n\n<p>You can note that the code is almost identical to the case for <code>RPair</code>. This is somehow related to currying.</p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 5065607, "user_type": "registered", "profile_image": "https://graph.facebook.com/563472407126201/picture?type=large", "display_name": "Jeremy  Bi", "link": "https://stackoverflow.com/users/5065607/jeremy-bi"}, "edited": false, "score": 0, "creation_date": 1435673597, "post_id": 31140529, "comment_id": 50292023, "body": "I am very familiar with higher-order functions. The question I have is how to compose them in the way I specify through type. Thanks anyway!"}, {"owner": {"reputation": 552, "user_id": 4409863, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e96e35d48fcbde43780dd48a3e39b5f0?s=128&d=identicon&r=PG&f=1", "display_name": "Xaphanius", "link": "https://stackoverflow.com/users/4409863/xaphanius"}, "reply_to_user": {"reputation": 31, "user_id": 5065607, "user_type": "registered", "profile_image": "https://graph.facebook.com/563472407126201/picture?type=large", "display_name": "Jeremy  Bi", "link": "https://stackoverflow.com/users/5065607/jeremy-bi"}, "edited": false, "score": 0, "creation_date": 1435675521, "post_id": 31140529, "comment_id": 50293529, "body": "I see. I started writing before you edited the answer, my bad here. I am looking for some other way to solve this now."}], "tags": [], "owner": {"reputation": 552, "user_id": 4409863, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e96e35d48fcbde43780dd48a3e39b5f0?s=128&d=identicon&r=PG&f=1", "display_name": "Xaphanius", "link": "https://stackoverflow.com/users/4409863/xaphanius"}, "is_accepted": false, "score": 0, "last_activity_date": 1435673120, "creation_date": 1435673120, "answer_id": 31140529, "question_id": 31139692, "link": "https://stackoverflow.com/questions/31139692/how-to-compose-these-two-functions/31140529#31140529", "title": "How to compose these two functions", "body": "<p>I believe that you are looking for <strong>Higher Order Functions</strong>, which is basically a function taking functions as parameters or returning other functions.</p>\n\n<p>For example to illustrate a higher order function, you can define the following functions:</p>\n\n<pre><code>f0 :: Int -&gt; Int\nf0 x = 0\n\nf1 :: a -&gt; a\nf1 x = x\n\nf2 :: (a -&gt; a) -&gt; a -&gt; a\nf2 f a = f(a)\n\nf3 :: (a -&gt; a) -&gt; (a -&gt; a)\nf3 f = f1\n</code></pre>\n\n<p>Notice that f2 takes a <strong>function</strong> and apply it to the second parameter and that f3 takes a <strong>function</strong> and <strong>return</strong> the function  f1.</p>\n\n<p>If you execute f2(f3(f0)) 5, it is going to return 5 to you.</p>\n\n<p><strong>Step-by-step</strong></p>\n\n<p><strong>1- f2(f3(f0)) 5</strong> f3 takes a function (f0) and will return f1.</p>\n\n<p><strong>2- f2(f1) 5</strong> f2 takes a function (f1) and applies it to the second parameter (5)</p>\n\n<p><strong>3- f1(5)</strong> f1 is applied to 5.</p>\n"}, {"tags": [], "owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "is_accepted": false, "score": 3, "last_activity_date": 1435704756, "creation_date": 1435704756, "answer_id": 31149872, "question_id": 31139692, "link": "https://stackoverflow.com/questions/31139692/how-to-compose-these-two-functions/31149872#31149872", "title": "How to compose these two functions", "body": "<p>As a small supplement to max taldykin's answer,</p>\n\n<p>Given</p>\n\n<pre><code>f :: (a -&gt; c) -&gt; (b -&gt; d) -&gt; (a -&gt; b) -&gt; (c -&gt; d)\nf ac bd ab = ???\n</code></pre>\n\n<p>there's really only one way to combine the arguments</p>\n\n<pre><code>bd . ab :: a -&gt; d\n</code></pre>\n\n<p>but now we're stuck! We have no way to construct a <code>c -&gt; d</code> from any combination of <code>a -&gt; c</code>, <code>b -&gt; d</code>, <code>a -&gt; b</code>, or <code>a -&gt; d</code>.</p>\n\n<p>On the other hand, if we had a <code>c -&gt; a</code> then we could construct a</p>\n\n<pre><code>f :: (c -&gt; a) -&gt; (b -&gt; d) -&gt; (a -&gt; b) -&gt; (c -&gt; d)\nf ca bd ab = bd . ab . ca\n</code></pre>\n\n<p>By the way, it can be very helpful to get out a pen and paper and draw some arrows and try to connect them into a diagram:</p>\n\n<p><img src=\"https://i.stack.imgur.com/rUw6U.png\" alt=\"\"></p>\n\n<p>If you try to do the same for <code>f :: (a -&gt; c) -&gt; (b -&gt; d) -&gt; (a -&gt; b) -&gt; (c -&gt; d)</code> then you'll see that there's no way to draw a diagram that connects <code>c -&gt; d</code>:</p>\n\n<p><img src=\"https://i.stack.imgur.com/w44Pd.png\" alt=\"enter image description here\"></p>\n\n<p>and now we have no way to connect the dots.</p>\n"}], "owner": {"reputation": 31, "user_id": 5065607, "user_type": "registered", "profile_image": "https://graph.facebook.com/563472407126201/picture?type=large", "display_name": "Jeremy  Bi", "link": "https://stackoverflow.com/users/5065607/jeremy-bi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1435704756, "creation_date": 1435671146, "last_edit_date": 1435671969, "question_id": 31139692, "link": "https://stackoverflow.com/questions/31139692/how-to-compose-these-two-functions", "title": "How to compose these two functions", "body": "<p>I know the title is a bit unclear, the problem is:</p>\n\n<p>Suppose I have a function of type <code>a -&gt; c</code>, another function of type <code>b -&gt; d</code>, how can I get a function of type <code>(a -&gt; b) -&gt; (c -&gt; d)</code>, or is it impossible in general?</p>\n\n<hr>\n\n<p>Probably I should provide some background. I asked this question because I have difficulty solving Exercise 9 from the paper <a href=\"http://www.cs.ox.ac.uk/ralf.hinze/publications/With.pdf\" rel=\"nofollow\">Fun with phantom types</a>.</p>\n\n<pre><code>data Type t where\n  ...\n  RFun :: Type a -&gt; Type b -&gt; Type (a -&gt; b)\n</code></pre>\n\n<p>And the <code>tequal</code>function</p>\n\n<pre><code>tequal :: Type t -&gt; Type u -&gt; Maybe (t -&gt; u)\n...\ntequal (RFun a b) (RFun c d) = -- should do something with (tequal a c) (tequal b d)\n</code></pre>\n\n<p>So the problem boils down to composing <code>a -&gt; c</code> and <code>b -&gt; d</code> to get <code>(a -&gt; b) -&gt; (c -&gt; d)</code></p>\n"}, {"tags": ["haskell", "http-conduit"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4734474"}, "edited": false, "score": 0, "creation_date": 1435671317, "post_id": 31138915, "comment_id": 50290120, "body": "Meanwhile, if you have the same issue and need some way to get data via HTTP, you can consider using <code>Network.Curl</code> which given a test I just did seems to work even with proxy settings for the obvious reasons."}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1435678449, "post_id": 31138915, "comment_id": 50295696, "body": "<code>http-client</code> doesn&#39;t support proxies with auth (at the moment), see <a href=\"https://github.com/snoyberg/http-client/issues/129\" rel=\"nofollow noreferrer\">github.com/snoyberg/http-client/issues/129</a>."}], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 4, "last_activity_date": 1435680125, "creation_date": 1435680125, "answer_id": 31143137, "question_id": 31138915, "link": "https://stackoverflow.com/questions/31138915/haskell-network-http-conduit-exception-invalidproxyenvironmentvariable-http-pr/31143137#31143137", "title": "Haskell Network.HTTP.Conduit Exception: InvalidProxyEnvironmentVariable &quot;http_proxy&quot;", "body": "<p>This is a limitation of http-client, which has now <a href=\"https://github.com/snoyberg/http-client/issues/129\">been reported</a> and <a href=\"https://github.com/snoyberg/http-client/commit/f6397dcc2a7472b34c986ab54ac854cb3fb08fa5\">resolved</a>. This change will get released to Hackage in the next few days, testing and success reports welcome!</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4734474"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 551, "favorite_count": 0, "accepted_answer_id": 31143137, "answer_count": 1, "score": 4, "last_activity_date": 1435680125, "creation_date": 1435668963, "question_id": 31138915, "link": "https://stackoverflow.com/questions/31138915/haskell-network-http-conduit-exception-invalidproxyenvironmentvariable-http-pr", "title": "Haskell Network.HTTP.Conduit Exception: InvalidProxyEnvironmentVariable &quot;http_proxy&quot;", "body": "<p>I'm using the simple example from HTTP.Conduit's documentation found <a href=\"http://hackage.haskell.org/package/http-conduit-2.1.5/docs/Network-HTTP-Conduit.html\" rel=\"nofollow\">here</a>.</p>\n\n<pre><code>   import Network.HTTP.Conduit\n   import qualified Data.ByteString.Lazy as L\n   main = simpleHttp \"http://www.haskell.org/\" &gt;&gt;= L.putStr\n</code></pre>\n\n<p>My system requires a proxy which is set with the environmental variable <code>http_proxy</code> and has the form <code>http://user:pass@proxy:port/</code>. </p>\n\n<p>Http.Conduit results in an exception with the error:</p>\n\n<pre><code>  *** Exception: InvalidProxyEnvironmentVariable \"http_proxy\" \"http://user:pass@proxy:port/\"\n</code></pre>\n\n<p>(I've changed the details for the proxy..)</p>\n\n<p>What is the issue? Does Http.Conduit not support authentication?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1435668663, "post_id": 31138658, "comment_id": 50288050, "body": "because the interpreter does not know what type you want back - try <code>map read . tail . inits $ show 1234 :: [Int]</code> ;)"}], "answers": [{"comments": [{"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1435669676, "post_id": 31139058, "comment_id": 50288814, "body": "good idea but I think you should show how to use this exactly ;)"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 1, "creation_date": 1435671877, "post_id": 31139058, "comment_id": 50290520, "body": "IDRIS <code>the</code> function would be really helpful here"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "edited": false, "score": 0, "creation_date": 1435723292, "post_id": 31139058, "comment_id": 50314236, "body": "@Carsten, thanks for the edit. Haskell doesn&#39;t need <code>the</code> so much because it allows terms as well as bindings to have type signatures."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": false, "score": 2, "last_activity_date": 1435671875, "last_edit_date": 1495541649, "creation_date": 1435669379, "answer_id": 31139058, "question_id": 31138658, "link": "https://stackoverflow.com/questions/31138658/how-to-get-all-subnumbers-of-a-number-in-haskell/31139058#31139058", "title": "How to get all subnumbers of a number in haskell", "body": "<p>As Carsten <a href=\"https://stackoverflow.com/questions/31138658/how-to-get-all-subnumbers-of-a-number-in-haskell#comment50288050_31138658\">suggests</a>, you need to give some indication of what type you want. This is because <code>read</code> is polymorphic in its result type. Until the compiler knows what type you want, it doesn't know what parser to use! An explicit type annotation is usually the way to go, but you might sometimes consider the function</p>\n\n<pre><code>asTypeOf :: a -&gt; a -&gt; a\nasTypeOf x _ = x\n</code></pre>\n\n<hr>\n\n<h2>how to use this here</h2>\n\n<p>I see two obvious ways to use <code>asTypeOf</code> here:</p>\n\n<pre><code>\u03bb&gt; asTypeOf (map read . tail . inits $ show 1234) ([0] :: [Int])\n[1,12,123,1234]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>\u03bb&gt; map (asTypeOf read length) . tail . inits $ show 1234\n[1,12,123,1234]\n</code></pre>\n\n<p>the first one seems hardly better at all and the second might be a bit tricky for beginners - but it works ;)</p>\n\n<p>Why? Because <code>length</code> has type <code>[a] -&gt; Int</code> and so the result type will be fixed to <code>Int</code>:</p>\n\n<pre><code>\u03bb&gt; :t (`asTypeOf` length)\n(`asTypeOf` length) :: ([a] -&gt; Int) -&gt; [a] -&gt; Int\n</code></pre>\n\n<p>which is just what we need for <code>read</code></p>\n\n<p>Please note that it's not important what <code>length</code> does - only it's type is important - any other function with an compatible signature would have worked as well (although I can come up only with <code>length</code> right now)</p>\n\n<p>For example:</p>\n\n<pre><code>wantInt :: [a] -&gt; Int\nwantInt = undefined\n\n\u03bb&gt; map (asTypeOf read wantInt) . tail . inits $ show 1234\n[1,12,123,1234]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3516, "user_id": 4233758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zNTBC.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/4233758/aleksandar"}, "edited": false, "score": 0, "creation_date": 1435669973, "post_id": 31139114, "comment_id": 50289045, "body": "I had the later already implemented, but I wanted a nicer way. The main problem was that from the right side it becomes a bit more complicated, but with the usage of show and hide is almost the same for both left and right side."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 3516, "user_id": 4233758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zNTBC.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/4233758/aleksandar"}, "edited": false, "score": 1, "creation_date": 1435671013, "post_id": 31139114, "comment_id": 50289876, "body": "it&#39;s not really more complicated (well the obvious <i>solution</i> will be less efficient but well ...) - anyway just a fun fact ;)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 3, "last_activity_date": 1435669517, "creation_date": 1435669517, "answer_id": 31139114, "question_id": 31138658, "link": "https://stackoverflow.com/questions/31138658/how-to-get-all-subnumbers-of-a-number-in-haskell/31139114#31139114", "title": "How to get all subnumbers of a number in haskell", "body": "<p>because the interpreter does not know what type you want back</p>\n\n<p>this will work:</p>\n\n<pre><code>\u03bb&gt; map read . tail . inits $ show 1234 :: [Int]\n[1,12,123,1234]\n</code></pre>\n\n<p>of course you can just add a type-signature as well (most likely in your code file):</p>\n\n<pre><code>subnums :: Int -&gt; [Int]\nsubnums = map read . tail . inits . show\n</code></pre>\n\n<hr>\n\n<p>in ghci:</p>\n\n<pre><code>\u03bb&gt; subnums 1234\n[1,12,123,1234]\n</code></pre>\n\n<hr>\n\n<p>and a nice exercise can be to do this without <code>show</code>/<code>read</code>:</p>\n\n<pre><code>subnumbers :: Int -&gt; [Int]\nsubnumbers 0 = []\nsubnumbers n =\n  n : subnumbers (n `div` 10)\n</code></pre>\n\n<p>Can you solve the problem with the order here?</p>\n"}, {"tags": [], "owner": {"reputation": 4773, "user_id": 4148211, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/DiKJf.jpg?s=128&g=1", "display_name": "frasertweedale", "link": "https://stackoverflow.com/users/4148211/frasertweedale"}, "is_accepted": false, "score": 3, "last_activity_date": 1435731516, "last_edit_date": 1435731516, "creation_date": 1435717596, "answer_id": 31151630, "question_id": 31138658, "link": "https://stackoverflow.com/questions/31138658/how-to-get-all-subnumbers-of-a-number-in-haskell/31151630#31151630", "title": "How to get all subnumbers of a number in haskell", "body": "<p>A good approach is to use an <strong>unfold</strong>.  While a <strong>fold</strong> (variously known as <em>reduce</em>, <em>accumulate</em> or <em>aggregate</em> in other languages) can process a list of numbers (or values of other types) to compute a single result value, an unfold starts with a single value and expands it into a list of values according to a given function.  Let us examine the type of an unfold function:</p>\n\n<pre><code>Data.List.unfoldr :: (b -&gt; Maybe (a, b)) -&gt; b -&gt; [a]\n</code></pre>\n\n<p>We see that <code>unfoldr</code> take a function <code>(b -&gt; Maybe (a, b)</code>, and a starting <code>b</code>.  The result is a <code>[a]</code>.  If the function evaluates to <code>Just (a, b)</code>, the <code>a</code> will be appended to the result, and the unfold recurses with the new <code>b</code>.  If the function evaluates to <code>Nothing</code>, the unfold is complete.</p>\n\n<p>The function for your unfold is:</p>\n\n<pre><code>f :: Integral b =&gt; b -&gt; Maybe (b, b)\nf x = if x &gt; 0 \n  then Just (x, x `div` 10)  -- append x to result; continue with x/10\n  else Nothing               -- x = 0; we're done\n</code></pre>\n\n<p>Now we can solve your problem without any of this <code>show</code> and <code>read</code> hackery:</p>\n\n<pre><code>\u03bb&gt; let f = (\\x -&gt; if x &gt; 0 then Just (x, x `div` 10) else Nothing)\n\u03bb&gt; reverse $ unfoldr f 1234\n[1,12,123,1234]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10220, "user_id": 2720372, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/olQxk.jpg?s=128&g=1", "display_name": "w.b", "link": "https://stackoverflow.com/users/2720372/w-b"}, "is_accepted": false, "score": 1, "last_activity_date": 1435739087, "creation_date": 1435739087, "answer_id": 31156170, "question_id": 31138658, "link": "https://stackoverflow.com/questions/31138658/how-to-get-all-subnumbers-of-a-number-in-haskell/31156170#31156170", "title": "How to get all subnumbers of a number in haskell", "body": "<p>A working list comprehension solution:</p>\n\n<pre><code>subNums :: Int -&gt; [Int]\nsubNums num = [read x | let str = show num, let size = length str, n &lt;- [1 .. size], let x = take n str]\n\n\u03bb&gt; subNums 1234\n[1,12,123,1234]\n</code></pre>\n"}], "owner": {"reputation": 3516, "user_id": 4233758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zNTBC.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/4233758/aleksandar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 1, "accepted_answer_id": 31139114, "answer_count": 4, "score": 3, "last_activity_date": 1435739087, "creation_date": 1435668147, "last_edit_date": 1435732586, "question_id": 31138658, "link": "https://stackoverflow.com/questions/31138658/how-to-get-all-subnumbers-of-a-number-in-haskell", "title": "How to get all subnumbers of a number in haskell", "body": "<p>I would like to get all sub numbers of a number from a particular side. </p>\n\n<p>In the case of the number 1234, the sub numbers from the left side are:</p>\n\n<pre><code>1, 12, 123, 1234\n</code></pre>\n\n<p>I implemented it with:</p>\n\n<pre><code>tail . inits $ show 1234\n</code></pre>\n\n<p>This way I get all the sub numbers in [[Char]] format.</p>\n\n<pre><code>[\"1\",\"12\",\"123\",\"1234\"]\n</code></pre>\n\n<p>I tried to convert them to Integer, with the following line.</p>\n\n<pre><code>map read . tail . inits $ show 1234\n</code></pre>\n\n<p>But I get the following error</p>\n\n<pre><code>[*** Exception: Prelude.read: no parse\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["haskell", "haskell-stack"], "comments": [{"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 2, "creation_date": 1435662602, "post_id": 31135606, "comment_id": 50283769, "body": "Actually, that pull request only added support for authentication values in the request URL itself, not in talking with the proxy. <a href=\"https://github.com/snoyberg/http-client/blob/dc981b9fde57d77ccecf0171a96fb92c5cb5712f/http-client/Network/HTTP/Client/Manager.hs#L503\" rel=\"nofollow noreferrer\">This is the relevant line.</a> This is worth opening as an http-client issue"}, {"owner": {"reputation": 1767, "user_id": 1280784, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f879447ea8f119c9e0dfe3981fd11a46?s=128&d=identicon&r=PG", "display_name": "cms_mgr", "link": "https://stackoverflow.com/users/1280784/cms-mgr"}, "reply_to_user": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "edited": false, "score": 0, "creation_date": 1435667262, "post_id": 31135606, "comment_id": 50286972, "body": "@MichaelSnoyman okay thanks, I&#39;ll do it when I get home."}], "answers": [{"comments": [{"owner": {"reputation": 560, "user_id": 284642, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2f30c76f5371a33ebd29109c24ccb0e5?s=128&d=identicon&r=PG", "display_name": "Pavel Martynov", "link": "https://stackoverflow.com/users/284642/pavel-martynov"}, "edited": false, "score": 1, "creation_date": 1438669064, "post_id": 31143098, "comment_id": 51530463, "body": "http-client with proxy auth fix has been released to the Hackage. please, release stack with it, we can not use stack behind corporate proxy :-/"}, {"owner": {"reputation": 716, "user_id": 1995474, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae968c7b168bb164fc30f3e3254a8478?s=128&d=identicon&r=PG", "display_name": "Stephan", "link": "https://stackoverflow.com/users/1995474/stephan"}, "edited": false, "score": 3, "creation_date": 1441306010, "post_id": 31143098, "comment_id": 52636980, "body": "I am also using a proxy and stack doesn&#39;t work for me. I get a <code>ProxyConnectException</code>, with <code>statusMessage = \\&quot;Proxy Authentication Required\\&quot;</code>. I have the <code>http_proxy</code> and <code>https_proxy</code> environment variables set up, and interacting with github works, but stack fails."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 9, "last_activity_date": 1435680023, "creation_date": 1435680023, "answer_id": 31143098, "question_id": 31135606, "link": "https://stackoverflow.com/questions/31135606/using-commercialhaskell-stack-with-a-proxy/31143098#31143098", "title": "Using commercialhaskell/stack with a proxy", "body": "<p>This is a limitation of http-client, which has now <a href=\"https://github.com/snoyberg/http-client/issues/129\" rel=\"noreferrer\">been reported</a> and <a href=\"https://github.com/snoyberg/http-client/commit/f6397dcc2a7472b34c986ab54ac854cb3fb08fa5\" rel=\"noreferrer\">resolved</a>. This change will get released to Hackage in the next few days, and then hopefully the next official build of stack will include the change. If you're adventurous, you can build the <a href=\"https://github.com/commercialhaskell/stack/tree/http-proxy-auth\" rel=\"noreferrer\">http-proxy-auth branch</a>, which includes this fix pre-release.</p>\n"}], "owner": {"reputation": 1767, "user_id": 1280784, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f879447ea8f119c9e0dfe3981fd11a46?s=128&d=identicon&r=PG", "display_name": "cms_mgr", "link": "https://stackoverflow.com/users/1280784/cms-mgr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2413, "favorite_count": 3, "accepted_answer_id": 31143098, "answer_count": 1, "score": 11, "last_activity_date": 1435680023, "creation_date": 1435659453, "last_edit_date": 1435674298, "question_id": 31135606, "link": "https://stackoverflow.com/questions/31135606/using-commercialhaskell-stack-with-a-proxy", "title": "Using commercialhaskell/stack with a proxy", "body": "<p>I'm trying to use <a href=\"https://github.com/commercialhaskell/stack\" rel=\"noreferrer\">stack</a> behind a corporate proxy. Issuing the <code>stack new</code> command returns:</p>\n\n<pre><code>InvalidProxyEnvironmentVariable \"http_proxy\" \"http://username:password@host:port/\"\n</code></pre>\n\n<p>I have <code>http_proxy</code>, <code>https_proxy</code> and <code>ftp_proxy</code> defined in my <code>.bashrc</code>, as well as their equivalents in all caps (e.g. <code>HTTP_PROXY</code>). Removing or altering those will break stuff elsewhere.</p>\n\n<p>The stack repo doesn't seem to have proxy behaviour documented yet, which is understandable since it was only recently released. Does anyone know if using stack behind a proxy is even possible at the moment? If so, how?</p>\n"}, {"tags": ["haskell", "elm"], "comments": [{"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 0, "creation_date": 1435656928, "post_id": 31134228, "comment_id": 50280103, "body": "&quot;Flower brackets&quot; \u2014 nice \ud83c\udf37"}], "answers": [{"tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": true, "score": 6, "last_activity_date": 1435656137, "creation_date": 1435656137, "answer_id": 31134326, "question_id": 31134228, "link": "https://stackoverflow.com/questions/31134228/pipe-symbol-in-elm-action-method/31134326#31134326", "title": "Pipe symbol in elm action method", "body": "<p>This is record update syntax: <a href=\"http://elm-lang.org/docs/records#updating-records\" rel=\"noreferrer\">http://elm-lang.org/docs/records#updating-records</a></p>\n\n<p><code>{ model | tasks &lt;- value }</code> returns <code>model</code> record with <code>tasks</code> field set to a new value.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 1, "accepted_answer_id": 31134326, "answer_count": 1, "score": 3, "last_activity_date": 1435656438, "creation_date": 1435655829, "last_edit_date": 1435656438, "question_id": 31134228, "link": "https://stackoverflow.com/questions/31134228/pipe-symbol-in-elm-action-method", "title": "Pipe symbol in elm action method", "body": "<pre><code>update action model =\n    case action of\n      Delete id -&gt;\n          { model | tasks &lt;- List.filter (\\t -&gt; t.id /= id) model.tasks }\n</code></pre>\n\n<p>I don't understand this syntax,</p>\n\n<pre><code>  { model | .......... }\n</code></pre>\n\n<p>What does the pipe symbol <code>|</code> do here?</p>\n\n<p>What does flower brackets <code>{}</code> mean? And does the action <code>Delete</code> return any value?</p>\n\n<p>This code is taken from elm's Todo <a href=\"https://github.com/evancz/elm-todomvc/blob/master/Todo.elm#L114\" rel=\"nofollow\">tutorial</a>.</p>\n"}, {"tags": ["haskell", "cabal", "haskell-warp"], "answers": [{"tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": false, "score": 1, "last_activity_date": 1435653460, "creation_date": 1435653460, "answer_id": 31133432, "question_id": 31128907, "link": "https://stackoverflow.com/questions/31128907/yesods-wrap-needs-transformers-0-2-2-and-0-4-it-conflicts-with-local-versi/31133432#31133432", "title": "Yesod&#39;s wrap needs transformers &gt; 0.2.2 and &lt; 0.4, it conflicts with local version", "body": "<p>Looks like you've hit the limits of cabal's dependency solver backjumps. You can:</p>\n\n<ul>\n<li>Add the flags <code>--max-backjumps=-1 --reorder-goals</code></li>\n<li>Follow the <a href=\"http://www.yesodweb.com/page/quickstart\" rel=\"nofollow\">quickstart guide</a> which uses Stackage to avoid this problem</li>\n<li>Use <a href=\"https://github.com/commercialhaskell/stack\" rel=\"nofollow\">stack</a> instead of cabal, which fixes this and many other problems. Note that this workflow is <a href=\"http://www.yesodweb.com/blog/2015/06/stack-support-yesod-devel\" rel=\"nofollow\">still being refined</a></li>\n</ul>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1435653460, "creation_date": 1435633894, "last_edit_date": 1435646858, "question_id": 31128907, "link": "https://stackoverflow.com/questions/31128907/yesods-wrap-needs-transformers-0-2-2-and-0-4-it-conflicts-with-local-versi", "title": "Yesod&#39;s wrap needs transformers &gt; 0.2.2 and &lt; 0.4, it conflicts with local version", "body": "<p>I created a new yesod project as,</p>\n\n<pre><code>yesod init\ncd lemonstand &amp;&amp; cabal sandbox init &amp;&amp; cabal install\n</code></pre>\n\n<p>Package dependency resolution fails as,</p>\n\n<pre><code>next goal: warp (dependency of lemonstand-0.0.0)\nrejecting: warp-3.0.12.1, 3.0.12,,,,(conflict: lemonstand =&gt; warp&gt;=1.3 &amp;&amp; &lt;1.4)\nrejecting: warp-1.3.10.2, 1.3.10.1,,,,(conflict: transformers==0.4.3.0, warp =&gt; transformers&gt;=0.2.2 &amp;&amp; &lt;0.4)\nrejecting: warp-1.2.2, 1.2.1.1,,,,(conflict: lemonstand =&gt;warp&gt;=1.3 &amp;&amp; &lt;1.4)\nBackjump limit reached (change with --max-backjumps)\n</code></pre>\n\n<p>On running <code>cabal exec ghc-pkg list transformers</code>, it shows,</p>\n\n<pre><code>/opt/ghc/7.8.4/lib/ghc-7.8.4/package.conf.d\n   transformers-0.3.0.0\n/home/user/ws/yesod/lemonstand/.cabal-sandbox/x86_64-linux-ghc-7.8.4-packages.conf.d\n</code></pre>\n\n<p>What does <code>conflict: transformers==0.4.3.0</code> mean in the error line? And since <code>warp</code> expects the <code>transformers</code> versioned > 0.2.2 and &lt; 0.4, can i install <code>transformers</code> inside the sandbox folder?</p>\n\n<p>Since transformers come as part of ghc's inbuilt libraries, i am not sure how to install a different version of <code>transformers</code>?</p>\n"}, {"tags": ["haskell", "monads"], "answers": [{"tags": [], "owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "is_accepted": true, "score": 4, "last_activity_date": 1435629480, "creation_date": 1435629480, "answer_id": 31128338, "question_id": 31128236, "link": "https://stackoverflow.com/questions/31128236/print-map-functions-output-list-using-mapm-putstrln/31128338#31128338", "title": "Print map function&#39;s output list using mapM_ / putStrLn", "body": "<p><code>mapM_</code> is based on the <code>mapM</code> function, which has the type</p>\n\n<pre><code>mapM :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]\n</code></pre>\n\n<p>And <code>mapM_</code> has the type</p>\n\n<pre><code>mapM_ :: Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m ()\n</code></pre>\n\n<p>With the former, it acts like the normal <code>map</code> over a list, but where each element has an action run with the results aggregated.  So for example if you wanted to read multiple files you could use <code>contents &lt;- mapM readFile [filename1, filename2, filename3]</code>, and <code>contents</code> would be a list where each element represented the contents of the corresponding file.  The <code>mapM_</code> function does the same thing, but throws away the results.  One definition is</p>\n\n<pre><code>mapM_ f list = do\n    mapM f list\n    return ()\n</code></pre>\n\n<p>Every action gets executed, but nothing is returned.  This is useful in situations like yours where the result value is useless, namely that <code>()</code> is the only value of type <code>()</code> and therefore no actual decisions can be made from it.  If you had <code>mapM putStrLn someListOfStrings</code> then the result of this would have type <code>IO [()]</code>, but with <code>mapM_ putStrLn someListOfStrings</code> the <code>[()]</code> is thrown away and just replaced with <code>()</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 735, "favorite_count": 1, "accepted_answer_id": 31128338, "answer_count": 1, "score": 2, "last_activity_date": 1435650517, "creation_date": 1435628612, "last_edit_date": 1435650517, "question_id": 31128236, "link": "https://stackoverflow.com/questions/31128236/print-map-functions-output-list-using-mapm-putstrln", "title": "Print map function&#39;s output list using mapM_ / putStrLn", "body": "<p>I tried to print map function's list output using putStrLn as,  </p>\n\n<pre><code>main = do\n  let out = \"hello\\nworld\\nbye\\nworld\\n\"\n  putStrLn $ map (\"out: \" ++) $ lines out\n</code></pre>\n\n<p>It throws error as,</p>\n\n<pre><code>Couldn't match type \u2018[Char]\u2019 with \u2018Char\u2019\n</code></pre>\n\n<p>I referred some other code and changed the lastline to </p>\n\n<pre><code>  mapM_ putStrLn $ map (\"out: \" ++) $ lines out\n</code></pre>\n\n<p>It solves the problem, but how does map monad with underscore suffix work in this case?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1435624472, "post_id": 31127605, "comment_id": 50267667, "body": "Do you have the exact error message? It doesn&#39;t look like a Type Mismatch."}, {"owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 1, "creation_date": 1435624523, "post_id": 31127605, "comment_id": 50267681, "body": "An unrelated error is that LogExStack may not have a methodName. You would want to deal with that."}, {"owner": {"reputation": 4285, "user_id": 894682, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4edaf2fa1d9d3f2ff26158fcbbf5a9e4?s=128&d=identicon&r=PG", "display_name": "Nixit Patel", "link": "https://stackoverflow.com/users/894682/nixit-patel"}, "reply_to_user": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "edited": false, "score": 0, "creation_date": 1435680522, "post_id": 31127605, "comment_id": 50297051, "body": "@PyRulez I have added the error details."}], "answers": [{"comments": [{"owner": {"reputation": 4285, "user_id": 894682, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4edaf2fa1d9d3f2ff26158fcbbf5a9e4?s=128&d=identicon&r=PG", "display_name": "Nixit Patel", "link": "https://stackoverflow.com/users/894682/nixit-patel"}, "edited": false, "score": 0, "creation_date": 1435680607, "post_id": 31130173, "comment_id": 50297101, "body": "I have made the changes as you have said but its still showing Type error, I have edited my question"}, {"owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "reply_to_user": {"reputation": 4285, "user_id": 894682, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4edaf2fa1d9d3f2ff26158fcbbf5a9e4?s=128&d=identicon&r=PG", "display_name": "Nixit Patel", "link": "https://stackoverflow.com/users/894682/nixit-patel"}, "edited": false, "score": 0, "creation_date": 1435695827, "post_id": 31130173, "comment_id": 50305971, "body": "@NixitPatel I updated my answer, have a look at that example"}], "tags": [], "owner": {"reputation": 2152, "user_id": 1103600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7830fb399137c319ff68dca3e3b6f7e2?s=128&d=identicon&r=PG", "display_name": "Arnon", "link": "https://stackoverflow.com/users/1103600/arnon"}, "is_accepted": true, "score": 2, "last_activity_date": 1435695797, "last_edit_date": 1435695797, "creation_date": 1435641868, "answer_id": 31130173, "question_id": 31127605, "link": "https://stackoverflow.com/questions/31127605/filter-in-list-with-custom-data-types/31130173#31130173", "title": "Filter in List with custom data types", "body": "<p>I can only assume that you are calling the filter wrong:</p>\n\n<p>You defined your own data type <code>List [LogExStack]</code>, but your <code>filterStackTrace</code> accepts just <code>[LogExStack]</code>. You would therefore need to have to 'extract' the actual list from the <code>List</code> constructor before calling <code>filterStackTrace</code>, perhaps by pattern matching it in the <code>filterStackTrace</code> clause:</p>\n\n<pre><code>filterStackTrace :: LogExStack -&gt; LogExStack\nfilterStackTrace  (List l) = List $ filter (\\r -&gt; methodName r == \"com.xyz.abc\") l\n</code></pre>\n\n<p>Edit:\nOn second thought actually, defining your own list type here is a bit weird.\nWhy not just have the data type as</p>\n\n<pre><code>data LogExStack = LogExStack {\n    methodName :: String,\n    className :: String,\n    extraInfo :: String\n} deriving Show\n</code></pre>\n\n<p>Then altering the parser to return the proper list version of <code>LogExStack</code></p>\n\n<pre><code>exceptionStackTraceParser :: Parser [LogExStack]\nexceptionStackTraceParser =\n    sepBy exceptionParser newLinesTabEx\n</code></pre>\n\n<p>And then calling the <code>filterStackTrace</code> as you wrote it originally?</p>\n\n<p>Edit 2, as a response:\nYou are missing the call to <code>parse</code>.\nThis simple program worked for me:</p>\n\n<pre><code>module Main where\nimport Text.Parsec\nimport Text.Parsec.String\n\ndata LogExStack = LogExStack {\n    methodName :: String,\n    className :: String,\n    extraInfo :: String\n} deriving Show\n\nexceptionParser :: Parser LogExStack\nexceptionParser =\n    do\n        _ &lt;- string \"at\"\n        method &lt;- many (noneOf \"(\")\n        _ &lt;- string \"(\"\n        className' &lt;- many (noneOf \")\")\n        _ &lt;- string \")\"\n        extraInfo' &lt;- many (noneOf \"\\n\")\n        _ &lt;- string \"\\n\"\n        return $ LogExStack method className' extraInfo'\n\nexceptionStackTraceParser :: Parser [LogExStack]\nexceptionStackTraceParser =\n    exceptionParser `sepBy` newLinesTabEx\n  where\n    newLinesTabEx = oneOf \"\\t\\r\\n\"\n\nmain :: IO ()\nmain = do\n     case (parse exceptionParser \"example\" \"bla bla bla bla\") of\n      Left err -&gt; print $ \"Error: \" ++ show err\n      Right xs -&gt; print xs\n</code></pre>\n"}], "owner": {"reputation": 4285, "user_id": 894682, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/4edaf2fa1d9d3f2ff26158fcbbf5a9e4?s=128&d=identicon&r=PG", "display_name": "Nixit Patel", "link": "https://stackoverflow.com/users/894682/nixit-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 934, "favorite_count": 1, "accepted_answer_id": 31130173, "answer_count": 1, "score": 2, "last_activity_date": 1435695797, "creation_date": 1435623577, "last_edit_date": 1495540278, "question_id": 31127605, "link": "https://stackoverflow.com/questions/31127605/filter-in-list-with-custom-data-types", "title": "Filter in List with custom data types", "body": "<p>I have just started using Haskell. And I am using it for log parsing, and I am trying to filter the log. but getting error related to TypeMismatch.</p>\n\n<p>Here is what I did.</p>\n\n<p><strong>my data types</strong></p>\n\n<pre><code>data LogExStack = LogExStack {\n    methodName :: String,\n    className :: String,\n    extraInfo :: String\n} | List [LogExStack] deriving Show\ndata LogException = LogException {\n    exFirstLine :: LogExFirstLine,\n    exMessage :: LogExMessage,\n    exStackTrace :: LogExStack\n} deriving Show\n</code></pre>\n\n<p>I want to have the filter on <code>LogExStack</code> type data.\nand my function for creating that list looks something like this</p>\n\n<pre><code>exceptionStackTraceParser :: Parser LogExStack\nexceptionStackTraceParser =\n    M.liftM List $ sepBy exceptionParser newLinesTabEx\n\n\nexceptionParser :: Parser LogExStack\nexceptionParser =\n    do\n        string \"at\"\n        method &lt;- many (noneOf \"(\")\n        string \"(\"\n        className &lt;- many (noneOf \")\")\n        string \")\"\n        extraInfo &lt;- many (noneOf \"\\n\")\n        string \"\\n\"\n        return $ LogExStack method className extraInfo\n</code></pre>\n\n<p>till now it's fine, but when I tried to use the list for filter it didn't work. I wanted to have filter on the methodName from LogExStack list.</p>\n\n<p>here is my function for that</p>\n\n<pre><code>filterStackTrace :: [LogExStack] -&gt; [LogExStack]\nfilterStackTrace  = filter (\\r -&gt; methodName r == \"com.xyz.abc\")\n</code></pre>\n\n<p>I also tried without [] but it failed as well. can anyone help me with this.\nI took the reference for my implementation from here</p>\n\n<p><a href=\"https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/Parsing\" rel=\"nofollow noreferrer\">https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/Parsing</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/20653830/filter-a-haskell-data-type\">Filter a haskell data type</a></p>\n\n<p>can anyone help me with this?\nThanks</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>here is the changes I make after reading Arnon post</p>\n\n<pre><code>exceptionStackTraceParser :: Parser [LogExStack]\nexceptionStackTraceParser =\n    sepBy exceptionParser newLinesTabEx\n</code></pre>\n\n<p>here is how I am calling filter</p>\n\n<pre><code>parseExpr :: Parser LogException\nparseExpr = \n    do\n        fstLine &lt;- exceptionFirstLineParser\n        msgLine &lt;- exceptionMessageParser\n        stackTrace &lt;- exceptionStackTraceParser\n        list &lt;- filterStackTrace stackTrace\n        return $ LogException fstLine msgLine list\n</code></pre>\n\n<p>and here is my exception</p>\n\n<pre><code>H:\\&gt;ghc --make -O logparser.hs\n[1 of 1] Compiling Main             ( logparser.hs, logparser.o )\n\nlogparser.hs:69:25:\n    Couldn't match type `[]'\n                  with `Text.Parsec.Prim.ParsecT\n                          String () Data.Functor.Identity.Identity'\n    Expected type: Text.Parsec.Prim.ParsecT\n                     String () Data.Functor.Identity.Identity LogExStack\n      Actual type: [LogExStack]\n    In a stmt of a 'do' block: list &lt;- filterStackTrace stackTrace\n    In the expression:\n      do { fstLine &lt;- exceptionFirstLineParser;\n           msgLine &lt;- exceptionMessageParser;\n           stackTrace &lt;- exceptionStackTraceParser;\n           list &lt;- filterStackTrace stackTrace;\n           .... }\n</code></pre>\n\n<p><strong>EDIT2</strong>\nGot it I was calling the list filter from wrong place somehow I can not call from the parseExpr function, because I don't know somehow it thinks called function from there must be Parsec type. </p>\n\n<p>I don't know why? can anybody help me understand that?</p>\n"}, {"tags": ["haskell", "cabal", "cabal-install", "gnu-toolchain"], "answers": [{"comments": [{"owner": {"reputation": 11669, "user_id": 76123, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c933fbb8685a083234fe385df8e9025f?s=128&d=identicon&r=PG", "display_name": "Daniel Pratt", "link": "https://stackoverflow.com/users/76123/daniel-pratt"}, "edited": false, "score": 0, "creation_date": 1435669140, "post_id": 31128854, "comment_id": 50288402, "body": "It appears you are correct. I did <code>cabal install cabal-install</code> and thereafter I was able to execute the previously failing command. Is this fix documented somewhere? I&#39;m curious to know how it was fixed."}, {"owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "reply_to_user": {"reputation": 11669, "user_id": 76123, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c933fbb8685a083234fe385df8e9025f?s=128&d=identicon&r=PG", "display_name": "Daniel Pratt", "link": "https://stackoverflow.com/users/76123/daniel-pratt"}, "edited": false, "score": 1, "creation_date": 1435672213, "post_id": 31128854, "comment_id": 50290786, "body": "You can see the gory details here: <a href=\"https://github.com/haskell/cabal/issues/2502\" rel=\"nofollow noreferrer\">github.com/haskell/cabal/issues/2502</a>. Note that the initial fix actually caused a much worse bug where cabal couldn&#39;t install anything, see: <a href=\"https://github.com/haskell/cabal/issues/2658\" rel=\"nofollow noreferrer\">github.com/haskell/cabal/issues/2658</a>"}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 3, "last_activity_date": 1435633466, "creation_date": 1435633466, "answer_id": 31128854, "question_id": 31125664, "link": "https://stackoverflow.com/questions/31125664/how-can-i-work-around-cabal-sandbox-build-errors-on-windows-due-to-path-length-l/31128854#31128854", "title": "How can I work around cabal sandbox build errors on Windows due to path length limitations?", "body": "<p>This was fixed in the most recent release of cabal-install. Upgrading should solve the problem.</p>\n"}], "owner": {"reputation": 11669, "user_id": 76123, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c933fbb8685a083234fe385df8e9025f?s=128&d=identicon&r=PG", "display_name": "Daniel Pratt", "link": "https://stackoverflow.com/users/76123/daniel-pratt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "accepted_answer_id": 31128854, "answer_count": 1, "score": 3, "last_activity_date": 1435633466, "creation_date": 1435612352, "question_id": 31125664, "link": "https://stackoverflow.com/questions/31125664/how-can-i-work-around-cabal-sandbox-build-errors-on-windows-due-to-path-length-l", "title": "How can I work around cabal sandbox build errors on Windows due to path length limitations?", "body": "<p>For a while I was mystified about the fact that doing installs/builds in a cabal sandbox often failed on my Windows machine. I eventually figured out that the failures were caused by certain paths exceeding the <code>MAX_PATH</code> limit (paths are effectively limited to 255 characters).</p>\n\n<p>As a specific example, if I try to <code>cabal install data-default-instances-old-locale-0.0.1</code> within a cabal sandbox folder, it fails. At some point in the process, Cabal invokes <code>ar.exe</code> with a path that looks like <code>dist/dist-sandbox-72eb259b\\build\\libHSdata-default-instances-old-locale-0.0.1-6jcjjaR25tK4x3nJhHHjFM.a-45644\\libHSdata-default-instances-old-locale-0.0.1-6jcjjaR25tK4x3nJhHHjFM.a</code>. This is relative to a working folder under the temp directory (which I have set to simply <code>C:\\Temp</code>), so the full path works out to be <code>C:\\Temp\\data-default-instances-old-locale-0.0.1-18744\\data-default-instances-old-locale-0.0.1\\dist\\dist-sandbox-72eb259b\\build\\libHSdata-default-instances-old-locale-0.0.1-6jcjjaR25tK4x3nJhHHjFM.a-18744\\libHSdata-default-instances-old-locale-0.0.1-6jcjjaR25tK4x3nJhHHjFM.a</code>.</p>\n\n<p>That final path is 272 characters long, well over the 255 limit.</p>\n\n<p>It is possible to deal with longer paths on Windows, but it isn't trivial and in any case, ar doesn't seem to do whatever is necessary to handle them (not surprising since it's just a port of the GNU tool chain).</p>\n\n<p>I have a feeling this is the situation for the foreseeable future, but maybe someone can think of a work around?</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1435608487, "post_id": 31124265, "comment_id": 50261706, "body": "Seems like somewhere <code>Maybe</code> gets into the way. Could you check (in ghci for example) what&#39;s the type of the expression wrapped in <code>liftIO</code>? And perhaps post the whole function to see where from we&#39;re getting <code>Just</code>?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1435608865, "post_id": 31124265, "comment_id": 50261928, "body": "Aside, you might be interested in the concept that the <a href=\"https://code.google.com/p/ganeti/\" rel=\"nofollow noreferrer\">Ganeti</a> project (which I&#39;m affiliated with) uses: A custom monad transformer named <code>ResultT</code>, isomorphic to <code>EitherT</code>, but whose <a href=\"http://git.ganeti.org/?p=ganeti.git;a=blob;f=src/Ganeti/BasicTypes.hs;h=15a26a323a2d6091a032ee8410b9caddde91ac3f;hb=HEAD#l195\" rel=\"nofollow noreferrer\"><code>liftIO</code> implementation</a> catches <code>IO</code> errors and converts them to the error part of the <code>ResultT</code> monad. This is very convenient as failing wrapped primitive <code>IO</code> operations are nicely handled by the monad."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435610195, "post_id": 31124265, "comment_id": 50262691, "body": "What is the exact error that GHC gives you? Please post enough code (perhaps with implementations of irrelevant things stubbed out with <code>undefined</code>) that we can reproduce your error."}], "answers": [{"comments": [{"owner": {"reputation": 1706, "user_id": 1840613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2dfd4d21060ccd9b972864e0f6cb8c4?s=128&d=identicon&r=PG", "display_name": "Jeremy List", "link": "https://stackoverflow.com/users/1840613/jeremy-list"}, "edited": false, "score": 0, "creation_date": 1437100574, "post_id": 31126169, "comment_id": 50901124, "body": "The last time I wrote a function that returned an <code>IO (IO [Value])</code> it was deliberate, but I&#39;ve done it accidentally too."}], "tags": [], "owner": {"reputation": 507, "user_id": 467526, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/336abdba9ba141d3fef8e439b820a624?s=128&d=identicon&r=PG", "display_name": "user467526", "link": "https://stackoverflow.com/users/467526/user467526"}, "is_accepted": false, "score": 3, "last_activity_date": 1435614587, "creation_date": 1435614587, "answer_id": 31126169, "question_id": 31124265, "link": "https://stackoverflow.com/questions/31124265/using-liftio-and-monad-transformers-why-is-the-type-of-a-bound-variable-io-list/31126169#31126169", "title": "Using liftIO and monad transformers, why is the type of a bound variable IO List instead of List?", "body": "<p>I figured out my issue. I was calling return on a value that was already an IO value, leading to IO (IO [Value]).</p>\n"}], "owner": {"reputation": 507, "user_id": 467526, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/336abdba9ba141d3fef8e439b820a624?s=128&d=identicon&r=PG", "display_name": "user467526", "link": "https://stackoverflow.com/users/467526/user467526"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 390, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1435614587, "creation_date": 1435607126, "question_id": 31124265, "link": "https://stackoverflow.com/questions/31124265/using-liftio-and-monad-transformers-why-is-the-type-of-a-bound-variable-io-list", "title": "Using liftIO and monad transformers, why is the type of a bound variable IO List instead of List?", "body": "<p>I'm using EitherT in conjunction with IO for error handling. I have a function in the IO monad that gets data from a database so it has a type of IO [Value]. I use liftIO to lift this function into my EitherT IO monad and bind the result of this function to a variable. The problem is that GHC is telling me that the variable has the type IO [Value] instead of just [Value]. My code looks like this</p>\n\n<pre><code>    getItem :: (IConnection a) =&gt; a -&gt; ItemId -&gt; EitherT String IO Item\n    getItem conn id = do\n                    result &lt;- liftIO $ do\n                                        ... database stuf\n</code></pre>\n\n<p>It seems like i'm misunderstanding how liftIO and binding variables works. I thought that liftIO would take IO [Value] and return EitherT String IO [Value] and when bound to a variable, it would have the type [Value]. But it seems like I'm mistaken.</p>\n"}, {"tags": ["haskell", "category-theory"], "comments": [{"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1435605038, "post_id": 31122882, "comment_id": 50259731, "body": "I think I understand what you&#39;re asking. The reason we know <code>id</code> must be the identity function follows from the polymorphic type, and &lt;hand waving&gt;has to do with <a href=\"http://bartoszmilewski.com/2014/09/22/parametricity-money-for-nothing-and-theorems-for-free/\" rel=\"nofollow noreferrer\">parametricity</a> and <a href=\"https://www.fpcomplete.com/user/edwardk/snippets/fmap\" rel=\"nofollow noreferrer\">free theorems</a> &lt;/hand waving&gt; which are things I don&#39;t completely understand."}, {"owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1435617816, "post_id": 31122882, "comment_id": 50265917, "body": "Yes, looks like you&#39;ve read the post I linked above. I do have a more specific question than the one posed <a href=\"http://stackoverflow.com/a/21485660\">there</a>,  so I&#39;m hoping the answers here can be more directed."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1435620934, "post_id": 31122882, "comment_id": 50266797, "body": "Parametricity is not relevant here. There are plenty of categories that have multiple &quot;parametric functions <code>forall a. a -&gt; a</code>&quot; (natural endomorphisms of the identity functor), but the identity on an object A is always determined by the identities <code>id_A . f = f</code>, <code>g . id_A = g</code>. An example of the former would be a version of Hask that incorporates bottom, and <code>notId :: a -&gt; a; notId _ = undefined</code>."}], "answers": [{"comments": [{"owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 1, "creation_date": 1435617357, "post_id": 31123082, "comment_id": 50265768, "body": "See, I&#39;m not buying that (because of something I don&#39;t see, no doubt?). If the Hask Objects are indeed types, then you have to establish equality by comparing Haskell <i>types</i>, not values...don&#39;t you? So to satisfy the identity requirements a Haskell function should only have to preserve types -- not values. Given that, the left identity rule should be typeof (id . f) = typeof(f) and right identity likewise: typeof (g . id) = typeof(g).  (Please excuse the unHaskellish pseudocode.)  So where is this value-based notion of equality coming from? Seemingly neither category theory nor Hask..."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 1, "creation_date": 1435621242, "post_id": 31123082, "comment_id": 50266882, "body": "@nclark Your argument basically states that given two objects A,B in a category, there can be at most one morphism A -&gt; B. This is wrong, in general: equality of morphisms is a much stronger requirement than having the same source/target object. Take vector spaces and linear functions as a category: surely you can find more than one linear function between a real plane and itself. Ergo, there are many morphisms."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 1, "creation_date": 1435621488, "post_id": 31123082, "comment_id": 50266967, "body": "@nclark Even more abstractly, build your own category with two objects, the letters A and B. Let letters a,b,c,d be four morphisms, a,b acting as the identities for A,B, while both c,d are A -&gt; B. Composition is defined by the identity laws. Note that A,B are no sets, so we have no &quot;values&quot; to speak of in this category. Yet, we do have two distinct morphisms A-&gt;B, namely c and d."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 1, "creation_date": 1435655982, "post_id": 31123082, "comment_id": 50279384, "body": "@nclark &quot;If the Hask objects are types, then you have to establish equality by comparing Haskell types, not values... don&#39;t you?&quot; No, you don&#39;t. Arrows are their own kind of thing, distinct from objects, and can have their own equalities and disequalities. One way you could imagine <i>defining</i> equality on arrows is to say they take equal arguments to equal results (though one would likely have to be careful of a few technical details). One could <i>alternately</i> choose to define arrow equality by making all equally-typed arrows equal, but the resulting category would be too boring."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 12, "last_activity_date": 1435603075, "creation_date": 1435603075, "answer_id": 31123082, "question_id": 31122882, "link": "https://stackoverflow.com/questions/31122882/what-is-the-category-theoretical-basis-for-the-requirement-that-the-haskell-id/31123082#31123082", "title": "What is the category-theoretical basis for the requirement that the Haskell &quot;id&quot; function must return the same value as passed in?", "body": "<p>I'm not sure I really understood the point of your question.</p>\n\n<p>But identity in categories must satisfy</p>\n\n<pre><code>id . f = f\ng . id = g\n</code></pre>\n\n<p>for any <code>f,g</code> of the correct types. So <code>id</code> is not just any random function <code>A -&gt; A</code>, it is the one satisfying the requirements above.</p>\n\n<p>Note that, in Hask, we have that for any value <code>a :: A</code></p>\n\n<pre><code>id . (const a) = const a\n</code></pre>\n\n<p>hence</p>\n\n<pre><code>id (const a ()) = const a ()\n</code></pre>\n\n<p>hence</p>\n\n<pre><code>id a = a\n</code></pre>\n\n<p>So <code>id</code> is really what we expect.</p>\n"}, {"comments": [{"owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 0, "creation_date": 1435626486, "post_id": 31127058, "comment_id": 50268105, "body": "So equality of morphisms is a concept that category theory depends on to define identity, but leaves it to the implementer of a given category (such as Hask) to define &quot;=&quot; in some way that works to achieve a given purpose? Given that, it now seems to me as if in category theory, equality of morphisms is this implied, vague thing for which I would have expected to see some kind of formalism - sort of like a &quot;typeclass&quot; which category theory invokes but provides no &quot;instance&quot; of. The &quot;instance&quot; Hask provides assures that id returns the value it accepts. Am I on the right track at all here?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 1, "creation_date": 1435631334, "post_id": 31127058, "comment_id": 50269173, "body": "@nclark If category theory defined mophism equality in detail, you wouldn&#39;t be able to model as many things as categories. The entire point of category theory is to say that a category is <i>any</i> collection of objects and morphisms, where morphisms can be composed, there is an identity morphism for every object, and the category laws hold. Any other properties of equality are deliberately left undefined, so theories of category theory cannot rely on other properties but are true regardless of what they are; exactly the same way as the idea of &quot;composition&quot; is left undefined."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "reply_to_user": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 0, "creation_date": 1435632282, "post_id": 31127058, "comment_id": 50269363, "body": "@nclark, I fear we may soon be speaking different languages, but from the standpoint of category theory, all that matters is that the collection of morphisms from one particular object to another forms a set. Then implicitly we can talk about what it means for one morphism to be equal to another, as elements of the set. In the case of Hask the way we would construct this set is first write down all the strings that represent functions from <code>A</code> to <code>B</code>, then form the quotient set where we identify two strings if they represent equal functions (in the sense described in my answer)."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 3, "last_activity_date": 1435619400, "creation_date": 1435619400, "answer_id": 31127058, "question_id": 31122882, "link": "https://stackoverflow.com/questions/31122882/what-is-the-category-theoretical-basis-for-the-requirement-that-the-haskell-id/31127058#31127058", "title": "What is the category-theoretical basis for the requirement that the Haskell &quot;id&quot; function must return the same value as passed in?", "body": "<p>It seems that you have several common misconceptions about the category Hask and categories in general, but maybe they all come down to the point</p>\n\n<blockquote>\n  <ol>\n  <li>In the <code>Hask</code> category, the Objects are Haskell types and the Morphisms are Haskell functions. Values play no role in <code>Hask</code>. </li>\n  </ol>\n</blockquote>\n\n<p>This doesn't really make sense. The morphisms in Hask are functions, and functions are values, so in that sense already values do play a role in Hask.</p>\n\n<p>Two morphisms f and g from A to B in Hask are equal if and only if the functions <code>f, g :: A -&gt; B</code> are equal, which in turn holds if and only if for every value <code>a :: A</code>, the values <code>f a</code> and <code>g a</code> are equal. So having expanded this definition, we see that values that are not necessarily functions (like <code>a :: A</code>) also have a certain role to play in Hask.</p>\n\n<p>The unital and associative axioms for Hask are equalities of functions in this sense, so they do very much have something to say about the value level!</p>\n\n<p>A priori, values of non-function type do not appear explicitly in the inventory of (objects, morphisms, identities, composition rules, unital and associative properties) that comprise the category Hask. But actually the value <code>a :: A</code> can be encoded in Hask as the morphism <code>const a :: () -&gt; A</code>, and different values <code>a :: A</code> correspond to different morphisms from () to A. This is the fact used in chi's computation showing that we have no other choice for the identity function on an object A in Hask besides the familiar <code>id :: A -&gt; A; id a = a</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 0, "creation_date": 1435625221, "post_id": 31127492, "comment_id": 50267817, "body": "I believe I understand how in fact Haskell behaves with respect to the category laws. But I I&#39;ve been imputing to category theory an incompatible notion of equality that is based on object identity, i.e. simply A == A but A != B, and that therefore any two morphisms that start and end on the same object are fundamentally equal. Instead should I assume that category theory states NOTHING about equality (equality of objects? equality of morphisms?), that it is defined solely in the context of a given category? I haven&#39;t seen that written down yet anywhere, but I can certainly conceptualize it..."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 0, "creation_date": 1435627434, "post_id": 31127492, "comment_id": 50268333, "body": "@nclark Basically for objects, A == A and A != B, and <i>also for morphisms</i> f == f and f != g. But there&#39;s nothing that says if two morphisms have the same domain and codomain then they must be the same morphism; that&#39;s an additional assumption you&#39;re making, which doesn&#39;t have to follow."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 4, "creation_date": 1435628462, "post_id": 31127492, "comment_id": 50268563, "body": "@nclark Actually category theory <i>does</i> say more about equality of morphisms, but only what&#39;s contained on the category laws: <code>id . f = f</code>, <code>f . id = f</code>, and <code>f . (g . h) = (f . g) . h</code>. But your idea that two morphisms are interchangeable if they are between the same objects does not follow (and is not generally true, though it could be for some specific categories)."}, {"owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "edited": false, "score": 0, "creation_date": 1435677161, "post_id": 31127492, "comment_id": 50294766, "body": "All your answers are excellent, thank you all so much! My lack of SO mojo prevents me from meaningful upvotes. Though all are quite useful and relevant, @Ben gave the answer that came closest to the heart of my misconception of morphism identity / equality. Now back to work: I have to rebuild my understanding category theory! (Shouldn&#39;t be too hard, I haven&#39;t learned that much yet.)"}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": true, "score": 6, "last_activity_date": 1435632931, "last_edit_date": 1435632931, "creation_date": 1435622758, "answer_id": 31127492, "question_id": 31122882, "link": "https://stackoverflow.com/questions/31122882/what-is-the-category-theoretical-basis-for-the-requirement-that-the-haskell-id/31127492#31127492", "title": "What is the category-theoretical basis for the requirement that the Haskell &quot;id&quot; function must return the same value as passed in?", "body": "<p><code>id</code> is supposed to be the identity morphism for any given Haskell type. The identify morphism for a type A in <strong>Hask</strong> is a function of type <code>A -&gt; A</code>, but it's not just <em>any</em> function of type <code>A -&gt; A</code>; it has to obey the category laws.</p>\n\n<p>In particular, it must be a left and right identity for composition with morphisms to/from the object A. If <code>idA</code> is the identify morphism for the object A, this means for <em>any</em> object B and morphism <code>f :: A -&gt; B</code>, <code>f . idA</code> must be exactly the same as <code>f</code>, and for any object C and morphism <code>g :: C -&gt; A</code>, <code>ifA . g</code> must be exactly the same as <code>g</code>.</p>\n\n<p>We can test your claim that any function of type <code>A -&gt; A</code> can be A's identity, by picking a concrete case. Lets take take <code>(+1) :: Integer -&gt; Integer</code> as the identity for Integer, and consider the function <code>(*2) :: Integer -&gt; Integer</code>. Now obviously <code>(*2) . (+1)</code>, <code>(+1) . (*2)</code>, and just <code>(*2)</code> are all the same, so we've shown - oh wait, those are not the same function at all.</p>\n\n<p>Note I have <em>not</em> brought in equality of Haskell values here. I'm talking about equality of the morphisms in the <strong>Hask</strong> category; and equality of morphisms most certainly <em>is</em> within the domain of category theory, since without it the category laws about the identity morphism are meaningless.</p>\n\n<p>A key point which I was confused about at one point is that although it doesn't make sense to consider two different <em>objects</em> with the same type (since the objects <em>are</em> types when we're talking about <strong>Hask</strong>), you <em>can</em> have two different <em>morphisms</em> with the same type. Category theory <strong>does</strong> allow there to be several different morphisms between two objects A and B (and does allow there to be morphisms from an object to itself which are <em>not</em> identity morphisms, and are distinguished from each other). Morphisms are not purely defined by their \"endpoints\".</p>\n\n<p>The identity laws are actually pretty strict requirements, and should heavily hint that not just any old <code>A -&gt; A</code> function will do for <code>idA</code>. There's a clear intuition that to be able to compose with arbitrary other morphisms without changing them, the identity morphism needs to \"do nothing\" (whatever that means for the category in question).</p>\n\n<p>In <strong>Hask</strong> where we know morphisms are functions, there's a pretty obvious interpretation of \"do nothing\"; the function that just returns its input. It should be clear that this <em>does</em> work for the category laws:</p>\n\n<pre><code>f . id = f\nid . f = f\n</code></pre>\n\n<p>And also, if a proposed identity morphism that does anything <em>other</em> than return its input unchanged (there exists some <code>x</code> such that <code>badId x</code> is not <code>x</code>), then you can disprove the category laws by trying to compose with <code>id</code>!</p>\n\n<pre><code>(badId . id) x\nbadId (id x)\nbadId x\n</code></pre>\n\n<p><code>badId x</code> is not <code>x</code>, by assumption, so <code>badId . id</code> can't be equal to <code>id</code> (which is defined by <code>id x = x</code>). So <code>badId</code> isn't a left identity for composition.</p>\n"}], "owner": {"reputation": 955, "user_id": 817658, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9a03bfe9e020bce25a7fac210bdeff84?s=128&d=identicon&r=PG", "display_name": "nclark", "link": "https://stackoverflow.com/users/817658/nclark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 507, "favorite_count": 0, "accepted_answer_id": 31127492, "answer_count": 3, "score": 4, "last_activity_date": 1435632931, "creation_date": 1435602326, "last_edit_date": 1495535352, "question_id": 31122882, "link": "https://stackoverflow.com/questions/31122882/what-is-the-category-theoretical-basis-for-the-requirement-that-the-haskell-id", "title": "What is the category-theoretical basis for the requirement that the Haskell &quot;id&quot; function must return the same value as passed in?", "body": "<p>How can the following all be true?</p>\n\n<ol>\n<li>In the <code>Hask</code> category, the Objects are Haskell types and the\nMorphisms are Haskell functions. Values play no role in <code>Hask</code>. </li>\n<li>The identity Morphism is defined as an arrow originating at an Object <code>A</code> and terminating at the same Object <code>A</code>.</li>\n<li>The role of the identity Morphism is played by the Haskell <code>id</code> function.</li>\n<li>The value returned from the Haskell <code>id</code> function must be identical to\nthe value of the argument passed in.</li>\n</ol>\n\n<p>If the identity morphism is defined in category theory as an arrow from an Object A back to the same Object A, isn't that description satisfied by any and every Haskell function of type <code>f :: A -&gt; A</code> ?</p>\n\n<p>There is <a href=\"https://stackoverflow.com/a/21485660\">another question</a> whose answers might also perhaps cover this topic, but they seem to assume a level of familiarity with category theory that I unfortunately do not possess.</p>\n\n<p>This seems to me a very basic beginner-level question. So can someone supply an answer using only language, symbols and notional constructs that a beginner can understand?</p>\n"}, {"tags": ["haskell", "vim"], "comments": [{"owner": {"reputation": 11096, "user_id": 541208, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2dfc2e563d2150994a6e06ef37f9e7be?s=128&d=identicon&r=PG", "display_name": "TankorSmash", "link": "https://stackoverflow.com/users/541208/tankorsmash"}, "edited": false, "score": 0, "creation_date": 1435599806, "post_id": 31121764, "comment_id": 50256904, "body": "Consider moving this to the new vim SE."}], "answers": [{"tags": [], "owner": {"reputation": 39152, "user_id": 438329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4b5b093781b8d97da6b9c21cf2706d7?s=128&d=identicon&r=PG", "display_name": "Peter Rincker", "link": "https://stackoverflow.com/users/438329/peter-rincker"}, "is_accepted": false, "score": 1, "last_activity_date": 1435603992, "creation_date": 1435603992, "answer_id": 31123334, "question_id": 31121764, "link": "https://stackoverflow.com/questions/31121764/vim-begin-insert-on-new-line-in-same-column-as-cursor/31123334#31123334", "title": "Vim: Begin insert on new line in same column as cursor", "body": "<p>I use the vim plugin <a href=\"https://github.com/godlygeek/tabular\" rel=\"nofollow\">tabular</a> to do alignment. There are other plugins like <a href=\"http://www.vim.org/scripts/script.php?script_id=294\" rel=\"nofollow\">Align.vim</a> and <a href=\"https://github.com/junegunn/vim-easy-align\" rel=\"nofollow\">vim-easy-align</a> as well.</p>\n\n<p>If you want to do automatic alignment then add the following to <code>~/.vim/after/ftplugin/haskell.vim</code>:</p>\n\n<pre><code>inoremap &lt;silent&gt; &lt;buffer&gt; &lt;bar&gt; &lt;bar&gt;&lt;esc&gt;:call &lt;SID&gt;align()&lt;cr&gt;a\nfunction! s:align()\n  if exists(':Tabularize') &amp;&amp; line('.') &gt; 1 &amp;&amp; getline(line('.') - 1) =~ '|' &amp;&amp; getline('.')[0:col('.')] =~ '^\\s*|$'\n    if getline(line('.') - 1) =~ '^\\s*|'\n      Tabularize/^\\s*\\zs|/\n    else\n      Tabularize/^[^|]*\\zs|/\n    endif\n    normal! 0f|\n  endif\nendfunction\n</code></pre>\n\n<p>This will align your guards in insert mode on the fly. It requires the tabular plugin. It is based off of Tim Pope's <a href=\"https://gist.github.com/tpope/287147\" rel=\"nofollow\">cucumbertables.vim gist</a>.</p>\n\n<p>For more help with tabular.vim see the following <a href=\"http://vimcasts.org/\" rel=\"nofollow\">Vimcasts</a> episode: <a href=\"http://vimcasts.org/episodes/aligning-text-with-tabular-vim/\" rel=\"nofollow\">Aligning text with Tabular.vim</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 2, "last_activity_date": 1435604629, "last_edit_date": 1490005097, "creation_date": 1435604629, "answer_id": 31123508, "question_id": 31121764, "link": "https://stackoverflow.com/questions/31121764/vim-begin-insert-on-new-line-in-same-column-as-cursor/31123508#31123508", "title": "Vim: Begin insert on new line in same column as cursor", "body": "<p>I posted a very similar question on Superuser some time ago:</p>\n\n<blockquote>\n  <p><a href=\"https://superuser.com/q/685828/162491\">How to align the cursor under a specific character?</a></p>\n</blockquote>\n\n<p>There is another solution though, that I somewhat prefer: The problem with this style of alignment is that if you change the name of the function, the names of the variables etc., you need to change the indentation of the whole block, which is troublesome especially when sending patches to version controlled projects etc. An alternative is to add new-lines and just one step indentation as in</p>\n\n<pre><code>powMod a p m\n    | odd p = (a * powMod asq halfp m) `polyMod` m\n    | otherwise = powMod asq halfp m\n  where\n    halfp = p `div` 2\n    asq = (a*a) `polyMod` m\n</code></pre>\n\n<p>And if the patterns themselves get too complex, like when using <a href=\"https://wiki.haskell.org/Pattern_guard\" rel=\"nofollow noreferrer\">pattern guards</a>, the equations can be again indented, as in</p>\n\n<pre><code>powMod a p m\n    | odd p -- some very long pattern\n      = (a * powMod asq halfp m) `polyMod` m\n    | otherwise\n      = powMod asq halfp m\n  ...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "is_accepted": true, "score": 3, "last_activity_date": 1435606578, "creation_date": 1435606578, "answer_id": 31124103, "question_id": 31121764, "link": "https://stackoverflow.com/questions/31121764/vim-begin-insert-on-new-line-in-same-column-as-cursor/31124103#31124103", "title": "Vim: Begin insert on new line in same column as cursor", "body": "<p>To answer your exact question </p>\n\n<blockquote>\n  <p>I would prefer to position my cursor over the first '|' (with 'F|' or something similar), then do something simple to open a new line and start inserting at the same column</p>\n</blockquote>\n\n<p>You can set <code>virtualedit</code>. This allows you to move the cursor everywhere regardless you reached the end of a line or not (I can't live without it now). This way, once you are on the <code>|</code> you just need to press <code>ji</code> (go down and start inserting). </p>\n\n<p>Once you've done this, using <code>autoindent</code> make each newline start at the same indentation as the previous line.</p>\n\n<p>Another way is to use virtual block <code>Ctrl-V</code> , go down a few lines and press <code>r|</code>. This will draw a vertical line of <code>|</code>.</p>\n"}], "owner": {"reputation": 4565, "user_id": 1134885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c428466054762cf7d4b5fb5f4396fa2?s=128&d=identicon&r=PG", "display_name": "NovaDenizen", "link": "https://stackoverflow.com/users/1134885/novadenizen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 587, "favorite_count": 1, "accepted_answer_id": 31124103, "answer_count": 3, "score": 2, "last_activity_date": 1435606578, "creation_date": 1435598377, "question_id": 31121764, "link": "https://stackoverflow.com/questions/31121764/vim-begin-insert-on-new-line-in-same-column-as-cursor", "title": "Vim: Begin insert on new line in same column as cursor", "body": "<p>Haskell has a language feature called guards that look like this (starting with the '<code>|</code>'):</p>\n\n<pre><code>powMod a p m | odd p = (a * powMod asq halfp m) `polyMod` m\n             | otherwise = powMod asq halfp m\n    where\n        halfp = p `div` 2\n        asq = (a*a) `polyMod` m\n</code></pre>\n\n<p>Proper style requires that you keep the guards in multiple lines aligned with each other.  When I'm typing source code, I tend to enter the first line of a function definition with a guard, hit enter, then messily <code>tab</code>, <code>space</code>, and <code>backspace</code> my way around until I get the cursor aligned under the first '<code>|</code>'.  I would prefer to position my cursor over the first '<code>|</code>' (with '<code>F|</code>' or something similar), then do something simple to open a new line and start inserting at the same column, without autoindent forcing the cursor to retreat to the left margin and without any messy manual alignment.</p>\n\n<p>What is this simple thing I need to do to begin an insert on the next line in the same column?</p>\n"}, {"tags": ["list", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": true, "score": 7, "last_activity_date": 1435651987, "last_edit_date": 1435651987, "creation_date": 1435598118, "answer_id": 31121692, "question_id": 31121640, "link": "https://stackoverflow.com/questions/31121640/pass-multiple-arguments-to-maps-func-argument/31121692#31121692", "title": "Pass multiple arguments to map&#39;s func argument", "body": "<h2>using sections</h2>\n\n<p>you can use a <em>section</em> like this:</p>\n\n<pre><code>Prelude&gt; let func x y = x / y\nPrelude&gt; map (`func` 2) [2,4,6,8]\n[1.0,2.0,3.0,4.0]\n</code></pre>\n\n<p>see when you write a function in <em>backticks</em> you make it into an operator - then you can plug in values to the left or to the right to (for <code>x</code> or <code>y</code> here).</p>\n\n<p>If you wanted to substitute for <code>x</code> then you could have used <em>normal</em> partial application as well:</p>\n\n<pre><code>Prelude&gt; map (func 24) [2,4,6,8]\n[12.0,6.0,4.0,3.0]\n</code></pre>\n\n<p>which is the same as</p>\n\n<pre><code>Prelude&gt; map (24 `func`) [2,4,6,8]\n[12.0,6.0,4.0,3.0]\n</code></pre>\n\n<h2>using a lambda</h2>\n\n<p>of course if you don't like this at all you can always use lambda's:</p>\n\n<pre><code>Prelude&gt; map (\\x -&gt; func x 2) [2,4,6,8]\n[1.0,2.0,3.0,4.0]\n</code></pre>\n\n<h2>using list-comprehension</h2>\n\n<p>or you can do the same as you did in Python (use a list comprehension):</p>\n\n<pre><code>Prelude&gt; [ func x 2 | x &lt;- [2,4,6,8] ]\n[1.0,2.0,3.0,4.0]\n</code></pre>\n\n<p>ok I think right now I can think of no other (easy) ones ;)</p>\n\n<h2>using partial application with <code>flip</code></h2>\n\n<p><code>flip</code> and partial application (I think a bit less readable - but I find it kind of funny ;):</p>\n\n<pre><code>Prelude&gt; map (flip f 2) [2,4,6,8]\n[1.0,2.0,3.0,4.0]\n</code></pre>\n\n<h2>remark / <code>div</code></h2>\n\n<p>as you only dealt with <code>Int</code>s here you probably would want to use <code>div</code> instead of <code>(/)</code>:</p>\n\n<pre><code>Prelude&gt; map (`div` 2) [2,4,6,8]\n[1,2,3,4]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1720, "favorite_count": 0, "accepted_answer_id": 31121692, "answer_count": 1, "score": 3, "last_activity_date": 1435651987, "creation_date": 1435597943, "last_edit_date": 1435598268, "question_id": 31121640, "link": "https://stackoverflow.com/questions/31121640/pass-multiple-arguments-to-maps-func-argument", "title": "Pass multiple arguments to map&#39;s func argument", "body": "<p>In python,\n  with list comprehension, i can pass multiple arguments to a map function's function argument as,</p>\n\n<pre><code>  const = 2 \n  def divide(x,y):\n    return x/y\n  [divide(x, const) for x in [2,4,6,8]]\n</code></pre>\n\n<p>How can i do the same in haskell using map function?</p>\n\n<p>Something like this,</p>\n\n<pre><code>func x y = x/y\n\nmap (func x 2) [2 4 6 8]\n</code></pre>\n\n<p>I think, it can be done using function currying, but not sure about the correct way?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 2429, "user_id": 3158020, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/NynOQ.jpg?s=128&g=1", "display_name": "Roman Mik", "link": "https://stackoverflow.com/users/3158020/roman-mik"}, "edited": false, "score": 2, "creation_date": 1435596320, "post_id": 31121102, "comment_id": 50255019, "body": "this is not a question"}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 2429, "user_id": 3158020, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/NynOQ.jpg?s=128&g=1", "display_name": "Roman Mik", "link": "https://stackoverflow.com/users/3158020/roman-mik"}, "edited": false, "score": 1, "creation_date": 1435598954, "post_id": 31121102, "comment_id": 50256427, "body": "@RomanMik while yes it is not technical a question from the SO-book it might be usefull for other Haskell beginners trying to use those as well, and Balaji seems to just have joined here - so please keep it friendly and explain the problem (I am a really glad that the Haskell tag here still is :D - no need to get to the point where C# and co are)"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5062200, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jZteM14fZqw/AAAAAAAAAAI/AAAAAAAABtc/VnDveszQlcU/photo.jpg?sz=128", "display_name": "Balaji G", "link": "https://stackoverflow.com/users/5062200/balaji-g"}, "edited": false, "score": 1, "creation_date": 1435676223, "post_id": 31121557, "comment_id": 50294082, "body": "Thank you for your suggestion.I tried to get it work as you have suggested and it started to build. Cabal reported an error when it was downloading package hint. A similar issue was also reported here <a href=\"https://github.com/HaskVan/HaskellKoans/issues/9\" rel=\"nofollow noreferrer\">github.com/HaskVan/HaskellKoans/issues/9</a>."}], "tags": [], "owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "is_accepted": false, "score": 1, "last_activity_date": 1435597689, "creation_date": 1435597689, "answer_id": 31121557, "question_id": 31121102, "link": "https://stackoverflow.com/questions/31121102/install-haskell-koans-on-windows/31121557#31121557", "title": "Install haskell koans on windows", "body": "<p>If you look at the top of <a href=\"https://github.com/HaskVan/HaskellKoans/blob/master/bin/setup-koans\" rel=\"nofollow\"><code>setup-koans</code></a>, you'll see:</p>\n\n<pre><code>#!/usr/bin/env runhaskell\nimport Control.Monad (unless)\n...etc\n</code></pre>\n\n<p>That first line with the <a href=\"https://en.wikipedia.org/wiki/Shebang_(Unix)\" rel=\"nofollow\">hashbang</a> indicates that a unix shell running this file as a program should pass everything that follows (the haskell source file, in this case) to the command specified (<code>/usr/bin/env runhaskell</code> in this case).</p>\n\n<p>If you have a GHC installation, and <code>runghc</code> in your path, you should be able to remove that line and do <code>runghc setup-koans</code>.</p>\n\n<p>You might also like to play with cygwin, or with a linux virtual machine (e.g. in docker) to familiarize yourself with this sort of thing.</p>\n"}], "owner": {"reputation": 11, "user_id": 5062200, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-jZteM14fZqw/AAAAAAAAAAI/AAAAAAAABtc/VnDveszQlcU/photo.jpg?sz=128", "display_name": "Balaji G", "link": "https://stackoverflow.com/users/5062200/balaji-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1435597689, "creation_date": 1435596167, "question_id": 31121102, "link": "https://stackoverflow.com/questions/31121102/install-haskell-koans-on-windows", "title": "Install haskell koans on windows", "body": "<p>I am trying to learn haskell using haskell koans <a href=\"https://github.com/HaskVan/HaskellKoans\" rel=\"nofollow\">https://github.com/HaskVan/HaskellKoans</a>. The installation instructions found is not working and they look presumably for linux. I need help to get the koans working on windows.</p>\n"}, {"tags": ["haskell", "category-abstractions"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1435590259, "post_id": 31118949, "comment_id": 50251271, "body": "Check the <code>ArrowApply</code> typeclass at <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base/Control-Arrow.html\" rel=\"nofollow noreferrer\">downloads.haskell.org/~ghc/latest/docs/html/libraries/base/&hellip;</a>"}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1435590452, "post_id": 31118949, "comment_id": 50251422, "body": "@AJFarmar <code>ArrowApply</code> is equivalent to <code>Monad</code>"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1435614341, "post_id": 31118949, "comment_id": 50264633, "body": "You may also like to look into <a href=\"https://en.wikipedia.org/wiki/Cartesian_closed_category\" rel=\"nofollow noreferrer\">cartesian closed categories</a>, which are those categories that have an &quot;application&quot; operation (and a few other supporting constructs)."}, {"owner": {"reputation": 4530, "user_id": 94687, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/ef249e4381c9d55297cddc4bd5b5c3c2?s=128&d=identicon&r=PG", "display_name": "imz -- Ivan Zakharyaschev", "link": "https://stackoverflow.com/users/94687/imz-ivan-zakharyaschev"}, "edited": false, "score": 0, "creation_date": 1436134899, "post_id": 31118949, "comment_id": 50469725, "body": "A similar question (with the same usage example: invertible functions) has been discussed at <a href=\"http://programmers.stackexchange.com/q/215497/11591\">Why isn&#39;t there a typeclass for functions?</a>."}], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 6, "last_activity_date": 1435591877, "last_edit_date": 1495540694, "creation_date": 1435591877, "answer_id": 31119720, "question_id": 31118949, "link": "https://stackoverflow.com/questions/31118949/generalising-like-control-category-generalises/31119720#31119720", "title": "Generalising ($) like Control.Category generalises (.)", "body": "<p>There are two abstractions used for things like this in Haskell, one usings <code>Arrow</code>s and the other <code>Applicative</code>s. Both can be broken down into smaller parts than those used in <code>base</code>.</p>\n\n<hr>\n\n<p>If you go in the <code>Arrow</code> direction and <a href=\"https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0CB8QFjAA&amp;url=http%3A%2F%2Farxiv.org%2Fabs%2F1007.2885&amp;ei=52KRVaLWAoTwoASV44OYCA&amp;usg=AFQjCNF7TMVyJnsjsrNguJGMYjCIYaBXRw&amp;sig2=uB6vQrlIINYTTpim5p5CAA\" rel=\"nofollow noreferrer\">break down the capabilities of <code>Arrow</code>s into component pieces</a>, you'd have a separate class for those arrows that are able to lift arbitrary functions into the arrow.</p>\n\n<pre><code>class ArrowArr a where\n    arr :: (b -&gt; c) -&gt; a b c\n</code></pre>\n\n<p>This would be the opposite of <code>ArrowArr</code>, arrows where any arbitrary arrow can be dropped to a function.</p>\n\n<pre><code>class ArrowFun a where\n    ($) :: a b c -&gt; (b -&gt; c)\n</code></pre>\n\n<p>If you just split <code>arr</code> off of <code>Arrow</code> you are left with <a href=\"https://stackoverflow.com/a/27387931/414413\">arrow like categories that can construct and deconstruct tuples</a>.</p>\n\n<pre><code>class Category a =&gt; ArrowLike a where\n    fst   :: a (b, d) b\n    snd   :: a (d, b) b\n    (&amp;&amp;&amp;) :: a b c -&gt; a b c' -&gt; a b (c,c')\n</code></pre>\n\n<hr>\n\n<p>If you go in the <code>Applicative</code> direction this is a <a href=\"https://hackage.haskell.org/package/pointed-2.0.2/docs/Data-Copointed.html\" rel=\"nofollow noreferrer\"><code>Copointed</code></a> \"<code>Applicative</code> without <code>pure</code>\" (which goes by the name <a href=\"https://hackage.haskell.org/package/semigroupoids-5.0.0.2/docs/Data-Functor-Apply.html#t:Apply\" rel=\"nofollow noreferrer\"><code>Apply</code></a>). </p>\n\n<pre><code>class Copointed p where Source\n    copoint :: p a -&gt; a\n\nclass Functor f =&gt; Apply f where\n  (&lt;.&gt;) :: f (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>When you go this way you typically drop the <code>Category</code> for functions and instead have a type constructor <code>C a</code> representing values (including function values) constructed according to a certain set of rules.</p>\n"}, {"comments": [{"owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "edited": false, "score": 0, "creation_date": 1435632002, "post_id": 31120454, "comment_id": 50269309, "body": "I&#39;m a bit confused. Can you add an instance for &#39;WellPointed&#39;?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1435669593, "post_id": 31120454, "comment_id": 50288754, "body": "May I recommend using &quot;final&quot; instead of &quot;terminal&quot;? The meaning of the latter depends on who&#39;s writing it."}, {"owner": {"reputation": 1672, "user_id": 11143763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HWExJ.png?s=128&g=1", "display_name": "Zhiltsoff Igor", "link": "https://stackoverflow.com/users/11143763/zhiltsoff-igor"}, "edited": false, "score": 0, "creation_date": 1595775369, "post_id": 31120454, "comment_id": 111584642, "body": "What are the fors and againsts of making <code>WellPointed</code> <code>Category</code>&#39;s direct subclass? Why wasn&#39;t it chosen for <code>Control.Arrow.Constrained</code>? <a href=\"https://stackoverflow.com/questions/63060108/wellpointed-for-dual-to-prearrow-class\">Related.</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 1672, "user_id": 11143763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HWExJ.png?s=128&g=1", "display_name": "Zhiltsoff Igor", "link": "https://stackoverflow.com/users/11143763/zhiltsoff-igor"}, "edited": false, "score": 1, "creation_date": 1595777009, "post_id": 31120454, "comment_id": 111585209, "body": "@ZhiltsoffIgor you mean why is it currently <code>PreArrow a =&gt; WellPointed a</code> instead of <code>Category a =&gt; WellPointed a</code>? Well, I kind of started from the view to cartesian closed categories and ravelled it up. But you&#39;re right, mathematically it would actually be nicer to put <code>WellPointed</code> higher in the hierarchy, separate from the <code>Cartesian</code> branch, and have a dedicated <code>class (PreArrow a, WellPointed a, UnitObject a ~ Terminal a) =&gt; CartesianClosed a</code>, though I may be overlooking some practical issue right now. \u2014 If you would like that changed, feel free to file a pull request."}, {"owner": {"reputation": 1672, "user_id": 11143763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HWExJ.png?s=128&g=1", "display_name": "Zhiltsoff Igor", "link": "https://stackoverflow.com/users/11143763/zhiltsoff-igor"}, "edited": false, "score": 0, "creation_date": 1595777930, "post_id": 31120454, "comment_id": 111585521, "body": "@leftaroundabout truth be told, I feel a bit lost. Haven&#39;t we got <code>Control.Category.Constrained.Curry</code> for cartesian closed categories (<a href=\"https://stackoverflow.com/questions/62994618/why-is-it-fair-to-think-of-just-locally-small-cartesian-closed-categories-in-has\">at least locally small ones</a>)? I guess cartesian closed categories could be written down in Haskell different ways, yet <code>Curry</code> always felt very neat. Or am I missing the point of some the classes?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1595778362, "post_id": 31120454, "comment_id": 111585665, "body": "Ah yes, <code>Curry</code>. It is rather me that&#39;s lost, not you! I think that&#39;s the reason why I made no class actually named <code>CartesianClosed</code>: I couldn&#39;t decide where to put it in the hierarchy. \u2014 Goes to show the problems you get when kind of balancing between <i>keeping it close to the <code>base.Arrow</code> hierarchy</i> and <i>making it proper mathematically category theory</i>."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 12, "last_activity_date": 1435669097, "last_edit_date": 1435669097, "creation_date": 1435594000, "answer_id": 31120454, "question_id": 31118949, "link": "https://stackoverflow.com/questions/31118949/generalising-like-control-category-generalises/31120454#31120454", "title": "Generalising ($) like Control.Category generalises (.)", "body": "<p><code>$</code> applies morphisms to <em>values</em>. The concept of a value seems trivial, but actually, general categories need to have no such notion. Morphisms are values (arrow-values... whatever), but objects (types) needn't actually contain any elements.</p>\n\n<p>However, in many categories, there is a special object, the <a href=\"https://en.wikipedia.org/wiki/Initial_and_terminal_objects\">terminal object</a>. In <strong>Hask</strong>, this is the <code>()</code> type. You'll notice that functions <code>() -&gt; a</code> are basically equivalent to <code>a</code> values themselves. Categories in which this works are called <a href=\"https://en.wikipedia.org/wiki/Well-pointed_category\">well-pointed</a>. So really, the fundamental thing you need for something like <code>$</code> to make sense is</p>\n\n<pre><code>class Category c =&gt; WellPointed c where\n  type Terminal c :: *\n  point :: a -&gt; Terminal c `c` a\n  unpoint :: Terminal c `c` a -&gt; a\n</code></pre>\n\n<p>Then you can define the application operator by</p>\n\n<pre><code>($) :: WellPointed c =&gt; c a b -&gt; a -&gt; b\nf $ p = unpoint $ f . point p\n</code></pre>\n\n<hr>\n\n<p>The obvious instance for <code>WellPointed</code> is of course <strong>Hask</strong> itself:</p>\n\n<pre><code>instance WellPointed (-&gt;) where\n  type Terminal c = ()\n--point :: a -&gt; () -&gt; a\n  point a () = a\n--unpoint :: (() -&gt; a) -&gt; a\n  unpoint f = f ()\n</code></pre>\n\n<p>The other well-known category, <code>Kleisli</code>, is <em>not</em> an instance of <code>WellPointed</code> as I wrote it (it allows <code>point</code>, but not <code>unpoint</code>). But there are plenty of categories which would make for a good <code>WellPointed</code> instance, if they could properly be implemented in Haskell at all. Basically, all the categories of mathematical functions with particular properties (<a href=\"https://en.wikipedia.org/wiki/Category_of_modules#Example:_the_category_of_vector_spaces\"><strong>Lin<sub><em>K</em></sub></strong></a>, <a href=\"https://en.wikipedia.org/wiki/Category_of_groups\"><strong>Grp</strong></a>, <a href=\"https://en.wikipedia.org/wiki/Pointed_space\">{{&bullet;}, <strong>Top</strong>}</a>...). The reason these aren't directly expressible as a <code>Category</code> is that they can't have any Haskell type as an object; newer category libraries like <a href=\"http://hackage.haskell.org/package/categories\">categories</a> or <a href=\"http://hackage.haskell.org/package/constrained-categories\">constrained-categories</a> do allow this. For instance, <a href=\"https://github.com/leftaroundabout/manifolds/blob/5e191c413d9facd18bb5c72fd850b08e0c96cf7c/manifolds/Data/Manifold/PseudoAffine.hs#L435\">I have implemented this</a>:</p>\n\n<pre><code>instance (MetricScalar s) =&gt; WellPointed (Differentiable s) where\n  unit = Tagged Origin\n  globalElement x = Differentiable $ \\Origin -&gt; (x, zeroV, const zeroV)\n  const x = Differentiable $ \\_ -&gt; (x, zeroV, const zeroV)\n</code></pre>\n\n<p>As you see, <a href=\"http://hackage.haskell.org/package/constrained-categories-0.2.0.0/docs/Control-Arrow-Constrained.html#t:WellPointed\">the class interface</a> is actually a bit different from what I wrote above. There isn't one universally accepted way of implementing such stuff in Haskell yet... in <code>constrained-categories</code>, the <code>$</code> operator actually works more like what Cirdec described.</p>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 1, "accepted_answer_id": 31119720, "answer_count": 2, "score": 8, "last_activity_date": 1559483950, "creation_date": 1435589826, "last_edit_date": 1559483950, "question_id": 31118949, "link": "https://stackoverflow.com/questions/31118949/generalising-like-control-category-generalises", "title": "Generalising ($) like Control.Category generalises (.)", "body": "<p>I had a thought to generalise <code>($)</code> like <code>Control.Category</code> generalises <code>(.)</code>, and I've done so with the code at the end of this post (<a href=\"https://ideone.com/Uc1398\" rel=\"noreferrer\">also ideone</a>).</p>\n\n<p>In this code I've created a class called <code>FunctionObject</code>. This class has a function <code>($)</code> with the following signature:</p>\n\n<pre><code>($) :: f a b -&gt; a -&gt; b\n</code></pre>\n\n<p>Naturally I make <code>(-&gt;)</code> an instance of this class so <code>$</code> continues to work with ordinary functions.</p>\n\n<p>But this allows you to make special functions that, for example, know their own inverse, as the example below shows.</p>\n\n<p>I've concluded there's one of three possibilities:</p>\n\n<ol>\n<li>I'm the first to think of it.</li>\n<li>Someone else has already done it and I'm reinventing the wheel.</li>\n<li>It's a bad idea.</li>\n</ol>\n\n<p>Option 1 seems unlikely, and my searches on <a href=\"http://hayoo.fh-wedel.de/\" rel=\"noreferrer\">hayoo</a> didn't reveal option 2, so I suspect option 3 is most likely, but if someone could explain why that is it would be good.</p>\n\n<pre><code>import Prelude hiding ((.), ($))\nimport Control.Category ((.), Category)\n\nclass FunctionObject f where\n  ($) :: f a b -&gt; a -&gt; b\n\ninfixr 0 $\n\ninstance FunctionObject (-&gt;) where\n  f $ x = f x\n\ndata InvertibleFunction a b = \n   InvertibleFunction (a -&gt; b) (b -&gt; a)\n\ninstance Category InvertibleFunction where\n  (InvertibleFunction f f') . (InvertibleFunction g g') =\n    InvertibleFunction (f . g) (g' . f')\n\ninstance FunctionObject InvertibleFunction where\n  (InvertibleFunction f _) $ x = f $ x\n\ninverse (InvertibleFunction f f') = InvertibleFunction f' f\n\nadd :: (Num n) =&gt; n -&gt; InvertibleFunction n n\nadd n = InvertibleFunction (+n) (subtract n)\n\nmain = do\n  print $ add 2 $ 5 -- 7\n  print $ inverse (add 2) $ 5 -- 3\n</code></pre>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1435581200, "post_id": 31115506, "comment_id": 50244842, "body": "<code>ParsecT</code> and <code>Parsec</code> are defined and explained in the <code>Text.Parsec.Prim</code> module. Have a look at it on <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Prim.html\" rel=\"nofollow noreferrer\">Hackage</a>."}], "answers": [{"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 8, "last_activity_date": 1441181648, "last_edit_date": 1592644375, "creation_date": 1435581870, "answer_id": 31116078, "question_id": 31115506, "link": "https://stackoverflow.com/questions/31115506/what-is-the-meaning-of-parsec-string-string-string/31116078#31116078", "title": "What is the meaning of Parsec String () (String,String)?", "body": "<h1><code>ParsecT</code> and <code>Parsec</code></h1>\n<p>In <code>parsec</code> 3, <code>ParsecT</code> and <code>Parsec</code> are defined and explained in the <a href=\"http://hackage.haskell.org/package/parsec-3.1.9/docs/Text-Parsec-Prim.html\" rel=\"nofollow noreferrer\"><code>Text.Parsec.Prim</code> module</a>:</p>\n<blockquote>\n<p><code>data ParsecT s u m a</code></p>\n<p><code>ParsecT s u m a</code> is a parser with stream type <code>s</code>, user state type <code>u</code>, underlying monad <code>m</code> and return type <code>a</code>.</p>\n</blockquote>\n<p>(Examples of stream types are <code>String</code>, <code>ByteString</code>, and <code>Text</code>.)</p>\n<p><code>Parsec</code> is simply  a version of <code>ParsecT</code> specialised to the <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Functor-Identity.html\" rel=\"nofollow noreferrer\"><code>Identity</code> monad</a>:</p>\n<blockquote>\n<p><code>type Parsec s u = ParsecT s u Identity</code></p>\n</blockquote>\n<h1>The signature of <code>myParser</code> explained</h1>\n<p>Going back to your type signature, in</p>\n<pre><code>myParser :: Parsec.Parsec String () (String,String)\n</code></pre>\n<ul>\n<li>the stream type is <code>String</code>;</li>\n<li>the user state is simply the empty tuple (also known as &quot;unit&quot;); in other words, <code>myParser</code> parses something but doesn't keep track of any useful state;</li>\n<li>the result type is a pair of <code>String</code>s.</li>\n</ul>\n<p>Moreover, the type signature uses <code>Parsec.Parsec</code> (and not simply <code>Parsec</code>) because, in <a href=\"http://unbui.lt/#!/post/haskell-parsec-basics\" rel=\"nofollow noreferrer\">the blogpost you link to</a>, <code>Text.Parsec</code> is imported <a href=\"https://wiki.haskell.org/Qualified_names\" rel=\"nofollow noreferrer\"><em>qualified</em></a> as <code>Parsec</code>.</p>\n<h1>The <code>Parser</code> type synonym</h1>\n<p>If all your parsers have stream type <code>String</code> and don't keep track of any state, you probably want to abstract some of that <code>parsec</code> complexity away. In that case, you should use the <code>Parser</code> type synonym, which the <code>Text.Parsec.String</code> module defines as</p>\n<pre><code>type Parser = Parsec String ()\n</code></pre>\n<p>For instance, with the following import</p>\n<pre><code>import Text.Parsec.String ( Parser )\n</code></pre>\n<p>you can simplify <code>myParser</code>'s type signature to</p>\n<pre><code>myParser :: Parser (String, String)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2879704"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 2, "accepted_answer_id": 31116078, "answer_count": 1, "score": 4, "last_activity_date": 1441181648, "creation_date": 1435580255, "last_edit_date": 1435585686, "question_id": 31115506, "link": "https://stackoverflow.com/questions/31115506/what-is-the-meaning-of-parsec-string-string-string", "title": "What is the meaning of Parsec String () (String,String)?", "body": "<p>I understand the <code>Parsec</code> modules' <code>parse</code> function, which takes a rule argument, an error message, and an input string:</p>\n\n<pre><code>parse rule text = Parsec.parse rule \"(source)\" text\n</code></pre>\n\n<p>However, I don't understand the meaning of <code>Parsec.Parsec</code>, or how it's different from <code>Parsec.ParsecT</code>. Why do type signatures of custom parsers use this name?</p>\n\n<p>For example, in the following code snippet taken from <a href=\"http://unbui.lt/#!/post/haskell-parsec-basics\" rel=\"nofollow\">this blogpost</a>,</p>\n\n<pre><code>myParser :: Parsec.Parsec String () (String,String)\nmyParser = do\n    letters &lt;- Parsec.many1 Parsec.letter\n    Parsec.spaces\n    digits &lt;- Parsec.many1 Parsec.digit\n    return (letters,digits)\n</code></pre>\n\n<p>what does <code>Parsec.Parsec</code> and <code>()</code> mean in <code>myParser</code>'s type signature?</p>\n"}, {"tags": ["haskell", "type-families", "overlapping-instances"], "answers": [{"comments": [{"owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "edited": false, "score": 1, "creation_date": 1435579223, "post_id": 31115029, "comment_id": 50243485, "body": "Thank you! It would indeed be nice to emit a warning &quot;you use a type variable of the same name, did you intend to add forall?&quot;."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "edited": false, "score": 0, "creation_date": 1435579510, "post_id": 31115029, "comment_id": 50243676, "body": "@ron I strongly concur. I&#39;d even go as far as changing the Haskell definition so that scoped type variables are enabled by default, with or without forall. This would break compatibility, but I really wonder how much this will break (my uninformed guess is very little)."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 4, "last_activity_date": 1435579311, "last_edit_date": 1435579311, "creation_date": 1435578884, "answer_id": 31115029, "question_id": 31114770, "link": "https://stackoverflow.com/questions/31114770/reason-for-overlapping-instances-error-when-not-quantifying-method-existentially/31115029#31115029", "title": "Reason for overlapping instances error when not quantifying method existentially", "body": "<p>This is how scoped type variables work in Haskell. Note that you are re-using <code>r</code> here:</p>\n\n<pre><code>go :: forall r a . (Typeable a, Typeable (D r)) =&gt; a -&gt; Proxy r -&gt; A\ngo a _ = case cast a of\n  Just (b :: D r) -&gt; A b  -- this r is the same as the r above\n</code></pre>\n\n<p>Without the explicit <code>forall</code>, type variables are interpreted to be local to the signature. That is, your code is read as:</p>\n\n<pre><code>go :: (Typeable a1, Typeable (D r1)) =&gt; a1 -&gt; Proxy r1 -&gt; A  -- renaming local variables\ngo a _ = case cast a of\n  Just (b :: D r) -&gt; A b   -- r bears no relation to r1\n</code></pre>\n\n<p>Hence the type error.</p>\n\n<p>(It <em>is</em> confusing to get an <code>Overlapping instances</code> error, though.)</p>\n"}], "owner": {"reputation": 9119, "user_id": 180258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8b3779ca7c73166d7016272086c6282f?s=128&d=identicon&r=PG", "display_name": "ron", "link": "https://stackoverflow.com/users/180258/ron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 31115029, "answer_count": 1, "score": 1, "last_activity_date": 1435579311, "creation_date": 1435578056, "last_edit_date": 1435578795, "question_id": 31114770, "link": "https://stackoverflow.com/questions/31114770/reason-for-overlapping-instances-error-when-not-quantifying-method-existentially", "title": "Reason for overlapping instances error when not quantifying method existentially", "body": "<p>Given the following code, removing <code>forall a r</code> from the type of <code>go</code> fails with \"Overlapping instances for Typeable (D r)\". I wonder why?</p>\n\n<pre><code>{-# LANGUAGE DeriveDataTypeable #-}\n{-# LANGUAGE ExistentialQuantification #-}\n{-# LANGUAGE FlexibleContexts #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE StandaloneDeriving #-}\n{-# LANGUAGE TypeFamilies #-}\nmodule M where\n\nimport Data.Typeable (Proxy, Typeable, cast)\n\nclass C r where\n    data D r :: *\n\nderiving instance Typeable D\n\ndata A = forall r . A (D r)\n\ngo :: forall r a . (Typeable a, Typeable (D r)) =&gt; a -&gt; Proxy r -&gt; A\ngo a _ = case cast a of\n  Just (b :: D r) -&gt; A b\n  Nothing -&gt; error \"fail to cast\"\n</code></pre>\n\n<p>The error also says \"The choice depends on the instantiation of <code>r</code>\" - but isn't that pinned by the supplied <code>Proxy r</code>?</p>\n"}, {"tags": ["haskell", "generics", "ghc"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 7, "creation_date": 1435564341, "post_id": 31109559, "comment_id": 50234818, "body": "<code>M1</code> stores meta-information. <code>i</code> indicates if it is storing a record selector, constructor, or datatype. <code>c</code> is a tag generated for each datatype - it allows you to access the name of the original datatype, record selector, or constructor as a string, as well as other things. <code>f</code> is the &quot;branches&quot; of the datatype, and <code>p</code> the &quot;leaves&quot;. All of this is in the docs for <a href=\"https://hackage.haskell.org/package/base-4.7.0.0/docs/GHC-Generics.html\" rel=\"nofollow noreferrer\">GHC.Generics</a>."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1526010094, "post_id": 50278882, "comment_id": 87585456, "body": "You have two things called <code>EmptySelector</code>. I don&#39;t understand the syntax of this list. Like ... what is <code>Selector typ</code> supposed to mean?"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526011577, "post_id": 50278882, "comment_id": 87585750, "body": "@dfeuer I cleaned it up a bit and fixed the naming. The things on the left are supposed to be type synonyms. It is only a reference to help make sense of the documentation in GHC.Generics. It isn&#39;t intended to be used in real code."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1526014643, "post_id": 50278882, "comment_id": 87586342, "body": "<code>U1</code> doesn&#39;t have any selectors (it has no fields, so it can&#39;t). I&#39;m not sure what you mean there."}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526043845, "post_id": 50278882, "comment_id": 87602204, "body": "@dfeuer Thanks for the feedback"}, {"owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1526044229, "post_id": 50278882, "comment_id": 87602453, "body": "For <code>U1</code> I meant to express that for a particular Constructor it has no selectors. I am still trying to think of a better name for it."}], "tags": [], "owner": {"reputation": 1894, "user_id": 412417, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/880a205c1958574d83803d5e30da95ca?s=128&d=identicon&r=PG&f=1", "display_name": "MCH", "link": "https://stackoverflow.com/users/412417/mch"}, "is_accepted": false, "score": 0, "last_activity_date": 1526044086, "last_edit_date": 1526044086, "creation_date": 1525975227, "answer_id": 50278882, "question_id": 31109559, "link": "https://stackoverflow.com/questions/31109559/how-do-ghc-generics-representations-work/50278882#50278882", "title": "How do GHC.Generics representations work?", "body": "<p>There are not a lot of resources out there for GHC.Generics. Your best bet is the documentation in hackage, blog posts and reading source code.</p>\n\n<p>Here is a simplified reference list of type synonyms I keep in order to remember what all the types from GHC.Generics mean.</p>\n\n<pre><code>type TypeName = D1 ('MetaSelector name moduleName packageName isNewType) rest\n-- Company from data Company = MkCompany { name :: String, address :: String }\n\ntype Constructor = C1 ('MetaCons constructor prefixOrInfix isRecord) rest\n-- MkCompany from data Company = MkCompany { name :: String, address :: String }\n\ntype NamedSelector = S1 ('MetaSel ('Just selector) unpackednesss sourceStrictness decidedStrictness)\n-- age from data Person = Person { age :: Int }\n\ntype UnnamedSelector = S1 ('MetaSel Nothing unpackednesss sourceStrictness decidedStrictness)\n-- Int from data Wrapper = Wrapper Int\n\ntype ConcatSelectors = (:*:)\n\ntype ConcatConstructors = (:+:)\n\ntype TypeParameter a = Rec0 a\n-- a from the right side of data Wrapper a = Wrapper {getA :: a}\n\ntype ConstructorEmptyValuePlaceholder = U1\n-- data Empty = MkEmpty, MkEmpty is a Constructor but takes no values\n-- ConstructorEmptyValuePlaceholder fills the type requirement of Constructor\n</code></pre>\n"}], "owner": {"reputation": 845, "user_id": 4131972, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/--SIseZZR51U/AAAAAAAAAAI/AAAAAAAAAAw/xWroBmQMpfk/photo.jpg?sz=128", "display_name": "hliu", "link": "https://stackoverflow.com/users/4131972/hliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1526044086, "creation_date": 1435561158, "last_edit_date": 1435592633, "question_id": 31109559, "link": "https://stackoverflow.com/questions/31109559/how-do-ghc-generics-representations-work", "title": "How do GHC.Generics representations work?", "body": "<p>I am really confused by the <em>'Generic representation type'</em> in GHC.Generics. I don't understand how this datatype works. For example, Meta-information, <code>M1</code>:</p>\n\n<pre><code>newtype M1 i c f p\nM1\n  unM1 :: f p\n</code></pre>\n\n<p>Why edoes the type <code>M1</code> have four type variables: i, c, f and p. By that I mean, why <em>4</em>. Does it have some special meaning?</p>\n\n<p>Also, any books or papers good for learning about GHC Generics for beginners would be appreciated.</p>\n"}, {"tags": ["parsing", "haskell", "f#"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 4, "creation_date": 1435565678, "post_id": 31108482, "comment_id": 50235542, "body": "You should expand &quot;does not work&quot;. Type error? Run time error? Wrong result?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435625838, "post_id": 31108482, "comment_id": 50267954, "body": "&quot;Why does the F# function not work as expected [when I remove <code>else return &quot;&quot;</code>]?&quot; Well... that depends a lot on what you expect. Perhaps you should say what that is."}, {"owner": {"reputation": 133, "user_id": 3535953, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0eec2af1e498005f4f73387a2d958628?s=128&d=identicon&r=PG&f=1", "display_name": "user3535953", "link": "https://stackoverflow.com/users/3535953/user3535953"}, "edited": false, "score": 0, "creation_date": 1435733874, "post_id": 31108482, "comment_id": 50318202, "body": "If I remove the last tow lines of the string function (else return &quot;&quot;). Then if I do &#39;runParser (string &quot;hello&quot;) &quot;hello!&quot;, in F# i got the empty list, but in Haskell i got [(&quot;hello&quot;,&quot;!&quot;)]."}], "answers": [{"tags": [], "owner": {"reputation": 7386, "user_id": 2894770, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xfbIb.png?s=128&g=1", "display_name": "CaringDev", "link": "https://stackoverflow.com/users/2894770/caringdev"}, "is_accepted": false, "score": 0, "last_activity_date": 1435573766, "creation_date": 1435573766, "answer_id": 31113381, "question_id": 31108482, "link": "https://stackoverflow.com/questions/31108482/f-parser-combinators/31113381#31113381", "title": "F# parser combinators", "body": "<p>My Haskell is a bit rusty, but isn't the snippet you posted equivalent to your F# code, i.e. in Haskell too, you need a base case for the recursion (the empty string)?</p>\n\n<p>If you remove the else part, the second to last call to string (i.e. the one with just one character left) will get no result from its recursive call (passing \"\"), so it'll return no valid result as well. This then propagates 'upwards' and you'll end up with an empty list.</p>\n"}], "owner": {"reputation": 133, "user_id": 3535953, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0eec2af1e498005f4f73387a2d958628?s=128&d=identicon&r=PG&f=1", "display_name": "user3535953", "link": "https://stackoverflow.com/users/3535953/user3535953"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 202, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1435573766, "creation_date": 1435556202, "last_edit_date": 1435565295, "question_id": 31108482, "link": "https://stackoverflow.com/questions/31108482/f-parser-combinators", "title": "F# parser combinators", "body": "<p>I'm trying translate the example about monadic parsers (<a href=\"https://www.cs.nott.ac.uk/~gmh/pearl.pdf\" rel=\"nofollow\">https://www.cs.nott.ac.uk/~gmh/pearl.pdf</a>) to F#.</p>\n\n<p>So far I have:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>type Parser&lt;'a&gt; = Parser of  (string -&gt; ('a*string) list)\n\nlet item : Parser&lt;char&gt; =\n  Parser (fun (s:string) -&gt; \n                match s with\n                | \"\" -&gt; []\n                | null -&gt; []\n                | _ -&gt; (s.Chars(0),s.Substring 1)::[])\n\nlet sat (pred : (char -&gt; bool)) : Parser&lt;char&gt; =\n  parserWf\n    {\n       let! c = item\n       if pred c then return c\n    }\n\nlet char c : Parser&lt;char&gt; =\n  sat (fun c' -&gt; c'.Equals(c))\n\nlet rec string (str:string) : Parser&lt;string&gt; =\n  parserWf\n    {\n        if (str.Length &gt; 0)\n        then\n            let! c = char (str.Chars 0)\n            let! cs = string (str.Substring 1)\n            printfn \"String: %s\" cs\n            return c.ToString() + cs\n        else\n            return \"\"\n    }\n</code></pre>\n\n<p>If I remove the <code>else return \"\"</code> from the <code>string</code> method then the result is always the empty list. \nIn Haskell the string function is declared:</p>\n\n<pre><code>string :: String -&gt; Parser String\nstring \"\" = return \"\"\nstring (c:cs) = do {char c; string cs; return (c:cs)}  \n</code></pre>\n\n<p>and this works just fine.\nWhy does the F# function not work as expected?</p>\n"}, {"tags": ["haskell", "error-handling", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1435598049, "post_id": 31109822, "comment_id": 50255960, "body": "What&#39;s interesting is that the default definition for <code>instance Error ByteString</code> is enough to resolve the problem in my original code using <code>&lt;|&gt;</code>. But the default method definitions for <code>noMsg</code> and <code>strMsg</code> are defined in terms of each other. So apparently <code>noMsg</code> doesn&#39;t actually get called. Is that correct?"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1435598519, "post_id": 31109822, "comment_id": 50256201, "body": "If you just declare <code>instance Error Bytestring</code> then calling <code>noMsg</code> or <code>strMsg</code> will produce an infinite loop."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1435606690, "post_id": 31109822, "comment_id": 50260636, "body": "Yeah - that&#39;s the weird thing. In order to use <code>&lt;|&gt;</code> I have to define <code>instance Error ByteString</code>, but the <code>Error</code> methods <code>noMsg</code> and <code>strMsg</code> never get called."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1435626427, "post_id": 31109822, "comment_id": 50268095, "body": "@user5402 Correct; as stated in the answer, <code>empty</code> uses <code>noMsg</code>, but <code>&lt;|&gt;</code> doesn&#39;t. (And <code>fail</code> uses <code>strMsg</code>, in case you&#39;re wondering why that&#39;s in the class.)"}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 0, "creation_date": 1435642975, "post_id": 31109822, "comment_id": 50272338, "body": "Ok - I found this in the GHC Trac which helped explain things: <a href=\"https://ghc.haskell.org/trac/ghc/ticket/9588\" rel=\"nofollow noreferrer\">ghc.haskell.org/trac/ghc/ticket/9588</a>"}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 4, "last_activity_date": 1435562108, "creation_date": 1435562108, "answer_id": 31109822, "question_id": 31108139, "link": "https://stackoverflow.com/questions/31108139/writing-a-chain-of-catcherror-s-with/31109822#31109822", "title": "Writing a chain of `catchError`-s with `(&lt;|&gt;)`?", "body": "<p>The <code>Alternative</code> instance for <code>Either</code> uses an <code>Error</code> constraint to generate a value for <code>empty :: Alternative f =&gt; f a</code>. In this case, it does something like <code>empty = Left noMsg :: Error e =&gt; Either e a</code>. Since using <code>&lt;|&gt;</code> doesn't actually need the error instance, if you want <code>&lt;|&gt;</code> without <code>empty</code>, you could use <a href=\"http://haddocks.fpcomplete.com/fp/7.8/20140916-162/semigroupoids/Data-Functor-Alt.html\" rel=\"nofollow\"><code>Data.Functor.Alt.Alt</code></a> from semigroupoids.</p>\n\n<p>However, <code>ExceptT</code> from <code>Control.Monad.Except</code> or <code>Control.Monad.Trans.Except</code> uses a more sensible <code>Monoid</code> constraint, and <code>Bytestring</code> is a <code>Monoid</code> already. I believe that <code>ErrorT</code> is deprecated now because of this. You also may want to use a list of <code>Bytestring</code>s as your error type, or else the <code>Bytestring</code>s will be concatenated together with no spacing.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Bar where\n\nimport Data.ByteString.Char8 (ByteString)\nimport qualified Data.ByteString.Char8 as BS\n\nimport Control.Monad\nimport Control.Applicative\nimport Control.Monad.Trans.Except \nimport Data.Monoid\n\ncheck1 str =\n  if str == \"abc\"\n    then return 1\n    else throwE [\"not equal to abc\" ]\n\ncheck2 str =\n  if str == \"def\"\n    then return 2\n    else throwE [\"not equal to def\" ]\n\nchecks str = check1 str &lt;|&gt; check2 str &lt;|&gt; throwE [\"not abc or def\"]\n\nmain :: IO ()\nmain = do\n  input &lt;- BS.getLine\n  case runExcept $ checks input of\n    Left e  -&gt; mapM_ (BS.putStrLn . (\"Error: \" &lt;&gt;)) e \n    Right a -&gt; print a \n</code></pre>\n"}], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1435562108, "creation_date": 1435554389, "question_id": 31108139, "link": "https://stackoverflow.com/questions/31108139/writing-a-chain-of-catcherror-s-with", "title": "Writing a chain of `catchError`-s with `(&lt;|&gt;)`?", "body": "<p>In the following code, is there a more idiomatic way to write the <code>checks</code> function?</p>\n\n<p>The pattern feels a lot like <code>(&lt;|&gt;)</code> should work here, but using</p>\n\n<pre><code>checks s = check1 s &lt;|&gt; check2 s &lt;|&gt; throwError \"...\"\n</code></pre>\n\n<p>requires me to define <code>instance Error ByteString</code>.</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nmodule Bar where\n\nimport Data.ByteString.Char8 (ByteString)\nimport qualified Data.ByteString.Char8 as BS\n\nimport Control.Monad\nimport Control.Applicative\nimport Control.Monad.Error\nimport Data.Monoid\n\ncheck1 str =\n  if str == \"abc\"\n    then return 1\n    else throwError (\"not equal to abc\" :: ByteString)\n\ncheck2 str =\n  if str == \"def\"\n    then return 2\n    else throwError (\"not equal to def\" :: ByteString)\n\nchecks str = (check1 str)\n               `catchError` (const (check2 str))\n               `catchError` (const (throwError \"not abc or def\"))\n\nmain :: IO ()\nmain = do\n  input &lt;- BS.getLine\n  case checks input of\n    Left e  -&gt; BS.putStrLn $ \"Error: \" &lt;&gt; e\n    Right a -&gt; BS.putStrLn \"OK\"\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching", "abstract-data-type", "pattern-synonyms"], "answers": [{"comments": [{"owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "edited": false, "score": 1, "creation_date": 1435548930, "post_id": 31106674, "comment_id": 50229374, "body": "Did you mean S.EmptyL"}], "tags": [], "owner": {"reputation": 1003, "user_id": 218307, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71349c1b606c549215197f7ec55e2276?s=128&d=identicon&r=PG", "display_name": "jhickner", "link": "https://stackoverflow.com/users/218307/jhickner"}, "is_accepted": true, "score": 12, "last_activity_date": 1435559537, "last_edit_date": 1435559537, "creation_date": 1435542482, "answer_id": 31106674, "question_id": 31106484, "link": "https://stackoverflow.com/questions/31106484/pattern-matching-data-sequence-like-lists/31106674#31106674", "title": "Pattern matching Data.Sequence like lists", "body": "<p><code>ViewPatterns</code> is probably the way to go here. Your code doesn't work because you need to call <code>viewl</code> or <code>viewr</code> on your <code>Seq</code> first to get something of type <code>ViewL</code> or <code>ViewR</code>. <code>ViewPatterns</code> can handle that pretty nicely:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns #-}\n\nfoo (S.viewl -&gt; S.EmptyL)    = ... -- empty on left\nfoo (S.viewl -&gt; (x S.:&lt; xs)) = ... -- not empty on left\n</code></pre>\n\n<p>Which is equivalent to something like:</p>\n\n<pre><code>foo seq = case S.viewl seq of\n    S.EmptyL    -&gt; ...\n    (x S.:&lt; xs) -&gt; ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1435558424, "post_id": 31106916, "comment_id": 50231969, "body": "Excellent, I had no idea this made it into 7.10. Why is the <a href=\"https://ghc.haskell.org/trac/ghc/ticket/8581\" rel=\"nofollow noreferrer\">GHC ticket</a> still open for it though?"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1435559437, "post_id": 31106916, "comment_id": 50232361, "body": "@Andr&#225;sKov&#225;cs: erhmm... I&#39;ve left it open because the matcher vs builder type context issues in that ticket haven&#39;t been completely addressed yet."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 15, "last_activity_date": 1435544909, "creation_date": 1435544909, "answer_id": 31106916, "question_id": 31106484, "link": "https://stackoverflow.com/questions/31106484/pattern-matching-data-sequence-like-lists/31106916#31106916", "title": "Pattern matching Data.Sequence like lists", "body": "<p>As of GHC 7.8, you can use <a href=\"https://ghc.haskell.org/trac/ghc/wiki/PatternSynonyms\">pattern synonyms</a> together with <a href=\"https://ghc.haskell.org/trac/ghc/wiki/ViewPatterns\">view patterns</a> for this purpose:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns, PatternSynonyms #-}\n\nimport qualified Data.Sequence as Seq\n\npattern Empty   &lt;- (Seq.viewl -&gt; Seq.EmptyL)\npattern x :&lt; xs &lt;- (Seq.viewl -&gt; x Seq.:&lt; xs)\npattern xs :&gt; x &lt;- (Seq.viewr -&gt; xs Seq.:&gt; x)\n</code></pre>\n\n<p>As of GHC 7.10, you can also make it into a bidirectional pattern synonym, so that <code>Empty</code>, <code>(:&lt;)</code> and <code>(:&gt;)</code> can be used as \"constructors\" as well:</p>\n\n<pre><code>{-# LANGUAGE ViewPatterns, PatternSynonyms #-}\n\nimport qualified Data.Sequence as Seq\n\npattern Empty   &lt;- (Seq.viewl -&gt; Seq.EmptyL)  where Empty = Seq.empty\npattern x :&lt; xs &lt;- (Seq.viewl -&gt; x Seq.:&lt; xs) where (:&lt;)  = (Seq.&lt;|) \npattern xs :&gt; x &lt;- (Seq.viewr -&gt; xs Seq.:&gt; x) where (:&gt;)  = (Seq.|&gt;) \n</code></pre>\n"}], "owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1750, "favorite_count": 3, "accepted_answer_id": 31106674, "answer_count": 2, "score": 10, "last_activity_date": 1452954886, "creation_date": 1435540695, "last_edit_date": 1452954886, "question_id": 31106484, "link": "https://stackoverflow.com/questions/31106484/pattern-matching-data-sequence-like-lists", "title": "Pattern matching Data.Sequence like lists", "body": "<p>I am using <a href=\"https://hackage.haskell.org/package/containers/docs/Data-Sequence.html\" rel=\"noreferrer\"><code>Data.Sequence</code></a> instead lists for better performance.  With lists we can do the following</p>\n\n<pre><code>foo :: [Int] -&gt; Int\nfoo [] m = m\nfoo (x:xs) m = ...\n</code></pre>\n\n<p>How can this be accomplished with <code>Data.Sequence</code>.  I have tried the following:</p>\n\n<pre><code>foo:: S.Seq Int -&gt; Int\nfoo S.empty m = m\nfoo (x S.&lt;: xs) m = ...\n</code></pre>\n\n<p>I think the solution involves using <code>S.viewl</code> and <code>S.viewr</code>, but cannot seem to figure out how.</p>\n"}, {"tags": ["haskell", "pattern-matching", "ghc"], "answers": [{"comments": [{"owner": {"reputation": 2052, "user_id": 3949424, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb2f4d411841f6c34bdee2d0769ef96e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramith Jayatilleka", "link": "https://stackoverflow.com/users/3949424/ramith-jayatilleka"}, "edited": false, "score": 0, "creation_date": 1435539210, "post_id": 31106168, "comment_id": 50227576, "body": "I see. That&#39;s kind of disappointing. I was actually thinking about the case where you have a nested persistent data structure (like a binary tree) and you wanted to insert a value that was already present. You&#39;d need a helper function like &#39;insert :: (Ord a) =&gt; a -&gt; Tree a -&gt; Maybe (Tree a)` that returned a Nothing if the element was already present to avoid reconstructing up the path of the value."}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "reply_to_user": {"reputation": 2052, "user_id": 3949424, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb2f4d411841f6c34bdee2d0769ef96e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramith Jayatilleka", "link": "https://stackoverflow.com/users/3949424/ramith-jayatilleka"}, "edited": false, "score": 4, "creation_date": 1435544813, "post_id": 31106168, "comment_id": 50228645, "body": "@Ramith That destroys laziness unfortunately; all of the calls on the path down to the leaf node would have to wait for the ultimate call to return before they&#39;d know whether they&#39;re returning a reference to an existing constructor node or allocating a new one, which means forcing the root step forces everything. So if you ever want to choose between those properties (laziness vs avoiding reconstruction of identical trees), then it needs to be explicitly programmed (such as via the Maybe (Tree a) helper) rather than implicit behaviour of the compiler."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1435586258, "post_id": 31106168, "comment_id": 50248350, "body": "Is <code>unsafeCoerce</code> safe in this case? I mean <code>Either a b</code> and <code>Either a c</code> have the same argument to <code>Left</code> so it seems plausible that the <code>Left</code> constructor could be coerced without problems (and probably is), however is there any <i>guarantee</i> about this?"}], "tags": [], "owner": {"reputation": 8690, "user_id": 712548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f468e49dc69e4f281faf3e9516adcf5?s=128&d=identicon&r=PG", "display_name": "shachaf", "link": "https://stackoverflow.com/users/712548/shachaf"}, "is_accepted": true, "score": 16, "last_activity_date": 1435537343, "creation_date": 1435537343, "answer_id": 31106168, "question_id": 31105630, "link": "https://stackoverflow.com/questions/31105630/does-ghc-make-a-new-copy-of-an-object-when-deconstructing-and-reconstructing-it/31106168#31106168", "title": "Does GHC make a new copy of an object when deconstructing and reconstructing it?", "body": "<p>In general GHC will allocate a new value rather than reuse the argument in that situation. In this particular case you could write something like</p>\n\n<pre><code>f :: T -&gt; T\nf t@(T x y) = t\n</code></pre>\n\n<p>to explicitly reuse the argument. Unfortunately, in one of the cases where you'd really want this --</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Either e a -&gt; Either e b\nfmap f (Right x) = Right (f x)\nfmap f (Left x) = Left x\n</code></pre>\n\n<p>-- GHC will allocate a new <code>Left</code> value, and you can't simply reuse the argument, because the result has a different type. As far as I know there's no way to tell GHC to reuse the argument in this case other than <code>unsafeCoerce</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1435566665, "post_id": 31107601, "comment_id": 50236070, "body": "The case matching affects strictness. The original specification for <code>identity</code> requires it to be strict, so GHC keeps that strictness."}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 15, "last_activity_date": 1435550652, "creation_date": 1435550652, "answer_id": 31107601, "question_id": 31105630, "link": "https://stackoverflow.com/questions/31105630/does-ghc-make-a-new-copy-of-an-object-when-deconstructing-and-reconstructing-it/31107601#31107601", "title": "Does GHC make a new copy of an object when deconstructing and reconstructing it?", "body": "<p>You can test this easily enough with <code>-ddump-simpl</code>. An allocation of a value of an ADT will show up as an application of a data constructor.</p>\n\n<p>In this case, GHC does spot that it can reuse the value, and even that it doesn't have to perform the pattern matching:</p>\n\n<pre><code>module I where\n\ndata T = T Int String\n\nidentity :: T -&gt; T\nidentity (T a b) = T a b\n</code></pre>\n\n<p>-</p>\n\n<pre><code>rwbarton@morphism:/tmp$ ghc -ddump-simpl I\n[1 of 1] Compiling I                ( I.hs, I.o )\n\n==================== Tidy Core ====================\nResult size of Tidy Core = {terms: 3, types: 3, coercions: 0}\n\nI.identity :: I.T -&gt; I.T\n[GblId, Arity=1, Caf=NoCafRefs, Str=DmdType]\nI.identity = \\ (ds_dHN :: I.T) -&gt; ds_dHN\n</code></pre>\n\n<p>This happens even without optimizations enabled, and it also works on ADTs with more than one constructor.</p>\n"}], "owner": {"reputation": 2052, "user_id": 3949424, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb2f4d411841f6c34bdee2d0769ef96e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramith Jayatilleka", "link": "https://stackoverflow.com/users/3949424/ramith-jayatilleka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "accepted_answer_id": 31106168, "answer_count": 2, "score": 18, "last_activity_date": 1435550652, "creation_date": 1435532269, "last_edit_date": 1435532631, "question_id": 31105630, "link": "https://stackoverflow.com/questions/31105630/does-ghc-make-a-new-copy-of-an-object-when-deconstructing-and-reconstructing-it", "title": "Does GHC make a new copy of an object when deconstructing and reconstructing it?", "body": "<p>If I have a type like <code>data T = T Int String</code> and a function like so:</p>\n\n<pre><code>identity :: T -&gt; T\nidentity (T a b) = T a b\n</code></pre>\n\n<p>After the deconstruction in the pattern matching, does GHC create a new T object containing references to the same Int and String? Or does it return the exact same object (with the same memory address) it received? I understand they're semantically equivalent, I'm just curious.</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 3, "last_activity_date": 1435526263, "last_edit_date": 1435526263, "creation_date": 1435525863, "answer_id": 31104795, "question_id": 31104667, "link": "https://stackoverflow.com/questions/31104667/looking-for-a-standard-haskell-idiom-before-i-implement-it-myself/31104795#31104795", "title": "Looking For A Standard Haskell Idiom Before I Implement it Myself", "body": "<pre><code>rfWarnings rf = let warnings = [((\\rf -&gt; length (neigh rf) &gt; 3), \"warning: ...\"),\n                                &lt;more warnings&gt; ]\n                in [ message | (predicate, message) &lt;- warnings, predicate rf ]\n</code></pre>\n\n<p>or even, removing the lambda,</p>\n\n<pre><code>rfWarnings rf = let warnings = [(length (neigh rf) &gt; 3, \"warning: ...\"),\n                                &lt;more warnings&gt; ]\n                in [ message | (predicate, message) &lt;- warnings, predicate ]\n</code></pre>\n\n<p>or even (a bit more cryptic)</p>\n\n<pre><code>rfWarnings rf = let warnings = [(length (neigh rf) &gt; 3, \"warning: ...\"),\n                                &lt;more warnings&gt; ]\n                in [ message | (True, message) &lt;- warnings ]\n</code></pre>\n\n<p>or even (shorter but less readable)</p>\n\n<pre><code>rfWarnings rf = let warnings = [(length (neigh rf) &gt; 3, \"warning: ...\"),\n                                &lt;more warnings&gt; ]\n                in map snd $ filter fst warnings\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 4, "last_activity_date": 1435561296, "last_edit_date": 1435561296, "creation_date": 1435527202, "answer_id": 31104982, "question_id": 31104667, "link": "https://stackoverflow.com/questions/31104667/looking-for-a-standard-haskell-idiom-before-i-implement-it-myself/31104982#31104982", "title": "Looking For A Standard Haskell Idiom Before I Implement it Myself", "body": "<p>Not sure if this works for your application \u2013 but, an idiomatic thing might be to change the type of your predicates: rather than a fixed string and a function that <a href=\"https://shreevatsa.wordpress.com/2015/01/31/boolean-blindness/\" rel=\"nofollow\">returns <code>Bool</code></a> (but in the <code>Nothing</code> case you don't actually need the string), use <em>only</em> a function &ndash; which returns <code>Maybe String</code>. Then what you're asking about becomes very simple: apply all functions in a list to a given argument, and gather the <code>Just</code> values.</p>\n\n<pre><code>rfWarnings' :: RuleFile -&gt; [String]\nrfWarnings' rf = catMaybes $ map ($rf) warnings\n where warnings = [ \\rf -&gt; guard (length (neigh rf) &gt; 3) &gt;&gt; return\n                             \"warning: unknown extra information in the neighborhood, discarding it and moving on\"\n                  , {-more warnings-}\n                  ]\n</code></pre>\n\n<p>To avoid repeating this <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#v:guard\" rel=\"nofollow\"><code>guard</code></a> stuff in the <code>Maybe</code> <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#t:MonadPlus\" rel=\"nofollow\"><code>MonadPlus</code></a>, you can define an operator that links ordinary predicates directly to the strings you want them to yield:</p>\n\n<pre><code> where warnings = [ (\\rf -&gt; length (neigh rf) &gt; 3) ==&gt;\n                             \"warning: unknown extra information in the neighborhood, discarding it and moving on\"\n                  , {-more warnings-}\n                  ]\n       pred ==&gt; str = guard pred &gt;&gt; return str\n</code></pre>\n\n<p>Looks perhaps even nicer the other way around:</p>\n\n<pre><code> where warnings = [ \"warning: unknown extra information in the neighborhood, discarding it and moving on\"\n                      \\&lt;= \\rf -&gt; length (neigh rf) &gt; 3\n                  , {-more warnings-}\n                  ]\n       str \\&lt;= pred = guard pred &gt;&gt; return str\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1003, "user_id": 1483516, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/97f19b874f98797ff0a07478d351e29a?s=128&d=identicon&r=PG", "display_name": "seewalker", "link": "https://stackoverflow.com/users/1483516/seewalker"}, "edited": false, "score": 0, "creation_date": 1435553978, "post_id": 31107030, "comment_id": 50230570, "body": "Thanks everybody for answering. I probably don&#39;t have the taste/judgement to mark any of these answers as the &quot;accepted&quot; answer. It looks like Cactus&#39; answer is the most psuedocode-y/syntax-sugary, so I will probably use that as a starting point given that performance isn&#39;t a huge factor here and i&#39;m not likely to want to introduce further abstractions. leftaroundabout and chi&#39;s answers have structural things going on I wouldn&#39;t have thought of (but am glad to)."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 4, "last_activity_date": 1435545871, "creation_date": 1435545871, "answer_id": 31107030, "question_id": 31104667, "link": "https://stackoverflow.com/questions/31104667/looking-for-a-standard-haskell-idiom-before-i-implement-it-myself/31107030#31107030", "title": "Looking For A Standard Haskell Idiom Before I Implement it Myself", "body": "<p>You could use a <code>Writer</code> for this:</p>\n\n<pre><code>import Control.Monad.Writer\n\nrfWarnings rf = execWriter $ do\n    unless (length (neigh rf) &lt;= 3) $ tell \"Too much neigh!\"\n    unless (isFrobulastic rf) $ tell \"Frobulation mismatch!\"\n</code></pre>\n\n<p>This has the advantage that it is very easy to compose <code>rfWarnings</code> from smaller pieces, e.g.</p>\n\n<pre><code>rfWarnings rf = execWriter $ do\n  unless (looksOK rf) $ tell \"Completely b0rken!\"\n  mapM_ partWarning (parts rf)\n</code></pre>\n\n<p>and also, I'd rather use <code>unless</code> than <code>when</code> because I think describing the correct state is better than describing the incorrect one.</p>\n"}], "owner": {"reputation": 1003, "user_id": 1483516, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/97f19b874f98797ff0a07478d351e29a?s=128&d=identicon&r=PG", "display_name": "seewalker", "link": "https://stackoverflow.com/users/1483516/seewalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1435561296, "creation_date": 1435524999, "last_edit_date": 1435526764, "question_id": 31104667, "link": "https://stackoverflow.com/questions/31104667/looking-for-a-standard-haskell-idiom-before-i-implement-it-myself", "title": "Looking For A Standard Haskell Idiom Before I Implement it Myself", "body": "<p>I have defined a datatype <code>RuleFile</code> and I writing a function that examines a <code>Rulefile</code> with a number of predicates, accumulating warning strings as it goes along.</p>\n\n<pre><code>rfWarnings :: RuleFile -&gt; [String]\nrfWarnings rf = let warnings = [((\\rf -&gt; length (neigh rf) &gt; 3), \"warning: unknown extra information in the neighborhood, discarding it and moving on\"),\n                               &lt;more warnings&gt; ]\n                in &lt;process&gt; warnings\n</code></pre>\n\n<p>Is there some off-the-shelf haskell function for <code>&lt;process&gt;</code>? Or maybe I'm not thinking about this in an idiomatic haskell way, and there's some other recommended approach? I'm using <code>Control.Monad.Except</code> for errors, but my current thinking is I want to treat warnings separately and output the messages on stderr.</p>\n\n<p>Later on, I'll use it with something like ...</p>\n\n<pre><code>main :: IO ()\nmain = do\n &lt;some stuff&gt;\n ruleFiles &lt;- &lt;produce them&gt;\n mapM (hPutStr stderr) (map rfWarnings ruleFiles)\n &lt;other stuff&gt;\n</code></pre>\n"}, {"tags": ["haskell", "syntactic-sugar", "template-haskell"], "answers": [{"comments": [{"owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "edited": false, "score": 0, "creation_date": 1435512528, "post_id": 31102623, "comment_id": 50220301, "body": "I see so it has nothing to do with the $ operator. <code>widgetFile &quot;home&quot;</code> will then be responsible for generating this code on the fly at compile time?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "edited": false, "score": 1, "creation_date": 1435512609, "post_id": 31102623, "comment_id": 50220329, "body": "@LuisDosReis Yes. It might for instance access an external file, process it, and generate some Haskell code depending on it. This can be used to obtain a vastly generalized <code>#include</code>, for instance, where the included file can use a different syntax."}, {"owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "edited": false, "score": 0, "creation_date": 1435512960, "post_id": 31102623, "comment_id": 50220450, "body": "Oh interesting so I can apply metaprogramming at manipulating different languages too."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 10, "last_activity_date": 1435512340, "creation_date": 1435512340, "answer_id": 31102623, "question_id": 31102599, "link": "https://stackoverflow.com/questions/31102599/what-is-the-construct/31102623#31102623", "title": "What is the $() construct?", "body": "<p>This is not using the <code>$</code> application operator, but is involving a <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/template-haskell.html\">Template Haskell slice</a>.</p>\n\n<p>Very roughly, <code>widgetFile \"home\"</code> is code which is run at <em>compile time</em>: it generates Haskell code, which is then compiled as usual. It's a form of <a href=\"https://en.wikipedia.org/wiki/Metaprogramming\">metaprogramming</a> in Haskell.</p>\n"}], "owner": {"reputation": 353, "user_id": 3977199, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e6bce85208aeb360ce66fabc2cdd7c26?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Dos Reis", "link": "https://stackoverflow.com/users/3977199/luis-dos-reis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 1, "accepted_answer_id": 31102623, "answer_count": 1, "score": 10, "last_activity_date": 1435524775, "creation_date": 1435512183, "last_edit_date": 1435524775, "question_id": 31102599, "link": "https://stackoverflow.com/questions/31102599/what-is-the-construct", "title": "What is the $() construct?", "body": "<p>I have been trying to find in the Haskell reference the use of this:</p>\n\n<pre><code>getHomeR = defaultLayout $ do\n    setTitle \"My Awesome Site\"\n    $(widgetFile \"home\")\n</code></pre>\n\n<p>Specifically:</p>\n\n<pre><code>$(widgetFile \"home\")\n</code></pre>\n\n<p>I know that the $ operator gives precedence to whatever is to the right of it, but I have not been able to comprehend the usage of $(). Anyone?</p>\n"}, {"tags": ["function", "haskell", "tuples", "type-conversion", "maybe"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 3, "creation_date": 1435503175, "post_id": 31101071, "comment_id": 50217532, "body": "Using <code>-XTupleSections</code> you could do something like:  <code>f (x, y) = (,y) &lt;$&gt; x</code>."}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435505604, "post_id": 31101071, "comment_id": 50218225, "body": "<i>&quot;Without reinventing the wheel&quot;</i> and <i>&quot;easy&quot;</i> are very vague terms. To an experienced Haskell programmer, maybe concepts that are difficult for a beginner maybe be very straightforward. Could you redefine what you mean?"}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1435508887, "post_id": 31101071, "comment_id": 50219206, "body": "&quot;without ...&quot; I mean not rolling out my own function, but using a function which already exists . &quot;easy&quot; : usable as such in a expression. Petr <code>bitraverse</code> solution is a good example of it. My solution using sequence <code>fmap swap . sequence . swap</code> doesn&#39;t reinvent the wheel but it&#39;s not what I qualify easy."}], "answers": [{"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 5, "last_activity_date": 1435503394, "creation_date": 1435503394, "answer_id": 31101177, "question_id": 31101071, "link": "https://stackoverflow.com/questions/31101071/converting-maybe-a-b-to-maybe-a-b/31101177#31101177", "title": "Converting (Maybe a, b) to Maybe (a,b)", "body": "<p>Yes. Functors.</p>\n\n<pre><code>solution :: (Maybe a, b) -&gt; Maybe (a, b)\nsolution (a, b) = fmap (\\q -&gt; (q, b)) a\n</code></pre>\n\n<p>Or, in pointfree style:</p>\n\n<pre><code>solution = uncurry $ flip $ fmap . flip (,)\n</code></pre>\n\n<p>Additionally, as @Bakuriu said, if you have <code>TupleSections</code> enabled, and <code>Control.Applicative</code> imported, it becomes <em>really</em> easy:</p>\n\n<pre><code>solution (a, b) = (, b) &lt;$&gt; a\n</code></pre>\n\n<p>Learn more <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1435504015, "post_id": 31101205, "comment_id": 50217770, "body": "I mean , I can write as it&#39;s pretty straight forward indeed, but I was wondering if such function already existed as it looks to be a specific case of the more general <code>(m a, b) -&gt; m (a,b)</code> or even <code>t (m a) -&gt; m (t a)</code>"}], "tags": [], "owner": {"reputation": 67060, "user_id": 783743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/835bdcdab3e4bf466f0d59f809c50035?s=128&d=identicon&r=PG", "display_name": "Aadit M Shah", "link": "https://stackoverflow.com/users/783743/aadit-m-shah"}, "is_accepted": false, "score": 1, "last_activity_date": 1435503583, "creation_date": 1435503583, "answer_id": 31101205, "question_id": 31101071, "link": "https://stackoverflow.com/questions/31101071/converting-maybe-a-b-to-maybe-a-b/31101205#31101205", "title": "Converting (Maybe a, b) to Maybe (a,b)", "body": "<p>What do you mean by &ldquo;without reinventing the wheel&rdquo;? The most straightforward way to create such a function is as follows:</p>\n\n<pre><code>f :: Maybe a -&gt; b -&gt; Maybe (a, b)\nf Nothing  _ = Nothing\nf (Just a) b = Just (a, b)\n\ng :: (Maybe a, b) -&gt; Maybe (a, b)\ng = uncurry f\n</code></pre>\n\n<p>Hope that helps.</p>\n"}, {"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 7, "last_activity_date": 1435504427, "creation_date": 1435504427, "answer_id": 31101336, "question_id": 31101071, "link": "https://stackoverflow.com/questions/31101071/converting-maybe-a-b-to-maybe-a-b/31101336#31101336", "title": "Converting (Maybe a, b) to Maybe (a,b)", "body": "<p>You could also use <a href=\"https://hackage.haskell.org/package/bifunctors-4.1.1/docs/Data-Bitraversable.html\"><code>Bitraversable</code></a>:</p>\n\n<pre><code>bitraverse id pure :: (Bitraversable t, Applicative f) =&gt; t (f c) d -&gt; f (t c d)\n</code></pre>\n\n<p>which specializes to</p>\n\n<pre><code>bitraverse id pure :: (Maybe a, b) -&gt; Maybe (a, b)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1435508432, "post_id": 31101807, "comment_id": 50219071, "body": "Note that this is the same as <code>sequenceAOf _1 (Just 1, 2)</code>. I guess it&#39;s personal preference which one you prefer."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1435510014, "post_id": 31101807, "comment_id": 50219525, "body": "I like that lots, even though it&#39;s hard to understand."}], "tags": [], "owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "is_accepted": false, "score": 3, "last_activity_date": 1435507224, "creation_date": 1435507224, "answer_id": 31101807, "question_id": 31101071, "link": "https://stackoverflow.com/questions/31101071/converting-maybe-a-b-to-maybe-a-b/31101807#31101807", "title": "Converting (Maybe a, b) to Maybe (a,b)", "body": "<p>The following works with <a href=\"https://hackage.haskell.org/package/lens\" rel=\"nofollow\"><code>lens</code></a>:</p>\n\n<pre><code>&gt; import Control.Lens\n&gt; _1 id (Just 1, 2)\nJust (1, 2)\n</code></pre>\n"}], "owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 31101336, "answer_count": 4, "score": 3, "last_activity_date": 1435507224, "creation_date": 1435502697, "last_edit_date": 1435503640, "question_id": 31101071, "link": "https://stackoverflow.com/questions/31101071/converting-maybe-a-b-to-maybe-a-b", "title": "Converting (Maybe a, b) to Maybe (a,b)", "body": "<p>Is there an easy (without reinventing the wheel) to convert from <code>(Maybe a, b)</code> to <code>Maybe (a,b)</code>. I looked at <code>Traversable</code> but can't make it work.</p>\n"}, {"tags": ["haskell", "bytestring"], "answers": [{"comments": [{"owner": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 1, "creation_date": 1435489515, "post_id": 31097661, "comment_id": 50213550, "body": "I&#39;d suggest using something like <a href=\"https://hackage.haskell.org/package/base16-bytestring\" rel=\"nofollow noreferrer\">base16-bytestring</a>. The output will be longer but always the same length (twice as long as the input ByteString) and the output will be hex instead of gibberish (which is more suitable for an auth token)."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "reply_to_user": {"reputation": 2846, "user_id": 4347335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb7e6f293a134a5defec74e12cae42cc?s=128&d=identicon&r=PG&f=1", "display_name": "cchalmers", "link": "https://stackoverflow.com/users/4347335/cchalmers"}, "edited": false, "score": 0, "creation_date": 1435494751, "post_id": 31097661, "comment_id": 50214942, "body": "@cchalmers You are right. It really depends on the output the OP wants, which he didn&#39;t really explain."}, {"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1435519764, "post_id": 31097661, "comment_id": 50222878, "body": "@Bakuriu thanks! I would like to generate a session token that is secure. This token will be stored in the DB and shared wit the client.  Encoding will probably give me what I want."}, {"owner": {"reputation": 729, "user_id": 1229165, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/56b36edf3c8dbf296bee4094376e82c7?s=128&d=identicon&r=PG", "display_name": "Wilfred", "link": "https://stackoverflow.com/users/1229165/wilfred"}, "edited": false, "score": 0, "creation_date": 1547489104, "post_id": 31097661, "comment_id": 95202021, "body": "<code>\\n -&gt; T.take n . T.decodeUtf8 . B.encode &lt;$&gt; (getEntropy . uncurry (+) $ divMod n 2)</code> uses the hex technique above but still provides length <code>n</code> Text."}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 4, "last_activity_date": 1435494720, "last_edit_date": 1435494720, "creation_date": 1435480598, "answer_id": 31097661, "question_id": 31097451, "link": "https://stackoverflow.com/questions/31097451/converting-bytestring-generated-by-system-entropy-to-text/31097661#31097661", "title": "Converting ByteString Generated by System.Entropy to Text", "body": "<p><code>randBS</code> returns <em>random bytes</em> <strong>not</strong> utf-8 encoded data!\nWhat you have is not a representation of <code>Text</code> so it doesn't matter which function you use you <em>will</em> encounter some decoding error, and so you'll have to use something like <a href=\"http://hackage.haskell.org/package/text-1.2.1.1/docs/Data-Text-Encoding.html#g:3\" rel=\"nofollow\"><code>decodeUtf8With</code></a> and use an error handler to replace invalid bytes with their literal counterpart.</p>\n\n<p>Something like:</p>\n\n<pre><code>import Data.Text                    (Text, pack, unpack)\nimport Data.Text.Encoding           (decodeUtf8With)\nimport Data.ByteString              (ByteString)\nimport Data.Char                    (chr)\nimport Control.Applicative          ((&lt;$&gt;))\nimport System.Entropy\n\nhandler _ x = chr &lt;$&gt; fromIntegral &lt;$&gt; x\n\nrandBS :: IO ByteString \nrandBS = do\n    randBytes &lt;- getEntropy 2048  \n    return randBytes\n\nmain :: IO ()\nmain = do\n    r &lt;- randBS\n    putStrLn $ unpack $ decodeUtf8With handler r \n</code></pre>\n\n<p><sup>Not tested, in this moment I don't have GHC installed :s</sup></p>\n\n<hr>\n\n<p>Probably even better is to simply use hexadecimal encoding instead of utf-8 + error handler. You can do so with the <a href=\"https://hackage.haskell.org/package/base16-bytestring\" rel=\"nofollow\"><code>base16-bytestring</code></a> library. So you'd first use the <a href=\"https://hackage.haskell.org/package/base16-bytestring-0.1.1.6/docs/Data-ByteString-Base16.html#v:encode\" rel=\"nofollow\"><code>encode :: ByteString -&gt; ByteString</code></a> to obtain a representation with only ASCII values:</p>\n\n<pre><code>import Data.Text                    (Text, pack, unpack)\nimport Data.ByteString              (ByteString)\nimport Data.ByteString.Encoding     (decodeUtf8)\nimport Data.ByteString.Base16       (encode)\nimport System.Entropy\n\n--- ... randBS as before\n\nmain = do\n    r &lt;- randBS\n    putStrLn $ unpack $ decodeUtf8 $ encode r \n</code></pre>\n"}], "owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 31097661, "answer_count": 1, "score": 1, "last_activity_date": 1435494720, "creation_date": 1435478955, "last_edit_date": 1435479874, "question_id": 31097451, "link": "https://stackoverflow.com/questions/31097451/converting-bytestring-generated-by-system-entropy-to-text", "title": "Converting ByteString Generated by System.Entropy to Text", "body": "<p>When I run this code, I get a decode error from <code>Data.Text</code>. What am I doing wrong? </p>\n\n<pre><code>import Data.Text                    (Text, pack, unpack)\nimport Data.Text.Encoding           (decodeUtf8)\nimport Data.ByteString              (ByteString)\nimport System.Entropy\n\nrandBS :: IO ByteString \nrandBS = do\n    randBytes &lt;- getEntropy 2048  \n    return randBytes\n\nmain :: IO ()\nmain = do\n    r &lt;- randBS\n    putStrLn $ unpack $ decodeUtf8 r \n</code></pre>\n\n<p><strong>Runtime Error:</strong></p>\n\n<pre><code>Cannot decode byte '\\xc4': Data.Text.Internal.Encoding.Fusion.streamUtf8:\nInvalid UTF-8 stream\n</code></pre>\n\n<p>I would like to generate some random bytes that will be used as an auth token. </p>\n\n<p>I am on <strong>Mac OS X (Yosemite)</strong> and <strong>GHC Version 7.10.1</strong></p>\n"}, {"tags": ["performance", "haskell", "functional-programming", "bytestring"], "comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1435473001, "post_id": 31096152, "comment_id": 50209661, "body": "Could you link to the file? On my computer your Haskell program runs 4 times faster than the Python one with a random 1000 x 1000 matrix (which is 13 Mb)."}, {"owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1435476673, "post_id": 31096152, "comment_id": 50210419, "body": "Here is the file: <a href=\"https://www.dropbox.com/s/5nhttzeytkxzmwm/telematrix?dl=0\" rel=\"nofollow noreferrer\">dropbox.com/s/5nhttzeytkxzmwm/telematrix?dl=0</a>"}, {"owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 2, "creation_date": 1435477764, "post_id": 31096152, "comment_id": 50210661, "body": "I think I might have figured out why it was so slow.  I was using runhaskell instead of compiling it with ghc and then running it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1435478185, "post_id": 31096152, "comment_id": 50210746, "body": "How does <code>ghc -O2</code> perform, then?"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 2, "creation_date": 1435483185, "post_id": 31096152, "comment_id": 50211795, "body": "@abden003 If it turns out it was indeed caused just by <code>runhaskell</code>, please consider adding it as your own answer (and accept it later) so that the question is marked as resolved."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1435504080, "post_id": 31096152, "comment_id": 50217787, "body": "You should use <code>foldl&#39; (+) 0</code> to sum integers, not <code>foldr (+) 0</code> (you&#39;ve manually fused this with another loop, but I hope you see what I mean)."}], "answers": [{"comments": [{"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 4, "creation_date": 1435473532, "post_id": 31096664, "comment_id": 50209764, "body": "<code>B.split</code> doesn&#39;t copy data, it returns slices. <code>ByteString</code> is definitely much faster than lists for the OP&#39;s task. Also, the <code>++</code> in <code>sumfile</code> is a one-off small O(n) cost per line that shouldn&#39;t affect the total runtime much."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1435478988, "post_id": 31096664, "comment_id": 50210879, "body": "I&#39;m quite sure using <code>ByteString</code> and <code>B.split</code> is ok and actually helps performance. The library is smart not to copy the arrays, it creates splices pointing to the original piece of data. In particular the documentation for <a href=\"https://hackage.haskell.org/package/bytestring-0.10.6.0/docs/Data-ByteString-Char8.html#v:split\" rel=\"nofollow noreferrer\"><code>split</code></a> says:  &gt; As for all splitting functions in this library, this function does not copy the substrings, it just constructs new ByteStrings that are slices of the original."}], "tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": false, "score": 0, "last_activity_date": 1435471510, "creation_date": 1435471510, "answer_id": 31096664, "question_id": 31096152, "link": "https://stackoverflow.com/questions/31096152/increasing-performance-in-file-manipulation/31096664#31096664", "title": "Increasing performance in file manipulation", "body": "<p>At a glance, I would bet your first bottleneck is in the <code>++</code> on strings in <code>sumfile</code>, which is destructuring the left operand each time and rebuilding it. Instead of appending <code>\"\\n\"</code> to the end, you could replace the <code>unwords</code> function call with <code>unlines</code>, which does exactly what you want it to here. That should get you a nice little speed boost.</p>\n\n<p>A more minor nitpick is that the <code>(*1)</code> in the <code>maybe</code> function is unneeded. Using <code>id</code> there would be more efficient, since <code>(*1)</code> wastes a multiplication operation, but that's no more than a few processor cycles.</p>\n\n<p>Then finally, I have to ask why you're using <code>ByteString</code>'s here. <code>ByteString</code>'s store string data efficiently as an array, like traditional strings in a more imperative language. However, what you're doing here involves splitting the string and iterating over the elements, which are operations that linked lists would be suited for. I would honestly recommend using the traditional <code>[Char]</code> type in this case. That <code>B.split</code> call may be what's ruining you, since it has to take the entire line and copy it into separate arrays of the split form, whereas the <code>words</code> function for linked lists of characters simply splits the linked structure off at a few points.</p>\n"}, {"tags": [], "owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "is_accepted": false, "score": 1, "last_activity_date": 1435537840, "creation_date": 1435537840, "answer_id": 31106230, "question_id": 31096152, "link": "https://stackoverflow.com/questions/31096152/increasing-performance-in-file-manipulation/31106230#31106230", "title": "Increasing performance in file manipulation", "body": "<p>It seems that he problem was that I was compiling and running the program with runhaskell as opposed to using ghc and then running the program.  By compiling first and then running, I increased performance to 1 second in Haskell</p>\n"}, {"tags": [], "owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "is_accepted": true, "score": 0, "last_activity_date": 1437510578, "creation_date": 1437510578, "answer_id": 31549000, "question_id": 31096152, "link": "https://stackoverflow.com/questions/31096152/increasing-performance-in-file-manipulation/31549000#31549000", "title": "Increasing performance in file manipulation", "body": "<p>The main reason for the poor performance was because I was using runhaskell instead of first compiling and then running the program.  So I switched from:</p>\n\n<pre><code>runhaskell program.hs\n</code></pre>\n\n<p>to</p>\n\n<pre><code>ghc program.hs\n\n./program\n</code></pre>\n"}], "owner": {"reputation": 1176, "user_id": 2415118, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f71ca7d457d223d598b1f439ff171ecd?s=128&d=identicon&r=PG", "display_name": "abden003", "link": "https://stackoverflow.com/users/2415118/abden003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 31549000, "answer_count": 3, "score": 1, "last_activity_date": 1437510578, "creation_date": 1435465815, "last_edit_date": 1435466106, "question_id": 31096152, "link": "https://stackoverflow.com/questions/31096152/increasing-performance-in-file-manipulation", "title": "Increasing performance in file manipulation", "body": "<p>I have a file which contains a matrix of numbers as following:</p>\n\n<pre><code>0 10 24 10 13 4 101 ...\n6 0 52 10 4 5 0 4 ...\n3 4 0 86 29 20 77 294 ...\n4 1 1 0 78 100 83 199 ...\n5 4 9 10 0 58 8 19 ...\n6 58 60 13 68 0 148 41 ...\n. .\n.   .\n.     .\n</code></pre>\n\n<p>What I am trying to do is sum each row and output the sum of each row to a new file (with the sum of each row on a new line).</p>\n\n<p>I have tried doing it in Haskell using ByteStrings, but the performance is 3 times a slow as the python implementation.  Here is the Haskell implementation:</p>\n\n<pre><code>import qualified Data.ByteString.Char8 as B\n\n-- This function is for summing a row\nsumrows r = foldr (\\x y -&gt; (maybe 0 (*1) $ fst &lt;$&gt; (B.readInt x)) + y) 0 (B.split ' ' r)\n\n-- This function is for mapping the sumrows function to each line\nsumfile f = map (\\x -&gt; (show x) ++ \"\\n\") (map sumrows (B.split '\\n' f)) \n\nmain = do\n  contents &lt;- B.readFile \"telematrix\"\n  -- I get the sum of each line, and then pack up all the results so that it can be written\n  B.writeFile \"teleDensity\" $ (B.pack . unwords) (sumfile contents)\n  print \"complete\"\n</code></pre>\n\n<p>This takes about 14 seconds for a 25 MB file.</p>\n\n<p>Here is the python implemenation</p>\n\n<pre><code>fd = open(\"telematrix\", \"r\")\nnfd = open(\"teleDensity\", \"w\")\n\nfor line in fd: \n  nfd.write(str(sum(map(int, line.split(\" \")))) + \"\\n\")\n\nfd.close()\nnfd.close()\n</code></pre>\n\n<p>This takes about 5 seconds for the same 25 MB file.</p>\n\n<p>Any suggestions on how to increase the Haskell implementation?</p>\n"}, {"tags": ["haskell", "monads", "persistent"], "answers": [{"comments": [{"owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 0, "creation_date": 1435479196, "post_id": 31096419, "comment_id": 50210915, "body": "Thank you, Michael. I don&#39;t fully understand how <code>runDb</code> gets inside <code>runMaybeT</code> and executes the statements but the code compiles :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "edited": false, "score": 1, "creation_date": 1435501173, "post_id": 31096419, "comment_id": 50216885, "body": "@Ecognium, the thing to do, typically, it&#39;s to write out the definitions of the types and expand them by hand. Pretend that the newtypes are just type synonyms."}], "tags": [], "owner": {"reputation": 30377, "user_id": 369198, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?s=128&d=identicon&r=PG", "display_name": "Michael Snoyman", "link": "https://stackoverflow.com/users/369198/michael-snoyman"}, "is_accepted": true, "score": 6, "last_activity_date": 1435468855, "creation_date": 1435468855, "answer_id": 31096419, "question_id": 31096081, "link": "https://stackoverflow.com/questions/31096081/chaining-db-insertions-without-explicitly-checking-for-success/31096419#31096419", "title": "Chaining DB Insertions Without Explicitly Checking for Success", "body": "<p>The standard approach to something like this is the <a href=\"http://haddock.stackage.org/nightly-2015-06-26/transformers-0.4.2.0/Control-Monad-Trans-Maybe.html\" rel=\"noreferrer\"><code>MaybeT</code> monad transformer</a>. Something like the following will probably work:</p>\n\n<pre><code>runMaybeT $ do\n    uid &lt;- MaybeT $ insertUnique user\n    ...\n</code></pre>\n"}], "owner": {"reputation": 1954, "user_id": 110844, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/a4afd458cb202c0a2e566e569f753765?s=128&d=identicon&r=PG", "display_name": "Ecognium", "link": "https://stackoverflow.com/users/110844/ecognium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 31096419, "answer_count": 1, "score": 1, "last_activity_date": 1435479394, "creation_date": 1435464761, "last_edit_date": 1435479394, "question_id": 31096081, "link": "https://stackoverflow.com/questions/31096081/chaining-db-insertions-without-explicitly-checking-for-success", "title": "Chaining DB Insertions Without Explicitly Checking for Success", "body": "<p>I am trying to figure out if there is a way to avoid lots of <code>case</code> statements while inserting records into the DB. </p>\n\n<p>My current code sort of looks like this:</p>\n\n<pre><code>mt1 &lt;- runDb $ do\n        muid &lt;- insertUnique user\n        case muid of \n            Just uid -&gt; do\n                let t1 = Table1 {..., user = uid} \n                maid  &lt;- insertUnique t1\n                case maid of\n                    Just aid -&gt; do \n                        mo &lt;- getBy $ UniqueField \"somevalue\" \n                        case mo of\n                            Just (Entity oid o) -&gt; do\n                                mcid &lt;- insertUnique Table2 {..., oid = oid} \n                                case mcid of\n                                    Just cid -&gt; do \n                                        mfid &lt;- insertUnique Table3 {..., cid = cid} \n                                        case mfid of \n                                            Just fid -&gt; Just t1 -- original t1 that was created at the top of the chain\n                                            Nothing  -&gt; Nothing\n                                    Nothing  -&gt; Nothing \n                            Nothing -&gt; Nothing \n                    Nothing -&gt; Nothing \n                Nothing -&gt; Nothing\n            Nothing  -&gt; Nothing\n</code></pre>\n\n<p>First of all, I have issues getting the code to compile but instead of trying to debug that, I wanted to see if there is a better way to do this. </p>\n\n<p>At a conceptual level, I want to do something like below, where all the <code>Maybe</code> values get unwrapped automatically to be used in subsequent invocations. If any point, we hit a <code>Nothing</code>, I just want to return <code>Nothing</code>. The whole code will run in a single transaction so if we hit a <code>Nothing</code> in between, the transaction is rolled back </p>\n\n<pre><code>runDb $ do\n    uid &lt;- insertUnique user\n    let t1 = Table1 {..., user = uid} -- uid is unwrapped to just the value \n    aid  &lt;- insertUnique t1\n    o &lt;- getBy $ UniqueField \"somevalue\"\n    cid &lt;- insertUnique Table2 {..., oid = oid}\n    fid &lt;- insertUnique Table3 {..., cid = cid} \n    Just t1 \n</code></pre>\n\n<p>I am Haskell beginner so I only have superficial understanding of Monads (I can use the simple ones fine) but when it comes to use it inside something like <code>runDb</code> of Persistent, I have no idea how to put the pieces together. </p>\n\n<p>Any suggestions on how I can simply the logic so I don't end up checking for failure each step of the way?</p>\n\n<p><strong>Update</strong>: Based on Michael's answer, I did something like this and it automatically unwraps the maybes when used. </p>\n\n<pre><code>mt1 &lt;- runDb $ runMaybeT $ do \n           uid &lt;- MaybeT $ insertUnique user\n           ... \ncase mt1 of\n    Just t -&gt; return t\n    Nothing -&gt; lift $ left ... \n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["haskell", "ghci", "ghc-mod"], "comments": [{"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1435463146, "post_id": 31095608, "comment_id": 50208139, "body": "In GHCi, <code>:cd</code> can change the current working directory - see <a href=\"http://stackoverflow.com/questions/20078059/specifying-the-search-path-for-load-operations-in-ghci\" title=\"specifying the search path for load operations in ghci\">stackoverflow.com/questions/20078059/&hellip;</a> ."}], "answers": [{"tags": [], "owner": {"reputation": 81794, "user_id": 9859, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/KEZOL.jpg?s=128&g=1", "display_name": "rampion", "link": "https://stackoverflow.com/users/9859/rampion"}, "is_accepted": true, "score": 5, "last_activity_date": 1435462523, "creation_date": 1435462523, "answer_id": 31095896, "question_id": 31095608, "link": "https://stackoverflow.com/questions/31095608/why-does-ghci-not-use-relative-paths/31095896#31095896", "title": "Why does ghci not use relative paths?", "body": "<p>The flag you're looking for is <code>-i&lt;dir&gt;</code>:</p>\n\n<pre><code>% ghci --help\nUsage:\n\n    ghci [command-line-options-and-input-files]\n\n...\n\nIn addition, ghci accepts most of the command-line options that plain\nGHC does.  Some of the options that are commonly used are:\n\n    -i&lt;dir&gt;         Search for imported modules in the directory &lt;dir&gt;.\n</code></pre>\n\n<p>For example</p>\n\n<pre><code>% ls src\nBar.hs Foo.hs\n% ghci -isrc\nGHCi, version 7.8.2: http://www.haskell.org/ghc/  :? for help\nLoading package ghc-prim ... linking ... done.\nLoading package integer-gmp ... linking ... done.\nLoading package base ... linking ... done.\n\u03bb :l Foo\n[1 of 1] Compiling Foo              ( src/Foo.hs, interpreted )\nOk, modules loaded: Foo.\n\u03bb :l Bar\n[1 of 2] Compiling Foo              ( src/Foo.hs, interpreted )\n[2 of 2] Compiling Bar              ( src/Bar.hs, interpreted )\nOk, modules loaded: Foo, Bar.\n</code></pre>\n\n<p>You can also <a href=\"https://github.com/eagletmt/ghcmod-vim#details\" rel=\"noreferrer\">pass <code>ghc-mod</code> the <code>-i&lt;dir&gt;</code> flag from within <code>ghcmod.vim</code></a></p>\n\n<blockquote>\n  <p>If you'd like to give GHC options, set <code>g:ghcmod_ghc_options</code>.</p>\n\n<pre><code>let g:ghcmod_ghc_options = ['-idir1', '-idir2']\n</code></pre>\n  \n  <p>Also, there's buffer-local version <code>b:ghcmod_ghc_options</code>.</p>\n\n<pre><code>autocmd BufRead,BufNewFile ~/.xmonad/* call s:add_xmonad_path()\nfunction! s:add_xmonad_path()\n  if !exists('b:ghcmod_ghc_options')\n    let b:ghcmod_ghc_options = []\n  endif\n  call add(b:ghcmod_ghc_options, '-i' . expand('~/.xmonad/lib'))\nendfunction\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 2052, "user_id": 3949424, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb2f4d411841f6c34bdee2d0769ef96e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramith Jayatilleka", "link": "https://stackoverflow.com/users/3949424/ramith-jayatilleka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 31095896, "answer_count": 1, "score": 3, "last_activity_date": 1435462523, "creation_date": 1435458962, "last_edit_date": 1435459405, "question_id": 31095608, "link": "https://stackoverflow.com/questions/31095608/why-does-ghci-not-use-relative-paths", "title": "Why does ghci not use relative paths?", "body": "<p>If I have a project structured like this:</p>\n\n<pre><code>project/\n  src/\n    Foo.hs\n    Bar.hs\n</code></pre>\n\n<p>With files Foo.hs:</p>\n\n<pre><code>module Foo where  \n\nfoo :: String\nfoo = \"foo\"\n</code></pre>\n\n<p>and Bar.hs:</p>\n\n<pre><code>module Bar where\n\nimport Foo \n\nbar :: String\nbar = foo ++ \"bar\"\n</code></pre>\n\n<p>If my current directory is <code>src</code>, and I enter ghci and run <code>:l Bar.hs</code>, I get the expected output:</p>\n\n<pre><code>[1 of 2] Compiling Foo              ( Foo.hs, interpreted )\n[2 of 2] Compiling Bar              ( Bar.hs, interpreted )\nOk, modules loaded: Bar, Foo.\n</code></pre>\n\n<p>But if I move up to the <code>project</code> directory (which is where I'd prefer to stay and run vim/ghci/whatever), and try <code>:l src/Bar.hs</code>, I get:</p>\n\n<pre><code>src/Bar.hs:3:8:\n    Could not find module \u2018Foo\u2019\n    Use -v to see a list of the files searched for.\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Why does ghc not search for Foo in the same directory as Bar? Can I make it do so? And can I propagate that change up to ghc-mod and then to ghcmod.vim? Because I get errors about can't find module when I'm running my syntax checker or ghc-mod type checker in vim.</p>\n\n<p>I'm running ghc 7.10.1.</p>\n"}, {"tags": ["haskell", "haskell-platform", "haddock"], "comments": [{"owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "edited": false, "score": 0, "creation_date": 1435553900, "post_id": 31095109, "comment_id": 50230552, "body": "What OS are you using? If you&#39;re using a Debian derivative, the documentation is in <code>haskell-platform-doc</code>."}], "answers": [{"tags": [], "owner": {"reputation": 11412, "user_id": 617159, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fc43cf2d76ce0981a21c0e5a817f96f5?s=128&d=identicon&r=PG", "display_name": "Lambda Fairy", "link": "https://stackoverflow.com/users/617159/lambda-fairy"}, "is_accepted": true, "score": 4, "last_activity_date": 1435555054, "creation_date": 1435555054, "answer_id": 31108247, "question_id": 31095109, "link": "https://stackoverflow.com/questions/31095109/haddock-could-not-find-link-destinations-for/31108247#31108247", "title": "haddock &quot;could not find link destinations for&quot;", "body": "<p>On Debian and Ubuntu, the Haskell Platform documentation is provided in a separate package (<code>haskell-platform-doc</code>). You can install it using <code>apt-get</code>:</p>\n\n<pre><code>sudo apt-get install haskell-platform-doc\n</code></pre>\n\n<p>I recommend installing the profiling libraries (<code>haskell-platform-prof</code>) as well.</p>\n"}], "owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1200, "favorite_count": 0, "accepted_answer_id": 31108247, "answer_count": 1, "score": 4, "last_activity_date": 1435555054, "creation_date": 1435452919, "question_id": 31095109, "link": "https://stackoverflow.com/questions/31095109/haddock-could-not-find-link-destinations-for", "title": "haddock &quot;could not find link destinations for&quot;", "body": "<p>I tried using haddock to generate documentation for a library and while it works, it won't link any types that are part of GHC/the standard libraries and emits this error:</p>\n\n<pre><code>Warning: The documentation for the following packages are not installed. No\nlinks will be generated to these packages: array-0.4.0.1, base-4.6.0.1,\nbinary-0.5.1.1, rts-1.0, bytestring-0.10.0.2, containers-0.5.0.0,\ndeepseq-1.3.0.1, ghc-prim-0.3.0.0, integer-gmp-0.5.0.0, utf8-string-1\nHaddock coverage:\n  93% ( 14 / 15) in 'projectname'\nWarning: SHA1: could not find link destinations for:\n    GHC.Base.String Data.ByteString.Lazy.Internal.ByteString GHC.Word.Word32 GHC.Integer.Type.Integer GHC.Types.Int Data.Sequence.Seq\n</code></pre>\n\n<p>Now I googled around and found that the solution would be trying to reinstall those packages with <code>haddock install array-0.4.0.1 base-4.6.0.1 binary-0.5.1.1 rts-1.0 bytestring-0.10.0.2 containers-0.5.0.0 deepseq-1.3.0.1 ghc-prim-0.3.0.0 integer-gmp-0.5.0.0 utf8-string-1 --enable-documentation</code> but it fails with</p>\n\n<pre><code>cabal: Could not resolve dependencies:\nrejecting: base-4.8.0.0, 4.7.0.2, 4.7.0.1, 4.7.0.0 (global constraint requires\n==4.6.0.1)\nrejecting: base-4.6.0.1 (only already installed instances can be used)\nrejecting: base-4.6.0.0, 4.5.1.0, 4.5.0.0, 4.4.1.0, 4.4.0.0, 4.3.1.0, 4.3.0.0,\n4.2.0.2, 4.2.0.1, 4.2.0.0, 4.1.0.0, 4.0.0.0, 3.0.3.2, 3.0.3.1 (global\nconstraint requires ==4.6.0.1)\n</code></pre>\n\n<p>and also doesn't even find a package called rts. What is going on?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 0, "creation_date": 1435450002, "post_id": 31094728, "comment_id": 50205990, "body": "CPU time is the time assigned by the system to your application. Wall clock time is the real time as we use on earth (Einstein might have some things to say about that). So your application got less then 100% of the wall clock time available (only about 45%). The rest was spent on something else."}, {"owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "reply_to_user": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 0, "creation_date": 1435450254, "post_id": 31094728, "comment_id": 50206033, "body": "@NorbertvanNobelen Something completely external to the program? I ask because my computer didn&#39;t do any hard work during the execution that would take that much resources, so something is a bit peculiar to me, and I&#39;m a bit worried it&#39;s my program that&#39;s misbehaving."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 7, "last_activity_date": 1435457976, "creation_date": 1435457976, "answer_id": 31095516, "question_id": 31094728, "link": "https://stackoverflow.com/questions/31094728/how-can-the-cpu-time-be-lower-than-wall-clock-time-on-ghcs-rts-stats/31095516#31095516", "title": "How can the CPU time be lower than wall-clock time on GHC&#39;s RTS stats?", "body": "<p>Wall-clock time includes time spent waiting for the network, disk, user input, etc. whereas CPU time only includes time actively spent computing something on (exactly) one CPU. (When computing on multiple CPUs, the time spent on each is added together.)</p>\n"}], "owner": {"reputation": 18999, "user_id": 825637, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/825a58fde1ef99db42c5354dab6cd472?s=128&d=identicon&r=PG", "display_name": "MasterMastic", "link": "https://stackoverflow.com/users/825637/mastermastic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 31095516, "answer_count": 1, "score": 1, "last_activity_date": 1435457976, "creation_date": 1435448874, "last_edit_date": 1435450390, "question_id": 31094728, "link": "https://stackoverflow.com/questions/31094728/how-can-the-cpu-time-be-lower-than-wall-clock-time-on-ghcs-rts-stats", "title": "How can the CPU time be lower than wall-clock time on GHC&#39;s RTS stats?", "body": "<p>I have a program linked with <code>-rtsopts</code> and called with <code>+RTS -s</code> and on the timing I get this:</p>\n\n<pre><code>  INIT    time    0.000s  (  0.001s elapsed)\n  MUT     time    4.047s  (  9.694s elapsed)\n  GC      time    0.578s  (  0.514s elapsed)\n  RP      time    0.000s  (  0.000s elapsed)\n  PROF    time    0.000s  (  0.004s elapsed)\n  EXIT    time    0.000s  (  0.000s elapsed)\n  Total   time    4.625s  ( 10.209s elapsed)\n</code></pre>\n\n<p>This program was running for about 10 seconds.\nIt's linked with the threaded RTS but it uses <code>-N1</code> so I don't get why there would be a difference in the first place between wall-clock time and CPU time.</p>\n\n<p>And I just found this in the GHC user guide:</p>\n\n<blockquote>\n  <p>Next there is the CPU time and wall clock time elapsed broken down by\n  what the runtime system was doing at the time.</p>\n</blockquote>\n\n<p>So, how does it make sense that the CPU time is lower than wall-clock time?</p>\n\n<p>Note: my computer didn't do any hard work during the execution of my program, certainly not that much.. which is why I'm confused and worry my program is misbehaving.</p>\n\n<p>Update: I think I may have found the culprit: does the RTS count the cpu time for IO? if it doesn't then that's probably the reason, there are tons of writes.</p>\n"}, {"tags": ["haskell", "time"], "comments": [{"owner": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 3, "creation_date": 1435434971, "post_id": 31092875, "comment_id": 50202270, "body": "This was confusing for me too.  Notice that <code>NominalDiffTime</code> is an instance of <code>Num</code>, which means it supports numeric literals. E.g. <code>1 :: NominalDiffTime</code>.  Not sure what that means, but it&#39;s probably enough to get you started."}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "reply_to_user": {"reputation": 57219, "user_id": 33796, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/08727b23ba62e634b32988cdff082663?s=128&d=identicon&r=PG", "display_name": "luqui", "link": "https://stackoverflow.com/users/33796/luqui"}, "edited": false, "score": 0, "creation_date": 1435444145, "post_id": 31092875, "comment_id": 50204768, "body": "Thanks. Correct if i am wrong: this is not visible in the documentation <a href=\"http://hackage.haskell.org/package/time-1.2.0.3/docs/Data-Time-Clock.html#t:NominalDiffTime\" rel=\"nofollow noreferrer\">generated by Haddock</a>, so one should look at the source, right?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1435444852, "post_id": 31092875, "comment_id": 50204948, "body": "@danza Under the documentation for the type, it lists classes it is an instance of, including <code>Num</code>, so this information is indeed in the generated haddocks. The (human-written) documentation also says, &quot;Conversion functions will treat it as seconds.&quot;."}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "edited": false, "score": 0, "creation_date": 1435445799, "post_id": 31092875, "comment_id": 50205147, "body": "Thanks! Now i understood better how to read the <i>instances</i> section!"}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "edited": false, "score": 0, "creation_date": 1435446467, "post_id": 31092875, "comment_id": 50205311, "body": "Now i understand the source of my confusion about <i>instances</i>. Under type classes they will list implementing types, while under a concrete type they will list implemented type classes."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1435515626, "post_id": 31092875, "comment_id": 50221387, "body": "1 :: NominalDiffTime is one second. However &quot;succ&quot; applied to either a UTCTime or a NominalDiffTime will increment it by 1 picosecond. In the past I&#39;ve been caught out writing [t1 .. t2] and wondering why it was taking so long."}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1504806246, "post_id": 31092875, "comment_id": 79167261, "body": "Not trying to be pedantic &quot;time interval&quot; is not what you&#39;re looking for in that argument. Using a geometric analogy: an interval is a line segment (and can be &quot;closed&quot; or &quot;open&quot; on either end). You&#39;re looking for something like a geometric vector (a &quot;length of time&quot;, i.e. having only a magnitude and (incidentally or interestingly?) a direction (forward)) see also <a href=\"http://math.ucr.edu/home/baez/torsors.html\" rel=\"nofollow noreferrer\">math.ucr.edu/home/baez/torsors.html</a>"}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1505318027, "post_id": 31092875, "comment_id": 79366756, "body": "thanks for the observation @jberryman. how would you call this? i guess that it could be called &quot;time sampling&quot;? once agreed i can rename ... keeping a reference to the old name for findability"}, {"owner": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 1, "creation_date": 1505319960, "post_id": 31092875, "comment_id": 79367942, "body": "@danza I&#39;m not sure right off the top of my head (and it&#39;s probably fine to keep this name for searchability; probably other people will use the same terminology). And actually &quot;time interval&quot; does seem to be common usage, just scanning wikipedia, so I guess I retract my comment haha. It would be very nice if there was good terminology for talking about this sort of thing"}, {"owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "reply_to_user": {"reputation": 15757, "user_id": 176841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/45a168cb9eb8454d66c78f18e29d9342?s=128&d=identicon&r=PG", "display_name": "jberryman", "link": "https://stackoverflow.com/users/176841/jberryman"}, "edited": false, "score": 0, "creation_date": 1505391823, "post_id": 31092875, "comment_id": 79400518, "body": "@jberryman maybe &quot;sampling sequence&quot;? with reference to <a href=\"https://en.wikipedia.org/wiki/Sampling_(signal_processing)#Theory\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Sampling_(signal_processing)#Theory</a>"}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1435436506, "last_edit_date": 1435436506, "creation_date": 1435436281, "answer_id": 31093111, "question_id": 31092875, "link": "https://stackoverflow.com/questions/31092875/how-to-express-time-intervals-in-haskell/31093111#31093111", "title": "How to express time intervals in Haskell?", "body": "<p>In ghci:</p>\n\n<pre><code>Data.Time&gt; now &lt;- getCurrentTime\nData.Time&gt; let tenMinutes = 10*60\nData.Time&gt; mapM_ print . take 10 . iterate (addUTCTime tenMinutes) $ now \n2015-06-27 20:14:21.445443 UTC\n2015-06-27 20:24:21.445443 UTC\n2015-06-27 20:34:21.445443 UTC\n2015-06-27 20:44:21.445443 UTC\n2015-06-27 20:54:21.445443 UTC\n2015-06-27 21:04:21.445443 UTC\n2015-06-27 21:14:21.445443 UTC\n2015-06-27 21:24:21.445443 UTC\n2015-06-27 21:34:21.445443 UTC\n2015-06-27 21:44:21.445443 UTC\n</code></pre>\n\n<p>Note that <code>NominalDiffTime</code> (as used here) ignores leap seconds; that is, adding <code>60*60*24</code> will produce the same time with a different date, even if there are actually <code>60*60*24+1</code> seconds between those two UTC times. This is often (but not always) what you want. If you want to be leap-second aware, you can use <code>AbsoluteTime</code> and <code>DiffTime</code> instead of <code>UTCTime</code> and <code>NominalDiffTime</code>.</p>\n\n<hr>\n\n<p>and of course your function could just be:</p>\n\n<pre><code>import Data.Time.Clock\n\ntimeSeq :: UTCTime -&gt; NominalDiffTime -&gt; [UTCTime]\ntimeSeq start interval = iterate (addUTCTime delta) start\n</code></pre>\n"}], "owner": {"reputation": 9281, "user_id": 393758, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/3ee15f717c343aabe3e14db32c22130b?s=128&d=identicon&r=PG", "display_name": "danza", "link": "https://stackoverflow.com/users/393758/danza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 602, "favorite_count": 0, "accepted_answer_id": 31093111, "answer_count": 1, "score": 3, "last_activity_date": 1435436506, "creation_date": 1435434589, "question_id": 31092875, "link": "https://stackoverflow.com/questions/31092875/how-to-express-time-intervals-in-haskell", "title": "How to express time intervals in Haskell?", "body": "<p>I am trying to generate a sequence of dates separated at regular intervals, for example, starting from now, i want to produce the list:</p>\n\n<pre><code>[now, now + 10 minutes, now + 20 minutes, now + 30 minutes, ...]\n</code></pre>\n\n<p>My function will be based upon <code>iterate</code> and have two arguments, <code>start</code> and <code>interval</code> but which should be the types of those arguments? I have been wandering in the library and the wiki, without success. It seems that the recommended way to encode a time is using <code>UTCTime</code> from <code>Data.Time.Clock</code>, and the recommended way to encode a time difference is <code>NominalDiffTime</code>, but how do i generate a nominal time difference of one day? For example?</p>\n\n<p>It seems that the <code>time-lens</code> package provides ways to do this, but as far as i know lenses are a way to improve expressiveness, i would be surprised if using lenses was the only way to solve this problem</p>\n"}, {"tags": ["function", "haskell", "lambda", "substitution"], "comments": [{"owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "edited": false, "score": 4, "creation_date": 1435430914, "post_id": 31092265, "comment_id": 50201025, "body": "please don&#39;t hesitate to show us your code"}], "answers": [{"comments": [{"owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "edited": false, "score": 0, "creation_date": 1435431372, "post_id": 31092349, "comment_id": 50201169, "body": "but of course I must have used application... Thanks!!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 1, "last_activity_date": 1435431167, "creation_date": 1435431167, "answer_id": 31092349, "question_id": 31092265, "link": "https://stackoverflow.com/questions/31092265/substitution-function-for-lambda-expression/31092349#31092349", "title": "Substitution function for Lambda expression", "body": "<p>Well, the definition is simply a rewriting of</p>\n\n<pre><code>(E1 E2)[v-&gt;E] = E1[v-&gt;E] E2[v -&gt; E]\n</code></pre>\n\n<p>into Haskell syntax. First we use <code>sub</code> instead of the <code>[v -&gt; E]</code> notation.</p>\n\n<pre><code>sub (E1 E2) v E = (sub E1 v E) (sub E2 v E)\n</code></pre>\n\n<p>Then we make syntactic application between <code>LExpr</code>s explicit.</p>\n\n<pre><code>sub (App E1 E2) v E = App (sub E1 v E) (sub E2 v E)\n</code></pre>\n\n<p>Finally, we use lowercase names for variables, since Haskell reserves uppercase ones for constructors.</p>\n\n<pre><code>sub (App e1 e2) v e = App (sub e1 v e) (sub e2 v e)\n</code></pre>\n"}], "owner": {"reputation": 3566, "user_id": 4325010, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/048bff2cd5cae6d0a93ecd485f6690ad?s=128&d=identicon&r=PG&f=1", "display_name": "users at 4325010", "link": "https://stackoverflow.com/users/4325010/users-at-4325010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 31092349, "answer_count": 1, "score": -1, "last_activity_date": 1435431167, "creation_date": 1435430714, "question_id": 31092265, "link": "https://stackoverflow.com/questions/31092265/substitution-function-for-lambda-expression", "title": "Substitution function for Lambda expression", "body": "<p>I am currently writing the function and I am unable to get around the 4th case and that is:</p>\n\n<blockquote>\n  <p>(E1 E2)[v->E] = E1[v->E] E2[v -> E]</p>\n</blockquote>\n\n<p>I have already defined the first 3(for a constant and variable) but this turns out to be little too tricky for me. </p>\n\n<p>However, the function signature is: </p>\n\n<pre><code>sub :: LExpr -&gt; String -&gt; LExpr -&gt; LExpr \n</code></pre>\n\n<p>I am confused first how to represent the argument <code>(E1 E2)</code> and later how to do the <code>E1[v-&gt;E] E2[v -&gt; E]</code>-part. I think <code>++</code> doesn`t work here because the outcome must be lambda expression and not String.</p>\n\n<p>The definition of <code>data LExpr</code> is the \"common\" one for Haskell and uses <code>Eq</code> and <code>Show</code>. If needed I can provide it, but it is pretty basic and you must be well acquainted with it. </p>\n"}, {"tags": ["json", "haskell", "haskell-pipes"], "answers": [{"comments": [{"owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "edited": false, "score": 0, "creation_date": 1436483942, "post_id": 31094307, "comment_id": 50645590, "body": "I found a way to do it with JsonStream and Pipes: <a href=\"https://gist.github.com/joelthelion/7d4d4b44120607b63035\" rel=\"nofollow noreferrer\">gist.github.com/joelthelion/7d4d4b44120607b63035</a> . It&#39;s not perfect but it works. Anyways, thanks for confirming that Aeson wasn not the right tool."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1435445306, "creation_date": 1435445306, "answer_id": 31094307, "question_id": 31090783, "link": "https://stackoverflow.com/questions/31090783/subsampling-a-huge-json-array-with-haskell/31094307#31094307", "title": "Subsampling a huge json array with Haskell", "body": "<p>I believe you will not be able to reuse aeson for this. From the <a href=\"http://hackage.haskell.org/package/aeson-0.9.0.1/docs/Data-Aeson-Parser.html\" rel=\"nofollow\">aeson <code>Parser</code> documentation</a>:</p>\n\n<blockquote>\n  <p>It can be useful to think of parsing as occurring in two phases:</p>\n  \n  <ul>\n  <li>Identification of the textual boundaries of a JSON value. This is always strict, so that an invalid JSON document can be rejected as soon as possible.</li>\n  <li>Conversion of a JSON value to a Haskell value. This may be either immediate (strict) or deferred (lazy); see below for details.</li>\n  </ul>\n</blockquote>\n\n<p>The first bullet seems to imply (to me, at least) that the parser will not hand you anything until it has inspected enough of the string it is supposed to be parsing to know whether parsing succeeded or failed -- in your case, that's almost certainly the entire string. So this phase will put (some representation of) the entire object in memory at once.</p>\n\n<p>This property is true of most parser combinator libraries at the moment. You could consider looking into <a href=\"http://hackage.haskell.org/package/uu-parsinglib\" rel=\"nofollow\">uu-parsinglib</a> as an alternative; I believe it supports returning partial parses. There is a very readable paper describing its capabilities linked from its Hackage page.</p>\n"}], "owner": {"reputation": 45996, "user_id": 164171, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/dec2e1cd575b184c3695fe6d18a24638?s=128&d=identicon&r=PG", "display_name": "static_rtti", "link": "https://stackoverflow.com/users/164171/static-rtti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 1, "accepted_answer_id": 31094307, "answer_count": 1, "score": 4, "last_activity_date": 1435445306, "creation_date": 1435421610, "last_edit_date": 1435422934, "question_id": 31090783, "link": "https://stackoverflow.com/questions/31090783/subsampling-a-huge-json-array-with-haskell", "title": "Subsampling a huge json array with Haskell", "body": "<p>I have a huge Json file that I would like to avoid loading entirely to memory. Its structure is pretty simple: it consists of a large array with arbitrary elements inside. I'd simply like to transform the array by randomly dropping most of the elements, and simply outputting the transformed Json.</p>\n\n<p>Haskell seems well suited to this problem with all the laziness, and I thought it would make a nice Haskell exercise (I'm not an expert, and I don't know much FP theory).</p>\n\n<p>I've found pipes-aeson [1] which seems to be what I want, but after trying for a while, I have to admit I'm stuck. There are almost no examples, and while I can work with Pipes to downsample data, working with a Parser object seems more complicated. The option I've found (evalStateT) is strict and parses the whole thing, without letting me intervene.</p>\n\n<p>Maybe Lenses would be the solution to my problem, but they're very abstract I don't get what they are nor how to use them.</p>\n\n<p>Could someone more knowledgeable than I am provide a little guidance?</p>\n\n<p>[1] <a href=\"https://hackage.haskell.org/package/pipes-aeson-0.4.1.3/docs/Pipes-Aeson.html#t:DecodingError\" rel=\"nofollow\">https://hackage.haskell.org/package/pipes-aeson-0.4.1.3/docs/Pipes-Aeson.html#t:DecodingError</a></p>\n"}, {"tags": ["function", "haskell", "arguments"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1435422367, "post_id": 31090746, "comment_id": 50198399, "body": "I&#39;m having a hard time understanding this -- can you elaborate your example further? Maybe in the last case you simply want to pass a tuple <code>(myfunc, args)</code> instead of the application <code>myfunc args</code>?"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1435422590, "post_id": 31090746, "comment_id": 50198453, "body": "What is the type of <code>func2</code>?"}, {"owner": {"reputation": 3, "user_id": 3147228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad48412a73cdfa9bd9f8d9298095728d?s=128&d=identicon&r=PG&f=1", "display_name": "matultimate", "link": "https://stackoverflow.com/users/3147228/matultimate"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1435423148, "post_id": 31090746, "comment_id": 50198608, "body": "@duplode: Int -&gt; (a -&gt; a) -&gt; a -&gt; a"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1435423693, "post_id": 31090746, "comment_id": 50198770, "body": "...and then you want to pass <code>func2</code> as the argument of type <code>a -&gt; a</code>, and the result of scenario #1 as the argument of type <code>a</code>?"}, {"owner": {"reputation": 3, "user_id": 3147228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad48412a73cdfa9bd9f8d9298095728d?s=128&d=identicon&r=PG&f=1", "display_name": "matultimate", "link": "https://stackoverflow.com/users/3147228/matultimate"}, "reply_to_user": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1435424201, "post_id": 31090746, "comment_id": 50198923, "body": "yep @duplode, but the result of scenario I cant be evaluated i believe, it seems that a is actualy one argument, instead of three (as ... is a argument)"}], "answers": [{"tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 3, "last_activity_date": 1435426378, "creation_date": 1435426378, "answer_id": 31091541, "question_id": 31090746, "link": "https://stackoverflow.com/questions/31090746/haskell-pass-a-function-and-its-arguments-as-separate-arguments/31091541#31091541", "title": "Haskell - Pass a function and its arguments as separate arguments", "body": "<p>When you get type errors, the first thing to do is to review the types of all involved expressions. Your <code>func2</code> has type</p>\n\n<pre><code>func2 :: Int -&gt; (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>so the full expression in scenario #1 would be something like</p>\n\n<pre><code>func2 n myfunc args\n</code></pre>\n\n<p>with <code>n :: Int</code>, <code>myFunc :: a -&gt; a</code> and <code>args :: a</code> for some <code>a</code>. Then you want to do, for some <code>m :: Int</code></p>\n\n<pre><code>func2 m func2 (n myfunc args)\n</code></pre>\n\n<p>but the types won't match. <code>func2</code> is not an <code>a -&gt; a</code> function; you need to supply the first two arguments to get one (by the way, you can also read the type of <code>func2</code> as <code>Int -&gt; (a -&gt; a) -&gt; (a -&gt; a)</code> - a function of two arguments that results in an <code>a -&gt; a</code> function). As for the final argument, <code>n myfunc args</code> would mean applying <code>n</code> to <code>myfunc</code> and <code>args</code>, which won't work as <code>n</code> is an <code>Int</code>, and not even a function. You simply want to pass the full expression of scenario #1, which has the expected <code>a</code> type. So scenario #2 might read:</p>\n\n<pre><code>func2 m (func2 m myfunc) (func2 n myfunc args)\n</code></pre>\n\n<p>That will at least get past the type checker.</p>\n"}], "owner": {"reputation": 3, "user_id": 3147228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad48412a73cdfa9bd9f8d9298095728d?s=128&d=identicon&r=PG&f=1", "display_name": "matultimate", "link": "https://stackoverflow.com/users/3147228/matultimate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1186, "favorite_count": 0, "accepted_answer_id": 31091541, "answer_count": 1, "score": -1, "last_activity_date": 1435426378, "creation_date": 1435421376, "question_id": 31090746, "link": "https://stackoverflow.com/questions/31090746/haskell-pass-a-function-and-its-arguments-as-separate-arguments", "title": "Haskell - Pass a function and its arguments as separate arguments", "body": "<p>I'd like to pass a function and its arguments separatedly</p>\n\n<p>Now I've got a function, lets call it myfunc, that takes a single argument.</p>\n\n<p>I've got another function (func2), that takes multiple arguments, of which the last two are a function (f) and its arguments (a). I cannot pass them together as I need them separatly.</p>\n\n<p>(... represents other arguments)</p>\n\n<p>I've managed to do (SCENARIO I):</p>\n\n<pre><code>func2 ... myfunc args\n</code></pre>\n\n<p>But when I try and do (pass SCENARIO I as 2 last arguments to main func2):</p>\n\n<pre><code>func2 ... func2 (... myfunc args)\n</code></pre>\n\n<p>I get an error. I believe myfunc is evaluating and the second func2 is getting missing arguments. What do?</p>\n"}, {"tags": ["haskell", "monads"], "comments": [{"owner": {"reputation": 31301, "user_id": 1598537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c214754fba6f3a238a93af85a0ab4f58?s=128&d=identicon&r=PG", "display_name": "AndrewC", "link": "https://stackoverflow.com/users/1598537/andrewc"}, "edited": false, "score": 2, "creation_date": 1435522546, "post_id": 31090228, "comment_id": 50223765, "body": "This is not opinion based as (a) the Reader monad has very precise semantics and (b) the actual question has a limited scope compared to the title. I&#39;ll edit the title to make that clearer."}], "answers": [{"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 4, "last_activity_date": 1435419013, "creation_date": 1435419013, "answer_id": 31090369, "question_id": 31090228, "link": "https://stackoverflow.com/questions/31090228/is-it-correct-to-use-the-reader-monad-in-this-turn-based-game/31090369#31090369", "title": "Is it correct to use the Reader monad in this turn-based game?", "body": "<p>The <code>Reader</code> monad is used when you have an <em>immutable</em> state that you want to read in your computation.  Is basically like having an extra argument implicitly passed to all the monadic actions.</p>\n\n<p>It seems like in your game you actually want to <em>change</em> something (i.e. turn, or state of the game). In this case a <code>State</code> monad may be easier to work with.</p>\n\n<p>In order to use <code>Reader</code> you have to group all actions that depend on the state, execute them in the monad then <em>outside</em> the monad change the state and run a new monadic computation with the modified state etc. This sounds cumbersome.</p>\n\n<p>Note that using <code>Reader</code> is actually similar to using <code>State</code>. Simply: the <code>put</code> operation (and derivatives) are disallowed. So you could start writing using <code>Reader</code> and if you encounter a place were you'd like to modify the state you know that it would probably be better to use <code>State</code>.\nOr viceversa: start by using <code>State</code> and if you end up never modifying the state replace it with <code>Reader</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 4, "last_activity_date": 1435419190, "creation_date": 1435419190, "answer_id": 31090398, "question_id": 31090228, "link": "https://stackoverflow.com/questions/31090228/is-it-correct-to-use-the-reader-monad-in-this-turn-based-game/31090398#31090398", "title": "Is it correct to use the Reader monad in this turn-based game?", "body": "<p>It seems reasonable to have something like <code>StateT Turn (ReaderT Game IO)</code>, assuming <code>Turn</code> value changes every turn and <code>Game</code> doesn't. You'll need to read up on monad transformers for this (I personally like <a href=\"http://www.cs.virginia.edu/~wh5a/personal/Transformers.pdf\" rel=\"nofollow\">\"Monad Transformers Step by Step\" (PDF)</a>).</p>\n"}], "owner": {"reputation": 34692, "user_id": 356440, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d16fc2844c1d9f8f815f318734554266?s=128&d=identicon&r=PG", "display_name": "Stephane Rolland", "link": "https://stackoverflow.com/users/356440/stephane-rolland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 31090369, "answer_count": 2, "score": 5, "last_activity_date": 1435526336, "creation_date": 1435418104, "last_edit_date": 1435522703, "question_id": 31090228, "link": "https://stackoverflow.com/questions/31090228/is-it-correct-to-use-the-reader-monad-in-this-turn-based-game", "title": "Is it correct to use the Reader monad in this turn-based game?", "body": "<p>I need to learn to use the Reader monad. (And also the Writer and State).</p>\n\n<p>The game-contests I do always consists in global parameters that are valid throughout the Game. And a bunch of parameters that are valid only during one Turn.</p>\n\n<p>I ended all the latest contests with lots and lots of functions that almost all had Game and Turn as input parameters.</p>\n\n<p>After having read about the reader monad, I am thinking about having:</p>\n\n<pre><code>data Game = Game AllNeeded StrategicPositions AndGameRelatedStuffs\ndata Turn = Turn PlayersPositions AndTurnDependentStuffs \n</code></pre>\n\n<p>and for each loop when I receive turn dependent data, I plan to have a variable <code>Reader Game Turn</code>:</p>\n\n<pre><code>turnReader = Reader currentGame currentTurn\nlet actionToPerform = play turnReader\n</code></pre>\n\n<p>Do you think it's the good example of application for the Reader monad ?\nDo you think I can/should go blindfold and learn to use the Reader monad in this context ? Or is there a more appropriate monad for this, like State ?</p>\n"}, {"tags": ["haskell", "lazy-evaluation"], "answers": [{"comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 1, "creation_date": 1435471952, "post_id": 31090211, "comment_id": 50209476, "body": "It&#39;s also worth noting that, interestingly, it explicitly defines how to construct a thunk, so you can change some functions&#39; behaviours with it, such as <code>foldl&#39;</code>."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435484064, "post_id": 31090211, "comment_id": 50212011, "body": "@AJFarmar that sounds interesting, could you open up or drop a link with more details?"}, {"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 2, "creation_date": 1435485446, "post_id": 31090211, "comment_id": 50212361, "body": "This may be useful: <a href=\"https://wiki.haskell.org/Let_vs._Where\" rel=\"nofollow noreferrer\">wiki.haskell.org/Let_vs._Where</a> . You may have to do some wider reading, however. Also, here&#39;s the source of <code>foldl&#39;</code>: <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/src/Data-Foldable.html#foldl%27\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.8.0.0/docs/src/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": true, "score": 6, "last_activity_date": 1435418036, "creation_date": 1435418036, "answer_id": 31090211, "question_id": 31090119, "link": "https://stackoverflow.com/questions/31090119/is-the-where-keyword-lazy/31090211#31090211", "title": "Is the &quot;where&quot; keyword lazy?", "body": "<p>Yes, it's lazy, so that <code>f2</code> will not be evaluated, for example:</p>\n\n<pre><code>foo = 8 + f1\n    where f1 = 8 + 9\n          f2 = last [1..]\n</code></pre>\n\n<p>will be calculated instantly, and would take forever if it was strict.</p>\n"}], "owner": {"reputation": 542, "user_id": 1956587, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e92d52f1c16bcf435ef24f7a474fde04?s=128&d=identicon&r=PG", "display_name": "tolUene", "link": "https://stackoverflow.com/users/1956587/toluene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 31090211, "answer_count": 1, "score": 4, "last_activity_date": 1435502320, "creation_date": 1435417396, "last_edit_date": 1435502320, "question_id": 31090119, "link": "https://stackoverflow.com/questions/31090119/is-the-where-keyword-lazy", "title": "Is the &quot;where&quot; keyword lazy?", "body": "<p>Assuming I have a function like</p>\n\n<pre><code>foo = 8 + f1\n  where f1 = 8 + 9\n        f2 = 8 + 10\n</code></pre>\n\n<p><code>f1</code> clearly has to be evaluated, but <code>f2</code> doesn't have to be. Will it be though? I can see how evaluating every <code>where</code> expression would be a performance issue.</p>\n"}, {"tags": ["haskell", "state-monad", "aeson"], "comments": [{"owner": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "edited": false, "score": 0, "creation_date": 1435427376, "post_id": 31089873, "comment_id": 50199887, "body": "Can you add all the definitions that you are using.  It is difficult to diagnose the problem without being able to run it through GHC myself."}, {"owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "reply_to_user": {"reputation": 3669, "user_id": 4876946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5dc4839a7e9466d54f3791122f8f5d75?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/4876946/matt"}, "edited": false, "score": 0, "creation_date": 1435433764, "post_id": 31089873, "comment_id": 50201916, "body": "Sorry you are perfectly right. I mixed up wrong parts. Anyway I have re-edited the question and put the solution below."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435434306, "post_id": 31089873, "comment_id": 50202090, "body": "@Randomize It is considered good practice to put the solution in an answer instead of in the question. It is fine etiquette to answer your own question."}], "answers": [{"tags": [], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "is_accepted": true, "score": 0, "last_activity_date": 1435434415, "creation_date": 1435434415, "answer_id": 31092848, "question_id": 31089873, "link": "https://stackoverflow.com/questions/31089873/monad-escaping-inside-a-statet-context/31092848#31092848", "title": "Monad escaping inside a StateT context", "body": "<p>The error was due to the fact I used:</p>\n\n<p><code>let newCursor = case fb of</code></p>\n\n<p>instead of</p>\n\n<p><code>newCursor &lt;- case fb of</code></p>\n\n<p>For this reason the final value never get \"unwrapped\" from its monad context.</p>\n"}], "owner": {"reputation": 7296, "user_id": 324315, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fbb413736c6866ac28a73a44ab56c6b5?s=128&d=identicon&r=PG&f=1", "display_name": "Randomize", "link": "https://stackoverflow.com/users/324315/randomize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 31092848, "answer_count": 1, "score": 1, "last_activity_date": 1435502989, "creation_date": 1435415766, "last_edit_date": 1435502989, "question_id": 31089873, "link": "https://stackoverflow.com/questions/31089873/monad-escaping-inside-a-statet-context", "title": "Monad escaping inside a StateT context", "body": "<p>I am trying to get back a value that is in a json feed (via Aeson) directly inside a <code>StateT</code> stacked on <code>IO</code>:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric #-}\nmodule MyFeed where\n\nimport Data.Aeson\nimport Network.URI (parseURI, URI(..))\nimport Data.Maybe (fromJust)\nimport Data.Text (Text, unpack)\nimport Control.Monad.State\nimport Network.HTTP\nimport GHC.Generics\nimport Control.Applicative\nimport Network.HTTP.Conduit (simpleHttp)\nimport qualified Data.ByteString.Lazy as B\n\ntype Feed a = StateT MyIndex IO a\n\ndata MyIndex = MyIndex {\n    index :: Int\n}\n\ndata FooBar = Foo | Bar\n\ndata MyFeed = MyFeed {\n    idx :: !Text,\n    key :: !Text\n    } deriving (Show,Generic)\n\ninstance FromJSON MyFeed\ninstance ToJSON MyFeed\n\ngetJSON :: String -&gt; IO B.ByteString\ngetJSON url = simpleHttp url\n\ngetFeed :: String -&gt; IO (Maybe MyFeed)\ngetFeed url = (decode &lt;$&gt; getJSON url) :: IO (Maybe MyFeed)\n\ngetIndex :: FooBar -&gt; Feed MyIndex\ngetIndex fb = do\n  cursor &lt;- get\n  let newCursor = case fb of\n                            Foo -&gt; do  myFeed &lt;- liftIO $ getFeed \"http://echo.jsontest.com/key/value/idx/1\"\n                                       let i = read $ unpack $ idx $ fromJust myFeed\n                                       return $ cursor { index = i }\n\n                            Bar -&gt; return cursor\n  put newCursor\n  return newCursor\n</code></pre>\n\n<p>In the <code>Foo</code> case I fetch the feed as expected but when the required value is returned I get:</p>\n\n<pre><code>src/MyFeed.hs:47:10:\n    Couldn't match expected type \u2018MyIndex\u2019\n                with actual type \u2018m0 MyIndex\u2019\n    Relevant bindings include\n      newCursor :: m0 MyIndex (bound at src/MyFeed.hs:40:7)\n    In the first argument of \u2018return\u2019, namely \u2018newCursor\u2019\n    In a stmt of a 'do' block: return newCursor\n</code></pre>\n\n<p>The <code>Actual Type</code> looks still in a Monad context (<code>do {...}</code>). Is there a way to take it out or I am using a wrong approach?</p>\n"}, {"tags": ["haskell", "recursion", "lambda", "monadfix"], "comments": [{"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 1, "creation_date": 1435414933, "post_id": 31089564, "comment_id": 50196184, "body": "They&#39;re called <a href=\"https://www.haskell.org/tutorial/patterns.html#tut-lazy-patterns\" rel=\"nofollow noreferrer\">lazy patterns</a>"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1435415464, "post_id": 31089564, "comment_id": 50196334, "body": "Can you <a href=\"https://meta.stackoverflow.com/questions/284577/are-there-any-issues-with-posting-screenshots-of-books-pages\">please not post images</a> ?"}, {"owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "edited": false, "score": 0, "creation_date": 1435417225, "post_id": 31089564, "comment_id": 50196785, "body": "I think the image makes here clearer what is the question."}], "owner": {"reputation": 18456, "user_id": 1198559, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/bOjLe.png?s=128&g=1", "display_name": "jhegedus", "link": "https://stackoverflow.com/users/1198559/jhegedus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 237, "favorite_count": 0, "closed_date": 1435415742, "answer_count": 0, "score": 0, "last_activity_date": 1435413461, "creation_date": 1435413461, "question_id": 31089564, "link": "https://stackoverflow.com/questions/31089564/what-is-the-meaning-of-tilde-in-lambda-expression", "closed_reason": "Duplicate", "title": "What is the meaning of tilde in lambda expression?", "body": "<p>On the 7th page of <a href=\"http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.15.1543&amp;rep=rep1&amp;type=pdf\" rel=\"nofollow noreferrer\">this</a> book there is a tilde (shown by red circle in the picture below) in the definition of <code>toggle</code>. What does the tilde mean ? </p>\n\n<p><img src=\"https://i.stack.imgur.com/zCF5Q.jpg\" alt=\"enter image description here\"></p>\n"}, {"tags": ["haskell", "haskell-snap-framework"], "answers": [{"comments": [{"owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "reply_to_user": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1435758525, "post_id": 31150688, "comment_id": 50334885, "body": "@cimmanon rewrote my answer using the preprocessor directive.  Regrettably it requires recompiling."}, {"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1435759978, "post_id": 31150688, "comment_id": 50336013, "body": "Hm, yes, I tried experimenting with that last night, but doing a <code>cabal clean</code> + <code>cabal install</code> (production) or <code>cabal install -f development</code> (development) both produce the same results:  the internalServerError handler always runs when I create an exception."}], "tags": [], "owner": {"reputation": 18252, "user_id": 154527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9367d0448b8fc3e6d7f6cd421940ac62?s=128&d=identicon&r=PG", "display_name": "Alain O&#39;Dea", "link": "https://stackoverflow.com/users/154527/alain-odea"}, "is_accepted": false, "score": 1, "last_activity_date": 1435757964, "last_edit_date": 1435757964, "creation_date": 1435710356, "answer_id": 31150688, "question_id": 31089161, "link": "https://stackoverflow.com/questions/31089161/how-can-i-change-the-behavior-of-a-snap-application-depending-on-the-environment/31150688#31150688", "title": "How can I change the behavior of a Snap application depending on the environment (Production vs. Development)?", "body": "<p>There is a <strong>DEVELOPMENT</strong> flag passed to the preprocessor when compiling for development mode.</p>\n\n<pre><code>#ifndef DEVELOPMENT\nwrapSite internalServerError\n#endif\n</code></pre>\n\n<p>This is ugly and I was really hoping there was something better since it only works by recompiling.</p>\n"}, {"comments": [{"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1435769497, "post_id": 31165748, "comment_id": 50342435, "body": "I have no reason to display naked exceptions when the application is compiled without the <code>-f development</code> flag, so what I&#39;m looking for is an answer that checks <i>that</i> flag, not the one passed in when running the application."}, {"owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "reply_to_user": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1436820717, "post_id": 31165748, "comment_id": 50762868, "body": "That function just gets the environment string set by the user.  What you do with it is up to you.  Why not just display your nice looking exception page all the time?  If you need more detailed information for debugging purposes, you can write it to stdout or a log file."}, {"owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "edited": false, "score": 0, "creation_date": 1436821794, "post_id": 31165748, "comment_id": 50763391, "body": "Logging the error would require tailing the log the entire time I am doing development.  That&#39;s rather inconvenient since I have to refresh my browser to get it to recompile.  Displaying it in the browser is the most efficient way to obtain the error."}], "tags": [], "owner": {"reputation": 7154, "user_id": 527460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cece5abd2f9ad9056f5ac3830ac0bfe?s=128&d=identicon&r=PG", "display_name": "mightybyte", "link": "https://stackoverflow.com/users/527460/mightybyte"}, "is_accepted": true, "score": 0, "last_activity_date": 1436820948, "last_edit_date": 1436820948, "creation_date": 1435764838, "answer_id": 31165748, "question_id": 31089161, "link": "https://stackoverflow.com/questions/31089161/how-can-i-change-the-behavior-of-a-snap-application-depending-on-the-environment/31165748#31165748", "title": "How can I change the behavior of a Snap application depending on the environment (Production vs. Development)?", "body": "<p>Snap provides the <a href=\"http://hackage.haskell.org/package/snap-0.14.0.5/docs/Snap-Snaplet.html#v:getEnvironment\" rel=\"nofollow\">getEnvironment</a> function for this purpose.  This function gets the environment passed to <a href=\"http://hackage.haskell.org/package/snap-0.14.0.5/docs/Snap-Snaplet.html#v:runSnaplet\" rel=\"nofollow\">runSnaplet</a>.  The environment defaults to \"devel\" but can be changed at runtime with the -e command line option.  If you run your application like this:</p>\n\n<pre><code>dist/build/myapp/myapp -e prod\n</code></pre>\n\n<p>Then <code>getEnvironment</code> will return \"prod\".  You can use that like this:</p>\n\n<pre><code>notFound = do\n  e &lt;- getEnvironment\n  case e of\n    \"devel\" -&gt; develErrorPage\n    _       -&gt; productionErrorPage\n</code></pre>\n"}], "owner": {"reputation": 62282, "user_id": 1652962, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2cf5a0741f183379686fe0995ffc27ae?s=128&d=identicon&r=PG", "display_name": "cimmanon", "link": "https://stackoverflow.com/users/1652962/cimmanon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 31165748, "answer_count": 2, "score": -1, "last_activity_date": 1436820948, "creation_date": 1435410611, "question_id": 31089161, "link": "https://stackoverflow.com/questions/31089161/how-can-i-change-the-behavior-of-a-snap-application-depending-on-the-environment", "title": "How can I change the behavior of a Snap application depending on the environment (Production vs. Development)?", "body": "<p>The default behavior for an uncaught runtime exception in Snap is to display a white page containing the error.  This is great for development mode, but really terrible for production.</p>\n\n<p>I have my application setup to catch the exception and log the error so that displays something more attractive to the user when something bad happens.  How can I change it so that this only happens when I am in production mode?</p>\n\n<pre><code>app :: SnapletInit App App\napp = makeSnaplet \"app\" \"An snaplet example application.\" Nothing $ do\n    h &lt;- nestSnaplet \"\" heist $ heistInit \"templates\"\n    s &lt;- nestSnaplet \"sess\" sess $\n                 initCookieSessionManager \"site_key.txt\" \"sess\" (Just 86400)\n\n    d &lt;- nestSnaplet \"db\" db pgsInit\n\n    addRoutes routes\n\n    wrapSite (&lt;|&gt; notFound)\n    -- TODO: figure out how make this only catch errors when in production mode\n    wrapSite internalServerError\n\n    initFlashNotice h sess\n    addConfig h $ mempty &amp; scInterpretedSplices .~ userSessionSplices sess\n    return $ App h s d\n\ninternalServerError :: AppHandler () -&gt; AppHandler ()\ninternalServerError h =\n    catch h (\\ (e :: SomeException) -&gt; do\n        logError $ B.pack $ show e\n        modifyResponse (setResponseCode 500)\n        render \"errors/500\")\n</code></pre>\n"}, {"tags": ["haskell", "main", "accumulator"], "answers": [{"comments": [{"owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "edited": false, "score": 0, "creation_date": 1435412210, "post_id": 31089151, "comment_id": 50195478, "body": "Thanks for your help but thats not what I want. If I don&#39;t enter a name and just the age there should be no output. Then when I enter a name and age next time the output should be the entered name and the age that was entered before."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "edited": false, "score": 1, "creation_date": 1435412639, "post_id": 31089151, "comment_id": 50195600, "body": "well tbh: I don&#39;t know exactly what you are trying to do (your question stated otherwise) - but the snippet should be easy to adapt - you only asked for a way to use <i>an accumulator</i> - and I just wanted to show you how to do it with just an function-argument"}, {"owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "edited": false, "score": 0, "creation_date": 1435412788, "post_id": 31089151, "comment_id": 50195642, "body": "It&#39;s just a programming task. There is a hint that says, you can use an simple accumulator rather than a monad."}, {"owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "reply_to_user": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "edited": false, "score": 0, "creation_date": 1435412860, "post_id": 31089151, "comment_id": 50195662, "body": "oh I think I spoiled your homework then (sorry) - anyway: one more reason for you to try it yourself (and you cannot escape the <code>IO</code> Monad/Type here as you want to input and output data)"}], "tags": [], "owner": {"reputation": 48129, "user_id": 76051, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/AGDxz.jpg?s=128&g=1", "display_name": "Carsten", "link": "https://stackoverflow.com/users/76051/carsten"}, "is_accepted": false, "score": 3, "last_activity_date": 1435411368, "last_edit_date": 1435411368, "creation_date": 1435410550, "answer_id": 31089151, "question_id": 31089081, "link": "https://stackoverflow.com/questions/31089081/use-of-accumulator-in-main/31089151#31089151", "title": "Use of accumulator in main", "body": "<p>sure just use another function where you can use arguments of your choice:</p>\n\n<pre><code>ask :: String -&gt; IO ()\nask lastAge = do\n   -- don't know what you want to do with lastAge\n   -- so I just use it when the user did not enter anything\n   putStrLn \"Hey there, what's your name and age?\"\n   name &lt;- getLine\n   age' &lt;- getLine\n   let age = if null age' then lastAge else age'\n   putStrLn (\"Hi \" ++ name ++ \" you are \" ++ age ++ \" years old!\")\n   ask age\n\nmain :: IO ()\nmain = ask \"\"\n</code></pre>\n\n<hr>\n\n<p>allow me to introduce a small improvement: you probably don't want the infinite loop here - you can get rid of it easily using <a href=\"https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#v:unless\" rel=\"nofollow\">unless</a>:</p>\n\n<pre><code>import Control.Monad (unless)\n\nask :: String -&gt; IO ()\nask lastAge = do\n   -- don't know what you want to do with lastAge but here you have it\n   putStrLn \"Hey there, what's your name and age?\"\n   name &lt;- getLine\n   unless (null name) $ do\n     age' &lt;- getLine\n     let age = if null age' then lastAge else age'\n     putStrLn (\"Hi \" ++ name ++ \" you are \" ++ age ++ \" years old!\")\n     ask age\n</code></pre>\n\n<p>this will stop the loop as soon as the user does not give his name</p>\n"}], "owner": {"reputation": 1993, "user_id": 4089350, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ea18e53f0ae689e2ed747bdeb2fb6935?s=128&d=identicon&r=PG&f=1", "display_name": "Nico S.", "link": "https://stackoverflow.com/users/4089350/nico-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1435411368, "creation_date": 1435410153, "question_id": 31089081, "link": "https://stackoverflow.com/questions/31089081/use-of-accumulator-in-main", "title": "Use of accumulator in main", "body": "<p>I want to use an accumulator in the main.</p>\n\n<p>Lets say:</p>\n\n<pre><code>main = do\n   putStrLn \"Hey there, what's your name and age?\"\n   name &lt;- getLine\n   age &lt;- getLine\n   putStrLn (\"Hi \" ++ name ++ \" you are \" ++ age ++ \" years old!\")\n   main\n</code></pre>\n\n<p>So what I want to do is if the user did not supply his name and just the age, I want to use the age that was entered before in the next main call. Any suggestion how I can achieve that?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell", "pattern-matching", "type-conversion", "parse-error", "maybe"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 3, "creation_date": 1435403686, "post_id": 31088057, "comment_id": 50193137, "body": "I hope you understand that \u201cconverting\u201d this way is not really a clever idea: you&#39;re essentially subverting the type system. Only do this when you&#39;re absolutely sure that the argument is a <code>Just</code>, but the type checker can&#39;t proove it. And even then it&#39;s better to explicitly match <code>case mx of {Just x -&gt; x}</code> right where you need it, not through a helper function. The reason being: if this match <i>does</i> fail, it will give you a nice clear error message telling where it happened. Your <code>convert</code> will always give you the same error message when the assumption fails, no matter where you use it."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "edited": false, "score": 2, "creation_date": 1435403763, "post_id": 31088057, "comment_id": 50193157, "body": "It sounds like you just need <code>takeWhile (&#47;= item)</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 4, "creation_date": 1435403474, "post_id": 31088071, "comment_id": 50193077, "body": "That said, what the OP seems to want, is <a href=\"http://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Maybe.html#v:fromJust\" rel=\"nofollow noreferrer\"><code>fromJust</code></a>."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 4, "creation_date": 1435403877, "post_id": 31088071, "comment_id": 50193188, "body": "@bereal: mhhhh... I wouldn&#39;t recommend <code>fromJust</code>. See my comment above to the question. (It&#39;s still better than <code>convert</code>, though.)"}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 10, "last_activity_date": 1435403344, "creation_date": 1435403344, "answer_id": 31088071, "question_id": 31088057, "link": "https://stackoverflow.com/questions/31088057/parse-error-in-a-case-statement/31088071#31088071", "title": "Parse error in a case statement", "body": "<p>This is a whitespace problem. The <code>case</code> clauses need to be indented to the same level.</p>\n\n<pre><code>convert :: Maybe Int -&gt; Int\nconvert mx = case mx of \n               Just x -&gt; x\n               Nothing -&gt; error \"error message\"\n</code></pre>\n\n<p>Remember to use only spaces, no tabs.</p>\n"}, {"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 2, "last_activity_date": 1435409677, "last_edit_date": 1435409677, "creation_date": 1435405840, "answer_id": 31088399, "question_id": 31088057, "link": "https://stackoverflow.com/questions/31088057/parse-error-in-a-case-statement/31088399#31088399", "title": "Parse error in a case statement", "body": "<p>To add to @leftaroundabout's answer, I think I might provide you with some other options.</p>\n\n<p>First off, you shouldn't make unsafe things like this: your program will fail. It's much cleaner to keep it as a <code>Maybe Int</code> and operate as such, safely. In other words, this was a simple parse error, but making incomplete functions like this may cause far greater problems in the future.</p>\n\n<p>The problem you've encountered it, <em>how can I do that?</em></p>\n\n<p>We might make a better function, like this:</p>\n\n<pre><code>mapMaybe :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nmapMaybe f m = case m of\n     Just a  -&gt; f a\n     Nothing -&gt; Nothing\n</code></pre>\n\n<p>Which would allow you to write:</p>\n\n<pre><code>\u03bb&gt; (+ 15) `mapMaybe` Just 9\nJust 24\n</code></pre>\n\n<p>However, there is a function called <code>fmap</code>, which 'maps' a function over certain data-structures, <code>Maybe</code> included:</p>\n\n<pre><code>\u03bb&gt; (== 32) `fmap` Just 9\nJust False\n</code></pre>\n\n<p>and if you have <code>import</code>ed <code>Control.Applicative</code>, there is a nice operator synonym for it:</p>\n\n<pre><code>\u03bb&gt; show &lt;$&gt; Just 9\nJust \"9\"\n</code></pre>\n\n<p>If you want to know more about these data-structures, called Functors, I would recommend reading <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow\">Learn-you a Haskell</a>.</p>\n"}], "owner": {"reputation": 794, "user_id": 5055821, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/05181881c49c5cd10664acfa533fbb2c?s=128&d=identicon&r=PG&f=1", "display_name": "imc", "link": "https://stackoverflow.com/users/5055821/imc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3438, "favorite_count": 0, "accepted_answer_id": 31088071, "answer_count": 2, "score": 8, "last_activity_date": 1435409677, "creation_date": 1435403239, "last_edit_date": 1435405172, "question_id": 31088057, "link": "https://stackoverflow.com/questions/31088057/parse-error-in-a-case-statement", "title": "Parse error in a case statement", "body": "<p>I am trying to convert a Maybe Int to an Int in Haskell like this:</p>\n\n<pre><code>convert :: Maybe Int -&gt; Int\nconvert mx = case mx of \n               Just x -&gt; x\n              Nothing -&gt; error \"error message\"\n</code></pre>\n\n<p>When I compile it, Haskell tells me: <code>parse error on input 'Nothing'</code>.</p>\n\n<p>I need this, because I want to get the Index of an element in a list with the elem.Index function from the Data.List module and then use this index on the take function. My problem is that <code>elemIndex</code> returns a <code>Maybe Int</code>, but <code>take</code> needs an <code>Int</code>.</p>\n"}, {"tags": ["haskell", "time", "formatting"], "answers": [{"comments": [{"owner": {"reputation": 3116, "user_id": 353187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdc97f71e1b8c257ae1bbd52989785d?s=128&d=identicon&r=PG", "display_name": "xnyhps", "link": "https://stackoverflow.com/users/353187/xnyhps"}, "edited": false, "score": 0, "creation_date": 1435559677, "post_id": 31092975, "comment_id": 50232448, "body": "Note that this only works for <code>DiffTime</code>s of less than a day, if it&#39;s more than a day <code>timeToTimeOfDay</code> adds the extra time as leap seconds. The question asked about a solution that works for days too."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1435435396, "creation_date": 1435435396, "answer_id": 31092975, "question_id": 31087004, "link": "https://stackoverflow.com/questions/31087004/print-nominaldifftime-as-hours-minutes-and-seconds/31092975#31092975", "title": "Print NominalDiffTime as hours, minutes and seconds", "body": "<p>You can print a <code>DiffTime</code> -- which actually represents a duration, and is likely the type you should be using -- by going through <code>TimeOfDay</code>. Getting your hands on a <code>DiffTime</code> correctly is actually a little bit tricky; you'll need:</p>\n\n<ul>\n<li>A leap second table. <a href=\"http://hackage.haskell.org/package/time-1.5.0.1/docs/Data-Time-Clock-TAI.html#t:LeapSecondTable\" rel=\"nofollow\">type documentation</a>, <a href=\"http://www.timeanddate.com/time/leap-seconds-future.html\" rel=\"nofollow\">a page with a leap second table</a>; you'll want to have a way for your program to read this in at runtime, as these change every few months.</li>\n<li>From there, you can use <a href=\"http://hackage.haskell.org/package/time-1.5.0.1/docs/Data-Time-Clock-TAI.html#v:utcToTAITime\" rel=\"nofollow\"><code>utcToTAITime</code></a> to convert to <code>AbsoluteTime</code>, and</li>\n<li><a href=\"http://hackage.haskell.org/package/time-1.5.0.1/docs/Data-Time-Clock-TAI.html#v:diffAbsoluteTime\" rel=\"nofollow\"><code>diffAbsoluteTime</code></a> to get a <code>DiffTime</code>, and</li>\n<li><a href=\"http://hackage.haskell.org/package/time-1.5.0.1/docs/Data-Time-LocalTime.html#v:timeToTimeOfDay\" rel=\"nofollow\"><code>timeToTimeOfDay</code></a> to have the library do your divmod's for you, and finally</li>\n<li><a href=\"http://hackage.haskell.org/package/time-1.5.0.1/docs/Data-Time-Format.html#v:formatTime\" rel=\"nofollow\"><code>formatTime</code></a> to print this.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 29209, "user_id": 495796, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/86637c99f25d60157aa0f2e7eab90148?s=128&d=identicon&r=PG", "display_name": "Robin Green", "link": "https://stackoverflow.com/users/495796/robin-green"}, "is_accepted": false, "score": 1, "last_activity_date": 1446672091, "creation_date": 1446672091, "answer_id": 33532229, "question_id": 31087004, "link": "https://stackoverflow.com/questions/31087004/print-nominaldifftime-as-hours-minutes-and-seconds/33532229#33532229", "title": "Print NominalDiffTime as hours, minutes and seconds", "body": "<p><code>floor</code>[1] gives you (as you say) the number of seconds, which you can then use <code>div</code> and <code>mod</code> to convert into hours, minutes and seconds.</p>\n\n<p>For example:</p>\n\n<pre><code>floor ndt `div` 60 -- minutes, which may be more than 59\nfloor ndt `mod` 60 -- seconds\n</code></pre>\n\n<p>[1] unlike <code>fromEnum</code>, which is a \"conversion function\" but doesn't convert to seconds, contrary to what the documentation says.</p>\n"}, {"tags": [], "owner": {"reputation": 19307, "user_id": 1663462, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c30e0fa0f3a065c038c633a95066d299?s=128&d=identicon&r=PG", "display_name": "Chris Stryczynski", "link": "https://stackoverflow.com/users/1663462/chris-stryczynski"}, "is_accepted": false, "score": 0, "last_activity_date": 1546810884, "creation_date": 1546810884, "answer_id": 54066203, "question_id": 31087004, "link": "https://stackoverflow.com/questions/31087004/print-nominaldifftime-as-hours-minutes-and-seconds/54066203#54066203", "title": "Print NominalDiffTime as hours, minutes and seconds", "body": "<pre><code>myFormatDiffTime :: NominalDiffTime -&gt; String\nmyFormatDiffTime = formatTime defaultTimeLocale \"%H:%M:%S\" . posixSecondsToUTCTime\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 104, "user_id": 826753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d32bda212d90f3d131b7f7781f8ac0b?s=128&d=identicon&r=PG&f=1", "display_name": "Jens Petersen", "link": "https://stackoverflow.com/users/826753/jens-petersen"}, "is_accepted": false, "score": 0, "last_activity_date": 1586800037, "creation_date": 1586800037, "answer_id": 61193597, "question_id": 31087004, "link": "https://stackoverflow.com/questions/31087004/print-nominaldifftime-as-hours-minutes-and-seconds/61193597#61193597", "title": "Print NominalDiffTime as hours, minutes and seconds", "body": "<p>time-1.10 has <code>formatTime</code> support for  NominalDiffTime.</p>\n\n<p><code>formatTime defaultTimeLocale \"%H:%M:%S\" ndt</code></p>\n"}], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 862, "favorite_count": 2, "accepted_answer_id": 31092975, "answer_count": 4, "score": 7, "last_activity_date": 1586800037, "creation_date": 1435395873, "question_id": 31087004, "link": "https://stackoverflow.com/questions/31087004/print-nominaldifftime-as-hours-minutes-and-seconds", "title": "Print NominalDiffTime as hours, minutes and seconds", "body": "<p>I'm surprised nobody has asked this before, but... How do I trivially print a <code>NominalDiffTime</code> as hours, minutes and seconds? (And possibly <em>days</em>, if it happens to be that long...)</p>\n\n<p>For reasons unknown, the <code>Show</code> instance prints total seconds, which is obviously useless. (How long is 13,055.22 seconds? Is that a few minutes? A day? Half an hour? I have no idea!)</p>\n\n<p>There's the <code>FormatTime</code> class, but it doesn't apply to <code>NominalDiffTime</code>.</p>\n\n<p>It seems you can use the <code>floor</code> method to get total seconds as an actual <em>number</em>, but then what do you do with it?</p>\n\n<p>As far as I can tell, <code>DiffTime</code> doesn't help either.</p>\n\n<p>There <em>must</em> be a way to print time durations sanely...</p>\n"}, {"tags": ["haskell", "parsec"], "comments": [{"owner": {"reputation": 106969, "user_id": 189179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bab16b3716e0e72b8b1a7741d68f5ee2?s=128&d=identicon&r=PG", "display_name": "Ben James", "link": "https://stackoverflow.com/users/189179/ben-james"}, "edited": false, "score": 1, "creation_date": 1435396657, "post_id": 31085228, "comment_id": 50191276, "body": "It&#39;s hard to keep track of where whitespace was supposed to be consumed, because the code is scattered with <code>space</code> and <code>eol</code> in many places. With a simple line-based format like this, you really want to deal with whole lines at a time. I would try writing a <code>line :: Parser a -&gt; Parser a</code> combinator, which parses an <code>a</code> then eagerly chomps the space and newlines afterwards. (But be cautious that <code>a</code> itself doesn&#39;t consume newlines.)"}], "owner": {"reputation": 1055, "user_id": 593298, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/51e634a7316f1a4101f65519d2110cce?s=128&d=identicon&r=PG", "display_name": "keep_learning", "link": "https://stackoverflow.com/users/593298/keep-learning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 252, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1435380269, "creation_date": 1435380269, "question_id": 31085228, "link": "https://stackoverflow.com/questions/31085228/parsing-file-with-parsec", "title": "Parsing file with parsec", "body": "<p>I am trying to parse file [1] but below code is not working properly. </p>\n\n<pre><code>import Control.Applicative hiding ( many , ( &lt;|&gt; )  )\nimport Text.Parsec\nimport Text.Parsec.String (Parser) \nimport qualified Text.Parsec.Token as T\nimport Text.Parsec.Language (emptyDef)\n\n--Scheme Code;ISIN Div Payout/ ISIN Growth;ISIN Div Reinvestment;Scheme Name;Net Asset Value;Repurchase Price;Sale Price;Date\n--120523;INF846K01ET8;INF846K01EU6;Axis Triple Advantage Fund - Direct Plan - Dividend Option;13.3660;13.2323;13.3660;19-Jun-2015\n\ndata MFund = MFund Integer  String String String Double Double Double String deriving (Show) --String String String  deriving (Show)\n\nlexer :: T.TokenParser st\nlexer  = T.makeTokenParser emptyDef\n\nnatural :: Parser Integer\nnatural = T.natural lexer\n\nfloat :: Parser Double\nfloat = T.float lexer\n\neol :: Parser String\neol =  try (string \"\\r\\n\")\n   &lt;|&gt; try (string \"\\n\")\n   &lt;|&gt; try (string \"\\r\")\n\nparseFund :: Parsec String () MFund\nparseFund = MFund &lt;$&gt; natural \n              &lt;*&gt; (char ';' *&gt; (many1 alphaNum &lt;|&gt; string \"-\")) \n              &lt;*&gt; (char ';' *&gt; (many1 alphaNum &lt;|&gt; string \"-\")) \n              &lt;*&gt; (char ';' *&gt; manyTill anyChar (char ';'))\n              &lt;*&gt; float\n              &lt;*&gt; (char ';' *&gt; float)\n              &lt;*&gt; (char ';' *&gt; float)\n              &lt;*&gt; (char ';' *&gt; many1 (alphaNum &lt;|&gt; char '-'))\n\n\n\nparseBlockFund :: Parsec String () [MFund]\nparseBlockFund = manyTill anyChar eol *&gt; space *&gt; eol *&gt; endBy parseFund eol\n\nparseMutual :: Parsec String () [MFund]\nparseMutual = concat &lt;$&gt; (manyTill anyChar eol *&gt; space *&gt; eol *&gt;\n          sepBy parseBlockFund (space *&gt; eol))\n\n{- each scheme is seperated by space and end of line-}\nparseSchemeBlock :: Parsec String () [MFund]\nparseSchemeBlock = concat &lt;$&gt; (sepBy parseMutual (space *&gt; eol))\n\nparseFile :: Parsec String () [MFund]\nparseFile = \n   string \"Scheme Code;ISIN Div Payout/ ISIN Growth;ISIN Div Reinvestment;Scheme Name;Net Asset Value;Repurchase Price;Sale Price;Date\" *&gt;\n   eol *&gt; space *&gt; eol *&gt; parseSchemeBlock &lt;* eof\n\n\nmain :: IO ()\nmain = do \n input &lt;- readFile \"data.txt\"\n print input\n case parse  parseFile  \"\" input  of\n    Left err -&gt; print err\n    Right val -&gt; print val\n</code></pre>\n\n<p>I am starting to parse the file from parseFile function which consumes first line, end of line, space and end of line. Now I parse each scheme blocks which are separated by space and end of line. Within each scheme block, we have many mutual blocks which are also separated by space and end of line so I first consume the string till end of line followed by space and end of line and call parseBlockFund. </p>\n\n<p>The problem which I suspect is when I am calling parseMutual function and when it's reaching to end of scheme block, it eats the space and end of line which is suppose to be consumed by parseSchemeBlock function. I tried try function but it's not working so I am not sure if I am thinking correctly or not. Could some one please tell me what is wrong with this code. </p>\n\n<p>One interesting thing when I remove the eof, this code is able to parse at least one scheme block [2].</p>\n\n<p>[1] <a href=\"http://portal.amfiindia.com/spages/NAV0.txt\" rel=\"nofollow\">http://portal.amfiindia.com/spages/NAV0.txt</a></p>\n\n<p>[2] <a href=\"https://github.com/mukeshtiwari/Puzzles/blob/master/Assigment/Api.hs\" rel=\"nofollow\">https://github.com/mukeshtiwari/Puzzles/blob/master/Assigment/Api.hs</a></p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "edited": false, "score": 0, "creation_date": 1435393550, "post_id": 31084771, "comment_id": 50190541, "body": "A good example may be <code>mapM putStrLn () [&quot;Hello&quot;, &quot;World&quot;]</code> will produce <code>IO ()</code> and print <code>Hello\\nWorld</code>."}], "answers": [{"comments": [{"owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 0, "creation_date": 1435432961, "post_id": 31084932, "comment_id": 50201678, "body": "From where does <code>&lt;$</code> come?"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "edited": false, "score": 1, "creation_date": 1435433201, "post_id": 31084932, "comment_id": 50201752, "body": "@KevinMeredith <a href=\"http://hoogle.haskell.org/?hoogle=%28%3C%24%29&amp;scope=set%3Astackage\" rel=\"nofollow noreferrer\">Hoogle</a> is very good at answering that kind of question."}, {"owner": {"reputation": 10772, "user_id": 427598, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/Fq5PZ.jpg?s=128&g=1", "display_name": "Konstantin Milyutin", "link": "https://stackoverflow.com/users/427598/konstantin-milyutin"}, "edited": false, "score": 0, "creation_date": 1453390793, "post_id": 31084932, "comment_id": 57589280, "body": "Nice example, but <code>ensure</code> requires type signature to compile. Probably because it doesn&#39;t know which monad to use."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 13, "last_activity_date": 1453400546, "last_edit_date": 1453400546, "creation_date": 1435376746, "answer_id": 31084932, "question_id": 31084771, "link": "https://stackoverflow.com/questions/31084771/understanding-foldm/31084932#31084932", "title": "Understanding `foldM`", "body": "<p>Here's a sort of stupid example. Suppose we wanted to sum the list, and make sure the partial sum never went over (say) 10; thus:</p>\n\n<pre><code>&gt; let ensure p x = x &lt;$ guard (p x)\n&gt; foldM (\\a b -&gt; ensure (&lt;10) (a+b)) 0 [1,2,3] :: Maybe Integer\nJust 6\n&gt; foldM (\\a b -&gt; ensure (&lt;10) (a+b)) 0 [5,5,5,-10] :: Maybe Integer\nNothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 58, "user_id": 923090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a3c73f9503acc4ff766c9b26c5d8555?s=128&d=identicon&r=PG", "display_name": "Raghu Kaippully", "link": "https://stackoverflow.com/users/923090/raghu-kaippully"}, "is_accepted": false, "score": 1, "last_activity_date": 1435377789, "creation_date": 1435377789, "answer_id": 31085021, "question_id": 31084771, "link": "https://stackoverflow.com/questions/31084771/understanding-foldm/31085021#31085021", "title": "Understanding `foldM`", "body": "<p>Notice that <code>a</code> and <code>b</code> can be different types. So the function can do anything with the two values as long as it can return a value of type <code>m a</code>.</p>\n\n<p>See the example below. This function is trying to sum up the length of all strings as long as they are not empty. If it finds any empty string, it returns <code>Nothing</code>.</p>\n\n<pre><code>count :: Int -&gt; String -&gt; Maybe Int\ncount c s = if null s\n            then Nothing\n            else Just $ c + length s\n</code></pre>\n\n<p>Now you can try it out:</p>\n\n<pre><code>*Main&gt; foldM count 0 [\"Hello\", \"World\"]\nJust 10\n*Main&gt; foldM count 0 [\"Hello\", \"\", \"World\"]\nNothing\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9455, "user_id": 1172541, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/LROoN.png?s=128&g=1", "display_name": "PyRulez", "link": "https://stackoverflow.com/users/1172541/pyrulez"}, "is_accepted": false, "score": 3, "last_activity_date": 1435377803, "creation_date": 1435377803, "answer_id": 31085022, "question_id": 31084771, "link": "https://stackoverflow.com/questions/31084771/understanding-foldm/31085022#31085022", "title": "Understanding `foldM`", "body": "<p>Just like with all folds with initializes, the <code>b</code> type variable signifies that you may have a different type of thing for accumulator and the rest. For example, let's say I was repeating a string. I could do</p>\n\n<pre><code>Prelude&gt; import Control.Monad\nPrelude Control.Monad&gt; foldM (\\str n -&gt; (putStrLn $ \"Repeating string \" ++ (show str) ++ \" \" ++ (show n) ++ \" times\") &gt;&gt; (return $ concat $ replicate n str)) \"Yolo\" [4,5,6]\nRepeating string \"Yolo\" 4 times\nRepeating string \"YoloYoloYoloYolo\" 5 times\nRepeating string \"YoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYolo\" 6 times\n\"YoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYoloYolo\"\n</code></pre>\n\n<p>As you can see the type of <code>\"Yolo\"</code> differs from the types of <code>4</code>, <code>5</code>, and <code>6</code>. This is the same as all folds, <code>foldM</code> just adds a monadic aspect.</p>\n"}, {"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": false, "score": 6, "last_activity_date": 1435407861, "last_edit_date": 1495541236, "creation_date": 1435407861, "answer_id": 31088722, "question_id": 31084771, "link": "https://stackoverflow.com/questions/31084771/understanding-foldm/31088722#31088722", "title": "Understanding `foldM`", "body": "<p>I believe you have a problem with <code>foldl</code> and not with <code>foldM</code>. <code>foldM</code> is basically just a very minor variation of <code>foldl</code>.</p>\n\n<p>So consider:</p>\n\n<pre><code>foldl :: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; a\nfoldl f x xs\n</code></pre>\n\n<p>What \"happens\" is:\n  - If <code>xs == []</code> then <code>x</code> is returned.\n  - otherwise <code>f</code> is called as: <code>f x (xs !! 0)</code> obtaining the result value <code>y :: a</code>. Then <code>f</code> is called as: <code>f y (xs !! 1)</code>, obtaining <code>z</code>. Then we go for <code>f z (xs !! 2)</code> etc.</p>\n\n<p>As you can see every call to <code>f</code> is passed the current result up to that point and the next element from the list in input. So it's used whenever you want to reduce a list into a single value and the computation you want to do is \"sequential\", i.e. you compute a value from the first element, then from this value and the following element you compute the new value, and from this and the second element you compute a new one etc.</p>\n\n<p>For example:</p>\n\n<pre><code>f ys x = map (+x) ys ++ [x]\nfoldl f [] [1,2,3]\n</code></pre>\n\n<p>produces:</p>\n\n<pre><code>[6, 5, 3]\n</code></pre>\n\n<p>Because:</p>\n\n<ul>\n<li><code>f [] 1 = [1]</code></li>\n<li><code>f [1] 2 = [1+2, 2] = [3, 2]</code></li>\n<li><code>f [3, 2] 3 = [3+3, 2+3, 3] = [6, 5, 3]</code></li>\n</ul>\n\n<p>To better understand how <code>foldl</code> and <code>foldr</code> work, see:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/13280159/haskell-foldl-and-foldr\">Haskell- foldl and foldr?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/6172004/writing-foldl-using-foldr\">Writing foldl using foldr</a></li>\n<li><a href=\"https://stackoverflow.com/questions/384797/implications-of-foldr-vs-foldl-or-foldl\">Implications of foldr vs. foldl (or foldl&#39;)</a></li>\n<li><a href=\"https://stackoverflow.com/questions/3082324/foldl-versus-foldr-behavior-with-infinite-lists\">foldl versus foldr behavior with infinite lists</a></li>\n<li><a href=\"http://foldl.com/\" rel=\"nofollow noreferrer\">http://foldl.com/</a>  and <a href=\"http://foldr.com/\" rel=\"nofollow noreferrer\">http://foldr.com/</a></li>\n<li><a href=\"https://wiki.haskell.org/Fold\" rel=\"nofollow noreferrer\">https://wiki.haskell.org/Fold</a></li>\n</ul>\n\n<p>Now, <code>foldM</code> is the same as <code>foldl</code> but now the <code>f :: a -&gt; b -&gt; a</code> has type <code>f :: a -&gt; b -&gt; m a</code>. This means that the function that combine the current result with the next element is a monadic action, i.e. it can have effects.</p>\n\n<p>For example, consider:</p>\n\n<pre><code>f ys x = do\n    let a = map (+x) ys ++ [x]\n    print a\n    return a\n\nfoldM f [] [1,2,3]\n</code></pre>\n\n<p>What happens is that the text:</p>\n\n<pre><code>[1]\n[3,2]\n[6,5,3]\n</code></pre>\n\n<p>gets printed and the value <code>[6, 5, 3]</code> is the return value of the monadic action.</p>\n"}], "owner": {"reputation": 37991, "user_id": 409976, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9ccda0b49cc974197399eae01ebd6850?s=128&d=identicon&r=PG", "display_name": "Kevin Meredith", "link": "https://stackoverflow.com/users/409976/kevin-meredith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3738, "favorite_count": 0, "accepted_answer_id": 31084932, "answer_count": 4, "score": 7, "last_activity_date": 1453400546, "creation_date": 1435374755, "question_id": 31084771, "link": "https://stackoverflow.com/questions/31084771/understanding-foldm", "title": "Understanding `foldM`", "body": "<p>I'm looking at <code>foldM</code> in order to gain intuition as to how it's used.</p>\n\n<p><code>foldM :: Monad m =&gt; (a -&gt; b -&gt; m a) -&gt; a -&gt; [b] -&gt; m a</code></p>\n\n<p>In this simple example, I simply return <code>[Just 100]</code>. But, what if I want to use the <code>b</code>?</p>\n\n<pre><code>ghci&gt; foldM (\\a _ -&gt; return a) (Just 100) [1,2,3] :: [Maybe Int]\n[Just 100]\n</code></pre>\n\n<p>I'm confused how to use the <code>b</code> within <code>(a -&gt; b -&gt; m a)</code>. </p>\n\n<p>Please help me gain intuition for this function and how to use the <code>b</code>.</p>\n"}, {"tags": ["haskell", "reflection", "monads"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1435360262, "post_id": 31083000, "comment_id": 50184906, "body": "This is a pretty tough problem in general, essentially you&#39;re wanting to write a static analysis tool for your DSL.  You could write such a DSL in Haskell using free monads pretty easily, actually, but performing the analysis to pull out all possible messages, however that&#39;s going to be difficult since a message&#39;s value could be determined solely at runtime.  If you limit your <code>title</code>s and <code>code</code>s using simple sum data types then it&#39;d be a bit easier, but you still have the problem that some values could be only determined by runtime values."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1435360743, "post_id": 31083000, "comment_id": 50185032, "body": "@bheklilr I hope my answer blows your mind. =)"}, {"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435360972, "post_id": 31083000, "comment_id": 50185090, "body": "@DanielWagner it does a bit, yeah! I wouldn&#39;t have thought of that approach at all."}], "answers": [{"comments": [{"owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 4, "creation_date": 1435362418, "post_id": 31083469, "comment_id": 50185424, "body": "Also, I love how unobtrusively you sneaked that link into there."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 10, "last_activity_date": 1435360804, "last_edit_date": 1435360804, "creation_date": 1435360372, "answer_id": 31083469, "question_id": 31083000, "link": "https://stackoverflow.com/questions/31083000/can-i-reflect-messages-out-of-a-haskell-program-at-runtime/31083469#31083469", "title": "Can I reflect messages out of a Haskell program at runtime?", "body": "<p>This kind of half-static analysis is basically exactly what arrows were invented for. So let's make an arrow! Our arrow will basically be just a <code>Writer</code> action, but one that remembers what messages it might have spit out at any given moment. First, some boilerplate:</p>\n\n<pre><code>{-# LANGUAGE Arrows #-}\n\nimport Control.Arrow\nimport Control.Category\nimport Control.Monad.Writer\nimport Prelude hiding (id, (.))\n</code></pre>\n\n<p>Now, the type described above:</p>\n\n<pre><code>data Validator m a b = Validator\n    { possibleMessages :: [m]\n    , action :: Kleisli (Writer m) a b\n    }\n\nrunValidator :: Validator m a b -&gt; a -&gt; Writer m b\nrunValidator = runKleisli . action\n</code></pre>\n\n<p>There are some straightforward instances to put in place. Of particular interest: the composition of two validators remembers messages from both the first action and the second action.</p>\n\n<pre><code>instance Monoid m =&gt; Category (Validator m) where\n    id = Validator [] id\n    Validator ms act . Validator ms' act' = Validator (ms ++ ms') (act . act')\n\ninstance Monoid m =&gt; Arrow (Validator m) where\n    arr f = Validator [] (arr f)\n    first (Validator ms act) = Validator ms (first act)\n\ninstance Monoid m =&gt; ArrowChoice (Validator m) where\n    left (Validator ms act) = Validator ms (left act)\n</code></pre>\n\n<p>All the magic is in the operation that actually lets you report something:</p>\n\n<pre><code>reportWhen :: Monoid m =&gt; m -&gt; (a -&gt; Bool) -&gt; Validator m a ()\nreportWhen m f = Validator [m] (Kleisli $ \\a -&gt; when (f a) (tell m))\n</code></pre>\n\n<p>This is the operation that notices when you're about to output a possible message, and makes a note of it. Let's copy your types and show how to code up <code>checkPerson</code> as an arrow. I've simplified your messages a little bit, but nothing important is different there -- just less syntactic overhead in the example.</p>\n\n<pre><code>type Message = String\ndata Name = FullName String String | NickName String -- http://www.kalzumeus.com/2010/06/17/falsehoods-programmers-believe-about-names/\ndata Person = Person { name :: Name, age :: Maybe Int }\n\ncheckPerson :: Validator Message Person ()\ncheckPerson = proc person -&gt; do\n    case age person of\n        Nothing -&gt; returnA -&lt; ()\n        Just years -&gt; do\n            \"negative age\"  `reportWhen` (&lt;  0) -&lt; years\n            \"age too large\" `reportWhen` (&gt;200) -&lt; years\n    case name person of\n        FullName firstName lastName -&gt; do\n            \"empty first name\" `reportWhen` null -&lt; firstName\n        NickName nick -&gt; do\n            \"empty nickname\"   `reportWhen` null -&lt; nick\n</code></pre>\n\n<p>I hope you'll agree that this syntax is not <em>too</em> far removed from what you originally wrote. Let's see it in action in ghci:</p>\n\n<pre><code>&gt; runWriter (runValidator checkPerson (Person (NickName \"\") Nothing))\n((),\"empty nickname\")\n&gt; possibleMessages checkPerson \n[\"empty nickname\",\"empty first name\",\"age too large\",\"negative age\"]\n</code></pre>\n"}], "owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 3, "accepted_answer_id": 31083469, "answer_count": 1, "score": 9, "last_activity_date": 1435360804, "creation_date": 1435357378, "question_id": 31083000, "link": "https://stackoverflow.com/questions/31083000/can-i-reflect-messages-out-of-a-haskell-program-at-runtime", "title": "Can I reflect messages out of a Haskell program at runtime?", "body": "<p>I\u2019m writing a program that validates a complex data structure according to a number of complex rules. It inputs the data and outputs a list of messages indicating problems with the data.</p>\n\n<p>Think along these lines:</p>\n\n<pre><code>import Control.Monad (when)\nimport Control.Monad.Writer (Writer, tell)\n\ndata Name = FullName String String | NickName String\ndata Person = Person { name :: Name, age :: Maybe Int }\n\ndata Severity = E | W | C   -- error/warning/comment\ndata Message = Message { severity :: Severity, code :: Int, title :: String }\ntype Validator = Writer [Message]\n\nreport :: Severity -&gt; Int -&gt; String -&gt; Validator ()\nreport s c d = tell [Message s c d]\n\ncheckPerson :: Person -&gt; Validator ()\ncheckPerson person = do\n  case age person of\n    Nothing -&gt; return ()\n    Just years -&gt; do\n      when (years &lt; 0) $ report E 1001 \"negative age\"\n      when (years &gt; 200) $ report W 1002 \"age too large\"\n  case name person of\n    FullName firstName lastName -&gt; do\n      when (null firstName) $ report E 1003 \"empty first name\"\n    NickName nick -&gt; do\n      when (null nick) $ report E 1004 \"empty nickname\"\n</code></pre>\n\n<p>For documentation, I also want to compile a list of all messages this program can output. That is, I want to obtain the value:</p>\n\n<pre><code>[ Message E 1001 \"negative age\"\n, Message W 1002 \"age too large\"\n, Message E 1003 \"empty first name\"\n, Message E 1004 \"empty nickname\"\n]\n</code></pre>\n\n<p>I could move the messages out of <code>checkPerson</code> into some external data structure, but I like it when the messages are defined right at the spot where they are used.</p>\n\n<p>I could (and probably should) extract the messages from the AST at compile time.</p>\n\n<p>But the touted flexibility of Haskell made me thinking: can I achieve that <strong>at runtime</strong>? That is, can I write a function</p>\n\n<pre><code>allMessages :: (Person -&gt; Validator ()) -&gt; [Message]\n</code></pre>\n\n<p>such that <code>allMessages checkPerson</code> would give me the above list?</p>\n\n<p>Of course, <code>checkPerson</code> and <code>Validator</code> <strong>need not</strong> stay the same.</p>\n\n<p>I can almost (not quite) see how I could make a custom <code>Validator</code> monad with a \u201cbackdoor\u201d that would run <code>checkPerson</code> in a sort of \u201creflection mode,\u201d traversing all paths and returning all <code>Message</code>s encountered. I would have to write a custom <code>when</code> function that would know to ignore its first argument under some circumstances (which ones?). So, a kind of a DSL. Perhaps I could even emulate pattern matching?</p>\n\n<p>So: can I do something like this, how, and what would I have to sacrifice?</p>\n\n<p>Please feel free to suggest any solutions even if they do not exactly fit the above description.</p>\n"}, {"tags": ["haskell", "attoparsec"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1435354084, "post_id": 31082272, "comment_id": 50183142, "body": "I do not know of a parser combinator library that smoothly supports this kind of composition (and I have looked for it in the past)."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1435416034, "post_id": 31082272, "comment_id": 50196449, "body": "I had a similar problem the other day, trying to parse a &quot;line-oriented&quot; file. The problem with <code>Parsec</code> is : it gives you the impression you don&#39;t need a lexer and you might not in theory. In your case, it seems that &#39;tokenizing&#39; your file first will solve the problem. You just need to create on token for a BlockQuote. I might be wrong."}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1435417634, "post_id": 31082272, "comment_id": 50196899, "body": "@mb14 interesting... do you know of some OSS examples of that approach, lexer then parsec? It might actually work but i&#39;ll probably skip it and go for a less elegant approach this time."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1435419338, "post_id": 31082272, "comment_id": 50197447, "body": "I know parsec has support for lexers as well  but I didn&#39;t find anything really helpful. However, I&#39;m sure there are. Lexer + Parser is the standard way to go, so at least GHC should be doing something similar."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 1, "creation_date": 1435419461, "post_id": 31082272, "comment_id": 50197493, "body": "There is <a href=\"https://gist.github.com/osa1/3507011\" rel=\"nofollow noreferrer\">this</a> which I haven&#39;t really had time to look at properly."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1439969521, "post_id": 31082272, "comment_id": 52073392, "body": "<i>[...] a parser for the markdown format, well a subset of it.</i> Could you describe the subset in question? Does it, for instance, allow nested blockquotes?"}, {"owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "edited": false, "score": 0, "creation_date": 1439981442, "post_id": 31082272, "comment_id": 52081315, "body": "yes it allows nested blockquotes. Actually there was also a reddit discussion on the topic: <a href=\"https://www.reddit.com/r/haskell/comments/3ba7s7/how_would_you_solve_this_attoparsec_problem/\" rel=\"nofollow noreferrer\">reddit.com/r/haskell/comments/3ba7s7/&hellip;</a> -- My current implementation is at: <a href=\"https://github.com/emmanueltouzery/projectpad/blob/8c8f3bb3462a2c08eeb72da04648a0f3ac43af68/src/Notes.hs\" rel=\"nofollow noreferrer\">github.com/emmanueltouzery/projectpad/blob/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1392, "user_id": 5198575, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RAYCSjVZdnQ/AAAAAAAAAAI/AAAAAAAAClo/VQ8V_H3l8O8/photo.jpg?sz=128", "display_name": "trevor cook", "link": "https://stackoverflow.com/users/5198575/trevor-cook"}, "is_accepted": false, "score": 4, "last_activity_date": 1486399861, "creation_date": 1486399861, "answer_id": 42073064, "question_id": 31082272, "link": "https://stackoverflow.com/questions/31082272/attoparsec-nested-parsers-parse-a-subset-of-the-input-with-a-different-par/42073064#42073064", "title": "attoparsec: &quot;nested&quot; parsers -- parse a subset of the input with a different parser", "body": "<p>I have asked myself the same question. Why is there no standard combinator for nested parsers like how you describe? My default mode is to trust the package author, especially when that author also co-wrote \"Real World Haskell\". If such an obvious capability is missing, perhaps it is by design and I should look for a better way. However, I've managed to convince myself that such a convenient combinator is mostly harmless. Useful whenever an all-or-nothing type parser is appropriate for the inner parse. </p>\n\n<h2>Implementation</h2>\n\n<pre><code>import Data.Attoparsec.Text\nimport qualified Data.Text as T\nimport Data.Text(Text)\nimport Control.Applicative\n</code></pre>\n\n<p>I've divided the required functionality into two parsers. The first, <code>constP</code>, performs an \"in place\" parse of some given text. It substitutes the constant parser's fail with <code>empty</code> (from Alternative), but otherwise has no other side effects.</p>\n\n<pre><code>constP :: Parser a -&gt; Text -&gt; Parser a\nconstP p t = case parseOnly p t of\n  Left _ -&gt; empty\n  Right a -&gt; return a\n</code></pre>\n\n<p>The second part comes from <code>parseOf</code>, which performs the constant, inner parse based on the result of the outer parse. The <code>empty</code> alternative here allows a failed parse to return without consuming any input.</p>\n\n<pre><code>parseOf :: Parser Text -&gt; Parser a -&gt; Parser a\nparseOf ptxt pa = bothParse &lt;|&gt; empty\n  where\n    bothParse = ptxt &gt;&gt;= constP pa\n</code></pre>\n\n<p>The block quote markdown can be written in the desired fashion. This implementation requires the resulting block to be totally parsed.</p>\n\n<pre><code>blockQuoteMarkdown :: Parser [[Double]]\nblockQuoteMarkdown = parseOf blockQuote ( markdownSurrogate &lt;* \n                                          endOfInput\n                                        )\n</code></pre>\n\n<p>Instead of the actual markdown parser, I just implemented a quick parser of space separated doubles. The complication of the parser comes from allowing the last, non-empty line, either end in a new line or not.</p>\n\n<pre><code>markdownSurrogate :: Parser [[Double]]\nmarkdownSurrogate = do\n  lns &lt;- many (mdLine &lt;* endOfLine)\n  option lns ((lns ++) . pure &lt;$&gt; mdLine1)\n  where\n    mdLine = sepBy double (satisfy (==' '))\n    mdLine1 = sepBy1 double (satisfy (==' '))\n</code></pre>\n\n<p>These two parsers are responsible for returning the text internal to block quotes.</p>\n\n<pre><code>blockQuote :: Parser Text\nblockQuote = T.unlines &lt;$&gt; many blockLine\n\nblockLine :: Parser Text\nblockLine = char '&gt;' *&gt; takeTill isEndOfLine &lt;* endOfLine\n</code></pre>\n\n<p>Finally, a test of the parser. </p>\n\n<pre><code>parseMain :: IO ()\nparseMain = do\n\n  putStrLn \"\"\n  doParse \"a\" markdownSurrogate a\n  doParse \"_\" markdownSurrogate \"\"\n  doParse \"b\" markdownSurrogate b\n  doParse \"ab\" markdownSurrogate ab\n  doParse \"a_b\" markdownSurrogate a_b\n  doParse \"badMarkdown x\" markdownSurrogate x\n  doParse \"badMarkdown axb\" markdownSurrogate axb\n\n  putStrLn \"\"\n  doParse \"BlockQuote ab\" blockQuoteMarkdown $ toBlockQuote ab\n  doParse \"BlockQuote a_b\" blockQuoteMarkdown $ toBlockQuote a_b\n  doParse \"BlockQuote axb\" blockQuoteMarkdown $ toBlockQuote axb\n  where\n    a = \"7 3 1\"\n    b = \"4 4 4\"\n    x = \"a b c\"\n\n    ab = T.unlines [a,b]\n    a_b = T.unlines [a,\"\",b]\n    axb = T.unlines [a,x,b]\n\n    doParse desc p str = do\n      print $ T.concat [\"Parsing \",desc,\": \\\"\",str,\"\\\"\"]\n      let i = parse (p &lt;* endOfInput ) str\n      print $ feed i \"\"\n\n    toBlockQuote = T.unlines\n                 . map (T.cons '&gt;')\n                 . T.lines\n\n*Main&gt; parseMain\n\n\"Parsing a: \\\"7 3 1\\\"\"\nDone \"\" [[7.0,3.0,1.0]]\n\"Parsing _: \\\"\\\"\"\nDone \"\" []\n\"Parsing b: \\\"4 4 4\\\"\"\nDone \"\" [[4.0,4.0,4.0]]\n\"Parsing ab: \\\"7 3 1\\n4 4 4\\n\\\"\"\nDone \"\" [[7.0,3.0,1.0],[4.0,4.0,4.0]]\n\"Parsing a_b: \\\"7 3 1\\n\\n4 4 4\\n\\\"\"\nDone \"\" [[7.0,3.0,1.0],[],[4.0,4.0,4.0]]\n\"Parsing badMarkdown x: \\\"a b c\\\"\"\nFail \"a b c\" [] \"endOfInput\"\n\"Parsing badMarkdown axb: \\\"7 3 1\\na b c\\n4 4 4\\n\\\"\"\nFail \"a b c\\n4 4 4\\n\" [] \"endOfInput\"\n\n\"Parsing BlockQuote ab: \\\"&gt;7 3 1\\n&gt;4 4 4\\n\\\"\"\nDone \"\" [[7.0,3.0,1.0],[4.0,4.0,4.0]]\n\"Parsing BlockQuote a_b: \\\"&gt;7 3 1\\n&gt;\\n&gt;4 4 4\\n\\\"\"\nDone \"\" [[7.0,3.0,1.0],[],[4.0,4.0,4.0]]\n\"Parsing BlockQuote axb: \\\"&gt;7 3 1\\n&gt;a b c\\n&gt;4 4 4\\n\\\"\"\nFail \"&gt;7 3 1\\n&gt;a b c\\n&gt;4 4 4\\n\" [] \"Failed reading: empty\"\n</code></pre>\n\n<h2>Discussion</h2>\n\n<p>The notable difference comes in the semantics of failure. For instance, when parsing <code>axb</code> and blockquoted <code>axb</code>, which are the following two strings, respectively</p>\n\n<pre><code>7 3 1\na b c\n4 4 4\n</code></pre>\n\n<p>and</p>\n\n<pre><code>&gt; 7 3 1\n&gt; a b c\n&gt; 4 4 4\n</code></pre>\n\n<p>the markdown parse results in </p>\n\n<pre><code>Fail \"a b c\\n4 4 4\\n\" [] \"endOfInput\"\n</code></pre>\n\n<p>whereas the quoted results in</p>\n\n<pre><code>Fail \"&gt;7 3 1\\n&gt;a b c\\n&gt;4 4 4\\n\" [] \"Failed reading: empty\"\n</code></pre>\n\n<p>The markdown consumes \"7 3 1\\n\", but this is nowhere reported in the quoted failure. Instead, fail becomes all or nothing.</p>\n\n<p>Likewise, there is no allowance for handling unparsed text in the case of partial success. But I don't see a need for this, given the use case. For example, if a parse looked something like the following</p>\n\n<pre><code>\"{ &lt;tok&gt; unhandled }more to parse\"\n</code></pre>\n\n<p>where <code>{}</code> denotes the recognized block quote context, and <code>&lt;tok&gt;</code> is parsed within that inner context. A partial success then would have to lift \"unhandled\" out of that block quote context and somehow combine it with \"more to parse\".</p>\n\n<p>I see no <em>general</em> way to do this, but it is allowed through choice of inner parser return type. For instance, by some parser <code>parseOf blockP innP :: Parser (&lt;tok&gt;,Maybe Text)</code>. However, if this need arises I would expect that there is a better way to handle the situation than with nested parsers.</p>\n\n<p>There may also be concerns about the loss of attoparsec Partial parsing. That is, the implementation of <code>constP</code> uses <code>parseOnly</code>, which collapses the parse return <code>Fail</code> and <code>Partial</code> into a single <code>Left</code> failure state. In other words, we lose the ability to feed our inner parser with more text as it becomes available. However, note that text to parse is itself the result of an outer parse; it will only be available after enough text has been fed to the outer parse. So this shouldn't be an issue either.</p>\n"}], "owner": {"reputation": 7942, "user_id": 516188, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/934a553983eaca4c3f8f939daf6d2faa?s=128&d=identicon&r=PG", "display_name": "Emmanuel Touzery", "link": "https://stackoverflow.com/users/516188/emmanuel-touzery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 902, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1486399861, "creation_date": 1435353349, "question_id": 31082272, "link": "https://stackoverflow.com/questions/31082272/attoparsec-nested-parsers-parse-a-subset-of-the-input-with-a-different-par", "title": "attoparsec: &quot;nested&quot; parsers -- parse a subset of the input with a different parser", "body": "<p>Well in fact I'm pretty sure I'm using the wrong terminology. Here is the problem I want to solve: a parser for the <code>markdown</code> format, well a subset of it.</p>\n\n<p>My problem is with the blockquote feature. Each line in a blockquote starts with <code>&gt;</code>; otherwise everything is the normal structure in a markdown file.</p>\n\n<p>You can't look at individual lines separately, because you need to separate paragraphs from normal lines, eg</p>\n\n<pre><code>&gt; a\n&gt; b\n</code></pre>\n\n<p>is not the same as</p>\n\n<pre><code>&gt; a\n&gt;\n&gt; b\n</code></pre>\n\n<p>and things like that (same if a list is blockquoted you don't want x lists but one list with x elements). A natural and trivial way is to \"take off\" the <code>&gt;</code> signs, parse the blockquote on its own, ignoring anything around it, wrap it with a <code>BlockQuote</code> type constructor, put that in the outer AST and resume parsing of the original input. It's what <code>pango</code> does if I'm not wrong:</p>\n\n<p><a href=\"https://hackage.haskell.org/package/pandoc-1.14.0.4/docs/src/Text-Pandoc-Readers-Markdown.html#blockQuote\" rel=\"noreferrer\">https://hackage.haskell.org/package/pandoc-1.14.0.4/docs/src/Text-Pandoc-Readers-Markdown.html#blockQuote</a></p>\n\n<pre><code>blockQuote :: MarkdownParser (F Blocks)\nblockQuote = do\n  raw &lt;- emailBlockQuote\n  -- parse the extracted block, which may contain various block elements:\n  contents &lt;- parseFromString parseBlocks $ (intercalate \"\\n\" raw) ++ \"\\n\\n\"\n  return $ B.blockQuote &lt;$&gt; contents\n</code></pre>\n\n<p>And then:</p>\n\n<p><a href=\"http://hackage.haskell.org/package/pandoc-1.5.1/docs/src/Text-Pandoc-Shared.html#parseFromString\" rel=\"noreferrer\">http://hackage.haskell.org/package/pandoc-1.5.1/docs/src/Text-Pandoc-Shared.html#parseFromString</a></p>\n\n<pre><code>-- | Parse contents of 'str' using 'parser' and return result.\nparseFromString :: GenParser tok st a -&gt; [tok] -&gt; GenParser tok st a\nparseFromString parser str = do\n  oldPos &lt;- getPosition\n  oldInput &lt;- getInput\n  setInput str\n  result &lt;- parser\n  setInput oldInput\n  setPosition oldPos\n  return result\n</code></pre>\n\n<p>Now <code>parseFromString</code> looks quite hacky to me and besides that it's also <code>Parsec</code> not <code>attoparsec</code> so I can't use it in my project. I'm not sure how I could take that <code>Text</code> from the blockquote and parse it and return the parsing result so that it \"fits\" within the current parsing. Seems impossible?</p>\n\n<p>I've been googling on the issue and I <em>think</em> that <code>pipes-parse</code> and <code>conduit</code> can help on that area although I struggle to find examples and what I see appears considerably less nice to look at than \"pure\" parsec/attoparsec parsers.</p>\n\n<p>Other options to parse blockquotes would be to rewrite the usual parsers but with the <code>&gt;</code> catch... Complicating and duplicating a lot. Parsing blockquotes counting each line separately and writing some messy \"merge\" function. Or parsing to a first AST that would contain the blockquotes as <code>Text</code> inside a first <code>BlockquoteText</code> type constructor waiting for a transformation where they would be parsed separately, not very elegant but it has the benefit of simplicity, which does count for something.</p>\n\n<p>I would probably go for the latter, but surely there's a better way?</p>\n"}, {"tags": ["multithreading", "haskell"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 2, "creation_date": 1435330236, "post_id": 31074264, "comment_id": 50170863, "body": "That equation you quoted is exactly saying that <code>evaluate `seq` y</code> is the same as <code>y</code>, i.e., your use of <code>evaluate</code> does nothing."}], "answers": [{"comments": [{"owner": {"reputation": 3657, "user_id": 119765, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0a8015e6047bee31cc8c78808c77e5ec?s=128&d=identicon&r=PG", "display_name": "lol", "link": "https://stackoverflow.com/users/119765/lol"}, "edited": false, "score": 0, "creation_date": 1435327832, "post_id": 31074484, "comment_id": 50169244, "body": "I can see what you&#39;re saying, but this is still slower than not doing it concurrently. I also feel like you may not have enough information in the question to diagnose this issue, though... Hmm"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 3657, "user_id": 119765, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0a8015e6047bee31cc8c78808c77e5ec?s=128&d=identicon&r=PG", "display_name": "lol", "link": "https://stackoverflow.com/users/119765/lol"}, "edited": false, "score": 0, "creation_date": 1435329084, "post_id": 31074484, "comment_id": 50170068, "body": "@lol How do you measure the speed? How complex is your <code>f</code>? Are you sure that the concurrency overhad (switching CPU contexts, using <code>MVar</code>s isn&#39;t greater than the gain from parallelization?"}, {"owner": {"reputation": 3657, "user_id": 119765, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0a8015e6047bee31cc8c78808c77e5ec?s=128&d=identicon&r=PG", "display_name": "lol", "link": "https://stackoverflow.com/users/119765/lol"}, "edited": false, "score": 0, "creation_date": 1435333078, "post_id": 31074484, "comment_id": 50172750, "body": "<code>f</code> is a factorial function, I&#39;m timing it with <code>time</code> and for googlers that make it here ever, remember to compile with <code>ghc -threaded</code>, control for <code>O1</code>, <code>O2</code>, etc. in your tests"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "reply_to_user": {"reputation": 3657, "user_id": 119765, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0a8015e6047bee31cc8c78808c77e5ec?s=128&d=identicon&r=PG", "display_name": "lol", "link": "https://stackoverflow.com/users/119765/lol"}, "edited": false, "score": 1, "creation_date": 1435341235, "post_id": 31074484, "comment_id": 50177223, "body": "@lol Sounds good.  Somewhat more accurate measurement than <code>time</code> is provided by <a href=\"http://hackage.haskell.org/package/criterion\" rel=\"nofollow noreferrer\">criterion</a>."}], "tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": false, "score": 5, "last_activity_date": 1435325350, "creation_date": 1435325350, "answer_id": 31074484, "question_id": 31074264, "link": "https://stackoverflow.com/questions/31074264/using-haskells-mvar-package-but-enforcing-strictness-with-seq/31074484#31074484", "title": "Using Haskell&#39;s MVar package but enforcing strictness with seq", "body": "<p>Because you used <code>seq</code> to force the evaluation of <code>evaluate fv</code>. This is an <code>IO</code> action, and <em>evaluating</em> it is something completely different than <em>running</em> it.</p>\n\n<p>If you think of an <code>IO</code> action as a recipe, running <code>seq</code> on it, evaluating it, is just making sure the recipe is fully written down, but running is actually using the recipe to produce something.</p>\n\n<p>The forked part should be instead</p>\n\n<pre><code>forkIO $ do\n          let fv = f v\n          evaluate fv\n          putMVar res fv\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3657, "user_id": 119765, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0a8015e6047bee31cc8c78808c77e5ec?s=128&d=identicon&r=PG", "display_name": "lol", "link": "https://stackoverflow.com/users/119765/lol"}, "edited": false, "score": 0, "creation_date": 1435333001, "post_id": 31076175, "comment_id": 50172683, "body": "You&#39;re a living legend. Now how to I cash out the points to both of you haha?!?!?"}], "tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": true, "score": 6, "last_activity_date": 1435330124, "creation_date": 1435330124, "answer_id": 31076175, "question_id": 31074264, "link": "https://stackoverflow.com/questions/31074264/using-haskells-mvar-package-but-enforcing-strictness-with-seq/31076175#31076175", "title": "Using Haskell&#39;s MVar package but enforcing strictness with seq", "body": "<p>Assuming you fixed your program as in Petr Pudl\u00e1k's answer, you're trying to take from the <code>MVar</code> immediately after starting the thread to put a value in it. So you have no parallelism since the thread running <code>concTreeMap</code> has to wait for the <code>MVar</code> to be full, which means waiting for the forked thread to put <code>fv</code> in the <code>MVar</code>, which it doesn't do until after it has evaluated it. Meanwhile the original thread is doing nothing.</p>\n\n<p>Didn't you mean to write</p>\n\n<pre><code>  ...\n  forkIO $ do\n              let fv = f v\n              evaluate fv `seq` (putMVar res fv)\n  l' &lt;- concTreeMap f l\n  r' &lt;- concTreeMap f r\n  v' &lt;- takeMVar res         -- Note: this moved to after we do more work\n  return (Branch v' l' r')\n</code></pre>\n\n<p>?</p>\n"}], "owner": {"reputation": 3657, "user_id": 119765, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0a8015e6047bee31cc8c78808c77e5ec?s=128&d=identicon&r=PG", "display_name": "lol", "link": "https://stackoverflow.com/users/119765/lol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 1, "accepted_answer_id": 31076175, "answer_count": 2, "score": 2, "last_activity_date": 1435333573, "creation_date": 1435324796, "last_edit_date": 1435333573, "question_id": 31074264, "link": "https://stackoverflow.com/questions/31074264/using-haskells-mvar-package-but-enforcing-strictness-with-seq", "title": "Using Haskell&#39;s MVar package but enforcing strictness with seq", "body": "<p>Under the <code>Control.Concurrent.MVar</code> documentation on hackage, we have a 'gotcha' regarding the usage of <code>MVar</code>s. Here's the <a href=\"http://hackage.haskell.org/package/base-4.7.0.0/docs/Control-Concurrent-MVar.html\" rel=\"nofollow\">link</a>.</p>\n\n<p>MVar says that when you use <code>putMVar</code> to put something in an <code>MVar</code>, if that thing you're putting in is a huge thunk, the receiving thread will have the messy job of evaluation, not the sending thread.</p>\n\n<p>Apart from that being potentially annoying or unwarranted, to remedy such a situation it points us in the direction of <code>evaluate</code> which itself says to use <code>seq</code>. Everyone's favourite haskell function.</p>\n\n<p><a href=\"http://hackage.haskell.org/package/base-4.7.0.0/docs/Control-Exception-Base.html#v:evaluate\" rel=\"nofollow\">Evaluate</a>'s semantics are supposedly meant to be like this:</p>\n\n<blockquote>\n<pre><code>evaluate x `seq` y    ==&gt;  y\n</code></pre>\n</blockquote>\n\n<p>So my question is: why won't this evaluate in the forked thread!?!?!</p>\n\n<pre><code>concTreeMap :: (a -&gt; b) -&gt; BinaryTree a -&gt; IO (BinaryTree b)\nconcTreeMap f Leaf = return Leaf\nconcTreeMap f (Branch v l r) =  do\n  res &lt;- newEmptyMVar\n  forkIO $ do\n              let fv = f v\n              evaluate fv `seq` (putMVar res fv)\n  v' &lt;- takeMVar res\n  l' &lt;- concTreeMap f l\n  r' &lt;- concTreeMap f r\n  return (Branch v' l' r')\n</code></pre>\n\n<p>Edited to add an equivalent speedup...</p>\n\n<p>Somehow this is equivalent to the answer below (not using evaluate but using seq)... Anyway I think the point of the speed up is in a) providing a hint to the haskell runtime about thunk evaluation and 2) moving the take away from the put</p>\n\n<pre><code>concTreeMap :: (a -&gt; b) -&gt; BinaryTree a -&gt; IO (BinaryTree b)\nconcTreeMap f Leaf = return Leaf\nconcTreeMap f (Branch v l r) =  do\n  res &lt;- newEmptyMVar\n  forkIO $ do { let fv = f v in fv `seq` putMVar res fv }\n  l' &lt;- concTreeMap f l\n  r' &lt;- concTreeMap f r\n  v' &lt;- takeMVar res\n  return (Branch v' l' r')\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1435306403, "post_id": 31068080, "comment_id": 50155779, "body": "Um... could you give some examples of how you&#39;d like to use this?"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1435307214, "post_id": 31068080, "comment_id": 50156241, "body": "My goal is minimize backend restrictions and maximize abstraction. Updated! :)"}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1435308402, "post_id": 31068080, "comment_id": 50156910, "body": "<a href=\"http://stackoverflow.com/a/7438716/477476\">stackoverflow.com/a/7438716/477476</a>"}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "reply_to_user": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1435308683, "post_id": 31068080, "comment_id": 50157075, "body": "I&#39;m sorry @Cactus but I cannot see how it solve my doubt."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 0, "creation_date": 1435308855, "post_id": 31068080, "comment_id": 50157169, "body": "@josejuan that answer might give you a good idea of why your definition of <code>Backend</code> is going down the wrong path."}, {"owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "edited": false, "score": 0, "creation_date": 1435309153, "post_id": 31068080, "comment_id": 50157334, "body": "Mm... I&#39;m still not sure but <code>k</code> and <code>v</code> restrictions blow up at <code>selectBackend &lt;- </code> and for each <code>makeBackend</code> as needed. I&#39;ve used <code>GADTs</code> also but &quot;record&quot; was recommended to me (sorry if I don&#39;t understand you)"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435311632, "post_id": 31068080, "comment_id": 50158840, "body": "What are the types of the operations in question for the backends you want to support?"}], "answers": [{"tags": [], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "is_accepted": true, "score": 7, "last_activity_date": 1435312881, "creation_date": 1435312881, "answer_id": 31070328, "question_id": 31068080, "link": "https://stackoverflow.com/questions/31068080/how-to-define-function-types-when-they-will-be-monadic-io-and-pure/31070328#31070328", "title": "How to define function types when they will be monadic, IO and pure", "body": "<p>If you need a non-<code>IO</code> backend as well, then I'd suggest to parametrize the data type by the monad in which its operations run. As pointed out by @Cactus, there is no need to add constraints to the data type itself. It doesn't help anything, it just makes things complicated. Instead, these constraints will be at functions that create various <code>Backend</code>s.</p>\n\n<p>Also, while it might be possible to vary the return type of the update function, using such a function would be just hell, as the application would basically need to cover all (both) cases whenever using the function. So instead I'd suggest to keep the result simple, just monadic. And for the pure backend you can just run the application within the <code>State</code> monad, for example:</p>\n\n<pre><code>{-# LANGUAGE FlexibleContexts #-}\nimport Control.Monad.State\n\ndata Backend m key value = Backend\n    { beGet :: m [(key, value)]\n    , beCud :: key -&gt; Maybe value -&gt; m () -- Create Update Delete\n    }\n\npureBackend :: (MonadState [(k, v)] m, Eq k) =&gt; Backend m k v\npureBackend = Backend get pureCud\n  where\n    filterOut k = filter ((/= k) . fst)\n    pureCud k Nothing = modify (filterOut k)\n    pureCud k (Just v) = modify (((k, v) :) . filterOut k)\n\n-- other backends ...\n</code></pre>\n\n<p>This means that <code>AppData</code> and whoever else uses <code>Backend</code> needs to be parametrized by the monad as well.</p>\n"}], "owner": {"reputation": 6942, "user_id": 1540749, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dd6c24a0bc5c0a59a456aa8b08a78b6a?s=128&d=identicon&r=PG", "display_name": "josejuan", "link": "https://stackoverflow.com/users/1540749/josejuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 1, "accepted_answer_id": 31070328, "answer_count": 1, "score": 1, "last_activity_date": 1435312881, "creation_date": 1435305919, "last_edit_date": 1495539829, "question_id": 31068080, "link": "https://stackoverflow.com/questions/31068080/how-to-define-function-types-when-they-will-be-monadic-io-and-pure", "title": "How to define function types when they will be monadic, IO and pure", "body": "<p>(Related question <a href=\"https://stackoverflow.com/questions/31034826/select-instance-behavior-at-runtime\">Select instance behavior at runtime</a>)</p>\n\n<p>I want to define a kind of backend (reusable as independent api), then provide multiple implementations and be able to select one at runtime.</p>\n\n<p>My application will be like</p>\n\n<pre><code>data AppData =\n     AppData { ...\n             , backend :: Backend\n             }\n</code></pre>\n\n<p>for simplicity, let our backend (<strong>conceptual code</strong>)</p>\n\n<pre><code>data Backend key value =\n     Backend { get :: [(key, value)]\n             , cud :: key -&gt; Maybe value -&gt; () -- Create Update Delete\n             }\n</code></pre>\n\n<p>now <strong>What's the proper/recommended way to define our <code>Backend</code> type?</strong></p>\n\n<p>I think it will be monadic (then <code>Monad m</code>) but also <code>IO</code> (then <code>MonadIO m</code>) but also pure (then we need change <code>-&gt; ()</code> by <code>-&gt; Backend key value</code>) and so on...</p>\n\n<p>I'm doubting, the next attempt works monadic, <code>IO</code> and pure, but may be over-engineering</p>\n\n<pre><code>data Backend m k v =\n     Backend { get :: MonadIO m =&gt; m [(k, v)]\n             , cud :: MonadIO m =&gt; k -&gt; Maybe v -&gt; Backend m k v\n             }\n</code></pre>\n\n<p>the <code>MonadIO</code> is a strong restriction and return immutable version on <code>cud</code> is redundant (in most cases?) with <code>m</code>.</p>\n\n<p><strong>What is the proper/recommended way to abstract it?</strong></p>\n\n<p>Thank you!</p>\n\n<p>Once defined our <code>Backend</code> API my intention was use as (<strong>conceptual code</strong>) more or less</p>\n\n<pre><code>main = do\n    configuration &lt;- getAppConfiguration\n    selectedBackend &lt;- case preferedBackend configuration of\n                           \"mongoDB\"  -&gt; MongoDBBackend.makeBackend\n                           \"sqlite\"   -&gt; SqliteBackend.makeBackend\n                           \"volatile\" -&gt; PureDataMapBackend.makeBackend\n                           ...\n    appData &lt;- makeAppData configuration selectedBackend\n    ....\n</code></pre>\n"}, {"tags": ["haskell", "monads"], "answers": [{"comments": [{"owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "edited": false, "score": 0, "creation_date": 1435310366, "post_id": 31068848, "comment_id": 50158082, "body": "Ouch, yes. You&#39;re right. The typical noob mistake :-) Thanks for that."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 0, "last_activity_date": 1435308696, "creation_date": 1435308696, "answer_id": 31068848, "question_id": 31066672, "link": "https://stackoverflow.com/questions/31066672/haskell-groundhog-db-function-types/31068848#31068848", "title": "Haskell Groundhog-Db function types", "body": "<p><code>when</code> and <code>unless</code> both have the same type:</p>\n\n<pre><code>when, unless :: Monad m =&gt; Bool -&gt; m () -&gt; m ()\n</code></pre>\n\n<p>so the value you pass as the second argument must have type <code>m ()</code>. You are passing <code>m Symbol</code> in both cases. It looks like you just want to use <code>if</code>:</p>\n\n<pre><code>ensureSymbol sym = do\n    loadedSymbols &lt;- select (NameField ==. sym)\n    if (null loadedSymbols) then (return (Symbol sym)) else (return (loadedSymbols !! 0))\n</code></pre>\n\n<p>or a <code>case</code>:</p>\n\n<pre><code>ensureSymbol sym = do\n        loadedSymbols &lt;- select (NameField ==. sym)\n        case loadedSymbols of\n          [] -&gt; return (Symbol sym)\n          s:ss -&gt; return s\n</code></pre>\n"}], "owner": {"reputation": 1216, "user_id": 2682133, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/e6O9c.jpg?s=128&g=1", "display_name": "Hennes", "link": "https://stackoverflow.com/users/2682133/hennes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 1, "accepted_answer_id": 31068848, "answer_count": 1, "score": 1, "last_activity_date": 1435308696, "creation_date": 1435301234, "last_edit_date": 1435307996, "question_id": 31066672, "link": "https://stackoverflow.com/questions/31066672/haskell-groundhog-db-function-types", "title": "Haskell Groundhog-Db function types", "body": "<p>I'm new to haskell and I'm fiddling around with the Groundhog-ORM library upon a postgreSQL database. Everythings works fine, if I put all my database stuff inside a single function. However, now I want to separate different topics in separate functions.</p>\n\n<pre><code>{-# LANGUAGE GADTs, TypeFamilies, TemplateHaskell, QuasiQuotes, FlexibleInstances, StandaloneDeriving #-}\n\nmodule Main where\n\nimport System.IO\nimport Database.Groundhog.TH\nimport Database.Groundhog.Postgresql\nimport Data.DateTime\nimport Data.List.Split (splitOn)\nimport Control.Monad (mapM_, when, unless)\nimport Control.Monad.IO.Class (liftIO)\n\npostgres_connection_string = \"host=localhost port=5432 user=itsme password=unknown dbname=stocks\"\n\ndata Symbol = Symbol {\n    name :: String\n} deriving (Show, Eq)\n\nmkPersist defaultCodegenConfig [groundhog|\ndefinitions:\n  - entity: Symbol\n    dbName: symbols\n    schema: stocks\n    keys:\n      - name: unique_symbol\n    constructors:\n      - name: Symbol\n        uniques:\n          - name: unique_symbol\n            fields: [name]\n|]\n\n\nensureSymbol :: (PersistBackend m) =&gt; String -&gt; m (Symbol)\nensureSymbol sym = do\n    loadedSymbols &lt;- select (NameField ==. sym)\n    return (loadedSymbols !! 0)\n\nmain = do\n    contents &lt;- readFile \"src\\\\inputTable.csv\"\n    putStrLn (\"Read \" ++ show (length contents) ++ \" Bytes input data.\")\n    withPostgresqlConn postgres_connection_string . runDbConn $ do\n        liftIO $ putStrLn \"About to ensure table structures.\"\n        runMigration $ do\n          migrate (undefined :: Symbol)\n        liftIO $ putStrLn \"Checking for the symbol.\"\n        symbol &lt;- ensureSymbol \"EURUSD\"\n        ... [ Some more stuff ] ...\n</code></pre>\n\n<p>As you can see, I already separated a little function which reads a symbol entity from the database. This example compiles okay. </p>\n\n<p>However, the function is called <code>ensureSymbol</code> and not <code>readSymbol</code>, so the function should read </p>\n\n<pre><code>ensureSymbol :: (PersistBackend m) =&gt; String -&gt; m (Symbol)\nensureSymbol sym = do\n    loadedSymbols &lt;- select (NameField ==. sym)\n    when (null loadedSymbols) (return (Symbol sym))\n    unless (null loadedSymbols) (return (loadedSymbols !! 0))\n</code></pre>\n\n<p>But now I get a bunch of error messages, even in the line </p>\n\n<pre><code>loadedSymbols &lt;- select (NameField ==. sym)\n</code></pre>\n\n<p>which previously compiled correctly. I assume I need an additional type specifier to make <code>when</code> and <code>unless</code> visible to the function, but I'm not sure.</p>\n\n<pre><code>src\\Main.hs:117:40:\n    Couldn't match type `Symbol' with `()'\n    In the first argument of `select', namely `(NameField ==. sym)'\n    In a stmt of a 'do' block:\n      loadedSymbols &lt;- select (NameField ==. sym)\n    In the expression:\n      do { loadedSymbols &lt;- select (NameField ==. sym);\n           when (null loadedSymbols) (return (Symbol sym));\n           unless (null loadedSymbols) (return (loadedSymbols !! 0)) }\n\n src\\Main.hs:118:40:\n    Couldn't match expected type `()' with actual type `Symbol'\n    In the first argument of `return', namely `(Symbol sym)'\n    In the second argument of `when', namely `(return (Symbol sym))'\n\nsrc\\Main.hs:119:5:\n    Couldn't match type `()' with `Symbol'\n    Expected type: m Symbol\n      Actual type: m ()\n    In a stmt of a 'do' block:\n      unless (null loadedSymbols) (return (loadedSymbols !! 0))\n    In the expression:\n      do { loadedSymbols &lt;- select (NameField ==. sym);\n           when (null loadedSymbols) (return (Symbol sym));\n           unless (null loadedSymbols) (return (loadedSymbols !! 0)) }\n</code></pre>\n\n<p>Maybe there is a much more elegant way to do this?</p>\n"}, {"tags": ["haskell", "installation", "package"], "comments": [{"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1435269149, "post_id": 31058380, "comment_id": 50143353, "body": "I don&#39;t understand the third error, but the last one looks like a Windows line ending issue. Probably your config.guess has \\r\\n line endings while sh is expecting \\n line endings."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1435290866, "post_id": 31058380, "comment_id": 50149148, "body": "The last error you get is <code>lexical error in string&#47;character literal at character &#39;P&#39;</code>. The code you have simply does not compile (it doesn&#39;t even parse). You have a recent compiler and this package hasn&#39;t been updated in two years, so really this is to be expected. At this point you can try to fix it yourself or contact the maintainer."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 1, "creation_date": 1435291512, "post_id": 31058380, "comment_id": 50149324, "body": "The offending line is <code>ghcLibraryPath  = GHC_LIB_PATH</code> so I guess <code>GHC_LIB_PATH</code> is set to something like <code>&quot;C:\\Program Files\\...&quot;</code>... and <code>\\P</code> is not an escape sequence. Probably it would not work correctly on a UNIX system either when the path contains a backslash."}], "owner": {"reputation": 101, "user_id": 4874953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b49aa9290f30bcf7081da6921cfb921?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Melan&#231;on", "link": "https://stackoverflow.com/users/4874953/jason-melan%c3%a7on"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1435287884, "creation_date": 1435257961, "last_edit_date": 1435287884, "question_id": 31058380, "link": "https://stackoverflow.com/questions/31058380/problems-installing-haskells-plugins-package-windows-8-1-64-bit-cygwin", "title": "Problems installing Haskell&#39;s plugins package (Windows 8.1 64-bit, cygwin)", "body": "<p>I can't get this package to install. I've tried outside of cygwin, and get this error:</p>\n\n<p><a href=\"http://pastebin.com/tcEsFXVT\" rel=\"nofollow\">http://pastebin.com/tcEsFXVT</a></p>\n\n<p>I've tried inside cygwin, and get this error:</p>\n\n<p><a href=\"http://pastebin.com/LHGDnnDb\" rel=\"nofollow\">http://pastebin.com/LHGDnnDb</a></p>\n\n<p>I tried downloading the latest config.guess and config.sub, putting them into the plugins local repository (.tar.gz), and installing from it:</p>\n\n<p><a href=\"http://pastebin.com/txbW9G9t\" rel=\"nofollow\">http://pastebin.com/txbW9G9t</a></p>\n\n<p>I even tried doing the same with only config.guess:</p>\n\n<p><a href=\"http://pastebin.com/yVQhgyKs\" rel=\"nofollow\">http://pastebin.com/yVQhgyKs</a></p>\n\n<p>Based on Reid Barton's suggestion, I tried converting config.guess and config.sub to Unix line-endings (totally forgot about that issue, so thanks!). This produced a fifth error (replacing only config.guess did not change the error):</p>\n\n<p><a href=\"http://pastebin.com/U5rS6CyD\" rel=\"nofollow\">http://pastebin.com/U5rS6CyD</a></p>\n\n<p>Can anyone provide instructions for how to install this bear? </p>\n"}, {"tags": ["haskell", "scotty", "haskell-wai"], "answers": [{"tags": [], "owner": {"reputation": 8542, "user_id": 768869, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9100b96db729677ff09702887be524ba?s=128&d=identicon&r=PG", "display_name": "Hugh", "link": "https://stackoverflow.com/users/768869/hugh"}, "is_accepted": true, "score": 6, "last_activity_date": 1435248880, "creation_date": 1435248880, "answer_id": 31055563, "question_id": 31055102, "link": "https://stackoverflow.com/questions/31055102/why-does-this-work-in-ghci-but-not-scotty/31055563#31055563", "title": "Why does this work in GHCi but not Scotty?", "body": "<pre><code>fs &lt;- liftIO $ filterM (doesFileExist . ((++) prefix)) entries\n</code></pre>\n\n<p>Should that not be <code>(++) path</code>?</p>\n"}], "owner": {"reputation": 464, "user_id": 3435730, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b4cad01be7d94b2182896e7e9d241d3?s=128&d=identicon&r=PG&f=1", "display_name": "asg0451", "link": "https://stackoverflow.com/users/3435730/asg0451"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 31055563, "answer_count": 1, "score": 2, "last_activity_date": 1484860606, "creation_date": 1435247487, "last_edit_date": 1484860606, "question_id": 31055102, "link": "https://stackoverflow.com/questions/31055102/why-does-this-work-in-ghci-but-not-scotty", "title": "Why does this work in GHCi but not Scotty?", "body": "<p>I am trying to make a webpage that will list the contents of a given directory, but I am running into a strange problem: The code produces the desired output when I run it line by line in GHCi, but when it is executed in the running Scotty instance, it produces different (wrong) output. Here is the relevant part of the code:</p>\n\n<pre><code>serveDir :: String -&gt; ActionM ()\nserveDir p = do let path = prefix ++ p\n                entries &lt;- liftIO $ getDirectoryContents path\n                fs &lt;- liftIO $ filterM (doesFileExist . ((++) prefix)) entries\n                ds &lt;- liftIO $ filterM (doesDirectoryExist . ((++) prefix)) entries\n                liftIO $ print path &gt;&gt; print entries &gt;&gt; print fs &gt;&gt; print ds\n                blaze $ renderDir fs ds\n   where prefix = \"static/\"\n</code></pre>\n\n<p>(that last line in the <code>do</code> statement just renders it into html. this works, but the correct output never makes it to that function)\nWhen I run each line of this function in GHCi, i get the following output:</p>\n\n<pre><code>*Main&gt; entries &lt;- getDirectoryContents \"static/stuff\"\n*Main&gt; fs &lt;- liftIO $ filterM (doesFileExist . ((++) \"static/stuff/\")) entries\n*Main&gt; ds &lt;- liftIO $ filterM (doesDirectoryExist . ((++) \"static/stuff/\")) entries\n*Main&gt; liftIO $ print entries &gt;&gt; print fs &gt;&gt; print ds\n[\"..\",\"hello\",\"bye\",\"someDir\",\".\"]\n[\"hello\",\"bye\"]\n[\"..\",\"someDir\",\".\"]\n</code></pre>\n\n<p>which is what I am expecting. But when this function is run from Scotty, called as <code>serveDir \"stuff/\"</code>, I get this output:</p>\n\n<pre><code>\"static/stuff/\"\n[\"..\",\"hello\",\"bye\",\"someDir\",\".\"]\n[]\n[\"..\",\".\"]\n</code></pre>\n\n<p>What is happening here? I know that ActionM is an instance of MonadIO, otherwise this would not compile. I am at a bit of a loss. Can somebody shed some light on this or advise? Rest of code available upon request, but I can say that I am using wai-middleware-static to allow static file requests, and other file request from this directory in other functions works.</p>\n"}, {"tags": ["haskell", "types", "f#"], "comments": [{"owner": {"reputation": 19367, "user_id": 901059, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/203ec9c8a5506bc8808d0a79702950e8?s=128&d=identicon&r=PG&f=1", "display_name": "N_A", "link": "https://stackoverflow.com/users/901059/n-a"}, "edited": false, "score": 1, "creation_date": 1435247589, "post_id": 31053514, "comment_id": 50131524, "body": "I think the thing you&#39;re looking for is dependent types.  F# doesn&#39;t have it.  You could probably achieve this using code generation."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 19367, "user_id": 901059, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/203ec9c8a5506bc8808d0a79702950e8?s=128&d=identicon&r=PG&f=1", "display_name": "N_A", "link": "https://stackoverflow.com/users/901059/n-a"}, "edited": false, "score": 0, "creation_date": 1435248097, "post_id": 31053514, "comment_id": 50131878, "body": "Indeed dependent types did come to mind and I would assume this is something that could be handled in such a system, but I know that some things that require dependent types to be &quot;nice&quot; are still able to be encoded in less powerful type systems with additional effort. I&#39;m just wondering which classification this problem falls in."}, {"owner": {"reputation": 19367, "user_id": 901059, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/203ec9c8a5506bc8808d0a79702950e8?s=128&d=identicon&r=PG&f=1", "display_name": "N_A", "link": "https://stackoverflow.com/users/901059/n-a"}, "edited": false, "score": 0, "creation_date": 1435248477, "post_id": 31053514, "comment_id": 50132165, "body": "There is a tuple type for each size of tuple and records have a fixed size at compile-time.  This pretty much leaves meta programming of some sort being your only option. See <a href=\"https://msdn.microsoft.com/en-us/library/system.tuple.aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/system.tuple.aspx</a> for the tuple types."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 19367, "user_id": 901059, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/203ec9c8a5506bc8808d0a79702950e8?s=128&d=identicon&r=PG&f=1", "display_name": "N_A", "link": "https://stackoverflow.com/users/901059/n-a"}, "edited": false, "score": 0, "creation_date": 1435249590, "post_id": 31053514, "comment_id": 50132849, "body": "Hmm I actually do remember reading something a while ago where someone wanted to automatically generate functions for combining record instances. If the records themselves could also be generated perhaps that would work."}, {"owner": {"reputation": 46011, "user_id": 162396, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a57d6a4d1d19991243d3afa1294fa6e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/162396/daniel"}, "edited": false, "score": 0, "creation_date": 1435249719, "post_id": 31053514, "comment_id": 50132939, "body": "How is the initial list of maps populated?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1435249766, "post_id": 31053514, "comment_id": 50132970, "body": "My feeling is that you can not even statically express that a simpler <code>foo : Test -&gt; TestList</code> maps bools into bool-lists and the int analogous. In Haskell we could use GADTs for enforcing this statically, at the cost of changing the <code>Test,TestList</code> types a bit. (And then the heterogeneous maps would need existential types.)"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 46011, "user_id": 162396, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a57d6a4d1d19991243d3afa1294fa6e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/162396/daniel"}, "edited": false, "score": 0, "creation_date": 1435251015, "post_id": 31053514, "comment_id": 50133689, "body": "@Daniel It&#39;s a .csv that&#39;s combined with an interpreter that parses each field according to a specification. The parsing specification is defined at a column level, which is why I &quot;know&quot; that each index contains the same type of value (otherwise it would have failed during construction), I just don&#39;t know how to propagate that knowledge. I&#39;m not tied to the list of maps representation at all (and actually don&#39;t think it&#39;s possible using those structures alone), it&#39;s just what is currently used."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1435251109, "post_id": 31053514, "comment_id": 50133741, "body": "@chi Yes I think you&#39;re right about the Test -&gt; TestList encoding and I&#39;m actually not concerned with that constraint. My goal is simply to avoid &quot;rechecking&quot; and having to re-propagate error conditions that I &quot;know&quot; are impossible. If you&#39;re able to elaborate on a Haskell implementation I actually have more experience with Haskell than F# and I know there are ways of expressing [some?] existentials in F# with additional effort."}, {"owner": {"reputation": 46011, "user_id": 162396, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a57d6a4d1d19991243d3afa1294fa6e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/162396/daniel"}, "edited": false, "score": 0, "creation_date": 1435251329, "post_id": 31053514, "comment_id": 50133870, "body": "@ZJM Could explain more of what you want to do with the data? Maybe heterogeneous lists are tangential."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 46011, "user_id": 162396, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a57d6a4d1d19991243d3afa1294fa6e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/162396/daniel"}, "edited": false, "score": 0, "creation_date": 1435252692, "post_id": 31053514, "comment_id": 50134641, "body": "@Daniel Sure. I agree perhaps I&#39;m approaching things incorrectly. So I have tabular data (delimited text, SQL result, etc.) and an expression language (number/date arithmetic and boolean logic, for now) allowing virtual fields that is evaluated within the context of a parsed record. All of this works fine (though some parts aren&#39;t pretty). But now I need to represent a &quot;group by&quot; operation on this data so that each group (list of records) is transformed into a record of lists and passed to the aggregation component of the specification."}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1435304306, "post_id": 31053514, "comment_id": 50154651, "body": "Is the parsing specification (the types of columns) defined at compile time or at run time? And how is the specification given?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1435318356, "post_id": 31053514, "comment_id": 50162870, "body": "@PetrPudl&#225;k It is at run time and user defined. The specification is in the form of a simple expression language with variables being fields in the context of a record (raw values or virtual fields). There is something of a type checking pass prior to the grouping transformation which is why I &quot;know&quot; earlier that all the values in a given field are of the same type. Currently the specification is stored in a database."}], "answers": [{"comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435244909, "post_id": 31053821, "comment_id": 50129492, "body": "Thank you for the reply! This isn&#39;t quite what I&#39;m looking for, though. I&#39;m actually trying to &quot;collapse&quot; multiple Maps into a single Map, with the values being lists of the values in the component maps. The piece I want to avoid is having to check whether the values from two maps are of the same type and propagating that exception, since I do that check at construction time so I &quot;know&quot;, but just don&#39;t know how to encode that knowledge in the type system."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435250375, "post_id": 31053821, "comment_id": 50133312, "body": "@ZJM You should add that to the question."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1435254369, "post_id": 31053821, "comment_id": 50135636, "body": "@chi Thanks I updated the question to try to be more clear."}], "tags": [], "owner": {"reputation": 224912, "user_id": 33518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06834fe3fb105f62b2186aba4a430d5?s=128&d=identicon&r=PG", "display_name": "Tomas Petricek", "link": "https://stackoverflow.com/users/33518/tomas-petricek"}, "is_accepted": false, "score": 0, "last_activity_date": 1435258866, "last_edit_date": 1435258866, "creation_date": 1435244016, "answer_id": 31053821, "question_id": 31053514, "link": "https://stackoverflow.com/questions/31053514/is-it-possible-to-represent-this-transformation-in-a-strongly-typed-manner/31053821#31053821", "title": "Is it possible to represent this transformation in a strongly typed manner?", "body": "<p>You could define a <code>transformMap</code> function that has the property you want (i.e. preserves the key and turns strings to lists of strings and bools to lists of bools). The function can still be fully parametric in what it does with the values:</p>\n\n\n\n<pre class=\"lang-ml prettyprint-override\"><code>let transformMap fstr fbool map = \n  map |&gt; Map.map (fun k v -&gt; \n    match v with \n    | TBool b -&gt; TLBool(fbool k b)\n    | TString s -&gt; TLString(fstr k s) )\n</code></pre>\n\n<p>Any transformation that you then perform on your map using <code>transformMap</code> has the properties you want. If you wanted to be more strict, you could write a wrapper over <code>Map&lt;'K, TestList&gt;</code> and hide the internal representation, which would give you a strong guarantee. In practice, I think it is probably reasonable to make the internals public, but check by hand that you only manipulate the map using your correct transformation function. </p>\n\n<p>An example that turns each value into a singleton list using this function looks like this:</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>Map.empty |&gt; transformMap\n  (fun k s -&gt; [s])\n  (fun k b -&gt; [b])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435246097, "post_id": 31054397, "comment_id": 50130458, "body": "Thank you for the reply! Unfortunately this solution doesn&#39;t gain me anything since it just defers the &quot;checking&quot; of the types of the elements in the list until I process that list. I also suspect it may not be possible due to limitations of the type system, but would be happy with any solution no matter how convoluted - I do feel it would be worth the effort."}, {"owner": {"reputation": 46011, "user_id": 162396, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a57d6a4d1d19991243d3afa1294fa6e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/162396/daniel"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435246417, "post_id": 31054397, "comment_id": 50130672, "body": "What do you mean by &quot;checking of the types&quot;? We do know that list elements are of the same type (as in <code>System.Type</code>). I thought you were trying to capture the fact that the keys of the resulting map are unique, prior to building the map."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435246715, "post_id": 31054397, "comment_id": 50130891, "body": "I&#39;m sorry I may have phrased my question unintuitively. My goal is to be able to collapse two maps (or more, but once I can do two I can recurse) &quot;knowing&quot; that though each map&#39;s value are heterogenous, the type of the value at a given key is the same between the two maps. I &quot;know&quot; this because that invariant is enforced at the time the map is constructed, but I currently lose that information from the perspective of the type system since I don&#39;t know how to encode it."}, {"owner": {"reputation": 46011, "user_id": 162396, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a57d6a4d1d19991243d3afa1294fa6e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/162396/daniel"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435246917, "post_id": 31054397, "comment_id": 50131039, "body": "The types of the values of <i>all</i> the keys are the same, right? <code>Map&lt;&#39;K, &#39;V&gt;</code> means a map where all keys are of type <code>&#39;K</code> and all values are of types <code>&#39;V</code>. Maybe I still don&#39;t understand what you&#39;re saying...?"}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435247632, "post_id": 31054397, "comment_id": 50131551, "body": "Yes I&#39;m sorry. So the Test type allows my to combine bools and strings into a single type to use in a type constructor such as Map. However, I &quot;know&quot; that index 0 is always a TBool, index 1 is always a TString, etc. I would like to encode that information such that I can combine the maps [(0, TBool true); (1, TString &quot;&quot;)] and [(0, TBool false); (1, TString &quot;&quot;)] into [(0, TLBool [true;false]); (1, TLString [&quot;&quot;, &quot;&quot;])] without having to check for (and propagate on error) the condition that the values at index 0 in the two maps are indeed both TBool."}, {"owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435250204, "post_id": 31054397, "comment_id": 50133220, "body": "@ZJM, do you just want heterogeneous lists? Not sure about F#, but in Haskell it&#39;s just <code>data HList as where HNil :: HList &#39;[]; HCons :: a -&gt; HList as -&gt; HList (a &#39;: as)</code>."}, {"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "reply_to_user": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "edited": false, "score": 0, "creation_date": 1435254075, "post_id": 31054397, "comment_id": 50135456, "body": "@user3237465 I do essentially want heterogenous lists (I used maps since my indices can be sparse, but I could always use lists with an index mapping), but with the additional constraint that two instances of the heterogenous list can be &quot;zipped together&quot; and the values at a given index are of the same type."}], "tags": [], "owner": {"reputation": 46011, "user_id": 162396, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6a57d6a4d1d19991243d3afa1294fa6e?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/162396/daniel"}, "is_accepted": false, "score": 0, "last_activity_date": 1435270566, "last_edit_date": 1435270566, "creation_date": 1435245527, "answer_id": 31054397, "question_id": 31053514, "link": "https://stackoverflow.com/questions/31053514/is-it-possible-to-represent-this-transformation-in-a-strongly-typed-manner/31054397#31054397", "title": "Is it possible to represent this transformation in a strongly typed manner?", "body": "<p>If you can do with <code>Test list</code> instead of <code>TestList</code>, the conversion is fairly straightforward:</p>\n\n<pre class=\"lang-fs prettyprint-override\"><code>let transform listOfMaps : Map&lt;int, Test list&gt; =\n    listOfMaps\n    |&gt; Seq.collect Map.toSeq \n    |&gt; Seq.groupBy fst\n    |&gt; Seq.map (fun (i, s) -&gt; \n        let xs = s |&gt; Seq.map snd |&gt; Seq.toList\n        i, xs)\n    |&gt; Map.ofSeq\n</code></pre>\n\n<p>As far as capturing your assumptions in the types, I suspect it's either impossible or much more effort than it's worth.</p>\n"}, {"comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435268594, "post_id": 31060764, "comment_id": 50143098, "body": "I have not worked with dependent types as my understanding is that current implementations are not yet practical for general usage. Are there any more specific terms that I could perhaps investigate in order to determine whether this particular application has a representation in less powerful systems? Unfortunately I cannot know at compile time since the positions are dependent on user input, and they would be too large to, for example, generate all permutations (current instances are ~50 fields and will be much larger)."}, {"owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "reply_to_user": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435273210, "post_id": 31060764, "comment_id": 50144868, "body": "@ZJM: that sounds more like structural record types than collections.  But I&#39;m afraid that structural record types are another thing that barely any mature languages have support for; you might want to look at O&#39;Caml&#39;s object system for one of the better examples.  It still might not be enough, because if the field names and types aren&#39;t known at compilation time, it&#39;s also a matter of runtime reflection into structural record types."}], "tags": [], "owner": {"reputation": 28456, "user_id": 1094403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3770aa7eae5c211921493abd0d2c9f5a?s=128&d=identicon&r=PG", "display_name": "Luis Casillas", "link": "https://stackoverflow.com/users/1094403/luis-casillas"}, "is_accepted": false, "score": 1, "last_activity_date": 1435266267, "creation_date": 1435266267, "answer_id": 31060764, "question_id": 31053514, "link": "https://stackoverflow.com/questions/31053514/is-it-possible-to-represent-this-transformation-in-a-strongly-typed-manner/31060764#31060764", "title": "Is it possible to represent this transformation in a strongly typed manner?", "body": "<blockquote>\n  <p><strong>Edit</strong> [...] The root of what I'm after is to be able to take two variable sized collections whose values at a given position are always the same type, but that the collection itself can contain values of multiple types, and \"zip\" them together using the knowledge that at a given position the two values are the same type.</p>\n</blockquote>\n\n<p>This, in its broadest reading, fundamentally requires that the types of the collections encode which position contains which element type, and this dips into dependent types territory.</p>\n\n<p>If there is one fixed shape of collection that can be determined at compilation time, however, then it's easy\u2014you just write a type all of whose values have that shape.</p>\n"}, {"comments": [{"owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "edited": false, "score": 0, "creation_date": 1435319235, "post_id": 31061534, "comment_id": 50163375, "body": "Thank you very much for this! I do not fully understand and will need to play with it a bit. The hzipWith function appears to the form I&#39;m looking for I&#39;m just not sure the types line up the way I would need. But I do think I will learn something at least, and possibly be able to apply this to other problems!"}], "tags": [], "owner": {"reputation": 11986, "user_id": 3237465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/vOArX.png?s=128&g=1", "display_name": "user3237465", "link": "https://stackoverflow.com/users/3237465/user3237465"}, "is_accepted": false, "score": 0, "last_activity_date": 1435277157, "last_edit_date": 1435277157, "creation_date": 1435269615, "answer_id": 31061534, "question_id": 31053514, "link": "https://stackoverflow.com/questions/31053514/is-it-possible-to-represent-this-transformation-in-a-strongly-typed-manner/31061534#31061534", "title": "Is it possible to represent this transformation in a strongly typed manner?", "body": "<p>Heterogeneous lists with elements wrapped in some <code>f</code> are:</p>\n\n<pre><code>{-# LANGUAGE GADTs, DataKinds, TypeOperators #-}\n\ninfixr 5 :::\n\ndata HList f as where\n    HNil  :: HList f '[]\n    (:::) :: f a -&gt; HList f as -&gt; HList f (a ': as)\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>xs1 :: HList [] [Bool, Int]\nxs1 = [True, False] ::: [1..3] ::: HNil\n\nxs2 :: HList [] [Bool, Int]\nxs2 = [True]        ::: [1..5] ::: HNil\n</code></pre>\n\n<p>It's easy to zip two <code>HList []</code>:</p>\n\n<pre><code>hzip :: HList [] as -&gt; HList [] as -&gt; HList [] as\nhzip  HNil         HNil        = HNil\nhzip (xs ::: xss) (ys ::: yss) = (xs ++ ys) ::: hzip xss yss\n</code></pre>\n\n<p>Or a bit more generally (and with the <code>Rank2Types</code> extension):</p>\n\n<pre><code>hzipWith :: (forall a. f a -&gt; g a -&gt; h a) -&gt; HList f as -&gt; HList g as -&gt; HList h as\nhzipWith f  HNil       HNil      = HNil\nhzipWith f (x ::: xs) (y ::: ys) = f x y ::: hzipWith f xs ys\n\nhzip :: HList [] as -&gt; HList [] as -&gt; HList [] as\nhzip = hzipWith (++)\n</code></pre>\n\n<p>Then (requires <code>FlexibleInstances</code> and <code>FlexibleContexts</code>)</p>\n\n<pre><code>instance Show (HList f '[]) where\n    show HNil = \"HNil\"\n\ninstance (Show (f a), Show (HList f as)) =&gt; Show (HList f (a ': as)) where\n    show (x ::: xs) = show x ++ \" ::: \" ++ show xs \n\nmain = print $ hzip xs1 xs2\n</code></pre>\n\n<p>prints <code>[True,False,True] ::: [1,2,3,1,2,3,4,5] ::: HNil</code>.</p>\n"}], "owner": {"reputation": 4185, "user_id": 1424121, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c6f5c5cd761b9ce4493fd875cc041ac3?s=128&d=identicon&r=PG", "display_name": "ryachza", "link": "https://stackoverflow.com/users/1424121/ryachza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 1, "answer_count": 4, "score": 2, "last_activity_date": 1435277157, "creation_date": 1435243201, "last_edit_date": 1435258811, "question_id": 31053514, "link": "https://stackoverflow.com/questions/31053514/is-it-possible-to-represent-this-transformation-in-a-strongly-typed-manner", "title": "Is it possible to represent this transformation in a strongly typed manner?", "body": "<p>I'm looking to perform a transformation like (in F#):</p>\n\n<pre class=\"lang-ml prettyprint-override\"><code>type Test = TBool of bool | TString of string\n\ntype TestList = TLBool of bool list | TLString of string list\n\nlet transform : Map&lt;int, Test&gt; list -&gt; Map&lt;int, TestList&gt; = ??\n</code></pre>\n\n<p>Is there a way to encode this such that we \"know\" that while the Map contains heterogeneous values, the value at each position is the same type across elements of the containing list? The Maps would be of static size once constructed and the same across each list element, but the size is not known in advance so I'm basically looking to generate tuples/records of an unknown size.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I think my example was unclear. The root of what I'm after is to be able to take two variable sized collections whose values at a given position are always the same type, but that the collection itself can contain values of multiple types, and \"zip\" them together using the knowledge that at a given position the two values are the same type. Specifically, I don't want to have to recheck that they are the same and propagate the condition that they vary (as an error of some sort), since I already do exactly that when initially creating the collections.</p>\n\n<p><strong>Edit 2</strong></p>\n\n<p>From a comment posted below: I do essentially want heterogenous lists (I used maps since my indices can be sparse, but I could always use lists with an index mapping), but with the additional constraint that two instances of the heterogenous list can be \"zipped together\" and the values at a given index are of the same type.</p>\n"}, {"tags": ["html", "haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 3, "creation_date": 1435262654, "post_id": 31052290, "comment_id": 50140232, "body": "But... there aren&#39;t any HTML tags in your original string! (And TagSoup is correctl"}], "answers": [{"tags": [], "owner": {"reputation": 387, "user_id": 1701790, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/65944183b3935873fd2087e45b27269e?s=128&d=identicon&r=PG", "display_name": "Goens", "link": "https://stackoverflow.com/users/1701790/goens"}, "is_accepted": false, "score": 1, "last_activity_date": 1435243541, "last_edit_date": 1435243541, "creation_date": 1435241559, "answer_id": 31052863, "question_id": 31052290, "link": "https://stackoverflow.com/questions/31052290/remove-html-tags-in-haskell/31052863#31052863", "title": "Remove HTML Tags in Haskell", "body": "<p>Does it have to be with <code>Text.HTML.TagSoup</code>? It seems <code>Hakyll.Web.Html</code> would be a much better fit: <a href=\"https://hackage.haskell.org/package/hakyll-4.1.2.1/docs/Hakyll-Web-Html.html\" rel=\"nofollow\">https://hackage.haskell.org/package/hakyll-4.1.2.1/docs/Hakyll-Web-Html.html</a></p>\n\n<p>There you have a function that does what it seems you want:</p>\n\n<p>stripTags :: String -> StringSource</p>\n\n<p>Strip all HTML tags from a string</p>\n"}], "owner": {"reputation": 2024, "user_id": 2726995, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/43b927bba59dd5210f0f12b705997407?s=128&d=identicon&r=PG&f=1", "display_name": "user2726995", "link": "https://stackoverflow.com/users/2726995/user2726995"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1435243541, "creation_date": 1435240180, "question_id": 31052290, "link": "https://stackoverflow.com/questions/31052290/remove-html-tags-in-haskell", "title": "Remove HTML Tags in Haskell", "body": "<p>I have a string such as </p>\n\n<pre><code>&amp;lt;b&amp;gt;Vitamin A&amp;lt;/b&amp;gt;&amp;lt;br&amp;gt;Chloe Braided Halter Swim Top&amp;#44;\n</code></pre>\n\n<p>Using Text.HTML.TagSoup I am attempting to remove all html and just have</p>\n\n<pre><code>\"Vitamin Chloe Braided Halter Swim Top\" \n</code></pre>\n\n<p>using</p>\n\n<pre><code>import qualified Text.HTML.TagSoup as TS \nTS.parseTags \"&amp;lt;b&amp;gt;Vitamin A&amp;lt;/b&amp;gt;&amp;lt;br&amp;gt;Chloe Braided Halter Swim Top&amp;#44;\"\n\n[TagText \"&lt;b&gt;Vitamin A&lt;/b&gt;&lt;br&gt;Chloe Braided Halter Swim Top,\"]\n</code></pre>\n\n<p>How can I strip all HTML tags ? </p>\n"}, {"tags": ["haskell", "ghci"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 3, "creation_date": 1435221015, "post_id": 31044960, "comment_id": 50112649, "body": "That&#39;s because GHCi ignores the list of exports and exports everything from the module."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1435221148, "post_id": 31044960, "comment_id": 50112729, "body": "<b>Do not trust GHCi</b>. It behaves differently from GHC. If you find something odd when using GHCi try to past the code into a file and compile it."}], "owner": {"reputation": 21, "user_id": 5047917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3665a0a317cbbc2b5b4187f8c7e40615?s=128&d=identicon&r=PG", "display_name": "jpmathew", "link": "https://stackoverflow.com/users/5047917/jpmathew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "closed_date": 1435221931, "answer_count": 0, "score": 2, "last_activity_date": 1435221392, "creation_date": 1435220733, "last_edit_date": 1435221392, "question_id": 31044960, "link": "https://stackoverflow.com/questions/31044960/why-is-this-value-constructor-not-hidden", "closed_reason": "Duplicate", "title": "Why is this value constructor not hidden?", "body": "<p>Refer to <a href=\"https://wiki.haskell.org/Smart_constructors\" rel=\"nofollow\">https://wiki.haskell.org/Smart_constructors</a> and module code:</p>\n\n<pre><code>module Resistor (\n         Resistor,       -- abstract, hiding constructors\n         metalResistor,  -- only way to build a metal resistor\n       ) where\n\n ...\n</code></pre>\n\n<p>When I try this in ghci, I am able to call both <code>metalResistor</code> and <code>Metal</code>. Metal was supposed to be hidden. \nWhat should I do to properly hide the <code>Resistor</code> value constructor?</p>\n"}, {"tags": ["linux", "haskell"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1435217618, "post_id": 31043717, "comment_id": 50110470, "body": "Get a GHC binary and build or download a cabal binary - better yet the haskell platform, which comes with cabal - and install pandoc with <code>cabal install pandoc</code>."}, {"owner": {"reputation": 24266, "user_id": 946226, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5823d09208b1e4b63bbfcd189492032c?s=128&d=identicon&r=PG", "display_name": "Joachim Breitner", "link": "https://stackoverflow.com/users/946226/joachim-breitner"}, "edited": false, "score": 0, "creation_date": 1435218528, "post_id": 31043717, "comment_id": 50111044, "body": "Do you have a non-standard operating system that prevents you from using existing binaries, or your distribution\u2019s packages?"}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 2, "creation_date": 1435222364, "post_id": 31043717, "comment_id": 50113485, "body": "In case you didn&#39;t know there is an web interface: <a href=\"http://pandoc.org/try/\" rel=\"nofollow noreferrer\">pandoc.org/try</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1435235602, "post_id": 31043717, "comment_id": 50121865, "body": "I suppose this question might better be phrased \u201chow to completely bootstrap GHC &amp; cabal from source\u201d. Once you have those, getting Pandoc is trivial..."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1435238865, "post_id": 31043717, "comment_id": 50124489, "body": "To compile GHC, you need GHC. You appear to have a chicken-and-egg problem here..."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1435246918, "post_id": 31043717, "comment_id": 50131042, "body": "Can you install GHC (or pandoc for that matter) through your package manager?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1435249218, "post_id": 31043717, "comment_id": 50132621, "body": "@MathematicalOrchid: it should certainly be possible to \u201cupgrade\u201d yourself through a whole lot of versions of GHC, as was historically done (the first ones were written in C, the first Haskell ones compiled with first-generation GHC, etc.). It would be a heck lot of work though \u2013 interesting question is, could there be an faster option."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1435251233, "post_id": 31043717, "comment_id": 50133809, "body": "Theoretically possible, but probably requires installing ancient versions of gcc and other tools first, so it still wouldn&#39;t solve OP&#39;s problem."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1435253752, "post_id": 31043717, "comment_id": 50135268, "body": "@leftaroundabout Isn&#39;t there an option to compile GHC to ANSI-C? (For porting?) That might be a shorter route to bootstrapping. You still need to install the binary for a C compiler though. ;-)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1435254049, "post_id": 31043717, "comment_id": 50135437, "body": "@MathematicalOrchid: interesting approach. Though IMO it would be somewhat pointless to allow compiler-generated C code... you could always transform any binary into \u201cC code\u201d that simply writes that executable (stored in the C code as e.g. Base64-string) back to a file, then executes it."}, {"owner": {"reputation": 2340, "user_id": 2068635, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/vFzWX.png?s=128&g=1", "display_name": "Stefan", "link": "https://stackoverflow.com/users/2068635/stefan"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1435345598, "post_id": 31043717, "comment_id": 50179387, "body": "@MathematicalOrchid <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Building/Porting\" rel=\"nofollow noreferrer\">Porting</a> via .hc seems to be broken (the Bug is closed in favor of CrossCompilation)."}], "answers": [{"comments": [{"owner": {"reputation": 18893, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "edited": false, "score": 0, "creation_date": 1435233439, "post_id": 31049520, "comment_id": 50120324, "body": "Nice try but it won&#39;t work. I can&#39;t download any executable. Thus, I can&#39;t do the first point <code>Obtain the stack executable</code>. I naively tried to download the version from GitHub but I get an error: <code>docker: Command not found</code>."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 18893, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "edited": false, "score": 0, "creation_date": 1435234228, "post_id": 31049520, "comment_id": 50120884, "body": "Exactly what did you do to get the  <code>docker: ...</code> error?"}, {"owner": {"reputation": 18893, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "edited": false, "score": 0, "creation_date": 1435234496, "post_id": 31049520, "comment_id": 50121060, "body": "As mentioned in my question, I don&#39;t have an internet connection. I can only download things from Google Chrome. If <code>stack</code> is planning to fetch anything from the internet, it won&#39;t work."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 18893, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "edited": false, "score": 0, "creation_date": 1435235032, "post_id": 31049520, "comment_id": 50121437, "body": "Link #2 is an HTML page which tells you how to get the <code>stack</code> executable for various platform."}, {"owner": {"reputation": 18893, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "edited": false, "score": 0, "creation_date": 1435235301, "post_id": 31049520, "comment_id": 50121621, "body": "I cannot get any executable from internet. If I want to use <code>stack</code> I need to build it from the sources."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 18893, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "edited": false, "score": 4, "creation_date": 1435235663, "post_id": 31049520, "comment_id": 50121922, "body": "I would talk to your IT department about your problem. Obviously they don&#39;t require that you build <code>gcc</code> (or whatever C compiler you use) from source. If they don&#39;t allow <code>stack</code>, perhaps they will let you start with a &quot;ghc bindist&quot; which you can download <a href=\"https://www.haskell.org/ghc/download_ghc_7_8_4#x86_64linux\" rel=\"nofollow noreferrer\">here</a>. The bindists are produced by the GHC compiler team so they are authoritative builds."}, {"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "reply_to_user": {"reputation": 18893, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "edited": false, "score": 0, "creation_date": 1435236832, "post_id": 31049520, "comment_id": 50122841, "body": "Most compilers are written in the same language they compile and GHC is no different. so building GHC &quot;from source&quot; is not a viable option for you. You&#39;re best bet is to get the powers that be bless a GHC bandits and from that you can bootstrap your way up. Or use a pandoc web service as @Sibi mentioned."}], "tags": [], "owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "is_accepted": true, "score": 2, "last_activity_date": 1437721869, "last_edit_date": 1437721869, "creation_date": 1435232940, "answer_id": 31049520, "question_id": 31043717, "link": "https://stackoverflow.com/questions/31043717/how-to-completely-bootstrap-ghc-cabal-from-source/31049520#31049520", "title": "How to completely bootstrap GHC &amp; cabal from source", "body": "<p>I would try using the newly (beta-)released <code>stack</code> tool [<a href=\"https://www.fpcomplete.com/blog/2015/06/announcing-first-public-beta-stack\" rel=\"nofollow\">1</a>]</p>\n\n<p>Recipe to download GHC and build pandoc:</p>\n\n<ol>\n<li>Obtain the <code>stack</code> executable [<a href=\"https://github.com/commercialhaskell/stack/wiki/Downloads\" rel=\"nofollow\">2</a>]</li>\n<li><p>Run:</p>\n\n<p>$ stack setup</p></li>\n<li><p>Add the recommended directory to your PATH (will be something like <code>$HOME/.stack/progams/...arch.../ghc-7.8.4/bin</code>)</p></li>\n<li><p>Run:</p>\n\n<p>$ stack install pandoc</p></li>\n<li><p>Look for the <code>pandoc</code> executable in <code>$HOME/.local/bin</code>.</p></li>\n</ol>\n\n<p>Links:</p>\n\n<pre><code>[1]: https://www.fpcomplete.com/blog/2015/06/announcing-first-public-beta-stack\n[2]: https://github.com/commercialhaskell/stack/wiki/Downloads\n</code></pre>\n"}], "owner": {"reputation": 18893, "user_id": 2612235, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/dpsjq.jpg?s=128&g=1", "display_name": "nowox", "link": "https://stackoverflow.com/users/2612235/nowox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 776, "favorite_count": 1, "accepted_answer_id": 31049520, "answer_count": 1, "score": 3, "last_activity_date": 1437721869, "creation_date": 1435216763, "last_edit_date": 1435235714, "question_id": 31043717, "link": "https://stackoverflow.com/questions/31043717/how-to-completely-bootstrap-ghc-cabal-from-source", "title": "How to completely bootstrap GHC &amp; cabal from source", "body": "<p>I would like to install <a href=\"/questions/tagged/pandoc\" class=\"post-tag\" title=\"show questions tagged &#39;pandoc&#39;\" rel=\"tag\">pandoc</a>, but I have some restrictions due to the Corporate IT policies: </p>\n\n<ol>\n<li>I cannot download any binaries. </li>\n<li>Every executable has to be build from sources</li>\n<li>Only Google Chrome have an access to internet (proxy restrictions)</li>\n</ol>\n\n<p>So I downloaded <code>Pandoc</code> sources but it depends on <a href=\"/questions/tagged/haskell\" class=\"post-tag\" title=\"show questions tagged &#39;haskell&#39;\" rel=\"tag\">haskell</a>. Thus I downloaded <code>ghc-7.8.4-src.tar.bz2</code></p>\n\n<p>Unfortunately I discovered that I need <code>GHC</code> to build <code>GHC</code>. I downloaded <code>ghc-7.4.1-i386-unknown-linux.tar.bz2</code> and I got this error:</p>\n\n<pre><code>$ ./configure\nchecking for path to top of build tree... ./configure: line 2113: utils/ghc-pwd/dist-install/build/tmp/ghc-pwd: cannot execute binary file: Exec format error\nconfigure: error: cannot determine current directory\n</code></pre>\n\n<p>In <code>\"/usr/src/ghc-7.4.1/utils/ghc-pwd/dist-install/build/tmp/usr/src/ghc-7.4.1/utils/ghc-pwd/dist-install/build/tmp\"</code> I found a binary that should not be here. I cannot execute binaries.</p>\n\n<p>I also discovered that I need <a href=\"/questions/tagged/cabal\" class=\"post-tag\" title=\"show questions tagged &#39;cabal&#39;\" rel=\"tag\">cabal</a> for which I need to install <code>Haskell</code> first. </p>\n\n<p>It seems It's the snake that bites its own tail...</p>\n\n<p>Is there a method that I can use to build Pandod, Haskell, Cabal and all the other dependencies?</p>\n\n<p>Usually if I need a program, I just download the sources, execute <code>./configure</code>, solve the dependencies issues and eventually run <code>make install</code>. In this case it seems I need my whole lifetime just to understand what I need to build Pandoc...</p>\n"}, {"tags": ["haskell", "monads", "monad-transformers"], "comments": [{"owner": {"reputation": 304245, "user_id": 216074, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/609c93bafd659500f83fde04802a9be5?s=128&d=identicon&r=PG", "display_name": "poke", "link": "https://stackoverflow.com/users/216074/poke"}, "edited": false, "score": 5, "creation_date": 1435215546, "post_id": 31043254, "comment_id": 50109195, "body": "Have you tried running <code>:t unET</code> in ghci?"}], "answers": [{"tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 4, "last_activity_date": 1435216185, "creation_date": 1435216185, "answer_id": 31043535, "question_id": 31043254, "link": "https://stackoverflow.com/questions/31043254/what-is-the-type-of-a-very-simple-unwrap-function-for-a-transformed-monad/31043535#31043535", "title": "What is the type of a very simple unwrap function for a transformed monad?", "body": "<p>Just look at the definition:</p>\n\n<pre><code>unET (ET m) = m\n</code></pre>\n\n<p>you know that the only field of <code>ET</code> has type: <code>m (Maybe a)</code>. The <code>unET</code> function takes an <code>ET m a</code> and returns its only field, so the return type of <code>unET</code> must be the type of the field, i.e. <code>m (Maybe a)</code> and <em>not</em> <code>m a</code>!</p>\n"}], "owner": {"reputation": 2695, "user_id": 1924798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1ba7bffbe41ca39353b6f8bbfd4624a8?s=128&d=identicon&r=PG", "display_name": "Marco Faustinelli", "link": "https://stackoverflow.com/users/1924798/marco-faustinelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 1, "accepted_answer_id": 31043535, "answer_count": 1, "score": -1, "last_activity_date": 1435216185, "creation_date": 1435215326, "question_id": 31043254, "link": "https://stackoverflow.com/questions/31043254/what-is-the-type-of-a-very-simple-unwrap-function-for-a-transformed-monad", "title": "What is the type of a very simple unwrap function for a transformed monad?", "body": "<p>I am exercising with monad transformers as presented in <a href=\"http://www.cs.nott.ac.uk/~nhn/MGS2006/LectureNotes/lecture03-9up.pdf\" rel=\"nofollow\">http://www.cs.nott.ac.uk/~nhn/MGS2006/LectureNotes/lecture03-9up.pdf</a></p>\n\n<p>I have an implementation for an <strong>error transformer</strong> which reads like:</p>\n\n<pre><code>newtype ET m a = ET (m (Maybe a))\nderiving instance Show (m (Maybe a)) =&gt; Show (ET m a)\n</code></pre>\n\n<p>(Actually this looks to me like <code>MaybeT</code>, but ok...)</p>\n\n<p>I wish to specify a function to unwrap <code>ET</code>'s. This function is given in the paper and does its job even without type declaration:</p>\n\n<pre><code>unET (ET m) = m\n</code></pre>\n\n<p>The thing is that <strong>I am uncapable to specify its type explicity</strong>. If I prepend a type which seems reasonable to me:</p>\n\n<pre><code>unET :: (Monad m) =&gt; ET m a -&gt; m a\n</code></pre>\n\n<p>the error message is <code>Could not deduce (a ~ Maybe a) from the context (Monad m)</code></p>\n\n<p>What is the type of the <code>unET</code> function?</p>\n\n<p>I have already tried the magic compiler spells <code>NoMonomorphismRestriction</code>, <code>MonoLocalBinds</code>, which I've found in answers to similar questions. Still no joy.</p>\n\n<p>Thank you for your attention.</p>\n"}, {"tags": ["haskell", "stm"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 4, "creation_date": 1435201157, "post_id": 31040329, "comment_id": 50104330, "body": "You have your <code>then</code>/<code>else</code> swapped compared to <code>check</code>."}, {"owner": {"reputation": 1595, "user_id": 2913916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/478cf0ef7b6e6b5233eae232acf258d1?s=128&d=identicon&r=PG&f=1", "display_name": "Code Monkey", "link": "https://stackoverflow.com/users/2913916/code-monkey"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1435205942, "post_id": 31040329, "comment_id": 50105493, "body": "Oh dear, of course it&#39;s that obvious! Thanks @DanielWagner"}, {"owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 1, "creation_date": 1435214344, "post_id": 31040329, "comment_id": 50108525, "body": "@CodeMonkey Perhaps write your own answer to the question and accept it so it doesn&#39;t appear open any more."}, {"owner": {"reputation": 1595, "user_id": 2913916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/478cf0ef7b6e6b5233eae232acf258d1?s=128&d=identicon&r=PG&f=1", "display_name": "Code Monkey", "link": "https://stackoverflow.com/users/2913916/code-monkey"}, "reply_to_user": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "edited": false, "score": 0, "creation_date": 1435214574, "post_id": 31040329, "comment_id": 50108652, "body": "@PetrPudl&#225;k good idea, I&#39;ve added my own answer but can&#39;t accept for 2 days."}], "answers": [{"tags": [], "owner": {"reputation": 1595, "user_id": 2913916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/478cf0ef7b6e6b5233eae232acf258d1?s=128&d=identicon&r=PG&f=1", "display_name": "Code Monkey", "link": "https://stackoverflow.com/users/2913916/code-monkey"}, "is_accepted": false, "score": 3, "last_activity_date": 1435214543, "creation_date": 1435214543, "answer_id": 31043017, "question_id": 31040329, "link": "https://stackoverflow.com/questions/31040329/is-haskells-stm-check-different-from-explicitly-using-retry/31043017#31043017", "title": "Is Haskell&#39;s STM `check` different from explicitly using `retry`?", "body": "<p>No, <code>check</code> is no different than to using <code>retry</code> explicitly, I simply confused the argument to <code>check</code>. </p>\n\n<p>The solution is to <code>check</code> that <code>isTaken</code> is <code>False</code>, i.e., <code>check $ not isTaken</code>.</p>\n\n<pre><code>takeChopstick :: ChopStick -&gt; STM ()\ntakeChopstick (CS chopstick) = do\n    isTaken &lt;- readTVar chopstick\n    check (not isTaken)\n    writeTVar chopstick True\n</code></pre>\n"}], "owner": {"reputation": 1595, "user_id": 2913916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/478cf0ef7b6e6b5233eae232acf258d1?s=128&d=identicon&r=PG&f=1", "display_name": "Code Monkey", "link": "https://stackoverflow.com/users/2913916/code-monkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1435214543, "creation_date": 1435200135, "question_id": 31040329, "link": "https://stackoverflow.com/questions/31040329/is-haskells-stm-check-different-from-explicitly-using-retry", "title": "Is Haskell&#39;s STM `check` different from explicitly using `retry`?", "body": "<p>I am experimenting with STM by implementing the dining philsophers problems.</p>\n\n<p>Anyway, I have the following definitions.</p>\n\n<pre><code>data ChopStick = CS (TVar Bool)\n\ntakeChopstick :: ChopStick -&gt; STM ()\ntakeChopstick (CS chopstick) = do\n    isTaken &lt;- readTVar chopstick\n    check (isTaken)\n    writeTVar chopstick True\n</code></pre>\n\n<p>This function is called atomically:</p>\n\n<pre><code>atomically $ do\n    takeChopstick leftChopstick\n    takeChopstick rightChopstick\n</code></pre>\n\n<p>When running the program with the above definition of takeChopstick, I experience different results to running it with this definition:</p>\n\n<pre><code>takeChopstick :: ChopStick -&gt; STM ()\ntakeChopstick (CS chopstick) = do\n    isTaken &lt;- readTVar chopstick\n    if isTaken\n        then retry\n        else writeTVar chopstick True\n</code></pre>\n\n<p>In particular, the program hangs. </p>\n\n<p>The source code for <code>check</code> (hackage, stm-2.2.0.1) is as follows:</p>\n\n<pre><code>check :: Bool -&gt; STM a\ncheck b = if b then return undefined else retry\n</code></pre>\n\n<p>Which appears to be effectively the same as my explicit use of <code>retry</code>.</p>\n\n<p>How does <code>check</code> differ to explicitly using <code>retry</code>? Is pushing the <code>retry</code> call further down causing it to restart a different atomic block? </p>\n"}, {"tags": ["java", "haskell", "stream"], "answers": [{"comments": [{"owner": {"reputation": 557, "user_id": 573800, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/4987adff3a738aeccdc59a3ee7613e13?s=128&d=identicon&r=PG", "display_name": "Tad", "link": "https://stackoverflow.com/users/573800/tad"}, "edited": false, "score": 0, "creation_date": 1435243162, "post_id": 31039524, "comment_id": 50128079, "body": "Thanks.  That&#39;s exactly what I was looking for.  So the function that works for me is:  \tpublic static Boolean or(Stream&lt;Boolean&gt; bs) {return bs.anyMatch(b -&gt; b);}"}], "tags": [], "owner": {"reputation": 251342, "user_id": 438154, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/827d86026ddc062f449ccedece1c52da?s=128&d=identicon&r=PG&f=1", "display_name": "Sotirios Delimanolis", "link": "https://stackoverflow.com/users/438154/sotirios-delimanolis"}, "is_accepted": true, "score": 6, "last_activity_date": 1435199557, "last_edit_date": 1435199557, "creation_date": 1435193809, "answer_id": 31039524, "question_id": 31039477, "link": "https://stackoverflow.com/questions/31039477/what-is-a-good-way-to-implement-the-equivalent-of-haskells-or-function-using/31039524#31039524", "title": "What is a good way to implement the equivalent of Haskell&#39;s &quot;or&quot; function using Streams in Java", "body": "<p>Just use <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#anyMatch-java.util.function.Predicate-\"><code>Stream#anyMatch(...)</code></a> with a <code>Predicate</code> that returns the value itself.</p>\n\n<pre><code>// assuming there are no null values\nboolean or = booleans.anyMatch(b -&gt; b); // will only match if value is true\n</code></pre>\n\n<p>Similarly to what is described in the Haskell documentation for <code>or</code> that you linked, if the <code>Stream</code> is infinite, it cannot return <code>false</code>. It will continue to consume the <code>Stream</code> if all it sees is <code>false</code> values.</p>\n\n<p>This is a short-circuiting operation. It will (actually, it can, but doesn't have to) return <code>true</code> as soon as it finds a <code>true</code> value.</p>\n"}], "owner": {"reputation": 557, "user_id": 573800, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/4987adff3a738aeccdc59a3ee7613e13?s=128&d=identicon&r=PG", "display_name": "Tad", "link": "https://stackoverflow.com/users/573800/tad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 31039524, "answer_count": 1, "score": 2, "last_activity_date": 1435199557, "creation_date": 1435193402, "question_id": 31039477, "link": "https://stackoverflow.com/questions/31039477/what-is-a-good-way-to-implement-the-equivalent-of-haskells-or-function-using", "title": "What is a good way to implement the equivalent of Haskell&#39;s &quot;or&quot; function using Streams in Java", "body": "<p>I'm looking for an equivalent to <a href=\"https://hackage.haskell.org/package/base-4.7.0.1/docs/Data-List.html#v:or\" rel=\"nofollow\">Haskell's \"or\" function</a> in Java using Streams.  </p>\n\n<p>This version does not return when given an infinite stream:</p>\n\n<pre><code>    public static Boolean or(Stream&lt;Boolean&gt; bs) {\n      return bs.reduce(false, (x, y) -&gt; x || y);\n    }\n</code></pre>\n\n<p>This version does not run because the bs stream is used twice:</p>\n\n<pre><code>    public static Boolean or(Stream&lt;Boolean&gt; bs) {\n    Optional&lt;Boolean&gt; b0 = bs.findFirst();\n\n    if (b0.isPresent()) {\n        return  b0.get() || or(bs.skip(1));\n    } else {\n        return false;\n    }\n}\n</code></pre>\n\n<p>I'm new to Java, so any tips would be greatly appreciated. Thanks.</p>\n"}]