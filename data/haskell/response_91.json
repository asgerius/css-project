[{"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1475708768, "post_id": 39884935, "comment_id": 67056813, "body": "<code>f(x y z)</code> is not the same as <code>f x y z</code> at all."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6929012"}, "reply_to_user": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1475709445, "post_id": 39884935, "comment_id": 67056963, "body": "@amalloy that helps mate. Many thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 1, "creation_date": 1475717334, "post_id": 39885204, "comment_id": 67058771, "body": "I think the semantic-equivalence point just confuses the issue."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 2, "last_activity_date": 1475709908, "creation_date": 1475709908, "answer_id": 39885204, "question_id": 39884935, "link": "https://stackoverflow.com/questions/39884935/haskell-patterns-matching-error-with-my-own-type/39885204#39885204", "title": "Haskell: Patterns matching error with my own type", "body": "<p><code>encodeMessage(xs cp n)</code> means the function <code>xs</code> is applied to <code>cp</code> and <code>n</code>, and the result of that is then fed as a single argument to <code>encodeMessage</code>. Well, that's evidently rubbish, because <code>xs</code> is not a function at all! Also, <code>encodeMessage</code> has three arguments, not one, which is what GHC is quite clearly telling you there.</p>\n\n<p>You evidently want <code>encodeMessage xs cp n</code>, which BTW is equivalent to all of the following:</p>\n\n<pre><code>((encodeMessage xs) cp) n\n((encodeMessage xs) cp) (n)\n((encodeMessage) xs) (cp) n\n...\n</code></pre>\n\n<p>and also <a href=\"https://en.wikipedia.org/wiki/Currying\" rel=\"nofollow\">semantically equivalent</a> to </p>\n\n<pre><code>encodeMessage (xs, cp, n)\n</code></pre>\n\n<p>...or, <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Tuple.html#v:uncurry\" rel=\"nofollow\">more precisely</a>,</p>\n\n<pre><code>uncurry (uncurry encodeMessage) ((xs, cp), n)\n</code></pre>\n\n<p>But it is not at all equivalent to <code>encodeMessage (xs cp n)</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6929012"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 39885204, "answer_count": 1, "score": 0, "last_activity_date": 1475737749, "creation_date": 1475708188, "last_edit_date": 1475737749, "question_id": 39884935, "link": "https://stackoverflow.com/questions/39884935/haskell-patterns-matching-error-with-my-own-type", "title": "Haskell: Patterns matching error with my own type", "body": "<p>I'm trying to take individual letter from user input string, follow a set of rule then give out encoded string. The parameters take a string, a cipher which is also a string and an integer. I've got some errors with  type matching. Here's my code </p>\n\n<pre><code> encodeMessage :: [Char]-&gt;Cipher-&gt;Int -&gt; [Char]\n encodeMessage (x:xs) [] _ = (x:xs)\n encodeMessage (x:xs) cp n\n  | n&gt;=0      = [(offsetRight (mod n 26) cp)!!((letterToNum x)-1)] ++ encodeMessage(xs cp n)\n  | otherwise = [(offsetLeft (26-(mod n 26)) cp)!!((letterToNum x)-1)] ++ encodeMessage(xs cp n)\n</code></pre>\n\n<p>Here's the structure for Cipher <code>type Cipher = [Char]</code>.\nHere's the error </p>\n\n<pre><code>SubstitutionCiphers.hs:95:71: error:\n    \u2022 Couldn't match expected type \u2018[Char]\u2019\n                  with actual type \u2018Cipher -&gt; Int -&gt; [Char]\u2019\n    \u2022 Probable cause: \u2018encodeMessage\u2019 is applied to too few arguments\n      In the second argument of \u2018(++)\u2019, namely \u2018encodeMessage (xs cp n)\u2019\n      In the expression:\n        [(offsetRight (mod n 26) cp) !! ((letterToNum x) - 1)]\n        ++ encodeMessage (xs cp n)\n      In an equation for \u2018encodeMessage\u2019:\n          encodeMessage (x : xs) cp n\n            | n &gt;= 0\n            = [(offsetRight (mod n 26) cp) !! ((letterToNum x) - 1)]\n              ++ encodeMessage (xs cp n)\n            | otherwise\n            = [(offsetLeft (26 - (mod n 26)) cp) !! ((letterToNum x) - 1)]\n              ++ encodeMessage (xs cp n)\n\nSubstitutionCiphers.hs:95:85: error:\n    \u2022 Couldn't match expected type \u2018Cipher -&gt; Int -&gt; [Char]\u2019\n                  with actual type \u2018[Char]\u2019\n    \u2022 The function \u2018xs\u2019 is applied to two arguments,\n      but its type \u2018[Char]\u2019 has none\n      In the first argument of \u2018encodeMessage\u2019, namely \u2018(xs cp n)\u2019\n      In the second argument of \u2018(++)\u2019, namely \u2018encodeMessage (xs cp n)\u2019\n</code></pre>\n"}, {"tags": ["haskell", "parallel-processing"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6902625"}, "edited": false, "score": 0, "creation_date": 1475716692, "post_id": 39884893, "comment_id": 67058598, "body": "<code>and your system has a spare CPU core, then the parallel version will finish faster.</code> -- but we wait for them both to finish anyway by calling <code>rseq</code>, therefore even if the 1st one finished fast, it still has to wait for the 2nd one afterwards. so what&#39;s the benefit on calling them in parallel instead of sequentially?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 3, "creation_date": 1475729829, "post_id": 39884893, "comment_id": 67061951, "body": "@Daaka The benefit is the the shorter one&#39;s runtime proceeds <b>while the longer one is running</b>. So you only have to wait the time the longer one needs, not the longer one <b>plus</b> the shorter one. Again, to be worth doing, you usually expect <b>both</b> of them to take a reasonable amount of time. Say, 6 seconds and 4 seconds. If you run them sequentially, it takes 10 seconds. If you run them in parallel, it only takes 6 (plus the overhead, which isn&#39;t perceptible in human time)."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1475754999, "post_id": 39884893, "comment_id": 67076272, "body": "Concrete numbers: if you have two jobs that 30 and 40 minutes, the parallel version takes 40 minutes plus overhead. The sequential version takes 70 minutes. Say your first call to <code>rseq</code> is for the 40-minute job. That takes 40 minutes, but the <i>next</i> call returns immediately, because that job has been done for 10 minutes. If the calls to <code>rseq</code> are reversed, the first one take 30 minutes, and the second one takes an additional 10 minutes (since that is all that&#39;s left of the 40-minute job). Either way, the combined running time for both calls to <code>rseq</code> is 40 minutes."}], "tags": [], "owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "is_accepted": false, "score": 6, "last_activity_date": 1475707975, "creation_date": 1475707975, "answer_id": 39884893, "question_id": 39884451, "link": "https://stackoverflow.com/questions/39884451/eval-rpar-and-rseq-any-benefit/39884893#39884893", "title": "Eval, rpar and rseq -- any benefit?", "body": "<p>It depends entirely on what <code>f</code> does. If <code>f</code> takes a long time for your system to compute, and your system has a spare CPU core, then the parallel version will finish faster.</p>\n\n<p>If <code>f</code> is something tiny like <code>f n = n + 1</code> then <em>of course</em> the standard single-threaded version will be faster. The overhead of creating a Haskell thread is fairly low, but it's not <strong>that</strong> low. (And if you've only got a single execution context then there's no point anyway, of course).</p>\n\n<p>Note that the first version <em>always</em> has more \"overhead\", if we define overhead as \"work the system does that's not directly related to computing your result\". But if you get to evaluate<code>f x</code> and <code>f y</code> in parallel, you might finish faster even though the system has \"wasted\" some of its execution resources on the overhead. We might approximate the parallel version's run time as:</p>\n\n<pre><code>maximum(time for f x, time for f y)  +  overhead\n</code></pre>\n\n<p>And the standard version's run time as:</p>\n\n<pre><code>time for f x  +  time for f y\n</code></pre>\n\n<p>So the parallel version is only worth it if the <em>smaller</em> of the two <code>f</code> calls takes conclusively more time than the parallelisation overhead.</p>\n\n<p>Of course in reality it could be much more complicated. One such issue: if <code>f x</code> and <code>f y</code> share references to the same thunks, then the standard sequential version fully shares the work, while the parallel version might accidentally waste time having both threads execute the thunks. In particular if most of the work of <code>f x</code> and <code>f y</code> is <em>actually</em> reducing thunks to get <code>f</code> ready to apply, then you're not \"really\" parallelising this work at all (instead more-or-less racing two threads to see which finishes first).</p>\n\n<p>Ultimately you need to use measurements and judgement to decide where to apply parallelism. It's not something you can add blindly and automatically get a benefit (otherwise the compiler would do it for you).</p>\n\n<p>But it certainly <strong>won't</strong> give you any benefit if you try to run two really trivial computations in parallel. If you're just playing around with parallelism to get a feel for how it works, try to write a function <code>f</code> that does enough work such that your second version takes at least a couple of seconds to run, and then see if the parallel version is faster.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6902625"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1475735744, "creation_date": 1475705179, "last_edit_date": 1475735744, "question_id": 39884451, "link": "https://stackoverflow.com/questions/39884451/eval-rpar-and-rseq-any-benefit", "title": "Eval, rpar and rseq -- any benefit?", "body": "<p>I'm learning parallelism in Haskell. I've seen this code:</p>\n\n<pre><code>runEval $ do\n  a &lt;- rpar (f x)\n  b &lt;- rpar (f y)\n  rseq a\n  rseq b\n  return (a,b)\n</code></pre>\n\n<p>What's the difference between it and this in terms of performance and overhead?</p>\n\n<pre><code>let a = f x\nlet b = f y\n(a, b)\n</code></pre>\n\n<p>that is, without using <code>Eval</code> at all. For me, the 2nd one has the same performance and less overhead.</p>\n"}, {"tags": ["function", "haskell", "recursion"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1475687544, "post_id": 39879734, "comment_id": 67046701, "body": "The actual error is due to <code>delta</code> being defined as a function with arity 0 and arity 2 in the 2nd equation for <code>deltaTest</code>. It&#39;s not clear what the actual definition should be. Another (unreported) error is the attempt to use the value of <code>epsilon</code> as part of the pattern match."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1475689478, "post_id": 39879734, "comment_id": 67047773, "body": "@chepner The use of <code>epsilon</code> shouldn&#39;t throw an error; it&#39;s just name shadowing. That might be unintended, but it&#39;s  not a compile error."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 1, "creation_date": 1475690279, "post_id": 39879734, "comment_id": 67048185, "body": "A quick <a href=\"http://stackoverflow.com/search?q=%5Bhaskell%5D+conflicting+definition\">search of StackOverflow</a> turned up someone else who had the <a href=\"http://stackoverflow.com/questions/18563575/haskell-multiple-declarations-of-function-name/18563628\">same problem</a>."}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1475690687, "post_id": 39879734, "comment_id": 67048421, "body": "@crockeea I&#39;ll pretend that&#39;s what I meant by unreported :)"}, {"owner": {"reputation": 131, "user_id": 1653940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c075e33ec3d5504bd46e939d261bf21?s=128&d=identicon&r=PG", "display_name": "lombardo2", "link": "https://stackoverflow.com/users/1653940/lombardo2"}, "reply_to_user": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1475692857, "post_id": 39879734, "comment_id": 67049646, "body": "@crockeea Apologies, I tried many keywords in my search but couldn&#39;t find an answer since I did not know the correct terminology."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "edited": false, "score": 0, "creation_date": 1475693684, "post_id": 39879734, "comment_id": 67050138, "body": "@lombardo2 All I did was search for the keywords in the error that GHC reported; no extra knowledge required!"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 1653940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c075e33ec3d5504bd46e939d261bf21?s=128&d=identicon&r=PG", "display_name": "lombardo2", "link": "https://stackoverflow.com/users/1653940/lombardo2"}, "edited": false, "score": 0, "creation_date": 1475693435, "post_id": 39880651, "comment_id": 67050005, "body": "Thanks, this made it click. Made it work doing <code>delta x y = deltaTest re (start + 1) x y</code> after the particular case"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 131, "user_id": 1653940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c075e33ec3d5504bd46e939d261bf21?s=128&d=identicon&r=PG", "display_name": "lombardo2", "link": "https://stackoverflow.com/users/1653940/lombardo2"}, "edited": false, "score": 1, "creation_date": 1475693605, "post_id": 39880651, "comment_id": 67050098, "body": "@lombardo2 Fine, that fixes the arity issue, but the first definition is now completely generic, and the second definition will still never be called! (You should be getting a warning about <code>Pattern match is redundant</code> when you compile.) This will not do what you intend it to."}, {"owner": {"reputation": 131, "user_id": 1653940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c075e33ec3d5504bd46e939d261bf21?s=128&d=identicon&r=PG", "display_name": "lombardo2", "link": "https://stackoverflow.com/users/1653940/lombardo2"}, "edited": false, "score": 0, "creation_date": 1475694073, "post_id": 39880651, "comment_id": 67050380, "body": "Yeah, just noticed. I tough <code>start</code> was the same <code>start</code> before where, a constant, but guess it&#39;s not. It&#39;s hard to grasp functional programming after thinking so much in imperative"}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1475694923, "post_id": 39880651, "comment_id": 67050820, "body": "It hasn&#39;t to do with imperative in this case. You just need to get used to the scoping rules. An identifier occuring in a pattern is always a &quot;new&quot; one and will shadow any others with the same name in its scope. Now, the next thing to learn is to get a feeling where patterns occur. :)"}, {"owner": {"reputation": 131, "user_id": 1653940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c075e33ec3d5504bd46e939d261bf21?s=128&d=identicon&r=PG", "display_name": "lombardo2", "link": "https://stackoverflow.com/users/1653940/lombardo2"}, "reply_to_user": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1475695205, "post_id": 39880651, "comment_id": 67051004, "body": "@Ingo Is there a way to use the outer one? A quick search in learnyouahaskell did not provided me one."}, {"owner": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 2, "creation_date": 1475695325, "post_id": 39880651, "comment_id": 67051078, "body": "You could use guards, i.e. <code>delta x y | x == start, y == epsilon = .....</code>"}, {"owner": {"reputation": 131, "user_id": 1653940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c075e33ec3d5504bd46e939d261bf21?s=128&d=identicon&r=PG", "display_name": "lombardo2", "link": "https://stackoverflow.com/users/1653940/lombardo2"}, "reply_to_user": {"reputation": 34889, "user_id": 86604, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/329af917389e6cf8e146c03012f5319a?s=128&d=identicon&r=PG", "display_name": "Ingo", "link": "https://stackoverflow.com/users/86604/ingo"}, "edited": false, "score": 0, "creation_date": 1475698530, "post_id": 39880651, "comment_id": 67052819, "body": "@Ingo Thanks, that&#39;s what I did."}], "tags": [], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "is_accepted": true, "score": 7, "last_activity_date": 1475691991, "last_edit_date": 1475691991, "creation_date": 1475689868, "answer_id": 39880651, "question_id": 39879734, "link": "https://stackoverflow.com/questions/39879734/expand-a-function-in-haskell/39880651#39880651", "title": "Expand a function in Haskell", "body": "<p>All definitions of a function must have the same <em>arity</em>, i.e., the same number of function arguments. You define <code>delta</code> in three lines:</p>\n\n<ol>\n<li>The first line is a type signature.</li>\n<li>The second line is a <em>definition</em> of <code>delta</code> with arity zero (no arguments to the left of the <code>=</code>)</li>\n<li>The third line is another <em>definition</em> of <code>delta</code> with arity two (two arguments to the left of the <code>=</code>)</li>\n</ol>\n\n<p>The two definitions have a different arity, so the compiler tells you there are conflicting definitions.</p>\n\n<p>Ask yourself: What is the inteded behavior of <code>delta</code>? The compiler will look at the definitions of <code>delta</code> in the order they are defined, and choose the first one where a pattern match succeeds. Since there are no arguments in the first definition (and hence no patterns to match), it will always succeed and the second definition will never be called.</p>\n"}], "owner": {"reputation": 131, "user_id": 1653940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c075e33ec3d5504bd46e939d261bf21?s=128&d=identicon&r=PG", "display_name": "lombardo2", "link": "https://stackoverflow.com/users/1653940/lombardo2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "accepted_answer_id": 39880651, "answer_count": 1, "score": 1, "last_activity_date": 1475691991, "creation_date": 1475686473, "last_edit_date": 1475689604, "question_id": 39879734, "link": "https://stackoverflow.com/questions/39879734/expand-a-function-in-haskell", "title": "Expand a function in Haskell", "body": "<p>In my homework, we are given a regular expression. I have to return an e-NFA. I'm trying to build the <code>delta</code> function. So far I have:</p>\n\n<pre><code>module ConsENFA where\n\nimport Data.Set (Set, fromList, singleton, empty)\nimport RegEx\nimport ENFA\n\nepsilon :: RegExp Char\nepsilon = Symbol 'e'\n\ndeltaTest :: RegExp Char -&gt; Int -&gt; (Int -&gt; Char -&gt; Set Int)\ndeltaTest (Symbol sym) start = delta\n    where\n        delta :: Int -&gt; Char -&gt; Set Int\n        delta start sym = singleton (start + 1)\n\ndeltaTest (Star re) start = delta\n    where\n        delta :: Int -&gt; Char -&gt; Set Int\n        delta = deltaTest re (start + 1)\n        delta start epsilon = fromList[1, 3]\n</code></pre>\n\n<p>I got the error</p>\n\n<pre><code>ConsENFA.hs:19:9: error:\nConflicting definitions for `delta'\nBound at: ConsENFA.hs:19:9-13\n          ConsENFA.hs:20:9-13\n</code></pre>\n\n<p>which I assume means that I can't expand the pattern matching like that, I can't add more states.</p>\n\n<p>I first define <code>delta</code> for a single label and then I add more definitions to the previously defined <code>delta</code>, but it's not working. What's the correct way to do it?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1475684994, "post_id": 39878977, "comment_id": 67045229, "body": "You have to do: <code>if prim then do xs &lt;- rbMersenneGens (x+1) k; return m : xs</code> to match the types."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1475685336, "post_id": 39878977, "comment_id": 67045454, "body": "The problem is that Rabin-Miller uses random numbers. Haskell has a problem with random numbers because they are intrinsically impure. If it is your implementation of Rabin-Miller then you need to rewrite it to take the random seed as an argument. Or else use a different primality test."}], "answers": [{"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1475685394, "post_id": 39879340, "comment_id": 67045502, "body": "Yep. I think OP may be falling into <a href=\"http://stackoverflow.com/documentation/haskell/1904/io/7236/getting-the-a-out-of-io-a#t=201610051636053171053\">this common trap</a>"}, {"owner": {"reputation": 113, "user_id": 5817341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793dbb99afa5c20fe196ca03d99e3932?s=128&d=identicon&r=PG&f=1", "display_name": "Mal", "link": "https://stackoverflow.com/users/5817341/mal"}, "edited": false, "score": 0, "creation_date": 1475685608, "post_id": 39879340, "comment_id": 67045637, "body": "But if i let it return <code>[IO Integer]</code> and <code>rbMersenneGen</code> <code>IO [IO Integer]</code> the same error occurs (and two more)"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1475685806, "post_id": 39879340, "comment_id": 67045758, "body": "The declared return value means the <code>do</code> expression is operating in the list monad, and <code>prim</code> needs to be a <code>Bool</code> since it is used with the <code>if</code> expression. This means <code>rabinMiller</code> would need to return a <code>[Bool]</code> value, but it returns an <code>IO Bool</code>."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 113, "user_id": 5817341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793dbb99afa5c20fe196ca03d99e3932?s=128&d=identicon&r=PG&f=1", "display_name": "Mal", "link": "https://stackoverflow.com/users/5817341/mal"}, "edited": false, "score": 0, "creation_date": 1475686044, "post_id": 39879340, "comment_id": 67045875, "body": "@Mal The return type of <code>rbMersenneGens</code> should be <code>IO [Integer]</code>, I think."}, {"owner": {"reputation": 113, "user_id": 5817341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793dbb99afa5c20fe196ca03d99e3932?s=128&d=identicon&r=PG&f=1", "display_name": "Mal", "link": "https://stackoverflow.com/users/5817341/mal"}, "edited": false, "score": 0, "creation_date": 1475686527, "post_id": 39879340, "comment_id": 67046152, "body": "So I changed the type of <code>rbMersenneGen</code> to <code>IO (IO [Integer])</code> and the type of <code>rbMersenneGens</code> to <code>IO [Integer]</code>, but my compiler is not really a fan of the expression <code>m:rbMergenneGens (x+1) k</code>, since it wants <code>m</code> to be an <code>[Integer]</code> instead of <code>Integer</code> (and then two errors that it expects <code>IO [Integer]</code> but it is actually <code>[[Integer]]</code> and then the other way around..)"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 113, "user_id": 5817341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793dbb99afa5c20fe196ca03d99e3932?s=128&d=identicon&r=PG&f=1", "display_name": "Mal", "link": "https://stackoverflow.com/users/5817341/mal"}, "edited": false, "score": 2, "creation_date": 1475693709, "post_id": 39879340, "comment_id": 67050151, "body": "@Mal You cannot just throw types at the compiler until it shuts up. You need to understand what the <code>IO Bool</code> result type of <code>rabinMiller</code> (and <code>IO</code> in general) means."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1475735217, "post_id": 39879340, "comment_id": 67064051, "body": "@SebastianRedl, throwing types at the compiler until it shuts up is the best approach I&#39;ve found thus far for working with non-regular data types using polymorphic recursion. Of course, that probably just means my brain isn&#39;t strong enough."}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": false, "score": 0, "last_activity_date": 1475685047, "creation_date": 1475685047, "answer_id": 39879340, "question_id": 39878977, "link": "https://stackoverflow.com/questions/39878977/create-infinite-list-in-haskell-with-io/39879340#39879340", "title": "Create infinite list in Haskell with IO", "body": "<p>You have a do block in <code>rbMersenneGens</code>. The result of a do block is always in the same monad as the things inside. Since you call <code>rabinMiller</code> inside, which is in the <code>IO</code> monad, the result of the do block is in the <code>IO</code> monad as well. Yet you have declared that <code>rbMersenneGens</code> returns a <code>[Integer]</code>, which doesn't match the deduced type.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475691722, "post_id": 39880684, "comment_id": 67048990, "body": "Won&#39;t that loop forever (IO being a strict applicative)?"}, {"owner": {"reputation": 113, "user_id": 5817341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793dbb99afa5c20fe196ca03d99e3932?s=128&d=identicon&r=PG&f=1", "display_name": "Mal", "link": "https://stackoverflow.com/users/5817341/mal"}, "edited": false, "score": 0, "creation_date": 1475691760, "post_id": 39880684, "comment_id": 67049012, "body": "Thank you so much! This worked! Only <code>(m:)</code> and <code>id</code> need to be switched (in the last row), since <code>bool</code> behaves weird. And if I run <code>rbMersenneGen k</code> it never returns something... But I can solve this by making <code>rbMersenneGens n _ = return []</code> for some n"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1475691915, "post_id": 39880684, "comment_id": 67049111, "body": "Sorry, I didn&#39;t read the description of <code>bool</code> closely enough."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 1, "last_activity_date": 1475691938, "last_edit_date": 1475691938, "creation_date": 1475689996, "answer_id": 39880684, "question_id": 39878977, "link": "https://stackoverflow.com/questions/39878977/create-infinite-list-in-haskell-with-io/39880684#39880684", "title": "Create infinite list in Haskell with IO", "body": "<p>Your original types are fine; we just need to adjust the definition of <code>rbMersenneGens</code> a little. I'm going to refactor the function a little as well.</p>\n\n<pre><code>rbMersenneGen :: Integer -&gt; IO [Integer]\nrbMersenneGen k = rbMersenneGens 0 k\n\nrbMersenneGens :: Int -&gt; Integer -&gt; IO [Integer]\nrbMersenneGens x k = \n  let n = primes!!x\n      m = (2^n) - 1\n  in do\n       prim &lt;- rabinMiller k m\n       -- We call rmMersenneGens the same way in either case;\n       -- the only difference is which function we apply to the result\n       (if prim then (m:) else id) (rbMersenneGens (x+1) k)\n</code></pre>\n\n<p>Your problem is that <code>prim</code> needs to be a <code>Bool</code> for the <code>if-else</code> expression, and the <code>do</code> expression needs to evaluate to an <code>IO [Integer]</code> value. This means <code>rabinMiller</code> would need to return an <code>[Bool]</code> value instead of the <code>IO Bool</code> that it does. The fix is to replace the <code>if</code> else with <code>Data.Bool.bool :: a -&gt; a -&gt; Bool -&gt; a</code>.</p>\n\n<p>This doesn't type check...</p>\n\n<pre><code>rbMersenneGens :: Int -&gt; Integer -&gt; IO [Integer]\nrbMersenneGens x k = \n  let n = primes!!x\n      m = (2^n) - 1\n      prim = rabinMiller k m -- IO Bool\n  in (bool id (m:) prim) (rbMersenneGens (x+1) k)\n</code></pre>\n\n<p>because we are still trying to treat <code>prim</code> as a <code>Bool</code> rather than an <code>IO Bool</code>, but this does:</p>\n\n<pre><code>rbMersenneGens :: Int -&gt; Integer -&gt; IO [Integer]\nrbMersenneGens x k = \n  let n = primes!!x\n      m = (2^n) - 1\n      prim = rabinMiller k m\n  in (bool id (m:)) &lt;$&gt; prim &lt;*&gt; (rbMersenneGens (x+1) k)\n</code></pre>\n\n<p>We can't make <code>if</code> work with an <code>IO Bool</code>, but we <em>can</em> lift <code>bool</code> to work with one. In fact, we only need to treat <code>IO</code> as an <code>Applicative</code>, not a <code>Monad</code>. We are replacing <code>&gt;&gt;=</code> with <code>fmap</code> (in its infix form <code>&lt;$&gt;</code>).</p>\n"}], "owner": {"reputation": 113, "user_id": 5817341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/793dbb99afa5c20fe196ca03d99e3932?s=128&d=identicon&r=PG&f=1", "display_name": "Mal", "link": "https://stackoverflow.com/users/5817341/mal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "accepted_answer_id": 39880684, "answer_count": 2, "score": 1, "last_activity_date": 1475691938, "creation_date": 1475683799, "last_edit_date": 1475686914, "question_id": 39878977, "link": "https://stackoverflow.com/questions/39878977/create-infinite-list-in-haskell-with-io", "title": "Create infinite list in Haskell with IO", "body": "<p>EDITED!</p>\n\n<p>I am trying to write an algorithm that generates an (infinite) list of Mersenne prime numbers. I have an algorithm (Rabin-Miller) that returns an IO Bool, according to whether the algorithm thinks the number is prime or not. This algoritm is called rabinMiller, and it takes two arguments, the first an Integer that says something about the security of the list, and second the number that we're submitting to the primality test.</p>\n\n<p>I want to index over the list of all primes (called primes), and for each p in primes, check whether rabinMiller thinks 2^p - 1 is prime. If it is, we submit 2^p - 1 to the list.</p>\n\n<p>What I have now is this:</p>\n\n<pre><code>rbMersenneGen :: Integer -&gt; IO(IO [Integer])\nrbMersenneGen k = do return $ rbMersenneGens 0 k\n\nrbMersenneGens :: Int -&gt; Integer -&gt; IO [Integer]\nrbMersenneGens x k = \n  let n = primes!!x\n      m = (2^n) - 1\n  in do\n   prim &lt;- rabinMiller k m\n    if prim then \n        m:rbMersenneGens (x + 1) k \n    else \n        rbMersenneGens (x + 1) k\n</code></pre>\n\n<p>But this is not really working, since I cannot get the type of <code>m:rbMersenneGens (x + 1) k</code> right. I get the error that <code>m</code> is an <code>Integer</code> instead of an <code>[Integer]</code>, and then the type of the entire <code>m:rbMersenneGens (x + 1) k</code> is wrong and creates other errors</p>\n"}, {"tags": ["haskell", "typeclass", "gadt"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1475681554, "post_id": 39878075, "comment_id": 67042984, "body": "Why do you have all those constraints on the constructors in the first place?"}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "reply_to_user": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1475681866, "post_id": 39878075, "comment_id": 67043177, "body": "I want to be able to get LaTeX representations with Show. Where should I have the constraints? Indeed now that I think of it the particular ones are not useful but I can&#39;t think of a way to do away with the existentials completely."}], "answers": [{"comments": [{"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1475682074, "post_id": 39878315, "comment_id": 67043299, "body": "Well the way I am thinking of it is that the expressions you present above is obviously not equal because the left side of <code>:&lt;:</code> is not the same, even though their evaluated value may be equal."}, {"owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 0, "creation_date": 1475682154, "post_id": 39878315, "comment_id": 67043358, "body": "It just dawned on me what you are suggesting. You are right."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "edited": false, "score": 1, "creation_date": 1475682260, "post_id": 39878315, "comment_id": 67043435, "body": "The way I am thinking is that this kind of <code>Eq</code> instance is in principle not a good idea, because there are all kinds of \u201cobvious\u201d properties of such expressions which don&#39;t actually hold."}], "tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 8, "last_activity_date": 1475681891, "creation_date": 1475681891, "answer_id": 39878315, "question_id": 39878075, "link": "https://stackoverflow.com/questions/39878075/deriving-a-trivial-eq-class-from-a-gadt/39878315#39878315", "title": "Deriving a trivial Eq class from a GADT", "body": "<p>Traditional <code>deriving</code> can't handle GADT constraints. Standalone deriving can, in principle:</p>\n\n<pre><code>{-# LANGUAGE GADTs, StandaloneDeriving #-}\ndata Expr a where\n  (:+:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr a\n  ...\nderiving instance Eq (Expr a)\n</code></pre>\n\n<p>However, that doesn't help you because that <code>Eq</code> instance is just not possible. How will you compare</p>\n\n<pre><code>(1 :&lt;: (2 :: Expr Int)) == (pi :&lt;: (sqrt 2 :: Expr Double))\n</code></pre>\n\n<p>It's just not possible; the GADT constraint</p>\n\n<pre><code>  (:&lt;:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr Bool\n</code></pre>\n\n<p>only enforces that both values <em>compared in that <code>Expr</code></em> have the same type and are <code>Eq</code>, but it doesn't tell you anything about the types of <em>different</em> expressions.</p>\n"}], "owner": {"reputation": 5328, "user_id": 325809, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/b858606c4daae58cfdb362bf2fc4caa5?s=128&d=identicon&r=PG", "display_name": "fakedrake", "link": "https://stackoverflow.com/users/325809/fakedrake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "accepted_answer_id": 39878315, "answer_count": 1, "score": 2, "last_activity_date": 1475681891, "creation_date": 1475681203, "question_id": 39878075, "link": "https://stackoverflow.com/questions/39878075/deriving-a-trivial-eq-class-from-a-gadt", "title": "Deriving a trivial Eq class from a GADT", "body": "<p>I thought GADTs were great until I tried putting any of the \"expressions with GADTs\" examples scattered around the internet to use.</p>\n\n<p>Traditional ADTs kindly provide definitional equality in the guise of Eq for free. In GADTs for this code:</p>\n\n<pre><code>data Expr a where\n  (:+:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr a\n  (:-:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr a\n  (:*:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr a\n  (:/:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr a\n  (:=:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr Bool\n  (:&lt;:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr Bool\n  (:&gt;:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr Bool\n  (:&gt;=:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr Bool\n  (:&lt;=:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr Bool\n  (:&lt;&gt;:) :: (Show a, Eq a) =&gt; Expr a -&gt; Expr a -&gt; Expr Bool\n  EOr :: Expr Bool -&gt; Expr Bool -&gt; Expr Bool\n  EAnd :: Expr Bool -&gt; Expr Bool -&gt; Expr Bool\n  ENot :: Expr Bool -&gt; Expr Bool\n  ESymbol :: (Show a, Eq a) =&gt; String -&gt; Expr a\n  ELiteral :: (Show a, Eq a) =&gt; a -&gt; Expr a\n  EFunction :: (Show a, Eq a) =&gt; String -&gt; [Expr a] -&gt; Expr a\n  deriving (Eq)\n</code></pre>\n\n<p>I get (very understandably):</p>\n\n<pre><code>    \u2022 Can't make a derived instance of \u2018Eq (Expr a)\u2019:\n        Constructor \u2018:+:\u2019 has existentials or constraints in its type\n        Constructor \u2018:-:\u2019 has existentials or constraints in its type\n        Constructor \u2018:*:\u2019 has existentials or constraints in its type\n        Constructor \u2018:/:\u2019 has existentials or constraints in its type\n        Constructor \u2018:=:\u2019 has existentials or constraints in its type\n        Constructor \u2018:&lt;:\u2019 has existentials or constraints in its type\n        Constructor \u2018:&gt;:\u2019 has existentials or constraints in its type\n        Constructor \u2018:&gt;=:\u2019 has existentials or constraints in its type\n        Constructor \u2018:&lt;=:\u2019 has existentials or constraints in its type\n        Constructor \u2018:&lt;&gt;:\u2019 has existentials or constraints in its type\n        Constructor \u2018EOr\u2019 has existentials or constraints in its type\n        Constructor \u2018EAnd\u2019 has existentials or constraints in its type\n        Constructor \u2018ENot\u2019 has existentials or constraints in its type\n        Constructor \u2018ESymbol\u2019 has existentials or constraints in its type\n        Constructor \u2018ELiteral\u2019 has existentials or constraints in its type\n        Constructor \u2018EFunction\u2019 has existentials or constraints in its type\n        Possible fix: use a standalone deriving declaration instead\n    \u2022 In the data declaration for \u2018Expr\u2019\n</code></pre>\n\n<p>Which would be understandable if I hadn't the <code>Eq</code> restriction for each constructor but now I have to write trivial equality rules for all these constructors.</p>\n\n<p>I feel like there is better way to go about this than I have </p>\n"}, {"tags": ["haskell", "applicative"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 2, "creation_date": 1475677829, "post_id": 39876673, "comment_id": 67040142, "body": "It seems like this question gets asked at least once a week. try <a href=\"http://hayoo.fh-wedel.de/?query=%3C%3E\" rel=\"nofollow noreferrer\">hayoo.fh-wedel.de/?query=%3C%3E</a>"}, {"owner": {"reputation": 2861, "user_id": 2847643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PmATO.jpg?s=128&g=1", "display_name": "user2847643", "link": "https://stackoverflow.com/users/2847643/user2847643"}, "edited": false, "score": 2, "creation_date": 1475678529, "post_id": 39876673, "comment_id": 67040701, "body": "It&#39;s an infix synonym for <a href=\"https://www.haskell.org/hoogle/?hoogle=mappend\" rel=\"nofollow noreferrer\"><code>mappend</code></a>"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1475678932, "post_id": 39876673, "comment_id": 67041066, "body": "If you have a compiling source file, you can load it in GHCi and then use <code>:i (&lt;&gt;)</code> to discover where that function is coming from."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475682259, "post_id": 39876673, "comment_id": 67043433, "body": "Try <a href=\"http://hoogle.haskell.org/?hoogle=(%3C%3E)\" rel=\"nofollow noreferrer\">the other Hoogle</a>."}, {"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1475703898, "post_id": 39876673, "comment_id": 67055303, "body": "It might be worth pointing out that there is no special (semantic) significance to the name <code>&lt;&gt;</code> itself, it&#39;s just the name for an operator defined in the standard library. In Haskell, you can give operators pretty arbitrary names. If you wanted to, for some reason, you could make an operator called <code>!$%^&lt;</code>."}, {"owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475748225, "post_id": 39876673, "comment_id": 67072003, "body": "Thanks you all for replies, especially @chi and @Daniel!"}], "owner": {"reputation": 29, "user_id": 6788235, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2X2H.png?s=128&g=1", "display_name": "E. Nerush", "link": "https://stackoverflow.com/users/6788235/e-nerush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "closed_date": 1475686258, "answer_count": 0, "score": 0, "last_activity_date": 1475677590, "creation_date": 1475677590, "question_id": 39876673, "link": "https://stackoverflow.com/questions/39876673/meaning-of-void-angle-brackets-in-haskell", "closed_reason": "Duplicate", "title": "Meaning of void angle brackets in Haskell", "body": "<p>The example from <a href=\"https://hackage.haskell.org/package/optparse-applicative\" rel=\"nofollow\"><em>optparse-applicative</em> package</a> uses void angle brackets (<code>&lt;&gt;</code>):</p>\n\n<pre><code>sample :: Parser Sample\nsample = Sample\n  &lt;$&gt; strOption\n      ( long \"hello\"\n     &lt;&gt; metavar \"TARGET\"\n     &lt;&gt; help \"Target for the greeting\" )\n  &lt;*&gt; switch\n      ( long \"quiet\"\n     &lt;&gt; help \"Whether to be quiet\" )\n</code></pre>\n\n<p>I know what <code>&lt;*&gt;</code> and <code>&lt;$&gt;</code> relate to applicative functors, but what does triangle brackets <code>&lt;&gt;</code> mean and were are they defined? (Hoogle doesn't help).</p>\n"}, {"tags": ["haskell", "discrete-mathematics", "induction"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1475703162, "post_id": 39873954, "comment_id": 67054983, "body": "If you&#39;re hoping somebody is going to just do your homework for you, I hope to heck your hopes are dashed. See also <a href=\"http://meta.stackoverflow.com/questions/334822/how-do-i-ask-and-answer-homework-questions\">How do I ask and answer homework questions?</a> for advice on turning this copy-and-paste job into a question that could be productive both for you and for the site. In the meantime, I am following the advice on that page in voting to close this question as &quot;too broad&quot;."}, {"owner": {"reputation": 13, "user_id": 6926274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab107bc55d784a22d3714e3b23febf9?s=128&d=identicon&r=PG&f=1", "display_name": "Huskey", "link": "https://stackoverflow.com/users/6926274/huskey"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475743190, "post_id": 39873954, "comment_id": 67068556, "body": "Not homework though. This is an old exam question from a university I wish to attend next year. So dont jump to conclusions please."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475766414, "post_id": 39873954, "comment_id": 67084692, "body": "In fact, &quot;homework&quot; vs. &quot;not homework&quot; doesn&#39;t matter. What matters is that you have evidently made no effort to solve the problem yourself, and no effort to identify and communicate to us exactly what it is you need to know to make progress."}], "answers": [{"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 2, "last_activity_date": 1475671149, "creation_date": 1475671149, "answer_id": 39874222, "question_id": 39873954, "link": "https://stackoverflow.com/questions/39873954/structural-induction-in-haskell-lists-and-sum/39874222#39874222", "title": "Structural induction in haskell. Lists and sum", "body": "<p><code>++</code> is defined by induction on its first argument, <code>xs</code>, so this is usually a good sign that we need to proceed by induction on <code>xs</code>.</p>\n\n<p>Hence, we fix <code>ys</code> once for all, and define <code>P(xs)</code> as follows</p>\n\n<pre><code>P(xs) = (sum (xs ++ ys) == sum xs + sum ys)\n</code></pre>\n\n<p>Now you have to prove that <code>P(xs)</code> holds for all <code>xs</code>. Apply the induction principle on lists and you should be OK.</p>\n"}], "owner": {"reputation": 13, "user_id": 6926274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab107bc55d784a22d3714e3b23febf9?s=128&d=identicon&r=PG&f=1", "display_name": "Huskey", "link": "https://stackoverflow.com/users/6926274/huskey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1475671149, "creation_date": 1475670435, "last_edit_date": 1475671068, "question_id": 39873954, "link": "https://stackoverflow.com/questions/39873954/structural-induction-in-haskell-lists-and-sum", "title": "Structural induction in haskell. Lists and sum", "body": "<p>Hi I'm quite new to haskell and just got into structural induction and was wondering if someone could explain the steps I should take it would be very helpful.</p>\n\n<p>Question:\n-- computes the sum of all numbers in the list</p>\n\n<pre><code>sum :: [Integer] -&gt; Integer\nsum []     = 0\nsum (x:xs) = x + sum xs  \n</code></pre>\n\n<p>-- appends two lists</p>\n\n<pre><code>(++) :: [Integer] -&gt; [Integer] -&gt; [Integer]\n[]     ++ ys = ys\n(x:xs) ++ ys = x : (xs ++ ys) \n</code></pre>\n\n<p>Prove (by using structural induction) that the following equation holds, for all lists of integers <code>xs</code> and <code>ys</code>:</p>\n\n<pre><code>sum (xs ++ ys) = sum xs + sum ys\n</code></pre>\n\n<p>Don't forget to state the I.H. in the induction step. Please also make sure you clearly state the reasons why you make the steps in your proofs.</p>\n\n<p>My steps:\nTo prove:</p>\n\n<pre><code>sum (xs ++ ys) = sum xs + sum ys\n</code></pre>\n\n<p>Proof: by structural induction</p>\n\n<p>Let P ( ) &lt;--- dont really know what to type in there so if someone could take it from there I would appreciete it greatly!</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1475668511, "post_id": 39870813, "comment_id": 67033111, "body": "Using such a tree might be cumbersome. A simple solution would be to just store a list of children, <code>data Tree a = Leaf | Node a [Tree a]</code> and enforce a limit of 10 children at run time. A more complicated answer would use type-level integers to constrain the second argument of <code>Node</code> to lists of length 10."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475706653, "post_id": 39870813, "comment_id": 67056212, "body": "The following incantation is to be pronounced with tongue tucked firmly in cheek: <code>type Triple t = (t, t, t); data Tree t = Tea | Timber t (Tree t) (Triple (Triple (Tree t)))</code>."}], "answers": [{"tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": false, "score": 2, "last_activity_date": 1475688981, "last_edit_date": 1475688981, "creation_date": 1475688604, "answer_id": 39880309, "question_id": 39870813, "link": "https://stackoverflow.com/questions/39870813/repetition-in-data-constructor/39880309#39880309", "title": "Repetition in data constructor", "body": "<p>It seems like you want a tree whose branching factor is determined on the type level, and can be any natural number. This is fairly straightforward with GADTs:</p>\n\n<pre><code>data Nat = Z | S Nat \n\ndata Vec (n :: Nat) a where \n  Nil :: Vec 'Z a \n  (:&gt;) :: a -&gt; Vec n a -&gt; Vec ('S n) a \ninfixr 5 :&gt; \n\ndata Tree k a = Leaf | Node a (Vec k (Tree k a))\n</code></pre>\n\n<p><code>Vec</code> is the standard way to encode a homogenous length-indexed vector with GADTs (found e.g. <a href=\"https://hackage.haskell.org/package/sized-vector-1.4.3.1\" rel=\"nofollow\">here</a>). A node in a tree is then an element of type <code>a</code> and a vector of length <code>k</code>, where each element of the vector is a subtree.</p>\n\n<p>Binary trees are simply</p>\n\n<pre><code>type BinaryTree = Tree ('S ('S 'Z))\n</code></pre>\n\n<p>and constructing is simply</p>\n\n<pre><code>tree = Node 1 (Node 2 (Leaf :&gt; Leaf :&gt; Nil) :&gt; Leaf :&gt; Nil)\n</code></pre>\n\n<p>the inferred type will be <code>Num a =&gt; Tree ('S ('S 'Z)) a</code>.</p>\n\n<p>But if you really need 10 nodes, writing out ten <code>'S</code> is still too tedious, so you may want to use type literals:</p>\n\n<pre><code>import qualified GHC.TypeLits as TL\n\n...\n\ntype family N (n :: TL.Nat) :: Nat where  \n  N 0 = 'Z \n  N n = 'S (N (n TL.- 1))\n\ntype Tree10 = Tree (N 10)\n</code></pre>\n\n<p>This not only gives you trees with any branching factor you like, but it allows you to write functions which are polymorphic in the branching factor, and even more, GHC give you all the following for free:</p>\n\n<pre><code>-- With StandaloneDeriving, DeriveFunctor, DeriveFoldable, DeriveTraversable\nderiving instance Functor (Vec k) \nderiving instance Foldable (Vec k) \nderiving instance Traversable (Vec k) \n\nderiving instance Functor (Tree k)\nderiving instance Foldable (Tree k) \nderiving instance Traversable (Tree k)  \n</code></pre>\n"}], "owner": {"reputation": 8697, "user_id": 1055165, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d7c25776b0ca1c13212eea512370102d?s=128&d=identicon&r=PG", "display_name": "zoran119", "link": "https://stackoverflow.com/users/1055165/zoran119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1475688981, "creation_date": 1475661185, "question_id": 39870813, "link": "https://stackoverflow.com/questions/39870813/repetition-in-data-constructor", "title": "Repetition in data constructor", "body": "<p>I can define a binary tree data structure:</p>\n\n<pre><code>data Tree a = Leaf | Node a (Tree a) (Tree a)\n</code></pre>\n\n<p>Now I want to create a tree such that each <code>Node</code> has 10 sub-trees. I could so so by writing out 10 <code>(Tree a)</code>s, but is there a more consise way? I'm thinking type families might help here but I'm not sure.</p>\n"}, {"tags": ["haskell", "random"], "answers": [{"tags": [], "owner": {"reputation": 3611, "user_id": 1029158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YmuXk.jpg?s=128&g=1", "display_name": "DiegoNolan", "link": "https://stackoverflow.com/users/1029158/diegonolan"}, "is_accepted": false, "score": 4, "last_activity_date": 1475659004, "creation_date": 1475659004, "answer_id": 39869983, "question_id": 39869722, "link": "https://stackoverflow.com/questions/39869722/what-does-getstdrandom-randomr-return/39869983#39869983", "title": "What does getStdRandom $ randomR return?", "body": "<p>When you write a number literal in Haskell it could be any of the instances of the <code>Num</code> typeclass. This includes things like <code>Float</code>, <code>Double</code>, <code>Int</code>, <code>Integer</code> etc. Therefore the compiler doesn't know which <code>Num</code> you are talking about so you must specify that you meant <code>Int</code>. Char literals on the other hand are always <code>Char</code>s so there is no need to specify the type.</p>\n"}, {"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": false, "score": 2, "last_activity_date": 1475659578, "creation_date": 1475659578, "answer_id": 39870192, "question_id": 39869722, "link": "https://stackoverflow.com/questions/39869722/what-does-getstdrandom-randomr-return/39870192#39870192", "title": "What does getStdRandom $ randomR return?", "body": "<pre><code>Prelude System.Random&gt; getStdRandom $ randomR (1,100) :: IO Int\n88\nPrelude System.Random&gt; getStdRandom $ randomR (1,100) :: IO Double\n10.275865473218671\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 3, "last_activity_date": 1475660443, "last_edit_date": 1475660443, "creation_date": 1475659839, "answer_id": 39870296, "question_id": 39869722, "link": "https://stackoverflow.com/questions/39869722/what-does-getstdrandom-randomr-return/39870296#39870296", "title": "What does getStdRandom $ randomR return?", "body": "<blockquote>\n  <p>Could someone tell me why two similar looking tuples (Char,Char) and (Int,Int) generate different type signature functions ?</p>\n</blockquote>\n\n<p>A tuple like <code>(1, 100)</code> doesn't have the type <code>(Int, Int)</code> because all number literals in Haskell are polymorphic unless a specific type can be inferred from the context. </p>\n\n<blockquote>\n  <p>I don't know why \"print =&lt;&lt; func1\" works but \"print =&lt;&lt; getStdRandom $ randomR ('A','Z')\" does not work if func1 and \"getStdRandom $ randomR ('A','Z')\" are the same thing?</p>\n</blockquote>\n\n<p>It's because of operator precedence.</p>\n\n<pre><code>print =&lt;&lt; getStdRandom $ randomR ('A','Z')\n</code></pre>\n\n<p>is parsed as:</p>\n\n<pre><code>(print =&lt;&lt; getStdRandom) $ (randomR ('A','Z'))\n</code></pre>\n\n<p>What you want is:</p>\n\n<pre><code>print =&lt;&lt; (getStdRandom $ randomR ('A','Z'))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2226, "user_id": 2246434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bTuEI.jpg?s=128&g=1", "display_name": "Julia Path", "link": "https://stackoverflow.com/users/2246434/julia-path"}, "is_accepted": false, "score": 1, "last_activity_date": 1475661599, "creation_date": 1475661599, "answer_id": 39870959, "question_id": 39869722, "link": "https://stackoverflow.com/questions/39869722/what-does-getstdrandom-randomr-return/39870959#39870959", "title": "What does getStdRandom $ randomR return?", "body": "<blockquote>\n  <p>Could someone tell me why two similar looking tuples (Char,Char) and (Int,Int) generate different type signature functions ?</p>\n</blockquote>\n\n<p>In Haskell integral literals actually have type <code>Num t =&gt; t</code>:</p>\n\n<pre><code>Prelude&gt; :t 1\n1 :: Num t =&gt; t\n</code></pre>\n\n<p>The part before the <code>=&gt;</code> is a type constraint. It says that the type <code>t</code> must implement the <code>Num</code> class. And the part after the <code>=&gt;</code> is the type, in this case just <code>t</code>. This means that the literal <code>1</code> can have any type <code>t</code> that implements the <code>Num</code> class.</p>\n\n<p>A type class is a way to express that a type supports a set of functions like in this case every type <code>a</code> that is an instance of (i.e. that implementing) Num must have a function <code>fromInteger :: Integer -&gt; a</code>. Haskell now desugars all your integral literals like <code>1</code> to <code>fromInteger 1</code> where <code>1</code> is of type <code>Integer</code>.</p>\n"}], "owner": {"reputation": 697, "user_id": 5821028, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f02b2f13bdf83954535307af466460a7?s=128&d=identicon&r=PG&f=1", "display_name": "eii0000", "link": "https://stackoverflow.com/users/5821028/eii0000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1475665697, "creation_date": 1475658338, "last_edit_date": 1475665697, "question_id": 39869722, "link": "https://stackoverflow.com/questions/39869722/what-does-getstdrandom-randomr-return", "title": "What does getStdRandom $ randomR return?", "body": "<p>I wrote a short Haskell program and compiled it without issues</p>\n\n<pre><code>import System.Random\nfunc1=getStdRandom $ randomR ('A','Z')\nmain = do\n  print =&lt;&lt; func1\n</code></pre>\n\n<p>But if I changed the tuple to (1,100), I have to add a type signature in order to successfully compile it.</p>\n\n<pre><code>import System.Random\nfunc2 :: IO Int\nfunc2=getStdRandom $ randomR (1,100)\nmain = do\n  print =&lt;&lt; func2\n</code></pre>\n\n<p>The type of the functions are different.</p>\n\n<pre><code>Prelude System.Random&gt; func1 = getStdRandom $ randomR ('A','Z')\nPrelude System.Random&gt; func2 = getStdRandom $ randomR (1,100)\nPrelude System.Random&gt; func3 = getStdRandom $ randomR (1,100) :: IO Int\nPrelude System.Random&gt; :t func1\nfunc1 :: IO Char\nPrelude System.Random&gt; :t func2\nfunc2 :: (Random a, Num a) =&gt; IO a\nPrelude System.Random&gt; :t func3\nfunc3 :: IO Int\nPrelude System.Random&gt; \n</code></pre>\n\n<p>Could someone tell me why two similar looking tuples (Char,Char) and (Int,Int) generate different type signature functions ?</p>\n\n<p>And if I moved the function, it does not compile. </p>\n\n<pre><code>import System.Random\nmain = do\nprint =&lt;&lt; getStdRandom $ randomR ('A','Z')\n</code></pre>\n\n<p>I don't know why \"print =&lt;&lt; func1\" works but \"print =&lt;&lt; getStdRandom $ randomR ('A','Z')\" does not work if func1 and \"getStdRandom $ randomR ('A','Z')\" are the same thing?</p>\n\n<p>Thank you\neii</p>\n"}, {"tags": ["haskell", "floating-point"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1475656537, "post_id": 39868831, "comment_id": 67025197, "body": "Can you show your similar code ?"}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1475656589, "post_id": 39868831, "comment_id": 67025225, "body": "Which version of the binary package do you have? <code>getFloatle</code> and friends is in <a href=\"https://hackage.haskell.org/package/binary-0.8.4.1/docs/Data-Binary-Get.html\" rel=\"nofollow noreferrer\">the latest</a>, but not in the randomly picked <a href=\"https://hackage.haskell.org/package/binary-0.8.1.0/docs/Data-Binary-Get.html\" rel=\"nofollow noreferrer\">0.8.1.0</a>."}, {"owner": {"reputation": 1281, "user_id": 6647585, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/cac5dd1f2f2645dcc1dbf1165fed77c6?s=128&d=identicon&r=PG&f=1", "display_name": "Vlam", "link": "https://stackoverflow.com/users/6647585/vlam"}, "edited": false, "score": 0, "creation_date": 1475657470, "post_id": 39868831, "comment_id": 67025780, "body": "I installed using <a href=\"https://haskell.org/platform/download/8.0.1/haskell-platform-8.0.1-unknown-posix--full-x86_64.tar.gz\" rel=\"nofollow noreferrer\">haskell.org/platform/download/8.0.1/&hellip;</a> which is supposed to be the latest. Cabal is showing 0.8.3.0 for the binary package."}, {"owner": {"reputation": 394, "user_id": 3099227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2fa8baddabb7e43d079d297a5791c11?s=128&d=identicon&r=PG", "display_name": "iuriisusuk", "link": "https://stackoverflow.com/users/3099227/iuriisusuk"}, "edited": false, "score": 0, "creation_date": 1475659025, "post_id": 39868831, "comment_id": 67026806, "body": "can you pls provide the content of DATA.BIN file, or a sample of it."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1475674948, "post_id": 39868831, "comment_id": 67037832, "body": "@Vlam: Well yes, that might be the latest version of the <i>Haskell platform</i>. The Haskell platform consists of a set of &quot;core&quot; packages at versions known to work well with eachother. The platform version you installed probably ships with a version of binary from before <code>getFloatle</code> was introduced."}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "reply_to_user": {"reputation": 394, "user_id": 3099227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2fa8baddabb7e43d079d297a5791c11?s=128&d=identicon&r=PG", "display_name": "iuriisusuk", "link": "https://stackoverflow.com/users/3099227/iuriisusuk"}, "edited": false, "score": 0, "creation_date": 1475674978, "post_id": 39868831, "comment_id": 67037855, "body": "@iuriisusuk: The content of DATA.BIN can&#39;t possibly be relevant to this compilation error."}, {"owner": {"reputation": 394, "user_id": 3099227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2fa8baddabb7e43d079d297a5791c11?s=128&d=identicon&r=PG", "display_name": "iuriisusuk", "link": "https://stackoverflow.com/users/3099227/iuriisusuk"}, "reply_to_user": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "edited": false, "score": 0, "creation_date": 1475676392, "post_id": 39868831, "comment_id": 67039000, "body": "@gspr the first step to find a problem is to reproduce it)"}, {"owner": {"reputation": 10320, "user_id": 453616, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f5c35ad8a6275273c50d1274fd549d84?s=128&d=identicon&r=PG", "display_name": "gspr", "link": "https://stackoverflow.com/users/453616/gspr"}, "reply_to_user": {"reputation": 394, "user_id": 3099227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2fa8baddabb7e43d079d297a5791c11?s=128&d=identicon&r=PG", "display_name": "iuriisusuk", "link": "https://stackoverflow.com/users/3099227/iuriisusuk"}, "edited": false, "score": 0, "creation_date": 1475679413, "post_id": 39868831, "comment_id": 67041502, "body": "@iuriisusuk: OP has a compiler error. To the compiler, DATA.BIN exists only as a string in the program. There is obviously no problem with that string."}], "answers": [{"comments": [{"owner": {"reputation": 1281, "user_id": 6647585, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/cac5dd1f2f2645dcc1dbf1165fed77c6?s=128&d=identicon&r=PG&f=1", "display_name": "Vlam", "link": "https://stackoverflow.com/users/6647585/vlam"}, "edited": false, "score": 0, "creation_date": 1475717770, "post_id": 39869093, "comment_id": 67058893, "body": "I have just installed the 0.8.4.1 version of the binary package using cabal and all seems to be working fine. Will add the build-depends when I create the cabal file for my package after my development and testing are done. Right now compiling with ghc so I don&#39;t think that supports the build-depends functionality."}], "tags": [], "owner": {"reputation": 6694, "user_id": 2555037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c62b3037add2dde3cb8dd935f7ca9fe7?s=128&d=identicon&r=PG", "display_name": "Toxaris", "link": "https://stackoverflow.com/users/2555037/toxaris"}, "is_accepted": true, "score": 4, "last_activity_date": 1475673869, "last_edit_date": 1475673869, "creation_date": 1475656563, "answer_id": 39869093, "question_id": 39868831, "link": "https://stackoverflow.com/questions/39868831/why-is-the-variable-not-in-scope/39869093#39869093", "title": "Why is the variable not in scope?", "body": "<p><code>getFloatle</code> was added in binary-0.8.4.0. I guess you are using binary-0.8.3.0, maybe from Stackage or the Haskell platform.</p>\n\n<p>To use the newest binary version, the first step is to put a lower bound in the cabal file. For example:</p>\n\n<p>...</p>\n\n<pre><code>  build-depends:\n    ...,\n    binary &gt;= 0.8.4.0 &amp;&amp; &lt; 0.9,\n    ...\n...\n</code></pre>\n\n<p>This says that you want at least version 0.8.4.0 (so you can use <code>getFloatle</code>) and at most version 0.8.something (so you're protected against future breaking changes that might be introduced by the 0.9 series). You can also leave out the <code>&amp;&amp; &lt; 0.9</code> if you don't care about the protection against future changes.</p>\n\n<p>If you're compiling your code with cabal with this updated cabal file, <code>cabal</code> should download and install an appropriate version of <code>binary</code> for you.</p>\n"}], "owner": {"reputation": 1281, "user_id": 6647585, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/cac5dd1f2f2645dcc1dbf1165fed77c6?s=128&d=identicon&r=PG&f=1", "display_name": "Vlam", "link": "https://stackoverflow.com/users/6647585/vlam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1702, "favorite_count": 0, "accepted_answer_id": 39869093, "answer_count": 1, "score": 1, "last_activity_date": 1475673869, "creation_date": 1475655701, "question_id": 39868831, "link": "https://stackoverflow.com/questions/39868831/why-is-the-variable-not-in-scope", "title": "Why is the variable not in scope?", "body": "<p>I have similar code working but using getWord8 and getWord32le so why is getFloatle giving me error?</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BS\nimport Data.Word\nimport Data.Bits\nimport Data.Binary.Get\n\nreadfloat :: BS.ByteString -&gt; Int -&gt; Float\nreadfloat contents startpos = runGet getFloatle (BS.drop (fromIntegral startpos) contents)\n\nmain :: IO ()\nmain = do\n    let myfile = \"DATA.BIN\"\n    contents &lt;- BS.readFile myfile\n    let stuff = readfloat contents 1042346125\n    print stuff\n</code></pre>\n\n<p>Getting the following error:</p>\n\n<pre><code>test2.hs:7:38: error:\n    Variable not in scope: getFloatle :: Get Float\n</code></pre>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 2, "creation_date": 1475654448, "post_id": 39868407, "comment_id": 67024106, "body": "Show us the definition of you parser type and of the attempts you&#39;ve made at defining the instance yourself. But either way perhaps you should first read up a bit on functors... really, these aren&#39;t so difficult, and if you can&#39;t even figure out what to do with them then you&#39;ll have a hard time implementing the <code>Applicative</code> instance. <a href=\"http://learnyouahaskell.com/functors-applicative-functors-and-monoids\" rel=\"nofollow noreferrer\">LYAH</a> is always an easy start."}, {"owner": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475654953, "post_id": 39868407, "comment_id": 67024381, "body": "I&#39;ve already read some stuff about functors (like in lyahfgg), and I can understand the use of fmap on easy(?) functors like lists, IO Monad, Maybe Monad. But here, I have to map a function over a function of type <code>String -&gt; Maybe (a, String)</code>, and in that case, I can&#39;t understand the need to do this (expect that it is required to implement Applicative)."}, {"owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "edited": false, "score": 0, "creation_date": 1475655186, "post_id": 39868407, "comment_id": 67024496, "body": "The functor instance of a parser is used to apply some transformation function to the final result of the parser, essentially changing a <code>Parser a</code> into <code>Parser b</code>."}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 0, "creation_date": 1475683291, "post_id": 39875042, "comment_id": 67044110, "body": "I think you mean <code>String -&gt; Maybe (b, String)</code>"}, {"owner": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "edited": false, "score": 0, "creation_date": 1475690865, "post_id": 39875042, "comment_id": 67048523, "body": "Here&#39;s my implementation. But since I don&#39;t know what to expect from the functor, I don&#39;t if it OK : <code>instance Functor Parser where     fmap g (Parser f) = Parser f&#39; where         f&#39; s = case f s of             Nothing -&gt; Nothing             Just (x, ss) -&gt; Just (g x, ss) </code>"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "edited": false, "score": 0, "creation_date": 1475692443, "post_id": 39875042, "comment_id": 67049418, "body": "@MaximeB., yes, that&#39;s exactly right. You can see what to expect from a <code>Functor</code> by reading the documentation for the class on Hackage."}, {"owner": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "edited": false, "score": 0, "creation_date": 1475824117, "post_id": 39875042, "comment_id": 67107301, "body": "@dfeuer, could you give a real example on why would I use fmap function over a Parser ?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "edited": false, "score": 0, "creation_date": 1475846971, "post_id": 39875042, "comment_id": 67120777, "body": "@MaximeB., I think that would be an appropriate question to ask separately."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 2, "last_activity_date": 1475692282, "last_edit_date": 1475692282, "creation_date": 1475673408, "answer_id": 39875042, "question_id": 39868407, "link": "https://stackoverflow.com/questions/39868407/the-need-to-turn-a-parser-into-a-functor/39875042#39875042", "title": "The need to turn a Parser into a Functor", "body": "<p>We need to define</p>\n\n<pre><code>fmap :: (a -&gt; b) -&gt; Parser a -&gt; Parser b\n</code></pre>\n\n<p>As usual, we start by pattern matching:</p>\n\n<pre><code>fmap f (Parser p) = _\n</code></pre>\n\n<p>The result has to be a parser, so let's apply the constructor:</p>\n\n<pre><code>fmap f (Parser p) = Parser _\n</code></pre>\n\n<p>Now we need a function in the hole, <code>String -&gt; Maybe (b, String)</code>. So let's make one:</p>\n\n<pre><code>fmap f (Parser p) = Parser $ \\s -&gt; _\n</code></pre>\n\n<p>I'll let you try to finish this off.</p>\n"}], "owner": {"reputation": 550, "user_id": 2701351, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7603ef1885e05ce9b8562a03f9a0d14a?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime", "link": "https://stackoverflow.com/users/2701351/maxime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 39875042, "answer_count": 1, "score": 1, "last_activity_date": 1475692282, "creation_date": 1475654268, "question_id": 39868407, "link": "https://stackoverflow.com/questions/39868407/the-need-to-turn-a-parser-into-a-functor", "title": "The need to turn a Parser into a Functor", "body": "<p>I'm a beginner in Haskell, and I'm trying to do this <a href=\"http://www.cis.upenn.edu/~cis194/spring13/hw/10-applicative.pdf\" rel=\"nofollow\">exercise</a>.</p>\n\n<p>So I need to implements Functor Parser in order to implement Applicative Parser.</p>\n\n<p>But I'm stuck on how to implement the Functor, even with the \"first function hint\" :(. Actually, I can't figure out what we are trying to achieve by using \"fmap f Parser a\".</p>\n\n<p>Can someone explain it ?</p>\n"}, {"tags": ["haskell", "phantom-types"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1475650262, "post_id": 39867138, "comment_id": 67021743, "body": "Your <code>newtype</code> isn&#39;t syntactically correct. That being said, <code>a1 &lt; a2</code> indicates that a) both are of the same type and b) both are values, not types, as long as we&#39;re talking about <code>(&lt;) :: Ord a =&gt; a -&gt; a -&gt; Bool</code>. What do you actually want to do?"}], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 0, "creation_date": 1475690617, "post_id": 39868567, "comment_id": 67048371, "body": "Actually, this doesn&#39;t answers original question. The initial goal is to compare somehow <code>x :: MyType a</code> with <code>y :: MyType b</code> by types <code>a</code> and <code>b</code> first and only then by values <code>getInt x</code> and <code>getInt y</code>. You just implemented comparison by values of objects of different types. But you comparison is not lexicographical with respect to types."}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 2, "last_activity_date": 1475656553, "last_edit_date": 1475656553, "creation_date": 1475654844, "answer_id": 39868567, "question_id": 39867138, "link": "https://stackoverflow.com/questions/39867138/how-to-compare-instances-of-a-phantom-type-with-respect-to-the-phantom-type-argu/39868567#39868567", "title": "How to compare instances of a phantom type with respect to the phantom type argument?", "body": "<p>Since comparison using the standard <code>Eq</code> and <code>Ord</code> type-classes require that both values being compared have the exact same type (including the phantom type parameter) you need to either define your own comparison operators or use an existential wrapper. For example:</p>\n\n<pre><code>{-# LANGUAGE ExistentialQuantification #-}\n\nnewtype MyType a = MyType { getInt :: Int }\n\ndata SomeType = forall a . SomeType (MyType a)\n\ninstance Eq SomeType where\n  (SomeType (MyType a)) == (SomeType (MyType b)) = a == b\n\ninstance Ord SomeType where\n  compare (SomeType (MyType a)) (SomeType (MyType b)) = compare a b\n\ntest = SomeType a &lt; SomeType b where\n  a :: MyType Char\n  a = MyType 10\n\n  b :: MyType Float\n  b = MyType 15\n</code></pre>\n\n<p>Another option is to use <code>Data.Coerce</code> which allows you to use the standard comparison functions without writing any boilerplate instances. You just need to supply some explicit type signatures:</p>\n\n<pre><code>import Data.Coerce\n\ntest2 :: Bool\ntest2 = coerce ((&lt;) :: Int -&gt; Int -&gt; Bool) a b where\n  a :: MyType Char\n  a = MyType 10\n\n  b :: MyType Float\n  b = MyType 15\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 2466068, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f4f97d30600e1671764f3bd09429f1da?s=128&d=identicon&r=PG", "display_name": "user2466068", "link": "https://stackoverflow.com/users/2466068/user2466068"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 39868567, "answer_count": 1, "score": -2, "last_activity_date": 1475656553, "creation_date": 1475650051, "last_edit_date": 1475650204, "question_id": 39867138, "link": "https://stackoverflow.com/questions/39867138/how-to-compare-instances-of-a-phantom-type-with-respect-to-the-phantom-type-argu", "title": "How to compare instances of a phantom type with respect to the phantom type argument?", "body": "<p>I have a phantom type: </p>\n\n<pre><code>newtype MyType a = {getSth :: SthType} \n</code></pre>\n\n<p>How can I compare <code>MyType a1</code> and <code>MyType a2</code> with respect to the result of <code>a1</code> and <code>a2</code> comparison, i.e. if <code>a1 &lt; a2</code> then <code>MyType a1</code> &lt; <code>MyType a2</code>?</p>\n"}, {"tags": ["haskell", "byte"], "answers": [{"tags": [], "owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "is_accepted": true, "score": 3, "last_activity_date": 1475646415, "last_edit_date": 1475646415, "creation_date": 1475645930, "answer_id": 39866167, "question_id": 39865942, "link": "https://stackoverflow.com/questions/39865942/trying-to-read-a-byte-word8-by-offset-in-haskell-and-getting-various-error/39866167#39866167", "title": "Trying to read a byte (Word8) by offset in Haskell and getting various error", "body": "<h2>Type Errors</h2>\n\n<p>Most of your issues are type errors.  These are the most common type of compiler error message when writing a Haskell program.  Let's look at an example function:</p>\n\n<pre><code>readuint8 :: BS.ByteString -&gt; Int -&gt; Int\n</code></pre>\n\n<p>This function will accept a <code>ByteString</code> and <code>Int</code> then return an <code>Int</code>.</p>\n\n<pre><code>readuint8 contents startpos \n</code></pre>\n\n<p>So contents is the <code>ByteString</code> and <code>startpos</code> is the <code>Int</code>.</p>\n\n<pre><code>       = do\n    return $ \n</code></pre>\n\n<p>For some reason you are using do notation, but the type (<code>Int</code>) is not a monad (which would appear as something like <code>IO Int</code>, <code>[Int]</code> or more generally <code>m Int</code>).  <strong>Issue 1</strong> You should not be using either <code>do</code> or <code>return</code> here and instead just use the expression, for which you have:</p>\n\n<pre><code>runGet getuint8 (drop startpos contents)\n</code></pre>\n\n<p>The <code>drop</code> function defined in the prelude operates over lists, not ByteStrings.  <strong>Issue 2</strong> You probably want <code>BS.drop</code>.  Since bytestring drop requires an <code>Int64</code> parameter, which is distinct from an <code>Int</code>, you should convert via <code>fromIntegral</code>.  Note that dropping bytes implies <code>startpos</code> is zero indexed.</p>\n\n<p>Now the type is... whatever <code>getuint8</code>'s type is.  Notice this function definition is superfluous - it is equal to <code>getuint8 = getWord8</code>.  You didn't explicitly type <code>getuint8</code>, but the type is inferred to be a <code>Get Word8</code>.  <strong>Issue 3</strong> The mixing of <code>Word8</code> and <code>Int</code> types is a problem - <code>readuint8</code> expects an <code>Int</code> and that is different than <code>Word8</code>.  You can convert between integral types using <code>fromIntegral</code> so consider:</p>\n\n<pre><code>fromIntegral (runGet getuint8 (BS.drop (fromIntegral startpos) contents))\n</code></pre>\n\n<h2>Alternative</h2>\n\n<p>Consider just unpacking the bytestring and indexing into that:</p>\n\n<pre><code>main :: IO ()\nmain = do\n    let myfile = \"DATA.BIN\"\n    contents &lt;- BS.readFile myfile\n    let stuff = drop 1 (BS.unpack contents)\n    case stuff of\n        (firstByte:restOfTheBytes)    -&gt; print firstByte\n         [] {- empty list of bytes -} -&gt; putStrLn \"The file was not that long.\"\n</code></pre>\n\n<p>Consider some slight compaction of your original construction:</p>\n\n<pre><code>main :: IO ()\nmain = print . runGet getWord8 . BS.drop 1 =&lt;&lt; BS.readFile \"DATA.BIN\"\n</code></pre>\n\n<p>Which reads from right to left as read the file, drop a byte, get the first Word8 value, print the value.</p>\n"}], "owner": {"reputation": 1281, "user_id": 6647585, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/cac5dd1f2f2645dcc1dbf1165fed77c6?s=128&d=identicon&r=PG&f=1", "display_name": "Vlam", "link": "https://stackoverflow.com/users/6647585/vlam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 39866167, "answer_count": 1, "score": 1, "last_activity_date": 1475646415, "creation_date": 1475644800, "question_id": 39865942, "link": "https://stackoverflow.com/questions/39865942/trying-to-read-a-byte-word8-by-offset-in-haskell-and-getting-various-error", "title": "Trying to read a byte (Word8) by offset in Haskell and getting various error", "body": "<p>I have a file called test2.hs below where I'm trying to read a byte (Word8) by offset in a binary file and use it as Int. Below example is trying to read the 2nd byte in the binary file.</p>\n\n<pre><code>import qualified Data.ByteString.Lazy as BS\nimport Data.Word\nimport Data.Bits\nimport Data.Binary.Get\n\ngetuint8 = do\n    uint8 &lt;- getWord8\n    return uint8\n\nreaduint8 :: BS.ByteString -&gt; Int -&gt; Int\nreaduint8 contents startpos = do\n    return $ runGet getuint8 (drop startpos contents)\n\nmain :: IO ()\nmain = do\n    let myfile = \"DATA.BIN\"\n    contents &lt;- BS.readFile myfile\n    let stuff = readuint8 contents 1\n    print stuff\n</code></pre>\n\n<p>Not too sure why I'm getting the below errors:</p>\n\n<pre><code>test2.hs:12:9: error:\n    \u2022 Couldn't match expected type \u2018Int\u2019 with actual type \u2018m0 Word8\u2019\n    \u2022 In a stmt of a 'do' block:\n        return $ runGet getuint8 (drop startpos contents)\n      In the expression:\n        do { return $ runGet getuint8 (drop startpos contents) }\n      In an equation for \u2018readuint8\u2019:\n          readuint8 contents startpos\n            = do { return $ runGet getuint8 (drop startpos contents) }\n\ntest2.hs:12:35: error:\n    \u2022 Couldn't match expected type \u2018BS.ByteString\u2019\n                  with actual type \u2018[a0]\u2019\n    \u2022 In the second argument of \u2018runGet\u2019, namely\n        \u2018(drop startpos contents)\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018runGet getuint8 (drop startpos contents)\u2019\n      In a stmt of a 'do' block:\n        return $ runGet getuint8 (drop startpos contents)\n\ntest2.hs:12:49: error:\n    \u2022 Couldn't match expected type \u2018[a0]\u2019\n                  with actual type \u2018BS.ByteString\u2019\n    \u2022 In the second argument of \u2018drop\u2019, namely \u2018contents\u2019\n      In the second argument of \u2018runGet\u2019, namely\n        \u2018(drop startpos contents)\u2019\n      In the second argument of \u2018($)\u2019, namely\n        \u2018runGet getuint8 (drop startpos contents)\u2019\n</code></pre>\n"}, {"tags": ["list", "haskell", "parameters"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475667232, "post_id": 39865381, "comment_id": 67032290, "body": "This error appears quite frequently on SO. I wonder if there&#39;s some course/tutorial somewhere that prods beginners in using <code>[x]</code> as a notation for an arbitrary list, instead of a singleton list."}], "answers": [{"tags": [], "owner": {"reputation": 383, "user_id": 4937439, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZmHu9gy1S7c/AAAAAAAAAAI/AAAAAAAADpE/tKoIiG2kniU/photo.jpg?sz=128", "display_name": "Sandeep Tuniki", "link": "https://stackoverflow.com/users/4937439/sandeep-tuniki"}, "is_accepted": true, "score": 3, "last_activity_date": 1475642838, "last_edit_date": 1475642838, "creation_date": 1475641938, "answer_id": 39865484, "question_id": 39865381, "link": "https://stackoverflow.com/questions/39865381/haskell-get-error-when-list-parameter-has-more-than-one-element/39865484#39865484", "title": "Haskell get error when list parameter has more than one element", "body": "<p>Just replace the <code>[x]</code> in the left-hand side of the expression with <code>x</code>, and change the expression <code>x &lt; 0</code> to <code>z &lt; 0</code> (Remember, we are filtering out individual elements, not the container itself). </p>\n\n<p>Here is how I would do it:</p>\n\n<pre><code>negative :: [Int] -&gt; [Int]\nnegative x = [z | z &lt;- x, z &lt; 0]\n</code></pre>\n\n<p><strong>(Optional)</strong> Here is how you could solve the same problem using higher-order functions:</p>\n\n<pre><code>negative :: [Int] -&gt; [Int]\nnegative xs = filter (&lt; 0) xs\n</code></pre>\n\n<p>(If you don't know what higher-order functions are, just ignore the previous example. You'll learn about them as you go along)</p>\n"}], "owner": {"reputation": 51, "user_id": 5343720, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c8cb0e79384730275d9b6f4e70900616?s=128&d=identicon&r=PG&f=1", "display_name": "StarCharm", "link": "https://stackoverflow.com/users/5343720/starcharm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 39865484, "answer_count": 1, "score": 3, "last_activity_date": 1475652331, "creation_date": 1475641170, "last_edit_date": 1475652331, "question_id": 39865381, "link": "https://stackoverflow.com/questions/39865381/haskell-get-error-when-list-parameter-has-more-than-one-element", "title": "Haskell get error when list parameter has more than one element", "body": "<p>I just got into Haskell, and I'm trying to make a function that given a list of numbers will return a list of all the negative numbers in it.\nSo I did this</p>\n\n<pre><code>negative:: [Int] -&gt; [Int]\n\nnegative [x] = [z | z &lt;- [x], x &lt; 0]\n</code></pre>\n\n<p>When I try it with only one element in the list it works as it should</p>\n\n<p>negative [-1] returns [-1]</p>\n\n<p>negative [1] returns []</p>\n\n<p>However when I add more numbers like for example\nnegative [0,-1] I get the following error:</p>\n\n<p>Program error: pattern match failure: negative [Num_fromInt instNum_v30 0,Num_fromInt instNum_v30 -1]</p>\n\n<p>I tried typing the numbers with spaces and without spaces between but the result is the same. I'm guessing there's something wrong with my code, but since I'm still getting used to Haskell I'm having a hard time finding it. Any help will be appreciated.</p>\n"}, {"tags": ["haskell", "build", "haskell-stack"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1475644421, "post_id": 39865246, "comment_id": 67019398, "body": "As far as I know, right now you have to use Cabal&#39;s infrastructure for that. Related ticket: <a href=\"https://github.com/commercialhaskell/stack/issues/503\" rel=\"nofollow noreferrer\">github.com/commercialhaskell/stack/issues/503</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "is_accepted": false, "score": 1, "last_activity_date": 1475691280, "last_edit_date": 1495542790, "creation_date": 1475691280, "answer_id": 39881049, "question_id": 39865246, "link": "https://stackoverflow.com/questions/39865246/when-building-a-haskell-project-using-stack-can-i-specify-a-custom-pre-build-st/39881049#39881049", "title": "When building a Haskell project using Stack, can I specify a custom pre-build step?", "body": "<p>You can do this by using standard Cabal infrastructure (as mentioned by @Sibi) -  you will need <code>Setup.hs</code> file in your main project directory. Seems that a similar question was already asked here: <a href=\"https://stackoverflow.com/questions/38903177/how-to-run-bash-commands-like-npm-install-on-complie/39078496#39078496\">How to run bash commands like &quot;npm install&quot; on complie</a></p>\n"}], "owner": {"reputation": 275, "user_id": 83704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P7DJg.jpg?s=128&g=1", "display_name": "jsk", "link": "https://stackoverflow.com/users/83704/jsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1475691280, "creation_date": 1475640220, "question_id": 39865246, "link": "https://stackoverflow.com/questions/39865246/when-building-a-haskell-project-using-stack-can-i-specify-a-custom-pre-build-st", "title": "When building a Haskell project using Stack, can I specify a custom pre-build step?", "body": "<p>Some Haskell packages require a custom pre-build step before any invocation of GHC. For example, the <a href=\"https://github.com/haskell/unix\" rel=\"nofollow\">unix package</a> requires an invocation of <code>autoreconf -i</code> before its C bindings can be compiled.</p>\n\n<p>Let's say I want to \"stackify\" such a package. Is there any way to specify within <code>stack.yaml</code> that <code>autoreconf -i</code> should be called first, as a pre-build step?</p>\n\n<p>Currently, (assuming I add a basic <code>stack.yaml</code> to <code>unix</code>), I must perform the following steps in order to build:</p>\n\n<pre>\nautoreconf -i\nstack build\n</pre>\n\n<p>Is it possible to reduce this down to just a single step? As in:</p>\n\n<pre>\nstack build\n</pre>\n"}, {"tags": ["function", "haskell", "pattern-matching"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 0, "last_activity_date": 1475636338, "creation_date": 1475636338, "answer_id": 39864737, "question_id": 39864685, "link": "https://stackoverflow.com/questions/39864685/haskell-lacking-of-patterns-in-function/39864737#39864737", "title": "Haskell - Lacking of patterns in function", "body": "<p>You've covered the case where there are 0 elements (<code>[]</code>) and where there is one element (<code>[a]</code>). You're missing all other cases.</p>\n\n<p>To match non-empty lists of any size, you'd use the pattern <code>x:xs</code> which will match any non-empty list, bind its first element to <code>x</code> and the remaining elements to <code>xs</code>.</p>\n\n<p><code>[x]</code> only matches one-element lists and binds their single element to <code>x</code>.</p>\n"}], "owner": {"reputation": 1179, "user_id": 6358607, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fc4656a64508378979d66b7693e19c9c?s=128&d=identicon&r=PG", "display_name": "Tri Nguyen", "link": "https://stackoverflow.com/users/6358607/tri-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 39864737, "answer_count": 1, "score": 0, "last_activity_date": 1475652377, "creation_date": 1475635839, "last_edit_date": 1475652377, "question_id": 39864685, "link": "https://stackoverflow.com/questions/39864685/haskell-lacking-of-patterns-in-function", "title": "Haskell - Lacking of patterns in function", "body": "<p>I'm trying to add 0s to the beginning of a list. My module is successfully loaded but when I try below function with some parameters  I get <code>Non-exhaustive patterns in function</code>. Here's the code, <code>offset n</code> is just an integer</p>\n\n<pre><code>extraUnicodeList :: Int-&gt;[Int] -&gt; [Int]\nextraUnicodeList n [] = []\nextraUnicodeList n [a] \n  | (n==0)   = [a]\n  | otherwise = replicate (offset n) 0 ++ [a]\n</code></pre>\n\n<p>Which case am I still missing?</p>\n"}, {"tags": ["haskell"], "answers": [{"tags": [], "owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "is_accepted": true, "score": 2, "last_activity_date": 1475630672, "creation_date": 1475630672, "answer_id": 39864077, "question_id": 39864040, "link": "https://stackoverflow.com/questions/39864040/haskell-add-n-number-of-0s-into-a-list/39864077#39864077", "title": "Haskell - add n number of 0s into a list", "body": "<p>This is super straightforward: it's just</p>\n\n<pre><code>replicate n 0 ++ list\n</code></pre>\n\n<p>where <code>replicate</code> just makes a list of <code>n</code> occurrences of the specified element, and <code>++</code> combines the lists together.</p>\n"}], "owner": {"reputation": 1179, "user_id": 6358607, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fc4656a64508378979d66b7693e19c9c?s=128&d=identicon&r=PG", "display_name": "Tri Nguyen", "link": "https://stackoverflow.com/users/6358607/tri-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "accepted_answer_id": 39864077, "answer_count": 1, "score": -1, "last_activity_date": 1475630672, "creation_date": 1475630415, "question_id": 39864040, "link": "https://stackoverflow.com/questions/39864040/haskell-add-n-number-of-0s-into-a-list", "title": "Haskell - add n number of 0s into a list", "body": "<p>I'm quite new to haskell. Given list [a] of integers and an integer n, how can I add n 0s in the beginning of list [a]. Many thanks.</p>\n"}, {"tags": ["list", "haskell"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 7, "creation_date": 1475623674, "post_id": 39863203, "comment_id": 67014501, "body": "Yes there is, <i>and you&#39;ve already done it for <code>total</code></i>..."}], "answers": [{"comments": [{"owner": {"reputation": 417, "user_id": 4945014, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7M5UE9keRkk/AAAAAAAAAAI/AAAAAAAAA3s/GWLVUx2L4oE/photo.jpg?sz=128", "display_name": "Matt F.", "link": "https://stackoverflow.com/users/4945014/matt-f"}, "edited": false, "score": 0, "creation_date": 1617311198, "post_id": 39863219, "comment_id": 118276768, "body": "Plus one for suggesting <code>map</code>. IMO it&#39;s more clear than recursion-based solutions, and point-free to boot."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 3, "last_activity_date": 1475623553, "creation_date": 1475623553, "answer_id": 39863219, "question_id": 39863203, "link": "https://stackoverflow.com/questions/39863203/how-to-avoid-exception-prelude-head-empty-list-haskell/39863219#39863219", "title": "How to avoid \u201cException: Prelude.head: empty list\u201d? - Haskell", "body": "<p>Yep, you just will have to pattern match in <code>unicodeValueList</code></p>\n\n<pre><code>unicodeValueList :: String -&gt; [Int]\nunicodeValueList [] = []\nunicodeValueList (x:xs) = getLetterUnicodeValue x : unicodeValueList xs\n</code></pre>\n\n<p>Note this could be written more nicely as <code>unicodeValueList = map getLetterUnicodeValue</code>. The reason you are getting the error for <code>head</code> is that your recursion had no base case - it keeps trying to recurse, even when it has reached the empty list.</p>\n"}, {"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 7, "last_activity_date": 1475623776, "creation_date": 1475623776, "answer_id": 39863248, "question_id": 39863203, "link": "https://stackoverflow.com/questions/39863203/how-to-avoid-exception-prelude-head-empty-list-haskell/39863248#39863248", "title": "How to avoid \u201cException: Prelude.head: empty list\u201d? - Haskell", "body": "<p>The surest way to avoid this exception is not to use <code>head</code>. Instead you can use pattern matching to get the head and tail of a list:</p>\n\n<pre><code>unicodeValueList (x:xs) = getLetterUnicodeValue x : unicodeValueList xs\n\ntotal (x:xs) = x + total xs\n</code></pre>\n\n<p>This way <code>x</code> and <code>xs</code> will only be available when the list is non-empty and it is guaranteed that you never accidentally access the head or tail of an empty list.</p>\n\n<p>Of course now you'll get a warning that the pattern match is incomplete: You don't specify what should happen when the list is empty. Of course this was true before as well, but now that you use pattern matching the compiler can actually see this and warn you about it (whereas the previous code crashed at runtime without any prior warning).</p>\n\n<p>So what should be done when the list is empty? Well, an empty string contains no unicode values, right? So it should return the empty list when the input is empty:</p>\n\n<pre><code>unicodeValueList [] = []\n</code></pre>\n\n<hr>\n\n<p>Of course you don't <em>need</em> pattern matching to fix your error. You could just use an <code>if</code> to make sure that you only call <code>head</code> and <code>tail</code> when the list is not empty. But if you do that, the compiler won't be able to verify that your checks are in order. If you use pattern matching  and avoid the unsafe <code>head</code> and <code>tail</code> functions completely, you'll never be able to accidentally access the head or tail of an empty list and the compiler will warn you if you ever forget to consider that the list might be empty.</p>\n"}], "owner": {"reputation": 1179, "user_id": 6358607, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fc4656a64508378979d66b7693e19c9c?s=128&d=identicon&r=PG", "display_name": "Tri Nguyen", "link": "https://stackoverflow.com/users/6358607/tri-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5898, "favorite_count": 0, "accepted_answer_id": 39863248, "answer_count": 2, "score": 6, "last_activity_date": 1475652510, "creation_date": 1475623406, "last_edit_date": 1475652510, "question_id": 39863203, "link": "https://stackoverflow.com/questions/39863203/how-to-avoid-exception-prelude-head-empty-list-haskell", "title": "How to avoid \u201cException: Prelude.head: empty list\u201d? - Haskell", "body": "<p>Good evening everyone, I'm new to haskell. I'm trying to sum up a list of reading a string Unicode values and store them in a list and then sum the integers up. </p>\n\n<pre><code> getLetterUnicodeValue :: Char -&gt; Int\n getLetterUnicodeValue l = (ord l) - 64\n\n unicodeValueList :: String -&gt; [Int]\n unicodeValueList x = getLetterUnicodeValue (head x) : unicodeValueList (tail x)\n\n total :: [Int] -&gt; Int\n total []     = 0\n total x = (head x) + (total (tail x))\n</code></pre>\n\n<p>I got the error of empty list when the string come to the last character and the sum up function cannot successfully execute. Is there any way to stop the function <code>unicodeValueList</code> when it comes to its end.</p>\n\n<pre><code>*** Exception: Prelude.head: empty list\n</code></pre>\n"}, {"tags": ["haskell", "polymorphism", "memoization"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1475623080, "post_id": 39863136, "comment_id": 67014365, "body": "Isn&#39;t <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#specialize-pragma\" rel=\"nofollow noreferrer\"><code>SPECIALIZE</code></a> exactly the &quot;type specific memoization&quot; you are looking for?"}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1475623579, "post_id": 39863136, "comment_id": 67014480, "body": "@Alec looks like it is, I was kind of hoping for a more generic form that didn&#39;t require enumerating all the different types I wanted memoized. Also a way that would work pervasively for local and global bindings without significant code bloat."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1475624286, "post_id": 39863136, "comment_id": 67014634, "body": "It doesn&#39;t turn out to be <i>too</i> bad. Also, if you want to delegate the writing of <code>SPECIALIZE</code> to call-sites (in a different module), you can just declare the  target function <code>INLINEABLE</code> and put the <code>SPECIALIZE</code> pragmas in another module... The docs go into some detail about this."}, {"owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "reply_to_user": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1475631228, "post_id": 39863136, "comment_id": 67016150, "body": "Is it possible to do <code>{-# SPECIALIZEALL #-}</code> or something like that where every type that GHC can guarantee is requested (not necessarily used, but just the types match up) is specialized?"}], "owner": {"reputation": 2313, "user_id": 1513295, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/bc00550a36e3d751bee5e0027f929cbf?s=128&d=identicon&r=PG", "display_name": "semicolon", "link": "https://stackoverflow.com/users/1513295/semicolon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 316, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1475689893, "creation_date": 1475622814, "last_edit_date": 1475689893, "question_id": 39863136, "link": "https://stackoverflow.com/questions/39863136/could-monolocalbinds-replace-the-monomorphismrestriction", "title": "Could MonoLocalBinds replace the MonomorphismRestriction", "body": "<p>The main reason the <code>MonomorphismRestriction</code> exists is to avoid unexpected duplication of work.</p>\n\n<p>One example is the following function:</p>\n\n<pre><code>len2 xs = (len, len)\n    where len = genericLength xs\n</code></pre>\n\n<p>Which has the inferred type <code>(Num b, Num c) =&gt; [a] -&gt; (b, c)</code> which can unfortunately lead to situations where things like <code>uncurry (+) . len2</code> actually computes <code>genericLength</code> twice despite it really only needing to compute it once.</p>\n\n<p>However even without <code>MonomorphismRestriction</code>, the safer type <code>Num b =&gt; [a] -&gt; (b, b)</code> is correctly inferred when you turn on <code>MonoLocalBinds</code>.</p>\n\n<p>Given that <code>MonoLocalBinds</code> is automatically turned on with <code>GADTs</code>, with <code>TypeFamilies</code> and SHOULD be automatically turned on with <code>OVERLAPS</code> (but currently is not). It seems as though having <code>MonoLocalBinds</code> replace <code>MonomorphismRestriction</code> in the long run would make since. Particularly since it seems that there is a general consensus that <code>TypeFamilies</code> and <code>GADTs</code> are incredibly useful and might eventually be made standard.</p>\n\n<p>Now certain things like:</p>\n\n<pre><code>foo = 8 ^ 8 ^ 8\n\nbar = foo + foo\n</code></pre>\n\n<p>Still risk duplication. But I would argue that such expressions are not common enough in real code to warrant the pitfalls of <code>MonomorphismRestriction</code>.</p>\n\n<p>Also if the <code>foo</code> is exported in the above example then I would argue it is correct to give it the type <code>Num a =&gt; a</code> even with the duplication risk, and if it is not exported then it seems like it should not be hard for the optimizer to remove the duplication within <code>bar</code>.</p>\n\n<p>On a side note is there any chance Haskell will implement type specific memoization at some point in the future? Because that seems like it would very convenient for polymorphic top level computations.</p>\n"}, {"tags": ["haskell", "pattern-matching"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1475622523, "post_id": 39862667, "comment_id": 67014224, "body": "You should also see a &quot;shadowing&quot; warning, if you enable warnings with <code>-Wall</code>."}], "answers": [{"comments": [{"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "edited": false, "score": 0, "creation_date": 1475667289, "post_id": 39862787, "comment_id": 67032325, "body": "&gt; <i>since quote and doublequote aren&#39;t the defined identifers but the names of the parameters.</i>   Hm... But I see that my code works right... So Haskell understands what I meaned in my definitions."}, {"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "reply_to_user": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "edited": false, "score": 1, "creation_date": 1475668377, "post_id": 39862787, "comment_id": 67033033, "body": "Really? Is <code>isBorder &#39;5&#39;</code> false?"}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 4, "last_activity_date": 1475620449, "creation_date": 1475620449, "answer_id": 39862787, "question_id": 39862667, "link": "https://stackoverflow.com/questions/39862667/pattern-match-is-redundant/39862787#39862787", "title": "Pattern match is redundant", "body": "<p>The pattern can only be matched against concrete values, not against identifiers.</p>\n\n<p>So the compiler essentially sees:</p>\n\n<pre><code>isBorder x = True\nisBorder x = True\n</code></pre>\n\n<p>since <code>quote</code> and <code>doublequote</code> aren't the defined identifers but the names of the parameters.</p>\n"}, {"comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 0, "creation_date": 1475620600, "post_id": 39862790, "comment_id": 67013628, "body": "You can pack all the calls in one top-level function."}, {"owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "edited": false, "score": 0, "creation_date": 1475667909, "post_id": 39862790, "comment_id": 67032713, "body": "Yes, I understand you and I think you are right. Hm... But I see that my code works right too... So Haskell understands what I meaned in my definitions. Look my full code example, please here: <a href=\"https://yadi.sk/d/MfyG7OmHwGmsV\" rel=\"nofollow noreferrer\">yadi.sk/d/MfyG7OmHwGmsV</a>"}], "tags": [], "owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "is_accepted": true, "score": 14, "last_activity_date": 1475620461, "creation_date": 1475620461, "answer_id": 39862790, "question_id": 39862667, "link": "https://stackoverflow.com/questions/39862667/pattern-match-is-redundant/39862790#39862790", "title": "Pattern match is redundant", "body": "<p>When declaring functions, the argument variables are <em>new</em> names. Your quote and doubleQuote are shadowing the functions rather than invoking the functions for pattern matching. In this way the language of pattern matching subtly deviates from the language of right-hand-sided expressions. To achieve what you want, either do</p>\n\n<pre><code>isBorder :: Char -&gt; Bool\nisBorder '\\'' = True\nisBorder '\\\"' = True\nisBorder _ = False\n</code></pre>\n\n<p>or</p>\n\n<pre><code>isBorder :: Char -&gt; Bool\nisBorder c | quote == c = True\nisBorder c | doubleQuote == c = True\nisBorder _ = False\n</code></pre>\n\n<p>The philosophy is to first bind the argument to name and <em>then</em> to use a guard to invoke an expression that evaluates to a boolean.</p>\n\n\n"}], "owner": {"reputation": 10045, "user_id": 1306132, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/kVX7T.png?s=128&g=1", "display_name": "Andrey Bushman", "link": "https://stackoverflow.com/users/1306132/andrey-bushman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8778, "favorite_count": 0, "accepted_answer_id": 39862790, "answer_count": 2, "score": 8, "last_activity_date": 1571213980, "creation_date": 1475619744, "last_edit_date": 1571213980, "question_id": 39862667, "link": "https://stackoverflow.com/questions/39862667/pattern-match-is-redundant", "title": "Pattern match is redundant", "body": "<p>Haskell, Stack build tool.</p>\n\n<p>I have code:</p>\n\n<pre><code>quote :: Char\nquote = '\\''\n\ndoubleQuote :: Char\ndoubleQuote = '\\\"'\n\nisBorder :: Char -&gt; Bool\nisBorder quote = True\nisBorder doubleQuote = True\nisBorder _ = False\n</code></pre>\n\n<p>It will be compiled without erors, but I see the messages during the compilation:</p>\n\n<blockquote>\n  <p>D:\\haskell\\real\\app\\Main.hs:34:1: warning: [-Woverlapping-patterns]<br>\n      Pattern match is redundant<br>\n      In an equation for `isBorder': isBorder doubleQuote = ...</p>\n  \n  <p>D:\\haskell\\real\\app\\Main.hs:35:1: warning: [-Woverlapping-patterns]<br>\n      Pattern match is redundant<br>\n      In an equation for `isBorder': isBorder _ = ...</p>\n</blockquote>\n\n<p>What does it mean? I don't see redundance...  </p>\n"}, {"tags": ["function", "haskell"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1475620566, "post_id": 39862653, "comment_id": 67013614, "body": "besides the trivial <code>\\_ na _ -&gt; return na</code>?"}, {"owner": {"reputation": 953, "user_id": 98770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5514b46bca60a2dc6194f0c36b273cf9?s=128&d=identicon&r=PG", "display_name": "drhodes", "link": "https://stackoverflow.com/users/98770/drhodes"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1475620763, "post_id": 39862653, "comment_id": 67013689, "body": "yeah I&#39;m looking for a function that applies <code>f</code> somehow"}], "answers": [{"tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": true, "score": 12, "last_activity_date": 1475621628, "last_edit_date": 1475621628, "creation_date": 1475621305, "answer_id": 39862929, "question_id": 39862653, "link": "https://stackoverflow.com/questions/39862653/can-this-function-be-implemented/39862929#39862929", "title": "Can this function be implemented?", "body": "<p>Yes, and it can be given a more general type.</p>\n\n<pre><code>foo :: (Functor f, Functor g) =&gt; (a -&gt; b -&gt; c) -&gt; f a -&gt; g b -&gt; f (g c)\nfoo f fx gy = fmap (\\x -&gt; fmap (f x) gy) fx\n</code></pre>\n"}], "owner": {"reputation": 953, "user_id": 98770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5514b46bca60a2dc6194f0c36b273cf9?s=128&d=identicon&r=PG", "display_name": "drhodes", "link": "https://stackoverflow.com/users/98770/drhodes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 39862929, "answer_count": 1, "score": 4, "last_activity_date": 1475652477, "creation_date": 1475619682, "last_edit_date": 1475652477, "question_id": 39862653, "link": "https://stackoverflow.com/questions/39862653/can-this-function-be-implemented", "title": "Can this function be implemented?", "body": "<p>Is there any implementation for this function?</p>\n\n<pre><code>foo :: (Monad m, Monad n) =&gt; m a -&gt; n a -&gt; (a -&gt; a -&gt; a) -&gt; m (n a)\nfoo x y f = ...\n</code></pre>\n"}, {"tags": ["haskell", "stream", "transformer"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1475605517, "post_id": 39859064, "comment_id": 67006409, "body": "The problem I see is that there is no beginning point; every Mealy automaton comes from some previous automaton, but where does the first one come from? In other words, you need an explicit start state as an argument to <code>toMealy</code>."}, {"owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1475605738, "post_id": 39859064, "comment_id": 67006532, "body": "You can certainly write a function <code>toMealy :: (Stream a -&gt; Stream b) -&gt; Mealy a b</code> if you don&#39;t care what it does, but I&#39;m guessing you have something more specific in mind. But not every stream transformer can be produced by <code>toStreamTransformer</code>; only ones where the first N elements of the output only depend on the first N elements of the input for each N."}, {"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1475606383, "post_id": 39859064, "comment_id": 67006878, "body": "Its not an answer to your question, but you might take a look at Edward Kmetts &quot;machine&quot; package. <a href=\"https://hackage.haskell.org/package/machines-0.6.1\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/machines-0.6.1</a>"}, {"owner": {"reputation": 35, "user_id": 5762027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2394851f4e8f258ac490a3dd16a230d1?s=128&d=identicon&r=PG&f=1", "display_name": "Reddog", "link": "https://stackoverflow.com/users/5762027/reddog"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1475607897, "post_id": 39859064, "comment_id": 67007719, "body": "@Paul Johnson I know of this package, but as you said, it does not seem to have a solution."}, {"owner": {"reputation": 35, "user_id": 5762027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2394851f4e8f258ac490a3dd16a230d1?s=128&d=identicon&r=PG&f=1", "display_name": "Reddog", "link": "https://stackoverflow.com/users/5762027/reddog"}, "reply_to_user": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "edited": false, "score": 0, "creation_date": 1475608014, "post_id": 39859064, "comment_id": 67007778, "body": "@Reid Barton You are right, so the reversal of toStreamTransformer has to be restricted, too. I see. Hmm, I wonder, if there is still a way of doing something close. Obviously, I only care about streams that are deterministic in the way you described it."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 2, "creation_date": 1475608151, "post_id": 39859064, "comment_id": 67007845, "body": "See the blog post <a href=\"http://pchiusano.blogspot.com.es/2011/12/programmatic-translation-to-iteratees.html\" rel=\"nofollow noreferrer\">Programmatic translation to iteratees from pull-based code</a> by Paul Chiusano. I also implemented something a bit like this in my <a href=\"http://hackage.haskell.org/package/streaming-eversion\" rel=\"nofollow noreferrer\">streaming-eversion</a> library, only the transformation was not to Mealy machines; but to the <code>Fold</code> datatype of the <a href=\"http://hackage.haskell.org/package/foldl-1.2.1/docs/Control-Foldl.html\" rel=\"nofollow noreferrer\">foldl</a> library."}], "answers": [{"tags": [], "owner": {"reputation": 14485, "user_id": 190376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd8280c5e1491b8cf55760750ed97dec?s=128&d=identicon&r=PG", "display_name": "Reid Barton", "link": "https://stackoverflow.com/users/190376/reid-barton"}, "is_accepted": false, "score": 0, "last_activity_date": 1475609496, "creation_date": 1475609496, "answer_id": 39860344, "question_id": 39859064, "link": "https://stackoverflow.com/questions/39859064/convert-stream-transformer-function-into-mealy-automaton-in-haskell/39860344#39860344", "title": "Convert stream transformer function into Mealy automaton in Haskell", "body": "<p>If you're assuming that the stream transformer passed to <code>toMealy</code> is \"deterministic\" then you can get your Mealy machine started by, on input <code>a</code>, passing <code>a : e : e : ...</code> to the stream transformer (where <code>e = error \"input stream transformer is not deterministic\"</code>), and outputting the first element <code>b</code> of the output stream. Then modify your stream transformer to prepend <code>a</code> to its input and drop the first element (presumably <code>b</code>) of its output and recurse.</p>\n\n<p>Or if you prefer you can use input <code>a : a : a : ...</code> instead; then you'll get a total function that doesn't detect whether the input is deterministic, but produces a Mealy machine that only generates the original stream transformer when it is.</p>\n\n<p>This approach will take quadratic time in the number of steps you want to run the Mealy machine for; there might be something cleverer.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 5762027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2394851f4e8f258ac490a3dd16a230d1?s=128&d=identicon&r=PG&f=1", "display_name": "Reddog", "link": "https://stackoverflow.com/users/5762027/reddog"}, "edited": false, "score": 1, "creation_date": 1475649833, "post_id": 39861542, "comment_id": 67021516, "body": "Thank you very much. It took quite some time to understand. The blog-post helped a lot as well!"}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "reply_to_user": {"reputation": 35, "user_id": 5762027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2394851f4e8f258ac490a3dd16a230d1?s=128&d=identicon&r=PG&f=1", "display_name": "Reddog", "link": "https://stackoverflow.com/users/5762027/reddog"}, "edited": false, "score": 0, "creation_date": 1475650846, "post_id": 39861542, "comment_id": 67022054, "body": "The definition of <code>trickster</code> is more complex than it needs to be because it accesses the internals of <code>Stream</code> to gain a bit of efficiency. You can substitute <code>r &lt;- lift (yields id)</code> for <code>Effect (Step (Return . Return))</code>, <code>Input a -&gt; yield a *&gt; trickster</code> for <code>Input a -&gt; Step (a :&gt; trickster)</code> and <code>return ()</code> for <code>Return ()</code>. <code>Effect</code>, <code>Step</code> and <code>Return</code> are internal constructors from <code>Streaming.Internal</code> which are usually hidden."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 3, "last_activity_date": 1475652803, "last_edit_date": 1475652803, "creation_date": 1475614326, "answer_id": 39861542, "question_id": 39859064, "link": "https://stackoverflow.com/questions/39859064/convert-stream-transformer-function-into-mealy-automaton-in-haskell/39861542#39861542", "title": "Convert stream transformer function into Mealy automaton in Haskell", "body": "<p>This answer makes use of the <code>Stream</code> abstraction provided by the <a href=\"http://hackage.haskell.org/package/streaming\" rel=\"nofollow\">streaming</a> package. This abstraction:</p>\n\n<ul>\n<li>Is a monad transformer, so you can put any monad under it.</li>\n<li>Has a return type separate from the elements produced by the stream. A value of this type is returned when the stream is exhausted.</li>\n</ul>\n\n<p>Imagine you have a function like:</p>\n\n<pre><code>module Main where\n\nimport Streaming\nimport Streaming.Internal (Stream(Effect,Step,Return))\nimport Streaming.Prelude\n\ntransformation :: Monad m =&gt; Stream (Of Int) m r -&gt; Stream (Of String) m r\ntransformation = undefined -- your code here\n</code></pre>\n\n<p><code>transformation</code> changes a stream of <code>Int</code> values into a stream of <code>String</code> values. It is polymorphic on the base monad, which means the transformation itself is pure. It is polymorphic on the return type <code>r</code>, which means that the transformation always exhausts the source stream.</p>\n\n<p>Now we write these auxiliary definitions:</p>\n\n<pre><code>data Feed a = Input a | EOF\n\ntrickster :: Monad m =&gt; Stream (Of a) (Stream ((-&gt;) (Feed a)) m) ()        \ntrickster = do\n  r &lt;- Effect (Step (Return . Return)) -- request a `Feed a` value\n  case r of\n      Input a -&gt; Step (a :&gt; trickster)\n      EOF     -&gt; Return () \n</code></pre>\n\n<p><code>trickster</code> is a bit strange. At the outer level, it is a stream that produces <code>a</code> values. But underneath, we have something like a <code>Free (-&gt;)</code> monad (here also implemented with <code>Stream</code>) that takes <code>a</code> values and emits them at the outer level.</p>\n\n<p>What happens if we apply <code>trickster</code> to <code>transformation</code>, and then merge the two <code>Stream</code> layers using the <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.3/docs/Streaming-Prelude.html#v:unseparate\" rel=\"nofollow\"><code>unseparate</code></a> function?</p>\n\n<pre><code>machine :: Stream (Sum (Of String) ((-&gt;) (Feed Int))) Identity ()         \nmachine = unseparate (transformation trickster)\n</code></pre>\n\n<p>We can advance through <code>machine</code> using the <a href=\"http://hackage.haskell.org/package/streaming-0.1.4.3/docs/Streaming.html#v:inspect\" rel=\"nofollow\"><code>inspect</code></a> function </p>\n\n<pre><code>inspect :: (Functor f, Monad m) =&gt; Stream f m r -&gt; m (Either r (f (Stream f m r)))\n</code></pre>\n\n<p>Here's a scary type:</p>\n\n<pre><code>ghci&gt; :t runIdentity (inspect machine)\nrunIdentity (inspect machine)\n  :: Either\n       ()\n       (Sum\n          (Of String)\n          ((-&gt;) (Feed Int))\n          (Stream (Sum (Of String) ((-&gt;) (Feed Int))) Identity ()))\n</code></pre>\n\n<p>It basically means that at a given step the machine either terminates (but the implementation of <code>trickster</code> ensures that it will never do that unless we pass <code>EOF</code>) or it produces a <code>String</code>, or requires us to enter an <code>Int</code> value.</p>\n\n<p>(We could have done without <code>unseparate</code>, but the process of peeling the two <code>Stream</code> layers would have been more confusing.)</p>\n\n<p>(Also, see the blog post <a href=\"http://pchiusano.blogspot.com.es/2011/12/programmatic-translation-to-iteratees.html\" rel=\"nofollow\">Programmatic translation to iteratees from pull-based code</a> by Paul Chiusano for the original idea behind this code.)</p>\n"}], "owner": {"reputation": 35, "user_id": 5762027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2394851f4e8f258ac490a3dd16a230d1?s=128&d=identicon&r=PG&f=1", "display_name": "Reddog", "link": "https://stackoverflow.com/users/5762027/reddog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "accepted_answer_id": 39861542, "answer_count": 2, "score": 2, "last_activity_date": 1475652803, "creation_date": 1475604683, "question_id": 39859064, "link": "https://stackoverflow.com/questions/39859064/convert-stream-transformer-function-into-mealy-automaton-in-haskell", "title": "Convert stream transformer function into Mealy automaton in Haskell", "body": "<p>I work with streams:</p>\n\n<pre><code>data Stream a = Cons a (Stream a)\n</code></pre>\n\n<p>Particularly, stream transformer functions:</p>\n\n<pre><code>f :: Stream a -&gt; Stream b\n</code></pre>\n\n<p>I would like to make a Mealy automaton out of such a function:</p>\n\n<pre><code>data Mealy a b = Mealy (a -&gt; (b, Mealy a b))\n</code></pre>\n\n<p>Is there a way to write such a function?</p>\n\n<pre><code>toMealy :: (Stream a -&gt; Stream b) -&gt; Mealy a b\n</code></pre>\n\n<p>I can't find a way. Although the other way works easily:</p>\n\n<pre><code>toStreamTransformer :: Mealy a b -&gt; Stream a -&gt; Stream b\n</code></pre>\n\n<p>Maybe I'm missing something trivial?</p>\n"}, {"tags": ["haskell", "io", "functional-programming"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1475622780, "post_id": 39855987, "comment_id": 67014295, "body": "<code>x</code> is a string (aka a list of characters) and <code>replicateM</code> needs an int - what&#39;s unclear?"}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1475601212, "post_id": 39856018, "comment_id": 67004213, "body": "Indeed <code>readLn</code> gets <code>x</code> as <code>IO a</code> where <code>a</code> is the type which is needed in the context. Since <code>replicateM</code> requires <code>Int</code>, then the compiler infers <code>a ~ Int</code>. If <code>replicateM</code> did not fix <code>a</code> precisely, an ambiguity error would have occurred."}], "tags": [], "owner": {"reputation": 2399, "user_id": 3065657, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XDEr0.jpg?s=128&g=1", "display_name": "lycuid", "link": "https://stackoverflow.com/users/3065657/lycuid"}, "is_accepted": true, "score": 4, "last_activity_date": 1475594202, "creation_date": 1475594202, "answer_id": 39856018, "question_id": 39855987, "link": "https://stackoverflow.com/questions/39855987/error-while-getting-input-from-a-file/39856018#39856018", "title": "error while getting input from a file", "body": "<p>replicateM goes like <code>replicateM :: Monad m =&gt; Int -&gt; m a -&gt; m [a]</code>\nwhere as <code>getLine :: IO String</code><br>\n\"x\" needs to be <code>Int</code> but <code>getLine</code> returns an <code>IO String</code>,\nYou can do <code>read x :: Int</code>:</p>\n\n<pre><code>main = do\n  x &lt;- getLine\n  lines &lt;- replicateM (read x :: Int) getLine\n  print $ lines\n</code></pre>\n\n<p>or simply do:</p>\n\n<pre><code>main = do\n  x &lt;- readLn\n  lines &lt;- replicateM x getLine\n  print $ lines\n</code></pre>\n\n<p><code>readLn</code> probably gets <code>x</code> as <code>IO Int</code></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6917232"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 39856018, "answer_count": 1, "score": 0, "last_activity_date": 1475594202, "creation_date": 1475594106, "question_id": 39855987, "link": "https://stackoverflow.com/questions/39855987/error-while-getting-input-from-a-file", "title": "error while getting input from a file", "body": "<p>main function:</p>\n\n<pre><code>main = do\n  x &lt;- getLine\n  lines &lt;- replicateM x getLine\n  print $ lines\n</code></pre>\n\n<p>the error I am getting:</p>\n\n<pre><code>Couldn't match type `[Char]' with `Int'\nExpected type: Int\n  Actual type: String\nIn the first argument of `replicateM', namely `x'\nIn a stmt of a 'do' block: lines &lt;- replicateM x getLine\n</code></pre>\n\n<p>Need a way to solve this issue.</p>\n"}, {"tags": ["haskell", "infinite", "idris", "induction", "coinduction"], "comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 7, "creation_date": 1475599083, "post_id": 39854514, "comment_id": 67003063, "body": "Haskell has no notion of inductive or coinductive types. (It doesn&#39;t really need one because it&#39;s a partial and lazy language.) So it doesn&#39;t really make sense to ask whether a given Haskell type is inductive or coinductive."}, {"owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "edited": false, "score": 1, "creation_date": 1475638168, "post_id": 39854514, "comment_id": 67017702, "body": "Your <code>HList</code> type is usually called a co-list."}], "answers": [{"comments": [{"owner": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 0, "creation_date": 1475616692, "post_id": 39857759, "comment_id": 67012144, "body": "Can you explain how Haskell has both types? I&#39;m pretty sure this isn&#39;t true. Every type in Haskell is lazy. So Haskell <i>cannot</i> represent inductive types like the natural numbers. It&#39;s simply impossible."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 1, "creation_date": 1475618411, "post_id": 39857759, "comment_id": 67012889, "body": "@gardenhead In my understanding it&#39;s not so much that all Haskell types are &quot;both inductive and coinductive&quot;, but more that Haskell has <i>neither</i> inductive nor coinductive types. You can&#39;t represent coinductive types like <code>Stream</code> either. This is more a consequence of partiality than of laziness in my opinion."}, {"owner": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1475622490, "post_id": 39857759, "comment_id": 67014218, "body": "@BenjaminHodgson What does partiality have to do with <code>Stream</code>? The data type <code>type Stream = Nil | Cons nat * Stream</code> should be the type of infinite streams under a lazy dynamics. How can a <i>datatype</i> be partial? Partiality only refers to functions."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 1, "creation_date": 1475624623, "post_id": 39857759, "comment_id": 67014718, "body": "@gardenhead Keep in mind that pretty much all formal treatment of Haskell as a system of logic relies on assumptions, such as <code>undefined</code> not coming into play, nor <code>seq</code>. I say that <code>[]</code> is both the inductive and coinductive list because you can write equivalent programs on Haskell lists to those in e.g. Agda or Coq which operate on <i>both</i> inductive and coinductive lists."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 1, "creation_date": 1475624789, "post_id": 39857759, "comment_id": 67014767, "body": "@gardenhead And if you accept the afformentioned assumptions, you can really represent the naturals with <code>data Nat = Z | S !Nat</code> (note the strictness annotation) for which the definition <code>inf = S inf</code> is <i>not</i> generative, and more specifically is just equivalent to <code>undefined</code>. The same works for lists, I suppose: <code>data FiniteList = Nil | Cons a !(FiniteList a)</code>  - this again makes things like <code>ones</code> non-generative and you get finite lists or bottom."}, {"owner": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 0, "creation_date": 1475624962, "post_id": 39857759, "comment_id": 67014808, "body": "@user2407038 I am not very familiar with Haskell, so this strictness annotation is news to me. If Haskell has both eager and lazy types, then of course it can represent natural numbers. But I still stand by my claim that the <i>standard</i> definition of the naturals is not correct in Haskell. Again, due to my unfamiliarity with Haskell, I was not aware of <code>undefined</code>. But if it&#39;s just the bottom type then I don&#39;t see how it comes into the picture."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 0, "creation_date": 1475625389, "post_id": 39857759, "comment_id": 67014915, "body": "@gardenhead Typical presentations probably rely on the assumption that the infinite natural number not be constructed. This isn&#39;t much different than the assumption that <code>undefined</code> not be used in a program, which is the bare minimum for any other formal treatment of Haskell. <code>undefined</code> means that even if you correctly axiomize the natural numbers, your type will still be inhabited by a value which is not a natural number, namely <code>undefined</code>."}, {"owner": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 0, "creation_date": 1475626074, "post_id": 39857759, "comment_id": 67015090, "body": "@user2407038 I don&#39;t think that&#39;s true. There are semantics of type systems that don&#39;t use <code>undefined</code> as an explicit value. For example, one can consider partial functions as the underlying domain. Then a function N -&gt; N that doesn&#39;t halt on input <i>x</i> simply is not defined on <i>x</i>, instead of being defined with value <i>undefined</i>. Moreover, in an operational semantics, there is no need to even consider such notions as non-halting computation. Their meaning is given by their lack of termination."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 2, "creation_date": 1475628870, "post_id": 39857759, "comment_id": 67015659, "body": "@gardenhead Are you talking about a real programming language or a theoretical semantics that has the magical ability to tell when a function halts for any arbitrary input?"}, {"owner": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1475629310, "post_id": 39857759, "comment_id": 67015763, "body": "@user2297560 I&#39;m not sure what you mean. Of course I&#39;m not assuming that we can solve the Halting problem. I&#39;m saying that in an operational semantics one does not need any &quot;undefined&quot; value, because the computation will never reach a value."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 0, "creation_date": 1475877245, "post_id": 39857759, "comment_id": 67136232, "body": "@gardenhead I&#39;m sure it would be easy enough to modify a Haskell interpreter so that it enters an infinite loop instead of raising an &quot;undefined&quot; error, but pragmatically, that&#39;s <i>less</i> useful than raising the error."}, {"owner": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1475877432, "post_id": 39857759, "comment_id": 67136281, "body": "@immibis But then the interpreter would have to determine if the program will halt..."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "edited": false, "score": 0, "creation_date": 1475877600, "post_id": 39857759, "comment_id": 67136333, "body": "@gardenhead No; with that modification it will <i>always not halt</i> when encountering <code>undefined</code>, instead of sometimes halting and sometimes not halting. Thus you can never have <code>undefined</code> as a value, you can only have a computation that never terminates. Isn&#39;t that what you wanted?"}, {"owner": {"reputation": 1649, "user_id": 2616221, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/95e86e947ab529429b9182904f01540c?s=128&d=identicon&r=PG&f=1", "display_name": "gardenhead", "link": "https://stackoverflow.com/users/2616221/gardenhead"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1475883958, "post_id": 39857759, "comment_id": 67137882, "body": "@immibis Maybe I misunderstood you? I think the confusion stems from using three different meanings of &quot;bottom&quot;: a type, a construct in Haskell of that type, and a special value in certain denotational semantics. These are <i>not</i> the same thing."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 25, "last_activity_date": 1475600686, "last_edit_date": 1492087710, "creation_date": 1475599743, "answer_id": 39857759, "question_id": 39854514, "link": "https://stackoverflow.com/questions/39854514/are-lists-inductive-or-coinductive-in-haskell/39857759#39857759", "title": "Are Lists Inductive or Coinductive in Haskell?", "body": "<ol>\n<li><p>Due to laziness, Haskell types are both inductive and coinductive, or, there is no formal distinguishment between data and codata. All recursive types can contain an infinite nesting of constructors. In languages such as Idris, Coq, Agda, etc. a definition like <code>ones = 1 : ones</code> is rejected by the termination checker. Laziness means that <code>ones</code> can be evaluated in one step to <code>1 : ones</code>, whereas the other languages evaluate to normal form only, and <code>ones</code> does not have a normal form.</p></li>\n<li><p>'Coinductive' does not mean 'necessarily infinite', it means 'defined by how it is deconstructed', wheras inductive means 'defined by how it is constructed'. I think <a href=\"https://cs.stackexchange.com/questions/525/what-is-coinduction\">this</a> is an excellent explanation of the subtle difference. Surely you would agree that the type </p>\n\n<p><code>codata A : Type where MkA : A</code></p>\n\n<p>cannot be infinite.</p></li>\n<li><p>This is an interesting one - as opposed to <code>HList</code>, which you can never 'know' if it is finite or infinite (specifically, you can discover in finite time if a list is finite, but you can't compute that it is infinite), <code>HList'</code> gives you a simple way to decide in constant time if your list is finite or infinite.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 747, "user_id": 1644720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56c78e4be01bb6d0fd2ad2c2f99a5f37?s=128&d=identicon&r=PG", "display_name": "Crazycolorz5", "link": "https://stackoverflow.com/users/1644720/crazycolorz5"}, "edited": false, "score": 1, "creation_date": 1475601847, "post_id": 39858006, "comment_id": 67004524, "body": "In Agda, is it possible to define a structure similar to HList? In that case, are productivity constraints still imposed (as it is codata), and thus filter would still be invalid? That is, the introduction of Nil doesn&#39;t affect its validity?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "reply_to_user": {"reputation": 747, "user_id": 1644720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56c78e4be01bb6d0fd2ad2c2f99a5f37?s=128&d=identicon&r=PG", "display_name": "Crazycolorz5", "link": "https://stackoverflow.com/users/1644720/crazycolorz5"}, "edited": false, "score": 1, "creation_date": 1475603274, "post_id": 39858006, "comment_id": 67005251, "body": "That&#39;s right. Coinductive lists can still be infinite (though unlike streams they might not be), so <code>filter</code> would still be rejected because it wouldn&#39;t be productive for all its inputs"}], "tags": [], "owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "is_accepted": false, "score": 19, "last_activity_date": 1475696533, "last_edit_date": 1475696533, "creation_date": 1475600675, "answer_id": 39858006, "question_id": 39854514, "link": "https://stackoverflow.com/questions/39854514/are-lists-inductive-or-coinductive-in-haskell/39858006#39858006", "title": "Are Lists Inductive or Coinductive in Haskell?", "body": "<p>In a total language like Coq or Agda, inductive types are those whose values can be torn down in finite time. Inductive functions must terminate. Coinductive types, on the other hand, are those whose values can be <em>built up</em> in finite time. Coinductive functions must be productive.</p>\n\n<p>Systems that are intended to be useful as proof assistants (like Coq and Agda) <em>must</em> be total, because non-termination causes a system to be logically inconsistent. But requiring all functions to be total and inductive makes it impossible to work with infinite structures, thus, coinduction was invented.</p>\n\n<p>So the purpose of inductive and coinductive types is to reject possibly non-terminating programs. Here's an example in Agda of a function which is rejected because of the productivity condition. (The function you pass to <code>filter</code> could reject every element, so you could be waiting forever for the next element of the resulting stream.)</p>\n\n<pre><code>filter : {A : Set} -&gt; (A -&gt; Bool) -&gt; Stream A -&gt; Stream A\nfilter f xs with f (head xs)\n... | true = head xs :: filter f (tail xs)\n... | false = filter f (tail xs)  -- unguarded recursion\n</code></pre>\n\n<p>Now, Haskell has no notion of inductive or coinductive types. The question \"Is this type inductive or coinductive?\" is not a meaningful one. How does Haskell get away without making the distinction? Well, Haskell was never intended to be consistent as a logic in the first place. It's a partial language, which means that you're allowed to write non-terminating and non-productive functions - there's no termination checker and no productivity checker. One can debate the wisdom of this design decision but it certainly renders induction and coinduction redundant.</p>\n\n<p>Instead, Haskell programmers are used to reasoning <em>informally</em> about a program's termination/productivity. Laziness lets us work with infinite data structures, but we don't get any help from the machine to ensure that our functions are total.</p>\n"}, {"tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": false, "score": 5, "last_activity_date": 1475600758, "creation_date": 1475600758, "answer_id": 39858025, "question_id": 39854514, "link": "https://stackoverflow.com/questions/39854514/are-lists-inductive-or-coinductive-in-haskell/39858025#39858025", "title": "Are Lists Inductive or Coinductive in Haskell?", "body": "<p>To interpret type-level recursion one needs to find a \"fixed point\" for the\nCPO-valued list functor </p>\n\n<pre><code>F X = (1 + A_bot * X)_bot\n</code></pre>\n\n<p>If we reason inductively, we want the fixed point to be \"least\". If coinductively, \"greatest\".</p>\n\n<p>Technically, this is done by working in the embedding-projection subcategory of CPO_bot, taking e.g. for the \"least\" the colimit of the diagram of embeddings</p>\n\n<pre><code>0_bot |-&gt; F 0_bot |-&gt; F (F 0_bot) |-&gt; ...\n</code></pre>\n\n<p>generalizing the Kleene's fixed point theorem. For the \"greatest\" we would take the limit of the diagram of the projections</p>\n\n<pre><code>0_bot &lt;-| F 0_bot &lt;-| F (F 0_bot) &lt;-| ...\n</code></pre>\n\n<p>It however turns out that the \"least\" is isomorphic to the \"greatest\", for any <code>F</code>. This is the \"bilimit\" theorem (see e.g. Abramsky's \"Domain Theory\" survey paper).</p>\n\n<p>Perhaps surprisingly, it turns out that the inductive or coinductive flavor comes from the liftings applied by <code>F</code> instead of the least/greatest fixed points. For instance, if <code>x</code> is the smashed product and <code>#</code> is the smashed sum,</p>\n\n<pre><code>F X = 1_bot # (A_bot x X)\n</code></pre>\n\n<p>would have as a bilimit the set of finite lists (up to iso).</p>\n\n<p>[I hope I got the liftings right -- these are tricky ;-) ]</p>\n"}], "owner": {"reputation": 747, "user_id": 1644720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56c78e4be01bb6d0fd2ad2c2f99a5f37?s=128&d=identicon&r=PG", "display_name": "Crazycolorz5", "link": "https://stackoverflow.com/users/1644720/crazycolorz5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1905, "favorite_count": 10, "accepted_answer_id": 39857759, "answer_count": 3, "score": 30, "last_activity_date": 1475696533, "creation_date": 1475590150, "last_edit_date": 1475593062, "question_id": 39854514, "link": "https://stackoverflow.com/questions/39854514/are-lists-inductive-or-coinductive-in-haskell", "title": "Are Lists Inductive or Coinductive in Haskell?", "body": "<p>So I've been reading about coinduction a bit lately, and now I'm wondering: are Haskell lists inductive or coinductive? I've also heard that Haskell doesn't distinguish the two, but if so, how do they do so formally?</p>\n\n<p>Lists are defined inductively, <code>data [a] = [] | a : [a]</code>, yet can be used coinductively, <code>ones = a:ones</code>. We can create infinite lists. Yet, we can create finite lists. So which are they?</p>\n\n<p>Related is in Idris, where the type <code>List a</code> is strictly an inductive type, and is thus only finite lists. It's defined akin to how it is in Haskell. However, <code>Stream a</code> is a coinductive type, modeling an infinite list. It's defined as (or rather, the definition is equivalent to) <code>codata Stream a = a :: (Stream a)</code>. It's impossible to create an infinite List or a finite Stream. However, when I write the definition</p>\n\n<pre><code>codata HList : Type -&gt; Type where\n    Nil : HList a\n    Cons : a -&gt; HList a -&gt; HList a\n</code></pre>\n\n<p>I get the behavior that I expect from Haskell lists, namely that I can make both finite and infinite structures.</p>\n\n<p>So let me boil them down to a few core questions:</p>\n\n<ol>\n<li><p>Does Haskell not distinguish between inductive and coinductive types? If so, what's the formalization for that? If not, then which is [a]?</p></li>\n<li><p>Is HList coinductive? If so, how can a coinductive type contain finite values?</p></li>\n<li><p>What about if we defined <code>data HList' a = L (List a) | R (Stream a)</code>? What would that be considered and/or would it be useful over just <code>HList</code>?</p></li>\n</ol>\n"}, {"tags": ["haskell", "haskell-pipes"], "comments": [{"owner": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1475611749, "post_id": 39854497, "comment_id": 67009752, "body": "It looks like you could just fix your type signature and it&#39;d be better.  You have a <code>Consumer B.ByteString IO ()</code> in the type signature instead of a <code>Consumer B.ByteString IO a</code>.  The <code>runEffect</code> returns whatever your overall <code>Effect</code> returns, and you&#39;ve told it that it has to be a <code>Consumer B.ByteString IO ()</code>, but that <code>runEffect</code> needs to return an <code>IO a</code>."}, {"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "reply_to_user": {"reputation": 51584, "user_id": 839246, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b0573c2b936b12828dd1e4cc04206dc?s=128&d=identicon&r=PG&f=1", "display_name": "bheklilr", "link": "https://stackoverflow.com/users/839246/bheklilr"}, "edited": false, "score": 0, "creation_date": 1475614119, "post_id": 39854497, "comment_id": 67010923, "body": "That doesn&#39;t work because <a href=\"http://hackage.haskell.org/package/pipes-concurrency-2.0.6/docs/Pipes-Concurrent.html#v:fromInput\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/pipes-concurrency-2.0.6/docs/&hellip;</a> explicitely returns <code>Producer&#39; a m () </code>.<code>toOutput</code> is similar.  I thought about trying to convert them somehow, but I&#39;m not sure if that makes sense."}], "answers": [{"comments": [{"owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "edited": false, "score": 0, "creation_date": 1475676030, "post_id": 39863504, "comment_id": 67038723, "body": "This is exactly what I was hoping for.  Bonus:  I can tell whether my program exited properly or if the server cuts me off unexpectedly."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1475626078, "last_edit_date": 1475626078, "creation_date": 1475625718, "answer_id": 39863504, "question_id": 39854497, "link": "https://stackoverflow.com/questions/39854497/connecting-pipes-with-consumers-and-producers-that-return-different-values/39863504#39863504", "title": "Connecting Pipes with Consumers and Producers that return different values", "body": "<p><code>Producer</code>s and <code>Consumer</code>s that return <code>()</code> can stop by themselves. <code>Producer</code>s and <code>Consumer</code>s that are polymorphic on their return type never stop by themselves.</p>\n\n<p>To unify the return types in your case, put each one in different branches of an <code>Either</code>, using <code>fmap</code>.</p>\n\n<pre><code>runAsterisk' :: Producer B.ByteString IO () \n             -&gt; Consumer B.ByteString IO () \n             -&gt; Asterisk a \n             -&gt; IO (Either () a)\nrunAsterisk' i o m' = runEffect $ fmap Left i &gt;-&gt; fmap Right (astPipe m') &gt;-&gt; fmap Left o\n</code></pre>\n\n<p>Pattern matching on the <code>Either</code> will reveal which component stopped the pipeline.</p>\n\n<p>Also, you can use <a href=\"http://hackage.haskell.org/package/pipes-4.2.0/docs/Pipes-Prelude.html#v:drain\" rel=\"nofollow\"><code>drain</code></a> to transform a <code>Consumer a IO ()</code> into a consumer that never stops by itself:</p>\n\n<pre><code>neverStop :: Consumer a IO () -&gt; Consumer a IO r\nneverStop consumer = consumer *&gt; drain\n</code></pre>\n\n<p>All the inputs received after the original consumer stops will be discarded.</p>\n"}], "owner": {"reputation": 2369, "user_id": 1500583, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/71020354a2fefbdadf424bd48c912515?s=128&d=identicon&r=PG", "display_name": "David McHealy", "link": "https://stackoverflow.com/users/1500583/david-mchealy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 39863504, "answer_count": 1, "score": 2, "last_activity_date": 1475626078, "creation_date": 1475590104, "question_id": 39854497, "link": "https://stackoverflow.com/questions/39854497/connecting-pipes-with-consumers-and-producers-that-return-different-values", "title": "Connecting Pipes with Consumers and Producers that return different values", "body": "<p>I am writing a  streaming function with the pipes ecosystem, and pipes-concurrency in particular, which is based on the operational library to allow me to quickly make little program snippets which I yield commands to a server over the network or to the stdin/out of a shell command and then read back the response.  In this case it is asterisk, but could be generalized to be anything similar.</p>\n\n<p>I initially wrote this with pipes in mind, but it doesn't work.  The reason the following code doesn't work is that astPipe returns a <code>Pipe _ _ IO a</code>, whereas both i and o, from pipes-concurrency both return <code>Consumer/Producer _ IO ()</code>.  I thought about having <code>astPipe</code> yield <code>Maybe ByteString</code>, and then making the output <code>Consumer</code> consume <code>Maybe ByteString</code>, but that still doesn't solve the problem of the <code>Producer</code> returning <code>()</code>.</p>\n\n<p>I feel like I'm really close to a solution, but I can't quite eek it out.  You should be able to just run stack on this file to replicate.</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-6.20 runghc --package pipes  --package pipes-concurrency  --package operational --package process-streaming\n\n{-# LANGUAGE OverloadedStrings, LambdaCase #-}\n{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE GADTs #-}\nmodule West.Asterisk where\n\nimport System.Process.Streaming as PS\nimport Control.Monad.Operational as Op\n\nimport Pipes as P\nimport Pipes.Concurrent as PC;\n\nimport qualified Data.ByteString.Char8 as B\n\nimport Control.Concurrent.Async\n\nimport GHC.IO.Exception (ExitCode)\n\ndata Version = Version String\ndata Channels = Channels\n\ndata AsteriskInstruction a where\n    Login :: AsteriskInstruction (Maybe Version)\n    CoreShowChannels :: AsteriskInstruction (Maybe Channels)\n\ntype Asterisk a = Program AsteriskInstruction a\n\nrunAsterisk :: forall a. Asterisk a -&gt; IO a\nrunAsterisk m = \n  let\n\n    runAsterisk' :: Producer B.ByteString {- TODO Response -} IO () -&gt; Consumer B.ByteString IO () -&gt; Asterisk a -&gt; IO a\n    runAsterisk' i o m' = runEffect $ i &gt;-&gt; astPipe m' &gt;-&gt; o\n      where\n        astPipe :: Asterisk a -&gt; Pipe B.ByteString B.ByteString IO a\n        astPipe k = \n          case Op.view m' of\n\n            Return a -&gt; return a\n\n            Login :&gt;&gt;= k -&gt; do\n              yield logincmd\n              resp &lt;- await -- :: Response\n              let v = undefined resp :: Maybe Version\n              astPipe (k v)\n\n            CoreShowChannels :&gt;&gt;= k -&gt; do\n              yield coreshowchannelscmd\n              resp &lt;- await\n              let c = undefined resp :: Maybe Channels\n              astPipe (k c)\n\n  in do\n    withSpawn unbounded $ \\(out1, in1) -&gt; do\n        async $ asteriskManager (fromInput in1) (toOutput out1)\n        runAsterisk' (fromInput in1) (toOutput out1) m \n\nasteriskManager :: Producer B.ByteString IO () -&gt; Consumer B.ByteString IO () -&gt; IO ExitCode\nasteriskManager prod cons = do\n  let ssh = shell \"nc someserver 5038\"\n  execute (piped ssh) (foldOut (withConsumer cons) *&gt; feedProducer prod *&gt; exitCode)\n\n\nlogincmd, coreshowchannelscmd :: B.ByteString\nlogincmd = \"action: login\\nusername: username\\nsecret: pass\\nevents: off\\n\\n\"\ncoreshowchannelscmd = \"action: coreshowchannels\\n\\n\"\n</code></pre>\n\n<p>The error:</p>\n\n<pre><code>  Blah.hs:38:45:\n    Couldn't match type \u2018a\u2019 with \u2018()\u2019\n      \u2018a\u2019 is a rigid type variable bound by\n          the type signature for runAsterisk :: Asterisk a -&gt; IO a\n          at Blah.hs:33:23\n    Expected type: Proxy () B.ByteString () B.ByteString IO ()\n      Actual type: Pipe B.ByteString B.ByteString IO a\n    Relevant bindings include\n      astPipe :: Asterisk a -&gt; Pipe B.ByteString B.ByteString IO a\n        (bound at Blah.hs:41:9)\n      m' :: Asterisk a (bound at Blah.hs:38:22)\n      runAsterisk' :: Producer B.ByteString IO ()\n                      -&gt; Consumer B.ByteString IO () -&gt; Asterisk a -&gt; IO a\n        (bound at Blah.hs:38:5)\n      m :: Asterisk a (bound at Blah.hs:34:13)\n      runAsterisk :: Asterisk a -&gt; IO a (bound at Blah.hs:34:1)\n    In the second argument of \u2018(&gt;-&gt;)\u2019, namely \u2018astPipe m'\u2019\n    In the first argument of \u2018(&gt;-&gt;)\u2019, namely \u2018i &gt;-&gt; astPipe m'\u2019\n</code></pre>\n"}, {"tags": ["haskell", "random", "monad-transformers"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1475587026, "post_id": 39852329, "comment_id": 66994517, "body": "Mmm, what &quot;better way&quot; are you thinking of? There&#39;s nothing inherently random in <code>ST</code> itself as far as I&#39;m concerned. AFAIK there are three ways to &quot;unpack&quot; an <code>RVal</code> and those are <code>runRVar</code>, <code>sampleRVar</code> and <code>sampleState</code>. If your <code>ST</code> can somehow provide <code>MonadRandom</code> instance, you can use the 2nd one."}, {"owner": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1475601495, "post_id": 39852329, "comment_id": 67004356, "body": "I would not expect this to be legal.  <code>ST</code> is supposed to be deterministic after you run it; randomness violates that."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "reply_to_user": {"reputation": 171740, "user_id": 869736, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/671f732e3c68c387c702112a30e5ebd8?s=128&d=identicon&r=PG&f=1", "display_name": "Louis Wasserman", "link": "https://stackoverflow.com/users/869736/louis-wasserman"}, "edited": false, "score": 1, "creation_date": 1475603650, "post_id": 39852329, "comment_id": 67005450, "body": "@LouisWasserman of course you&#39;d first need to introduce a seed somehow, after that it&#39;s perfectly deterministic."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 0, "creation_date": 1475617532, "post_id": 39852329, "comment_id": 67012550, "body": "I&#39;d try to equip <a href=\"https://hackage.haskell.org/package/MonadPrompt-1.0.0.5/docs/Control-Monad-Prompt.html#t:PromptT\" rel=\"nofollow noreferrer\"><code>PromptT</code></a> and <a href=\"https://hackage.haskell.org/package/rvar-0.2.0.3/docs/Data-RVar.html#t:RVarT\" rel=\"nofollow noreferrer\"><code>RVarT</code></a> with <a href=\"https://hackage.haskell.org/package/mmorph-1.0.6/docs/Control-Monad-Morph.html#t:MFunctor\" rel=\"nofollow noreferrer\"><code>MFunctor</code></a> and <a href=\"https://hackage.haskell.org/package/primitive-0.6.1.0/docs/Control-Monad-Primitive.html\" rel=\"nofollow noreferrer\"><code>PrimMonad</code></a> instances (there are no obvious obstacles), then <code>hoist lift ranfu</code> into <code>RVarT ST</code>."}], "answers": [{"tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": true, "score": 1, "last_activity_date": 1475587626, "creation_date": 1475587626, "answer_id": 39853615, "question_id": 39852329, "link": "https://stackoverflow.com/questions/39852329/how-to-sample-random-values-in-an-st-monad/39853615#39853615", "title": "How to sample random values in an ST monad?", "body": "<p>The simplest way is probably to use the <code>RandomSource</code> instance for <code>ST</code> in <a href=\"http://hackage.haskell.org/package/random-source-0.3.0.6/docs/Data-Random-Source-MWC.html\" rel=\"nofollow\"><code>Data.Random.Source.MWC</code></a>:</p>\n\n<pre><code>import Data.Random.Source.MWC\n\nsample :: [Bool]\nsample = runST $ do\n  g &lt;- create\n  stTrav (\\i -&gt; runRVar ranfu g)\n</code></pre>\n"}], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 1, "accepted_answer_id": 39853615, "answer_count": 1, "score": 2, "last_activity_date": 1475587626, "creation_date": 1475584004, "last_edit_date": 1475587352, "question_id": 39852329, "link": "https://stackoverflow.com/questions/39852329/how-to-sample-random-values-in-an-st-monad", "title": "How to sample random values in an ST monad?", "body": "<p>If I have a random value generator in the <a href=\"http://hackage.haskell.org/package/random-fu-0.2.7.0/docs/Data-Random.html#t:RVar\" rel=\"nofollow\"><code>RVar</code></a> monad</p>\n\n<pre><code>ranfu :: RVar Bool\n</code></pre>\n\n<p>and a higher-order  function that does some kind of traversal in (e.g.) the <code>ST</code> monad</p>\n\n<pre><code>stTrav :: PrimMonad m =&gt; (Int -&gt; m b) -&gt; m [b]\n</code></pre>\n\n<p>then how could I use <code>ranfu</code> in the loop of this traversal? Do I need to channel the state of the <code>RVar</code> through an <code>STRef</code>, or is there a better way?</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1475577967, "post_id": 39850051, "comment_id": 66988390, "body": "This has nothing to do with indentation, <code>where</code> is just not allowed here by the syntax. Normally you use <code>where</code> in bindings (<code>a = b where c</code>) whereas <code>then</code>-clause requires an expression. Use <code>let...in</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 1, "creation_date": 1475580225, "post_id": 39850051, "comment_id": 66989837, "body": "@n.m.You should make that as an answer."}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1475588397, "post_id": 39850051, "comment_id": 66995501, "body": "Strictly speaking, it isn&#39;t <i>GHC</i> that makes the indentation rules, it&#39;s the Haskell language specification..."}], "answers": [{"tags": [], "owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "is_accepted": false, "score": 4, "last_activity_date": 1475581631, "creation_date": 1475581631, "answer_id": 39851488, "question_id": 39850051, "link": "https://stackoverflow.com/questions/39850051/error-parse-error-on-input-where/39851488#39851488", "title": "error: parse error on input \u2018where\u2019", "body": "<p>Regardless of indentation, <code>where</code> is not allowed at this syntactic position.</p>\n\n<p>Normally the <code>where</code> clause is allowed in <em>bindings</em> that look like <code>a = b where c</code>. Formally, according to the <a href=\"https://www.haskell.org/onlinereport/haskell2010/haskellch4.html#x10-830004.4.3\" rel=\"nofollow\">language report</a>, <code>where</code> is a part of <em>rhs</em> (which stands for \"right-hand side (of a declaration/binding)\", and <em>rhs</em> is defined like this:</p>\n\n<blockquote>\n  <p><em>rhs</em> \u2192 = <em>exp</em> [<strong>where</strong> <em>decls</em>]<br>\n  &nbsp; &nbsp; &nbsp; &nbsp; | <em>gdrhs</em> [<strong>where</strong> <em>decls</em>]</p>\n</blockquote>\n\n<p>and <em>gdrhs</em> is the guarded right-hand side which is defined as</p>\n\n<blockquote>\n  <p><em>gdrhs</em> \u2192 <em>guards</em> = <em>exp</em> [<em>gdrhs</em>]</p>\n</blockquote>\n\n<p>So <code>where</code> can only be used when using <code>=</code>, that is, making a binding.</p>\n\n<p>(There are other kinds of <code>where</code> clauses: in a module, in class/instance definitions, in GADT definitions, but those are only tangentially related).</p>\n\n<p>In an expression, use <code>let ... in</code>:</p>\n\n<pre><code>let list = ((head (fib (n-1)) + head (fib (n-2))) : fib (n-1))\nin  reverse list\n</code></pre>\n\n<p>or just straight</p>\n\n<pre><code>reverse ((head (fib (n-1)) + head (fib (n-2))) : fib (n-1))\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 6368959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b93461c76d260210258aec3817cbb10b?s=128&d=identicon&r=PG&f=1", "display_name": "William", "link": "https://stackoverflow.com/users/6368959/william"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1520, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475881279, "creation_date": 1475577273, "last_edit_date": 1475881279, "question_id": 39850051, "link": "https://stackoverflow.com/questions/39850051/error-parse-error-on-input-where", "title": "error: parse error on input \u2018where\u2019", "body": "<p>Struggling to understand the GHC compiler and it's mysterious indentation rules but unfortunately this block of code refuses to compile</p>\n\n<p>Sorry I know this question has been asked before but just can't get this code to compile</p>\n\n<pre><code>fib :: Int -&gt; [Int] \nfib 1 = [1]\nfib 2 = [1,1]\nfib n =\n   if n &gt; 1\n     then \n         reverse list \n          where\n           list = ((head (fib (n-1)) + head (fib (n-2))) : fib (n-1))\n    else\n        error \"Exception, n cannot be less than 0\"\n</code></pre>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 8237, "user_id": 2900502, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/R1OjD.jpg?s=128&g=1", "display_name": "Shersh", "link": "https://stackoverflow.com/users/2900502/shersh"}, "edited": false, "score": 1, "creation_date": 1475583338, "post_id": 39848577, "comment_id": 66991859, "body": "Actually you don&#39;t need to specify <code>--package</code> option. You can write just <code>stack ghci lens mtl</code>"}, {"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1504630360, "post_id": 39848577, "comment_id": 79080115, "body": "I wasn&#39;t able to load the <code>matrix</code> package without specifying the <code>--package</code> option. I had to write properly like <code>stack ghci --package matrix</code> fyi."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 2, "creation_date": 1504632234, "post_id": 39848577, "comment_id": 79080996, "body": "@Redu You are right, I have updated the answer. That only works when the package is already registred with your package database, in which case just <code>stack ghci</code> also works."}, {"owner": {"reputation": 208473, "user_id": 126014, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/33526616d4a11f1630d4939b769cfbf9?s=128&d=identicon&r=PG", "display_name": "Mark Seemann", "link": "https://stackoverflow.com/users/126014/mark-seemann"}, "edited": false, "score": 0, "creation_date": 1533300888, "post_id": 39848577, "comment_id": 90308809, "body": "If you need a specific version of the package, something like this worked for me: <code>$ stack ghci --package containers-0.6.0.1</code>"}, {"owner": {"reputation": 113, "user_id": 1663197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7c055b7bb6a0bbbbd3e71fd90e1a346?s=128&d=identicon&r=PG", "display_name": "AleXoundOS", "link": "https://stackoverflow.com/users/1663197/alexoundos"}, "edited": false, "score": 1, "creation_date": 1593964373, "post_id": 39848577, "comment_id": 110954402, "body": "Also, you can load a package on-the-fly while inside stack ghci using <code>:set -package pretty-simple</code>."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 113, "user_id": 1663197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7c055b7bb6a0bbbbd3e71fd90e1a346?s=128&d=identicon&r=PG", "display_name": "AleXoundOS", "link": "https://stackoverflow.com/users/1663197/alexoundos"}, "edited": false, "score": 1, "creation_date": 1594005211, "post_id": 39848577, "comment_id": 110964630, "body": "@AleXoundOS That only works, if your package is already registred with your local package database. If not, it doesn&#39;t work. Example:  ``` \u03bb&gt; :set -package pretty-simple cannot satisfy -package pretty-simple     (use -v for more information) ```"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": true, "score": 25, "last_activity_date": 1504632186, "last_edit_date": 1504632186, "creation_date": 1475572821, "answer_id": 39848577, "question_id": 39848576, "link": "https://stackoverflow.com/questions/39848576/load-a-new-package-in-ghci-using-stack/39848577#39848577", "title": "Load a new package in ghci using stack", "body": "<p>For the packages present in Stackage,</p>\n\n<pre><code>$ stack ghci --package unix-time\n</code></pre>\n\n<p>And this will give you a repl with the package <code>unix-time</code> loaded in it:</p>\n\n<pre><code>Run from outside a project, using implicit global project config\nUsing resolver: lts-6.14 from implicit global project's config file: /home/sibi/.stack/global-project/stack.yaml\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\n\u03bb&gt; import Data.UnixTime\n\u03bb&gt; :t getUnixTime\ngetUnixTime :: IO UnixTime\n</code></pre>\n\n<p>For multiple packages:</p>\n\n<pre><code>$ stack ghci --package unix-time --package download\nRun from outside a project, using implicit global project config\nUsing resolver: lts-6.14 from implicit global project's config file: /home/sibi/.stack/global-project/stack.yaml\ntagsoup-0.13.10: using precompiled package\nxml-1.3.14: using precompiled package\ntime-locale-compat-0.1.1.3: using precompiled package\nfeed-0.3.11.1: download\nfeed-0.3.11.1: configure\nfeed-0.3.11.1: build\nfeed-0.3.11.1: copy/register\ndownload-0.3.2.4: download\ndownload-0.3.2.4: configure\ndownload-0.3.2.4: build\ndownload-0.3.2.4: copy/register\nCompleted 5 action(s).\nConfiguring GHCi with the following packages:\nGHCi, version 7.10.3: http://www.haskell.org/ghc/  :? for help\nOk, modules loaded: none.\n\u03bb&gt; import Network.Download\n\u03bb&gt;\n</code></pre>\n"}], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2823, "favorite_count": 2, "accepted_answer_id": 39848577, "answer_count": 1, "score": 14, "last_activity_date": 1504632186, "creation_date": 1475572821, "question_id": 39848576, "link": "https://stackoverflow.com/questions/39848576/load-a-new-package-in-ghci-using-stack", "title": "Load a new package in ghci using stack", "body": "<p>Is there a way to load a package(s) using Stack in GHCI and play around with it ?</p>\n\n<p>So, that when the <code>ghci</code> is loaded, we can import the modules and see it's type signature, etc.</p>\n"}, {"tags": ["haskell", "types"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1475581665, "post_id": 39848495, "comment_id": 66990741, "body": "Don&#39;t add new questions to an existing post. That said, <code>Example a</code> is an example of the use of a <a href=\"https://wiki.haskell.org/Phantom_type\" rel=\"nofollow noreferrer\">phantom type</a>."}], "answers": [{"comments": [{"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1475576240, "post_id": 39848773, "comment_id": 66987436, "body": "How can I change this newtype declaration into a normal function declaration?"}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1475576387, "post_id": 39848773, "comment_id": 66987503, "body": "@barbrac Do you mean a function declaration or regular type alias? If the latter, simply use <code>type</code>."}, {"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1475584226, "post_id": 39848773, "comment_id": 66992487, "body": "@barbrac this is how the question should look like from the start. Please avoid making edits that substantially change the scope of the Q/A."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": false, "score": 5, "last_activity_date": 1475573402, "creation_date": 1475573402, "answer_id": 39848773, "question_id": 39848495, "link": "https://stackoverflow.com/questions/39848495/new-type-declaring-functions/39848773#39848773", "title": "New type declaring functions?", "body": "<blockquote>\n  <p>This appears to be a function declaration? </p>\n</blockquote>\n\n<p>Yes. Specifically, <code>String -&gt; [(a,String)]</code> is a function type. A <code>newtype</code> declaration is analogous to a simple wrapper around any given type. There's no restriction that says you can't make it based on a function type, and it works in exactly the same way.</p>\n\n<p>Also remember that you can <em>always</em> replace <code>newtype</code> with <code>data</code>; in this case, thinking about the resulting type as a record type that has a field that is a function might be helpful; <code>newtype</code> is just a special, optimized case.</p>\n\n<hr>\n\n<p>One other thing to mention is that your two lines also differ in that the second one is parametrized over <code>a</code>. This can of course be used with regular types:</p>\n\n<pre><code>newtype MyWrapper a = MyWrapper a\n</code></pre>\n\n<p>or a function type can be <code>newtype</code>-d without parametrisation</p>\n\n<pre><code>newtype MyFunction = MyFunction (Float -&gt; Float)\n</code></pre>\n\n<p>You can also write the above using the record syntax that gives you the \"getter\" function as well.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1475577806, "creation_date": 1475572576, "last_edit_date": 1475577806, "question_id": 39848495, "link": "https://stackoverflow.com/questions/39848495/new-type-declaring-functions", "title": "New type declaring functions?", "body": "<p>I'm familiar with the newtype declaration:</p>\n\n<pre><code>newtype MyAge = Age {age :: Int} deriving (Show, Eq, Ord)\n</code></pre>\n\n<p>In this instance Age is an Int, however I've come across the code below and I can't understand it:</p>\n\n<pre><code>newtype Ages a = Ages {age :: String -&gt; [(a,String)]}\n</code></pre>\n\n<p>This appears to be a function declaration? (takes string, returns list of tuples containing 'a' and string) - is this correct?</p>\n\n<p>N.B I've just realized this is just basic record syntax to declare a function.</p>\n\n<p><strong>Additionally</strong>, I've tried to implement this type, but I must be doing something wrong:</p>\n\n<pre><code>newtype Example a = Example {ex :: Int -&gt; Int}\n\nmyexample = Example {ex = (\\x -&gt; x + 1)}\n</code></pre>\n\n<p>This compiles, however I don't understand why as I haven't passed the 'a' parameter?</p>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475605249, "post_id": 39845112, "comment_id": 67006253, "body": "&quot;This definition is equivalent to yours&quot;, except that it requires only a linear number of calls to <code>f</code>, whereas the OP&#39;s implementation has a worst-case exponential number of calls to <code>f</code>..."}], "tags": [], "owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "is_accepted": false, "score": 2, "last_activity_date": 1475605304, "last_edit_date": 1475605304, "creation_date": 1475560729, "answer_id": 39845112, "question_id": 39844986, "link": "https://stackoverflow.com/questions/39844986/can-someone-explain-how-the-code-below-works/39845112#39845112", "title": "Can someone explain how the code below works?", "body": "<p>Basically you traverse the entire list until you hit a single element, x (first line). Since x is the only element, it must be the maxiumum.</p>\n\n<p>Now you go backwards and check every element y against x: If y is greater than x (first case) then you continue with y as your maximum, otherwise you keep x (second case).</p>\n\n<p>Instead of using your definition with the if-clause I will use <code>maxBy</code> to illustrate this:</p>\n\n<pre><code>maximumBy f [x] = x\nmaximumBy f (x:xs) = maxBy f x (maximumBy f xs)\n\nmaxBy f x y | f x y == GT = x\n            | otherwise   = y\n</code></pre>\n\n<p>This definition is equivalent to yours.</p>\n\n<p>Example:</p>\n\n<pre><code>maximumBy (comparing abs) [2,5,-3,1]\n== maxBy (comparing abs) 2 (maxBy (comparing abs) 5 (maxBy (comparing abs) -3 (maximumBy (comparing abs) [1])))\n== maxBy (comparing abs) 2 (maxBy (comparing abs) 5 (maxBy (comparing abs) -3 1))\n== maxBy (comparing abs) 2 (maxBy (comparing abs) 5 -3)\n== maxBy (comparing abs) 2 5\n== 5\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 4483177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cffee33bb27f0cd1eaccd6579fac5a76?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremy Chen", "link": "https://stackoverflow.com/users/4483177/jeremy-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1475605304, "creation_date": 1475560152, "last_edit_date": 1475561181, "question_id": 39844986, "link": "https://stackoverflow.com/questions/39844986/can-someone-explain-how-the-code-below-works", "title": "Can someone explain how the code below works?", "body": "<p>I can't figure out how two recursions(myMaximumBy) work together, and I'm trying to draw diagram on paper but I'm stuck. For example, myMaximumBy compare [1, 5, 2, 4, 3]</p>\n\n<pre><code>myMaximumBy :: (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; a\nmyMaximumBy _ (x:[]) = x\nmyMaximumBy f (x:xs) = if (f x (myMaximumBy f xs)) == GT then x else (myMaximumBy f xs)\n</code></pre>\n"}, {"tags": ["haskell", "pattern-matching"], "answers": [{"comments": [{"owner": {"reputation": 1690, "user_id": 5691928, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/pm6iL.jpg?s=128&g=1", "display_name": "Ratan Senapathy", "link": "https://stackoverflow.com/users/5691928/ratan-senapathy"}, "edited": false, "score": 0, "creation_date": 1475633725, "post_id": 39845392, "comment_id": 67016688, "body": "Is JuicyPixels better. Where can I find proprer documentation for it?"}, {"owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "reply_to_user": {"reputation": 1690, "user_id": 5691928, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/pm6iL.jpg?s=128&g=1", "display_name": "Ratan Senapathy", "link": "https://stackoverflow.com/users/5691928/ratan-senapathy"}, "edited": false, "score": 0, "creation_date": 1475677725, "post_id": 39845392, "comment_id": 67040066, "body": "Sorry, my English was broken. What I want to say in parenthesis that I guess you have used <code>JuicyPixels</code>, but you didn&#39;t indicate it in your question. There was <code>Codec.Picture</code>, but its name could be taken by any other packages. Is this what you wants to ask?"}], "tags": [], "owner": {"reputation": 480, "user_id": 4688042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/07539504725306ff45b0e9c09e3e2699?s=128&d=identicon&r=PG", "display_name": "QuietJoon", "link": "https://stackoverflow.com/users/4688042/quietjoon"}, "is_accepted": true, "score": 5, "last_activity_date": 1475678140, "last_edit_date": 1475678140, "creation_date": 1475562068, "answer_id": 39845392, "question_id": 39844971, "link": "https://stackoverflow.com/questions/39844971/trying-to-perform-haskell-pattern-matching-on-constructor-value/39845392#39845392", "title": "Trying to perform haskell pattern matching on Constructor value", "body": "<p>You may concern the return type of the function <code>getImage</code>.  (I think you may has used the package <code>JuicyPixels</code>. You may describe the package name instead of the module...)</p>\n\n<p>Let see the definition of data type:</p>\n\n<pre><code>ImageY8 (Image Pixel8)\nImageY16 (Image Pixel16)\n</code></pre>\n\n<p>You can see that the return type of <code>getImage (ImageY8 image)</code> and <code>getImage (ImageY16 image)</code> is different. The former is <code>Image Pixel8</code> and the latter is <code>Image Pixel16</code>.<br>\nTherefore, the type signature of former function is <code>DynamicImage -&gt; Image Pixel8</code> and the latter is <code>DynamicImage -&gt; Image Pixel16</code>.\nAs you know, one function could not have different type signatures.</p>\n\n<p>You have to rename these <strong>two</strong> different functions for each type signature.</p>\n"}, {"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 4, "last_activity_date": 1475562088, "creation_date": 1475562088, "answer_id": 39845399, "question_id": 39844971, "link": "https://stackoverflow.com/questions/39844971/trying-to-perform-haskell-pattern-matching-on-constructor-value/39845399#39845399", "title": "Trying to perform haskell pattern matching on Constructor value", "body": "<p>What would you expect the type of <code>getImage</code> to be? The compiler is complaining because one equation has the type <code>DynamicImage -&gt; Image Pixel8</code> and the other has type <code>DynamicImage -&gt; Image Pixel16</code>, and these types don\u2019t match.</p>\n\n<p>The reason you can write:</p>\n\n<pre><code>area (Circle r) = \u2026\narea (Rectangle a b) = \u2026\n</code></pre>\n\n<p>Is because both equations have type <code>Shape -&gt; Float</code>.</p>\n"}], "owner": {"reputation": 1690, "user_id": 5691928, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/pm6iL.jpg?s=128&g=1", "display_name": "Ratan Senapathy", "link": "https://stackoverflow.com/users/5691928/ratan-senapathy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 39845392, "answer_count": 2, "score": 1, "last_activity_date": 1475678140, "creation_date": 1475560099, "last_edit_date": 1475582226, "question_id": 39844971, "link": "https://stackoverflow.com/questions/39844971/trying-to-perform-haskell-pattern-matching-on-constructor-value", "title": "Trying to perform haskell pattern matching on Constructor value", "body": "<p>I have a function getImage which takes an input of type DynamicImage and changes it into an image. The function is as follows</p>\n\n<pre><code>getImage (ImageY8 image) = image \ngetImage (ImageY16 image) = image\n</code></pre>\n\n<p>The above definitions are from the Codec.Picture module. But it gives me an error:</p>\n\n<pre><code>Couldn't match type \u2018GHC.Word.Word16\u2019 with \u2018GHC.Word.Word8\u2019\n    Expected type: Image Pixel8\n      Actual type: Image Pixel16\n    In the expression: image\n    In an equation for \u2018getImage\u2019: getImage (ImageY16 image) = image\nFailed, modules loaded: none.\n</code></pre>\n\n<p>Why is this not working as I can do the following:</p>\n\n<pre><code>data Shape = Circle Float | Rectangle Float Float\n\narea (Circle r) = 3.14 * r * r\narea (Rectangle a b) = a * b\n</code></pre>\n\n<p>which is similar to my question. </p>\n"}, {"tags": ["haskell", "matrix"], "answers": [{"tags": [], "owner": {"reputation": 3385, "user_id": 841562, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4cbb35380ef84f4f0f68061f578a4e73?s=128&d=identicon&r=PG", "display_name": "Lemming", "link": "https://stackoverflow.com/users/841562/lemming"}, "is_accepted": true, "score": 2, "last_activity_date": 1475566673, "creation_date": 1475566673, "answer_id": 39846722, "question_id": 39843638, "link": "https://stackoverflow.com/questions/39843638/haskell-convert-between-matrix-types/39846722#39846722", "title": "Haskell - Convert between matrix types", "body": "<p>It depends on how you want to round the values.\nIf you want to round to the nearest integer, then you can use <code>cmap round</code>:</p>\n\n<pre><code>\u03bb&gt; cmap round $ conv2 ((3&gt;&lt;3)[1..]) ((1&gt;&lt;1)[1.1 :: R]) :: Matrix Z\n(3&gt;&lt;3)\n [ 1, 2,  3\n , 4, 6,  7\n , 8, 9, 10 ]\n</code></pre>\n\n<p><code>cmap</code> has the following signature:</p>\n\n<pre><code>cmap :: (Element b, Container c e) =&gt; (e -&gt; b) -&gt; c e -&gt; c b\n</code></pre>\n\n<p>Which means it's like <code>fmap</code> only constrained to types that can be held by hmatrix containers.</p>\n\n<p>If, instead, you want to crop the decimals, you can use <code>toZ</code>:</p>\n\n<pre><code>\u03bb&gt; toZ $ conv2 ((3&gt;&lt;3)[1..]) ((1&gt;&lt;1)[1.1 :: R]) :: Matrix Z\n(3&gt;&lt;3)\n [ 1, 2, 3\n , 4, 5, 6\n , 7, 8, 9 ]\n</code></pre>\n\n<p><code>toZ</code> has the following signature:</p>\n\n<pre><code>toZ :: Container c e =&gt; c e -&gt; c Z\n</code></pre>\n\n<p>Which means it will convert anything to a container of <code>Z</code>. It does so by cropping the decimals.</p>\n"}], "owner": {"reputation": 2784, "user_id": 3160197, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d8e8d0d86e3cb6b4e6d201c2ea206dd0?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3160197/alon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 39846722, "answer_count": 1, "score": 0, "last_activity_date": 1475566673, "creation_date": 1475551303, "last_edit_date": 1475555509, "question_id": 39843638, "link": "https://stackoverflow.com/questions/39843638/haskell-convert-between-matrix-types", "title": "Haskell - Convert between matrix types", "body": "<p>I am using the <code>Numeric.LinearAlgebra</code> library. This is my code:</p>\n\n<pre><code>customConv :: Matrix Z\ncustomConv = conv2 ((3&gt;&lt;3)[1..]) ((1&gt;&lt;1)[1.1]) \n</code></pre>\n\n<p>My problem is that I want that the output will be from type <code>Matrix Z</code>.</p>\n\n<p>Now the type is not <code>Z</code> because the conv is with 1.1</p>\n\n<p>Is there any function to round all the values of the matrix and make it from this type?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 2, "creation_date": 1475550477, "post_id": 39843527, "comment_id": 66976511, "body": "Why should it result in <code>LT</code>?"}, {"owner": {"reputation": 56659, "user_id": 450128, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2f72b3fdc99fe9fd1bbeb2f9da1d2c0a?s=128&d=identicon&r=PG", "display_name": "Ben", "link": "https://stackoverflow.com/users/450128/ben"}, "edited": false, "score": 3, "creation_date": 1475551963, "post_id": 39843527, "comment_id": 66976857, "body": "Please put the actual code you&#39;re running directly in the question. Links can provide helpful context, but it should be possible to understand and answer your question without following the link."}], "answers": [{"tags": [], "owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "is_accepted": false, "score": 2, "last_activity_date": 1475551982, "creation_date": 1475551982, "answer_id": 39843723, "question_id": 39843527, "link": "https://stackoverflow.com/questions/39843527/is-there-any-curried-changes-on-haskell/39843723#39843723", "title": "Is there any curried change&#39;s on haskell?", "body": "<p><code>compareWithHundred</code> is the same as <code>compare 100</code>, so<br>\n<code>compareWithHundred 9</code> is the same as <code>(compare 100) 9</code>,<br>\nwhich is GT because 100 > 9.</p>\n"}], "owner": {"reputation": 1, "user_id": 6918572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86caa6336afbd63b4bdd869f54270f44?s=128&d=identicon&r=PG&f=1", "display_name": "Joss Ca", "link": "https://stackoverflow.com/users/6918572/joss-ca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475551982, "creation_date": 1475550293, "question_id": 39843527, "link": "https://stackoverflow.com/questions/39843527/is-there-any-curried-changes-on-haskell", "title": "Is there any curried change&#39;s on haskell?", "body": "<p>Im studying from a book curried on haskell and I read that If I use this partially applying function with 9 it should results LT, but is GT as u can see. I also used 800 to prove that. If I'm understanding in a bad way pls correct me.</p>\n\n<p><a href=\"http://i.stack.imgur.com/cnswB.png\" rel=\"nofollow\">Curried example of compare function</a></p>\n\n<p>Thanks a lot.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "edited": false, "score": 0, "creation_date": 1475552530, "post_id": 39843195, "comment_id": 66977001, "body": "Technically, <code>modus_ponens</code> would have the type <code>(p -&gt; q, p) -&gt; q</code> (or your <code>(p -&gt; q) &#47;\\ p -&gt; q</code>), but obviously your definition is equivalent by currying."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475566297, "post_id": 39843195, "comment_id": 66981763, "body": "When you get stuck like in this case, it&#39;s possible you found a classical tautology which is not an intuitionistic one. In such case, a possible strategy is starting to apply <code>excluded_middle</code> on some (possibly all) propositional variables. If done on all, this essentially amounts to building the full truth table -- inefficient and boring, but effective."}], "answers": [{"tags": [], "owner": {"reputation": 10971, "user_id": 3575047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a1820d77e8fbadfc9800df2b21efcd46?s=128&d=identicon&r=PG&f=1", "display_name": "Fengyang Wang", "link": "https://stackoverflow.com/users/3575047/fengyang-wang"}, "is_accepted": true, "score": 6, "last_activity_date": 1475551771, "last_edit_date": 1475551771, "creation_date": 1475549859, "answer_id": 39843461, "question_id": 39843195, "link": "https://stackoverflow.com/questions/39843195/prove-the-transposition-theorem/39843461#39843461", "title": "Prove the Transposition Theorem", "body": "<p>You rightfully note that</p>\n\n<pre><code>-- There is no way to prove this axiom in constructive logic, therefore we\n-- leave it admitted\nexcluded_middle :: p \\/ Not p\nexcluded_middle = admit\n</code></pre>\n\n<p>In fact, the following are equivalent axioms when added to constructive logic:</p>\n\n<ul>\n<li>Law of Excluded Middle</li>\n<li>Double Negation</li>\n<li>Law of Contrapositive (what you've called the Transposition Theorem)</li>\n<li>Peirce's law</li>\n</ul>\n\n<p>Therefore, you need to use the axiom that you've admitted (the LEM) in your proof of double negation. We may apply LEM to obtain <code>p \\/ Not p</code>. Then, apply casework on this disjunction. In case <code>Left p</code>, it is easy to show <code>Not (Not p) -&gt; p</code>. In case <code>Right q</code>, we use <code>Not (Not p)</code> to arrive at <code>False</code>, from which we can conclude <code>p</code>.</p>\n\n<p>To wit, this is the part you're missing:</p>\n\n<pre><code>double_negation_rev :: Not (Not p) -&gt; p\ndouble_negation_rev = \\nnp -&gt; case excluded_middle of\n    Left p -&gt; p\n    Right q -&gt; absurd (nnp q)\n</code></pre>\n"}], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 2, "accepted_answer_id": 39843461, "answer_count": 1, "score": 13, "last_activity_date": 1475551771, "creation_date": 1475547466, "last_edit_date": 1475549541, "question_id": 39843195, "link": "https://stackoverflow.com/questions/39843195/prove-the-transposition-theorem", "title": "Prove the Transposition Theorem", "body": "<p>I'm proving some theorems in Propositional Logic.</p>\n\n<p>Says, Modus Ponens, which states that <em>if P implies Q and P is true, then Q is true</em></p>\n\n<pre><code>P \u2192 Q\nP\n-----\nQ\n</code></pre>\n\n<p>would be interpreted in Haskell as</p>\n\n<pre><code>modus_ponens :: (p -&gt; q) -&gt; p -&gt; q\nmodus_ponens pq p = pq p\n</code></pre>\n\n<p>You might find it <em>types are equivalent to theorems and programs are equivalent to proofs</em>.</p>\n\n<p>Logical Disjunction</p>\n\n<pre><code>data p \\/ q = Left  p\n            | Right q\n</code></pre>\n\n<p>Logical Conjunction</p>\n\n<pre><code>data p /\\ q = Conj p q\n</code></pre>\n\n<p>If and only if</p>\n\n<pre><code>type p &lt;-&gt; q = (p -&gt; q) /\\ (q -&gt; p)\n</code></pre>\n\n<p>Admit is used to assume an axiom without proof</p>\n\n<pre><code>admit :: p\nadmit = admit\n</code></pre>\n\n<p>Now I am having trouble proving the Transposition Theorem:</p>\n\n<pre><code>(P \u2192 Q) \u2194 (\u00acQ \u2192 \u00acP)\n</code></pre>\n\n<p>which consists of 2 parts:</p>\n\n<p>left to right:</p>\n\n<pre><code>P \u2192 Q\n\u00acQ\n-----\n\u00acP\n</code></pre>\n\n<p>right to left:</p>\n\n<pre><code>\u00acQ \u2192 \u00acP\nP\n-------\nQ\n</code></pre>\n\n<p>I already proved the 1st part with <code>Modus tollens</code> but couldn't figure out a way for 2nd part:</p>\n\n<pre><code>transposition :: (p -&gt; q) &lt;-&gt; (Not q -&gt; Not p)\ntransposition = Conj left_right right_left\n                where left_right p_q not_q = modus_tollens p_q not_q\n                      right_left = admit\n\nmodus_tollens :: (p -&gt; q) -&gt; Not q -&gt; Not p\nmodus_tollens pq not_q = \\p -&gt; not_q $ pq p\n\ndouble_negation :: p &lt;-&gt; Not (Not p)\ndouble_negation = Conj (\\p not_p -&gt; not_p p) admit\n</code></pre>\n\n<p>It seems that it could write as:</p>\n\n<pre><code>(\u00acQ) \u2192 (\u00acP)\n\u00ac(\u00acP)\n-----------\n\u00ac(\u00acQ)\n</code></pre>\n\n<p>But I have no idea how to do the negation (and maybe double negation) in this system.</p>\n\n<p>Could someone help me with that?</p>\n\n<hr>\n\n<p>Total program:</p>\n\n<pre><code>{-# LANGUAGE TypeOperators        #-}\n{-# LANGUAGE GADTs                #-}\n{-# LANGUAGE NoImplicitPrelude    #-}\n{-# LANGUAGE PolyKinds            #-}\n{-# LANGUAGE DataKinds            #-}\n{-# LANGUAGE TypeFamilies         #-}\n{-# OPTIONS_GHC -fwarn-incomplete-patterns #-}\n\nimport Prelude (Show(..), Eq(..), ($), (.), flip)\n\n-- Propositional Logic --------------------------------\n\n-- False, the uninhabited type\ndata False\n\n-- Logical Not\ntype Not p = p -&gt; False\n\n-- Logical Disjunction\ndata p \\/ q = Left  p\n            | Right q\n\n-- Logical Conjunction\ndata p /\\ q = Conj p q\n\n-- If and only if\ntype p &lt;-&gt; q = (p -&gt; q) /\\ (q -&gt; p)\n\n-- Admit is used to assume an axiom without proof\nadmit :: p\nadmit = admit\n\n-- There is no way to prove this axiom in constructive logic, therefore we\n-- leave it admitted\nexcluded_middle :: p \\/ Not p\nexcluded_middle = admit\n\nabsurd :: False -&gt; p\nabsurd false = admit\n\ndouble_negation :: p &lt;-&gt; Not (Not p)\ndouble_negation = Conj (\\p not_p -&gt; not_p p) admit\n\nmodus_ponens :: (p -&gt; q) -&gt; p -&gt; q\nmodus_ponens = ($)\n\nmodus_tollens :: (p -&gt; q) -&gt; Not q -&gt; Not p\nmodus_tollens pq not_q = \\p -&gt; not_q $ pq p\n\ntransposition :: (p -&gt; q) &lt;-&gt; (Not q -&gt; Not p)\ntransposition = Conj left_right right_left\n                where left_right = modus_tollens\n                      right_left = admit\n</code></pre>\n"}, {"tags": ["haskell"], "answers": [{"comments": [{"owner": {"reputation": 2784, "user_id": 3160197, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d8e8d0d86e3cb6b4e6d201c2ea206dd0?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3160197/alon"}, "edited": false, "score": 0, "creation_date": 1475523543, "post_id": 39839143, "comment_id": 66968046, "body": "Oh I get it.. Thanks"}], "tags": [], "owner": {"reputation": 62252, "user_id": 1435869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TrEd9.jpg?s=128&g=1", "display_name": "karakfa", "link": "https://stackoverflow.com/users/1435869/karakfa"}, "is_accepted": true, "score": 1, "last_activity_date": 1475523452, "creation_date": 1475523452, "answer_id": 39839143, "question_id": 39839037, "link": "https://stackoverflow.com/questions/39839037/insert-array-into-constructor-haskell/39839143#39839143", "title": "insert array into constructor Haskell", "body": "<p>hopefully, these will give some clues.  You should read more...</p>\n\n<pre><code>&gt; data SpecielNumber = SN Float Float Float deriving (Show)   \n&gt; let makeSN [x,y,z] = SN x y z\n\n&gt; makeSN [1.2,1.3,2.3]\nSN 1.2 1.3 2.3\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1475524006, "post_id": 39839184, "comment_id": 66968273, "body": "Half the answer discusses a minor aside on naming conventions. It would probably be sufficient to say &quot;It is common for a single data constructor to have the same same as the type constructor; the two are always distinguishable by context&quot; and leave it at that."}], "tags": [], "owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "is_accepted": false, "score": 3, "last_activity_date": 1475523593, "creation_date": 1475523593, "answer_id": 39839184, "question_id": 39839037, "link": "https://stackoverflow.com/questions/39839037/insert-array-into-constructor-haskell/39839184#39839184", "title": "insert array into constructor Haskell", "body": "<p>First, <code>[1.2, 1.3, 2.3]</code> is not an array, its a list.</p>\n\n<p>Second, your data type <code>SpecialNumber</code> needs a constructor name. So you can make it have a list in its constructor like this:</p>\n\n<pre><code>data SpecialNumber = SpecialNumber [Float]\n</code></pre>\n\n<p>The first <code>SpecialNumber</code> is the name of the type. The second is the name of the constructor. These are different name spaces. It is conventional to have the two match unless you are defining a type with different variants, like:</p>\n\n<pre><code>data Either a b = Left a | Right b\n</code></pre>\n\n<p>The <code>Left</code> and <code>Right</code> are alternative constructors, and the type is called <code>Either</code>.</p>\n"}], "owner": {"reputation": 2784, "user_id": 3160197, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d8e8d0d86e3cb6b4e6d201c2ea206dd0?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3160197/alon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 39839143, "answer_count": 2, "score": -1, "last_activity_date": 1475523593, "creation_date": 1475523003, "last_edit_date": 1475523522, "question_id": 39839037, "link": "https://stackoverflow.com/questions/39839037/insert-array-into-constructor-haskell", "title": "insert array into constructor Haskell", "body": "<p>I have a function that return array of this form</p>\n\n<pre><code>  [1.2,1.3,2.3]\n</code></pre>\n\n<p>and I created data:</p>\n\n<pre><code>data SpecielNumber = SP Float Float Float\n</code></pre>\n\n<p>How Can I from the <code>foo</code> function  that returns the number to Generate <code>SpecielNumber</code> ? </p>\n\n<p>something like this dont work :(</p>\n\n<pre><code>  x=[1.2,1.3,2.3]\n  SP x\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["python", "python-3.x", "haskell", "mandelbrot"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 2, "creation_date": 1475548615, "post_id": 39839033, "comment_id": 66976138, "body": "Do you understand the definition of the Mandelbrot set (mathematically, unrelated to Haskell)?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1475688028, "post_id": 39839033, "comment_id": 67046935, "body": "You should split the task into 2 parts. Step 1 is print an image with colour based on a simple function, such as the distance of each point in a plane from the origin, with the colour representing the distance. You can make an array of colour values, indexed by distance. For distances larger than the array length, take the <i>modulus</i> of the distance, so the colours used will wrap. Step 2 is to write a Mandelbrot implementation using the <i>iterations</i> at each point as the colour index. The <i>scale</i> of the x-y plane will be different, so you need to convert the pixel coordinates to the range &#177;2."}], "answers": [{"tags": [], "owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "is_accepted": true, "score": 0, "last_activity_date": 1475701447, "creation_date": 1475701447, "answer_id": 39883645, "question_id": 39839033, "link": "https://stackoverflow.com/questions/39839033/haskell-figuring-use-some-defined-function-to-draw-the-mandelbrot-need-explana/39883645#39883645", "title": "haskell, figuring use some defined function to draw the mandelbrot, need explanation", "body": "<p>I figure it out.</p>\n\n<p>So what I need to do is:</p>\n\n<pre><code>-- find all points using plane r\n-- using orbit list comprehension to take the orbit with one point at index i\n-- using norm(x,y) to calculate the distance of orbit to the original\n-- using find to give the list of char\n-- finally using sp to put character with 'n'\n-- all these stuff can using the list comprehension combine together.\n</code></pre>\n\n<p>Just for anyone who want to know how to solve this.</p>\n"}], "owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 39883645, "answer_count": 1, "score": 0, "last_activity_date": 1475701447, "creation_date": 1475522986, "last_edit_date": 1495540856, "question_id": 39839033, "link": "https://stackoverflow.com/questions/39839033/haskell-figuring-use-some-defined-function-to-draw-the-mandelbrot-need-explana", "title": "haskell, figuring use some defined function to draw the mandelbrot, need explanation", "body": "<p>I've write several function that need to used in function mandelbrot to draw it, here are these:</p>\n\n<pre><code># sp that takes integer n, element y, list xs. insert the specified element y after every n elements.\nsp 1 'a' ['b','c','d'] = ['b','a','c','a','d','a']\n\n# plane that gives (x/r,y/r) where x and y are int, -2&lt;x/r&lt;1,-1&lt;y/r&lt;1.\nplane 1 = [(-2.0,-1.0),(-1.0,-1.0),(0.0,-1.0),(1.0,-1.0),(-2.0,0.0),(-1.0,0.0),(0.0,0.0),(1.0,0.0),(-2.0,1.0),(-1.0,1.0),(0.0,1.0),(1.0,1.0)]\n</code></pre>\n\n<p># orbit, is the same in this question : <a href=\"https://stackoverflow.com/questions/39809592/haskell-infinite-recursion-in-list-comprehension\">Haskell infinite recursion in list comprehension</a></p>\n\n<pre><code>print(take 3 (orbit(2,1))) = [(2,1),(5,5),(2,51)]\n</code></pre>\n\n<p># find, is the same in this questionL <a href=\"https://stackoverflow.com/questions/39823833/haskell-recursive-function-that-return-the-char-in-a-tuple-list-with-certain-co\">haskell: recursive function that return the char in a tuple list with certain condition(compare)</a></p>\n\n<pre><code>print(find 0.4 [(0.15,'#'),(0.5,'x'),(1,'.')]) == 'x' ## &gt;all will print char ' '\n</code></pre>\n\n<p>So I'm trying to use sp,plane,orbit,and find,this four function with a new func named norm, that calculate the distances of points from the origin:</p>\n\n<pre><code>norm (x,y) = x*x + y*y\n</code></pre>\n\n<h2>Now is my question:</h2>\n\n<p>I'm little confused about what should do and why that, so I think I will first use plane to all the points, then use orbit  to print the list with the point? And after this, what should I do? Can anyone explain these relationship of each function and what I should do?</p>\n\n<p>Separate code or explanation are fine. The mandelbrot function should draw something that looks like mandelbrot contains '#' 'x' '.' and ' '.</p>\n"}, {"tags": ["haskell", "polymorphism", "monads"], "comments": [{"owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "edited": false, "score": 0, "creation_date": 1475508355, "post_id": 39835012, "comment_id": 66959709, "body": "monad is a collection of function.. i think you can not just substitute one code for another in binaries.. that would open all kinds of weird and security risks."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 3, "creation_date": 1475508678, "post_id": 39835012, "comment_id": 66959917, "body": "You should provide more details -- it&#39;s hard to guess here."}], "answers": [{"comments": [{"owner": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 0, "creation_date": 1475515750, "post_id": 39835215, "comment_id": 66963891, "body": "Am I right in thinking that the &quot;forall m.&quot; is redundant in this case?"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 16362, "user_id": 49220, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/431cd43aaf713caa80316e852a87a840?s=128&d=identicon&r=PG", "display_name": "Paul Johnson", "link": "https://stackoverflow.com/users/49220/paul-johnson"}, "edited": false, "score": 1, "creation_date": 1475517450, "post_id": 39835215, "comment_id": 66964747, "body": "@PaulJohnson, yes, but some people like to use that to emphasize universality."}], "tags": [], "owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "is_accepted": true, "score": 3, "last_activity_date": 1475508622, "creation_date": 1475508622, "answer_id": 39835215, "question_id": 39835012, "link": "https://stackoverflow.com/questions/39835012/haskell-is-there-a-way-to-use-two-monads-that-derive-from-the-same-class-inter/39835215#39835215", "title": "Haskell - Is there a way to use two monads that derive from the same class interchangeably?", "body": "<p>You can use the class type as your context, that way you'll be restricted to the common subset.</p>\n\n<pre><code>myFun :: forall m. MyClass m =&gt; m a\n</code></pre>\n\n<p>You can also add additional classes there, altough the <code>MyClass</code> will typically require <code>Monad</code> anyway.</p>\n"}], "owner": {"reputation": 916, "user_id": 3686057, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a689d2dbba6a4372281439b89f6e565b?s=128&d=identicon&r=PG&f=1", "display_name": "Niko", "link": "https://stackoverflow.com/users/3686057/niko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 39835215, "answer_count": 1, "score": 1, "last_activity_date": 1475508622, "creation_date": 1475508000, "question_id": 39835012, "link": "https://stackoverflow.com/questions/39835012/haskell-is-there-a-way-to-use-two-monads-that-derive-from-the-same-class-inter", "title": "Haskell - Is there a way to use two monads that derive from the same class interchangeably?", "body": "<p>I have two monads that are very similar (they actually have the same name, but are not perfectly identical) and derive from the same class type. Unfortunately these monads are defined in different libraries and don't know about each other. When I try to use MonadB in LibraryA as a function context, I'm getting an error that it's expecting MonadA, understandably so. Is there any way to polymorphically use MonadB within LibraryA without linking the two libraries together, perhaps by using their general class type as a context instead?</p>\n"}, {"tags": ["haskell", "servant", "haskell-wai"], "answers": [{"tags": [], "owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "is_accepted": true, "score": 1, "last_activity_date": 1475546497, "creation_date": 1475546497, "answer_id": 39843110, "question_id": 39834616, "link": "https://stackoverflow.com/questions/39834616/join-two-network-wai-application/39843110#39843110", "title": "Join two Network.Wai.Application", "body": "<p>I asked this on <code>#servant</code> channel and <code>alpounet</code> told me about <code>servant Raw</code> that allows to put our own <code>Application</code> handler. They even have a <code>serveDirectory</code> api as well :)</p>\n\n<pre><code>import qualified Servant as S\nimport Servant ((:&gt;), (:&lt;|&gt;))\n\ntype JobApi = \"job\" :&gt; \"status\" :&gt; S.Capture \"id\" ST.JobId :&gt; S.Get '[S.JSON] ST.JobStatus\n         :&lt;|&gt; \"job\" :&gt; S.ReqBody '[S.JSON] ST.JobPostBody :&gt; S.Post '[S.JSON] ST.JobId\n         :&lt;|&gt; \"job\" :&gt; S.Capture \"id\" ST.JobId :&gt; S.Get '[S.JSON] ST.JobResult\n         :&lt;|&gt; S.Raw\n\nserverRouter :: ST.Server -&gt; S.Server JobApi\nserverRouter server = statusGet\n    S.:&lt;|&gt; jobPost\n    S.:&lt;|&gt; jobGet\n    S.:&lt;|&gt; S.serveDirectory \"assets\"\n  where \n    -- ... so on\n</code></pre>\n"}], "owner": {"reputation": 4733, "user_id": 728407, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26b3f058ce75a05fd2ccc561f1cfa501?s=128&d=identicon&r=PG", "display_name": "Ashish Negi", "link": "https://stackoverflow.com/users/728407/ashish-negi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 39843110, "answer_count": 1, "score": 2, "last_activity_date": 1484860581, "creation_date": 1475506789, "last_edit_date": 1484860581, "question_id": 39834616, "link": "https://stackoverflow.com/questions/39834616/join-two-network-wai-application", "title": "Join two Network.Wai.Application", "body": "<p>i am using <code>servant</code> and <code>Network.Wai.Application.Static</code> for json api and static file serving respectively. I want to join these two <a href=\"https://hackage.haskell.org/package/wai-3.2.1.1/docs/Network-Wai.html#t:Application\" rel=\"nofollow\">Application</a> such that if <code>staticApp</code> fails to serve, request should go to <code>jsonApp</code>.</p>\n\n<p>I tried finding out and read how <code>websocketsOr</code> has done it.<a href=\"https://hackage.haskell.org/package/wai-websockets-3.0.1.1/docs/src/Network-Wai-Handler-WebSockets.html#websocketsOr\" rel=\"nofollow\">WebsocketsOr</a></p>\n\n<p>I finally wrote :</p>\n\n<pre><code>app :: NW.Application -&gt; NW.Application -&gt; NW.Application\napp staticApp apiApp req respond =\n  staticApp req (\\ response -&gt;\n                  do\n                    if (Status.statusCode . NW.responseStatus $ response) &lt; 300\n                    then respond response\n                    else apiApp req respond)\n</code></pre>\n\n<p>But it seems like someone else (wai itself) would have done it, handling many possible cases.. But i am not able to find.</p>\n\n<p>What are the edges cases i am missing (exceptions ?? ) and what other api can i use to do the same ?</p>\n"}, {"tags": ["haskell", "ghc", "haskell-lens"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475506186, "post_id": 39833351, "comment_id": 66958319, "body": "IMHO, this extension is just vile. It&#39;s merely another ad-hoc measure to surpress the symptoms of the old Haskell records&#39; design problem, but without actually fixing that problem in an idiomatic way. It&#39;s certainly not sensible to use this extension if you otherwise take a more modern course with lenses. A <i>proper</i> way to get overloaded record fields <a href=\"https://nikita-volkov.github.io/record/\" rel=\"nofollow noreferrer\">has been pointed out by Nikita Volkov</a> \u2013 based from the ground up on first-class concepts and all lenses."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475506838, "post_id": 39833351, "comment_id": 66958760, "body": "Do you know about the suite of record-related extensions outlined <a href=\"https://ghc.haskell.org/trac/ghc/wiki/Records/OverloadedRecordFields\" rel=\"nofollow noreferrer\">here</a>?"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475507734, "post_id": 39833351, "comment_id": 66959321, "body": "Yes, and I&#39;ve used these in the past, but ultimately they&#39;re unsatisfying. Lenses give you much more flexiblity; if you use lenses you just don&#39;t need any of these extensions."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475507799, "post_id": 39833351, "comment_id": 66959363, "body": "I just wanted to get rid of the ugly mangled field names, that&#39;s all."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475507896, "post_id": 39833351, "comment_id": 66959414, "body": "Also, according to one lens-maintainer, it should be possibly to use this new extension together with the TH functions (cf. <a href=\"https://github.com/ekmett/lens/issues/680\" rel=\"nofollow noreferrer\">this issue</a>)"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475508631, "post_id": 39833351, "comment_id": 66959881, "body": "Well \u2013 it is a bit annoying that the record fields themselves are essentially degraded to boilerplate when using <code>lens</code>. But I have begun to actually consider <code>_longUglyName</code> as a kind of \u201cattention, unstable implementation detail\u201d marker. It&#39;s somewhat handy \u2013 you can export everything, but automatically encourage to use the short, stable lens names instead of the implementation-specific record fields."}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1475546623, "post_id": 39833351, "comment_id": 66975689, "body": "It turns out you can use a short arbitrary prefix, together with DuplicateRecordFields, to get overloaded lenses without using clunky names for the record fields."}, {"owner": {"reputation": 335, "user_id": 3176773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e6ee66bc758342bea43a4e92f472f2?s=128&d=identicon&r=PG&f=1", "display_name": "SeongChan Lee", "link": "https://stackoverflow.com/users/3176773/seongchan-lee"}, "edited": false, "score": 0, "creation_date": 1488418277, "post_id": 39833351, "comment_id": 72226116, "body": "Short arbitrary prefix is not the default rule after lens-4.6. You need to prefix whole type name with first character lowercased, or to use <code>makeLensesWith abbreviatedFields</code>"}, {"owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "edited": false, "score": 0, "creation_date": 1488484668, "post_id": 39833351, "comment_id": 72263473, "body": "Yes, I&#39;m aware of that. I ended up using <code>abbreviatedFields</code>."}, {"owner": {"reputation": 4734, "user_id": 736508, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2b30f4fcb5b2b34a8468a8d378cab9d1?s=128&d=identicon&r=PG", "display_name": "Gal", "link": "https://stackoverflow.com/users/736508/gal"}, "edited": false, "score": 1, "creation_date": 1545402281, "post_id": 39833351, "comment_id": 94619197, "body": "@SwiftsNamesake If you&#39;ve solved your problem, why not post your solution and accept it as an answer so everybody else who come across this question would also know how to solve it?"}], "answers": [{"tags": [], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "is_accepted": true, "score": 0, "last_activity_date": 1571422417, "creation_date": 1571422417, "answer_id": 58456194, "question_id": 39833351, "link": "https://stackoverflow.com/questions/39833351/creating-lenses-with-duplicaterecordfields/58456194#58456194", "title": "Creating lenses with DuplicateRecordFields", "body": "<p>As a commenter pointed out, you can solve this with <code>makeLensesWith</code>, which is what I ended up doing:</p>\n\n<pre><code>makeLensesWith abbreviatedFields\n</code></pre>\n"}], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "accepted_answer_id": 58456194, "answer_count": 1, "score": 5, "last_activity_date": 1571422417, "creation_date": 1475502830, "question_id": 39833351, "link": "https://stackoverflow.com/questions/39833351/creating-lenses-with-duplicaterecordfields", "title": "Creating lenses with DuplicateRecordFields", "body": "<p>How would you go about generating lenses with the new <code>DuplicateRecordFields</code> enabled?</p>\n\n<p>I've already tried using <code>makeLenses</code>, but nothing was generated <em>at all</em>.</p>\n\n<p>I also tried importing my constructors with a qualifier to prevent name clashes between fields and lenses, but that didn't help either.</p>\n\n<p>Are there some unresolved issues with template-haskell as it pertains to this new extension (I found a ticket in the GHC bug tracker to that effect, but it's been closed), or am I missing something obvious?</p>\n"}, {"tags": ["list", "haskell", "io", "return", "monads"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1475503185, "post_id": 39833349, "comment_id": 66956225, "body": "What&#39;s the error?"}, {"owner": {"reputation": 10246, "user_id": 762363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cec6320f5a5a8253b3dbfbb8177e001?s=128&d=identicon&r=PG", "display_name": "Tarmil", "link": "https://stackoverflow.com/users/762363/tarmil"}, "edited": false, "score": 0, "creation_date": 1475504435, "post_id": 39833349, "comment_id": 66957114, "body": "If your code is indeed exactly as you put it here, then you have an indentation problem: <code>putStrLn</code> and <code>return</code> must be indented exactly at the level where <code>res &lt;-</code> starts."}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475531661, "post_id": 39833941, "comment_id": 66971771, "body": "Or <code>(\\res1 res2 -&gt; map (x:) res1 ++ res2) &lt;$&gt; combinationIO (n-1) xs &lt;*&gt; combinationIO n xs</code>."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 3, "last_activity_date": 1475504644, "creation_date": 1475504644, "answer_id": 39833941, "question_id": 39833349, "link": "https://stackoverflow.com/questions/39833349/haskell-why-is-it-not-working-io-action-wth-lists/39833941#39833941", "title": "Haskell - Why is it not working? (IO Action wth Lists)", "body": "<p>The major problem is that <code>map</code> and <code>++</code> work on <code>[a]</code>, not <code>IO [a]</code>. I think what you wanted was something like this:</p>\n\n<pre><code>combinationIO :: Show a =&gt; Int -&gt; [a] -&gt; IO [[a]]\ncombinationIO 0 _ = return [[]]\ncombinationIO _ [] = return []\ncombinationIO n (x:xs) = do\n  res1 &lt;- combinationIO (n-1) xs\n  res2 &lt;- combinationIO n xs\n  let res = (map (x:) res1) ++ res2\n  putStrLn $ (show n) ++ \" : (\" ++ (show (x,xs)) ++ \") = \" ++ (show res)\n  return res\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5761651, "user_type": "registered", "profile_image": "https://graph.facebook.com/477084759149014/picture?type=large", "display_name": "Cheati Nikle", "link": "https://stackoverflow.com/users/5761651/cheati-nikle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1475504644, "creation_date": 1475502823, "question_id": 39833349, "link": "https://stackoverflow.com/questions/39833349/haskell-why-is-it-not-working-io-action-wth-lists", "title": "Haskell - Why is it not working? (IO Action wth Lists)", "body": "<pre><code>combinationIO :: Int -&gt; [a] -&gt; IO [[a]]\ncombinationIO 0 _ = return [[]]\ncombinationIO _ [] = return []\ncombinationIO n (x:xs) = do res &lt;- (map (x:) (combinationIO (n-1) xs)) ++ (combinationIO n xs)\n                          putStrLn $ (show n) ++ show \" : (\" ++ show (x,xs) ++ show \") = \" ++ show res\n                          return res\n</code></pre>\n\n<p>I saw this example (below) on some site, and I wondered how it works so I put some IO actions in it. However, ghci gives me a type error. What is the problem?</p>\n\n<pre><code>combination2 :: Int -&gt; [a] -&gt; [[a]]\ncombination2 0 _ = [[]]\ncombination2 _ [] = []\ncombination2 n (x:xs) = (map (x:) (combination2 (n-1) xs)) ++ (combination2 n xs)\n</code></pre>\n"}, {"tags": ["haskell", "matrix"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475500596, "post_id": 39832485, "comment_id": 66954548, "body": "Please post the exact code that reproduces your error."}, {"owner": {"reputation": 2784, "user_id": 3160197, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d8e8d0d86e3cb6b4e6d201c2ea206dd0?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3160197/alon"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475500964, "post_id": 39832485, "comment_id": 66954769, "body": "I added the imports. This code reproduces the error"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 2, "creation_date": 1475502314, "post_id": 39832485, "comment_id": 66955693, "body": "The types that have <code>Element</code> instances are <code>Float</code> <code>Double</code>, <code>Complex Float</code> and <code>Complex Double</code>. That is, you can&#39;t do this with <code>Word8</code>.   If e.g. I put in  Float instead, this compiles fine <a href=\"http://sprunge.us/WTIK\" rel=\"nofollow noreferrer\">sprunge.us/WTIK</a>"}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475502416, "post_id": 39832485, "comment_id": 66955759, "body": "No it doesn&#39;t reproduce the error, though it does give a similar one."}, {"owner": {"reputation": 2784, "user_id": 3160197, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d8e8d0d86e3cb6b4e6d201c2ea206dd0?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3160197/alon"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1475503552, "post_id": 39832485, "comment_id": 66956474, "body": "@Michael , My img is Image PixelRGB8,I know that is function convertRGB8, their is also a way to readImage and than convertRGBF ?  Thanks"}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1475506456, "post_id": 39832485, "comment_id": 66958501, "body": "@Alon what I said was a mistake, integral types are represented by the <code>Z</code> (<code>Int64</code>) type. (There is also the complicated <code>Mod</code> business.) So this works, for example <a href=\"http://sprunge.us/hYgj\" rel=\"nofollow noreferrer\">sprunge.us/hYgj</a> The matrices are holding <code>Int64</code>s so you need to make sure that the manipulations respect the fact that &#39;morally&#39; they are <code>Word8</code>"}, {"owner": {"reputation": 2784, "user_id": 3160197, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d8e8d0d86e3cb6b4e6d201c2ea206dd0?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3160197/alon"}, "edited": false, "score": 0, "creation_date": 1475506777, "post_id": 39832485, "comment_id": 66958721, "body": "Thanks this solve my problem, can You write this ad an answer that I can set this question as solved? Thanks!!"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475536770, "post_id": 39832485, "comment_id": 66973455, "body": "Or you can use a more special-purpose library such as <code>friday</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "is_accepted": true, "score": 1, "last_activity_date": 1475507826, "creation_date": 1475507826, "answer_id": 39834945, "question_id": 39832485, "link": "https://stackoverflow.com/questions/39832485/haskell-convert-an-image-to-matrix/39834945#39834945", "title": "Haskell, convert an image to matrix", "body": "<p><code>hmatrix</code> has a limited number of instances for <code>Element</code>, and <code>Word8</code> isn't one of them. The simple <code>Integral</code> type it uses is <code>type Z = Int64</code>. If you keep in mind that for you what a <code>Matrix Int64</code> holds are morally <code>Word8</code>s, some conversion like the following is possible. (It is the same as what you wrote just putting <code>fromIntegral</code> in a few places.)</p>\n\n<pre><code>import Codec.Picture\nimport Data.Vector\nimport Data.Vector.Storable\n\nimport Debug.Trace\nimport GHC.Word\n\nimport Numeric.LinearAlgebra.Data\nimport Numeric.LinearAlgebra\n\nconvImg ::Image PixelRGB8 -&gt; Image PixelRGB8\nconvImg img = matrixToImg $  imgToMatrix img\n\nimgToMatrix ::Image PixelRGB8 -&gt; Numeric.LinearAlgebra.Matrix Z\nimgToMatrix Image { imageWidth = w, imageHeight = h, imageData = vec } =  ((3*w)&gt;&lt;h)  ( Data.Vector.Storable.toList $ (Data.Vector.Storable.map fromIntegral) (vec))\n\nmatrixToImg::Numeric.LinearAlgebra.Matrix Z -&gt;  Image PixelRGB8\nmatrixToImg matrix = Image  (rows matrix `quot` 3) (cols matrix) (vectorToStorableVector (Numeric.LinearAlgebra.Data.flatten(matrix)))\n    where vectorToStorableVector = \n               Data.Vector.Storable.fromList . Prelude.map fromIntegral . Numeric.LinearAlgebra.Data.toList  \n</code></pre>\n"}], "owner": {"reputation": 2784, "user_id": 3160197, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d8e8d0d86e3cb6b4e6d201c2ea206dd0?s=128&d=identicon&r=PG&f=1", "display_name": "Alon", "link": "https://stackoverflow.com/users/3160197/alon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 39834945, "answer_count": 1, "score": 1, "last_activity_date": 1475507826, "creation_date": 1475500198, "last_edit_date": 1475502257, "question_id": 39832485, "link": "https://stackoverflow.com/questions/39832485/haskell-convert-an-image-to-matrix", "title": "Haskell, convert an image to matrix", "body": "<p>I try to take an Image PixelRGB8 and convert it to matrix, to do some convolutions on the matrix. For the first try I want to convert it to matrix and convert the matrix back to an image. </p>\n\n<p>I receive this error:</p>\n\n<pre><code>    \u2022 No instance for (Element Word8)\n        arising from a use of \u2018matrixToImg\u2019\n    \u2022 In the expression: matrixToImg $ imgToMatrix img\n      In an equation for \u2018convImg\u2019:\n          convImg img = matrixToImg $ imgToMatrix img\nFailed, modules loaded: none.\n</code></pre>\n\n<p>what does it mean?</p>\n\n<p>This is the code.</p>\n\n<pre><code>import Codec.Picture\nimport Data.Matrix\nimport Data.Vector\nimport Data.Vector.Storable\n\nimport Debug.Trace\nimport GHC.Word\n\nimport Numeric.LinearAlgebra.Data\nimport Numeric.LinearAlgebra\nconvImg ::Image PixelRGB8 -&gt; Image PixelRGB8\nconvImg img = matrixToImg $  imgToMatrix img\n\nimgToMatrix ::Image PixelRGB8-&gt;Numeric.LinearAlgebra.Matrix Word8\nimgToMatrix Image { imageWidth = w, imageHeight = h, imageData = vec } =  ((3*w)&gt;&lt;h)  ( Data.Vector.Storable.toList vec)\n\nmatrixToImg::Numeric.LinearAlgebra.Matrix Word8-&gt;  Image PixelRGB8\nmatrixToImg matrix = Image  (rows matrix `quot` 3) (cols matrix) (vectorToStorableVector (Numeric.LinearAlgebra.Data.flatten(matrix)))\n    where vectorToStorableVector vec= Data.Vector.Storable.fromList $ Numeric.LinearAlgebra.Data.toList vec\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["haskell", "monads", "functor", "applicative"], "comments": [{"owner": {"reputation": 7030, "user_id": 3032349, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cd8d19756aa9bc73d8045ae988ae728?s=128&d=identicon&r=PG&f=1", "display_name": "ThreeFx", "link": "https://stackoverflow.com/users/3032349/threefx"}, "edited": false, "score": 1, "creation_date": 1475496984, "post_id": 39830892, "comment_id": 66952144, "body": "I think your problem is covered in <a href=\"http://stackoverflow.com/questions/7220436/good-examples-of-not-a-functor-functor-applicative-monad\">this</a> question."}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "closed_date": 1475497115, "answer_count": 0, "score": 2, "last_activity_date": 1475495351, "creation_date": 1475495351, "question_id": 39830892, "link": "https://stackoverflow.com/questions/39830892/understanding-differences-between-functors-applicative-functors-and-monads", "closed_reason": "Duplicate", "title": "Understanding differences between functors, applicative functors and monads?", "body": "<p>I've gone over functors, applicative functors and monad in learnyouahaskell, however I'm struggling to understand the exact characteristics that differentiate these 3 language elements.</p>\n\n<p>Does anyone have a simple example that show the differences of these concepts?</p>\n"}, {"tags": ["haskell", "build", "doctest", "haskell-stack", "hlint"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2913694"}, "is_accepted": true, "score": 2, "last_activity_date": 1475493080, "creation_date": 1475493080, "answer_id": 39830222, "question_id": 39827623, "link": "https://stackoverflow.com/questions/39827623/how-to-get-stack-to-run-extra-commands-when-building-a-haskell-package/39830222#39830222", "title": "How to get stack to run extra commands when building a haskell package?", "body": "<p>Stack provides a <code>--exec</code> flag which allows you to do this. Check the <a href=\"https://docs.haskellstack.org/en/stable/build_command/#flags\" rel=\"nofollow\">'Flags' documentation</a> for a full example, but we can see a command like:</p>\n\n<pre><code>$ stack build --test --exec \"echo Hi!\"\n</code></pre>\n\n<p>Where <code>--exec</code> is the 'do other stuff' and <code>--test</code> runs the tests. </p>\n\n<p>Related to your example, it could look like:</p>\n\n<pre><code>stack build \\\n  --exec \"hlint foo\" \\\n  --exec \"~/.cabal/bin/scan -j False bar\"\n  --exec \"~/.cabal/bin/doctest baz\"\n</code></pre>\n"}], "owner": {"reputation": 5679, "user_id": 1878788, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/fc54887ecbaba35e17251129e5b78c9a?s=128&d=identicon&r=PG", "display_name": "bli", "link": "https://stackoverflow.com/users/1878788/bli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 1, "accepted_answer_id": 39830222, "answer_count": 1, "score": 1, "last_activity_date": 1475493080, "creation_date": 1475484343, "question_id": 39827623, "link": "https://stackoverflow.com/questions/39827623/how-to-get-stack-to-run-extra-commands-when-building-a-haskell-package", "title": "How to get stack to run extra commands when building a haskell package?", "body": "<p>I had made a script for compiling my haskell programs (so far just simple scripts consisting in a single source file) that contained, before the call to ghc, the following lines:</p>\n\n<pre><code>echo \"Running hlint\"\nhlint ${1}\necho \"Running scan\"\n~/.cabal/bin/scan -j False ${1}\necho \"Running doctest\"\n~/.cabal/bin/doctest ${1}\n</code></pre>\n\n<p>(<code>${1}</code> referring to the single .hs source file.)</p>\n\n<p>How to get some equivalent checking done when using stack to manage and build my programs?</p>\n\n<p>I would like to setup some global configuration that would have these commands run automatically on the source code when calling <code>stack build</code> in any of my projects.</p>\n"}, {"tags": ["haskell", "hspec"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 1, "creation_date": 1475479774, "post_id": 39824646, "comment_id": 66942959, "body": "You&#39;re able to run this with <code>stack test</code>, but not with <code>runhaskell</code>? Well, there are two things that come immediately to mind: 1) you might be running <code>Spec.hs</code> from the wrong directory and 2) <code>runhaskell</code> won&#39;t know about <code>HintExample</code>."}, {"owner": {"reputation": 986, "user_id": 2953798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/47edc9c371f59db2f0620d0ae46d4c8f?s=128&d=identicon&r=PG&f=1", "display_name": "Manvi", "link": "https://stackoverflow.com/users/2953798/manvi"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1475503245, "post_id": 39824646, "comment_id": 66956261, "body": "Spec.hs is in test directory with HintExampleSpec.hs and I am running it from main project directory as &quot; runhaskell test/Spec.hs&quot;. And HintExample is in src directory. Kindly let me know if my project structure is not correct.."}, {"owner": {"reputation": 421, "user_id": 576888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29e2f75737bf56c1b9690974576833ed?s=128&d=identicon&r=PG", "display_name": "kirhgoff", "link": "https://stackoverflow.com/users/576888/kirhgoff"}, "edited": false, "score": 0, "creation_date": 1573465659, "post_id": 39824646, "comment_id": 103878322, "body": "I am also trying to run simple project with file and spec file and I am getting this error (no cabal or stack files in folder). I expect global installation of hspec by cabal should do it and allow me to import Test.Hspec but it does not"}], "owner": {"reputation": 986, "user_id": 2953798, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/47edc9c371f59db2f0620d0ae46d4c8f?s=128&d=identicon&r=PG&f=1", "display_name": "Manvi", "link": "https://stackoverflow.com/users/2953798/manvi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 570, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1475469169, "creation_date": 1475469169, "question_id": 39824646, "link": "https://stackoverflow.com/questions/39824646/hspec-unable-to-load-interface-for-spec-file", "title": "Hspec unable to load interface for Spec file", "body": "<p>I am trying to run hspec but getting error as \"Failed to load interface for Spec file\". I tried similar example from github, got same error. Please suggest where I am going wrong...(PS: I am able to run this with stack).</p>\n\n<p>Example from github (<a href=\"https://github.com/FranklinChen/twenty-four-days2015-of-hackage\" rel=\"nofollow\">https://github.com/FranklinChen/twenty-four-days2015-of-hackage</a>)\nI have following files:</p>\n\n<pre><code>-- src.HintExample.hs\nmodule HintExample where\nimport SortWrapper (Sort)\nimport qualified Language.Haskell.Interpreter as I\nimport Language.Haskell.Interpreter (OptionVal((:=)))\n\n-- | Dynamically load a 'Sort' implementation from a file.\n-- src is needed to pick up our SortWrapper.\n-- sort-plugins is a sample user plugins directory\nloadSort :: I.MonadInterpreter m =&gt;\n        String  -- ^ module name\n     -&gt; String  -- ^ function name\n     -&gt; m Sort\nloadSort moduleName functionName = do\nI.set [I.searchPath := [\"src\", \"sort-plugins\"]]\nI.loadModules [moduleName]\nI.setImports [moduleName, \"SortWrapper\"]\nI.interpret (moduleName ++ \".\" ++ functionName) (I.as :: Sort)\n</code></pre>\n\n<p>And test file as</p>\n\n<pre><code>-- test.HintExampleSpec.hs\nmodule HintExampleSpec where\nimport SortWrapper (Sort(Sort))\nimport HintExample (loadSort)\nimport qualified Language.Haskell.Interpreter as I\nimport Test.Hspec (Spec, hspec, describe, it, shouldBe)\nimport Test.Hspec.QuickCheck (prop)\n\n-- | Required for auto-discovery.\nspec :: Spec\nspec =\ndescribe \"hint\" $ do\nit \"dynamically loads a correct polymorphic sort function\" $ do\n  Right (Sort ourSort) &lt;-\n    I.runInterpreter (loadSort \"OurSorter\" \"ourSort\")\n  ourSort \"ebcad\" `shouldBe` \"abcde\"\n  ourSort [1 :: Int, 5, 4, 3, 7] `shouldBe` [1, 3, 4, 5, 7]\nit \"dynamically loads a wrong (only head) sort function\" $ do\n  Right (Sort onlyHead) &lt;-\n    I.runInterpreter (loadSort \"OurSorter\" \"onlyHead\")\n  onlyHead \"ebcad\" `shouldBe` \"e\"\n  onlyHead [True, False] `shouldBe` [True]\n\nmain :: IO ()\nmain = hspec spec\n</code></pre>\n\n<p>Spec file (Spec.hs) in test directory as:</p>\n\n<pre><code>{-# OPTIONS_GHC -F -pgmF hspec-discover #-}\n</code></pre>\n\n<p>running as:\nrunhaskell test/Spec.hs</p>\n"}, {"tags": ["python", "haskell"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1475465292, "post_id": 39823833, "comment_id": 66938562, "body": "I don&#39;t think <code>tail(xs)</code> does what you think it does."}, {"owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "reply_to_user": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1475465673, "post_id": 39823833, "comment_id": 66938629, "body": "@immibis as I expected it should return the list without the first tuple, so you mean this will not work in a list with tuple?? And what tail give in this code?"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1475465981, "post_id": 39823833, "comment_id": 66938680, "body": "If I&#39;m not mistaken, <code>tail(xs)</code> is the same as <code>tail (xs)</code>, so in this context <code>find d tail(xs)</code> is the same as <code>find d tail xs</code> which &quot;passes three arguments&quot; to <code>find</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475492530, "post_id": 39823833, "comment_id": 66949701, "body": "You probably can&#39;t / don&#39;t want to change the exercise requirement, but note that returning <code>&#39;n&#39;</code> as the error value for &quot;not found&quot; is quite unidiomatic in Haskell. This is because if we get <code>&#39;n&#39;</code> back we don&#39;t know whether it was found and it was <code>&#39;n&#39;</code> or it was not found. A more standard approach would be to return a <code>Maybe Char</code> instead of a plain <code>Char</code>."}, {"owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475515291, "post_id": 39823833, "comment_id": 66963674, "body": "@chi what do you mean a maybr char\uff1f"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "edited": false, "score": 0, "creation_date": 1475462779, "post_id": 39823923, "comment_id": 66938016, "body": "I try this, and it still said &quot;Parse error in pattern:&quot;"}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "reply_to_user": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "edited": false, "score": 0, "creation_date": 1475462973, "post_id": 39823923, "comment_id": 66938054, "body": "I am sorry I just missed <code>()</code>."}, {"owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "edited": false, "score": 0, "creation_date": 1475463175, "post_id": 39823923, "comment_id": 66938092, "body": "That works, do you have any resources like website that give more example on list+tuple ?"}, {"owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "reply_to_user": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "edited": false, "score": 1, "creation_date": 1475463378, "post_id": 39823923, "comment_id": 66938146, "body": "List and tuple are the most commonly used data structures in Haskell, there are tons of great resources you can refer to such as: <a href=\"http://learnyouahaskell.com/starting-out\" rel=\"nofollow noreferrer\">learnyouahaskell.com/starting-out</a>"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1475494037, "post_id": 39823923, "comment_id": 66950523, "body": "And <i>list</i> is also very, very different from <i>array</i>."}], "tags": [], "owner": {"reputation": 1556, "user_id": 1392943, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/606e0a60eca298e29ce56b5544de4950?s=128&d=identicon&r=PG&f=1", "display_name": "Kamel", "link": "https://stackoverflow.com/users/1392943/kamel"}, "is_accepted": true, "score": 3, "last_activity_date": 1475463203, "last_edit_date": 1475463203, "creation_date": 1475462610, "answer_id": 39823923, "question_id": 39823833, "link": "https://stackoverflow.com/questions/39823833/haskell-recursive-function-that-return-the-char-in-a-tuple-list-with-certain-co/39823923#39823923", "title": "haskell: recursive function that return the char in a tuple list with certain condition(compare)", "body": "<p><a href=\"https://en.wikibooks.org/wiki/Haskell/Lists_and_tuples\" rel=\"nofollow\">tuple</a> is different from array in Haskell</p>\n\n<pre><code>find :: Double -&gt; [(Double,Char)] -&gt; Char\nfind d [] = ' '\nfind d (x:xs)\n    | d &lt;= fst x = snd x\n    | otherwise = find d xs\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 39823923, "answer_count": 1, "score": 0, "last_activity_date": 1475463203, "creation_date": 1475461675, "question_id": 39823833, "link": "https://stackoverflow.com/questions/39823833/haskell-recursive-function-that-return-the-char-in-a-tuple-list-with-certain-co", "title": "haskell: recursive function that return the char in a tuple list with certain condition(compare)", "body": "<p>I'm learning recursive function in haskell that confused with such conditon:</p>\n\n<p>I got a tuple list here:</p>\n\n<pre><code>[(0.5,'!'),(1,'*'),(1.5,'#')]\n</code></pre>\n\n<p>What I want to do is input a number n and compare with fist number in each tuple of the list</p>\n\n<p>so suppose n=0.1, when it compared 0.5 and find it is smaller than 0.5, it will return char '!'</p>\n\n<p>suppose n=0.7, which is > 0.5 and keep comparing, find that it &lt; 1, then it will return char '*'</p>\n\n<p>and after compare the whole list and find d is still bigger than the last one, it will just return char 'n'</p>\n\n<p>I've been work with such condition lots of time,but still cannot get to this, here is my code:</p>\n\n<pre><code>find :: Double -&gt; [(Double,Char)] -&gt; Char\nfind d [] = ' '\nfind d xs\n    | d &lt;= Double(xs[0]) = xs[0]\n    | d &gt; Double(xs[0]) = find d tail(xs)\n</code></pre>\n\n<p>please use recursion!</p>\n"}, {"tags": ["haskell", "haskell-stack"], "answers": [{"comments": [{"owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 2, "creation_date": 1475483193, "post_id": 39823737, "comment_id": 66944535, "body": "if you want to add <code>--no-system-ghc</code> flag to all commands, you may as well add it to <code>stack.yaml</code> (possibly your local one, not the project&#39;s one)"}], "tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": true, "score": 3, "last_activity_date": 1475614641, "last_edit_date": 1475614641, "creation_date": 1475460776, "answer_id": 39823737, "question_id": 39823472, "link": "https://stackoverflow.com/questions/39823472/dependency-issues-when-using-stack-build-profile/39823737#39823737", "title": "Dependency issues when using &#39;stack build --profile&#39;?", "body": "<p>Figured it out after finding <a href=\"https://github.com/commercialhaskell/stack/issues/1331\" rel=\"nofollow\">https://github.com/commercialhaskell/stack/issues/1331</a>.</p>\n\n<p>Solution:</p>\n\n<ul>\n<li><p>Instead of doing</p>\n\n<pre><code>$ stack build --profile\n</code></pre></li>\n<li><p>Do:</p>\n\n<pre><code>$ stack build --profile --no-system-ghc\n</code></pre></li>\n</ul>\n\n<p>And just add <code>--no-system-ghc</code> to everything.  You might potentially need to do <code>stack setup --no-system-ghc</code> before everything too?</p>\n\n<p>Alternatively, as suggested by the comments, you can add this to the <code>stack.yaml</code> for the project or for your global stack project.</p>\n"}], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 39823737, "answer_count": 1, "score": 3, "last_activity_date": 1475614641, "creation_date": 1475458552, "question_id": 39823472, "link": "https://stackoverflow.com/questions/39823472/dependency-issues-when-using-stack-build-profile", "title": "Dependency issues when using &#39;stack build --profile&#39;?", "body": "<p>Steps to reproduce:</p>\n\n<pre><code>$ stack new profiling-test\n$ cd profiling-test\n$ stack build --profile\n</code></pre>\n\n<p>A new project is initialized with <code>lts-7.2</code> and a default template.  I get the error:</p>\n\n<pre><code>While constructing the BuildPlan the following exceptions were encountered:\n\n--  While attempting to add dependency,\n    Could not find package base in known packages\n\n--  Failure when adding dependencies:\n      base: needed (&gt;=4.7 &amp;&amp; &lt;5), stack configuration has no specified version (latest applicable is 4.9.0.0)\n    needed for package profiling-test-0.1.0.0\n\nRecommended action: try adding the following to your extra-deps in ~/profiling-test/stack.yaml\n- base-4.9.0.0\n\nYou may also want to try the 'stack solver' command\n</code></pre>\n\n<p>If I just do <code>stack build</code>, it compiles fine without any errors.</p>\n\n<p>I've added <code>base-4.9.0.0</code> to <code>extra-deps</code> in <code>stack.yaml</code>, but I get the same error.</p>\n\n<p>My stack version is:</p>\n\n<pre><code>$ stack --version\nVersion 1.1.3, Git revision 225df244ea346a8dc880ef911b002583486a92b2 x86_64 hpack-0.14.0\n</code></pre>\n\n<p>And I'm running Ubuntu 14.04 trusty.</p>\n\n<p>Thanks in advance for any help!</p>\n"}, {"tags": ["haskell", "operator-overloading"], "answers": [{"comments": [{"owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "edited": false, "score": 0, "creation_date": 1475459784, "post_id": 39823564, "comment_id": 66937413, "body": "Is there any way to alter the design to allow me to use <code>Num</code>?"}, {"owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "reply_to_user": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "edited": false, "score": 0, "creation_date": 1475460261, "post_id": 39823564, "comment_id": 66937506, "body": "@IzaakWeiss There are a bunch of options - I covered a few of them in the edit I was working on for the last 12 or so minutes."}], "tags": [], "owner": {"reputation": 24028, "user_id": 383200, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9dc722f936cb1059adaae4fe39c07f0?s=128&d=identicon&r=PG", "display_name": "Carl", "link": "https://stackoverflow.com/users/383200/carl"}, "is_accepted": false, "score": 1, "last_activity_date": 1475460219, "last_edit_date": 1475460219, "creation_date": 1475459446, "answer_id": 39823564, "question_id": 39823408, "link": "https://stackoverflow.com/questions/39823408/prime-finite-field-z-pz-in-haskell-with-operator-overloading/39823564#39823564", "title": "Prime finite field (Z/pZ) in Haskell with Operator Overloading", "body": "<p>You can't productively use <code>Num</code> with this design.  The important thing about type classes is that dispatch is done by type, not value.  An instance of <code>Num</code> for <code>FieldElement</code> wouldn't have any way of knowing what <code>FiniteField</code> it belongs to, so its operations can't depend on what field you're operating in.</p>\n\n<p>There are a couple directions you could take this that would work with <code>Num</code>.</p>\n\n<p>The first is making <code>FieldElement</code> an expression type that builds up expression trees with its <code>Num</code> instance, then can be evaluated within a particular <code>FiniteField</code>.  This has the advantage of using very simple techniques.  It has the disadvantage of being <em>really</em> bad for memory and performance when the computations get complex.</p>\n\n<p>The second is to follow a pattern like <code>Data.Fixed</code>.  You would change <code>FiniteField</code> to a class and implement it on some empty types representing various specific fields, with names like <code>F17</code>, for instance.  Then you parameterize <code>FieldElement</code> with a type argument that's used to mark which <code>FiniteField</code> they belong to.  Finally, the instance of <code>Num</code> for <code>FiniteElement</code> requires that its argument have a <code>FiniteField</code> instance, which is used in its implementation.  This approach has the advantage of being really nice to work with.  The disadvantage is requiring a boilerplate <code>FiniteField</code> instance for each field you want to work in.</p>\n\n<p>A third option is very similar to the above, but replacing the custom <code>F17</code> like data types with some sort of type-level natural. (Either manual, or from <code>-XDataKinds</code>).  Then you can implement the <code>Num</code> instance in terms of the type-level natural.  The advantage here is that you get rid of all the boilerplate instances from the previous approach. The disadvantage is that it doesn't require that the type-level argument is a prime number, and several calculations are wrong if it isn't prime.</p>\n"}, {"tags": [], "owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "is_accepted": true, "score": 2, "last_activity_date": 1475488344, "last_edit_date": 1475488344, "creation_date": 1475459825, "answer_id": 39823614, "question_id": 39823408, "link": "https://stackoverflow.com/questions/39823408/prime-finite-field-z-pz-in-haskell-with-operator-overloading/39823614#39823614", "title": "Prime finite field (Z/pZ) in Haskell with Operator Overloading", "body": "<p>The main issue you have to work around is the fact that you shouldn't be allowed to add/multiply/etc. values of <code>FiniteField</code> under different orders.  The solution is pretty straightforward from a type-system perspective: give values of different orders different types.</p>\n\n<pre><code>newtype FieldElem (n :: Nat) = FieldElem Integer\n</code></pre>\n\n<p><code>Nat</code> is a kind (from the GHC.TypeLits module) whose inhabitants are type-level numerical literals like <code>1</code>, <code>2</code>, <code>3</code>, etc.</p>\n\n<p>So now, you have different types:</p>\n\n<pre><code>FieldElem 7     -- the type of an element of a finite field of order 7\nFieldElem 11    -- the type of an element of a finite field of order 11\n</code></pre>\n\n<p>So if you try to add two values of different types, you get a compile error.</p>\n\n<pre><code>&gt; (x :: FieldElem 7) + (y :: FieldElem 11)\nError!  You can only use + on two things of the same type!\n&gt; (x :: FieldElem 7) + (y :: FieldElem 7)\n-- result: something of type FieldElem 7\n</code></pre>\n\n<p>Now you can implement the <code>Num</code> instance:</p>\n\n<pre><code>instance Num (FieldElem n) where\n   (+) = ...\n   (*) = ...\n</code></pre>\n\n<p>One issue here is that <code>(+)</code> needs to know what the order is, and the only information is in the type of <code>FieldElem</code>.  To go around this, we require <code>n</code> to be an instance of the <code>KnownNat</code> typeclass (also from GHC.TypeLits), which lets us get its integer value as a value at runtime:</p>\n\n<pre><code>natVal :: KnownNat n =&gt; Proxy n -&gt; Integer\n</code></pre>\n\n<p>so,</p>\n\n<pre><code>&gt; natVal (Proxy :: Proxy 10)\n10\n&gt; natVal (Proxy :: Proxy 19)\n19\n</code></pre>\n\n<p>And so our final design: (which requires <code>ScopedTypeVariables</code> to let us use the <code>n</code> type variable)</p>\n\n<pre><code>instance KnownNat n =&gt; Num (FieldElem n) where\n  FieldElem x + FieldElem y = FieldElem (mod (x + y) n)\n    where\n      n = natVal (Proxy :: Proxy n)\n</code></pre>\n\n<p>etc.!</p>\n\n<p>You can bring in <code>Integer</code>s into <code>FieldElem</code> using a smart constructor:</p>\n\n<pre><code>mkFieldElem :: forall n. KnownNat n =&gt; Integer -&gt; Maybe (FieldElem n)\nmkFieldElem x | isPrime n = Just (FieldElem (mod x n))\n              | otherwise = Nothing\n  where\n    n = natVal (Proxy :: Proxy n)\n</code></pre>\n\n<p>The nice thing is that you get to use Haskell's type inference to specify the order you want:</p>\n\n<pre><code>&gt; mkFieldElem 10 :: Maybe (FieldElem 23)\nJust (FieldElem 10)     -- :: Maybe (FieldElem 23)\n</code></pre>\n\n<p>Instead of manually passing it as a parameter! :)</p>\n\n<p>By using smart constructors (and hiding the actual constructor) you can make sure that the user never has any values of type <code>FieldElem 8</code>, for instance, so you don't have to worry about fields of bad orders being added together.</p>\n\n<p>Note that, unfortunately, <code>fromInteger :: KnownNat n =&gt; Integer -&gt; FieldElem n</code> will necessarily be partial.  It has to reject bad orders.  But there are a large number of instances in <em>base</em> with partial implementations of <code>fromInteger</code> anyway :|  But, <code>fromInteger</code> being in <code>Num</code> is a bad idea anyways, and <code>Num</code> is a bad typeclass, so it's <code>Num</code>'s fault :)</p>\n\n<hr>\n\n<p><strong>EDIT</strong> There's a potential way to make <code>fromInteger</code> not partial/total: we could create a <code>Prime</code> typeclass and have only instances where the <code>Nat</code> parameter is prime:</p>\n\n<pre><code>class KnownNat n =&gt; Prime (n :: Nat)\n</code></pre>\n\n<p>Then you could make:</p>\n\n<pre><code>mkFieldElem :: Prime n =&gt; Integer -&gt; FieldElem n\nmkFieldElem x = FieldElem (mod x n)\n  where\n    n = natVal (Proxy :: Proxy n)\n</code></pre>\n\n<p>And now if you had:</p>\n\n<pre><code>instance Prime n =&gt; Num (FieldElem n) where\n  ...\n  fromInteger = mkFieldElem\n</code></pre>\n\n<p><code>fromInteger</code> would be a total function, because the only instances would be for prime order fields!</p>\n\n<p>However, in order for this to work, you need to get your instances of <code>Prime</code> in a way that GHC can understand.  In theory, this could be done using a GHC type checker extension --- you could write your own type checker extension so that <code>n</code> is given a <code>Prime</code> instance if it's prime at compile-time.  However, this hasn't been done yet ... the next best thing you can do is offer run-time proofs of prime-ness:</p>\n\n<pre><code>witPrime :: forall n.KnownNat n =&gt; Proxy n -&gt; Maybe (Dict (Prime n))\nwitPrime p | isPrime (natVal p) = Just (unsafeCoerce (Dict :: Dict (KnownNat n))\n           | otherwise          = Nothing\n</code></pre>\n\n<p>This is using <code>Dict</code> from the <a href=\"http://hackage.haskell.org/package/constraints-0.8/docs/Data-Constraint.html\" rel=\"nofollow\">constraints</a> library, which is one way of generating typeclass instances at runtime.  If you ever pattern match on the <code>Dict</code> constructor of a value of type <code>Dict c</code>, the instance <code>c</code> is \"in scope\" in that case statement.</p>\n\n<p>In our case, then, we can do:</p>\n\n<pre><code>case witPrime (Proxy :: Proxy 11) of\n  Just Dict -&gt; ... -- in this branch, `Prime 11` is an instance we can use\n  Nothing   -&gt; ... -- here, it isn't\n</code></pre>\n\n<p>Or we can run it in GHCi:</p>\n\n<pre><code>&gt; let x = mkFieldElem 6 :: FieldElem 11\nError: No instance for (Prime 11)\n&gt; case witPrime (Proxy :: Proxy 11) of\n    Just Dict -&gt; let x = mkFieldElem 6 :: FieldElem 11  -- okay, because of Dict constructor match\n                 in  print x\nFieldElem 6    -- :: FieldElem 11\n</code></pre>\n"}], "owner": {"reputation": 1290, "user_id": 5499871, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206799318615183/picture?type=large", "display_name": "Izaak Weiss", "link": "https://stackoverflow.com/users/5499871/izaak-weiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "closed_date": 1475467558, "accepted_answer_id": 39823614, "answer_count": 2, "score": 1, "last_activity_date": 1475488344, "creation_date": 1475457954, "question_id": 39823408, "link": "https://stackoverflow.com/questions/39823408/prime-finite-field-z-pz-in-haskell-with-operator-overloading", "closed_reason": "Duplicate", "title": "Prime finite field (Z/pZ) in Haskell with Operator Overloading", "body": "<p>I have some code right now that creates a prime field of order n, with all the necessary functions to compute addition, multiplication, and their inverses. It works fine, but I really want to be able to overload the Integral and Num infix functions of +, -, *, /, and ^, but I don't know how to do this. Here's my current code:</p>\n\n<pre><code>import Data.Maybe\n\ndata FiniteField = FiniteField {add::(FieldElement -&gt; FieldElement -&gt; FieldElement),\n              addinv::(FieldElement -&gt; FieldElement),\n              mul::(FieldElement -&gt; FieldElement -&gt; FieldElement),\n              mulinv::(FieldElement -&gt; FieldElement),\n              new::(Integer -&gt; FieldElement)\n              }\n\nnewtype FieldElement = FieldElement Integer deriving (Eq, Show, Read)\n\ntoInt :: FieldElement -&gt; Integer\ntoInt (FieldElement x) = x\n\ngcdExt :: Integer -&gt; Integer -&gt; (Integer, Integer, Integer)\ngcdExt a 0 = (1, 0, a)\ngcdExt a b = (t, s - q * t, g)\n    where (q, r) = quotRem a b\n          (s, t, g) = gcdExt b r\n\nmodMulInv :: Integer -&gt; Integer -&gt; Integer\nmodMulInv a n = i\n    where (i, _, _) = gcdExt a n\n\nisPrimeLoop :: Integer -&gt; Integer -&gt; Bool\nisPrimeLoop n i\n    | i == n = True\n    | i == 2 = (mod n i /= 0) &amp;&amp; isPrimeLoop n (i+1)\n    | otherwise = (mod n i /= 0) &amp;&amp; isPrimeLoop n (i+2)\n\nisPrime :: Integer -&gt; Bool\nisPrime n = isPrimeLoop n 2\n\nnewFiniteField :: Integer -&gt; Maybe FiniteField\nnewFiniteField n\n    | not (isPrime n) = Nothing\n    | otherwise = Just (FiniteField add addinv mul mulinv new)\n    where\n        add = (\\x y -&gt; FieldElement (mod (toInt x + toInt y) n) )\n        addinv = (\\x -&gt; FieldElement (mod (n - toInt x) n) )\n        mul = (\\x y -&gt; FieldElement (mod (toInt x * toInt y) n) )\n        mulinv = (\\x -&gt; FieldElement (mod (modMulInv (toInt x) n) n) )\n        new = (\\x -&gt; FieldElement x)\n</code></pre>\n"}, {"tags": ["haskell", "mandelbrot"], "comments": [{"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 0, "creation_date": 1475448926, "post_id": 39822524, "comment_id": 66935478, "body": "Is this a Mandelbrot set computation, by any chance?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1475449111, "post_id": 39822524, "comment_id": 66935533, "body": "This looks familiar: <a href=\"http://stackoverflow.com/questions/39809592/haskell-infinite-recursion-in-list-comprehension\" title=\"haskell infinite recursion in list comprehension\">stackoverflow.com/questions/39809592/&hellip;</a>"}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1475449176, "post_id": 39822524, "comment_id": 66935550, "body": "@melpomene Good spotting"}, {"owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "edited": false, "score": 0, "creation_date": 1475451531, "post_id": 39822524, "comment_id": 66935993, "body": "So many thanks that I try to search and find nothing related, the question name of that one is so much different of what I try to search.! That solve my problem !"}], "owner": {"reputation": 87, "user_id": 5915959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c83fb73c72b7946a2905b338e86eeb74?s=128&d=identicon&r=PG&f=1", "display_name": "o1xhack", "link": "https://stackoverflow.com/users/5915959/o1xhack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "closed_date": 1475451540, "answer_count": 0, "score": 1, "last_activity_date": 1475448911, "creation_date": 1475448447, "last_edit_date": 1475448911, "question_id": 39822524, "link": "https://stackoverflow.com/questions/39822524/haskell-takes-a-x-y-and-return-a-infinite-list-with-the-a-definition-of-orbit", "closed_reason": "Duplicate", "title": "haskell takes a (x,y) and return a infinite list with the a definition of Orbit(x,y)", "body": "<p>There is a function P(x,y) defined as:</p>\n\n<pre><code>P(x,y)(u,v) = (u^2 - v^2 + x, 2uv + y)\n</code></pre>\n\n<p>and define Orbit O(x,y) of a point (x,y) to be an infinite list of items:</p>\n\n<pre><code>O(x,y) = {(0,0), P(x,y)(0,0), P(x,y)(P(x,y)(0,0)), P(x,y)(P(x,y)(P(x,y)(0,0))),..}\n</code></pre>\n\n<p>So I need to write Haskell function that takes a single point (x,y) as an argument and returns an infinite list corresponding to O(x,y). </p>\n\n<p>I try to write this with a helper function where:</p>\n\n<pre><code>orbit :: (Eq i, Num i) =&gt; i -&gt; i -&gt; [i]\norbit x y = (x,y) : orbit(p(x,y)(u,v))\nwhere p(x,y)(u,v) = phelp x y\n\nphelp u v = ((0^2)-(0^2)+x,(2*0*0)+y)\n</code></pre>\n\n<p>but I keep going wrong with whatever I modify. Can someone else help me and explain why it works? I think it needs to use recursion.</p>\n"}, {"tags": ["haskell", "quadratic"], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": false, "score": 5, "last_activity_date": 1475445373, "creation_date": 1475445373, "answer_id": 39822116, "question_id": 39821968, "link": "https://stackoverflow.com/questions/39821968/haskell-quadratic-solution-finder-error/39822116#39822116", "title": "Haskell Quadratic solution finder - Error", "body": "<p>You aren't passing any arguments to <code>nRoots</code>. You can fix the errors by passing the coefficients to <code>nRoots</code></p>\n\n<pre><code>roots a b c | nRoots a b c ==2 = ...\n</code></pre>\n\n<p>The error messages are telling you that there's no way to check for equality (an <code>Eq</code> instance) for things like <code>nRoots</code>, which has type <code>Float -&gt; Float -&gt; Float -&gt; Int</code>, and there's no way to convert the number <code>2</code> to a number with the same type (no <code>Num</code> instance). Both errors are arising from the expression <code>nRoots == 2</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 121, "user_id": 2924117, "user_type": "registered", "profile_image": "https://graph.facebook.com/821112709/picture?type=large", "display_name": "Arthur Welf", "link": "https://stackoverflow.com/users/2924117/arthur-welf"}, "is_accepted": false, "score": 0, "last_activity_date": 1570418269, "last_edit_date": 1592644375, "creation_date": 1475445564, "answer_id": 39822138, "question_id": 39821968, "link": "https://stackoverflow.com/questions/39821968/haskell-quadratic-solution-finder-error/39822138#39822138", "title": "Haskell Quadratic solution finder - Error", "body": "<p>You didn't applied your function <code>nRoot</code> to its arguments in guards in second function. Apply your functions <code>nRoots</code> to arguments <code>a</code>, <code>b</code> and <code>c</code> and then you will be able to compare the result of it.</p>\n<p><a href=\"https://i.stack.imgur.com/IQVzr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/IQVzr.png\" alt=\"\" /></a></p>\n\n"}, {"tags": [], "owner": {"reputation": 3609, "user_id": 2565354, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/590ed3229d95cdcaa05a96028c586165?s=128&d=identicon&r=PG", "display_name": "badcook", "link": "https://stackoverflow.com/users/2565354/badcook"}, "is_accepted": true, "score": 2, "last_activity_date": 1475446293, "creation_date": 1475446293, "answer_id": 39822245, "question_id": 39821968, "link": "https://stackoverflow.com/questions/39821968/haskell-quadratic-solution-finder-error/39822245#39822245", "title": "Haskell Quadratic solution finder - Error", "body": "<p>You need to provide the appropriate arguments to <code>nRoots</code>, specifically <code>roots a b c | nRoots a b c == 2 = ...</code>.</p>\n\n<p>Your error message tells you that though, so let's go through how you should read this error message from GHC to figure out how this was your problem. I've marked the error message below with several section marks.</p>\n\n<pre><code>raizes.hs:8:21:\n    ---------------------BEGIN SECTION A--------------------\n    No instance for (Eq (Float -&gt; Float -&gt; Float -&gt; Int))\n      (maybe you haven't applied enough arguments to a function?)\n      arising from a use of \u2018==\u2019\n    In the expression: nRoots == 2\n    ---------------------END SECTION A--------------------\n    ---------------------BEGIN SECTION B--------------------\n    In a stmt of a pattern guard for\n                   an equation for \u2018roots\u2019:\n      nRoots == 2\n    In an equation for \u2018roots\u2019:\n        roots a b c\n          | nRoots == 2\n          = [(- b - sqrt (b ^ 2 - 4 * a * c)) / (2 * a),\n             (- b + sqrt (b ^ 2 - 4 * a * c)) / (2 * a)]\n          | nRoots == 1 = [- b / (2 * a)]\n          | otherwise = []\n    ---------------------END SECTION B--------------------\n\nraizes.hs:8:23:\n    ---------------------BEGIN SECTION C--------------------\n    No instance for (Num (Float -&gt; Float -&gt; Float -&gt; Int))\n      (maybe you haven't applied enough arguments to a function?)\n      arising from the literal \u20182\u2019\n    In the second argument of \u2018(==)\u2019, namely \u20182\u2019\n    In the expression: nRoots == 2\n    In a stmt of a pattern guard for\n                   an equation for \u2018roots\u2019:\n      nRoots == 2\n   ---------------------END SECTION C--------------------\n</code></pre>\n\n<p>First let's review the type of <code>==</code>.</p>\n\n<pre><code>(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p><code>SECTION A</code> tells you that <code>==</code> requires instances of the equality type class (<code>Eq</code>) in order to work because it's overloaded to work for any type which has an <code>Eq</code> instance. Unfortunately there is no (and can be no non-trivial) instance for <code>Eq</code> for <code>nRoots</code> because <code>nRoots</code> itself is a function (think halting problem). The hint that GHC gives here is exactly your problem, namely GHC notices you're trying to compare equality of a function (to a number in this case) and suggests <code>maybe you haven't applied enough arguments to a function?</code></p>\n\n<p>Okay so just after <code>SECTION A</code> we already seem to know the problem you're facing, but let's not be too hasty here, maybe it's the case <code>SECTION B</code> and <code>SECTION C</code> will show that the error you're seeing in <code>SECTION A</code> is just a superificial error caused by something deeper.</p>\n\n<p>Well <code>SECTION B</code> is really just telling you the exactly location of the problem in <code>SECTION A</code> so that's not anything new.</p>\n\n<p>What about <code>SECTION C</code>? Well remember the type of <code>==</code>? It turns out that <code>==</code> expects both sides of the equality to be of the same type. So now GHC sees <code>nRoots == 2</code> and expects both <code>nRoots</code> and <code>2</code> to be of the same type. Well numeric literals in Haskell are overloaded to be of type <code>Num a =&gt; a</code> so that they can simultaneously represent <code>Int</code>s, <code>Integer</code>s, <code>Double</code>s, <code>Rational</code>s, etc. So now GHC expects <code>nRoots</code> to be of type <code>Num a =&gt; a</code> where <code>a</code> in particular must be <code>Float -&gt; Float -&gt; Float -&gt; Int</code>, i.e. it expects <code>nRoots</code> to be an instance of the <code>Num</code> typeclass.</p>\n\n<p>Well as GHC astutely hints at, this is really just another symptom of the same problem! Namely that you forgot to actually apply arguments to <code>nRoots</code> and so GHC is trying to deal with a bare function rather than the output of the function.</p>\n\n<p>So <code>Section A</code> and <code>Section C</code> are both telling you that you have the same problem, namely you're trying to use a function itself <code>nRoots</code> when you should be fully applying your arguments to that function and be using the output of that function.</p>\n"}], "owner": {"reputation": 23, "user_id": 6912980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a959d945ef4813aefc2358237b5ba59e?s=128&d=identicon&r=PG&f=1", "display_name": "Rmp", "link": "https://stackoverflow.com/users/6912980/rmp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 0, "accepted_answer_id": 39822245, "answer_count": 3, "score": 2, "last_activity_date": 1570418269, "creation_date": 1475444362, "last_edit_date": 1475508012, "question_id": 39821968, "link": "https://stackoverflow.com/questions/39821968/haskell-quadratic-solution-finder-error", "title": "Haskell Quadratic solution finder - Error", "body": "<p>I am using Haskell in college and one of the exercises I have to do is make a function that gives me the roots of a quadratic equation when I give it its coefficients, using a previous function that tells me how many solutions it has. Here's what I have done:</p>\n\n<p>First function, this one works fine:</p>\n\n<pre><code>nRoots :: Float -&gt; Float -&gt; Float -&gt; Int\nnRoots a b c | r&lt;0 = 0\n             | r==0 = 1\n             | otherwise = 2\n             where r = b^2-4*a*c\n</code></pre>\n\n<p>Second function, it does not work:</p>\n\n<pre><code>roots :: Float -&gt; Float -&gt; Float -&gt; [Float]\nroots a b c | nRoots==2 = [(-b-sqrt(b^2-4*a*c))/(2*a),(-b+sqrt(b^2-4*a*c))/(2*a)]\n            | nRoots==1 = [-b/(2*a)] \n            | otherwise = []\n</code></pre>\n\n<p>Here's the error I get:</p>\n\n<pre><code>raizes.hs:8:21:\n    No instance for (Eq (Float -&gt; Float -&gt; Float -&gt; Int))\n      (maybe you haven't applied enough arguments to a function?)\n      arising from a use of \u2018==\u2019\n    In the expression: nRoots == 2\n    In a stmt of a pattern guard for\n                   an equation for \u2018roots\u2019:\n      nRoots == 2\n    In an equation for \u2018roots\u2019:\n        roots a b c\n          | nRoots == 2\n          = [(- b - sqrt (b ^ 2 - 4 * a * c)) / (2 * a),\n             (- b + sqrt (b ^ 2 - 4 * a * c)) / (2 * a)]\n          | nRoots == 1 = [- b / (2 * a)]\n          | otherwise = []\n\nraizes.hs:8:23:\n    No instance for (Num (Float -&gt; Float -&gt; Float -&gt; Int))\n      (maybe you haven't applied enough arguments to a function?)\n      arising from the literal \u20182\u2019\n    In the second argument of \u2018(==)\u2019, namely \u20182\u2019\n    In the expression: nRoots == 2\n    In a stmt of a pattern guard for\n                   an equation for \u2018roots\u2019:\n      nRoots == 2\n</code></pre>\n\n<p>Any idea as to what is going on??</p>\n\n<p>Thanks in advance</p>\n\n<p>EDIT: Thanks for all the answers! I feel quite dumb now for not noticing it :X</p>\n"}, {"tags": ["forms", "haskell", "post", "servant"], "answers": [{"tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": false, "score": 3, "last_activity_date": 1475429687, "creation_date": 1475429687, "answer_id": 39819730, "question_id": 39819729, "link": "https://stackoverflow.com/questions/39819729/handling-regular-form-posts-application-x-www-form-urlencoded-with-servant/39819730#39819730", "title": "Handling regular form posts (application/x-www-form-urlencoded) with servant", "body": "<p>Servant supports this via the data type <a href=\"https://www.stackage.org/haddock/lts-7.2/servant-0.8.1/Servant-API-ContentTypes.html#t:FormUrlEncoded\" rel=\"nofollow\">FormUrlEncoded</a>, and the class <a href=\"https://www.stackage.org/haddock/lts-7.2/servant-0.8.1/Servant-API-ContentTypes.html#t:FromFormUrlEncoded\" rel=\"nofollow\">FromFormUrlEncoded</a> (renamed to <code>FromForm</code> in Servant 0.9).</p>\n\n<p>First we define a data type for the form data, and rewrite our handler to accept that.</p>\n\n<pre><code>data CheckRequest = CheckRequest { code :: Text }\n\ncheckCode :: CheckRequest -&gt; Handler CheckResult\ncheckCode (CheckRequest code) = if code == \"secret\" then Correct else Wrong\n</code></pre>\n\n<p>Then we specify a POST body of type <code>application/x-www-form-urlencoded</code>.</p>\n\n<pre><code>type API = \"check\"\n         :&gt; ReqBody '[FormUrlEncoded] CheckRequest\n         :&gt; Post '[HTML] CheckResult\n</code></pre>\n\n<p>Now all that's required is to make <code>CheckRequest</code> an instance of <code>FromFormUrlEncoded</code>.</p>\n\n<pre><code>instance FromFormUrlEncoded CheckRequest where\n  --fromFormUrlEncoded :: [(Text, Text)] -&gt; Either String CheckRequest\n  fromFormUrlEncoded [(\"code\", c)] = Right (CheckRequest c)\n  fromFormUrlEncoded _             = Left \"expected a single field `code`\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6788, "user_id": 1748754, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jjk7p.jpg?s=128&g=1", "display_name": "erewok", "link": "https://stackoverflow.com/users/1748754/erewok"}, "is_accepted": true, "score": 10, "last_activity_date": 1497364951, "last_edit_date": 1497364951, "creation_date": 1497363845, "answer_id": 44524290, "question_id": 39819729, "link": "https://stackoverflow.com/questions/39819729/handling-regular-form-posts-application-x-www-form-urlencoded-with-servant/44524290#44524290", "title": "Handling regular form posts (application/x-www-form-urlencoded) with servant", "body": "<p>I just wanted to add an answer for a recent version of Servant, because I had to google various things in order to assemble a complete, working version of form handling. </p>\n\n<p>The above answer works well for earlier versions of Servant, but I got stuck using forms when upgrading to Servant 0.9. </p>\n\n<p>Here's how I did it.</p>\n\n<p>First of all, they switched from a custom Form implementation to the one in <a href=\"https://github.com/fizruk/http-api-data\" rel=\"noreferrer\">http-api-data</a>, so you need that in your cabal file:</p>\n\n<p><em>some-project.cabal</em></p>\n\n<pre><code>  build-depends:       base &gt;= 4.7 &amp;&amp; &lt; 5\n                     , aeson\n                     , blaze-html\n                     , http-api-data\n</code></pre>\n\n<p>Next, you can declare a form, like above, but you can use <code>GHC.Generics</code> to automatically derive a <code>FromForm</code> instance:</p>\n\n<pre><code>{-# LANGUAGE DeriveGeneric     #-}\n\nmodule Html.Contact where\n\nimport           GHC.Generics\nimport           Servant\nimport           Web.FormUrlEncoded          (FromForm)\n\ndata ContactForm = ContactForm\n { cname    :: !T.Text\n , cemail   :: !T.Text\n , cmessage :: !T.Text\n } deriving (Eq, Show, Generic)\n\ninstance FromForm ContactForm\n</code></pre>\n\n<p>After that, you can use the regular <code>FormUrlEncoded</code> ContentType from Servant in your endpoint:</p>\n\n<pre><code>type ContactApi = \"contact\" :&gt; ReqBody '[FormUrlEncoded] ContactForm\n                                   :&gt; Post '[HTML] Html\n</code></pre>\n\n<p><strong>Almost forgot: How to render the thing</strong></p>\n\n<p>You will also need a page, probably, where you are displaying your form? Well, the \"name\" attributes have to match the fields in your form (here's how I did it, using <code>Blaze</code>):</p>\n\n<pre><code>contactForm :: H.Html\ncontactForm = H.section ! A.id \"contact\" ! A.class_ \"container contact-us u-full-width u-max-full-width\" $\n  H.div ! A.class_ \"row\" $ do\n    H.div ! A.class_ \"eight columns contact-us-form\" $\n      H.form ! A.method \"post\" ! A.action \"/contact\" $ do\n        H.div ! A.class_ \"row\" $ do\n          H.div ! A.class_ \"six columns\" $\n            H.input ! A.class_ \"u-full-width\" ! A.type_ \"text\" ! A.name \"cname\" ! A.placeholder \"Name\" ! A.id \"nameInput\"\n          H.div ! A.class_ \"six columns\" $\n            H.input ! A.class_ \"u-full-width\" ! A.type_ \"text\" !  A.name \"cemail\" ! A.placeholder \"Email\" ! A.id \"emailInput\"\n        H.textarea ! A.class_ \"u-full-width\" ! A.name \"cmessage\" ! A.placeholder \"Message\" ! A.id \"messageInput\" $ \"\"\n        H.input ! A.class_ \"button u-pull-right\" ! A.type_ \"submit\" !  A.value \"Send\"\n</code></pre>\n"}], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 907, "favorite_count": 2, "accepted_answer_id": 44524290, "answer_count": 2, "score": 8, "last_activity_date": 1497364951, "creation_date": 1475429687, "question_id": 39819729, "link": "https://stackoverflow.com/questions/39819729/handling-regular-form-posts-application-x-www-form-urlencoded-with-servant", "title": "Handling regular form posts (application/x-www-form-urlencoded) with servant", "body": "<p>How can I handle regular form POSTs with Servant? In particular, given an HTML form like</p>\n\n<pre><code>&lt;form action=\"/check\" method=\"post\"&gt;\n  Solution:\n  &lt;input name=\"code\" type=\"text\"&gt;\n  &lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>and</p>\n\n<pre><code>data CheckResult = Correct | Wrong\n\ninstance ToHtml CheckResult\n    ...\n\ncheckCode :: Text -&gt; Handler CheckResult\ncheckCode code = if code == \"secret\" then Correct else Wrong\n</code></pre>\n\n<p>how do I string things together?</p>\n"}, {"tags": ["haskell", "monads", "trace"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475429361, "post_id": 39819495, "comment_id": 66929540, "body": "One option could be using <code>x &lt;- concat &lt;$&gt; mapM (\\l -&gt; tokenize l &quot;&quot;) lines</code> and rewriting <code>tokenize</code> in a monadic way. I&#39;m not too happy with this because we lose the nice streaming performance of <code>concatMap</code>. I wonder if the monadic version can be made somehow to preserve streaming, knowing that we use the writer monad here..."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475429949, "post_id": 39819495, "comment_id": 66929708, "body": "@chi I hadn&#39;t thought of the performance implications. Would it help to defined a <code>concatMapM</code> as a fold?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1475432128, "post_id": 39819495, "comment_id": 66930493, "body": "@user2297560 I don&#39;t think an efficient <code>concatMapM</code> can exist while working on a generic monad. In the specific case of writer... I don&#39;t know."}], "answers": [{"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 1, "last_activity_date": 1475429467, "creation_date": 1475429467, "answer_id": 39819686, "question_id": 39819495, "link": "https://stackoverflow.com/questions/39819495/how-to-use-monad-writer-for-tracing/39819686#39819686", "title": "How to use Monad.Writer for tracing?", "body": "<p>You just need to lift the result of <code>tokenize</code> into the <code>Writer</code>:</p>\n\n<pre><code>tokenize :: T.Text -&gt; T.Text -&gt; W.Writer [Token]\ntokenize t token\n   | T.null t = return $ addToken token []\n   | h == ' ' = return $ addToken token (tokenize r \"\")\n   | h == '\"' = let (t', r') = consumeString r\n                in return $ addToken t' (tokenize r' \"\")\n   | otherwise = return $ tokenize r (T.snoc token h)\n   where h = T.head t\n         r = T.tail t\n</code></pre>\n\n<p>Then <code>parse</code> has to change to handle a monadic result from <code>tokenize</code>:</p>\n\n<pre><code>parse :: [T.Text] -&gt; W.Writer String [Token]\nparse lines = do\n    x &lt;- concat &lt;$&gt; mapM (\\l -&gt; tokenize l \"\") lines\n    W.tell \"hello\"\n    return x\n</code></pre>\n"}], "owner": {"reputation": 2963, "user_id": 1528246, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/f76f3e46a94eb011d85d14bf54425950?s=128&d=identicon&r=PG", "display_name": "rogergl", "link": "https://stackoverflow.com/users/1528246/rogergl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475448472, "creation_date": 1475428052, "last_edit_date": 1475448472, "question_id": 39819495, "link": "https://stackoverflow.com/questions/39819495/how-to-use-monad-writer-for-tracing", "title": "How to use Monad.Writer for tracing?", "body": "<p>My code looks like this:  </p>\n\n<p>I would like to use tell inside the tokenize function in order to write to the same Writer Monad. Is this possible ?</p>\n\n<pre><code>tokenize :: T.Text -&gt; T.Text -&gt; [Token]\ntokenize t token\n   | T.null t = addToken token []\n   | h == ' ' = addToken token (tokenize r \"\")\n   | h == '\"' = let (t', r') = consumeString r\n                in addToken t' (tokenize r' \"\")\n   | otherwise = tokenize r (T.snoc token h)\n   where h = T.head t\n         r = T.tail t\n\nparse :: [T.Text] -&gt; W.Writer String [Token]\nparse lines = do\n    let x = concatMap (\\l -&gt; tokenize l \"\") lines\n    W.tell \"hello\"\n    return x\n\nmain :: IO ()\nmain = do\n    content &lt;- readContent\n    let lines = toTextList content\n    let (res, log) = W.runWriter $ parse lines\n    forM_ res $ \\x -&gt;\n        print x\n    print log\n</code></pre>\n"}, {"tags": ["javascript", "node.js", "algorithm", "haskell", "graph-algorithm"], "comments": [{"owner": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1475420979, "post_id": 39818251, "comment_id": 66926803, "body": "I guess that&#39;s Haskell You can mimic most part of it with ES6 syntax."}, {"owner": {"reputation": 817, "user_id": 4417545, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/05d7e42f3a2ad39ac7e3297be4e911c8?s=128&d=identicon&r=PG&f=1", "display_name": "mortensen", "link": "https://stackoverflow.com/users/4417545/mortensen"}, "reply_to_user": {"reputation": 18798, "user_id": 4543207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed6f11c827fa7cef811f141a84cc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Redu", "link": "https://stackoverflow.com/users/4543207/redu"}, "edited": false, "score": 0, "creation_date": 1475421195, "post_id": 39818251, "comment_id": 66926866, "body": "I just can&#39;t interpret it. I have read it tons of times and still don&#39;t understand it :D"}, {"owner": {"reputation": 61419, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1475431642, "post_id": 39818251, "comment_id": 66930289, "body": "which of them gives you problems? <code>nub</code> removes duplicates and keeps only one of each group of duplicates in a list; <code>and [condition | agent &lt;- agents]</code> means the <code>condition</code> holds for each <code>agent</code> among <code>agents</code>; <code>bl part x = head [b | b &lt;- part, elem x b]</code> returns first block in partition that contains <code>x</code>; and <code>rel2part (x:xs) r = ( x : [y | y &lt;- xs, r x y] ) : rel2part [y | y &lt;- xs, not (r x y)] r</code> partitions list into blocks of elements equivalent to each other according to a given relation <code>r</code>."}, {"owner": {"reputation": 817, "user_id": 4417545, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/05d7e42f3a2ad39ac7e3297be4e911c8?s=128&d=identicon&r=PG&f=1", "display_name": "mortensen", "link": "https://stackoverflow.com/users/4417545/mortensen"}, "edited": false, "score": 0, "creation_date": 1475433874, "post_id": 39818251, "comment_id": 66931089, "body": "Maybe I also don&#39;t fully understand the algorithm. I have tried reading about it, but I can still not implement it"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1475444131, "post_id": 39818251, "comment_id": 66934239, "body": "I didn&#39;t spend much time reading those slides, however I believe the algorithm proposed isn&#39;t as efficient. If I did not misunderstood the description they take a block <code>B</code>, for each node they compute all reachable agents and they partition <code>B</code> into subblocks <code>B1</code>, ..., <code>Bn</code> that reach the same sets of agents, and then repeat for the next block in the partition.  This is somewhat the reverse of what you usually do with partition refinement algorithms. You usually take a block <code>S</code>, compute the preimage of <code>S</code> and track the blocks <code>B1</code>,...,<code>Bn</code> that you reached. Every block <code>Bi</code> can be"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1475444250, "post_id": 39818251, "comment_id": 66934278, "body": "split into two subsets: nodes of <code>Bi</code> that you have found in the preimage of <code>S</code>, and those that do not. Here comes the optimization that makes the algorithm O(nlogn): if <code>Bi</code>, as a whole, was already used as a splitter previously at this point you can choose one of the two subblocks and ignore it for further splitting operations, preserving correctness of the result. By ignoring the bigger of the two you always at least halve the size of the blocks -&gt; nlog n instead of n^2."}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1475444320, "post_id": 39818251, "comment_id": 66934291, "body": "(Obviously I have simplified a lot in the above comments, I just wanted to give the fundamental ideas since part of my thesis was developing partition refinement algorithms for Markov models of PEPA and implementing the algorithms into the PEPA Eclise plug-in)."}, {"owner": {"reputation": 817, "user_id": 4417545, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/05d7e42f3a2ad39ac7e3297be4e911c8?s=128&d=identicon&r=PG&f=1", "display_name": "mortensen", "link": "https://stackoverflow.com/users/4417545/mortensen"}, "edited": false, "score": 0, "creation_date": 1475471351, "post_id": 39818251, "comment_id": 66939819, "body": "Thank you! I am not quite sure how to compute the preimage of <code>S</code>, but I will read about it. Can you refer to any code snippets that implement the algorithm you just described?"}], "owner": {"reputation": 817, "user_id": 4417545, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/05d7e42f3a2ad39ac7e3297be4e911c8?s=128&d=identicon&r=PG&f=1", "display_name": "mortensen", "link": "https://stackoverflow.com/users/4417545/mortensen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 179, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475471788, "creation_date": 1475420160, "last_edit_date": 1475471788, "question_id": 39818251, "link": "https://stackoverflow.com/questions/39818251/implementing-partition-refinement-algorithm", "title": "Implementing partition refinement algorithm", "body": "<p>I have some nodes and edges</p>\n\n<pre><code>nodes = [\n  { id: 'n1', propositions: ['p'] },\n  { id: 'n2', propositions: ['p'] },\n  { id: 'n3', propositions: ['p'] }\n];\nedges = [\n  { source: 'n1', target: 'n2' },\n  { source: 'n2', target: 'n1' },\n  { source: 'n1', target: 'n3' },\n  { source: 'n2', target: 'n3' }\n];\n</code></pre>\n\n<p>As seen in the data, the two nodes <code>n1</code> and <code>n2</code> are pointing against each other, and both <code>n1</code> and <code>n2</code> are each pointing at <code>n3</code>.</p>\n\n<p>I am trying to implement the algorithm on <a href=\"http://homepages.cwi.nl/~jve/courses/lai0506/LAI11.pdf#page=25\" rel=\"nofollow\">http://homepages.cwi.nl/~jve/courses/lai0506/LAI11.pdf#page=25</a> in JavaScript.</p>\n\n<p>From what I understand, the initial partition will have only one block that contains all three nodes <code>n1</code>, <code>n2</code>, and <code>n3</code>. The second partition will have <code>n1</code> and <code>n2</code> in one subblock and <code>n3</code> in another subblock. The third partition will be the same as the second partition, so the iteration will halt. And as I have understood, all nodes in a subblock are redundant except of one, so I can just remove them and keep only one.</p>\n\n<p>I have first created an initial partition Pi_0 by grouping the nodes with the same propositions. Then I move onto iterating until no changes are made since the last partition.</p>\n\n<p>What I have come up with so far is</p>\n\n<pre><code>/**\n * Initial partition\n **/\n\n// blocks in initial partition\nconst partition = {};\n\n// group nodes into blocks based on propositions\nnodes.forEach(function (node) {\n  // use propositions as key\n  const key = node.propositions.sort().join();\n\n  // create block if it does not already exists\n  if (!partition[key]) {\n    partition[key] = [];\n  }\n\n  // add node to block\n  partition[key].push(node);\n});\n\n/**\n * Iterate until P_{i} = P_{i - 1}\n **/\n\n// repeat until Pi_{i} = Pi_{i-1}\nwhile (true) {\n  // get ready to partition each block in the partition into subblocks\n  const newPartition = {};\n\n  // go through each block in partition\n  Object.keys(partition).forEach(function (blockName) {\n    // get block by blockName\n    const nodesInBlock = partition[blockName];\n\n    // go through each node in the block\n    nodesInBlock.forEach(function (sourceNode) {\n        // ...\n        // ...\n\n        // create subblock if it doesn't already exists\n        if (!newPartition[key]) {\n          newPartition[key] = [];\n        }\n\n        // add node to subblock\n        newPartition[key].push(sourceNode);\n      });\n    }\n  });\n\n  // if nothing changed\n  if (Object.keys(partition).length === Object.keys(newPartition).length) {\n    break;\n  } else {\n    partition = newPartition;\n  }\n}\n}\n</code></pre>\n\n<p>But I don't know what to do instead of the snippet where I wrote <code>...</code>.</p>\n\n<p>I guess I should get the name of the block to which the node points (i.e. the target node's block name), and then create a key from the source node's block name and the target node's block name. I just don't know how. From <a href=\"http://homepages.cwi.nl/~jve/courses/lai0506/LAI11.pdf#page=27\" rel=\"nofollow\">page 27</a>, the implementation is described in Haskell, but I don't understand Haskell, so it won't help me.</p>\n\n<h1>Edit</h1>\n\n<p>I guess the partitions should look like this</p>\n\n<pre><code>// data:\nnodes = [\n  { id: 'n1', propositions: ['p'] },\n  { id: 'n2', propositions: ['p'] },\n  { id: 'n3', propositions: ['p'] }\n];\nedges = [\n  { source: 'n1', target: 'n2' },\n  { source: 'n2', target: 'n1' },\n  { source: 'n1', target: 'n3' },\n  { source: 'n2', target: 'n3' }\n];\n\n// initial partition\ninitialPartition = [\n  { id: 'n1', propositions: ['p'] },\n  { id: 'n2', propositions: ['p'] },\n  { id: 'n3', propositions: ['p'] }\n];\n\n// second partition\nsecondPartition = [\n  [\n    { id: 'n1', propositions: ['p'] },\n    { id: 'n2', propositions: ['p'] }\n  ],\n  { id: 'n3', propositions: ['p'] }\n];\n\n// third partition\nthirdPartition = [\n  [\n    { id: 'n1', propositions: ['p'] },\n    { id: 'n2', propositions: ['p'] }\n  ],\n  { id: 'n3', propositions: ['p'] }\n];\n</code></pre>\n\n<p>So because the second and third are equal, the iteration process halts.</p>\n"}, {"tags": ["parsing", "haskell", "time"], "answers": [{"comments": [{"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475477433, "post_id": 39818693, "comment_id": 66941845, "body": "I am getting <code>Not in scope: &#39;parseTimeOrError&#39;</code>, which module to import?"}, {"owner": {"reputation": 12359, "user_id": 1173513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d690004dc97e147f64c8ce8408adeba9?s=128&d=identicon&r=PG", "display_name": "tomahh", "link": "https://stackoverflow.com/users/1173513/tomahh"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475481022, "post_id": 39818693, "comment_id": 66943508, "body": "I imported only <code>Data.Time</code>. Your haskell version may be outdated. You safely can replace <code>parseTimeOrError True</code> with a call to <a href=\"https://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-Format.html#v:parseTime\" rel=\"nofollow noreferrer\"><code>parseTime</code></a> if you don&#39;t want to update haskell version."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475502236, "post_id": 39818693, "comment_id": 66955637, "body": "With that change I am getting the error: <code>Couldn&#39;t match expected type &#39;UTCTime&#39; with actual type </code>Maybe t0&#39;    In the return type of a call of &#39;understandTime&#39;`"}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475503422, "post_id": 39818693, "comment_id": 66956385, "body": "got it working with <code>time :: Maybe UTCTime</code>, if you update your answer, I&#39;ll accept it."}, {"owner": {"reputation": 12359, "user_id": 1173513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d690004dc97e147f64c8ce8408adeba9?s=128&d=identicon&r=PG", "display_name": "tomahh", "link": "https://stackoverflow.com/users/1173513/tomahh"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475503482, "post_id": 39818693, "comment_id": 66956417, "body": "answer is valid haskell code, using ghc 8.0.1. I&#39;d rather keep the up-to-date code on SO. <code>parseTime</code> is documented as outdated."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475513014, "post_id": 39818693, "comment_id": 66962518, "body": "fair enough but then please mention that it will work only with ghc 8.0.1. in the answer. It may not work with future ghc also."}, {"owner": {"reputation": 595, "user_id": 2184571, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/MhDTj.jpg?s=128&g=1", "display_name": "Jaakko Luttinen", "link": "https://stackoverflow.com/users/2184571/jaakko-luttinen"}, "edited": false, "score": 0, "creation_date": 1513091110, "post_id": 39818693, "comment_id": 82512360, "body": "What is the purpose of the first <code>True</code> argument?"}, {"owner": {"reputation": 12359, "user_id": 1173513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d690004dc97e147f64c8ce8408adeba9?s=128&d=identicon&r=PG", "display_name": "tomahh", "link": "https://stackoverflow.com/users/1173513/tomahh"}, "edited": false, "score": 0, "creation_date": 1513245681, "post_id": 39818693, "comment_id": 82582225, "body": "Weather to accept or not arguments with leading/trailing white spaces."}], "tags": [], "owner": {"reputation": 12359, "user_id": 1173513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d690004dc97e147f64c8ce8408adeba9?s=128&d=identicon&r=PG", "display_name": "tomahh", "link": "https://stackoverflow.com/users/1173513/tomahh"}, "is_accepted": true, "score": 9, "last_activity_date": 1475423585, "last_edit_date": 1475423585, "creation_date": 1475423031, "answer_id": 39818693, "question_id": 39818213, "link": "https://stackoverflow.com/questions/39818213/how-to-parse-a-time-value-of-type-utctime-from-string-in-haskell/39818693#39818693", "title": "How to parse a time value of type UTCTime from string in Haskell?", "body": "<pre><code>import Data.Time\n\ntimeFormat = \"%H:%M:%S\"\nunderstandTime = parseTimeOrError True defaultTimeLocale timeFormat\n\ntime :: UTCTime\ntime = understandTime \"10:30:20\"\n</code></pre>\n\n<hr>\n\n<pre><code>\u03bb&gt; time\n1970-01-01 10:30:20 UTC\n</code></pre>\n\n<p>Let's break down what's going on:</p>\n\n<ul>\n<li><code>timeFormat</code> is simply a string, describing how we expect the time to be passed to us.</li>\n<li>we partially apply <a href=\"https://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-Format.html#v:parseTimeOrError\" rel=\"noreferrer\"><code>parseTimeOrError</code></a>, using <a href=\"https://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-Format.html#v:defaultTimeLocale\" rel=\"noreferrer\"><code>defaultTimeLocale</code></a> for the locale, and previously defined <code>timeFormat</code> for the expected format.</li>\n<li>We now have a <code>understandTime</code> function, that can take in a time as a <code>String</code>. When using it, we need to explicitly set the expected output type to <code>UTCTime</code> (this is what <code>time :: UTCTime</code> does). If we were to use <code>understandTime</code> within the context of a function that already expects a <code>UTCTime</code>, this would be unnecessary (for example <code>addUTCTime 1000 (understandTime \"10:30:20\")</code>)</li>\n<li>We get back <code>time</code>. Note that the year, day, month and timezone default to 1970-01-01 and UTC because we do not explicitly read them in <code>timeFormat</code>.</li>\n</ul>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1457, "favorite_count": 0, "accepted_answer_id": 39818693, "answer_count": 1, "score": 8, "last_activity_date": 1555861735, "creation_date": 1475419932, "last_edit_date": 1555861735, "question_id": 39818213, "link": "https://stackoverflow.com/questions/39818213/how-to-parse-a-time-value-of-type-utctime-from-string-in-haskell", "title": "How to parse a time value of type UTCTime from string in Haskell?", "body": "<p>This is a follow-up question to <a href=\"https://stackoverflow.com/questions/39815742/haskell-how-to-add-minutes-to-current-time-using-data-time\">the one I asked</a> just a little while ago.</p>\n\n<p>I couldn't find a single example (sorry for my Google skills) on the Haskell site which shows how to use the <code>Data.Time</code> functions to convert a formatted <code>String</code> to <code>UTCTime</code> and then be able to add/subtract minutes/seconds from that and convert back the <code>UTCTime</code> to formatted <code>String</code>.</p>\n\n<p>I am looking for an example that shows how to convert a <code>String</code> (e.g. like <code>\"10:20:30\"</code> to <code>UTCTime</code> and then add 1000 seconds to that time. How to do this Haskell using the <code>Data.Time</code> library without using IO at all?</p>\n\n<p>The type of the function should be <code>FormatTime -&gt; String -&gt; UTCTime</code>.</p>\n\n<p>The function should use <code>TimeLocale</code> or <code>FormatTime</code> as locale/formatting is needed.</p>\n\n<p>There are so many functions in the library and so many types that it just baffling. <code>readTime</code>, <code>TimeLocale</code>, <code>ParseTime t</code>, <code>NominalDiffTime</code>, <code>Time</code> and what not.</p>\n\n<p>Please do not just point to docs on <a href=\"https://downloads.haskell.org/~ghc/6.12.2/docs/html/libraries/time-1.1.4/Data-Time-Format.html#t%3AFormatTime\" rel=\"noreferrer\">the Haskell site</a>. Most of the docs there are just a dump of type signatures from the source code, without almost any examples. Sorry if this is coming as rant, but I have spent a lot of time trying to figure out something from those docs.</p>\n\n<p>Compare this to <a href=\"https://docs.python.org/2/library/time.html\" rel=\"noreferrer\">Python docs</a> on time. So many beautiful examples.\nThank god, there is SO.</p>\n"}, {"tags": ["haskell", "time", "clock"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 4, "creation_date": 1475402142, "post_id": 39815742, "comment_id": 66922171, "body": "Time is a prime example of where you&#39;d need <a href=\"https://hackage.haskell.org/package/vector-space\" rel=\"nofollow noreferrer\">vector-space</a>, which distinguishes between points (timestamps) and vectors (time intervals). I suspect this library is lacking this basic functionality. It seems you could use <code>dayFractionToTimeOfDay</code> and its inverse, but you can&#39;t cross midnights that way."}, {"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1475407215, "post_id": 39815742, "comment_id": 66923214, "body": "As pointed by Sibi there is a distinction between <code>UTCTime</code> (timestamp) and <code>NominalDiffTime</code> (duration). Maybe they indeed could do with vector-spaces instances."}], "answers": [{"comments": [{"owner": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1475407032, "post_id": 39816074, "comment_id": 66923174, "body": "Note <code>diffUtcTime</code> as a different signature than <code>addUTCTime</code> ."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 20862, "user_id": 376113, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d3a5bd12fe6d876527a3cf4ac0de5fc6?s=128&d=identicon&r=PG", "display_name": "mb14", "link": "https://stackoverflow.com/users/376113/mb14"}, "edited": false, "score": 0, "creation_date": 1475407253, "post_id": 39816074, "comment_id": 66923225, "body": "@mb14 Oh yeah, you are right. Well, then for subtracting just have <code>hundredMinutes</code> as <code>- 100 * 60</code>. :)"}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475410827, "post_id": 39816074, "comment_id": 66923993, "body": "I don&#39;t want to use IO monad, I have a time value in the program itself. Also I don&#39;t need only the current time. Edited to reflect this. Sorry for not making it clear earlier."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475413464, "post_id": 39816074, "comment_id": 66924704, "body": "@mntk123 You don&#39;t need to use IO monad.  But you need a function for converting your time to either <code>LocalTime</code> or <code>UTCTime</code>."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475414696, "post_id": 39816074, "comment_id": 66925064, "body": "@Sibi Thanks, but how to convert a string to <code>UTCTime</code>? I found a function <code>readTime</code> but couldn&#39;t get it to work. It seems to require <code>TimeLocale</code> and then it returns <code>ParseTime t</code>. Whereas <code>addUTCTime</code> requires something else altogether. It&#39;s quite confusing and frustrating."}, {"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475416877, "post_id": 39816074, "comment_id": 66925630, "body": "@mntk123 depends on the string and the amount of information it holds. Most likely you have to write your own function for that depending on the string."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 2, "creation_date": 1475417723, "post_id": 39816074, "comment_id": 66925847, "body": "@Sibi Thanks again. The most frustrating thing with the docs found on Haskell site is that they don&#39;t show even a single example in most cases :( It sucks. Compare that to Python. Anyway, I will try. I will ask a separate question for this."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475429851, "post_id": 39816074, "comment_id": 66929680, "body": "@mntk123 So true. Sometimes clicking the &quot;source&quot; link to access the library code can be more enlightening than the docs themselves. (Some packages do have nice docs, though.)"}], "tags": [], "owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "is_accepted": false, "score": 7, "last_activity_date": 1475407282, "last_edit_date": 1475407282, "creation_date": 1475404319, "answer_id": 39816074, "question_id": 39815742, "link": "https://stackoverflow.com/questions/39815742/how-to-add-minutes-to-current-time-using-data-time-utctime/39816074#39816074", "title": "How to add minutes to current time using Data.Time.UTCTime?", "body": "<p>A sample demo of adding 100 minutes:</p>\n\n<pre><code>\u03bb&gt; import Data.Time\n\u03bb&gt; currentTime &lt;- getCurrentTime\n\u03bb&gt; currentTime\n2016-10-02 10:27:03.30961 UTC\n\u03bb&gt; currentZone &lt;- getCurrentTimeZone\n\u03bb&gt; currentZone\nIST\n\u03bb&gt; utcToLocalTime currentZone currentTime\n2016-10-02 15:57:03.30961\n\u03bb&gt; let hundredMinutes = 100 * 60\n\u03bb&gt; addUTCTime hundredMinutes currentTime\n2016-10-02 12:07:03.30961 UTC\n\u03bb&gt; let newTime = addUTCTime hundredMinutes currentTime\n\u03bb&gt; utcToLocalTime currentZone newTime\n2016-10-02 17:37:03.30961\n</code></pre>\n\n<p>The <a href=\"https://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-Clock.html#v:addUTCTime\" rel=\"nofollow\">addUTCTime</a> function is used for adding 100 minutes. <strike>An equivalent function <a href=\"https://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-Clock.html#v:diffUTCTime\" rel=\"nofollow\">for subtracting</a> is also available.</strike></p>\n"}, {"comments": [{"owner": {"reputation": 12359, "user_id": 1173513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d690004dc97e147f64c8ce8408adeba9?s=128&d=identicon&r=PG", "display_name": "tomahh", "link": "https://stackoverflow.com/users/1173513/tomahh"}, "edited": false, "score": 0, "creation_date": 1475410452, "post_id": 39816884, "comment_id": 66923904, "body": "I&#39;m still a beginner with haskell, and I&#39;m not sure the <code>&gt;&gt;= (\\t -&gt; ...)</code> notation is the best way to write this. Anyone has recommandations?"}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475417800, "post_id": 39816884, "comment_id": 66925867, "body": "what is time in <code>addMinutes 10 time</code>?"}, {"owner": {"reputation": 12359, "user_id": 1173513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d690004dc97e147f64c8ce8408adeba9?s=128&d=identicon&r=PG", "display_name": "tomahh", "link": "https://stackoverflow.com/users/1173513/tomahh"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475417881, "post_id": 39816884, "comment_id": 66925889, "body": "The &quot;given time&quot; mentioned in the question."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475417928, "post_id": 39816884, "comment_id": 66925907, "body": "What is the type of that time object? String? IO String? or what?"}, {"owner": {"reputation": 12359, "user_id": 1173513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d690004dc97e147f64c8ce8408adeba9?s=128&d=identicon&r=PG", "display_name": "tomahh", "link": "https://stackoverflow.com/users/1173513/tomahh"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 1, "creation_date": 1475418032, "post_id": 39816884, "comment_id": 66925938, "body": "You can figure that out yourself using <code>:t addMinutes</code> within ghci. In this instance, it outputs <code>addMinutes :: NominalDiffTime -&gt; UTCTime -&gt; UTCTime</code>, so time needs to be a <code>UTCTime</code>."}, {"owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 0, "creation_date": 1475418544, "post_id": 39816884, "comment_id": 66926077, "body": "Yes, thanks but how to construct <code>UTCTime</code> in the source code using a string?"}, {"owner": {"reputation": 12359, "user_id": 1173513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d690004dc97e147f64c8ce8408adeba9?s=128&d=identicon&r=PG", "display_name": "tomahh", "link": "https://stackoverflow.com/users/1173513/tomahh"}, "reply_to_user": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "edited": false, "score": 1, "creation_date": 1475418600, "post_id": 39816884, "comment_id": 66926087, "body": "This is a complex topic. You probably should post another question if you want an answer to that."}], "tags": [], "owner": {"reputation": 12359, "user_id": 1173513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d690004dc97e147f64c8ce8408adeba9?s=128&d=identicon&r=PG", "display_name": "tomahh", "link": "https://stackoverflow.com/users/1173513/tomahh"}, "is_accepted": false, "score": 0, "last_activity_date": 1475418088, "last_edit_date": 1475418088, "creation_date": 1475410417, "answer_id": 39816884, "question_id": 39815742, "link": "https://stackoverflow.com/questions/39815742/how-to-add-minutes-to-current-time-using-data-time-utctime/39816884#39816884", "title": "How to add minutes to current time using Data.Time.UTCTime?", "body": "<p>You can use <code>Data.Time.Clock.getCurrentTime</code> to fetch the current time. This returns <code>IO UTCTime</code>.</p>\n\n<p>You can then use <code>Data.Time.Clock.addUTCTime</code> to add minutes to this previously fetched time.</p>\n\n<pre><code>import Data.Time\n\ncurrentTimePlusMinutes minutes = getCurrentTime \n  &gt;&gt;= (\\time -&gt; return (addUTCTime (minutes * 60) time))\n</code></pre>\n\n<hr>\n\n<p>If you don't want to use the current time, you can then simply do</p>\n\n<pre><code> addMinutes :: NominalDiffTime -&gt; UTCTime -&gt; UTCTime\n addMinutes minutes = addUTCTime (minutes * 60)\n\n \u03bb&gt; addMinutes 10 time\n 2016-10-02 12:41:09.68297 UTC\n</code></pre>\n"}], "owner": {"reputation": 845, "user_id": 4725700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b517b68a2f6eee6dc160661a0e78e4ce?s=128&d=identicon&r=PG&f=1", "display_name": "mntk123", "link": "https://stackoverflow.com/users/4725700/mntk123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1284, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1597782458, "creation_date": 1475401572, "last_edit_date": 1597782458, "question_id": 39815742, "link": "https://stackoverflow.com/questions/39815742/how-to-add-minutes-to-current-time-using-data-time-utctime", "title": "How to add minutes to current time using Data.Time.UTCTime?", "body": "<p>I want to add/subtract given number of minutes to/from given given time and find out the resulting time.</p>\n\n<p>e.g. Suppose the given time is 11:30AM and number of minutes to add are 100 then the resulting time is 01:10PM</p>\n\n<p>How to do it in Haskell using the Data-Time library? I tried reading <a href=\"https://hackage.haskell.org/package/time-1.6.0.1/docs/Data-Time-LocalTime.html\" rel=\"nofollow\">the docs on the Haskell site</a> but couldn't get almost anything out of it.</p>\n\n<p>There is no example shown on that documentation site. Also the <a href=\"https://wiki.haskell.org/Cookbook/Dates_And_Time\" rel=\"nofollow\">cookbook on the Haskell site</a> doesn't contain any example for time calculations.</p>\n\n<p>Edit: no need for current time, it should work for any given time. Time may be given as a string like \"11:30\".</p>\n"}, {"tags": ["haskell", "interpreter"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1475402477, "post_id": 39815552, "comment_id": 66922257, "body": "Is this an exercise where you&#39;ve been given A, B, C and told to go implement X, Y, Z? Or are you designing the whole thing yourself?"}, {"owner": {"reputation": 1947, "user_id": 1475898, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/09d3a80a2c8bf17d4a755fcfd955efd8?s=128&d=identicon&r=PG", "display_name": "Comforse", "link": "https://stackoverflow.com/users/1475898/comforse"}, "reply_to_user": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1475402559, "post_id": 39815552, "comment_id": 66922277, "body": "@MathematicalOrchid it&#39;s an exercise, yes"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 0, "creation_date": 1475403070, "post_id": 39815552, "comment_id": 66922371, "body": "Can you tell us specifically which bits you&#39;ve been given and what they&#39;re supposed to mean? (E.g., it looks like <code>Context</code> is a pair of maps \u2014 but what are those maps supposed to <i>mean</i>? Where does <code>:+:</code> come from?)"}, {"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 2, "creation_date": 1475404296, "post_id": 39815552, "comment_id": 66922583, "body": "In fairness, &quot;write an interpreter&quot; would be a major undertaking in C# or Java. But in Haskell it&#39;s a small beginner&#39;s exercise. Maybe <i>that</i> is why people think Haskell is a &quot;hard language&quot;. ;-)"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475429681, "post_id": 39815552, "comment_id": 66929641, "body": "If <code>(+)</code> is in the environment, you probably need to define <code>evalExpr (e1 :+: e2)</code> not using the Haskell <code>+</code> but fetching the meaning of <code>+</code> from the environment. So, something like <code>Intepreter $ \\ctx -&gt; let plus = lookupEnv ctx &quot;+&quot; in ...</code> for some custom <code>lookupEnv</code>. You also need to add functions to your values."}], "answers": [{"tags": [], "owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "is_accepted": false, "score": 1, "last_activity_date": 1475404244, "creation_date": 1475404244, "answer_id": 39816063, "question_id": 39815552, "link": "https://stackoverflow.com/questions/39815552/haskell-define-interpreter-for-language/39816063#39816063", "title": "Haskell: define interpreter for language", "body": "<p>Alright, I'll take a stab at this...</p>\n\n<p>So it looks like a <code>Context</code> consists of a pair of maps. It appears the first map lets you look up a variable's value from its name. The second one lets you look up a function name and get the corresponding executable code for it.</p>\n\n<p>You're using <code>Interpreter</code> as if it's a monad; I don't know whether it actually is, but it looks plausible.</p>\n\n<p>So <code>initCtx</code> starts off with no variables defined (<code>Map.empty</code>), and presumably you're meant to put a bunch of predefined functions like <code>+</code> in the second map.</p>\n\n<p>Looking at the definition for <code>Primitive</code>, it takes a list of <code>Value</code> and returns an <code>Interpreter</code> computation. So I guess it looks something like</p>\n\n<pre><code>addExpr :: [Value] -&gt; Interpreter Value\naddExpr [e1, e2] = do\n  v1 &lt;- eval e1\n  v2 &lt;- eval e2\n  return (v1 + v2)\n</code></pre>\n\n<p>and then you could write <code>map.fromList [... (\"+\", addExpr) ...]</code>.</p>\n\n<p>Except that's not quite right either. <code>Value</code> isn't a number type; what happens if, say, <code>v1 = StringVal</code>? For that matter, what if somebody calls \"+\" with a different number of arguments? We need some error checking here.</p>\n\n<p>I'm <em>guessing</em> the thing you're looking for probably looks something like this:</p>\n\n<pre><code>checkInt :: Value -&gt; Interpreter Int\ncheckInt (IntVal x) = return x\ncheckInt _          = Interpreter $ ctx -&gt; Left \"Not an integer.\"\n\naddExpr :: [Value] -&gt; Interpreter Value\naddExpr [expr1, expr2] do\n  val1 &lt;- eval expr1\n  int1 &lt;- checkInt val1\n\n  val2 &lt;- eval expr2\n  int2 &lt;- checkInt val2\n\n  return (IntVal $ int1 + int2)\naddExpr _ = Interpreter $ ctx -&gt; error \"Wrong number of arguments.\"\n</code></pre>\n"}], "owner": {"reputation": 1947, "user_id": 1475898, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/09d3a80a2c8bf17d4a755fcfd955efd8?s=128&d=identicon&r=PG", "display_name": "Comforse", "link": "https://stackoverflow.com/users/1475898/comforse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475404244, "creation_date": 1475399863, "last_edit_date": 1475403190, "question_id": 39815552, "link": "https://stackoverflow.com/questions/39815552/haskell-define-interpreter-for-language", "title": "Haskell: define interpreter for language", "body": "<p>As part of defining a language interpreter I have the following definition:</p>\n\n<pre><code>initCtx :: Context\ninitCtx = (Map.empty, initEnv)\n  where initEnv =\n          Map.fromList [ ...\n                       , (\"+\", undefined)\n                         ...\n                       ]\n</code></pre>\n\n<p>And for the sum operation I have this:</p>\n\n<pre><code>evalExpr :: Expr -&gt; Interpreter Value\nevalExpr (e1 :+: e2) = do v1 &lt;- eval e1\n                      v2 &lt;- eval e2\n                      return Interpreter $ (v1 + v2)\n</code></pre>\n\n<p>The exalExpr is made by me, but what do I need to write in place of <code>undefined</code> so that the expression is executed? Or, perhaps, I am looking to the wrong thing ? I have more operations of course, but I just need to have an example. I am veeeeery new to Haskell, I am practically required to deal with it.</p>\n\n<p>Thanks!</p>\n\n<p><strong>EDIT:</strong></p>\n\n<pre><code>type Env = Map Ident Value\ntype Primitive = [Value] -&gt; Interpreter Value\ntype PEnv = Map FunName Primitive\ntype Context = (Env, PEnv)\n</code></pre>\n\n<p>Here's <code>Expr</code>:</p>\n\n<pre><code>data Expr = Number Int\n          | String String\n          | Array [Expr]\n          | Undefined\n          | TrueConst\n          | FalseConst\n          | Var Ident\n          | Compr ArrayFor Expr\n          | Call FunName [Expr]\n          | Assign Ident Expr\n          | Comma Expr Expr\n          deriving (Eq, Read, Show)\n</code></pre>\n\n<p>And <code>Interpreter</code></p>\n\n<pre><code>newtype Interpreter a = Interpreter {runInterpreter :: Context -&gt; Either Error (a, Env)}\n</code></pre>\n\n<p>And Value:</p>\n\n<pre><code>data Value = IntVal Int\n           | UndefinedVal\n           | TrueVal | FalseVal\n           | StringVal String\n           | ArrayVal [Value]\n           deriving (Eq, Show)\n</code></pre>\n"}, {"tags": ["haskell", "pandoc"], "comments": [{"owner": {"reputation": 12941, "user_id": 292731, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e3f90adedab79538799e2375a9731920?s=128&d=identicon&r=PG", "display_name": "Justin L.", "link": "https://stackoverflow.com/users/292731/justin-l"}, "edited": false, "score": 0, "creation_date": 1475460974, "post_id": 39815375, "comment_id": 66937646, "body": "What happens when you try using <code>writeMarkdown</code> without specifying <code>writerTemplate</code> ?"}], "answers": [{"tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": false, "score": 2, "last_activity_date": 1475498049, "creation_date": 1475498049, "answer_id": 39831791, "question_id": 39815375, "link": "https://stackoverflow.com/questions/39815375/creating-a-document-with-pandoc/39831791#39831791", "title": "Creating a document with Pandoc", "body": "<p>You are not setting a correct <code>writerTemplate</code>.</p>\n\n<p>You can tweak the template yourself, but should start from the default ones to understand their required structure. This is especially important for the ODT exporter, where the template needs to contain a quite verbose XML prelude.</p>\n\n<p>I was able to get your code working by first loading the default templates, and then populating that with your document:</p>\n\n<pre><code>main = do\n    Right odtTemplate &lt;- getDefaultTemplate Nothing \"odt\"\n    doc &lt;- writeODT def{ writerStandalone = True\n                       , writerTemplate = odtTemplate\n                       }\n                    doctest\n    Byt.writeFile \"test.odt\" doc\n\n    Right mdTemplate &lt;- getDefaultTemplate Nothing \"markdown\"\n    let doc2 = writeMarkdown def{ writerStandalone = True\n                                , writerTemplate = mdTemplate \n                                } \n                             doctest\n    writeFile \"test.txt\" doc2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2337, "user_id": 3595992, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a8fc8a00391b1282338f66de57e3fea0?s=128&d=identicon&r=PG&f=1", "display_name": "JeanJouX", "link": "https://stackoverflow.com/users/3595992/jeanjoux"}, "is_accepted": true, "score": 1, "last_activity_date": 1475620253, "creation_date": 1475620253, "answer_id": 39862759, "question_id": 39815375, "link": "https://stackoverflow.com/questions/39815375/creating-a-document-with-pandoc/39862759#39862759", "title": "Creating a document with Pandoc", "body": "<p>You have enabled the option <code>writerStandalone</code> which require a template to be defined to work properly. Personally, I don't use templates and I set the <code>writerStandalone</code> option to <code>False</code></p>\n\n<p>To make it work, use these <code>WriterOptions</code> for the plain text writer : </p>\n\n<pre><code>let textfile = writePlain WriterOptions{  writerStandalone=False\n                                        , writerExtensions=plainExtensions\n                                        , writerWrapText=True\n                                        , writerColumns=80}  pandoc\n</code></pre>\n\n<p>for the docx writer : </p>\n\n<pre><code>docxfile &lt;- writeDocx WriterOptions{ writerStandalone=False\n                                   , writerReferenceDocx=Nothing\n                                   , writerUserDataDir=Nothing\n                                   , writerHighlight        = False\n                                   }  pandoc\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 5459759, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3cbbdd3ca3da640706b554b4e3483d81?s=128&d=identicon&r=PG&f=1", "display_name": "Vigo", "link": "https://stackoverflow.com/users/5459759/vigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 39862759, "answer_count": 2, "score": 3, "last_activity_date": 1475620253, "creation_date": 1475398391, "last_edit_date": 1475498082, "question_id": 39815375, "link": "https://stackoverflow.com/questions/39815375/creating-a-document-with-pandoc", "title": "Creating a document with Pandoc", "body": "<p>I would like to create a <strong>Haskell</strong> program to automatically generate documents with <strong>Pandoc</strong>. </p>\n\n<p>I created a small example document with the data types provided by <a href=\"https://hackage.haskell.org/package/pandoc-types-1.16.1/docs/Text-Pandoc-Definition.html#t:Pandoc\" rel=\"nofollow\">Pandoc</a> but when I launch my program, the ODT document is empty (But with the title <code>My own test file</code> in the properties) and the text file only contain the word <code>Template</code>.</p>\n\n<p>This is the code snippet of my program : </p>\n\n<pre><code>import Text.Pandoc\nimport qualified Data.ByteString.Lazy as Byt\nimport Data.Map (fromList)\n\nmain = do\n  doc &lt;- writeODT WriterOptions{ writerStandalone=True\n                               , writerReferenceODT=Nothing\n                               , writerUserDataDir=Nothing\n                               , writerTemplate=\"Template\"}  doctest\n  let doc2 = writeMarkdown WriterOptions{ writerStandalone=True\n                                        , writerTemplate=\"Template\"}  doctest\n  putStrLn $ show doctest\n  Byt.writeFile \"test.odt\" doc\n  writeFile \"test.txt\" doc2\n\ndoctest = Pandoc ( Meta {unMeta = fromList [(\"title\", MetaInlines [Str \"My own testfile\"])\n                                           ,(\"authors\", MetaInlines [Str \"My Name\"])  ]} )\n                          [Para  [Str \"This\",Space,Str \"is\",Space,Str \"some\",Space,Str \"text\"],HorizontalRule]\n</code></pre>\n\n<p>Both of the text file and the ODT docuement should contain the phrase <code>This is some text</code> and I don't understand why it doesn't appear.</p>\n\n<p><strong>Do you know what I have made wrong ?</strong></p>\n\n<p><strong>Do you have a working example on how to generate a Pandoc file with Haskell ?</strong></p>\n"}, {"tags": ["haskell", "types", "typeclass"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1475417870, "post_id": 39814056, "comment_id": 66925888, "body": "It seems like you want an associated type in the <code>PlaneZip</code> class, and a superclass constraint in <code>PlaneZip</code> stating that type must be an instance of <code>ListZip</code>. Maybe you even want <code>z</code> to be existentially quantified. I&#39;m not sure that <code>p (z (z a)) -&gt; z (z a)</code> is correct, however, because <code>\\(PlaneZipInf zs) -&gt; zs</code> has type <code>PlaneZipInf a -&gt; ListZipInf (ListZipInf a)</code> which doesn&#39;t match the above type."}], "answers": [{"comments": [{"owner": {"reputation": 443, "user_id": 1103912, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5c2f5b8f04199194a829f0e7164740f6?s=128&d=identicon&r=PG", "display_name": "WanderingMathematician", "link": "https://stackoverflow.com/users/1103912/wanderingmathematician"}, "edited": false, "score": 0, "creation_date": 1475412061, "post_id": 39814392, "comment_id": 66924351, "body": "This is close, but I think my problem comes about because I want to make PlaneZipInf and PlaneZipTorus satisfy various typeclasses, so they have to be actual newtypes, not just aliases."}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 3, "last_activity_date": 1475388892, "creation_date": 1475388892, "answer_id": 39814392, "question_id": 39814056, "link": "https://stackoverflow.com/questions/39814056/haskell-specify-the-function-satisfying-a-typeclass-will-take-some-specific-typ/39814392#39814392", "title": "Haskell: Specify the function satisfying a typeclass will take some specific type satisfying a constraint", "body": "<p>I may be misunderstanding your question, but in your case it seems that you will always end up creating plane zippers from nesting list zippers. If that is the case, it seems more advisable to simply do something like the following:</p>\n\n<pre><code>{-# LANGUAGE StandaloneDeriving, FlexibleContexts, UndecidableInstances #-}\n\ndata PlaneZip z a = PlaneZipInf (z (z a))\nderiving instance (Show a, Show (z a), Show (z (z a))) =&gt; Show (PlaneZip z a)\n\ntype PlaneZipInf a = PlaneZip ListZipInf a\ntype PlaneZipTorus a = PlaneZip ListZipTorus a\n\nunwrap :: PlaneZip z a -&gt; z (z a)\nunwrap (PlaneZip zs) = zs\n\ncounit :: Comonad z =&gt; PlaneZip z a -&gt; a\ncounit p =\n    let zs = unwrap p\n      in extract $ extract zs\n</code></pre>\n\n<p>If you really want to be sure that the <code>z</code> in <code>PlaneZip z a</code> is <em>always</em> a <code>ListZip</code>, you can use the following GADT instead</p>\n\n<pre><code>{-# LANGUAGE GADTs #-}\ndata PlaneZip z a where\n  PlaneZip :: ListZip z =&gt; z (z a) -&gt; PlaneZip z a\n</code></pre>\n\n<p>If this is not the case, feel free to reply - I believe there is also something else that could be done here with <a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#associated-data-and-type-families\" rel=\"nofollow\">associated type families</a>, but the solution above is much better.</p>\n"}, {"tags": [], "owner": {"reputation": 153048, "user_id": 9204, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c79937a093ff9e963c563e22cd385f30?s=128&d=identicon&r=PG", "display_name": "Alexey Romanov", "link": "https://stackoverflow.com/users/9204/alexey-romanov"}, "is_accepted": false, "score": 1, "last_activity_date": 1475420507, "creation_date": 1475420507, "answer_id": 39818299, "question_id": 39814056, "link": "https://stackoverflow.com/questions/39814056/haskell-specify-the-function-satisfying-a-typeclass-will-take-some-specific-typ/39818299#39818299", "title": "Haskell: Specify the function satisfying a typeclass will take some specific type satisfying a constraint", "body": "<p>What about simply making <code>z</code> a parameter of the class?</p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses, FunctionalDependencies #-}\n\nclass (ListZip z, Comonad z) =&gt; PlaneZip p z | p -&gt; z where\n  unwrap :: p (z (z a)) -&gt; z (z a)\n  counit :: p (z (z a)) -&gt; a\n  counit p =\n    let zs = unwrap p\n      in extract $ extract zs\n\ninstance PlaneZip PlaneZipInf ListZipInf where\n    unwrap (PlaneZipInf zs) = zs\n</code></pre>\n\n<p><code>| p -&gt; z</code> syntax is a functional dependency; it means <code>z</code> is determined by <code>p</code>, so it's illegal to also have <code>instance PlaneZip PlaneZipInf SomeOtherType</code>. </p>\n"}], "owner": {"reputation": 443, "user_id": 1103912, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5c2f5b8f04199194a829f0e7164740f6?s=128&d=identicon&r=PG", "display_name": "WanderingMathematician", "link": "https://stackoverflow.com/users/1103912/wanderingmathematician"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1475420507, "creation_date": 1475384955, "question_id": 39814056, "link": "https://stackoverflow.com/questions/39814056/haskell-specify-the-function-satisfying-a-typeclass-will-take-some-specific-typ", "title": "Haskell: Specify the function satisfying a typeclass will take some specific type satisfying a constraint", "body": "<p>I think I want to effectively do something like this:</p>\n\n<pre><code>class (forall z. ListZip z) =&gt; PlaneZip p where... --functions using z excluded\n</code></pre>\n\n<p>In short, but more precisely, I want to have</p>\n\n<pre><code>class A p where ... --definition excluded\nclass C p where\n  foo :: (A z) =&gt; p (z a) -&gt; a\ndata Alpha a = ...definition excluded\ndata Beta a = ...definition excluded\ninstance A Alpha where --definition excluded\nbar :: Beta (Alpha a) -&gt; a\ninstance C Beta where\n  foo = bar\n</code></pre>\n\n<p>This is impossible, since <code>foo</code> must allow for <code>z</code> to be anything which is an <code>A</code>, not <code>Alpha</code> specifically. How do I make it possible, enforcing that <code>foo</code> must take <em>some</em> <code>A</code> but not <em>any</em> <code>A</code>?</p>\n\n<hr>\n\n<p>In more detail, I have numerous list zippers which I want to make instances of Comonad. Instead of creating a list zipper type and making lots of wrappers around it, I decided to make a class ListZip, and make multiple types which are instances of it. That is,</p>\n\n<pre><code>class (Functor z) =&gt; ListZip z where\n    leftMv :: z a -&gt; z a\n    rightMv :: z a -&gt; z a --further functions excluded\n\ndata ListZipInf a = ListZipInf ([a]) a ([a]) deriving (Show)\ninstance ListZip ListZipInf where... --functions excluded\ndata ListZipTorus a = ListZipTorus [a] a [a] deriving (Show)\ninstance ListZip ListZipTorus where.. --functions excluded\n</code></pre>\n\n<p>Now I want to make similar zippers for 2d lists - plane zippers - </p>\n\n<pre><code>data PlaneZipInf a = PlaneZipInf (ListZipInf (ListZipInf a)) deriving (Show)\ndata PlaneZipTorus a = PlaneZipTorus (ListZipTorus (ListZipTorus a)) deriving (Show)\n</code></pre>\n\n<p>And finally, I want to make a similar plane zipper typeclass, which will allow me to have a default implementation for a way to pull a single element, the 'focus' out of this list zipper, given a way to 'unwrap' the plane zipper constructor:</p>\n\n<pre><code>class PlaneZip p where\n  unwrap :: (ListZip z) =&gt; p (z (z a)) -&gt; z (z a)\n  counit :: (ListZip z, Comonad z) =&gt; p (z (z a)) -&gt; a\n  counit p =\n    let zs = unwrap p\n      in extract $ extract zs\n</code></pre>\n\n<p>This however doesn't work, in particular</p>\n\n<pre><code>instance PlaneZip PlaneZipInf where\n    unwrap (PlaneZipInf zs) = zs\n</code></pre>\n\n<p>Gives me an error - <code>Could not deduce a ~ (ListZipInf (ListZipInf a))</code>\nIt expects a function that works for any <code>ListZip</code>, but I gave it a function that provides a particular one. </p>\n\n<p>How could I express that I want <code>unwrap</code> to take a type <code>p (z (z a))</code>, where <code>z</code> is some type which is an instance of <code>ListZip</code>, and produce a <code>(z (z a))</code>?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 5, "creation_date": 1475382533, "post_id": 39813812, "comment_id": 66918527, "body": "This sounds like a math problem. Solve it with paper and pencil and plug the result into your program, parameterized by whatever variables are appropriate."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "edited": false, "score": 1, "creation_date": 1475394219, "post_id": 39813812, "comment_id": 66920437, "body": "This problem doesn&#39;t have a unique solution; it always has two solutions. How are you going to pick which one to use?"}], "answers": [{"tags": [], "owner": {"reputation": 14052, "user_id": 1004301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a6aacd03deb37cb13cbc8b65e454f2b?s=128&d=identicon&r=PG", "display_name": "Lee Duhem", "link": "https://stackoverflow.com/users/1004301/lee-duhem"}, "is_accepted": true, "score": 2, "last_activity_date": 1475384163, "creation_date": 1475384163, "answer_id": 39813997, "question_id": 39813812, "link": "https://stackoverflow.com/questions/39813812/how-to-find-an-x-y-coordinate-that-is-d-distance-away-from-a-given-point-on-slop/39813997#39813997", "title": "How to find an x y coordinate that is d distance away from a given point on slope m?", "body": "<p>According to the definition of <a href=\"https://en.wikipedia.org/wiki/Slope\" rel=\"nofollow\">slope</a>, this problem could be solved like this:</p>\n\n<pre><code>endPoint :: (Double, Double) -&gt; Double -&gt; Double -&gt; (Double, Double)\nendPoint (x0, y0) m d = (x0 + dx, y0 + dy)\n  where theta = atan m\n        dx = d * cos theta\n        dy = d * sin theta\n</code></pre>\n\n<p>Here is an example about point (2,8) and (3,20):</p>\n\n<pre><code>*Main&gt; endPoint (2,8) 12 (sqrt $ 12 * 12 + 1)\n(3.000000000000001,20.0)\n</code></pre>\n"}], "owner": {"reputation": 1582, "user_id": 4604899, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/WyuD9.jpg?s=128&g=1", "display_name": "Julien Chien", "link": "https://stackoverflow.com/users/4604899/julien-chien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 39813997, "answer_count": 1, "score": 0, "last_activity_date": 1475384163, "creation_date": 1475381795, "last_edit_date": 1495535267, "question_id": 39813812, "link": "https://stackoverflow.com/questions/39813812/how-to-find-an-x-y-coordinate-that-is-d-distance-away-from-a-given-point-on-slop", "title": "How to find an x y coordinate that is d distance away from a given point on slope m?", "body": "<p>We are trying to define a Haskell function that gives the coordinates x, y given a starting point (x0, y0), distance from the starting coord, and slope of the line that goes through both points. Any ideas?</p>\n\n<p>It will probably have a signature of</p>\n\n<p><code>endPoint :: (Double, Double) -&gt; double -&gt; double -&gt; (Double, Double)</code></p>\n\n<p>How you would do this on paper is to use the distance formula (with the second point as variables/unknowns), which then gives you some ratio of the x and y for this new point, use that ratio as the substitution into the point-slope formula, which should give one of y and x, then plug that value into the formula again to get the x and y we don't have yet.</p>\n\n<p>From <a href=\"https://stackoverflow.com/questions/29126138/calculate-distance-between-two-points-haskell\">this question</a>, we can do the distance formula, but how do we deal with substitution? Is that possible in Haskell?</p>\n"}, {"tags": ["haskell", "monads", "haskell-lens", "state-monad", "lenses"], "comments": [{"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 4, "creation_date": 1475382581, "post_id": 39813675, "comment_id": 66918536, "body": "I found <a href=\"http://www.haskellforall.com/2013/05/program-imperatively-using-haskell.html\" rel=\"nofollow noreferrer\">this page by Gabriel Gonzales</a> which takes a different approach from what I&#39;d imagined. It uses a single state monad where the state is a &quot;universe&quot; containing all the objects, and uses lenses to pick out and modify the objects from within that universe. That idea <i>seems</i> to make sense for my application, so I guess I&#39;ll work through that if I don&#39;t get any answers here."}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 3, "creation_date": 1475392954, "post_id": 39813675, "comment_id": 66920134, "body": "Yep, the method Gonzales outlined is the way to do it. It&#39;s also the most direct translation of your Python. <code>def doInteraction(machine1, machine2)</code> becomes <code>doInteraction :: State (Machine, Machine) Int</code>"}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1475423252, "post_id": 39813675, "comment_id": 66927570, "body": "@BenjaminHodgson thank you for your very useful comment - for some reason I hadn&#39;t thought of just putting them in a tuple and was imagining something much more complicated. That little nudge sets me in the right direction."}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1475458715, "post_id": 39813675, "comment_id": 66937226, "body": "@BenjaminHodgson having said that, I&#39;ve realised I don&#39;t know how to implement the body of that function in an imperative style. If you&#39;re interested in helping further, please see the edit at the end of my question."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475635204, "post_id": 39813675, "comment_id": 67016994, "body": "Using <i>lazy</i> <code>State</code> to simulate an abstract machine seems very strange to me. Are you sure you don&#39;t want to use the usual &quot;strict&quot; <code>State</code>? I put scare quotes around &quot;strict&quot; there because its strictness just comes from performing case analysis on pairs, rather than doing anything weird. Lazy <code>State</code> is the weird one."}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475640675, "post_id": 39813675, "comment_id": 67018321, "body": "@dfeuer I guess I hadn&#39;t paid much attention to the difference and assumed lazy would be the default choice. (As I understand it, it means I could give the machine an infinite input stream, and have it poll that stream until it decides to halt, which might be quite useful later on. But maybe I haven&#39;t understood that correctly.) If changing to strict will help it&#39;s no problem for me to do that."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475672813, "post_id": 39813675, "comment_id": 67036117, "body": "You don&#39;t need lazy state to allow the machine to consume input lazily, but rather to produce results lazily (only running the machine long enough to produce the portion of the result that is demanded). Your machine can stop whenever it wants in either case. It&#39;s generally advise you to stick with strict state unless and until you find you actually need lazy state."}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475674686, "post_id": 39813675, "comment_id": 67037618, "body": "@dfeuer I see, thank you, that&#39;s helpful. I might end up needing that one day, e.g. if I want a machine to produce an infinite stream of output to be consumed by another machine, with the second machine deciding when to halt. But I don&#39;t need that today, so I&#39;ll switch to the strict version."}], "answers": [{"tags": [], "owner": {"reputation": 48938, "user_id": 246886, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dd1ebaade6623fc538fb8af3338e730d?s=128&d=identicon&r=PG", "display_name": "Jon Purdy", "link": "https://stackoverflow.com/users/246886/jon-purdy"}, "is_accepted": false, "score": 5, "last_activity_date": 1475554480, "creation_date": 1475554480, "answer_id": 39844064, "question_id": 39813675, "link": "https://stackoverflow.com/questions/39813675/simulating-interacting-stateful-objects-in-haskell/39844064#39844064", "title": "Simulating interacting stateful objects in Haskell", "body": "<p>One option is to make your state transformations into pure functions operating on <code>Machine</code> values:</p>\n\n<pre><code>getValue :: Machine -&gt; Int\ngetValue (Register x) = x\n\naddToState :: Int -&gt; Machine -&gt; Machine\naddToState i (Register x) = Register (x + i)\n</code></pre>\n\n<p>Then you can lift them into <code>State</code> as needed, writing <code>State</code> actions on multiple machines like so:</p>\n\n<pre><code>doInteraction :: State (Machine, Machine) Int\ndoInteraction = do\n  a &lt;- gets $ getValue . fst\n  modify $ first $ addToState (-a)\n  modify $ second $ addToState a\n  gets $ getValue . snd\n</code></pre>\n\n<p>Where <code>first</code> (resp. <code>second</code>) is a function from <code>Control.Arrow</code>, used here with the type:</p>\n\n<pre><code>(a -&gt; b) -&gt; (a, c) -&gt; (b, c)\n</code></pre>\n\n<p>That is, it modifies the first element of a tuple.</p>\n\n<p>Then <code>runState doInteraction (Register 3, Register 5)</code> produces <code>(8, (Register 0, Register 8))</code> as expected.</p>\n\n<p>(In general I think you could do this sort of \u201czooming in\u201d on subvalues with lenses, but I\u2019m not really familiar enough to offer an example.)</p>\n"}, {"comments": [{"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475634946, "post_id": 39857720, "comment_id": 67016943, "body": "Thanks, this is close to what I want to do. I&#39;ve been learning lenses and I&#39;ve got almost as far as this. The place I&#39;m stuck is that where you write <code>machine2.register += a</code>, I want to write something like <code>machine2 ~. addToState a</code>, where <code>~.</code> would basically do <code>runState addToState [value pointed at by the lens]</code>, then replace the value pointed at by the lens with the new state, and return the resulting value. The reason is that in reality I don&#39;t just want to add and subtract from registers, but to perform complicated actions that both change the state of a Machine and return a value."}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475635973, "post_id": 39857720, "comment_id": 67017159, "body": "@Nathaniel Does <a href=\"http://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Setter.html#v:-60--126-\" rel=\"nofollow noreferrer\"><code>&lt;~</code></a> do what you want by any chance? You could then do something like <code>machine1.register &lt;~ randomIO</code>.... If this is not what you mean, could you give a more precise example?"}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475639942, "post_id": 39857720, "comment_id": 67018133, "body": "No, because <code>&lt;~</code> runs the action in the current monad, and thus expects <code>addToState</code> to have type <code>State System Int</code> instead of <code>State Machine Int</code>. I want to be able to call <code>addToState</code>, implemented as in my question, from inside the <code>doInteraction</code> function, and have it update only one of the two Machines. I will think about how to update the question to explain this more clearly, and I&#39;ll let you know when I&#39;ve done that."}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475640441, "post_id": 39857720, "comment_id": 67018263, "body": "Maybe this is a less confusing way to put it: imagine I wanted to call <code>runProgram</code> on just one of the Machines in the System, and that I wanted not only for this to update that Machine&#39;s state, but that I also wanted to get the result that the program returns. How would I do that?"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475651747, "post_id": 39857720, "comment_id": 67022565, "body": "@Nathaniel I&#39;ve edited my answer for what I think you are looking for. I am curious to see if anyone else has a simpler way..."}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475654793, "post_id": 39857720, "comment_id": 67024294, "body": "Great, that seems to be exactly what I wanted. I&#39;m not sure I understand the implications of not being able to use MonadState but for now it doesn&#39;t seem to be a problem. (I will accept after some time.)"}, {"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "reply_to_user": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475683566, "post_id": 39857720, "comment_id": 67044285, "body": "@Nathaniel The implications are that your code is less generic. For example, say that in another function you realize that you need to be in a monad that can write too, then now you need to go back and change this to <code>RWST</code> (as opposed to just adding a <code>MonadReader constraint on the new function and switching to </code>RWST` only when you run the monad). Also, I&#39;d prefer if you <i>not</i> accept sooner. I&#39;m actually very curious about this problem and would like to see what other more experienced Haskellers have to say."}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475684407, "post_id": 39857720, "comment_id": 67044816, "body": "Ok, I&#39;ll hold of on accepting for a while in that case, and we&#39;ll see if anyone else chimes in. I&#39;m very grateful for your help!"}], "tags": [], "owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "is_accepted": false, "score": 16, "last_activity_date": 1475651672, "last_edit_date": 1475651672, "creation_date": 1475599585, "answer_id": 39857720, "question_id": 39813675, "link": "https://stackoverflow.com/questions/39813675/simulating-interacting-stateful-objects-in-haskell/39857720#39857720", "title": "Simulating interacting stateful objects in Haskell", "body": "<p>I think good practice would dictate that you should actually make a <code>System</code> data type to wrap your two machines, and then you might as well use <a href=\"https://hackage.haskell.org/package/lens-4.14\"><code>lens</code></a>.</p>\n\n<pre><code>{-# LANGUAGE TemplateHaskell, FlexibleContexts #-}\n\nimport Control.Lens\nimport Control.Monad.State.Lazy\n\n-- With these records, it will be very easy to add extra machines or registers\n-- without having to refactor any of the code that follows\ndata Machine = Machine { _register :: Int } deriving (Show)\ndata System = System { _machine1, _machine2 :: Machine } deriving (Show)\n\n-- This is some TemplateHaskell magic that makes special `register`, `machine1`,\n-- and `machine2` functions.\nmakeLenses ''Machine\nmakeLenses ''System\n\n\ndoInteraction :: MonadState System m =&gt; m Int\ndoInteraction = do\n    a &lt;- use (machine1.register)\n    machine1.register -= a\n    machine2.register += a\n    use (machine2.register)\n</code></pre>\n\n<p>Also, just to test this code, we can check at GHCi that it does what we want:</p>\n\n<pre><code>ghci&gt; runState doInteraction (System (Machine 3) (Machine 4))\n(7,System {_machine1 = Machine {_register = 0}, _machine2 = Machine {_register = 7}})\n</code></pre>\n\n<h3>Advantages:</h3>\n\n<ul>\n<li><p>By using records and <code>lens</code>, there will be no refactoring if I decide to add extra fields. For example, say I want a <em>third</em> machine, then all I do is change <code>System</code>:</p>\n\n<pre><code>data System = System\n  { _machine1, _machine2, _machine3 :: Machine } deriving (Show)\n</code></pre>\n\n<p>But nothing else in my existing code will change - just now I will be able to use <code>machine3</code> like I use <code>machine1</code> and <code>machine2</code>.</p></li>\n<li><p>By using <code>lens</code>, I can scale more easily to nested structures. Note that I just avoided the very simple <code>addToState</code> and <code>getValue</code> functions completely. Since a <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Lens.html\"><code>Lens</code></a> is actually just a function, <code>machine1.register</code> is just regular function composition. For example, lets say I want a machine to now have an <em>array</em> of registers, then getting or setting particular registers is still simple. We just modify <code>Machine</code> and <code>doInteraction</code>:</p>\n\n<pre><code>import Data.Array.Unboxed (UArray)\ndata Machine = Machine { _registers :: UArray Int Int } deriving (Show)\n\n-- code snipped\n\ndoInteraction2 :: MonadState System m =&gt; m Int\ndoInteraction2 = do\n    Just a &lt;- preuse (machine1.registers.ix 2) -- get 3rd reg on machine1\n    machine1.registers.ix 2 -= a               -- modify 3rd reg on machine1\n    machine2.registers.ix 1 += a               -- modify 2nd reg on machine2\n    Just b &lt;- preuse (machine2.registers.ix 1) -- get 2nd reg on machine2\n    return b\n</code></pre>\n\n<p>Note that this is equivalent to having a function like the following in Python:</p>\n\n<pre><code>def doInteraction2(machine1,machine2):\n  a = machine1.registers[2]\n  machine1.registers[2] -= a\n  machine2.registers[1] += a\n  b = machine2.registers[1]\n  return b\n</code></pre>\n\n<p>You can again test this out on GHCi:</p>\n\n<pre><code>ghci&gt; import Data.Array.IArray (listArray)\nghci&gt; let regs1 = listArray (0,3) [0,0,6,0]\nghci&gt; let regs2 = listArray (0,3) [0,7,3,0]\nghci&gt; runState doInteraction (System (Machine regs1) (Machine regs2))\n(13,System {_machine1 = Machine {_registers = array (0,3) [(0,0),(1,0),(2,0),(3,0)]}, _machine2 = Machine {_registers = array (0,3) [(0,0),(1,13),(2,3),(3,0)]}})\n</code></pre></li>\n</ul>\n\n<h1>EDIT</h1>\n\n<p>The OP has specified that he would like to have a way of embedding a <code>State Machine a</code> into a <code>State System a</code>. <code>lens</code>, as always, has such a function if you go digging deep enough. <a href=\"http://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Zoom.html#v:zoom\"><code>zoom</code></a> (and its sibling <a href=\"http://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Zoom.html#v:magnify\"><code>magnify</code></a>) provide facilities for \"zooming\" out/in of <code>State</code>/<code>Reader</code> (it only makes sense to zoom out of <code>State</code> and magnify into <code>Reader</code>).</p>\n\n<p>Then, if we want to implement <code>doInteraction</code> while keeping as black boxes <code>getValue</code> and <code>addToState</code>, we get</p>\n\n<pre><code>getValue :: State Machine Int\naddToState :: Int -&gt; State Machine ()\n\ndoInteraction3 :: State System Int\ndoInteraction3 = do\n  a &lt;- zoom machine1 getValue     -- call `getValue` with state `machine1`\n  zoom machine1 (addToState (-a)) -- call `addToState (-a)` with state `machine1` \n  zoom machine2 (addToState a)    -- call `addToState a` with state `machine2`\n  zoom machine2 getValue          -- call `getValue` with state `machine2`\n</code></pre>\n\n<p>Notice however that if we do this we really must commit to a particular state monad transformer (as opposed to the generic <code>MonadState</code>), since not all ways of storing state are going to be necessarily \"zoomable\" in this way. That said, <code>RWST</code> is another state monad transformer supported by <code>zoom</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1476161914, "post_id": 39956557, "comment_id": 67220682, "body": "This looks very nice. It seems to correspond more to coroutines than to the more object-based model I had in mind. (Roughly speaking, the difference is that in a coroutine it&#39;s the stateful object&#39;s choice what to do next, whereas in OOP that choice is made by the calling function.) Coroutines are a super-useful feature that&#39;s lacking in most imperative languages, so I&#39;m very happy to know this exists in Haskell."}, {"owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "reply_to_user": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1476184608, "post_id": 39956557, "comment_id": 67230738, "body": "Yes, its a different model. It allows you to write the machines behaviour independently, and model their interactions by combining them, rather than writing the program at the top level. This may not be what you were after of course, but its nice it exists. I find it useful for doing stateful DSP pipelines, because it allows you to focus on only 1 algorithm at a time."}], "tags": [], "owner": {"reputation": 1308, "user_id": 2248754, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0f3fdf7274a422a407b9554e822c96e8?s=128&d=identicon&r=PG", "display_name": "OllieB", "link": "https://stackoverflow.com/users/2248754/ollieb"}, "is_accepted": false, "score": 4, "last_activity_date": 1476096540, "creation_date": 1476096540, "answer_id": 39956557, "question_id": 39813675, "link": "https://stackoverflow.com/questions/39813675/simulating-interacting-stateful-objects-in-haskell/39956557#39956557", "title": "Simulating interacting stateful objects in Haskell", "body": "<p>You could also use Gabriel Gonzales' Pipes library for the case you've illustrated. The tutorial for the library is one of the best pieces of Haskell documentation in existence. </p>\n\n<p>Below illustrates a simple example (untested). </p>\n\n<pre><code>-- machine 1 adds its input to current state\nmachine1 :: (MonadIO m) =&gt; Pipe i o m ()\nmachine1 = flip evalStateT 0 $ forever $ do\n               -- gets pipe input\n               a &lt;- lift await\n               -- get current local state\n               s &lt;- get\n               -- &lt;whatever&gt;\n               let r = a + s\n               -- update state\n               put r\n               -- fire down pipeline\n               yield r\n\n-- machine 2 multiplies its input by current state\nmachine2 :: (MonadIO m) =&gt; Pipe i o m ()\nmachine2 = flip evalStateT 0 $ forever $ do\n               -- gets pipe input\n               a &lt;- lift await\n               -- get current local state\n               s &lt;- get\n               -- &lt;whatever&gt;\n               let r = a * s\n               -- update state\n               put r\n               -- fire down pipeline\n               yield r\n</code></pre>\n\n<p>You can then combine using the >-> operator. An example would be to run</p>\n\n<pre><code>run :: IO ()\nrun :: runEffect $ P.stdinLn &gt;-&gt; machine1 &gt;-&gt; machine2 &gt;-&gt; P.stdoutLn\n</code></pre>\n\n<p>Note that is possible, although a little more involved to have bi-directional pipes, which is gives you communications between both machines. Using some of the other pipes ecosystems, you can also have asynchronous pipes to model non-deterministic or parallel operation of machines.</p>\n\n<p>I believe the same can be achieved with the conduit library, but I don't have much experience with it.</p>\n"}], "owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 553, "favorite_count": 1, "answer_count": 3, "score": 14, "last_activity_date": 1476096540, "creation_date": 1475380234, "last_edit_date": 1495542648, "question_id": 39813675, "link": "https://stackoverflow.com/questions/39813675/simulating-interacting-stateful-objects-in-haskell", "title": "Simulating interacting stateful objects in Haskell", "body": "<p>I'm currently writing a Haskell program that involves simulating an abstract machine, which has internal state, takes input and gives output. I know how to implement this using the state monad, which results in much cleaner and more manageable code.</p>\n\n<p>My problem is that I don't know how to pull the same trick when I have two (or more) stateful objects interacting with one another. Below I give a highly simplified version of the problem and sketch out what I have so far.</p>\n\n<p>For the sake of this question, let's assume a machine's internal state consists only of a single integer register, so that its data type is</p>\n\n<pre><code>data Machine = Register Int\n        deriving (Show)\n</code></pre>\n\n<p>(The actual machine might have multiple registers, a program pointer, a call stack etc. etc., but let's not worry about that for now.) After a <a href=\"https://stackoverflow.com/a/39807831/1119340\">previous question</a> I know how to implement the machine using the state monad, so that I don't have to explicitly pass its internal state around. In this simplified example the implementation looks like this, after importing <code>Control.Monad.State.Lazy</code>:</p>\n\n<pre><code>addToState :: Int -&gt; State Machine ()\naddToState i = do\n        (Register x) &lt;- get\n        put $ Register (x + i)\n\ngetValue :: State Machine Int\ngetValue = do\n        (Register i) &lt;- get\n        return i\n</code></pre>\n\n<p>This allows me to write things like</p>\n\n<pre><code>program :: State Machine Int\nprogram = do\n        addToState 6\n        addToState (-4)\n        getValue\n\nrunProgram = evalState program (Register 0)\n</code></pre>\n\n<p>This adds 6 to the register, then subtracts 4, then returns the result. The state monad keeps track of the machine's internal state so that the \"program\" code doesn't have to explicitly track it.</p>\n\n<p>In object oriented style in an imperative language, this \"program\" code might look like</p>\n\n<pre><code>def runProgram(machine):\n    machine.addToState(6)\n    machine.addToState(-4)\n    return machine.getValue()\n</code></pre>\n\n<p>In that case, if I want to simulate two machines interacting with each other I might write</p>\n\n<pre><code>def doInteraction(machine1, machine2):\n    a = machine1.getValue()\n    machine1.addToState(-a)\n    machine2.addToState(a)\n    return machine2.getValue()\n</code></pre>\n\n<p>which sets <code>machine1</code>'s state to 0, adding its value onto <code>machine2</code>'s state and returning the result.</p>\n\n<p>My question is simply, what is the paradigmatic way to write this kind of imperative code in Haskell? Originally I thought I needed to chain two state monads, but after a hint by Benjamin Hodgson in the comments I realised I should be able to do it with a single state monad where the state is a tuple containing both machines.</p>\n\n<p>The problem is that I don't know how to implement this in a nice clean imperative style. Currently I have the following, which works but is inelegant and fragile:</p>\n\n<pre><code>interaction :: State (Machine, Machine) Int\ninteraction = do\n        (m1, m2) &lt;- get\n        let a = evalState (getValue) m1\n        let m1' = execState (addToState (-a)) m1\n        let m2' = execState (addToState a) m2\n        let result = evalState (getValue) m2'\n        put $ (m1',m2')\n        return result\n\ndoInteraction = runState interaction (Register 3, Register 5)\n</code></pre>\n\n<p>The type signature <code>interaction :: State (Machine, Machine) Int</code> is a nice direct translation of the Python function declaration <code>def doInteraction(machine1, machine2):</code>, but the code is fragile because I resorted to threading state through the functions using explicit <code>let</code> bindings. This requires me to introduce a new name every time I want to change the state of one of the machines, which in turn means I have to manually keep track of which variable represents the most up-to-date state. For longer interactions this is likely to make the code error-prone and hard to edit.</p>\n\n<p>I expect that the result will have something to do with lenses. The problem is that I don't know how to run a monadic action on only one of the two machines. Lenses has an operator <code>&lt;&lt;~</code> whose documentation says \"Run a monadic action, and set the target of Lens to its result\", but this action gets run in the current monad, where the state is type <code>(Machine, Machine)</code> rather than <code>Machine</code>.</p>\n\n<p>So at this point my question is, how can I implement the <code>interaction</code> function above in a more imperative / object-oriented style, using state monads (or some other trick) to implicitly keep track of the internal states of the two machines, without having to pass the states around explicitly?</p>\n\n<p>Finally, I realise that wanting to write object oriented code in a pure functional language might be a sign that I'm doing something wrong, so I'm very open to being shown another way to think about the problem of simulating multiple stateful things interacting with each other. Basically I just want to know the \"right way\" to approach this sort of problem in Haskell.</p>\n"}, {"tags": ["haskell", "cabal"], "comments": [{"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 1, "creation_date": 1475376253, "post_id": 39813308, "comment_id": 66917683, "body": "I found that if I type <code>cabal install parsec lens</code> then it reports that it will break only things I don&#39;t use (not including scary things like HTTP and &quot;security&quot;), so I&#39;m going with that for now. However I&#39;d still like some orientation on the correct/intended way to resolve this kind of thing, as I&#39;m sure it will come up again in the future."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 3, "creation_date": 1475395819, "post_id": 39813308, "comment_id": 66920795, "body": "If you can live with the downgrade <code>transformers-0.5.2.0 -&gt; 0.4.3.0</code>, rebuild and reinstall broken packages. For better life, try <a href=\"https://docs.haskellstack.org/en/stable/README/\" rel=\"nofollow noreferrer\">stack</a>."}, {"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1475396963, "post_id": 39813308, "comment_id": 66921028, "body": "@Nathaniel What version of Cabal are you using? Try to update to the latest  1.24 version, if you aren&#39;t there already. Also, it is a good idea to used Cabal sandboxes, by running <code>cabal sandbox init</code> in your project folder, and only then running Cabal install."}], "answers": [{"tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1475436722, "creation_date": 1475436722, "answer_id": 39820835, "question_id": 39813308, "link": "https://stackoverflow.com/questions/39813308/how-to-resolve-broken-dependencies-in-cabal/39820835#39820835", "title": "How to resolve broken dependencies in cabal?", "body": "<p>The standard technique is to tell cabal that you don't mind reinstalling the packages that would be broken. You can do this with something like</p>\n\n<pre><code>cabal install lenses parsec-3.1.11 network-uri-2.6.1.0 hackage-security-0.5.2.2 HTTP-4000.3.3\n</code></pre>\n\n<p>There are further details on what's happening here on <a href=\"http://www.vex.net/~trebla/haskell/sicp.xhtml\" rel=\"nofollow\">this fine introduction to cabal packages</a>, especially the section labeled \"The Pigeon Drop Con\".</p>\n"}], "owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 555, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475436722, "creation_date": 1475375459, "question_id": 39813308, "link": "https://stackoverflow.com/questions/39813308/how-to-resolve-broken-dependencies-in-cabal", "title": "How to resolve broken dependencies in cabal?", "body": "<p>I'm a beginner at Haskell, and I've been merrily using cabal to install everything that I thought I might need, assuming it would work like port or homebrew, resolving all dependencies for me and keeping things up to date so they won't break, etc. However, now when trying to instal the <code>lenses</code> library I get this message:</p>\n\n<pre><code>In order, the following would be installed:\nbase-orphans-0.5.4 (new package)\ndistributive-0.5.0.2 (new version)\ncomonad-5 (new version)\nbifunctors-5.4.1 (new package)\nmtl-2.2.1 (reinstall) changes: transformers-0.5.2.0 -&gt; 0.4.3.0\nexceptions-0.8.3 (new package)\nprelude-extras-0.4.0.3 (new package)\nprofunctors-5.2 (new package)\nreflection-2.1.2 (new package)\nsemigroupoids-5.1 (new package)\nfree-4.12.4 (new package)\nadjunctions-4.3 (new package)\nkan-extensions-5.0.1 (new package)\nlens-4.14 (new package)\ncabal: The following packages are likely to be broken by the reinstalls:\nparsec-3.1.11\nnetwork-uri-2.6.1.0\nhackage-security-0.5.2.2\nHTTP-4000.3.3\nUse --force-reinstalls if you want to install anyway.\n</code></pre>\n\n<p>Well, breaking HTTP and something called \"security\" doesn't sound like a good idea, and my code relies on Parsec. What's the proper way to resolve this situation? Should I use <code>--force-reinstalls</code> and expect things to not really break? Or let those packages break and then reinstall them, assuming that's possible if the HTTP package is broken? Or do I have to make my own choices about which packages to install or not to install, knowing that some will conflict each other?</p>\n\n<p>Part of the problem might be that I initially didn't realise that some of the packages on hackage aren't really production-quality code, so I do have a lot of dependencies that I don't really need. Perhaps the solution is to uninstall those packages and their dependencies. However <code>cabal --help</code> doesn't reveal any kind of uninstall command, so I'm a bit lost with how to do that.</p>\n"}, {"tags": ["haskell", "ghc", "haskell-stack"], "comments": [{"owner": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 1, "creation_date": 1475364699, "post_id": 39812378, "comment_id": 66916119, "body": "What does the log file say?"}, {"owner": {"reputation": 227, "user_id": 1813436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c770ce5b1d203a4ce99a51f6f3c0061?s=128&d=identicon&r=PG", "display_name": "kai", "link": "https://stackoverflow.com/users/1813436/kai"}, "reply_to_user": {"reputation": 10378, "user_id": 2476735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e9447bbc32246fcd23b76b5e946618?s=128&d=identicon&r=PG&f=1", "display_name": "David Young", "link": "https://stackoverflow.com/users/2476735/david-young"}, "edited": false, "score": 0, "creation_date": 1475429943, "post_id": 39812378, "comment_id": 66929705, "body": "Nothing. It is empty."}, {"owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 1, "creation_date": 1475617221, "post_id": 39812378, "comment_id": 67012407, "body": "segfault in GHC suggests a compiler error, doesn&#39;t it?"}], "answers": [{"tags": [], "owner": {"reputation": 227, "user_id": 1813436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c770ce5b1d203a4ce99a51f6f3c0061?s=128&d=identicon&r=PG", "display_name": "kai", "link": "https://stackoverflow.com/users/1813436/kai"}, "is_accepted": true, "score": 0, "last_activity_date": 1489690670, "creation_date": 1489690670, "answer_id": 42842658, "question_id": 39812378, "link": "https://stackoverflow.com/questions/39812378/stack-build-failed-randomly/42842658#42842658", "title": "&quot;stack build&quot; failed randomly", "body": "<p>This turns out to be a memory defect issue.</p>\n"}], "owner": {"reputation": 227, "user_id": 1813436, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c770ce5b1d203a4ce99a51f6f3c0061?s=128&d=identicon&r=PG", "display_name": "kai", "link": "https://stackoverflow.com/users/1813436/kai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 42842658, "answer_count": 1, "score": 1, "last_activity_date": 1489690670, "creation_date": 1475363908, "last_edit_date": 1483466975, "question_id": 39812378, "link": "https://stackoverflow.com/questions/39812378/stack-build-failed-randomly", "title": "&quot;stack build&quot; failed randomly", "body": "<p>When I used <code>stack build</code> to build a package, it failed randomly during the process of installing dependent packages. Here is an example error message:</p>\n\n<p><code>\nWhile building package statistics-0.13.3.0 using:\n      /home/work/.stack/setup-exe-cache/x86_64-linux/setup-Simple-Cabal-1.24.0.0-ghc-8.0.1 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.24.0.0 build --ghc-options \" -ddump-hi -ddump-to-file\"\n    Process exited with code: ExitFailure (-11)\n    Logs have been written to: /home/work/server/dev/taiji/.stack-work/logs/statistics-0.13.3.0.log\n</code></p>\n\n<p>I said \"failed randomly\" because this can be fixed by restart <code>stack build</code>. But it will fail on building another package later.</p>\n\n<p>I looked at the <code>dmesg | tail</code>, it says:</p>\n\n<p><code>\n[1029507.778048] ghc[16868]: segfault at 7d538d610628 ip 00007f5384094ed0 sp 00007ffceed0bda0 error 4 in libHSrts_thr-ghc8.0.1.so[7f538407a000+63000]\n[1029524.911751] ghc[17599]: segfault at 100206005838 ip 00007f1c727de754 sp 00007ffdc160fd58 error 4 in libHSghc-8.0.1-ghc8.0.1.so[7f1c6e4de000+49c9000]\n[1029533.035216] ghc[16789]: segfault at 7da273b664f0 ip 00007fa273b35a8e sp 00007ffe2f55d540 error 4 in libHSrts_thr-ghc8.0.1.so[7fa273b1c000+63000]\n</code></p>\n\n<p>Any idea?</p>\n"}, {"tags": ["haskell", "functional-programming", "lambda-calculus"], "comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475363799, "post_id": 39812262, "comment_id": 66915951, "body": "Tell us what you did and where exactly you got stuck."}, {"owner": {"reputation": 85, "user_id": 4061741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-jTyCiIFoD0g/AAAAAAAAAAI/AAAAAAAAC-o/3StRToY78t4/photo.jpg?sz=128", "display_name": "Chapi", "link": "https://stackoverflow.com/users/4061741/chapi"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475364247, "post_id": 39812262, "comment_id": 66916045, "body": "@leftaroundabout Sure, just added the part for m = 0 and currently adding my attempt for m = Sy"}, {"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 1, "creation_date": 1475391293, "post_id": 39812262, "comment_id": 66919814, "body": "The arrow \u21d3 probably means: for every finite, non-bottom value. Consider that in Haskell you can define: <code>n :: Nat; n = S n</code> which is an &quot;infinite number&quot;. And also: <code>loop :: Nat; loop = loop</code> which is a divergent computation of type <code>Nat</code>.  If you substitute this kind of values into that equation the equation may not hold."}, {"owner": {"reputation": 85, "user_id": 4061741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-jTyCiIFoD0g/AAAAAAAAAAI/AAAAAAAAC-o/3StRToY78t4/photo.jpg?sz=128", "display_name": "Chapi", "link": "https://stackoverflow.com/users/4061741/chapi"}, "reply_to_user": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 0, "creation_date": 1475399501, "post_id": 39812262, "comment_id": 66921573, "body": "Thank you @Bakuriu that was actually my guess, non-bottom value but I was unsure, thanks for clearing it up!"}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 4061741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-jTyCiIFoD0g/AAAAAAAAAAI/AAAAAAAAC-o/3StRToY78t4/photo.jpg?sz=128", "display_name": "Chapi", "link": "https://stackoverflow.com/users/4061741/chapi"}, "edited": false, "score": 0, "creation_date": 1475526700, "post_id": 39814642, "comment_id": 66969564, "body": "Thank you very much, I think that the reason why I didn&#39;t thought of this before is because I never intended to use induction on the first place. But yeah it works perfectly, thanks again"}], "tags": [], "owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "is_accepted": true, "score": 0, "last_activity_date": 1475391644, "creation_date": 1475391644, "answer_id": 39814642, "question_id": 39812262, "link": "https://stackoverflow.com/questions/39812262/prove-distributive-law-of-multiplication-over-addition-functions-in-haskell/39814642#39814642", "title": "Prove distributive law of multiplication over addition functions in Haskell", "body": "<p>Well, you are simply forgetting to apply the inductive hypothesis:</p>\n\n<pre><code>(Sy + n) * k =? Sy * k + n * k\nLeft side:\n(case Sy of {0-&gt;...;Sy-&gt;S(y+n)}) * k = S(y+n) * k\n= case Sx of {0-&gt;...;Sx-&gt; k + k * (y+n)\n( inductive hypothesis; we know that k * (y+n) = k*y + k*n)\n= k + k*y + k*n\nRight side:\nSy * k + n * k = (case Sy of {0-&gt;...;Sy-&gt;k + k*y}) + n * k\n= k + k*y + n * k \n</code></pre>\n\n<p>Remember: you were providing by induction on the first argument of <code>+</code> that <code>(m+n)*k == m*k + n*k</code>. You proved the base case <code>(0+n)*k</code> so when proving the inductive case you assume to know that <code>(y+n)*k == y*k + n*k</code> for up to a certain value of <code>y</code> and you want to prove that <code>(S(y) + n)*k == S(y)*k + n*k</code>.</p>\n"}], "owner": {"reputation": 85, "user_id": 4061741, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-jTyCiIFoD0g/AAAAAAAAAAI/AAAAAAAAC-o/3StRToY78t4/photo.jpg?sz=128", "display_name": "Chapi", "link": "https://stackoverflow.com/users/4061741/chapi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "accepted_answer_id": 39814642, "answer_count": 1, "score": 1, "last_activity_date": 1475391644, "creation_date": 1475362871, "last_edit_date": 1475364731, "question_id": 39812262, "link": "https://stackoverflow.com/questions/39812262/prove-distributive-law-of-multiplication-over-addition-functions-in-haskell", "title": "Prove distributive law of multiplication over addition functions in Haskell", "body": "<p>I'm currently on a beginner's course of haskell and lambda calculus and I'm unsure of how to do the following exercise:</p>\n\n<p>Using the following definitions of (+) and (*) operations in haskell, prove:</p>\n\n<p>1)The distributive law of the (*) over the (+)</p>\n\n<pre><code>(\u2200m\u21d3,n\u21d3,k\u21d3::N) (m+n) * k = m * k + n * k\n</code></pre>\n\n<p>Definitions:</p>\n\n<pre><code>(+) :: N -&gt; N -&gt; N\n(+) = \\m n -&gt; case m of { 0 -&gt; n; S(y) -&gt; S(y+n)}\n\n(*) :: N -&gt; N -&gt; N\n(*) = \\m n -&gt; case m of { 0 -&gt; 0; S y -&gt; n + (y*n)}\n</code></pre>\n\n<p>My idea was to do what I did for a previous exercise, prove for each possible case of m. The difference is that the exercise I did was for Boolean type, which can only be true or false and this is a natural, so my guess was to do the proof for the cases m = 0 and m = S(y)</p>\n\n<p>I easily managed to prove the equality for m = 0 but got stuck when doing it for m = S(y)</p>\n\n<p>Case m = 0</p>\n\n<pre><code>(0 + n) * k =? 0 * k + n * k\nLeft side:\n(0 + n) * k = (case 0 of {0-&gt;n;Sy-&gt;...}) * k\n= n * k\nRight side:\n0 * k + n * k = (case 0 of {0-&gt;0;Sy-&gt;...}) + (n * k)\n= 0 + (n * k) = (case 0 of {0-&gt;(n*k);Sy-&gt;...}) = n * k (equal to the left side)\n</code></pre>\n\n<p>Case m = S(y)</p>\n\n<pre><code>(Sy + n) * k =? Sy * k + n * k\nLeft side:\n(case Sy of {0-&gt;...;Sy-&gt;S(y+n)}) * k = S(y+n) * k\n= case Sx of {0-&gt;...;Sx-&gt; k + k * (y+n)\nRight side:\nSy * k + n * k = (case Sy of {0-&gt;...;Sy-&gt;k + k*y}) + n * k\n= k + k*y + n * k (Point at which I got stuck)\n</code></pre>\n\n<p>(...) Stands for irrelevant code</p>\n\n<p>On a side question, what exactly does the arrow down \u21d3 on \u2200m\u21d3 mean? Thanks in advance!</p>\n"}, {"tags": ["haskell", "types", "functional-programming", "type-theory", "hindley-milner"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6907139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60f468ac8240365d1faa36521ecaaf3a?s=128&d=identicon&r=PG&f=1", "display_name": "EvHi", "link": "https://stackoverflow.com/users/6907139/evhi"}, "is_accepted": false, "score": 1, "last_activity_date": 1475358245, "creation_date": 1475358245, "answer_id": 39811738, "question_id": 39810259, "link": "https://stackoverflow.com/questions/39810259/limit-a-number-to-a-range-haskell/39811738#39811738", "title": "Limit a number to a range (Haskell)", "body": "<p>What you're asking for is dependent types. There is a nice tutorial on it in\n<a href=\"https://www.schoolofhaskell.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell\" rel=\"nofollow\">https://www.schoolofhaskell.com/user/konn/prove-your-haskell-for-great-safety/dependent-types-in-haskell</a></p>\n\n<p>Although I don't know how friendly it will be. Do note that dependent typing was improved in GHC 8.0 but I have no experience in that area. I would make sure you're comfortable using template Haskell if you don't want it to be cumbersome.</p>\n"}, {"comments": [{"owner": {"reputation": 287, "user_id": 1156729, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b54204ee7bcdce5b04323d0d842596e1?s=128&d=identicon&r=PG", "display_name": "doodledood", "link": "https://stackoverflow.com/users/1156729/doodledood"}, "edited": false, "score": 0, "creation_date": 1475409466, "post_id": 39811823, "comment_id": 66923725, "body": "Thanks for the answer :) I like how changing the interpretation keeps things simple."}], "tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 16, "last_activity_date": 1475358940, "creation_date": 1475358940, "answer_id": 39811823, "question_id": 39810259, "link": "https://stackoverflow.com/questions/39810259/limit-a-number-to-a-range-haskell/39811823#39811823", "title": "Limit a number to a range (Haskell)", "body": "<p>This doesn't exactly answer your question, but one approach that sometimes works is to change your <em>interpretation</em> of your type. For example, instead of</p>\n\n<pre><code>data Range = {lo :: Integer, hi :: Integer}\n</code></pre>\n\n<p>you could use</p>\n\n<pre><code>data Range = {lo :: Integer, size :: Natural}\n</code></pre>\n\n<p>This way, there's no way to represent an invalid range.</p>\n"}, {"comments": [{"owner": {"reputation": 287, "user_id": 1156729, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b54204ee7bcdce5b04323d0d842596e1?s=128&d=identicon&r=PG", "display_name": "doodledood", "link": "https://stackoverflow.com/users/1156729/doodledood"}, "edited": false, "score": 2, "creation_date": 1475409431, "post_id": 39812205, "comment_id": 66923715, "body": "Thanks for the answer, cool stuff :). But I think it is a bit too much and I find dfeuer&#39;s answer to be much more simple and satisfy my requirements."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 10, "last_activity_date": 1475364051, "last_edit_date": 1475364051, "creation_date": 1475362378, "answer_id": 39812205, "question_id": 39810259, "link": "https://stackoverflow.com/questions/39810259/limit-a-number-to-a-range-haskell/39812205#39812205", "title": "Limit a number to a range (Haskell)", "body": "<p>This solution uses dependent types (and might be too heavyweight, check if <em>dfeuer</em>'s answer is enough for your needs).</p>\n\n<p>The solution makes use of the <code>GHC.TypeLits</code> module from <em>base</em>, and also of the <a href=\"http://hackage.haskell.org/package/typelits-witnesses-0.2.3.0\"><em>typelits-witnesses</em></a> package.</p>\n\n<p>Here is a difference function that takes two integer arguments (known statically) and complains at compile-time when the first number is greater than the second:</p>\n\n<pre><code>{-# language TypeFamilies #-}\n{-# language TypeOperators #-}\n{-# language DataKinds #-}\n{-# language ScopedTypeVariables #-}\n\nimport GHC.TypeLits\nimport GHC.TypeLits.Compare\nimport Data.Type.Equality\nimport Data.Proxy\nimport Control.Applicative\n\ndifference :: forall n m. (KnownNat n,KnownNat m,n &lt;= m) \n           =&gt; Proxy n \n           -&gt; Proxy m \n           -&gt; Integer\ndifference pn pm = natVal pm - natVal pn\n</code></pre>\n\n<p>We can check it from GHCi:</p>\n\n<pre><code>ghci&gt; import Data.Proxy\nghci&gt; :set -XTypeApplications\nghci&gt; :set -XDataKinds\nghci&gt; difference (Proxy @2) (Proxy @7)\n5\nghci&gt; difference (Proxy @7) (Proxy @2)\n** TYPE ERROR **\n</code></pre>\n\n<p>But what if we want to use the function with values determined at run time? Say, values that we read from console, or from a file?</p>\n\n<pre><code>main :: IO ()\nmain = do\n   case (,) &lt;$&gt; someNatVal 2 &lt;*&gt; someNatVal 7 of\n       Just (SomeNat proxyn,SomeNat proxym) -&gt;\n            case isLE proxyn proxym of\n                Just Refl -&gt; print $ difference proxyn proxym \n                Nothing   -&gt; error \"first number not less or equal\"\n       Nothing -&gt;     \n            error \"could not bring KnownNat into scope\"\n</code></pre>\n\n<p>In this case, we use functions like <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html#v:someNatVal\"><code>someNatVal</code></a> and <a href=\"http://hackage.haskell.org/package/typelits-witnesses-0.2.3.0/docs/GHC-TypeLits-Compare.html#v:isLE\"><code>isLE</code></a>. These functions might fail with <code>Nothing</code>. If they succeed, however, they return a value that \"witnesses\" some constraint. And by pattern-matching on the witness, we bring that constraint into scope (this works because the witness is a GADT).</p>\n\n<p>In the example, the <code>Just (SomeNat proxyn,SomeNat proxym)</code> pattern match brings <code>KnownNat</code> constraints for the two arguments into scope. And the <code>Just Refl</code> pattern match brings the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/GHC-TypeLits.html#t:-60--61-\"><code>n &lt;= m</code></a> constraint into scope. Only then we can call our <code>difference</code> function.</p>\n\n<p>So, in a way, we have shifted all the busywork of ensuring that the arguments satisfy the required preconditions out of the function itself.</p>\n"}, {"tags": [], "owner": {"reputation": 398, "user_id": 1351182, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/a19ea4f2204cb5ccc2745fcdf8cda84c?s=128&d=identicon&r=PG", "display_name": "Myridium", "link": "https://stackoverflow.com/users/1351182/myridium"}, "is_accepted": false, "score": 1, "last_activity_date": 1475390092, "creation_date": 1475390092, "answer_id": 39814492, "question_id": 39810259, "link": "https://stackoverflow.com/questions/39810259/limit-a-number-to-a-range-haskell/39814492#39814492", "title": "Limit a number to a range (Haskell)", "body": "<p>You needn't invoke the <code>Maybe</code> type to take advantage of 'smart constructors'. If you like, you may accept constructors of either form <code>(min,max)</code> or <code>(max,min)</code> and still create a <code>data</code> type which correctly interprets which is  which.</p>\n\n<p>For instance, you could make a little module:</p>\n\n<pre><code>module RangeMinMax (\n               Range,\n               makeRange\n              )\nwhere\n\ndata Range = Range (Integer,Integer)\n  deriving Show\nmakeRange a b = Range (min a b, max a b)\n</code></pre>\n\n<p>And now when you create a <code>Range</code> using <code>makeRange</code>, the 2-tuple will automatically be arranged so it's in the form <code>(min,max)</code>. Note that the constructor for <code>Range</code> is not exported, so the user of the module is unable to create an invalid <code>Range</code>-- you just need to make sure that you create valid ones in the this module.</p>\n"}], "owner": {"reputation": 287, "user_id": 1156729, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b54204ee7bcdce5b04323d0d842596e1?s=128&d=identicon&r=PG", "display_name": "doodledood", "link": "https://stackoverflow.com/users/1156729/doodledood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2058, "favorite_count": 3, "accepted_answer_id": 39811823, "answer_count": 4, "score": 9, "last_activity_date": 1475390092, "creation_date": 1475347468, "question_id": 39810259, "link": "https://stackoverflow.com/questions/39810259/limit-a-number-to-a-range-haskell", "title": "Limit a number to a range (Haskell)", "body": "<p>I am exposing a function which takes two parameters, one is a minimum bound and the other is a maximum bound. How can I ensure, using types, that for example the minimum bound is not greater than the maximum bound?</p>\n\n<p>I want to avoid creating a smart constructor and returning a Maybe because it would make the whole usage more cumbersome.</p>\n\n<p>Thank you</p>\n"}, {"tags": ["list", "haskell", "recursion", "repeat", "infinite"], "comments": [{"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 4, "creation_date": 1475346282, "post_id": 39809592, "comment_id": 66911522, "body": "<a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:iterate\" rel=\"nofollow noreferrer\"><code>iterate P (0, 0)</code></a>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 2, "creation_date": 1475346954, "post_id": 39809592, "comment_id": 66911723, "body": "Please don&#39;t remove your example code. Everyone starts out somewhere. There&#39;s no need to be ashamed of it :)"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475355268, "post_id": 39809592, "comment_id": 66914070, "body": "@Rhymoid, are you suggesting my elementary school Logo, BASIC, and Turbo Pascal code may have left something to be desired? I have only ever written perfect code myself, and I expect the same of everyone else. Programming is Serious Business, and there&#39;s no room for any mistakes!"}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 6908903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37ce6a8bf87ee04a52f226e670755797?s=128&d=identicon&r=PG&f=1", "display_name": "Curious", "link": "https://stackoverflow.com/users/6908903/curious"}, "edited": false, "score": 0, "creation_date": 1475345679, "post_id": 39809855, "comment_id": 66911318, "body": "Thank you so much! That makes a lot of sense!"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "is_accepted": false, "score": 8, "last_activity_date": 1475351909, "last_edit_date": 1475351909, "creation_date": 1475344986, "answer_id": 39809855, "question_id": 39809592, "link": "https://stackoverflow.com/questions/39809592/haskell-infinite-recursion-in-list-comprehension/39809855#39809855", "title": "Haskell infinite recursion in list comprehension", "body": "<p>Let's first ignore the exact question you have, and focus on getting the loop working. What you want, essentially, is to have something that takes some initial value <code>iv</code> (namely, <code>(0, 0)</code> for <code>(u, v)</code>), and returns the list</p>\n\n\n\n<pre class=\"lang-hs prettyprint-override\"><code>f iv : f (f iv) : f (f (f iv)) : f (f (f (f iv))) : ...\n</code></pre>\n\n<p>for some function <code>f</code> (constructed from your <code>p</code> and <code>(x, y)</code>). Moreover, you want the result to reuse the previously computed elements of the list. If I would write a function myself that does this, it might looke like this (but maybe with some different names):</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>looper :: (a -&gt; a) -&gt; a -&gt; [a]\nlooper f iv = one_result : more_results\n  where\n    one_result   = f iv\n    more_results = looper f one_result\n</code></pre>\n\n<p>But, of course, I would first <a href=\"https://www.haskell.org/hoogle/?hoogle=%28a+-%3E+a%29+-%3E+a+-%3E+%5Ba%5D\" rel=\"nofollow noreferrer\">look</a> if a function with that type exists. It does: it's called <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-List.html#v:iterate\" rel=\"nofollow noreferrer\"><code>Data.List.iterate</code></a>. The only thing it does wrong is the first element of the list will be <code>iv</code>, but that can be easily fixed by using <code>tail</code> (which is fine here: as long as your iteration function terminates, <code>iterate</code> will always generate an infinite list).</p>\n\n<hr>\n\n<p>Let's now get back to your case. We established that it'll generally look like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>o :: Num a =&gt; (a, a) -&gt; [(a, a)]\no (x, y) = tail (iterate f iv)\n  where\n    f (u, v) = undefined\n    iv = undefined\n</code></pre>\n\n<p>As you indicated, the initial value of <code>(u, v)</code> is <code>(0, 0)</code>, so that's what our definition of <code>iv</code> will be. <code>f</code> now has to call <code>p</code> with the <code>(x, y)</code> from <code>o</code>'s argument and the <code>(u, v)</code> for that iteration:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>o :: Num a =&gt; (a, a) -&gt; [(a, a)]\no (x, y) = tail (iterate f iv)\n  where\n    f (u, v) = p (x, y) (u, v)\n    iv = (0, 0)\n    p = undefined\n</code></pre>\n\n<p>It's as simple as that: the <code>(x, y)</code> from <code>o</code>'s definition is actually in scope in the <code>where</code>-clause. You could even decide to merge <code>f</code> and <code>p</code>, and end up with</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>o :: Num a =&gt; (a, a) -&gt; [(a, a)]\no (x, y) = tail (iterate p iv)\n  where\n    iv = (0, 0)\n    p (u, v) = (u^2 - v^2 + x, 2 * u * v + y)\n</code></pre>\n\n<hr>\n\n<p>Also, may I suggest that you use <code>Data.Complex</code> for your application? This makes the constraints on <code>a</code> a bit stricter (you need <code>RealFloat a</code>, because of <code>Num.signum</code>), but in my opinion, it makes your code much easier to read:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>import Data.Complex\nimport Data.List (iterate)\n\n{- ... -}\n\no :: Num (Complex a) =&gt; Complex a -&gt; [Complex a]\no c = tail (iterate p iv)\n  where\n    iv = 0  -- or \"0 :+ 0\", if you want to be explicit\n    p z = z^2 + c\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user824425"}, "edited": false, "score": 0, "creation_date": 1475371433, "post_id": 39811255, "comment_id": 66917083, "body": "Are you sure that this performs as efficiently as a solution based on <code>iterate</code>?"}], "tags": [], "owner": {"reputation": 121, "user_id": 2924117, "user_type": "registered", "profile_image": "https://graph.facebook.com/821112709/picture?type=large", "display_name": "Arthur Welf", "link": "https://stackoverflow.com/users/2924117/arthur-welf"}, "is_accepted": false, "score": 0, "last_activity_date": 1475354438, "creation_date": 1475354438, "answer_id": 39811255, "question_id": 39809592, "link": "https://stackoverflow.com/questions/39809592/haskell-infinite-recursion-in-list-comprehension/39811255#39811255", "title": "Haskell infinite recursion in list comprehension", "body": "<p>You want: </p>\n\n<ol>\n<li>To construct a list <code>[(u, v)]</code> with the head of this list equal <code>(0, 0)</code></li>\n<li>And then <code>map</code> this list with the function <code>\\(u, v) -&gt; (u^2 - v^2 + x, 2 * u * v + y)</code>, appending results of this function to the list. </li>\n</ol>\n\n<p>We can write this function as described: \n</p>\n\n<pre><code>func :: (Num t) =&gt; (t, t) -&gt; [(t, t)]\nfunc (x, y) = (0, 0) : map functionP (func (x, y))\n    where functionP (u, v) = (u^2 - v^2 + x, 2 * u * v + y)\n\nGHCi &gt; take 5 $ func (1, 2)\n     &gt; [(0,0),(1,2),(-2,6),(-31,-22),(478,1366)]\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 6908903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37ce6a8bf87ee04a52f226e670755797?s=128&d=identicon&r=PG&f=1", "display_name": "Curious", "link": "https://stackoverflow.com/users/6908903/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 805, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1475354438, "creation_date": 1475343349, "last_edit_date": 1475353262, "question_id": 39809592, "link": "https://stackoverflow.com/questions/39809592/haskell-infinite-recursion-in-list-comprehension", "title": "Haskell infinite recursion in list comprehension", "body": "<p>I am trying to define a function that accepts a point (x,y) as input, and returns an infinite list corresponding to recursively calling</p>\n\n<blockquote>\n  <p>P = (u^2 \u2212 v^2 + x, 2uv + y)</p>\n</blockquote>\n\n<p>The initial values of u and v are both 0.</p>\n\n<ul>\n<li><p>The first call would be</p>\n\n<blockquote>\n  <p>P = (0^2 - 0^2 + 1, 2(0)(0) + 2) = (1,2)</p>\n</blockquote></li>\n<li><p>Then that resulting tuple (1,2) would be the next values for u and v, so then it would be</p>\n\n<blockquote>\n  <p>P = (1^2 - 2^2 + 1, 2(1)(2) + 2) = (-2,6)</p>\n</blockquote></li>\n</ul>\n\n<p>and so on.</p>\n\n<p>I'm trying to figure out how to code this in Haskell. This is what I have so far:</p>\n\n<pre><code>o :: Num a =&gt;(a,a) -&gt; [(a,a)]\no (x,y) = [(a,b)| (a,b)&lt;- [p(x,y)(x,y)]]   \n  where p(x,y)(u,v) = ((u^2)-(v^2)+x,(2*u*v)+y)\n</code></pre>\n\n<p>I'm really not sure how to make this work. Any help would be appreciated! </p>\n"}, {"tags": ["algorithm", "haskell"], "answers": [{"tags": [], "owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "is_accepted": false, "score": 3, "last_activity_date": 1475352850, "last_edit_date": 1475352850, "creation_date": 1475344504, "answer_id": 39809767, "question_id": 39809527, "link": "https://stackoverflow.com/questions/39809527/explain-and-clarify-haskell-counting-sort/39809767#39809767", "title": "Explain and Clarify Haskell Counting Sort", "body": "<p><code>count</code> through <a href=\"https://hackage.haskell.org/package/array-0.5.1.1/docs/Data-Array.html#v:accumArray\" rel=\"nofollow\"><code>accumArray</code></a> works as histogram builder. That is, for each number from <code>lo</code> to <code>hi</code> it returns how many times the number occurs in the argument list. </p>\n\n<pre><code>count ::  (Ix i, Num e) =&gt; [i] -&gt; i -&gt; i -&gt; [(i, e)]\ncount l lo hi = assocs . accumArray (+) 0 (lo, hi) . map (\\i -&gt; (i, 1)) $ l\n\ncount [6,2,1,6] 0 10 ==  \n   [(0,0),(1,1),(2,1),(3,0),(4,0),(5,0),(6,2),(7,0),(8,0),(9,0),(10,0)]\n</code></pre>\n\n<p>Results of <code>count</code> are used to generate original elements back from this specification. That is done by  <code>replicate</code>ing  each <code>fst</code> element of tuple <code>snd</code> number of times . This yields list of lists that are concatenated together.</p>\n\n<pre><code> f l lo hi = map (uncurry $ flip replicate ) $ count l lo hi\n f [6,2,1,6] 0 10 == [[],[1],[2],[],[],[],[6,6],[],[],[],[]]\n</code></pre>\n\n<p>Full solution is equivalent to </p>\n\n<pre><code>countingSort l lo hi = concat $ f l lo hi\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475357470, "post_id": 39809794, "comment_id": 66914612, "body": "You could also skip the <code>concat</code> with <code>[occurrence | (n, times) &lt;- counts, occurrence &lt;- replicate times n]</code>. Oh, and <code>uncurry (flip . replicate)</code> is horrible, IMO."}, {"owner": {"reputation": 271, "user_id": 3574479, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef0ae971aa925ec2f6c2ff12cc99c822?s=128&d=identicon&r=PG", "display_name": "joeA", "link": "https://stackoverflow.com/users/3574479/joea"}, "edited": false, "score": 0, "creation_date": 1479068339, "post_id": 39809794, "comment_id": 68392325, "body": "I accepted because this appears to be an excellent answer, however it is still not clear to me that this is actually doing counting sort (in the style of the CLRS book). I had hoped to give this the time it deserves, but I don&#39;t think that&#39;s going to happen any time soon. As I understand it, counting sort (CLRS-style) relies on arrays with numeric indexes to <i>avoid comparisons</i> and do the sort just by counting. Without having dug into the implementation of accumArray and Data.Array, it looks like accumArray is doing some kind of sort with comparisons (and thus not a counting sort)."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 271, "user_id": 3574479, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef0ae971aa925ec2f6c2ff12cc99c822?s=128&d=identicon&r=PG", "display_name": "joeA", "link": "https://stackoverflow.com/users/3574479/joea"}, "edited": false, "score": 0, "creation_date": 1479153152, "post_id": 39809794, "comment_id": 68428915, "body": "@joeA I&#39;d be very surprised if <code>accumArray</code> did any comparisons... why would it? It should basically be &quot;for each tuple (x,y): add x to element y of the array.&quot; That&#39;s just indexing into an array and doing addition."}, {"owner": {"reputation": 271, "user_id": 3574479, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef0ae971aa925ec2f6c2ff12cc99c822?s=128&d=identicon&r=PG", "display_name": "joeA", "link": "https://stackoverflow.com/users/3574479/joea"}, "edited": false, "score": 0, "creation_date": 1479167670, "post_id": 39809794, "comment_id": 68435220, "body": "@smarx Perhaps you&#39;re right. I don&#39;t have a good understanding of Array in haskell and I naively think of them as just lists of pairs, and I thought of accumArray as manipulating the (unordered) list of pairs that is its argument."}, {"owner": {"reputation": 271, "user_id": 3574479, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef0ae971aa925ec2f6c2ff12cc99c822?s=128&d=identicon&r=PG", "display_name": "joeA", "link": "https://stackoverflow.com/users/3574479/joea"}, "edited": false, "score": 0, "creation_date": 1479263098, "post_id": 39809794, "comment_id": 68480115, "body": "@smarx Having now read <a href=\"https://www.haskell.org/tutorial/arrays.html\" rel=\"nofollow noreferrer\">A Gentle Introduction to Haskell/Arrays</a> and <a href=\"http://stackoverflow.com/questions/5773070/how-are-mutable-arrays-implemented-in-haskell\">How are mutable arrays implemented in Haskell?</a> (to the degree that I understand it) I guess I should just think of haskell&#39;s Data.Array as good old imperative-style arrays. Thanks for the answer."}], "tags": [], "owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "is_accepted": true, "score": 7, "last_activity_date": 1475354296, "last_edit_date": 1475354296, "creation_date": 1475344629, "answer_id": 39809794, "question_id": 39809527, "link": "https://stackoverflow.com/questions/39809527/explain-and-clarify-haskell-counting-sort/39809794#39809794", "title": "Explain and Clarify Haskell Counting Sort", "body": "<p>It is indeed doing a counting sort. Here's a slightly rewritten version that I find easier to understand:</p>\n\n<pre><code>import Data.Array\n\ncountingSort :: (Ix n) =&gt; [n] -&gt; n -&gt; n -&gt; [n]\ncountingSort l lo hi = concat [replicate times n | (n, times) &lt;- counts]\n  where counts = assocs (accumArray (+) 0 (lo, hi) [(i, 1) | i &lt;- l])\n</code></pre>\n\n<p>Let's break it down step by step. We'll use the list <code>[5, 3, 1, 2, 3, 4, 5]</code>.</p>\n\n<pre><code>*Main&gt; [(i, 1) | i &lt;- [5, 3, 1, 2, 3, 4, 5]]\n[(5,1),(3,1),(1,1),(2,1),(3,1),(4,1),(5,1)]\n</code></pre>\n\n<p>We're just taking every element of the list and turning it into a tuple with 1. This is the basis for our counts. Now we need a way to sum up those counts per element. This is where <a href=\"http://hackage.haskell.org/package/array-0.5.1.1/docs/Data-Array-IArray.html#v:accumArray\"><code>accumArray</code></a> comes into play.</p>\n\n<pre><code>*Main&gt; accumArray (+) 0 (1, 5) [(i, 1) | i &lt;- [5, 3, 1, 2, 3, 4, 5]]\narray (1,5) [(1,1),(2,1),(3,2),(4,1),(5,2)]\n</code></pre>\n\n<p>The first parameter to <code>accumArray</code> is the operation to apply during accumulation (just simple addition for us). The second parameter is the starting value, and the third parameter is the bounds. So we end up with an array mapping numbers to their counts in the input.</p>\n\n<p>Next we use <a href=\"http://hackage.haskell.org/package/containers-0.5.8.1/docs/Data-IntMap-Strict.html#v:assocs\"><code>assocs</code></a> to get key/value tuples from the map:</p>\n\n<pre><code>*Main&gt; assocs $ accumArray (+) 0 (1, 5) [(i, 1) | i &lt;- [5, 3, 1, 2, 3, 4, 5]]\n[(1,1),(2,1),(3,2),(4,1),(5,2)]\n</code></pre>\n\n<p>And then <code>replicate</code> to repeat each number based on its count:</p>\n\n<pre><code>*Main&gt; [replicate times n | (n, times) &lt;- assocs $ accumArray (+) 0 (1, 5) [(i, 1) | i &lt;- [5, 3, 1, 2, 3, 4, 5]]]\n[[1],[2],[3,3],[4],[5,5]]\n</code></pre>\n\n<p>Finally, we use concat to turn this list of lists into a single list:</p>\n\n<pre><code>*Main&gt; concat [replicate times n | (n, times) &lt;- assocs $ accumArray (+) 0 (1, 5) [(i, 1) | i &lt;- [5, 3, 1, 2, 3, 4, 5]]]\n[1,2,3,3,4,5,5]\n</code></pre>\n\n<p>In the actual function I wrote above, I used <code>where</code> to break up this one-liner.</p>\n\n<p>I find list comprehension to be easier to deal with than <code>map</code> and <code>concatMap</code>, so those are the main changes I made in my version of the function.</p>\n\n<p><code>(uncurry $ flip replicate)</code> is a nice trick... <code>flip replicate</code> gives you a version of <code>replicate</code> that takes its arguments in the opposite order. <code>uncurry</code> takes that curried function and turns it into a function that takes a tuple as an argument instead. Together, those produce the same result as my list comprehension, which destructured the tuple and then passed its parameters in reverse order. I'm not familiar enough with Haskell to know if this is a common idiom, but for me, the list comprehension was easier to follow.</p>\n"}], "owner": {"reputation": 271, "user_id": 3574479, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef0ae971aa925ec2f6c2ff12cc99c822?s=128&d=identicon&r=PG", "display_name": "joeA", "link": "https://stackoverflow.com/users/3574479/joea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 540, "favorite_count": 1, "accepted_answer_id": 39809794, "answer_count": 2, "score": 2, "last_activity_date": 1475354296, "creation_date": 1475342837, "last_edit_date": 1475344743, "question_id": 39809527, "link": "https://stackoverflow.com/questions/39809527/explain-and-clarify-haskell-counting-sort", "title": "Explain and Clarify Haskell Counting Sort", "body": "<p>I am working through <em>Cormen et. al., Introduction to Algorithms, 3rd ed.</em>, but I also have an interest in Haskell. Section 8.2 (p. 194) covers counting sort. I was interested in how it and many algorithms might be implemented in haskell as they often use array access and destructive update. I took a look at the implementation on <a href=\"https://rosettacode.org/wiki/Sorting_algorithms/Counting_sort#Haskell\" rel=\"nofollow\">RosettaCode</a> (copied below) and I find it very difficult to follow.</p>\n\n<pre><code>import Data.Array\n\ncountingSort :: (Ix n) =&gt; [n] -&gt; n -&gt; n -&gt; [n]\ncountingSort l lo hi = concatMap (uncurry $ flip replicate) count\n  where count = assocs . accumArray (+) 0 (lo, hi) . map (\\i -&gt; (i, 1)) $ l\n</code></pre>\n\n<p>One of the things I like about haskell is how algorithms can be very clear (e.g. Haskell quicksort examples), at least as a specification that hasn't been optimized. This seems very unclear and I wonder if it's necessarily so or just overdone.</p>\n\n<p>Can someone</p>\n\n<ol>\n<li>clarify what's going on here,</li>\n<li>perhaps provide a more instructive and clear implementation, and</li>\n<li>tackle whether this is actually implementing counting sort or if non-strictness (lazyness) and immutability mean that this is actually some other sort disguised as counting sort?</li>\n</ol>\n"}, {"tags": ["haskell", "bytestring"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475422684, "post_id": 39809365, "comment_id": 66927382, "body": "Your desire is unclear.  What does <code>[255,0] + [1,0]</code> equal?  <code>[0,1]</code> for little endian 16 bit number? <code>[1,0,0]</code> for a big endian unbounded size number? <code>[0,0]</code> for 2 8 bit numbers?  If it is the first then you could resurrect the <a href=\"http://hackage.haskell.org/package/NumLazyByteString-0.0.0.1/docs/Data-ByteString-Lazy-Num.html\" rel=\"nofollow noreferrer\">NumLazyByteString package</a>"}, {"owner": {"reputation": 1627, "user_id": 1116674, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a67699697916153ccbf869f9f1383c8f?s=128&d=identicon&r=PG", "display_name": "Hudon", "link": "https://stackoverflow.com/users/1116674/hudon"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475426955, "post_id": 39809365, "comment_id": 66928742, "body": "@ThomasM.DuBuisson I get to define how I want my number represented, basically. My constraints are: I&#39;m generating a random bytestring of 256 bits in length. I need the concept of addition and subtraction, such that when I add &quot;a + b = c&quot;, I can get &quot;c - b = a&quot;. How I decode a number out of the bytestring is up to me, as long as those operations work in a consistent way"}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475431392, "post_id": 39809365, "comment_id": 66930180, "body": "Ok, in that case just make <code>a + _ = a</code> and <code>x - _ = x</code> (aka <code>const</code>).  When you don&#39;t need commutativity you can make the operations much faster."}, {"owner": {"reputation": 1627, "user_id": 1116674, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a67699697916153ccbf869f9f1383c8f?s=128&d=identicon&r=PG", "display_name": "Hudon", "link": "https://stackoverflow.com/users/1116674/hudon"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475442698, "post_id": 39809365, "comment_id": 66933847, "body": "To be more precise: <code>c - a = b</code> would need to be true as well, so say: <code>for all a, b : if a + b = c then c - a = b and c - b = a</code>"}, {"owner": {"reputation": 1627, "user_id": 1116674, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a67699697916153ccbf869f9f1383c8f?s=128&d=identicon&r=PG", "display_name": "Hudon", "link": "https://stackoverflow.com/users/1116674/hudon"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475444917, "post_id": 39809365, "comment_id": 66934465, "body": "And if you want full context: I&#39;m implementing the FairExchange protocol defined here <a href=\"https://crypto.stanford.edu/~xb/fc12/bitcoin.pdf\" rel=\"nofollow noreferrer\">crypto.stanford.edu/~xb/fc12/bitcoin.pdf</a> in section 7. Alice has secrets <code>a</code> and Bob has secrets <code>b</code> and knows Alice&#39;s <code>a</code>s. Bob publishes <code>a + b</code> (publicly) and Alice is the only one that can then figure out Bob&#39;s <code>b</code>s (by doing <code>a + b - a</code>). I&#39;m considering not using <code>genBytes</code> but instead using your <code>crandom</code> function to return <code>Integer</code>s"}, {"owner": {"reputation": 1627, "user_id": 1116674, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a67699697916153ccbf869f9f1383c8f?s=128&d=identicon&r=PG", "display_name": "Hudon", "link": "https://stackoverflow.com/users/1116674/hudon"}, "reply_to_user": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475448472, "post_id": 39809365, "comment_id": 66935368, "body": "ok... I ended up using <code>crandomRs</code> to get signed 256-bit Integers and just doing the math on that instead of dealing with bytestrings..."}, {"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475462779, "post_id": 39809365, "comment_id": 66938017, "body": "@Hudson.  Sounds good.  An alternative would be use of xor.  <code>(+) = (-) = B.pack . B.zipWith xor</code>"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475350915, "post_id": 39809366, "comment_id": 66912949, "body": "Going through lists doesn&#39;t seem likely to be terrifically efficient."}, {"owner": {"reputation": 1627, "user_id": 1116674, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a67699697916153ccbf869f9f1383c8f?s=128&d=identicon&r=PG", "display_name": "Hudon", "link": "https://stackoverflow.com/users/1116674/hudon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475356043, "post_id": 39809366, "comment_id": 66914276, "body": "Sure, feel free to give a better answer! I&#39;m trying to opt for simplicity but if there&#39;s a simple and more performant solution I&#39;ll take it"}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475357166, "post_id": 39809366, "comment_id": 66914537, "body": "I don&#39;t know about simple. The simplest little-endian approach that seems likely to be reasonable is to index into the bytestrings manually while filling the result. For big-endian ones, a lot of extra effort should be able to make it scream: dig into the bytestring representation to get at the pointers, cast them to <code>Word#</code> pointers, and then perform word-wise addition, handling carrying manually with bitwise operations. I think that gets it down to around three arithmetic instructions per 8 bytes. It&#39;s also possible that someone has already written a library for this stuff somewhere."}, {"owner": {"reputation": 1627, "user_id": 1116674, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a67699697916153ccbf869f9f1383c8f?s=128&d=identicon&r=PG", "display_name": "Hudon", "link": "https://stackoverflow.com/users/1116674/hudon"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475361813, "post_id": 39809366, "comment_id": 66915566, "body": "nice, I&#39;ll look into this if I need to speed things up, thank you! It could be either LE or BE (it&#39;s my bytestring and it&#39;s initially random so I can decide), but I will be doing addition and subtraction so as long as I&#39;m consistent with one I&#39;m good"}, {"owner": {"reputation": 9721, "user_id": 131057, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4d84023d355c712ca3a393881e862679?s=128&d=identicon&r=PG", "display_name": "Luka Rahne", "link": "https://stackoverflow.com/users/131057/luka-rahne"}, "edited": false, "score": 0, "creation_date": 1475362299, "post_id": 39809366, "comment_id": 66915667, "body": "For little endian (x64) you can take 64 bits out and perform 64 biit addition instead 8 8bit additions."}], "tags": [], "owner": {"reputation": 1627, "user_id": 1116674, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a67699697916153ccbf869f9f1383c8f?s=128&d=identicon&r=PG", "display_name": "Hudon", "link": "https://stackoverflow.com/users/1116674/hudon"}, "is_accepted": false, "score": 1, "last_activity_date": 1475347468, "last_edit_date": 1475347468, "creation_date": 1475341834, "answer_id": 39809366, "question_id": 39809365, "link": "https://stackoverflow.com/questions/39809365/how-do-you-add-two-large-random-bytestrings-in-haskell/39809366#39809366", "title": "How do you add two large random bytestrings in Haskell?", "body": "<ol>\n<li><strong>Solution 1</strong></li>\n</ol>\n\n<p>It seems that there is no <code>math-buffer</code>-like packages in Haskell, so you would be forced to implement these byte-wise operations yourself and use math-buffer for inspiration. So you would unpack your bytestring to a list of <code>Word8</code>s and then implement addition of a base-256 number, like so:</p>\n\n<pre><code>byteSum :: [Word8] -&gt; [Word8] -&gt; [Word8]\nbyteSum = byteSum' 0\n  where\n    byteSum' 0 [] [] = []\n    byteSum' 1 [] [] = [1]\n    byteSum' carry (x:xs) (y:ys) =\n        let v = x + y + carry\n        in v : byteSum' (if v &lt; x || v &lt; y then 1 else 0) xs ys\n\nmain = do\n    let bs1 = ...\n    let bs2 = ...\n    let sum = pack $ byteSum (unpack bs1) (unpack bs2)\n</code></pre>\n\n<p>Note this is assuming little-endianness (least significant byte first).</p>\n\n<ol start=\"2\">\n<li><strong>Solution 2</strong></li>\n</ol>\n\n<p>Alternatively, assume this bytestring is a big-endian unsigned integer, convert from <code>ByteString -&gt; Integer</code> and let the Integer to the math, then convert it back:</p>\n\n<pre><code>bstoi :: ByteString -&gt; Integer\nbstoi = fromDigits 0 . unpack\n  where\n    fromDigits n [] = n\n    fromDigits n (x:xs) = fromDigits (n * 256 + (toInteger x)) xs\n\nitobs :: Integer -&gt; ByteString\nitobs = pack . reverse . toDigits\n  where\n    toDigits 0 = []\n    toDigits x = (fromIntegral $ x `mod` 256) : toDigits (x `div` 256)\n\nmain = do\n    let bs1 = ...\n    let bs2 = ...\n    let sum = itobs $ (bstoi bs1) + (bstoi bs2)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475422850, "post_id": 39814709, "comment_id": 66927441, "body": "This assumes the bytestrings are streams of independent 8 bit numbers."}], "tags": [], "owner": {"reputation": 11, "user_id": 6888557, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1GoaF.jpg?s=128&g=1", "display_name": "maru", "link": "https://stackoverflow.com/users/6888557/maru"}, "is_accepted": false, "score": 0, "last_activity_date": 1475392337, "creation_date": 1475392337, "answer_id": 39814709, "question_id": 39809365, "link": "https://stackoverflow.com/questions/39809365/how-do-you-add-two-large-random-bytestrings-in-haskell/39814709#39814709", "title": "How do you add two large random bytestrings in Haskell?", "body": "<p>import qualified Data.ByteString.Lazy as BL</p>\n\n<p>pizdec bl = BL.pack . BL.zipWith (+) bl</p>\n"}], "owner": {"reputation": 1627, "user_id": 1116674, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/a67699697916153ccbf869f9f1383c8f?s=128&d=identicon&r=PG", "display_name": "Hudon", "link": "https://stackoverflow.com/users/1116674/hudon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1475392337, "creation_date": 1475341834, "last_edit_date": 1475384814, "question_id": 39809365, "link": "https://stackoverflow.com/questions/39809365/how-do-you-add-two-large-random-bytestrings-in-haskell", "title": "How do you add two large random bytestrings in Haskell?", "body": "<p>I have two lazy bytestrings that were generated randomly using the <code>DRBG</code> package. I want to interpret these bytestrings as numbers and be able to perform addition on them. So something like a function with signature <code>ByteString -&gt; ByteString -&gt; ByteString</code>. </p>\n\n<p>In JavaScript, I was using the <a href=\"https://github.com/dominictarr/math-buffer\" rel=\"nofollow\">math-buffer</a> package\nHow can I do this in Haskell?</p>\n"}, {"tags": ["performance", "haskell", "function-composition"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 3, "creation_date": 1475336956, "post_id": 39808487, "comment_id": 66908432, "body": "Are you specifically asking about <code>a -&gt; b -&gt; c</code> where we can see from the type that the only possible result is non-termination?"}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1475337801, "post_id": 39808487, "comment_id": 66908707, "body": "Any number of foo composed together will run nearly instantaneously and fail. Perhaps rethink your question? What about <code>succ . succ</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475354894, "post_id": 39809585, "comment_id": 66913981, "body": "While this sort of performance is not guaranteed by the language semantics, an implementation would have to be pretty weird to give very different results. In particular, the non-spine-strict specification of <code>foldr</code> virtually requires spine laziness, while the non-accumulator-strict specification of <code>foldl</code> virtually requires spine-eagerness."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475370015, "post_id": 39809585, "comment_id": 66916875, "body": "@dfeuer Indeed, but even so it is just an accident: my real point was that this is quick only because it&#39;s throwing an exception. Any real code would of course need to run all iterations of <code>foo</code>."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475371203, "post_id": 39809585, "comment_id": 66917047, "body": "a constant function would also be quick with <code>foldr</code> but not <code>foldl</code>. And I think you could probably construct slightly less trivial examples."}], "tags": [], "owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "is_accepted": true, "score": 3, "last_activity_date": 1475343678, "last_edit_date": 1495541213, "creation_date": 1475343313, "answer_id": 39809585, "question_id": 39808487, "link": "https://stackoverflow.com/questions/39808487/foo-is-a-b-c-foo-foo-is-also-a-b-c-does-haskell-treat-th/39809585#39809585", "title": "&quot;foo&quot; is &quot;a -&gt; b -&gt; c&quot;. &quot;foo . foo&quot; is also &quot;a -&gt; b -&gt; c&quot;. Does Haskell treat them exactly the same in terms of speed?", "body": "<p>Yes, they perform the same, but only by accident. In ghci:</p>\n\n<pre><code>&gt; :i .\n(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; (a -&gt; c)     -- Defined in \u2018GHC.Base\u2019\ninfixr 9 .\n</code></pre>\n\n<p>Since it is <code>infixr</code>, <code>foo . foo . foo</code> parses as <code>foo . (foo . foo)</code>, and so we can shortcut writing <code>foo . foo . foo . ...</code> a billion times with <code>foldr</code>. So:</p>\n\n<pre><code>&gt; let foo :: a -&gt; b -&gt; c; foo = undefined\n&gt; foldr (.) id (replicate 1000000000 foo) ()\n*** Exception: Prelude.undefined\nCallStack (from HasCallStack):\n  error, called at libraries/base/GHC/Err.hs:79:14 in base:GHC.Err\n  undefined, called at &lt;interactive&gt;:1:5 in interactive:Ghci1\n</code></pre>\n\n<p>It returns almost immediately. On the other hand, the following two hang for a while:</p>\n\n<pre><code>&gt; foldl (.) id (replicate 1000000000 foo) ()\n&gt; foldr (flip (.)) id (replicate 1000000000 foo) ()\n</code></pre>\n\n<p>However, I must stress again that this is a coincidence of GHC's implementation, not a guarantee made by the semantics of the language. It so happens that GHC's implementation of <a href=\"https://stackoverflow.com/q/11070690/791604\">imprecise exceptions</a> quickly notices that this will be an error (and throw's the left-most <code>foo</code>'s error) in the case of <code>foldr (.)</code>, but doesn't notice as quickly for <code>foldl (.)</code>. And of course in the case where <code>foo</code> is not just an error, but has to do some actual computation, that computation will need to be performed as many times as it appears in the string of compositions -- GHC is pretty amazing, but not magical.</p>\n"}], "owner": {"reputation": 957, "user_id": 5771245, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d4ff1986f900f764881c1862b5300a6d?s=128&d=identicon&r=PG&f=1", "display_name": "haskellHQ", "link": "https://stackoverflow.com/users/5771245/haskellhq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 39809585, "answer_count": 1, "score": -1, "last_activity_date": 1475417986, "creation_date": 1475336543, "last_edit_date": 1475417986, "question_id": 39808487, "link": "https://stackoverflow.com/questions/39808487/foo-is-a-b-c-foo-foo-is-also-a-b-c-does-haskell-treat-th", "title": "&quot;foo&quot; is &quot;a -&gt; b -&gt; c&quot;. &quot;foo . foo&quot; is also &quot;a -&gt; b -&gt; c&quot;. Does Haskell treat them exactly the same in terms of speed?", "body": "<pre><code>foo :: a -&gt; b -&gt; c\nfoo = undefined\n\nghci&gt; :t foo\nfoo :: a -&gt; b -&gt; c\n\nghci&gt; :t foo . foo\nfoo . foo :: a -&gt; b -&gt; c\n\nghci&gt; :t foo . foo . foo\nfoo . foo . foo :: a -&gt; b -&gt; c\n</code></pre>\n\n<p>And so on.</p>\n\n<p>The types are the same. We also clearly see, just by looking at the types, that all three are equivalent. They have the same result.</p>\n\n<p>But what about speed? For instance, will <code>foo</code> composed to itself a million times with <code>.</code> automatically (without optimization) run just as fast as <code>foo</code>? If not, will optimization (O1 or O2) make it so?</p>\n"}, {"tags": ["haskell", "monads", "state-monad"], "answers": [{"comments": [{"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475333920, "post_id": 39807831, "comment_id": 66907393, "body": "Thank you so much, this is invaluable. I had to make a number of changes to get it to run (which I&#39;m not complaining about at all, it was highly instructive to do so). I&#39;m not sure whether to edit them into your answer or leave it as it is - let me know if you have a preference."}, {"owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "reply_to_user": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475334490, "post_id": 39807831, "comment_id": 66907581, "body": "@Nathaniel - You&#39;re welcome to make any edits you want."}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475558753, "post_id": 39807831, "comment_id": 66978500, "body": "If you&#39;re interested in helping further I have a <a href=\"http://stackoverflow.com/questions/39813675/simulating-interacting-stateful-objects-in-haskell\">follow on question</a> about how to program in this style when I have multiple interacting stateful objects."}], "tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": true, "score": 7, "last_activity_date": 1475335208, "last_edit_date": 1475335208, "creation_date": 1475332563, "answer_id": 39807831, "question_id": 39807736, "link": "https://stackoverflow.com/questions/39807736/how-can-i-write-this-simple-code-using-the-state-monad/39807831#39807831", "title": "How can I write this simple code using the state monad?", "body": "<p>First you need to convert your existing functions to return <code>State Machine a</code> values:</p>\n\n<pre><code>import Control.Monad.State.Lazy\n\ndata Machine = Register Int\n\naddToState :: Int -&gt; State Machine ()\naddToState i = do\n        (Register x) &lt;- get\n        put $ Register (x + i)\n\nsubtractFromState :: Int -&gt; State Machine ()\nsubtractFromState i = do\n        (Register x) &lt;- get\n        put $ Register (x - i)\n\ngetValue :: State Machine Int\ngetValue = do\n        (Register i) &lt;- get\n        pure i\n</code></pre>\n\n<p>then you can combine them into a stateful computation:</p>\n\n<pre><code>program :: State Machine Int\nprogram = do\n  addToState 6\n  subtractFromState 4\n  getValue\n</code></pre>\n\n<p>finally you need can run this computation with <code>evalState</code> to get the final result and discard the state:</p>\n\n<pre><code>runProgram :: Int\nrunProgram = evalState program (Register 0)\n</code></pre>\n"}], "owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 39807831, "answer_count": 1, "score": 2, "last_activity_date": 1475475230, "creation_date": 1475331868, "last_edit_date": 1495535267, "question_id": 39807736, "link": "https://stackoverflow.com/questions/39807736/how-can-i-write-this-simple-code-using-the-state-monad", "title": "How can I write this simple code using the state monad?", "body": "<p>I'm a beginner at Haskell and I've come across a situation where I would like to use the state monad. (Or at least, I think I that's what I'd like to use.) There are a million tutorials for the state monad, but all of them seem to assume that my main goal is to understand it on a deep conceptual level, and consequently they stop just before the part where they say how to actually develop software with it. So I'm looking for help with a simplified practical example.</p>\n\n<p>Below is a very simple version of what my current code looks like. As you can see, I'm threading state through my functions, and my question is simply how to re-write the code using the <code>do</code> notation so that I won't have to do that.</p>\n\n<pre><code>data Machine = Register Int\n\naddToState :: Machine -&gt; Int -&gt; Machine\naddToState (Register s) a = Register $ s+a\n\nsubtractFromState :: Machine -&gt; Int -&gt; Machine\nsubtractFromState (Register s) a = Register (s-a)\n\ngetValue :: Machine -&gt; Int\ngetValue (Register s) = s\n\ninitialState = Register 0\n\nrunProgram = getValue (subtractFromState (addToState initialState 6) 4)\n</code></pre>\n\n<p>The code simulates a simple abstract machine that has a single register, and instructions to add to the register, subtract from it, and get its value. The \"program\" at the end initialises the register to 0, adds 6 to it, subtracts 4 and returns the result, which of course is 2.</p>\n\n<p>I understand the purpose of the state monad (or at least think I do), and I expect that it will allow me to re-write this so that I end up with something like</p>\n\n<pre><code>runProgram :: ???????\nrunProgram = do\n    put 0\n    addToState 6\n    subtractFromState 4\n    value &lt;- getValue\n    return value\n</code></pre>\n\n<p>However, despite all the tutorials I've read I still don't quite know how to transform my code into this form. </p>\n\n<p>Of course, my actual machine's state is much more complicated, and I'm also passing around its output (which will be passed to another machine) and various other things, so I'm quite keen to simplify it. Knowing how to do it for this simplified example would be a very great help.</p>\n\n<p><strong>Update:</strong> after Lee's great answer I now know how to do this, but I'm stuck on how to write code in the same elegant form when I have multiple interacting machines. I've asked about that in <a href=\"https://stackoverflow.com/questions/39813675/simulating-interacting-stateful-objects-in-haskell\">a new question</a>.</p>\n"}, {"tags": ["haskell", "io", "monad-transformers"], "answers": [{"comments": [{"owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "edited": false, "score": 0, "creation_date": 1475324585, "post_id": 39806527, "comment_id": 66904479, "body": "I am aware of that. But why is this done so awkwardly? E.g. when I derive <code>MonadError e</code>, I don&#39;t have to add any constraints later."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1475354828, "post_id": 39806527, "comment_id": 66913966, "body": "<code>MonadError e</code> doesn&#39;t require any constraints on <code>m</code> since the implementation from <code>ExceptT</code> is used, which works for all <code>m</code>. <code>MonadIO</code> cannot be implemented without a constraint on <code>m</code> since it must use an implementation from <code>m</code> and thus ensure that such an implementation exists. It isn&#39;t awkward, or it least it is precisely as awkward as it needs to be."}, {"owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "edited": false, "score": 0, "creation_date": 1475397425, "post_id": 39806527, "comment_id": 66921097, "body": "Added a link to the documentation and hopefully better explanation."}], "tags": [], "owner": {"reputation": 7033, "user_id": 288201, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/b4b21f0f66f55fe614e7eeac6807f7f4?s=128&d=identicon&r=PG", "display_name": "Koterpillar", "link": "https://stackoverflow.com/users/288201/koterpillar"}, "is_accepted": true, "score": 1, "last_activity_date": 1475397412, "last_edit_date": 1475397412, "creation_date": 1475324412, "answer_id": 39806527, "question_id": 39806305, "link": "https://stackoverflow.com/questions/39806305/why-can-apparently-any-monad-stack-generally-derive-monadio/39806527#39806527", "title": "Why can apparently any monad stack generally derive MonadIO?", "body": "<p>With <code>GeneralizedNewtypeDeriving</code>, all instances have the same constraint - the base type for <code>newtype</code> must be an instance of the same class:</p>\n\n<p><a href=\"https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#generalised-derived-instances-for-newtypes\" rel=\"nofollow\">Generalised derived instances for newtypes</a></p>\n\n<blockquote>\n  <p>All the instance does is apply and remove the newtype constructor.</p>\n</blockquote>\n\n<p>The derived instance for, i.e. <code>Monad</code> has the constraint <code>Monad (ExceptT e m)</code>, which already exists. However, there is no instance for <code>MonadIO (ExceptT e m)</code>, so it must be a constraint on the resulting <code>MonadIO</code> declaration.</p>\n\n<p>If I try to <em>use</em> <code>MonadIO (Foo e m)</code>, an error is generated:</p>\n\n<pre><code>something :: Foo e m ()\nsomething = liftIO $ print \"5\"\n</code></pre>\n\n<p>Here's the error:</p>\n\n<pre><code>    \u2022 No instance for (MonadIO m) arising from a use of \u2018liftIO\u2019\n      Possible fix:\n        add (MonadIO m) to the context of\n          the type signature for:\n            something :: Foo e m ()\n    \u2022 In the expression: liftIO $ print \"5\"\n      In an equation for \u2018something\u2019: something = liftIO $ print \"5\"\n</code></pre>\n"}], "owner": {"reputation": 1489, "user_id": 2925659, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Ifwgn.jpg?s=128&g=1", "display_name": "ruben.moor", "link": "https://stackoverflow.com/users/2925659/ruben-moor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 39806527, "answer_count": 1, "score": 1, "last_activity_date": 1475397412, "creation_date": 1475322767, "question_id": 39806305, "link": "https://stackoverflow.com/questions/39806305/why-can-apparently-any-monad-stack-generally-derive-monadio", "title": "Why can apparently any monad stack generally derive MonadIO?", "body": "<p>I'm confused that the compiler doesn't complain about the code below (the code compiles):</p>\n\n<pre><code>{-# LANGUAGE GeneralizedNewtypeDeriving #-}\n\nmodule Main where\n\nimport Control.Monad.IO.Class (MonadIO)\nimport Control.Monad.Except   (ExceptT)\n\nmain = undefined\n\nnewtype Foo e m a = Foo { unFoo :: ExceptT e m a }\n  deriving (Functor, Applicative, Monad, MonadIO)\n</code></pre>\n\n<p>It would immediately make sense to me again, if I had to add <code>MonadIO m</code> as constraint somewhere, e.g.</p>\n\n<pre><code>deriving instance MonadIO m =&gt; MonadIO (Foo e m a)\n</code></pre>\n\n<p>and indeed, if I try</p>\n\n<pre><code>deriving instance MonadIO (Foo e m a),\n</code></pre>\n\n<p>the compiler complains.</p>\n\n<p>I also noticed that I can only use <code>liftIO</code> when I add the constraint <code>MonadIO m</code> there, later, regardless of whether or not I used method two with the standalone deriving and constraint, which again kind of makes sense. The <code>MonadIO</code> instance is <em>under the condition</em> of <code>MonadIO m</code>.</p>\n\n<p>Is it only me, or is that counter-intuitive?</p>\n\n<p>Does it have to do with the deprecated -XDatatypeContexts extension?</p>\n"}, {"tags": ["haskell", "semaphore", "inotify", "stm", "debouncing"], "answers": [{"tags": [], "owner": {"reputation": 1189, "user_id": 348201, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1b5c1cb1e1615645078717836ffc3eaf?s=128&d=identicon&r=PG", "display_name": "somesoaccount", "link": "https://stackoverflow.com/users/348201/somesoaccount"}, "is_accepted": false, "score": 1, "last_activity_date": 1479850471, "creation_date": 1479850471, "answer_id": 40752055, "question_id": 39805916, "link": "https://stackoverflow.com/questions/39805916/waiting-until-a-file-stops-being-modified/40752055#40752055", "title": "Waiting until a file stops being modified", "body": "<p>Does it have to be <code>STM</code>? You can achieve you goal with ordinary <code>MVar</code>s:</p>\n\n<pre><code>#!/usr/bin/env stack\n{- stack\n  --resolver lts-7.9\n  --install-ghc runghc\n  --package hinotify\n  --package stm\n-}\n\nimport System.INotify\nimport System.Environment (getArgs)\nimport Control.Concurrent (forkIO, threadDelay)\nimport Control.Concurrent.MVar (newMVar, newEmptyMVar, readMVar, swapMVar, putMVar, takeMVar, modifyMVar_)\nimport Control.Monad (forM_, forever)\n\n\nmain :: IO ()\nmain = do\n  [file] &lt;- getArgs\n\n  mainBlocker &lt;- newEmptyMVar\n  tickCounter &lt;- newMVar 0\n\n  -- make changes every 1/10th of a second for 10 seconds\n  forkIO $ forM_ [0..100] $ \\s -&gt; do\n    appendFile file $ show s\n    threadDelay (second `div` 10)\n\n\n  -- set up file watches\n  notif &lt;- initINotify\n  watcher &lt;- addWatch notif [Modify] file $ \\e -&gt; do\n    swapMVar tickCounter 10\n    print \"file has been modified; reset ticks to 10\"\n\n  -- 'decreaser' thread\n  forkIO $ forever $ do\n    threadDelay second\n    ticks &lt;- readMVar tickCounter\n    print $ \"current ticks in decreaser thread: \" ++ show ticks\n    if ticks &lt;= 0\n       then putMVar mainBlocker ()\n       else modifyMVar_ tickCounter (\\v -&gt; return (v-1))\n\n\n  takeMVar mainBlocker\n  print \"exiting...\"\n  removeWatch watcher\n  killINotify notif\n\n\nsecond = 1000000\n</code></pre>\n\n<p>The idea is a 'tick' counter that gets set to 10 whenever the file has been modified. A separate thread tries to count down to 0 and, when it succeeds, releases the block of the main thread.</p>\n\n<p>If you use <code>stack</code> you can execute the code as a script like this:</p>\n\n<pre><code>stack theCode.hs fileToBeWatched\n</code></pre>\n"}], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1479850471, "creation_date": 1475320511, "last_edit_date": 1475321580, "question_id": 39805916, "link": "https://stackoverflow.com/questions/39805916/waiting-until-a-file-stops-being-modified", "title": "Waiting until a file stops being modified", "body": "<p>I'm trying to use <a href=\"https://hackage.haskell.org/package/hinotify\" rel=\"nofollow\">hinotify</a> and STM to make a simple concept:</p>\n\n<ul>\n<li>Block the thread of execution until the watched file <em>stops</em> being modified</li>\n<li>Continue once modifications stop, or their interval is larger than some time threshold (debounces)</li>\n</ul>\n\n<p>Currently, I'm trying to use a TSem to get this working correctly, but I keep running into either of these problems:</p>\n\n<ul>\n<li>the thread doesn't block at all, and I end up removing the hinotify watcher before it even starts, throwing an exception</li>\n<li>the thread blocks indefinitely, causing STM to throw an exception</li>\n<li>the program prints 3 times (3 concurrent notifications), but only lasts for 1 second and not 10</li>\n</ul>\n\n<p>The code I've written is below, and can be checked out <a href=\"https://github.com/athanclark/fileneglect\" rel=\"nofollow\">on github</a> to see for yourself.</p>\n\n<pre><code>module Main where\n\n\nimport System.INotify\nimport System.Environment (getArgs)\nimport Control.Concurrent (forkIO, threadDelay)\nimport Control.Concurrent.STM\nimport Control.Concurrent.STM.TSem\nimport Control.Concurrent.STM.TVar\nimport Control.Monad (forM_)\n\n\nmain :: IO ()\nmain = do\n  [file] &lt;- getArgs\n\n\n  -- make changes every 1/10th of a second for 10 seconds\n  forkIO $ forM_ [0..100] $ \\s -&gt; do\n    appendFile file $ show s\n    threadDelay (second `div` 10)\n\n\n  debouncer &lt;- atomically $ newTSem 0\n  notif &lt;- initINotify\n  expectation &lt;- newTVarIO (0 :: Int)\n\n  watcher &lt;- addWatch notif [Modify] file $ \\e -&gt; do\n    e' &lt;- atomically $ do\n      modifyTVar expectation (+1)\n      readTVar expectation\n    print e\n    threadDelay second\n    e'' &lt;- readTVarIO expectation\n    if e' == e''\n    then atomically $ signalTSem debouncer\n    else pure ()\n\n  atomically $ waitTSem debouncer\n  removeWatch watcher\n  killINotify notif\n\n\nsecond = 1000000\n</code></pre>\n\n<p>Do you see anything immediately wrong with what I'm trying to do?</p>\n"}, {"tags": ["haskell", "io"], "comments": [{"owner": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1475315279, "post_id": 39805071, "comment_id": 66901931, "body": "Well, you can have a conduit/pipes solution. :)"}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 43759, "user_id": 1651941, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/a513bc1fa519d2fcf5e4e0d9b5500101?s=128&d=identicon&r=PG", "display_name": "Sibi", "link": "https://stackoverflow.com/users/1651941/sibi"}, "edited": false, "score": 0, "creation_date": 1475316233, "post_id": 39805071, "comment_id": 66902211, "body": "@Sibi These libraries are huge. I think that requires a long time to be mastered. Also, I don&#39;t think to use a cannon to kill a mosquito."}, {"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 1, "creation_date": 1475317164, "post_id": 39805071, "comment_id": 66902469, "body": "@AlbertoCapitani you don&#39;t need a cannon to kill a mosquito \u2013 but nor do you need a supercomputer (by 70&#39;s standards) for making phone calls."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1475341350, "post_id": 39805071, "comment_id": 66909867, "body": "If you do <code>import qualified Data.Text.IO as T</code> you have strict text and <code>ideal</code> works fine <code>T.readFile pathFile &gt;&gt;= T.writeFile pathFile . (&lt;&gt; &quot;!&quot;)</code>. The <code>text</code> package is the standard way of handling text."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1475347238, "post_id": 39805071, "comment_id": 66911808, "body": "@Michael Thank you, but I chose the example just for simplicity. I work with sets and maps and other much more complex structures."}, {"owner": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1475429148, "post_id": 39805071, "comment_id": 66929467, "body": "I&#39;m not sure how any answer to this question could apply to sets and maps."}, {"owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "reply_to_user": {"reputation": 2831, "user_id": 183792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ddcfbc6c31012fd25384f6301363347?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/183792/michael"}, "edited": false, "score": 0, "creation_date": 1475531922, "post_id": 39805071, "comment_id": 66971864, "body": "@Michael It&#39;s true, but leftaroundabout&#39;s answer got me thinking and I clarified many things. So I defined this general function, and now all work: updateFile :: forall a. Show a =&gt; FilePath -&gt; String -&gt; a -&gt; IO () updateFile pathDir nameFile content = do     let pathFile = pathDir ++ nameFile     (tempFile,ht) &lt;- openTempFile pathDir nameFile     hPrint ht content     hClose ht     removeFile pathFile      renameFile tempFile pathFile"}], "answers": [{"tags": [], "owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "is_accepted": true, "score": 1, "last_activity_date": 1475324311, "last_edit_date": 1475324311, "creation_date": 1475317736, "answer_id": 39805518, "question_id": 39805071, "link": "https://stackoverflow.com/questions/39805071/shortest-code-to-read-a-file-and-then-update-it/39805518#39805518", "title": "Shortest code to read a file and then update it?", "body": "<p>The problem with <code>ideal</code> is that it reads the string lazily, i.e. the file isn't fully in memory before you already try to open it again for writing.</p>\n\n<p>This kind of lazyness is by now widely considered a bad idea<sup>\u2020</sup> \u2013 if you really do need such read-as-you-go capabilities, then <a href=\"http://hackage.haskell.org/package/conduit\" rel=\"nofollow\">conduit</a>/<a href=\"http://hackage.haskell.org/package/pipes\" rel=\"nofollow\">pipes</a> is what you want.</p>\n\n<p>In your example, you don't really need lazyness <em>at all</em> though, unless the file is too big to warrant having it in memory at once. So you can just use <code>readFile</code>, but need to make it strict: a manual way to do that would be</p>\n\n<pre><code>ideal = do\n    fc &lt;- readFile pathFile\n    length fc `seq` writeFile pathFile (fc++ \"!\")\n where pathFile = \"C:\\\\TEMP\\\\Foo.txt\"\n</code></pre>\n\n<p>Here I've used <code>length</code> to ensure the string is really evaluated to the end. A nicer way of ensuring the same thing is with <a href=\"http://hackage.haskell.org/package/deepseq-1.4.2.0/docs/Control-DeepSeq.html\" rel=\"nofollow\"><code>deepseq</code></a>:</p>\n\n<pre><code>ideal = do\n    fc &lt;- readFile pathFile\n    fc `deepseq` writeFile pathFile (fc++ \"!\")\n</code></pre>\n\n<p>...or, if you want it point-free,</p>\n\n<pre><code>ideal = readFile pathFile &gt;&gt;= (writeFile pathFile . (++ \"!\") $!!)\n</code></pre>\n\n<p>Note that the more modern variants of <code>readFile</code> with more efficient types than <code>String</code> \u2013 in particular, <a href=\"http://hackage.haskell.org/package/text-1.2.2.1/docs/Data-Text-IO.html#v:readFile\" rel=\"nofollow\"><code>Data.Text.readFile</code></a> \u2013 don't need any of this, because they're strict out of the box. The following therefore just works, and is probably the best solution:</p>\n\n<pre><code>{-# LANGUAGE OverloadedStrings #-}\n\nimport Prelude hiding (readFile, writeFile)\nimport Data.Text.IO\nimport Data.Monoid ((&lt;&gt;))\n\nmain :: IO ()\nmain = readFile pathFile &gt;&gt;= writeFile pathFile . (&lt;&gt; \"!\")\n where pathFile = \"/tmp/foo.txt\"\n</code></pre>\n\n<hr>\n\n<p><sup>\u2020</sup><sub>In the very early days of Haskell, all \u201cinterleaved IO\u201d was actually based on lazyness, hence the old libraries were somewhat drowned with it.</sub></p>\n"}], "owner": {"reputation": 1069, "user_id": 2153280, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zkQvQ.jpg?s=128&g=1", "display_name": "Alberto Capitani", "link": "https://stackoverflow.com/users/2153280/alberto-capitani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 39805518, "answer_count": 1, "score": 0, "last_activity_date": 1475373847, "creation_date": 1475314647, "last_edit_date": 1475373847, "question_id": 39805071, "link": "https://stackoverflow.com/questions/39805071/shortest-code-to-read-a-file-and-then-update-it", "title": "Shortest code to read a file and then update it?", "body": "<p>I need to read, modify and then update some files in the same function. The ideal solution (see below) could not work, it is wrong. The \"worst\" solution works.</p>\n\n<pre><code>-- Ex. \"Pseudocode\" - Doesn't work.\nideal = let pathFile = \"C:\\\\TEMP\\\\Foo.txt\" \n           in readFile pathFile &gt;&gt;= writeFile pathFile . (++ \"!\")\n\n-- It works. \nworst = do\n    let pathFile = \"C:\\\\TEMP\\\\Foo.txt\"\n    h &lt;- openFile pathFile ReadMode\n    cs &lt;- hGetContents h \n    (temp_Foo,temp_handle) &lt;- openTempFile pathFile\n    hPrint temp_handle $ cs ++ \"!\"\n    hClose temp_handle\n    removeFile pathFile\n    renameFile temp_Foo pathFile\n</code></pre>\n\n<p>I would prefer to avoid \"the simple but ugly workaround\" suggested by Reid Burton in 2010:</p>\n\n<pre><code>doit file = do\n    contents &lt;- readFile file\n    length contents `seq` (writeFile file $ process contents)\n</code></pre>\n\n<p>Is there a better solution?</p>\n"}, {"tags": ["haskell", "interrupt", "handle", "child-process"], "owner": {"reputation": 3644, "user_id": 1465116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1987d0ba73cb23a47a25dbfe0b36106e?s=128&d=identicon&r=PG", "display_name": "Athan Clark", "link": "https://stackoverflow.com/users/1465116/athan-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1475288277, "creation_date": 1475288277, "question_id": 39802378, "link": "https://stackoverflow.com/questions/39802378/is-interruptprocessgroupof-intended-to-interrupt-the-process-calling-the-funct", "title": "Is `interruptProcessGroupOf` intended to interrupt the process calling the function as well?", "body": "<p>I'm trying to interrupt a <code>System.Process.ProcessHandle</code> in a clean way, but when I call <code>interruptProcessGroupOf</code>, the parent process (the Haskell code calling this function) gets interrupted as well. Is there a proper way to interrupt <code>ProcessHandles</code> / child processes?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1475276325, "post_id": 39800909, "comment_id": 66894785, "body": "The type of <code>==</code> indicates that if <code>a</code> is an instance of <code>Eq</code>, then <code>==</code> is defined for that type. It says nothing about whether <code>==</code> itself is an instance of <code>Eq</code> (which it cannot be, being a function and not a type)."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 2, "creation_date": 1475278199, "post_id": 39800909, "comment_id": 66895181, "body": "You misunderstood the question. It is asking why we can&#39;t define <code>function1 == function2</code> as in e.g. <code>(+) == (-)</code> or <code>(\\x -&gt; x+x) == (\\x -&gt;2*x)</code>. This latter example should be a hint."}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 1, "creation_date": 1475279586, "post_id": 39800909, "comment_id": 66895443, "body": "Also possibly relevant: <a href=\"http://stackoverflow.com/q/17045941/791604\">How to compare two functions for equivalence</a>."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1475295148, "post_id": 39800909, "comment_id": 66897777, "body": "I don&#39;t understand what is being asked. The question does not contain a clear problem statement. I think we are misunderstanding a question that is itself based on a misunderstanding of a question. Before we mark it as a duplicate or attempt to answer it, we should try to figure out what the actual question is."}], "owner": {"reputation": 925, "user_id": 4329348, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d81065aaee14940d1760786db70120a3?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/4329348/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 893, "favorite_count": 0, "closed_date": 1475292341, "answer_count": 0, "score": 0, "last_activity_date": 1475274949, "creation_date": 1475274193, "question_id": 39800909, "link": "https://stackoverflow.com/questions/39800909/why-are-function-types-not-always-instances-of-eq-class", "closed_reason": "Duplicate", "title": "Why are function types not always instances of Eq class?", "body": "<p>I am trying to understand the Eq class and while I was reading a chapter about the types in Haskell I faced the following question:</p>\n\n<p>\"Explain why is not feasible in general for function types to be instances of the Eq class.\"</p>\n\n<p>I tried to understand by checking the type of the <code>(==)</code> function.</p>\n\n<pre><code>:t (==)\n(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\n</code></pre>\n\n<p>So <code>a</code> is instance of <code>Eq</code> class, but this doesn't show that the (==) function is instance of the Eq class, does it? For me, seems that the two arguments of the function == are instances of the type Eq.</p>\n\n<pre><code>equal x1 x2 = x1 == x2\n</code></pre>\n\n<p>Is actually equivalent to (==).</p>\n\n<p>My understanding is that, is not feasible always (my above example is feasible) for function types to be instances of the Eq class because they have to have the same number of arguments (two) and return the same type (Bool).</p>\n\n<p>Although I am not sure if that is the case. Is not crystal clear what is meant for a function type to be an instance of a class.</p>\n"}, {"tags": ["haskell", "persistent"], "comments": [{"owner": {"reputation": 1825, "user_id": 2671214, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v464b.jpg?s=128&g=1", "display_name": "Tomasz Lewowski", "link": "https://stackoverflow.com/users/2671214/tomasz-lewowski"}, "edited": false, "score": 0, "creation_date": 1475617136, "post_id": 39800423, "comment_id": 67012376, "body": "maybe this helps: <a href=\"http://stackoverflow.com/questions/30062707/foreign-key-constraints-in-yesod-persistent\" title=\"foreign key constraints in yesod persistent\">stackoverflow.com/questions/30062707/&hellip;</a> ? as far as I know there should be no restrictions, as long as you export all types from <code>Common</code> module"}], "owner": {"reputation": 2183, "user_id": 52310, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8729b9952488497d0343e8bd86afe8cb?s=128&d=identicon&r=PG", "display_name": "Alex R", "link": "https://stackoverflow.com/users/52310/alex-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 187, "favorite_count": 0, "answer_count": 0, "score": 10, "last_activity_date": 1483271208, "creation_date": 1475271371, "last_edit_date": 1483271208, "question_id": 39800423, "link": "https://stackoverflow.com/questions/39800423/is-it-possible-to-construct-a-persistent-schema-in-pieces", "title": "Is it possible to construct a `persistent` schema in pieces?", "body": "<p>Say I have 4 modules: Common, A, B, and Main, and I want the following schema:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>share [mkPersist sqlSettings, mkMigrate \"migrateAll\"] [persistLowerCase|\nCommon\n  commonField Int\nA\n  commonId CommonId\n  aField Int\nB\n  commonId CommonId\n  bField Int\n|]\n</code></pre>\n\n<p>But I want to split it across the Common, A, and B modules. I then want Main to depend on all of them and to contain the database logic.</p>\n\n<p>I tried the following (ignoring B)</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>-- module Common\nshare [mkPersist sqlSettings, mkMigrate \"migrateCommon\"] [persistLowerCase|\nCommon\n  commonField Int\n|]\n\n-- module A\nshare [mkPersist sqlSettings, mkMigrate \"migrateA\"] [persistLowerCase|\nA\n  commonId CommonId\n  aField Int\n|]\n</code></pre>\n\n<p>but the resulting migration removes the foreign constraint from A to Common.</p>\n\n<p>I tried storing and concatenating the results of the <code>persistLowerCase</code> quasiquoter before calling share, but that led to a type error about CommonId not being in scope.</p>\n\n<p>The only other solution I can think of is storing strings, concatenating them, and calling the quasiquoter on that, and that doesn't seem good.</p>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "edited": false, "score": 1, "creation_date": 1475268793, "post_id": 39799887, "comment_id": 66892491, "body": "<code>??? is just a placeholder</code>. If you change <code>???</code> by <code>_</code> and reload, GHCi will try to guess what type should be in the &quot;typed hole&quot;."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 4, "creation_date": 1475269146, "post_id": 39799887, "comment_id": 66892637, "body": "<code>compress [] = []; compress (x : xs) = x : compress&#39; xs x</code>"}], "answers": [{"comments": [{"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475279937, "post_id": 39800254, "comment_id": 66895494, "body": "I&#39;ve added <code>x</code> as an argument to <code>compress&#39;</code> because I think this was probably your intention; if not, my apologies."}, {"owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "reply_to_user": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475364002, "post_id": 39800254, "comment_id": 66915993, "body": "@DanielWagner: Thanks! That&#39;s almost definitely right\u2014I was (still am) too lazy to test my code :)."}], "tags": [], "owner": {"reputation": 64805, "user_id": 286871, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/xNBpr.png?s=128&g=1", "display_name": "Tikhon Jelvis", "link": "https://stackoverflow.com/users/286871/tikhon-jelvis"}, "is_accepted": true, "score": 9, "last_activity_date": 1475279912, "last_edit_date": 1475279912, "creation_date": 1475270372, "answer_id": 39800254, "question_id": 39799887, "link": "https://stackoverflow.com/questions/39799887/haskell-initial-accumulator-null-value/39800254#39800254", "title": "haskell initial accumulator &#39;null&#39; value", "body": "<p>So there are two answers to your question. The more literal answer is that you can use <code>Maybe</code> to make something nullable, and the type system will make sure you check whether something is <code>Nothing</code> each time you use it:</p>\n\n<pre><code>compress list = compress' list Nothing\n  where compress' [] _ = []\n        compress' (x:xs) Nothing = x : compress xs (Just x)\n        compress' (x:xs) (Just last)\n          | x == last = compress xs last\n          | otherwise = x : compress xs (Just x)\n</code></pre>\n\n<p>The moral of the story is that if you have an element which might be missing (ie could be <code>null</code> in other languages), you wrap it in <code>Maybe</code>. Then you either have <code>Just x</code> or <code>Nothing</code>, and you can pattern match on it the same way you pattern match on a list.</p>\n\n<p>However, in this particular case, we can have a cleaner solution. Note that the element is only missing <em>the first time</em> you call <code>compress'</code>. We can deal with this by adding a case to the top-level <code>compress</code> function which handles this possibility:</p>\n\n<pre><code>compress [] = []\ncompress (x:xs) = x : compress' xs x\n  where ...\n</code></pre>\n\n<p>Essentially, we can avoid needing to handle the case in our helper <code>compress'</code> function if we instead handle it in the top-level function, where we can match on the list passed in to decided what to do.</p>\n"}], "owner": {"reputation": 2864, "user_id": 4858640, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c3eef6d48a6bc20ea9c2c2825dc9c6d6?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4858640/peter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 39800254, "answer_count": 1, "score": 2, "last_activity_date": 1475309862, "creation_date": 1475268627, "last_edit_date": 1475309862, "question_id": 39799887, "link": "https://stackoverflow.com/questions/39799887/haskell-initial-accumulator-null-value", "title": "haskell initial accumulator &#39;null&#39; value", "body": "<p>I have a seemingly simple Haskell problem and with my limited knowledge I'm not sure what terms to search for in order to solve it.</p>\n\n<p>I've tried to solve problem number 8 from the 99 Haskell problems (removing consecutive duplicates from a list) and this is what I've come up with:</p>\n\n<pre><code>compress :: (Eq a) =&gt; [a] -&gt; [a]\ncompress list = compress' list ???\n  where\n    compress' [] _ = []\n    compress' (x:xs) last\n      | x == last = compress xs last\n      | otherwise = x : compress xs x\n</code></pre>\n\n<p>'???' is just a placeholder, this is where I'm unsure what to do. I suppose how the snippet is intended to work should be clear enough, 'last' is an accumulator of sorts which is used to check whether elements are duplicates of previous ones.\nNow, what initial value can I give 'last' in this case? (something akin to 'null' in most OO languages I suppose).</p>\n\n<p>edit: Tikhon's answer works, however I just realized that I have made a mistake in my original post, compress' should recursively call itself and not compress. Thus the 'trivial' solution to my problem is now:</p>\n\n<pre><code>compress :: (Eq a) =&gt; [a] -&gt; [a]\ncompress list = compress' list Nothing\n  where\n    compress' [] _ = []\n    compress' (x:xs) Nothing = x : compress' xs (Just x)\n    compress' (x:xs) (Just last)\n      | x == last = compress' xs (Just last)\n      | otherwise = x : compress' xs (Just x)\n</code></pre>\n"}, {"tags": ["performance", "haskell", "dynamic-programming"], "comments": [{"owner": {"reputation": 49959, "user_id": 866915, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/09242131d6e17cbbe31e8547514da6e5?s=128&d=identicon&r=PG", "display_name": "ErikR", "link": "https://stackoverflow.com/users/866915/erikr"}, "edited": false, "score": 1, "creation_date": 1475264657, "post_id": 39798956, "comment_id": 66890760, "body": "Strings are very inefficient. For a competition program I would read the input in as a ByteString if you can get away with that - other use Text."}], "answers": [{"tags": [], "owner": {"reputation": 61029, "user_id": 625914, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f1932d8bf4e9dbf779a48b41bbf21592?s=128&d=identicon&r=PG", "display_name": "behzad.nouri", "link": "https://stackoverflow.com/users/625914/behzad-nouri"}, "is_accepted": true, "score": 2, "last_activity_date": 1482391571, "last_edit_date": 1482391571, "creation_date": 1482370870, "answer_id": 41274592, "question_id": 39798956, "link": "https://stackoverflow.com/questions/39798956/haskell-performance-using-dynamic-programming/41274592#41274592", "title": "Haskell performance using dynamic programming", "body": "<p>The backward equations for edit distance calculations are:</p>\n\n<pre><code>f(i, j) = minimum [\n  1 + f(i + 1, j), -- delete from the 1st string\n  1 + f(i, j + 1), -- delete from the 2nd string \n  f(i + 1, j + 1) + if a(i) == b(j) then 0 else 1 -- substitute or match\n]\n</code></pre>\n\n<p>So within each dimension, you need nothing more than the very <em>next</em> index: <code>+ 1</code>. This is a <em>sequential</em> access pattern, not random access to require arrays; and can be implemented using lists and nested right folds:</p>\n\n<pre><code>editDistance :: Eq a =&gt; [a] -&gt; [a] -&gt; Int\neditDistance a b = head . foldr loop [n, n - 1..0] $ zip a [m, m - 1..]\n  where\n  (m, n) = (length a, length b)\n  loop (s, l) lst = foldr go [l] $ zip3 b lst (tail lst)\n    where\n    go (t, i, j) acc@(k:_) = inc `seq` inc:acc\n      where inc = minimum [i + 1, k + 1, if s == t then j else j + 1]\n</code></pre>\n\n<p>You may test this code in <a href=\"https://www.hackerrank.com/contests/cse-830-homework-3/challenges/edit-distance\" rel=\"nofollow noreferrer\">Hackerrank Edit Distance Problem</a> as in:</p>\n\n<pre><code>import Control.Applicative ((&lt;$&gt;))\nimport Control.Monad (replicateM_)\nimport Text.Read (readMaybe)\n\neditDistance :: Eq a =&gt; [a] -&gt; [a] -&gt; Int\neditDistance a b = ... -- as implemented above\n\nmain :: IO ()\nmain = do\n  Just n &lt;- readMaybe &lt;$&gt; getLine\n  replicateM_ n $ do\n    a &lt;- getLine\n    b &lt;- getLine\n    print $ editDistance a b\n</code></pre>\n\n<p>which passes all tests with a decent performance.</p>\n"}], "owner": {"reputation": 587, "user_id": 1015602, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ea1629e2c2d1d82ab8c3645d82ecc60d?s=128&d=identicon&r=PG", "display_name": "Free_D", "link": "https://stackoverflow.com/users/1015602/free-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 41274592, "answer_count": 1, "score": 2, "last_activity_date": 1482391571, "creation_date": 1475264350, "last_edit_date": 1495541785, "question_id": 39798956, "link": "https://stackoverflow.com/questions/39798956/haskell-performance-using-dynamic-programming", "title": "Haskell performance using dynamic programming", "body": "<p>I am attempting to calculate the Levenshtein distance between two strings using dynamic programming. This is being done through Hackerrank, so I have timing constraints. I used a techenique I saw in: <a href=\"https://stackoverflow.com/questions/4976908/how-are-dynamic-programming-algorithms-implemented-in-idiomatic-haskell\">How are Dynamic Programming algorithms implemented in idiomatic Haskell?</a> and it seems to be working.  Unfortunaly, it is timing out in one test case.  I do not have access to the specific test case, so I don't know the exact size of the input.  </p>\n\n<pre><code>import Control.Monad\nimport Data.Array.IArray\nimport Data.Array.Unboxed\n\nmain = do\n  n &lt;- readLn\n  replicateM_ n $ do\n    s1 &lt;- getLine\n    s2 &lt;- getLine\n    print $ editDistance s1 s2\n\neditDistance :: String -&gt; String -&gt; Int\neditDistance s1 s2 = dynamic editDistance' (length s1, length s2)\n  where\n    s1' :: UArray Int Char\n    s1' = listArray (1,length s1) s1\n    s2' :: UArray Int Char\n    s2' = listArray (1,length s2) s2\n    editDistance' table (i,j)\n      | min i j == 0 = max i j\n      | otherwise = min' (table!((i-1),j) + 1) (table!(i,(j-1)) + 1) (table!((i-1),(j-1)) + cost)\n      where\n        cost =  if s1'!i == s2'!j then 0 else 1\n        min' a b = min (min a b)\n\ndynamic :: (Array (Int,Int) Int -&gt; (Int,Int) -&gt; Int) -&gt; (Int,Int) -&gt; Int\ndynamic compute (xBnd, yBnd) = table!(xBnd,yBnd)\n  where\n    table = newTable $ map (\\coord -&gt; (coord, compute table coord)) [(x,y) | x&lt;-[0..xBnd], y&lt;-[0..yBnd]]\n    newTable xs = array ((0,0),fst (last xs)) xs\n</code></pre>\n\n<p>I've switched to using arrays, but that speed up was insufficient.  I cannot use Unboxed arrays, because this code relies on laziness. Are there any glaring performance mistakes I have made? Or how else can I speed it up?</p>\n"}, {"tags": ["haskell", "megaparsec"], "comments": [{"owner": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1475268455, "post_id": 39798950, "comment_id": 66892340, "body": "does it work if you try composing your monad stack differently? <code>ParsecT Dec T.Text (StateT UserState) a</code>"}, {"owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "reply_to_user": {"reputation": 9772, "user_id": 3963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9pDQ8.png?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/3963/hao"}, "edited": false, "score": 0, "creation_date": 1475270208, "post_id": 39798950, "comment_id": 66893030, "body": "In this case the state would be available at the end of parsing, but it would not be back-tracking with the parser."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1475275055, "post_id": 39798950, "comment_id": 66894488, "body": "The type of <code>runStateT p initialUserState</code> is <code>Parser (a, UserState)</code> - conceptually this could just be the parser which unconditionally fails and never produces a value, so the &#39;state&#39; doesn&#39;t exist - what could such a function produce in this case? Surely not <code>(UserState, Either (..) (a, UserState))</code>."}, {"owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1475311975, "post_id": 39798950, "comment_id": 66901100, "body": "@user2407038 the state would exist in any case, why not? If the parser fails immediately, it would probably be the initial user state. But I agree that the function signature would look odd."}], "answers": [{"comments": [{"owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "edited": false, "score": 0, "creation_date": 1475311098, "post_id": 39804572, "comment_id": 66900888, "body": "This is precisely what I have been doing so far with Parsec. I was just hoping that Megaparsec could make things simpler."}], "tags": [], "owner": {"reputation": 24211, "user_id": 1364288, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/JVtNl.png?s=128&g=1", "display_name": "danidiaz", "link": "https://stackoverflow.com/users/1364288/danidiaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1475310879, "creation_date": 1475310879, "answer_id": 39804572, "question_id": 39798950, "link": "https://stackoverflow.com/questions/39798950/megaparsec-backtracking-user-state-with-statet-and-parsect/39804572#39804572", "title": "Megaparsec, backtracking user state with StateT and ParsecT", "body": "<p>You could try sandwiching <code>ParserT</code> between two <code>State</code>s, like</p>\n\n<pre><code>type MyParser a = StateT UserState (ParsecT Dec T.Text (State UsersState)) a\n</code></pre>\n\n<p>And write special-purpose <code>put</code> and <code>modify</code> operations that, after changing the outer state, copy the entire state into the inner <code>State</code> monad using <code>put</code>.</p>\n\n<p>That way, even if parsing fails, you'll have the last \"state before failure\" available from the inner <code>State</code> monad.</p>\n"}, {"tags": [], "owner": {"reputation": 903, "user_id": 2393937, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d35b1ec2432fbea0b75940a605a3d962?s=128&d=identicon&r=PG", "display_name": "DanielM", "link": "https://stackoverflow.com/users/2393937/danielm"}, "is_accepted": true, "score": 2, "last_activity_date": 1482170172, "creation_date": 1482170172, "answer_id": 41228382, "question_id": 39798950, "link": "https://stackoverflow.com/questions/39798950/megaparsec-backtracking-user-state-with-statet-and-parsect/41228382#41228382", "title": "Megaparsec, backtracking user state with StateT and ParsecT", "body": "<p>You can use a custom error component combined with the <code>observing</code> function for this purpose (see <a href=\"https://mrkkrp.github.io/posts/latest-additions-to-megaparsec.html\" rel=\"nofollow noreferrer\">this great post</a> for more information):</p>\n\n<pre><code>{-# LANGUAGE RecordWildCards #-}\n\nmodule Main where\n\nimport Text.Megaparsec\nimport qualified Data.Set as Set\nimport Control.Monad.State.Lazy\n\ndata MyState = MyState Int deriving (Ord, Eq, Show)\ndata MyErrorComponent = MyErrorComponent (Maybe MyState) deriving (Ord, Eq, Show)\n\ninstance ErrorComponent MyErrorComponent where\n    representFail _ = MyErrorComponent Nothing \n    representIndentation _ _ _= MyErrorComponent Nothing \n\ntype Parser = StateT MyState (Parsec MyErrorComponent String)\n\ntrackState :: Parser a -&gt; Parser a\ntrackState parser = do\n    result &lt;- observing parser -- run parser but don't fail right away\n    case result of\n        Right x -&gt; return x -- if it succeeds we're done here\n        Left ParseError {..} -&gt; do\n            state &lt;- get -- read the current state to add it to the error component\n            failure errorUnexpected errorExpected $\n                if Set.null errorCustom then Set.singleton (MyErrorComponent $ Just state) else errorCustom\n</code></pre>\n\n<p>In the above snipped, <code>observing</code> functions a bit like a <code>try</code>/<code>catch</code> block that catches a parse error, then reads the current state and adds the it to the custom error component. The custom error component in turn is returned when <code>runParser</code> returns a <code>ParseError</code>.</p>\n\n<p>Here's a demonstration how this function could be used:</p>\n\n<pre><code>a = trackState $ do\n    put (MyState 6)\n    string \"foo\"\n\nb = trackState $ do\n    put (MyState 5)\n    a\n\nmain = putStrLn (show $ runParser (runStateT b (MyState 0)) \"\" \"bar\") \n</code></pre>\n\n<p>In reality you would probably want to do something more clever (for instance I imagine you could also add the entire stack of states you go through while traversing the stack).</p>\n"}], "owner": {"reputation": 1781, "user_id": 1248563, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8105b89ccc12fd51cdf9267f8ea5704f?s=128&d=identicon&r=PG", "display_name": "cornuz", "link": "https://stackoverflow.com/users/1248563/cornuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 2, "accepted_answer_id": 41228382, "answer_count": 2, "score": 7, "last_activity_date": 1482170172, "creation_date": 1475264320, "last_edit_date": 1475311291, "question_id": 39798950, "link": "https://stackoverflow.com/questions/39798950/megaparsec-backtracking-user-state-with-statet-and-parsect", "title": "Megaparsec, backtracking user state with StateT and ParsecT", "body": "<p>Using Megaparsec 5.\nFollowing <a href=\"https://mrkkrp.github.io/megaparsec/tutorials/switch-from-parsec-to-megaparsec.html\" rel=\"nofollow\">this guide</a>, I can achieve a back-tracking user-state by combining <code>StateT</code> and <code>ParsecT</code> (non-defined types should be obvious/irrelevant):</p>\n\n<pre><code>type MyParser a = StateT UserState (ParsecT Dec T.Text Identity) a\n</code></pre>\n\n<p>if I run a parser <code>p :: MyParser a</code>, like this:</p>\n\n<pre><code>parsed = runParser (runStateT p initialUserState) \"\" input\n</code></pre>\n\n<p>The type of <code>parsed</code> is:</p>\n\n<pre><code>Either (ParseError Char Dec) (a, UserState)\n</code></pre>\n\n<p>Which means, in case of error, the user state is lost.</p>\n\n<p>Is there any way to have it in both cases?</p>\n\n<p><strong>EDIT:</strong>\nCould I perhaps, in case of error, use a custom error component instead of Dec (a feature introduced in 5.0) and encapsulate the user state in there?</p>\n"}, {"tags": ["haskell", "ghc", "yesod"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475286920, "post_id": 39798381, "comment_id": 66896568, "body": "I don&#39;t know much about this, but I&#39;m given to understand that you should generally only tell GHC the number of <i>actual</i> cores, not the number of hyperthreaded virtual ones. No, I don&#39;t know why."}], "owner": {"reputation": 899, "user_id": 1686629, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/783eacdab4a800eab9d786d5f5911fac?s=128&d=identicon&r=PG", "display_name": "Echo Nolan", "link": "https://stackoverflow.com/users/1686629/echo-nolan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1484243384, "creation_date": 1475261970, "question_id": 39798381, "link": "https://stackoverflow.com/questions/39798381/why-are-my-yesod-tests-so-much-slower-in-parallel", "title": "Why are my Yesod tests so much slower in parallel?", "body": "<p>On a machine with 8 virtual cores, <code>time .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/test/test +RTS -N1</code> reports:</p>\n\n<pre><code>real    0m10.368s\nuser    0m8.592s\nsys 0m2.056s\n</code></pre>\n\n<p>While <code>time .stack-work/dist/x86_64-linux/Cabal-1.22.5.0/build/test/test +RTS -N8</code> reports:</p>\n\n<pre><code>real    0m15.266s\nuser    0m40.032s\nsys 0m19.880s\n</code></pre>\n\n<p>To reproduce: run <code>stack new partest yesod-simple</code>, add <code>replicateM_ 500</code> to <code>test/Handler/HomeSpec.hs</code> after <code>describe \"Homepage\"</code> and set <code>ghc-options</code> in <code>partest.cabal</code> to <code>-Wall -rtsopts -threaded</code>.</p>\n\n<p>Why is this? ISTM that this should profit from parallelism - I can't think of any resources that the threads would fight for. <code>yesod-test</code> doesn't even spin up a real server. Removing the file upload from the test doesn't substantially affect the results.</p>\n\n<p>This is a minimized example. My original problem is in a larger application where it seems like passing <code>-N</code> doesn't make the tests run in parallel at all. So my other question is: is there something in Yesod that prevents parallelism? Multiple threads accessing the DB at once would invalidate some tests, but I'd like to address that myself. (The <code>yesod-simple</code> template doesn't have a DB so that can't be the issue there.)</p>\n"}, {"tags": ["algorithm", "haskell", "recursion", "minimax"], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "edited": false, "score": 0, "creation_date": 1475266665, "post_id": 39798827, "comment_id": 66891621, "body": "Hi Cirdec, thanks so much for your reply. Your code seems logical, however, when I test the minimax function giving P1 and an example Board for input, my minimax tree is filled with &#39; 1 &#39;. But the example Board actually has scenarios where P2 wins, which means there should also be &#39;-1&#39; in the tree... I double checked if the &quot;hasWinner&quot; function works, and after some tests, it seems to work correctly."}, {"owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "reply_to_user": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "edited": false, "score": 1, "creation_date": 1475268914, "post_id": 39798827, "comment_id": 66892545, "body": "If <code>r</code> is the move chosen by <code>P1</code>, <code>rs</code> are the moves available to <code>P2</code>, <code>P2</code> is trying to <code>minimize</code>. Perhaps <code>P1</code> needs to consider how the other player would choose a move instead of choosing the one <code>P1</code> likes best for <code>P2</code> to make."}, {"owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "edited": false, "score": 0, "creation_date": 1475311823, "post_id": 39798827, "comment_id": 66901065, "body": "Isn&#39;t that practically the same as minimizing P2&#39;s move? How would I implement your theory in my code?"}], "tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 5, "last_activity_date": 1475263825, "creation_date": 1475263825, "answer_id": 39798827, "question_id": 39798342, "link": "https://stackoverflow.com/questions/39798342/haskell-recursive-minimax-tree/39798827#39798827", "title": "Haskell Recursive Minimax Tree", "body": "<p>You aren't switching between the two players correctly. <code>minimax' p b@(r :&gt; []) = minimax p b</code> is wrong. <code>map (minimax p) rs</code> in <code>minimax'</code> doesn't switch to the other player for the maximizing half.</p>\n\n<p>I'd recommend writing this out explicitly for <code>P1</code> (trying to maximize) and <code>P2</code> (trying to minimize).</p>\n\n<p>The endgame can assign the winner without caring about which player is currently playing</p>\n\n<pre><code>minimax :: Player -&gt; Rose Board -&gt; Rose Int\nminimax p (r :&gt; [])   | hasWinner r == Just P1 = 1    :&gt; []\n                      | hasWinner r == Just P2 = (-1) :&gt; []\n                      | otherwise              = 0    :&gt; []\n</code></pre>\n\n<p>Player <code>P1</code> is trying to maximize</p>\n\n<pre><code>minimax P1 (r :&gt; rs) = maximum (map root xs) :&gt; xs\n    where xs = map (minimax (nextPlayer p)) rs\n</code></pre>\n\n<p>Player <code>P2</code> is trying to minimize</p>\n\n<pre><code>minimax P2 (r :&gt; rs) = minimum (map root xs) :&gt; xs\n    where xs = map (minimax (nextPlayer p)) rs\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "is_accepted": false, "score": -1, "last_activity_date": 1475333108, "creation_date": 1475333108, "answer_id": 39807920, "question_id": 39798342, "link": "https://stackoverflow.com/questions/39798342/haskell-recursive-minimax-tree/39807920#39807920", "title": "Haskell Recursive Minimax Tree", "body": "<p>After a lot of testing and being confused, I found out that the function which created the Game Tree had some flaws. After debugging that, the algorithm suggested by Cirdec worked correctly!</p>\n"}], "owner": {"reputation": 137, "user_id": 2843415, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/58ac1c408c45bc187eed4b57b020034b?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/2843415/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4062, "favorite_count": 1, "accepted_answer_id": 39798827, "answer_count": 2, "score": 3, "last_activity_date": 1475333108, "creation_date": 1475261811, "question_id": 39798342, "link": "https://stackoverflow.com/questions/39798342/haskell-recursive-minimax-tree", "title": "Haskell Recursive Minimax Tree", "body": "<p>I'm trying to write a Tic Tac Toe program in Haskell, using the minimax algorithm. I constructed my own \"Rose a\" data type as follows:</p>\n\n<pre><code>data Rose a = a :&gt; [Rose a]\n</code></pre>\n\n<p>This is the data type in which I want to 'store' my minimax tree. I understand how the minimax algorithm works, but can't seem to implement it in a recursive function. </p>\n\n<pre><code>minimax :: Player -&gt; Rose Board -&gt; Rose Int\nminimax p (r :&gt; [])   | hasWinner r == Just p              = 1  :&gt; []\n                      | hasWinner r == Just (nextPlayer p) = (-1) :&gt; []\n                      | otherwise                          = 0  :&gt; []\nminimax p (r :&gt; rs)   = maximum(map root xs) :&gt; xs\n    where xs = map (minimax' (nextPlayer p)) rs\n\nminimax' :: Player -&gt; Rose Board -&gt; Rose Int\nminimax' p b@(r :&gt; []) = minimax p b\nminimax' p   (r :&gt; rs) = minimum(map root xs) :&gt; xs\n    where xs = map (minimax p) rs\n</code></pre>\n\n<p>The \"Player\" is also a self-constructed data type, which can be of value P1 or P2. The \"hasWinner\" function checks if a given \"Board\" (data type which can hold a Tic Tac Toe board) has a winner, and returns either Maybe P1 or Maybe P2, or Nothing.</p>\n\n<p>This \"minimax\" function I wrote is not giving me errors, but the result is not correct. Where is the flaw in my minimax implementation? </p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1475255562, "post_id": 39796621, "comment_id": 66886195, "body": "They already are the types you want. The trouble is that there&#39;s no way to use <code>b</code> because its type doesn&#39;t mention <code>a</code>."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475256686, "post_id": 39796621, "comment_id": 66886816, "body": "Ideally, <code>b @ a @ b</code> could work if enough extensions are used, like <code>AllowAmbiguousTypes, TypeArguments, ScopedTypeVariables</code>. I can&#39;t test that now, though."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1475256734, "post_id": 39796621, "comment_id": 66886844, "body": "Can you clarify what you&#39;re trying to accomplish? Suppose you have <code>instance C String Double where a = &quot;foo&quot;; b = 42.0</code>. What do you expect <code>f &quot;bar&quot;</code> to produce?"}, {"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1475256849, "post_id": 39796621, "comment_id": 66886905, "body": "I think you could use a functional dependency <code>| a -&gt; b</code> (if it is indeed true that <code>a</code> determines <code>b</code> in your model)"}, {"owner": {"reputation": 7656, "user_id": 823, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab7c8cd9bfc94ab2eae4a39e229a712e?s=128&d=identicon&r=PG", "display_name": "ryantm", "link": "https://stackoverflow.com/users/823/ryantm"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1475257019, "post_id": 39796621, "comment_id": 66886998, "body": "@user2297560 I&#39;m trying to pass a dictionary into the function f that is uniquely specified by both the type of a and b, so <code>f &quot;bar&quot;</code> would produce 42.0. I modified my question to include this info."}, {"owner": {"reputation": 7656, "user_id": 823, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab7c8cd9bfc94ab2eae4a39e229a712e?s=128&d=identicon&r=PG", "display_name": "ryantm", "link": "https://stackoverflow.com/users/823/ryantm"}, "reply_to_user": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 0, "creation_date": 1475257083, "post_id": 39796621, "comment_id": 66887037, "body": "@BenjaminHodgson Thanks for the suggestion. I was researching that route for a while, but that isn&#39;t true in my case."}, {"owner": {"reputation": 7656, "user_id": 823, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab7c8cd9bfc94ab2eae4a39e229a712e?s=128&d=identicon&r=PG", "display_name": "ryantm", "link": "https://stackoverflow.com/users/823/ryantm"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475257288, "post_id": 39796621, "comment_id": 66887132, "body": "@chi can you elaborate on where I put that pattern?"}], "answers": [{"comments": [{"owner": {"reputation": 7656, "user_id": 823, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab7c8cd9bfc94ab2eae4a39e229a712e?s=128&d=identicon&r=PG", "display_name": "ryantm", "link": "https://stackoverflow.com/users/823/ryantm"}, "edited": false, "score": 0, "creation_date": 1475268022, "post_id": 39797901, "comment_id": 66892172, "body": "This seems to work great for my problem. I think I can compartmentalize the Type Applications into a small part of the code. Thanks!"}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 2, "last_activity_date": 1475260204, "creation_date": 1475260204, "answer_id": 39797901, "question_id": 39796621, "link": "https://stackoverflow.com/questions/39796621/how-do-i-change-this-to-say-the-body-types-should-equal-the-parameter-types/39797901#39797901", "title": "How do I change this to say the body types should equal the parameter types?", "body": "<p>Using explicit type arguments. I'm not convinced this is a good approach,\nthough.</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes, TypeApplications, \n             ScopedTypeVariables, MultiParamTypeClasses #-}\n\nclass C a b where\n   getA :: a\n   getB :: b\n\nfoo :: forall a b. C a b =&gt; a -&gt; b\nfoo _ = getB @ a\n\ninstance C Int Char where\n   getA = 3\n   getB = 'a'\n\ntest :: Char\ntest = foo @ Int @ Char 23\n</code></pre>\n\n<p>Are you sure you don't have any functional dependency between <code>a</code> and <code>b</code>? Otherwise, you have to always disambiguate with explicit type arguments.</p>\n"}, {"tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 3, "last_activity_date": 1475260998, "creation_date": 1475260998, "answer_id": 39798119, "question_id": 39796621, "link": "https://stackoverflow.com/questions/39796621/how-do-i-change-this-to-say-the-body-types-should-equal-the-parameter-types/39798119#39798119", "title": "How do I change this to say the body types should equal the parameter types?", "body": "<p>To illustrate the problem, consider these two instances:</p>\n\n<pre><code>instance Char Double where\n  a = 'x'\n  b = 42.0\n\ninstance Char Int where\n  a = 'x'\n  b = 17\n</code></pre>\n\n<p>Now <code>f 'c'</code> needs to equal <code>b</code>, but which <code>b</code>? There are two instances of <code>C</code> that could work.</p>\n\n<p>One solution is to use a functional dependency to enforce that the type of <code>b</code> depends on the type of <code>a</code>:</p>\n\n<pre><code>class C a b | b -&gt; a where\n   a :: a\n   b :: b\n</code></pre>\n\n<p>Just note that you may run into some type inference issues that require explicit annotations.</p>\n"}], "owner": {"reputation": 7656, "user_id": 823, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ab7c8cd9bfc94ab2eae4a39e229a712e?s=128&d=identicon&r=PG", "display_name": "ryantm", "link": "https://stackoverflow.com/users/823/ryantm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 39797901, "answer_count": 2, "score": 0, "last_activity_date": 1475260998, "creation_date": 1475255255, "last_edit_date": 1475258927, "question_id": 39796621, "link": "https://stackoverflow.com/questions/39796621/how-do-i-change-this-to-say-the-body-types-should-equal-the-parameter-types", "title": "How do I change this to say the body types should equal the parameter types?", "body": "<p>I am trying to use a typeclass to pass a dictionary into a function where the values of the dictionary are uniquely specified by the types of two types parameters of the function.</p>\n\n<p>When I compile this code, I get the error message in the comment. </p>\n\n<p>How do I modify this code to avoid this ambiguity? I would like the a and b types in the body to be the same as the ones in the formal parameters. </p>\n\n<pre><code>{-# LANGUAGE MultiParamTypeClasses#-}\n\nclass C a b where\n  a :: a\n  b :: b\n\nf :: C a b =&gt; a -&gt; b\nf a = b\n\n\n-- $ runhaskell toy2.hs\n-- toy2.hs:8:7:\n--     Could not deduce (C a0 b) arising from a use of \u2018b\u2019\n--     from the context (C a b)\n--       bound by the type signature for f :: C a b =&gt; a -&gt; b\n--       at toy2.hs:7:6-20\n--     The type variable \u2018a0\u2019 is ambiguous\n--     Relevant bindings include f :: a -&gt; b (bound at toy2.hs:8:1)\n--     In the expression: b\n--     In an equation for \u2018f\u2019: f a = b\n</code></pre>\n\n<p>Then usage would be like</p>\n\n<pre><code>instance C String Double where\n  a = \"foo\"\n  b = 42.0\n</code></pre>\n\n<p>and</p>\n\n<pre><code>f \"bar\" = 42.0\n</code></pre>\n"}, {"tags": ["haskell", "ghc", "type-kinds"], "answers": [{"tags": [], "owner": {"reputation": 23444, "user_id": 414413, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6de2113f01432aa844dc85070ff33e89?s=128&d=identicon&r=PG", "display_name": "Cirdec", "link": "https://stackoverflow.com/users/414413/cirdec"}, "is_accepted": true, "score": 8, "last_activity_date": 1475258655, "creation_date": 1475258655, "answer_id": 39797493, "question_id": 39796459, "link": "https://stackoverflow.com/questions/39796459/deriving-with-higher-kinder-type-variables/39797493#39797493", "title": "Deriving with higher-kinder type variables", "body": "<p><strong>1.</strong> There's nothing unsafe about <code>UndecidableInstances</code>.</p>\n\n<p>There's another way to define <code>Show (Tricky m)</code>, which is to require the <code>m</code> satisfies <code>forall a. Show a =&gt; Show (m a)</code>. This is captured by a typeclass like</p>\n\n<pre><code>class Show1 f where\n    showsPrec1 :: Show a =&gt; Int -&gt; f a -&gt; ShowS\n</code></pre>\n\n<p>An <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor-Classes.html#t:Show1\">even cleverer version of <code>Show1</code></a> has been added to base 4.9. It's more general since it can be used to show an <code>m a</code> when <code>a</code> doesn't have a <code>Show a</code> instance.</p>\n\n<p><strong>2.</strong> You've found the right bits and pieces for doing this.</p>\n\n<p><strong>3.</strong> No, it's right-headed to abstract over even higher-kinded structures like <code>Vector</code>, <code>[]</code>, and <code>Set</code>. Monad transformers have the kind <code>(* -&gt; *) -&gt; (* -&gt; *)</code> and abstract over types of kind <code>(* -&gt; *)</code>, the same kind as a functor, to produce types with the same kind as a functor. <code>Tricky</code> has kind <code>(* -&gt; *) -&gt; *</code>, it takes something with the same kind as a functor and produces an ordinary data type. I call data types of this kind \"Models\" since they produce a data type abstracting over how it is put together.</p>\n"}], "owner": {"reputation": 1545, "user_id": 2670439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/wFcPA.jpg?s=128&g=1", "display_name": "SwiftsNamesake", "link": "https://stackoverflow.com/users/2670439/swiftsnamesake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 1, "accepted_answer_id": 39797493, "answer_count": 1, "score": 5, "last_activity_date": 1475317582, "creation_date": 1475254523, "last_edit_date": 1475317582, "question_id": 39796459, "link": "https://stackoverflow.com/questions/39796459/deriving-with-higher-kinder-type-variables", "title": "Deriving with higher-kinder type variables", "body": "<p>Let's say I have a polymorphic type where one of the parameters is a higher-kinded type (<code>* -&gt; *</code>).</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>data Tricky m = Tricky { numbers :: m Int, genesis :: m String }\n</code></pre>\n\n<p>Is there a general way of deriving instances for such types without using arcane and unsafe language extensions?</p>\n\n<p>I tried enabling <code>StandaloneDeriving</code> so that I could specify the context:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>deriving instance Show (m Int) =&gt; Show (Tricky m)\n</code></pre>\n\n<p>But GHC then complains about the constraint being no smaller than the instance head, and points me in the direction of <code>UndecidableInstances</code>.</p>\n\n<p>To summarise:</p>\n\n<p><strong>1.</strong> Should I simply go along with this advice, or is there a better way?</p>\n\n<p><strong>2.</strong> Are there any proposals to make this process easier?</p>\n\n<p><strong>3.</strong> Is it somehow wrong-headed to want to derive 'higher-kinded' instances?      Would it be better to derive instances for a few concrete types instead (eg. <code>Vector</code>, <code>[]</code>, <code>Set</code>)</p>\n"}, {"tags": ["haskell", "applicative", "free-monad"], "comments": [{"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 2, "creation_date": 1475255219, "post_id": 39795944, "comment_id": 66886036, "body": "You need to define an actual instance of <code>Functor</code> to use <code>fmap</code>. You have already defined <code>&gt;&gt;=</code> for <code>FixE f</code> and <code>return</code> is <code>ThrowE</code> so you can use the default implementations for <code>Functor</code> and <code>Applicative</code>."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1475256827, "post_id": 39795944, "comment_id": 66886890, "body": "I do not think this is what the type error is about. Well I sort of understand what they mean now, but what really surprises me is that when I change <code>applicate_fixe&#39;&#39; (Throw f) b = fmap f b</code> to <code>applicate_fixe&#39; (Throw f) (Fix b) = fmap f b</code> I still get a type error. This confusing because <code>b</code> in <code>Fix b</code> really is a functor and yet the compiler still won&#39;t accept it."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1475264044, "post_id": 39795944, "comment_id": 66890492, "body": "You need to either add <code>instance .. =&gt; Functor (...) where fmap = ...</code> explicitly or using the <code>deriving</code> mechanism (possibly standalone). If you don&#39;t, Haskell does not equip your type with any instance (not for <code>Functor</code>, nor for <code>Eq</code>, <code>Show</code>, ... or any other class)."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1475266220, "post_id": 39795944, "comment_id": 66891440, "body": "@chi, well, you do get two non-standard classes for free with sufficiently recent compilers. <code>Typeable</code> and <code>Coercible</code> don&#39;t need to be derived explicitly."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "edited": false, "score": 0, "creation_date": 1475301234, "post_id": 39795944, "comment_id": 66898768, "body": "Please see the edit."}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1475303254, "post_id": 39795944, "comment_id": 66899166, "body": "@melpomene No, that still gives me type errors."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1475303831, "post_id": 39795944, "comment_id": 66899285, "body": "Shouldn&#39;t that be <code>fmap f (Fix x) = Fix (fmap (fmap f) x)</code>?"}, {"owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1475304648, "post_id": 39795944, "comment_id": 66899432, "body": "@melpomene Yeah, that is it. Did not see that one coming. Also changing <code>applicate_fixe (Throw f) (Fix b) = fmap f b</code> to <code>applicate_fixe (Throw f) b = fmap f b</code> now fixes the type error. I guess I have my applicative right there."}], "answers": [{"tags": [], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "is_accepted": false, "score": 1, "last_activity_date": 1475304990, "creation_date": 1475304990, "answer_id": 39803864, "question_id": 39795944, "link": "https://stackoverflow.com/questions/39795944/why-cant-the-compiler-deduce-the-functor-type-in-the-free-applicative-examples/39803864#39803864", "title": "Why can&#39;t the compiler deduce the Functor type in the Free Applicative examples?", "body": "<pre><code>module Main where\n\ndata Toy b next =\n    Output b next\n  | Bell next\n  | Done\n\ninstance Functor f =&gt; Functor (FixE f) where\n  fmap f (Fix x) = Fix (fmap (fmap f) x)\n  fmap f (Throw e) = Throw (f e)\n\ndata FixE f e = Fix (f (FixE f e)) | Throw e\n\n-- Monadic function\ncatch :: (Functor f) =&gt; FixE f e1 -&gt; (e1 -&gt; FixE f e2) -&gt; FixE f e2\ncatch (Fix x) f = Fix (fmap (`catch` f) x)\ncatch (Throw e) f = f e\n\n-- Applicative function\napplicativeFixE :: (Functor f) =&gt; FixE f (e1 -&gt; e2) -&gt; FixE f e1 -&gt; FixE f e2\napplicativeFixE (Fix f) b = Fix (fmap (`applicativeFixE` b) f)\napplicativeFixE (Throw f) b = fmap f b\n\nmain :: IO()\nmain = print \"Hello.\"\n</code></pre>\n\n<p>Based on the comments I managed to implement the applicative function. I am not completely sure why the above works yet versus some of the alternative I've tried, but it type checks. </p>\n\n<p>Thanks everyone.</p>\n"}], "owner": {"reputation": 3436, "user_id": 4364027, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e84dbb0e9c838c25bbb70b326fd696aa?s=128&d=identicon&r=PG&f=1", "display_name": "Marko Grdinic", "link": "https://stackoverflow.com/users/4364027/marko-grdinic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475304990, "creation_date": 1475252479, "last_edit_date": 1475301663, "question_id": 39795944, "link": "https://stackoverflow.com/questions/39795944/why-cant-the-compiler-deduce-the-functor-type-in-the-free-applicative-examples", "title": "Why can&#39;t the compiler deduce the Functor type in the Free Applicative examples?", "body": "<pre><code>module Main where\n\ndata Toy b next =\n    Output b next\n  | Bell next\n  | Done\n\ndata FixE f e = Fix (f (FixE f e)) | Throw e\n\n-- The working monadic function\ncatch :: (Functor f) =&gt; FixE f e1 -&gt; (e1 -&gt; FixE f e2) -&gt; FixE f e2\ncatch (Fix x) f = Fix (fmap (`catch` f) x)\ncatch (Throw e) f = f e\n\n-- Type error\napplicate_fixe :: (Functor f) =&gt; FixE f (e1 -&gt; e2) -&gt; FixE f e1 -&gt; FixE f e2\napplicate_fixe a b = a `catch` (`fmap` b)\n\n-- Type error\napplicate_fixe' :: (Functor f) =&gt; FixE f (e1 -&gt; e2) -&gt; FixE f e1 -&gt; FixE f e2\napplicate_fixe' (Throw f) b = fmap f b\napplicate_fixe' (Fix f) b = Fix (fmap (`applicate_fixe` b) f)\n\nmain :: IO()\nmain = print \"Hello.\"\n</code></pre>\n\n<hr>\n\n<pre><code>C:\\!Various_Exercises\\Haskell_Exercises\\Free_Monad_Stuff\\test.hs: 15, 33\nCould not deduce (Functor (FixE f)) arising from a use of `fmap'\nfrom the context (Functor f)\n  bound by the type signature for\n             applicate_fixe :: Functor f =&gt;\n                               FixE f (e1 -&gt; e2) -&gt; FixE f e1 -&gt; FixE f e2\n  at test.hs:14:19-76\nIn the second argument of `catch', namely `(`fmap` b)'\nIn the expression: a `catch` (`fmap` b)\nIn an equation for `applicate_fixe':\n    applicate_fixe a b = a `catch` (`fmap` b)\nC:\\!Various_Exercises\\Haskell_Exercises\\Free_Monad_Stuff\\test.hs: 18, 31\nCould not deduce (Functor (FixE f)) arising from a use of `fmap'\nfrom the context (Functor f)\n  bound by the type signature for\n             applicate_fixe' :: Functor f =&gt;\n                                FixE f (e1 -&gt; e2) -&gt; FixE f e1 -&gt; FixE f e2\n  at test.hs:17:20-77\nIn the expression: fmap f b\nIn an equation for applicate_fixe':\n    applicate_fixe' (Throw f) b = fmap f b\n</code></pre>\n\n<p>I am going off <a href=\"http://www.haskellforall.com/2012/06/you-could-have-invented-free-monads.html\" rel=\"nofollow\">this tutorial</a> trying to figure out the Free Monad and as an exercise I am trying to do the Applicative function as well. To be honest, I am not sure what those errors are supposed to mean.</p>\n\n<p>Also I am not sure what the type signature for the <code>data FixE f e = Fix (f (FixE f e)) | Throw e</code> is supposed to be exactly. At first I thought <code>f (FixE f e)</code> is supposed to be a tuple, but it does seem like it is one argument, therefore the <code>(FixE f e)</code> part is actually a type argument to the first <code>f</code>. But if that is the case shouldn't the <code>f</code> inside <code>FixE f e</code> also require a type argument as well?</p>\n\n<p>Edit:</p>\n\n<pre><code>applicate_fixe :: (Functor f) =&gt; FixE f (e1 -&gt; e2) -&gt; FixE f e1 -&gt; FixE f e2\napplicate_fixe (Fix f) b = Fix (fmap (`applicate_fixe` b) f) -- Works as the f argument in fmap is a functor\napplicate_fixe (Throw f) (Fix b) = fmap f b -- The b is of type f (FixE f e1) so it is clearly a functor and yet the type system rejects it.\n</code></pre>\n\n<p>Before anything, I do not understand this last part. Also what exactly should have an instance of functor defined? <code>f</code> should already has that constraint in the above definition.</p>\n\n<p>Edit2: Maybe you means that FixE should have a Functor instance.</p>\n\n<pre><code>instance Functor f =&gt; Functor (FixE f) where\n  fmap f (Fix x) = fmap f x -- Type error\n  fmap f (Throw e) = Throw (f e)\n</code></pre>\n\n<p>Here is my best shot, but it complains that the type f is too rigid in the first line.</p>\n"}, {"tags": ["haskell", "functional-programming", "typeclass", "type-kinds"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1475252446, "post_id": 39795779, "comment_id": 66884640, "body": "I think it&#39;s a problem with the documentation generation; the extra <code>*</code> appear in the documentation for <code>Compose</code>, <code>Product</code>, and <code>Sum</code> instances, but not in the source itself."}], "answers": [{"comments": [{"owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1475266639, "post_id": 39796501, "comment_id": 66891607, "body": "Thanks. But is it necessary to use PolyKinds? I thought the compiler was smart enough to figure this out."}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "reply_to_user": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "edited": false, "score": 0, "creation_date": 1475273951, "post_id": 39796501, "comment_id": 66894182, "body": "Figure what out? Regular Haskell does not allow for kind variables - such a type signature would not even be valid. GHC conforms to Haskell 2010 by default, so it wouldn&#39;t even permit you to write the type declaration as given - it would tell you to turn on <code>PolyKinds</code>."}], "tags": [], "owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "is_accepted": true, "score": 2, "last_activity_date": 1475254785, "creation_date": 1475254785, "answer_id": 39796501, "question_id": 39795779, "link": "https://stackoverflow.com/questions/39795779/the-role-of-the-asterisks-kinds-in-this-foldable-instance/39796501#39796501", "title": "The role of the asterisks (kinds, *) in this Foldable instance", "body": "<p>Technically the kind of <code>Compose</code> is more general if you turn on <code>PolyKinds</code> : </p>\n\n<pre><code>newtype Compose (f :: k -&gt; *) (g :: k' -&gt; k) (a :: k') = Compose (f (g a))\n</code></pre>\n\n<p>This type is inferred with <code>PolyKinds</code> and requires it to write (and it is defined as such in the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/src/Data.Functor.Compose.html#Compose\" rel=\"nofollow\">library</a> - note that <code>PolyKinds</code> is enabled in the module). </p>\n\n<p>Technically, this\n<code>Compose</code> takes two <em>kind</em> parameters, which are implicit. This means you do not normally specify them, nor can you normally see them. However, it is a peculiarity of the Haddocks that they do display kind parameters. But if you are interested, you can see the same thing in GHCi, with e.g. </p>\n\n<pre><code>&gt;:set -fprint-explicit-kinds\n&gt;import Data.Functor.Compose\n&gt;:i Compose\ntype role Compose nominal nominal representational nominal nominal\nnewtype Compose k k1 (f :: k -&gt; *) (g :: k1 -&gt; k) (a :: k1)\n  = Compose {getCompose :: f (g a)}\n        -- Defined in `Data.Functor.Compose'\n....\ninstance [safe] (Foldable f, Foldable g) =&gt;\n                Foldable (Compose * * f g)\n</code></pre>\n\n<p>Note that <code>Compose</code> is given two kind arguments - <code>*</code> and <code>*</code> - because <code>f</code> and <code>g</code> must be of kind <code>* -&gt; *</code> due to the <code>Functor</code> constraints. </p>\n"}], "owner": {"reputation": 4593, "user_id": 2289983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/LG4hj.jpg?s=128&g=1", "display_name": "Damian Nadales", "link": "https://stackoverflow.com/users/2289983/damian-nadales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 39796501, "answer_count": 1, "score": 3, "last_activity_date": 1475254785, "creation_date": 1475251841, "question_id": 39795779, "link": "https://stackoverflow.com/questions/39795779/the-role-of-the-asterisks-kinds-in-this-foldable-instance", "title": "The role of the asterisks (kinds, *) in this Foldable instance", "body": "<p>In the <a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Foldable.html\" rel=\"nofollow\"><code>Foldable</code></a> documentaion, I see the following instance:</p>\n\n<pre><code>(Foldable f, Foldable g) =&gt; Foldable (Compose * * f g)\n</code></pre>\n\n<p>If I look at the definition of <a href=\"https://hackage.haskell.org/package/base-4.9.0.0/docs/Data-Functor-Compose.html#t:Compose\" rel=\"nofollow\">Compose</a>, I see it is declared as</p>\n\n<pre><code>newtype Compose f g a = Compose f (g a)\n</code></pre>\n\n<p>which has kind <code>(* -&gt; *) -&gt; (* -&gt; *) -&gt; * -&gt; *</code>, right? (which I suppose it is inferred). Now as far as I can see, I guess it would be correct to write:</p>\n\n<pre><code>(Foldable f, Foldable g) =&gt; Foldable (Compose f g)\n</code></pre>\n\n<p>Since <code>Compose f g</code> has also kind <code>* -&gt; *</code>. However, I guess the two <code>kind</code> identifiers are there for a reason. But what is this reason?</p>\n"}, {"tags": ["haskell", "ffi"], "answers": [{"comments": [{"owner": {"reputation": 1435, "user_id": 45364, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ee9c045ef6024f170ebfe2b619bcef1c?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/45364/sean"}, "edited": false, "score": 0, "creation_date": 1475243137, "post_id": 39792849, "comment_id": 66878903, "body": "Thanks! I saw StablePtr, but I didn&#39;t quite get it. Maybe I need a third cup of coffee."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": true, "score": 4, "last_activity_date": 1475242517, "creation_date": 1475242517, "answer_id": 39792849, "question_id": 39792790, "link": "https://stackoverflow.com/questions/39792790/how-do-i-pass-haskell-data-through-a-c-ffi-as-an-opaque-data-type/39792849#39792849", "title": "How do I pass Haskell data through a C FFI as an opaque data type?", "body": "<p>This is what <a href=\"https://hackage.haskell.org/package/base/docs/Foreign-StablePtr.html#t:StablePtr\" rel=\"nofollow\">StablePtr</a> is for. So you have to use <a href=\"https://hackage.haskell.org/package/base/docs/Foreign-StablePtr.html#v:newStablePtr\" rel=\"nofollow\">newStablePtr</a> in place of your <code>dataFromPtr</code> and <a href=\"https://hackage.haskell.org/package/base/docs/Foreign-StablePtr.html#v:deRefStablePtr\" rel=\"nofollow\">deRefStablePtr</a> in place of your <code>dataToPtr</code>. Note that <code>deRefStablePtr</code> operates in the <code>IO</code> monad, so you would have to ajust your code accordingly. Also, you would have to adjust the foreign imports to use stable pointers, e.g.:</p>\n\n<pre><code>foreign import ccall \"lua.h lua_pushlightuserdata\"\n  c_lua_pushlightuserdata :: LuaState -&gt; StablePtr MyData -&gt; IO ()\n</code></pre>\n\n<p>and similarly for <code>lua_touserdata</code>.</p>\n\n<p>Finally, when you create a stable pointer with <code>newStablePtr</code>, the garbage collector will not deallocate that value automatically. So it is your responsibility to deallocate it by calling <a href=\"https://hackage.haskell.org/package/base/docs/Foreign-StablePtr.html#v:freeStablePtr\" rel=\"nofollow\">freeStablePtr</a>.</p>\n"}], "owner": {"reputation": 1435, "user_id": 45364, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ee9c045ef6024f170ebfe2b619bcef1c?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/45364/sean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 39792849, "answer_count": 1, "score": 4, "last_activity_date": 1475242517, "creation_date": 1475242333, "question_id": 39792790, "link": "https://stackoverflow.com/questions/39792790/how-do-i-pass-haskell-data-through-a-c-ffi-as-an-opaque-data-type", "title": "How do I pass Haskell data through a C FFI as an opaque data type?", "body": "<p>I'm trying to pass some data through a C library that doesn't read or modify that data.</p>\n\n<pre><code>foreign import ccall \"lua.h lua_pushlightuserdata\"\n  c_lua_pushlightuserdata :: LuaState -&gt; Ptr a -&gt; IO ()\n\nforeign import ccall \"lua.h lua_touserdata\"\n  c_lua_touserdata :: LuaState -&gt; CInt -&gt; IO (Ptr a)\n\ndata MyData =\n  MyData\n  { dataIds = TVar [Int]\n  , dataSomethingElse = [String]\n  }\n\ncalledFromRunLuaState :: LuaState -&gt; IO ()\ncalledFromRunLuaState luaState = do\n  dataPtr &lt;- c_lua_touserdata luaState (-1)\n  myData &lt;- dataFromPtr dataPtr\n  doSomethingWith myData\n\nmain = do\n  luaState &lt;- Lua.newstate\n  ids &lt;- atomically $ newTVar []\n  c_lua_pushlightuserdata luaState (dataToPtr (MyData ids []))\n  runLuaState luaState\n</code></pre>\n\n<p>I'm trying to figure out how to define <code>dataFromPtr</code> and <code>dataToPtr</code>.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1475239394, "post_id": 39791647, "comment_id": 66876557, "body": "The usual, I&#39;d assume: <code>forall r. Proxy (t r)</code>"}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1475242275, "post_id": 39791647, "comment_id": 66878375, "body": "So that works  because <code>r</code> doesn&#39;t need to unify with anything, and also doesn&#39;t have any constraints?"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1475238817, "creation_date": 1475238817, "question_id": 39791647, "link": "https://stackoverflow.com/questions/39791647/unification-with-mystery-variable", "title": "Unification with mystery variable", "body": "<p>In the following snippet, I incorrectly tagged <code>entailFunctor</code> with <code>t</code> <em>and</em> <code>r</code>, instead of just <code>t</code>. As a result, when I try to use it, I need both <code>t</code> and <code>r</code> in scope.</p>\n\n<pre><code>{-# LANGUAGE ScopedTypeVariables #-}\n{-# LANGUAGE TypeOperators #-}\n\nimport Data.Constraint\nimport Data.Tagged\nimport Data.Proxy\n\nentailFunctor  :: Tagged (t r) (() :- (Functor t))\nentailFunctor = undefined\n\nnewtype Foo t r = Foo (t r)\n\ninstance Functor (Foo t) where\n  fmap f (Foo a) = Foo $ fmap f a \\\\ proxy entailFunctor (Proxy::Proxy (t r))\n</code></pre>\n\n<p>That's a problem because (at least the way I wrote my <code>Functor</code> instance) <code>r</code> <strong>isn't</strong> in scope. Yet this compiles with GHC 8.0.1! Is this a bug, and if not, to what does the type variable <code>r</code> refer in the definition of <code>fmap</code>?</p>\n"}, {"tags": ["haskell", "minimax"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 1, "creation_date": 1475237497, "post_id": 39790016, "comment_id": 66875424, "body": "<code>Num (Rose a)</code> is a clue. You&#39;re trying to use a <code>Rose a</code> where something with a <code>Num</code> instance is expected. Look at your definition of <code>minimax&#39;</code>. Think about the type of the value that it returns and the type of the value it should be returning."}, {"owner": {"reputation": 71, "user_id": 6904246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a599e1abb05cda9aa32f22d485b2409?s=128&d=identicon&r=PG&f=1", "display_name": "Henk", "link": "https://stackoverflow.com/users/6904246/henk"}, "reply_to_user": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 0, "creation_date": 1475241172, "post_id": 39790016, "comment_id": 66877670, "body": "Mhm, minimax&#39; should return a Rose int, since that is also the output of the function minimax, but as far as i can see that is also what it does?"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1475241767, "post_id": 39790016, "comment_id": 66878047, "body": "@Henk: Not in your <code>case \u2026 of</code>."}, {"owner": {"reputation": 71, "user_id": 6904246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a599e1abb05cda9aa32f22d485b2409?s=128&d=identicon&r=PG&f=1", "display_name": "Henk", "link": "https://stackoverflow.com/users/6904246/henk"}, "edited": false, "score": 0, "creation_date": 1475243393, "post_id": 39790016, "comment_id": 66879067, "body": "Ah, in case the rose starts of empty minimax&#39; wil only return a number. Shouldnt changing the <code>case .. off</code> to.                                                          <code>Just n -&gt; if n == p then (1 :&gt; []) else (-1 :&gt; [])   Nothing -&gt; (0 :&gt; [])</code> fix this problem (since it sadly doesn&#39;t) ?"}], "owner": {"reputation": 71, "user_id": 6904246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a599e1abb05cda9aa32f22d485b2409?s=128&d=identicon&r=PG&f=1", "display_name": "Henk", "link": "https://stackoverflow.com/users/6904246/henk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 296, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1475233568, "creation_date": 1475233397, "last_edit_date": 1475233568, "question_id": 39790016, "link": "https://stackoverflow.com/questions/39790016/haskell-minimax-flexiblecontext", "title": "Haskell minimax, FlexibleContext", "body": "<p>I'm new to haskell and need to write a function called minimax for an assignment on a gametree provided to the function (a tree of boards, Rose Board) and a player who's turn it is. I sadly get a </p>\n\n<blockquote>\n  <p>\"Non type-variable argument in te constraint: Num (Rose a) (use FlexibleContext to permit this)\" </p>\n</blockquote>\n\n<p>I've tried doing it different ways, but I keep getting the same problem about FlexibleContext and i can't figure out exactly FlexibleContext is. </p>\n\n\n\n<pre class=\"lang-haskell prettyprint-override\"><code>minimax :: Player -&gt; Rose Board -&gt; Rose Int\nminimax player roseBoard = minimax' player roseBoard\n              where minimax' p (board :&gt; rest) | null rest  = case hasWinner board of\n                                                            Just n -&gt; if n == p then 1 else -1 \n                                                            Nothing -&gt; 0\n                                               | otherwise = 0 :&gt; [(minimax' (nextPlayer p) (onthaak rest))]\n                                                     where onthaak [a] = a  \n</code></pre>\n"}, {"tags": ["parsing", "haskell", "parsec"], "answers": [{"comments": [{"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475295233, "post_id": 39791310, "comment_id": 66897795, "body": "This is great, I learned a lot from it. (I especially appreciate whatever magic you used to give the parsers readable types instead of things like <code>Parsec.Stream s m Char =&gt; Parsec.ParsecT s u m [Expr]</code> like I had before.) But your parser seems to ignore unmatched &#39;]&#39; if it finds a set of matched brackets first, so that <code>[]]</code> comes out equivalent to <code>[]</code> instead of <code>[[]]</code>. (I&#39;ve added that test case to the question and I&#39;m really sorry for not making that intention clearer to begin with. Perhaps I can fix it myself once I figure out what your <code>parseStart</code> function is doing.)"}, {"owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "edited": false, "score": 0, "creation_date": 1475301533, "post_id": 39791310, "comment_id": 66898831, "body": "I posted a self-answer that addresses this issue, though it feels a bit like cheating..."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 2, "last_activity_date": 1475237711, "creation_date": 1475237711, "answer_id": 39791310, "question_id": 39787541, "link": "https://stackoverflow.com/questions/39787541/how-to-parse-this-grammar-in-parsec-unusual-case-of-left-recursion/39791310#39791310", "title": "How to parse this grammar in Parsec? (unusual case of left recursion)", "body": "<p>Here's my take on this one:</p>\n\n<pre><code>import qualified Text.Parsec as Parsec\nimport Text.Parsec.String (Parser)\nimport Control.Monad (void)\nimport Control.Applicative\n\ndata Expr = Brackets [Expr]\n        deriving(Show)\n\nparseTopLevel :: Parser [Expr]\nparseTopLevel =\n    ((:) &lt;$&gt; parseStart &lt;*&gt; parseExpr) &lt;|&gt; parseExpr\n\nparseStart :: Parser Expr\nparseStart = do\n    closeBracket\n    go (Brackets [])\n  where\n    go r = (closeBracket *&gt; go (Brackets [r])) &lt;|&gt; return r\n\nparseBrackets :: Parser Expr\nparseBrackets = do\n        expr &lt;- Parsec.between openBracket closeBracket parseExpr\n        return $ Brackets expr\n\nparseExpr :: Parser [Expr]\nparseExpr = Parsec.many parseBrackets\n\nopenBracket :: Parser ()\nopenBracket = void $ Parsec.char '['\n\ncloseBracket :: Parser ()\ncloseBracket = (void $ Parsec.char ']') &lt;|&gt; Parsec.eof\n</code></pre>\n\n<p>As you can see, for parsing the unbalanced brackets at the beginning of the string, I couldn't use any of the combinators that come with parsec, I just wrote my own, <code>parseStart</code>. The rest is pretty much you code.</p>\n\n<p>Here's what it returns on your example:</p>\n\n<pre><code>\u03bb&gt; Parsec.parse parseTopLevel \"\" \"]][][[\"\nRight [Brackets [Brackets []],Brackets [],Brackets [Brackets []]]\n\u03bb&gt; Parsec.parse parseTopLevel \"\" \"[[]][][[]]\"\nRight [Brackets [Brackets []],Brackets [],Brackets [Brackets []]]\n</code></pre>\n\n<p>As you can see, it returns the exact same thing for <code>]][][[</code> and <code>[[]][][[]]</code> as you wanted.</p>\n"}, {"tags": [], "owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "is_accepted": false, "score": 1, "last_activity_date": 1475301513, "last_edit_date": 1495535267, "creation_date": 1475301513, "answer_id": 39803516, "question_id": 39787541, "link": "https://stackoverflow.com/questions/39787541/how-to-parse-this-grammar-in-parsec-unusual-case-of-left-recursion/39803516#39803516", "title": "How to parse this grammar in Parsec? (unusual case of left recursion)", "body": "<p>Here is a self-answer, based on <a href=\"https://stackoverflow.com/a/39791310/1119340\">redneb's improvements to my code</a>. This version covers cases like <code>[]]</code> in which redneb's code ignores the unmatched <code>]</code>s rather than matching them against the start of the string.</p>\n\n<p>This code works by simply parsing the whole expression as a <code>]</code>-separated list of balanced expressions, and then explicitly building up the parse tree from that list. This feels somehow like admitting defeat, since the construction of the parse tree happens in a separate step from the actual parsing. Then again that seems to be how <code>chainl1</code> works, so perhaps it's the \"right way\" after all. I won't accept my own answer in case anyone else has a better solution.</p>\n\n<pre><code>import qualified Text.Parsec as Parsec\nimport Text.Parsec.String (Parser)\nimport Control.Monad (void)\nimport Control.Applicative\n\n-- for testing\nparse rule text = Parsec.parse rule \"(source)\" text\n\ndata Expr = Brackets [Expr]\n        deriving(Show)\n\nparseTopLevel :: Parser [Expr]\nparseTopLevel = do\n        exprList &lt;- parseExprAsList\n        return $ composeExpr exprList\n\ncomposeExpr :: [[Expr]] -&gt; [Expr]\ncomposeExpr [exprList] = exprList\ncomposeExpr (exprList:next:tail) = composeExpr $ (Brackets exprList:next) : tail\n\nparseExprAsList :: Parser [[Expr]]\nparseExprAsList = Parsec.sepBy parseBalancedExpr (Parsec.char ']')\n\nparseBalancedExpr :: Parser [Expr]\nparseBalancedExpr = Parsec.many parseBrackets\n\nparseBrackets :: Parser Expr\nparseBrackets = do\n        expr &lt;- Parsec.between openBracket closeBracket parseBalancedExpr\n        return $ Brackets expr\n\nopenBracket :: Parser ()\nopenBracket = void $ Parsec.char '['\n\ncloseBracket :: Parser ()\ncloseBracket = (void $ Parsec.char ']') &lt;|&gt; Parsec.eof\n</code></pre>\n\n<p>Some test cases:</p>\n\n<pre><code>*Main&gt; parse parseTopLevel \"[]]\"\nRight [Brackets [Brackets []]]\n*Main&gt; parse parseTopLevel \"[[]]\"\nRight [Brackets [Brackets []]]\n\n*Main&gt; parse parseTopLevel \"][\"\nRight [Brackets [],Brackets []]\n*Main&gt; parse parseTopLevel \"[][]\"\nRight [Brackets [],Brackets []]\n\n*Main&gt; parse parseTopLevel \"[]][]]]\"\nRight [Brackets [Brackets [Brackets [Brackets []],Brackets []]]]\n*Main&gt; parse parseTopLevel \"[[[[]][]]\"\nRight [Brackets [Brackets [Brackets [Brackets []],Brackets []]]]\n</code></pre>\n"}], "owner": {"reputation": 6424, "user_id": 1119340, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/ts6WE.jpg?s=128&g=1", "display_name": "Nathaniel", "link": "https://stackoverflow.com/users/1119340/nathaniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1475301513, "creation_date": 1475225810, "last_edit_date": 1475294933, "question_id": 39787541, "link": "https://stackoverflow.com/questions/39787541/how-to-parse-this-grammar-in-parsec-unusual-case-of-left-recursion", "title": "How to parse this grammar in Parsec? (unusual case of left recursion)", "body": "<p>I'm a beginner at Haskell, Parsec, and writing parsers in general. I'm trying to parse a simple language, which (simplifying it further for the sake of this question) consists simply of strings of nested brackets, e.g. <code>[[][]][]</code>.</p>\n\n<p>I have the Haskell code below, which works fine. However, I would like to extend it so that unmatched brackets will match against the end of the string. So for example, <code>]][][[</code> should be equivalent to <code>[[]][][[]]</code>, and <code>[]]</code> should be equivalent to <code>[[]]</code>. Doing this for open brackets matching the end of the string is easy, but doing it for closed brackets matching the start of the string results in left recursion and infinite loops, and I haven't figured out a way to resolve that. I am not sure if the reason has to do with the way I'm thinking about the grammar or the way I'm using the Parsec library, but either way I'd appreciate being shown the way forward.</p>\n\n<p>Here is the working code I have:</p>\n\n<pre><code>{-# LANGUAGE NoMonomorphismRestriction #-}\n\nimport qualified Text.Parsec as Parsec\n\nimport Control.Applicative\n\n-- for testing\nparse rule text = Parsec.parse rule \"(source)\" text\n\ndata Expr = Brackets [Expr]\n        deriving(Show)\n\nopenBracket = Parsec.char '['\ncloseBracket = Parsec.char ']'\n\nparseBrackets = do\n        expr &lt;- Parsec.between openBracket closeBracket parseExpr\n        return $ Brackets expr\n\nparseExpr = Parsec.many parseBrackets\n</code></pre>\n\n<p>If I want closed brackets to match against the end of the string I can just change the definition of <code>closeBracket</code> to</p>\n\n<pre><code>closeBracket = (Parsec.char ']' &gt;&gt; return ()) &lt;|&gt; Parsec.eof\n</code></pre>\n\n<p>But despite quite a bit of trial and error I haven't found a solution to match unmatched <code>]</code>s against the start of the string. I know that the usual solution to left recursion in Parsec is the <code>chainl1</code> function, but that seems to be quite specialised for infix operators and I can't see a way to use it here.</p>\n"}, {"tags": ["haskell", "haskell-lens"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475271818, "post_id": 39786824, "comment_id": 66893527, "body": "I don&#39;t know much lens either, and I can&#39;t answer the question, but I would recommend pulling your code apart a bit more. Write a function that takes a <code>Taggy.Element</code> and produces a filtered <code>Taggy.Element</code>. Then write a separate function handling the conversion from/to text around that, which can probably be done pretty directly through the prism."}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "edited": false, "score": 0, "creation_date": 1475645034, "post_id": 39786824, "comment_id": 67019620, "body": "(Neat trick with the stack shebang -- very useful for Stack Overflow!)"}], "answers": [{"comments": [{"owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1475696960, "post_id": 39865972, "comment_id": 67052016, "body": "Thank you! If you don&#39;t mind, added this for a review in SO Documentation <a href=\"http://stackoverflow.com/documentation/haskell/6962/parsing-html-with-taggy-lens-and-lens#t=201610051948271417687\">stackoverflow.com/documentation/haskell/6962/&hellip;</a> (might be not visible until accepted)"}, {"owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "reply_to_user": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "edited": false, "score": 0, "creation_date": 1475697778, "post_id": 39865972, "comment_id": 67052410, "body": "@KostiantynRybnikov I don&#39;t mind at all -- reuse it as you see fit."}], "tags": [], "owner": {"reputation": 31243, "user_id": 2751851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4ddc0.png?s=128&g=1", "display_name": "duplode", "link": "https://stackoverflow.com/users/2751851/duplode"}, "is_accepted": true, "score": 2, "last_activity_date": 1475644948, "creation_date": 1475644948, "answer_id": 39865972, "question_id": 39786824, "link": "https://stackoverflow.com/questions/39786824/filter-inner-element-from-a-tree-via-lens/39865972#39865972", "title": "Filter inner element from a tree via lens", "body": "<p>The root of your problem is <code>universe</code>, which flattens the DOM tree into a list. If you look again at the output, you will see the filtering is working fine but the tree structure is lost -- and so you get the unmodified article element (with all children still within) followed by the children nodes minus the script element.</p>\n\n<p>One <code>Control.Lens.Plated</code> combinator that can do what you want is <a href=\"https://hackage.haskell.org/package/lens-4.14/docs/Control-Lens-Plated.html#v:transform\" rel=\"nofollow\"><code>transform</code></a>, which transforms \"every element in the tree, in a bottom-up manner\":</p>\n\n<pre><code>transform :: Plated a =&gt; (a -&gt; a) -&gt; a -&gt; a\n</code></pre>\n\n<p>In particular, you can use it to filter the children nodes recursively:</p>\n\n<pre><code>renderWithoutScriptTag :: Text\nrenderWithoutScriptTag =\n    let mArticle :: Maybe Taggy.Element\n        mArticle =\n            (fromText somehtmlSmall) ^? html .\n            allAttributed (ix \"id\" . only \"article\")\n        mArticleFiltered =\n            fmap\n                (transform (children %~ filter (\\n -&gt;\n                    n ^? element . name /= Just \"script\")))\n                mArticle\n    in maybe \"\" (toText . Renderer.render) mArticleFiltered\n</code></pre>\n"}], "owner": {"reputation": 2277, "user_id": 540810, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d6ac4c55425d6f9d28db9068dbb49e09?s=128&d=identicon&r=PG", "display_name": "Konstantine Rybnikov", "link": "https://stackoverflow.com/users/540810/konstantine-rybnikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 1, "accepted_answer_id": 39865972, "answer_count": 1, "score": 2, "last_activity_date": 1475644948, "creation_date": 1475223649, "question_id": 39786824, "link": "https://stackoverflow.com/questions/39786824/filter-inner-element-from-a-tree-via-lens", "title": "Filter inner element from a tree via lens", "body": "<p>I'm constantly admitting that I'm bad at lens, but isn't learning by examples is a good thing? I want to take HTML, parse it with <code>taggy-lens</code> and then remove all the <code>script</code> elements from inside. Here's my attempt:</p>\n\n<pre><code>#!/usr/bin/env stack\n-- stack --resolver lts-7.1 --install-ghc runghc --package text --package lens --package taggy-lens --package string-class --package classy-prelude\n\n{-# LANGUAGE NoImplicitPrelude #-}\n{-# LANGUAGE OverloadedStrings #-}\n\nimport ClassyPrelude\nimport Control.Lens hiding (children, element)\nimport Data.String.Class (toText, fromText, toString)\nimport Data.Text (Text)\nimport Text.Taggy.Lens\nimport qualified Text.Taggy.Lens as Taggy\nimport qualified Text.Taggy.Renderer as Renderer\n\nsomehtmlSmall :: Text\nsomehtmlSmall =\n    \"&lt;!doctype html&gt;&lt;html&gt;&lt;body&gt;\\\n    \\&lt;div id=\\\"article\\\"&gt;&lt;div&gt;first&lt;/div&gt;&lt;div&gt;second&lt;/div&gt;&lt;script&gt;this should be removed&lt;/script&gt;&lt;div&gt;third&lt;/div&gt;&lt;/div&gt;\\\n    \\&lt;/body&gt;&lt;/html&gt;\"\n\nrenderWithoutScriptTag :: Text\nrenderWithoutScriptTag =\n    let mArticle :: Maybe Taggy.Element\n        mArticle =\n            (fromText somehtmlSmall) ^? html .\n            allAttributed (ix \"id\" . only \"article\")\n        mArticleFiltered =\n            fmap\n                (\\el -&gt;\n                      el ^.. to universe . traverse .\n                      filtered (\\n -&gt; n ^. name /= \"script\"))\n                mArticle\n    in maybe \"\" (toText . concatMap Renderer.render) mArticleFiltered\n\nmain :: IO ()\nmain = print renderWithoutScriptTag\n</code></pre>\n\n<p>Mark this file as executable and just run it, and you'll see:</p>\n\n<pre><code>\u279c  tmp  ./scraping-question.hs\n\"&lt;div id=\\\"article\\\"&gt;&lt;div&gt;first&lt;/div&gt;&lt;div&gt;second&lt;/div&gt;&lt;script&gt;this should be removed&lt;/script&gt;&lt;div&gt;third&lt;/div&gt;&lt;/div&gt;&lt;div&gt;first&lt;/div&gt;&lt;div&gt;second&lt;/div&gt;&lt;div&gt;third&lt;/div&gt;\"\n</code></pre>\n\n<p>So, this didn't work. I would like to:</p>\n\n<ul>\n<li>have a working solution</li>\n<li>understand the working solution</li>\n</ul>\n\n<p>Would be especially thankful, if you'd help me realize what's wrong with mine. Thanks!</p>\n"}, {"tags": ["haskell", "ip"], "comments": [{"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1475223338, "post_id": 39786657, "comment_id": 66867093, "body": "The IP\u2026 number? What exactly are you looking for? A <code>data IP4 = IP4 Word8 Word8 Word8 Word8</code>, or something for C libraries?"}, {"owner": {"reputation": 1281, "user_id": 6647585, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/cac5dd1f2f2645dcc1dbf1165fed77c6?s=128&d=identicon&r=PG&f=1", "display_name": "Vlam", "link": "https://stackoverflow.com/users/6647585/vlam"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1475223612, "post_id": 39786657, "comment_id": 66867215, "body": "E.g. &quot;134.244.11.55&quot; and get 2264140599  I also need to do that for IPv6."}, {"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1475225881, "post_id": 39786657, "comment_id": 66868441, "body": "So you want a 32 bit integer for IPv4 and a 128 bit integer for IPv6? Or I guess just an <code>Integer</code>, I don&#39;t think 128 bit fixed width integers are in the standard library."}], "answers": [{"tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": false, "score": 2, "last_activity_date": 1475238228, "last_edit_date": 1475238228, "creation_date": 1475237131, "answer_id": 39791145, "question_id": 39786657, "link": "https://stackoverflow.com/questions/39786657/how-to-parse-ip-address-into-ip-number-in-haskell/39791145#39791145", "title": "How to parse IP address into IP number in Haskell?", "body": "<p><code>Data.IP</code> has <code>IPv4</code> and <code>IPv6</code> types which support parsing from strings, as well as functions for converting them into lists of <code>Int</code> values.</p>\n\n<pre><code>&gt; fromIPv4 . read \"192.0.0.1\"\n[192,0,0,1]\n&gt; fromIPv6b . read \"2001:0db8::1\"\n[32,1,13,184,0,0,0,0,0,0,0,0,0,0,0,1]\n</code></pre>\n\n<p>Once you have the list, you can fold it to a single integer if you like:</p>\n\n<pre><code>&gt; import Data.List\n&gt; foldl' (\\acc octet -&gt; 256*acc + fromIntegral octet) 0 [192,0,0,1]\n3221225473\n</code></pre>\n\n<p>(Since both <code>fromIPv4</code> and <code>fromIPv6</code> return <code>[Int]</code> values, <code>fromIntegeral</code> ensures that the fold can return an <code>Integer</code>.)</p>\n\n<p>However, consider whether you actually <em>need</em> a single integer. Any API you have is really going to be concerned with the individual bytes in the correct order. Other than serializing an address to a binary file, you probably don't even need that.</p>\n"}, {"tags": [], "owner": {"reputation": 336, "user_id": 5657031, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQu61dwt0vc/AAAAAAAAAAI/AAAAAAAAAY0/ki0tUEoS0pU/photo.jpg?sz=128", "display_name": "Michael Szvetits", "link": "https://stackoverflow.com/users/5657031/michael-szvetits"}, "is_accepted": true, "score": 3, "last_activity_date": 1475239639, "last_edit_date": 1475239639, "creation_date": 1475238922, "answer_id": 39791678, "question_id": 39786657, "link": "https://stackoverflow.com/questions/39786657/how-to-parse-ip-address-into-ip-number-in-haskell/39791678#39791678", "title": "How to parse IP address into IP number in Haskell?", "body": "<p>Here is a copy-ready solution:</p>\n\n<pre><code>module Program where\n\nimport Data.IP\n\nipToOcts :: IP -&gt; [Int]\nipToOcts (IPv4 ip) = fromIPv4 ip\nipToOcts (IPv6 ip) = fromIPv6b ip\n\nipToInteger :: IP -&gt; Integer\nipToInteger =\n    sum . map (\\(n,o) -&gt; toInteger o * 256 ^ n) . zip [0..] . reverse . ipToOcts\n\nipStringToInteger :: String -&gt; Integer\nipStringToInteger = ipToInteger . read\n</code></pre>\n\n<p>Example calls:</p>\n\n<pre><code>ipStringToInteger \"134.244.11.55\"\nipStringToInteger \"2001:db8:00:00:00:00:00:01\"\n</code></pre>\n\n<p>You need the <em>iproute</em> package for that:</p>\n\n<pre><code>cabal install iproute\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1979, "user_id": 2789312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4OgOz.png?s=128&g=1", "display_name": "palik", "link": "https://stackoverflow.com/users/2789312/palik"}, "is_accepted": false, "score": 1, "last_activity_date": 1565189405, "creation_date": 1565189405, "answer_id": 57397119, "question_id": 39786657, "link": "https://stackoverflow.com/questions/39786657/how-to-parse-ip-address-into-ip-number-in-haskell/57397119#57397119", "title": "How to parse IP address into IP number in Haskell?", "body": "<p>2018 was released <a href=\"https://hackage.haskell.org/package/ip-1.5.1/docs/Net-IP.html\" rel=\"nofollow noreferrer\">ip</a> package, which is very convenient for the purpose.</p>\n\n<p><strong>Decode</strong></p>\n\n<pre><code>\u03bb&gt; import Net.IP\n\u03bb&gt; :set -XOverloadedStrings\n\u03bb&gt; decode \"127.0.0.1\"\nJust (ipv4 127 0 0 1)\n\u03bb&gt; decode \"2a02:2450:dd1f:0:7646:a0ff:fe91:67b1\"\nJust (ipv6 0x2a02 0x2450 0xdd1f 0x0000 0x7646 0xa0ff 0xfe91 0x67b1)\n</code></pre>\n\n<p><strong>Encode</strong></p>\n\n<pre><code>\u03bb&gt; encode (ipv4 127 0 0 1)\n\"127.0.0.1\"\n\u03bb&gt; encode (ipv6 0x2a02 0x2450 0xdd1f 0x0000 0x7646 0xa0ff 0xfe91 0x67b1)\n\"2a02:2450:dd1f::7646:a0ff:fe91:67b1\n</code></pre>\n\n<p>The <a href=\"https://hackage.haskell.org/package/ip-1.5.1/docs/Net-IPv4.html#g:4\" rel=\"nofollow noreferrer\">package</a> provides <a href=\"https://hackage.haskell.org/package/attoparsec-0.13.2.2/docs/Data-Attoparsec-Text.html#t:Parser\" rel=\"nofollow noreferrer\">Attoparsec</a> integration.</p>\n"}], "owner": {"reputation": 1281, "user_id": 6647585, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/cac5dd1f2f2645dcc1dbf1165fed77c6?s=128&d=identicon&r=PG&f=1", "display_name": "Vlam", "link": "https://stackoverflow.com/users/6647585/vlam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 777, "favorite_count": 0, "accepted_answer_id": 39791678, "answer_count": 3, "score": 2, "last_activity_date": 1565189405, "creation_date": 1475222944, "question_id": 39786657, "link": "https://stackoverflow.com/questions/39786657/how-to-parse-ip-address-into-ip-number-in-haskell", "title": "How to parse IP address into IP number in Haskell?", "body": "<p>What would be the easiest way to take a string containing either IPv4 or IPv6 address and get the IP number?</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 12213, "user_id": 671703, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/96ac349a9c65277e304401ea92a62ff4?s=128&d=identicon&r=PG", "display_name": "pat", "link": "https://stackoverflow.com/users/671703/pat"}, "edited": false, "score": 0, "creation_date": 1475223064, "post_id": 39784676, "comment_id": 66866965, "body": "In what universe does <code>(1+9x)+(9+3x) == (10+12x+7x^2)</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475220466, "post_id": 39784716, "comment_id": 66865658, "body": "Of course <code>xs == replicate (length xs) 0</code> should never actually be used. <code>all (==0) xs</code> is the correct way to do this."}, {"owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "reply_to_user": {"reputation": 100892, "user_id": 745903, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/50933f6638836741e620669b3940410e?s=128&d=identicon&r=PG", "display_name": "leftaroundabout", "link": "https://stackoverflow.com/users/745903/leftaroundabout"}, "edited": false, "score": 0, "creation_date": 1475221452, "post_id": 39784716, "comment_id": 66866142, "body": "@leftaroundabout Thanks, it&#39;s much more neat"}], "tags": [], "owner": {"reputation": 3967, "user_id": 3853711, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/SwXly.png?s=128&g=1", "display_name": "Rahn", "link": "https://stackoverflow.com/users/3853711/rahn"}, "is_accepted": true, "score": 4, "last_activity_date": 1475221419, "last_edit_date": 1475221419, "creation_date": 1475215461, "answer_id": 39784716, "question_id": 39784676, "link": "https://stackoverflow.com/questions/39784676/implement-polynomial-multiplication-in-haskell/39784716#39784716", "title": "implement polynomial multiplication in Haskell", "body": "<pre><code>mul []       _  = [0]\nmul (x : xs) ys = add (map (*x) ys) (mul (0 : xs) ys)\n</code></pre>\n\n<p>Let's find out what happend when you evaluate <code>mul [1] [1,2,3]</code>:</p>\n\n<pre><code>mul (1:[]) [1,2,3]\n-&gt; add (map (*1) [1,2,3]) (mul (0:[]) [1,2,3])\n-&gt; add [1,2,3] (mul [0] [1,2,3])\n-&gt; add [1,2,3] (mul (0:[]) [1,2,3])\n-&gt; add [1,2,3] (add (map (*0) [1,2,3]) (mul (0:[]) [1,2,3]))\n-&gt; add [1,2,3] (add [0,0,0] (mul [0] [1,2,3]))\n</code></pre>\n\n<p>Every time you take out the <code>head</code>, another <code>head</code>(<code>0</code>) is appended to it, thus, Length of your first list (1st argument of <code>mul</code>) never change.</p>\n\n<p>So there's no way to reach an exit condition (<code>first_list == []</code>).</p>\n\n<p>To fix it, append <code>0</code> outside of <code>mul</code>:</p>\n\n<pre><code>mul []       _  = [0]\nmul (x : xs) ys = add (map (*x) ys) (0 : (mul (xs) ys))\n</code></pre>\n\n<p>or perhaps this is more close to your intuition:</p>\n\n<pre><code>mul xs ys = if all (==0) xs\n                then [0]\n                else add (map (*(head xs)) ys) (0 : (mul (tail xs) ys))\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 6902513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/508b2de59ed3c10d3695bb1c070c1065?s=128&d=identicon&r=PG&f=1", "display_name": "androidCrazy", "link": "https://stackoverflow.com/users/6902513/androidcrazy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1637, "favorite_count": 1, "accepted_answer_id": 39784716, "answer_count": 1, "score": 0, "last_activity_date": 1475223739, "creation_date": 1475215204, "last_edit_date": 1475223739, "question_id": 39784676, "link": "https://stackoverflow.com/questions/39784676/implement-polynomial-multiplication-in-haskell", "title": "implement polynomial multiplication in Haskell", "body": "<p>I'm defining some functions for polynomial arithmetic</p>\n\n<p>To make it easier for debugging, I make polynomial list:</p>\n\n<pre><code>[5,3,7] -&gt; 5 + 3*x + 7*x^2\n</code></pre>\n\n<p>Here I get function <code>add</code> that already works:</p>\n\n<pre><code>add [1,9,7] [9,3] == [10,12,7]\n</code></pre>\n\n<p>But I have trouble with <code>mul</code>:</p>\n\n<pre><code>mul []       _ = [0]\nmul (x : xs) ys = add (map (*x) ys) (mul (0 : xs) ys)\n</code></pre>\n\n<p>As I suppose:</p>\n\n<pre><code>[4,5,6] * [1,2,3] = 4*[1,2,3] + [0,4,6]*[1,2,3]\n</code></pre>\n\n<p>It takes forever to evaluate <code>mul [1] [1,2,3]</code>, I can't find out what's wrong with it.</p>\n"}, {"tags": ["haskell"], "comments": [{"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 1, "creation_date": 1475205148, "post_id": 39783017, "comment_id": 66860101, "body": "Can you link to the description of it as unary?"}, {"owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "reply_to_user": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475205325, "post_id": 39783017, "comment_id": 66860135, "body": "<a href=\"http://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:const\" rel=\"nofollow noreferrer\">hackage.haskell.org/package/base-4.9.0.0/docs/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "is_accepted": true, "score": 10, "last_activity_date": 1475205470, "creation_date": 1475205470, "answer_id": 39783118, "question_id": 39783017, "link": "https://stackoverflow.com/questions/39783017/const-a-unary-function/39783118#39783118", "title": "Const a unary function", "body": "<p>The relevant statement from the Prelude is actually</p>\n\n<blockquote>\n  <p><code>const x</code> is a unary function which evaluates to x for all inputs.</p>\n</blockquote>\n\n<p>Note that it says <code>const x</code>, rather than <code>const</code>, is a unary function.</p>\n"}], "owner": {"reputation": 831, "user_id": 2198297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1c9129d47811254fac68d8561c9a50c?s=128&d=identicon&r=PG", "display_name": "andro", "link": "https://stackoverflow.com/users/2198297/andro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 39783118, "answer_count": 1, "score": 0, "last_activity_date": 1475205470, "creation_date": 1475204742, "question_id": 39783017, "link": "https://stackoverflow.com/questions/39783017/const-a-unary-function", "title": "Const a unary function", "body": "<p>The Prelude states that const is a unary function. The type signature is</p>\n\n<pre><code>const :: a -&gt; b -&gt; a\n</code></pre>\n\n<p>A unary function takes one argument. Yet the const function seems to take two arguments and discard the second, which would make it a binary function. What is going on here? I suppose you can bracket the type as</p>\n\n<pre><code>a -&gt; (b -&gt; a)\n</code></pre>\n\n<p>but I am very unclear about the actual usage of const. Why is const described explicitly as unary?</p>\n"}, {"tags": ["list", "haskell", "merge", "pattern-matching", "currying"], "comments": [{"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1475199261, "post_id": 39782352, "comment_id": 66858817, "body": "How are you using this function and what is the actual error you get?"}, {"owner": {"reputation": 45, "user_id": 6553519, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/90875031c28fdf180188e36d77708617?s=128&d=identicon&r=PG&f=1", "display_name": "WalterC", "link": "https://stackoverflow.com/users/6553519/walterc"}, "reply_to_user": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 0, "creation_date": 1475199452, "post_id": 39782352, "comment_id": 66858865, "body": "@ReinHenrichs How am I using it? Just as it is I guess? Like make two lists and see if they weave together correctly, I&#39;m not really using this in anything else but the tester file which is pretty much just take two lists and see if it weaves correctly. The error was &quot;differing number of arguements&quot;"}, {"owner": {"reputation": 126897, "user_id": 791604, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/ce991df7a056248d5e4f6fc3659ba733?s=128&d=identicon&r=PG", "display_name": "Daniel Wagner", "link": "https://stackoverflow.com/users/791604/daniel-wagner"}, "edited": false, "score": 0, "creation_date": 1475204273, "post_id": 39782352, "comment_id": 66859907, "body": "A cute trick you might like: if you put the interesting case first, the last case can just concatenate the arguments. <code>interleave (x:xs) (y:ys) = x:y:interleave xs ys; interleaves xs ys = xs ++ ys</code>. It has a slight cost when <code>ys</code> is <code>[]</code> compared to your implementation, but it sure is pretty!"}], "answers": [{"comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 45, "user_id": 6553519, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/90875031c28fdf180188e36d77708617?s=128&d=identicon&r=PG&f=1", "display_name": "WalterC", "link": "https://stackoverflow.com/users/6553519/walterc"}, "edited": false, "score": 1, "creation_date": 1475201182, "post_id": 39782382, "comment_id": 66859273, "body": "@WalterC Alternatively you can modify all cases to take two parameters. Of course, this requires a slightly different type signature if you are giving it explicitly."}], "tags": [], "owner": {"reputation": 25144, "user_id": 477476, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Qf4TT.png?s=128&g=1", "display_name": "Cactus", "link": "https://stackoverflow.com/users/477476/cactus"}, "is_accepted": true, "score": 4, "last_activity_date": 1475200424, "last_edit_date": 1475200424, "creation_date": 1475199294, "answer_id": 39782382, "question_id": 39782352, "link": "https://stackoverflow.com/questions/39782352/weaving-lists-in-haskell/39782382#39782382", "title": "weaving lists in haskell", "body": "<p>The problem is that your type signature, and your three cases, are all defining a function of one parameter (of type <code>([a], [a])</code>), but then your fourth case is trying to define a function of two parameters (the first one being <code>x:xs</code>, the second <code>y:ys</code>).</p>\n\n<p>The fix is to change the fourth case to also be over a single pair parameter:</p>\n\n<pre><code>interleave (x:xs, y:ys) = x : y : interleave (xs, ys)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": false, "score": 5, "last_activity_date": 1475539718, "last_edit_date": 1475539718, "creation_date": 1475201477, "answer_id": 39782624, "question_id": 39782352, "link": "https://stackoverflow.com/questions/39782352/weaving-lists-in-haskell/39782624#39782624", "title": "weaving lists in haskell", "body": "<p>Unless you have a requirement to take only a single parameter, I think it would make more sense to change all cases to take two parameters:</p>\n\n<pre><code>interleave [] [] = []\ninterleave xs [] = xs\ninterleave [] ys = ys\ninterleave (x:xs) (y:ys) = x : y : interleave xs ys\n</code></pre>\n\n<p>Note that in the case <code>interleave xs []</code>, you originally returned <code>[xs]</code>. This is a list containing the list named <code>xs</code>. Instead you should return <code>xs</code> directly. Simlarly for the case involving <code>ys</code>.</p>\n"}], "owner": {"reputation": 45, "user_id": 6553519, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/90875031c28fdf180188e36d77708617?s=128&d=identicon&r=PG&f=1", "display_name": "WalterC", "link": "https://stackoverflow.com/users/6553519/walterc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 39782382, "answer_count": 2, "score": 1, "last_activity_date": 1475539718, "creation_date": 1475198976, "last_edit_date": 1475199320, "question_id": 39782352, "link": "https://stackoverflow.com/questions/39782352/weaving-lists-in-haskell", "title": "weaving lists in haskell", "body": "<p>I'm trying to create a function to weave two lists together for example\n<code>[1,3,5]</code> and <code>[2,4]</code> -> <code>[1,2,3,4,5]</code></p>\n\n<p>I get the basic principle of what I have to do and check for but I'm running into the problem that the required type </p>\n\n<pre><code>interleave :: ([a],[a]) -&gt; [a] \n</code></pre>\n\n<p>is giving errors about different number of arguments. This is the version that's given me the least amount of errors so far</p>\n\n<pre><code>interleave ([],[]) = []\ninterleave (xs,[]) = [xs]\ninterleave ([],ys) = [ys]\ninterleave (x:xs) (y:ys) = x : y : interleave xs ys\n</code></pre>\n\n<p>I've tried messing with the arguments and outputs a few times but I'm new to haskell syntax so I don't really see where I'm going wrong</p>\n\n<p>PART 2: Also I have a testing file to makes sure the functions are correct so if I'm still having trouble after this with that file (as I was getting similar input/output mismatches there which led me to change to what I have now) I'll probably post that code too for help</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 62421, "user_id": 216164, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/786f224adbe0784cdf7d0f15476061fe?s=128&d=identicon&r=PG", "display_name": "Thomas M. DuBuisson", "link": "https://stackoverflow.com/users/216164/thomas-m-dubuisson"}, "edited": false, "score": 0, "creation_date": 1475179086, "post_id": 39778920, "comment_id": 66852215, "body": "The second example doesn&#39;t do what you think - you need indentation on <code>fmap</code> to make it part of the instance.  The first example you omitted the error which tells you the issue (n.b. It&#39;s an issue of kinds, functor instances are of kind <code>*-&gt;*</code>)."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1475201567, "post_id": 39778920, "comment_id": 66859330, "body": "<code>Yet this won&#39;t compile?</code> What is the compiler error?"}], "answers": [{"comments": [{"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1475179932, "post_id": 39779020, "comment_id": 66852628, "body": "So is there anyway of applying a functor to my first example?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1475180222, "post_id": 39779020, "comment_id": 66852768, "body": "See my last update: what function do you envision being useful to apply to a user&#39;s height, weight, <i>and</i> age?"}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1475181986, "post_id": 39779020, "comment_id": 66853607, "body": "Thanks - its not really a case of &#39;useful&#39;, more of trying to get to grips with what functions/applicative functors can do and where they can be useful..."}], "tags": [], "owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "is_accepted": true, "score": 7, "last_activity_date": 1475180552, "last_edit_date": 1475180552, "creation_date": 1475179340, "answer_id": 39779020, "question_id": 39778920, "link": "https://stackoverflow.com/questions/39778920/functor-declaration-with-multiple-types/39779020#39779020", "title": "Functor declaration with multiple types?", "body": "<p>Each type and type constructor has a kind. Something simple like <code>Int</code> has kind <code>*</code>. Your single-argument type constructor <code>Users</code> has kind <code>* -&gt; *</code>; it takes one type and returns a new one. Your first example of <code>Users</code> has kind <code>* -&gt; * -&gt; * -&gt; *</code>; it takes <em>three</em> types and returns a new one.</p>\n\n<p><code>Functor</code> only works with type constructors of kind <code>* -&gt; *</code>. This allows you to define a <code>Functor</code> instance for your second <code>Users</code> type constructor, but not your first one.</p>\n\n<p>Think about your first try: the data constructor <code>Users</code> takes three arguments, but your definition of <code>fmap</code> attempts to call it with just one, the return value of f. You could make <code>Users</code> a functor as long as you are willing to make all three fields the same type:</p>\n\n<pre><code>data Users a = Users a a a\n\ninstance Functor Users where\n    fmap f (Users a b c) = Users (f a) (f b) (f c)\n</code></pre>\n\n<p>In theory, you could define a class <code>Trifunctor</code> (there is a <code>Bifunctor</code> class available):</p>\n\n<pre><code>class Trifunctor f where\n    trimap :: (a1 -&gt; b1) -&gt; (a2 -&gt; b2) -&gt; (a3 -&gt; b3) -&gt; f a1 a2 a3 -&gt; f b1 b2 b3\n\ndata Users a b c = Users a b c\n\ninstance Trifunctor Users where\n    trimap f g h (Users a b c) = Users (f a) (g b) (h c)\n</code></pre>\n\n<p>but it's debatable how useful this would be. <code>Functor</code> is useful for general purpose containers, because they have a wide range of uses. <code>Users</code>, on the other hand, seems pretty specific. You generally don't need the flexibility you are defining it with; <code>data User = User Int Int Int</code> seems like it would work fine, and there is no need to map a function over this: how often to you need the same function to modify height, weight, and age in the same way?</p>\n"}, {"tags": [], "owner": {"reputation": 885, "user_id": 1704462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6664ce416d2ff42b5e5ac4add93a1b6d?s=128&d=identicon&r=PG&f=1", "display_name": "pangiole", "link": "https://stackoverflow.com/users/1704462/pangiole"}, "is_accepted": false, "score": 1, "last_activity_date": 1531781204, "last_edit_date": 1531781204, "creation_date": 1531780889, "answer_id": 51370980, "question_id": 39778920, "link": "https://stackoverflow.com/questions/39778920/functor-declaration-with-multiple-types/51370980#51370980", "title": "Functor declaration with multiple types?", "body": "<p>Instances of the <code>Functor</code> class can be defined for types of first-order kind only, which are those of kind <code>* -&gt; *</code></p>\n\n<p>If you try querying GHCI as follows</p>\n\n<pre><code>ghci&gt; :kind Users\nUsers :: * -&gt; * -&gt; * -&gt; *\n</code></pre>\n\n<p>you will understand that you custom type is of much higher kindness, hence the compiler error.</p>\n\n<p>If you still wish to provide an instance of the <code>Functor</code> class for it, despite how useful that could be, do as follows</p>\n\n<pre><code>ghci&gt; :{\n    | -- define custom type having a too high kind\n    | data User a b c = User a b c deriving Show\n    |\n    | -- provide functor instance by reducing its type kindness \n    | instance Functor (User a b) where\n    |   fmap f (User x y z) = User x y (f z)\n    | :}\n</code></pre>\n\n<p>The trick is to <strong>partially</strong> apply the <code>User</code> type constructor so to produce a type having kindness reduced to the expected one. Then, define your <code>fmap</code> by pattern matching the whole <code>User</code> value constructor and apply the function <code>f</code> to the last input value.</p>\n\n<p>Example of usage is:</p>\n\n<pre><code>ghci&gt; u1 = User 1 168 58.9\nghci&gt; fmap (+5) u1\nUser 1 168 63.9\n</code></pre>\n\n<p>That's roughly how the <code>Either</code>, tuple <code>(,)</code> and function <code>(-&gt;)</code> types, which are also higher-order kinded types in Haskell prelude, are able to provide instances of the <code>Functor</code> class too.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1037, "favorite_count": 1, "accepted_answer_id": 39779020, "answer_count": 2, "score": 1, "last_activity_date": 1531781204, "creation_date": 1475178939, "question_id": 39778920, "link": "https://stackoverflow.com/questions/39778920/functor-declaration-with-multiple-types", "title": "Functor declaration with multiple types?", "body": "<p>I've got the following data type:</p>\n\n<pre><code>data Users id height weight = User id height weight\n\ninstance Functor Users where\nfmap f (User id height weight) = User(f id height weight)\n</code></pre>\n\n<p>Yet this won't compile? </p>\n\n<p>It works fine when I use a type with a single parameter, such as:</p>\n\n<pre><code>data Users id = User id\ninstance Functor Users where\nfmap f (User id) = User (f id)\n</code></pre>\n\n<p>Why isn't my first example working?</p>\n"}, {"tags": ["haskell", "haskell-pipes"], "owner": {"reputation": 3032, "user_id": 1405768, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/WnFhY.jpg?s=128&g=1", "display_name": "Andrew Thaddeus Martin", "link": "https://stackoverflow.com/users/1405768/andrew-thaddeus-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1475160608, "creation_date": 1475160608, "last_edit_date": 1495541707, "question_id": 39773551, "link": "https://stackoverflow.com/questions/39773551/pipes-choice-without-pattern-matching", "title": "Pipes choice without pattern matching", "body": "<p>This is closely related to Gabriel's response to <a href=\"https://stackoverflow.com/questions/19758744/haskell-splitting-pipes-broadcast-without-using-spawn\">another question</a>. I have written a function that provides something like the <code>|||</code> function from <code>ArrowChoice</code> but for a <code>Proxy</code> (from the <code>pipes</code> library). It pattern matches and has five mutually recursive functions. I'd like to find an alternative implementation that uses the function from <code>Pipes.Core</code> instead of pattern matching.</p>\n\n<p>I first tried adapted the implementation of <code>left</code> in the other answer. It looks like this:</p>\n\n<pre><code>newtype Edge m r a b = Edge { unEdge :: a -&gt; Pipe a b m r }\n\ninstance (Monad m) =&gt; ArrowChoice (Edge m r) where\n  left (Edge k) = Edge (bef &gt;=&gt; (up \\&gt;\\ (k /&gt;/ dn)))\n    where\n      bef x = case x of\n          Left b -&gt; return b\n          Right d -&gt; do\n              _ &lt;- respond (Right d)\n              x2 &lt;- request ()\n              bef x2\n      up () = do\n          x &lt;- request ()\n          bef x\n      dn c = respond (Left c)\n</code></pre>\n\n<p>However, this implementation relies on upstream out and downstream in being the same, and I could not see a way to generalize it further. The closest I could get was:</p>\n\n<pre><code>proxyLeft :: Monad m\n  =&gt; (a -&gt; Pipes.Proxy y a y b m r)\n  -&gt; Either a x\n  -&gt; Pipes.Proxy y (Either a x) y (Either b x) m r\nproxyLeft k = bef &gt;=&gt; (up \\&gt;\\ (k /&gt;/ dn))\n  where\n  bef x = case x of\n    Left b -&gt; return b\n    Right d -&gt; do\n      a &lt;- respond (Right d)\n      x2 &lt;- request a\n      bef x2\n  up a = do\n    x &lt;- request a\n    bef x\n  dn c = respond (Left c)\n</code></pre>\n\n<p>The code snippet for my variant of <code>|||</code> is pretty long, and I am only providing it as evidence that this can be done in some fashion. The function is named <code>downstreamOr</code>. All of the other functions are just mutually recursive helper functions:</p>\n\n<pre><code>downstreamOr ::\n     Monad m\n  =&gt; (b' -&gt; Pipes.Proxy a' a b' b m r)\n  -&gt; (c' -&gt; Pipes.Proxy a' a c' b m r)\n  -&gt; Either b' c'\n  -&gt; Pipes.Proxy a' a (Either b' c') b m r\ndownstreamOr f g e = case e of\n  Left b' -&gt; case f b' of\n    Pipes.Request a' k -&gt; Pipes.Request a' (downstreamOrLeft k g)\n    Pipes.Respond b k -&gt; Pipes.Respond b (downstreamOr k g)\n    Pipes.M m -&gt; Pipes.M $ m &gt;&gt;= \\p -&gt; return $ downstreamLeftM p g\n    Pipes.Pure r -&gt; Pipes.Pure r\n  Right c' -&gt; case g c' of\n    Pipes.Request a' k -&gt; Pipes.Request a' (downstreamOrRight f k)\n    Pipes.Respond b k -&gt; Pipes.Respond b (downstreamOr f k)\n    Pipes.M m -&gt; Pipes.M $ m &gt;&gt;= \\p -&gt; return $ downstreamRightM f p\n    Pipes.Pure r -&gt; Pipes.Pure r\n\ndownstreamOrLeft ::\n     Monad m\n  =&gt; (a -&gt; Pipes.Proxy a' a b' b m r)\n  -&gt; (c' -&gt; Pipes.Proxy a' a c' b m r)\n  -&gt; a\n  -&gt; Pipes.Proxy a' a (Either b' c') b m r\ndownstreamOrLeft f g a = case f a of\n  Pipes.Request a' k -&gt; Pipes.Request a' (downstreamOrLeft k g)\n  Pipes.Respond b k -&gt; Pipes.Respond b (downstreamOr k g)\n  Pipes.M m -&gt; Pipes.M $ m &gt;&gt;= \\p -&gt; return $ downstreamLeftM p g\n  Pipes.Pure r -&gt; Pipes.Pure r\n\ndownstreamOrRight ::\n     Monad m\n  =&gt; (b' -&gt; Pipes.Proxy a' a b' b m r)\n  -&gt; (a -&gt; Pipes.Proxy a' a c' b m r)\n  -&gt; a\n  -&gt; Pipes.Proxy a' a (Either b' c') b m r\ndownstreamOrRight f g a = case g a of\n  Pipes.Request a' k -&gt; Pipes.Request a' (downstreamOrRight f k)\n  Pipes.Respond b k -&gt; Pipes.Respond b (downstreamOr f k)\n  Pipes.M m -&gt; Pipes.M $ m &gt;&gt;= \\p -&gt; return $ downstreamRightM f p\n  Pipes.Pure r -&gt; Pipes.Pure r\n\ndownstreamLeftM ::\n     Monad m\n  =&gt; Pipes.Proxy a' a b' b m r\n  -&gt; (c' -&gt; Pipes.Proxy a' a c' b m r)\n  -&gt; Pipes.Proxy a' a (Either b' c') b m r\ndownstreamLeftM p g = case p of\n  Pipes.Pure r -&gt; Pipes.Pure r\n  Pipes.Request a' k -&gt; Pipes.Request a' (downstreamOrLeft k g)\n  Pipes.Respond b k -&gt; Pipes.Respond b (downstreamOr k g)\n  Pipes.M m -&gt; Pipes.M $ m &gt;&gt;= \\p -&gt; return $ downstreamLeftM p g\n\ndownstreamRightM ::\n     Monad m\n  =&gt; (b' -&gt; Pipes.Proxy a' a b' b m r)\n  -&gt; Pipes.Proxy a' a c' b m r\n  -&gt; Pipes.Proxy a' a (Either b' c') b m r\ndownstreamRightM f p = case p of\n  Pipes.Pure r -&gt; Pipes.Pure r\n  Pipes.Respond a' k -&gt; Pipes.Respond a' (downstreamOr f k)\n  Pipes.Request a' k -&gt; Pipes.Request a' (downstreamOrRight f k)\n  Pipes.M m -&gt; Pipes.M $ m &gt;&gt;= \\p -&gt; return $ downstreamRightM f p\n</code></pre>\n\n<p>It would be helpful to see how either of these can be implemented without pattern matching. Thanks, and let me know if I can clarify anything.</p>\n"}, {"tags": ["haskell", "ghc"], "comments": [{"owner": {"reputation": 29444, "user_id": 3072788, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/220a45c2fcff7e7358d144551b116205?s=128&d=identicon&r=PG&f=1", "display_name": "Alec", "link": "https://stackoverflow.com/users/3072788/alec"}, "edited": false, "score": 0, "creation_date": 1475173722, "post_id": 39772531, "comment_id": 66849305, "body": "The weird thing is that it <i>is</i> partly unifying the type of <code>foo&#39;</code> since the error message tells us it has already figured out <code>b = Int</code>"}, {"owner": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 1, "creation_date": 1475180729, "post_id": 39772531, "comment_id": 66853015, "body": "The type of <code>foo&#39;</code> is completely ambiguous, which means you always have to use a type application to specify the type variable. Inference can&#39;t figure it out because the <code>Foo a</code> in <code>foo&#39;</code> can&#39;t ever unify with anything, as it doesn&#39;t appear in the type, only the context."}, {"owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "reply_to_user": {"reputation": 13807, "user_id": 2407038, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/538f6f4a9aa43841841de7d8e8b169fc?s=128&d=identicon&r=PG&f=1", "display_name": "user2407038", "link": "https://stackoverflow.com/users/2407038/user2407038"}, "edited": false, "score": 0, "creation_date": 1475191467, "post_id": 39772531, "comment_id": 66856986, "body": "@user2407038 Does that observation inspire a solution?"}, {"owner": {"reputation": 7792, "user_id": 242189, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/48a18a00706b9c7206ef4092b6e68a41?s=128&d=identicon&r=PG", "display_name": "nicolas", "link": "https://stackoverflow.com/users/242189/nicolas"}, "edited": false, "score": 0, "creation_date": 1500462707, "post_id": 39772531, "comment_id": 77344636, "body": "could you rewrite the example without the Tagged library ?"}], "owner": {"reputation": 21417, "user_id": 925978, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/06e4467a5bd1538a92cefb20db07897a?s=128&d=identicon&r=PG&f=1", "display_name": "crockeea", "link": "https://stackoverflow.com/users/925978/crockeea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 460, "favorite_count": 0, "answer_count": 0, "score": 9, "last_activity_date": 1475157802, "creation_date": 1475157802, "question_id": 39772531, "link": "https://stackoverflow.com/questions/39772531/type-application-with-ambiguous-types", "title": "Type application with ambiguous types", "body": "<p>I recently discovered <code>-XTypeApplications</code>, which allows me to write abbreviate my code. Consider the following:</p>\n\n<pre><code>{-# LANGUAGE AllowAmbiguousTypes, DataKinds, KindSignatures, RankNTypes, \n             ScopedTypeVariables, TypeApplications #-}\n\nimport Data.Tagged\nimport Data.Proxy\n\nclass Foo (a :: Bool) where\n  foo :: Tagged a Int\n\ninstance Foo 'True where\n  foo = 3\n\ninstance Foo 'False where\n  foo = 4\n</code></pre>\n\n<p>instead of writing <code>proxy foo (Proxy::Proxy 'True)</code>, I can now write <code>untag $ foo @'True</code>, which saves me a lot of <code>Proxy</code> boilerplate. That's okay, but we can do better with ambiguous types:</p>\n\n<pre><code>foo' :: forall (a :: Bool) . (Foo a) =&gt; Int\nfoo' = untag $ foo @a\n</code></pre>\n\n<p><em>Now</em> I can write <code>foo' @'True</code>! Note that although the type was ambiguous prior to <code>-XTypeApplications</code>, it is no longer since I can specify the type <code>a</code>. I think this is pretty great, but others might not. So I was hoping to introduce a wrapper </p>\n\n<pre><code>wrapAmbiguous :: forall (a :: Bool) b . (Foo a) =&gt; (forall (t :: Bool) . (Foo t) =&gt; b) -&gt; Tagged a b\nwrapAmbiguous f = Tagged $ f @a\n</code></pre>\n\n<p>(even more general in my actual use case, but this gets the point across), so that users don't need <code>-XTypeApplications</code>. However, when I try to use <code>wrapAmbiguous</code> like <code>proxy (wrapAmbiguous foo') (Proxy::Proxy 'True)</code>, I get the error</p>\n\n<pre><code>\u2022 Could not deduce (Foo a0) arising from a use of \u2018foo'\u2019\n  from the context: Foo t\n    bound by a type expected by the context:\n               Foo t =&gt; Int\n    at Foo.hs:26:18-35\n  The type variable \u2018a0\u2019 is ambiguous\n  These potential instances exist:\n    instance Foo 'False -- Defined at Foo.hs:12:10\n    instance Foo 'True -- Defined at Foo.hs:9:10\n\u2022 In the first argument of \u2018wrapAmbiguous\u2019, namely \u2018foo'\u2019\n  In the first argument of \u2018proxy\u2019, namely \u2018(wrapAmbiguous foo')\u2019\n  In the second argument of \u2018($)\u2019, namely\n    \u2018proxy (wrapAmbiguous foo') (Proxy :: Proxy True)\u2019\n</code></pre>\n\n<p>It seems to me that this should be legal, but GHC apparently can't unify the type of <code>foo'</code> with <code>forall (t :: Bool) (Foo t) =&gt; b</code>. Is there some way to make my wrapper work?</p>\n"}, {"tags": ["haskell", "functor"], "comments": [{"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 3, "creation_date": 1475154168, "post_id": 39770191, "comment_id": 66836521, "body": "If you do <code>newtype Mu f a = InF { outF :: f (Mu f a) }</code>, then <code>instance Functor f =&gt; Functor (Mu f)</code> is possible. This is just <code>Free</code> without the <code>Pure</code> constructor, though."}, {"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 0, "creation_date": 1475159618, "post_id": 39770191, "comment_id": 66840650, "body": "Check <a href=\"https://github.com/ekmett/recursion-schemes/pull/23\" rel=\"nofollow noreferrer\">github.com/ekmett/recursion-schemes/pull/23</a> for musings around this very problem."}, {"owner": {"reputation": 15620, "user_id": 596361, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b7219254970581e53d3b2b162f7f50f8?s=128&d=identicon&r=PG", "display_name": "Mirzhan Irkegulov", "link": "https://stackoverflow.com/users/596361/mirzhan-irkegulov"}, "edited": false, "score": 0, "creation_date": 1504429820, "post_id": 39770191, "comment_id": 79003142, "body": "For interested, this is an exercise from Chapter 16. Functors of <i>Haskell Programming from First Principles</i>."}], "answers": [{"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475152974, "post_id": 39770307, "comment_id": 66835629, "body": "I&#39;d add the explicit kind signature <code>Mu :: (* -&gt; *) -&gt; *</code> to stress that it is not the one required by <code>Functor</code> (<code>* -&gt; *</code> as mentioned above), so we get a kind error."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 7, "last_activity_date": 1475152969, "last_edit_date": 1475152969, "creation_date": 1475151957, "answer_id": 39770307, "question_id": 39770191, "link": "https://stackoverflow.com/questions/39770191/functor-instance-for-newtype-mu-f-inf-outf-f-mu-f/39770307#39770307", "title": "Functor instance for (newtype Mu f = InF {outF :: f (Mu f)})", "body": "<p>You can't. In order to define an instance <code>Functor c</code> for some <code>c</code>, <code>c</code> must be of the kind <code>* -&gt; *</code>. So in your case, <code>Mu</code> should have been of that kind, which means that its argument <code>f</code> must have been of the kind <code>*</code>. But clearly this is not the case, as you are applying <code>f</code> to something else (to <code>Mu f</code>).</p>\n\n<p>To put it more simply, if <code>Mu</code> was a functor, you could use <code>fmap</code> on values of type <code>Mu f</code> for any <code>f</code>. But this would have allowed you to change the type parameter to any other type, e.g., by applying the function <code>fmap (const (0 :: Int))</code> to any <code>Mu f</code> value, it would have to return a <code>Mu Int</code> value. But you can not form such a value because the <code>outF</code> of that value would have had type <code>Int (Mu Int)</code> which does not make sense.</p>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 1523776, "user_type": "moderator", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b3e0b5c8e42a8c38009ef2d969f8dabb?s=128&d=identicon&r=PG", "display_name": "Benjamin Hodgson", "link": "https://stackoverflow.com/users/1523776/benjamin-hodgson"}, "edited": false, "score": 1, "creation_date": 1475252388, "post_id": 39772347, "comment_id": 66884615, "body": "IOW <code>Mu</code> is a functor from the category of type constructors <code>* -&gt; *</code> (whose morphisms are natural transformations <code>forall x. f x -&gt; g x</code>) to the category of Haskell types <code>*</code> and functions"}], "tags": [], "owner": {"reputation": 23816, "user_id": 572606, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c20a126ad0dce40e8fc4a43456107919?s=128&d=identicon&r=PG", "display_name": "shang", "link": "https://stackoverflow.com/users/572606/shang"}, "is_accepted": false, "score": 4, "last_activity_date": 1475157374, "creation_date": 1475157374, "answer_id": 39772347, "question_id": 39770191, "link": "https://stackoverflow.com/questions/39770191/functor-instance-for-newtype-mu-f-inf-outf-f-mu-f/39772347#39772347", "title": "Functor instance for (newtype Mu f = InF {outF :: f (Mu f)})", "body": "<p>redneb gives a good explanation of why <code>Mu</code> cannot be a regular <code>Functor</code> but you can implement a sort of functor-like mapping operation for <code>Mu</code> as</p>\n\n<pre><code>{-# LANGUAGE RankNTypes #-}\n\nnewtype Mu f = InF {outF :: f (Mu f)}\n\nmumap :: Functor f =&gt; (forall a. f a -&gt; g a) -&gt; Mu f -&gt; Mu g\nmumap f (InF m) = InF $ f $ fmap (mumap f) m\n</code></pre>\n\n<p>Though I'm not sure how useful it would be in your case. :)</p>\n"}, {"tags": [], "owner": {"reputation": 25181, "user_id": 23845, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/434aee9ad675384a9e745c7217ac4abe?s=128&d=identicon&r=PG", "display_name": "Edward Z. Yang", "link": "https://stackoverflow.com/users/23845/edward-z-yang"}, "is_accepted": false, "score": 0, "last_activity_date": 1517887122, "creation_date": 1517887122, "answer_id": 48634951, "question_id": 39770191, "link": "https://stackoverflow.com/questions/39770191/functor-instance-for-newtype-mu-f-inf-outf-f-mu-f/48634951#48634951", "title": "Functor instance for (newtype Mu f = InF {outF :: f (Mu f)})", "body": "<p>A slight re-phrasing of <code>Mu</code>, different from user2297560's, is sufficient to admit a Functor instance for Mu:</p>\n\n<pre><code>-- Natural transformations\ntype g ~&gt; h = forall a. g a -&gt; h a\n\nclass HFunctor f where\n  ffmap :: Functor g =&gt; (a -&gt; b) -&gt; f g a -&gt; f g b\n  hfmap :: (Functor g, Functor h) =&gt; (g ~&gt; h) -&gt; (f g ~&gt; f h)\n\nnewtype Mu f a = In { unIn :: f (Mu f) a }\n\ninstance HFunctor f =&gt; Functor (Mu f) where\n  fmap f (In r) = In (ffmap f r)\n</code></pre>\n\n<p>This formulation comes from Patricia and Neil's paper <a href=\"https://pdfs.semanticscholar.org/3cb7/d5c74497fc23d813de4d121c0796eb82962b.pdf\" rel=\"nofollow noreferrer\">Haskell Programming with Nested Types: A Principled Approach</a>.</p>\n"}], "owner": {"reputation": 409, "user_id": 1897830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4bb6f01afcee8d6fd59ccb93499732d6?s=128&d=identicon&r=PG", "display_name": "user1897830", "link": "https://stackoverflow.com/users/1897830/user1897830"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1517887122, "creation_date": 1475151641, "last_edit_date": 1475158443, "question_id": 39770191, "link": "https://stackoverflow.com/questions/39770191/functor-instance-for-newtype-mu-f-inf-outf-f-mu-f", "title": "Functor instance for (newtype Mu f = InF {outF :: f (Mu f)})", "body": "<p>This has me stumped. How do you write a Functor instance for <code>newtype Mu f = InF {outF :: f (Mu f)}</code></p>\n"}, {"tags": ["haskell", "functor"], "answers": [{"tags": [], "owner": {"reputation": 133611, "user_id": 152602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f370b4bd787fc68f9f62d9c6781cb79?s=128&d=identicon&r=PG", "display_name": "Lee", "link": "https://stackoverflow.com/users/152602/lee"}, "is_accepted": false, "score": 6, "last_activity_date": 1475146450, "creation_date": 1475146450, "answer_id": 39768333, "question_id": 39768269, "link": "https://stackoverflow.com/questions/39768269/fmap-over-a-list-of-custom-types/39768333#39768333", "title": "Fmap over a list of custom types?", "body": "<p>Lists are functors and you have an <code>[Outcome]</code> so you need to supply a function <code>Outcome -&gt; b</code>. It looks like you want to apply <code>(+1)</code> to each <code>Outcome</code> within the list so you need to use:</p>\n\n<pre><code>fmap (\\o -&gt; fmap (+1) o) myList\n</code></pre>\n\n<p>or</p>\n\n<pre><code>fmap (fmap (+1)) myList\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11487, "user_id": 1308058, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/2be2ab74793559ea1c1dbdf55ccdf90b?s=128&d=identicon&r=PG", "display_name": "phadej", "link": "https://stackoverflow.com/users/1308058/phadej"}, "edited": false, "score": 3, "creation_date": 1475159920, "post_id": 39768335, "comment_id": 66840839, "body": "Sometimes writing <code>(fmap . fmap) (+1) myList</code>, <code>fmap2 = fmap . fmap</code> is handy too."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 3, "creation_date": 1475176628, "post_id": 39768335, "comment_id": 66850912, "body": "Sometimes, I like to call it <code>&lt;$$&gt;</code>."}], "tags": [], "owner": {"reputation": 16405, "user_id": 6776093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heFeh.png?s=128&g=1", "display_name": "redneb", "link": "https://stackoverflow.com/users/6776093/redneb"}, "is_accepted": false, "score": 11, "last_activity_date": 1475146451, "creation_date": 1475146451, "answer_id": 39768335, "question_id": 39768269, "link": "https://stackoverflow.com/questions/39768269/fmap-over-a-list-of-custom-types/39768335#39768335", "title": "Fmap over a list of custom types?", "body": "<p>The problem is that you are trying to add 1 to each element of the list <code>myList</code> which has type <code>Outcome Integer</code>. Try this instead:</p>\n\n<pre><code>fmap (fmap (+1)) myList\n</code></pre>\n\n<p>or to make it more clear:</p>\n\n<pre><code>map (fmap (+1)) myList\n</code></pre>\n\n<p>So the outer <code>fmap</code> applies to the list and the inner one applies to the <code>Outcome</code> functor. So, to each element of the list, we apply the function <code>fmap (+1)</code>, which in turn applies the function <code>(+1)</code> to the value inside the <code>Outcome</code>.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1475146451, "creation_date": 1475146236, "question_id": 39768269, "link": "https://stackoverflow.com/questions/39768269/fmap-over-a-list-of-custom-types", "title": "Fmap over a list of custom types?", "body": "<p>The below code won't compile:</p>\n\n<pre><code>data Outcome a = Fail | Pass a deriving (Show, Eq, Ord, Functor)\n\nmyList = [Pass 33, Pass 12, Fail, Pass 45]\n\nmain = do\n   print $ fmap (+1) myList\n</code></pre>\n\n<p>I can't see why this doesn't work, as I've successfully applied the same approach to my binary tree of type 'data Tree a = Empty | Node a (Tree a) (Tree a)'?</p>\n"}, {"tags": ["haskell", "functional-programming"], "comments": [{"owner": {"reputation": 84731, "user_id": 510937, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/70b13a9ae1aae1ca1aa6ac8dab4643f2?s=128&d=identicon&r=PG", "display_name": "Bakuriu", "link": "https://stackoverflow.com/users/510937/bakuriu"}, "edited": false, "score": 4, "creation_date": 1475148685, "post_id": 39767984, "comment_id": 66832431, "body": "I don&#39;t think there is any way to avoid this... and this <i>is good</i>. Changing something from being pure to impure <b>is</b> a big deal, and having the code silently compile with such a change means that you have given up type safety almost completely..."}, {"owner": {"reputation": 45534, "user_id": 106104, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c88b9310b92a937108ec4336c2832f92?s=128&d=identicon&r=PG", "display_name": "user253751", "link": "https://stackoverflow.com/users/106104/user253751"}, "edited": false, "score": 1, "creation_date": 1475185250, "post_id": 39767984, "comment_id": 66855101, "body": "How about adding a random seed into the configuration?"}, {"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1475234961, "post_id": 39767984, "comment_id": 66873927, "body": "I wonder if this question might be a better fit for programmers.stackexchange.com, being as it is a question about software development practices."}, {"owner": {"reputation": 6198, "user_id": 839601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6db99aa846a8217f7e2aba6fa198e7c?s=128&d=identicon&r=PG", "display_name": "gnat", "link": "https://stackoverflow.com/users/839601/gnat"}, "reply_to_user": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 0, "creation_date": 1475238707, "post_id": 39767984, "comment_id": 66876139, "body": "@chepner when referring other sites, it is often helpful to point that <a href=\"http://meta.stackexchange.com/tags/cross-posting/info\">cross-posting is frowned upon</a>"}], "answers": [{"comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 1, "creation_date": 1475208237, "post_id": 39772538, "comment_id": 66860918, "body": "This code presumes the type to modify is already a monad stack; it seems there is still a lot of refactoring to do to apply something like  <code>StateT StdGen</code> to <code>[Packet]</code>."}, {"owner": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 1, "creation_date": 1475209413, "post_id": 39772538, "comment_id": 66861196, "body": "This is a nice snippet of code but I don&#39;t believe this answers the question at all. I.e., what should he/she do if a large amount of his code is already written differently? The answer can&#39;t be &quot;always just start with a monad stack&quot;"}, {"owner": {"reputation": 373, "user_id": 2156507, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/716d31d2669df94167ffcb4d881eaa01?s=128&d=identicon&r=PG", "display_name": "trunklop", "link": "https://stackoverflow.com/users/2156507/trunklop"}, "reply_to_user": {"reputation": 106013, "user_id": 633183, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/RHeN9.png?s=128&g=1", "display_name": "Thank you", "link": "https://stackoverflow.com/users/633183/thank-you"}, "edited": false, "score": 2, "creation_date": 1475219083, "post_id": 39772538, "comment_id": 66864826, "body": "@naomik: yes, that&#39;s what I meant (half-jokingly) with &quot;give all your functions a state monad, just in case&quot; and I was wondering how the &quot;real FP-guys&quot; handle this problem. If my Haskell program has state everywhere, the difference to an impure language becomes just a question of syntax."}, {"owner": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "reply_to_user": {"reputation": 373, "user_id": 2156507, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/716d31d2669df94167ffcb4d881eaa01?s=128&d=identicon&r=PG", "display_name": "trunklop", "link": "https://stackoverflow.com/users/2156507/trunklop"}, "edited": false, "score": 0, "creation_date": 1475220339, "post_id": 39772538, "comment_id": 66865577, "body": "@RmS even if your program has state everywhere, at every point you statically know exactly what the state is. That&#39;s a significant difference to most stateful languages."}, {"owner": {"reputation": 373, "user_id": 2156507, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/716d31d2669df94167ffcb4d881eaa01?s=128&d=identicon&r=PG", "display_name": "trunklop", "link": "https://stackoverflow.com/users/2156507/trunklop"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 0, "creation_date": 1475221990, "post_id": 39772538, "comment_id": 66866423, "body": "@Andr&#225;sKov&#225;cs: right, but my question was more about workflow, patterns and coding style: Do I have to write my program with (at the beginning empty) state constructs (monads or whaterver you prefer) for all functions <i>just in case</i> (&quot;Hey, maybe I will need state later and then I have to refactor everything&quot;)? Is that how the &quot;real guys&quot; (you, user2297560, etc.) work when they start a big project?"}, {"owner": {"reputation": 373, "user_id": 2156507, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/716d31d2669df94167ffcb4d881eaa01?s=128&d=identicon&r=PG", "display_name": "trunklop", "link": "https://stackoverflow.com/users/2156507/trunklop"}, "reply_to_user": {"reputation": 28873, "user_id": 1068232, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2a0a145ce58c20013969fe3f203531da?s=128&d=identicon&r=PG", "display_name": "Andr&#225;s Kov&#225;cs", "link": "https://stackoverflow.com/users/1068232/andr%c3%a1s-kov%c3%a1cs"}, "edited": false, "score": 1, "creation_date": 1475224232, "post_id": 39772538, "comment_id": 66867519, "body": "@Andr&#225;sKov&#225;cs: Just another comment about &quot;statically knowing the state&quot;. When I added RNGState to my program, I had to do it for every function in the path from the head function down to the function F which needed the RNG. What happens if, in a few years, I decide to change F so that it does not need the RNG anymore? Just a quick small change in F...But wait, what about all the other functions in the path? Refactor them again? Do I still remember why I put RNGState everywhere? Yes, the compiler knows, but do I? My question is about daily coding habits and work flow to make life easier."}, {"owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "edited": false, "score": 1, "creation_date": 1475228424, "post_id": 39772538, "comment_id": 66870114, "body": "Fair point. If you already have a bunch of code, this technique requires some amount of refactoring. I usually assume for non-trivial projects that the &#39;backbone&#39; of the application will need effects (IO at the very least) so I&#39;ll start with <code>type Program = IO ()</code> and add effects as necessary."}], "tags": [], "owner": {"reputation": 2863, "user_id": 2297560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/948d4a17494b3c616a0873453b74670c?s=128&d=identicon&r=PG", "display_name": "user2297560", "link": "https://stackoverflow.com/users/2297560/user2297560"}, "is_accepted": false, "score": 9, "last_activity_date": 1475229708, "last_edit_date": 1592644375, "creation_date": 1475157826, "answer_id": 39772538, "question_id": 39767984, "link": "https://stackoverflow.com/questions/39767984/how-to-limit-code-changes-when-introducing-state/39772538#39772538", "title": "How to limit code changes when introducing state?", "body": "<p>One approach that I've been fairly successful with is using a monad transformer stack. This lets you both add new effects when needed and also track the effects required by particular functions.</p>\n<p>Here's a really simple example.</p>\n<pre><code>import Control.Monad.State\nimport Control.Monad.Reader\n\ndata Config = Config { v1 :: Int, v2 :: Int }\n\n-- the type of the entire program describes all the effects that it can do\ntype Program = StateT Int (ReaderT Config IO) ()\n\nrunProgram program config startState = \n  runReaderT (runStateT program startState) config\n\n-- doesn't use configuration values. doesn't do IO    \nstep1 :: MonadState Int m =&gt; m ()\nstep1 = get &gt;&gt;= \\x -&gt; put (x+1)\n\n-- can use configuration and change state, but can't do IO\nstep2 :: (MonadReader Config m, MonadState Int m) =&gt; m ()\nstep2 = do\n  x &lt;- asks v1\n  y &lt;- get\n  put (x+y)\n\n-- can use configuration and do IO, but won't touch our internal state\nstep3 :: (MonadReader Config m, MonadIO m) =&gt; m ()\nstep3 = do\n  x &lt;- asks v2\n  liftIO $ putStrLn (&quot;the value of v2 is &quot; ++ show x)\n\nprogram :: Program\nprogram = step1 &gt;&gt; step2 &gt;&gt; step3\n\nmain :: IO ()\nmain = do\n  let config = Config { v1 = 42, v2 = 123 }\n      startState = 17\n  result &lt;- runProgram program config startState\n  return ()\n</code></pre>\n<p>Now if we want to add another effect:</p>\n<pre><code>step4 :: MonadWriter String m =&gt; m()\nstep4 = tell &quot;done!&quot;\n\nprogram :: Program\nprogram = step1 &gt;&gt; step2 &gt;&gt; step3 &gt;&gt; step4\n</code></pre>\n<p>Just adjust <code>Program</code> and <code>runProgram</code></p>\n<pre><code>type Program = StateT Int (ReaderT Config (WriterT String IO)) ()\n\nrunProgram program config startState =\n    runWriterT $ runReaderT (runStateT program startState) config\n</code></pre>\n<p>To summarize, this approach lets us decompose a program in a way that tracks effects but also allows adding new effects as needed without a huge amount of refactoring.</p>\n<h1>edit:</h1>\n<p>It's come to my attention that I didn't answer the question about what to do for code that's already written. In many cases, it's not too difficult to change pure code into this style:</p>\n<pre><code>computation :: Double -&gt; Double -&gt; Double\ncomputation x y = x + y\n</code></pre>\n<p>becomes</p>\n<pre><code>computation :: Monad m =&gt; Double -&gt; Double -&gt; m Double\ncomputation x y = return (x + y)\n</code></pre>\n<p>This function will now work for any monad, but doesn't have access to any extra effects. Specifically, if we add another monad transformer to <code>Program</code>, then <code>computation</code> will still work.</p>\n"}], "owner": {"reputation": 373, "user_id": 2156507, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/716d31d2669df94167ffcb4d881eaa01?s=128&d=identicon&r=PG", "display_name": "trunklop", "link": "https://stackoverflow.com/users/2156507/trunklop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 4, "answer_count": 1, "score": 9, "last_activity_date": 1475229708, "creation_date": 1475145437, "question_id": 39767984, "link": "https://stackoverflow.com/questions/39767984/how-to-limit-code-changes-when-introducing-state", "title": "How to limit code changes when introducing state?", "body": "<p>I am a senior C/C++/Java/Assembler programmer and I have been always fascinated by the pure functional programming paradigm. From time to time, I try to implement something useful with it, e.g., a small tool, but often I quickly reach a point where I realize that I (and my tool, too) would be much faster in a non-pure language. It's probably because I have much more experience with imperative programming languages with thousands of idoms, patterns and typical solution approaches in my head.</p>\n\n<p>Here is one of those situations. I have encountered it several times and I hope you guys can help me.</p>\n\n<p>Let's assume I write a tool to simulate communication networks. One important task is the generation of network packets. The generation is quite complex, consisting of dozens of functions and configuration parameters, but at the end there is one master function and because I find it useful I always write down the signature:</p>\n\n<pre><code>generatePackets :: Configuration -&gt; [Packet]\n</code></pre>\n\n<p>However, after a while I notice that it would be great if the packet generation would have some kind of random behavior deep down in one of the many sub-functions of the generation process. Since I need a random number generator for that (and I also need it at some other places in the code), this means to manually change dozens of signatures to something like</p>\n\n<pre><code>f :: Configuration -&gt; RNGState [Packet]\n</code></pre>\n\n<p>with</p>\n\n<pre><code>type RNGState = State StdGen\n</code></pre>\n\n<p>I understand the \"mathematical\" necessity (no states) behind this. My question is on a higher (?) level: How would an experienced Haskell programmer have approached this situation? What kind of design pattern or work flow would have avoided the extra work later? </p>\n\n<p>I have never worked with an experienced Haskell programmer. Maybe you will tell me that you never write signatures because you have to change them too often afterwards, or that you give all your functions a state monad, \"just in case\" :)</p>\n"}, {"tags": ["haskell", "functor"], "answers": [{"comments": [{"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1475140109, "post_id": 39765985, "comment_id": 66826683, "body": "Could you take this a step further and differentiate, in simple terms, how functors differ from applicative functors?"}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "reply_to_user": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 2, "creation_date": 1475140414, "post_id": 39765985, "comment_id": 66826875, "body": "If you have <code>a-&gt;b</code> and <code>f a</code>, when <code>f</code> is a functor, you can get <code>f b</code> using <code>fmap</code>. However, if you have <code>f (a-&gt;b)</code> and <code>f a</code>, you can not get <code>f b</code>: the function is wrapped underneath <code>f</code> and there&#39;s no way to make it interact with its argument. Applicative functors instead define an additional operation <code>&lt;*&gt;</code> allowing for that."}, {"owner": {"reputation": 44013, "user_id": 1477667, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/trgKM.jpg?s=128&g=1", "display_name": "dfeuer", "link": "https://stackoverflow.com/users/1477667/dfeuer"}, "edited": false, "score": 0, "creation_date": 1475152644, "post_id": 39765985, "comment_id": 66835384, "body": "One available functor is &quot;reader` which indeed relates to functions, but now may not be the best stage to learn about it."}], "tags": [], "owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "is_accepted": true, "score": 11, "last_activity_date": 1475139945, "creation_date": 1475139945, "answer_id": 39765985, "question_id": 39765694, "link": "https://stackoverflow.com/questions/39765694/example-of-an-fmap-to-distinguish-from-map/39765985#39765985", "title": "Example of an Fmap to distinguish from map?", "body": "<p>No, the difference is that <code>fmap</code> applies to any functor. For instance:</p>\n\n<pre><code>readLine :: IO String           -- read a line\nfmap length readLine :: IO Int  -- read a line and count its length\n\nJust 4 :: Maybe Int\nfmap (+10) (Just 4) :: Maybe Int  -- apply (+10) underneath Just\n                                  -- returns (Just 14)\n</code></pre>\n\n<p><code>map</code> turns <code>a -&gt; b</code> into a function <code>[] a -&gt; [] b</code> (usually written as <code>[a] -&gt; [b]</code>).</p>\n\n<p><code>fmap</code> turns <code>a -&gt; b</code> into a function <code>f a -&gt; f b</code>for any functor <code>f</code>, not only for <code>f = []</code>. The examples above chose <code>f = IO</code> and <code>f = Maybe</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475140169, "post_id": 39766021, "comment_id": 66826720, "body": "You should clarify that you can&#39;t <code>fmap</code> over <code>Text</code> or <code>ByteString</code>, though, since they are not functors."}, {"owner": {"reputation": 11496, "user_id": 5438433, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OJ1qY.png?s=128&g=1", "display_name": "TheInnerLight", "link": "https://stackoverflow.com/users/5438433/theinnerlight"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1475140720, "post_id": 39766021, "comment_id": 66827069, "body": "@chi I&#39;ll just replace them with better examples."}, {"owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "edited": false, "score": 0, "creation_date": 1475141395, "post_id": 39766021, "comment_id": 66827552, "body": "@TheInnerLight could you give an example of applying this to a binary tree of type data Tree a = Empty | Node a (Tree a) (Tree a)?"}], "tags": [], "owner": {"reputation": 11496, "user_id": 5438433, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OJ1qY.png?s=128&g=1", "display_name": "TheInnerLight", "link": "https://stackoverflow.com/users/5438433/theinnerlight"}, "is_accepted": false, "score": 4, "last_activity_date": 1475140673, "last_edit_date": 1475140673, "creation_date": 1475140066, "answer_id": 39766021, "question_id": 39765694, "link": "https://stackoverflow.com/questions/39765694/example-of-an-fmap-to-distinguish-from-map/39766021#39766021", "title": "Example of an Fmap to distinguish from map?", "body": "<p>It would help to look at the type signatures for each function, let's start with the <code>map</code> function you are looking at:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; [a] -&gt; [b]\n</code></pre>\n\n<p>As you can see, this <code>map</code> function operates on lists.  Logically however, there are many data structures which can be mapped over.  Here are some other possible maps:</p>\n\n<pre><code>map :: (a -&gt; b) -&gt; Map k a -&gt; Map k b\nmap :: (a -&gt; b) -&gt; Maybe a -&gt; Maybe b\nmap :: (a -&gt; b) -&gt; IO a -&gt; IO b\n</code></pre>\n\n<p>This is just the tip of the iceberg, many things can be mapped!</p>\n\n<p>In languages that don't support type classes, this could be the world as you know it.  There are simply many <code>map</code> functions and you have to qualify them with an appropriate module type to distinguish which <code>map</code> you actually mean.  Not so in Haskell!</p>\n\n<p>Now let's look at <code>fmap</code>:</p>\n\n<pre><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>This function has exactly the same form as those shown above but works on anything which is a functor.</p>\n\n<p>Functor is defined like this:</p>\n\n<pre><code>class  Functor f  where\n    fmap        :: (a -&gt; b) -&gt; f a -&gt; f b\n    (&lt;$)        :: a -&gt; f b -&gt; f a\n    (&lt;$)        =  fmap . const\n</code></pre>\n\n<p>Hopefully this makes it obvious that a functor is simply <em>something that supports being mapped over.</em></p>\n\n<p>Therefore <code>fmap</code> is general, while <code>map</code> is specific.</p>\n"}, {"tags": [], "owner": {"reputation": 14781, "user_id": 630160, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4445f21326af525a8ad19af7e3ae41a8?s=128&d=identicon&r=PG", "display_name": "epsilonhalbe", "link": "https://stackoverflow.com/users/630160/epsilonhalbe"}, "is_accepted": false, "score": 2, "last_activity_date": 1475140155, "creation_date": 1475140155, "answer_id": 39766067, "question_id": 39765694, "link": "https://stackoverflow.com/questions/39765694/example-of-an-fmap-to-distinguish-from-map/39766067#39766067", "title": "Example of an Fmap to distinguish from map?", "body": "<p><code>fmap</code> is more general than <code>map</code> - and indeed for lists there is no difference - here you have <code>map == fmap</code>.</p>\n\n<p>Let us begin with the definition of <code>fmap</code></p>\n\n<pre><code>class Functor f where\n    fmap :: (a -&gt; b) -&gt; (f a -&gt; f b)\n</code></pre>\n\n<p>this essentially says you can turn a simple function into a function that transforms containers into containers of the same shape but different elements.</p>\n\n<pre><code>instance Functor [] where\n   fmap = map\n\ninstance Functor Maybe where\n   fmap _ Nothing = Nothing\n   fmap f (Just something) = Just (f something)\n</code></pre>\n\n<p>there are many more, I think almost every container with a single type parameter can be a functor</p>\n\n<p>As an exercise you can try to define an instance for</p>\n\n<pre><code>data Tree a = Tree a [a]\n</code></pre>\n\n<p>for the usage of <code>fmap</code> see @chi's answer.</p>\n"}], "owner": {"reputation": 2691, "user_id": 5477287, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yKMgF.jpg?s=128&g=1", "display_name": "Babra Cunningham", "link": "https://stackoverflow.com/users/5477287/babra-cunningham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3041, "favorite_count": 3, "accepted_answer_id": 39765985, "answer_count": 3, "score": 4, "last_activity_date": 1475140673, "creation_date": 1475139177, "question_id": 39765694, "link": "https://stackoverflow.com/questions/39765694/example-of-an-fmap-to-distinguish-from-map", "title": "Example of an Fmap to distinguish from map?", "body": "<p>My understanding is that the difference between map and fmap is that the latter can return a function?</p>\n\n<p>I'm studying the functors section of this <a href=\"http://learnyouahaskell.com\" rel=\"nofollow\">http://learnyouahaskell.com</a> and some of the explanation is a bit unclear.</p>\n\n<p>Map and fmap behave identically in the following:</p>\n\n<pre><code>let exMap = map (+1) [1..5]\nlet exFMap = fmap (+1) [1..5]\n</code></pre>\n\n<p>What is a good example of an fmap returning a function? </p>\n"}, {"tags": ["haskell", "hugs"], "comments": [{"owner": {"reputation": 58792, "user_id": 1006010, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f683d229f3673c9dcc3f3f2796d75c09?s=128&d=identicon&r=PG", "display_name": "MathematicalOrchid", "link": "https://stackoverflow.com/users/1006010/mathematicalorchid"}, "edited": false, "score": 1, "creation_date": 1475137380, "post_id": 39765019, "comment_id": 66824852, "body": "Hugs is pretty much obsolete; it hasn&#39;t been maintained in years. Most people use GHCi instead."}, {"owner": {"reputation": 14582, "user_id": 2225384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30b04ed4d0b3fc4bc791a28815f34ca?s=128&d=identicon&r=PG", "display_name": "Rein Henrichs", "link": "https://stackoverflow.com/users/2225384/rein-henrichs"}, "edited": false, "score": 1, "creation_date": 1475137931, "post_id": 39765019, "comment_id": 66825218, "body": "Win Hugs was the windows version of Hugs, which wouldn&#39;t work on Ubuntu even if it weren&#39;t obsolete and unmaintained. Install GHC instead."}], "answers": [{"tags": [], "owner": {"reputation": 176, "user_id": 6369445, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/6Jrwo.jpg?s=128&g=1", "display_name": "Abdul Malik", "link": "https://stackoverflow.com/users/6369445/abdul-malik"}, "is_accepted": true, "score": 0, "last_activity_date": 1477297735, "creation_date": 1477297735, "answer_id": 40213835, "question_id": 39765019, "link": "https://stackoverflow.com/questions/39765019/how-to-install-hugs-compiler-in-ubuntu/40213835#40213835", "title": "How to Install Hugs Compiler in ubuntu?", "body": "<p>To install hugs compiler in Ubuntu you just need to execute two under given commands.  </p>\n\n<p>sudo apt-get update<br>\nsudo apt-get install hugs</p>\n\n<p>To start working with hugs, type <strong>hugs</strong> in terminal and start working with it. Type <strong>:?</strong> for help. To terminate it, type <strong>:quit</strong>.</p>\n"}], "owner": {"reputation": 176, "user_id": 6369445, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/6Jrwo.jpg?s=128&g=1", "display_name": "Abdul Malik", "link": "https://stackoverflow.com/users/6369445/abdul-malik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1294, "favorite_count": 0, "accepted_answer_id": 40213835, "answer_count": 1, "score": 0, "last_activity_date": 1487785304, "creation_date": 1475137223, "last_edit_date": 1487785304, "question_id": 39765019, "link": "https://stackoverflow.com/questions/39765019/how-to-install-hugs-compiler-in-ubuntu", "title": "How to Install Hugs Compiler in ubuntu?", "body": "<p>I want to program in Haskel, a functional programming language and I want to install Hugs compiler for that in Ubuntu. Does anybody have any idea about it's installation.   </p>\n"}]