[{"tags": ["c"], "comments": [{"owner": {"reputation": 14263, "user_id": 1255873, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/dZChN.jpg?s=128&g=1", "display_name": "Abion47", "link": "https://stackoverflow.com/users/1255873/abion47"}, "edited": false, "score": 0, "creation_date": 1549497031, "post_id": 54564290, "comment_id": 95927474, "body": "Where you do assign a value to <code>N</code> and <code>Y</code>?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1549497091, "post_id": 54564290, "comment_id": 95927496, "body": "Note: you should not call <code>main()</code>"}, {"owner": {"reputation": 1174, "user_id": 8998310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/620a41a51c7a40164675ceae1c0b6548?s=128&d=identicon&r=PG&f=1", "display_name": "josemz", "link": "https://stackoverflow.com/users/8998310/josemz"}, "edited": false, "score": 1, "creation_date": 1549497406, "post_id": 54564290, "comment_id": 95927584, "body": "you probably mean to compare newInvoice to the characters &#39;Y&#39; and &#39;N&#39; instead of the variables Y and N, in which case <code>if(newInvoice == &#39;Y&#39;)</code> should do the job."}, {"owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "edited": false, "score": 2, "creation_date": 1549497438, "post_id": 54564290, "comment_id": 95927599, "body": "Calling <code>main</code> recursively is legal in C, but illegal in C++.  (It is never a <b><i>good</i></b> idea, however)"}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "reply_to_user": {"reputation": 1174, "user_id": 8998310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/620a41a51c7a40164675ceae1c0b6548?s=128&d=identicon&r=PG&f=1", "display_name": "josemz", "link": "https://stackoverflow.com/users/8998310/josemz"}, "edited": false, "score": 0, "creation_date": 1549498535, "post_id": 54564290, "comment_id": 95927878, "body": "@josemz the OP would have to compare `if (*newInvoice == &#39;Y&#39;) since s/he&#39;d only want to look at the first character on the input"}, {"owner": {"reputation": 1174, "user_id": 8998310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/620a41a51c7a40164675ceae1c0b6548?s=128&d=identicon&r=PG&f=1", "display_name": "josemz", "link": "https://stackoverflow.com/users/8998310/josemz"}, "reply_to_user": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 1, "creation_date": 1549499061, "post_id": 54564290, "comment_id": 95928005, "body": "@bruceg I thought <code>newInvoice</code> was a character but now that I see the <code>%s</code> in <code>scanf</code> you&#39;re probably right. Guess we can&#39;t know for sure if we don&#39;t see the declaration of <code>newInvoice</code>."}, {"owner": {"reputation": 49, "user_id": 10372764, "user_type": "registered", "profile_image": "https://graph.facebook.com/2103173239741612/picture?type=large", "display_name": "Aidan Agee", "link": "https://stackoverflow.com/users/10372764/aidan-agee"}, "edited": false, "score": 0, "creation_date": 1549499145, "post_id": 54564290, "comment_id": 95928024, "body": "char newInvoice[1], Y, N; sorry this is it"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1549503269, "post_id": 54564290, "comment_id": 95928854, "body": "The recursive call to <code>main()</code> is probably <i>not</i> a good idea.  You should be looping, not recursing.  Also, since you&#39;ve not shown how any of the variables are defined (nor how most of them are initialized), it is hard to be sure of anything.  You should check that the <code>scanf()</code> returns <code>1</code>; if not, you&#39;ve got an EOF or other error condition."}], "answers": [{"comments": [{"owner": {"reputation": 6675, "user_id": 854742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dc3befe29d589c7c34fd1600affc041?s=128&d=identicon&r=PG", "display_name": "Carey Gregory", "link": "https://stackoverflow.com/users/854742/carey-gregory"}, "edited": false, "score": 0, "creation_date": 1549501823, "post_id": 54564754, "comment_id": 95928559, "body": "You&#39;d better hope the user never enters more than one character."}, {"owner": {"reputation": 568, "user_id": 10816404, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UU34KIKCsDo/AAAAAAAAAAI/AAAAAAAAAFs/ddSxo0F-UBc/photo.jpg?sz=128", "display_name": "Duck Ling", "link": "https://stackoverflow.com/users/10816404/duck-ling"}, "reply_to_user": {"reputation": 6675, "user_id": 854742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dc3befe29d589c7c34fd1600affc041?s=128&d=identicon&r=PG", "display_name": "Carey Gregory", "link": "https://stackoverflow.com/users/854742/carey-gregory"}, "edited": false, "score": 0, "creation_date": 1549502110, "post_id": 54564754, "comment_id": 95928617, "body": "it actually loops and saves one char only according to the debugger, then overwrites  the old one, unless it actually accesses the further memory and doesn&#39;t show up in debugger (leading to undefined behavior)? But yeah, I did suggest to use getchar();. I personally wouldn&#39;t play around with one element array, it&#39;s just for the purpose of this example, as the author used a string."}, {"owner": {"reputation": 6675, "user_id": 854742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dc3befe29d589c7c34fd1600affc041?s=128&d=identicon&r=PG", "display_name": "Carey Gregory", "link": "https://stackoverflow.com/users/854742/carey-gregory"}, "edited": false, "score": 0, "creation_date": 1549502784, "post_id": 54564754, "comment_id": 95928757, "body": "You&#39;re misinterpreting the debugger. <code>scanf</code> will read an unlimited number of characters up until the first whitespace. Since your array is only one char long that&#39;s going to trash the stack and produce UB if the user types in more than one char. I know it&#39;s only an example, but you shouldn&#39;t teach bad habits. There are multiple ways to solve this problem that don&#39;t trash the stack."}, {"owner": {"reputation": 568, "user_id": 10816404, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UU34KIKCsDo/AAAAAAAAAAI/AAAAAAAAAFs/ddSxo0F-UBc/photo.jpg?sz=128", "display_name": "Duck Ling", "link": "https://stackoverflow.com/users/10816404/duck-ling"}, "reply_to_user": {"reputation": 6675, "user_id": 854742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dc3befe29d589c7c34fd1600affc041?s=128&d=identicon&r=PG", "display_name": "Carey Gregory", "link": "https://stackoverflow.com/users/854742/carey-gregory"}, "edited": false, "score": 1, "creation_date": 1549503545, "post_id": 54564754, "comment_id": 95928927, "body": "thanks for the explanation Carey. Please have a look at the edited code above. Tested and works just fine with any input, and hopefully doesn&#39;t mess with the stack anymore!"}, {"owner": {"reputation": 6675, "user_id": 854742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dc3befe29d589c7c34fd1600affc041?s=128&d=identicon&r=PG", "display_name": "Carey Gregory", "link": "https://stackoverflow.com/users/854742/carey-gregory"}, "edited": false, "score": 0, "creation_date": 1549503639, "post_id": 54564754, "comment_id": 95928941, "body": "Much better solution."}], "tags": [], "owner": {"reputation": 568, "user_id": 10816404, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UU34KIKCsDo/AAAAAAAAAAI/AAAAAAAAAFs/ddSxo0F-UBc/photo.jpg?sz=128", "display_name": "Duck Ling", "link": "https://stackoverflow.com/users/10816404/duck-ling"}, "is_accepted": true, "score": 1, "last_activity_date": 1549503399, "last_edit_date": 1549503399, "creation_date": 1549500205, "answer_id": 54564754, "question_id": 54564290, "link": "https://stackoverflow.com/questions/54564290/how-do-characters-store-values-when-being-compared-to-each-other-in-an-if-else/54564754#54564754", "title": "How do characters store values when being compared to each other in an if else?", "body": "<p>consider the following (changed abelenky's code a little). The below makes sure the lower case letters get accepted, but it's probably a little clunky, and may be represented a little more elegant.</p>\n\n<pre><code>int main()\n{\n    char newInvoice, buffer;\n    do \n    {\n        newInvoice = getchar();\n        bufferClean(&amp;buffer); //see underneath the code for the explanation.\n        if (newInvoice == 'Y' || newInvoice == 'y') \n        {\n            printf(\"you've chosen YES, continue ......\\n\");\n            break; // breaks the loop and continues with the code.\n        }\n        else if (newInvoice == 'N' || newInvoice == 'n') \n        {\n            printf(\"you've chosen NO, Goodbye!\\n\");\n            return 1; //main returns 1 and ends the program\n        }\n        else \n        {\n            printf(\"Invalid Entry (it has to be y or n):\\n\");\n        }\n    } while(1);\n\n    printf(\"exited the loop\\n\");\n    return 0;\n}\n</code></pre>\n\n<p>Also, asking for users' input is a little tricky. I suggest clearing the buffer after using it, as it passes on the <code>newline char</code> and may skip any further input prompt.\nI  have created a little function to do so:</p>\n\n<pre><code>void bufferClean(char *buff)\n{\n    while ((*buff = getchar()) != '\\n' &amp;&amp; *buff != EOF);\n}\n</code></pre>\n\n<p>Just declare a <code>char buffer</code> in <code>main()</code> with no value, and pass it on to the function every time you want to clear the buffer (I do every time after asking for users' input). I'm a novice, and if I'm making any mistakes please point them out!</p>\n"}], "owner": {"reputation": 49, "user_id": 10372764, "user_type": "registered", "profile_image": "https://graph.facebook.com/2103173239741612/picture?type=large", "display_name": "Aidan Agee", "link": "https://stackoverflow.com/users/10372764/aidan-agee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 54564754, "answer_count": 1, "score": 0, "last_activity_date": 1549503399, "creation_date": 1549496791, "last_edit_date": 1549503217, "question_id": 54564290, "link": "https://stackoverflow.com/questions/54564290/how-do-characters-store-values-when-being-compared-to-each-other-in-an-if-else", "title": "How do characters store values when being compared to each other in an if else?", "body": "<p>I'm creating a loop that basically has a (y/n) yes, no answer and I wanted to use an if else inside of a do while loop. When using the <code>input == Y</code> it seems to not accept it, so I'm wondering that's even possible in C? Or if I'm approaching in the wrong way.</p>\n\n<p>I tried just a simple if input == Y but that didn't work, then I tried a <code>strcmp</code> and that didn't seem to work either. I'm at the <code>strcmp</code> part because I think I might be close to the answer with that but I'm not entirely sure if I'm understanding what's going on with the char values.</p>\n\n<pre><code>printf(\"Would you like to print another invoice? Y=yes, N=No\\n\");\ndo {\n    scanf(\"%s\", &amp;newInvoice);\n    if(strcmp(newInvoice, Y)!= 0) {\n        main();\n    }\n    else if(strcmp(newInvoice, N)!= 0) {\n        printf(\"Goodbye!\\n\");\n    }\n    else {\n        printf(\"Invalid Entry (it has to be y or n):\\n\");\n    }\n} while(strcmp(newInvoice, N)!= 0); \n</code></pre>\n\n<p>When I had just <code>input == Y</code> it wanted me to initialize Ym and N so that didn't seem to be the answer. I would like the loop to repeat the question and input until they say yes or no; if they enter something like G or whatever other character it needs to loop again.</p>\n"}, {"tags": ["c", "linux", "memory", "page-fault"], "comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1549496916, "post_id": 54564273, "comment_id": 95927445, "body": "Related and potentially interesting: <a href=\"https://unix.stackexchange.com/a/79256/66358\">unix.stackexchange.com/a/79256/66358</a>"}], "answers": [{"comments": [{"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 0, "creation_date": 1549499798, "post_id": 54564696, "comment_id": 95928152, "body": "Thanks. I suspected this but couldn&#39;t find the code in the kernel. You make great answers!"}], "tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 3, "last_activity_date": 1549499665, "creation_date": 1549499665, "answer_id": 54564696, "question_id": 54564273, "link": "https://stackoverflow.com/questions/54564273/dynamic-expansion-of-the-linux-stack/54564696#54564696", "title": "Dynamic expansion of the Linux stack", "body": "<p>The linux kernel takes the content of the stack pointer as the limit (within reasonable boundaries). Accessing the stack <em>below</em> the stack pointer minus 65536 and the size for 32 unsigned longs is causing a segmentation violation. So, if you access the memory down the stack you have to make sure, that the stack pointer somehow decreases with the accesses to have the linux kernel enlarge the segment. See this snippet from <code>/arch/x86/mm/fault.c</code>:</p>\n\n<pre><code>if (sw_error_code &amp; X86_PF_USER) {\n    /*\n     * Accessing the stack below %sp is always a bug.\n     * The large cushion allows instructions like enter\n     * and pusha to work. (\"enter $65535, $31\" pushes\n     * 32 pointers and then decrements %sp by 65535.)\n     */\n    if (unlikely(address + 65536 + 32 * sizeof(unsigned long) &lt; regs-&gt;sp)) {\n        bad_area(regs, sw_error_code, address);\n        return;\n    }\n}\n</code></pre>\n\n<p>The value of the stack pointer register is key here!</p>\n"}], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 54564696, "answer_count": 1, "score": 3, "last_activity_date": 1549499665, "creation_date": 1549496675, "question_id": 54564273, "link": "https://stackoverflow.com/questions/54564273/dynamic-expansion-of-the-linux-stack", "title": "Dynamic expansion of the Linux stack", "body": "<p>I've noticed the Linux stack starts small and expands with page faults caused by recursion/pushes/vlas up to size <code>getrlimit(RLIMIT_STACK,...)</code>, give or take (defaults to 8MiB on my system).</p>\n\n<p>Curiously though, if I cause page faults by addressing bytes directly, within the limit, Linux will just regularly segfault without expanding the page mapping (no segfault though, if I do it after I had e.g., alloca, cause the stack expansion).</p>\n\n<p>Example program:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdlib.h&gt;\n#define CMD \"grep stack /proc/XXXXXXXXXXXXXXXX/maps\"\n#define CMDP \"grep stack /proc/%ld/maps\"\nvoid vla(size_t Sz)\n{\n    char b[Sz];\n    b[0]='y';\n    b[1]='\\0';\n    puts(b);\n}\n#define OFFSET (sizeof(char)&lt;&lt;12)\nint main(int C, char **V)\n{\n    char cmd[sizeof CMD]; sprintf(cmd,CMDP,(long)getpid());\n    if(system(cmd)) return 1;\n    for(int i=0; ; i++){\n        printf(\"%d\\n\", i);\n        char *ptr = (char*)(((uintptr_t)&amp;ptr)-i*OFFSET);\n        if(C&gt;1) vla(i*OFFSET); //pass an argument to the executable to turn this on\n        ptr[0] = 'x';\n        ptr[1] = '\\0';\n        if(system(cmd)) return 1;\n        puts(ptr);\n    }\n}\n</code></pre>\n\n<p>What kernel code is doing this? How does it differentiate between natural stack growth and me poking around in the address space?</p>\n"}, {"tags": ["c", "oop", "free"], "comments": [{"owner": {"reputation": 3560, "user_id": 5550963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7jAip.png?s=128&g=1", "display_name": "CEPB", "link": "https://stackoverflow.com/users/5550963/cepb"}, "edited": false, "score": 0, "creation_date": 1549496530, "post_id": 54564231, "comment_id": 95927345, "body": ":) LOL this is not OOP."}, {"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 1, "creation_date": 1549496734, "post_id": 54564231, "comment_id": 95927397, "body": "I&#39;m curious how you C code &quot;is throwing an exception&quot;!"}, {"owner": {"reputation": 449, "user_id": 9131933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/272423f6785184b9d180ef6a5bd16504?s=128&d=identicon&r=PG&f=1", "display_name": "newbie", "link": "https://stackoverflow.com/users/9131933/newbie"}, "edited": false, "score": 1, "creation_date": 1549496897, "post_id": 54564231, "comment_id": 95927435, "body": "&amp;x-&gt;columns[i] is that what you intended ? x is already a pointer to dynamic memory"}, {"owner": {"reputation": 426, "user_id": 5029430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfebca461b5469f748ae8fff3fcea68a?s=128&d=identicon&r=PG&f=1", "display_name": "Dan Mills", "link": "https://stackoverflow.com/users/5029430/dan-mills"}, "reply_to_user": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1549497067, "post_id": 54564231, "comment_id": 95927488, "body": "@KerrekSB I would guess by making the mmu cause the cpu to jump to an exception vector, probably sigsegv or its windows equivalent in response to an attempt to stomp on memory not owned. Exception does NOT have to be a c++ thing, and in fact like much else C++ borrowed the term from well established usage."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549573903, "post_id": 54564231, "comment_id": 95961615, "body": "OT: in C, the heap allocation functions: <code>malloc()</code> <code>calloc()</code> and <code>realloc()</code>  1) the returned type is <code>void*</code> which can be assigned to any pointer.  Casting just clutters the code, making it more difficult to understand, debug, etc.  2) always check (!=NULL) the returned value to assure the operation was successful."}], "owner": {"reputation": 1, "user_id": 2653897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51e4b2fbd01ebe8f3e846b183e019346?s=128&d=identicon&r=PG", "display_name": "user2653897", "link": "https://stackoverflow.com/users/2653897/user2653897"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549496325, "creation_date": 1549496325, "question_id": 54564231, "link": "https://stackoverflow.com/questions/54564231/how-do-i-free-dynamically-allocated-memory-where-each-index-is-also-dynamically", "title": "How do I free dynamically allocated memory where each index is also dynamically allocated?", "body": "<p>For a project, I am trying to implement a matrix \"class\" in C, but the \"destructor\" for the matrix is throwing an exception. I am not 100% sure why, though I think it is due to reassigning a variable to two different dynamically allocated pointers and then trying to free the latter one twice. I cannot use C++ for this, but I thought I would try to emulate the functionality as best I can.</p>\n\n<p>Here is the code, I am not including the declarations of any functions or structs that needed to be predefined:</p>\n\n<pre><code>struct vComplex {\n    double* realp;\n    double* imagp;\n    uint32_t length ; // for bookkeeping\n    BOOL(*isreal)(vComplex);\n    void(*free)(vComplex*);\n    void(*print)(vComplex*);\n}; \n\nstruct mComplex { // complex matrix type\n    vComplex* columns; // each vComplex represents one column of the mComplex\n    uint32_t nCols;\n    uint32_t nRows;\n    BOOL (*isreal)(mComplex);\n    void (*free)(mComplex*);\n    void(*print)(mComplex*);\n};\n\nvComplex* createVComplex(uint32_t len) {\n\n    vComplex* x = (vComplex*)malloc(sizeof(vComplex));\n\n    x-&gt;realp = (double*)malloc(len * sizeof(double));\n    x-&gt;imagp = (double*)malloc(len * sizeof(double));\n    x-&gt;length = len;\n    x-&gt;isreal = &amp;isreal_v;\n    x-&gt;free = &amp;vComplex_free;\n    x-&gt;print = &amp;vComplex_print;\n\n    return x;\n}\n\nmComplex* createMComplex(uint32_t nRows, uint32_t nCols) {\n    mComplex* x = malloc(sizeof(mComplex));\n    vComplex* vp;\n    x-&gt;columns = (vComplex*)malloc(nCols * sizeof(vComplex));\n    for (uint32_t i = 0; i &lt; nCols; i++) {\n        vp = createVComplex(nRows);\n        x-&gt;columns[i] = *vp;\n    }\n    x-&gt;nRows = nRows;\n    x-&gt;nCols = nCols;\n    x-&gt;isreal = &amp;isreal_m;\n    x-&gt;free = &amp;mComplex_free;\n    x-&gt;print = &amp;mComplex_print;\n\n    return x;\n}\n\n\nvoid vComplex_free(vComplex* x) {\n    free(x-&gt;realp);\n    free(x-&gt;imagp);\n    free(x); // error occurs here (only when called from mComplex_free)\n\n    return;\n}\n\nvoid mComplex_free(mComplex* x) {\n    for (uint32_t i = x-&gt;nCols - 1; i &gt;= 0; i--) {\n        x-&gt;columns[i].free(&amp;x-&gt;columns[i]);\n    }\n    free(x);\n\n    return;\n}\n</code></pre>\n\n<p><code>vComplex.free</code> seems to work just fine, but <code>mComplex.free</code> throws an exception. My intention is that <code>createVComplex</code> creates and returns a pointer to a <code>vComplex</code> which is then freed by <code>vComplex.free</code>. <code>createMComplex</code> would allocate memory for <code>nCols</code> number of <code>vComplex</code> \"objects\" which would then be freed one at a time. Then the pointer to the array of <code>vComplex</code> would be freed and finally the pointer to the <code>mComplex</code>. What I think is happening instead is that the first time I call <code>vComplex.free</code> inside <code>mComplex.free</code> is that it is unable to free the <code>vComplex</code> pointer for whatever reason.</p>\n"}, {"tags": ["c", "volatile", "setjmp"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1549523621, "post_id": 54564083, "comment_id": 95934165, "body": "You cannot in general show that <code>volatile</code> is needed by running an example program. It is needed because the standard says so."}], "answers": [{"tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 1, "last_activity_date": 1549528014, "last_edit_date": 1549528014, "creation_date": 1549526853, "answer_id": 54568820, "question_id": 54564083, "link": "https://stackoverflow.com/questions/54564083/when-volatile-is-needed-when-longjmp-is-called/54568820#54568820", "title": "When `volatile` is needed when `longjmp()` is called?", "body": "<p>Whenever the local variable could have changed between the setup-call to <code>setjmp</code> and the jump back.</p>\n\n<p><a href=\"http://port70.net/~nsz/c/c11/n1570.html#7.13.2.1p3\" rel=\"nofollow noreferrer\">7.13.2.1p3</a></p>\n\n<blockquote>\n  <p>All accessible objects have values, and all other components of the abstract machine249) have state, as of the time the longjmp\n  function was called, except that the values of objects of automatic\n  storage duration that are local to the function containing the\n  invocation of the corresponding setjmp macro that do not have\n  volatile-qualified type and have been changed between the setjmp\n  invocation and longjmp call are indeterminate.</p>\n</blockquote>\n\n<p><code>setjmp</code> snapshots your registers. If the local variable was in a register and you change the variable after the <code>setjmp</code> call, when you jump back it'll have the snapshotted value.</p>\n\n<p>On Linux x86_64 I get outputs <code>2</code> (up to date because volatile) and <code>10</code> (old value) iff I compile with optimization on. </p>\n"}], "owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1549528014, "creation_date": 1549495377, "last_edit_date": 1549506567, "question_id": 54564083, "link": "https://stackoverflow.com/questions/54564083/when-volatile-is-needed-when-longjmp-is-called", "title": "When `volatile` is needed when `longjmp()` is called?", "body": "<p>I am trying to make a minimal working example to show when <code>volatile</code> is needed. But the following example does not require the <code>volatile</code>. Could anybody show an example? Thanks.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;setjmp.h&gt;\n\nstatic jmp_buf buf;\n\nint main() {\n    volatile int local_var = 1;\n    int local_var2 = 10;\n    if(!setjmp(buf)) {\n        local_var = 2;\n        local_var2 = 20;\n        longjmp(buf, 1);\n    } else {\n        printf(\"%d\\n\", local_var);\n        printf(\"%d\\n\", local_var2);\n    }\n\n    return 0;\n}\n</code></pre>\n\n<pre><code>$ ./main.exe \n2\n20\n</code></pre>\n"}, {"tags": ["c", "pointers"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 2, "creation_date": 1549493313, "post_id": 54563712, "comment_id": 95926350, "body": "Where do you think <code>p</code> points to such that you can assign <code>p[0]</code>?"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1549493587, "post_id": 54563712, "comment_id": 95926451, "body": "Both codws are wrong. Second code UB on the first realloc. Then probable many more"}, {"owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "edited": false, "score": 0, "creation_date": 1549493643, "post_id": 54563712, "comment_id": 95926473, "body": "See: <a href=\"https://en.wikipedia.org/wiki/Dangling_pointer\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Dangling_pointer</a>"}, {"owner": {"reputation": 743, "user_id": 246206, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a2d4d601c3e3caab1e9a8090ea63c47a?s=128&d=identicon&r=PG", "display_name": "gbox", "link": "https://stackoverflow.com/users/246206/gbox"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1549493962, "post_id": 54563712, "comment_id": 95926581, "body": "@P__J__ If array was initialized to NULL it was ok?"}], "answers": [{"tags": [], "owner": {"reputation": 864, "user_id": 10913596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1cf12cce6499d0cf89a03500f0808ab?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/10913596/daniel"}, "is_accepted": true, "score": 1, "last_activity_date": 1549493962, "creation_date": 1549493962, "answer_id": 54563864, "question_id": 54563712, "link": "https://stackoverflow.com/questions/54563712/initiations-pointer-to-arrays/54563864#54563864", "title": "initiations pointer to arrays", "body": "<p>Examining the code:</p>\n\n<pre><code>char **p; // Declared, but uninitialized\np[0] = \"test\"; // Setting value to it?\n</code></pre>\n\n<p><code>p</code> is uninitialized, and as such, trying to access and set memory with it is UB, or undefined behavior. Failing is much better than potential alternatives. </p>\n\n<p>For the second piece of code, assuming size is some pointer not included in the snippet. </p>\n\n<pre><code>char** array\narray = realloc(array, sizeof(char*)*((*size)+1)); // Allocating. \narray[*size] = (char*)malloc(sizeof(char)*(strlen(input)+1));\n</code></pre>\n\n<p>So, strictly speaking, calling realloc with an uninitialized pointer is UB, by chance array is equal to <code>Null</code>.</p>\n\n<p>Note that:</p>\n\n<blockquote>\n  <p>If ptr is NULL, the behavior is the same as calling malloc(new_size). </p>\n</blockquote>\n\n<p>As such, realloc will allocate a chunk of memory and pass it to array. </p>\n\n<p>You then dereference the pointer (which is no longer pointing to <code>Null</code> but a valid spot in memory), and malloc it, which does not crash. </p>\n\n<p>From the best guess, while this is undefined behavior, p is possibly <code>Null</code> in both cases, and the first one crashes when trying to dereference it, and the second one successfully gets malloced. </p>\n"}], "owner": {"reputation": 743, "user_id": 246206, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a2d4d601c3e3caab1e9a8090ea63c47a?s=128&d=identicon&r=PG", "display_name": "gbox", "link": "https://stackoverflow.com/users/246206/gbox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 54563864, "answer_count": 1, "score": 0, "last_activity_date": 1549493962, "creation_date": 1549493108, "question_id": 54563712, "link": "https://stackoverflow.com/questions/54563712/initiations-pointer-to-arrays", "title": "initiations pointer to arrays", "body": "<pre><code>    //1\n    char** p;\n    p[0]=\"Test\";\n\n    //2\n    char** array;\n    array = realloc(array, sizeof(char*)*((*size)+1));\n    array[*size] = (char*)malloc(sizeof(char)*(strlen(input)+1));\n</code></pre>\n\n<p>Why does the first code fails in the second line, while the the second code works fine, doesn't  <code>array[*size]</code> is just like <code>p[0]</code>?</p>\n"}, {"tags": ["c", "if-statement", "scanf"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "edited": false, "score": 0, "creation_date": 1549502217, "post_id": 54563658, "comment_id": 95928639, "body": "so set the values of both &quot;x&quot; and &quot;y&quot; (aka numItemsRead) equal to zero at the beginning of the program?"}, {"owner": {"reputation": 4046, "user_id": 4971422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4abf51a937ddda51cc6813445605c50?s=128&d=identicon&r=PG&f=1", "display_name": "FredK", "link": "https://stackoverflow.com/users/4971422/fredk"}, "reply_to_user": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "edited": false, "score": 0, "creation_date": 1549581250, "post_id": 54563658, "comment_id": 95964477, "body": "No. x is the number that you want to raise to the y power. Neither is the same thing as numItemsRead.The method scanf() returns an int that is the number of items successfully read. In my example for reading y, if numItemsRead is equal to one, then  y was successfully input. If numItemsRead is zero,it means that no number was successfully read ,(the value input for y is not a legitimate number)."}], "tags": [], "owner": {"reputation": 4046, "user_id": 4971422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4abf51a937ddda51cc6813445605c50?s=128&d=identicon&r=PG&f=1", "display_name": "FredK", "link": "https://stackoverflow.com/users/4971422/fredk"}, "is_accepted": false, "score": 0, "last_activity_date": 1549492843, "creation_date": 1549492843, "answer_id": 54563658, "question_id": 54563368, "link": "https://stackoverflow.com/questions/54563368/c-program-wont-end-when-user-enters-invalid-character/54563658#54563658", "title": "C Program Won&#39;t End When User Enters Invalid Character", "body": "<p>You need to check how many items scanf successfully read:</p>\n\n<pre><code>int numItemsRead = 0;\n\nprintf(\"What power is the number raised to?\\n\");\nnumItemsRead = scanf(\"%d\", &amp;y);\n\nif (numItemsRead!=1)\n   printf(\"The character you have entered is not a number.Please try again.\");\n} else {\n   '''\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "edited": false, "score": 0, "creation_date": 1549543193, "post_id": 54563720, "comment_id": 95944820, "body": "This all makes sense. I&#39;m trying to work with a do-while loop at the moment but I keep running into errors with this as well. I think my issue lies in my if else statement when my statements say either &quot;(x!=1)&quot; or &quot;(x==1)&quot; and the same with &quot;y&quot;."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "edited": false, "score": 0, "creation_date": 1549544563, "post_id": 54563720, "comment_id": 95945674, "body": "Well, @Rozay, done right, checking the value of <code>x</code> and / or <code>y</code> can tell you about many cases in which you <i>successfully</i> scan numbers -- those in which the number scanned is different from the prior values of thosee variables -- but it does not reliably tell you about failures.  For that, you should be checking the function&#39;s <b>return value</b>.  I.e. <code>rval = scanf(&quot;%d&quot;, &amp;x); if (rval != 1) ...</code>."}, {"owner": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "edited": false, "score": 0, "creation_date": 1549738842, "post_id": 54563720, "comment_id": 96014045, "body": "that makes sense but appears that it is more difficult than I anticipated. The assignment called for a simple program and I was looking to add a little extra with this. For the time being I&#39;m going with the simple program until I get further in my coding studies."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1549493132, "creation_date": 1549493132, "answer_id": 54563720, "question_id": 54563368, "link": "https://stackoverflow.com/questions/54563368/c-program-wont-end-when-user-enters-invalid-character/54563720#54563720", "title": "C Program Won&#39;t End When User Enters Invalid Character", "body": "<p>When your program detects invalid input, it prints a message, but otherwise just continues on ahead as if a valid input had been read.  Instead, it needs to do one of these things:</p>\n\n<ul>\n<li>abort when invalid input is detected, or</li>\n<li>consume and ignore the invalid input, AND\n\n<ul>\n<li>loop back to provide a chance to enter new input, or</li>\n<li>use a default value.</li>\n</ul></li>\n</ul>\n\n<p>Its message suggests that the program will provide for entering new input, but in fact it does not follow through.  Moreover, if it is the input for the first prompt that is invalid, then that input is still waiting to be read when the program prints the second prompt, where it is <em>still</em> invalid, and the program blithely continues on a second time, ultimately printing the initial value of <code>n</code>, 1, without having calculated anything.</p>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "edited": false, "score": 0, "creation_date": 1549501895, "post_id": 54564022, "comment_id": 95928572, "body": "This works to end the program if a letter is entered, however the program ends even if a number is entered."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10998008"}, "reply_to_user": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "edited": false, "score": 0, "creation_date": 1549503243, "post_id": 54564022, "comment_id": 95928849, "body": "hey bro look your code carefully if you enter a number except 1 even if \u0131t is a number the program will be give error :)"}, {"owner": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "edited": false, "score": 0, "creation_date": 1549543340, "post_id": 54564022, "comment_id": 95944913, "body": "Thank you!! That&#39;s what I thought was the problem...but I don&#39;t know what info to put there instead of this to say &quot;if x is not a number then...&quot; or &quot;if y is not a number then...&quot;. I&#39;m a real newb here so I apologize if this is simple and I&#39;m making it much harder than need be."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10998008"}, "reply_to_user": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "edited": false, "score": 0, "creation_date": 1549544914, "post_id": 54564022, "comment_id": 95945886, "body": "np bro.If you are beginner you can think like that &quot;The user will be entered just numbers&quot; .You think far-reaching \u0131ts a good think but for just now dont think like that  :))"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user10998008"}, "is_accepted": false, "score": 0, "last_activity_date": 1549494999, "creation_date": 1549494999, "answer_id": 54564022, "question_id": 54563368, "link": "https://stackoverflow.com/questions/54563368/c-program-wont-end-when-user-enters-invalid-character/54564022#54564022", "title": "C Program Won&#39;t End When User Enters Invalid Character", "body": "<pre><code>int main()\n{\nint x, y, i,n=1,val; \n\nprintf(\"Please enter a number: \\n\"); \nscanf(\"%d\", &amp;x);\n\nif (x!=1)\nprintf(\"The character you have entered is not a number.Please try again.\");\nreturn 0;\n\nelse\nprintf(\"What power is the number raised to?\\n\");\nscanf(\"%d\", &amp;y);\n</code></pre>\n\n<p>Maybe if u do like that even if u entered a invalid character program will be end.</p>\n"}], "owner": {"reputation": 25, "user_id": 6063896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8559d5da4faf6246209d6177e9631c91?s=128&d=identicon&r=PG&f=1", "display_name": "Rozay", "link": "https://stackoverflow.com/users/6063896/rozay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 493, "favorite_count": 0, "closed_date": 1549503003, "answer_count": 3, "score": 0, "last_activity_date": 1549503009, "creation_date": 1549491139, "last_edit_date": 1549503009, "question_id": 54563368, "link": "https://stackoverflow.com/questions/54563368/c-program-wont-end-when-user-enters-invalid-character", "closed_reason": "Duplicate", "title": "C Program Won&#39;t End When User Enters Invalid Character", "body": "<p>I'm trying to write a C program that computes X^Y (X to the Y power) without using the 'pow' function. The program works fine when I enter numbers, but I'm having an issue with the code not stopping when the user enters a character that isn't a number. It runs through the program once more after giving the message \"The character you have entered is not a number.Please try again.The character you have entered is not a number.Please try again. The value is 1.\" Can someone help? I'm going insane trying to figure this out.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main()\n{\nint x, y, i,n=1,val; \n\nprintf(\"Please enter a number: \\n\"); \nscanf(\"%d\", &amp;x);\n\nif (x!=1)\n    printf(\"The character you have entered is not a number.Please try again.\");\n\nelse\n    printf(\"What power is the number raised to?\\n\");\n    scanf(\"%d\", &amp;y);\n\n    if (y!=1)\n    printf(\"The character you have entered is not a number.Please try again.\");\n\n    else\n        for(i=1;i&lt;=y;i++)\n        {\n        val=x;\n        n=n*val;\n        }\n    printf(\"The value is %d.\\n\", n);\nreturn 0;\n}\n</code></pre>\n"}, {"tags": ["c++", "c", "linux", "windows", "stack-overflow"], "comments": [{"owner": {"reputation": 67968, "user_id": 584192, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YBSIc.png?s=128&g=1", "display_name": "Samuel Liew", "link": "https://stackoverflow.com/users/584192/samuel-liew"}, "edited": false, "score": 0, "creation_date": 1549545152, "post_id": 54563208, "comment_id": 95946026, "body": "Comments are not for extended discussion; this conversation has been <a href=\"https://chat.stackoverflow.com/rooms/188055/discussion-on-question-by-scorpio11550-my-program-crashes-on-the-windows-machine\">moved to chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10542737, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kmhlN.jpg?s=128&g=1", "display_name": "scorpio11550", "link": "https://stackoverflow.com/users/10542737/scorpio11550"}, "edited": false, "score": 0, "creation_date": 1549494135, "post_id": 54563708, "comment_id": 95926640, "body": "Thanks for the answer, I&#39;m not going to risk it though. I use simpler IDEs like Code::Blocks and Dev C++ because Visual Studio is something &quot;out of my league&quot;. I just don&#39;t believe in myself enough to start using it.   Now I understand the problem little bit more, sadly, as I&#39;m new here, my upvote doesn&#39;t show.  I just don&#39;t understand why I have &quot;so small stack&quot; compared to Linux terminal :-/"}], "tags": [], "owner": {"reputation": 864, "user_id": 10913596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1cf12cce6499d0cf89a03500f0808ab?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/10913596/daniel"}, "is_accepted": false, "score": 2, "last_activity_date": 1549493080, "creation_date": 1549493080, "answer_id": 54563708, "question_id": 54563208, "link": "https://stackoverflow.com/questions/54563208/my-program-crashes-on-the-windows-machine-yet-it-works-fine-on-the-linux/54563708#54563708", "title": "My program crashes on the Windows machine yet it works fine on the Linux", "body": "<p>Sounds like it's stack smashing, or more accurately a <a href=\"https://en.wikipedia.org/wiki/Stack_buffer_overflow\" rel=\"nofollow noreferrer\">stack buffer overflow</a>, which is the error message you got. The function has a very large depth, and will keep on pushing variables on the stack. If you push enough variables onto the stack, it'll smash. The computer doesn't have infinite memory for the stack and from the sounds of it, not a crazy amount either.</p>\n\n<p>Given big enough input, it should stack any smash if not optimized well (and might still anyways). Without knowing more about your compiler, there can't be a comprehensive option on how to disable it, but if you're using Microsoft Visual Studio's compiler suite, you can disable the protection <a href=\"https://docs.microsoft.com/en-us/cpp/build/reference/gs-buffer-security-check?view=vs-2017\" rel=\"nofollow noreferrer\">if I understand this doc correctly</a>.</p>\n\n<ol>\n<li>In Solution Explorer, right-click the project and then click Properties  </li>\n<li>In the Property Pages dialog box, click the C/C++ folder.</li>\n<li>Click the Code Generation property page.</li>\n<li>Modify the Buffer Security Check property.</li>\n</ol>\n\n<p>As a warning, <strong>this is not safe</strong> and bad things can happen, so use this at your own risk. </p>\n"}, {"comments": [{"owner": {"reputation": 2653, "user_id": 3515931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c0edddc6a265a0a22058bb2343328d?s=128&d=identicon&r=PG&f=1", "display_name": "JohnH", "link": "https://stackoverflow.com/users/3515931/johnh"}, "reply_to_user": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 0, "creation_date": 1549562008, "post_id": 54564620, "comment_id": 95956133, "body": "@TedLyngmo I amended my comment.  The issue still appears to exist, unless using a compiler other than MSVC with a bigger default program stack limit on windows."}, {"owner": {"reputation": 35613, "user_id": 7582247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OH0qZNY40Y4/AAAAAAAAAAI/AAAAAAAABbc/xAoU3i299E0/photo.jpg?sz=128", "display_name": "Ted Lyngmo", "link": "https://stackoverflow.com/users/7582247/ted-lyngmo"}, "edited": false, "score": 0, "creation_date": 1549562419, "post_id": 54564620, "comment_id": 95956309, "body": "Yes, it&#39;s surely exceeding the stack limit in some environments. 65536(!) is pretty deep."}], "tags": [], "owner": {"reputation": 2653, "user_id": 3515931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c0edddc6a265a0a22058bb2343328d?s=128&d=identicon&r=PG&f=1", "display_name": "JohnH", "link": "https://stackoverflow.com/users/3515931/johnh"}, "is_accepted": true, "score": 1, "last_activity_date": 1549562105, "last_edit_date": 1549562105, "creation_date": 1549499104, "answer_id": 54564620, "question_id": 54563208, "link": "https://stackoverflow.com/questions/54563208/my-program-crashes-on-the-windows-machine-yet-it-works-fine-on-the-linux/54564620#54564620", "title": "My program crashes on the Windows machine yet it works fine on the Linux", "body": "<p>In Visual Studio the default stack size is 1 MB, so with a recursion depth of 65535, and, I believe, a minimum stack frame for caller/function on x64 of this type is 72 bytes, so you will run out of available stack frame space for your program ( I compute almost 4.5Mb of stack needed for this scenario). This also produced the stack buffer overflow error, and has nothing to do with stack smashing other than you went beyond the maximum stack size available to your program when compiled.</p>\n\n<p>Most compilers including Visual Studio let you specify the stack size.</p>\n\n<p>More details:\n<a href=\"https://docs.microsoft.com/en-us/cpp/build/reference/f-set-stack-size?view=vs-2017\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/cpp/build/reference/f-set-stack-size?view=vs-2017</a></p>\n\n<p>[ Edited to reflect 65,535 frames, and not 1.4 billion ]</p>\n"}], "owner": {"reputation": 23, "user_id": 10542737, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kmhlN.jpg?s=128&g=1", "display_name": "scorpio11550", "link": "https://stackoverflow.com/users/10542737/scorpio11550"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 54564620, "answer_count": 2, "score": 1, "last_activity_date": 1549562105, "creation_date": 1549490356, "last_edit_date": 1549490956, "question_id": 54563208, "link": "https://stackoverflow.com/questions/54563208/my-program-crashes-on-the-windows-machine-yet-it-works-fine-on-the-linux", "title": "My program crashes on the Windows machine yet it works fine on the Linux", "body": "<p>I tried to program Ackermann function on my notebook (Win10), however the program crashed at higher values instead of continuing to calculate for a few minutes or hours.</p>\n\n<p>My friend tried the same code on his machine (SUSE) and it worked just fine, then we tried it on the school server (CentOS) and it crashed yet again.</p>\n\n<p>EDIT: It worked on server too, it just needed a second try. It also worked on the other server we had tried... All of it is on Linux.</p>\n\n<p>We suspect the stack overflow is behind it but it's weird, because values aren't THAT HIGH yet. How am I able to preform recursive functions on this system then?</p>\n\n<p>Thanks for all the answers. I'm just curious why it happens and how to make it work on my machine.</p>\n\n<p>I tried to use both C and C++ to no change.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint ackermann (int m, int n);\n\nint main () {\n\n  int m = 4;\n  int n = 1;\n\n  return ackermann(m,n);\n}\n\nint ackermann (int m, int n)\n{\n  if      (m == 0)          return n=n+1;\n  else if (m &gt; 0 &amp;&amp; n == 0) return ackermann(m-1,1);\n  else if (m &gt; 0 &amp;&amp; n &gt; 0)  return ackermann(m-1,ackermann(m,n - 1));\n}\n</code></pre>\n"}, {"tags": ["c", "linked-list", "strtok", "delimited-text"], "comments": [{"owner": {"reputation": 3805, "user_id": 3845803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aG57R.jpg?s=128&g=1", "display_name": "Kon", "link": "https://stackoverflow.com/users/3845803/kon"}, "edited": false, "score": 1, "creation_date": 1549486278, "post_id": 54562319, "comment_id": 95923565, "body": "What is <code>curr-&gt;set</code>?  Are you allocating memory for it before copying into it?"}, {"owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "edited": false, "score": 2, "creation_date": 1549486566, "post_id": 54562319, "comment_id": 95923694, "body": "please show the part of the program where you call <code>deliminator</code>, especially type and initializion of <code>word</code>; Also show the definition of <code>struct node</code>."}, {"owner": {"reputation": 45, "user_id": 10240742, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QY7vdc7WW70/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaP8TwJ8FXnx-BGjzjeDgpuVe8s50A/mo/photo.jpg?sz=128", "display_name": "jay patel", "link": "https://stackoverflow.com/users/10240742/jay-patel"}, "edited": false, "score": 0, "creation_date": 1549487257, "post_id": 54562319, "comment_id": 95923997, "body": "I am allocating the memory before copying into it, the memory is allocated in the struct itself."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1549487337, "post_id": 54562319, "comment_id": 95924031, "body": "Your loop <code>while(root-&gt;next!= NULL){     printf(&quot;%s&quot;,root-&gt;set);     };</code> never changes <code>root</code> \u2014 you need something equivalent to <code>root = root-&gt;next;</code> somewhere in the loop, worrying about whether it is OK to change <code>root</code> itself (it probably isn&#39;t \u2014 you need it to free up the memory)."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1549487436, "post_id": 54562319, "comment_id": 95924076, "body": "Additionally, you never set <i>any</i> node&#39;s <code>next</code> pointer to null, and <code>malloc()</code> cannot safely be relied upon to do that for you.  You need to explicitly set the <code>next</code> (and <code>prev</code>) pointers null where that&#39;s the value those should have."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1549487806, "post_id": 54562319, "comment_id": 95924213, "body": "Is <code>struct node *start</code> intentionally left empty and uninitialized (except for the <code>next</code> pointer)?"}, {"owner": {"reputation": 45, "user_id": 10240742, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QY7vdc7WW70/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaP8TwJ8FXnx-BGjzjeDgpuVe8s50A/mo/photo.jpg?sz=128", "display_name": "jay patel", "link": "https://stackoverflow.com/users/10240742/jay-patel"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1549487860, "post_id": 54562319, "comment_id": 95924234, "body": "i see thanks @JohnBollinger the problem still persists but thanks for the tip, also thank you Johnathon leffler, didnt even notice that, guess im getting a little sloppy."}, {"owner": {"reputation": 45, "user_id": 10240742, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QY7vdc7WW70/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaP8TwJ8FXnx-BGjzjeDgpuVe8s50A/mo/photo.jpg?sz=128", "display_name": "jay patel", "link": "https://stackoverflow.com/users/10240742/jay-patel"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1549487940, "post_id": 54562319, "comment_id": 95924270, "body": "@DavidC.Rankin yes it is, its so i can set root = to that start, I didn&#39;t do that just yet, I am still messing with some other stuff before I do that."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1549488443, "post_id": 54562319, "comment_id": 95924506, "body": "How is <code>struct node</code> defined?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1549488470, "post_id": 54562319, "comment_id": 95924512, "body": "Possible duplicate: <a href=\"https://stackoverflow.com/questions/25385173/what-is-a-debugger-and-how-can-it-help-me-diagnose-problems\">What is a debugger and how can it help me diagnose problems?</a>"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1549488797, "post_id": 54562319, "comment_id": 95924637, "body": "Your <code>deliminator</code> function creates two <code>struct node</code> objects without assigning anything to their <code>set</code> members, and inserts these into the list ahead of any nodes into which you copy tokens.  When you subsequently print the <code>set</code> members of these nodes in <code>main()</code>, you invoke undefined behavior."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1549489824, "post_id": 54562319, "comment_id": 95925089, "body": "Overall, no, you are not having an issue with <code>strtok()</code>.  The usage of that function in your code is just fine.  You do, however, have an impressive variety of issues with details of setting up, maintaining, and examining the contents of your linked list.  I therefore suggest running your program under Valgrind or a similar memory-use checker.  Valgrind ought to recognize all of the specific issues I noticed."}], "answers": [{"tags": [], "owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "is_accepted": true, "score": 1, "last_activity_date": 1549492930, "creation_date": 1549492930, "answer_id": 54563677, "question_id": 54562319, "link": "https://stackoverflow.com/questions/54562319/having-an-issue-with-strtok-in-c/54563677#54563677", "title": "having an issue with strtok in c", "body": "<p>Your code is mostly structured OK, and uses <code>strtok</code> correctly.  But you don't initialize your variables or the fields inside the allocated nodes.  I switched your call from strcpy to strdup so you allocate memory, and used calloc instead of malloc so that the pointers are initialized to null.  In deliminator, you only need to allocate the nodes inside the loop, and just keep a pointer trav to traverse the list, and you can leave the root node alone.</p>\n\n<p>I left if to you to figure out how to not waste the memory on a root node, which you don't really need.  You should just have a root pointer, and pass in its address to deliminator. Also, you should clean up and free the nodes and allocated strings from strdup before you exit.</p>\n\n<pre><code>int  deliminator(char word[], struct node *root) {\n            struct node *trav = root;\n\n            char *token;\n            token = strtok(word,\"-\");\n\n            while(token){\n                            /* this loop is fixed! */\n\n                            printf(\"DEBUG: %s\\n\",token);\n                            struct node *curr  = calloc(1, sizeof(struct node));\n                            curr-&gt;set = strdup(token);\n                            trav-&gt;next = curr;\n                            curr-&gt;prev = trav;\n                            trav = trav-&gt;next;\n\n                            token = strtok(NULL,\"-\");\n            };\n            return(0);\n\n\n}\n\nint main(int argc, char *argv[]){\n            struct node *root = calloc(1, sizeof(struct node));\n            if(argc == 2){\n                            /*only one giant string*/\n                            deliminator(argv[1],root);\n                            root = root-&gt; next;\n                            while(root != NULL){\n                                            printf(\"%s\\n\",root-&gt;set);\n                                            root = root-&gt;next;\n                            }\n            }\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 10240742, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QY7vdc7WW70/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaP8TwJ8FXnx-BGjzjeDgpuVe8s50A/mo/photo.jpg?sz=128", "display_name": "jay patel", "link": "https://stackoverflow.com/users/10240742/jay-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 54563677, "answer_count": 1, "score": 1, "last_activity_date": 1549492930, "creation_date": 1549486072, "last_edit_date": 1549487224, "question_id": 54562319, "link": "https://stackoverflow.com/questions/54562319/having-an-issue-with-strtok-in-c", "title": "having an issue with strtok in c", "body": "<p>I have written some code to help me deliminate dashes in my program for a larger linked list but when I call the class my code gets stuck on the deliminator loop and does not die. I cant even kill it with the kill command I have to open a new ssh client</p>\n\n<pre><code>int  deliminator(char word[], struct node *root){\n    struct node *start =  (struct node*) malloc(sizeof(struct node));\n    struct node *trav = (struct node*) malloc(sizeof(struct node));\n    start-&gt;next= trav;\n    trav-&gt;prev = start;\n\n    char *token;\n    token = strtok(word,\"-\");\n\n    while(token){\n            /* this loop is broken */\n\n            printf(\"%s\",token);\n            struct node *curr  = (struct node*) malloc(sizeof(struct node));\n            strcpy(curr-&gt;set, token);\n            trav-&gt;next = curr;\n            curr-&gt;prev = trav;\n            trav = trav-&gt;next;\n\n            token = strtok(NULL,\"-\");\n    };\n    root-&gt;next = start;\n    return(0);\n\n\n};\n</code></pre>\n\n<p>Also when I try to run the strtok improperly by looping with \ntoken = strtok(token,\"-\"); it gets stuck on the first token. I can't seem to find the problem, a friend of mine suggested that it had to do with the linked list nodes but i removed them and I had the same issue. </p>\n\n<p>I call the deliminator class in this code snippit. </p>\n\n<pre><code>int main(int argc, char *argv[]){\n    struct node *root = (struct node*) malloc(sizeof(struct node));\n    struct node *trav = (struct node*) malloc(sizeof(struct node));\n    root-&gt;next = trav;\n    if(argc == 2){\n    /*only one giant string*/\n    deliminator(argv[1],root);\n    while(root-&gt;next!= NULL){\n    printf(\"%s\",root-&gt;set);\n    };\n</code></pre>\n"}, {"tags": ["c++", "c", "arrays", "multidimensional-array", "arduino"], "comments": [{"owner": {"reputation": 57967, "user_id": 2805305, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/442d249754d1725d9510cf06fa46b964?s=128&d=identicon&r=PG&f=1", "display_name": "bolov", "link": "https://stackoverflow.com/users/2805305/bolov"}, "edited": false, "score": 2, "creation_date": 1549486039, "post_id": 54562271, "comment_id": 95923465, "body": "please create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. What is the type of <code>storage</code>?"}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 0, "creation_date": 1549486062, "post_id": 54562271, "comment_id": 95923469, "body": "We have no idea what <code>storage</code> is."}, {"owner": {"reputation": 344, "user_id": 7753291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3d183f147e8f5265b8bc1f76ef48fb1?s=128&d=identicon&r=PG", "display_name": "Felix Kunz", "link": "https://stackoverflow.com/users/7753291/felix-kunz"}, "edited": false, "score": 0, "creation_date": 1549486151, "post_id": 54562271, "comment_id": 95923508, "body": "sorry... better now?"}, {"owner": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 7, "creation_date": 1549486178, "post_id": 54562271, "comment_id": 95923521, "body": "For array <code>int storage[7]</code> the maximum index you can access is <code>6</code>"}, {"owner": {"reputation": 31368, "user_id": 3133316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30f0b31e22bec21f12f31cd30ae5b148?s=128&d=identicon&r=PG&f=1", "display_name": "PaulMcKenzie", "link": "https://stackoverflow.com/users/3133316/paulmckenzie"}, "edited": false, "score": 4, "creation_date": 1549486194, "post_id": 54562271, "comment_id": 95923528, "body": "<code>int storage[127][7];</code> -- This is an out-of-bounds access: <code>Serial.println(storage[48][7] ,BIN);</code>.  Array indexing starts from 0 and go to <code>n-1</code>, where <code>n</code> is the total number of entries."}, {"owner": {"reputation": 344, "user_id": 7753291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3d183f147e8f5265b8bc1f76ef48fb1?s=128&d=identicon&r=PG", "display_name": "Felix Kunz", "link": "https://stackoverflow.com/users/7753291/felix-kunz"}, "reply_to_user": {"reputation": 12749, "user_id": 7976805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a559df8b4b287aad23724b4c66d67c?s=128&d=identicon&r=PG&f=1", "display_name": "Yksisarvinen", "link": "https://stackoverflow.com/users/7976805/yksisarvinen"}, "edited": false, "score": 0, "creation_date": 1549486303, "post_id": 54562271, "comment_id": 95923572, "body": "@Yksisarvinen Thank you so much! Beginner mistake. I knew arrays start at 0, and i kinda assumed they would start counting there ;)"}, {"owner": {"reputation": 5508, "user_id": 794749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pfE2l.jpg?s=128&g=1", "display_name": "gre_gor", "link": "https://stackoverflow.com/users/794749/gre-gor"}, "edited": false, "score": 0, "creation_date": 1549491964, "post_id": 54562271, "comment_id": 95925885, "body": "<code>int storage[128][8];</code> needs 2048 bytes of memory and an Arduino Uno has only same 2048 bytes of available memory."}, {"owner": {"reputation": 344, "user_id": 7753291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3d183f147e8f5265b8bc1f76ef48fb1?s=128&d=identicon&r=PG", "display_name": "Felix Kunz", "link": "https://stackoverflow.com/users/7753291/felix-kunz"}, "reply_to_user": {"reputation": 5508, "user_id": 794749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pfE2l.jpg?s=128&g=1", "display_name": "gre_gor", "link": "https://stackoverflow.com/users/794749/gre-gor"}, "edited": false, "score": 0, "creation_date": 1549492566, "post_id": 54562271, "comment_id": 95926094, "body": "@gre_gor i&#39;m using the mega ;)"}], "answers": [{"tags": [], "owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "is_accepted": true, "score": 2, "last_activity_date": 1549486748, "creation_date": 1549486748, "answer_id": 54562461, "question_id": 54562271, "link": "https://stackoverflow.com/questions/54562271/2d-array-deletes-elements-itself-when-new-elements-get-stored/54562461#54562461", "title": "2D-Array deletes elements itself when new elements get stored", "body": "<p>You are defining a 2D-array with row-size <code>7</code>, but you access 8 elements of a single row:</p>\n\n<pre><code> int storage[127][7];\n\n storage[48][0] =0b01111110;\n ...\n storage[48][7] =0b01111110;\n</code></pre>\n\n<p>Note that 0..7 are actually 8 elements, not 7. So you'd have to define <code>storage</code> as...</p>\n\n<pre><code> int storage[127][8];\n</code></pre>\n\n<p>One might discuss now if <code>int storage[127][7];storage[48][7] =0b01111110</code> is undefined behaviour;</p>\n\n<p>Yet the most probably behaviour is that <code>storage[48][7]</code> maps to the same memory address as <code>storage[49][0]</code>. Hence, when you assign <code>storage[49][0] =0b00000000;</code>, then you write to <code>storage[48][7]</code> \"as well\" and it will become <code>0b0000000</code>.</p>\n"}], "owner": {"reputation": 344, "user_id": 7753291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3d183f147e8f5265b8bc1f76ef48fb1?s=128&d=identicon&r=PG", "display_name": "Felix Kunz", "link": "https://stackoverflow.com/users/7753291/felix-kunz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "closed_date": 1549874925, "accepted_answer_id": 54562461, "answer_count": 1, "score": -1, "last_activity_date": 1583497871, "creation_date": 1549485859, "last_edit_date": 1583497871, "question_id": 54562271, "link": "https://stackoverflow.com/questions/54562271/2d-array-deletes-elements-itself-when-new-elements-get-stored", "closed_reason": "Not suitable for this site", "title": "2D-Array deletes elements itself when new elements get stored", "body": "<p>edit: I didn't initialise the array with the right size. I should have used 8 instead of 7. I had to learn that Arrays start counting at 0, but when initialising the don't!</p>\n\n<p>I have a 2 dimensional Array storage[x][y] and want to store for each x value 8 different y values. For some reason I can read out a specific place in the array, for example [48][7] and after filling other spaces in the array the [48][7] value has changed even tough I never touched it. </p>\n\n<pre><code>int storage[127][7];\n\nvoid store(){\n storage[48][0] =0b01111110;\n storage[48][1] =0b01111110;\n storage[48][2] =0b11100011;\n storage[48][3] =0b11010011;\n storage[48][4] =0b11001011;\n storage[48][5] =0b11000111;\n storage[48][6] =0b01111110;\n storage[48][7] =0b01111110;\n\n\n   Serial.println(storage[48][7], BIN); // returns 01111110\n\n storage[49][0] =0b00000000;\n storage[49][1] =0b11000001;\n storage[49][2] =0b11000001;\n storage[49][3] =0b11111111;\n storage[49][4] =0b11111111;\n storage[49][5] =0b00000001;\n storage[49][6] =0b00000001;\n storage[49][7] =0b00000000;\n\n   Serial.println(storage[48][7], BIN); // returns 0\n}\n</code></pre>\n\n<p>Depending on the order in which I store the values some of them delete each other. </p>\n\n<p>Why do I suddenly lose data?</p>\n"}, {"tags": ["c", "file", "pointers", "multidimensional-array"], "comments": [{"owner": {"reputation": 526, "user_id": 7611851, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ffa1ed84e91190f288c03d8f7cf8dee?s=128&d=identicon&r=PG&f=1", "display_name": "jjj", "link": "https://stackoverflow.com/users/7611851/jjj"}, "edited": false, "score": 0, "creation_date": 1549485733, "post_id": 54562104, "comment_id": 95923308, "body": "You dont need to allocate that much memory. You only need to multipy by the first number. That does not solve the problem but you should change that."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549566637, "post_id": 54562104, "comment_id": 95958350, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> so we can reproduce the problem and then help you to debug it"}, {"owner": {"reputation": 310, "user_id": 10136694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb62e8d9b3fd5405e7a8af6afaa4258b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Alessandro Aguilar", "link": "https://stackoverflow.com/users/10136694/daniel-alessandro-aguilar"}, "edited": false, "score": 0, "creation_date": 1549567638, "post_id": 54562104, "comment_id": 95958835, "body": "It&#39;s already solved. Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 310, "user_id": 10136694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb62e8d9b3fd5405e7a8af6afaa4258b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Alessandro Aguilar", "link": "https://stackoverflow.com/users/10136694/daniel-alessandro-aguilar"}, "edited": false, "score": 0, "creation_date": 1549488711, "post_id": 54562190, "comment_id": 95924601, "body": "I tried to declare <code>readed</code> as you mention with out assign memory to each location of the array, but now the compiler fails with the error <code>free(): invalid pointer. Abort (core dumped)</code>"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 310, "user_id": 10136694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb62e8d9b3fd5405e7a8af6afaa4258b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Alessandro Aguilar", "link": "https://stackoverflow.com/users/10136694/daniel-alessandro-aguilar"}, "edited": false, "score": 0, "creation_date": 1549488770, "post_id": 54562190, "comment_id": 95924627, "body": "@DanielAlessandroAguilar You should only <code>free</code> what you <code>malloc</code>, specifically <code>free(readed)</code> only."}, {"owner": {"reputation": 310, "user_id": 10136694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb62e8d9b3fd5405e7a8af6afaa4258b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Alessandro Aguilar", "link": "https://stackoverflow.com/users/10136694/daniel-alessandro-aguilar"}, "edited": false, "score": 0, "creation_date": 1549488932, "post_id": 54562190, "comment_id": 95924696, "body": "I&#39;m not calling <code>free</code> function, I just change the pointer declaration and delete the <code>for</code> that allocate memory in every position."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 310, "user_id": 10136694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb62e8d9b3fd5405e7a8af6afaa4258b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Alessandro Aguilar", "link": "https://stackoverflow.com/users/10136694/daniel-alessandro-aguilar"}, "edited": false, "score": 0, "creation_date": 1549489165, "post_id": 54562190, "comment_id": 95924805, "body": "@DanielAlessandroAguilar See my edit.  You&#39;re writing / reading too many bytes."}, {"owner": {"reputation": 310, "user_id": 10136694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb62e8d9b3fd5405e7a8af6afaa4258b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Alessandro Aguilar", "link": "https://stackoverflow.com/users/10136694/daniel-alessandro-aguilar"}, "edited": false, "score": 0, "creation_date": 1549489542, "post_id": 54562190, "comment_id": 95924948, "body": "Thanks, your edit solve my problem, I&#39;ve thinking that thrid parameter to <code>fread</code> / <code>fwrite</code> was the size on bytes of every element on the array."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 1, "last_activity_date": 1549489144, "last_edit_date": 1549489144, "creation_date": 1549485465, "answer_id": 54562190, "question_id": 54562104, "link": "https://stackoverflow.com/questions/54562104/how-to-read-a-multidimensional-array-and-store-it-in-a-pointer/54562190#54562190", "title": "How to read a multidimensional array and store it in a pointer", "body": "<p>You have two different data structures here, each with a different layout.</p>\n\n<p><code>writed</code> is a 3 dimensional array of <code>char</code>, meaning that all of the memory of the array is contiguous.  In contrast, <code>readed</code> is a pointer to an array of <code>char **</code>, each of which points to an array of <code>char *,</code>each of which points to an array of <code>char</code>, and none of those need be continuous.</p>\n\n<p>To have a similar data structure, you need declare <code>readed</code> as a pointer to a 2D array and allocate space for enough of those for a 3D array:</p>\n\n<pre><code>char (*readed)[2][512] = malloc(2 * sizeof(char[2][512]));\n</code></pre>\n\n<p>Also, <a href=\"https://stackoverflow.com/questions/605845/do-i-cast-the-result-of-malloc\">don't cast the return value of <code>malloc</code></a>.</p>\n\n<p>You're also writing / reading way more than you need to:</p>\n\n<pre><code>fwrite(writed, 2 * 2 * 512, 2 * 512, writeFile);\n...\nfread(readed, 2 * 2 * 512, 2 * 512, readFile);\n</code></pre>\n\n<p>This says you're reading / writing <code>2 * 512</code> elements, each of which has size <code>2 * 2 * 512</code>.  You're only reading/writing 1 member of that size:</p>\n\n<pre><code>fwrite(writed, 2 * 2 * 512, 1, writeFile);\n...\nfread(readed, 2 * 2 * 512, 1, readFile);\n</code></pre>\n"}], "owner": {"reputation": 310, "user_id": 10136694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb62e8d9b3fd5405e7a8af6afaa4258b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Alessandro Aguilar", "link": "https://stackoverflow.com/users/10136694/daniel-alessandro-aguilar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 54562190, "answer_count": 1, "score": 0, "last_activity_date": 1549489144, "creation_date": 1549485129, "question_id": 54562104, "link": "https://stackoverflow.com/questions/54562104/how-to-read-a-multidimensional-array-and-store-it-in-a-pointer", "title": "How to read a multidimensional array and store it in a pointer", "body": "<p>I'm trying to write and read a <code>char</code> three dimensional array, or said in other words an array of strings arrays.</p>\n\n<p>I've already try to allocate the memory in each part of the array, but it keeps failing with the following error: <code>Segment fault (core dumped)</code></p>\n\n<pre><code>/**\n * Create array to write\n */\nchar writed[2][2][512] = {{\"Hello\", \"World\"}, {\"Bye\", \"World\"}};\n/**\n * Allocate memory\n */\nchar *** readed = (char ***)malloc(sizeof(char **) *2 * 2 * 512);\nfor (int z = 0; z &lt; 2; z++) {\n    readed[z] = (char **)malloc(sizeof(char **) * 2 * 512 );\n    for (int y = 0; y &lt; 2; y++) {\n        readed[z][y] = (char *)malloc(sizeof(char) * 512); \n    }\n}    \n/**\n * Write array\n */\nFILE *writeFile = fopen(\"strings\", \"wb\");\nfwrite(writed, 2 * 2 * 512, 2 * 512, writeFile);\nfclose(writeFile);\n/**\n * Read array\n */\nFILE *readFile = fopen(\"strings\", \"rb\");\nfread(readed, 2 * 2 * 512, 2 * 512, readFile);\nfclose(readFile);\n</code></pre>\n"}, {"tags": ["c", "increment", "operator-precedence", "postfix-operator"], "comments": [{"owner": {"reputation": 864, "user_id": 10913596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1cf12cce6499d0cf89a03500f0808ab?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/10913596/daniel"}, "edited": false, "score": 0, "creation_date": 1549485037, "post_id": 54561978, "comment_id": 95923027, "body": "In case this isn&#39;t clear, precedence and associativity are independent from order of evaluation. It&#39;s understandable how these terms can be confused though."}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1549485952, "post_id": 54561978, "comment_id": 95923412, "body": "<code>a</code> is retrieved for the assignment, then the memory location of <code>a</code> is  incremented (not the retrieved value)."}, {"owner": {"reputation": 198, "user_id": 3832655, "user_type": "registered", "accept_rate": 14, "profile_image": "https://i.stack.imgur.com/wsgoq.jpg?s=128&g=1", "display_name": "aaronvan", "link": "https://stackoverflow.com/users/3832655/aaronvan"}, "edited": false, "score": 0, "creation_date": 1567909494, "post_id": 54561978, "comment_id": 102105570, "body": "I think of the &quot;post&quot; in &quot;postfix&quot; as indicating that the increment occurs <i>after</i> everything else is evaluated. i.e <code>char *str = &quot;FreeBSD&quot;; char increment() { ((*str++) + 1) }</code>, the pointer is de-referenced, the arithmetic is applied, and the value returned (in this case a &#39;G&#39;.) Only then is the increment applied. This was helpful when I began grappling with things like Duff&#39;s Device."}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 5, "last_activity_date": 1549484820, "creation_date": 1549484820, "answer_id": 54562019, "question_id": 54561978, "link": "https://stackoverflow.com/questions/54561978/how-to-justify-c-postfix-increment-operator-with-precedence-table/54562019#54562019", "title": "How to justify C postfix increment operator with precedence table?", "body": "<p>This had nothing to do with precedence.  It's a matter of how the postfix <code>++</code> operator works.</p>\n\n<p>The postfix <code>++</code> operator evaluates to the <strong>current</strong> value of its operand, <em>and</em> has the side effect of incrementing its operand.  In contrast the prefix <code>++</code> operator evaluates to the <strong>incremented</strong> value of its operand.</p>\n\n<pre><code>int a, b;\na = 1;\nb = a++;   // b is 1, a is 2\nb = ++a;   // b is 3, a is 3\n</code></pre>\n\n<p>This behavior of the postfix <code>++</code> operator is documented in section 6.5.2.4p2 of the <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf\" rel=\"noreferrer\">C standard</a>:</p>\n\n<blockquote>\n  <p><strong>The  result  of  the  postfix\n  <code>++</code> operator  is  the  value  of  the  operand.  As  a  side  effect,  the value of the operand object is incremented (that is, the value 1\n  of the appropriate type is added  to  it).</strong>   See  the  discussions  of\n  additive  operators  and  compound  assignment  for information  on \n  constraints,  types,  and  conversions  and  the  effects  of \n  operations  on pointers.   The  value  computation  of  the  result \n  is  sequenced  before  the  side  effect  of updating  the  stored \n  value  of  the  operand.  With  respect  to  an \n  indeterminately-sequenced function call, the operation of postfix\n  <code>++</code> is a single evaluation.  Postfix\n  <code>++</code> on an object with  atomic  type  is  a  read-modify-write  operation  with memory_order_seq_cst memory order semantics.</p>\n</blockquote>\n\n<p>And the prefix <code>++</code> operator is documented in section 6.5.3.1p2:</p>\n\n<blockquote>\n  <p>The value of the operand of the prefix\n  <code>++</code> operator is incremented.  <strong>The result is the new value of the operand after incrementation.</strong>  The expression\n  <code>++E</code> is equivalent to <code>(E+=1)</code> . See  the  discussions  of  additive  operators  and  compound  assignment  for  information  on\n  constraints, types, side effects, and conversions and the effects of\n  operations on pointers.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "is_accepted": true, "score": 2, "last_activity_date": 1549484917, "creation_date": 1549484917, "answer_id": 54562042, "question_id": 54561978, "link": "https://stackoverflow.com/questions/54561978/how-to-justify-c-postfix-increment-operator-with-precedence-table/54562042#54562042", "title": "How to justify C postfix increment operator with precedence table?", "body": "<p>The precedence happens during the <em>parsing</em>. It means that <code>++</code> applies to <code>a</code>, not to <code>b = a</code>.</p>\n\n<p>But <code>++</code> means <em>post</em> incrementation, so performed <em>after</em> <code>a</code> is evaluated to be assigned to <code>b</code></p>\n\n<p>If you want both to take the value <code>2</code> perform a pre-incrementation:</p>\n\n<pre><code>b = ++a;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "is_accepted": false, "score": 3, "last_activity_date": 1549494171, "last_edit_date": 1549494171, "creation_date": 1549486449, "answer_id": 54562405, "question_id": 54561978, "link": "https://stackoverflow.com/questions/54561978/how-to-justify-c-postfix-increment-operator-with-precedence-table/54562405#54562405", "title": "How to justify C postfix increment operator with precedence table?", "body": "<p>Precedence <em>only</em> determines which operators are grouped with which operands during parsing.  It <em>does not</em> control order of evaluation. <code>++</code> having a higher precedence than <code>=</code> only means that <code>b = a++</code> is parsed as <code>b = (a++)</code> rather than <code>(b = a)++</code>.  </p>\n\n<p>The <code>++</code> operator (both unary and postfix forms) has a <em>result</em> and a <em>side effect</em>.  In the expression <code>b = a++</code>, the <em>result</em> of <code>a++</code> is the current value of <code>a</code> - that's what gets assigned to <code>b</code>.  The <em>side effect</em> of <code>a++</code> is to add 1 to <code>a</code>. </p>\n\n<p>The order in which the assignment to <code>b</code> and the update to <code>a</code> occur is <em>unspecified</em>.  The most straightforward is</p>\n\n<pre><code>b &lt;- a\na &lt;- a + 1\n</code></pre>\n\n<p>but the following is also allowed:</p>\n\n<pre><code>tmp &lt;- a\na &lt;- a + 1\nb &lt;- tmp\n</code></pre>\n\n<p>The result of <code>++a</code> is the current value of <code>a</code> plus 1, and the side effect is to add 1 to <code>a</code>.  <em>Do not assume</em> that in an expression like <code>b = ++a</code> that <code>a</code> is updated before <code>b</code>.  Again, the order of evaluation could be something like</p>\n\n<pre><code>b &lt;- a + 1\na &lt;- a + 1\n</code></pre>\n\n<p>The actual evaluation order depends on your compiler, optimization settings, even the surrounding code.  </p>\n\n<p>The only operators that force left-to-right evaluation of expressions are the <code>&amp;&amp;</code>, <code>||</code>, <code>?:</code>, and comma operators.  </p>\n"}], "owner": {"reputation": 189, "user_id": 3899226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/004f07dd584e5fde25df84cdea3c9079?s=128&d=identicon&r=PG&f=1", "display_name": "user153245", "link": "https://stackoverflow.com/users/3899226/user153245"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 1, "accepted_answer_id": 54562042, "answer_count": 3, "score": 2, "last_activity_date": 1582204310, "creation_date": 1549484673, "last_edit_date": 1582204310, "question_id": 54561978, "link": "https://stackoverflow.com/questions/54561978/how-to-justify-c-postfix-increment-operator-with-precedence-table", "title": "How to justify C postfix increment operator with precedence table?", "body": "<p>I am working with the C operator precedence table to better understand the operator precedence of C. I am having a problem understanding the results of the following code:</p>\n\n<pre><code>int a, b;\na = 1;\nb = a++;   // does not seem to follow C operator precedence\n</code></pre>\n\n<p>Using the precedence table of C operators, I can not explain why with the postfix <code>++</code> operator, first the assignment is evaluated and then the increment.</p>\n\n<p>The postfix increment operator (<code>++</code>) has the highest precedence in C and the assignment operator (<code>=</code>) has the lowest precedence. So in the above code first postfix <code>++</code> must executed and then assignment <code>=</code>. Therefore both variables <code>a</code> and <code>b</code> should equal 2 but they don't.</p>\n\n<p>Why does the C operator precedence seems not to work with this code?</p>\n\n<p>When doesn't the highest precedence of postfix <code>++</code> show itself?</p>\n"}, {"tags": ["c", "size", "fixed", "strlen"], "answers": [{"comments": [{"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "reply_to_user": {"reputation": 1924, "user_id": 2669042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c66a47707c3d1748c9977727ddfa4d50?s=128&d=identicon&r=PG", "display_name": "xing", "link": "https://stackoverflow.com/users/2669042/xing"}, "edited": false, "score": 0, "creation_date": 1549490384, "post_id": 54561785, "comment_id": 95925309, "body": "That probably doesn&#39;t help either :-)"}, {"owner": {"reputation": 1067, "user_id": 218010, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JbwMv.jpg?s=128&g=1", "display_name": "Alper", "link": "https://stackoverflow.com/users/218010/alper"}, "edited": false, "score": 0, "creation_date": 1549493247, "post_id": 54561785, "comment_id": 95926322, "body": "I&#39;ve corrected the code, first one is copied from previous (old) app, length of char was 6 (still it was wrong, because last index should be 5 in this condition). But for now index numbering is not issue.."}, {"owner": {"reputation": 1067, "user_id": 218010, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JbwMv.jpg?s=128&g=1", "display_name": "Alper", "link": "https://stackoverflow.com/users/218010/alper"}, "edited": false, "score": 0, "creation_date": 1549495851, "post_id": 54561785, "comment_id": 95927149, "body": "In addition, is &quot;0&quot; differ than &#39;0&#39;? So I need to learn more about C.. I&#39;ll inform after trying on arduino.Than thank you for your (detailed and helpful) answer.."}, {"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 1, "creation_date": 1549517284, "post_id": 54561785, "comment_id": 95931811, "body": "Yes, single and double quotes are completely different in C. &#39;0&#39; (or &#39;x&#39;, or &#39;?&#39;) is a single integer--the ASCII value of one character. &#39;0&#39; is just a fancy way of writing the number 48. &quot;0&quot; (or &quot;x&quot; or &quot;ImATeapot&quot;) is a pointer to a character that begins a sequence of characters ending with a 0. C doesn&#39;t really have a &quot;string&quot; type like other languages."}], "tags": [], "owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "is_accepted": true, "score": 2, "last_activity_date": 1549490853, "last_edit_date": 1549490853, "creation_date": 1549483870, "answer_id": 54561785, "question_id": 54561658, "link": "https://stackoverflow.com/questions/54561658/how-to-add-a-char-zero-at-the-end-of-char-array-in-c/54561785#54561785", "title": "How to add a char (zero) at the end of char array in C?", "body": "<p>At least three problems. First, <code>temp_char[]</code> is declared at size 5, but you're trying to put 6 characters into it with \"EEEEE\" (which has a trailing zero), and by using <code>temp_char[5]</code> (only values 0..4 are legal).</p>\n\n<p>Second, the assignment <code>temp_char = \"EEEEE\"</code> just changes the pointer, it doesn't actually copy anything into <code>temp_char</code>. You need <code>strcpy()</code> or something similar for that. </p>\n\n<p>Third, you're confusing types:</p>\n\n<pre><code>temp_char[4] = \"0\";\n</code></pre>\n\n<p><code>temp_char[4]</code> is of type <code>char</code>. <code>\"0\"</code> is of type <code>char *</code>, that is, it's a pointer to a character, not a character, so you're just getting the lower 8 bits of some random memory address.  You probably mean:</p>\n\n<pre><code>temp_char[4] = '0';\n</code></pre>\n\n<p>because <code>'0'</code> is of type <code>int</code>, representing an ASCII value, that will be properly truncated to 8 bits on assignment.</p>\n"}], "owner": {"reputation": 1067, "user_id": 218010, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JbwMv.jpg?s=128&g=1", "display_name": "Alper", "link": "https://stackoverflow.com/users/218010/alper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1154, "favorite_count": 0, "accepted_answer_id": 54561785, "answer_count": 1, "score": 0, "last_activity_date": 1550490772, "creation_date": 1549483396, "last_edit_date": 1550490772, "question_id": 54561658, "link": "https://stackoverflow.com/questions/54561658/how-to-add-a-char-zero-at-the-end-of-char-array-in-c", "title": "How to add a char (zero) at the end of char array in C?", "body": "<p>I am newbie in C (I'm using Delphi/pascal instead) and trying to get some temperature sensor values and make them equal/fixed size to send to the MCU (with Arduino IDE- so I have to work with C).</p>\n\n<p>Length of data (strlen()) can be 3(like 5.3, 0.9, 0.0 etc), 4(like -4.2, 19.8 etc) or 5(like -15.6) based on temp sensor and below code;</p>\n\n<pre><code>    char value[5]; // must be char in order to send to MCU\n    if ((temp_data&gt;=temp_max){\n      fix_size(value,true); //Error part. writes: \"EEEEE\" to reach fix size: 5\n    } else {\n      dtostrf(temp_data, 0, 1, value);\n     fix_size(value,false); //I'll use this to send data to screen later..\n    }\n</code></pre>\n\n<p>I need to fixed the size of data (to do that I am trying to add zeros at the end) and Iam trying to do with below;</p>\n\n<pre><code>char fix_size(char temp_char[5],bool err=false){\n  if(err){\n    temp_char= \"EEEEE\";\n    Serial.println(temp_char);\n    return temp_char;\n  }\n  int num = strlen(temp_char);\n  // If strlen is 5 then it is OK and strlen cannot be 2 and 1 because of my temp sensor data processing (dtostrf(temp_data, 0, 1, value)) so I only need to take care 3 and 4\n  switch (num) {\n    case 3:\n      temp_char[3] = \"0\";\n      temp_char[4] = \"\\0\";\n      //0.0 would become 0.000\n      //5.4 would become 5.400\n    break;\n    case 4:\n      temp_char[4] = \"\\0\";\n      //15.2 would become 15.20\n      //-7.4 would become -7.40\n    break;\n      // -15.3 is in right format already\n  }                              | E.g. I tried for 15.4 and get\n  Serial.println(temp_char[0]);  | 1\n  Serial.println(temp_char[1]);  | 5\n  Serial.println(temp_char[2]);  | .\n  Serial.println(temp_char[3]);  | 4\n  Serial.println(temp_char[4]);  | \u061f\n  return temp_char;\n}\n</code></pre>\n\n<p>But, when I execute the app I am taking strange characters as output in ArduinoIDE (reversed question marks, squares etc..).\nWhat can be the problem?How can I solve this problem? or can you suggest better way? thanks right now..</p>\n\n<p>NOTE: Origin of this question (problem) is more about Embedded Systems and I've asked another question on Electronics StackExchage as a reference to this question (If you want/need <a href=\"https://electronics.stackexchange.com/questions/420019/sending-array-data-from-arduino-mega-2560-to-nextion-and-explode-the-data-for-re\">you can read here</a>)</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549483383, "post_id": 54561636, "comment_id": 95922291, "body": "How do you invoke it?"}, {"owner": {"reputation": 66610, "user_id": 2411320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5kF5N.jpg?s=128&g=1", "display_name": "gsamaras", "link": "https://stackoverflow.com/users/2411320/gsamaras"}, "edited": false, "score": 0, "creation_date": 1549483450, "post_id": 54561636, "comment_id": 95922318, "body": "How do you execute your code? Are you sure the first if&#39;s condition is not satisfied? That condition seems fine."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549483654, "post_id": 54561636, "comment_id": 95922400, "body": "Soo..? Is your edit changing anything in the question?"}, {"owner": {"reputation": 117, "user_id": 11006304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/868653dd90dc31acdd518433040d95ca?s=128&d=identicon&r=PG&f=1", "display_name": "user11006304", "link": "https://stackoverflow.com/users/11006304/user11006304"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549483716, "post_id": 54561636, "comment_id": 95922432, "body": "@EugeneSh. it finds if there are equal arguments but if there aren&#39;t it doesn&#39;t print them in the file."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549483773, "post_id": 54561636, "comment_id": 95922468, "body": "did you see what the first two comments are asking for? Also the contents of the input file are needed"}, {"owner": {"reputation": 117, "user_id": 11006304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/868653dd90dc31acdd518433040d95ca?s=128&d=identicon&r=PG&f=1", "display_name": "user11006304", "link": "https://stackoverflow.com/users/11006304/user11006304"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549483869, "post_id": 54561636, "comment_id": 95922514, "body": "@EugeneSh. ./prog file.txt new laura anna milano"}, {"owner": {"reputation": 117, "user_id": 11006304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/868653dd90dc31acdd518433040d95ca?s=128&d=identicon&r=PG&f=1", "display_name": "user11006304", "link": "https://stackoverflow.com/users/11006304/user11006304"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549484018, "post_id": 54561636, "comment_id": 95922578, "body": "@EugeneSh. no, it&#39;s ./prog file.txt new laura anna milano"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1549484090, "post_id": 54561636, "comment_id": 95922607, "body": "Well, time to use a debugger."}, {"owner": {"reputation": 15221, "user_id": 1023911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wln26.jpg?s=128&g=1", "display_name": "Werner Henze", "link": "https://stackoverflow.com/users/1023911/werner-henze"}, "edited": false, "score": 0, "creation_date": 1549484116, "post_id": 54561636, "comment_id": 95922621, "body": "How do you call your program? What is the file&#39;s content?"}, {"owner": {"reputation": 117, "user_id": 11006304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/868653dd90dc31acdd518433040d95ca?s=128&d=identicon&r=PG&f=1", "display_name": "user11006304", "link": "https://stackoverflow.com/users/11006304/user11006304"}, "reply_to_user": {"reputation": 15221, "user_id": 1023911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wln26.jpg?s=128&g=1", "display_name": "Werner Henze", "link": "https://stackoverflow.com/users/1023911/werner-henze"}, "edited": false, "score": 0, "creation_date": 1549484166, "post_id": 54561636, "comment_id": 95922637, "body": "@WernerHenze I call it with ./prog file.txt new laura anna milano and the file contains three strings on each line. If one line contains the three strings I passed, it doesn&#39;t print it in the file, otherwise it should print it."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549484349, "post_id": 54561636, "comment_id": 95922718, "body": "Just realized that the <code>fopen</code> mode is not appropriate.. but there is already an answer about that."}], "answers": [{"comments": [{"owner": {"reputation": 117, "user_id": 11006304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/868653dd90dc31acdd518433040d95ca?s=128&d=identicon&r=PG&f=1", "display_name": "user11006304", "link": "https://stackoverflow.com/users/11006304/user11006304"}, "edited": false, "score": 0, "creation_date": 1549484377, "post_id": 54561872, "comment_id": 95922732, "body": "Does fprintf always automatically print at the end of the file?"}, {"owner": {"reputation": 15221, "user_id": 1023911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wln26.jpg?s=128&g=1", "display_name": "Werner Henze", "link": "https://stackoverflow.com/users/1023911/werner-henze"}, "edited": false, "score": 0, "creation_date": 1549484417, "post_id": 54561872, "comment_id": 95922745, "body": "<code>&quot;w+&quot;</code> might better suit the questioners needs. BTW, your new code still shows <code>&quot;rw&quot;</code>."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 15221, "user_id": 1023911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wln26.jpg?s=128&g=1", "display_name": "Werner Henze", "link": "https://stackoverflow.com/users/1023911/werner-henze"}, "edited": false, "score": 0, "creation_date": 1549484495, "post_id": 54561872, "comment_id": 95922783, "body": "@WernerHenze <code>w+</code> isn&#39;t appropriate here because it truncates the file."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "reply_to_user": {"reputation": 117, "user_id": 11006304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/868653dd90dc31acdd518433040d95ca?s=128&d=identicon&r=PG&f=1", "display_name": "user11006304", "link": "https://stackoverflow.com/users/11006304/user11006304"}, "edited": false, "score": 0, "creation_date": 1549484585, "post_id": 54561872, "comment_id": 95922829, "body": "@user11006304 It will print wherever the file pointer happens to be.  In your case, you start reading at the beginning and continue until the end, so it prints at the end."}, {"owner": {"reputation": 15221, "user_id": 1023911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wln26.jpg?s=128&g=1", "display_name": "Werner Henze", "link": "https://stackoverflow.com/users/1023911/werner-henze"}, "edited": false, "score": 0, "creation_date": 1549484612, "post_id": 54561872, "comment_id": 95922838, "body": "@dbush Good point. <code>&quot;a+&quot;</code> would be the mode that creates the file if it not exists."}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 2, "last_activity_date": 1549484432, "last_edit_date": 1549484432, "creation_date": 1549484233, "answer_id": 54561872, "question_id": 54561636, "link": "https://stackoverflow.com/questions/54561636/how-to-compare-argv-and-another-string/54561872#54561872", "title": "How to compare argv and another string?", "body": "<p>You're not opening the file correctly:</p>\n\n<pre><code>in = fopen(argv[1], \"rw\");\n</code></pre>\n\n<p><code>rw</code> is not a valid mode.  If you want to open for reading and writing, use <code>r+</code> instead.  Also, don't forget to check if <code>fopen</code> failed.</p>\n\n<pre><code>in = fopen(argv[1], \"r+\");\nif (!in) {\n    perror(\"fopen failed\");\n    exit(1);\n }\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 11006304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/868653dd90dc31acdd518433040d95ca?s=128&d=identicon&r=PG&f=1", "display_name": "user11006304", "link": "https://stackoverflow.com/users/11006304/user11006304"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 54561872, "answer_count": 1, "score": 2, "last_activity_date": 1549484624, "creation_date": 1549483308, "last_edit_date": 1549484624, "question_id": 54561636, "link": "https://stackoverflow.com/questions/54561636/how-to-compare-argv-and-another-string", "title": "How to compare argv and another string?", "body": "<p>It's like my code doesn't compare the two. I don't understand why. It's the first if condition that gives me trouble. How can I do to solve the problem?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint main(int argc, char *argv[]){\n    FILE *in;\n    in = fopen(argv[1], \"rw\");\n    char s1[30], s2[30], s3[30];\n\n    if(strcmp(argv[2], \"new\") == 0){\n        while(fscanf(in, \"%s %s %s\", s1,s2,s3) == 3){\n            if(strcmp(s1, argv[3]) == 0 &amp;&amp; strcmp(s2,argv[4])==0 &amp;&amp; strcmp(s3, argv[5])==0){\n                printf(\"Errore! Cartolina gi\u00e0 esistente.\\n\");\n                exit(0);\n            }\n        }\n        fprintf(in, \"%s %s %s\\n\", argv[3], argv[4], argv[5]);\n    }\n\n    if(strcmp(argv[2], \"find\") == 0){\n        while(fgets(s1, 30, in) != NULL){\n            if(strstr(s1, argv[3]) != NULL){\n                printf(\"%s\", s1);\n            }\n        }\n    }\n\n    return 0;\n\n\n}\n</code></pre>\n\n<p>EDIT: I just realized that I used \"r\" instead of \"rw\" but it still doesn't print argv[3], argv[4] and argv[5] in the file.</p>\n"}, {"tags": ["c", "arrays", "struct", "char", "segmentation-fault"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549481708, "post_id": 54561256, "comment_id": 95921611, "body": "Please properly indent your code."}, {"owner": {"reputation": 47115, "user_id": 235354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/097d761861529df52a6800744f1074d2?s=128&d=identicon&r=PG", "display_name": "jspcal", "link": "https://stackoverflow.com/users/235354/jspcal"}, "edited": false, "score": 0, "creation_date": 1549481917, "post_id": 54561256, "comment_id": 95921699, "body": "Perhaps compile with debugging and look at the stack trace when it crashes?"}, {"owner": {"reputation": 25589, "user_id": 15727, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FFivc.jpg?s=128&g=1", "display_name": "Thomas Padron-McCarthy", "link": "https://stackoverflow.com/users/15727/thomas-padron-mccarthy"}, "edited": false, "score": 0, "creation_date": 1549482005, "post_id": 54561256, "comment_id": 95921734, "body": "And also, for us to be able to help you, you need to show us the actual code. What you have shown here doesn&#39;t compile, so you can&#39;t have been running it. But a suggestion is to compile with warnings enabled, and pay attention to what your compiler tells you!"}, {"owner": {"reputation": 19, "user_id": 7891792, "user_type": "registered", "profile_image": "https://graph.facebook.com/1315160468537801/picture?type=large", "display_name": "Lagging", "link": "https://stackoverflow.com/users/7891792/lagging"}, "reply_to_user": {"reputation": 25589, "user_id": 15727, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FFivc.jpg?s=128&g=1", "display_name": "Thomas Padron-McCarthy", "link": "https://stackoverflow.com/users/15727/thomas-padron-mccarthy"}, "edited": false, "score": 0, "creation_date": 1549482244, "post_id": 54561256, "comment_id": 95921837, "body": "@thomasPadron-mccarthy It compiles and runs using g++ and in the linux terminal? It would run for you"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549482285, "post_id": 54561256, "comment_id": 95921857, "body": "<code>g++</code> is a C++ compiler, not C."}, {"owner": {"reputation": 25589, "user_id": 15727, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FFivc.jpg?s=128&g=1", "display_name": "Thomas Padron-McCarthy", "link": "https://stackoverflow.com/users/15727/thomas-padron-mccarthy"}, "edited": false, "score": 0, "creation_date": 1549482329, "post_id": 54561256, "comment_id": 95921875, "body": "@Lagging: Errors on &quot;return one&quot; and for a missing semicolon."}, {"owner": {"reputation": 15221, "user_id": 1023911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wln26.jpg?s=128&g=1", "display_name": "Werner Henze", "link": "https://stackoverflow.com/users/1023911/werner-henze"}, "edited": false, "score": 0, "creation_date": 1549482381, "post_id": 54561256, "comment_id": 95921898, "body": "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, focus on <i>minimal</i>."}, {"owner": {"reputation": 19, "user_id": 7891792, "user_type": "registered", "profile_image": "https://graph.facebook.com/1315160468537801/picture?type=large", "display_name": "Lagging", "link": "https://stackoverflow.com/users/7891792/lagging"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549482414, "post_id": 54561256, "comment_id": 95921912, "body": "@EugeneSh. G++ also will compile C. Source: <a href=\"https://www.cs.utah.edu/~germain/PPS/Topics/C_Language/compiling_C_programs.html\" rel=\"nofollow noreferrer\">cs.utah.edu/~germain/PPS/Topics/C_Language/&hellip;</a>"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549482680, "post_id": 54561256, "comment_id": 95922027, "body": "That page is utterly wrong with it&#39;s premise &quot;<i>but since C is directly compatible with C++</i>. It is not. In both ways."}, {"owner": {"reputation": 25589, "user_id": 15727, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FFivc.jpg?s=128&g=1", "display_name": "Thomas Padron-McCarthy", "link": "https://stackoverflow.com/users/15727/thomas-padron-mccarthy"}, "edited": false, "score": 0, "creation_date": 1549482766, "post_id": 54561256, "comment_id": 95922065, "body": "@Lagging: g++ will compile C++. That source claims that &quot;C is directly compatible with C++&quot;, and that is not true, whatever they mean by &quot;directly compatible&quot;. C and C++ are different languages. It doesn&#39;t seem to be the cause of your problems in this case, but it can cause you all sorts of grief if you believe them. Again: Compile with warnings enabled, and pay attention to what your compiler tells you!"}, {"owner": {"reputation": 401, "user_id": 7926640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15aaf0885ac6a86de3d42c23139abdb2?s=128&d=identicon&r=PG&f=1", "display_name": "stensal", "link": "https://stackoverflow.com/users/7926640/stensal"}, "edited": false, "score": 0, "creation_date": 1549520510, "post_id": 54561256, "comment_id": 95932923, "body": "This is a live test of your code: <a href=\"https://segfault.stensal.com/a/ZSzd8TakLlQFeQ9A\" rel=\"nofollow noreferrer\">segfault.stensal.com/a/ZSzd8TakLlQFeQ9A</a>,  it seems there is an array out-of-bounds read at line 120.   I combined your code into one file, so the line # might be off a little bit."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 7891792, "user_type": "registered", "profile_image": "https://graph.facebook.com/1315160468537801/picture?type=large", "display_name": "Lagging", "link": "https://stackoverflow.com/users/7891792/lagging"}, "edited": false, "score": 0, "creation_date": 1549483698, "post_id": 54561674, "comment_id": 95922423, "body": "Thank you for pointing this out. Unfortunately my code hits the segmentation fault before that line is executed. So it is still giving me the error of segmentation fault."}, {"owner": {"reputation": 25589, "user_id": 15727, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FFivc.jpg?s=128&g=1", "display_name": "Thomas Padron-McCarthy", "link": "https://stackoverflow.com/users/15727/thomas-padron-mccarthy"}, "reply_to_user": {"reputation": 19, "user_id": 7891792, "user_type": "registered", "profile_image": "https://graph.facebook.com/1315160468537801/picture?type=large", "display_name": "Lagging", "link": "https://stackoverflow.com/users/7891792/lagging"}, "edited": false, "score": 0, "creation_date": 1549484574, "post_id": 54561674, "comment_id": 95922822, "body": "The program doesn&#39;t crash for me. But have you checked the other warnings? About sizeof?"}, {"owner": {"reputation": 19, "user_id": 7891792, "user_type": "registered", "profile_image": "https://graph.facebook.com/1315160468537801/picture?type=large", "display_name": "Lagging", "link": "https://stackoverflow.com/users/7891792/lagging"}, "edited": false, "score": 0, "creation_date": 1549484829, "post_id": 54561674, "comment_id": 95922931, "body": "Thomas pador-mccarthy Yes I am trying a new condtion to loop through infix[]"}], "tags": [], "owner": {"reputation": 25589, "user_id": 15727, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FFivc.jpg?s=128&g=1", "display_name": "Thomas Padron-McCarthy", "link": "https://stackoverflow.com/users/15727/thomas-padron-mccarthy"}, "is_accepted": false, "score": 0, "last_activity_date": 1549483433, "creation_date": 1549483433, "answer_id": 54561674, "question_id": 54561256, "link": "https://stackoverflow.com/questions/54561256/c-segmentation-fault-trying-to-put-the-top-of-a-stack-into-a-char-array/54561674#54561674", "title": "C - Segmentation fault trying to put the top of a Stack into a Char array", "body": "<p>After fixing some errors, so the code compiles, you will get several warnings from the compiler. One of them is this:</p>\n\n<pre><code>foo.c:183:18: warning: format \u2018%s\u2019 expects argument of type \u2018char *\u2019, but argument 2 has type \u2018int\u2019 [-Wformat=]\n         printf(\"%s\",postfix[x]);\n                 ~^  ~~~~~~~~~~\n                 %d\n</code></pre>\n\n<p>You are using the wrong format specifier. <code>postfix[x]</code> is a character (which is converted to integer in this case, thus the warning about \"int\"), not a string. You should use <code>\"%c\"</code> and not <code>\"%s\"</code>.</p>\n\n<p>After this change, the program no longer crashes when I run it.</p>\n"}], "owner": {"reputation": 19, "user_id": 7891792, "user_type": "registered", "profile_image": "https://graph.facebook.com/1315160468537801/picture?type=large", "display_name": "Lagging", "link": "https://stackoverflow.com/users/7891792/lagging"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1549483433, "creation_date": 1549481662, "last_edit_date": 1549482166, "question_id": 54561256, "link": "https://stackoverflow.com/questions/54561256/c-segmentation-fault-trying-to-put-the-top-of-a-stack-into-a-char-array", "title": "C - Segmentation fault trying to put the top of a Stack into a Char array", "body": "<p>I am getting a segmentation fault in my code and am unable to explain why. I am writing a program that takes a infix expression and converts to postfix using a stuct stack.</p>\n\n<p>Heres my main and declaration of methods as well as declaration of of my stack:</p>\n\n<pre><code>#define LINELN 72\n#define STACKSZ 25 \n#define NEWLN '\\n' \n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\ntypedef struct stack {\nchar data[STACKSZ];\nint top;\n} stack;\n\nvoid initstk(stack *s1);\nint emptystk(stack s1);\nchar peek(stack s);\nint getline(char infix[]);\nvoid push(char item, stack *s);\nchar pop(stack *s);\nint preced(char x);\nvoid processinfix(char infix[], int l, char postifx[]);\n#include &lt;stdio.h&gt;\n\nint main() {\n\nchar infix[LINELN];\nchar postfix[LINELN];\n\nprocessinfix(infix,getline(infix),postfix);\n\n exit(0);\n}\n</code></pre>\n\n<p>My methods that I have tested and that are working are the basic stack manipulation methods:</p>\n\n<pre><code>//makes top of stack -1\nvoid initstk(stack *s1) {\n\ns1-&gt;top=-1;\n}\n\n//returns 1 if stack is empty, 0 otherwise\nint emptystk(stack s) {\n\n\nif(s.top == -1){\nreturn one;\n}\nelse{\n    return 0;\n\n}\n}\n //peeks at top of the stack\nchar peek(stack s) {\nreturn s.data[s.top];\n}\n//pushes value to top of stack \nvoid push(char item, stack *s) {\n   s-&gt;top = s-&gt;top +1;\n   s-&gt;data[s-&gt;top] = item;\n\n}\n//pops off the top of stack and returns it\nchar pop(stack *s) {\n\nchar x;\nx = s -&gt; data[s-&gt;top];\ns-&gt; top =s-&gt;top-1;\nreturn x;\n}\n//gives character a precedence number according to what it is\nint preced(char x) {\n\nswitch (x) {\n    case '(':\n    case ')':\n        return 3;\n    case '*':\n    case '/':\n    case '%':\n        return 2;\n    case '+':        case '-':\n        return 1;\n  }\n    return 0;\n}\n</code></pre>\n\n<p>I have a function getLine() that takes in user input that would be expression, for example: A+B, and stores it in infix[]</p>\n\n<pre><code>int getline(char infix[]){\n\n    char c;\n    int i=0;\n    printf(\"Type in your expression\");\n    while((c = getchar()) !=NEWLN &amp;&amp; i &lt;= LINELN &amp;&amp; c != ' ' ){\n    infix[i]=c;\n    i++;\n}\nreturn i;   \n\n\n}\n</code></pre>\n\n<p>My next function is what sorts the infix expression and puts it into postfix[]</p>\n\n<pre><code>   void processinfix(char infix[], int inlen, char postfix[])\n  {\n    stack s1;\n    initstk(&amp;s1);\n    printf(\"%d characters are in infix\\n\", inlen);\n    int i =0;       \n    int k=0;\n\n            // while \"i\" isnt bigger then the number of elements in infix\n    while( i&lt;sizeof(infix)){\n\n           /* if infix[i] is a letter send it to post fix right away, \n             increment inlen down one because infix is now smaller by 1 */\n\nif (('a'&lt;=  infix[i]&amp;&amp; infix[i] &lt;= 'z') ||( 'A' &lt;= infix[i]&amp;&amp; infix[i] \n     &lt;='Z')){\n\n        printf(\"%c is a letter, sending to postfix\\n\", infix[i]);\n        postfix[k] = infix[i];\n        inlen--;\n        printf(\"infix has shrinked by 1\\n\");\n        k++;\n\n\n}\n /* else if infix[i] has a higher precedence then whats on top of stack \n  push infix[i] on to stack and increment inlen down 1 */\n  else if(preced(infix[i])&gt;preced( s1.data[s1.top])){\n\n       push(infix[i],&amp;s1);\n       inlen--;\n       printf(\"infix has shrinked by 1\\n\");\n       printf(\"%c is top of stack\\n\", s1.data[s1.top]);\n\n} \n\n   /* else if infix[i] is lower or equal to whats on top of stack. put \n   top of  stack into postfix[] until infix[i] is higher precedene then \n    top of stack. then put it on top of stack and decrease */\n\nelse if(preced(infix[i]) &lt;= preced(s1.data[s1.top])){\n\n       printf(\"%c is  higher or equal  then %c\\n\", s1.data[s1.top], \n       infix[i]);\n\n    while (preced(infix[i])&lt;=preced(s1.data[s1.top])){\n        postfix[k] = s1.data[s1.top];\n        printf(\"%c is put into postfix expression\\n\", s1.data[s1.top]);\n        pop(&amp;s1);\n        k++;\n\n }\n\n    push(infix[i], &amp;s1);\n    inlen--;\n    printf(\"%c is now the top\\n\", s1.data[s1.top]);\n\n }\n\n// if nothing is left in infix pop stack until s1.top = -1 \n\nif(inlen==0){\n     printf(\"nothing left in infix\\n\");\n     while (s1.top!= -1){\n     printf(\"sendin %c to postfix\\n\", s1.data[s1.top]);\n     postfix[k]=s1.data[s1.top]\n     pop(&amp;s1);\n     k++;\n}\n\nbreak;\n}\n\ni++;\n}\n\n// print postfix\nint x=0;\nwhile(x&lt;= sizeof(postfix)){\nprintf(\"%s\",postfix[x]);\nx++;\n}\nprintf(\"\\n\");\n}\n</code></pre>\n\n<p>The output that I am getting is</p>\n\n<pre><code>Type in your expressionA+B\n3 characters are in infix\nA is a letter, sending to postfix\ninfix has shrinked by 1\ninfix has shrinked by 1\n+ is top of stack\nB is a letter, sending to postfix\ninfix has shrinked by 1\nnothing left in infix\nsending + to postfix\nSegmentation fault\n</code></pre>\n\n<p>so everything is running fine until it runs into</p>\n\n<pre><code>if(inlen==0){\n    printf(\"nothing left in infix\\n\");\n    while (s1.top!= -1){\n    printf(\"sendin %c to postfix\\n\", s1.data[s1.top]);\n    THIS LINE -&gt; postfix[k]=s1.data[s1.top]&lt;-THIS LINE\n    pop(&amp;s1);\n    k++;\n}\n</code></pre>\n\n<p>Postfix[k] = s1.data[s1.top]; works earliar in the while loops but just not here. Any ideas on why?</p>\n"}, {"tags": ["c", "pthreads", "shared-memory"], "comments": [{"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1549480806, "post_id": 54560918, "comment_id": 95921205, "body": "Don&#39;t use <code>assert()</code> this way."}, {"owner": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "reply_to_user": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1549480941, "post_id": 54560918, "comment_id": 95921260, "body": "is assert the only problem here???"}, {"owner": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1549481157, "post_id": 54560918, "comment_id": 95921356, "body": "No, none of your code makes any sense at all."}, {"owner": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "reply_to_user": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1549481224, "post_id": 54560918, "comment_id": 95921388, "body": "may i ask for some hints for this? would be grateful."}, {"owner": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "reply_to_user": {"reputation": 5821, "user_id": 3185968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffc0f4eda45ce3e2ff4249afbfdac43e?s=128&d=identicon&r=PG&f=1", "display_name": "EOF", "link": "https://stackoverflow.com/users/3185968/eof"}, "edited": false, "score": 0, "creation_date": 1549481255, "post_id": 54560918, "comment_id": 95921402, "body": "the case what i am trying is invalid or there are some problems in my source ... :-("}], "answers": [{"comments": [{"owner": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "edited": false, "score": 0, "creation_date": 1549481821, "post_id": 54561228, "comment_id": 95921655, "body": "thanks for pointing out this in my ugly code. I will go further with this ugly code now ... :-)"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "edited": false, "score": 0, "creation_date": 1549481982, "post_id": 54561228, "comment_id": 95921723, "body": "@EricIpsum this is not the alone error in your code, warning"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "edited": false, "score": 0, "creation_date": 1549482327, "post_id": 54561228, "comment_id": 95921874, "body": "@EricIpsum <i>counter</i> is wrongly managed to be the guard of the signal / signal waiting"}, {"owner": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "edited": false, "score": 0, "creation_date": 1549482462, "post_id": 54561228, "comment_id": 95921931, "body": "what was that??"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "edited": false, "score": 0, "creation_date": 1549483027, "post_id": 54561228, "comment_id": 95922166, "body": "@EricIpsum I mean you set <i>counter</i> to 1 under the <i>mutex2</i> in <i>task2</i>, so first possibility <i>task&#39;4</i> already finished because <i>counter</i> was 0 when it got the <i>mutext2</i>, else <i>task4</i> will wait the signal <i>after</i> you send it but the signal is not buffered so it will never be received"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "edited": false, "score": 0, "creation_date": 1549491703, "post_id": 54561228, "comment_id": 95925807, "body": "@EricIpsum I edited my answer to add more explanation"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 2, "last_activity_date": 1549492017, "last_edit_date": 1549492017, "creation_date": 1549481501, "answer_id": 54561228, "question_id": 54560918, "link": "https://stackoverflow.com/questions/54560918/pthread-execution-fall-in-infinite-loop/54561228#54561228", "title": "pthread execution fall in infinite loop", "body": "<blockquote>\n  <p>But my program falls in infinite loop. </p>\n</blockquote>\n\n<p>you do</p>\n\n<pre><code>while (counter &gt; 0) {\n  pthread_cond_wait(&amp;cond_one, &amp;mutex2);\n  printf(\"waiting for signal. \\n\");\n}\n</code></pre>\n\n<p>but <em>counter</em> is just set to 1 one time in <em>task2</em>, no reason to go out of the while</p>\n\n<p>Anyway this is not the alone problem, in <em>task2</em> under <em>mutext2</em> <em>counter</em> is set to 1 and the signal is sent, so </p>\n\n<ul>\n<li><p>first possibility <em>task4</em> already finished before it was set to 1,  the signal is useless</p></li>\n<li><p>else <em>task2</em> is faster to run and get <em>mutex2</em> before <em>task4</em>, so when <em>task4</em> will get <em>mutex2</em> the signal was already sent, but the signal is not buffered so it will never be received by <em>task4</em></p></li>\n</ul>\n\n<p>If you want to be sure the code protected by <em>mutex2</em> in <em>task2</em> is executed before <em>task4</em> finishes the code protected by <em>mutex2</em> :</p>\n\n<ul>\n<li><em>counter</em> is still initialized to 0 : <code>int counter = 0;</code></li>\n<li>in <em>task4</em> when <em>mutex2</em> is get just set <em>counter</em> to 1 and remove the useless test <code>if (counter &gt; 0)</code> to send the signal in all cases before to unlock <em>mutext2</em></li>\n<li>in <em>task2</em> when <em>mutext2</em> is get replace the <code>while (counter &gt; 0) {</code> by <code>if (counter == 0) {</code></li>\n</ul>\n\n<p>with that :</p>\n\n<ul>\n<li>if <em>task4</em> get <em>mutex2</em> before <em>task2</em> because <em>counter</em> is still 0 <em>task4</em> waits for the signal (that unlocks <em>mutext2</em>), <em>task2</em> can get <em>mutext2</em> and send the signal and unlock <em>mutext2</em> and finishes, <em>task4</em> receives the signal (that locks <em>mutext2</em>) then unlock <em>mutext2</em> and finishes</li>\n<li>if <em>task2</em> get <em>mutext2</em> before <em>task4</em> it sets <em>counter</em> to 1 and unlock <em>mutext2</em> and finishes, <em>task4</em> can get <em>mutext2</em> and does not wait for the signal because <em>counter</em> is 1 so  unlock <em>mutext2</em> and finishes</li>\n</ul>\n"}], "owner": {"reputation": 543, "user_id": 5734104, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/0dee532a4e2d741503ba8486db8b0bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Ipsum", "link": "https://stackoverflow.com/users/5734104/eric-ipsum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 54561228, "answer_count": 1, "score": -2, "last_activity_date": 1549492017, "creation_date": 1549480296, "last_edit_date": 1549480662, "question_id": 54560918, "link": "https://stackoverflow.com/questions/54560918/pthread-execution-fall-in-infinite-loop", "title": "pthread execution fall in infinite loop", "body": "<p>What i am trying is:</p>\n\n<ul>\n<li>created four thread(main creates 3 thread and thread 3 creates thread 4)</li>\n<li>one shared memory object is shared between all thread.</li>\n<li>another shared memory object is shared between thread two and thread four.</li>\n<li>Thread four waits for signal from thread 2 until shared mem obj is created.</li>\n<li>all are mutually exclusive.</li>\n</ul>\n\n<p>But my program falls in infinite loop. Need help for the solution.</p>\n\n<p>Below is my source code:</p>\n\n<pre><code>#include &lt;assert.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;unistd.h&gt;   /* for ftruncate */\n#include &lt;sys/mman.h&gt; /* for shm_ and mmap */\n#include &lt;sys/stat.h&gt; /* For mode constants */\n#include &lt;fcntl.h&gt;    /* For O_* constants */\n\npthread_t T1, T2, T3, T4;\n\npthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;\npthread_mutex_t mutex2 = PTHREAD_MUTEX_INITIALIZER;\npthread_mutex_t mutex3 = PTHREAD_MUTEX_INITIALIZER;\npthread_cond_t cond_one;\n\nint fd;\nint *shared_heap;\nint *shared_heap2;\nint *shared_heap3;\nint counter = 0;\n\n//thread one creator func\n// *argv is the shared mem obj which is passed while thread is created\nvoid* task1(void *argv) {\n    int *var = (int*) argv;\n    pthread_mutex_lock(&amp;mutex);\n    *var += 1;\n     pthread_mutex_unlock(&amp;mutex);\n    return NULL;\n} \n\n//thread two creator func\n// *argv is the shared mem obj which is passed while thread is created\nvoid* task2(void *argv) {\n    int *var = (int*) argv;\n    pthread_mutex_lock(&amp;mutex);\n    *var += 1;\n\n    pthread_mutex_unlock(&amp;mutex);\n    //another mutex to create another shared mem obj\n    pthread_mutex_lock(&amp;mutex2);\n    shared_heap2 = (int *) mmap(NULL, sizeof(int), PROT_READ | PROT_WRITE,MAP_SHARED, fd, 0);\n    assert(shared_heap2);\n    counter++;\n    //signal \n    if (counter &gt; 0) {\n     pthread_cond_signal(&amp;cond_one);\n        printf(\"signal is sent \\n\");\n   }\n   pthread_mutex_unlock(&amp;mutex2);\n\n  return NULL;\n  }\n\n //thread four creator func\n //created from thread three\n // *argv is the shared mem obj which is passed while thread is created\n void* task4(void *argv) {\n    int *var = (int*) argv;\n    pthread_mutex_lock(&amp;mutex);\n    *var += 1;\n    pthread_mutex_unlock(&amp;mutex);\n\n    pthread_mutex_lock(&amp;mutex2);\n\n    //waiting for signal from thread two\n    while (counter &gt; 0) {\n    pthread_cond_wait(&amp;cond_one, &amp;mutex2);\n    printf(\"waiting for signal. \\n\");\n }\n\n    *shared_heap2 = 9;\n    pthread_mutex_unlock(&amp;mutex2);\n\n\n    return NULL;  \n}\n\n////thread three creator func\nvoid* task3(void *argv) {\n     int *var = (int*) argv;\n     pthread_mutex_lock(&amp;mutex);\n     *var += 1;\n    pthread_mutex_unlock(&amp;mutex);\n\n    //thread four is create from here\n     assert(pthread_create(&amp;T4, NULL, &amp;task4, var) == 0);\n    assert(pthread_join(T4, NULL) == 0);\n     return NULL;\n}\n\nint main(void) {\n\n    pthread_cond_init(&amp;cond_one, NULL);\n     fd = shm_open(\"test_shared_var_heap_local\", O_CREAT | O_RDWR,S_IRUSR | S_IWUSR);\n    assert(fd != -1);\n    assert(ftruncate(fd, sizeof(int)) == 0);\n    shared_heap = (int *) mmap(NULL, sizeof(int), PROT_READ | PROT_WRITE,MAP_SHARED, fd, 0);\n\n    assert(shared_heap);\n\n    printf(\"main \\n\");\n    //assert(shared_heap);\n\n    assert(pthread_create(&amp;T1, NULL, &amp;task1, shared_heap) == 0);\n\n    assert(pthread_create(&amp;T2, NULL, &amp;task2, shared_heap) == 0);\n\n    assert(pthread_create(&amp;T3, NULL, &amp;task3, shared_heap) == 0);\n    printf(\"three \\n\");\n\n    assert(pthread_join(T1, NULL) == 0);\n    assert(pthread_join(T3, NULL) == 0);\n    assert(pthread_join(T2, NULL) == 0);\n\n     return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "printf"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1549480109, "post_id": 54560843, "comment_id": 95920879, "body": "The order is unspecified. But this is also an undefined behavior to <code>c++</code> twice without sequence point in between."}], "answers": [{"tags": [], "owner": {"reputation": 368, "user_id": 2904562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77e6e82a71d9209170823146567abca2?s=128&d=identicon&r=PG&f=1", "display_name": "Michal Butterweck", "link": "https://stackoverflow.com/users/2904562/michal-butterweck"}, "is_accepted": false, "score": 3, "last_activity_date": 1549480151, "creation_date": 1549480151, "answer_id": 54560889, "question_id": 54560843, "link": "https://stackoverflow.com/questions/54560843/what-is-the-order-of-excecution-of-printf-parameters/54560889#54560889", "title": "What is the order of excecution of printf(..) parameters?", "body": "<p>The order of evaluation of function arguments is unspecified. As ++ operator has side effects - it is undefined behavior to make two side effects inside one expression (function call).</p>\n"}, {"tags": [], "owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "is_accepted": true, "score": 5, "last_activity_date": 1549480473, "creation_date": 1549480473, "answer_id": 54560970, "question_id": 54560843, "link": "https://stackoverflow.com/questions/54560843/what-is-the-order-of-excecution-of-printf-parameters/54560970#54560970", "title": "What is the order of excecution of printf(..) parameters?", "body": "<p>The order of evaluation of the arguments in a function call is unspecified,\nand there is no sequence point between the evaluation of these expressions. This means that - if one expression alters as a side effect an object (like the value of <code>c</code>) which is also accessed by another expression - it is unpredictable what the outcome of these expressions will be. For that reason, the language defines such cases as <em>undefined behaviour</em> (cf., for example, <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.5p2\" rel=\"noreferrer\">this</a> online C standard draft):</p>\n\n<blockquote>\n  <p><strong>6.5 Expressions</strong></p>\n  \n  <p>2.) If a side effect on a scalar object is unsequenced relative to\n  either a different side effect on the same scalar object or a value\n  computation using the value of the same scalar object, the behavior is\n  undefined. ...</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": false, "score": 1, "last_activity_date": 1549480641, "creation_date": 1549480641, "answer_id": 54561014, "question_id": 54560843, "link": "https://stackoverflow.com/questions/54560843/what-is-the-order-of-excecution-of-printf-parameters/54561014#54561014", "title": "What is the order of excecution of printf(..) parameters?", "body": "<p>The order in which arguments to a function are evaluated is not defined by the C standard. The order in which arguments are <em>passed</em> to a function are normally defined by the calling convention, though that still leaves the order of evaluation up to the compiler.</p>\n\n<p>For example, if you have a calling convention where parameters are pushed on the stack right to left (this is ubiquitous on x86-32), the assembly generated for <code>printf(\"%d %d\", c, c++);</code> might look like:</p>\n\n<pre><code>push eax ; arg 3\npush edx ; arg 2\npush offset format_string\ncall _printf\nadd esp, 12\n</code></pre>\n\n<p>However, we still can't reason about which order <code>eax</code> and <code>edx</code> were populated with the value of <code>c</code> and <code>c++</code>.</p>\n"}], "owner": {"reputation": 166, "user_id": 7217757, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154902716958189/picture?type=large", "display_name": "Tom&#225;s Arturo Herrera Castro", "link": "https://stackoverflow.com/users/7217757/tom%c3%a1s-arturo-herrera-castro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "closed_date": 1549488661, "accepted_answer_id": 54560970, "answer_count": 3, "score": 0, "last_activity_date": 1549480641, "creation_date": 1549479973, "question_id": 54560843, "link": "https://stackoverflow.com/questions/54560843/what-is-the-order-of-excecution-of-printf-parameters", "closed_reason": "Duplicate", "title": "What is the order of excecution of printf(..) parameters?", "body": "<p>I want to do something like this <code>printf(\"%d,%d\",array[c], array[c+1])</code>, with only one variable that increases in every iteration. I wrote the following code, and I expected \"1,2\" to stdout, I was wrong:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main()\n{\n    int c = 1;\n    printf(\"%d,%d\",c++,c++); /* 2,1 */\n    //printf(\"%d,%d\",c,c++);   /* 2,1 */\n    //printf(\"%d,%d\",c++,c);   /* 1,2 */\n}\n</code></pre>\n\n<p>If I try doing <code>printf(\"%d,%d\",c++,c)</code> and  <code>printf(\"%d,%d\",c,c++)</code>, I can see that there is no defined order of execution of the \"c++\" statements.</p>\n\n<p>Could somebody explain how the code I wrote compiles to ? And why and how does it change according to the position of the \"c++\" statements. </p>\n"}, {"tags": ["c", "linux", "compiler-errors", "permission-denied", "cunit"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 7, "creation_date": 1549480352, "post_id": 54560808, "comment_id": 95920993, "body": "Switch to a native IDE. Seriously, the hassle doesn&#39;t worth it."}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 1, "creation_date": 1549530877, "post_id": 54560808, "comment_id": 95937545, "body": "Agree with Eugene. I&#39;ve never quite understood the desire to make Windows like Linux and Linux like Windows. When in Rome do as the Romans do and most of the problems go away."}], "owner": {"reputation": 21, "user_id": 10192153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fd8be354b2a360f90323b0f1b0c69a0?s=128&d=identicon&r=PG&f=1", "display_name": "Dave M", "link": "https://stackoverflow.com/users/10192153/dave-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 213, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549530800, "creation_date": 1549479803, "last_edit_date": 1549530800, "question_id": 54560808, "link": "https://stackoverflow.com/questions/54560808/cant-create-precompiled-header-z-usr-include-stdio-h-gch-permission-denied", "title": "Can&#39;t create precompiled header Z:\\usr\\include\\stdio.h.gch: Permission denied", "body": "<p>I'm using a Debian9 Linux and Cpp-Dev using Wine. I'm currently trying to run some CUnit tests which were written for a program (protocol stack written in C) developed in 2006/2007. (which I need to update later)</p>\n\n<p>There is:</p>\n\n<ul>\n<li>...Unittest.dev file, so Dev-Cpp was used</li>\n<li>...Unittest.layout file</li>\n<li>CUnit folder, from 2006</li>\n<li>suites folder, with two test suites</li>\n<li>xmlout folder</li>\n<li>main.c</li>\n</ul>\n\n<p>The directory structure is kind a screwed. It gives me a Windows like structure. Although it adds me a Z: drive, where I can access my Linux directories writing the path in Windows style... e.g. <code>Z:\\usr\\</code></p>\n\n<p>I'm adding the directory <code>Z:\\usr\\include\\</code> as include library in the compile options.</p>\n\n<p>Dev-Cpp throws me this error:</p>\n\n<p><code>[Error] can't create precompiled header Z:\\usr\\include\\stdio.h.gch: Permission denied</code></p>\n\n<p>Which is true, it should not try to write something in <code>\\usr\\include.</code></p>\n\n<p>Trying to stick with Dev-Cpp because it was the tool used to create this testing environment.</p>\n\n<p>Work around would be, to use a Windows machine.\nWant to keep the whole environment on Linux if possible.</p>\n\n<p>Any Ideas?</p>\n"}, {"tags": ["c", "memory", "char", "malloc", "corruption"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549479690, "post_id": 54560760, "comment_id": 95920684, "body": "You are allocating <code>sending_data</code> and overwriting it right in the next line."}, {"owner": {"reputation": 7, "user_id": 10674626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7951c7f61bd93a0931bb2ed804cbbd4?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/10674626/sebastian"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549480057, "post_id": 54560760, "comment_id": 95920855, "body": "@EugeneSh. I removed <code>malloc</code> from <code>sending_data</code> and i could not print the size of <code>sending_data</code>."}, {"owner": {"reputation": 15221, "user_id": 1023911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wln26.jpg?s=128&g=1", "display_name": "Werner Henze", "link": "https://stackoverflow.com/users/1023911/werner-henze"}, "edited": false, "score": 0, "creation_date": 1549480122, "post_id": 54560760, "comment_id": 95920890, "body": "Why do you copy the complete read file into a memory location of size <code>USER_SIZE</code> (8) bytes? Are you sure that your file isn&#39;t longer?"}, {"owner": {"reputation": 15221, "user_id": 1023911, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wln26.jpg?s=128&g=1", "display_name": "Werner Henze", "link": "https://stackoverflow.com/users/1023911/werner-henze"}, "edited": false, "score": 0, "creation_date": 1549480163, "post_id": 54560760, "comment_id": 95920910, "body": "Did you try running your program in a debugger? Then you would see the place where it crashes."}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 0, "last_activity_date": 1549480201, "creation_date": 1549480201, "answer_id": 54560904, "question_id": 54560760, "link": "https://stackoverflow.com/questions/54560760/is-there-a-way-to-read-a-text-file-and-save-it-in-a-dynamical-char-array-in-c-t/54560904#54560904", "title": "Is there a way to read a text file and save it in a dynamical char array in C, try it befor and get &#39;malloc(): memory Corruption&#39;", "body": "<p>You're not using <code>printf</code> correctly.</p>\n\n<pre><code>printf(sending_data);\nprintf(strlen(sending_data));\n...\nprintf(data_size);\nprintf(data); \n</code></pre>\n\n<p>The first parameter to <code>printf</code> is a format string that contains text as well as format specifiers stating how to print additional arguments.  You can get away with this with <code>sending_data</code> and <code>data</code> if there are no format specifiers embedded in them, but you have a type mismatch when passing in <code>strlen(sending_data)</code> and <code>data_size</code>.  This invokes <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a>, which in this case causes a crash.</p>\n\n<p>Use a format string to dictate how to print the arguments:</p>\n\n<pre><code>char *sending_data;\n// no need to malloc since you already did that in readFile\nsending_data =readFile(\"../PayloadFiles/ToDo.txt\");\n\nprintf(\"%s\\n\", sending_data);\nprintf(\"%zu\\n\", strlen(sending_data));\n\nint data_size = strlen(sending_data));\ndata = malloc( data_size + 1);\n\nif(data)\n    strcpy((char*)data, sending_data);\n\nprintf(\"%d\\n\", data_size);\nprintf(\"%s\\n\", data); \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 417, "user_id": 8494004, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vymUnsuSdRs/AAAAAAAAAAI/AAAAAAAAAG4/PsFJnuq9eDo/photo.jpg?sz=128", "display_name": "Serge Ageyev", "link": "https://stackoverflow.com/users/8494004/serge-ageyev"}, "is_accepted": false, "score": 0, "last_activity_date": 1549482168, "last_edit_date": 1549482168, "creation_date": 1549480898, "answer_id": 54561083, "question_id": 54560760, "link": "https://stackoverflow.com/questions/54560760/is-there-a-way-to-read-a-text-file-and-save-it-in-a-dynamical-char-array-in-c-t/54561083#54561083", "title": "Is there a way to read a text file and save it in a dynamical char array in C, try it befor and get &#39;malloc(): memory Corruption&#39;", "body": "<p>You should allocate enough space in the <code>data</code> variable.</p>\n\n<pre><code>data = (char*)malloc(strlen(sending_data)+1);\n</code></pre>\n\n<p>It is also good idea to check that <code>sending_data</code> is not null after call to <code>readFile</code>.</p>\n\n<p>You should probably remove call to <code>sending_data = (char*)malloc(USER...)</code> in your main function before call to <code>readFile</code> as it will result memory leak (you allocate memory inside <code>readFile</code> and overwrite <code>sending_data</code> with its result value).</p>\n\n<p>Also, it would be great to call <code>free</code> for allocated memory at end if main function (as it good practice to free what you allocated)</p>\n"}], "owner": {"reputation": 7, "user_id": 10674626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7951c7f61bd93a0931bb2ed804cbbd4?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/10674626/sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 54560904, "answer_count": 2, "score": 0, "last_activity_date": 1549482168, "creation_date": 1549479594, "last_edit_date": 1549480435, "question_id": 54560760, "link": "https://stackoverflow.com/questions/54560760/is-there-a-way-to-read-a-text-file-and-save-it-in-a-dynamical-char-array-in-c-t", "title": "Is there a way to read a text file and save it in a dynamical char array in C, try it befor and get &#39;malloc(): memory Corruption&#39;", "body": "<p>I am programming a C program which should read Textfiles which have different size and save it into <code>char *sending_data</code>. After that it should copy the content of <code>char *sending_data</code> into <code>char *data</code> and print me the size of the <code>*data</code>.</p>\n\n<p>I already have code to read the File and save it into <code>char *sending_data</code>. If I try to copy the content to another <code>char *</code>, I get <code>malloc(): memory corruption error.</code> </p>\n\n<p>And if I try to print the size of <code>sending_data</code> or <code>data</code>, I get the <code>Memory access error.</code></p>\n\n<pre><code>char * readFile(char *path) {\n    FILE *fp;\n    char *data = NULL;\n\n    if ((fp = fopen(path, \"rb\")) == NULL) {\n        printf(\"Fehler!! / Datei konnte nicht gelesen werrden \\n\\n\");\n        return data;\n    } else if (fseek(fp, 0, SEEK_END) != 0) {\n        fclose(fp);\n    } else {\n        long size = ftell(fp);\n        if (size &gt; 0 &amp;&amp; (data = (char *) malloc(size + 1)) != NULL) {\n            fseek(fp, 0, SEEK_SET);\n            if (fread(data, 1, size, fp) != (size_t) size) {\n                free(data);\n                data = NULL;\n            } else {\n                data[size] = '\\0';\n            }\n        }\n        fclose(fp);\n    }\n\n    return data;\n}\n\nint main(int argc, char *argv[]) {\n    /*uint8_t */unsigned char *data;\n\n    int USER_SIZE = 8; // you can also use a macro\n\n    unsigned char *data;\n\n\n    char *sending_data;\n    sending_data =(char*)malloc ( USER_SIZE* sizeof (char));\n\n    sending_data =readFile(\"../PayloadFiles/ToDo.txt\");\n\n    printf(sending_data);\n    printf(strlen(sending_data));\n\n    data = (char*)malloc( USER_SIZE * sizeof(char));\n\n    if(data)\n        strcpy((char*)data, sending_data);\n\n    printf(data_size);\n    printf(data); \n}\n</code></pre>\n\n<p>I expect the content and the size of the file, actually the copied content of the file in an other <code>char *</code> </p>\n"}, {"tags": ["c", "file-io", "double", "fgets"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1549478041, "post_id": 54560302, "comment_id": 95919868, "body": "Please take a look at the compiler warnings/errors. <code>char hGpa = &quot;0.0&quot;;</code> should be <code>char hGpa[] = &quot;0.0&quot;;</code> and the two definitions above similar. And, in C you can&#39;t copy a string with <code>hGpa = gpa;</code> you need <code>strcpy()</code>. Also why don&#39;t you use the <code>s</code> you computed as a loop control, instead of recalculating?"}, {"owner": {"reputation": 17, "user_id": 10931553, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YqUQYTBAtxY/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZUgqImwe-OXVZSlek92z53F4K4Jg/mo/photo.jpg?sz=128", "display_name": "cs_._._", "link": "https://stackoverflow.com/users/10931553/cs"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1549478347, "post_id": 54560302, "comment_id": 95920020, "body": "Alright thanks, I&#39;m going to try this. I was searching up other opinions on stack overflow and everyone seemed to be doing it the way I was doing above."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1549478473, "post_id": 54560302, "comment_id": 95920080, "body": "There may be other issues too. For example <code>fileSize = ftell(fp);</code> won&#39;t tell you the size of the file, it tells you the current position of the file pointer which is <code>0</code> after you open the file."}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 10931553, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YqUQYTBAtxY/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZUgqImwe-OXVZSlek92z53F4K4Jg/mo/photo.jpg?sz=128", "display_name": "cs_._._", "link": "https://stackoverflow.com/users/10931553/cs"}, "edited": false, "score": 0, "creation_date": 1549482355, "post_id": 54560577, "comment_id": 95921887, "body": "OMG thank you so much you explained everything perfectly. This was so helpful!"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 0, "last_activity_date": 1549480339, "last_edit_date": 1549480339, "creation_date": 1549478904, "answer_id": 54560577, "question_id": 54560302, "link": "https://stackoverflow.com/questions/54560302/cant-copy-value-from-one-double-to-another-and-the-variables-reset-to-0/54560577#54560577", "title": "Can&#39;t copy value from one double to another and the variables reset to 0", "body": "<p>For one time I give the messages produces by the compiler :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc -pedantic -Wall c.c\nc.c: In function \u2018main\u2019:\nc.c:37:19: warning: initialization makes integer from pointer without a cast [-Wint-conversion]\n     char hFirst = \"\";\n                   ^~\nc.c:38:18: warning: initialization makes integer from pointer without a cast [-Wint-conversion]\n     char hLast = \"\";\n                  ^~\nc.c:39:17: warning: initialization makes integer from pointer without a cast [-Wint-conversion]\n     char hGpa = \"0.0\";\n                 ^~~~~\nc.c:48:33: warning: format \u2018%s\u2019 expects argument of type \u2018char *\u2019, but argument 2 has type \u2018int\u2019 [-Wformat=]\n       printf(\"current highest: %s, %s, %s\\n\", hFirst, hLast, hGpa);\n                                 ^\nc.c:48:37: warning: format \u2018%s\u2019 expects argument of type \u2018char *\u2019, but argument 3 has type \u2018int\u2019 [-Wformat=]\n       printf(\"current highest: %s, %s, %s\\n\", hFirst, hLast, hGpa);\n                                     ^\nc.c:48:41: warning: format \u2018%s\u2019 expects argument of type \u2018char *\u2019, but argument 4 has type \u2018int\u2019 [-Wformat=]\n       printf(\"current highest: %s, %s, %s\\n\", hFirst, hLast, hGpa);\n                                         ^\nc.c:52:29: warning: passing argument 1 of \u2018atof\u2019 makes pointer from integer without a cast [-Wint-conversion]\n       double numHGpa = atof(hGpa);\n                             ^~~~\nIn file included from c.c:2:0:\n/usr/include/stdlib.h:105:15: note: expected \u2018const char *\u2019 but argument is of type \u2018char\u2019\n extern double atof (const char *__nptr)\n               ^~~~\nc.c:58:16: warning: assignment makes integer from pointer without a cast [-Wint-conversion]\n         hFirst = first;\n                ^\nc.c:59:15: warning: assignment makes integer from pointer without a cast [-Wint-conversion]\n         hLast = last;\n               ^\nc.c:60:14: warning: assignment makes integer from pointer without a cast [-Wint-conversion]\n         hGpa = gpa;\n              ^\nc.c:20:7: warning: unused variable \u2018s\u2019 [-Wunused-variable]\n   int s = sizeof(fileNames) /sizeof(char*); //array consists of 8 char pointers\n       ^\nc.c:18:8: warning: variable \u2018fileSize\u2019 set but not used [-Wunused-but-set-variable]\n   long fileSize;\n        ^~~~~~~~\nc.c:13:9: warning: unused variable \u2018filename\u2019 [-Wunused-variable]\n   char *filename;           //pointer to name of file\n         ^~~~~~~~\nc.c: At top level:\nc.c:73:5: warning: data definition has no type or storage class\n     fclose(fp);\n     ^~~~~~\nc.c:73:5: warning: type defaults to \u2018int\u2019 in declaration of \u2018fclose\u2019 [-Wimplicit-int]\nc.c:73:5: warning: parameter names (without types) in function declaration\npi@raspberrypi:/tmp $ \n</code></pre>\n\n<p>so</p>\n\n<pre><code>char hFirst = \"\";\nchar hLast = \"\";\nchar hGpa = \"0.0\";\n</code></pre>\n\n<p>can be</p>\n\n<pre><code>char * hFirst = \"\";\nchar * hLast = \"\";\nchar * hGpa = \"0.0\";\n</code></pre>\n\n<p><code>long fileSize;</code> and <code>fileSize = ftell(fp)</code> can be removed</p>\n\n<p><code>int s = sizeof(fileNames) /sizeof(char*);</code> can be removed</p>\n\n<p><code>char *filename;</code> can be removed</p>\n\n<p>the final <code>fclose(fp);</code> must be removed</p>\n\n<p>As you see, just asking for the warnings and looking at them allows to remove a lot of errors in your program</p>\n\n<hr>\n\n<p>Of course the compiler cannot check the semantic</p>\n\n<p><code>if(&amp;numGpa &gt; &amp;numHGpa){</code> is probably not what you want, can be <code>if(numGpa &gt; numHGpa){</code></p>\n\n<p>If I put </p>\n\n<pre><code>Jesse,Jordan,0.65\nCharles,Austin,3.23\nPeter,Cole,1.57\nDavid,Hamilton,2.73\n</code></pre>\n\n<p>in one file and I changes <em>fileNames</em> to only have it, the execution is :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ ./a.out\nReading from file #1: in.csv\ncurrent highest: , , 0.0\ngpa read: 0.650000 ++++++ gpa current: 0.000000\ncurrent highest: Charles, s, n\ngpa read: 3.230000 ++++++ gpa current: 0.000000\ncurrent highest: Peter, le, \n\ngpa read: 1.570000 ++++++ gpa current: 0.000000\ncurrent highest: David, Hamilton, ton\ngpa read: 2.730000 ++++++ gpa current: 0.000000\n</code></pre>\n\n<p>the names are not the right ones, this is because you do not duplicate the result of <em>strtok</em> when you save them into <em>hFirst, hLast and hGpa</em> while you always read &amp; <em>strtok</em> using <em>line</em></p>\n\n<p>So one possibility is to change</p>\n\n<pre><code>char * hFirst = \"\";\nchar * hLast = \"\";\nchar * hGpa = \"0.0\";\n...\nhFirst = first;\nhLast = last;\nhGpa = gpa;\n</code></pre>\n\n<p>by :</p>\n\n<pre><code>char * hFirst = strdup(\"\");;\nchar * hLast = strdup(\"\");\nchar * hGpa = strdup(\"0.0\");\n...\nfree(hFirst);\nfree(hLast);\nfree(hGpa);\nhFirst = strdup(first);\nhLast = strdup(last);\nhGpa = strdup(gpa);\n</code></pre>\n\n<p>I initialize with <em>strdup(\"\")</em> etc because of the <code>printf(\"current highest: %s, %s, %s\\n\", hFirst, hLast, hGpa);</code> </p>\n\n<p>To avoid memory leaks change</p>\n\n<pre><code>fclose(fp);\n</code></pre>\n\n<p>by</p>\n\n<pre><code>fclose(fp);\nfree(hFirst);\nfree(hLast);\nfree(hGpa);\n</code></pre>\n\n<p>and the execution is now :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ ./a.out\nReading from file #1: in.csv\ncurrent highest: , , 0.0\ngpa read: 0.650000 ++++++ gpa current: 0.000000\ncurrent highest: Jesse, Jordan, 0.65\n\ngpa read: 3.230000 ++++++ gpa current: 0.650000\ncurrent highest: Charles, Austin, 3.23\n\ngpa read: 1.570000 ++++++ gpa current: 3.230000\ncurrent highest: Charles, Austin, 3.23\n\ngpa read: 2.730000 ++++++ gpa current: 3.230000\n</code></pre>\n\n<p>Under <em>valgrind</em> :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ valgrind ./a.out\n==5547== Memcheck, a memory error detector\n==5547== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\n==5547== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info\n==5547== Command: ./a.out\n==5547== \nReading from file #1: in.csv\ncurrent highest: , , 0.0\ngpa read: 0.650000 ++++++ gpa current: 0.000000\ncurrent highest: Jesse, Jordan, 0.65\n\ngpa read: 3.230000 ++++++ gpa current: 0.650000\ncurrent highest: Charles, Austin, 3.23\n\ngpa read: 1.570000 ++++++ gpa current: 3.230000\ncurrent highest: Charles, Austin, 3.23\n\ngpa read: 2.730000 ++++++ gpa current: 3.230000\n==5547== \n==5547== HEAP SUMMARY:\n==5547==     in use at exit: 0 bytes in 0 blocks\n==5547==   total heap usage: 12 allocs, 12 frees, 5,518 bytes allocated\n==5547== \n==5547== All heap blocks were freed -- no leaks are possible\n==5547== \n==5547== For counts of detected and suppressed errors, rerun with: -v\n==5547== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 6 from 3)\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 10931553, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YqUQYTBAtxY/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZUgqImwe-OXVZSlek92z53F4K4Jg/mo/photo.jpg?sz=128", "display_name": "cs_._._", "link": "https://stackoverflow.com/users/10931553/cs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 54560577, "answer_count": 1, "score": 0, "last_activity_date": 1549480339, "creation_date": 1549477880, "question_id": 54560302, "link": "https://stackoverflow.com/questions/54560302/cant-copy-value-from-one-double-to-another-and-the-variables-reset-to-0", "title": "Can&#39;t copy value from one double to another and the variables reset to 0", "body": "<p>The problem that I have is I am trying to compare 2 numbers. I initialize hGpa as a char '0.0'. when the file is read it gets a gpa value and compares it to hGpa. If it is higher its values is assigned to hGpa. The point of this program is to get the highest GPA. My problem is that the value hGpa is never changed. I'm not sure if I am assigning it incorrectly or if I am placing the variables in the wrong location and they keep getting overwritten. Also I am not to familiar with C so I apologize if it is a stupid mistake. Here is my code</p>\n\n<p>I have already tried making the values global however they just keep resetting to 0.0000.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;dirent.h&gt;\n#include &lt;string.h&gt;\n\n\n#define MAXCHAR 1000\nint main(void){\n\n\n\n  FILE *fp;                 //pointer to file\n  char *filename;           //pointer to name of file\n  char *fileNames[] = {\"CSCI4060U_Lab02_data/1.csv\", \"CSCI4060U_Lab02_data/2.csv\",\n                       \"CSCI4060U_Lab02_data/3.csv\", \"CSCI4060U_Lab02_data/4.csv\",\n                       \"CSCI4060U_Lab02_data/5.csv\", \"CSCI4060U_Lab02_data/6.csv\",\n                       \"CSCI4060U_Lab02_data/7.csv\"};\n  long fileSize;\n\n  int s = sizeof(fileNames) /sizeof(char*); //array consists of 8 char pointers\n                                            //each char consists of 8 bytes in memory\n                                            //so you get 64 / 8 = 8;\n\n\n\n  for(int i = 0                             ; i &lt; sizeof(fileNames)/sizeof(char*); i++){\n\n    printf(\"Reading from file #%d: %s\\n\", i+1, fileNames[i] );\n    fp = fopen(fileNames[i],\"r\");\n    if(fp == NULL){\n      printf(\"Could not open file %s\",fileNames[i]);\n      return 1;\n    }\n    fileSize = ftell(fp);\n    char line[MAXCHAR];\n\n    char hFirst = \"\";\n    char hLast = \"\";\n    char hGpa = \"0.0\";\n\n    while(fgets(line, MAXCHAR, fp) != NULL){\n      //printf(\"%s\\n\",line);\n\n      char* first = strtok(line, \",\");\n      char* last = strtok(NULL, \",\");\n      char* gpa = strtok(NULL,\",\");\n\n      printf(\"current highest: %s, %s, %s\\n\", hFirst, hLast, hGpa);\n\n\n      double numGpa = atof(gpa);\n      double numHGpa = atof(hGpa);\n\n      printf(\"gpa read: %f ++++++ gpa current: %f\\n\",numGpa, numHGpa );\n\n      if(&amp;numGpa &gt; &amp;numHGpa){\n\n        hFirst = first;\n        hLast = last;\n        hGpa = gpa;\n        //printf(\"after assignment: %s, %s, %s\\n\", hFirst, hLast, hGpa);\n      }\n\n\n\n    }\n    fclose(fp);\n\n  }\n\n  return 0;\n}\n    fclose(fp);\n</code></pre>\n\n<p>The sample file I read through is the following:</p>\n\n<pre><code>Jesse,Jordan,0.65\nCharles,Austin,3.23\nPeter,Cole,1.57\nDavid,Hamilton,2.73\n</code></pre>\n\n<p>basically it should enter the if statement 2 times and change the value pointed to by hGpa. Again sorry if I am making any stupid obvious mistakes.</p>\n"}, {"tags": ["c", "multithreading", "race-condition"], "comments": [{"owner": {"reputation": 3693, "user_id": 5494721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WHK5j.png?s=128&g=1", "display_name": "OznOg", "link": "https://stackoverflow.com/users/5494721/oznog"}, "edited": false, "score": 0, "creation_date": 1549478154, "post_id": 54559865, "comment_id": 95919913, "body": "well a minimal eample could be helpful as this is quite a fuzzy problem to me; nevertheless, good lock handling is usually done by having each lock clearly identifying the data it protects, and in your case, I would expect the lock to protect a  t_arena and that&#39;s all, but it seems to protect the count in some way, which is fishy to me..."}, {"owner": {"reputation": 195, "user_id": 8484805, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646240402077569/picture?type=large", "display_name": "Jon Nimrod", "link": "https://stackoverflow.com/users/8484805/jon-nimrod"}, "reply_to_user": {"reputation": 3693, "user_id": 5494721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WHK5j.png?s=128&g=1", "display_name": "OznOg", "link": "https://stackoverflow.com/users/5494721/oznog"}, "edited": false, "score": 0, "creation_date": 1549478459, "post_id": 54559865, "comment_id": 95920075, "body": "How would you suggest making an example ? There is a lot more code than that so I tried to reduce it as much as possible."}], "answers": [{"comments": [{"owner": {"reputation": 195, "user_id": 8484805, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646240402077569/picture?type=large", "display_name": "Jon Nimrod", "link": "https://stackoverflow.com/users/8484805/jon-nimrod"}, "edited": false, "score": 0, "creation_date": 1549480541, "post_id": 54560465, "comment_id": 95921070, "body": "Yes, create_new_pool calls mmap. In case of a MAP_FAILED return from mmap, pthread_mutex_unlock will be called on the mutex, just before returning MAP_FAILED to malloc."}, {"owner": {"reputation": 195, "user_id": 8484805, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646240402077569/picture?type=large", "display_name": "Jon Nimrod", "link": "https://stackoverflow.com/users/8484805/jon-nimrod"}, "edited": false, "score": 0, "creation_date": 1549492092, "post_id": 54560465, "comment_id": 95925927, "body": "Your version does make more sense. About the mutex release, are you talking about the readability ?"}, {"owner": {"reputation": 1686, "user_id": 2615118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6c15506113bb2e6d1ebf17502d71a1c?s=128&d=identicon&r=PG", "display_name": "Julius", "link": "https://stackoverflow.com/users/2615118/julius"}, "reply_to_user": {"reputation": 195, "user_id": 8484805, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646240402077569/picture?type=large", "display_name": "Jon Nimrod", "link": "https://stackoverflow.com/users/8484805/jon-nimrod"}, "edited": false, "score": 0, "creation_date": 1549527041, "post_id": 54560465, "comment_id": 95935594, "body": "@JonNimrod: After reading your comment on the behavior of <code>create_new_pool</code>: Yes, the mutex discussion is just about readability."}], "tags": [], "owner": {"reputation": 1686, "user_id": 2615118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6c15506113bb2e6d1ebf17502d71a1c?s=128&d=identicon&r=PG", "display_name": "Julius", "link": "https://stackoverflow.com/users/2615118/julius"}, "is_accepted": true, "score": 1, "last_activity_date": 1549526524, "last_edit_date": 1549526524, "creation_date": 1549478476, "answer_id": 54560465, "question_id": 54559865, "link": "https://stackoverflow.com/questions/54559865/unable-to-understand-or-fix-race-condition-in-my-program/54560465#54560465", "title": "Unable to understand or fix race condition in my program", "body": "<p>I can spot three issue in your code.</p>\n\n<h1>1. Race condition when two threads create arenas</h1>\n\n<p>This is the race condition you describe in your question:</p>\n\n<blockquote>\n  <p>So I am suspecting that one thread might be reading the value of arena_count just before an other thread is incrementing it, and by the time it finishes reading it, the thread that incremented it releases the new_arena_mutex and the first thread goes in creating an arena with a wrong index.</p>\n</blockquote>\n\n<p>Yes, that can happen. The <em>load</em> from <code>arena_data.arena_count</code> happens atomically, but threads may not generally assume that the value is (still) correct. The modified version <a href=\"https://stackoverflow.com/a/54561301/2615118\">in your answer</a> does <strong>not</strong> fix the problem.</p>\n\n<p>In order to fix that, the following guarantee might be helpful: Any <em>store</em> to <code>arena_data.arena_count</code> happens while holding the <code>new_arena_mutex</code>. As a result, the thread that holds the mutex can safely load <code>arena_data.arena_count</code> (while holding the mutex, of course) and it can be sure that its value does not change until it unlocks the mutex. Let me try to explain by changing and commenting your updated code:</p>\n\n<pre><code>  while (pthread_mutex_trylock(&amp;current_arena-&gt;mutex) != 0) {\n\n    if (arena_index == arena_data.arena_count - 1) {\n// This thread checks the condition above _without_ holding the\n// `new_arena_mutex`. Another thread may hold the mutex (and hence it\n// may increment `arena_count`).\n\n      if (pthread_mutex_trylock(&amp;new_arena_mutex) == 0) {\n// Now, this thread can assume that no other thread writes to\n// `arena_data.arena_count`. However, the condition\n//\n//     arena_index == arena_data.arena_count - 1\n//\n// may no longer be true (because it had been checked before locking).\n\n    if (arena_data.arena_count &lt; M_ARENA_MAX) {\n// This thread may create a new arena at index\n// `arena_data.arena_count`. That is safe because this thread holds\n// the `new_arena_mutex` (preventing other threads from modifying\n// `arena_count`.\n//\n// However, it is possible that `arena_index` is not at the position\n// of the most recently created arena (checked _before_ locking). Let\n// us just assume that all the recently created arenas are still\n// locked. Hence we just skip the check and directly jump to the most\n// recently created arena (as if we failed locking).\n      arena_index = arena_data.arena_count - 1;\n      current_arena = &amp;arena_data.arenas[arena_index];\n      ++arena_data.arena_count;\n      assert(\n        arena_index + 1 == arena_data.arena_count &amp;&amp;\n        \"... and this thread is holding the mutex, so it stays true.\"\n      );\n      creator = true;\n      break;\n    } else {\n      pthread_mutex_unlock(&amp;new_arena_mutex);\n    }\n</code></pre>\n\n<p>In my opinion, the code becomes more readable if you extract those actions into functions such as</p>\n\n<pre><code>// both functions return `arena_index` or `-1`\nint try_find_and_lock_arena();\nint try_create_and_lock_arena();\n</code></pre>\n\n<h1>2. Suspicious (wrong?) post-increment operator</h1>\n\n<p>The post-increment operator in the following line looks wrong to me:</p>\n\n<pre><code>current_arena = &amp;arena_data.arenas[arena_index++];// post-increment\n// now, `&amp;arena_data.arenas[arena_index]` is one beyond `current_arena`.\n</code></pre>\n\n<p>Written in two lines, it may be easier to reason about the behavior:</p>\n\n<pre><code>assert(\n  current_arena == &amp;arena_data.arenas[arena_index] &amp;&amp;\n  \"this is an invariant I expect to hold\"\n);\n\ncurrent_arena = &amp;arena_data.arenas[arena_index];// this is a no-op...\narena_index++;// ... and now, they are out of sync\n\nassert(\n  current_arena == &amp;arena_data.arenas[arena_index] &amp;&amp;\n  \"now, the invariant is broken (and this assert should fire)\"\n);\n</code></pre>\n\n<h1>3. Readability of mutex lock/unlock pairs</h1>\n\n<p>I find it hard to match the mutex' lock/unlock operations for all possible paths because they happen in different scopes.</p>\n\n<pre><code>    // [new_arena_mutex is locked]\n\n    current_pool = create_new_pool(/* ... */, &amp;new_arena_mutex);\n\n    if (current_pool == MAP_FAILED) return NULL;// error-path return\n    // `create_new_pool` unlocks iff it returns `MAP_FAILED`...\n\n    /* ... */\n\n    pthread_mutex_unlock(&amp;new_arena_mutex);\n    // ... otherwise, the mutex is unlocked here\n\n    return user_area(/* ... */);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1686, "user_id": 2615118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6c15506113bb2e6d1ebf17502d71a1c?s=128&d=identicon&r=PG", "display_name": "Julius", "link": "https://stackoverflow.com/users/2615118/julius"}, "edited": false, "score": 0, "creation_date": 1549490525, "post_id": 54561301, "comment_id": 95925367, "body": "The code looks still wrong to me. I updated my answer to explain."}], "tags": [], "owner": {"reputation": 195, "user_id": 8484805, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646240402077569/picture?type=large", "display_name": "Jon Nimrod", "link": "https://stackoverflow.com/users/8484805/jon-nimrod"}, "is_accepted": false, "score": 0, "last_activity_date": 1549493659, "last_edit_date": 1549493659, "creation_date": 1549481854, "answer_id": 54561301, "question_id": 54559865, "link": "https://stackoverflow.com/questions/54559865/unable-to-understand-or-fix-race-condition-in-my-program/54561301#54561301", "title": "Unable to understand or fix race condition in my program", "body": "<p>(EDIT): It doesn't.</p>\n\n<p>This seems to have solved the issue:</p>\n\n<pre><code>    /* Look for an open arena. */\n    current_arena = &amp;arena_data.arenas[0];\n    int arena_index = 0;\n    while (pthread_mutex_trylock(&amp;current_arena-&gt;mutex) != 0) {\n\n        if (arena_index == arena_data.arena_count - 1) {\n\n            if (pthread_mutex_trylock(&amp;new_arena_mutex) == 0) {\n\n                if (arena_data.arena_count &lt; M_ARENA_MAX) {\n                    ++arena_data.arena_count;\n                    creator = true;\n                    break;\n                } else {\n                    pthread_mutex_unlock(&amp;new_arena_mutex);\n                }\n            }\n\n            current_arena = &amp;arena_data.arenas[(arena_index = 0)];\n            continue;\n        }\n\n        current_arena = &amp;arena_data.arenas[arena_index++];\n    }\n\n    /* All arenas are occupied by other threads but M_ARENA_MAX isn't reached. Let's just create a new one. */\n    if (creator == true) {\n\n        current_pool = create_new_pool(MAIN_POOL, chunk_type, size, pagesize, &amp;new_arena_mutex);\n        if (current_pool == MAP_FAILED) return NULL;\n\n        arena_data.arenas[arena_index + 1] = (t_arena){ .main_pool = current_pool };\n        pthread_mutex_init(&amp;arena_data.arenas[arena_index + 1].mutex, NULL);\n        pthread_mutex_lock(&amp;arena_data.arenas[arena_index + 1].mutex);\n        pthread_mutex_unlock(&amp;new_arena_mutex);\n\n        return user_area((t_alloc_chunk *)current_pool-&gt;chunk, size, &amp;arena_data.arenas[arena_index + 1].mutex);\n    }\n</code></pre>\n"}], "owner": {"reputation": 195, "user_id": 8484805, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646240402077569/picture?type=large", "display_name": "Jon Nimrod", "link": "https://stackoverflow.com/users/8484805/jon-nimrod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 54560465, "answer_count": 2, "score": 2, "last_activity_date": 1549526524, "creation_date": 1549476057, "last_edit_date": 1549477619, "question_id": 54559865, "link": "https://stackoverflow.com/questions/54559865/unable-to-understand-or-fix-race-condition-in-my-program", "title": "Unable to understand or fix race condition in my program", "body": "<p>I'm implementing my own version of malloc, which is very similar to the glibc malloc, as in it supports multithreading by creating arenas, which is a memory area that a thread can work on without the risk of competing with another thread.</p>\n\n<p>My data structure are as follow:</p>\n\n<pre><code>typedef struct          s_arena {\n    pthread_mutex_t     mutex;\n    t_pool              *main_pool;\n}                       t_arena;\n\ntypedef struct          s_arena_data {\n    _Atomic int         arena_count;\n    t_arena             arenas[M_ARENA_MAX];\n}                       t_arena_data;\n</code></pre>\n\n<p>t_arena_data is a global variable that contains the number of arenas that have been created, starting at 0 for the first call and capping at M_ARENA_MAX (which I currently define at 8), and an array containing all my arenas.</p>\n\n<p>An arena only contains a mutex, which is initialized with pthread_mutex_init(), and a pointer to a pool of memory. The pool of memory is unimportant for this topic as the race condition occurs before reaching it.</p>\n\n<p>How my program works: as each thread enters the malloc, it tries to pthread_try_lock the mutex of the first arena. If it does, all is well and it proceeds to the allocation which I haven't describe here. If it doesn't, several things can happen.</p>\n\n<p>If the next entry in the array is empty and M_ARENA_MAX isn't reached, a new mutex will be locked in order to create a new arena and add it to the array. The mutex is global, meaning no two threads can be creating an arena simultaneously.</p>\n\n<p>If that mutex is lock, then the thread will loop back to arena[0] and keep searching for an open mutex.</p>\n\n<p>Now, I'm pretty sure the race condition happens because of the variable arena_count. I've observed thanks to the debug printf statements that anytime the function segfaults, M_ARENA_MAX hasn't been reached. If it has, the program will not crash. So I am suspecting that one thread might be reading the value of arena_count just before an other thread is incrementing it, and by the time it finishes reading it, the thread that incremented it releases the new_arena_mutex and the first thread goes in creating an arena with a wrong index.</p>\n\n<p>It's my first multithreaded program so I apologize if my explanation or the code isn't clear, but I've been spending the last 4 hours on this issue and while I think I narrowed down the problem, I really don't know how to solve it.</p>\n\n<p>Here is the part of the code that is faulty:</p>\n\n<pre><code>    current_arena = &amp;arena_data.arenas[0];\n    int arena_index = 0;\n    while (pthread_mutex_trylock(&amp;current_arena-&gt;mutex) != 0) {\n\n        printf(\"THREAD %p READS[0] ARENA COUNT AT %d\\n\", (void *)pthread_self(), arena_data.arena_count);\n        if (arena_index == arena_data.arena_count - 1) {\n            printf(\"THREAD %p READS[1] ARENA COUNT AT %d\\n\", (void *)pthread_self(), arena_data.arena_count);\n\n            if (pthread_mutex_trylock(&amp;new_arena_mutex) != 0 || arena_data.arena_count == M_ARENA_MAX) {\n                current_arena = &amp;arena_data.arenas[(arena_index = 0)];\n                continue;\n            }\n\n            creator = true;\n            break;\n        }\n\n        current_arena = &amp;arena_data.arenas[arena_index++];\n    }\n\n    /* All arenas are occupied by other threads but M_ARENA_MAX isn't reached. Let's just create a new one. */\n    if (creator == true) {\n\n        printf(\"THREAD %p READS[2] ARENA COUNT AT %d\\n\", (void *)pthread_self(), arena_data.arena_count);\n\n        current_pool = create_new_pool(MAIN_POOL, chunk_type, size, pagesize, &amp;new_arena_mutex);\n        if (current_pool == MAP_FAILED) return NULL;\n\n        ++arena_data.arena_count;\n        arena_data.arenas[arena_index + 1] = (t_arena){ .main_pool = current_pool };\n        pthread_mutex_init(&amp;arena_data.arenas[arena_index + 1].mutex, NULL);\n        pthread_mutex_lock(&amp;arena_data.arenas[arena_index + 1].mutex);\n        pthread_mutex_unlock(&amp;new_arena_mutex);\n\n        return user_area((t_alloc_chunk *)current_pool-&gt;chunk, size, &amp;arena_data.arenas[arena_index + 1].mutex);\n    }\n</code></pre>\n\n<p>Here is one of the printf statements, and one that comforts my theory that there is a race condition:</p>\n\n<pre><code>THREAD 0x7f9c3b216700 READS[1] ARENA COUNT AT 4\nTHREAD 0x7f9c3b216700 READS[2] ARENA COUNT AT 5\n</code></pre>\n\n<p>The value should be equal but it's not.</p>\n"}, {"tags": ["c", "openssl", "diffie-hellman"], "comments": [{"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1549484313, "post_id": 54559829, "comment_id": 95922708, "body": "First, codes is a mask which can contain multiple bits.Second, why is 2 a suitable value for g?"}, {"owner": {"reputation": 6282, "user_id": 4706711, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh3.googleusercontent.com/-dlNFOguGD_A/AAAAAAAAAAI/AAAAAAAABwA/BMlWtrTgZtY/photo.jpg?sz=128", "display_name": "Dimitrios Desyllas", "link": "https://stackoverflow.com/users/4706711/dimitrios-desyllas"}, "reply_to_user": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1549487070, "post_id": 54559829, "comment_id": 95923909, "body": "Because this <a href=\"https://tools.ietf.org/html/rfc3526\" rel=\"nofollow noreferrer\">rfc</a> says so"}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1549491634, "post_id": 54559829, "comment_id": 95925775, "body": "<a href=\"https://github.com/openssl/openssl/blob/master/crypto/dh/dh_check.c\" rel=\"nofollow noreferrer\">github.com/openssl/openssl/blob/master/crypto/dh/dh_check.c</a>  Looks like it might be failing <code>p % 24 == 11</code> (line 148)"}, {"owner": {"reputation": 6282, "user_id": 4706711, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh3.googleusercontent.com/-dlNFOguGD_A/AAAAAAAAAAI/AAAAAAAABwA/BMlWtrTgZtY/photo.jpg?sz=128", "display_name": "Dimitrios Desyllas", "link": "https://stackoverflow.com/users/4706711/dimitrios-desyllas"}, "reply_to_user": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1549546415, "post_id": 54559829, "comment_id": 95946755, "body": "So how I can solve it?"}], "owner": {"reputation": 6282, "user_id": 4706711, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh3.googleusercontent.com/-dlNFOguGD_A/AAAAAAAAAAI/AAAAAAAABwA/BMlWtrTgZtY/photo.jpg?sz=128", "display_name": "Dimitrios Desyllas", "link": "https://stackoverflow.com/users/4706711/dimitrios-desyllas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1572450998, "creation_date": 1549475903, "last_edit_date": 1592644375, "question_id": 54559829, "link": "https://stackoverflow.com/questions/54559829/what-checks-should-i-perform-when-i-create-a-diffie-hellman-key-agreement-keys-f", "title": "What checks should I perform when I create a Diffie Hellman Key agreement keys from fixed p and g values using OpenSSL1.1.0g?", "body": "<p>Hello I attempt to make a Diffie Hellman Keys using fixes p and g parameters via this piece of code base upon this <a href=\"https://stackoverflow.com/a/54538811/4706711\">answer</a>:</p>\n<pre><code>#include &lt;openssl/dh.h&gt;\n#include &lt;openssl/bn.h&gt;\n\nint generateKeys(DH *encryptionInfo) {\n int codes;\n BIGNUM *two = BN_new(), *p=NULL;\n\n puts(&quot;Select fixed p and g parameters\\n&quot;);\n\n if(two == NULL) {\n   return -1;\n };\n \n if(p=NULL){\n    BN_free(two);\n    return -1;\n }\n\n BN_set_word(two,2);\n if( 1 != DH_set0_pqg (encryptionInfo, get_rfc3526_prime_2048(p), NULL, two)) return -1;\n\n//  if(1 != DH_generate_parameters_ex(encryptionInfo, 2048, DH_GENERATOR_2, NULL)) return -1;\n puts(&quot;Checking for codes\\n&quot;);\n if(1 != DH_check(encryptionInfo, &amp;codes)) return -1;\n printf(&quot;Codes values %d\\n&quot;, codes);\n switch(codes){\n    case DH_CHECK_P_NOT_PRIME:\n      puts(&quot;DH_CHECK_P_NOT_PRIME\\n&quot;);\n      break;\n    case DH_CHECK_P_NOT_SAFE_PRIME:\n      puts(&quot;DH_CHECK_P_NOT_SAFE_PRIME\\n&quot;);\n      break;\n    case DH_UNABLE_TO_CHECK_GENERATOR:\n      puts(&quot;DH_UNABLE_TO_CHECK_GENERATOR\\n&quot;);\n      break;\n    case DH_NOT_SUITABLE_GENERATOR:\n      puts(&quot;DH_NOT_SUITABLE_GENERATOR\\n&quot;);\n      break;\n    case DH_CHECK_Q_NOT_PRIME:\n      puts(&quot;DH_CHECK_Q_NOT_PRIME\\n&quot;);\n      break;\n    case DH_CHECK_INVALID_Q_VALUE:\n      puts(&quot;DH_CHECK_INVALID_Q_VALUE\\n&quot;);\n      break;\n    case DH_CHECK_INVALID_J_VALUE:\n      puts(&quot;DH_CHECK_INVALID_J_VALUE\\n&quot;);\n      break;\n }\n if(codes != 0) return -1;\n puts(&quot;Generating Keys \\n&quot;);\n if(1 != DH_generate_key(encryptionInfo)) return -1;\n  \n BN_free(two);\n BN_free(p);\n return 0;\n}\n</code></pre>\n<p>But when I try to run this piece of code I get the following error:</p>\n<blockquote>\n<p>Codes values 8</p>\n<p>DH_NOT_SUITABLE_GENERATOR</p>\n</blockquote>\n<p>By omitting the <code>DH_check</code> check seems to work:</p>\n<pre><code>#include &lt;openssl/dh.h&gt;\n#include &lt;openssl/bn.h&gt;\n\nint generateKeys(DH *encryptionInfo) {\n int codes;\n BIGNUM *two = BN_new(), *p=NULL;\n\n puts(&quot;Select fixed p and g parameters\\n&quot;);\n\n if(two == NULL) {\n   return -1;\n };\n \n if(p=NULL){\n    BN_free(two);\n    return -1;\n }\n\n BN_set_word(two,2);\n if( 1 != DH_set0_pqg (encryptionInfo, get_rfc3526_prime_2048(p), NULL, two)) return -1;\n\n//  if(1 != DH_generate_parameters_ex(encryptionInfo, 2048, DH_GENERATOR_2, NULL)) return -1;\n puts(&quot;Checking for codes\\n&quot;);\n puts(&quot;Generating Keys \\n&quot;);\n if(1 != DH_generate_key(encryptionInfo)) return -1;\n  \n BN_free(two);\n BN_free(p);\n return 0;\n}\n</code></pre>\n<p>But I am not sure whether I should do that, what is the recommended way in my case? What checks are required in my case?</p>\n"}, {"tags": ["c", "terminal"], "comments": [{"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1549474547, "post_id": 54559347, "comment_id": 95918310, "body": "Have you considered what type <code>argv</code> is? Have you checked the compiler warnings?"}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1549474698, "post_id": 54559347, "comment_id": 95918383, "body": "I deleted the <a href=\"https://stackoverflow.com/questions/tagged/ubuntu\">ubuntu</a> tag."}, {"owner": {"reputation": 57, "user_id": 9843826, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-55KmoD1XgTo/AAAAAAAAAAI/AAAAAAAAAAA/2Ppf7x1E2ZM/photo.jpg?sz=128", "display_name": "KMM", "link": "https://stackoverflow.com/users/9843826/kmm"}, "edited": false, "score": 0, "creation_date": 1549474801, "post_id": 54559347, "comment_id": 95918436, "body": "I&#39;m not actually getting any compiler warnings which is the strange thing. I know argv is a char** (I did try using char* as well) and I&#39;m not using argv[] although changing it to that hasn&#39;t affected the code output"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1549475089, "post_id": 54559347, "comment_id": 95918589, "body": "@KMM I put some remarks in my answer"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549497260, "post_id": 54559347, "comment_id": 95927545, "body": "to print the command line parameters:  <code>for( int 1; i&lt;argc; i++ ) { printf( &quot;%s\\n&quot;, argv[i] ); }</code>  Note: command line parameters rarely ever contain spaces unless the parameter is enclosed in <code>&quot;</code>s"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549497742, "post_id": 54559347, "comment_id": 95927685, "body": "Note: <code>argv[]</code> is an array of pointers, there are no spaces unless one of the pointers happens to contain a 0x20"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 9843826, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-55KmoD1XgTo/AAAAAAAAAAI/AAAAAAAAAAA/2Ppf7x1E2ZM/photo.jpg?sz=128", "display_name": "KMM", "link": "https://stackoverflow.com/users/9843826/kmm"}, "edited": false, "score": 0, "creation_date": 1549475214, "post_id": 54559486, "comment_id": 95918640, "body": "In the first working code snipped I provide, I&#39;m just trying to print a word at some defaultIndex; in the not working code, I&#39;m just trying to get it to print anything. I changed it to char** but am still getting the same nonsense outputs.  I added a line that sets tok=strtok(argv, &quot; &quot;) but that again doesn&#39;t change any outputs  I am just starting in C so have not yet encountered puts or gets altough I can see how your snippet is more efficient"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 57, "user_id": 9843826, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-55KmoD1XgTo/AAAAAAAAAAI/AAAAAAAAAAA/2Ppf7x1E2ZM/photo.jpg?sz=128", "display_name": "KMM", "link": "https://stackoverflow.com/users/9843826/kmm"}, "edited": false, "score": 1, "creation_date": 1549475386, "post_id": 54559486, "comment_id": 95918721, "body": "@KMM your question is not clear, what is the not working code ? where and what did you changed from &lt;not said&gt; to <code>char **</code>. You need to give the <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a> else it is impossible for us to help you, we do not have a magic crystal ball"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 57, "user_id": 9843826, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-55KmoD1XgTo/AAAAAAAAAAI/AAAAAAAAAAA/2Ppf7x1E2ZM/photo.jpg?sz=128", "display_name": "KMM", "link": "https://stackoverflow.com/users/9843826/kmm"}, "edited": false, "score": 0, "creation_date": 1549475885, "post_id": 54559486, "comment_id": 95918944, "body": "@KMM I edited my answer adding a new case, I cannot do more without more inputs from you"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 1, "last_activity_date": 1549475840, "last_edit_date": 1549475840, "creation_date": 1549474606, "answer_id": 54559486, "question_id": 54559347, "link": "https://stackoverflow.com/questions/54559347/how-to-make-printf-properly-print-a-strtok-of-a-user-input-argv-in-c/54559486#54559486", "title": "How to make printf properly print a strtok of a user input argv in C", "body": "<p>In</p>\n\n<pre><code>char* tok=(char *)malloc(strlen(strtok(sent, \" \")+1));\n</code></pre>\n\n<p>you just allocate a piece of memory whose size depends on the result of <em>strtok</em>, but the result of <em>strtok</em> is <em>not</em> copied into the returned block of memory</p>\n\n<hr>\n\n<pre><code>char* tok=strtok(argv,\" \");\nwhile(tok!=NULL){\n     printf(\"%s\\n\", tok);\n     tok=strtok(NULL,\" \");\n}\n</code></pre>\n\n<p>If <em>argv</em> is the second argument of <em>main</em> that one is not a <em>char*</em> but a <em>char**</em>, so your call is wrong</p>\n\n<p>What did you expect to do ? if it is to print the arguments or the program you have to do something like :</p>\n\n<pre><code>while (*++argv != 0)\n  puts(*argv);\n</code></pre>\n\n<p>If you want to get each word from a group of words given in the first argument of the program :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint main(int argc, char ** argv)\n{\n  if (argc == 2) {\n    char* tok=strtok(argv[1],\" \");\n\n    while(tok!=NULL){\n      printf(\"%s\\n\", tok);\n      tok=strtok(NULL,\" \");\n    }\n  }\n\n  return 0;\n}\n</code></pre>\n\n<p>Execution :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ ./a.out \"aze qsd wxc\"\naze\nqsd\nwxc\n</code></pre>\n\n<p>As you see I have to use a string when I call <em>./a.out</em> else there are 3 argument and the first argument is just <em>aze</em></p>\n\n<hr>\n\n<p>In</p>\n\n<pre><code>int i=0;\nchar* tok=strtok(defaultString,\" \");\nwhile(tok!=NULL){\n         i++;\n         if (i==defaultInd){\n             printf(\"%s \\n\", tok);\n             break;             \n         }\n         tok=strtok(NULL, \" \");\n}  \n</code></pre>\n\n<p>if <em>defaultString</em> is for instance \"11 22 33\" and <em>defaultInd</em> values 2 you will print <em>22</em></p>\n\n<p>but you do not said what are the value of these variables</p>\n"}, {"comments": [{"owner": {"reputation": 117184, "user_id": 9473764, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aGMXl.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/9473764/nick"}, "edited": false, "score": 1, "creation_date": 1549770153, "post_id": 54560228, "comment_id": 96020214, "body": "Code only answers are discouraged. Please <a href=\"https://stackoverflow.com/posts/54560228/edit\">edit</a> your answer and add some commentary as to how this will solve the question, and/or how it differs from previous answers. <a href=\"https://stackoverflow.com/review/low-quality-posts/22164906\">From Review</a>"}], "tags": [], "owner": {"reputation": 13, "user_id": 11021015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jP3Ev.jpg?s=128&g=1", "display_name": "Bartleby T. Scrivener", "link": "https://stackoverflow.com/users/11021015/bartleby-t-scrivener"}, "is_accepted": false, "score": 0, "last_activity_date": 1549477578, "creation_date": 1549477578, "answer_id": 54560228, "question_id": 54559347, "link": "https://stackoverflow.com/questions/54559347/how-to-make-printf-properly-print-a-strtok-of-a-user-input-argv-in-c/54560228#54560228", "title": "How to make printf properly print a strtok of a user input argv in C", "body": "<pre><code>char* tok = strtok(defaultString, \" \");\n    while (tok != NULL){\n        myarg[count]=strdup(tok);\n        count ++;\n        printf(\"%s\\n\", tok);\n        tok = strtok(NULL, \" \");\n    }\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 9843826, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-55KmoD1XgTo/AAAAAAAAAAI/AAAAAAAAAAA/2Ppf7x1E2ZM/photo.jpg?sz=128", "display_name": "KMM", "link": "https://stackoverflow.com/users/9843826/kmm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 54559486, "answer_count": 2, "score": 0, "last_activity_date": 1549477578, "creation_date": 1549474111, "last_edit_date": 1549474681, "question_id": 54559347, "link": "https://stackoverflow.com/questions/54559347/how-to-make-printf-properly-print-a-strtok-of-a-user-input-argv-in-c", "title": "How to make printf properly print a strtok of a user input argv in C", "body": "<p>I am able to use this to print my default string, but when I go to print a user input it does not work--instead I get some random characters and symbols back</p>\n\n<pre><code>int i=0;\nchar* tok=strtok(defaultString,\" \");\nwhile(tok!=NULL){\n         i++;\n         if (i==defaultInd){\n             printf(\"%s \\n\", tok);\n             break;             \n         }\n         tok=strtok(NULL, \" \");\n}    \n</code></pre>\n\n<p>I believe that there is some issue with accessing memory or something store in a memory that I haven't actually initialized yet, but when I try to use </p>\n\n<pre><code>char* tok=(char *)malloc(strlen(strtok(sent, \" \")+1));\n</code></pre>\n\n<p>it just stops printing things period.</p>\n\n<p>My work around had been to print argv using a for loop but I still don't know what the actual problem is.</p>\n\n<p>Here is what I have to print the user input</p>\n\n<pre><code>char* tok=strtok(argv,\" \");\n    while(tok!=NULL){\n         printf(\"%s\\n\", tok);\n         tok=strtok(NULL,\" \");\n    }\n</code></pre>\n\n<p>I get back a series of symbols (alphanumeric, greek, etc) instead of the string I input</p>\n"}, {"tags": ["c", "image-processing", "convolution"], "comments": [{"owner": {"reputation": 144819, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "edited": false, "score": 0, "creation_date": 1549474074, "post_id": 54559268, "comment_id": 95918100, "body": "Your kernel row and column probably don&#39;t start at <code>-offset</code> but at <code>0</code> in the line starting <code>for(int krnRow = -offset</code> and the next line."}, {"owner": {"reputation": 42647, "user_id": 7328782, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/treJu.png?s=128&g=1", "display_name": "Cris Luengo", "link": "https://stackoverflow.com/users/7328782/cris-luengo"}, "edited": false, "score": 0, "creation_date": 1549474424, "post_id": 54559268, "comment_id": 95918267, "body": "(1) This is only a valid dilation if <code>kernel</code> contains only 0 and 1 values. For non-binary kernels, you need to add the image and kernel values. (2) Your result looks indeed like an indexing problem. Unfortunately we can&#39;t tell what&#39;s wrong because you didn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We need to see how <code>imgIn</code> and <code>imgOut</code> are defined to understand where your indexing goes wrong. Likely you&#39;re mixing up width and height of the image."}, {"owner": {"reputation": 95, "user_id": 10942161, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2O-mNIkuoM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca4uC1fQh5VPyzO_iJz1V4SCHJlPg/mo/photo.jpg?sz=128", "display_name": "Tiago Bachiega de Almeida", "link": "https://stackoverflow.com/users/10942161/tiago-bachiega-de-almeida"}, "reply_to_user": {"reputation": 144819, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "edited": false, "score": 0, "creation_date": 1549474833, "post_id": 54559268, "comment_id": 95918457, "body": "@MarkSetchell I did it so my indexing of the pixel neighbours would be more easy."}, {"owner": {"reputation": 95, "user_id": 10942161, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2O-mNIkuoM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca4uC1fQh5VPyzO_iJz1V4SCHJlPg/mo/photo.jpg?sz=128", "display_name": "Tiago Bachiega de Almeida", "link": "https://stackoverflow.com/users/10942161/tiago-bachiega-de-almeida"}, "reply_to_user": {"reputation": 42647, "user_id": 7328782, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/treJu.png?s=128&g=1", "display_name": "Cris Luengo", "link": "https://stackoverflow.com/users/7328782/cris-luengo"}, "edited": false, "score": 0, "creation_date": 1549474930, "post_id": 54559268, "comment_id": 95918510, "body": "@CrisLuengo My kernel only contains  0 and 1 values, sorry for omitting this info. Also, edited the post adding the initialization of both input and output images. My input comes from an 1D array containing the grayscale values of the pixels and my output image is initialized with zeros."}, {"owner": {"reputation": 95, "user_id": 10942161, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2O-mNIkuoM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca4uC1fQh5VPyzO_iJz1V4SCHJlPg/mo/photo.jpg?sz=128", "display_name": "Tiago Bachiega de Almeida", "link": "https://stackoverflow.com/users/10942161/tiago-bachiega-de-almeida"}, "edited": false, "score": 0, "creation_date": 1549478345, "post_id": 54559268, "comment_id": 95920017, "body": "I really think the initialization is ok. I guess the problem is in the if or the kernel loop. When I substitute the if for <i>max = imgIn[idxRow][idxCol]</i> the imgOut looks the same as the imgIn."}, {"owner": {"reputation": 144819, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "edited": false, "score": 1, "creation_date": 1549480167, "post_id": 54559268, "comment_id": 95920912, "body": "Try changing to <code>imgOut[..][..] = idxRow</code> and then try <code>imgOut[..][..] = idxCol</code>."}, {"owner": {"reputation": 95, "user_id": 10942161, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2O-mNIkuoM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca4uC1fQh5VPyzO_iJz1V4SCHJlPg/mo/photo.jpg?sz=128", "display_name": "Tiago Bachiega de Almeida", "link": "https://stackoverflow.com/users/10942161/tiago-bachiega-de-almeida"}, "edited": false, "score": 0, "creation_date": 1549543351, "post_id": 54559268, "comment_id": 95944926, "body": "I&#39;ve tried the suggestions, both gave me correct results. <i>idxRow</i> and <i>idxCol</i> looks ok, also the <i>imgIn[idxRow][idxCol + 1] returned the shifted image, as expected. I printed the *idxRow + offset</i> and <i>idxCol + offset</i> to verify it&#39;s values and I think they&#39;re ok too. Just edited my post with the full code. I still guess the error is inside the kernel loop. but can&#39;t find out where..."}, {"owner": {"reputation": 95, "user_id": 10942161, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2O-mNIkuoM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca4uC1fQh5VPyzO_iJz1V4SCHJlPg/mo/photo.jpg?sz=128", "display_name": "Tiago Bachiega de Almeida", "link": "https://stackoverflow.com/users/10942161/tiago-bachiega-de-almeida"}, "edited": false, "score": 0, "creation_date": 1549545090, "post_id": 54559268, "comment_id": 95945995, "body": "Did a test with a 256x256 image. Gave me a correct result. But I have no ideia why with the big image of 1280x1024 it didn&#39;t works."}, {"owner": {"reputation": 95, "user_id": 10942161, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2O-mNIkuoM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca4uC1fQh5VPyzO_iJz1V4SCHJlPg/mo/photo.jpg?sz=128", "display_name": "Tiago Bachiega de Almeida", "link": "https://stackoverflow.com/users/10942161/tiago-bachiega-de-almeida"}, "edited": false, "score": 0, "creation_date": 1549555257, "post_id": 54559268, "comment_id": 95952244, "body": "Just some more information: when I tried to use a 3x3 kernel, the problem persists, but with three repetitions of the moon. Put the image in my main post."}, {"owner": {"reputation": 95, "user_id": 10942161, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2O-mNIkuoM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca4uC1fQh5VPyzO_iJz1V4SCHJlPg/mo/photo.jpg?sz=128", "display_name": "Tiago Bachiega de Almeida", "link": "https://stackoverflow.com/users/10942161/tiago-bachiega-de-almeida"}, "edited": false, "score": 0, "creation_date": 1549567607, "post_id": 54559268, "comment_id": 95958819, "body": "The shift worked, depending on how much i add to the index, what i think is a normal behaviour. Also, the program worked on a 210 x 240 image. About my input and output, i&#39;m doing this way to put the code in a hardware we use in university, where the systems for input and output are not yet finished. But first I need to test it on my PC. I did a scritp in matlab that reads a image and generates and unsigned char array from it and another script that reads this log file and generates the image. Will add their codes on the question."}, {"owner": {"reputation": 42647, "user_id": 7328782, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/treJu.png?s=128&g=1", "display_name": "Cris Luengo", "link": "https://stackoverflow.com/users/7328782/cris-luengo"}, "edited": false, "score": 0, "creation_date": 1549580716, "post_id": 54559268, "comment_id": 95964289, "body": "Thank you! Now it&#39;s complete, and I can see what the issue is."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 10942161, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2O-mNIkuoM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca4uC1fQh5VPyzO_iJz1V4SCHJlPg/mo/photo.jpg?sz=128", "display_name": "Tiago Bachiega de Almeida", "link": "https://stackoverflow.com/users/10942161/tiago-bachiega-de-almeida"}, "edited": false, "score": 0, "creation_date": 1549590255, "post_id": 54583775, "comment_id": 95966749, "body": "Hi, tried to modify my matlab script but I&#39;m still getting the wrong results. What I did was to remove the <code>rot90</code> and  the <code>flip</code> and replaced the <code>A = reshape(A, imgSizeRow, imgSizeCol);</code> by <code>A = reshape(A, imgSizeCol, imgSizeRow).&#39;;</code>. I also removed the <code>mat2gray</code> as I just realized it&#39;s creating a double matrix."}], "tags": [], "owner": {"reputation": 42647, "user_id": 7328782, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/treJu.png?s=128&g=1", "display_name": "Cris Luengo", "link": "https://stackoverflow.com/users/7328782/cris-luengo"}, "is_accepted": true, "score": 1, "last_activity_date": 1549602736, "last_edit_date": 1549602736, "creation_date": 1549581265, "answer_id": 54583775, "question_id": 54559268, "link": "https://stackoverflow.com/questions/54559268/c-implementation-of-image-processing-dilation-creating-repeated-patterns-on-the/54583775#54583775", "title": "C implementation of image processing dilation creating repeated patterns on the result image", "body": "<p>When converting the image to a linear array, you write each row consecutively (row-major). But then when converting the linear array back to an image, you use this sequence:</p>\n\n<pre class=\"lang-matlab prettyprint-override\"><code>A = reshape(A, imgSizeRow, imgSizeCol);\nA = rot90(A,3);\nI = mat2gray(A);\nI = flip(I, 2);\n</code></pre>\n\n<p>MATLAB is column-major, which is why you needed the <code>rot90</code> in there. But because of that, you should also switch the row and column sizes:</p>\n\n<pre class=\"lang-matlab prettyprint-override\"><code>A = reshape(A, imgSizeCol, imgSizeRow).';\nI = mat2gray(A);\n</code></pre>\n\n<p>Note also that <code>rot90</code> + <code>flip</code> is the same as transposing the matrix, which is what you actually need (going from a row-major matrix to a column-major one, you need to swap the two dimensions, which is what transposing does).</p>\n\n<hr>\n\n<p>You should also fix these two lines of code in your C program:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#define IMG_ROWS 1280\n#define IMG_COLS 1024\n</code></pre>\n\n<p>The image you posted as the input has 502 rows and 622 columns.</p>\n\n<p>I created this MATLAB script:</p>\n\n<pre class=\"lang-matlab prettyprint-override\"><code>% Load image\nI = imread('https://i.stack.imgur.com/0u3bK.png');\nI = I(:,:,1); % Keep only the first channel\n\n% Write image\n[nRows, nCols] = size(I);\ncFile = fopen('image.h', 'w');\nfprintf(cFile, '#define IMG_ROWS %d\\n', nRows);\nfprintf(cFile, '#define IMG_COLS %d\\n', nCols);\nfprintf(cFile, 'unsigned char img[%d] = {', (nRows*nCols));\nfprintf(cFile, '%d,', I.'); % Note transpose!\nfprintf(cFile, '};\\n');\nfclose(cFile);\n\n% Compile &amp; run C code\n!gcc so.c -o so\n!./so\n\n% Load output\nA = dlmread('ps_dil.log');\nA = uint8(A);\nA = reshape(A, nCols, nRows).';\nimshow(A);\n</code></pre>\n\n<p>The file <code>so.c</code> is the C code you posted, but with the two lines defining <code>IMG_ROWS</code> and <code>IMG_COLS</code> removed. The <code>image.h</code> file I create here writes those two lines. This is the output, a perfectly fine dilation:</p>\n\n<p><a href=\"https://i.stack.imgur.com/RNyve.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RNyve.png\" alt=\"output of code above\"></a></p>\n"}], "owner": {"reputation": 95, "user_id": 10942161, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P2O-mNIkuoM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca4uC1fQh5VPyzO_iJz1V4SCHJlPg/mo/photo.jpg?sz=128", "display_name": "Tiago Bachiega de Almeida", "link": "https://stackoverflow.com/users/10942161/tiago-bachiega-de-almeida"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 54583775, "answer_count": 1, "score": 3, "last_activity_date": 1549602736, "creation_date": 1549473886, "last_edit_date": 1549580899, "question_id": 54559268, "link": "https://stackoverflow.com/questions/54559268/c-implementation-of-image-processing-dilation-creating-repeated-patterns-on-the", "title": "C implementation of image processing dilation creating repeated patterns on the result image", "body": "<p>I'm trying to implement a dilation operation using C. Here's the code I've done</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"image.h\"\n\n#define IMG_ROWS 1280\n#define IMG_COLS 1024\n#define KERNEL_DIM 5 //kernel size\n\nunsigned char imgIn[IMG_ROWS][IMG_COLS]; //grayscale values array\nunsigned char imgOut[IMG_ROWS][IMG_COLS];\n\n//Kernel initialization\nint kernel[KERNEL_DIM][KERNEL_DIM] = {\n        {1,1,1,1,1},\n        {1,1,1,1,1},\n        {1,1,1,1,1},\n        {1,1,1,1,1},\n        {1,1,1,1,1}\n};\n\nint main()\n{\n\n    //fill the img matrix\n    for(int idxRow = 0; idxRow &lt; IMG_ROWS; idxRow++){\n        for(int idxCol = 0; idxCol &lt; IMG_COLS; idxCol++){\n            imgIn[idxRow][idxCol] = img[idxRow*IMG_COLS + idxCol];\n            imgOut[idxRow][idxCol] = 0;\n        }\n    }\n\n    int max;\n    int offset = KERNEL_DIM/2;\n    //Iterates over the image ignoring the borders\n    for(int idxRow = offset; idxRow &lt; IMG_ROWS - offset; idxRow++){\n        for(int idxCol = offset; idxCol &lt; IMG_COLS - offset; idxCol++){\n            max = 0;\n            //Iterates over the kernel\n            for(int krnRow = -offset; krnRow &lt; offset + 1; krnRow++){\n                for(int krnCol = -offset; krnCol &lt; offset + 1; krnCol++){\n                    //Max value under the kernel\n                    if(kernel[offset + krnRow][offset + krnCol]*\n                            imgIn[idxRow + krnRow][idxCol + krnCol] &gt; max)        {\n                        max = imgIn[idxRow + krnRow][idxCol + krnCol];\n                    }\n                }\n            }\n\n            imgOut[idxRow][idxCol] = max;\n        }\n    }\n\n    FILE *fp = fopen(\"ps_dil.log\", \"w\");\n\n    for(int idxRow = 0; idxRow &lt; IMG_ROWS; idxRow++){\n        for(int idxCol = 0; idxCol &lt; IMG_COLS; idxCol++){\n            fprintf(fp, \"%d \", imgOut[idxRow][idxCol]);\n        }\n    }\n\n    fclose(fp);\n\n    return 0;\n\n}\n</code></pre>\n\n<p>As you can see, my input image is in the <code>imgIn</code> array and my structuring element is in the <code>kernel</code> array, where all the elements are set to 1. Also, I'm not processing the borders, keeping it's pixels with the value 0.</p>\n\n<p>The input image comes from a 1D array, generated with the following matlab script:</p>\n\n<pre class=\"lang-matlab prettyprint-override\"><code>function saveAsCArray( I )\n[nRows, nCols] = size(I);\n\ncFile = fopen('image.h', 'w');\nfprintf(cFile, 'unsigned char img[%d] = {', (nRows*nCols));\n\nfor row = 1:nRows\n    for col = 1:nCols\n        if row == nRows &amp;&amp; col == nCols\n            fprintf(cFile, '%d};', I(row, col));\n        else\n            fprintf(cFile, '%d,', I(row, col));\n        end\n    end\n    fprintf(cFile, '\\n');\nend\n\nfclose(cFile);\n</code></pre>\n\n<p>end</p>\n\n<p>The output log file is convert back to an image with the following script:</p>\n\n<pre class=\"lang-matlab prettyprint-override\"><code>function intFileToImg( fileName, imgName, imgSizeRow, imgSizeCol)\n\n    A = dlmread(fileName);\n    A = uint8(A);\n    A = reshape(A, imgSizeRow, imgSizeCol);\n    A = rot90(A,3);\n    I = mat2gray(A);\n    I = flip(I, 2);\n    imwrite(I, imgName);\n    imshow(I);\n\nend\n</code></pre>\n\n<p>I implemented the dilation in a way that the output pixel receives the value of the maximum pixel inside the kernel window. The problem is that my output image is showing some weird repetitions, which I really think that is related to some indexing mistake. Unfortunately I can't figure out what I am doing wrong.</p>\n\n<p>Here is my input:</p>\n\n<p><a href=\"https://i.stack.imgur.com/0u3bK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0u3bK.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here is my output with 5x5 Kernel:\n<a href=\"https://i.stack.imgur.com/rj6yF.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rj6yF.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here is my output with 3x3 Kernel:\n<a href=\"https://i.stack.imgur.com/CnreV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CnreV.png\" alt=\"enter image description here\"></a></p>\n\n<p>Please, can someone take a look at the code and help me to find out what I am doing wrong?</p>\n"}, {"tags": ["c", "c89"], "comments": [{"owner": {"reputation": 25661, "user_id": 430766, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ee7e736eeb33c4b03d4a5e6e813a9abc?s=128&d=identicon&r=PG", "display_name": "bitmask", "link": "https://stackoverflow.com/users/430766/bitmask"}, "edited": false, "score": 1, "creation_date": 1549473796, "post_id": 54559204, "comment_id": 95917934, "body": "Which of these languages are you interested in? You are speaking of C, but you list three C++ tags."}, {"owner": {"reputation": 19856, "user_id": 2266772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60e03bd1fd9f2dbc750e0899b9e7e71d?s=128&d=identicon&r=PG", "display_name": "Matthieu Brucher", "link": "https://stackoverflow.com/users/2266772/matthieu-brucher"}, "edited": false, "score": 1, "creation_date": 1549473797, "post_id": 54559204, "comment_id": 95917935, "body": "I don&#39;t think it&#39;s valid C++, as <code>bool</code> is a type on its own."}, {"owner": {"reputation": 149509, "user_id": 4342498, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3j88.jpg?s=128&g=1", "display_name": "NathanOliver", "link": "https://stackoverflow.com/users/4342498/nathanoliver"}, "edited": false, "score": 1, "creation_date": 1549473799, "post_id": 54559204, "comment_id": 95917936, "body": "Are you using C or C++?"}, {"owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "edited": false, "score": 0, "creation_date": 1549473824, "post_id": 54559204, "comment_id": 95917953, "body": "Without a clear idea of which language and version you&#39;re discussing, this is difficult to answer correctly"}, {"owner": {"reputation": 3560, "user_id": 5550963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7jAip.png?s=128&g=1", "display_name": "CEPB", "link": "https://stackoverflow.com/users/5550963/cepb"}, "edited": false, "score": 0, "creation_date": 1549473873, "post_id": 54559204, "comment_id": 95917970, "body": "Good question but I think you are asking about C not C++"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1549473931, "post_id": 54559204, "comment_id": 95918010, "body": "Since the definitions cross translation units, the question boils down, if the ABI treats both types the same. This is obviously the case here, so this shouldn&#39;t be a problem. I would even say, that this question is out of scope for the C standard"}, {"owner": {"reputation": 3120, "user_id": 2012007, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/3cf2a036d360f8e177696b7f811dab05?s=128&d=identicon&r=PG", "display_name": "Graznarak", "link": "https://stackoverflow.com/users/2012007/graznarak"}, "edited": false, "score": 0, "creation_date": 1549474022, "post_id": 54559204, "comment_id": 95918067, "body": "I have updated the tags to reference only C and C89.  My code is specifically being compiled by a C89 compiler."}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 1, "creation_date": 1549474434, "post_id": 54559204, "comment_id": 95918270, "body": "<code>char varName;</code> is a definition, not just a declaration."}, {"owner": {"reputation": 3120, "user_id": 2012007, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/3cf2a036d360f8e177696b7f811dab05?s=128&d=identicon&r=PG", "display_name": "Graznarak", "link": "https://stackoverflow.com/users/2012007/graznarak"}, "reply_to_user": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 0, "creation_date": 1549474541, "post_id": 54559204, "comment_id": 95918307, "body": "@interjay Thanks for pointing that out.  I added the <code>extern</code> keyword there."}], "answers": [{"tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": true, "score": 5, "last_activity_date": 1549474758, "last_edit_date": 1549474758, "creation_date": 1549474238, "answer_id": 54559380, "question_id": 54559204, "link": "https://stackoverflow.com/questions/54559204/variable-declaration-and-definition-mismatch/54559380#54559380", "title": "Variable declaration and definition mismatch", "body": "<p><a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.2.7p2\" rel=\"nofollow noreferrer\">6.2.7p2</a></p>\n\n<blockquote>\n  <p>All declarations that refer to the same object or function shall have\n  compatible type; otherwise, the behavior is undefined.</p>\n</blockquote>\n\n<p>The <a href=\"http://port70.net/~nsz/c/c89/c89-draft.html\" rel=\"nofollow noreferrer\">C89 standard</a> has the same paragraph.</p>\n\n<p>Declarations referfing to the same object is further explained in the paragraph on linkage:</p>\n\n<blockquote>\n  <p>An identifier declared in different scopes or in the same scope more\n  than once can be made to refer to the same object or function by a\n  process called linkage . There are three kinds of linkage: external,\n  internal, and none.</p>\n  \n  <p>In the set of translation units and libraries that constitutes an\n  entire program, each instance of a particular identifier with external\n  linkage denotes the same object or function. Within one translation\n  unit, each instance of an identifier with internal linkage denotes the\n  same object or function. Identifiers with no linkage denote unique\n  entities.</p>\n</blockquote>\n\n<p>Compatible types essentially means identical types, with some minor caveats (e.g., <code>extern int foo[];</code> is compatible with <code>extern int foo[3];</code>).</p>\n"}], "owner": {"reputation": 3120, "user_id": 2012007, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/3cf2a036d360f8e177696b7f811dab05?s=128&d=identicon&r=PG", "display_name": "Graznarak", "link": "https://stackoverflow.com/users/2012007/graznarak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 54559380, "answer_count": 1, "score": 3, "last_activity_date": 1549474758, "creation_date": 1549473687, "last_edit_date": 1549474513, "question_id": 54559204, "link": "https://stackoverflow.com/questions/54559204/variable-declaration-and-definition-mismatch", "title": "Variable declaration and definition mismatch", "body": "<p>I am using a C89 compiler (embedded systems).</p>\n\n<p>I ran into some C code where one translation unit defines a variable as <code>bool varName;</code>, where <code>bool</code> is a <code>typedef</code> of <code>unsigned char</code>.  Another translation unit forward declares the variable as follows: <code>extern char varName;</code>.</p>\n\n<p>This is obviously a type mismatch, and is an error.  My question is, what exact rule does this violate?  My knee-jerk reaction was that it is an ODR violation, but there is a single definition so I'm not confident that this is an ODR violation.</p>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 0, "creation_date": 1549473229, "post_id": 54558912, "comment_id": 95917645, "body": "Please read <a href=\"https://stackoverflow.com/questions/tagged/c\">c</a> and <a href=\"https://stackoverflow.com/questions/tagged/c%2b%2b\">c++</a> and then delete the one that&#39;s not appropriate. That said, <code>getxattr()</code> is not standard C but comes from a certain environment, have you checked the according documentation? Also, add the according tag while you&#39;re at it!"}, {"owner": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 0, "creation_date": 1549473532, "post_id": 54558912, "comment_id": 95917802, "body": "@UlrichEckhardt your links are to the complete list of newest questions for c and c++, respectively. I hope OP is not reading all of it before coming back ;P. Sorry, no trolling, just wanted to know if you actually wanted to link to the tag description, maybe?"}, {"owner": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 0, "creation_date": 1549473575, "post_id": 54558912, "comment_id": 95917820, "body": "@UlrichEckhardt <a href=\"https://stackoverflow.com/tags/c%2b%2b/info\">this</a> is a better link imho"}, {"owner": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 0, "creation_date": 1549473591, "post_id": 54558912, "comment_id": 95917830, "body": "I was targetting the tag description, which is on top of the two."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 1, "creation_date": 1549473700, "post_id": 54558912, "comment_id": 95917883, "body": "However, the problem as well as the solution is exactly the same for both languages, so why decide for one? Remember, Q&amp;A here are not only for the OP (some say not even primarily)."}], "answers": [{"comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1549474029, "post_id": 54559078, "comment_id": 95918073, "body": "I suggest filing a report on the documentation of <code>getxattr</code> as it is not made explicit that the value returned is not null-terminated."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1549474169, "post_id": 54559078, "comment_id": 95918166, "body": "@PaulOgilvie My manpage states: &quot;An extended attribute name is a simple NULL-terminated string.  The name includes a namespace prefix - there may be several, disjoint namespaces  associated  with  an  individual inode.  The value of an extended attribute is a chunk of arbitrary textual or binary data of specified length.&quot; &lt;- Since binary data is mentioned, I would not expect it to be NULL-terminated, but it would be safer if they stated it more explicitly, agreed."}, {"owner": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1549492700, "post_id": 54559078, "comment_id": 95926131, "body": "If it is binary data it could also contain a null in the middle, meaning it cannot &quot;safely&quot; be printed via printf, no?"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1549495640, "post_id": 54559078, "comment_id": 95927089, "body": "@user463035818 Well, it <i>can</i> be binary data... The user namespace is custom, I assume, that the OP knows, that printable ascii text is stored in the attribute user.permission."}, {"owner": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1549535075, "post_id": 54559078, "comment_id": 95939951, "body": "@Ctx ok, I have to admit other than reading a bit of documentation I dont know anything about <code>getxattr</code>. My guess is that this is the reason why the function call does not place the null"}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1549535412, "post_id": 54559078, "comment_id": 95940179, "body": "@user463035818 Yes, you are correct, in general binary data is set, this is why no null termination is performed by getxattr(). But if you know, that the specific user attribute contains a string, you can of course printf() it after null termination is ensured"}, {"owner": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1549535502, "post_id": 54559078, "comment_id": 95940222, "body": "thanks for the clarification, assuming not having a null in the middle of a buffer once bite my ass, and now I am a bit paranoic about it ;)"}], "tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 4, "last_activity_date": 1549535444, "last_edit_date": 1549535444, "creation_date": 1549473273, "answer_id": 54559078, "question_id": 54558912, "link": "https://stackoverflow.com/questions/54558912/why-does-getxattr-fills-extra-elements/54559078#54559078", "title": "Why does getxattr fills extra elements?", "body": "<p>You have to honour the <em>real</em> size of the attribute.</p>\n\n<p>The call <code>getxattr()</code> returns the size of the value. So the following would be correct:</p>\n\n<pre><code>ssize_t sz = getxattr(filename, \"user.permission\", value, sizeof(value)-1);\nif (sz != -1) {\n    value[sz] = '\\0';\n    printf(\"value is %s\\n\", value);\n}\n</code></pre>\n\n<p>It looks, like your value is a string, but it is not null terminated, you have to do that yourself. So, <code>getxattr()</code> is not appending random bytes, the char array is simply not initialized and it is not completely overwritten, so some uninitialized bytes remain there.</p>\n"}, {"comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1549474098, "post_id": 54559090, "comment_id": 95918124, "body": "Nice that it returns the size, but I would expect a function handling a string to null-terminate said string. And if it doesn&#39;t that it is then noted in the remarks or description."}, {"owner": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1549491701, "post_id": 54559090, "comment_id": 95925803, "body": "@PaulOgilvie i guess the reasoning is that the bytes can contain a 0 (also at a different position than the end) Note that it doesnt say string but the documentation only talks about raw bytes"}], "tags": [], "owner": {"reputation": 61304, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "is_accepted": false, "score": 3, "last_activity_date": 1549473295, "creation_date": 1549473295, "answer_id": 54559090, "question_id": 54558912, "link": "https://stackoverflow.com/questions/54558912/why-does-getxattr-fills-extra-elements/54559090#54559090", "title": "Why does getxattr fills extra elements?", "body": "<p>From <a href=\"http://man7.org/linux/man-pages/man2/getxattr.2.html\" rel=\"nofollow noreferrer\">documentation</a> (emphasize mine):</p>\n\n<blockquote>\n  <p>getxattr() retrieves the value of the extended attribute identified\n         by name and associated with the given path in the filesystem.  The\n         attribute value is placed in the buffer pointed to by value; size\n         specifies the size of that buffer.  <strong>The return value of the call is\n         the number of bytes placed in value.</strong></p>\n</blockquote>\n\n<p>I didnt find something about <code>getxattr()</code> placing a <code>\\0</code> so I would expect that you have to use the size returned from the function to know the size of the string.</p>\n"}], "owner": {"reputation": 635, "user_id": 2754688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/595cbbf26e32c5162dced7a9d0cbb668?s=128&d=identicon&r=PG&f=1", "display_name": "srccode", "link": "https://stackoverflow.com/users/2754688/srccode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 54559078, "answer_count": 2, "score": 0, "last_activity_date": 1549535444, "creation_date": 1549472657, "question_id": 54558912, "link": "https://stackoverflow.com/questions/54558912/why-does-getxattr-fills-extra-elements", "title": "Why does getxattr fills extra elements?", "body": "<p>I have the below piece of code where I'm unable to figure out why I'm getting some weird symbols at the end of the buffer.</p>\n\n<pre><code>char value[100];\n    if(getxattr(filename, \"user.permission\", value, sizeof(value))!=-1){\n        //strncpy(val, value, strlen(value));\n        printf(\"value is %s\\n\", value);\n    }\n</code></pre>\n\n<p>For length >4 elements, it prints properly but if the value has less than four elements it appends some random characters at the end.</p>\n\n<p>When I print the size of the value, it shows 6 for any value length between 1-4.\nPlease, someone, explain why is this behavior.</p>\n"}, {"tags": ["c", "binary"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1549472601, "post_id": 54558856, "comment_id": 95917319, "body": "Constants starting with <code>0</code> are in <i>octal</i> base. <code>0101</code> is the same as <code>65</code>."}, {"owner": {"reputation": 206, "user_id": 10714410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/705ed7b594eb8631bf15b78a0ee90f9d?s=128&d=identicon&r=PG&f=1", "display_name": "RJM", "link": "https://stackoverflow.com/users/10714410/rjm"}, "edited": false, "score": 1, "creation_date": 1549472638, "post_id": 54558856, "comment_id": 95917339, "body": "I believe the leading 0 of var is actually , making it octal 101 = 65."}, {"owner": {"reputation": 44734, "user_id": 964243, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/fL1rH.png?s=128&g=1", "display_name": "Boann", "link": "https://stackoverflow.com/users/964243/boann"}, "edited": false, "score": 0, "creation_date": 1549479645, "post_id": 54558856, "comment_id": 95920660, "body": "Simpler demonstration: <code>printf(&quot;%d&quot;, 0101);</code>"}, {"owner": {"reputation": 77578, "user_id": 32914, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/50facfccdffe2e9cabaa589205959d30?s=128&d=identicon&r=PG", "display_name": "Mason Wheeler", "link": "https://stackoverflow.com/users/32914/mason-wheeler"}, "edited": false, "score": 2, "creation_date": 1549479841, "post_id": 54558856, "comment_id": 95920760, "body": "Q: Why do C programmers confuse Halloween and Christmas?  A: Because Oct 31 = Dec 25."}], "answers": [{"tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": false, "score": 11, "last_activity_date": 1549476373, "last_edit_date": 1549476373, "creation_date": 1549472702, "answer_id": 54558924, "question_id": 54558856, "link": "https://stackoverflow.com/questions/54558856/whats-the-logic-behind-addition-of-0101-with-5-in-c/54558924#54558924", "title": "What&#39;s the logic behind addition of 0101 with 5 in C?", "body": "<p>The C Standard dictates that a numeric constant beginning with 0 is an <em>octal constant</em> (i.e. base-8) in <a href=\"https://port70.net/~nsz/c/c11/n1570.html#6.4.4.1\" rel=\"nofollow noreferrer\">&sect; 6.4.4.1 (Integer constants)</a>.</p>\n\n<p>The value 101 in base 8 is 65 in base 10, so adding 5 to it (obviously) produces 70 in base 10.</p>\n\n<p>Try changing your format specifier in <code>printf</code> to <code>\"%o\"</code> to observe the octal representation of <code>var</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "edited": false, "score": 1, "creation_date": 1549474853, "post_id": 54559291, "comment_id": 95918474, "body": "I don&#39;t believe that the syntax <code>0bnnn</code> is currently supported by the C standard, though many compilers have it as an extension"}], "tags": [], "owner": {"reputation": 535, "user_id": 7927200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3a94c975d5ce0fe1b5f06edf3dc043a?s=128&d=identicon&r=PG&f=1", "display_name": "Niloy Rashid", "link": "https://stackoverflow.com/users/7927200/niloy-rashid"}, "is_accepted": false, "score": 5, "last_activity_date": 1549473952, "creation_date": 1549473952, "answer_id": 54559291, "question_id": 54558856, "link": "https://stackoverflow.com/questions/54558856/whats-the-logic-behind-addition-of-0101-with-5-in-c/54559291#54559291", "title": "What&#39;s the logic behind addition of 0101 with 5 in C?", "body": "<p>It is because of <strong>Integer Literals</strong>. A number with leading <code>0</code> denoted that the number is an <em>octal</em> number. You can also use <code>0b</code> for denoting <em>binary number</em>, for <em>hexadecimal number</em> it is <code>0x</code> or <code>0X</code>. You don't need to write any thing for <em>decimal</em>. See the code bellow.</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n\nint main()\n{\n    int binary = 0b10;\n    int octal=010;\n    int decimal = 10;\n    int hexa = 0x10;\n    printf(\"%d %d %d %d\\n\", octal, decimal, hexa, binary);\n}\n</code></pre>\n\n<p>For more information visit <a href=\"https://www.tutorialspoint.com/cprogramming/c_constants.htm\" rel=\"noreferrer\">tutorialspoint</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 4, "last_activity_date": 1549474225, "creation_date": 1549474225, "answer_id": 54559376, "question_id": 54558856, "link": "https://stackoverflow.com/questions/54558856/whats-the-logic-behind-addition-of-0101-with-5-in-c/54559376#54559376", "title": "What&#39;s the logic behind addition of 0101 with 5 in C?", "body": "<p>Not shocking at all. <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.4.4.1p3\" rel=\"nofollow noreferrer\">C11 Standard - 6.4.4.1 Integer constants(p3)</a> provides:</p>\n\n<blockquote>\n  <p><code>\"An octal constant consists of the prefix 0 optionally followed by a\n  sequence of the digits 0 through 7 only.\"</code></p>\n</blockquote>\n\n<p>Some compilers, such as gcc, provide extension for specifying binary constants, e.g. <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Binary-constants.html\" rel=\"nofollow noreferrer\">GCC Manual - 6.64 Binary Constants using the \u20180b\u2019 Prefix</a> But note, this is a non-standard extension.</p>\n\n<p>Combining both in your example would give:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main (void) {\n\n    int var = 0101,\n        bar = 0b0101;\n    var = var + 5;\n    bar = bar + 5;\n    printf (\"var: %d\\nbar: %d\\n\", var, bar);\n\n    return 0;\n}\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/octbin\nvar: 70\nbar: 10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 341, "user_id": 7674231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BVcW4.png?s=128&g=1", "display_name": "Rogelio Prieto", "link": "https://stackoverflow.com/users/7674231/rogelio-prieto"}, "is_accepted": false, "score": 1, "last_activity_date": 1549475705, "creation_date": 1549475705, "answer_id": 54559781, "question_id": 54558856, "link": "https://stackoverflow.com/questions/54558856/whats-the-logic-behind-addition-of-0101-with-5-in-c/54559781#54559781", "title": "What&#39;s the logic behind addition of 0101 with 5 in C?", "body": "<p>Inicially var is in octal numeric system, so  <code>var=0101</code> is equal to <code>001000001</code> in binary system or equal to <code>65</code> in decimal system.</p>\n\n<p>for example in this code you can show <code>65</code> as the var inicial value.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main()\n\n{\n  int var = 0101;\n  printf(\"initial value. var=%o\\n\",var);\n  var = var+5;\n\n  printf(\"result of var+5. var=%d\\n\",var);\n  printf(\"%d\\n\",var);\n  return 0;\n}\n</code></pre>\n\n<p>You'll get this output:</p>\n\n<pre><code>initial value. var=65\nresult of var+5. var=70\n70\n</code></pre>\n"}], "owner": {"reputation": 523, "user_id": 8971995, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VZQph.jpg?s=128&g=1", "display_name": "Uddesh Jain", "link": "https://stackoverflow.com/users/8971995/uddesh-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3183, "favorite_count": 0, "closed_date": 1549481402, "answer_count": 4, "score": 4, "last_activity_date": 1549476373, "creation_date": 1549472486, "last_edit_date": 1549472766, "question_id": 54558856, "link": "https://stackoverflow.com/questions/54558856/whats-the-logic-behind-addition-of-0101-with-5-in-c", "closed_reason": "Duplicate", "title": "What&#39;s the logic behind addition of 0101 with 5 in C?", "body": "<p>One of my friends asked me the output of this code and I just got shocked after running this code. The output of this code is 70. Please explain why? </p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main()\n\n{\n int var = 0101;\n var = var+5;\n printf(\"%d\",var);\n return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "postgresql", "libpq"], "answers": [{"tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 1, "last_activity_date": 1549475299, "creation_date": 1549475299, "answer_id": 54559674, "question_id": 54558801, "link": "https://stackoverflow.com/questions/54558801/how-to-execute-an-async-query-with-libpq/54559674#54559674", "title": "How to execute an async Query with libpq", "body": "<p>You misunderstand something here: <code>PQsendQuery()</code> sends an asynchronous query, meaning, that the command does not block until the results are available. However, you may <em>not</em> call <code>PQsendQuery()</code> again before all results were read!</p>\n\n<p>From the manpage:</p>\n\n<blockquote>\n  <p>After successfully calling PQsendQuery, call PQgetResult one or more times to obtain the results. <strong>PQsendQuery may not be called again</strong> (on the same connection) until PQgetResult has returned a null pointer, indicating that the command is done.</p>\n</blockquote>\n\n<p>As the manpage indicates, you would have to open several connections to run several concurrent queries. The different results are then associated with the different database handles.</p>\n\n<p>The PostgreSQLc async io api does not provide callback mechanisms; however, this is not too hard to build yourself. libevent can be used, since you can retrieve the socket file descriptor with <code>PQsocket()</code>. However, quite some glue is needed to make it work.</p>\n"}], "owner": {"reputation": 2135, "user_id": 4399651, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh6.googleusercontent.com/-x2q8M9lPZtw/AAAAAAAAAAI/AAAAAAAAC3k/bmH01KutNao/photo.jpg?sz=128", "display_name": "Arwed Mett", "link": "https://stackoverflow.com/users/4399651/arwed-mett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 777, "favorite_count": 0, "accepted_answer_id": 54559674, "answer_count": 1, "score": 1, "last_activity_date": 1549475299, "creation_date": 1549472266, "question_id": 54558801, "link": "https://stackoverflow.com/questions/54558801/how-to-execute-an-async-query-with-libpq", "title": "How to execute an async Query with libpq", "body": "<p>I want to execute a SQL query with libpq in a non-blocking fashion.\nThus I want to be notified when my query has finished executing.</p>\n\n<p>As I understand this is supported by libpq if I use the asynchronous api.</p>\n\n<p>With the <code>PQsendQuery</code> function I can send the query to the backend and with the <code>PQgetResult</code> function I can retrieve the result.</p>\n\n<p>I call the <code>PQsendQuery</code> function multiple times without waiting for\nthe previous one to finish.</p>\n\n<p>Now I have the following questions:</p>\n\n<ul>\n<li>How can I associate the results that I am going to pull later with\n<code>PQgetResult</code> to the corresponding query?</li>\n<li>Is there a method of using a callback instead of PQgetResult?</li>\n<li>Is there a way to run this in an event loop (e.g. libevent)?</li>\n</ul>\n"}, {"tags": ["c", "header-files", "mplab", "xc8"], "comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 2, "creation_date": 1549500183, "post_id": 54558752, "comment_id": 95928227, "body": "please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that shows the error"}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549535008, "post_id": 54558752, "comment_id": 95939919, "body": "The last paragraph would be that.  Isn&#39;t it?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549566482, "post_id": 54558752, "comment_id": 95958281, "body": "You should know that a variable instance should NEVER be declared in a header file.  Your question brings up a prime example of why that is true.   Much better to declare the variable in a .c file and have the header file use <code>extern</code> to reference that variable.  However, since the variable is <code>static</code> it should not be known anywhere except the file that declares it. (that&#39;s why the variable would be marked &#39;static&#39;"}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549571414, "post_id": 54558752, "comment_id": 95960518, "body": "The reason I need a variable in the header is that I need an array of constants (In the real case it&#39;s not a variable, but an array, but the error is the same).  And I would do that with a macro that expands to a compound array literal, but that shit of compiler doesn&#39;t have <code>C99</code> support (although it has <i>an incomplete</i> <code>&lt;stdint.h&gt;</code>), so the only way I&#39;ve found to accomplish that is though <code>static const</code> arrays.  However it seems that the compiler won&#39;t even allow me to do that.  The only options left would be to have a lot of macros (undesirable), or magic numbers with comments."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549571726, "post_id": 54558752, "comment_id": 95960654, "body": "Aside:  Untill now I always preferred macros over <code>static const</code>s, but didn&#39;t really know why, but yesterday I found a very very good reason:  <code>static const</code>s can NOT be used to initialize <code>static</code> variables."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549571815, "post_id": 54558752, "comment_id": 95960691, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that demonstrates the problem that you are trying to solve.  I.E. not a repeat of the compile problem, but rather the problem that you are trying to solve"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1549575295, "post_id": 54558752, "comment_id": 95962297, "body": "<code>xc8</code> ugh, had only problems with it. What&#39;s the point of <code>REG_OSCCON_IRCF_FREQ_16_MHZ</code> ? Can&#39;t it be just <code>#define REG_OSCCON_IRCF_FREQ_16_MHZ 16000000u</code> ?  I remember that <code>xc8</code> has problems calculating integers constants, I would advise to suffix with <code>ull</code>. But i need to say it: find a trash bin, put the pic18 there, buy cheaper stm32 and move to gcc. Are you using the free version of xc8? You can make the <code>REG_OSCCON_IRCF_FREQ</code> to just be a static array, which will actually save more memory. On a decent compiler. With optimizer."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1549576018, "post_id": 54558752, "comment_id": 95962592, "body": "I have STM32 L4 and F0, but this is part of a subject  :("}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1549576099, "post_id": 54558752, "comment_id": 95962620, "body": "<code>REG_OSCCON_IRCF_FREQ_16_MHZ</code>:  this macro is the value that I need to write into the <code>IRCF</code> field of the <code>OSCCON</code> register to change to a sysclk frequency of 16 MHz, and therefore the line <code>reg_OSCCON_IRCF_set(REG_OSCCON_IRCF_FREQ_16_MHZ);</code> After that, I change the variable <code>sys_freq</code> which is a variable that I created to remember what is the current frequency of the clk."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1549576395, "post_id": 54558752, "comment_id": 95962737, "body": "Why would I need the <code>ULL</code>? First, it is <code>C99</code> so I&#39;m not sure the compiler will understand it, and second, a constant integral is guaranteed to not overflow itself, isn&#39;t it?  And third, that shit doesn&#39;t even accept <code>uint_least64_t</code> so I don&#39;t think it will accept <code>unsigned long long</code>.  I wish I had GCC here, or at least that SDCC was stable enough to use it."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1549576848, "post_id": 54558752, "comment_id": 95962925, "body": "Yes, I think it&#39;s the free version of XC8, but I&#39;m not sure (I don&#39;t have the school PC here).  Not only that, but I&#39;m limited to an old version of it because the template for this PIC doesn&#39;t even compile with the new version of XC8."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1549576999, "post_id": 54558752, "comment_id": 95962982, "body": "For a <code>static</code> array (I guess also <code>const</code>), are you talking about option 2 above?  That wouldn&#39;t allow me to initialize <code>static</code>variables.  Also, <code>const</code> compound literals that are the same are allowed to share memory, so in the end it should be using the same memory (with a decent compiler, which XC8 isn&#39;t)"}], "answers": [{"tags": [], "owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "is_accepted": true, "score": 0, "last_activity_date": 1550090038, "creation_date": 1550090038, "answer_id": 54678967, "question_id": 54558752, "link": "https://stackoverflow.com/questions/54558752/symbol-filevariable-defined-more-than-once/54678967#54678967", "title": "Symbol &quot;file@variable&quot; defined more than once", "body": "<p>Definitely the <code>XC8</code> compiler is broken.</p>\n\n<p>Today similar errors appeared when using <code>static inline</code> functions.  I've googled about it, and it seems the compiler isn't very good with that kind of code.</p>\n"}], "owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 0, "accepted_answer_id": 54678967, "answer_count": 1, "score": 0, "last_activity_date": 1550090038, "creation_date": 1549472097, "last_edit_date": 1549641395, "question_id": 54558752, "link": "https://stackoverflow.com/questions/54558752/symbol-filevariable-defined-more-than-once", "title": "Symbol &quot;file@variable&quot; defined more than once", "body": "<p>IDE:  MPLAB X v2.15</p>\n\n<p>CC:  XC8 v1.32</p>\n\n<p>Target device: PIC18f45k20</p>\n\n<p>I have a header file <code>reg.h</code>, which contains a variable</p>\n\n<pre><code>static const int aaasdf = 3;\n</code></pre>\n\n<p>That header has proper include guards at the beginning:</p>\n\n<pre><code>#ifndef PRJ_REG_H\n#define PRJ_REG_H\n</code></pre>\n\n<p>And at the end:</p>\n\n<pre><code>#endif\n</code></pre>\n\n<p>If I have that same variable on any other header file, it compiles fine, but when that variable is in this particular file, it gives me <code>error: (845) symbol \"reg@aaasdf\" defined more than once</code></p>\n\n<p>But if I comment that variable, it doesn't exist anymore, and it complains because I need it in some .c file.</p>\n\n<p>The strange name is just for testing, to be sure that there isn't any other variable with the same name.</p>\n\n<p>What else can I do to debug this?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>It does it for any <code>static const</code> variable, (I'll test tomorrow for only <code>static</code>, <code>const</code> or <code>extern const</code>), that I create in that file, but there are also <code>enum</code>s, and <code>static inline</code> functions, and none of them gives me the repeated symbol error.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I think it's the compiler that is broken:</p>\n\n<p>I removed everything from the header and also the source files.  Now main is an infinite loop, and all is like that.</p>\n\n<p>The headers are empty but for the variable triggering the error.</p>\n\n<p>No header of mine includes any other header of mine.</p>\n\n<p>What triggers the error:\nAny header that is included in many source files, and contains a <code>static const</code> variable of any type.  What I mean by many is that if I include the header only in its source file and another file, it doesn't trigger the error, but if it is included in 2 source files that aren't its source file, it triggers the error.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>As requested, here is a MCV example of what I want (not the compile error):</p>\n\n<p><code>// reg.h</code></p>\n\n<pre><code>enum    Reg_OSCCON_IRCF_Values {\n    REG_OSCCON_IRCF_FREQ_31_KHZ = 0x0u,\n    REG_OSCCON_IRCF_FREQ_250_KHZ    = 0x1u,\n    REG_OSCCON_IRCF_FREQ_500_KHZ    = 0x2u,\n    REG_OSCCON_IRCF_FREQ_1_MHZ  = 0x3u,\n    REG_OSCCON_IRCF_FREQ_2_MHZ  = 0x4u,\n    REG_OSCCON_IRCF_FREQ_4_MHZ  = 0x5u,\n    REG_OSCCON_IRCF_FREQ_8_MHZ  = 0x6u,\n    REG_OSCCON_IRCF_FREQ_16_MHZ = 0x7u\n};\n#define REG_OSCCON_IRCF_FREQ        ((const uint32_t [8]){      \\\n                           31000u,      \\\n                          250000u,      \\\n                          500000u,      \\\n                         1000000u,      \\\n                         2000000u,      \\\n                         4000000u,      \\\n                         8000000u,      \\\n                        16000000u       \\\n                    })\n\nstatic inline   void reg_field_set(volatile uint8_t *reg,\n                uint8_t mask, uint8_t posn, uint8_t val)\n{\n\n    *reg    = (*reg &amp; ~mask) | ((val &lt;&lt; posn) &amp; mask);\n}\n\nstatic inline   void reg_OSCCON_IRCF_set(uint8_t val)\n{\n\n    reg_field_set(&amp;OSCCON, _OSCCON_IRCF_MASK, _OSCCON_IRCF_POSN, val);\n}\n</code></pre>\n\n<p><code>// pwm.c</code></p>\n\n<pre><code>#include \"reg.h\"\nextern uint32_t sys_freq;\n\nint foo(/**/)\n{\n    static const uint32_t   freq_min =\n        REG_OSCCON_IRCF_FREQ[REG_OSCCON_IRCF_FREQ_16_MHZ] /\n        (UINT8_MAX * 4 *\n        REG_T2CON_T2CKPS_PRESCALER[REG_T2CON_T2CKPS_PRESCALER_1]);\n\n    reg_OSCCON_IRCF_set(REG_OSCCON_IRCF_FREQ_16_MHZ);\n    sys_freq    = REG_OSCCON_IRCF_FREQ[REG_OSCCON_IRCF_FREQ_16_MHZ];\n    // ...\n}\n</code></pre>\n\n<p>Option 1:   As showed above, using a macro that expands to a <code>const</code>\ncompound array literal, where I can access any of its elements (either at\ncompile time or at run time).  Need <code>C99</code>, which I don't have.  <em>EDIT</em>: <code>const</code> compound literals <em>may</em> or <em>may not</em> be constant expressions (<a href=\"https://stackoverflow.com/q/54595387/6872717\">Initialize static variable with element of const compound literal</a>), and therefore <em>may</em> or <em>may not</em> be valid as initializers for <code>static</code> variables.</p>\n\n<p>Option 2:   Changing the macro to a <code>static const</code> array.\nPros: don't need <code>C99</code>.\nCons:  Can NOT initialize a <code>static</code> variable. The compiler seems broken and\ndoesn't allow me to do that.</p>\n\n<p>Option 3:   Magic numbers.\nPros: Don't need <code>C99</code>. Can initialize a\n<code>static</code> variable.\nCons: Magic numbers.</p>\n\n<p>Option 4:   A lot of macros (for each of the arrays, because it's not only\nthis one!).\nPros: Don't need <code>C99</code>.\nCons: Polluting global namespace.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1549471466, "post_id": 54558533, "comment_id": 95916687, "body": "Your program is doing exactly what you told it to do. Note, your posted code is incomplete."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1549471771, "post_id": 54558533, "comment_id": 95916870, "body": "If you want the triangle the other way up initialise <code>i = rows</code> and change the loop etc."}], "answers": [{"tags": [], "owner": {"reputation": 1190, "user_id": 3344587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d246b94ff48978d81b706630d0102196?s=128&d=identicon&r=PG&f=1", "display_name": "Loc Tran", "link": "https://stackoverflow.com/users/3344587/loc-tran"}, "is_accepted": false, "score": 0, "last_activity_date": 1549472008, "creation_date": 1549472008, "answer_id": 54558729, "question_id": 54558533, "link": "https://stackoverflow.com/questions/54558533/why-does-the-code-give-me-wrong-triangle/54558729#54558729", "title": "Why does the code give me wrong triangle?", "body": "<p>You have problem with </p>\n\n<pre><code>while(j &lt;= i) \n</code></pre>\n\n<p>loop. Here is my solution:  </p>\n\n<pre><code>int rows = 12, i = 1, j = 1;\n\nwhile (i &lt;= rows)\n{\n    while (j &lt;= (rows - i +1))\n    {\n        printf(\"*\");\n        j++;\n\n    }\n    printf(\"\\n\");\n    i++;\n    j = 1;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 157, "user_id": 6232777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zfMwD.jpg?s=128&g=1", "display_name": "Stealing", "link": "https://stackoverflow.com/users/6232777/stealing"}, "is_accepted": false, "score": 0, "last_activity_date": 1549482494, "last_edit_date": 1592644375, "creation_date": 1549482494, "answer_id": 54561453, "question_id": 54558533, "link": "https://stackoverflow.com/questions/54558533/why-does-the-code-give-me-wrong-triangle/54561453#54561453", "title": "Why does the code give me wrong triangle?", "body": "<p>Basically you have to reverse your loops. So for each loop in your code you're increasing the number of instances '*' is printed for each iteration of <code>i</code>. This is because <code>i</code> and <code>j</code> start at 1 and are increased until the number of iterations equals <code>rows</code>.</p>\n<pre><code>int rows = 12, i = 1, j = 1;\n\nwhile (i &lt;= rows)\n{\n    while (j &lt;= (rows - i +1))\n    {}\n}\n</code></pre>\n<p>What you want is to start from 12, and decrement each time until you hit 0. So to start with you can loose the variable <code>rows</code>, and set <code>i</code> and <code>j</code> equal to 12. In the outer <code>while()</code> loop you want to decrement <code>i</code> and reset <code>j = i</code> each time the inner loop closes. The inner loop should print * and decrement j. Below is my solutions, but <a href=\"https://stackoverflow.com/users/3344587/loc-tran\">Loc Tran's</a> answer works just as well.</p>\n<pre><code>int main(void){\nint i = 12, j = 12;\n\nwhile(i &gt;=0)\n{\n    while(j &gt;= 0)\n    {\n        printf(&quot;*&quot;);\n        j--;\n\n    }\n    printf(&quot;\\n&quot;);\n    i--;\n    j=i;\n}\n</code></pre>\n<p>}</p>\n<p>If this is for a school assignment (I had one quite similar in a 1st year course) I suggest you try understand why your code is different to the provided solutions.</p>\n"}], "owner": {"reputation": 1, "user_id": 10956388, "user_type": "registered", "profile_image": "https://graph.facebook.com/1085682394952881/picture?type=large", "display_name": "Dilip Maharjan", "link": "https://stackoverflow.com/users/10956388/dilip-maharjan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1549482494, "creation_date": 1549471379, "last_edit_date": 1549471395, "question_id": 54558533, "link": "https://stackoverflow.com/questions/54558533/why-does-the-code-give-me-wrong-triangle", "title": "Why does the code give me wrong triangle?", "body": "<p>Make a triangle</p>\n\n<pre><code>*\n**\n***\n****\n*****\n******\n*******\n********\n*********\n**********\n***********\n************\n</code></pre>\n\n<p>&nbsp;</p>\n\n<pre><code>int rows = 12, i = 1, j = 1;\n\n    while(i &lt;= rows)\n    {\n        while(j &lt;= i)\n        {\n            printf(\"*\");\n            j++;\n\n        }\n        printf(\"\\n\");\n        i++;\n        j=1;\n</code></pre>\n\n<p>I try to make a triangle like </p>\n\n<pre><code>********\n*******\n******\n*****\n****\n***\n**\n*\n</code></pre>\n\n<p>but i am getting wrong.</p>\n"}, {"tags": ["c", "gcc", "assembly", "conditional"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 6, "creation_date": 1549470739, "post_id": 54558152, "comment_id": 95916286, "body": "The optimisation is invalid as cmov performs an unconditional load from its source operand, faulting even if it does not end up being used."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549470961, "post_id": 54558152, "comment_id": 95916400, "body": "Edited code does not solve it. The source location is accessed even if the condition is false."}, {"owner": {"reputation": 29848, "user_id": 5958455, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/lBWIE.png?s=128&g=1", "display_name": "iBug", "link": "https://stackoverflow.com/users/5958455/ibug"}, "edited": false, "score": 0, "creation_date": 1549471123, "post_id": 54558152, "comment_id": 95916495, "body": "thanks guys I think I have a better understanding now. But does anyone know if there&#39;s any chance of getting a CMOV instruction?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1549471281, "post_id": 54558152, "comment_id": 95916589, "body": "@iBug Like <i>any</i> <code>cmov</code>? For just some C code? Here: <a href=\"https://godbolt.org/z/UkonTX\" rel=\"nofollow noreferrer\">godbolt.org/z/UkonTX</a>"}, {"owner": {"reputation": 29848, "user_id": 5958455, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/lBWIE.png?s=128&g=1", "display_name": "iBug", "link": "https://stackoverflow.com/users/5958455/ibug"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549471397, "post_id": 54558152, "comment_id": 95916642, "body": "@EugeneSh. I assume its functionality should be retained, i.e. dereference a pointer, return 0 if NULL&gt;"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1549472455, "post_id": 54558152, "comment_id": 95917250, "body": "@iBug Your updated code is not producing <code>cmove</code>  for me here: <a href=\"https://godbolt.org/z/C_cGjB\" rel=\"nofollow noreferrer\">godbolt.org/z/C_cGjB</a> , but it does with <code>-O1</code>. Also note, that you don&#39;t need <code>z</code> to be <code>static</code>."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1549473817, "post_id": 54558152, "comment_id": 95917947, "body": "You could first conditionally overwrite the pointer with a dummy pointer if it is NULL and then conditionally move the pointee to the result. E.g. <code>xor %eax, %eax; test %rdi, %rdi; cmovz %rsp, %rdi; cmovnz (%rdi), %rax</code>.  This could perform slightly better than the jump but I think it only does if the jump is poorly predicted."}, {"owner": {"reputation": 221394, "user_id": 366904, "user_type": "moderator", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3f8912af19fe86b7b34a0b011a962460?s=128&d=identicon&r=PG", "display_name": "Cody Gray", "link": "https://stackoverflow.com/users/366904/cody-gray"}, "edited": false, "score": 1, "creation_date": 1549478362, "post_id": 54558152, "comment_id": 95920026, "body": "Beyond the correctness issue pointed out by fuz and others, even if you could use a conditional-move, it&#39;s very unlikely to be an optimization over a simple branch. Why? Branch prediction. Branch prediction on modern processors works in your favor as long as the branches are predictable, and null pointer checks are quite predictable. You&#39;ll find that Intel&#39;s compiler prefers to just test-and-branch in such cases, even when it could use a conditional move."}], "answers": [{"tags": [], "owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "is_accepted": false, "score": 0, "last_activity_date": 1549474222, "creation_date": 1549474222, "answer_id": 54559374, "question_id": 54558152, "link": "https://stackoverflow.com/questions/54558152/conditional-move-instruction-on-a-null-check-before-dereferencing-a-pointer/54559374#54559374", "title": "Conditional move instruction on a NULL check before dereferencing a pointer", "body": "<p>Here is a branch-less version:</p>\n\n<pre><code>inline long* select(long* p, long* q) {\n    uintptr_t a = (uintptr_t)p;\n    uintptr_t b = (uintptr_t)q;\n    uintptr_t c = !a;\n    uintptr_t r = (a &amp; (c - 1)) | (b &amp; (!c - 1));\n    return (long*)r;\n}\n\nlong cond(long* p) {\n    long t = 0;\n    return *select(p, &amp;t);\n}\n</code></pre>\n\n<p>Assembly for gcc-8.2:</p>\n\n<pre><code>cond(long*):\n        mov     QWORD PTR [rsp-8], 0\n        xor     eax, eax\n        test    rdi, rdi\n        sete    al\n        lea     rdx, [rax-1]\n        neg     rax\n        and     rdi, rdx\n        lea     rdx, [rsp-8]\n        and     rax, rdx\n        or      rdi, rax\n        mov     rax, QWORD PTR [rdi]\n        ret\n</code></pre>\n\n<p>Assembly for clang-7:</p>\n\n<pre><code>cond(long*):                              # @cond(long*)\n        mov     qword ptr [rsp - 8], 0\n        xor     eax, eax\n        test    rdi, rdi\n        lea     rcx, [rsp - 8]\n        cmovne  rcx, rax\n        or      rcx, rdi\n        mov     rax, qword ptr [rcx]\n        ret\n</code></pre>\n"}], "owner": {"reputation": 29848, "user_id": 5958455, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/lBWIE.png?s=128&g=1", "display_name": "iBug", "link": "https://stackoverflow.com/users/5958455/ibug"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 274, "favorite_count": 0, "closed_date": 1549478129, "answer_count": 1, "score": 1, "last_activity_date": 1549495432, "creation_date": 1549470173, "last_edit_date": 1549473130, "question_id": 54558152, "link": "https://stackoverflow.com/questions/54558152/conditional-move-instruction-on-a-null-check-before-dereferencing-a-pointer", "closed_reason": "Duplicate", "title": "Conditional move instruction on a NULL check before dereferencing a pointer", "body": "<p>I'm working on exercise 3.61 of CSAPP, which requires to write a very simple function that checks if a pointer is <code>NULL</code> before trying to dereference it, which should base on a conditional move instruction rather than a jump. Here's an example I've found online:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>long cond(long* p) {\n    return (!p) ? 0 : *p;\n}\n</code></pre>\n\n<p>According to claims, the function can be compiled into the following assembly:</p>\n\n<pre><code>cond:\n    xor eax, eax\n    test rdi, rdi\n    cmovne rax, QWORD PTR [rdi]\n    ret\n</code></pre>\n\n<p>I am running GCC 7.3.0 (from APT package <code>gcc/bionic-updates,now 4:7.3.0-3ubuntu2.1 amd64</code>) on Ubuntu 18.04 on WSL. The computer is running on an Intel Coffee Lake (i.e. 8th-gen Core-i) processor.</p>\n\n<p>I have tried the following commands:</p>\n\n<pre><code>gcc -S a.c -O3\ngcc -S a.c -O3 -march=x86-64\ngcc -S a.c -O3 -march=core2\ngcc -S a.c -O3 -march=k8\n</code></pre>\n\n<p>Honestly, I wasn't able to observe any difference in the generated <code>a.s</code> file, since all of them look like</p>\n\n<pre><code>cond:\n    xorl    %eax, %eax\n    testq   %rdi, %rdi\n    je      .L1\n    movq    (%rdi), %rax\n.L1:\n    ret\n</code></pre>\n\n<p>Is there any possibility to have such a function that compiles into a conditional move, without a jump?</p>\n\n<hr>\n\n<p><strong>Edit:</strong> As told in comments, the CMOVxx series of instructions loads operands unconditionally, and only the actual assignment operation is conditional, so there'd be no luck to put <code>*p</code> (or <code>(%rdi)</code>) as the source operand of CMOV, is it right?</p>\n\n<p>The claim is on <a href=\"https://dreamanddead.gitbooks.io/csapp-3e-solutions/chapter3/3.61.html\" rel=\"nofollow noreferrer\">this page</a> but I think it's invalid.</p>\n"}, {"tags": ["c", "long-double"], "comments": [{"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 2, "creation_date": 1549470489, "post_id": 54558150, "comment_id": 95916136, "body": "TDM-GCC is based on MinGW which doesn&#39;t properly support <code>long double</code>. At least this was the case a few years ago, I don&#39;t know if it&#39;s changed."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1549471818, "post_id": 54558150, "comment_id": 95916888, "body": "You might need to define the <code>__USE_MINGW_ANSI_STDIO</code> macro as <code>1</code>, e.g. by adding <code>#define __USE_MINGW_ANSI_STDIO 1</code> before <code>#include &lt;stdio.h&gt;</code>, or by compiling with the <code>-D__USE_MINGW_ANSI_STDIO=1</code> option (the <code>=1</code> part can be omitted as that is the default for a macro defined by the <code>-D</code> option)."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549498347, "post_id": 54558150, "comment_id": 95927823, "body": "regarding: <code>void main(){</code>  in C, there are only two valid signatures for <code>main</code>  they are: <code>int main( void )</code> and <code>int main( int argc, char *argv[] )</code> Unfortunately, visual studio allows code that is not valid C."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549498414, "post_id": 54558150, "comment_id": 95927847, "body": "regarding: <code>printf(&quot;%Lf&quot;,a);</code>  The C language is case sensitive.  so <code>lf</code> is valid, but <code>Lf</code> is not"}, {"owner": {"reputation": 1, "user_id": 11023972, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cLrTR2sv-PA/AAAAAAAAAAI/AAAAAAAAAEg/odaLJ5dvODg/photo.jpg?sz=128", "display_name": "Kabir Uddin", "link": "https://stackoverflow.com/users/11023972/kabir-uddin"}, "edited": false, "score": 0, "creation_date": 1549501058, "post_id": 54558150, "comment_id": 95928412, "body": "How do I fix this? Is it my fault or the compiler&#39;s?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549505294, "post_id": 54558150, "comment_id": 95929262, "body": "@user3629249 Disagree with <a href=\"https://stackoverflow.com/questions/54558150/printing-long-double-goes-wrong#comment95927823_54558150\">only 2</a>.   C specifies  <code>int main(void)</code>, <code>int main(int argc, char *argv[])</code>, or equivalent or in some other implementation-defined manner. C11 &#167;5.1.2.2.1 1"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549505420, "post_id": 54558150, "comment_id": 95929283, "body": "@user3629249 OP&#39;s <code>&quot;%Lf&quot;</code> is valid and matches <code>long double</code> since C99.  The compiler is suspect."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1549506085, "post_id": 54558150, "comment_id": 95929417, "body": "@chux I agree, the compiler being used by the OP is not upto date.  so the <code>%Lf</code> is not valid for that compiler  And <code>void main()</code> has always been invalid"}], "owner": {"reputation": 1, "user_id": 11023972, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cLrTR2sv-PA/AAAAAAAAAAI/AAAAAAAAAEg/odaLJ5dvODg/photo.jpg?sz=128", "display_name": "Kabir Uddin", "link": "https://stackoverflow.com/users/11023972/kabir-uddin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549470172, "creation_date": 1549470172, "question_id": 54558150, "link": "https://stackoverflow.com/questions/54558150/printing-long-double-goes-wrong", "title": "printing long double goes wrong", "body": "<p>I was working with Dev-Cpp with my TDM-GCC 4.9.2 64-bit Release. But suddenly got stuck in printing long double values. </p>\n\n<pre><code>     #include&lt;stdio.h&gt;\n     void main(){\n     long double a = 22.0/7.0;\n     printf(\"%Lf\",a);\n}\n</code></pre>\n\n<p>It compiled well. Then when I ran it it said : \"Error 216: This version of %1 is not compatible with the version\"</p>\n\n<p>What should I do?</p>\n\n<p>I am not such a good programmer. If you would put some explanations and help me fix this I would be grateful </p>\n"}, {"tags": ["c", "file"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 3, "creation_date": 1549469582, "post_id": 54557875, "comment_id": 95915595, "body": "Read all of the data and count? Pretty much answering the question."}, {"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 1, "creation_date": 1549470074, "post_id": 54557875, "comment_id": 95915873, "body": "There is no nontrivial platform independent way to do it."}], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "closed_date": 1549471132, "answer_count": 0, "score": 1, "last_activity_date": 1549471792, "creation_date": 1549469368, "question_id": 54557875, "link": "https://stackoverflow.com/questions/54557875/is-there-a-well-defined-platform-independent-way-to-get-the-size-in-bytes-of", "closed_reason": "Duplicate", "title": "Is there a well-defined, platform-independent way to get the size, in bytes, of a file opened in binary mode in C?", "body": "<p>Normally I use the following code to determine the size of a file opened in <code>fp</code> in C:</p>\n\n<pre><code>size_t len;\nfseek(fp, 0, SEEK_END);\nlen = ftell(fp);\nrewind(fp);\n</code></pre>\n\n<p>The C Standard (<em>&sect; 7.21.3, Files</em>) has the following footnote:</p>\n\n<blockquote>\n  <p>Setting the file position indicator to end-of-file, as with <code>fseek(file, 0, SEEK_END)</code>, has undefined behavior for a binary stream (because of possible trailing null characters) or for any stream with state-dependent encoding that does not assuredly end in the initial shift state.</p>\n</blockquote>\n\n<p>I have not observed any cases myself where this method has failed to produce the correct size for a binary file in C code myself, but according to the standard it is not well defined unless (at least) the file is open in text mode.</p>\n\n<p>The other methods I know of for determining a file size are platform-dependent (like the <code>stat</code> family of functions, and <code>GetFileSize(Ex)</code> on Windows).</p>\n\n<p>Is there, then, any platform-independent way to determine the length of a <code>FILE</code> open in binary mode using only standard C functions?</p>\n"}, {"tags": ["c", "openssl", "mpi", "linker-errors", "dynamic-linking"], "answers": [{"comments": [{"owner": {"reputation": 7287, "user_id": 8062491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rd6rD.png?s=128&g=1", "display_name": "Gilles Gouaillardet", "link": "https://stackoverflow.com/users/8062491/gilles-gouaillardet"}, "edited": false, "score": 0, "creation_date": 1549497306, "post_id": 54559828, "comment_id": 95927556, "body": "fwiw, an other option is to <code>export LD_LIBRARY_PATH=${CURDIR}builds&#47;openssl&#47;lib:$LD_LIBRARY_PATH</code>"}, {"owner": {"reputation": 10953, "user_id": 776473, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dbfcfc0e3c4b2b0baef2383fbc97f687?s=128&d=identicon&r=PG", "display_name": "acm", "link": "https://stackoverflow.com/users/776473/acm"}, "reply_to_user": {"reputation": 7287, "user_id": 8062491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rd6rD.png?s=128&g=1", "display_name": "Gilles Gouaillardet", "link": "https://stackoverflow.com/users/8062491/gilles-gouaillardet"}, "edited": false, "score": 0, "creation_date": 1549508615, "post_id": 54559828, "comment_id": 95929876, "body": "Not really an option because then you need that set in your environment every time you want to run the binary."}, {"owner": {"reputation": 7287, "user_id": 8062491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rd6rD.png?s=128&g=1", "display_name": "Gilles Gouaillardet", "link": "https://stackoverflow.com/users/8062491/gilles-gouaillardet"}, "edited": false, "score": 0, "creation_date": 1549514485, "post_id": 54559828, "comment_id": 95931068, "body": "Strictly speaking, that is still an option - that does not require a rebuild if there is a typo in the command ;-) And yet an other option is to build openssl as a static library only."}], "tags": [], "owner": {"reputation": 10953, "user_id": 776473, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dbfcfc0e3c4b2b0baef2383fbc97f687?s=128&d=identicon&r=PG", "display_name": "acm", "link": "https://stackoverflow.com/users/776473/acm"}, "is_accepted": false, "score": 0, "last_activity_date": 1549514342, "last_edit_date": 1549514342, "creation_date": 1549475902, "answer_id": 54559828, "question_id": 54557590, "link": "https://stackoverflow.com/questions/54557590/failed-to-load-ibcrypto-so-3-using-the-locally-compiled-openssl/54559828#54559828", "title": "Failed to load ibcrypto.so.3 using the Locally compiled OpenSSL", "body": "<p>It does not appear that you have added a runtime search path for dynamic libraries to your executable. Have a look at the <code>-rpath</code> link flag. Most likely, you will need to add something like <code>-Wl,-rpath,${CURDIR}/builds/openssl/lib</code> to your link flags.</p>\n"}], "owner": {"reputation": 6282, "user_id": 4706711, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh3.googleusercontent.com/-dlNFOguGD_A/AAAAAAAAAAI/AAAAAAAABwA/BMlWtrTgZtY/photo.jpg?sz=128", "display_name": "Dimitrios Desyllas", "link": "https://stackoverflow.com/users/4706711/dimitrios-desyllas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1549514342, "creation_date": 1549468373, "question_id": 54557590, "link": "https://stackoverflow.com/questions/54557590/failed-to-load-ibcrypto-so-3-using-the-locally-compiled-openssl", "title": "Failed to load ibcrypto.so.3 using the Locally compiled OpenSSL", "body": "<p>I have the following <code>Makefile</code>:</p>\n\n<pre><code>CC=mpicc\n\n# use headers from builds/openssl\nCFLAGS := -g -I${CURDIR}builds/openssl/include/openssl\n\n# look for library in builds/openssl\nLDFLAGS := -L${CURDIR}builds/openssl/lib\nLIBS    := -lcrypto -lssl\n\n.PHONY: all\nall: builds/main\n\nbuilds:\n    mkdir -p $@\n\nbuilds/main: builds/dh.o builds/message.o\nbuilds/main: main.c\n    $(CC) $(CFLAGS) -o $@ $&lt; builds/dh.o builds/message.o $(LDFLAGS) $(LIBS)\n\nbuilds/dh.o: dh.h\nbuilds/dh.o: dh.c\n    $(CC) $(CFLAGS) -o $@ -c $&lt;\n\nbuilds/message.o: message.h\nbuilds/message.o: message.c\n    $(CC) $(CFLAGS) -o $@ -c $&lt;\n\nbuilds/dh.o builds/message.o builds/main: builds\n\n# if you want to build openssl with your makefile...\nbuilds/dh.o builds/message.o builds/main: builds/openssl\nbuilds/openssl: builds\n    cd openssl &amp;&amp; ./config --prefix=${CURDIR}/builds/openssl --openssldir=${CURDIR}/builds/openssl &amp;&amp; make &amp;&amp; make test &amp;&amp; make install\n\n.PHONY: run\n\nrun: builds/main\n    mpirun -quiet -np 3 xterm -hold -e ./builds/main &amp;\n\n.PHONY: debug\n\ndebug: builds/main\n    mpirun -quiet -np 3 xterm -e gdb ./builds/main\n\n.PHONY: clean\n\nclean:\n    rm -rf ./builds\n</code></pre>\n\n<p>That sompiles sucessfully my code. But whenb I try to ruin it via these commands:</p>\n\n<pre><code>make clean &amp;&amp; make run\n</code></pre>\n\n<p>The application runs but I get the following error:</p>\n\n<blockquote>\n  <p>./builds/main: error while loading shared libraries: libcrypto.so.3: cannot open shared object file\" No such file or directory</p>\n</blockquote>\n\n<p>I tried to change my <code>Makefile</code> like that:</p>\n\n<pre><code>CC=mpicc\n\n# use headers from builds/openssl\nCFLAGS := -g -I${CURDIR}builds/openssl/include/openssl\n\n# look for library in builds/openssl\nLDFLAGS := -L${CURDIR}builds/openssl/lib\nLIBS    := -lcrypto -lssl\n\n.PHONY: all\nall: builds/main\n\nbuilds:\n    mkdir -p $@\n\nbuilds/main: builds/dh.o builds/message.o\nbuilds/main: main.c\n    $(CC) $(CFLAGS) -o $@ $&lt; builds/dh.o builds/message.o $(LDFLAGS) $(LIBS)\n\nbuilds/dh.o: dh.h\nbuilds/dh.o: dh.c\n    $(CC) $(CFLAGS) -o $@ -c $&lt;\n\nbuilds/message.o: message.h\nbuilds/message.o: message.c\n    $(CC) $(CFLAGS) -o $@ -c $&lt;\n\nbuilds/dh.o builds/message.o builds/main: builds\n\n# if you want to build openssl with your makefile...\nbuilds/dh.o builds/message.o builds/main: builds/openssl\nbuilds/openssl: builds\n    cd openssl &amp;&amp; ./config --prefix=${CURDIR}/builds/openssl --openssldir=${CURDIR}/builds/openssl &amp;&amp; make &amp;&amp; make test &amp;&amp; make install\n\n.PHONY: run\n\nrun: builds/main\n    mpirun -quiet -np 3 xterm -hold -e ./builds/main &amp;\n\n.PHONY: debug\n\ndebug: builds/main\n    mpirun -quiet -np 3 xterm -e gdb ./builds/main\n\n.PHONY: clean\n\nclean:\n    rm -rf ./builds\n</code></pre>\n\n<p>And failed to compile at all:</p>\n\n<pre><code>main.c: In function \u2018main\u2019:\nmain.c:76:10: warning: implicit declaration of function \u2018DH_get0_pub_key\u2019 [-Wimplicit-function-declaration]\n   pubKey=DH_get0_pub_key(secret);\n          ^\nmain.c:76:9: warning: assignment makes pointer from integer without a cast [-Wint-conversion]\n   pubKey=DH_get0_pub_key(secret);\n         ^\nmain.c:125:5: warning: implicit declaration of function \u2018DH_get0_p\u2019 [-Wimplicit-function-declaration]\n   p=DH_get0_p(secret);\n     ^\nmain.c:125:4: warning: assignment makes pointer from integer without a cast [-Wint-conversion]\n   p=DH_get0_p(secret);\n    ^\n/tmp/ccgccndI.o: In function `main':\n/home/pcmagas/Kwdikas/master_thesis/mpi_dh/main.c:76: undefined reference to `DH_get0_pub_key'\n/home/pcmagas/Kwdikas/master_thesis/mpi_dh/main.c:125: undefined reference to `DH_get0_p'\nbuilds/dh.o: In function `generateKeys':\n/home/pcmagas/Kwdikas/master_thesis/mpi_dh/dh.c:20: undefined reference to `DH_set0_pqg'\nbuilds/dh.o: In function `generateKeyFromPreviousParticipant':\n/home/pcmagas/Kwdikas/master_thesis/mpi_dh/dh.c:136: undefined reference to `DH_get0_priv_key'\n/home/pcmagas/Kwdikas/master_thesis/mpi_dh/dh.c:147: undefined reference to `DH_get0_p'\ncollect2: error: ld returned 1 exit status\nMakefile:18: recipe for target 'builds/main' failed\n</code></pre>\n\n<p>Meaning if compared to the original result is fails to see the library at all whilst on the first error my project is compliled sucessfully but fails to load the dynamic library.</p>\n\n<p>The OpenSSL is loaded via a git submodule as been in this <a href=\"https://stackoverflow.com/q/54543348/4706711\">question</a> in order to avoid using a possibly outdated version of it.</p>\n\n<p>So how I can tell in the first case to load the dynamic library or even how I can build the OpenSSL as a static library/(ries)?</p>\n"}, {"tags": ["c", "linux", "kernel", "popen"], "comments": [{"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1549468192, "post_id": 54557497, "comment_id": 95914726, "body": "Suppress warnings. Possible duplicate of <a href=\"https://stackoverflow.com/q/34288844/608639\">What does casting to `void` really do?</a>"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1549468197, "post_id": 54557497, "comment_id": 95914730, "body": "I&#39;m <i>guessing</i> that the variable <code>f</code> isn&#39;t used anywhere else? Then that&#39;s to suppress possible warnings about unused variables. Personally I would rather cast the call to <code>popen</code> instead of having the unused variable."}, {"owner": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "edited": false, "score": 0, "creation_date": 1549468198, "post_id": 54557497, "comment_id": 95914731, "body": "Usually <code>(void)f</code> is called to silence compiler complaints (if you don&#39;t directly reference it)."}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 0, "last_activity_date": 1549468295, "creation_date": 1549468295, "answer_id": 54557564, "question_id": 54557497, "link": "https://stackoverflow.com/questions/54557497/c-programming-call-file-variable/54557564#54557564", "title": "C programming call FILE *variable", "body": "<p>This piece of code, as per the comment, is using <code>popen</code> to start a background process.  This function returns a <code>FILE *</code> to one end of the pipe.  </p>\n\n<p>This code however does not use the value of <code>f</code>.  Typically, a compiler will print a warning if a variable is unused.  Using <code>f</code> in an expression by itself casted to <code>void</code> uses the value of <code>f</code> but explicitly discards that value, preventing the warning from being printed.</p>\n"}], "owner": {"reputation": 2591, "user_id": 3406289, "user_type": "registered", "profile_image": "https://graph.facebook.com/770412499/picture?type=large", "display_name": "Breno Leit&#227;o", "link": "https://stackoverflow.com/users/3406289/breno-leit%c3%a3o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "closed_date": 1549468536, "answer_count": 1, "score": 0, "last_activity_date": 1549468569, "creation_date": 1549468105, "last_edit_date": 1549468569, "question_id": 54557497, "link": "https://stackoverflow.com/questions/54557497/c-programming-call-file-variable", "closed_reason": "Duplicate", "title": "C programming call FILE *variable", "body": "<p>I see this code in the Linux kernel but I am not able to understand why (void) f; is being called here. Any idea?</p>\n\n<pre><code>    /* start 'ping' in the background to have some kfree_skb events */\n    f = popen(\"ping -c5 localhost\", \"r\");\n    (void) f;\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["c", "windows", "uefi"], "answers": [{"tags": [], "owner": {"reputation": 744, "user_id": 4180477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d9c8a517fe4c12162d355d287c66544?s=128&d=identicon&r=PG", "display_name": "CodeRush", "link": "https://stackoverflow.com/users/4180477/coderush"}, "is_accepted": true, "score": 2, "last_activity_date": 1549472945, "creation_date": 1549472945, "answer_id": 54558989, "question_id": 54557111, "link": "https://stackoverflow.com/questions/54557111/how-i-can-set-firmware-environment-variable-in-uefi-driver/54558989#54558989", "title": "How i can set firmware environment variable in UEFI driver", "body": "<p>The function to set an NVRAM variable is called SetVariable() and is available to UEFI drivers via EFI_RUNTIME_SERVICES table.</p>\n\n<p>To know more about it's interface and usage, read chapter 7.2 Variable Services of the <a href=\"https://www.uefi.org/sites/default/files/resources/UEFI%20Spec%202_6.pdf\" rel=\"nofollow noreferrer\">UEFI 2.6 specification</a>. </p>\n"}], "owner": {"reputation": 189, "user_id": 9220329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35dd2a1865acb62efd476124455ba2ff?s=128&d=identicon&r=PG&f=1", "display_name": "spartaneg", "link": "https://stackoverflow.com/users/9220329/spartaneg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 608, "favorite_count": 0, "accepted_answer_id": 54558989, "answer_count": 1, "score": 0, "last_activity_date": 1549472945, "creation_date": 1549466936, "last_edit_date": 1549471806, "question_id": 54557111, "link": "https://stackoverflow.com/questions/54557111/how-i-can-set-firmware-environment-variable-in-uefi-driver", "title": "How i can set firmware environment variable in UEFI driver", "body": "<p>In a Windows application, I have a <code>GetFirmwareEnvironmentVariableA</code> function to read a firmware environment variable. Is there any way to write something in this variable in uefi driver and read from it later in Windows?</p>\n"}, {"tags": ["c", "arrays", "string"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1549466877, "post_id": 54557041, "comment_id": 95913757, "body": "No, you can&#39;t &quot;do <code>strcat(string, another_string)</code> without concern about size problem&quot;. There is no room for the concatenation."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549466880, "post_id": 54557041, "comment_id": 95913761, "body": "In order <code>printf</code> could print the string, it should be a proper null-terminated string. But your code is purposely truncating the null-terminator."}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 1, "creation_date": 1549466973, "post_id": 54557041, "comment_id": 95913821, "body": "your code will exhibit <i><a href=\"http://blog.llvm.org/2011/05/what-every-c-programmer-should-know.html\" rel=\"nofollow noreferrer\">undefined behavior</a></i>.  It will perhaps sometimes work, then suddenly it will not."}, {"owner": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1549466985, "post_id": 54557041, "comment_id": 95913833, "body": "@WeatherVane thats why i did <code>strncpy(b, a, (int)(sizeof(b) - 1));</code> because i concern size problem but it still gives me random stuff in later code?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1549467133, "post_id": 54557041, "comment_id": 95913925, "body": "The example in your narrative is <code>char string[] = &quot;first string&quot;; strcat(string, another_string);</code> There is no room because <code>string</code> is exactly 13 bytes in size, ending with the <code>&#39;\\0&#39;</code> terminator."}, {"owner": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "reply_to_user": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1549467182, "post_id": 54557041, "comment_id": 95913961, "body": "@ryyker 3, thats how much memory i gave it to"}, {"owner": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1549467476, "post_id": 54557041, "comment_id": 95914155, "body": "@WeatherVane if i do <code>char a[] = &quot;kenny&quot;; char b[] = &quot; confused&quot;; strcat(a, b); printf(&quot;%s\\n&quot;, a);</code> it still print out <code>kenny confused</code>, so seems like original 6 bytes of &#39;a&#39; is ignored."}, {"owner": {"reputation": 6023, "user_id": 2417459, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/QcuXb.png?s=128&g=1", "display_name": "i486", "link": "https://stackoverflow.com/users/2417459/i486"}, "edited": false, "score": 0, "creation_date": 1549467524, "post_id": 54557041, "comment_id": 95914207, "body": "When the string is defined with double quotes (e.g. &quot;abc&quot;), the null byte <code>\\0</code> is automatically added. <code>&quot;abc&quot;</code> will be compiled as 4 bytes (hex): <code>61 62 63 00</code>."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1549467538, "post_id": 54557041, "comment_id": 95914217, "body": "Well that was plain unlucky that <code>b</code> just happened to follow <code>a</code> in memory. It saved you being tipped off to the error by, say, a segfault. Note about <code>strcat</code>: <i>&quot;The behavior of strcat is undefined if the source and destination strings overlap.&quot;</i>."}], "answers": [{"tags": [], "owner": {"reputation": 362, "user_id": 5331696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53418e9ac96de6ad4951d5b8140fc22c?s=128&d=identicon&r=PG&f=1", "display_name": "vasile_t", "link": "https://stackoverflow.com/users/5331696/vasile-t"}, "is_accepted": false, "score": 0, "last_activity_date": 1549467042, "creation_date": 1549467042, "answer_id": 54557148, "question_id": 54557041, "link": "https://stackoverflow.com/questions/54557041/c-strings-behave-so-weird/54557148#54557148", "title": "C strings behave so weird", "body": "<p>You have to add the string terminator \\0 to the b, in a way or another. The printf(\"%s\\n\", b) will stop when it will find the \\0. </p>\n\n<p>It depends on what you have on memory, sometimes seg fault is to be expected. </p>\n"}, {"tags": [], "owner": {"reputation": 7829, "user_id": 4950584, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xTMYK-wVa7U/AAAAAAAAAAI/AAAAAAAAAGA/x2vE5BBF-hM/photo.jpg?sz=128", "display_name": "Chris Turner", "link": "https://stackoverflow.com/users/4950584/chris-turner"}, "is_accepted": false, "score": 1, "last_activity_date": 1549467451, "creation_date": 1549467451, "answer_id": 54557261, "question_id": 54557041, "link": "https://stackoverflow.com/questions/54557041/c-strings-behave-so-weird/54557261#54557261", "title": "C strings behave so weird", "body": "<p>If you read the documentation for <code>strncpy</code> it quite clearly states that it won't add a NUL terminator if the size you specify doesn't include it:</p>\n\n<blockquote>\n  <p>The strncpy() function is similar, except that at most n  bytes  of  src  are\n  copied.   Warning:  If  there is no null byte among the first n bytes of src,\n  the string placed in dest will not be null-terminated.</p>\n</blockquote>\n\n<p>So in the following case, you're only copying 2 characters and neither of them are the NUL terminator so you need to add it yourself.</p>\n\n<pre><code>strncpy(b, a, (int)(sizeof(b) - 1));\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "edited": false, "score": 0, "creation_date": 1549468203, "post_id": 54557265, "comment_id": 95914737, "body": "thx a lot! but when i do <code>char a[] = &quot;kenny&quot;; char b[] = &quot; confused&quot;; strcat(a, b); printf(&quot;%s\\n&quot;, a);</code> it still print out <code>kenny confused</code>, so seems like original 6 bytes of <code>a</code> is ignored somehow"}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "reply_to_user": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "edited": false, "score": 0, "creation_date": 1549468338, "post_id": 54557265, "comment_id": 95914831, "body": "@KennyWang - Carefully read the links I left describing <i>undefined behavior</i>."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1554535619, "post_id": 54557265, "comment_id": 97795867, "body": "You should be more explicit about <code>strncpy</code>: <a href=\"https://randomascii.wordpress.com/2013/04/03/stop-using-strncpy-already/\" rel=\"nofollow noreferrer\">randomascii.wordpress.com/2013/04/03/stop-using-strncpy-alre&zwnj;&#8203;ady</a>"}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "reply_to_user": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1554902287, "post_id": 54557265, "comment_id": 97921049, "body": "@chqrlie - If you are suggesting that I discourage use of the <i>r</i> string functions, (inferred by the link you provided.)   I am not in agreement with what the author is suggesting about <i>not</i> using the <code>r string</code> functions.  I noticed in other comments that you agree with him, but I have found them very useful on many occasions when size of destination string is fixed, but size of string to copy is unknown.  However, I do appreciate your position on the topic.  Thanks."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1554911773, "post_id": 54557265, "comment_id": 97926873, "body": "@ryyker: I&#39;m not sure which <code>r</code> string functions you refer to, I am specifically annoyed by <code>strncpy</code>, not so much with <code>strncat</code> and the article in reference has too much of a C++ bias, he is not proposing a simple alternative to <code>strncpy</code> with intuitive semantics such as <code>snprintf(dest, size, &quot;%s&quot;, src);</code>: Copy the string if it fits and otherwise truncate it, but always terminate it with a null byte."}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "reply_to_user": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565795196, "post_id": 54557265, "comment_id": 101464467, "body": "@chqrlie -  I know this is a little delayed, but I took another look at the link you provided above. (3rd comment from top.)  This time I perused the content and comments (with coffee this time :)), and truly enjoyed the volume and quality of response traffic the post received.  I also found the alternative he proposes for <code>strncpy()</code> interesting, but then realized its application is limited to <code>C++</code> usage.  I did not know if you were aware of that.  Have you run across alternatives to the <code>strncpy()</code> function implemented in <code>C</code> that you are partial to?  Again, I appreciate your perspective."}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "reply_to_user": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1565795408, "post_id": 54557265, "comment_id": 101464600, "body": "... @chqrlie - btw, I have read <i><a href=\"https://stackoverflow.com/questions/41869803/what-is-the-best-alternative-to-strncpy\">this</a></i>.  If you do know of a  custom function solution as a replacement, that would be my preference over non-standard library alternatives."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 1, "creation_date": 1565861849, "post_id": 54557265, "comment_id": 101483221, "body": "@ryyker: I updated my answer <a href=\"https://stackoverflow.com/a/41885173/4593267\">stackoverflow.com/a/41885173/4593267</a> to the question with more custom functions which I found useful in my projects."}], "tags": [], "owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "is_accepted": false, "score": 4, "last_activity_date": 1554481591, "last_edit_date": 1554481591, "creation_date": 1549467465, "answer_id": 54557265, "question_id": 54557041, "link": "https://stackoverflow.com/questions/54557041/c-strings-behave-so-weird/54557265#54557265", "title": "C strings behave so weird", "body": "<p>By definition, in the statement:</p>\n\n<pre><code>char string[] = \"first string\"\n</code></pre>\n\n<p><code>string</code> is populated with precisely all the content it can hold:</p>\n\n<p>In memory it looks like this:</p>\n\n<pre><code>|f|i|r|s|t| |s|t|r|i|n|g|\\0|?|?|?|\n/// end of legal memory    ^\n</code></pre>\n\n<p>...illustrating why the following statement:</p>\n\n<pre><code>strcat(string, anythingElse);\n</code></pre>\n\n<p>is <em><a href=\"http://blog.llvm.org/2011/05/what-every-c-programmer-should-know.html\" rel=\"nofollow noreferrer\">undefined behavior</a></em>.  ( Otherwise known by some as <em><a href=\"http://www.catb.org/jargon/html/N/nasal-demons.html\" rel=\"nofollow noreferrer\">nasal demons</a></em>. )</p>\n\n<p>Also, regarding <em><a href=\"http://www.cplusplus.com/reference/cstring/strncpy/\" rel=\"nofollow noreferrer\">strncpy(,,)</a></em> usage.  Because it is not guaranteed to contain a <code>nul</code> character after its use, it is recommended to always explicitly append the <code>nul</code> to the proper location in the new string:</p>\n\n<pre><code>strncpy (target, source, n);\ntarget[n] = 0;\n</code></pre>\n\n<p>Where in the case of your example, <code>n</code> == <code>(sizeof(b) - 1)</code></p>\n\n<p>Note your cast to <code>(int)</code> is not needed in the above expression when using <code>sizeof</code> as the type of the 3rd parameter to <code>strncpy(,,*)</code> is <code>size_t</code>:</p>\n\n<pre><code>char *strncpy (char Target_String[], const char Source_String[], size_t Max_Chars);\n</code></pre>\n\n<p>Usage for <em><a href=\"http://www.cplusplus.com/reference/cstring/strncat/\" rel=\"nofollow noreferrer\">strncat</a></em> on the other hand, <em>does</em> append the <code>nul</code> character to the end of the resultant target string, negating the need to explicitly append a <code>nul</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "edited": false, "score": 0, "creation_date": 1549468054, "post_id": 54557345, "comment_id": 95914602, "body": "thx!! so when i do <code>char str[10] = {&#39;a&#39;, &#39;b&#39;. &#39;c&#39;};</code> do i need to explicitly hand-adding <code>\\0</code> to the end?"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "reply_to_user": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "edited": false, "score": 0, "creation_date": 1549468196, "post_id": 54557345, "comment_id": 95914729, "body": "If you do it that way, yes.  See also <a href=\"https://stackoverflow.com/questions/31296727/\">this old question</a>."}, {"owner": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "edited": false, "score": 0, "creation_date": 1549472589, "post_id": 54557345, "comment_id": 95917310, "body": "<code>char a[] = &quot;kenny&quot;; char b[3]; strcpy(b, a); printf(&quot;%s\\n&quot;, b);</code> it still gives me <code>kenny</code> even i didn&#39;t assign enough memory, do u know what happened? plus, when use <code>strcpy</code>, will <code>\\0</code> be automatically added to the end of <code>dest</code>?"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "reply_to_user": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "edited": false, "score": 0, "creation_date": 1549478769, "post_id": 54557345, "comment_id": 95920223, "body": "Yes, <code>strcpy</code> appends <code>\\0</code>.  But as I said, you must be sure the destination buffer is big enough.  If it&#39;s not (and of course 3 is not big enough for &quot;Kenny&quot;), weird and unexplainable things can happen.  (The formal definition is &quot;undefined behavior&quot;.)  And &quot;weird and unexplainable&quot; definitely includes &quot;it seems to work even though you didn&#39;t expect it to&quot;."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1554535742, "post_id": 54557345, "comment_id": 97795887, "body": "+1: <b>my recommendation is to not use <code>strncpy</code> at all. What it actually does is unusual, special, difficult to explain, and usually not what you want anyway.</b>"}], "tags": [], "owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "is_accepted": true, "score": 4, "last_activity_date": 1549478889, "last_edit_date": 1549478889, "creation_date": 1549467687, "answer_id": 54557345, "question_id": 54557041, "link": "https://stackoverflow.com/questions/54557041/c-strings-behave-so-weird/54557345#54557345", "title": "C strings behave so weird", "body": "<p>The thing about C strings is that they're pretty low-level, and there are a number of extra things you have to keep in mind, and sometimes do \"by hand\".</p>\n\n<p>(C++ std::strings, by contrast, are just about completely normal, high-level types.)</p>\n\n<p>In answer to your specific questions:</p>\n\n<p>You almost never need to supply a <code>\\0</code> explicitly.  Just about the only time you do is when you're building a string completely by hand.  For example, this code works:</p>\n\n<pre><code>char str[10];\nstr[0] = 'c';\nstr[1] = 'a';\nstr[2] = 't';\nstr[3] = '\\0';\nprintf(\"%s\\n\", str);\n</code></pre>\n\n<p>But if you leave out the explicit assignment to <code>str[3]</code>, it will behave erratically.  (But if you don't create strings by hand like this, you don't need to worry so much.)</p>\n\n<p>You must be extremely careful when copying strings with <code>strcpy</code>.  You must ensure that the destination string (\"buffer\") is big enough.  Nothing in C will ever take care of this for you -- nothing makes sure the destination is big enough; nothing warns you if it's not big enough.  But if it's not big enough, the strangest things can happen -- including that it seems to work, even though it shouldn't.  (The formal name for this is \"undefined behavior\".)</p>\n\n<p>In particular, if you write</p>\n\n<pre><code>char string[] = \"first string\";\nstrcat(string, another_string);\n</code></pre>\n\n<p>what you have got is a bug, pure and simple.  It is <em>not</em> true that \"in this way you have no concern about size problem\".  When you say <code>char string[] = \"...\"</code>, the compiler sizes the string just big enough to hold the initializer (and its <code>\\0</code>), in this case 13 bytes for <code>\"first string\"</code>.  The <code>[]</code> does <em>not</em> mean \"make this string big enough for any text I'll ever try to shove into it\".</p>\n\n<p>You must be even more careful when using <code>strncpy</code>.  In fact, my recommendation is to not use <code>strncpy</code> at all.  What it actually does is unusual, special, difficult to explain, and usually not what you want anyway.  (For one thing, if you have it copy less than a full string, it doesn't add a `\\0' to the destination, which helps explain why you got things like \"kekenny\".)</p>\n"}, {"tags": [], "owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "is_accepted": false, "score": 2, "last_activity_date": 1549468901, "last_edit_date": 1549468901, "creation_date": 1549467734, "answer_id": 54557365, "question_id": 54557041, "link": "https://stackoverflow.com/questions/54557041/c-strings-behave-so-weird/54557365#54557365", "title": "C strings behave so weird", "body": "<p><strong>First question</strong></p>\n\n<p>When you do</p>\n\n<pre><code>char string[] = \"first string\";\n            ^\n            No size specified\n</code></pre>\n\n<p>the compiler will reserve memory that can hold exactly the text \"first string\" and a NUL termination. If you print the size of the string, you'll get 13. In other words - the variable can <strong>not</strong> hold further data so it is meaningless to concatenate another string.</p>\n\n<p>You could do:</p>\n\n<pre><code>char string[100] = \"first string\";\n</code></pre>\n\n<p>and then you can concatenate another string.</p>\n\n<p><strong>Second question</strong></p>\n\n<p>First thing to know is that strings in C are char-arrays that contains a NUL termination.</p>\n\n<p>When you do:</p>\n\n<pre><code>char b[3];\n</code></pre>\n\n<p>you get an uninitialized array, i.e. <code>b</code> can contain anything - like <code>b = { ? , ? , ? }</code></p>\n\n<p>Then you do:</p>\n\n<pre><code>strncpy(b, a, (int)(sizeof(b) - 1));\n</code></pre>\n\n<p>meaning that you copy the 2 first characters from <code>a</code> to <code>b</code>. </p>\n\n<p>So now we know the <code>b</code> is <code>b = { 'k' , 'e' , ? }</code> Notice that the third character of <code>b</code> is still uninitialized.</p>\n\n<p>So when you do:</p>\n\n<pre><code>printf(\"string length: %i\\n\", (int)strlen(b));\nprintf(\"%s\\n\", b);\n</code></pre>\n\n<p>you use <code>b</code> as if it is a string but it isn't. There is no NUL termination. Consequently the functions (<code>printf</code>, <code>strlen</code>) gives incorrect results. Calling these function with a char array <strong>without</strong> a NUL termination is undefined behavior, i.e. anything can happen.</p>\n\n<p>What seem to happen is two things:</p>\n\n<p>a) The uninitialized character in <code>b</code> just happens to be an 'E' (in one of your examples)</p>\n\n<p>b) The string literal \"kenny\" just happens to be located in memory right after variable <code>b</code>.</p>\n\n<p>So the two string function really sees the string \"keEkenny\" which has the len 8.</p>\n\n<p>To fix this you can do:</p>\n\n<pre><code>strncpy(b, a, (int)(sizeof(b) - 1));\nb[sizeof(b) - 1] = '\\0';\n</code></pre>\n\n<p>or simply do:</p>\n\n<pre><code>char b[3] = { 0 };\n</code></pre>\n\n<p>as this will initialize all of <code>b</code>, i.e. <code>b = { '\\0' , '\\0' , '\\0' }</code></p>\n"}], "owner": {"reputation": 49, "user_id": 9613730, "user_type": "registered", "profile_image": "https://graph.facebook.com/468786450205197/picture?type=large", "display_name": "Kenny Wang", "link": "https://stackoverflow.com/users/9613730/kenny-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 0, "accepted_answer_id": 54557345, "answer_count": 5, "score": 2, "last_activity_date": 1554492523, "creation_date": 1549466750, "last_edit_date": 1592644375, "question_id": 54557041, "link": "https://stackoverflow.com/questions/54557041/c-strings-behave-so-weird", "title": "C strings behave so weird", "body": "<p>First question is about null char <code>\\0</code> at the end of string, there are so many variations in terms of when <code>\\0</code> is needed/auto-added.\nWhen declaring a char array, do I need to specify <code>\\0</code> or no? or in what case, should I specify <code>\\0</code>, what case not? Can someone give a comprehensive summary? (as in <a href=\"https://stackoverflow.com/a/23286983/9613730\">this post</a>). if you feel my question is ambiguous, then a more specific one is when declare a string in C, what is the best way, is it <code>char string[] = &quot;first string&quot;</code>, because for example, in this way, I can do <code>strcat(string, another_string)</code> without concern about size problem?</p>\n<p>Second question: I have</p>\n<pre><code>1   char a[] = &quot;kenny&quot;;\n2   char b[3];\n3   strncpy(b, a, (int)(sizeof(b) - 1));\n4   printf(&quot;%i\\n&quot;, (int)sizeof(b)); // 3\n5   printf(&quot;string length: %i\\n&quot;, (int)strlen(b)); // string length: 8\n6   printf(&quot;%s\\n&quot;, b); // give me random stuff like kekenny or keEkenny \n</code></pre>\n<ul>\n<li>3: I only want to pass 2 bytes to b</li>\n<li>4: <code>sizeof</code> behaves normally</li>\n<li>5: but why does it become 8???</li>\n<li>6: why does it give me random stuff like kekenny or keEkenny</li>\n</ul>\n<p>I just got lost what is happening in C string. I used to use C++ a lot but still can't understand how C string behaves.</p>\n"}, {"tags": ["c", "unsigned-integer"], "comments": [{"owner": {"reputation": 429, "user_id": 10209003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8d9d1dd420c5e9381d2978720c47940?s=128&d=identicon&r=PG&f=1", "display_name": "Korni", "link": "https://stackoverflow.com/users/10209003/korni"}, "edited": false, "score": 0, "creation_date": 1549467520, "post_id": 54556973, "comment_id": 95914203, "body": "By using <code>unsigned</code> for positive-only values, you have double the range of possible values you can store and avoiding to use a data type of a higher magnitude. E.g. storing the value <code>255</code> as <code>char</code> (1byte) isn&#39;t possible, but as an <code>unsigned</code> (also 1byte) it is. To store <code>255</code> as <code>signed</code> data type you need the higher magnitude which would by <code>short</code> (2bytes). Also by using the <code>unsigned</code> you can express your intention for an positive-only value for future code readers cleary,."}, {"owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "reply_to_user": {"reputation": 429, "user_id": 10209003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8d9d1dd420c5e9381d2978720c47940?s=128&d=identicon&r=PG&f=1", "display_name": "Korni", "link": "https://stackoverflow.com/users/10209003/korni"}, "edited": false, "score": 1, "creation_date": 1549467735, "post_id": 54556973, "comment_id": 95914334, "body": "@Korni The statement about <code>char</code>s is not correct - the default signedness of a char is dependent on the particular compiler you&#39;re using"}], "answers": [{"tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": false, "score": 0, "last_activity_date": 1549467616, "last_edit_date": 1549467616, "creation_date": 1549466758, "answer_id": 54557043, "question_id": 54556973, "link": "https://stackoverflow.com/questions/54556973/signed-integer-and-unsigned-integer/54557043#54557043", "title": "Signed integer and unsigned integer", "body": "<ul>\n<li><p><code>unsigned</code> types have an extra bit of storage, allowing them a maximum magnitude of 2<sup>CHAR_BIT * sizeof(type)</sup>-1 for positive values. This is why types like <code>size_t</code>, which are meant to store sizes of files, strings, arrays, etc. are unsigned.</p>\n\n<p>With signed integers, one bit is reserved for the sign, so if an <code>int</code> is 32-bits long, you only get 31 bits to store the magnitude of the number. An <code>unsigned int</code> does not have this restriction; the MSB is used for magnitude as well, but it comes at the expense of no longer being able to be negative.</p></li>\n<li><p>Signed integer overflow is undefined by the C standard, whereas unsigned integer overflow is guaranteed to wrap-around and reset to zero. For example, the following code invokes undefined behavior in C:</p>\n\n<pre><code>int a = INT_MAX;\na++;\n</code></pre>\n\n<p>Whereas this is guaranteed to wrap-around back to zero:</p>\n\n<pre><code>unsigned int a = UINT_MAX;\na++;\n</code></pre></li>\n<li><p>Unsigned types are generally better for performing bit operations on</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 3699, "user_id": 474173, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/18331a42eeb0683a21fe3af6722c04cc?s=128&d=identicon&r=PG", "display_name": "Swanand", "link": "https://stackoverflow.com/users/474173/swanand"}, "reply_to_user": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "edited": false, "score": 0, "creation_date": 1549467356, "post_id": 54557129, "comment_id": 95914065, "body": "@GovindParmar Of course. But OP asked &quot;Signed integers can present both positive and negative numbers&quot;. It was more from number representation than performance concern."}], "tags": [], "owner": {"reputation": 3699, "user_id": 474173, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/18331a42eeb0683a21fe3af6722c04cc?s=128&d=identicon&r=PG", "display_name": "Swanand", "link": "https://stackoverflow.com/users/474173/swanand"}, "is_accepted": true, "score": 0, "last_activity_date": 1549466976, "creation_date": 1549466976, "answer_id": 54557129, "question_id": 54556973, "link": "https://stackoverflow.com/questions/54556973/signed-integer-and-unsigned-integer/54557129#54557129", "title": "Signed integer and unsigned integer", "body": "<p>One word answer is \"range\"!</p>\n\n<p>When you declare a signed integer, it takes 4 bytes/ 32 bits memory (on a 32 bit system).\nOut of those 32 bits, 1 bit is for sign and other 31 bits represent number. Means you can represent any number between -2,147,483,648 to 2,147,483,647 i.e. 2^31.</p>\n\n<p>What if you want to use  2,147,483,648? Go for 8 bytes? But if you are not interested in negative numbers, then isn't it wastage of 4 bytes?</p>\n\n<p>If you use unsigned int, all 32bits represent your number as you don't need to spare 1 bit for sign. Hence, with unsigned int, you can go from 0 to 4,294,967,295 i.e. 2^32</p>\n\n<p>Same applies for other data types.</p>\n"}, {"tags": [], "owner": {"reputation": 171, "user_id": 11023698, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RFMKl.jpg?s=128&g=1", "display_name": "Picardia", "link": "https://stackoverflow.com/users/11023698/picardia"}, "is_accepted": false, "score": 0, "last_activity_date": 1549470707, "last_edit_date": 1549470707, "creation_date": 1549466984, "answer_id": 54557131, "question_id": 54556973, "link": "https://stackoverflow.com/questions/54556973/signed-integer-and-unsigned-integer/54557131#54557131", "title": "Signed integer and unsigned integer", "body": "<p>It's all about memory. They are used to represent a greater number without making use of a larger amount of memory.</p>\n\n<p>Numbers are stored on the computer in binary form. Signed numeric values use a process called two's complement to transform positive numbers into negative ones where the first bit, the one that could represent the highest value is not taken into account for any calculation. </p>\n\n<p>It means that the numeric signed type of your choice can only store a maximum value of N available bits minus 1 bit and the remaining bit will be used to determine the sign of the value, while an unsigned type of your choice can make use of all its available bits to store its value with the drawback of not being able to represent negative values.</p>\n"}, {"tags": [], "owner": {"reputation": 3350, "user_id": 7332147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e4GFL.png?s=128&g=1", "display_name": "linuxfan says Reinstate Monica", "link": "https://stackoverflow.com/users/7332147/linuxfan-says-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1549467648, "last_edit_date": 1549467648, "creation_date": 1549467081, "answer_id": 54557162, "question_id": 54556973, "link": "https://stackoverflow.com/questions/54556973/signed-integer-and-unsigned-integer/54557162#54557162", "title": "Signed integer and unsigned integer", "body": "<p>There are two/three reasons, given that C must offer the greatest range of possibilities to the programmer.</p>\n\n<p>The first is that an unsigned integer can hold a double (positive) value in respect to its signed counterpart. And we don't want to waste any single bit right?</p>\n\n<p>The second is that a protocol, or some data structure a program must cope with, can use unsigned values, so it is handy to have that data type.</p>\n\n<p>The third is that processors actually have unsigned types, so C language gives them available. May be that there are algorithms which relay on overflow, for example.</p>\n\n<p>There can be still other motivations, probably I don't remember them all.</p>\n\n<p>Personally, I make large use of unsigned integers in embedded applications. For example, using a single unsigned char as an index into a circular buffer of 256 elements, makes it simple and fast to increment the index without checking for overflow, because when the index overflows, it does exactly what I want it to do (reset to zero). Again, there are probably many other situations, I tell just the first that comes to my mind.</p>\n"}, {"tags": [], "owner": {"reputation": 2219, "user_id": 1923580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcb6fec8d7afe41ed1188d655e14f618?s=128&d=identicon&r=PG", "display_name": "Chris623", "link": "https://stackoverflow.com/users/1923580/chris623"}, "is_accepted": false, "score": 0, "last_activity_date": 1549467505, "creation_date": 1549467505, "answer_id": 54557276, "question_id": 54556973, "link": "https://stackoverflow.com/questions/54556973/signed-integer-and-unsigned-integer/54557276#54557276", "title": "Signed integer and unsigned integer", "body": "<p>The reason is that Integer always has a fixed size. On  most systems, an Integer is 32 bits large.</p>\n\n<p>So no matter of having a signed or unsigned Integer, it takes always the same amout of memory. And that's where signed and unsigned differ: the range</p>\n\n<p>Where an unsigned integer has a range of 0 to 4294967295 (2\u00b3\u00b2-1), the signed integer has a range of -2147483647 to 2147483648</p>\n"}], "owner": {"reputation": 53, "user_id": 10053275, "user_type": "registered", "profile_image": "https://graph.facebook.com/1917694201615956/picture?type=large", "display_name": "Sangmin  Choi", "link": "https://stackoverflow.com/users/10053275/sangmin-choi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1568, "favorite_count": 1, "closed_date": 1549467786, "accepted_answer_id": 54557129, "answer_count": 5, "score": 1, "last_activity_date": 1549470707, "creation_date": 1549466542, "last_edit_date": 1549466677, "question_id": 54556973, "link": "https://stackoverflow.com/questions/54556973/signed-integer-and-unsigned-integer", "closed_reason": "Duplicate", "title": "Signed integer and unsigned integer", "body": "<p>I am studying c language and there are two different integer types, signed/unsigned.</p>\n\n<p>Signed integers can present both positive and negative numbers. Why do we\nneed unsigned integers then? </p>\n"}, {"tags": ["c", "openssl", "deprecated"], "answers": [{"tags": [], "owner": {"reputation": 12010, "user_id": 23235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6281820b28d03f98e85bb3d901ae3f39?s=128&d=identicon&r=PG", "display_name": "Shane Powell", "link": "https://stackoverflow.com/users/23235/shane-powell"}, "is_accepted": true, "score": 2, "last_activity_date": 1549471387, "creation_date": 1549471387, "answer_id": 54558536, "question_id": 54556943, "link": "https://stackoverflow.com/questions/54556943/openssl-update-into-newer-version-alternative-for-the-deprecated-openssl-confi/54558536#54558536", "title": "OpenSSL update into newer version: Alternative for the deprecated `OPENSSL_config`", "body": "<p>The <a href=\"https://www.openssl.org/docs/man1.1.1/man3/OPENSSL_config.html\" rel=\"nofollow noreferrer\">OPENSSL_config</a> says it all:</p>\n\n<blockquote>\n  <p>This function is deprecated and its use should be avoided.\n  Applications should instead call CONF_modules_load() during\n  initialization (that is before starting any threads).</p>\n</blockquote>\n\n<p>Also <a href=\"https://www.openssl.org/docs/man1.1.1/man3/ERR_load_crypto_strings.html\" rel=\"nofollow noreferrer\">SSL_load_error_strings</a> and <a href=\"https://www.openssl.org/docs/man1.1.1/man3/OpenSSL_add_all_algorithms.html\" rel=\"nofollow noreferrer\">OpenSSL_add_all_algorithms</a> are also deprecated as well.</p>\n\n<p>For openssl >= 1.1 you can remove the your whole startup and cleanup code above as it's not needed any longer.  It's all done automatically now for you.</p>\n"}], "owner": {"reputation": 6282, "user_id": 4706711, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh3.googleusercontent.com/-dlNFOguGD_A/AAAAAAAAAAI/AAAAAAAABwA/BMlWtrTgZtY/photo.jpg?sz=128", "display_name": "Dimitrios Desyllas", "link": "https://stackoverflow.com/users/4706711/dimitrios-desyllas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1096, "favorite_count": 0, "accepted_answer_id": 54558536, "answer_count": 1, "score": 2, "last_activity_date": 1549471387, "creation_date": 1549466454, "question_id": 54556943, "link": "https://stackoverflow.com/questions/54556943/openssl-update-into-newer-version-alternative-for-the-deprecated-openssl-confi", "title": "OpenSSL update into newer version: Alternative for the deprecated `OPENSSL_config`", "body": "<p>In my C project I updated the OpenSSl library 1.0.2g into newer one (1.1.x versions) while I was compiling my code I had the following warning thrown:</p>\n\n<blockquote>\n  <p>main.c:40:3: warning: \u2018OPENSSL_config\u2019 is deprecated [-Wdeprecated-declarations]\n     OPENSSL_config(NULL);</p>\n</blockquote>\n\n<p>The code throwing this error is:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n// Openssl\n#include &lt;openssl/conf.h&gt;\n#include &lt;openssl/evp.h&gt;\n#include &lt;openssl/err.h&gt;\n\nint main(int argc, char *argv[]) {\n  /* Load the human readable error strings for libcrypto */\n  ERR_load_crypto_strings();\n  /* Load all digest and cipher algorithms */\n  OpenSSL_add_all_algorithms();\n  /* Load config file, and other important initialisation */\n  OPENSSL_config(NULL);\n\n  //Come code here\n\n  EVP_cleanup();\n  CRYPTO_cleanup_all_ex_data();\n  ERR_free_strings();\n  return 0;\n}\n</code></pre>\n\n<p>So as the best practices dictate I should avoid and use alternative approaches on deprecated functions in my case which one should I use?</p>\n"}, {"tags": ["c", "fork"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1549466376, "post_id": 54556861, "comment_id": 95913441, "body": "You are closing the descriptors in the loop, while should only do it once."}, {"owner": {"reputation": 169, "user_id": 8877836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nmPOw.jpg?s=128&g=1", "display_name": "TheShield", "link": "https://stackoverflow.com/users/8877836/theshield"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549466678, "post_id": 54556861, "comment_id": 95913631, "body": "Could you please expand on that?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549466728, "post_id": 54556861, "comment_id": 95913663, "body": "Expand what? You perform <code>close(fd[0]);</code> each iteration of the <code>while</code> loop. But second time it is already closed."}, {"owner": {"reputation": 169, "user_id": 8877836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nmPOw.jpg?s=128&g=1", "display_name": "TheShield", "link": "https://stackoverflow.com/users/8877836/theshield"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549466823, "post_id": 54556861, "comment_id": 95913730, "body": "I&#39;ve tried running the program without closing the descriptors yet it doesn&#39;t seem to change anything."}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 2, "last_activity_date": 1549466759, "creation_date": 1549466759, "answer_id": 54557044, "question_id": 54556861, "link": "https://stackoverflow.com/questions/54556861/how-to-keep-child-process-alive-from-a-single-fork-call/54557044#54557044", "title": "How to keep child process alive from a single fork() call?", "body": "<p>In your child section:</p>\n\n<pre><code>while(1) {\n\n    if (pidVal == 0) {\n        printf(\"Child Process (should be 0): %d\\n\", pidVal);\n        val = getInput();\n        printf(\"You typed: %d\\n\", val);\n        //Write to parent\n        close(fd[0]);\n        write(fd[1], &amp;val, sizeof(val));\n        //Read if parent sends sum yet\n        close(fd2[1]);\n        read(fd2[0], &amp;final, sizeof(final));\n        //If sum sent from parent, print and terminate\n        if (final != -9999999) {\n            printf(\"%d\\n\", final);\n            exit(0);\n        }           \n    }\n    ...\n</code></pre>\n\n<p>You're reading a <em>single</em> value from the user, sending it to the parent, then waiting for the result from the parent.  The parent meanwhile has read the first value from the child and is waiting for another value, so the parent and child are deadlocked waiting for the other to send them something.</p>\n\n<p>You want the child to loop reading values until it gets -1, <em>then</em> wait for the parent.  </p>\n\n<pre><code>    if (pidVal == 0) {\n        printf(\"Child Process (should be 0): %d\\n\", pidVal);\n        do {\n            val = getInput();\n            printf(\"You typed: %d\\n\", val);\n            //Write to parent\n            close(fd[0]);\n            write(fd[1], &amp;val, sizeof(val));\n        } while (val != -1);\n        close(fd2[1]);\n        read(fd2[0], &amp;final, sizeof(final));\n        //If sum sent from parent, print and terminate\n        if (final != -9999999) {\n            printf(\"%d\\n\", final);\n            exit(0);\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 8877836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nmPOw.jpg?s=128&g=1", "display_name": "TheShield", "link": "https://stackoverflow.com/users/8877836/theshield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 54557044, "answer_count": 1, "score": 1, "last_activity_date": 1549466759, "creation_date": 1549466216, "question_id": 54556861, "link": "https://stackoverflow.com/questions/54556861/how-to-keep-child-process-alive-from-a-single-fork-call", "title": "How to keep child process alive from a single fork() call?", "body": "<p>I have a program that creates a child process from a fork() call. The child will continuously receive 1-byte integer input from the user. Once an integer has been sent to the child, the child will send the value to the parent using a pipe. When the parent receives the value, it will add it to an array. -1 is sent to end the program. Once the child sends the parent -1, the parent will sum the previous values in the array and, using another pipe, send this sum value to the child in which the child will print it and terminate the program.</p>\n\n<p>As of right now this is my code:</p>\n\n<pre><code>#include  &lt;stdio.h&gt;\n#include  &lt;stdlib.h&gt;\n#include  &lt;string.h&gt;\n#include  &lt;unistd.h&gt;\n#include  &lt;sys/types.h&gt;\n\n//Gets input from the user\nint getInput() {\n    int val; char temp;\n    scanf(\"%hhd\", &amp;temp);\n    val = temp;\n    return val;\n}\n\n//Sums the values of the entered numbers and returns it\nint finish(int arr[], int i) {\n    int sum = 0;\n    for (int j = 0; j &lt; i; j++) {sum+= arr[j];}\n    return(sum);\n}\n\nint main() {\n\n    int fd[2], fd2[2], val = 0, i = 0, sum, final = -9999999;\n    int arr[1000];\n    pid_t pidVal;\n\n    //Pipe for sending numbers from child to parent\n    pipe(fd);\n\n    //Pipe for sending the final sum from parent to child\n    pipe(fd2);\n\n    //Create parent and child processes\n    pidVal = fork();\n\n    //Used to make it run continously until -1 is pressed\n    while(1) {\n\n        //Child Process\n        if (pidVal == 0) {\n            printf(\"Child Process (should be 0): %d\\n\", pidVal);\n            val = getInput();\n            printf(\"You typed: %d\\n\", val);\n            //Write to parent\n            close(fd[0]);\n            write(fd[1], &amp;val, sizeof(val));\n            //Read if parent sends sum yet\n            close(fd2[1]);\n            read(fd2[0], &amp;final, sizeof(final));\n            //If sum sent from parent, print and terminate\n            if (final != -9999999) {\n                printf(\"%d\\n\", final);\n                exit(0);\n            }           \n        }\n\n        //Parent Process\n        if (pidVal &gt; 0) {\n            printf(\"I'm the parent (should be &gt; 0): %d\\n\", pidVal);\n            //Read what child sent to the pipe\n            close(fd[1]);\n            read(fd[0], &amp;val, sizeof(val));\n            //If exit value recieved\n            if (val == -1) {\n                //Sum the numbers sent\n                sum = finish(arr, i);\n                //Close read directory\n                close(fd2[0]);\n                //Write the sum to the pipe\n                write(fd2[1], &amp;sum, sizeof(sum));\n            } \n\n            //Not -1 as input\n            else {\n                //Collect input\n                arr[i] = val;\n                i++;\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>However the problem is when I try and send more than one number, the program is stuck, as you can see from this sample output:</p>\n\n<pre><code>I'm the parent (should be &gt; 0): 5673\nChild Process (should be 0): 0\n3 //My Input\nYou typed: 3\nI'm the parent (should be &gt; 0): 5673\n1 //My Input\n2 //My Input\n</code></pre>\n\n<p>I noticed how the child process does not seem to execute at the second iteration, yet the parent does, which leads me to believe the child is terminating after the first run. How can I keep this child alive until the user enters -1? More importantly I want to achieve this functionality with only <strong>one</strong> parent and <strong>one</strong> child process derived from only a single fork call for the entire program. Is this possible?</p>\n"}, {"tags": ["c", "arrays", "compression"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1549466182, "post_id": 54556811, "comment_id": 95913309, "body": "In what sense is 33% of 99 equal to 3?  Do you mean 33?"}, {"owner": {"reputation": 1, "user_id": 8406199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7add3aedb94c20b68da55ab62ee7cb4?s=128&d=identicon&r=PG&f=1", "display_name": "Donar144", "link": "https://stackoverflow.com/users/8406199/donar144"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1549466464, "post_id": 54556811, "comment_id": 95913495, "body": "Literally just edited that, but yes it was a typo"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1549467382, "post_id": 54556811, "comment_id": 95914090, "body": "You are passing <code>numberOfElementsInOriginal</code> as a parameter, which is fine, then you are replacing the passed value via <code>numberOfElementsInOriginal = sizeof(arrayToDecrease);</code>, which is completely wrong (it gives you the size of a pointer, which is completely unrelated to the number of elements in the array)."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1549468158, "post_id": 54556811, "comment_id": 95914699, "body": "As for whether you&#39;ve &quot;set this up right&quot;, I see several <i>stylistic</i> issues, but to evaluate the correctness of the code I would need a clear specification of what it means to &quot;average and compress&quot; the leading and trailing sub-arrays.  I cannot rely for that on the code itself, since its correctness is in question."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 8406199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7add3aedb94c20b68da55ab62ee7cb4?s=128&d=identicon&r=PG&f=1", "display_name": "Donar144", "link": "https://stackoverflow.com/users/8406199/donar144"}, "edited": false, "score": 0, "creation_date": 1549482114, "post_id": 54561251, "comment_id": 95921780, "body": "Thank you so much for your kind and helpful response John. I will take this example here and apply the percentile discrimination I mentioned earlier. The stylistic errors are definitely true, especially when it comes to variable names, but I am doing all of my work on older systems and using the convention made by others before me in order to keep things consistent."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 0, "last_activity_date": 1549482300, "last_edit_date": 1549482300, "creation_date": 1549481641, "answer_id": 54561251, "question_id": 54556811, "link": "https://stackoverflow.com/questions/54556811/attempting-to-take-the-average-of-a-certain-portion-of-beginning-and-end-of-arra/54561251#54561251", "title": "Attempting to take the average of a certain portion of beginning and end of array", "body": "<p>As I wrote in comments, you have a definite error in</p>\n\n<pre><code>numberOfElementsInOriginal = sizeof(arrayToDecrease);\n</code></pre>\n\n<p>because <code>sizeof(arrayToDecrease)</code> gives you the size of a pointer, in bytes, which is not in any way related to the number of elements in the array (in)to which the pointer points.  Since <code>numberOfElementsInOriginal</code> is a function parameter, I'm inclined to guess that this is an unwanted leftover from a previous version of the function, such that it can simply be removed.</p>\n\n<p>As far as style and approach go, it appears that you use exactly the same approach for the lead half of the destination array as for the trailing half.  If that's indeed what you want, then </p>\n\n<ul>\n<li>your code could be both shortened and simplified by factoring that out to a separate function</li>\n</ul>\n\n<p>that you call twice.  Additionally, although its very rare for me to say this in a SO answer,</p>\n\n<ul>\n<li>your variable names are too long.</li>\n</ul>\n\n<p>Those long names are pretty clear, but having so many variable names of such great length makes your code <em>harder</em> to read and understand, not easier, especially when several of them are similar to each other.  You can create shorter names that are still plenty descriptive by starting with shorter phrases, omitting prepositions, using abbreviations (especially conventional ones), and even just expressing the idea differently.  For example,</p>\n\n<pre><code>plcbit arrayCompressFloatExtremities(float *dest,\n        float *src, unsigned long dest_len,\n        unsigned long src_len, float inclusion_fraction)\n</code></pre>\n\n<p>I've also switched to snake_style instead of camelStyle there.  The former is more common in C code and I prefer it in that context, but the latter is ok, too.</p>\n\n<p>As for the actual averaging, if you have trouble following the code enough to be confident of its correctness then correctness is not its deepest problem.  I don't know about you, but even knowing (I think) what you're trying to do, it is very difficult for me to analyze your code to validate it.  In addition to the issues I already mentioned, this problem arises in part from use of</p>\n\n<ul>\n<li>complex inline expressions</li>\n</ul>\n\n<p>and it is especially egregious that </p>\n\n<ul>\n<li>such expressions are <em>duplicated</em>, and</li>\n<li>some are <em>needlessly</em> complex.</li>\n</ul>\n\n<p>Take this several-times-repeated expression in particular:</p>\n\n<pre><code>numberOfDesiredElements - (numberOfDesiredElements % 2)) / 2\n</code></pre>\n\n<p>Given that <code>numberOnumberOfDesiredElements</code> has an unsigned integer type, that expression will <em>always</em> evaluate to the same result as just</p>\n\n<pre><code>numberOfDesiredElements / 2\n</code></pre>\n\n<p>, which is much clearer and less than half the length.  Even making that substitution doesn't clear up the code enough for me to be confident about whether it is right, however.</p>\n\n<p>Consider this alternative, in the form of a function that you could call once for each half:</p>\n\n<pre><code>/*\n * Partitions the source array evenly into dest_len bins, and records the average\n * of the elements in each bin in the corresponding element of the destination\n * array.  When dest_len does not evenly divide src_len, each of the src_len % dest_len\n * initial bins is one element longer than the trailing bins.\n *\n * dest:     a pointer to the array wherein the results are to be stored\n * dest_len: the number of leading elements of dest to fill; must not exceed src_len\n * src:      a pointer to the array containing the source elements\n * src_len:  the number of initial elements of src to process\n */\nvoid compress_array(float *dest, size_t dest_len, float *src, size_t src_len) {\n    // This implementation depends on these assumptions to be true:\n    assert(0 &lt; dest_len &amp;&amp; dest_len &lt;= src_len &amp;&amp; dest_len &lt;= ULONG_MAX / 2 + 1);\n\n    size_t base_bin_size = src_len / dest_len;\n    size_t num_extras = src_len % dest_len;\n\n    // Iterate over the bins\n    for (size_t dest_inx = 0; dest_inx &lt; dest_len; dest_inx++) {\n        // This is a concise (but perhaps too clever) way of distributing\n        // the left-over source elements to bins, one element to each bin\n        // until they are used up.  It depends on the fact that relational\n        // expressions evaluate to either 0 or 1, and on the fact that\n        // unsigned arithmetic wraps around:\n        unsigned long bin_size = base_bin_size + (--num_extras &lt; dest_len);\n\n        // Average the elements in this bin\n        float temp = 0;\n        for (size_t bin_inx = 0; bin_inx &lt; bin_size; bin_inx++) {\n            // keeps track of our position in the source array by incrementing src\n            temp += *(src++);\n        }\n\n        dest[dest_inx] = temp / bin_size;\n    }\n}\n</code></pre>\n\n<p>To me, that's simple and clear, and it clearly does the job it is documented to do.  (And note: what it does is well and clearly documented.)  I'm not certain that what that function is documented to do is exactly what you need such a function to do, but the point is really to demonstrate some ways to write clearer, more maintainable code.</p>\n"}], "owner": {"reputation": 1, "user_id": 8406199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7add3aedb94c20b68da55ab62ee7cb4?s=128&d=identicon&r=PG&f=1", "display_name": "Donar144", "link": "https://stackoverflow.com/users/8406199/donar144"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 23, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549482300, "creation_date": 1549466065, "last_edit_date": 1549467210, "question_id": 54556811, "link": "https://stackoverflow.com/questions/54556811/attempting-to-take-the-average-of-a-certain-portion-of-beginning-and-end-of-arra", "title": "Attempting to take the average of a certain portion of beginning and end of array", "body": "<p>The following problem is being run on a PLC completely written in C. This function is part of a library that I have attempted to add.</p>\n\n<p>I have a float array of data of arbitrary length. The following code is triggered when the array length is >= 25 entries. This function is supposed to determine the first and last x percent of entries (i.e. 33% of an array of 99 would be the first and last 33 entries). The first and last portions are then averaged and compressed into two halves (or half +/- 1 in the case of odd input arrays). The final output is a combination of these two arrays.</p>\n\n<p>For this purpose, I am trying to make a function of this form:</p>\n\n<pre><code>plcbit arrayCompressFloatExtremities(float* arrayToCopyResultTo,\n        float* arrayToDecrease, unsigned long numberOfDesiredElements,\n        unsigned long numberOfElementsInOriginal, float inclusionZonePercent)\n</code></pre>\n\n<p>where</p>\n\n<ul>\n<li><code>float* arrayToCopyResultTo</code> is my target array after the function finishes</li>\n<li><code>float* arrayToDecrease</code> is the input array pointer</li>\n<li><code>unsigned long numberofDesiredElements</code> is the length of the output array, should be 25</li>\n<li><code>unsigned long numberofElementsInOriginal</code> is the length of the original array, >=25</li>\n<li><code>float inclusionZonePercent</code> is the percentage of the front and back end of the array I want to compress. E.g. a value input of .25 will compress the first 25% and last 25% of the entries into an array 25 entries in length</li>\n</ul>\n\n<p>So far, it seems that the code works to a point.  The <code>usedInterval</code> value appears to be dividing by zero in my debugger, however, and I'm not certain why. Regardless, I am not confident I set this up right.</p>\n\n<pre><code>/* compresses and compies the array while neglecting a certain percentage of the board */\nplcbit arrayCompressFloatExtremities(float* arrayToCopyResultTo,\n        float* arrayToDecrease, unsigned long numberOfDesiredElements,\n        unsigned long numberOfElementsInOriginal, float inclusionZonePercent) {\n    int usedInterval = 0, i = 0, j = 0, k = 0, numberOfElementsLeft = 0;\n    double temp = 0;\n    float zone = 0;\n\n    if ((numberOfElementsInOriginal == 0) || (numberOfDesiredElements == 0)) return 0;\n\n    // determine zone size\n    numberOfElementsInOriginal = sizeof(arrayToDecrease);\n    numberOfElementsLeft = numberOfElementsInOriginal * inclusionZonePercent;\n\n    // compress zone A into first half of output array using modulo operator\n    // for odd number arrays\n\n    for (i = 0;\n            i &lt; ((numberOfDesiredElements - (numberOfDesiredElements % 2)) / 2);\n            i++) // i starts at 0 for the beginning part of the board and continues until the halfway point or halfway - 1\n    {\n        usedInterval = numberOfElementsLeft /\n                (((numberOfDesiredElements - (numberOfDesiredElements % 2)) / 2) - i); \n        temp = 0;\n        for (j = 0;\n                j &lt; (usedInterval + numberOfElementsInOriginal - numberOfElementsLeft);\n                j++) {\n            temp += arrayToDecrease[j];\n        }\n\n        arrayToCopyResultTo[i] = temp / (float) usedInterval;\n\n        numberOfElementsLeft -= usedInterval;\n    }\n    // compress zone B\n    numberOfElementsLeft = numberOfElementsInOriginal * inclusionZonePercent;   \n    for (i = (numberOfElementsInOriginal - numberOfElementsLeft);\n            i &lt; (numberOfDesiredElements + (numberOfDesiredElements % 2));\n            i++) // i starts at the end of the board minus the appropriate percentile and fills array with half of desired point or halfwat + 1\n    {\n        usedInterval = numberOfElementsLeft /\n                (((numberOfDesiredElements + (numberOfDesiredElements % 2)) / 2) - i);\n        temp = 0;\n        for (j = (numberOfElementsInOriginal - numberOfElementsLeft);\n                j &lt; (usedInterval + numberOfElementsInOriginal - numberOfElementsLeft);\n                j++) {\n            temp += arrayToDecrease[j];\n        }\n\n        arrayToCopyResultTo[i] = temp / (float)usedInterval;\n\n        numberOfElementsLeft -= usedInterval;\n    }\n    return 1;\n}\n</code></pre>\n\n<p>I'm hoping that this algorithm will be able to take the beginning percentile of the array and the end, compress the values (through averaging entries), and output the values in an array while ignoring the middle values of the array.</p>\n"}, {"tags": ["c", "pseudocode"], "comments": [{"owner": {"reputation": 18268, "user_id": 5218354, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-NEO9rZKeffY/AAAAAAAAAAI/AAAAAAAAAKc/9IttO1jUOr4/photo.jpg=k-s128", "display_name": "norok2", "link": "https://stackoverflow.com/users/5218354/norok2"}, "edited": false, "score": 1, "creation_date": 1549466089, "post_id": 54556745, "comment_id": 95913266, "body": "Hi! Welcome to StackOverflow! Perhaps you would get better help if you would show your attempt and try to describe where are your struggling at."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1549466233, "post_id": 54556745, "comment_id": 95913340, "body": "Note that the recursive function terminates when the string terminator is found as in <code>case &#39;\\0&#39;: return !*str;</code> and remember that in C <code>0</code> is false and anything else is true."}, {"owner": {"reputation": 14339, "user_id": 1466970, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/V1J6z.jpg?s=128&g=1", "display_name": "Richard Chambers", "link": "https://stackoverflow.com/users/1466970/richard-chambers"}, "edited": false, "score": 0, "creation_date": 1549466334, "post_id": 54556745, "comment_id": 95913405, "body": "A <code>switch()</code> in C is about the same as in Java. This function is using recursion, calling itself, which is also available in Java. This function is using a pointer to a string of characters which is not available in Java so you will need to translate that to something that is in Java, <code>StringBuffer</code> comes first to mind however you will need to keep an index variable which is available in Java rather than relying on a pointer which is not. <a href=\"https://docs.oracle.com/javase/7/docs/api/java/lang/StringBuffer.html\" rel=\"nofollow noreferrer\">docs.oracle.com/javase/7/docs/api/java/lang/StringBuffer.htm&zwnj;&#8203;l</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11023356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60c39f7179cd1266e70a3f35e11717b?s=128&d=identicon&r=PG&f=1", "display_name": "BP13", "link": "https://stackoverflow.com/users/11023356/bp13"}, "edited": false, "score": 0, "creation_date": 1549467509, "post_id": 54557035, "comment_id": 95914190, "body": "Thank you for the fast response Bodo. So the switch case iterates through the string and compares to the search string, but what datatype is returned? I would expect int but isn&#39;t it boolean in this case?"}, {"owner": {"reputation": 13, "user_id": 11023356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60c39f7179cd1266e70a3f35e11717b?s=128&d=identicon&r=PG&f=1", "display_name": "BP13", "link": "https://stackoverflow.com/users/11023356/bp13"}, "edited": false, "score": 0, "creation_date": 1549469548, "post_id": 54557035, "comment_id": 95915573, "body": "Thank you for your help. I completely understood it now. The nonzero and zero returned are equivalent to true and false in terms of string consistency."}], "tags": [], "owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "is_accepted": false, "score": 0, "last_activity_date": 1549469345, "last_edit_date": 1549469345, "creation_date": 1549466723, "answer_id": 54557035, "question_id": 54556745, "link": "https://stackoverflow.com/questions/54556745/translating-a-snippet-in-c-to-pseudocode/54557035#54557035", "title": "Translating a snippet in c to pseudocode", "body": "<p>C and Java are similar languages, so you might understand parts of the program.</p>\n\n<p>There are a few important differences.\nC uses <code>char</code> array for strings and marks the end of the string with a trailing <code>'\\0'</code>. Similar to arrays are pointers.</p>\n\n<p>In function</p>\n\n<pre><code>int match ( char *pat, char *str )\n</code></pre>\n\n<p><code>pat</code> is a pointer to a pattern string, <code>str</code> is the string that should be matched.</p>\n\n<p>In the function body <code>*pat</code> is the first character of the pattern. Similar for <code>*str</code>.</p>\n\n<p><code>pat+1</code> is a pointer to the next character of the string which may be followed by other characters. The next character might also be the end marker <code>'\\0'</code>.</p>\n\n<p>In C you can use numbers for logical operations.</p>\n\n<pre><code>!*str\n</code></pre>\n\n<p>is the logical negation of the value of the first character where <code>str</code> points to. <code>'\\0'</code> is the value 0 (end of string) which is regarded as <code>false</code>. Any character in the string has a non-zero value and is regarded as <code>true</code>.</p>\n\n<p>The return type <code>int</code> is used as a boolean. in C there is no specific <code>boolean</code> or <code>bool</code> type. For example</p>\n\n<pre><code>case '\\0' : return !*str;\n</code></pre>\n\n<p>means: When we reached the end of the pattern (<code>case '\\0':)</code> we return <code>true</code> (not 0) if <code>str</code> points to the end of the string (<code>'\\0'</code>) otherwise we return <code>false</code> because the logical negation of something <code>!= 0</code> (<code>true</code>) is <code>0</code> (<code>false</code>).</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 11023356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60c39f7179cd1266e70a3f35e11717b?s=128&d=identicon&r=PG&f=1", "display_name": "BP13", "link": "https://stackoverflow.com/users/11023356/bp13"}, "edited": false, "score": 0, "creation_date": 1549469088, "post_id": 54557353, "comment_id": 95915291, "body": "Thanks a lot Micrified that really helps me. The pointer in C confused me very much but with your comments it&#39;s now clear how it works and what is returned. And I&#39;m sure I&#39;ll be able to translate that into Java."}, {"owner": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "reply_to_user": {"reputation": 13, "user_id": 11023356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60c39f7179cd1266e70a3f35e11717b?s=128&d=identicon&r=PG&f=1", "display_name": "BP13", "link": "https://stackoverflow.com/users/11023356/bp13"}, "edited": false, "score": 0, "creation_date": 1549469161, "post_id": 54557353, "comment_id": 95915329, "body": "@BP13 Yes, strings in C are tricky. Java makes it much more abstract with their &quot;String&quot; type. If my answer is satisfactory, please remember to hit that checkmark next to my answer so I can rake in those sweet good-boy-points!"}], "tags": [], "owner": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "is_accepted": true, "score": 0, "last_activity_date": 1549467696, "creation_date": 1549467696, "answer_id": 54557353, "question_id": 54556745, "link": "https://stackoverflow.com/questions/54556745/translating-a-snippet-in-c-to-pseudocode/54557353#54557353", "title": "Translating a snippet in c to pseudocode", "body": "<p>I've tried commenting it for you. Take a read and see if it helps you understand :).</p>\n\n<pre><code>/* Returns an integer (nonzero if the strings match, zero if they don't).\n * - pat: A string (char *) which is your pattern.\n * - str: A string (char *) which is your source string.\n * Note: All strings end in the null-character ('\\0') which has integer value zero. \n*/\nint match ( char *pat, char *str ) {\n\n /* The switch extracts the first character of the string \"pat\" (*pat).\n  * Then, it will run the code in the case to which that character matches:\n */\n switch ( *pat ) {\n\n  /* If you match null-character, then return nonzero only if the value \n   * of the leading character in str (*str) is zero (!*str) This means\n   * that it returns a match if the leading character in str is also \n   * the null character\n  */ \n  case '\\0' : return !*str;\n\n  /* If you match an asterisk '*', then return nonzero in two cases:\n   * (1) Calling your own function recursively having dropped the asterisk from\n   *     the pattern returns nonzero (match(pat+1, str)).\n   * ... OR ... \n   * (2) The leading character of str is nonzero (*str) AND calling\n   *     this very function having dropped the leading character of str returns\n   *     nonzero (match(pat, str + 1)).\n  */\n  case '*'  : return match( pat+1, str ) || *str &amp;&amp; match( pat, str+1 );\n\n  /* If you match '?', then return nonzero if both cases are true:\n   * (1) *str is not the null-char (it is nonzero).\n   * (2) Calling match recursively having skipped the current character\n   * in both the pattern AND the string returns nonzero (match(pat+1, str+1)).\n  */                             \n  case '?'  : return *str &amp;&amp; match( pat+1, str+1 );\n\n\n  /* Otherwise, if you didn't match on any of the above patterns, return\n   * nonzero only if both the following conditions are true:\n   * (1) The current character at the head of pat is the same as that of str\n   *      (*pat == *str)\n   * (2) calling match recursively having skipped both the current character\n   *     at the head of pattern AND the string also returns nonzero. \n   *     match(pat + 1, str + 1)\n  */\n  default   : return *pat == *str &amp;&amp; match( pat+1, str+1 );\n }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11023356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60c39f7179cd1266e70a3f35e11717b?s=128&d=identicon&r=PG&f=1", "display_name": "BP13", "link": "https://stackoverflow.com/users/11023356/bp13"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 54557353, "answer_count": 2, "score": 0, "last_activity_date": 1549469345, "creation_date": 1549465845, "question_id": 54556745, "link": "https://stackoverflow.com/questions/54556745/translating-a-snippet-in-c-to-pseudocode", "title": "Translating a snippet in c to pseudocode", "body": "<p>I'm just learning Java and I have an assignment where I need to translate a snippet of C to Java. Can anybody help me by translating the snippet to pseudocode? I want to do the Java coding on my own, but I do not know C and I can't get much sense out of the snippet. This is the assignment:</p>\n\n<hr>\n\n<p>You are looking for a simple pattern matching method. Similar to strstr (...) in C, it should search for a search string in a string. The search string should contain \"*\" (replacement for several characters) and \"?\". You have an example, but it's in C: </p>\n\n<pre><code>int match ( char *pat, char *str ) {\n switch ( *pat ) {\n  case '\\0' : return !*str;\n  case '*'  : return match( pat+1, str ) || *str &amp;&amp; match( pat, str+1 );\n  case '?'  : return *str &amp;&amp; match( pat+1, str+1 );\n  default   : return *pat == *str &amp;&amp; match( pat+1, str+1 );\n }\n}\n</code></pre>\n\n<p>Translate it to Java.</p>\n\n<hr>\n\n<p>I know it's stupid to try an assignment where you need to translate from a language you do not know and I cannot understand why this assignment is included in a list of Java learning tasks but I have to solve it and it would be very kind if anybody is willing to help me. </p>\n"}, {"tags": ["c", "misra"], "comments": [{"owner": {"reputation": 14339, "user_id": 1466970, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/V1J6z.jpg?s=128&g=1", "display_name": "Richard Chambers", "link": "https://stackoverflow.com/users/1466970/richard-chambers"}, "edited": false, "score": 2, "creation_date": 1549464621, "post_id": 54556195, "comment_id": 95912335, "body": "My first impression is that the declaration of the variable <code>x</code> in the statements <code>int x = \u2026</code> is reusing a global static variable <code>x</code> that is visible in this code. The first step would be to rename the local variable <code>x</code> to some other name such as <code>xLocal</code>. Does your IDE allow you to locate a variable by clicking on it and finding its definition?"}], "answers": [{"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1549464866, "post_id": 54556395, "comment_id": 95912485, "body": "In fact, the likelihood is quite high that the other, static <code>x</code> is not in the same translation unit, for otherwise I would expect the checker to instead, or at least additionally, report a violation of rule 5.2: &quot;Identifiers in an inner scope shall not use the same name as an  identifier in an outer scope, and therefore hide that identifier.&quot;"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1549464971, "post_id": 54556395, "comment_id": 95912558, "body": "@JohnBollinger True. That one is a far more sensible rule to follow."}, {"owner": {"reputation": 5873, "user_id": 1493192, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/32662661bf4aa1d1db842f95d6b84729?s=128&d=identicon&r=PG&f=1", "display_name": "Gianni Spear", "link": "https://stackoverflow.com/users/1493192/gianni-spear"}, "edited": false, "score": 0, "creation_date": 1549465042, "post_id": 54556395, "comment_id": 95912596, "body": "Thanks @Lundin I agree, x is an horrible variable name. The code is not mine, I am doing revision with MISRA C: 2004 rule on another code."}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 4, "last_activity_date": 1549464764, "creation_date": 1549464764, "answer_id": 54556395, "question_id": 54556195, "link": "https://stackoverflow.com/questions/54556195/misra-c-2004-rule-5-5-advisory-no-object-or-function-identifier-with-static/54556395#54556395", "title": "MISRA C: 2004 Rule 5.5 (advisory): No object or function identifier with static storage duration should be reused", "body": "<p>Somewhere in your project, you have another variable named <code>x</code>, with static storage duration. Not necessarily in the same translation unit where you get the MISRA violation. </p>\n\n<p>This was always a silly rule, I would create a permanent deviation organization-wide and ignore it. (It's an advisory rule)</p>\n\n<p>On the other hand, <code>x</code> is a horrible variable name.</p>\n"}], "owner": {"reputation": 5873, "user_id": 1493192, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/32662661bf4aa1d1db842f95d6b84729?s=128&d=identicon&r=PG&f=1", "display_name": "Gianni Spear", "link": "https://stackoverflow.com/users/1493192/gianni-spear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1549464764, "creation_date": 1549464214, "question_id": 54556195, "link": "https://stackoverflow.com/questions/54556195/misra-c-2004-rule-5-5-advisory-no-object-or-function-identifier-with-static", "title": "MISRA C: 2004 Rule 5.5 (advisory): No object or function identifier with static storage duration should be reused", "body": "<p>I have the second violation found by Understand SciTools, but I have no clear the right action to correct the violation. </p>\n\n<p>The violation regards the <code>Rule 5.5 (advisory): No object or function identifier with static storage duration should be reused</code> in the following code, in particular <code>Static Identifier 'x' reused</code></p>\n\n<pre><code> /* llvalue -&gt; ICmp.t option */\nCAMLprim value llvm_instr_icmp_predicate(LLVMValueRef Val) {\n  CAMLparam0();\n  int x = LLVMGetICmpPredicate(Val);\n  if (x) {\n    value Option = alloc(1, 0);\n    Field(Option, 0) = Val_int(x - LLVMIntEQ);\n    CAMLreturn(Option);\n  }\n  CAMLreturn(Val_int(0));\n}\n\n/* llvalue -&gt; FCmp.t option */\nCAMLprim value llvm_instr_fcmp_predicate(LLVMValueRef Val) {\n  CAMLparam0();\n  int x = LLVMGetFCmpPredicate(Val);\n  if (x) {\n    value Option = alloc(1, 0);\n    Field(Option, 0) = Val_int(x - LLVMRealPredicateFalse);\n    CAMLreturn(Option);\n  }\n  CAMLreturn(Val_int(0));\n}\n</code></pre>\n"}, {"tags": ["c", "gcc", "assembly", "clang", "x86-64"], "comments": [{"owner": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "edited": false, "score": 0, "creation_date": 1549465459, "post_id": 54556056, "comment_id": 95912851, "body": "How can you jump past the faulting instruction without knowing the length? FWIW I tried to figure out what you were doing here. But it&#39;s difficult for me to given I&#39;m used to Intel assembly (-masm=intel). Also, have you considered simply writing the entire function in assembly?"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "edited": false, "score": 0, "creation_date": 1549465575, "post_id": 54556056, "comment_id": 95912934, "body": "@Micrified You can&#39;t. That&#39;s why I&#39;m trying to generate known instructions."}, {"owner": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "edited": false, "score": 1, "creation_date": 1549465619, "post_id": 54556056, "comment_id": 95912961, "body": "(Actually you can do it by disassembling the current instruction in the sigsegv handler - something I&#39;ve done before :))."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "edited": false, "score": 0, "creation_date": 1549465654, "post_id": 54556056, "comment_id": 95912985, "body": "@Micrified That&#39;s definitely an adequate and easy to implement solution, but I though I&#39;d try and figure out how to do it with inline assembly. Reading up more on it now."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 2610, "user_id": 1883304, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/xYoZ7.png?s=128&g=1", "display_name": "Micrified", "link": "https://stackoverflow.com/users/1883304/micrified"}, "edited": false, "score": 0, "creation_date": 1549465702, "post_id": 54556056, "comment_id": 95913015, "body": "@Micrified Interesting approach."}], "answers": [{"tags": [], "owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "is_accepted": true, "score": 2, "last_activity_date": 1549467559, "last_edit_date": 1549467559, "creation_date": 1549466693, "answer_id": 54557018, "question_id": 54556056, "link": "https://stackoverflow.com/questions/54556056/rewriting-generated-assembly-into-gcc-inline-assembly/54557018#54557018", "title": "Rewriting generated assembly into GCC inline assembly", "body": "<p>The second line is just loading the <code>faulted</code> from the stack, you don't need that in asm and it won't ever fault (assuming the previous initialization didn't fault). You can use </p>\n\n<pre><code>\"mov (%1), %0\" : \"=a\" (c) : \"D\" (Ptr)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>\"movb $0, (%1)\" : \"=m\" (*Ptr): \"D\" (Ptr)\n</code></pre>\n\n<p>where <code>a</code> is the appropriately sized sub-register of <code>rax</code>, which is <code>al</code> for 8 bits. <code>D</code> is the <code>rdi</code> register. <code>=</code> means output. <code>m</code> is a generic memory operand used to tell the compiler the asm is writing into memory at <code>*Ptr</code>. Could be omitted here since your <code>Ptr</code> is <code>volatile</code> so the compiler will not cache the value, but it doesn't hurt.</p>\n"}], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 54557018, "answer_count": 1, "score": 1, "last_activity_date": 1549467559, "creation_date": 1549463793, "question_id": 54556056, "link": "https://stackoverflow.com/questions/54556056/rewriting-generated-assembly-into-gcc-inline-assembly", "title": "Rewriting generated assembly into GCC inline assembly", "body": "<p>In C I have:</p>\n\n<pre><code>struct segv_ctrl {\n    _Bool volatile*volatile rfaulted_eh_ptr;\n    _Bool volatile*volatile wfaulted_eh_ptr;\n};\n_Thread_local struct segv_ctrl segv_ctrl;\n_Bool rfaulted_eh(char volatile*Ptr)\n{\n    _Bool volatile faulted=0;\n    char c; _Bool r;\n    segv_ctrl.rfaulted_eh_ptr = &amp;faulted;\n    #if 1\n    c=*Ptr;\n    r = faulted;\n    #else\n    //I'd like this to produce the same code as the #if block above\n    //but I obviously have no idea what I'm doing :D\n    __asm__ __volatile__ (\n        \"mov (%2),%0;\\n\"\n        \"mov %3,%1;\\n\"\n        : \"=r\"(c), \"=r\"(r)\n        : \"r\" (Ptr), \"r\"(faulted)\n\n    );\n    #endif\n    return r;\n}\n_Bool wfaulted_eh(char volatile*Ptr)\n{\n    _Bool volatile faulted=0;\n    _Bool r;\n    segv_ctrl.wfaulted_eh_ptr = &amp;faulted;\n    #if 1\n    *Ptr=0;\n    r = faulted;\n    #else\n    #endif\n    return r;\n}\n</code></pre>\n\n<p>With clang -O1 to -O3 on x86-64 it very reliably generates:</p>\n\n<pre><code>c.o:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 &lt;rfaulted_eh&gt;:\n   0:   c6 44 24 ff 00          movb   $0x0,-0x1(%rsp)\n   5:   48 8d 44 24 ff          lea    -0x1(%rsp),%rax\n   a:   64 48 89 04 25 00 00    mov    %rax,%fs:0x0\n  11:   00 00 \n  13:   8a 07                   mov    (%rdi),%al\n  15:   8a 44 24 ff             mov    -0x1(%rsp),%al\n  19:   c3                      retq   \n  1a:   66 0f 1f 44 00 00       nopw   0x0(%rax,%rax,1)\n\n0000000000000020 &lt;wfaulted_eh&gt;:\n  20:   c6 44 24 ff 00          movb   $0x0,-0x1(%rsp)\n  25:   48 8d 44 24 ff          lea    -0x1(%rsp),%rax\n  2a:   64 48 89 04 25 00 00    mov    %rax,%fs:0x0\n  31:   00 00 \n  33:   c6 07 00                movb   $0x0,(%rdi)\n  36:   8a 44 24 ff             mov    -0x1(%rsp),%al\n  3a:   c3                      retq   \n</code></pre>\n\n<p>I'd like to take the </p>\n\n<pre><code>mov    (%rdi),%al\nmov    -0x1(%rsp),%al\n</code></pre>\n\n<p>part and the</p>\n\n<pre><code>movb   $0x0,(%rdi)\nmov    -0x1(%rsp),%al\n</code></pre>\n\n<p>part and turn them into reusable, inlinable assembly snippets.</p>\n\n<p>My very unsuccessful attempt is shown in the elided #if block above.\nCan you please explain why it's wrong and it's possible to make this work with inline assembly?</p>\n\n<p>(I'm using this to detect segfaults cheaply (if there wouldn't be a segfault). If I know the length of the possibly segfaulting instruction, I can skip right past it in my SIGSEGV handler without having to have made a relatively expensive sigsetjmp, but gcc isn't generating such reliable code so I'd like to force it to.)</p>\n"}, {"tags": ["c", "printf"], "comments": [{"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 1, "creation_date": 1549461369, "post_id": 54555277, "comment_id": 95910221, "body": "Your output and expected output are the same."}, {"owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "reply_to_user": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 2, "creation_date": 1549461435, "post_id": 54555277, "comment_id": 95910262, "body": "@Blaze maybe it&#39;s an editor issue? see <i>&quot; This char is not visible on the terminal&quot;</i>"}, {"owner": {"reputation": 73, "user_id": 10743228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pPZOw.png?s=128&g=1", "display_name": "Abraham Francis", "link": "https://stackoverflow.com/users/10743228/abraham-francis"}, "edited": false, "score": 0, "creation_date": 1549461443, "post_id": 54555277, "comment_id": 95910268, "body": "I&#39;ll show an image , wait"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1549461478, "post_id": 54555277, "comment_id": 95910297, "body": "The <code>^@</code> is a null byte. Maybe you are writing the null bytes at the end of the strings too?"}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "reply_to_user": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "edited": false, "score": 0, "creation_date": 1549461637, "post_id": 54555277, "comment_id": 95910405, "body": "@SouravGhosh that&#39;s possible. I thought that maybe OP accidentally pasted the same snippet twice. I know I&#39;d probably do that. :)"}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1549461798, "post_id": 54555277, "comment_id": 95910475, "body": "Anyway I got the Selection Highlighter installed and it highlights them as the same, so either it doesn&#39;t work with those hidden symbols or the hidden symbols were removed when posting the snippet."}, {"owner": {"reputation": 73, "user_id": 10743228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pPZOw.png?s=128&g=1", "display_name": "Abraham Francis", "link": "https://stackoverflow.com/users/10743228/abraham-francis"}, "edited": false, "score": 0, "creation_date": 1549462171, "post_id": 54555277, "comment_id": 95910723, "body": "I added a link to the image"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1549462438, "post_id": 54555277, "comment_id": 95910908, "body": "I\u2019m suspicious of the <code>modify(s + cur, \u2026)</code> line, but an MCVE (<a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>) would help."}, {"owner": {"reputation": 73, "user_id": 10743228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pPZOw.png?s=128&g=1", "display_name": "Abraham Francis", "link": "https://stackoverflow.com/users/10743228/abraham-francis"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1549463156, "post_id": 54555277, "comment_id": 95911376, "body": "@JonathanLeffler I agree. I did that. Also, there is a ^@ after the first A."}, {"owner": {"reputation": 15373, "user_id": 822669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f66e2987d5d24e6d8a1f686154a51c21?s=128&d=identicon&r=PG", "display_name": "Sander De Dycker", "link": "https://stackoverflow.com/users/822669/sander-de-dycker"}, "reply_to_user": {"reputation": 1924, "user_id": 2669042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c66a47707c3d1748c9977727ddfa4d50?s=128&d=identicon&r=PG", "display_name": "xing", "link": "https://stackoverflow.com/users/2669042/xing"}, "edited": false, "score": 0, "creation_date": 1549463624, "post_id": 54555277, "comment_id": 95911680, "body": "@xing : I recommend turning that into an answer"}, {"owner": {"reputation": 73, "user_id": 10743228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pPZOw.png?s=128&g=1", "display_name": "Abraham Francis", "link": "https://stackoverflow.com/users/10743228/abraham-francis"}, "reply_to_user": {"reputation": 1924, "user_id": 2669042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c66a47707c3d1748c9977727ddfa4d50?s=128&d=identicon&r=PG", "display_name": "xing", "link": "https://stackoverflow.com/users/2669042/xing"}, "edited": false, "score": 0, "creation_date": 1549464384, "post_id": 54555277, "comment_id": 95912180, "body": "@xing Thanks, that worked!"}], "answers": [{"comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1549500282, "post_id": 54556150, "comment_id": 95928249, "body": "Or <code>if (*vow != *ch &amp;&amp; *vow != &#39;\\0&#39;) putchar(*vow);</code>, which some people would shorten to <code>if (*vow != *ch &amp;&amp; *vow) putchar(*vow);</code>.  Personally, I think the symmetry of the longer version is better, and the compiler will produce the same code either way."}], "tags": [], "owner": {"reputation": 300, "user_id": 8800091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/230f0c9c6f2224071a4c4dc45bd1087f?s=128&d=identicon&r=PG&f=1", "display_name": "andi8086", "link": "https://stackoverflow.com/users/8800091/andi8086"}, "is_accepted": true, "score": 5, "last_activity_date": 1549464069, "creation_date": 1549464069, "answer_id": 54556150, "question_id": 54555277, "link": "https://stackoverflow.com/questions/54555277/printf-prints-invalid-characters-after-each-number/54556150#54556150", "title": "printf prints invalid characters after each number", "body": "<p>Look at your program logic in the <code>modify</code> function.\nIf you find a vowel, you set <code>*vow = 0</code> if it was not 0 before.\nIn the next step, if you don't find a vowel, you output <code>*vow</code>, which is\na null-byte. Afterwards, you set <code>*vow = *ch</code>.</p>\n\n<p>So always when it does not find a vowel and had found a vowel before,\nand a non-vowel before that, a 0-byte is printed.</p>\n\n<p>Rethink your logic :)</p>\n\n<p>Or simply change</p>\n\n<pre><code>if (*vow != *ch)\n    putchar(*vow)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>if (*vow != *ch)\n    if (*vow) putchar(*vow);\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 10743228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pPZOw.png?s=128&g=1", "display_name": "Abraham Francis", "link": "https://stackoverflow.com/users/10743228/abraham-francis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 54556150, "answer_count": 1, "score": 1, "last_activity_date": 1549464069, "creation_date": 1549461302, "last_edit_date": 1549463109, "question_id": 54555277, "link": "https://stackoverflow.com/questions/54555277/printf-prints-invalid-characters-after-each-number", "title": "printf prints invalid characters after each number", "body": "<p>On calling the print_compressed() (code given below), the program prints characters properly, but after printf() is executed (to print numerical values), an additional character is also printed. This char is not visible on the terminal. But on saving the output to a file, it is represented as '^@' (using nano editor).</p>\n\n<pre><code>void modify(char *ch, int *cons, char *vow)\n{\n    if (strchr(vowels, *ch) == NULL) {\n        if (*vow) {\n            putchar(*vow);\n            *vow = 0;\n        }\n        ++*cons;\n    } else {\n        if (*cons) {\n            printf(\"%i\", *cons);\n            *cons = 0;\n        }\n        if (*vow != *ch)\n            putchar(*vow);\n        *vow = *ch;\n    }    \n}\n\nvoid print_compressed(char *s)\n{\n    putchar(toupper(*(s++)));\n    int curr = 0;\n    int cons = 0;\n    char vow = 0;\n    while (s[curr]) {\n        modify(s + curr, &amp;cons, &amp;vow);\n        ++curr;\n    }\n    modify(s + curr, &amp;cons, &amp;vow);\n    putchar('\\n');\n}\n</code></pre>\n\n<blockquote>\n  <p>Input :\n  aaabcdefee</p>\n  \n  <p>Expected Output : \n  Aa3e1e</p>\n  \n  <p>Output on terminal is same as expected</p>\n  \n  <p>Output when output is saved as file : \n  A^@a3^@e1^@e</p>\n</blockquote>\n"}, {"tags": ["c", "time", "time.h"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 1, "creation_date": 1549459176, "post_id": 54554587, "comment_id": 95908927, "body": "why do you need to clock at start &amp; end? just clock at start and use the new value as end.. (except for the last value)"}, {"owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "edited": false, "score": 1, "creation_date": 1549459404, "post_id": 54554587, "comment_id": 95909061, "body": "Which OS and compiler? How are you monitoring <code>time_t</code>?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1549461354, "post_id": 54554587, "comment_id": 95910215, "body": "Can you show some values you\u2019re seeing?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1549461503, "post_id": 54554587, "comment_id": 95910313, "body": "Does \u201cend is coming as less and start is coming more comparatively\u201d mean that sometimes <code>end</code> is less than <code>start</code>?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1549463794, "post_id": 54554587, "comment_id": 95911795, "body": "Please show how you are checking the values and what values you are seeing."}, {"owner": {"reputation": 65, "user_id": 10242754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b47a568d62141a009b80a391384a820?s=128&d=identicon&r=PG&f=1", "display_name": "gov", "link": "https://stackoverflow.com/users/10242754/gov"}, "edited": false, "score": 1, "creation_date": 1549538703, "post_id": 54554587, "comment_id": 95942130, "body": "Updated actual question for the questions asked in comments."}, {"owner": {"reputation": 65, "user_id": 10242754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b47a568d62141a009b80a391384a820?s=128&d=identicon&r=PG&f=1", "display_name": "gov", "link": "https://stackoverflow.com/users/10242754/gov"}, "edited": false, "score": 0, "creation_date": 1549543645, "post_id": 54554587, "comment_id": 95945113, "body": "uname -a output on system  Linux 0005xxxxxxxxx 3.12.19-rt30 #1 SMP Thu Dec 20 17:55:58 IST 2018 ppc64 GNU/Linux"}, {"owner": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "edited": false, "score": 0, "creation_date": 1549549531, "post_id": 54554587, "comment_id": 95948605, "body": "You didn&#39;t <i>show how you are checking the values</i>."}, {"owner": {"reputation": 65, "user_id": 10242754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b47a568d62141a009b80a391384a820?s=128&d=identicon&r=PG&f=1", "display_name": "gov", "link": "https://stackoverflow.com/users/10242754/gov"}, "edited": false, "score": 0, "creation_date": 1549608555, "post_id": 54554587, "comment_id": 95970981, "body": "Added. Above is a simplified version of the actual code. Can&#39;t post actual code"}, {"owner": {"reputation": 870061, "user_id": 17034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cii6b.png?s=128&g=1", "display_name": "Hans Passant", "link": "https://stackoverflow.com/users/17034/hans-passant"}, "edited": false, "score": 0, "creation_date": 1549613661, "post_id": 54554587, "comment_id": 95972877, "body": "It should happen, you are not using <a href=\"https://en.wikipedia.org/wiki/Real-time_operating_system\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 80047, "user_id": 169346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645dbb4f7ba1ff9d7ff2de02f68fbe9c?s=128&d=identicon&r=PG", "display_name": "JeremyP", "link": "https://stackoverflow.com/users/169346/jeremyp"}, "edited": false, "score": 0, "creation_date": 1549621716, "post_id": 54554587, "comment_id": 95977075, "body": "These probably aren&#39;t the specific answer but two things you should so are 1) use the correct format specifier for <code>start</code> and <code>end</code>. On my computer, it&#39;s <code>%ld</code> and 2) have a check that <code>end - start</code> does not exceed 300, otherwise you&#39;ll be sleeping with a negative <code>timeleft</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1205, "user_id": 2655905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b78614e85e3c08eed9e43ab7197a90f3?s=128&d=identicon&r=PG", "display_name": "Stuart", "link": "https://stackoverflow.com/users/2655905/stuart"}, "is_accepted": false, "score": 0, "last_activity_date": 1549620205, "last_edit_date": 1549620205, "creation_date": 1549619876, "answer_id": 54589868, "question_id": 54554587, "link": "https://stackoverflow.com/questions/54554587/timetime-t-timer-gives-wrong-results-without-time-drift-in-system/54589868#54589868", "title": "time(time_t *timer) gives wrong results without time drift in system", "body": "<p>This analysis of the issue doesn't actually give a single answer, but it was too long to fit in a comment so here goes.</p>\n\n<p>After looking at your code, it appears that the problem is that <strong>end &lt; start</strong>. But <strong>end = time(0)</strong> is always called after <strong>start = time(0)</strong>.</p>\n\n<p>Your example assumes that you can subtract <strong>time_t</strong> values and get the elapsed seconds between them, but the C standard does not guarantee that. Your code seems to be running on a recent version of Linux so I took a look at the <a href=\"https://www.gnu.org/software/libc/manual/html_node/Simple-Calendar-Time.html#Simple-Calendar-Time\" rel=\"nofollow noreferrer\">GNU Libc manual</a>, and apparently <strong>time</strong> returns the number of secs since 00:00:00 on January 1, 1970, and a time_t is a long int. I also checked the values of <strong>start</strong> and <strong>end</strong>, when the issue occurred, and their values are about 49 years worth of secs, and since it been 49 years since January 1, 1970, it appears that the assumption in your example is valid.</p>\n\n<p>My best guess is that there is some significant difference between the actual code and your example. Perhaps a call to <strong>start = time(0)</strong> that takes place after the call to <strong>end=time(0)</strong>, or maybe situations where a call to end=time(0) does not take place.</p>\n\n<p>You can rule this out by converting your example into an actual program and see if that program has the same issue. If it does, you can post the code for the program. This site encourages people to create <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable examples</a>.</p>\n\n<p>In the meantime, I can make some other guesses:</p>\n\n<ol>\n<li>Your program has more than one thread, and your threads are stepping on each other.</li>\n<li>Some weird compiler optimization is causing the calls to <strong>time(0)</strong> to be moved around.</li>\n</ol>\n"}], "owner": {"reputation": 65, "user_id": 10242754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b47a568d62141a009b80a391384a820?s=128&d=identicon&r=PG&f=1", "display_name": "gov", "link": "https://stackoverflow.com/users/10242754/gov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1549620205, "creation_date": 1549459055, "last_edit_date": 1549608482, "question_id": 54554587, "link": "https://stackoverflow.com/questions/54554587/timetime-t-timer-gives-wrong-results-without-time-drift-in-system", "title": "time(time_t *timer) gives wrong results without time drift in system", "body": "<p>below code is for doing some stuff and sleep till next interval.\nfor calculation of sleep time, I am using below logic.</p>\n\n<pre><code>time_t start = time(0);\ntime_t end = time(0);\nint timeLeft = 0;\nint interval = 300;\nwhile(1)\n{\n\n    /* do something\n     * lets say takes 5 to 20 seconds to execute\n     */\n    end = time(0);\n    timeLeft = interval -(end - start);\n    printf(\"timeLeft: %d, interval: %d, end: %u, start: %u\",timeLeft,interval,end,start);\n    sleep(timeLeft)\n    start = time(0);\n}\n</code></pre>\n\n<p>After an uptime of 34 hours of the system, <strong>timeLeft</strong> is coming as greater than 300, which should never happen.\nI have checked, there is no time drift in the system.</p>\n\n<p>for an instance, when the issue happened, </p>\n\n<blockquote>\n  <p>timeLeft: 11484, interval: 300, end: 1549402241, start: 1549413425</p>\n</blockquote>\n\n<p>Don't know how can above happen?\nneed help.</p>\n"}, {"tags": ["c", "linked-list"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1549457778, "post_id": 54554154, "comment_id": 95908063, "body": "The thing is that you don&#39;t have a <code>Node</code> structure inside the structure, you have a <b><i>pointer</i></b> to a <code>Node</code> structure."}, {"owner": {"reputation": 292, "user_id": 5147834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/732459705630740316c5a2965662e056?s=128&d=identicon&r=PG&f=1", "display_name": "Axeon Thra", "link": "https://stackoverflow.com/users/5147834/axeon-thra"}, "edited": false, "score": 1, "creation_date": 1549457917, "post_id": 54554154, "comment_id": 95908161, "body": "All pointers, irrespective of their type has same size."}, {"owner": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 0, "creation_date": 1549457953, "post_id": 54554154, "comment_id": 95908184, "body": "Which is holding the address of a node structure?"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "reply_to_user": {"reputation": 292, "user_id": 5147834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/732459705630740316c5a2965662e056?s=128&d=identicon&r=PG&f=1", "display_name": "Axeon Thra", "link": "https://stackoverflow.com/users/5147834/axeon-thra"}, "edited": false, "score": 3, "creation_date": 1549458036, "post_id": 54554154, "comment_id": 95908233, "body": "@AxeonThra Strictly speaking that doesn&#39;t have to be true. It just happen to be so on &quot;modern&quot; PC-type systems. However, the size of a pointer is always known and fixed."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 1, "creation_date": 1549458047, "post_id": 54554154, "comment_id": 95908241, "body": "At the time the compiler reads the <code>struct Node *next</code>,  it (temporarily) treats it as a pointer to an incomplete type."}, {"owner": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 0, "creation_date": 1549458787, "post_id": 54554154, "comment_id": 95908695, "body": "How is incomplete defined?"}, {"owner": {"reputation": 55059, "user_id": 212858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1166c87b6f3fc2e6746da96b60fefb46?s=128&d=identicon&r=PG", "display_name": "Useless", "link": "https://stackoverflow.com/users/212858/useless"}, "edited": false, "score": 2, "creation_date": 1549458826, "post_id": 54554154, "comment_id": 95908719, "body": "It roughly means &quot;it&#39;s a pointer to something, and even though I don&#39;t yet know the size of the <i>something</i>, the size of the <i>pointer</i> is always the same&quot;."}, {"owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "edited": false, "score": 1, "creation_date": 1549458980, "post_id": 54554154, "comment_id": 95908821, "body": "What should be clear is that linked lists are <b>lightweight dynamically extensible data structures</b>. This means that they can grow, or contract, dynamically with little CPU and memory charge. In fact to extend structures you simply need to allocate a new memory block and &#39;link&#39; it by storing the base block address in the node pointer. On the other hand the use of arrays  require extension of large allocations that could require memory relocation, data copy etc (as using <code>realloc()</code>) that use more resources. Also deleting elements are simple, unlink it and free memory."}], "answers": [{"comments": [{"owner": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 2, "creation_date": 1549458306, "post_id": 54554254, "comment_id": 95908371, "body": "I see. But by &quot;The value of the pointer is indeterminate.&quot; do you mean that it might point to a random chunk of memory if I don&#39;t initialize it to NULL?"}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 0, "creation_date": 1549458465, "post_id": 54554254, "comment_id": 95908469, "body": "@Luyw - Pretty much. It means (formally) that you know nothing of the value the pointer holds (the value is an address). Using any variable that holds an indeterminate value means the behavior of the program is undefined. This is why one is told that initializing variables (and declaring right before the first use, where a meaningful initial value is possible) is considered good practice."}, {"owner": {"reputation": 3545, "user_id": 2183547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd540edd4677da5281d4331bf835f51?s=128&d=identicon&r=PG", "display_name": "L. Scott Johnson", "link": "https://stackoverflow.com/users/2183547/l-scott-johnson"}, "reply_to_user": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 0, "creation_date": 1549458470, "post_id": 54554254, "comment_id": 95908472, "body": "@Luyw: yes, exactly. If the value of a pointer is not defined, it will still have a value. If that value is NULL (0), then you&#39;re in luck. But if not, then yeah, it effectively points to some &quot;random&quot; chunk of memory."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 3545, "user_id": 2183547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd540edd4677da5281d4331bf835f51?s=128&d=identicon&r=PG", "display_name": "L. Scott Johnson", "link": "https://stackoverflow.com/users/2183547/l-scott-johnson"}, "edited": false, "score": 0, "creation_date": 1549458515, "post_id": 54554254, "comment_id": 95908503, "body": "@L.ScottJohnson - Out of luck. The appearance of working is also a possible manifestation of undefined behavior, the most dangerous kind."}, {"owner": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 0, "creation_date": 1549458628, "post_id": 54554254, "comment_id": 95908592, "body": "Then isn&#39;t the type in the declaration of a pointer useless? Since I could have a char pointer originally pointing to a memory chunk holding an int value for example?"}, {"owner": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 0, "creation_date": 1549458717, "post_id": 54554254, "comment_id": 95908646, "body": "I see how I could answer my second question if a pointer&#39;s type is ignored while the object itself is uninitialized but it&#39;s not the case right?"}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 2, "creation_date": 1549458784, "post_id": 54554254, "comment_id": 95908691, "body": "@Luyw - No. The type is for static type checking. You&#39;d have to constantly cast to a char*. You may think, okay I&#39;ll use void*. But either way you lose the benefit of the compiler verifying that the list contains only structures of the correct type. This does not good software make."}, {"owner": {"reputation": 3545, "user_id": 2183547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dd540edd4677da5281d4331bf835f51?s=128&d=identicon&r=PG", "display_name": "L. Scott Johnson", "link": "https://stackoverflow.com/users/2183547/l-scott-johnson"}, "edited": false, "score": 0, "creation_date": 1549458870, "post_id": 54554254, "comment_id": 95908740, "body": "@StoryTeller: yeah. Being in luck is a matter of luck. And when the luck runs out, you&#39;ll be out of luck. That&#39;s luck for you."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 1, "creation_date": 1549458883, "post_id": 54554254, "comment_id": 95908757, "body": "@Luyw - The pointer type is not ignored. It is a pointer to a type called <code>struct Node</code>. The compiler needs only so much info to know the full object layout (pointers are not the thing they point at, again)."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "edited": false, "score": 2, "creation_date": 1549459397, "post_id": 54554254, "comment_id": 95909056, "body": "@Luyw - All struct pointers are the same, that&#39;s guaranteed. And coincidentally that&#39;s enough to make useful data types. Other pointers may vary. But that goes beyond the scope of the question."}], "tags": [], "owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "is_accepted": true, "score": 10, "last_activity_date": 1549459677, "last_edit_date": 1549459677, "creation_date": 1549458023, "answer_id": 54554254, "question_id": 54554154, "link": "https://stackoverflow.com/questions/54554154/how-can-a-linked-list-node-be-defined-recursively/54554254#54554254", "title": "How can a linked list node be defined &quot;recursively&quot;?", "body": "<blockquote>\n  <ol start=\"2\">\n  <li>Create the struct pointed to by the pointer in the first struct, it contains an integer and a pointer to a struct of the same type.</li>\n  </ol>\n</blockquote>\n\n<p>This is where your reasoning is off. Creating a pointer to something does not automatically create the thing it's supposed to point at. So the fact the first object is created with a pointer in it, does not mean that the pointer will point to something valid. Just like if I write:</p>\n\n<pre><code>int *p;\n</code></pre>\n\n<p>It doesn't point to anything. The value of the <em>pointer</em> is indeterminate. I can initialize the pointer:</p>\n\n<pre><code>int *p = NULL;\n</code></pre>\n\n<p>And it still doesn't point at anything. But I can give it the address of something:</p>\n\n<pre><code>int i = 1;\nint *p = &amp;i;\n</code></pre>\n\n<p>And <em>now</em> is points at something. Same thing with the pointer in the node. The node can only be made to hold the address of some node, but it doesn't have to. This is why a linked list is not just the declaration of a node, but also of a set of functions (operations). It is those functions that are meant to make sure the list is in a valid state. That each node points at another, or at a well-defined terminator.</p>\n"}, {"tags": [], "owner": {"reputation": 3560, "user_id": 5550963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7jAip.png?s=128&g=1", "display_name": "CEPB", "link": "https://stackoverflow.com/users/5550963/cepb"}, "is_accepted": false, "score": 1, "last_activity_date": 1549462099, "last_edit_date": 1549462099, "creation_date": 1549461369, "answer_id": 54555299, "question_id": 54554154, "link": "https://stackoverflow.com/questions/54554154/how-can-a-linked-list-node-be-defined-recursively/54555299#54555299", "title": "How can a linked list node be defined &quot;recursively&quot;?", "body": "<blockquote>\n  <p>Why isn't this an infinite loop of declarations?</p>\n</blockquote>\n\n<p>Ok first thing first <strong>pointer</strong> is <strong>pointer</strong>, it does not matter does it point to the <code>int</code>, <code>char</code>, <code>double</code> or <code>struct</code> it is essentially address of memory where something starts and its size is determined by the architecture. That is why you can declare pointer inside <code>struct</code> which you just created. If you run this code:</p>\n\n<pre><code>struct node {\n    int val;\n    struct node next; // NOTE: I omitted * so it is not pointer it is struct\n};\n</code></pre>\n\n<p>this will give you an error, because <code>struct node</code> is <em>unknown</em>, its size is also unknown. So in comparison to:</p>\n\n<pre><code>struct node {\n    int val;\n    struct node *next;\n};\n</code></pre>\n\n<p>Pointer type is known, what is unknown here is what it points to. Size of pointer is also known thus you do not get recursion.</p>\n\n<p>To get to the point of <strong>pointers</strong>. In C this:</p>\n\n<pre><code>int a = 5;\nint *p = &amp;a;\nchar *c = p;\n</code></pre>\n\n<p>is perfectly legal, and it is up to programmer to keep track of this. So bottom line <code>struct node *next</code> is pointer to (address of) presumably next node. This is the reason why you do not have <code>recursion</code> occurring.</p>\n\n<blockquote>\n  <p>How does the compiler recognize a struct Node inside struct Node?</p>\n</blockquote>\n\n<p>It does not!!! This is why my first example does not work!!!! It recognizes pointer type. You can essentially write it as this:</p>\n\n<pre><code>struct node {\n    int val;\n    void *next;\n};\n</code></pre>\n\n<p>and to your machine it will be the same as:</p>\n\n<pre><code>struct node {\n    int val;\n    struct node *next;\n};\n</code></pre>\n\n<p>Hope this helps you.</p>\n"}], "owner": {"reputation": 219, "user_id": 10873007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LEXsS.jpg?s=128&g=1", "display_name": "Luyw", "link": "https://stackoverflow.com/users/10873007/luyw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 54554254, "answer_count": 2, "score": 7, "last_activity_date": 1549462099, "creation_date": 1549457684, "last_edit_date": 1549459238, "question_id": 54554154, "link": "https://stackoverflow.com/questions/54554154/how-can-a-linked-list-node-be-defined-recursively", "title": "How can a linked list node be defined &quot;recursively&quot;?", "body": "<p>We've just been introduced to linked list today, I get the concept but the declaration is bothering me, here's the code :</p>\n\n<pre><code>struct Node \n{ \n    int data; \n    struct Node *next; \n}; \n</code></pre>\n\n<p>Why isn't this an infinite loop of declarations?</p>\n\n<p>How does the compiler recognize a <code>struct Node</code> inside <code>struct Node?</code></p>\n\n<p>The way I see it, after turning a blind eye to my second question, is as follows :</p>\n\n<ol>\n<li>Create a struct inside which there's an integer and a pointer to a struct \nof the same type.</li>\n<li>Create the struct pointed to by the pointer in the first struct, it contains an integer and a pointer to a struct of the same type.</li>\n<li>Create the struct pointed to by the pointer in the second struct which is a struct pointed to by a pointer in the first struct.</li>\n<li>...</li>\n</ol>\n"}, {"tags": ["c", "stack", "rtos"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1549457336, "post_id": 54554009, "comment_id": 95907820, "body": "How do you examine the stack? How large are they? Are they all the same size? Is there a pattern that you can see? Is the size of a &quot;gap&quot; plus the next used area consistent? Do they always start or end at addresses that seems to indicate a pattern? Have you looked at the generated code to see if it&#39;s the compiler that adds some space between function call frames?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549457408, "post_id": 54554009, "comment_id": 95907859, "body": "Wouldn&#39;t you rather be concerned if all stacks were full and every task you have written suffers from stack overflow?"}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 2, "creation_date": 1549458050, "post_id": 54554009, "comment_id": 95908243, "body": "It&#39;s not unusual to require stack frames to have some alignment (e.g. 16 bytes on the AMD64 SystemV ABI to accommodate for SSE types). How big are those gaps?"}, {"owner": {"reputation": 4732, "user_id": 8477999, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8172e1919af53269de92316dcf03a03?s=128&d=identicon&r=PG&f=1", "display_name": "Gem Taylor", "link": "https://stackoverflow.com/users/8477999/gem-taylor"}, "edited": false, "score": 1, "creation_date": 1549465159, "post_id": 54554009, "comment_id": 95912673, "body": "If any of your functions declare an uninitialised array, and perhaps only uses part of it, this would show as your original pattern?"}], "answers": [{"tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": false, "score": 2, "last_activity_date": 1549894710, "last_edit_date": 1549894710, "creation_date": 1549894360, "answer_id": 54632440, "question_id": 54554009, "link": "https://stackoverflow.com/questions/54554009/unused-gaps-in-embedded-c-programs-task-stack/54632440#54632440", "title": "Unused gaps in Embedded C program&#39;s task stack", "body": "<p>The signature pattern is a method of determining stack usage, but is not a perfect mechanism - if nothing is ever written to a variable, the pattern will not be modified.  </p>\n\n<p>\"Unused\" is a misleading term; rather <em>not modified</em> is a better description.</p>\n\n<p>This would commonly occur in instances of buffers that might not be fully utilised.  For example if you had say:</p>\n\n<pre><code>char string_buff[128] ;\n\nsprintf( string_buf, \"%s\", \"hello\" ) ;\n</code></pre>\n\n<p>only 6 characters of <code>string_buff</code> will be written, and show as a 122 byte \"unused\" gap.</p>\n\n<p>If the code were modified thus:</p>\n\n<pre><code>char string_buff[128] = {0} ;\n\nsprintf( string_buf, \"%s\", \"hello\" ) ;\n</code></pre>\n\n<p>The entire buffer would show as used at the expense of initialising the entire buffer.</p>\n"}, {"tags": [], "owner": {"reputation": 2127, "user_id": 1819452, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3ad224b55add66c22f62380dea203e75?s=128&d=identicon&r=PG", "display_name": "Vroomfondel", "link": "https://stackoverflow.com/users/1819452/vroomfondel"}, "is_accepted": false, "score": 0, "last_activity_date": 1549971427, "creation_date": 1549971427, "answer_id": 54649280, "question_id": 54554009, "link": "https://stackoverflow.com/questions/54554009/unused-gaps-in-embedded-c-programs-task-stack/54649280#54649280", "title": "Unused gaps in Embedded C program&#39;s task stack", "body": "<p>I am not completely sure I understand you. \nThe gaps between stacks can come from the linker inserting a safety threshold on \"top\" (that is, in the direction of stack increase) of each stack to protect from the situation where a tasks stack is used up completely by task routines and an interrupt occurs - in an unmanaged situation the interrupt, in fact all possible interrupts which are allowed by the priority protocol of your CPU, may add on top of each tasks maximum stack usage. In a managed situation (most RTOS manage interrupt handling, or can at least be configured to do so) at least a small portion for the interrupt entry will temporarily reside on the task stack until the OS vectoring has moved to a system stack which will handle stacking the current and all higher priority ISRs. Thus also in a managed interrupt scheme there needs to be a safety margin on top of each stack.</p>\n"}], "owner": {"reputation": 642, "user_id": 4057482, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ea82a5621ea1ed4c0c9550ba443256e0?s=128&d=identicon&r=PG&f=1", "display_name": "User55412", "link": "https://stackoverflow.com/users/4057482/user55412"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1549971427, "creation_date": 1549457206, "last_edit_date": 1549467600, "question_id": 54554009, "link": "https://stackoverflow.com/questions/54554009/unused-gaps-in-embedded-c-programs-task-stack", "title": "Unused gaps in Embedded C program&#39;s task stack", "body": "<p>In an embedded C development running an RTOS with multiple tasks, where each task has its own stack, why would a stack have an unused gap in between used sections?</p>\n\n<p>The stacks are populated with a known pattern at startup to determine worst-case stack usage. When the stack contents are viewed at run-time using an IDE memory viewer, a gap of the known pattern can be seen between normal stack data.</p>\n\n<p>For example:</p>\n\n<pre><code>Stack top\n-----------------\nunused area\n-----------\nused area 2\n-----------\nunused area\n-----------\nused area 1\n-----------------\nStack bottom\n</code></pre>\n\n<p>Why would normal stack use leave a gap instead of contiguous data?</p>\n\n<p>Any suggestions appreciated,\nthanks</p>\n\n<p><strong>Update</strong></p>\n\n<p>To answer the questions, a single gap of 96 bytes has been seen on a single stack where the total stack size is 0x400 bytes.</p>\n\n<p>Thank you for all of your comments, there are some great suggestions. In this case I can rule Alignment due to the size of the gap and the single occurrence. An uninitialised array is probably the cause as all other RAM is initially populated with the same pattern as the stacks.</p>\n\n<p>My other (concerning) thought was a corrupt stack pointer but this seems unlikely as the software runs without issue.</p>\n"}, {"tags": ["c", "arrays", "struct", "pragma-pack"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 3, "creation_date": 1549452967, "post_id": 54552564, "comment_id": 95905195, "body": "You&#39;re doing the same (if <code>uint8_t</code> is <code>unsigned char</code> on your machine, etc.), only the <code>memcpy</code> is faster."}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1549456785, "post_id": 54552564, "comment_id": 95907513, "body": "If you show how you want to use the result of <code>writeStructToArray</code> we could provide better answers. Do you also have structures with data elements bigger than 8 bits? Do you already handle byte order and possible type size differences somewhere?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549464183, "post_id": 54552564, "comment_id": 95912053, "body": "Why do you need to copy the data? Double-buffering purposes?"}], "answers": [{"comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1549456096, "post_id": 54553157, "comment_id": 95907059, "body": "How does the endianess (ie. packing of bytes within integers) affect the second method? How will it differ? How will the first method and the second differ in the output, depending on the endianess of the system? Why and how need to be data prepared for the second method, while for the first there is no such requirement? Both methods copy byte by byte. Bytes in both methods are copied one after another - the order of bytes inside memory regions stays the same."}, {"owner": {"reputation": 76, "user_id": 1936612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c7c59fd15e98f5a7587831bfe4e5679?s=128&d=identicon&r=PG", "display_name": "Deepak", "link": "https://stackoverflow.com/users/1936612/deepak"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1549459602, "post_id": 54553157, "comment_id": 95909191, "body": "Above answer is given in a generic manner without considering the data type of the variable inside the structure. Structure with int data type is used insteed of unt8_t, in 32 bit muchine and if the first variable is assigned with 0x12345678 in little endian and same variable value will be 0x78563412 in big endian machine. Receiver doing memcpy() to a structue variable pointer then value will be improper. In the second case receiver also have to write a code to make sure that the bytes read are converted to proper value by reversing the order."}, {"owner": {"reputation": 76, "user_id": 1936612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c7c59fd15e98f5a7587831bfe4e5679?s=128&d=identicon&r=PG", "display_name": "Deepak", "link": "https://stackoverflow.com/users/1936612/deepak"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1549460298, "post_id": 54553157, "comment_id": 95909607, "body": "For sender both method  will be same, answer is given by considering the receiver, usually we tend to use memcpy() in both sender and receiver, that will make out code machine dependent and not portable. So better to have our own logic where in sender and receiver will  share the information in the initial hand shaking and then convert the byte stream accordingly. one of the sender or receiver can have logic to make sure of the data is received as intended."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1549464360, "post_id": 54553157, "comment_id": 95912163, "body": "Let the protocol handler port worry about endianess, if applicable. What matters is <i>network</i> endianess - the endianess used by the communication protocol. Not by the receiver."}, {"owner": {"reputation": 76, "user_id": 1936612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c7c59fd15e98f5a7587831bfe4e5679?s=128&d=identicon&r=PG", "display_name": "Deepak", "link": "https://stackoverflow.com/users/1936612/deepak"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549513827, "post_id": 54553157, "comment_id": 95930910, "body": "@Lundin: I am new on this network concept, if the sender is little endian and network is little endian and receiver is also big endian, then is this network take care of this handling? because in case of sending the structure with 2 int variable 8 byte will be sent to network as byte stream and network can not reverse whole 8 byte in this case to converts to big endian, it should consider first variable and second variable separately and then reverse 4 byte each and network will not know on structure declaration, how receiver will get proper value for the first and second variable?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549525614, "post_id": 54553157, "comment_id": 95934978, "body": "The network endianess is what the transmission protocol dictates. Both the transmitter and the receiver has to take care of this and write/read bytes in the appropriate order."}], "tags": [], "owner": {"reputation": 76, "user_id": 1936612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c7c59fd15e98f5a7587831bfe4e5679?s=128&d=identicon&r=PG", "display_name": "Deepak", "link": "https://stackoverflow.com/users/1936612/deepak"}, "is_accepted": false, "score": 1, "last_activity_date": 1549454356, "creation_date": 1549454356, "answer_id": 54553157, "question_id": 54552564, "link": "https://stackoverflow.com/questions/54552564/copying-a-struct-into-a-byte-array/54553157#54553157", "title": "Copying a struct into a byte array", "body": "<p>memcpy() will not consider endiannsess of the system. so if Sender is big endian and receiver is little endian then then will be a conflict in the receiver for the structure variable value.</p>\n\n<p>With the second method you know how the byte stream is prepared at sender so at the receiving end also it can receive accordingly to make sure of the proper structure variable value.</p>\n\n<p>If the endianness of the systems is same and endianness is not a concern then both the method will serve the purpose and memcpy() will be faster compare to the assigning the byte value in a loop.</p>\n"}, {"comments": [{"owner": {"reputation": 946, "user_id": 5405191, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-4P9RvEs8-eM/AAAAAAAAAAI/AAAAAAAAAA4/sRL7T9ciO7U/photo.jpg?sz=128", "display_name": "Akay", "link": "https://stackoverflow.com/users/5405191/akay"}, "edited": false, "score": 0, "creation_date": 1549455497, "post_id": 54553208, "comment_id": 95906694, "body": "yeah, I could do this, but I have more than 100 of these kinds of structs which I need to serialize, so in that case, this will involve a bit of work for creating unions for each of them, or maybe a master union for all of them!"}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "reply_to_user": {"reputation": 946, "user_id": 5405191, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-4P9RvEs8-eM/AAAAAAAAAAI/AAAAAAAAAA4/sRL7T9ciO7U/photo.jpg?sz=128", "display_name": "Akay", "link": "https://stackoverflow.com/users/5405191/akay"}, "edited": false, "score": 1, "creation_date": 1549456564, "post_id": 54553208, "comment_id": 95907373, "body": "@Akay You don&#39;t need the union and you don&#39;t need to copy the data. Depending on how you send the data you can simply cast the address to a <code>char*</code> or <code>void*</code> as necessary. Additionally you need the size of the structure, especially if you have some of them with different sizes."}], "tags": [], "owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "is_accepted": false, "score": 5, "last_activity_date": 1549454547, "creation_date": 1549454547, "answer_id": 54553208, "question_id": 54552564, "link": "https://stackoverflow.com/questions/54552564/copying-a-struct-into-a-byte-array/54553208#54553208", "title": "Copying a struct into a byte array", "body": "<p>As Kamil Cuk commented, your two proposals are nearly the same with some possible speed difference.</p>\n\n<p>Another option would be to use a union:</p>\n\n<pre><code>typedef struct {\n    uint8_t ck_a;\n    uint8_t ck_b;\n} UBXChecksum_t ;\n\nunion convert {\n    UBXChecksum_t checksum;\n    char buffer[sizeof UBXChecksum_t];\n};\n\nUBXChecksum_t checksum;\n\nunion convert converter;\n\nconverter.checksum = checksum;\n\npassArrayToSomeFunction(converter.buffer, sizeof(converter.buffer));\n</code></pre>\n\n<p>You don't have to copy the data to convert it to an array. You could pass a pointer to the structure (if necessary casted to <code>char*</code> or <code>void*</code>) and the structure size to a function that sends the data to the serial port. Example:</p>\n\n<pre><code>typedef struct {\n    uint8_t ck_a;\n    uint8_t ck_b;\n} UBXChecksum_t ;\n\nint sendData(void *buf, size_t size);\n\nUBXChecksum_t checksum;\n\n/* ... */\nint rc = sendData(&amp;checksum, sizeof(checksum));\n</code></pre>\n\n<p>All these variants send the structure's internal representation as binary data. Normally \"serializing\" is understood as a way to convert the data into a platform-independent format.</p>\n\n<p>Sending binary data structures works if the receiving system is of the same type and using the same compiler. You might get problems when the receiving system uses different byte order or different data type sizes. </p>\n\n<p>In your case you have a structure of two <code>uint8_t</code> values, so the size is fixed and the byte order is not a problem.</p>\n\n<p>It is OK to send binary data if the requirement for the structure is to match a specified binary data protocol and you are prepared to handle the byte order if necessary.</p>\n"}], "owner": {"reputation": 946, "user_id": 5405191, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-4P9RvEs8-eM/AAAAAAAAAAI/AAAAAAAAAA4/sRL7T9ciO7U/photo.jpg?sz=128", "display_name": "Akay", "link": "https://stackoverflow.com/users/5405191/akay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1546, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1549455925, "creation_date": 1549452396, "question_id": 54552564, "link": "https://stackoverflow.com/questions/54552564/copying-a-struct-into-a-byte-array", "title": "Copying a struct into a byte array", "body": "<p>I have a 1-byte pragma packed struct in C which I want to copy into a byte array for serialization purpose to be sent over a serial port.</p>\n\n<pre><code>#pragma pack(push, 1)\n\ntypedef struct {\n    uint8_t ck_a;\n    uint8_t ck_b;\n} UBXChecksum_t ;\n\n#pragma pack(pop)\n</code></pre>\n\n<p>What is the best way of serializing it into a byte array, should I just use <code>memcpy()</code>?</p>\n\n<pre><code>void writeStructToArray(const void* inStruct,\n                        const uint16_t inLenStruct,\n                        uint8_t* const outArray)\n{\n  memcpy(outArray, inStruct, inLenStruct);\n}\n</code></pre>\n\n<p>or better use byte-by-byte copying doing pointer typecasting?</p>\n\n<pre><code>void writeStructToArray(const void* inStruct,\n                        const uint16_t inLenStruct,\n                        uint8_t* const outArray)\n{\n  for(uint16_t i = 0; i &lt; inLenStruct; i++)\n  {\n    outArray[i] = ((uint8_t*)inStruct)[i];\n  }\n}\n</code></pre>\n"}, {"tags": ["c", "sockets"], "comments": [{"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 3, "creation_date": 1549454857, "post_id": 54552515, "comment_id": 95906292, "body": "You should show the (if necessary simplified) source code to allow us to find problems. Sending the complete block of data may exceed some buffer size, so you should be prepared for <code>write</code> to have written only a part of the data. Similar for <code>read</code>."}, {"owner": {"reputation": 292, "user_id": 5147834, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/732459705630740316c5a2965662e056?s=128&d=identicon&r=PG&f=1", "display_name": "Axeon Thra", "link": "https://stackoverflow.com/users/5147834/axeon-thra"}, "edited": false, "score": 0, "creation_date": 1549456817, "post_id": 54552515, "comment_id": 95907540, "body": "1. use send/recv for socket communication. 2. do not assume that recv/send fully received or send the data (so keep trying after a small sleep) 3. always handle zero recv/send case as connection closed."}, {"owner": {"reputation": 148, "user_id": 7996173, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213304284022738/picture?type=large", "display_name": "Alessandro Meschi", "link": "https://stackoverflow.com/users/7996173/alessandro-meschi"}, "reply_to_user": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1549471504, "post_id": 54552515, "comment_id": 95916710, "body": "@Bodo Ok i added some code, i hope that is useful. Anyway when i debug i test the return value of both <code>read()</code> and <code>write()</code>  and they result to be correct (the size of the file). Are you saying that even in the case of buffer size exceeding,  the &#39;write()` call return the requested size?"}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1549472787, "post_id": 54552515, "comment_id": 95917417, "body": "Try to send a file with contents that is easy to recognize, e.g. binary data <code>{ 0x55, 0xAA, 0x55, 0xAA, ...}</code>. Maybe you will see that you receive parts of the file as a new header. Your communication protocol is fragile. When you receive the file size in your header and the receiver does not receive the expected amount of data you don&#39;t know if the sender sent less than expected or if something failed (e.g. buffer full) in the receiver. So you don&#39;t know if you have to read the missing bytes before expecting the next header or not."}, {"owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 2, "creation_date": 1549473022, "post_id": 54552515, "comment_id": 95917528, "body": "<code>write</code> and <code>read</code> return the number of bytes written or read. The functions will tell you when they have written or read only a part of your data. When you run your program in a debugger it may run slower, so it might behave different, so you should handle partial reads or writes in your code."}, {"owner": {"reputation": 148, "user_id": 7996173, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213304284022738/picture?type=large", "display_name": "Alessandro Meschi", "link": "https://stackoverflow.com/users/7996173/alessandro-meschi"}, "reply_to_user": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "edited": false, "score": 0, "creation_date": 1549532166, "post_id": 54552515, "comment_id": 95938218, "body": "@Bodo You are right! I modified code like <a href=\"https://stackoverflow.com/a/54570172/7996173\">this</a> and now it works. I think this is what you meant. Thanks a lot for your help."}], "answers": [{"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1549532445, "post_id": 54570172, "comment_id": 95938396, "body": "This code doesn&#39;t work. It needs to advance the buffer pointer and decrement the length required. You should not treat 0 (end of stream) and -1 (error) as the same. They aren&#39;t. You will find further issues that are hard to debug unless you fix this,"}, {"owner": {"reputation": 148, "user_id": 7996173, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213304284022738/picture?type=large", "display_name": "Alessandro Meschi", "link": "https://stackoverflow.com/users/7996173/alessandro-meschi"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1549534685, "post_id": 54570172, "comment_id": 95939716, "body": "@user207421 you are right, I gave a hasty reply. I correct it now"}, {"owner": {"reputation": 148, "user_id": 7996173, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213304284022738/picture?type=large", "display_name": "Alessandro Meschi", "link": "https://stackoverflow.com/users/7996173/alessandro-meschi"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1549546508, "post_id": 54570172, "comment_id": 95946788, "body": "@user207421 Now it should be corect"}], "tags": [], "owner": {"reputation": 148, "user_id": 7996173, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213304284022738/picture?type=large", "display_name": "Alessandro Meschi", "link": "https://stackoverflow.com/users/7996173/alessandro-meschi"}, "is_accepted": true, "score": -1, "last_activity_date": 1549546484, "last_edit_date": 1549546484, "creation_date": 1549531939, "answer_id": 54570172, "question_id": 54552515, "link": "https://stackoverflow.com/questions/54552515/c-remaining-bytes-on-af-unix-socket/54570172#54570172", "title": "C: Remaining bytes on AF_UNIX socket", "body": "<p>Ok, I solved my issue.\nAs written in the comment, this problem was due to the <strong>lack of a check on partial writing.</strong></p>\n\n<p>Now the function <code>readData()</code> looks like this:</p>\n\n<pre><code>int readData(long fd, message_data_t *data)\n{\n    if(data == NULL || fd &lt; 0) {errno = EINVAL; return -1;}\n\n    int test;\n    char* ph;\n    unsigned int rd = 0;\n    struct iovec iov;\n\n    iov.iov_base = &amp;(data-&gt;hdr);\n    iov.iov_len = sizeof(message_data_hdr_t);\n\n    test = readv(fd, &amp;iov, 1);\n    if(test &lt;= 0){return -1;}\n\n    if(data-&gt;hdr.len != 0)\n    {\n        data-&gt;buf = malloc(data-&gt;hdr.len);\n        if(data-&gt;buf == NULL){return -1;}\n\n        ph = data-&gt;buf;\n\n        while (rd &lt; data-&gt;hdr.len)\n        {\n            test = read(fd, ph, data-&gt;hdr.len - rd);\n            if(test ==  -1)\n                return -1;\n            else if(test == 0)\n            {\n                errno = ENOENT;\n                return -1;\n            }\n\n            rd += test;\n            ph += test;\n        }\n    }\n\n    return rd;\n}\n</code></pre>\n\n<p>and <code>sendData()</code>:</p>\n\n<pre><code>int sendData(long fd, message_data_t *msg)\n{\n    if(msg == NULL || fd &lt; 0) {errno = EINVAL; return -1;}\n\n    int test;\n    char* ph;\n    unsigned int wr = 0;\n    struct iovec iov;\n\n    iov.iov_base = &amp;(msg-&gt;hdr);\n    iov.iov_len = sizeof(message_data_hdr_t);\n\n    test = writev(fd, &amp;(iov), 1);\n    if(test == -1){return -1;}\n\n    if(msg-&gt;hdr.len != 0)\n    {\n        ph = msg-&gt;buf;\n\n        while (wr &lt; msg-&gt;hdr.len)\n        {\n            test = write(fd, ph, msg-&gt;hdr.len - wr);\n            if(test ==  -1)\n                return -1;\n            else if(test == 0)\n            {\n                errno = ENOENT;\n                return -1;\n            }\n\n            wr += test;\n            ph += test;\n        }\n    }\n\n    return test;\n}\n</code></pre>\n\n<p>In this way I no longer found the error.</p>\n\n<p>Thanks for the help!</p>\n"}], "owner": {"reputation": 148, "user_id": 7996173, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213304284022738/picture?type=large", "display_name": "Alessandro Meschi", "link": "https://stackoverflow.com/users/7996173/alessandro-meschi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 54570172, "answer_count": 1, "score": 0, "last_activity_date": 1549546484, "creation_date": 1549452268, "last_edit_date": 1549471725, "question_id": 54552515, "link": "https://stackoverflow.com/questions/54552515/c-remaining-bytes-on-af-unix-socket", "title": "C: Remaining bytes on AF_UNIX socket", "body": "<p>I got some problems with <code>AF_UNIX</code> socket communication because after writing a data buffer there seem to remain some hanging bytes to read that I do not know where they come from.</p>\n\n<p>I am writing a multithreaded server program in C that communicates with clients through <code>AF_UNIX</code> sockets, it must implement a simple chatroom. Among other things, the server must implement file transfers between clients and servers and i encountered  problems when i try to send a quite large file (269K) from Server to client. (With smaller files i do not have any problems)</p>\n\n<p>For file transfer i use <code>mmap()</code> function which return a pointer to the map of the file I want to send, then i use <code>write()</code> for write that data on socket linked with the client that must recieve the file.\nAfter <code>write()</code> call i check the returned value to be equal than the file size. (always verified)</p>\n\n<p>The client, after receiving the file, check the size of read data  (always verified) and start waiting for other messages so it call a blocking <code>read()</code>. <strong>This</strong> is the point where I found the error because the client reads something that should not be there, <strong>as if there was something left to read on the socket</strong>.\nI've been debugging this part (both server and client) for two days and I have not yet been able to understand the origin of the problem. </p>\n\n<p><strong>I am sure that no other thread write on the same socket at the same time</strong></p>\n\n<p>Does any of you have an idea of what the cause of this error is?</p>\n\n<p>I try to post some useful code thinking at a normal operation sequence:</p>\n\n<p>First of all message structure:</p>\n\n<pre><code>struct message_hdr\n{\n    op_t     op; \n    char sender[MAX_NAME_LENGTH+1];\n};\n\nstruct message_data_hdr{\n    char receiver[MAX_NAME_LENGTH+1];\n    unsigned int   len;\n};\n\nstruct message_data\n{\n    message_data_hdr_t hdr;\n    char *buf;\n};\n\nstruct message\n{\n    message_hdr_t  hdr;\n    message_data_t data;\n};\n</code></pre>\n\n<p>A server->client file transfer starts with server that send a <code>message_hdr_t</code> to a client which is waiting on a <code>read()</code> (the client expects to receive only a <code>message_hdr_t</code>).</p>\n\n<pre><code>int sendHeader(long fd, message_hdr_t* hdr)\n{\n    if(hdr == NULL || fd &lt; 0) {errno = EINVAL; return -1;}\n\n    int test;\n    struct iovec iov;\n\n    iov.iov_base = hdr;\n    iov.iov_len = sizeof(message_hdr_t);\n\n    test = writev(fd, &amp;iov, 1);\n\n    return  test;\n}\n</code></pre>\n\n<p>The client understands from the operation code (<code>message.hdr.op</code>) that it is a file type message and it begins to wait for file,   </p>\n\n<p>So server send it:</p>\n\n<pre><code>int sendData(long fd, message_data_t *msg)\n{\n    if(msg == NULL || fd &lt; 0) {errno = EINVAL; return -1;}\n\n    int test;\n    struct iovec iov;\n\n    iov.iov_base = &amp;(msg-&gt;hdr);\n    iov.iov_len = sizeof(message_data_hdr_t);\n\n    test = writev(fd, &amp;(iov), 1);\n    if(test == -1){return -1;}\n\n    if (msg-&gt;hdr.len != 0)\n    {\n        test = write(fd, msg-&gt;buf, msg-&gt;hdr.len);\n        if(test &lt;= 0)\n            return -1;\n    }\n\n    return test;\n}\n</code></pre>\n\n<p>And client read it:</p>\n\n<pre><code>int readData(long fd, message_data_t *data)\n{\n    if(data == NULL || fd &lt; 0) {errno = EINVAL; return -1;}\n\n    int test;\n    struct iovec iov;\n\n    iov.iov_base = &amp;(data-&gt;hdr);\n    iov.iov_len = sizeof(message_data_hdr_t);\n\n    test = readv(fd, &amp;iov, 1);\n    if(test &lt;= 0){return -1;}\n\n    if(data-&gt;hdr.len != 0)\n    {\n        data-&gt;buf = malloc(data-&gt;hdr.len);\n        if(data-&gt;buf == NULL){return -1;}\n\n        test = read(fd, data-&gt;buf, data-&gt;hdr.len);\n        if((unsigned int)test != data-&gt;hdr.len)\n            return -1;\n    }\n\n    return test;\n}\n</code></pre>\n\n<p>At this point the client recived file, and it restart waiting for new messages:</p>\n\n<pre><code>int readMsg(long fd, message_t *msg)\n{\n    if(msg == NULL || fd &lt; 0) {errno = EINVAL; return -1;}\n\n    int test;\n\n    test = readHeader(fd, &amp;(msg-&gt;hdr));\n    if(test == -1 || test == 0){return -1;}\n\n    test += readData(fd, &amp;(msg-&gt;data));\n    return test;\n}\n</code></pre>\n\n<p>This is the point where the client should simply wait because there is no income messages, insted in this case it read something that I do not know where it comes from.</p>\n\n<p>When i try to print this unwanted message with GDB  it prints:</p>\n\n<pre><code>{hdr = {op = 512, \n        sender = \"\\000\\000\\020G\\032\\324\\t\\000\\000\\n\\000\\000\\000\\000\\030\\021B\\bC\\n\\000\\000\\v\\000\\000\\000\\000\\021D\\v\\222\\000\"}, \n data = {hdr = {receiver = \"\\000\\000\\000\\000\\021E\\022C\\n\\000\\000\\b\\v\\000\\000\\000\\000\\021F\\020I\\n\\000\\000\\020\\000\\006\\b\\002\\n\\000\\000\\006\", \n         len = 131072}, \n buf = 0x7ffff7f2f010 \"\"}`\n</code></pre>\n\n<p>Of course this is meaningless.</p>\n\n<p>I hope that this description will be useful</p>\n\n<p>Thank you all in advance.</p>\n"}, {"tags": ["c", "linux-kernel", "pthreads", "userspace"], "comments": [{"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 1, "creation_date": 1549540921, "post_id": 54551770, "comment_id": 95943480, "body": "The &quot;test question&quot; is using incorrect terminology. The switch between kernel mode and user mode isn&#39;t technically called a context switch. It&#39;s called a mode switch. You can measure the overhead of a mode switch by benchmarking very minimal system calls. See this question: <a href=\"https://stackoverflow.com/questions/23599074/system-calls-overhead/41783404\" title=\"system calls overhead\">stackoverflow.com/questions/23599074/system-calls-overhead/&hellip;</a>"}, {"owner": {"reputation": 1161, "user_id": 1510212, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0390278206197c05063efc130f1725e3?s=128&d=identicon&r=PG", "display_name": "Yugo Amaryl", "link": "https://stackoverflow.com/users/1510212/yugo-amaryl"}, "edited": false, "score": 0, "creation_date": 1563007707, "post_id": 54551770, "comment_id": 100566218, "body": "What if your loop gets interrupted by another unrelated process? You risk taking into account the time spent into this other process, don&#39;t you?"}], "answers": [{"tags": [], "owner": {"reputation": 3561, "user_id": 1149797, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/cVBtb.png?s=128&g=1", "display_name": "Alex Hoppus", "link": "https://stackoverflow.com/users/1149797/alex-hoppus"}, "is_accepted": true, "score": 2, "last_activity_date": 1549540218, "creation_date": 1549540218, "answer_id": 54572732, "question_id": 54551770, "link": "https://stackoverflow.com/questions/54551770/measure-overhead-without-pthread-in-c/54572732#54572732", "title": "Measure overhead without pthread in C", "body": "<p>You should try different approach.</p>\n\n<p>As it was stated, you are trying to measure </p>\n\n<blockquote>\n  <p>overhead of a context switch >between the kernel and userspace</p>\n</blockquote>\n\n<p>Context switch from user to kernel is done via <code>syscall</code>. For sure printf underneath uses <code>write</code> syscall, but this syscall is too heavy to get reliable estimation. To improve this estimation you should answer to the question - what is the fastest syscall in linux? And the answer is - <a href=\"http://man7.org/linux/man-pages/man2/syscall.2.html\" rel=\"nofollow noreferrer\">syscall</a> with invalid parameter.</p>\n\n<p>P.S.\nDon't forget about measurement accuracy. Also you should divide your result by 2 because syscall is a round-trip.</p>\n"}, {"tags": [], "owner": {"reputation": 135, "user_id": 8612338, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155307921634270/picture?type=large", "display_name": "Charles Julien", "link": "https://stackoverflow.com/users/8612338/charles-julien"}, "is_accepted": false, "score": 0, "last_activity_date": 1551264720, "creation_date": 1551264720, "answer_id": 54903772, "question_id": 54551770, "link": "https://stackoverflow.com/questions/54551770/measure-overhead-without-pthread-in-c/54903772#54903772", "title": "Measure overhead without pthread in C", "body": "<p>Amazingly enough, the answer I provided above was accepted as correct in this test.</p>\n\n<p>However to optimize the accuracy, we should rule out the \"printf\" method and go for either a syscall with invalid parameter as mentioned by Alex Hoppus or an empty method.</p>\n\n<p>At the end, result should divided by 2 as mentioned by Alex Hoppus.</p>\n"}], "owner": {"reputation": 135, "user_id": 8612338, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155307921634270/picture?type=large", "display_name": "Charles Julien", "link": "https://stackoverflow.com/users/8612338/charles-julien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1859, "favorite_count": 1, "accepted_answer_id": 54572732, "answer_count": 2, "score": 2, "last_activity_date": 1551264720, "creation_date": 1549450041, "question_id": 54551770, "link": "https://stackoverflow.com/questions/54551770/measure-overhead-without-pthread-in-c", "title": "Measure overhead without pthread in C", "body": "<p>I would like to share a test question I met recently and discuss about it:</p>\n\n<blockquote>\n  <p>Write a C program that roughly measures the overhead of a context switch >between the kernel and userspace on a UNIX/Linux system (without using the >pthread API). Please indicate the assumptions your rough estimation is based >on.</p>\n</blockquote>\n\n<p>I would like to discuss with more advanced C programmers the different options of this problematic. </p>\n\n<p>I have limited knowledge in C programming and I documented myself to provide an acceptable answer:</p>\n\n<p><a href=\"https://eli.thegreenplace.net/2018/measuring-context-switching-and-memory-overheads-for-linux-threads/\" rel=\"nofollow noreferrer\">https://eli.thegreenplace.net/2018/measuring-context-switching-and-memory-overheads-for-linux-threads/</a></p>\n\n<p><a href=\"https://www.researchgate.net/post/How_can_I_measure_thread_creation_and_destruction\" rel=\"nofollow noreferrer\">https://www.researchgate.net/post/How_can_I_measure_thread_creation_and_destruction</a></p>\n\n<p><a href=\"https://github.com/eliben/code-for-blog/blob/master/2018/threadoverhead/thread-pipe-msgpersec.c\" rel=\"nofollow noreferrer\">https://github.com/eliben/code-for-blog/blob/master/2018/threadoverhead/thread-pipe-msgpersec.c</a></p>\n\n<p>I realized quickly, despite of my limited knowledge, the ambiguity of the question. Indeed, the question doesn't stipulate if an answer should be given in unit of time or memory. </p>\n\n<p>I personally chose to develop my reasoning measuring time with the library time.h and a very simple snippet. Result should be divided by 1 000 000.</p>\n\n<p>Does my answer make sense or am I completely missing the point ?</p>\n\n<pre><code>#include&lt;time.h&gt;\n#include&lt;stdio.h&gt;\nint main(){\n    clock_t begin=clock();\n\n    int i;\n    for(i=0;i&lt;1000000;i++){\n        printf(\"%d\",i);\n    }\n    clock_t end=clock();\n    printf(\"Time taken:%lf\",(double)(end-begin)/CLOCKS_PER_SEC);\n}\n</code></pre>\n"}, {"tags": ["c", "linux"], "comments": [{"owner": {"reputation": 137, "user_id": 9480266, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "lol lol", "link": "https://stackoverflow.com/users/9480266/lol-lol"}, "edited": false, "score": 0, "creation_date": 1551256941, "post_id": 54551685, "comment_id": 96569789, "body": "As I can see, this thread is dead. Can anyone give me advice about how to contact  Linux developers?"}], "answers": [{"tags": [], "owner": {"reputation": 137, "user_id": 9480266, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "lol lol", "link": "https://stackoverflow.com/users/9480266/lol-lol"}, "is_accepted": true, "score": 0, "last_activity_date": 1551342239, "creation_date": 1551342239, "answer_id": 54921234, "question_id": 54551685, "link": "https://stackoverflow.com/questions/54551685/how-to-allocate-ions-memory-of-predefined-heap-type/54921234#54921234", "title": "How to allocate ION&#39;s memory of predefined heap type?", "body": "<p>ION's driver contains ioctl's command \"ION_IOC_HEAP_QUERY\" argument which may be used to get information about heaps (name, type, id, etc.), enabled on concrete platform.\nExample of implementation was found on the following <a href=\"https://android.googlesource.com/platform/system/core/+/master/libion/ion.c\" rel=\"nofollow noreferrer\">link</a>:</p>\n\n<pre><code>int ion_query_heap_cnt(int fd, int* cnt) {\n    int ret;\n    struct ion_heap_query query;\n    memset(&amp;query, 0, sizeof(query));\n    ret = ion_ioctl(fd, ION_IOC_HEAP_QUERY, &amp;query);\n    if (ret &lt; 0) return ret;\n    *cnt = query.cnt;\n    return ret;\n}\n\nint ion_query_get_heaps(int fd, int cnt, void* buffers) {\n    int ret;\n    struct ion_heap_query query = {\n        .cnt = cnt, .heaps = (uintptr_t)buffers,\n    };\n    ret = ion_ioctl(fd, ION_IOC_HEAP_QUERY, &amp;query);\n    return ret;\n}\n</code></pre>\n\n<p>Example of use for this API is found <a href=\"https://android.googlesource.com/device/linaro/hikey/+/refs/heads/master/gralloc/alloc_device.cpp\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<pre><code>static int find_ion_heap_id(int ion_client, char* name)\n{\n    int i, ret, cnt, heap_id = -1;\n    struct ion_heap_data *data;\n    ret = ion_query_heap_cnt(ion_client, &amp;cnt);\n    if (ret)\n    {\n        AERR(\"ion count query failed with %s\", strerror(errno));\n        return -1;\n    }\n    data = (struct ion_heap_data *)malloc(cnt * sizeof(*data));\n    if (!data)\n    {\n        AERR(\"Error allocating data %s\\n\", strerror(errno));\n        return -1;\n    }\n    ret = ion_query_get_heaps(ion_client, cnt, data);\n    if (ret)\n    {\n        AERR(\"Error querying heaps from ion %s\", strerror(errno));\n    }\n    else\n    {\n        for (i = 0; i &lt; cnt; i++) {\n            struct ion_heap_data *dat = (struct ion_heap_data *)data;\n            if (strcmp(dat[i].name, name) == 0) {\n                heap_id = dat[i].heap_id;\n                break;\n            }\n        }\n        if (i &gt; cnt)\n        {\n            AERR(\"No System Heap Found amongst %d heaps\\n\", cnt);\n            heap_id = -1;\n        }\n    }\n    free(data);\n    return heap_id;\n}\n</code></pre>\n\n<p>That is how heap_id is obtained.\nTo get heap_mask we need to:</p>\n\n<pre><code>heap_mask = (1 &lt;&lt; heap_id);\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 9480266, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "lol lol", "link": "https://stackoverflow.com/users/9480266/lol-lol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 559, "favorite_count": 0, "accepted_answer_id": 54921234, "answer_count": 1, "score": 0, "last_activity_date": 1571330419, "creation_date": 1549449837, "last_edit_date": 1571330419, "question_id": 54551685, "link": "https://stackoverflow.com/questions/54551685/how-to-allocate-ions-memory-of-predefined-heap-type", "title": "How to allocate ION&#39;s memory of predefined heap type?", "body": "<p>I cannot find documentation about ION's allocator.\nI don't know how to allocate contiguous memory of the selected heap type using ion.</p>\n\n<p>I've tried to allocate memory using following code:</p>\n\n<pre><code>    struct ion_allocation_data arg_alloc;\n\n    arg_alloc.len = len;\n    arg_alloc.heap_mask = heap_mask;\n    arg_alloc.flags = flags;\n    arg_alloc.fd = 0;\n\n    ret = ioctl(client, ION_IOC_ALLOC_V1, &amp;arg_alloc);\n</code></pre>\n\n<p>I don't understand the logic, which value should be placed into <strong>heap_mask</strong> variable.</p>\n"}, {"tags": ["c", "time-complexity"], "comments": [{"owner": {"reputation": 363, "user_id": 4514393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PYwMM.png?s=128&g=1", "display_name": "jeevcat", "link": "https://stackoverflow.com/users/4514393/jeevcat"}, "edited": false, "score": 0, "creation_date": 1549447260, "post_id": 54550771, "comment_id": 95901694, "body": "You are simply looping through your array once. You should try to understand how time complexity works: <a href=\"https://stackoverflow.com/questions/11032015/how-to-find-time-complexity-of-an-algorithm\" title=\"how to find time complexity of an algorithm\">stackoverflow.com/questions/11032015/&hellip;</a>"}, {"owner": {"reputation": 705, "user_id": 8359764, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZZGPy.jpg?s=128&g=1", "display_name": "hat", "link": "https://stackoverflow.com/users/8359764/hat"}, "edited": false, "score": 0, "creation_date": 1549447305, "post_id": 54550771, "comment_id": 95901727, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/11032015/how-to-find-time-complexity-of-an-algorithm\">How to find time complexity of an algorithm</a>"}, {"owner": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "reply_to_user": {"reputation": 363, "user_id": 4514393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PYwMM.png?s=128&g=1", "display_name": "jeevcat", "link": "https://stackoverflow.com/users/4514393/jeevcat"}, "edited": false, "score": 0, "creation_date": 1549447351, "post_id": 54550771, "comment_id": 95901758, "body": "yes, but not just once- i reset the loop within the for loop @jeevcat"}], "answers": [{"comments": [{"owner": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "edited": false, "score": 0, "creation_date": 1549447313, "post_id": 54550813, "comment_id": 95901729, "body": "but I set it so it can restart the for loop within the loop"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "edited": false, "score": 0, "creation_date": 1549447391, "post_id": 54550813, "comment_id": 95901783, "body": "@H.cohen ah yes I didn&#39;t see, sorry"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "edited": false, "score": 0, "creation_date": 1549449938, "post_id": 54550813, "comment_id": 95903335, "body": "@H.cohen sorry but your algorithm does not work, I edited my answer"}, {"owner": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "edited": false, "score": 0, "creation_date": 1549450011, "post_id": 54550813, "comment_id": 95903375, "body": "the function is set for a sorted array. as I wrote twice in my Q :) @bruno"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "edited": false, "score": 1, "creation_date": 1549450053, "post_id": 54550813, "comment_id": 95903405, "body": "@H.cohen { 4, 6, 11, 12, 14, 19 } is a sorted array, but you do not find the solution for the sum 36"}, {"owner": {"reputation": 976, "user_id": 3565017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8ca9b87bfc80f0428240ea6b8c0b5be?s=128&d=identicon&r=PG&f=1", "display_name": "L.C.", "link": "https://stackoverflow.com/users/3565017/l-c"}, "edited": false, "score": 0, "creation_date": 1549450309, "post_id": 54550813, "comment_id": 95903555, "body": "Right, it does not work as expected... but still, the complexity is O(N^2) not O(N^3) unless I missed something."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 976, "user_id": 3565017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8ca9b87bfc80f0428240ea6b8c0b5be?s=128&d=identicon&r=PG&f=1", "display_name": "L.C.", "link": "https://stackoverflow.com/users/3565017/l-c"}, "edited": false, "score": 1, "creation_date": 1549450467, "post_id": 54550813, "comment_id": 95903663, "body": "@L.C. I agree with you. While that does not work it is better to directly return 0 with a complexity of O(1) ^^"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "edited": false, "score": 0, "creation_date": 1549450779, "post_id": 54550813, "comment_id": 95903885, "body": "@H.cohen unfortunately, the approach was interesting"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 0, "last_activity_date": 1549451576, "last_edit_date": 1549451576, "creation_date": 1549447153, "answer_id": 54550813, "question_id": 54550771, "link": "https://stackoverflow.com/questions/54550771/3sum-algorithm-complexity/54550813#54550813", "title": "3sum algorithm complexity", "body": "<p><s>You just go through the array, there is no nested loop of recursive call, so O(n)</s></p>\n\n<p>Ok now I read the context, yes is late ^^</p>\n\n<p>Or course the worst case is when the values are not sorted because you have to look at up all the values, so N^3. Here the array is sorted.</p>\n\n<p>But you only use a loop, and even you <em>restart it</em> it seemed magical ... too magical, sorry but that doesn't work, you do not find a solution with for instance the vector { 4, 6, 11, 12, 14, 19  } and the expected sum 36, but <code>6+11+19==36</code></p>\n\n<p>I do not answer about the complexity, L.C. does, but is the complexity relevant while the algorithm doesn't work ? Just do <code>return 0;</code> having the complexity O(1) ^^</p>\n\n<hr>\n\n<p>P.S. because I had a doubt I used the <em>brutal force</em> to check</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\n#include &lt;stdlib.h&gt;\n\n/* function to find if there are 3 values in the \nsorted array that sum up to a given sum */\nint IsSumOf3( int arr[], size_t size, int sum)\n{\n  int right, left, third;\n  right = size-1;\n  left = 0;\n  while(arr[right] &gt; sum &amp;&amp; right &gt; 1)\n  {\n      --right;\n  }\n  if(right == 1)\n  {\n      /*printf(\"returned false on right == 1 \\n\");*/\n      return 0;\n  }\n\n  for(third = left+1; third &lt; right; ++third)\n  {\n      int localSum = arr[right]+ arr[left]+ arr[third];\n      if(localSum == sum)\n      {\n      /*printf(\"right |%d|, left |%d|, third |%d|\\n\",arr[right], arr[left], arr[third]);*/\n          return 1;\n      }\n      if(localSum &gt; sum)\n      {\n         --right;\n         left = 0;\n         third = left;\n      }\n      if(third+1 == right)\n      {\n          ++left;\n          third = left;\n      }\n  }\n  /*printf(\"returned false on exit\\n\");*/\n  return 0;\n}\n\nint brutal(int arr[], size_t size, int sum)\n{\n  int i,j,k;\n\n  for (i = 0; i != size - 2; ++i) {\n    for (j = i+1; j != size -1; ++j) {\n      for (k = j+1; k != size; ++k) {\n        if ((arr[i] + arr[j] + arr[k]) == sum) {\n          /*printf(\"%d %d %d\\n\", arr[i], arr[j], arr[k]);*/\n          return 1;\n        }\n      }\n    }\n  }\n\n  return 0;\n}\n\nint main()\n{\n#define N 6\n\n  int a[N];\n\n  srand(time(NULL));\n\n  for (;;) {\n    int i;\n\n    a[0] = rand() % N;\n\n    for (i = 1; i != N; ++i) {\n      a[i] = a[i - 1] + (rand() % (N - 1)) + 1; /* suppose must not be equals */\n    }\n\n    for (i = a[N-1] + a[N-2] + a[N-3] + 1; i != 0; i -= 1) {\n      if (IsSumOf3(a, N, i) != brutal(a, N, i)) {\n        int j;\n\n        for (j = 0; j != N; j++)\n          printf(\"%d \", a[j]);\n        printf(\" / %d\\n\", i);\n        return 0;\n      }\n    }\n  }\n\n  return 0 ;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1549450889, "post_id": 54551679, "comment_id": 95903965, "body": "U.V. for answering about the complexity"}], "tags": [], "owner": {"reputation": 976, "user_id": 3565017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8ca9b87bfc80f0428240ea6b8c0b5be?s=128&d=identicon&r=PG&f=1", "display_name": "L.C.", "link": "https://stackoverflow.com/users/3565017/l-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1549466346, "last_edit_date": 1549466346, "creation_date": 1549449810, "answer_id": 54551679, "question_id": 54550771, "link": "https://stackoverflow.com/questions/54550771/3sum-algorithm-complexity/54551679#54551679", "title": "3sum algorithm complexity", "body": "<p>First, I suggest you comment your code: it would be easier for people here to help you. I also suggest you keep it simple: the first approach should be to build a list of the sum of 2 numbers where the sum is lower than the expected result, then try to find the third element for each value of the 2-values-sum list.</p>\n\n<p>Your algorithm runs through the array until it finds a valid result. At each iteration, if there's no valid result there's one value (left or right) that is not being considered anymore. \nIterations in the worst case for an array of N elements are: </p>\n\n<p>N + (N-1) + (N-2) ... + 2 + 1 = N * N/2</p>\n\n<p>Finally, the complexity is O(N^2).</p>\n\n<p>P.S.: notice that counting the case where left = right = third has no impact on the complexity, so to make the calculation easier I just kept it into consideration.</p>\n"}], "owner": {"reputation": 527, "user_id": 10488746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vTDhZ.jpg?s=128&g=1", "display_name": "H.cohen", "link": "https://stackoverflow.com/users/10488746/h-cohen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1549466346, "creation_date": 1549447002, "last_edit_date": 1549450312, "question_id": 54550771, "link": "https://stackoverflow.com/questions/54550771/3sum-algorithm-complexity", "title": "3sum algorithm complexity", "body": "<p>This code finds if in a sorted array there are three numbers that add up to a given sum, but I'm not sure how to calculate its time complexity. Would love your input and ideas on how to improve it as well. </p>\n\n<p><strong>Note</strong> that the <code>for</code> loop can reset itself within the loop.</p>\n\n<pre><code>/* function to find if there are 3 values in the \nsorted array that sum up to a given sum */\nint IsSumOf3( int arr[], size_t size, int sum)\n{\n  int right, left, third;\n  right = size-1;\n  left = 0;\n  while(arr[right] &gt; sum &amp;&amp; right &gt; 1)\n  {\n      --right;\n  }\n  if(right == 1)\n  {\n      printf(\"returned false on right == 1 \\n\");\n      return 0;\n  }\n\n  for(third = left+1; third &lt; right; ++third)\n  {\n      int localSum = arr[right]+ arr[left]+ arr[third];\n      if(localSum == sum)\n      {\n          printf(\"right |%d|, left |%d|, third |%d|\\n\",arr[right], arr[left], arr[third]);\n          return 1;\n      }\n      if(localSum &gt; sum)\n      {\n         --right;\n         left = 0;\n         third = left;\n      }\n      if(third+1 == right)\n      {\n          ++left;\n          third = left;\n      }\n  }\n  printf(\"returned false on exit\\n\");\n  return 0;\n}\n\nint main()\n{\n\n    int A[] = { 1, 4, 6, 8, 10, 46 };\n\n    IsSumOf3(A,6, 22);\n    IsSumOf3(A,6, 11);\n    IsSumOf3(A,6, 100);\n    IsSumOf3(A,6, 3);\n\n    return 0 ;\n}\n</code></pre>\n"}, {"tags": ["c", "operating-system", "system-calls", "pid", "waitpid"], "comments": [{"owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "edited": false, "score": 0, "creation_date": 1549446193, "post_id": 54550459, "comment_id": 95901099, "body": "Are you sure your exec() call succeed? Add a call to exit(1); just after, in the case it fails..."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1549446222, "post_id": 54550459, "comment_id": 95901120, "body": "First of all check what <code>waitpid</code> <i>returns</i>. And if it returns zero then check the value of <code>t2</code> to learn the exit code of the child process. And don&#39;t forget to check if <code>execvp</code> returns as well."}, {"owner": {"reputation": 303, "user_id": 8161586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rCkxw.jpg?s=128&g=1", "display_name": "Black Jack 21", "link": "https://stackoverflow.com/users/8161586/black-jack-21"}, "edited": false, "score": 0, "creation_date": 1549446583, "post_id": 54550459, "comment_id": 95901329, "body": "I tried doing as you both suggested. Control flow doesn&#39;t go below execvp and waitpid is returning -1."}, {"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 1, "creation_date": 1549447380, "post_id": 54550459, "comment_id": 95901777, "body": "If <code>waitpid()</code> is returning -1, you should print out <code>errno</code> to see why it&#39;s failing (<code>perror()</code> or <code>strerror()</code> can be used to get a human readable error message instead of a cryptic number)"}], "answers": [{"tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 3, "last_activity_date": 1549448935, "creation_date": 1549448935, "answer_id": 54551384, "question_id": 54550459, "link": "https://stackoverflow.com/questions/54550459/waitpid-acting-as-if-in-non-blocking-mode/54551384#54551384", "title": "Waitpid acting as if in non-blocking mode", "body": "<p>The problem is a race condition. After the fork here:</p>\n\n<pre><code>a = fork();\n</code></pre>\n\n<p>if the child runs first the process group <code>-a</code> is created here:</p>\n\n<pre><code>if(a==0){\n    setpgid(getpid(),getpid());\n</code></pre>\n\n<p>and the parent then waits here:</p>\n\n<pre><code>waitpid(-a,&amp;t2,0);\n</code></pre>\n\n<p>but if the <em>parent</em> gets to run first, the process group <code>-a</code> does <em>not</em> exist yet and the <code>waitpid()</code> fails with <code>ECHILD</code>. The second case obviously happens on your system.</p>\n\n<p>You will have to find some way to make sure, that the<code>setpgid()</code> call in the child runs <em>before</em> the <code>waitpid()</code> call in the parent. The complex way are semaphores, the easy (hacky) way is a short delay, <code>usleep(1)</code> before the <code>waitpid()</code> will probably suffice.</p>\n"}], "owner": {"reputation": 303, "user_id": 8161586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rCkxw.jpg?s=128&g=1", "display_name": "Black Jack 21", "link": "https://stackoverflow.com/users/8161586/black-jack-21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 54551384, "answer_count": 1, "score": 2, "last_activity_date": 1549448935, "creation_date": 1549445998, "last_edit_date": 1549446480, "question_id": 54550459, "link": "https://stackoverflow.com/questions/54550459/waitpid-acting-as-if-in-non-blocking-mode", "title": "Waitpid acting as if in non-blocking mode", "body": "<p>I am playing around with system calls in C and I am stuck trying to understand this program I made -</p>\n\n<pre><code>int main(int argc, char* argv[])\n{\nint a;\nchar *args[]={\"sleep\",\" 10\",NULL}; \n\na = fork();\nint stat;\n\n\nif(a==0){\n    setpgid(getpid(),getpid());\n    printf(\"%d\\n\",getpgid(getpid()));\n    execvp(args[0],args);}\nelse\n{\n    int t2;\n    waitpid(-a,&amp;t2,0);\n}\n\nprintf(\"Parent pid = %d\\n\", getpid()); \nprintf(\"Child pid = %d\\n\", a); \n\n}\n</code></pre>\n\n<p>According to my understanding, I have set pgid of child as its own pid. When I call <code>waitpid</code> with -a as argument, I am basically asking it to wait(blocking) till any process in pgid=a is finished. However, the output of the program is not what I expected! Child process isn't being reaped at all. It is as if waitpid is in non-blocking mode. Output:</p>\n\n<pre><code>Parent pid = 11372\nChild pid = 11373\n11373\n</code></pre>\n\n<p>(The output is instantaneous, it doesn't wait for 10 seconds!)</p>\n\n<p>EDIT : I added <code>printf(\"Here\")</code> and <code>exit(1)</code> below execvp and printed out waitpid's output as suggested in comments. Here doesn't get printed and waitpid prints -1</p>\n"}, {"tags": ["c", "embedded", "c-preprocessor", "preprocessor"], "comments": [{"owner": {"reputation": 985, "user_id": 626644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/636efe6157fdb5b79215b3995ac03bc5?s=128&d=identicon&r=PG", "display_name": "Simon F", "link": "https://stackoverflow.com/users/626644/simon-f"}, "edited": false, "score": 0, "creation_date": 1549445186, "post_id": 54550103, "comment_id": 95900527, "body": "&quot;##&quot; is the token concatenation feature of the C preprocessor: <a href=\"https://en.wikipedia.org/wiki/C_preprocessor#Token_concatenation\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/C_preprocessor#Token_concatenation</a>"}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 1, "creation_date": 1549445777, "post_id": 54550103, "comment_id": 95900875, "body": "<i>I didn&#39;t know that we can use union and structures within #define statements. How are they interpreted by the compiler?</i> \u2013 you can use whatever text you want in a praeprocessor symbol definition. All the preaprocessor does is (quite) stupid text replacement."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549449182, "post_id": 54550103, "comment_id": 95902915, "body": "@Swordfish: Macro substitution replaces preprocessor tokens, not text, except for the # and ## operators."}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1549449384, "post_id": 54550103, "comment_id": 95903046, "body": "@EricPostpischil All preprocessor tokens i&#39;ve seen so far were text ^^"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549449655, "post_id": 54550103, "comment_id": 95903198, "body": "@Swordfish: If macro replacement substituted text, then <code>X-4</code> in a macro could become the floating-point literal <code>3e-4</code>. It cannot. Token  replacement cannot form new tokens. The initial lexical analysis has already be performed and is not repeated."}], "answers": [{"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": false, "score": 2, "last_activity_date": 1549446080, "last_edit_date": 1592644375, "creation_date": 1549445766, "answer_id": 54550398, "question_id": 54550103, "link": "https://stackoverflow.com/questions/54550103/how-can-we-use-unions-and-structure-within-a-define-statement/54550398#54550398", "title": "How can we use unions and structure within a #define statement", "body": "<ol>\n<li><p>You can put most things inside macros, they are mostly just text replacement (though on a token by token level). Putting typedefs and variable declarations inside macros is however bad practice and should be avoided unless there's no other option.</p>\n</li>\n<li><p>It pastes the token past and creates a new pre-processor token. In this case it creates member variable names. If you use <code>DEFA(foo,0)</code> you will get members named <code>foo_H</code> and <code>foo_L</code>.</p>\n<p>Notably, this particular macro would probably have been better if the fields were just named H and L. Why would anyone want to type <code>reg.foo_H</code> rather than <code>foo.H</code>?  Using <code>_L</code> versus <code>L</code> postfix to distinguish between 8 and 16 bit access is not a very bright idea either.</p>\n</li>\n<li><p>Some custom type used by the same code. Why they have a union between something called &quot;20 bit&quot; and 32 bit structs, I have no idea.</p>\n</li>\n<li><p>A non-standard extension. Usually it is used for allocation of a variable at a specific address, which is the case here. Probably you have a memory-mapped hardware register and this macro is supposed to be a generic declaration for such registers.</p>\n</li>\n</ol>\n<p>Also notable, the union syntax isn't standard C. You need to name the union. The anonymous structs are standard C since C11, but I doubt this is from a modern compiler.</p>\n<p>Overall, very bad code. A very typical kind of trash code you find in microcontroller register maps delivered by silicon/tool vendors. Not compliant with ISO C nor MISRA-C.</p>\n"}, {"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1549446284, "post_id": 54550520, "comment_id": 95901152, "body": "4 is quite relevant as this is a hardware register definition taken from a register memory map. Without it the macro would fill no purpose."}, {"owner": {"reputation": 1, "user_id": 10461662, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KOqHn.gif?s=128&g=1", "display_name": "dhiru", "link": "https://stackoverflow.com/users/10461662/dhiru"}, "edited": false, "score": 0, "creation_date": 1549474192, "post_id": 54550520, "comment_id": 95918179, "body": "So, this is what i infer, correct me if i am wrong... The whole UNION takes up 4 bytes, myName_L points to the 0-7 bits, myName_H points to the 8-15 bits, myNameL points to the 0-15 bits, myNameH points to the 16-31 bits, and the myName points to the 0-19 bits.., and the myAddress is the address of the 0th bit ?"}], "tags": [], "owner": {"reputation": 429, "user_id": 10209003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8d9d1dd420c5e9381d2978720c47940?s=128&d=identicon&r=PG&f=1", "display_name": "Korni", "link": "https://stackoverflow.com/users/10209003/korni"}, "is_accepted": false, "score": 0, "last_activity_date": 1549446342, "last_edit_date": 1549446342, "creation_date": 1549446186, "answer_id": 54550520, "question_id": 54550103, "link": "https://stackoverflow.com/questions/54550103/how-can-we-use-unions-and-structure-within-a-define-statement/54550520#54550520", "title": "How can we use unions and structure within a #define statement", "body": "<p>I think the best way to explain this piece of code is by trying an example:\nSo what results from the define <code>DEFA(name, address)</code>? </p>\n\n<p>Using the define like e.g. <code>DEFA(myName, myAddress)</code> the preprocessor creates these lines of code:</p>\n\n<pre><code>__no_init union\n{\n  struct\n  {\n    volatile unsigned char  myName_L;\n    volatile unsigned char  myName_H;\n  };\n  struct\n  {\n    volatile unsigned short myNameL;\n    volatile unsigned short myNameH;\n  };\n  __ACCESS_20BIT_REG__ myName;\n} @ myAddress;\n</code></pre>\n\n<p>So now to your questions:</p>\n\n<ol>\n<li>Interpreted as shown</li>\n<li>This is called token concatenation, is concates the given token to to an marco variable<a href=\"https://en.wikipedia.org/wiki/C_preprocessor#Token_concatenation\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/C_preprocessor#Token_concatenation</a></li>\n<li><strong>ACCESS_20BIT_REG</strong> is probably a 20bit long data type marcro whick is defined somewhere else</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "is_accepted": false, "score": 1, "last_activity_date": 1549446386, "creation_date": 1549446386, "answer_id": 54550575, "question_id": 54550103, "link": "https://stackoverflow.com/questions/54550103/how-can-we-use-unions-and-structure-within-a-define-statement/54550575#54550575", "title": "How can we use unions and structure within a #define statement", "body": "<blockquote>\n  <ol>\n  <li>I didn't know that we can use union and structures within #define statements. How are they interpreted by the compiler?</li>\n  </ol>\n</blockquote>\n\n<p>Define statements are just macros. They are NOT interpreted by the compiler but by the preprocessor. That bit of code that is defined inside the macro is just copy-pasted everywhere, where you call/use that macro. If it contains valid C/C++ code, then it will compile in the next step also, once the preprocessor is done.</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>What does \"name##_L\" and \"name##L\" mean.?, especially \"##\".</li>\n  </ol>\n</blockquote>\n\n<p>Yes, I was surprised by this <code>##</code> once upon a time also. It is token concatenation. Basically, you can generate 'programmatically' variable/function names using it. So for example, you have, </p>\n\n<pre><code>#include &lt;stdio.h&gt; \n#define concat(a, b) a##b \nint main(void) \n{ \n    int foobar = 1; \n    printf(\"%d\", concat(foo, bar)); \n    return 0; \n} \n</code></pre>\n\n<p>would print <code>1</code>, as it <strong>concatenates</strong> <code>foo</code> and <code>bar</code> together to form <code>foobar</code>.</p>\n\n<blockquote>\n  <ol start=\"3\">\n  <li>What is \"<code>__ACCESS_20BIT_REG__ name</code>\"?</li>\n  </ol>\n</blockquote>\n\n<p><code>__ACCESS_20BIT_REG__</code> seems to be an <em>implementation-defined</em> macro defined probably somewhere else in the code. The <code>__</code> double underscore followed by a capital are reserved for implementation (so that they can be used for example by your uC manufacturer).</p>\n\n<blockquote>\n  <ol start=\"4\">\n  <li>What is this new \"@\" symbol, I googled to find out about this symbol, and i find nothing related to the @ symbol anywhere, some people say that this is not C standard, is this true?, and what does it mean?</li>\n  </ol>\n</blockquote>\n\n<p>This one has me stumped also. I don't think this is legal C.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Actually, regarding your point 4 i.e. the <code>@</code> synmbol, I googled some more and found this <a href=\"https://stackoverflow.com/questions/24114365/does-at-symbol-and-dollar-sign-has-any-special-meaning-in-c-or-c\">stackoverflow question</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 10461662, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KOqHn.gif?s=128&g=1", "display_name": "dhiru", "link": "https://stackoverflow.com/users/10461662/dhiru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1549446386, "creation_date": 1549444665, "question_id": 54550103, "link": "https://stackoverflow.com/questions/54550103/how-can-we-use-unions-and-structure-within-a-define-statement", "title": "How can we use unions and structure within a #define statement", "body": "<p>I was going through a header file of a micro-controller, when i found this,</p>\n\n<pre><code> #define DEFA(name, address) __no_init union \\\n{ \\\n  struct \\\n  { \\\n    volatile unsigned char  name##_L; \\\n    volatile unsigned char  name##_H; \\\n  }; \\\n  struct \\\n  { \\\n    volatile unsigned short name##L; \\\n    volatile unsigned short name##H; \\\n  }; \\\n  __ACCESS_20BIT_REG__ name; \\\n} @ address;\n</code></pre>\n\n<p>I have multiple questions here,</p>\n\n<ol>\n<li>I didn't know that we can use union and structures within #define statements. How are they interpreted by the compiler?</li>\n<li>What does \"name##_L\" and \"name##L\" mean.?, especially \"##\".</li>\n<li>What is \"__ACCESS_20BIT_REG__ name\"?</li>\n<li>What is this new \"@\" symbol, I googled to find out about this symbol, and i find nothing related to the @ symbol anywhere, some people say that this is not C standard, is this true?, and what does it mean?</li>\n</ol>\n\n<p>Someone, please explain me this peace of code, everything depends on this piece of the code, and everything either directly or indirectly uses this #define. :(</p>\n"}, {"tags": ["c", "fft", "complex-numbers", "fftw", "symmetry"], "comments": [{"owner": {"reputation": 8727, "user_id": 2999346, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dQ1wB.png?s=128&g=1", "display_name": "francis", "link": "https://stackoverflow.com/users/2999346/francis"}, "edited": false, "score": 0, "creation_date": 1549484618, "post_id": 54550015, "comment_id": 95922839, "body": "To easily retrieve a result comparable to that of <code>fftw_plan_dft_r2c_2d()</code>, you can chain a call to <code>fftw_plan_dft_r2c_1d()</code> and a call to the complex-to-complex dft <code>fftw_plan_many_dft()</code>. The arguments <code>howmany</code> and <code>istride</code> can easily be tunned to match the pattern of the output of <code>fftw_plan_dft_r2c_1d()</code>. Contrary to <code>fftw_plan_dft_r2c_1d()</code>, the r2r_1d(...FFTW_HR2C...) separates the real and complex component of each frequency. A second <code>FFTW_HR2C</code> can be applied and would be comparable to <code>fftw_plan_dft_r2c_2d()</code> but not exactly similar."}, {"owner": {"reputation": 8727, "user_id": 2999346, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dQ1wB.png?s=128&g=1", "display_name": "francis", "link": "https://stackoverflow.com/users/2999346/francis"}, "edited": false, "score": 0, "creation_date": 1549485393, "post_id": 54550015, "comment_id": 95923185, "body": "As quoted on the page 11 of the documentation that you judiciously linked, &quot; Half of these column transforms,  however,  are of imaginary parts,  and should therefore be multiplied by i and combined with the r2hc transforms of the real columns to produce the 2d DFT amplitudes; ...  Thus, ... we recommend using the ordinary r2c/c2r interface&quot;. Since you have an array of complex numbers, you can either use c2r transforms or unfold real/imaginary parts and try to use HC2R transforms. The former option seems the most practical.Which one might solve your issue?"}, {"owner": {"reputation": 95, "user_id": 10690976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1384aef1f5092ac01b3511b16a9e9524?s=128&d=identicon&r=PG&f=1", "display_name": "Mirco", "link": "https://stackoverflow.com/users/10690976/mirco"}, "reply_to_user": {"reputation": 8727, "user_id": 2999346, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dQ1wB.png?s=128&g=1", "display_name": "francis", "link": "https://stackoverflow.com/users/2999346/francis"}, "edited": false, "score": 0, "creation_date": 1549530267, "post_id": 54550015, "comment_id": 95937193, "body": "Thank you @francis for your careful explanation. I think I will use the former option as you suggested"}], "answers": [{"tags": [], "owner": {"reputation": 722, "user_id": 8049790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3927a57c023479b1d1edad79125dbf4e?s=128&d=identicon&r=PG&f=1", "display_name": "ejderuby", "link": "https://stackoverflow.com/users/8049790/ejderuby"}, "is_accepted": true, "score": 0, "last_activity_date": 1566587198, "last_edit_date": 1592644375, "creation_date": 1566587198, "answer_id": 57631768, "question_id": 54550015, "link": "https://stackoverflow.com/questions/54550015/should-i-use-halfcomplex2real-or-complex2complex/57631768#57631768", "title": "Should I use Halfcomplex2Real or Complex2Complex", "body": "<blockquote>\n<p>&quot;To easily retrieve a result comparable to that of <code>fftw_plan_dft_r2c_2d()</code>, you can chain a call to <code>fftw_plan_dft_r2c_1d()</code> and a call to the complex-to-complex dft <code>fftw_plan_many_dft()</code>. The arguments <code>howmany</code> and <code>istride</code> can easily be tuned to match the pattern of the output of <code>fftw_plan_dft_r2c_1d()</code>. Contrary to <code>fftw_plan_dft_r2c_1d()</code>, the r2r_1d(...FFTW_HR2C...) separates the real and complex component of each frequency. A second <code>FFTW_HR2C</code> can be applied and would be comparable to <code>fftw_plan_dft_r2c_2d()</code> but not exactly similar.</p>\n<p>As quoted on the page 11 of the documentation that you judiciously linked,</p>\n<blockquote>\n<p>'Half of these column transforms, however, are of imaginary parts, and should therefore be multiplied by I and combined with the r2hc transforms of the real columns to produce the 2d DFT amplitudes; ... Thus, ... we recommend using the ordinary r2c/c2r interface.'</p>\n</blockquote>\n<p>Since you have an array of complex numbers, you can either use c2r transforms or unfold real/imaginary parts and try to use HC2R transforms. The former option seems the most practical.Which one might solve your issue?&quot;</p>\n</blockquote>\n<p>-@Francis</p>\n"}], "owner": {"reputation": 95, "user_id": 10690976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1384aef1f5092ac01b3511b16a9e9524?s=128&d=identicon&r=PG&f=1", "display_name": "Mirco", "link": "https://stackoverflow.com/users/10690976/mirco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 1, "accepted_answer_id": 57631768, "answer_count": 1, "score": 2, "last_activity_date": 1566587198, "creation_date": 1549444282, "question_id": 54550015, "link": "https://stackoverflow.com/questions/54550015/should-i-use-halfcomplex2real-or-complex2complex", "title": "Should I use Halfcomplex2Real or Complex2Complex", "body": "<p>Good morning, I'm trying to perform a <code>2D FFT</code> as 2 <code>1-Dimensional FFT</code>.</p>\n\n<p>The problem setup is the following:</p>\n\n<p>There's a matrix of complex numbers generated by an <code>inverse FFT</code> on an <strong>array of real numbers</strong>, lets call it <code>arr[-nx..+nx][-nz..+nz]</code>.</p>\n\n<p>Now, since the original array was made up of real numbers, I exploit the symmetry and reduce my array to be <code>arr[0..nx][-nz..+nz]</code>.</p>\n\n<p>My problem starts here, with <code>arr[0..nx][-nz..nz]</code> provided.\nNow I should come back in the domain of real numbers. \nThe question is what kind of transformation I should use in the 2 directions?</p>\n\n<p>In <code>x</code> I use the <code>fftw_plan_r2r_1d( .., .., .., FFTW_HC2R, ..)</code>, called <code>Half complex to Real</code> transformation because in that direction I've exploited the symmetry, and that's ok I think.\nBut in <code>z</code> direction I can't figure out if I should use the same transformation or, the <code>Complex to complex (C2C)</code> transformation?\nWhat is the correct once and why?</p>\n\n<p>In case of needing <a href=\"http://www.fftw.org/fftw3.pdf\" rel=\"nofollow noreferrer\">here</a>, at page 11, the HC2R transformation is briefly described</p>\n\n<p>Thank you</p>\n"}, {"tags": ["c", "linux", "posix", "aio"], "comments": [{"owner": {"reputation": 2626, "user_id": 300290, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wI1od.png?s=128&g=1", "display_name": "Mike Andrews", "link": "https://stackoverflow.com/users/300290/mike-andrews"}, "edited": false, "score": 0, "creation_date": 1549493921, "post_id": 54549922, "comment_id": 95926563, "body": "None of these APIs guarantee that writes will complete in the order you submit them. If the data you&#39;re writing is overlapping somehow, then you need to do your own serialization - avoid issuing writes for overlapping sections until the prior writes complete.  If you&#39;re not doing overlapping writes, it doesn&#39;t matter what order they complete in, so long as they all complete."}, {"owner": {"reputation": 8223, "user_id": 805579, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/0d2eb3294e0905aa3c750998db351ddc?s=128&d=identicon&r=PG", "display_name": "Niall Douglas", "link": "https://stackoverflow.com/users/805579/niall-douglas"}, "edited": false, "score": 0, "creation_date": 1549527572, "post_id": 54549922, "comment_id": 95935813, "body": "Firstly I have no idea why you would use async I/o here. On Linux and FreeBSD it&#39;s just a threadpool around the synchronous API which you can implement yourself more efficiently. Secondly writes are only serialised to reads on the same open file descriptor. If you want ordering between disparate file descriptors, you need to use fnctl() to lock byte ranges to coordinate readers and writers, or use some other IPC mechanism."}, {"owner": {"reputation": 73, "user_id": 10921015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4f930784d7988313922bf7fad4c2583?s=128&d=identicon&r=PG&f=1", "display_name": "Resist", "link": "https://stackoverflow.com/users/10921015/resist"}, "edited": false, "score": 0, "creation_date": 1549615999, "post_id": 54549922, "comment_id": 95973866, "body": "I&#39;m writing on same file discriptor and my reading file is different with writing file. In addition as you can see I have assigned offset in each operation according to previous operation (aiocb_element[write_count].aio_offset = pre_nbytes + pre_offset;) so there is no overlapping and I don&#39;t know why it generates a corrupted output file?!!!"}], "owner": {"reputation": 73, "user_id": 10921015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4f930784d7988313922bf7fad4c2583?s=128&d=identicon&r=PG&f=1", "display_name": "Resist", "link": "https://stackoverflow.com/users/10921015/resist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1549454346, "creation_date": 1549443955, "last_edit_date": 1549454346, "question_id": 54549922, "link": "https://stackoverflow.com/questions/54549922/aio-write-and-lio-listio-of-posix-aio-dont-work-correctly-in-write-operatio", "title": "aio_write() and lio_listio() of POSIX AIO don&#39;t work correctly in write operation", "body": "<p>I'm setting up a asynchronized writer and want operation order on file be guaranteed by that. I use it as writer in another program which read a pcap file. Consider I have already tried to use both linux-aio and POSIX aio in my code seperately, to write pcap file on disk. I need to know are aio_write() and lio_listio() of POSIX AIO guaranteed to be executed in order?</p>\n\n<p>In linux-aio I use iocb structure to represent a single request for write operation. After fixed number of single operation, io_getevents blocks until fixed number completion report.</p>\n\n<pre><code>struct iocb io_cb;\nmemset(&amp;io_cb, 0, sizeof(io_cb));\nio_cb.aio_fildes = file_descriptor;\nio_cb.aio_lio_opcode = IOCB_CMD_PWRITE;\nio_cb.aio_reqprio = 0;\nio_cb.aio_buf = (__u64)(buffer);\nio_cb.aio_nbytes = size;\nio_cb.aio_offset = 0;\nstruct iocb* io_cb_pointer = &amp;io_cb;\nstatic int32_t BLOCKS_COUNT = 1;\nsyscall(SYS_io_submit, io_context, BLOCKS_COUNT, &amp;io_cb_pointer) \nwrite_count++;\n if ((write_count == MAX_EVENT_COUNT) || flush == true)//flush is to flush before exit program.\n    {\n        struct io_event* events = (struct io_event *)malloc((write_count) * sizeof(struct io_event));\n        syscall(SYS_io_getevents, io_context, write_count / 2, MAX_EVENT_COUNT, events, NULL)\n    }\n</code></pre>\n\n<p>above piece of code which is writing responsible results in proper pcap output that can be opened by Wireshark.</p>\n\n<p>But my problem is with POSIX aio which seem doesn't guarantee order of operation in execution. The piece of writing code is demonstrated in below:</p>\n\n<pre><code>    aiocb_array = calloc(MAX_EVENT_COUNT, sizeof (struct aiocb*));\n    aiocb_element = calloc(MAX_EVENT_COUNT, sizeof (struct aiocb));\n...\n    struct aiocb** aiocb_array;\n    struct aiocb* aiocb_element;\n...\n    static size_t pre_nbytes = 0;\n    static __off_t pre_offset = 24;//Due to pcap header file length\n    aiocb_element[write_count].aio_fildes = file_descriptor;\n    aiocb_element[write_count].aio_lio_opcode = LIO_WRITE;\n    aiocb_element[write_count].aio_reqprio = 0;\n    aiocb_element[write_count].aio_buf = (void *)(buffer);\n    aiocb_element[write_count].aio_nbytes = size;\n    aiocb_element[write_count].aio_offset = pre_nbytes + pre_offset;\n\n    pre_nbytes = size;\n    pre_offset = aiocb_element[write_count].aio_offset;\n\n    aiocb_array[write_count] = &amp;aiocb_element[write_count];\n    write_count++;\n        if ((write_count == MAX_EVENT_COUNT) || flush == true )//flush is to flush before exit program.\n    {\n        if(flush)\n        {\n            if(lio_listio(LIO_WAIT, aiocb_array, write_count, NULL) != 0)\n            {\n                 printf(\"Flush lio_listio errno :%d\\n\", errno);\n                 input-&gt;error_code = errno;\n                 return false;\n            }\n        }\n        else\n        {\n            if(lio_listio(LIO_NOWAIT, aiocb_array, write_count, NULL) != 0)\n            {\n                 printf(\"lio_listio errno :%d\\n\", errno);\n                 input-&gt;error_code = errno;\n                 return false;\n            }\n        }\n\n        if(write_count == MAX_EVENT_COUNT)\n            write_count = 0;\n    }\n</code></pre>\n\n<p>As clear in above code, I prepare write request in aiocb structure and assign it's offset, because the file that is used to write was opened without append mode. the piece of code generates pcap file that has same byte like input pcap but unfortunately Wireshark can't open it and show error that indicate:\"The capture file appears to be damaged or corrupt. (pcap: File has .......-byte packet, bigger than maximum 0f 65535)\". But when I call lio_listio with LIO_WAIT mode and set MAX_EVENT_COUNT = 1, it generates proper pcap output that can be opened by Wireshark correctly.</p>\n\n<p>In addition when I replace lio_listio with aio_write function of POSIX, it produces corrupted file again.\nAccording to mentioned condition which results in proper output pcap, it seems that lio_listio and aio_write function of POSIX execution order are different with program submit order!!!\nDoes it carried out the operations in arbitrary order? if the answer is yes why it ignore offset value and proper output are not generated? why linux-aio guarantee and keep operation order?\nif the answer is no so what is my code and logic problem?</p>\n\n<p>Any help will be appreciated.</p>\n"}, {"tags": ["c", "macros"], "comments": [{"owner": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "edited": false, "score": 1, "creation_date": 1549443780, "post_id": 54549811, "comment_id": 95899754, "body": "<a href=\"http://coliru.stacked-crooked.com/a/a5513206927214ff\" rel=\"nofollow noreferrer\">Works for me</a>. Can you detail how it &quot;does not work properly?&quot;"}, {"owner": {"reputation": 551, "user_id": 980336, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bb2ca3cbbaf70c4cd09da29a75c2567a?s=128&d=identicon&r=PG", "display_name": "qmor", "link": "https://stackoverflow.com/users/980336/qmor"}, "reply_to_user": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "edited": false, "score": 0, "creation_date": 1549444474, "post_id": 54549811, "comment_id": 95900117, "body": "stri = 0x420d000100010001 &lt;Error reading characters of string.&gt;  Forget to mention, i&#39;m using msvc12. You example of usage looks exactly what i need"}, {"owner": {"reputation": 551, "user_id": 980336, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bb2ca3cbbaf70c4cd09da29a75c2567a?s=128&d=identicon&r=PG", "display_name": "qmor", "link": "https://stackoverflow.com/users/980336/qmor"}, "reply_to_user": {"reputation": 156300, "user_id": 1782465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b45d92faaf9d122bfed585490e0bafc5?s=128&d=identicon&r=PG", "display_name": "Angew is no longer proud of SO", "link": "https://stackoverflow.com/users/1782465/angew-is-no-longer-proud-of-so"}, "edited": false, "score": 0, "creation_date": 1549444645, "post_id": 54549811, "comment_id": 95900222, "body": "with #define TRACE(s) #s, s i&#39; calling AOCS_TRACE function with args 3, TRACE(FOOBAR),1,2)  and in debugger i see that first argument is correct and all other args looks like garbage"}, {"owner": {"reputation": 13762, "user_id": 694733, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/0a3de8cd40d9ffb86cc1fed0c8cf2e19?s=128&d=identicon&r=PG", "display_name": "user694733", "link": "https://stackoverflow.com/users/694733/user694733"}, "edited": false, "score": 0, "creation_date": 1549449336, "post_id": 54549811, "comment_id": 95903019, "body": "Please don&#39;t put relevant information in comments where it&#39;s hard to read. <a href=\"https://stackoverflow.com/posts/54549811/edit\">Edit</a> your question and add information there where it can be nicely formatted."}], "answers": [{"comments": [{"owner": {"reputation": 551, "user_id": 980336, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bb2ca3cbbaf70c4cd09da29a75c2567a?s=128&d=identicon&r=PG", "display_name": "qmor", "link": "https://stackoverflow.com/users/980336/qmor"}, "edited": false, "score": 0, "creation_date": 1549445031, "post_id": 54550183, "comment_id": 95900440, "body": "Thanks everyone. Don&#39;t know why itis doesnot works for me now. Will debug it."}], "tags": [], "owner": {"reputation": 896, "user_id": 6659361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/200d3e89398030d70445b9a3f071c385?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime B.", "link": "https://stackoverflow.com/users/6659361/maxime-b"}, "is_accepted": false, "score": 0, "last_activity_date": 1549445185, "last_edit_date": 1549445185, "creation_date": 1549444928, "answer_id": 54550183, "question_id": 54549811, "link": "https://stackoverflow.com/questions/54549811/c-macro-duplicate-arguments/54550183#54550183", "title": "c macro duplicate arguments", "body": "<p>Your macro is working fine.</p>\n\n<p>Example code to show how:</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n#define macro(s) #s,s\nconst int TRACE_qtn_guidance_TCOUNT0_VALUE= 123;\nvoid AO_TRACE(int level, char *macrostring, uint16_t type, uint32_t argument1, uint16_t argument2) {\n  printf(\"Level: %d, String: &lt;%s&gt;, Type: %d: Arg1: %d, Arg2: %d\\n\", level, macrostring, type, argument1, argument2);}\nint main(){\n  AO_TRACE(1, macro(TRACE_qtn_guidance_TCOUNT0_VALUE), 2, 3);\n  return 0;\n}\n\n</code></pre>\n\n<p>Outputs as expected</p>\n\n<pre><code>Level: 1, String: &lt;TRACE_qtn_guidance_TCOUNT0_VALUE&gt;, Type: 123: Arg1: 2, Arg2: 3\n</code></pre>\n"}], "owner": {"reputation": 551, "user_id": 980336, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bb2ca3cbbaf70c4cd09da29a75c2567a?s=128&d=identicon&r=PG", "display_name": "qmor", "link": "https://stackoverflow.com/users/980336/qmor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549445185, "creation_date": 1549443527, "question_id": 54549811, "link": "https://stackoverflow.com/questions/54549811/c-macro-duplicate-arguments", "title": "c macro duplicate arguments", "body": "<p>I'm writing a tracer with function signature:</p>\n\n<pre><code>void AO_TRACE(int level, char *macrostring, uint16_t type, uint32_t argument1, uint16_t argument2);\n</code></pre>\n\n<p>and have useful macro for make string from macro</p>\n\n<pre><code>#define strmacro(s) #s\n</code></pre>\n\n<p>i'm calling my function like that:</p>\n\n<pre><code>AOCS_TRACE(LEVEL_TRACE,strmacro(TRACE_qtn_guidance_TCOUNT0_VALUE), TRACE_qtn_guidance_TCOUNT0_VALUE, tcount[0],0);\n</code></pre>\n\n<p>is it possible to write a macro to call function like that</p>\n\n<pre><code>AOCS_TRACE(LEVEL_TRACE,newmacro(TRACE_qtn_guidance_TCOUNT0_VALUE), tcount[0],0);\n</code></pre>\n\n<p>in other words write a macro which just placing a string representation of input and input itself. I've tried:</p>\n\n<pre><code>#define TRACE(s) #s, s\n</code></pre>\n\n<p>and</p>\n\n<pre><code>#define TRACE(s) (#s, s)\n</code></pre>\n\n<p>but it's doesnot work propertly</p>\n"}, {"tags": ["c++", "c", "lua", "swig"], "comments": [{"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1549498312, "post_id": 54549499, "comment_id": 95927814, "body": "<code>SWIG_ConvertPtr</code>"}, {"owner": {"reputation": 101, "user_id": 7714745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cac797b9ba4e425c44034ba97c3e856?s=128&d=identicon&r=PG&f=1", "display_name": "Mahashi", "link": "https://stackoverflow.com/users/7714745/mahashi"}, "reply_to_user": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1549527801, "post_id": 54549499, "comment_id": 95935928, "body": "@HenriMenke Like I&#39;ve said, I&#39;m not trying to do it from within Swig, so I don&#39;t have any SWIG_ConvertPtr functionality."}, {"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1549528551, "post_id": 54549499, "comment_id": 95936306, "body": "Then I wish you good luck trying to extract the definition of <a href=\"https://github.com/swig/swig/blob/df86ec5af6985fc1ada3945237dcf34113db6512/Lib/lua/luarun.swg#L1762-L1796\" rel=\"nofollow noreferrer\"><code>SWIG_Lua_ConvertPtr</code> from the SWIG source</a>."}, {"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1549528641, "post_id": 54549499, "comment_id": 95936351, "body": "\u201cI&#39;d like to do it properly\u201d By not doing it from within SWIG you have already abandoned this goal."}, {"owner": {"reputation": 101, "user_id": 7714745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cac797b9ba4e425c44034ba97c3e856?s=128&d=identicon&r=PG&f=1", "display_name": "Mahashi", "link": "https://stackoverflow.com/users/7714745/mahashi"}, "reply_to_user": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 0, "creation_date": 1549532279, "post_id": 54549499, "comment_id": 95938299, "body": "ok, could I generate a function using Swig that is getting raw pointer to memory? I imagine that it should check for type and use SWIG_ConvertPtr. But the problem is that at this point in my code I have only variable interpreter name and C++ type."}, {"owner": {"reputation": 9980, "user_id": 1944004, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/60f3cc97f94fa3690ba406f8c1a7fc4f?s=128&d=identicon&r=PG", "display_name": "Henri Menke", "link": "https://stackoverflow.com/users/1944004/henri-menke"}, "edited": false, "score": 1, "creation_date": 1549577124, "post_id": 54549499, "comment_id": 95963041, "body": "If you are linking against the SWIG module, you can just copy the prototype of <code>SWIG_Lua_ConvertPtr</code> as an <code>extern</code> declaration to your file and <a href=\"http://www.swig.org/Doc3.0/SWIGDocumentation.html#Modules_external_run_time\" rel=\"nofollow noreferrer\">export the runtime in SWIG</a>."}], "owner": {"reputation": 101, "user_id": 7714745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cac797b9ba4e425c44034ba97c3e856?s=128&d=identicon&r=PG&f=1", "display_name": "Mahashi", "link": "https://stackoverflow.com/users/7714745/mahashi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549469542, "creation_date": 1549442450, "last_edit_date": 1549469542, "question_id": 54549499, "link": "https://stackoverflow.com/questions/54549499/swig-lua-object-from-interpreter", "title": "Swig lua object from interpreter", "body": "<p>I'm sometimes getting lua variables directly from interpreter from within my C++ code not related to swig, for instance</p>\n\n<pre><code>lua_getglobal( mpLuaState, varname );\ndouble var = lua_tonumber(mpLuaState, -1);\nlua_setglobal( mpLuaState, varname );\n</code></pre>\n\n<p>When I try to take some custom object with </p>\n\n<pre><code>void * = lua_touserdata(mpLuaState, -1);\n</code></pre>\n\n<p>I realized that SWIG is wrapping custom objects with SWIG_NewPointerObj.</p>\n\n<p>Is there any way to get a pointer value to my custom object?</p>\n\n<p>@edit</p>\n\n<p>I've just came up with a workaround for this issue.\nI've added a method to my class exported to lua with Swig, </p>\n\n<p><code>unsigned long GetPtr();</code> </p>\n\n<p>which is returning</p>\n\n<p><code>return (unsigned long)this;</code> </p>\n\n<p>and then when I want to take it from C++ code (not related to Swig but only with pointer to <code>Lua_state*</code>),\nrun script with </p>\n\n<p><code>luaL_doString(\"ptrVal = MyObj:GetVal\")</code></p>\n\n<p>and then take it as normal number and parse it to <code>void*</code></p>\n\n<p>This is just workaround and I'd like to do it properly.\nAny suggestions? </p>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1549441687, "post_id": 54549274, "comment_id": 95898748, "body": "<code>extern &quot;C&quot;</code> is not needed for variables, only functions. And why do you <i>define</i> a variable in a header file? You should declare it in a single header file, and then define it in a single <i>source</i> file."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1549441860, "post_id": 54549274, "comment_id": 95898821, "body": "And for your problem, keep both the declaration and definition <i>the same</i>. Do not specify different linkage (except the single <code>extern</code> in the declaration) between the two."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1549442435, "post_id": 54549274, "comment_id": 95899077, "body": "@Someprogrammerdude - Strictly speaking.... Language linkage <a href=\"https://timsong-cpp.github.io/cppwp/n4659/dcl.link#4\" rel=\"nofollow noreferrer\">does apply</a> to namespace scoped variable names. I imagine an implementation is free to do name mangling even at global scope, so this is needed to ensure proper linkage portably."}], "answers": [{"tags": [], "owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1549443241, "last_edit_date": 1549443241, "creation_date": 1549442883, "answer_id": 54549620, "question_id": 54549274, "link": "https://stackoverflow.com/questions/54549274/error-conflicting-declaration-of-structure-in-multiple-files/54549620#54549620", "title": "error: conflicting declaration of structure in multiple files", "body": "<p>Your program is ill-formed.</p>\n\n<blockquote>\n  <p><strong>[dcl.link]</strong> (emphasis mine)</p>\n  \n  <p><a href=\"https://timsong-cpp.github.io/cppwp/n4659/dcl.link#5\" rel=\"nofollow noreferrer\">5</a> If two declarations declare functions with the same name and\n  parameter-type-list to be members of the same namespace <strong>or declare\n  objects with the same name to be members of the same namespace and the\n  declarations give the names different language linkages, the program\n  is ill-formed</strong>; no diagnostic is required if the declarations appear\n  in different translation units. Except for functions with C++ linkage,\n  a function declaration without a linkage specification shall not\n  precede the first linkage specification for that function. A function\n  can be declared without a linkage specification after an explicit\n  linkage specification has been seen; the linkage explicitly specified\n  in the earlier declaration is not affected by such a function\n  declaration.</p>\n</blockquote>\n\n<p>Wherever you include <code>a.h</code> and <code>b.h</code> both you get conflicting language linkage specification for the declarations of <code>abc_table</code>. Unlike with functions, variables have to match explicitly. </p>\n\n<p>Either remove the linkage specification in <code>a.h</code>, or add it in <code>b.h</code>. Though then you have hit the problem of <code>b.h</code> defining an object name with internal linkage (on account of the <code>const</code>), so the symbol won't be found.</p>\n\n<p>I'd dispense with the declaration in <code>b.h</code> all together. Object definitions in headers should be kept to a minimum, especially if one intends to interface with C code.</p>\n"}], "owner": {"reputation": 13, "user_id": 7029644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d60c1ad78d498f46962ca0b174686954?s=128&d=identicon&r=PG&f=1", "display_name": "Nayak", "link": "https://stackoverflow.com/users/7029644/nayak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 600, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549443241, "creation_date": 1549441501, "last_edit_date": 1549441924, "question_id": 54549274, "link": "https://stackoverflow.com/questions/54549274/error-conflicting-declaration-of-structure-in-multiple-files", "title": "error: conflicting declaration of structure in multiple files", "body": "<pre><code>//a.cpp has following code\n#include \"c.h\"\n\nextern \"C\" {\n   extern const ABC abc_table[];\n}\n\n//b.h has\n\nconst ABC abc_table[] = {.....};\n\n//c.h has\n#include \"b.h\"\n   typedef struct {.....} ABC;\n</code></pre>\n\n<p>this code compiles fine in visual studio</p>\n\n<p>where as in Linux it gives following error</p>\n\n<pre><code>a.cpp:79:79: error: conflicting declaration of \u2018const ABC abc_table []\u2019 with \u2018C\u2019 linkage\n extern const ABC abc_table[];\n                                                                              ^\nIn file included from c.h:4:0, from a.cpp:31:\nb.h:147:1: note: previous declaration with \u2018C++\u2019 linkage\n abc_table [] =\n</code></pre>\n\n<p>how can I get rid of this error, and why is it different in windows and linux</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1549441231, "post_id": 54549193, "comment_id": 95898576, "body": "Please read <a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feof-file-always-wrong\">Why is \u201cwhile ( !feof (file) )\u201d always wrong?</a>"}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 1, "creation_date": 1549441346, "post_id": 54549193, "comment_id": 95898621, "body": "<code>opendir()</code> and <code>readdir()</code> are your friends."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1549441348, "post_id": 54549193, "comment_id": 95898622, "body": "Also, never return negative numbers from <code>main</code>, especially on a POSIX system (like Linux or macOS). Either return <code>0</code> on success (which is implicitly done if you&#39;re missing a final <code>return</code> statement) or a small positive number on error."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1549441412, "post_id": 54549193, "comment_id": 95898646, "body": "And why do you print <code>gpg_file_name</code>? It&#39;s never initialized or used anywhere else, which means that your final <code>printf</code> could lead to <i>undefined behavior</i>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1549441443, "post_id": 54549193, "comment_id": 95898657, "body": "Lastly, C or C++? They are two very different languages with very different rules. Only use the tag of the language you&#39;re actually programming in."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1549441946, "post_id": 54549193, "comment_id": 95898863, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/280571/how-to-control-popen-stdin-stdout-stderr-redirection\">how to control popen stdin, stdout, stderr redirection?</a>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1549442003, "post_id": 54549193, "comment_id": 95898884, "body": "If you don&#39;t want to see the error messages, you can use <code>ls -ltr *.gpg 2&gt;&#47;dev&#47;null | </code> to send the errors to <code>&#47;dev&#47;null</code>.  If you want to know whether there are any such error messages, you have to work a lot harder; it is not clear that <code>popen()</code> is the correct choice then.  You could drop the <code>l</code> from <code>-ltr</code> so you only get the names in order.  You would then simplify the rest of the shell script.  Do you ever plan to have directories or other non-regular files in the directory?  How much do you need to worry about that?  Consider using <code>readdir()</code> et al in your code, instead of <code>popen()</code>."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1549442094, "post_id": 54549193, "comment_id": 95898932, "body": "Parsing <code>ls</code> output is wrong and your script is just confusing (filtering files using <code>grep ^-</code> ??) , just do <code>find . -type f -name &#39;*.gpg&#39; -maxdepth 1 | wc -l</code>. You will get just a single integer, which you can just even <code>scanf</code>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1549442239, "post_id": 54549193, "comment_id": 95899001, "body": "@KamilCuk: agree parsing <code>ls</code> output is risky, but the <code>grep</code> is looking for regular files and the <code>-tr</code> parts of the <code>ls</code> options are sorting the files in time order, which <code>find</code> won&#39;t do.  So, your replacement isn&#39;t correct; the original gets the name of the most recent <code>.gpg</code> file.  Your proposed <code>find \u2026 | wc -l</code> does a wholly different job."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1549442306, "post_id": 54549193, "comment_id": 95899031, "body": "Incidentally, you should probably include <code>-d</code> in the <code>ls</code> options so that the command lists the directory by name, rather than expanding its contents."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1549443601, "post_id": 54549193, "comment_id": 95899680, "body": "@JonathanLeffler That&#39;s good advice in in general, but in practice not usually necessary when you use a wildcard that will only match ordinary files, like <code>*.gpg</code>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1549443711, "post_id": 54549193, "comment_id": 95899726, "body": "@Barmar \u2014 if there\u2019s a directory <code>a.gpg</code>, the wildcard <code>*.gpg</code> will match it."}], "owner": {"reputation": 21, "user_id": 10951872, "user_type": "registered", "profile_image": "https://graph.facebook.com/2172679162795775/picture?type=large", "display_name": "Deepak Mj", "link": "https://stackoverflow.com/users/10951872/deepak-mj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549441747, "creation_date": 1549441132, "last_edit_date": 1549441747, "question_id": 54549193, "link": "https://stackoverflow.com/questions/54549193/how-to-handle-shell-printing-errors-in-unix-using-popen", "title": "How to handle shell printing errors in Unix using popen", "body": "<p>I have written some code to get a updated GPG files from the path <code>/home/user/GPG_FILES</code>. It works fine when the files exist in the path but my issue is when the path doesn't contain any GPG files at that time it prints (\"ls: cannot access *.gpg: No such file or directory\") in my shell which I don't want it to print in my shell. I want to handle this error in my code by having my own error description.</p>\n\n<pre><code>int main()\n{\n    while( 1 )\n    {\n        char buffer[ 1024 + 1 ];\n        char stip_file_path[ 2048 + 1  ];\n        char gpg_file_name[ 2048 + 1  ];\n        FILE *p;\n\n        memset( stip_file_path, 0, sizeof( stip_file_path ));\n        sprintf( stip_file_path, \"%s/%s/%s\", \"home\", \"user\", \"GPG_FILE\" );\n        chdir( stip_file_path );\n        p = popen(\"ls -ltr *.gpg| grep ^- | tail -1 | awk '{ print $(NF) }'\", \"r\");\n        if(!p)\n        {\n            printf(\"Error opening pipe\");\n            return -1;\n        }\n        memset( buffer, 0, sizeof( buffer ));\n        char *ptr = buffer;\n        while(!feof(p))\n        {\n            fread( ptr, 1, 1, p );\n            ptr++;\n        }\n        if( pclose(p) == -1 )\n        {\n            printf(\"Error opening close\");\n            return -1;\n        }\n        printf(\"get_updated_file success(%s)\", gpg_file_name );\n    }\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1549441009, "post_id": 54549121, "comment_id": 95898498, "body": "See e.g. <a href=\"https://cdecl.org/?q=int+(%2Afp)()\" rel=\"nofollow noreferrer\">https://cdecl.org/?q=int+(*fp)()</a>."}], "answers": [{"tags": [], "owner": {"reputation": 30796, "user_id": 1145666, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/rXvMA.jpg?s=128&g=1", "display_name": "Bart Friederichs", "link": "https://stackoverflow.com/users/1145666/bart-friederichs"}, "is_accepted": false, "score": 2, "last_activity_date": 1549440918, "creation_date": 1549440918, "answer_id": 54549146, "question_id": 54549121, "link": "https://stackoverflow.com/questions/54549121/what-is-int-fp/54549146#54549146", "title": "What is int (*fp)()", "body": "<p>It is a <a href=\"https://www.geeksforgeeks.org/function-pointer-in-c/\" rel=\"nofollow noreferrer\">function pointer</a>. They are powerful and quite hard to get your head around if you are a beginner.</p>\n"}, {"tags": [], "owner": {"reputation": 691, "user_id": 9946382, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P24x3.png?s=128&g=1", "display_name": "Leo", "link": "https://stackoverflow.com/users/9946382/leo"}, "is_accepted": false, "score": 1, "last_activity_date": 1549441434, "last_edit_date": 1549441434, "creation_date": 1549440922, "answer_id": 54549147, "question_id": 54549121, "link": "https://stackoverflow.com/questions/54549121/what-is-int-fp/54549147#54549147", "title": "What is int (*fp)()", "body": "<p>It is a declaration of the variable <code>fp</code> which is a <a href=\"https://www.learn-c.org/en/Function_Pointers\" rel=\"nofollow noreferrer\">pointer to a function</a> that returns an int and takes an <a href=\"https://stackoverflow.com/questions/20835534/function-pointer-without-arguments-types\">unspecified list of arguments</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 8001, "user_id": 307297, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/e28FD.png?s=128&g=1", "display_name": "chris01", "link": "https://stackoverflow.com/users/307297/chris01"}, "is_accepted": false, "score": 1, "last_activity_date": 1549440942, "creation_date": 1549440942, "answer_id": 54549151, "question_id": 54549121, "link": "https://stackoverflow.com/questions/54549121/what-is-int-fp/54549151#54549151", "title": "What is int (*fp)()", "body": "<p>It is a strcture that wraps a function-pointer.</p>\n\n<p>Have a look here: <a href=\"https://stackoverflow.com/questions/840501/how-do-function-pointers-in-c-work\">How do function pointers in C work?</a></p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549441830, "post_id": 54549159, "comment_id": 95898803, "body": "<i>empty parameters list</i> \u2013 might be misleading."}, {"owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "reply_to_user": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 1, "creation_date": 1549442751, "post_id": 54549159, "comment_id": 95899249, "body": "@Swordfish I agree, but the problem is that the empty <b>parameter list</b> (not just no parameters) is another complication of the language. While it comes from old ANSI standard (and still mantained for compatibility reasons), could have at least 2 different meanings: no parameters at all, or variable number (variadic function). So I would add no more complication to the answer. Or do you have different suggestion?"}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549443273, "post_id": 54549159, "comment_id": 95899516, "body": "Maybe at least mention that empty parameter lists are depreciated for a long time now and shall no longer be used in new code. With the function pointer type from the example one can call every function returning an <code>int</code> as long as the correct number and type of parameters are provided on call. But then the next thing is default parameter promotions :/"}, {"owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "reply_to_user": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549447916, "post_id": 54549159, "comment_id": 95902097, "body": "@Swordfish You said it! Just going a little bit in detail we are drowning in: programming style, or bad programming habits, function definitions, ANSI compliance, future language directions, etc. Anyway I think that your comment is already a contribution, and refer to it in the answer."}], "tags": [], "owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "is_accepted": true, "score": 4, "last_activity_date": 1549448411, "last_edit_date": 1549448411, "creation_date": 1549441002, "answer_id": 54549159, "question_id": 54549121, "link": "https://stackoverflow.com/questions/54549121/what-is-int-fp/54549159#54549159", "title": "What is int (*fp)()", "body": "<p><strong><code>fp</code> is a pointer to a function with empty parameters list.</strong></p>\n\n<p>I.e.</p>\n\n<pre><code>int myfunc()    //define function\n{\n    return 0;\n}\n\nstruct fp    //define structure\n{\n  int (*fp)();\n} mystruct;\nmystruct.fp = &amp;myfunc;    //assign function pointer to structure element\n\nint a = mystruct.fp();    //Call function through pointer\n</code></pre>\n\n<p>There are many ways to read C declarations, that can be very complicate in some cases. Start reading this <a href=\"https://parrt.cs.usfca.edu/doc/how-to-read-C-declarations.html\" rel=\"nofollow noreferrer\">https://parrt.cs.usfca.edu/doc/how-to-read-C-declarations.html</a>.</p>\n\n<p>You can google for \"how to read c declarations\" for more in depth explanation and further tips.</p>\n\n<p>As Swordfish pointed out, the use of empty parameter list imply other sensible points about function definitions, that could be worth to deep. Please refer to Swordfish's comment below for the main points relative to functions definition.</p>\n\n<p>I will refer only to the <strong>\u00a76.11.6 Function declarators</strong> (of <strong>\u00a76.11 Future language directions</strong>):</p>\n\n<blockquote>\n  <p>The use of function declarators with empty parentheses (not\n  prototype-format parameter type declarators) is an obsolescent\n  feature.</p>\n</blockquote>\n"}], "owner": {"reputation": 13318, "user_id": 1815710, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/dddf39759fed431cd1e8ecad2aa7dc49?s=128&d=identicon&r=PG", "display_name": "Liondancer", "link": "https://stackoverflow.com/users/1815710/liondancer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 890, "favorite_count": 0, "closed_date": 1549441587, "accepted_answer_id": 54549159, "answer_count": 4, "score": 0, "last_activity_date": 1549448411, "creation_date": 1549440814, "question_id": 54549121, "link": "https://stackoverflow.com/questions/54549121/what-is-int-fp", "closed_reason": "Duplicate", "title": "What is int (*fp)()", "body": "<p>I am not familiar with the syntax below for the following <code>struct</code></p>\n\n<pre><code>struct fp {\n  int (*fp)();\n}\n</code></pre>\n\n<p>What is <code>int (*fp)()</code> ? I understand that it is an <code>integer</code> and <code>*fp</code> is a pointer but I do not understand what that parentheses in <code>(*fp)()</code> do.</p>\n"}, {"tags": ["c", "embedded", "microcontroller", "nxp-microcontroller"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1549442781, "post_id": 54549077, "comment_id": 95899264, "body": "<code>on one of Freesacle micro controller</code> which one? Can you post the datasheet?"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1549476961, "post_id": 54549077, "comment_id": 95919388, "body": "a watchdog reset implies that the code or other broke which means you are not running reliable code that can reliably mark where it was before the reset.  Plus to do this you need additional time assuming the code is working."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1549476978, "post_id": 54549077, "comment_id": 95919397, "body": "you need to go backward to the problem you are trying to solve and not use this as the solution."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1549540260, "post_id": 54549077, "comment_id": 95943101, "body": "@old_timer I believe the OP is actually asking for how to debug the source of a wdog reset."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549553557, "post_id": 54549077, "comment_id": 95951185, "body": "@Lundin I agree but you can understand the general problem of debugging a watchdog reset.   As you have nicely described in your answer.  Also that saving the pc itself isnt the solution as I mentioned in so many words.  debugging something like this takes some creativity and luck."}], "answers": [{"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549442041, "post_id": 54549116, "comment_id": 95898902, "body": "This is actually most often not written in the manual of any Freescale MCU. Relying on the contents of RAM after reset is safe in most cases, but often completely undocumented."}], "tags": [], "owner": {"reputation": 13596, "user_id": 551045, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/d3cf04e39bcaab5592938990ea158d51?s=128&d=identicon&r=PG", "display_name": "RedX", "link": "https://stackoverflow.com/users/551045/redx"}, "is_accepted": false, "score": 0, "last_activity_date": 1549440780, "creation_date": 1549440780, "answer_id": 54549116, "question_id": 54549077, "link": "https://stackoverflow.com/questions/54549077/how-can-i-save-some-data-before-hardware-reset-of-microcontroller/54549116#54549116", "title": "How Can I save some data before hardware reset of microcontroller?", "body": "<p>It is written in your manual.</p>\n\n<p>I don't know that specific processor but in most microprocessors a watchdog reset is a soft reset, meaning that certain registers will keep information about the reset source and sometimes reason.</p>\n\n<p>You need to post more specific information on your Freescale \u03bcC for this be answered properly.</p>\n"}, {"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549443243, "post_id": 54549161, "comment_id": 95899498, "body": "Watchdog interrupt in the context of Freescale MCUs is typically an ISR where you end up <i>after</i> reset, not instead of reset. The SP won&#39;t be preserved, even though the stack itself probably is."}], "tags": [], "owner": {"reputation": 2462, "user_id": 2705907, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/e2UTS.jpg?s=128&g=1", "display_name": "Vagish", "link": "https://stackoverflow.com/users/2705907/vagish"}, "is_accepted": false, "score": 1, "last_activity_date": 1549441008, "creation_date": 1549441008, "answer_id": 54549161, "question_id": 54549077, "link": "https://stackoverflow.com/questions/54549077/how-can-i-save-some-data-before-hardware-reset-of-microcontroller/54549161#54549161", "title": "How Can I save some data before hardware reset of microcontroller?", "body": "<p>Depending on your microcontroller you may get Reset Reason, but getting previous  <code>program counter (PC/IP)</code> after reset is not possible.</p>\n\n<p>Most of modern microcontrollers have provision for <code>Watchdog Interrupt</code> Instead of <code>reset</code>.\nYou can configure watchdog peripheral to enable interrupt , In that ISR you can check stored context on stack. ( You can take help from JTAG debugger to check call stack).</p>\n\n<p>There are multiple debugging methods available if your micro-controller dosent support above method. </p>\n\n<p>e.g\nIn simple <code>while(1)</code> based architecture you can use a HW timer and restart it after some section of code. In Timer ISR you will know which code section is consuming long enough than the timer.</p>\n"}, {"comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1549442687, "post_id": 54549189, "comment_id": 95899215, "body": "...amd flush &amp; close the log after every write, otherwise the last part may not be in the file at the moment of reset."}, {"owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1549442819, "post_id": 54549189, "comment_id": 95899281, "body": "Yes! Indeed. Good point @PaulOgilvie, some years ago, when I was writing a log on a microcontroller and wondering why nothing is written in the output, I kept thinking that that section of the code never got hit, until I realized the need for a missing <code>fflush()</code>."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549443426, "post_id": 54549189, "comment_id": 95899586, "body": "If you need to &quot;flush and close the log&quot;/fflush/stdio.h on a microcontroller, you are doing it terribly wrong. It will just a simple ring buffer residing in flash/eeprom."}, {"owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549444525, "post_id": 54549189, "comment_id": 95900141, "body": "@Lundin, I wasn&#39;t familiar with that technique (neither back then, nor now until 9min. ago), but wouldn&#39;t that kill flash/eeprom in a short amount of time? I mean, it can take only as many read/write cycles. The devices had to be in the field 30 years or so. As far as I remember, we had a dedicated <code>&#47;log</code> partition for logs from all modules (mine was not the only one). 2ndly, excuse my naivety but how would writing to the flash avoid needing to flush? We won&#39;t be opening a file, rather writing values directly into some predefined <code>struct</code> member variables which could be analyzed later? Or how?"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1549444892, "post_id": 54549189, "comment_id": 95900358, "body": "Unless you have some hard drive plugged to your MCU (or maybe MRAM/FRAM), you have no other option. Yes, it will kill flash/eeprom over time, you have to calculate the number of reads and continuously cycle through a whole page. &quot;Flush&quot; is a PC concept, assuming you have some manner of file system."}], "tags": [], "owner": {"reputation": 3126, "user_id": 2955790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vShcC.png?s=128&g=1", "display_name": "Duck Dodgers", "link": "https://stackoverflow.com/users/2955790/duck-dodgers"}, "is_accepted": false, "score": 1, "last_activity_date": 1549441108, "creation_date": 1549441108, "answer_id": 54549189, "question_id": 54549077, "link": "https://stackoverflow.com/questions/54549077/how-can-i-save-some-data-before-hardware-reset-of-microcontroller/54549189#54549189", "title": "How Can I save some data before hardware reset of microcontroller?", "body": "<p>Two things: </p>\n\n<ol>\n<li>Write a <strong>log</strong>! And rotate that log to keep the last 30 min. or whatever reasonable amount of time you think you need to reproduce the error. Where the log stops, you can see what happened just before that. Even in production-level devices there is some level of logging. </li>\n<li>(Less, practical) You can attach a <strong>debugger</strong> to nearly every micrcontroller and step through the code. Probably put a break-point that is hit just before you enter the critical section of code. Some IDEs/uCs allow having \"<em>data-breakpoints</em>\" that get triggered when certain variables contain certain values. \nDisclaimer: I am not familiar with the exact microcontroller that you are using.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1130, "user_id": 2368681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f80488f6f8c93ca4aeab533a7b125153?s=128&d=identicon&r=PG", "display_name": "pm101", "link": "https://stackoverflow.com/users/2368681/pm101"}, "is_accepted": false, "score": 0, "last_activity_date": 1549442880, "last_edit_date": 1549442880, "creation_date": 1549442516, "answer_id": 54549521, "question_id": 54549077, "link": "https://stackoverflow.com/questions/54549077/how-can-i-save-some-data-before-hardware-reset-of-microcontroller/54549521#54549521", "title": "How Can I save some data before hardware reset of microcontroller?", "body": "<p>Even if you could get the Program Counter before reset, it wouldn't be advisable to blindly set the program counter to another after reset --- as there would likely have been stack and heap information as well as the data itself may also have changed.</p>\n\n<p>It depends on what you want to preserve after reset, certain behaviour or data? Volatile memory may or may not have been cleared after watchdog (see your uC datasheet) and you will be able to detect a reset after checking reset registers (again see your uC datasheet). By detecting a reset and checking volatile memory you may be able to prepare your uC to restart in a way that you'd prefer after the unlikely event of a reset occurring. You could create a global value and set it to a particular value in global scope, then if it resets, check the value against it when a reset event occurs -- if it is the same, you could assume other memory may also be the same. If volatile memory is not an option you'll need to have a look at the datasheet for non-volatile options, however it is also advisable not to continually write to non-volatile memory due to writing limitations.</p>\n"}, {"comments": [{"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1549444115, "post_id": 54549696, "comment_id": 95899918, "body": "Freescale is now NXP and IoT can be arm uC also."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1549444306, "post_id": 54549696, "comment_id": 95900034, "body": "@P__J__ Yes, and...? And what does IoT have to do with anything?"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1549481500, "post_id": 54549696, "comment_id": 95921512, "body": "Io T it was my phone dictionary"}], "tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 2, "last_activity_date": 1549443553, "last_edit_date": 1549443553, "creation_date": 1549443125, "answer_id": 54549696, "question_id": 54549077, "link": "https://stackoverflow.com/questions/54549077/how-can-i-save-some-data-before-hardware-reset-of-microcontroller/54549696#54549696", "title": "How Can I save some data before hardware reset of microcontroller?", "body": "<p>Most Freescale MCUs work like this:</p>\n\n<ul>\n<li>RAM is preserved after watchdog reset. But probably not after LVD reset and certainly not after power-on reset. This is in most cases completely undocumented.</li>\n<li>The MCU will either have a status register where you can check the reset cause (for example HCS08, MPC5x, Kinetis), or it will have special reset vectors for different reset causes (for example HC11, HCS12, Coldfire).</li>\n</ul>\n\n<p>There is no way to save anything upon reset. Reset happens and only afterwards can you find out what caused the reset.</p>\n\n<p>It is however possible to reserve a chunk of RAM as a special segment. Upon power-on reset, you can initialize this segment by setting everything to zero. If you get a watchdog reset, you can assume that this RAM segment is still valid and intact. So you don't initialize it, but leave it as it is. This method enables you to save variable values across reset. <em>Probably</em> - this is not well documented for most MCU families. I have used this trick at least on HCS08, HCS12 and MPC56.</p>\n\n<p>As for the program counter, you are out of luck. It is reset with no means to recover it. Meaning that the only way to find out where a watchdog reset occurred is the tedious old school way of moving a breakpoint bit by bit down your code, run the program and check if it reached the breakpoint.</p>\n\n<p>Though in case of modern MCUs like MPC56 or Cortex M, you simply check the trace buffer and see what code that caused the reset. Not only do you get the PC, you get to see the C source code. But you might need a professional, Eclipse-free tool chain to do this.</p>\n"}, {"tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": false, "score": 0, "last_activity_date": 1549479808, "creation_date": 1549479808, "answer_id": 54560811, "question_id": 54549077, "link": "https://stackoverflow.com/questions/54549077/how-can-i-save-some-data-before-hardware-reset-of-microcontroller/54560811#54560811", "title": "How Can I save some data before hardware reset of microcontroller?", "body": "<p>The only reliable solution is to use a debugger with trace capability if your chip supports embedded instruction trace.</p>\n\n<p>Some devices have an option to redirect the watchdog timeout to an interrupt rather then a reset.  This would allow you to write the watchdog timeout handler much like an exception handler and dump  or store the stack information including the return address which will indicate the location the interrupt occurred.</p>\n\n<p>However in some cases, neither solution is a reliable method of achieving your aim.  In a multi-tasking environment or system with interrupt handlers, the code running when the watchdog timeout occurs may not be the process that is causing the problem.</p>\n"}], "owner": {"reputation": 73, "user_id": 10468650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5135b38e7990340856cb2e8b64f2fa12?s=128&d=identicon&r=PG&f=1", "display_name": "Anmk", "link": "https://stackoverflow.com/users/10468650/anmk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1319, "favorite_count": 0, "accepted_answer_id": 54549696, "answer_count": 6, "score": 3, "last_activity_date": 1549479808, "creation_date": 1549440571, "last_edit_date": 1549443165, "question_id": 54549077, "link": "https://stackoverflow.com/questions/54549077/how-can-i-save-some-data-before-hardware-reset-of-microcontroller", "title": "How Can I save some data before hardware reset of microcontroller?", "body": "<p>I'm working on one of Freesacle micro controller. This microcontroller has several reset sources (e.g. clock monitor reset, watchdog reset and ...).\nSuppose that because of watchdog, my micro controller is reset. How can I save some data just before reset happens. I mean for example how can I understand that where had been the program counter just before watchdog reset. With this method I want to know where I have error (in another words long process) that causes watchdog reset.</p>\n"}, {"tags": ["c", "scanf", "secure-coding"], "comments": [{"owner": {"reputation": 5101, "user_id": 700170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gZ8hw.png?s=128&g=1", "display_name": "Morten Jensen", "link": "https://stackoverflow.com/users/700170/morten-jensen"}, "edited": false, "score": 0, "creation_date": 1549462893, "post_id": 54548629, "comment_id": 95911194, "body": "I would have though that the precision specifiers are the 10-part of <code>%10s</code>, i.e. that you are already doing this correctly. Coverity does not perform a sound analysis, meaning there can be false positives; this could be such one. It is not easy to recognize from the format string, whether or not you use correct format-strings. Therefore I would guess that Coverity warns nomatter what is in the format string."}, {"owner": {"reputation": 76, "user_id": 1936612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c7c59fd15e98f5a7587831bfe4e5679?s=128&d=identicon&r=PG", "display_name": "Deepak", "link": "https://stackoverflow.com/users/1936612/deepak"}, "reply_to_user": {"reputation": 5101, "user_id": 700170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gZ8hw.png?s=128&g=1", "display_name": "Morten Jensen", "link": "https://stackoverflow.com/users/700170/morten-jensen"}, "edited": false, "score": 0, "creation_date": 1549622043, "post_id": 54548629, "comment_id": 95977288, "body": "@MortenJensen: Basically is this means coverty is not checking for the width specifier (or any other specifier) which is associated with format specifier? and giving this error for sscanf()? This means we can not resolve this issue accept to not to use sscanf."}, {"owner": {"reputation": 5101, "user_id": 700170, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gZ8hw.png?s=128&g=1", "display_name": "Morten Jensen", "link": "https://stackoverflow.com/users/700170/morten-jensen"}, "edited": false, "score": 1, "creation_date": 1549624803, "post_id": 54548629, "comment_id": 95978866, "body": "I am not 100% certain, but my assumption is based on two things: 1) it seems you&#39;re already &#39;doing the right thing&#39; with sscanf-format strings, and 2) it is non-trivial to parse the format-strings and decipher types, width etc. from those format-strings. Pure speculation on my part. If you need certainty, I suggest you contact Synopsys (or whoever owns Coverity)."}], "owner": {"reputation": 76, "user_id": 1936612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c7c59fd15e98f5a7587831bfe4e5679?s=128&d=identicon&r=PG", "display_name": "Deepak", "link": "https://stackoverflow.com/users/1936612/deepak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 363, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549461498, "creation_date": 1549438406, "last_edit_date": 1549461498, "question_id": 54548629, "link": "https://stackoverflow.com/questions/54548629/how-to-handle-secure-coding-coverty-error-with-sscanf", "title": "How to handle SECURE_CODING coverty error with sscanf()?", "body": "<p>Coverty is giving following error for the sscanf():</p>\n\n<pre><code>char charnum[15] = \"429496725\";\nchar copystrpointer[15] = {0};\nint intequal = 0;\n\n/* Event secure_coding:     [VERY RISKY]. Using \"sscanf(char const * restrict, char const * restrict, ...)\" can cause a buffer overflow when done incorrectly. sscanf() assumes an arbitrarily large string, so callers must use correct precision specifiers or never use sscanf(). Use correct precision specifiers or do your own parsing.*/\n\nsscanf (charnum, \"%10s\", copystrpointer);\n\n/*Event secure_coding:  [VERY RISKY]. Using \"sscanf(char const * restrict, char const * restrict, ...)\" can cause a buffer overflow when done incorrectly. sscanf() assumes an arbitrarily large string, so callers must use correct precision specifiers or never use sscanf(). Use correct precision specifiers or do your own parsing.*/\n\nsscanf (charnum, \"%4d\", &amp;intequal);\n</code></pre>\n\n<p>This error is basically because sscanf() doesn't have a bound for the reading and writing, and it can cross the array limit and cause the program to crash.</p>\n\n<p>As coverty itself mention use the precision specifier to solve this, used width specifier in above example, as per my understanding this should read only 10 byte and write maximum of 10 byte. so it should not cross array bound and should be secure.and in the second example 4 byte is the max as this is the integer range in my unit.</p>\n\n<p>But still coverty error persists. As per my understanding precision specifier is possible only for the float and double format specifier (ex: %f) not for the int (%d).</p>\n\n<p>I can see there are suggestion to use alternative functions to handle this, but wanted to use sscanf() to parse some normal strings.</p>\n\n<p>Please let me know what is this precision specifier that coverty is mentioning? is there a way to handle this error?</p>\n"}, {"tags": ["c", "gcc", "cygwin"], "comments": [{"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1549438998, "post_id": 54548357, "comment_id": 95897656, "body": "Related: <a href=\"https://www.gnu.org/software/gnulib/manual/html_node/execinfo_002eh.html\" rel=\"nofollow noreferrer\">gnu.org/software/gnulib/manual/html_node/execinfo_002eh.html</a> (1st hit on gxxgle, BTW)"}, {"owner": {"reputation": 271, "user_id": 10705248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31d5aaf7570fc3f11a673167b1c3d53c?s=128&d=identicon&r=PG&f=1", "display_name": "lsr729", "link": "https://stackoverflow.com/users/10705248/lsr729"}, "reply_to_user": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1549448313, "post_id": 54548357, "comment_id": 95902342, "body": "@alk can you elaborate what should I do here, I have no idea about it.Thanks"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1549471460, "post_id": 54548357, "comment_id": 95916684, "body": "Where did you get the sources from?"}], "answers": [{"comments": [{"owner": {"reputation": 271, "user_id": 10705248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31d5aaf7570fc3f11a673167b1c3d53c?s=128&d=identicon&r=PG&f=1", "display_name": "lsr729", "link": "https://stackoverflow.com/users/10705248/lsr729"}, "edited": false, "score": 1, "creation_date": 1549455212, "post_id": 54552970, "comment_id": 95906514, "body": "Yes the VIC model is designed for linux platform but the earlier versions of VIC are installed on windows using cygwin, but this latest version VIC5.0.1 has this issue. So it cant be installed on windows?"}, {"owner": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "reply_to_user": {"reputation": 271, "user_id": 10705248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31d5aaf7570fc3f11a673167b1c3d53c?s=128&d=identicon&r=PG&f=1", "display_name": "lsr729", "link": "https://stackoverflow.com/users/10705248/lsr729"}, "edited": false, "score": 0, "creation_date": 1549479284, "post_id": 54552970, "comment_id": 95920495, "body": "As it is can not be compiled. Of course you can try to patch it"}], "tags": [], "owner": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "is_accepted": false, "score": 2, "last_activity_date": 1549453712, "creation_date": 1549453712, "answer_id": 54552970, "question_id": 54548357, "link": "https://stackoverflow.com/questions/54548357/execinfo-h-no-such-file-or-directory-while-installing-vic5-0-1-on-windows-using/54552970#54552970", "title": "execinfo.h: No such file or directory while installing VIC5.0.1 on windows using cygwin", "body": "<p>The software as it is can not be built on cygwin and on several other platforms as the header is specific of <code>glibc</code>.</p>\n\n<p>In the link provided by <code>alk</code> is clearly reported</p>\n\n<blockquote>\n  <p>This header file is missing on some platforms: Mac OS X 10.3, FreeBSD\n  6.0, NetBSD 5.0, OpenBSD 3.8, Minix 3.1.8, AIX 5.1, HP-UX 11, IRIX 6.5, OSF/1 5.1, Solaris 10, Cygwin, mingw, MSVC 14, Interix 3.5, BeOS, Android 9.0.</p>\n</blockquote>\n\n<p>I can only guess that the software is only supported on a Linux platform.\nThere is no evidence of effort to make it multi platform.</p>\n"}], "owner": {"reputation": 271, "user_id": 10705248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31d5aaf7570fc3f11a673167b1c3d53c?s=128&d=identicon&r=PG&f=1", "display_name": "lsr729", "link": "https://stackoverflow.com/users/10705248/lsr729"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1330, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1549453712, "creation_date": 1549437141, "last_edit_date": 1549437449, "question_id": 54548357, "link": "https://stackoverflow.com/questions/54548357/execinfo-h-no-such-file-or-directory-while-installing-vic5-0-1-on-windows-using", "title": "execinfo.h: No such file or directory while installing VIC5.0.1 on windows using cygwin", "body": "<p>I am installing VIC5.0.1 using cygwin on windows 7 and while giving the <code>make</code> command, it shows:</p>\n\n<pre><code> fatal error: execinfo.h: No such file or directory\n</code></pre>\n\n<p>The above error is there so many times in cygwin terminal, whats wrong in this?</p>\n"}, {"tags": ["c", "endianness"], "comments": [{"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 2, "creation_date": 1549436022, "post_id": 54548061, "comment_id": 95896437, "body": "When you print a number using <code>printf</code> it doesn&#39;t matter if the system is big or little endian - they will print the same thing. Big/little endian is only about how the byte order is in memory"}, {"owner": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 1, "creation_date": 1549436047, "post_id": 54548061, "comment_id": 95896443, "body": "The hexadecimal representation of a number is not influenced by the bytewise representation in memory and only the latter is affected by the endianess."}, {"owner": {"reputation": 393, "user_id": 1930418, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/QyzHt.png?s=128&g=1", "display_name": "Ephemeral", "link": "https://stackoverflow.com/users/1930418/ephemeral"}, "reply_to_user": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1549436325, "post_id": 54548061, "comment_id": 95896542, "body": "@4386427, yes but I get the value with a function and a memory pointer. this could change something? I added the function."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 0, "creation_date": 1549436531, "post_id": 54548061, "comment_id": 95896626, "body": "@Aborted-Security No, you can only see the difference when you look at the memory order."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549438705, "post_id": 54548061, "comment_id": 95897531, "body": "Start by dropping this obscure example, this isn&#39;t rocket science. This will do: <code>uint16_t u16 = 1; uint8_t* p = (uint8_t*)&amp;u16; if(*p == 1) { puts(&quot;Little endian&quot;); }</code>"}, {"owner": {"reputation": 393, "user_id": 1930418, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/QyzHt.png?s=128&g=1", "display_name": "Ephemeral", "link": "https://stackoverflow.com/users/1930418/ephemeral"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1549438914, "post_id": 54548061, "comment_id": 95897625, "body": "@Lundin, thank&#39;s but I want Hexa human repr. for Little and Big Endian of 64Bit number, not checking my memory order, your code check if Little or Big if I&#39;m not mistaken"}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 2, "creation_date": 1549439990, "post_id": 54548061, "comment_id": 95898093, "body": "@Aborted-Security Human representation = Big Endian. If you want that, simply check if little endian and then print the bytes backwards, otherwise print them as in memory. Btw I took a look at that tutorial and it is bad. Someone using <code>char</code> type, literals like <code>0x000000000000FF00</code> and use bit-fields to prove a point about endianess clearly doesn&#39;t know what they are doing and never had to port code."}, {"owner": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "edited": false, "score": 0, "creation_date": 1549443506, "post_id": 54548061, "comment_id": 95899630, "body": "You just need to look at <code>char *swapbytes128(char *val)</code> to get the idea about the quality of that article. It uses a local, temporary array of pointers, then copies <code>char</code>s to pointers (how does that even compile?), and then returns the pointer to this temporary (stack-based) array. A disaster."}], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 1930418, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/QyzHt.png?s=128&g=1", "display_name": "Ephemeral", "link": "https://stackoverflow.com/users/1930418/ephemeral"}, "edited": false, "score": 0, "creation_date": 1549437652, "post_id": 54548370, "comment_id": 95897071, "body": "Ok, I see very clearly with your code :) thank&#39;s you very much for your time. But , sorry I persist. Problematic is that you&#39;re doing well in hex for Little and Big. Two different values order \u200b\u200b(to the eye and in memory), so the yolinux site was wrong? He inverted the Endian type for 64 Bit number ?"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "reply_to_user": {"reputation": 393, "user_id": 1930418, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/QyzHt.png?s=128&g=1", "display_name": "Ephemeral", "link": "https://stackoverflow.com/users/1930418/ephemeral"}, "edited": false, "score": 0, "creation_date": 1549438019, "post_id": 54548370, "comment_id": 95897207, "body": "@Aborted-Security There are times when you want to swap between endianness in software. One example is when reading data from a network interface. On network interfaces data is always send with MSB first (Network Byte Order). So if you receive 4 bytes that represents an integer from a NIC and your system is little endian, you can&#39;t just write the 4 bytes to memory in the order they were received. You need to &quot;swap&quot; the bytes first."}, {"owner": {"reputation": 393, "user_id": 1930418, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/QyzHt.png?s=128&g=1", "display_name": "Ephemeral", "link": "https://stackoverflow.com/users/1930418/ephemeral"}, "edited": false, "score": 0, "creation_date": 1549438180, "post_id": 54548370, "comment_id": 95897271, "body": "Thank&#39;s you very much for this explanations.I will think about all this."}, {"owner": {"reputation": 393, "user_id": 1930418, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/QyzHt.png?s=128&g=1", "display_name": "Ephemeral", "link": "https://stackoverflow.com/users/1930418/ephemeral"}, "edited": false, "score": 0, "creation_date": 1549438415, "post_id": 54548370, "comment_id": 95897402, "body": "Then, yolinux use a bad approach for explain Big and Little ? 0x0000010000040880 != 0x8008040000010000.  ? values order change in memory, i want the hexa human rep of this order ... (I think)"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "reply_to_user": {"reputation": 393, "user_id": 1930418, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/QyzHt.png?s=128&g=1", "display_name": "Ephemeral", "link": "https://stackoverflow.com/users/1930418/ephemeral"}, "edited": false, "score": 0, "creation_date": 1549438826, "post_id": 54548370, "comment_id": 95897579, "body": "@Aborted-Security Well, when written as <code>0x0000010000040880</code> and <code>0x8008040000010000</code> you are for sure <b>dealing with two different numbers</b> - regardless of endianness because it has nothing to do with endianness. But if you say: The <b>memory</b> contains the following hex values: <code>00 00 01 00 00 04 08 80</code> then the actual number is different on little endian and big endian. On little endian the actual number is: 0x8008040000010000 but on big endian the actual number is: 0x0000010000040880"}, {"owner": {"reputation": 393, "user_id": 1930418, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/QyzHt.png?s=128&g=1", "display_name": "Ephemeral", "link": "https://stackoverflow.com/users/1930418/ephemeral"}, "edited": false, "score": 0, "creation_date": 1549439024, "post_id": 54548370, "comment_id": 95897667, "body": "Yes sure, you are rigth. I seem to have finally understood my &#39;problem&#39; and I thank you for it."}], "tags": [], "owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "is_accepted": true, "score": 4, "last_activity_date": 1549449547, "last_edit_date": 1549449547, "creation_date": 1549437235, "answer_id": 54548370, "question_id": 54548061, "link": "https://stackoverflow.com/questions/54548061/c-little-and-big-endian-confusion/54548370#54548370", "title": "C, Little and Big Endian confusion", "body": "<p>When you print some \"multi-byte\" integer using <code>printf</code> (and the correct format specifier) it doesn't matter whether the system is little or big endian. The result will be the same.</p>\n\n<p>The difference between little and big endian is the order that multi-byte types are stored in memory. But once data is read from memory into the core processor, there is no difference.</p>\n\n<p>This code shows how an integer (4 bytes) is placed in memory on my machine.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    unsigned int u = 0x12345678;\n    printf(\"size of int is %zu\\n\", sizeof u);\n    printf(\"DEC: u=%u\\n\", u);\n    printf(\"HEX: u=0x%x\\n\", u);\n    printf(\"memory order:\\n\");\n    unsigned char * p = (unsigned char *)&amp;u;\n    for(int i=0; i &lt; sizeof u; ++i) printf(\"address %p holds %x\\n\", (void*)&amp;p[i], p[i]);\n    return 0;\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>size of int is 4\nDEC: u=305419896\nHEX: u=0x12345678\nmemory order:\naddress 0x7ffddf2c263c holds 78\naddress 0x7ffddf2c263d holds 56\naddress 0x7ffddf2c263e holds 34\naddress 0x7ffddf2c263f holds 12\n</code></pre>\n\n<p>So I can see that I'm on a little endian machine as the LSB (least significant byte, i.e. 78) is stored on the lowest address.</p>\n\n<p>Executing the same program on a big endian machine would (assuming same address) show:</p>\n\n<pre><code>size of int is 4\nDEC: u=305419896\nHEX: u=0x12345678\nmemory order:\naddress 0x7ffddf2c263c holds 12 \naddress 0x7ffddf2c263d holds 34 \naddress 0x7ffddf2c263e holds 56 \naddress 0x7ffddf2c263f holds 78 \n</code></pre>\n\n<p>Now it is the MSB (most significant byte, i.e. 12) that are stored on the lowest address.</p>\n\n<p>The important thing to understand is that this <strong>only</strong> relates to \"how multi-byte type are stored in memory\". Once the integer is read from memory into a register inside the core, the register will hold the integer in the form 0x12345678 on <strong>both</strong> little and big endian machines.</p>\n"}, {"tags": [], "owner": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "is_accepted": false, "score": 1, "last_activity_date": 1549444199, "creation_date": 1549444199, "answer_id": 54549998, "question_id": 54548061, "link": "https://stackoverflow.com/questions/54548061/c-little-and-big-endian-confusion/54549998#54549998", "title": "C, Little and Big Endian confusion", "body": "<p>There is only a single way to represent an integer in decimal, binary or hexadecimal format. For example, number <code>43981</code> is equal to <code>0xABCD</code> when written as hexadecimal, or <code>0b1010101111001101</code> in binary. Any other value (<code>0xCDAB</code>, <code>0xDCBA</code> or similar) represents a different number.</p>\n\n<p>The way your compiler and cpu choose to store this value internally is irrelevant as far as C standard is concerned; the value could be stored as a <a href=\"https://en.wikipedia.org/wiki/UNIVAC_1100/2200_series\" rel=\"nofollow noreferrer\">36-bit one's complement</a> if you're particularly unlucky, as long as all operations mandated by the standard have equivalent effects.</p>\n\n<p>You will rarely have to inspect your internal data representation when programming. Practically the only time when you care about endiannes is when working on a communication protocol, because then the binary format of the data must be precisely defined, but even then your code will not be different regardless of the architecture:</p>\n\n<pre><code>// input value is big endian, this is defined\n// by the communication protocol\n\nuint32_t parse_comm_value(const char * ptr)\n{\n     // but bit shifts in C have the same\n     // meaning regardless of the endianness\n     // of your architecture\n\n     uint32_t result = 0;\n     result |= (*ptr++) &lt;&lt; 24;\n     result |= (*ptr++) &lt;&lt; 16;\n     result |= (*ptr++) &lt;&lt; 8;\n     result |= (*ptr++);\n     return result;\n}\n</code></pre>\n\n<p>Tl;dr calling a standard function like <code>printf(\"0x%llx\", number);</code> always prints the correct value using the specified format. Inspecting the contents of memory by reading individual bytes gives you the representation of the data on your architecture.</p>\n"}], "owner": {"reputation": 393, "user_id": 1930418, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/QyzHt.png?s=128&g=1", "display_name": "Ephemeral", "link": "https://stackoverflow.com/users/1930418/ephemeral"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1214, "favorite_count": 1, "accepted_answer_id": 54548370, "answer_count": 2, "score": 0, "last_activity_date": 1549449547, "creation_date": 1549435771, "last_edit_date": 1549436408, "question_id": 54548061, "link": "https://stackoverflow.com/questions/54548061/c-little-and-big-endian-confusion", "title": "C, Little and Big Endian confusion", "body": "<p>I try to understand C programming memory Bytes order, but I'm confuse.\nI try my app with some value on this site for my output verification : <a href=\"http://www.yolinux.com/TUTORIALS/Endian-Byte-Order.html\" rel=\"nofollow noreferrer\">www.yolinux.com/TUTORIALS/Endian-Byte-Order.html</a> </p>\n\n<p><strong>For the 64bits value I use in my C program:</strong> </p>\n\n<pre><code>volatile long long ll = (long long)1099511892096;\n__mingw_printf(\"\\tlong long, %u Bytes, %u bits,\\t%lld to %lli, %lli, 0x%016llX\\n\", sizeof(long long), sizeof(long long)*8, LLONG_MIN, LLONG_MAX , ll, ll);\n\nvoid printBits(size_t const size, void const * const ptr)\n{\n    unsigned char *b = (unsigned char*) ptr;\n    unsigned char byte;\n    int i, j;\n    printf(\"\\t\");\n    for (i=size-1;i&gt;=0;i--)\n    {\n        for (j=7;j&gt;=0;j--)\n        {\n            byte = b[i] &amp; (1&lt;&lt;j);\n            byte &gt;&gt;= j;\n            printf(\"%u\", byte);\n        }\n\n        printf(\" \");\n    }\n    puts(\"\");\n}\n</code></pre>\n\n<p><strong>Out</strong></p>\n\n<pre><code>long long,                8 Bytes,   64 bits,   -9223372036854775808 to 9223372036854775807, 1099511892096, 0x0000010000040880\n80 08 04 00 00 01 00 00  (Little-Endian)\n10000000 00001000 00000100 00000000 00000000 00000001 00000000 00000000\n00 00 01 00 00 04 08 80  (Big-Endian)\n00000000 00000000 00000001 00000000 00000000 00000100 00001000 10000000\n</code></pre>\n\n<p><strong>Tests</strong></p>\n\n<pre><code>0x8008040000010000, 1000000000001000000001000000000000000000000000010000000000000000 // online website hex2bin conv. \n                    1000000000001000000001000000000000000000000000010000000000000000 // my C app\n0x8008040000010000, 1000010000001000000001000000000000000100000000010000000000000000 // yolinux.com\n\n\n0x0000010000040880, 0000000000000000000000010000000000000000000001000000100010000000      //online website hex2bin conv., 1099511892096  ! OK\n                    0000000000000000000000010000000000000000000001000000100010000000      // my C app,  1099511892096 ! OK\n[Convert]::ToInt64(\"0000000000000000000000010000000000000000000001000000100010000000\", 2) // using powershell for other verif., 1099511892096 ! OK          \n0x0000010000040880, 0000000000000000000000010000010000000000000001000000100010000100      // yolinux.com, 1116691761284 (from powershell bin conv.) ! BAD !\n</code></pre>\n\n<p><strong>Problem</strong></p>\n\n<p>yolinux.com website announce <strong>0x0000010000040880</strong> for <strong>BIG ENDIAN</strong> ! But my computer use LITTLE ENDIAN I think (Intel proc.)\nand I get same value 0x0000010000040880 from my C app and from another website hex2bin converter. \n__mingw_printf(...0x%016llX...,...ll) also print 0x0000010000040880 as you can see.</p>\n\n<p>Following yolinux website I have inverted my \"(Little-Endian)\" and \"(Big-Endian)\" labels in my output for the moment.</p>\n\n<p>Also, the sign bit must be 0 for a positive number it's the case on my result but also yolinux result.(can not help me to be sure.)</p>\n\n<p>If I correctly understand Endianness only Bytes are swapped not bits and my groups of bits seems to be correctly inverted.</p>\n\n<p>It is simply an error on yolinux.com or is I missing a step about 64-bit numbers and C programming?</p>\n"}, {"tags": ["c", "arrays", "file-handling", "filehandle"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1549435567, "post_id": 54547998, "comment_id": 95896269, "body": "A string is a null terminated array of <i>characters</i>. The only atrray you have in your program is an array of <i>pointers</i>.  For a pointer to be usable in functions like <code>fscanf</code>,  it needs to <i>point somewhere</i>."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 1, "creation_date": 1549438125, "post_id": 54548470, "comment_id": 95897248, "body": "Never use <code>&quot;%s&quot;</code> without specifying a width to limit the number of characters to read. <i><code>malloc(len)</code></i> off-by-one."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 1, "creation_date": 1549439320, "post_id": 54548470, "comment_id": 95897802, "body": "&quot;<i><code>strncpy(strings[i], temp, len);</code></i>&quot;: Why not just <code>strcpy(strings[i], temp)</code>?! <code>strnpcy()</code>&#39;s usage is so error prone, you should yourself in the foot so easyly, as the code you show unfortunately demonstrates."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1549439353, "post_id": 54548470, "comment_id": 95897817, "body": "Also: Do not cast the result of <code>malloc()</code> &amp; friends in C."}, {"owner": {"reputation": 33, "user_id": 9988159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/978e11aaf8289423199042dda3f665ed?s=128&d=identicon&r=PG&f=1", "display_name": "pi3.14", "link": "https://stackoverflow.com/users/9988159/pi3-14"}, "edited": false, "score": 0, "creation_date": 1549458392, "post_id": 54548470, "comment_id": 95908432, "body": "I dont understand why there is a (char *) before malloc. Can you please explain it?"}, {"owner": {"reputation": 628, "user_id": 1192700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98e582c508859b2fe285f938ea7ffb01?s=128&d=identicon&r=PG", "display_name": "Cristian Bidea", "link": "https://stackoverflow.com/users/1192700/cristian-bidea"}, "edited": false, "score": 0, "creation_date": 1549467495, "post_id": 54548470, "comment_id": 95914176, "body": "<a href=\"http://www.cplusplus.com/reference/cstdlib/malloc/\" rel=\"nofollow noreferrer\">cplusplus.com/reference/cstdlib/malloc</a> in the documentation it says that malloc returns void*, so i cast the result to char*. I think that some newer compilers don\u2019t need that."}], "tags": [], "owner": {"reputation": 628, "user_id": 1192700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98e582c508859b2fe285f938ea7ffb01?s=128&d=identicon&r=PG", "display_name": "Cristian Bidea", "link": "https://stackoverflow.com/users/1192700/cristian-bidea"}, "is_accepted": true, "score": 0, "last_activity_date": 1549438510, "last_edit_date": 1549438510, "creation_date": 1549437727, "answer_id": 54548470, "question_id": 54547998, "link": "https://stackoverflow.com/questions/54547998/how-to-scan-string-from-file-and-store-it-on-an-array-of-strings-two-dimensiona/54548470#54548470", "title": "How to scan string from file and store it on an array of strings (two-dimensional array)?", "body": "<p>You have an array of pointers but you didn't allocate space for each string. In this case what you can do is preallocate a big enough buffer or read in a preallocated buffer, see how many characters were read and allocate a string of that size.</p>\n\n<pre><code>FILE    *stringsIn = fopen(\"strings.txt\", \"rt\");\nchar    *strings[INPUT_STRINGS];\n\nfor (int i = 0; i &lt; INPUT_STRINGS; i++) {\n   strings[i] = (char*)malloc(2048); //allocate a big enough buffer\n   fscanf(stringsIn, \"%2047s \", &amp;strings[i][0]);\n}\n</code></pre>\n\n<p>The second version is something like:</p>\n\n<pre><code>FILE    *stringsIn = fopen(\"strings.txt\", \"rt\");\nchar    *strings[INPUT_STRINGS];\nchar temp[2048];\n\nfor (int i = 0; i &lt; INPUT_STRINGS; i++) {\n   fscanf(stringsIn, \"%2047s \", &amp;temp);\n   size_t len = strlen(temp);\n   strings[i] = (char*)malloc(len + 1);\n   strncpy(strings[i], temp, len);\n}\n\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9988159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/978e11aaf8289423199042dda3f665ed?s=128&d=identicon&r=PG&f=1", "display_name": "pi3.14", "link": "https://stackoverflow.com/users/9988159/pi3-14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "closed_date": 1549439161, "accepted_answer_id": 54548470, "answer_count": 1, "score": 0, "last_activity_date": 1549438510, "creation_date": 1549435409, "question_id": 54547998, "link": "https://stackoverflow.com/questions/54547998/how-to-scan-string-from-file-and-store-it-on-an-array-of-strings-two-dimensiona", "closed_reason": "Duplicate", "title": "How to scan string from file and store it on an array of strings (two-dimensional array)?", "body": "<p>I am scanning a string from a file and storing it into an array of strings. When I compile my program, it does not produce any error but when I run it, it says <code>Segmentation fault (core dumped)</code>. I know that the error is in the fscanf statement, but I can't figure out what's wrong.</p>\n\n<p>My code looks like this:</p>\n\n<pre><code> FILE    *stringsIn = fopen(\"strings.txt\", \"rt\");\n char    *strings[INPUT_STRINGS];\n\n    for (int i = 0; i &lt; INPUT_STRINGS; i++)\n            fscanf(stringsIn, \"%s \", &amp;strings[i][0]);\n</code></pre>\n"}, {"tags": ["c", "arduino", "serial-port", "sensors"], "answers": [{"tags": [], "owner": {"reputation": 3, "user_id": 10756077, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uyQjBUAvLNc/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hEwl1DhRxH1x4kaMaXcua4jknhWQ/mo/photo.jpg?sz=128", "display_name": "Julie Jane Dumon", "link": "https://stackoverflow.com/users/10756077/julie-jane-dumon"}, "is_accepted": false, "score": 0, "last_activity_date": 1549434199, "creation_date": 1549434199, "answer_id": 54547750, "question_id": 54547611, "link": "https://stackoverflow.com/questions/54547611/arduino-serial-port-printing-all-lines-only-when-i-put-a-serial-println-lin/54547750#54547750", "title": "Arduino serial port printing all lines only when I put a Serial.println(&quot; &quot;) line in the loop", "body": "<p>Only call Serial.print() once.</p>\n\n<p>If you define the circumstances under which you do, and do not, want to call Serial.print(), we can help you see that it happens that way.</p>\n\n<p>Basically, though, you need to count how many times you have already printed. Only actually call print if the count is 0.</p>\n"}], "owner": {"reputation": 1, "user_id": 8129388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bc20a1b1c254357d752db065c8e7dd0?s=128&d=identicon&r=PG&f=1", "display_name": "NaviX", "link": "https://stackoverflow.com/users/8129388/navix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 300, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549434199, "creation_date": 1549433555, "question_id": 54547611, "link": "https://stackoverflow.com/questions/54547611/arduino-serial-port-printing-all-lines-only-when-i-put-a-serial-println-lin", "title": "Arduino serial port printing all lines only when I put a Serial.println(&quot; &quot;) line in the loop", "body": "<p>I have some time controlled segments inside my main loop that turning LEDs on/off and are storing values from a sensor into a linked list (Using this linked list library: <a href=\"https://github.com/ivanseidel/LinkedList\" rel=\"nofollow noreferrer\">https://github.com/ivanseidel/LinkedList</a>). I have my baud rate set at 34800 because I want data to be transferred at a faster rate, and I have a a function that for loops the sensor data captured within the the timed loops and prints them. </p>\n\n<p>The weird problem I'm facing is when I Serial.print() the data, it only works when I have a Serial.println()(<strong>just Serial.print() does not work</strong>) inside each of the if blocks. If I remove this Serial.println() the code does not work, and just gives out garbage in the Serial monitor. </p>\n\n<p><strong>What is causing this issue? How do I resolve it?</strong> Here is the code:</p>\n\n<pre><code>void setup( void )\n{\n  Serial.begin( 38400 );\n  while(!Serial){\n    }\n  pinMode (ledPin670, OUTPUT);\n  pinMode (ledPin850, OUTPUT);\n  digitalWrite(ledPin670,HIGH);\n  digitalWrite(ledPin850,HIGH);\n  Start = millis();\n  timer = micros();\n}\n\nvoid loop( void )\n{\n  if ( millis() - Start &lt; 100 )\n  {\n    //Serial.read();\n    Serial.println(\" \");\n    digitalWrite(ledPin670,LOW);\n    analogRead( A0 );\n    valList670.add(analogRead( A0 ));\n    time670.add(micros() - timer);\n    ++Count;\n  }\n  else if ((millis() - Start &gt;= 100) &amp;&amp; (millis() - Start &lt; 110)){\n    digitalWrite(ledPin670,HIGH);\n    }\n  else if ((millis() - Start &gt;= 110) &amp;&amp; (millis() - Start &lt; 220))\n  {\n//    Serial.read();\n    Serial.println(\" \");\n    digitalWrite(ledPin670,HIGH);\n    digitalWrite(ledPin850,LOW);\n    analogRead( A0 );\n    valList950.add(analogRead( A0 ));\n    time850.add(micros() - timer);\n    ++Count2;\n  }\n  else if ((millis() - Start &gt;= 220) &amp;&amp; (millis() - Start &lt; 230)){\n    digitalWrite(ledPin850,HIGH);\n\n  else\n  {\n    //Serial.println(millis() - Start);\n    Serial.println(\"count:\");\n    Serial.println( Count );\n    Serial.println( Count2 );\n    Serial.println( Count3 );\n    arrayLoop(valList670, time670,10);\n    arrayLoop(valList850, time850,10);\n\n    valList670.clear();\n    valList850.clear();\n    time850.clear();\n    time670.clear();\n    timer = micros();\n    Count = 0;\n    Count2 = 0;\n    Start = millis();\n}\n\nvoid arrayLoop(LinkedList&lt;int&gt; &amp;pinNum,LinkedList&lt;unsigned long&gt; &amp;timer, int valDiff){\n//  Serial.println(pinNum);\n  int listSize = pinNum.size();\n  for (int h = 0; h &lt; listSize; h+=valDiff) {\n      //Get value from list\n      if (h &lt;= listSize){\n        int val = pinNum.get(h);\n        unsigned long tim = timer.get(h);\n        Serial.print(tim);\n        Serial.print(\"\\t\");\n        Serial.println(val);\n      }\n  }\n}\n</code></pre>\n"}, {"tags": ["c", "file"], "comments": [{"owner": {"reputation": 12858, "user_id": 6752050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d5c4caa7ff50e6e492c3957ca20ef6c?s=128&d=identicon&r=PG&f=1", "display_name": "S.M.", "link": "https://stackoverflow.com/users/6752050/s-m"}, "edited": false, "score": 1, "creation_date": 1549433453, "post_id": 54547536, "comment_id": 95895472, "body": "Which code have you tried to write?"}, {"owner": {"reputation": 2449, "user_id": 4730685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8d2d8e67d9c0443c382d1dd80132063?s=128&d=identicon&r=PG&f=1", "display_name": "Erlkoenig", "link": "https://stackoverflow.com/users/4730685/erlkoenig"}, "edited": false, "score": 3, "creation_date": 1549433744, "post_id": 54547536, "comment_id": 95895571, "body": "Perhaps by reading the file as UTF-32 big endian?"}, {"owner": {"reputation": 1256, "user_id": 3717691, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0e31f2eebcaa93d53b27abaf149df957?s=128&d=identicon&r=PG&f=1", "display_name": "Jeppe", "link": "https://stackoverflow.com/users/3717691/jeppe"}, "edited": false, "score": 0, "creation_date": 1549434141, "post_id": 54547536, "comment_id": 95895716, "body": "<a href=\"https://stackoverflow.com/questions/32557123/c-read-4-bytes-at-a-time\">This</a> might be related. Read 4 bytes at a time and then extend it to only keep the 1st."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11021217"}, "edited": false, "score": 0, "creation_date": 1549434279, "post_id": 54547536, "comment_id": 95895770, "body": "I have posted the code. The problem is i am so confused about en/decoding chars and integers."}, {"owner": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 1, "creation_date": 1549436162, "post_id": 54547536, "comment_id": 95896484, "body": "&quot;confused&quot; can mean anything. Please take the <a href=\"https://stackoverflow.com/tour\">tour</a> and specifically read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>. Then, extract a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> from your code and post that with a description of what you would expect and what you actually observe. In particular, don&#39;t dump you whole project&#39;s code here for others to pick the relevant pieces."}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1549461613, "post_id": 54547536, "comment_id": 95910389, "body": "see also how to create a <a href=\"http://sscce.org/\" rel=\"nofollow noreferrer\">Short, Self Contained, Correct, Example</a> instead of posting the whole code that no one will read here. And <a href=\"https://en.wikipedia.org/wiki/UTF-32\" rel=\"nofollow noreferrer\">UTF-32</a> is simply characters that are 32-bit long, why don&#39;t just read into a <code>uint32_t</code> array?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11021217"}, "edited": false, "score": 0, "creation_date": 1549483140, "post_id": 54547536, "comment_id": 95922211, "body": "why being so harsh instead of just answer the question?"}], "answers": [{"comments": [{"owner": {"reputation": 417, "user_id": 8494004, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vymUnsuSdRs/AAAAAAAAAAI/AAAAAAAAAG4/PsFJnuq9eDo/photo.jpg?sz=128", "display_name": "Serge Ageyev", "link": "https://stackoverflow.com/users/8494004/serge-ageyev"}, "edited": false, "score": 0, "creation_date": 1549561365, "post_id": 54547898, "comment_id": 95955770, "body": "IMHO this code looks invariant in terms big endian or little endian, because you do not use value of <code>uint32_t i</code> as integer, you use it just a placeholder in <code>union { ... }</code>. And character value <code>char c</code> will probably be a member at lower memory address (closer to beginning to the file). Clever trick!"}, {"owner": {"reputation": 5543, "user_id": 6372809, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O11k5.jpg?s=128&g=1", "display_name": "ilkkachu", "link": "https://stackoverflow.com/users/6372809/ilkkachu"}, "edited": false, "score": 0, "creation_date": 1549561576, "post_id": 54547898, "comment_id": 95955886, "body": "You shouldn&#39;t even need the union. With <code>char buf[4]</code>, just read directly to <code>buf</code>, and then pick out <code>buf[0]</code>."}], "tags": [], "owner": {"reputation": 6034, "user_id": 4460500, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7TTnO.jpg?s=128&g=1", "display_name": "VolAnd", "link": "https://stackoverflow.com/users/4460500/voland"}, "is_accepted": false, "score": 1, "last_activity_date": 1549438147, "last_edit_date": 1549438147, "creation_date": 1549434914, "answer_id": 54547898, "question_id": 54547536, "link": "https://stackoverflow.com/questions/54547536/convert-an-array-of-integers-to-an-array-of-chars/54547898#54547898", "title": "Convert an array of integers to an array of chars", "body": "<p>if your codding is \"every int is really a 8 byte\" your example is not correct, because I see 4 byte (32-bit) for each letter.\nBut in any case you can use <code>fread</code> when buffer is uint64_t (or uint32_t for case of 4 byte):</p>\n\n<pre><code>uint64_t buf;\nfread (&amp;buf,sizeof(buf),1,file);\n</code></pre>\n\n<p><strong>Note</strong>: here <code>1</code> is number of values, so you can use number of items in array of <code>uint64_t</code> instead of <code>1</code> and name of array instead of <code>buf</code>.</p>\n\n<p>Than <code>uint64</code> need conversion to <code>char</code> and here you have options for taking any byte from 8:</p>\n\n<ul>\n<li>use union of <code>uint64_t</code> and <code>char[8]</code> (write to <code>uint64_t</code> and read for any bytre from char[0] to char[7]) - <em>for uint32_t use char[4] and indices from 0 to 3</em></li>\n<li>use shift (if you need not low byte) of uint64_t value and assignment to char (e.g. to take high byte <code>char c = (char)(buf &gt;&gt; 56);</code>) - <em>high byte of uint32_t can be taken after right shift by 24, and of course the low byte does not require a shift</em></li>\n<li>etc. (you can invent your own method of single byte, i.e. character, extraction)</li>\n</ul>\n\n<p><strong>UPDATE</strong>\nThere is the simplest example of <code>uint32_t</code> to <code>char</code> conversion:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;stdint.h&gt;\n\nunion {\n    uint32_t i;\n    char c[4];\n} buf32;\n\nint main(int argc, char* argv[])\n{\n    if (argc &lt; 2) {\n        perror (\"Provide argument with filename\");\n        return 1;\n    }\n    FILE* f = fopen(argv[1],\"rb\");\n    char ch;\n    if (f == NULL) {\n        perror (\"Error opening file\");\n        return 2;\n    }\n    while (fread(&amp;buf32.i,sizeof(buf32),1,f) == 1) {\n      putchar(buf32.c[0]); // prints low byte\n    }\n    fclose(f);\n    return 0;\n}\n</code></pre>\n\n<p><strong>UPDATE2</strong>\nAlso read about little and big endian and see <a href=\"https://stackoverflow.com/questions/54548061/c-little-and-big-endian-confusion\">this question and answer</a> it can be useful in your case</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11021217"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1549560675, "creation_date": 1549433132, "last_edit_date": 1549560675, "question_id": 54547536, "link": "https://stackoverflow.com/questions/54547536/convert-an-array-of-integers-to-an-array-of-chars", "title": "Convert an array of integers to an array of chars", "body": "<p>I have a file where every char is represented as a 32-bit Integer value so for e.g a file containing the word <code>Hello</code> contains</p>\n\n<pre><code>0000000: 4800 0000 6500 0000 6c00 0000 6c00 0000  H...e...l...l...\n0000010: 6f00 0000 0000 0000                      o.......\n</code></pre>\n\n<p>How can I read this file into a string <code>Hello</code> so that every int is really a 8byte char? When i open this file in notepad or so i get</p>\n\n<pre><code>H   e   l   l   o // 3 spaces beween every character.\n</code></pre>\n"}, {"tags": ["c", "linux", "openwrt"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 12642546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/962d304b243d21ab78a061f88bef33d5?s=128&d=identicon&r=PG&f=1", "display_name": "carmo", "link": "https://stackoverflow.com/users/12642546/carmo"}, "is_accepted": false, "score": 0, "last_activity_date": 1577986113, "creation_date": 1577986113, "answer_id": 59567510, "question_id": 54547081, "link": "https://stackoverflow.com/questions/54547081/process-spawned-by-daemon-dies-when-no-tty-present/59567510#59567510", "title": "Process spawned by Daemon dies when no TTY present", "body": "<p>I had the same exact problem for a month until today,\nMy project has only one little difference in that I use a shell script to open ash instead of a c compiled program.\nI imagine you are using a proc script to run your logic after the boot procedures, if so my tip could be useful. \nIn the procd script I added the home as a environment variable and that solved the problem for me.\nI know that a year has passed and you could already found an alternative solution, still I hope this comment could be useful for others.\nHave a good day.</p>\n"}], "owner": {"reputation": 1, "user_id": 9072000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49c13f39bea68789fec74e9d1d254771?s=128&d=identicon&r=PG&f=1", "display_name": "UmeshTangnu", "link": "https://stackoverflow.com/users/9072000/umeshtangnu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1577986113, "creation_date": 1549430478, "last_edit_date": 1549444144, "question_id": 54547081, "link": "https://stackoverflow.com/questions/54547081/process-spawned-by-daemon-dies-when-no-tty-present", "title": "Process spawned by Daemon dies when no TTY present", "body": "<p>I need to start reverse ssh tunnel from my openwrt system to my cloud machine.\nThe application on the openwrt system will run as daemon at startup.When it receives a specific code over the network it should spawn a process that starts a remote ssh tunnel.\nThere will be no logins in the system.</p>\n\n<p>I am using following code to do it.</p>\n\n<pre><code>   int spawn_orphan(char* cmd)\n{\n    char command[1024]; // We could segfault if cmd is longer than 1000 bytes or so\n    int pid;\n    int Stat;\n    pid = fork();\n    if (pid &lt; 0)\n    {\n        perror(\"FORK FAILED\\n\");\n        return pid;\n    }\n    if (pid == 0)\n    { // CHILD\n        setsid(); // Make this process the session leader of a new session\n        pid = fork();\n        if (pid &lt; 0)\n        {\n            printf(\"FORK FAILED\\n\");\n            return ( 1 );\n        }\n        if (pid == 0)\n        { // GRANDCHILD\n            sprintf(command, \"ash -c '%s'\", cmd);\n            execl(\"/bin/ash\", \"ash\", \"-c\", command, NULL); // Only returns on error\n            perror(\"execl failed\");\n            return ( 1 );\n        }\n        exit(0); // SUCCESS (This child is reaped below with waitpid())\n    }\n\n    // Reap the child, leaving the grandchild to be inherited by init\n    waitpid(pid, &amp;Stat, 0);\n    if ( WIFEXITED(Stat) &amp;&amp; ( WEXITSTATUS(Stat) == 0 ))\n    {\n        printf(\"dbclient exit\\n\");\n        return 0; // Child forked and exited successfully\n    }\n    else\n    {\n        perror(\"failed to spawn orphan\\n\");\n        return 1;\n    }\n}\n</code></pre>\n\n<p>this is my calling function</p>\n\n<pre><code>uint8_t rdsService(uint8_t state)\n{\n\n\n\n    char buffer[1024];\n\n    uint8_t retVal;\n    if(state )\n    {\n        retVal = spawn_orphan(\"dbclient -f -K -I -T -N -R 1500:localhost:22 -p 22 username@HOSTMACHINE -i ~/ctusr/keys/X1_ID_RSA -y\");\n\n\n    }\n    else\n    {\n\n\n        retVal = spawn_orphan(\"ash -c 'killall dbclient'\");\n\n\n    }\n\n    return retVal;\n\n}\n</code></pre>\n\n<p>If I run my parent application from console  the application is able to spawn the dbclient and I am able to do reverse ssh into the system.</p>\n\n<p>The problem occurs when I run the parent application as a Daemon, in this case the application spawns the dbclient,i can see it when i do 'ps' on console, but after a few seconds the dbclient is killed.</p>\n\n<p>I have already tried to run the dbclient with 'nohup'</p>\n\n<blockquote>\n  <p>nohup dbclient -f -K -I -T -N -R 1500:localhost:22 -p 22\n  Username@machine-i ~/ctusr/keys/X1_ID_RSA -y &amp;</p>\n</blockquote>\n\n<p>Works fine when I run the application from console but has same error when application is run as Daemon .</p>\n\n<p>Thanks for help</p>\n"}, {"tags": ["c", "scanf"], "comments": [{"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1549430564, "post_id": 54547043, "comment_id": 95894559, "body": "If scanf for a[i][j] fails, it will be left uninitialized. You shouldn&#39;t print its value on error."}, {"owner": {"reputation": 65, "user_id": 10554167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0R5BgZv-yaw/AAAAAAAAAAI/AAAAAAAAAV4/zQfYg93oeT0/photo.jpg?sz=128", "display_name": "The Virtuoso", "link": "https://stackoverflow.com/users/10554167/the-virtuoso"}, "reply_to_user": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1549430803, "post_id": 54547043, "comment_id": 95894621, "body": "I was just curious to see what happens I don&#39;t actually plan on printing it in the final program."}, {"owner": {"reputation": 1421, "user_id": 9672954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/50jXz.jpg?s=128&g=1", "display_name": "runwuf", "link": "https://stackoverflow.com/users/9672954/runwuf"}, "edited": false, "score": 0, "creation_date": 1549431316, "post_id": 54547043, "comment_id": 95894764, "body": "Hi @TheVirtuoso, can we see how exactly do you declare variable &#39;a&#39;?"}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549431601, "post_id": 54547043, "comment_id": 95894842, "body": "<a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feof-file-always-wrong\">Why is \u201cwhile ( !feof (file) )\u201d always wrong?</a>"}, {"owner": {"reputation": 65, "user_id": 10554167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0R5BgZv-yaw/AAAAAAAAAAI/AAAAAAAAAV4/zQfYg93oeT0/photo.jpg?sz=128", "display_name": "The Virtuoso", "link": "https://stackoverflow.com/users/10554167/the-virtuoso"}, "edited": false, "score": 0, "creation_date": 1549431846, "post_id": 54547043, "comment_id": 95894929, "body": "I declared it as a 2d array with integer entries with n lines and n columns, immediately after I read n I declare my array"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549432141, "post_id": 54547043, "comment_id": 95895044, "body": "@Swordfish -- and totally superfluous to the code presented -- the entire outer loop can be removed. You writing this one up?"}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1549433707, "post_id": 54547043, "comment_id": 95895558, "body": "@DavidC.Rankin <i>You writing this one up?</i> \u2013 Am I doing what? I&#39;m just allergic to <code>while (!feof(file))</code> and I guess the OP would use it elsewhere too, so I left the link."}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549434219, "post_id": 54547043, "comment_id": 95895751, "body": "@TheVirtuoso Once you read with <code>fgets()</code> the file pointer moves to the next line. So the following <code>fscanf()</code> will never see the data consumed by <code>fgets()</code>. If you want to read the values from <code>buffer</code> use <code>sscanf()</code>."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1549434960, "post_id": 54547043, "comment_id": 95896027, "body": "I just hoped you were..."}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1549436631, "post_id": 54547043, "comment_id": 95896661, "body": "@DavidC.Rankin Hoped I were what!? Don&#39;t you understand that I don&#39;t get what you are trying to tell me??"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549436746, "post_id": 54547043, "comment_id": 95896699, "body": "@Swordfish -- I was hoping you were going to write the answer so I could sit this one out <code>:)</code>"}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1549437276, "post_id": 54547043, "comment_id": 95896922, "body": "@DavidC.Rankin Sorry, I&#39;m not much of a writer these days."}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 10554167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0R5BgZv-yaw/AAAAAAAAAAI/AAAAAAAAAV4/zQfYg93oeT0/photo.jpg?sz=128", "display_name": "The Virtuoso", "link": "https://stackoverflow.com/users/10554167/the-virtuoso"}, "edited": false, "score": 0, "creation_date": 1549434673, "post_id": 54547567, "comment_id": 95895920, "body": "When you are talking about allocation you are you referring to using malloc() function for lines and columns and checking if memory was allocated correctly ? ( if pointer is not NULL )"}, {"owner": {"reputation": 22021, "user_id": 236222, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cf4f3c341534395199d4dbe35a432f9d?s=128&d=identicon&r=PG", "display_name": "Jay", "link": "https://stackoverflow.com/users/236222/jay"}, "reply_to_user": {"reputation": 65, "user_id": 10554167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0R5BgZv-yaw/AAAAAAAAAAI/AAAAAAAAAV4/zQfYg93oeT0/photo.jpg?sz=128", "display_name": "The Virtuoso", "link": "https://stackoverflow.com/users/10554167/the-virtuoso"}, "edited": false, "score": 0, "creation_date": 1549434757, "post_id": 54547567, "comment_id": 95895961, "body": "Yes. I am talking about dynamically allocating the space for array correctly. You haven&#39;t posted your complete code, so I included this."}, {"owner": {"reputation": 65, "user_id": 10554167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0R5BgZv-yaw/AAAAAAAAAAI/AAAAAAAAAV4/zQfYg93oeT0/photo.jpg?sz=128", "display_name": "The Virtuoso", "link": "https://stackoverflow.com/users/10554167/the-virtuoso"}, "edited": false, "score": 0, "creation_date": 1549434933, "post_id": 54547567, "comment_id": 95896021, "body": "Yeah I usually like working with dynamic allocation but here I got lazy and decided to try to make the program work as quickly as possible ( after I make it work I usually try to look for steps I could skip in my final program and try to optimize it as much as possible )"}, {"owner": {"reputation": 65, "user_id": 10554167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0R5BgZv-yaw/AAAAAAAAAAI/AAAAAAAAAV4/zQfYg93oeT0/photo.jpg?sz=128", "display_name": "The Virtuoso", "link": "https://stackoverflow.com/users/10554167/the-virtuoso"}, "edited": false, "score": 0, "creation_date": 1549435019, "post_id": 54547567, "comment_id": 95896044, "body": "Ohh forgot to mention it , thank you the fseek() part resolved me, I need to study that function some more since this is the first time I found the need to use it"}, {"owner": {"reputation": 22021, "user_id": 236222, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cf4f3c341534395199d4dbe35a432f9d?s=128&d=identicon&r=PG", "display_name": "Jay", "link": "https://stackoverflow.com/users/236222/jay"}, "reply_to_user": {"reputation": 65, "user_id": 10554167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0R5BgZv-yaw/AAAAAAAAAAI/AAAAAAAAAV4/zQfYg93oeT0/photo.jpg?sz=128", "display_name": "The Virtuoso", "link": "https://stackoverflow.com/users/10554167/the-virtuoso"}, "edited": false, "score": 0, "creation_date": 1549436097, "post_id": 54547567, "comment_id": 95896459, "body": "Most Welcome Virtuoso! :)"}, {"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1549440857, "post_id": 54547567, "comment_id": 95898443, "body": "<i>&quot;There is no need for you to do both fgets and fscanf. Only one is sufficient.&quot;</i>, I&#39;d go as far as to say, using <code>fscanf</code> and <code>fgets</code> together is almost always a bad idea. Sure, <code>fgets</code> could be used to read until end of line for example to recover from error, but it will still depend on line being short enough to fit in the buffer, so not reliable."}], "tags": [], "owner": {"reputation": 22021, "user_id": 236222, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cf4f3c341534395199d4dbe35a432f9d?s=128&d=identicon&r=PG", "display_name": "Jay", "link": "https://stackoverflow.com/users/236222/jay"}, "is_accepted": true, "score": 2, "last_activity_date": 1549433645, "last_edit_date": 1549433645, "creation_date": 1549433282, "answer_id": 54547567, "question_id": 54547043, "link": "https://stackoverflow.com/questions/54547043/how-to-fix-error-of-fscanf-checking-if-an-element-in-matrix-is-an-integer-or/54547567#54547567", "title": "How to fix error of fscanf(), checking if an element in matrix is an integer or not in C", "body": "<p><strong>Key Issue of your Code</strong>: Your FILE pointer doesn't move ahead when fscanf encounters an error. You need to move it ahead using fseek.</p>\n\n<blockquote>\n  <p>Some of the issues you need to look at:</p>\n  \n  <ul>\n  <li>How to allocate an array of sufficient size to read all inputs correctly</li>\n  <li>File based error handling and how to move the FILE pointer ahead if it hits an error while reading using fscanf. <em>My below code considers\n  only the specific case of a single incorrect character being present,\n  you will have to handle it appropriately if more than one character is\n  present.</em></li>\n  <li>There is no need for you to do both fgets and fscanf. Only one is sufficient.</li>\n  <li>Relook, if you really want to use fscanf. The same logic can be achieved using other read methods related to FILE.</li>\n  </ul>\n</blockquote>\n\n<p>Treat the below code <strong>strictly as a pseudo code</strong>, just giving some indications. This doesn't handle all conditions at all. You need to work on lot of aspects of your code and handle additional error conditions etc. I have just given a pointer on how you can solve it.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(void)\n{\n\n  FILE *f = fopen(\"./check.txt\", \"r\");\n  int a[3][3] = {0};\n  int n, res, i;\n\n  res = fscanf(f, \"%d\", &amp;n);\n\n  i = 0;\n  while(i&lt;n)\n  {\n    for(int j = 0; j &lt; n; j++)\n    {\n       int val = 0;\n       res = fscanf(f, \"%d\", &amp;val);\n       if ((res == 0) || (res == EOF))\n       {\n           printf(\"Error: res = %d for i = %d, j = %d, val = %d\\n\", res, i, j, val);\n           fseek(f, 1, SEEK_CUR);\n       }\n       else\n           a[i][j] = val;\n    }\n    i++;\n\n  }\n\n  printf(\"The Matrix\\n\");\n  for(int i = 0; i&lt;n; i++)\n  {\n    for (int j=0; j&lt;n; j++)\n        printf(\"%d \", a[i][j]);\n    printf(\"\\n\");\n  }\n\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>Error: res = 0 for i = 1, j = 1, val = 0\nThe Matrix\n12 3 87\n78 0 9\n45 0 23\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 65, "user_id": 10554167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0R5BgZv-yaw/AAAAAAAAAAI/AAAAAAAAAV4/zQfYg93oeT0/photo.jpg?sz=128", "display_name": "The Virtuoso", "link": "https://stackoverflow.com/users/10554167/the-virtuoso"}, "edited": false, "score": 0, "creation_date": 1549435351, "post_id": 54547894, "comment_id": 95896182, "body": "I would give you an up vote if I could but I have less than 15 rep points... sorry and thank you"}], "tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 3, "last_activity_date": 1549434908, "creation_date": 1549434908, "answer_id": 54547894, "question_id": 54547043, "link": "https://stackoverflow.com/questions/54547043/how-to-fix-error-of-fscanf-checking-if-an-element-in-matrix-is-an-integer-or/54547894#54547894", "title": "How to fix error of fscanf(), checking if an element in matrix is an integer or not in C", "body": "<p>First points:</p>\n\n<pre><code>while(!feof(file))\n{\n</code></pre>\n\n<p>You will want to look at <a href=\"http://stackoverflow.com/questions/5431941/why-is-while-feof-file-always-wrong\"><strong>Why is while ( !feof (file) ) always wrong?</strong></a>. Further, the entire outer loop is superfluous to your code and can simply be removed.</p>\n\n<p>With any of the <code>scanf</code> family of functions, when input does not match the <em>conversion specifier</em> used in the <em>format string</em>, a <em>matching failure</em> occurs, character extraction from the input stream stops at the point of failure, the offending characters causing the failure are left in the input stream (unread) just waiting to bite you on your next attempted read. Attempting to read <code>'a'</code> as type <code>int</code> with <code>scanf</code> produces a <em>matching failure</em>.</p>\n\n<p><strong>How To Handle A Matching Failure?</strong></p>\n\n<p>Since you always validate all user input, as you note, you detect an input failure with <code>scanf</code> when the return is less than the number of conversions specified (or <code>EOF</code>). Reading an integer at a time with <code>fscanf</code> within your loops tells you exactly where the input failure happened from a row/col standpoint when reading a square matrix worth of data. Knowing where the failure occurred you can output the row/col where the invalid data was encountered.</p>\n\n<p>To capture the invalid data for reporting purposes, you can simply scan forward with <code>fgetc</code> reading a character at a time and filling a buffer with the offending characters until the next valid <code>digit</code> or <code>+/-</code> (explicit sign for a digit) is encountered (you can use <code>ungetc</code> at that point to put the valid digit (or sign) back in the input stream if your wanted to continue reading additional values)</p>\n\n<p><strong>A Short Example</strong></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;ctype.h&gt;\n\n#define MAXC 1024\n\nint main (int argc, char **argv) {\n\n    int **m = NULL;\n    unsigned dim = 0;\n    /* use filename provided as 1st argument (stdin by default) */\n    FILE *fp = argc &gt; 1 ? fopen (argv[1], \"r\") : stdin;\n\n    if (!fp) {  /* validate file open for reading */\n        perror (\"file open failed\");\n        return 1;\n    }\n\n    if (fscanf (fp, \"%u\", &amp;dim) != 1) { /* read square mtrx dim */\n        fputs (\"error: invalid format, no dimension.\\n\", stderr);\n        return 1;\n    }\n\n    if (!(m = malloc (dim * sizeof *m))) {  /* allocate/validate dim ptrs */\n        perror (\"malloc-m\");\n        return 1;\n    }\n\n    for (unsigned i = 0; i &lt; dim; i++)   /* allocate dim rows of dim int */\n        if (!(m[i] = calloc (dim, sizeof *m[i]))) { /* zero mem w/calloc */\n            perror (\"calloc-m[i]\");\n            return 1;\n        }\n\n    for (unsigned i = 0; i &lt; dim; i++)              /* for each row */\n        for (unsigned j = 0; j &lt; dim; j++) {        /* for each col */\n            if (fscanf (fp, \"%d\", &amp;m[i][j]) != 1) { /* read/validate int */\n                char buf[MAXC], *p = buf;   /* buf and ptr to buf */\n                int c;                      /* int for char */\n                /* read while !EOF, not digit and not -/+ */\n                while ((c = fgetc(fp)) != EOF &amp;&amp; (c &lt; '0' || '9' &lt; c) &amp;&amp;\n                        c != '-' &amp;&amp; c != '+')\n                    if (!isspace(c))    /* if not a space */\n                        *p++ = c;       /* store offending char(s) */\n                *p = 0;                 /* nul-terminate buf */\n                if (c != EOF)           /* if c a char - put it back */\n                    ungetc(c, fp);\n                /* output location of invalid input */\n                printf (\"error: m[%d][%d] - invalid entry '%s'.\\n\",\n                        i, j, buf);\n                return 1;   /* and bail - or continue -- your choice */\n            }\n        }\n    if (fp != stdin) fclose (fp);   /* close file if not stdin */\n\n    for (unsigned i = 0; i &lt; dim; i++) {    /* for each row */\n        for (unsigned j = 0; j &lt; dim; j++)  /* for each col */\n            printf (\" %3d\", m[i][j]);       /* output value */\n        putchar ('\\n');                     /* output newline */\n        free (m[i]);                        /* free ints in row */\n    }\n    free (m);   /* free pointers */\n\n    return 0;\n}\n</code></pre>\n\n<p>(<strong>note:</strong> you didn't say how you allocated storage, so a simple <em>pointer to pointer to</em> <code>int</code> was used to allocate <code>dim</code> pointers and a block of <code>dim</code> integers was allocated and the starting address for each allocation assigned to each of the pointer to allow indexing as a 2D array)</p>\n\n<p><strong>Example Input Files</strong></p>\n\n<p>Using your example input with invalid <code>int</code> at <code>[1][1]</code>:</p>\n\n<pre><code>$ cat ~/tmpd/mtrx.txt\n3\n12 3 87\n78 a 9\n45 0 23\n</code></pre>\n\n<p>An example with good values:</p>\n\n<pre><code>$ cat ~/tmpd/mtrxgood.txt\n3\n12 3 87\n78 8 9\n45 0 23\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<p>With invalid <code>int</code> at <code>[1][1]</code>:</p>\n\n<p>The program correctly reports the location and the offending character:</p>\n\n<pre><code>$ ./bin/readsquaremtrx ~/tmpd/mtrx.txt\nerror: m[1][1] - invalid entry 'a'.\n</code></pre>\n\n<p>With good values, all values are read and the matrix printed to the screen before all allocated memory is freed:</p>\n\n<pre><code>$ ./bin/readsquaremtrx ~/tmpd/mtrxgood.txt\n  12   3  87\n  78   8   9\n  45   0  23\n</code></pre>\n\n<p>The code is commented to help you follow along. If you have any questions, just let me know.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "is_accepted": false, "score": 1, "last_activity_date": 1549438667, "last_edit_date": 1549438667, "creation_date": 1549436981, "answer_id": 54548319, "question_id": 54547043, "link": "https://stackoverflow.com/questions/54547043/how-to-fix-error-of-fscanf-checking-if-an-element-in-matrix-is-an-integer-or/54548319#54548319", "title": "How to fix error of fscanf(), checking if an element in matrix is an integer or not in C", "body": "<p>Another example using a flat memory region instead of a somwhat inefficient \"array\" of pointers to pointers:</p>\n\n<pre><code>#include &lt;stddef.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nint is_magic_square(int *square, size_t dimension)\n{\n    if(dimension &lt; 3) {\n        return 0;\n    }\n\n    int prev_row_sum;\n    int prev_col_sum;\n    int d1_sum = 0;\n    int d2_sum = 0;\n\n    for (size_t y = 0; y &lt; dimension; ++y) {\n        int curr_row_sum = 0;\n        int curr_col_sum = 0;\n        for (size_t x = 0; x &lt; dimension; ++x) {\n            curr_row_sum += square[y * dimension + x];\n            curr_col_sum += square[x * dimension + y];\n\n            if (x == y) {\n                d1_sum += square[y * dimension + x];\n                d2_sum += square[y * dimension + dimension - 1 - x];\n            }\n        }\n\n        if (y &amp;&amp; (curr_row_sum != prev_row_sum || curr_col_sum != prev_col_sum)) {\n            return 0;\n        }\n\n        prev_row_sum = curr_row_sum;\n        prev_col_sum = curr_col_sum;\n    }\n\n    return prev_row_sum == d1_sum &amp;&amp; prev_row_sum == d2_sum ? prev_row_sum : 0;\n}\n\nint main(void)\n{\n    char const *filename = \"test.txt\";\n    FILE *input = fopen(filename, \"r\");\n    if (!input) {\n        fprintf(stderr, \"Couldn't open \\\"%s\\\" for reading :(\\n\\n\", filename);\n        return EXIT_FAILURE;\n    }\n\n    size_t dimension;\n    if (fscanf(input, \" %zu\", &amp;dimension) != 1) {\n        fprintf(stderr, \"Faild to read squares dimensions from \\\"%s\\\" :(\\n\\n\", filename);\n        fclose(input);\n        return EXIT_FAILURE;\n    }\n\n    int result = EXIT_FAILURE;\n    printf(\"Reading a %zu x %zu square from \\\"%s\\\" ...\\n\\n\", dimension, dimension, filename);\n\n    int *square = calloc(dimension * dimension, sizeof(*square));\n    if (!square) {\n        fputs(\"Not enough memory :(\\n\\n\", stderr);\n        goto cleanup;\n    }\n\n    for (size_t y = 0; y &lt; dimension; ++y, putchar('\\n')) {\n        for (size_t x = 0; x &lt; dimension; ++x) {\n            int value;\n            if (fscanf(input, \" %d\", &amp;value) != 1 || value &lt; 1) {\n                fprintf(stderr, \"\\n\\nFailed to read value at (%zu, %zu) from \\\"%s\\\" :(\\n\\n\",\n                        x + 1, y + 1, filename);\n                goto cleanup;\n            }\n\n            for (size_t pos = 0; pos &lt; y * dimension + x; ++pos) {\n                if (square[pos] == value) {\n                    fprintf(stderr, \"\\n\\nDuplicate value %d found at (%zu, %zu) in \\\"%s\\\" :(\\n\\n\",\n                            value, x + 1, y + 1, filename);\n                    goto cleanup;\n                }\n            }\n\n            if(value &gt; dimension * dimension) {\n                fprintf(stderr, \"\\n\\nValue %d at (%zu, %zu) in \\\"%s\\\" is out of range 1, 2, ..., %zu^2 :(\\n\",\n                        value, x + 1, y + 1, filename, dimension);\n                goto cleanup;\n            }\n\n            printf(\"%4d \", value);\n            square[y * dimension + x] = value;\n        }\n    }\n\n    int sum = is_magic_square(square, dimension);\n    printf(\"\\nThis %s a perfect square!\\n\", sum ? \"is\" : \"is not\");\n\n    if (sum) {\n        printf(\"It's sum is %d.\\n\", sum);\n    }\n\n    putchar('\\n');\n    result = EXIT_SUCCESS;\n\ncleanup:\n    free(square);\n    fclose(input);\n    return result;\n}\n</code></pre>\n\n<h3>Sample Input:</h3>\n\n<pre class=\"lang-none prettyprint-override\"><code>4\n10    3   13    8\n 5   16    2   11\n 4    9    7   14\n15    6   12    1\n</code></pre>\n\n<h3>Sample Output:</h3>\n\n<pre class=\"lang-none prettyprint-override\"><code>Reading a 4 x 4 square from \"test.txt\" ...\n\n  10    3   13    8\n   5   16    2   11\n   4    9    7   14\n  15    6   12    1\n\nThis is a perfect square!\nIt's sum is 34.\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 10554167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0R5BgZv-yaw/AAAAAAAAAAI/AAAAAAAAAV4/zQfYg93oeT0/photo.jpg?sz=128", "display_name": "The Virtuoso", "link": "https://stackoverflow.com/users/10554167/the-virtuoso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 552, "favorite_count": 0, "accepted_answer_id": 54547567, "answer_count": 3, "score": 0, "last_activity_date": 1549438667, "creation_date": 1549430242, "last_edit_date": 1549431725, "question_id": 54547043, "link": "https://stackoverflow.com/questions/54547043/how-to-fix-error-of-fscanf-checking-if-an-element-in-matrix-is-an-integer-or", "title": "How to fix error of fscanf(), checking if an element in matrix is an integer or not in C", "body": "<p>I am tasked with reading a matrix from a text file and find out if it is a magic square, I also have to make sure that all the entries of the matrix are integers and if not I have to write to the standard output an ERROR message while also describing the position where this error occurred.</p>\n\n<p>Now, I succeeded in reading all the elements of matrix but I have a problem with the verification if it is an integer or not.</p>\n\n<p>I used fscanf() because I know that on success it returns the number of elements it succeeded reading correctly and returns EOF or 0 otherwise.</p>\n\n<p>Here is the matrix:</p>\n\n<pre><code>3\n12 3 87\n78 a 9\n45 0 23\n</code></pre>\n\n<p>first element is the number of rows and columns.</p>\n\n<p>and here is my code ( the part I need help with at least )</p>\n\n<pre><code>while(!feof(file))\n{\n    while ( fgets(buffer, sizeof(buffer), file) )\n    {\n\n        for ( int j = 0; j &lt; n; j++ )\n        {\n            if ( i == n )\n            {\n                break;\n            }\n\n            m = fscanf(file, \"%d\", &amp;a[i][j]);\n            printf(\"\\n%d\", m);\n\n            if ( m == 0 || m == EOF )\n            {\n                printf(\"\\nERROR, %d, %d, %d \\n\", i, j, a[i][j]);\n            }\n\n        }\n        i++; \n\n    }\n\n\n\n}\n</code></pre>\n\n<p>and here is my output ( right now I'm just trying to figure out this problem so this is not how it will look later on ):</p>\n\n<pre><code>1\n1\n1\n1\n0\nERROR, 1, 1, 0\n\n0\nERROR, 1, 2, 48\n\n1\n1\n1\n12 3 87\n78 0 48\n45 0 23\n</code></pre>\n\n<p>When I replace 'a' with a number of type (float) for example it will display the ERROR message just for a[1][1] BUT it will replace 9 with 48.</p>\n\n<p>When I have a character ( like in this case ) it will display an ERROR message both for a[1][1] ('a') and a[1][2] ('9') and replace it too. </p>\n\n<p>And my question is why does this happen and what the hell happens between a[1][1] and a[1][2] and how to fix it.</p>\n\n<p>EDIT:I know I could simply exit the program when I find 1 case but I'm really curious on why does this error happen.</p>\n\n<pre><code>fscanf(file, \"%d\", &amp;n );//I read the first integer, which is also the maximum  capacity of my 2d array\n\nint a[n][n];\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 1291, "user_id": 8658157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DwurD.png?s=128&g=1", "display_name": "Elliott", "link": "https://stackoverflow.com/users/8658157/elliott"}, "edited": false, "score": 2, "creation_date": 1549422880, "post_id": 54546062, "comment_id": 95892814, "body": "Your exit condition for your for loop should be &quot;i &lt;= amount&quot;, not &quot;i = amount&quot;"}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 2, "creation_date": 1549422984, "post_id": 54546062, "comment_id": 95892840, "body": "You seem to default to using global variables, and <code>float</code> ones at that. I highly recommend you default to local integer variables."}, {"owner": {"reputation": 1291, "user_id": 8658157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DwurD.png?s=128&g=1", "display_name": "Elliott", "link": "https://stackoverflow.com/users/8658157/elliott"}, "edited": false, "score": 2, "creation_date": 1549423119, "post_id": 54546062, "comment_id": 95892863, "body": "Also, your &quot;default&quot; case in the switch should have &quot;return&quot; in there, as otherwise it goes to the printf when a and course1 are undefined (or not updated)."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1549424963, "post_id": 54546062, "comment_id": 95893207, "body": "<code>%i</code> is (almost) always wrong, you want to use <code>%d</code>."}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1549428224, "post_id": 54546062, "comment_id": 95893894, "body": "@AnttiHaapala &quot;Wrong&quot; is such a strong word. One should just be aware that <code>%i</code> interprets input prefixed with <code>0x</code> as hex and input prefixed with <code>0</code> as octal. And it&#39;s also quite hard to confuse them ... general <code>&quot;%i&quot;</code>nteger, but <code>%d</code>ecimal."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1549444610, "post_id": 54546062, "comment_id": 95900195, "body": "Hence the (almost). It certainly wasn&#39;t intended here, or does one need to enter octal numbers very often as course ids"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "is_accepted": true, "score": 1, "last_activity_date": 1549423918, "last_edit_date": 1549423918, "creation_date": 1549423011, "answer_id": 54546144, "question_id": 54546062, "link": "https://stackoverflow.com/questions/54546062/calling-functions-multiple-times-with-different-values-within-the-same-function/54546144#54546144", "title": "Calling functions multiple times with different values within the same function", "body": "<p>Avoid global variables. Declare/define variables as close to where they're used as possible. In <code>CourseInfo()</code> you are using <code>a</code> uninitialized if the <code>myCourse</code> passed to the function does not match a <code>case</code>. Dereferencing an invalid pointer value is undefined behaviour in C and C++. Also the 2nd conversion specifier \"%c\" of the format string within the call to <code>printf()</code> inside <code>CourseInfo()</code> does not match the parameter passed (<code>a</code>), which is a pointer to <code>char</code> - format <code>\"%s\"</code>.</p>\n\n<p>Also</p>\n\n<blockquote>\n<pre><code>scanf(\"%i %i %i\", &amp;course, &amp;course1, &amp;course2);\n</code></pre>\n</blockquote>\n\n<p>is undefined behaviour since the three parameters are <code>float</code>s, not <code>int</code>s. The types of the parameters must match the conversion specifiers of the format string.</p>\n\n<blockquote>\n<pre><code>for(i = 1; i = amount; i++){\n    printf(\"Enter the %.2f course number(s)\\n\", amount);\n    scanf(\"%i %i %i\", &amp;course, &amp;course1, &amp;course2);\n    courseInfo(course);\n    courseInfo(course1);\n    courseInfo(course2);\n}\n</code></pre>\n</blockquote>\n\n<p>To ask the user to enter up to three courses:</p>\n\n<pre><code>int amount;\n\n// ...\n\nprintf(\"Enter the %i course number(s):\\n\", amount);\n\nfor (int i = 0; i &lt; amount; ++i) {\n    int course;\n    if (scanf(\" %i\", &amp;course) == 1)\n        courseInfo(course);    \n}\n</code></pre>\n\n<p>If you want to save the course numbers for further use, use an array of <code>int</code>, make sure you don't write more elements than the size of that array and use it in the <code>for</code>-loop:</p>\n\n<pre><code>int courses[amount] = { 0 };  // initialize with all zeros to be able to tell\n                              // later if a input operation failed.\n\nfor (int i = 0; i &lt; amount; ++i) {\n    int course;\n    if (scanf(\" %i\", &amp;courses[i]) == 1)\n        courseInfo(course);    \n}\n</code></pre>\n\n<p>With your current design there is no way of knowing outside of <code>courseInfo()</code> if a given course number is valid. Perhaps <code>courseInfo()</code> should return a <code>bool</code> (<code>&lt;stdbool.h&gt;</code>) depending on wheter the passed value is valid.</p>\n"}, {"tags": [], "owner": {"reputation": 1190, "user_id": 3344587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d246b94ff48978d81b706630d0102196?s=128&d=identicon&r=PG&f=1", "display_name": "Loc Tran", "link": "https://stackoverflow.com/users/3344587/loc-tran"}, "is_accepted": false, "score": 0, "last_activity_date": 1549423013, "creation_date": 1549423013, "answer_id": 54546145, "question_id": 54546062, "link": "https://stackoverflow.com/questions/54546062/calling-functions-multiple-times-with-different-values-within-the-same-function/54546145#54546145", "title": "Calling functions multiple times with different values within the same function", "body": "<p>change for loop</p>\n\n<pre><code>for(i = 1; i = amount; i++){\n</code></pre>\n\n<p>to </p>\n\n<pre><code>for(i = 1; i &lt;= amount; i++){\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 10372764, "user_type": "registered", "profile_image": "https://graph.facebook.com/2103173239741612/picture?type=large", "display_name": "Aidan Agee", "link": "https://stackoverflow.com/users/10372764/aidan-agee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 662, "favorite_count": 0, "accepted_answer_id": 54546144, "answer_count": 2, "score": -1, "last_activity_date": 1549999323, "creation_date": 1549422245, "last_edit_date": 1549999323, "question_id": 54546062, "link": "https://stackoverflow.com/questions/54546062/calling-functions-multiple-times-with-different-values-within-the-same-function", "title": "Calling functions multiple times with different values within the same function", "body": "<p>Ive tried just making a lot of lines of different variables for entering courses, then the courses being assigned to credits and output on a receipt. But instead of having the 300+ lines of switches I wanted to make a switch function that I could call. I figured I would make a for loop to run the switch function based on the amount of courses the person chose, but when I run it the code seems to just run forever without even hitting a return 0 to end the program. Any tips for calling the function or if im doing it poorly?</p>\n\n<pre><code>int studentId, var, i;\nfloat first;\nint course, course1, course2;\nfloat second, amount;\nfloat credit1, credit2, credit3, credit4, credit5, credit6, credit7, credit8;\nfloat paymentA, paymentB, paymentC, paymentD, total;\nfloat creditA, creditB;\nchar *a;\n\n\nvoid courseInfo(int myCourse){\n    switch(myCourse)\n    {\n             case 4587:\n                credit1 = 4;\n                a = \"MAT 236\";\n                break;\n            case 4599:\n                credit1 = 3;\n                a = \"COP 220\";\n                break;\n            case 8997:\n                credit1 = 1;\n                a = \"GOL 124\";\n                break;\n            case 9696:\n                credit1 = 3;\n                a = \"COP 100\";\n                break;\n            case 4580:\n                credit1 = 3;\n                a = \"MAT 230\";\n                break;\n            case 4581:\n                credit1 = 4;\n                a = \"MAT 231\";\n                break;\n            case 4582:\n                credit1 = 2;\n                a = \"MAT 232\";\n                break;\n            case 4583:\n                credit1 = 2;\n                a = \"MAT 233\";\n                break;\n            case 3587:\n                credit1 = 4;\n                a = \"MAT 256\";\n                break;\n            case 4519:\n                credit1 = 3;\n                a = \"COP 420\";\n                break;\n            case 6997:\n                credit1 = 1;\n                a = \"GOL 127\";\n                break;\n            case 9494:\n                credit1 = 3;\n                a = \"COP 101\";\n                break;\n            default:\n                printf(\"Sorry invalid entry!\\n\\n\");\n                }\n        printf(\"%.2d\\t%.2c\\t%.2f\\t\\t$ %.2f\\n\", course, a, credit1 , credit1*120.25);\n}\n\nint main()\n{\n\n\n/*taking in the variables amounts*/\n\n\n\n\n\nprintf(\"Please enter Student ID:\\n\");\nscanf(\"%i\", &amp;studentId);\nprintf(\"Enter how may courses-up to 3:\\n\");\nscanf(\"%f\", &amp;amount);\n\nfor(i = 1; i = amount; i++){\n    printf(\"Enter the %.2f course number(s)\\n\", amount);\n    scanf(\"%i %i %i\", &amp;course, &amp;course1, &amp;course2);\n    courseInfo(course);\n    courseInfo(course1);\n    courseInfo(course2);\n    }\n</code></pre>\n\n<p>I just wanted the input to say 3 courses for example, you would input the 3 courses CRNs you wanted to take, it would run into the function and then print out the prices and what you were taking, then repeat the loop for the next 3. I figured if nothing was input like if someone chose 1 course, the course1 and course2 variables would not be assigned a value thus skipping the switch</p>\n"}, {"tags": ["c", "shell", "posix"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 2, "creation_date": 1549421532, "post_id": 54545813, "comment_id": 95892538, "body": "Using <code>printf()</code> in a signal handler is undefined, btw. And you should read the manpage for <code>waitpid()</code> again, paying attention to the section on the options argument."}, {"owner": {"reputation": 2435, "user_id": 9768291, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gf9Xz.jpg?s=128&g=1", "display_name": "payne", "link": "https://stackoverflow.com/users/9768291/payne"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1549425912, "post_id": 54545813, "comment_id": 95893407, "body": "@Shawn you helped me out, thank you! Feel free to post about how <code>WUNTRACED</code> was the flag that I needed in <code>waitpid</code> and I&#39;ll mark it as the answer. :)"}], "answers": [{"tags": [], "owner": {"reputation": 24693, "user_id": 10190237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f95f50f67af8a9658c5d76df263b323?s=128&d=identicon&r=PG&f=1", "display_name": "P.W", "link": "https://stackoverflow.com/users/10190237/p-w"}, "is_accepted": true, "score": 3, "last_activity_date": 1549430122, "creation_date": 1549430122, "answer_id": 54547029, "question_id": 54545813, "link": "https://stackoverflow.com/questions/54545813/using-kill-to-trigger-a-parents-waitpid/54547029#54547029", "title": "Using `kill` to trigger a parent&#39;s `waitpid`", "body": "<p><code>printf</code> is not an <a href=\"http://man7.org/linux/man-pages/man7/signal-safety.7.html\" rel=\"nofollow noreferrer\">async-signal-safe</a> function (as it is not re-entrant) and therefore must not be used in a signal handler. Using such functions will lead to undefined behavior.</p>\n\n<p>If you want a child process that is not traced with <code>ptrace</code> to return, you have to specify the <code>WUNTRACED</code> option when you use <a href=\"https://linux.die.net/man/2/waitpid\" rel=\"nofollow noreferrer\"><code>waitpid</code></a>.</p>\n\n<p>Alternatively, you can use <a href=\"https://linux.die.net/man/2/ptrace\" rel=\"nofollow noreferrer\"><code>ptrace</code></a> with the <code>PTRACE_TRACEME</code> option, so that it will provide status for the child process even if the <code>WUNTRACED</code> option is not specified in the <code>waitpid</code> call.</p>\n"}], "owner": {"reputation": 2435, "user_id": 9768291, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gf9Xz.jpg?s=128&g=1", "display_name": "payne", "link": "https://stackoverflow.com/users/9768291/payne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 54547029, "answer_count": 1, "score": 6, "last_activity_date": 1549460564, "creation_date": 1549420017, "last_edit_date": 1549460564, "question_id": 54545813, "link": "https://stackoverflow.com/questions/54545813/using-kill-to-trigger-a-parents-waitpid", "title": "Using `kill` to trigger a parent&#39;s `waitpid`", "body": "<p>I'm using <code>sigaction(SIGTSTP, &amp;ctrlz_signal, NULL);</code> to ensure I can catch <code>Ctrl-Z</code>.</p>\n\n<pre><code>void ctrlz_signal(int sigNo) {\n    printf(\"Caught Ctrl-Z  |  curr_chld=%d\\n\", CURR_CHILD);\n    if(CURR_CHILD != 0) kill(CURR_CHILD, SIGTSTP);\n}\n</code></pre>\n\n<p><code>CURR_CHILD</code> is set through forking:</p>\n\n<pre><code>    sigaction(SIGTSTP, &amp;ctrlz_signal, NULL);\n\n    int         status;\n    CURR_CHILD = fork();\n\n\n    if (CURR_CHILD &lt; 0) {\n        // ...\n\n    } else if (CURR_CHILD == 0) {  // child\n        // exec(...)\n\n    } else {  // back in parent\n        waitpid(CURR_CHILD, &amp;status, 0);  // wait for child to finish\n        // ...\n    }\n</code></pre>\n\n<p>It seems like it successfully stops the child process, but then it doesn't trigger the parent's <code>waitpid</code>. I would've thought there would be a signal sent to the parent when I'd use this <code>kill</code> function, but it seems like it isn't since my \"shell\" gets stuck on that <code>waitpid</code> line.</p>\n\n<p>How do I make it so that, once <code>Ctrl-Z</code> is pressed, the process running an <code>exec</code> command (which is a child, at that point) should be put in the background (stopped), and then the parent process should gain back its control over the flow of the program ?</p>\n"}, {"tags": ["c", "visual-studio-code", "vscode-settings", "vscode-debugger", "libsass"], "comments": [{"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549424114, "post_id": 54545810, "comment_id": 95893026, "body": "<i>How to debug libsass library in vscode?</i> \u2013 with a smile on your face. Seriously, why not just use Visual Studio and don&#39;t be bugged by trying to configure VSCode?"}, {"owner": {"reputation": 543, "user_id": 6861838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/2ELHa.png?s=128&g=1", "display_name": "vbrin27", "link": "https://stackoverflow.com/users/6861838/vbrin27"}, "reply_to_user": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549430500, "post_id": 54545810, "comment_id": 95894544, "body": "Even if you have a great intellect, your sarcastic comments won&#39;t help me :) @Swordfish"}, {"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549430686, "post_id": 54545810, "comment_id": 95894593, "body": "Your comment <i><code>&#47;&#47;sassc.exe path</code></i> made me assume you are on Windows. My comment above ... I&#39;ve seen so many people struggle to configure VS Code. ... you have my wholearted sympathy."}], "owner": {"reputation": 543, "user_id": 6861838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/2ELHa.png?s=128&g=1", "display_name": "vbrin27", "link": "https://stackoverflow.com/users/6861838/vbrin27"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549430323, "creation_date": 1549419992, "last_edit_date": 1549430323, "question_id": 54545810, "link": "https://stackoverflow.com/questions/54545810/how-to-debug-libsass-library", "title": "How to debug libsass library?", "body": "<p>I have cloned libsass and sassc and compiled it manually using makefile to generate its executable. Everything works just fine But I need to debug the libsass library to do some changes. I am using VSCode in Mac.</p>\n\n<p>For a simple helloworld program, when I configure launch.json   to execute its executable, the breakpoint works just fine. But for sassc it is not working. </p>\n\n<p>This is the launch.json file am using in VSCode. Should I make any changes in this or should I understand something else? </p>\n\n<pre><code>{\n// Use IntelliSense to learn about possible attributes.\n// Hover to view descriptions of existing attributes.\n// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387\n\"version\": \"0.2.0\",\n\"configurations\": [\n    {\n        \"name\": \"(lldb) Launch\",\n        \"type\": \"cppdbg\",\n        \"request\": \"launch\",\n        \"program\": \"${workspaceFolder}/sassc/bin/sassc\", //sassc.exe path\n        \"args\": [\"${workspaceFolder}/ex/sample.scss\",\"${workspaceFolder}/ex/sample.css\"],\n        \"stopAtEntry\": false,\n        \"cwd\": \"${workspaceFolder}\",\n        \"environment\": [],\n        \"externalConsole\": false,\n        \"MIMode\": \"lldb\"\n    }\n]\n}\n</code></pre>\n\n<p>Edit:</p>\n\n<p>I am using Mac and as per <a href=\"https://social.msdn.microsoft.com/Forums/en-US/ef99e9f5-2a48-423b-b6c0-fa5617d7c63d/how-do-i-get-c-to-work-on-visual-studio-for-mac?forum=visualstudiogeneral\" rel=\"nofollow noreferrer\">https://social.msdn.microsoft.com/Forums/en-US/ef99e9f5-2a48-423b-b6c0-fa5617d7c63d/how-do-i-get-c-to-work-on-visual-studio-for-mac?forum=visualstudiogeneral</a>, C/C++ project is not yet supported in Mac Visual Studio and I am not gonna use VM. So either I had to use XCode or VSCode as per my knowledge and since VSCode is lightweight and I have worked with it before, I opted for VSCode. If you have any other suggestions, let me know.</p>\n"}, {"tags": ["c", "algorithm", "binary-search", "binary-data"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1549418595, "post_id": 54545451, "comment_id": 95891960, "body": "Are you using C or C++? Pick one and adjust tags appropriately."}, {"owner": {"reputation": 1, "user_id": 11020521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Y3fDPFuOgr0/AAAAAAAAAAI/AAAAAAAAAEA/3q2UM_TlWhg/photo.jpg?sz=128", "display_name": "fabian galicia", "link": "https://stackoverflow.com/users/11020521/fabian-galicia"}, "reply_to_user": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1549419525, "post_id": 54545451, "comment_id": 95892123, "body": "i am using C in the code"}], "answers": [{"comments": [{"owner": {"reputation": 2649, "user_id": 4022617, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/nk22l.png?s=128&g=1", "display_name": "dgnuff", "link": "https://stackoverflow.com/users/4022617/dgnuff"}, "edited": false, "score": 0, "creation_date": 1549425007, "post_id": 54546231, "comment_id": 95893219, "body": "Could the initialization be optimized by declaring <code>count</code> as <code>int[max_len][char_count]</code>, removing the <code>for i=0:char_count:</code> loop, and then just iterating over the string, first using <code>memcpy()</code> to copy the previous column to the current, and then just adding one to the approriate row in the current column."}, {"owner": {"reputation": 2837, "user_id": 5131287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b075fe47cb28e2f62deabe058769ea9?s=128&d=identicon&r=PG&f=1", "display_name": "xashru", "link": "https://stackoverflow.com/users/5131287/xashru"}, "reply_to_user": {"reputation": 2649, "user_id": 4022617, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/nk22l.png?s=128&g=1", "display_name": "dgnuff", "link": "https://stackoverflow.com/users/4022617/dgnuff"}, "edited": false, "score": 0, "creation_date": 1549425230, "post_id": 54546231, "comment_id": 95893268, "body": "it will still need to copy the last column. But in practice it should be faster."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1549472105, "post_id": 54546231, "comment_id": 95917053, "body": "That requires an array with 26 million entries (actually 36 million since OP says alphanumeric and perhaps 62 million, if input is case sensitive.) That&#39;s almost certainly too big for a stack allocation, so malloc will be needed. (I know it&#39;s pseudocode but the warning seemed pertinent.)"}], "tags": [], "owner": {"reputation": 2837, "user_id": 5131287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b075fe47cb28e2f62deabe058769ea9?s=128&d=identicon&r=PG&f=1", "display_name": "xashru", "link": "https://stackoverflow.com/users/5131287/xashru"}, "is_accepted": false, "score": 0, "last_activity_date": 1549423775, "creation_date": 1549423775, "answer_id": 54546231, "question_id": 54545451, "link": "https://stackoverflow.com/questions/54545451/appearance-of-characters-in-substrings/54546231#54546231", "title": "Appearance of characters in substrings", "body": "<p>Since you only have fixed number of characters you can calculate the count of each character starting from index <code>0</code>. Once you do that you just need to check if the count has increased for that character from <code>I</code>to  <code>T</code>. Pseudo-code follows</p>\n\n<pre><code>char_count = 26 # I am assuming only lower case letter, but change it if its not\nmax_len = 1000000  # maximum length of string\ncount = int[char_count][max_len]  # 2D array storing cumulative count for each character, fill with 0\n\n# read the string s\n# populate the count array\ncount[s[0]][0] = 1  # set count 1 for first character in S\nfor i=0:char_count:\n    for j=1:len(s):\n        if s[j] == char[i]:  # equals i-th character\n            count[i][j] = count[i][j-1]+1\n        else:\n            count[i][j] = count[i][j-1]\n\n# for each query do following \nfor q=0:num_queries:\n    if count[C][T] != count[C][I]:\n        print(1)\n    else:\n        print(0)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11020521, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Y3fDPFuOgr0/AAAAAAAAAAI/AAAAAAAAAEA/3q2UM_TlWhg/photo.jpg?sz=128", "display_name": "fabian galicia", "link": "https://stackoverflow.com/users/11020521/fabian-galicia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549423775, "creation_date": 1549416338, "last_edit_date": 1549421183, "question_id": 54545451, "link": "https://stackoverflow.com/questions/54545451/appearance-of-characters-in-substrings", "title": "Appearance of characters in substrings", "body": "<p>Given an S string of characters, write a program that responds correctly if character C appears in the substring of S that starts at position I and has length T.</p>\n\n<p>entry<br>\nThe S string formed of alphanumeric characters and of length at most 1,000,000. Subsequently an integer N followed by N triplets C, I, T. You can assume that 1\u2264N\u226410,000 that 0\u2264I &lt;| S | and 1\u2264T\u2264 | S | -I.</p>\n\n<p>exit<br>\nFor each question, a line with a 1 if the character appears in the indicated substring and 0 otherwise.</p>\n\n<p>My idea was to implement a binary search but the judge that qualifies it says that it goes beyond the expected time and I do not know how to optimize it to the degree that the judge accepts my algorithm. For example, an entry could be:</p>\n\n<pre><code>how are you\n3\nh 0 3\n1\no 2 5\n1\na 4 4\n0 \n</code></pre>\n\n<p>My code:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint busqcadena(char cadena[], int a[],char x,int pos,int n);\n\nint main()\n{\n    char cadena[1000000]; \n    char c;\n    int t = 0, i; \n    int pos, lon, a[1000000], j = 0;\n    do{\n        fflush(stdin);\n        c = getchar();\n        cadena[i++] = c;\n        a[j] = j;\n        j++;\n    } while (c != '\\n');\n    cadena[ i - 1 ] = '\\0'; \n\n    scanf(\"%d\",&amp;t);\n    for( int k = 0; k &lt; t; k++){\n    char pa; pos = 0; lon = 0;\n    scanf(\"%s %d %d\",&amp;pa, &amp;pos, &amp;lon);\n    int busq3 = busqcadena(cadena,a,pa,pos,lon);\n    if( busq3 != -1){\n        printf(\"1\\n\");\n    }else{\n        printf(\"0\\n\");\n    } \n}\n    return 0; \n}\n\nint busqcadena(char cadena[], int arr[],char x,int pos,int n){\n    int a = 0, b = n - 1;\n    while( a &lt;= b ){\n        int k = (a+b)/2;\n        if( cadena[k] == x &amp;&amp; arr[k] == pos){\n            return arr[k]; \n        }\n        if( arr[k] &gt; pos ) b = k - 1;\n        else a = k + 1;\n    }\n    return -1;\n}\n</code></pre>\n"}, {"tags": ["c", "embedded"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1549415457, "post_id": 54545041, "comment_id": 95891424, "body": "As this is efficient, most complilers are more then enough to inline simple <code>static inline int INPUT02(void) { return INPUT_ARRAY[0]; }</code> function. Such functions are nowadays preferred over macros, as they don&#39;t pollute the code so much and allow some obfuscating and more readability, which in the long run is way more valuable then efficiency."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1549443927, "post_id": 54545041, "comment_id": 95899825, "body": "What do you mean &quot;mapped&quot;? Memory-mapped? DMA? Manual copy? What? Of course this will be much slower than reading directly from the GPIO registers. In general, trying to be clever with some abstraction layer above plain GPIO rarely ends well."}], "answers": [{"tags": [], "owner": {"reputation": 11771, "user_id": 1275653, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb781e5bd49c5d403228b98859d8b6dd?s=128&d=identicon&r=PG", "display_name": "thb", "link": "https://stackoverflow.com/users/1275653/thb"}, "is_accepted": true, "score": 2, "last_activity_date": 1549449724, "last_edit_date": 1549449724, "creation_date": 1549413105, "answer_id": 54545110, "question_id": 54545041, "link": "https://stackoverflow.com/questions/54545041/mapping-inputs-to-an-array-a-better-way/54545110#54545110", "title": "Mapping inputs to an array (A better way?)", "body": "<p>Yes, your solution is efficient.</p>\n\n<p>Before the C compiler even sees your code, the C preprocessor substitutes <code>INPUT_ARRAY[0]</code> for <code>INPUT01</code> and, similarly, <code>INPUT_ARRAY[1]</code> for <code>INPUT02</code>; so this substitution uses zero time and zero power at run time.</p>\n\n<p>Moreover, when the C compiler sees <code>INPUT_ARRAY[1]</code> in the preprocessed code, it adds 1 <em>at compile time</em> to the base address of <code>INPUT_ARRAY</code>. Therefore, you get maximal efficiency at run time.</p>\n\n<p>Admittedly, were you manually to turn your C compiler's optimizer off, as with the <code>-O0</code> option of GCC, then it is conceivable that the compiler would emit assembly code to add the 1 at run time. So don't do that.</p>\n\n<p>The only likely exception to the foregoing would be the case that the base address of <code>INPUT_ARRAY</code> were unknown to the compiler at run time, not likely because <code>INPUT_ARRAY</code> were dynamically allocated on the heap (which would make little sense for hardware device addressing), but likely because the base address of <code>INPUT_ARRAY</code> were configurable during boot via device configuration registers. Some hardware does this, but if yours does, why, that is exactly the reason your MCU (or MPU) possesses an index-offset indirect addressing mode in the first place. Though this mode engages the MCU's integer arithmetic unit, [a]&nbsp;the mode does not multiply (multiplication being a power-hungry operation); and, [b]&nbsp;anyway, the mode is such a normal, often-used mode that MCUs are invariably designed to support it efficiently&mdash;not perhaps as efficiently as precomputed direct addressing, but as efficiently as one can reasonably expect for such a use. The MCU's manufacturer knows that device pins are things you need to address. The engineer who designed your MCU will have given priority to making the index-offset indirect mode as efficient as possible for this and other reasons. (You could maybe still cheat the matter to save a few millijoules via self-modifying code, if your MCU even allowed that; but, as an engineer, you'd regret the cheat, I suspect, unless security and maintainability were non-issues to you. The problem probably is not much of a real problem. Index-offset indirect addressing is the normal technique when the base address remains unknown until run time. If you <em>really</em> need to save that last millijoule, then you might not be using a C compiler for your code's inner loop, anyway, but might be handcrafting assembly code.)</p>\n\n<p>I suspect that you would find it instructive to tell your compiler to emit assembly code for your inspection. I do not know which compiler you are using but, if you were using GCC, then <code>gcc -S myfile.c</code>.</p>\n"}], "owner": {"reputation": 160, "user_id": 6707322, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dd84cac155846997c02f3fb79f22df8a?s=128&d=identicon&r=PG&f=1", "display_name": "ConductedForce", "link": "https://stackoverflow.com/users/6707322/conductedforce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 54545110, "answer_count": 1, "score": 2, "last_activity_date": 1549449724, "creation_date": 1549412549, "question_id": 54545041, "link": "https://stackoverflow.com/questions/54545041/mapping-inputs-to-an-array-a-better-way", "title": "Mapping inputs to an array (A better way?)", "body": "<p>I'm working in an embedded system and have \"mapped\" some defines to an array for inputs.</p>\n\n<pre><code>volatile int INPUT_ARRAY[40];\n\n\n#define INPUT01 INPUT_ARRAY[0]\n#define INPUT02 INPUT_ARRAY[1]\n\n\n// section 2\nif ( INPUT01 &amp;&amp; INPUT02 ) {\n  writepin(outputpin, value);\n}\n</code></pre>\n\n<p>If I want to read from Input 1, I can simply say <code>newvariable = INPUT01</code> or I can compare data with Input 1, like in section 2 of my code. I'm not sure if this is a normal way of mapping the name INPUT01 to where the array position is. Or for an Input pin in the first place. Each array value represents a binary pin, and are read into the array by decoding a port value (16 bit). Question: Is using the defines and array like this reasonably efficient?</p>\n"}, {"tags": ["c", "sockets"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1549416538, "post_id": 54544944, "comment_id": 95891613, "body": "If fixing a bind error cured this problem you should have mentioned the bind error in your question. Unclear what you&#39;re really asking here."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1549443531, "post_id": 54544944, "comment_id": 95899648, "body": "@user207421 He can&#39;t know that there is a bind error, since he doesn&#39;t check the return value of the <code>bind()</code> syscall."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549499670, "post_id": 54544944, "comment_id": 95928129, "body": "OT: regarding: <code>printf(&quot;Connection with the server failed. [%s]\\n&quot;, strerror(errno));</code>  1) Error messages should be output to <code>stderr</code>, not <code>stdout</code>  2) when the error indication comes from a C library function, use <code>perror( &quot;my error message&quot; );, followed by </code>exit( EXIT_FAILURE );`  Because <code>perror()</code> outputs both your error message and the text reason the system thinks the error occurred to <code>stderr</code>.    Unfortunately, the posted code continues to execute as if everything is ok, after the error occurred"}], "answers": [{"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1549414001, "post_id": 54544964, "comment_id": 95891133, "body": "The problem is &#39;connection refused&#39; at the client, not a bind error at the server, and it is caused by he server only accepting one connection and then she thing down,. There may <i>also</i> have been a bind error at he server, but the OP hadn&#39;t mentioned it."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1549414368, "post_id": 54544964, "comment_id": 95891204, "body": "@user207421 No, the problem is, that the connection refused error comes despite the server was started. And the fact, that this answer was accepted shows, that the assumptions I made were correct. I don&#39;t mind your downvote, it just documents your lack of understanding ;)"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1549415971, "post_id": 54544964, "comment_id": 95891509, "body": "It documents that I understand the difference between &#39;connection refused&#39; at the client, which is the topic of the question, and a bind error at the server, which is the topic of your answer. If the OP got a bind error he should have said so. You don&#39;t have any evidence about who downvoted your answer. It&#39;s a secret ballot, by design, and you have no business speculating about it."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1549443167, "post_id": 54544964, "comment_id": 95899461, "body": "@user207421 As it is quite easy to see, the OP can&#39;t even know, that he has a <code>bind()</code> error, since he doesn&#39;t check the <i>return</i> value (as I mentioned in the answer, didn&#39;t you read that). It is quite obvious, that you downvoted, and I am free to comment that ;))"}], "tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 3, "last_activity_date": 1549412577, "last_edit_date": 1549412577, "creation_date": 1549412013, "answer_id": 54544964, "question_id": 54544944, "link": "https://stackoverflow.com/questions/54544944/sockets-connection-refused/54544964#54544964", "title": "Sockets: connection refused", "body": "<p>The problem is with your server lacking the <code>SO_REUSEADDR</code> socket option which leads to the <code>bind()</code> syscall failing. The reason is, that after a client disconnects from the server, the connection is still known by the system in <code>TIME_WAIT</code> state, to wait for late packets. These lead to the <code>bind()</code> to fail with <code>EADDRINUSE</code> if the above mentioned socket option is not set.</p>\n\n<p>Use the following:</p>\n\n<pre><code>...\nint one = 1;\nsetsockopt(net_socket, SOL_SOCKET, SO_REUSEADDR, &amp;one, sizeof(one));\n\nbind(net_socket, (struct sockaddr*)&amp;net_addr, sizeof(net_addr));\n...\n</code></pre>\n\n<p>and <em>do</em> error checks for all syscalls! That would have shown you the problem much earlier and had saved you much time.</p>\n\n<p>Some more issues:</p>\n\n<ul>\n<li>You are sending an uninitialized buffer <code>net_message</code></li>\n<li>A shutdown on a listen socket isn't sensible at all, since no connection is established on it (this here: <code>shutdown(net_socket, SHUT_RDWR);</code>)</li>\n<li>The shutdown on the client socket has - if at all - to be performed <em>before</em> the <code>close(cl_socket);</code>. But it is not necessary at all in that case.</li>\n</ul>\n"}], "owner": {"reputation": 21, "user_id": 11020372, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ez4BoERp9CI/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMBcMPlzqpiB4ZRz05vCKI9Dwm0oQ/mo/photo.jpg?sz=128", "display_name": "Vale", "link": "https://stackoverflow.com/users/11020372/vale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 54544964, "answer_count": 1, "score": 1, "last_activity_date": 1549412577, "creation_date": 1549411847, "last_edit_date": 1549412164, "question_id": 54544944, "link": "https://stackoverflow.com/questions/54544944/sockets-connection-refused", "title": "Sockets: connection refused", "body": "<p>I made a TCP Client/Server and I can run it one time. But when I try to run it more than one time, it gives me the following error: \"Connection refused\". Here's my code.</p>\n\n<p><em>Client</em></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;string.h&gt;\n\n#include &lt;sys/socket.h&gt;\n#include &lt;sys/types.h&gt;\n\n#include &lt;netinet/in.h&gt;\n\n#include &lt;arpa/inet.h&gt;\n\nint main() {\n    int net_socket = socket(AF_INET, SOCK_STREAM, 0);\n\n    struct sockaddr_in net_addr;\n\n    net_addr.sin_addr.s_addr = inet_addr(\"127.0.0.1\");\n    net_addr.sin_family = AF_INET;\n    net_addr.sin_port = htons(3250);\n\n    int connection_state = connect(net_socket, (struct sockaddr*)&amp;net_addr, sizeof(net_addr));\n\n    if (connection_state == 0) {\n        printf(\"Connected with the server.\\n\");\n    }\n    else {\n        printf(\"Connection with the server failed. [%s]\\n\", strerror(errno));\n    }\n\n    char net_message[256];\n\n    recv(net_socket, net_message, sizeof(net_message), 0);\n\n    close(net_socket);\n    shutdown(net_socket, SHUT_RDWR);\n\n    return 0;\n}\n</code></pre>\n\n<p><em>Server</em></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;errno.h&gt;\n\n#include &lt;sys/socket.h&gt;\n#include &lt;sys/types.h&gt;\n\n#include &lt;netinet/in.h&gt;\n\n#include &lt;arpa/inet.h&gt;\n\nint main() {\n    int net_socket = socket(AF_INET, SOCK_STREAM, 0);\n\n    struct sockaddr_in net_addr;\n\n    net_addr.sin_addr.s_addr = inet_addr(\"127.0.0.1\");\n    net_addr.sin_family = AF_INET;\n    net_addr.sin_port = htons(3250);\n\n    bind(net_socket, (struct sockaddr*)&amp;net_addr, sizeof(net_addr));\n\n    listen(net_socket, 1);\n\n    struct sockaddr_in cl_addr;\n\n    int cl_size = sizeof(cl_addr);\n\n    int cl_socket = accept(net_socket, (struct sockaddr*)&amp;cl_addr, (socklen_t*)&amp;cl_size);\n\n    int loop = 1;\n    char net_message[256];\n\n    send(cl_socket, net_message, sizeof(net_message), 0);\n\n    close(net_socket);\n    close(cl_socket);\n    shutdown(net_socket, SHUT_RDWR);\n    shutdown(cl_socket, SHUT_RDWR);\n\n    return 0;\n}\n</code></pre>\n\n<p>I've been trying to solve the problem by many ways but I'm a newbie. Thanks for the help in advance!</p>\n"}, {"tags": ["c", "gcc", "abi"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1549408933, "post_id": 54544451, "comment_id": 95889966, "body": "<code>at the same time it was expected to be 4B wide (sizeof int)</code> why? What has <code>int</code> to do with it? From the look of it, you have UB in your code."}, {"owner": {"reputation": 1203, "user_id": 5872193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839edfacb5837e124d10164cdc0c558?s=128&d=identicon&r=PG&f=1", "display_name": "Honza Reme\u0161", "link": "https://stackoverflow.com/users/5872193/honza-reme%c5%a1"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1549409464, "post_id": 54544451, "comment_id": 95890087, "body": "AFAIK, C99&#39;s <code>&lt;stdbool.h&gt;</code> defines bool as int. Subsequent versions change this."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 2, "creation_date": 1549409529, "post_id": 54544451, "comment_id": 95890116, "body": "the only standard definition I know of for <code>bool</code> is to be a typedef of <code>_Bool</code>"}, {"owner": {"reputation": 1203, "user_id": 5872193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839edfacb5837e124d10164cdc0c558?s=128&d=identicon&r=PG&f=1", "display_name": "Honza Reme\u0161", "link": "https://stackoverflow.com/users/5872193/honza-reme%c5%a1"}, "edited": false, "score": 0, "creation_date": 1549410181, "post_id": 54544451, "comment_id": 95890272, "body": "Oh yes, you are right. Guess I mixed it up with how people used to define <code>bool</code> before C99. I am confident that both the library and the project use <code>&lt;stdbool.h&gt;</code>, though."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1549410772, "post_id": 54544451, "comment_id": 95890404, "body": "I believe my statement did err by one nit: the standard actually states that <code>bool</code> is a macro that expands to <code>_Bool</code> rather than a typedef.  Regardless, I have not been able to find anything in the C99 standard regarding the size of <code>_Bool</code> other than being able to store the values <code>0</code> and <code>1</code>, so I cannot see anything preventing a standard conforming implementation from making <code>_Bool</code> more than one byte."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1549415041, "post_id": 54544451, "comment_id": 95891340, "body": "If the program was pre-C99 and typedefd <code>bool</code> to <code>int</code>, that means that the programmer broke the abi by changing the type of <code>important</code> from <code>int</code> to <code>_Bool</code>."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1549416466, "post_id": 54544451, "comment_id": 95891598, "body": "There are also compiler option for certain architectures that allow the <code>sizeof (bool)</code> to be changed at compile time, e.g. Darwin <code>-mone-byte-bool</code> changing the default size of 4-bytes to 1-byte."}], "answers": [{"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 4, "last_activity_date": 1549416162, "last_edit_date": 1549416162, "creation_date": 1549414676, "answer_id": 54545272, "question_id": 54544451, "link": "https://stackoverflow.com/questions/54544451/can-the-change-of-sizeofbool-really-break-old-code/54545272#54545272", "title": "Can the change of sizeof(bool) really break old code?", "body": "<blockquote>\n  <p>Can the change of sizeof(bool) really break old code?</p>\n</blockquote>\n\n<p>Yes.  Quite easy to find code that <em>assumes</em> incorrectly something about the size of <code>bool</code> and (lack of)  padding.</p>\n\n<blockquote>\n  <p>... there was the <code>important</code> member, which was expected to be 1B wide by the code that has set it (hence the 1 zero byte), but at the same time it was expected to be 4B wide (<code>sizeof int</code>) </p>\n</blockquote>\n\n<p>Even if the code was pre-C99, the size of the code defined type of <code>bool</code> should have been <code>sizeof(bool)</code> or better as <code>struct Foo f; sizeof(f.important)</code> and not <code>sizeof int</code>.</p>\n\n<p>Further, although code does not show how these sizes were applied, another issues is padding.  Layouts could have been</p>\n\n<pre><code>8 byte pointer,  1 byte bool, 7 padding\n8 byte pointer,  4 byte bool, 0 padding\n8 byte pointer,  4 byte bool, 4 padding\n4 byte pointer,  1 byte bool, 3 padding\n2 byte pointer,  4 byte bool, 0 padding\netc.\n</code></pre>\n\n<p>Better code would have used <code>offsetof()</code> to find the offset and <code>sizeof(object.member)</code> to find the size.</p>\n"}], "owner": {"reputation": 1203, "user_id": 5872193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9839edfacb5837e124d10164cdc0c558?s=128&d=identicon&r=PG&f=1", "display_name": "Honza Reme\u0161", "link": "https://stackoverflow.com/users/5872193/honza-reme%c5%a1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1549416162, "creation_date": 1549408383, "question_id": 54544451, "link": "https://stackoverflow.com/questions/54544451/can-the-change-of-sizeofbool-really-break-old-code", "title": "Can the change of sizeof(bool) really break old code?", "body": "<p>I have a C library which uses something like this:</p>\n\n<pre><code>struct Foo {\n  const char *bar;\n  bool important;\n  struct Baz *baz;\n}\n</code></pre>\n\n<p>Recently, I have used it in a project where <code>important</code> was supposed to be <code>false</code>, however, it evaluated as <code>true</code>. Looking on the memory layout (dump) of the structure, I have observed (from the beginning):</p>\n\n<ul>\n<li>8 nonzero bytes</li>\n<li>1 zero byte</li>\n<li>7 nonzero bytes</li>\n<li>...</li>\n</ul>\n\n<p>Since my architecture is <code>x86_64</code>, I assume that:</p>\n\n<ul>\n<li>first 8 bytes was the <code>bar</code> member</li>\n<li>then there was the <code>important</code> member, which was expected to be 1B wide by the code that has set it (hence the 1 zero byte), but at the same time it was expected to be 4B wide (<code>sizeof int</code>) by the code that checked its truthiness (hence its evaluation as <code>true</code>)</li>\n<li>then there was padding up to 8B</li>\n</ul>\n\n<p>If it is relevant, my platform is CentOS 7 with distribution version of GCC (4.8.5 RedHat).</p>\n\n<hr>\n\n<p>My question is - can this really happen? Can an unsuspecting programmer encounter ABI breakage due to the change of sizeof(bool)? Further tips about:</p>\n\n<ul>\n<li>how to test it (MWE)</li>\n<li>which version of GCC / glibc / C standard brings this change</li>\n<li>how to avoid it</li>\n</ul>\n\n<p>are welcome.</p>\n"}, {"tags": ["c", "arrays", "ascii"], "answers": [{"tags": [], "owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "is_accepted": false, "score": 2, "last_activity_date": 1549407545, "last_edit_date": 1549407545, "creation_date": 1549406752, "answer_id": 54544189, "question_id": 54544152, "link": "https://stackoverflow.com/questions/54544152/compare-two-char-in-c-without-ascii/54544189#54544189", "title": "compare two char in C without ASCII", "body": "<p>You\u2019re storing arrays of pointers to strings.  Dereferencing your arrays of pointers gives you a pointer.  To store an array of characters, write:</p>\n\n<pre><code>const char plainarray[26] = {'a', 'b', 'c', \\* ... */ };\n</code></pre>\n\n<p>or</p>\n\n<pre><code>const char plainarray[] = \"abc...\";\n</code></pre>\n\n<p>The latter is not quite the same, because it has an extra byte at the end to terminate the string.</p>\n"}, {"tags": [], "owner": {"reputation": 5566, "user_id": 530160, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xRnFS.jpg?s=128&g=1", "display_name": "Nick ODell", "link": "https://stackoverflow.com/users/530160/nick-odell"}, "is_accepted": false, "score": 1, "last_activity_date": 1549406779, "creation_date": 1549406779, "answer_id": 54544192, "question_id": 54544152, "link": "https://stackoverflow.com/questions/54544152/compare-two-char-in-c-without-ascii/54544192#54544192", "title": "compare two char in C without ASCII", "body": "<p>This type:</p>\n\n<pre><code>char* plainarray[26] = ...\n</code></pre>\n\n<p>is an array of pointers to characters, <em>not</em> an array of characters. Change it to this:</p>\n\n<pre><code>char* plainarray = \"abc...\";\n</code></pre>\n\n<p>Then, you can access the array like this:</p>\n\n<pre><code>printf(\"%c\", plainarray[0]); // prints 'a'\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": false, "score": 0, "last_activity_date": 1549406793, "creation_date": 1549406793, "answer_id": 54544197, "question_id": 54544152, "link": "https://stackoverflow.com/questions/54544152/compare-two-char-in-c-without-ascii/54544197#54544197", "title": "compare two char in C without ASCII", "body": "<p>You are comparing pointers to strings with <code>==</code>, which is not correct since they are obviously all at different addresses.</p>\n\n<p>If you did intend to store <code>plainarray</code> and <code>cryptarray</code> as arrays of pointers to null-terminated strings, each containing one letter of the alphabet, you can use the <code>strcmp</code> function to compare them (or, since every string pointed to is one character long plus the null-terminator, you can compare position <code>[0]</code> of both strings).</p>\n\n<p>In my mind it makes more sense to store <code>plainarray</code> and <code>cryptarray</code> as arrays of plain <code>char</code>, however.</p>\n"}], "owner": {"reputation": 137, "user_id": 10565854, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-w4wrJ5kr3n4/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD6COlIRDlpdjjiMRf0xwVPQm2r3w/mo/photo.jpg?sz=128", "display_name": "Yee Kee", "link": "https://stackoverflow.com/users/10565854/yee-kee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1549407545, "creation_date": 1549406479, "question_id": 54544152, "link": "https://stackoverflow.com/questions/54544152/compare-two-char-in-c-without-ascii", "title": "compare two char in C without ASCII", "body": "<p>So I want to do an encryption basically. The way I am doing this is creating two arrays and switching values. The problem I run into is, when the arrays are in just an array of characters, it doesnt work. But when I convert to the ASCII numbers, it does. Here's an example of what the two arrays would look like:</p>\n\n<pre><code>char* plainarray[26] = [\"a\",\"b\",\"c\"] //this would go on for the entire alphabet\nchar* cryptarray[26] = [\"p\",\"j\",\"n\"] //this array is the entire alphabet randomized\n</code></pre>\n\n<p>Then I have created to values for the plaintext and the encrypted text and values for the for loop. For example.</p>\n\n<pre><code>char plain[5] = \"hello\";\nchar* change[5] = {};\nint i;\nint j;\nlength = strlen(text); //length of string for for loop\n</code></pre>\n\n<p>Then I use two for loops to add encypted values to \"crypt\"</p>\n\n<pre><code>for(i=0; i&lt;length; i++){\n    for (j = 0; j &lt;26; j++){\n        if (plain[i] == plainarray1[j]){\n            change[i] = cryptarray2[j];\n        }\n    }\n}\n</code></pre>\n\n<p>The warning code I get when compiling is:</p>\n\n<pre><code>warning: comparison between pointer and integer\n</code></pre>\n\n<p>One solution to my problem was using ASCII numbers in the plain text array and making it an int array. This compares the two characters, but the order of alphabet will be random for this problem, so I can't do that. Is there a better way to do this? Also I my array and assignment for the modified text (\"change\") proper? It doesn't give he right output.</p>\n"}, {"tags": ["c", "string"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1549408402, "post_id": 54544125, "comment_id": 95889841, "body": "<code>strtok(.... &quot;() &quot;)</code> ? or better <code>strpbrk(...., &quot;() &quot;)</code>. You need to write a parser, there is no easy way. Read one character at time and write a fully capable parser."}, {"owner": {"reputation": 352, "user_id": 10330277, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gtvew.png?s=128&g=1", "display_name": "sushibossftw", "link": "https://stackoverflow.com/users/10330277/sushibossftw"}, "edited": false, "score": 0, "creation_date": 1549408947, "post_id": 54544125, "comment_id": 95889969, "body": "You have those parentheses because of operation priority? If not so you can eliminate parentheses. Also be aware, strtok affects the original string."}, {"owner": {"reputation": 1528, "user_id": 8580574, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/912ad5911e696e7aac0ea9ec35d80057?s=128&d=identicon&r=PG&f=1", "display_name": "PEREZje", "link": "https://stackoverflow.com/users/8580574/perezje"}, "reply_to_user": {"reputation": 352, "user_id": 10330277, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gtvew.png?s=128&g=1", "display_name": "sushibossftw", "link": "https://stackoverflow.com/users/10330277/sushibossftw"}, "edited": false, "score": 0, "creation_date": 1549409065, "post_id": 54544125, "comment_id": 95890002, "body": "@sushibossftw yes they are there for operator precedence."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1549411792, "post_id": 54544125, "comment_id": 95890615, "body": "@PEREZje If this is more than an exercise, you should really do yourself a favor and use a lexer like (f)lex, maybe accompanied by a parser generator such as yacc/bison for such tasks."}, {"owner": {"reputation": 106, "user_id": 2680390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeff27d0715eb6eb81557823eb4ff8d5?s=128&d=identicon&r=PG", "display_name": "Denis Golovkin", "link": "https://stackoverflow.com/users/2680390/denis-golovkin"}, "edited": false, "score": 0, "creation_date": 1549423474, "post_id": 54544125, "comment_id": 95892933, "body": "There is a good introdution to implementing lexer and parser here: <a href=\"https://llvm.org/docs/tutorial/LangImpl01.html\" rel=\"nofollow noreferrer\">LLVM tutorial</a> It&#39;s written in <code>c++</code>, but lexer part is written mostly in <code>c</code>. Maybe it worth attention."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1549425924, "post_id": 54544125, "comment_id": 95893409, "body": "the <code>(int)</code> cast is nonsense there. Also use <code>&#39; &#39;</code> instead of 32"}, {"owner": {"reputation": 1528, "user_id": 8580574, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/912ad5911e696e7aac0ea9ec35d80057?s=128&d=identicon&r=PG&f=1", "display_name": "PEREZje", "link": "https://stackoverflow.com/users/8580574/perezje"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1549438235, "post_id": 54544125, "comment_id": 95897302, "body": "@AnttiHaapala why is the int unnecessary? strcmp raised an error about pointers, what would be better? Furthermore I&#39;ll switch over to &#39; then, I come from Python3 and the distinction never really mattered. Is there a reason to use &#39; &gt; &quot;?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1549444448, "post_id": 54544125, "comment_id": 95900100, "body": "Of course there is. One is string, other is int. These have no relation to Python"}, {"owner": {"reputation": 1528, "user_id": 8580574, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/912ad5911e696e7aac0ea9ec35d80057?s=128&d=identicon&r=PG&f=1", "display_name": "PEREZje", "link": "https://stackoverflow.com/users/8580574/perezje"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1549445596, "post_id": 54544125, "comment_id": 95900769, "body": "@AnttiHaapala the distinction between &#39; and &quot;"}], "answers": [{"tags": [], "owner": {"reputation": 1079, "user_id": 6022817, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1JpCX.jpg?s=128&g=1", "display_name": "C\u0103t\u0103lin Fr&#226;ncu", "link": "https://stackoverflow.com/users/6022817/c%c4%83t%c4%83lin-fr%c3%a2ncu"}, "is_accepted": true, "score": 3, "last_activity_date": 1549451607, "creation_date": 1549451607, "answer_id": 54552283, "question_id": 54544125, "link": "https://stackoverflow.com/questions/54544125/parsing-mathematical-expression-string/54552283#54552283", "title": "Parsing mathematical expression string", "body": "<p><a href=\"https://en.wikipedia.org/wiki/Lexical_analysis#Tokenization\" rel=\"nofollow noreferrer\">Tokenization</a> is the first step towards syntactic analysis. As such, it is probably a good idea to encapsulate it into a layer of abstraction, a function that yields one token at a time. This function also discards white space and combines consecutive digits into numbers. It is hard to delegate these steps to <code>strtok()</code>. Finally, the function may rewrap single characters into more structured information.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;ctype.h&gt;\n#include &lt;stdio.h&gt;\n\n#define T_NUMBER 0\n#define T_OPERATOR 1\n#define T_BRACKET 2\n\ntypedef struct {\n  int type;\n  int value;\n} token;\n\n/* Reads the next token from stdin. Returns 1 on success, 0 on EOL. */\nint next_token(token *t) {\n  char c;\n\n  /* discard spaces silently */\n  do {\n    c = getchar();\n  } while (c == ' ');\n\n  if (isdigit(c)) {\n    t-&gt;type = T_NUMBER;\n    t-&gt;value = 0;\n    do {\n      t-&gt;value = t-&gt;value * 10 + (c - '0');\n      c = getchar();\n    } while (isdigit(c));\n    ungetc(c, stdin); /* save the non-digit for next time */\n\n  } else if (c == '+' || c == '-' || c == '*' || c == '/') {\n    t-&gt;type = T_OPERATOR;\n    t-&gt;value = c;\n\n  } else if (c == '(' || c == ')') {\n    t-&gt;type = T_BRACKET;\n    t-&gt;value = c;\n\n  } else if (c == '\\n') {\n    ungetc(c, stdin); /* make sure we always return 0 from now on */\n    return 0;\n\n  } else {\n    /* handle illegal character */\n\n  }\n\n  return 1;\n}\n\nint main() {\n\n  token t;\n\n  while (next_token(&amp;t)) {\n    switch (t.type) {\n      case T_NUMBER:   printf(\"number   %d\\n\", t.value); break;\n      case T_OPERATOR: printf(\"operator %c\\n\", t.value); break;\n      case T_BRACKET:  printf(\"bracket  %c\\n\", t.value); break;\n    }\n  }\n\n  return 0;\n}\n</code></pre>\n\n<p>Sample run:</p>\n\n<pre><code>(22+   37 * ( 1534-9)) + 18\nbracket  (\nnumber   22\noperator +\nnumber   37\noperator *\nbracket  (\nnumber   1534\noperator -\nnumber   9\nbracket  )\nbracket  )\noperator +\nnumber   18\n</code></pre>\n"}], "owner": {"reputation": 1528, "user_id": 8580574, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/912ad5911e696e7aac0ea9ec35d80057?s=128&d=identicon&r=PG&f=1", "display_name": "PEREZje", "link": "https://stackoverflow.com/users/8580574/perezje"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 54552283, "answer_count": 1, "score": 1, "last_activity_date": 1549451607, "creation_date": 1549406304, "question_id": 54544125, "link": "https://stackoverflow.com/questions/54544125/parsing-mathematical-expression-string", "title": "Parsing mathematical expression string", "body": "<p>So this is my issue, I have to create a program that implements the <a href=\"https://en.wikipedia.org/wiki/Shunting-yard_algorithm\" rel=\"nofollow noreferrer\">shunting yard algorithm</a> in C. For this I first need to parse the given mathematical expression into it's component parts. So I figured a simple for loop over a given string would do the trick.</p>\n\n<pre><code>char *math_exp = \"2 + 4\";\nfor (int i = 0; (unsigned) i &lt; strlen(math_expr); i++) {\n    printf(\"%c\", math_expr[i]);\n}\n\n&gt; 2 + 4\n</code></pre>\n\n<p>But this quickly runs into an issue when a string contains a number with more digits than 1.</p>\n\n<pre><code>for (int i = 0; (unsigned) i &lt; strlen(math_expr); i++) {\n    // skip if char is a space\n    if ((int) math_expr[i] == 32) {\n        continue;\n    }\n    printf(\"%c \", math_expr[i]);\n}\n&gt; 2 2 + 4\n</code></pre>\n\n<p>The 22 is now treated as two separate numbers. So I tried to loop over all tokens in the string by splitting the string using the delimiter SPACE.</p>\n\n<pre><code>char math_expr[] = \"22 + 4\";\nchar *token = strtok(math_expr, \" \");\n\nwhile (token != NULL) {\n    printf(\"%s \", token);\n    token = strtok(NULL, \" \");\n}\n&gt; 22 + 4\n</code></pre>\n\n<p>This seemed to work but quickly ran into the issue of what to do when there's a bracket in the expression. e.g.:</p>\n\n<pre><code>char math_expr[] = \"(22 + 2)\";\nchar *token = strtok(math_expr, \" \");\n\nwhile (token != NULL) {\n    printf(\"%s\\n\", token);\n    token = strtok(NULL, \" \");\n}\n&gt; (22\n&gt; +\n&gt; 2)\n</code></pre>\n\n<p>And now I'm stuck, is there a way to circumvent this issue? I need to be able to extract every operator and number (with all possible digits) furthermore I also need to be able to distinguish brackets from numbers they are attached to. I hoped there was some easy way to do this. Any help is appreaciated.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 0, "creation_date": 1549406620, "post_id": 54544123, "comment_id": 95889343, "body": "you&#39;re not comparing all files from <code>dir1</code> against all files from <code>dir2</code>, you&#39;ll need to use 2 loops to do that. What you have now reads the first file from each directory, compares them, then the next file from each directory, compares them, etc.. until you run out of files in one of the directories (or an error occurs). You need to compare the first file from <code>dir1</code> against <i>all</i> the files in <code>dir2</code>, then the 2nd file from <code>dir1</code> against <i>all</i> the files in <code>dir2</code>, etc."}, {"owner": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 0, "creation_date": 1549406745, "post_id": 54544123, "comment_id": 95889381, "body": "This may be &lt;O/T&gt; depending on your task, but if you&#39;re really looking for duplicates, you should hash the file contents and compare the hashes. Obviously, two files can be the same size, have the same name and extension, yet have different content."}, {"owner": {"reputation": 5996, "user_id": 1152524, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b2e23f3f9bf82e6fe806261f50b2f9b6?s=128&d=identicon&r=PG&f=1", "display_name": "txtechhelp", "link": "https://stackoverflow.com/users/1152524/txtechhelp"}, "reply_to_user": {"reputation": 2445, "user_id": 3476780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/abf771bddcd864626a0e1499ccfc699b?s=128&d=identicon&r=PG&f=1", "display_name": "yano", "link": "https://stackoverflow.com/users/3476780/yano"}, "edited": false, "score": 0, "creation_date": 1549418205, "post_id": 54544123, "comment_id": 95891893, "body": "If this is an exercise, then as @yano has mentioned, you&#39;ll need to loop through the files and compare them .. alternatively, you could use <code>fdupes</code> like <a href=\"https://unix.stackexchange.com/a/71178/27770\">this</a> answer suggests."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1549426040, "post_id": 54544123, "comment_id": 95893431, "body": "For one directory, build a list.. or rather a hash table of the attributes, then scan the other and see if the entry is in this list"}, {"owner": {"reputation": 31, "user_id": 11019455, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iSPSJ5I64Tw/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQO2WTOwd5e0oIw823881qXlNyEdkQ/mo/photo.jpg?sz=128", "display_name": "Paul Wolff", "link": "https://stackoverflow.com/users/11019455/paul-wolff"}, "edited": false, "score": 0, "creation_date": 1549440786, "post_id": 54544123, "comment_id": 95898419, "body": "I added the necessary while-loops. However some files arent compared randomly and some files show 0 bytes size wich are obviously not 0 bytes...  Hashing is not allowed as our teacher wants us to work with directories"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1549468991, "post_id": 54544123, "comment_id": 95915250, "body": "Rather than repeatedly iterating over the files in either directory, why not create a struct with the filename and filesize and then fill an array of struct from each directory and then your comparisons would simply be in-memory operations."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 11019455, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iSPSJ5I64Tw/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQO2WTOwd5e0oIw823881qXlNyEdkQ/mo/photo.jpg?sz=128", "display_name": "Paul Wolff", "link": "https://stackoverflow.com/users/11019455/paul-wolff"}, "edited": false, "score": 0, "creation_date": 1549462983, "post_id": 54554791, "comment_id": 95911259, "body": "I dont understand your 4th poit: Could you providea code snippet please? I am reopening the second entry in the inner while loop."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 31, "user_id": 11019455, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iSPSJ5I64Tw/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQO2WTOwd5e0oIw823881qXlNyEdkQ/mo/photo.jpg?sz=128", "display_name": "Paul Wolff", "link": "https://stackoverflow.com/users/11019455/paul-wolff"}, "edited": false, "score": 0, "creation_date": 1549466268, "post_id": 54554791, "comment_id": 95913366, "body": "@PaulWolff:  There is an extra <code>;</code> in <code>if (filesize1.st_size == filesize2.st_size); {                 printf(&quot;%s und %s sind gleich\\n&quot;,                         d_verzeichnis1-&gt;d_name, d_verzeichnis2-&gt;d_name);             }</code>. This <code>;</code> is an empty statement, making the <code>if</code> useless."}, {"owner": {"reputation": 31, "user_id": 11019455, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iSPSJ5I64Tw/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQO2WTOwd5e0oIw823881qXlNyEdkQ/mo/photo.jpg?sz=128", "display_name": "Paul Wolff", "link": "https://stackoverflow.com/users/11019455/paul-wolff"}, "edited": false, "score": 0, "creation_date": 1549478215, "post_id": 54554791, "comment_id": 95919953, "body": "The code is very helpful thanks! However I dont understand those parts : char *buildpath(char *dest, size_t size, const char *dir, const char *name) and (!buildpath(path1, sizeof path1, argv[1], dp1-&gt;d_name)) and (!buildpath(path2, sizeof path2, argv[2], dp2-&gt;d_name)  ?"}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": true, "score": 1, "last_activity_date": 1549469901, "last_edit_date": 1549469901, "creation_date": 1549459729, "answer_id": 54554791, "question_id": 54544123, "link": "https://stackoverflow.com/questions/54544123/how-to-compare-multiple-files-based-on-only-file-type-and-size/54554791#54554791", "title": "How to compare multiple files based on only file type and size", "body": "<p>There are multiple problems in your code:</p>\n\n<ul>\n<li>you should verify the actual number of arguments provided on the command line to avoid undefined behavior if fewer than 3 were provided.</li>\n<li><code>fopen(v[3], \"W\");</code> uses an invalid mode string, you should use <code>\"w\"</code>. It is unclear what this stream pointer is used for anyway.</li>\n<li><code>dir1</code> and <code>dir2</code> are not tested: you have undefined behavior if <code>opendir()</code> fails.</li>\n<li><code>stat</code> is called with the directory entry name, which is not a relative pathname to the file if the directory is different from the current directory. You should construct the path name from the directory name and entry name.</li>\n<li><code>if (filesize1.st_size == filesize2.st_size);</code> has an extra <code>;</code> at the end of the line, causing the following block to execute unconditionally. You should use <code>K&amp;R style with</code>{` at the end of the line to avoid such silly mistakes.</li>\n<li>the logic of parallel scan is incorrect: you should reopen or at least rewind the second directory for each entry in the first to allow a full scan for potential matches.</li>\n</ul>\n\n<p>Here is a corrected version:</p>\n\n<pre><code>#include &lt;dirent.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;time.h&gt;\n#include &lt;sys/stat.h&gt;\n\nchar *buildpath(char *dest, size_t size, const char *dir, const char *name) {\n    size_t len = strlen(dir);\n    const char *sep = \"\";\n\n    if (len &gt; 0 &amp;&amp; dir[len - 1] != '/')\n        sep = \"/\";\n\n    if ((unsigned)snprintf(dest, size, \"%s%s%s\", dir, sep, name) &lt; size)\n        return dest;\n    else\n        return NULL;\n}\n\nint main(int argc, char *argv[]) {\n    char path1[1024];\n    char path2[1024];\n    struct dirent *dp1;\n    struct dirent *dp2;\n    DIR *dir1;\n    DIR *dir2;\n    struct stat filesize1;\n    struct stat filesize2;\n\n    if (argc &lt; 3) {\n        fprintf(stderr, \"missing argument\\n\");\n        fprintf(stderr, \"usage: cmpdir dir1 dir2\\n\");\n        return 1;\n    }\n\n    dir1 = opendir(argv[1]);\n    if (dir1 == NULL) {\n        fprintf(stderr, \"cannt open directory %s: %s\\n\", argv[1], strerror(errno));\n        return 1;\n    }\n    dir2 = opendir(argv[2]);\n    if (dir2 == NULL) {\n        fprintf(stderr, \"cannt open directory %s: %s\\n\", argv[2], strerror(errno));\n        return 1;\n    }\n    while ((dp1 = readdir(dir1)) != NULL) {\n        /* ignore . and .. entries */\n        if (!strcmp(dp1-&gt;d_name, \".\")\n        ||  !strcmp(dp1-&gt;d_name, \"..\"))\n            continue;\n        if (!buildpath(path1, sizeof path1, argv[1], dp1-&gt;d_name)) {\n            /* path too long */\n            continue;\n        }\n        if (stat(path1, &amp;filesize1)) {\n            /* cannot stat entry */\n            continue;\n        }\n        if (!S_ISREG(filesize1.st_mode)) {\n            /* not a regular file */\n            continue;\n        }\n        rewinddir(dir2);\n        while ((dp2 = readdir(dir2)) != NULL) {\n            /* ignore . and .. entries */\n            if (!strcmp(dp2-&gt;d_name, \".\")\n            ||  !strcmp(dp2-&gt;d_name, \"..\"))\n                continue;\n            if (!buildpath(path2, sizeof path2, argv[2], dp2-&gt;d_name)) {\n                /* path too long */\n                continue;\n            }\n            if (stat(path2, &amp;filesize2)) {\n                /* cannot stat entry */\n                continue;\n            }\n            if (!S_ISREG(filesize2.st_mode)) {\n                /* not a regular file */\n                continue;\n            }\n            if (filesize1.st_size == filesize2.st_size) {\n                printf(\"%s and %s have the same size %llu\\n\",\n                       path1, path2, (unsigned long long)filesize1.st_size);\n                /* perform actual comparison... */\n            }\n        }\n    }\n    closedir(dir1);\n    closedir(dir2);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 11019455, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-iSPSJ5I64Tw/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQO2WTOwd5e0oIw823881qXlNyEdkQ/mo/photo.jpg?sz=128", "display_name": "Paul Wolff", "link": "https://stackoverflow.com/users/11019455/paul-wolff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 54554791, "answer_count": 1, "score": 0, "last_activity_date": 1549469901, "creation_date": 1549406298, "last_edit_date": 1549459805, "question_id": 54544123, "link": "https://stackoverflow.com/questions/54544123/how-to-compare-multiple-files-based-on-only-file-type-and-size", "title": "How to compare multiple files based on only file type and size", "body": "<p>The goal is to compare files by size and filter those of the same size. \nFor that you need to compare every file to every file. \nHowever the first loop doesnt work so the search of the first directory is stuck at the first file.  </p>\n\n<pre><code>#include &lt;dirent.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n#include &lt;sys/stat.h&gt;\n\nint main(int argc, char *v[]) {\n    struct dirent *d_verzeichnis1;\n    struct dirent *d_verzeichnis2;\n    DIR *dir1;\n    DIR *dir2;\n    FILE *file = fopen(v[3], \"W\");\n    dir1 = opendir(v[1]);\n    dir2 = opendir(v[2]);\n    struct stat filesize1;\n    struct stat filesize2;\n\n    while ((d_verzeichnis1 = readdir(dir1)) != NULL) {\n        stat((d_verzeichnis1-&gt;d_name), &amp;filesize1);\n        while ((d_verzeichnis2 = readdir(dir2)) != NULL) {\n            stat((d_verzeichnis2-&gt;d_name), &amp;filesize2);\n            if (filesize1.st_size == filesize2.st_size);\n            {\n                printf(\"%s und %s sind gleich\\n\", \n                       d_verzeichnis1-&gt;d_name, d_verzeichnis2-&gt;d_name);\n            }\n        }   \n        d_verzeichnis1 = readdir(dir1); \n    }\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 3723, "user_id": 1169091, "user_type": "registered", "accept_rate": 9, "profile_image": "https://i.stack.imgur.com/5vE4L.jpg?s=128&g=1", "display_name": "nicomp", "link": "https://stackoverflow.com/users/1169091/nicomp"}, "edited": false, "score": 0, "creation_date": 1549404441, "post_id": 54543792, "comment_id": 95888707, "body": "You are missing some braces. And the indenting is inconsistent."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549404534, "post_id": 54543792, "comment_id": 95888738, "body": "What is the relevance of the code after the first line for this question?"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1549404659, "post_id": 54543792, "comment_id": 95888773, "body": "Fix your code with all the proper braces, indent it in a logical manner, and show your attempts at making a do-while-loop."}, {"owner": {"reputation": 48201, "user_id": 1250772, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/633e1f643d2c9b043231b4a32b078907?s=128&d=identicon&r=PG", "display_name": "Kaz", "link": "https://stackoverflow.com/users/1250772/kaz"}, "edited": false, "score": 2, "creation_date": 1549404719, "post_id": 54543792, "comment_id": 95888794, "body": "A <code>do</code> loop executes its body unconditionally at least once, whereas a <code>for</code> loop doesn&#39;t. <code>for</code> loops are usually not good candidates for conversion to <code>do</code> loops. It has to be obvious that there is always at least one iteration. A for loop with a blank top like <code>for (;;)</code> which has a termination test at the bottom of the block is an example of a good candidate for a <code>do</code> loop."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549406769, "post_id": 54543872, "comment_id": 95889384, "body": "One could do without the extra variable and conditions: <code>{ init; do { if (!condition) break; loop-body; increment; } while(true); }</code>"}, {"owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "reply_to_user": {"reputation": 1, "user_id": 3975177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ODKj.jpg?s=128&g=1", "display_name": "Swordfish", "link": "https://stackoverflow.com/users/3975177/swordfish"}, "edited": false, "score": 0, "creation_date": 1549406931, "post_id": 54543872, "comment_id": 95889431, "body": "@Swordfish I agree, but I feel that for a beginner at C the extra logic may help them follow the path of the conversion from <code>for</code> to <code>do-while</code>"}], "tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": true, "score": 2, "last_activity_date": 1549405375, "last_edit_date": 1549405375, "creation_date": 1549404797, "answer_id": 54543872, "question_id": 54543792, "link": "https://stackoverflow.com/questions/54543792/how-do-i-change-a-for-loop-to-a-do-while-loop/54543872#54543872", "title": "How do i change a for loop to a do while loop", "body": "<p>This task sounds a bit like a homework problem, so I won't give you working code outright but I will help you out a bit: </p>\n\n<p>A <code>for</code> loop <code>for(init; cond; increment) { loop-body; }</code> is equivalent to:</p>\n\n<pre><code>init;\nwhile(cond)\n{\n    loop-body;\n    increment;\n}\n</code></pre>\n\n<p>Now, a <code>do-while</code> loop is similar to a while loop, except that even if <code>cond</code> is false from the start, <code>loop-body</code> will be executed at least once.  In other words, the above <code>while</code> loop is equivalent to the following <code>do-while</code> loop:</p>\n\n<pre><code>init;\nint first_run = 1;\ndo\n{ \n    if(first_run)\n    {\n        if((cond) == 0) break;\n        first_run = 0;\n    }\n    loop-body;\n    increment;\n}\nwhile(cond);\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6791918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd488d965aae171776f878c6b264c7dd?s=128&d=identicon&r=PG&f=1", "display_name": "juvenalis", "link": "https://stackoverflow.com/users/6791918/juvenalis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "closed_date": 1549457393, "accepted_answer_id": 54543872, "answer_count": 1, "score": -4, "last_activity_date": 1549405375, "creation_date": 1549404393, "last_edit_date": 1549404446, "question_id": 54543792, "link": "https://stackoverflow.com/questions/54543792/how-do-i-change-a-for-loop-to-a-do-while-loop", "closed_reason": "Needs more focus", "title": "How do i change a for loop to a do while loop", "body": "<p>how do i convert the for loop in the below code to a do while loop,</p>\n\n<pre><code>for (int i= 0; i&lt; N_list;i++ ){\n        k=0;\n        fscanf(fp_in, \"%d %d %d\", &amp;fixation_number, &amp;x, &amp;y);\n    while (!((x == -1) &amp;&amp; (y ==-1))){\n            Point[k].x = x;\n            Point[k].y =y;\n            Point[k].id_number =k+1;\n</code></pre>\n"}, {"tags": ["c", "linux", "memory"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1549403602, "post_id": 54543603, "comment_id": 95888374, "body": "Do you have ASLR on?"}, {"owner": {"reputation": 123967, "user_id": 251153, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4b25144c09555e7d5b5e288469e011ef?s=128&d=identicon&r=PG", "display_name": "zneak", "link": "https://stackoverflow.com/users/251153/zneak"}, "edited": false, "score": 0, "creation_date": 1549403603, "post_id": 54543603, "comment_id": 95888378, "body": "Have you looked at what&#39;s on the stack with a debugger?"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 0, "creation_date": 1549403662, "post_id": 54543603, "comment_id": 95888400, "body": "@ASLR All addresses change with each run so I suppose yes."}, {"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1549404001, "post_id": 54543603, "comment_id": 95888531, "body": "(By the way, you can use <code>&#47;proc&#47;self&#47;maps</code>.)"}, {"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1549404477, "post_id": 54543603, "comment_id": 95888719, "body": "(Online demo: <a href=\"https://wandbox.org/permlink/CLW9SlPOy5rTg7mp\" rel=\"nofollow noreferrer\">wandbox.org/permlink/CLW9SlPOy5rTg7mp</a>)"}, {"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1549404533, "post_id": 54543603, "comment_id": 95888736, "body": "You should probably take a look at your platform&#39;s startup code (crt*.o) to see what your actual entry point function is doing."}, {"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 1, "creation_date": 1549404663, "post_id": 54543603, "comment_id": 95888776, "body": "Oh, here, if you pick a different local variable, you get something more expected: <a href=\"https://wandbox.org/permlink/tO5WuOAb3SdCed3v\" rel=\"nofollow noreferrer\">wandbox.org/permlink/tO5WuOAb3SdCed3v</a>"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1549405614, "post_id": 54543603, "comment_id": 95889056, "body": "@KerrekSB Tried your program locally 1000 times. I&#39;m never getting a match like in the link you posted. It&#39;s always off by 1, 2, or 3 pages on my machine. Thanks for looking at it, anyways. I don&#39;t really care about it deeply, but I think it&#39;s interesting."}, {"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1549406534, "post_id": 54543603, "comment_id": 95889315, "body": "Did you see that I changed it from C++ to C? That way I avoided some dynamic initialization preambling."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "edited": false, "score": 0, "creation_date": 1549409876, "post_id": 54543603, "comment_id": 95890194, "body": "@Ctx All the absolute addresses get randomized and my <code>cat  &#47;proc&#47;sys&#47;kernel&#47;randomize_va_space</code> is at <code>2</code> (full randomization). I don&#39;t know what&#39;s up with the first variables in main being variably 1-3 pages away from the start of the stack, but I don&#39;t suppose it has much to do with ASLR."}, {"owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1549410541, "post_id": 54543603, "comment_id": 95890353, "body": "@PSkocik Ah, ok. I think, it does. Did you try to disable ASLR and see, if there is still a variable offset?"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "edited": false, "score": 0, "creation_date": 1549411068, "post_id": 54543603, "comment_id": 95890456, "body": "@Ctx Nice idea! Turning it off constantizes (is that a word?) the offset to 1 page."}], "answers": [{"tags": [], "owner": {"reputation": 17054, "user_id": 5636775, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GC9DT.gif?s=128&g=1", "display_name": "Ctx", "link": "https://stackoverflow.com/users/5636775/ctx"}, "is_accepted": true, "score": 4, "last_activity_date": 1549411088, "creation_date": 1549411088, "answer_id": 54544841, "question_id": 54543603, "link": "https://stackoverflow.com/questions/54543603/beginning-of-stack-on-linux/54544841#54544841", "title": "Beginning of stack on Linux", "body": "<p>ASLR first completely randomizes the stack location in the virtual memory. But it does more: It also randomizes the stack pointer relative to the top of the stack mapping!</p>\n\n<p>From the linux source code:</p>\n\n<pre><code>unsigned long arch_align_stack(unsigned long sp)\n{\n        if (!(current-&gt;personality &amp; ADDR_NO_RANDOMIZE) &amp;&amp; randomize_va_space)\n                sp -= get_random_int() % 8192;\n        return sp &amp; ~0xf;\n}\n</code></pre>\n\n<p>Here, if ASLR is active, the stack pointer is reduced by 0-8192 bytes and then 16 bytes aligned. This explains the variable offset of 1-3 pages.</p>\n"}], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 54544841, "answer_count": 1, "score": 7, "last_activity_date": 1549411088, "creation_date": 1549403470, "last_edit_date": 1549405245, "question_id": 54543603, "link": "https://stackoverflow.com/questions/54543603/beginning-of-stack-on-linux", "title": "Beginning of stack on Linux", "body": "<p>I thought I could get the beginning of my process stack by taking the address of a variable in main and rounding up to a page boundary (considering that my stack grows down).</p>\n\n<p>I compared this to the boundary reported by <code>/proc/self/maps</code> and it's always off by 1, 2, or 3 pages (4096 bytes per page), never by a different offset. The difference varies with each run and this C program used in the following (messy, not minimalistic) pipeline demonstrates the difference.</p>\n\n<p>stacksz.c:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#define CAT \"cat /proc/XXXXXXXXXXX/maps\"\n#define CATP \"cat /proc/%ld/maps\"\n#define MASK ((sizeof(char)&lt;&lt;12)-1)\n\nint main()\n{\n    uintptr_t  top = (uintptr_t)&amp;top + MASK &amp; ~MASK;\n\n    char cat[sizeof CAT];\n    sprintf(cat,CATP,(long)getpid());\n    if(system(cat)) return 1;\n\n    printf(\" %lx stack\\n\", top);\n    return 0;\n}\n</code></pre>\n\n<p>bash pipeline:</p>\n\n<pre><code>gcc stacksz.c &amp;&amp; echo \"$(( $(./a.out |grep stack |tr '-' ' ' |cut -d' ' -f2 |sed 's/^/0x/'|tr '\\n' -|sed 's/-$//') ))\"\n</code></pre>\n\n<p>I'm curious if anyone can explain this phenomenon.\nThe machine is <code>Linux precision 4.15.0-43-generic #46-Ubuntu SMP x86_64</code>.\n`\n(\nI got the following offset distribution in a 1000 runs:</p>\n\n<pre><code>4096 195\n8192 490\n12288 315\n</code></pre>\n\n<p>).</p>\n"}, {"tags": ["c", "makefile", "openssl", "gnu-make"], "answers": [{"comments": [{"owner": {"reputation": 6282, "user_id": 4706711, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh3.googleusercontent.com/-dlNFOguGD_A/AAAAAAAAAAI/AAAAAAAABwA/BMlWtrTgZtY/photo.jpg?sz=128", "display_name": "Dimitrios Desyllas", "link": "https://stackoverflow.com/users/4706711/dimitrios-desyllas"}, "edited": false, "score": 0, "creation_date": 1549463787, "post_id": 54548607, "comment_id": 95911789, "body": "At the <code>builds&#47;openssl: builds</code> target is advisable to place the following command chain `\tcd openssl &amp;&amp; ./config --prefix=${CURDIR}/builds/openssl --openssldir=${CURDIR}/builds/openssl &amp;&amp; make &amp;&amp; make test &amp;&amp; make install` as you can see use the <code>${CURDIR}</code> in order to build the openssl to the <code>builds</code> folder."}], "tags": [], "owner": {"reputation": 5181, "user_id": 8866606, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ao_wuU1YCUE/AAAAAAAAAAI/AAAAAAAAAtc/Nc6ExTtKE_A/photo.jpg?sz=128", "display_name": "Stefan Becker", "link": "https://stackoverflow.com/users/8866606/stefan-becker"}, "is_accepted": true, "score": 1, "last_activity_date": 1549459160, "last_edit_date": 1549459160, "creation_date": 1549438300, "answer_id": 54548607, "question_id": 54543348, "link": "https://stackoverflow.com/questions/54543348/install-a-project-only-non-system-version-of-openssl-and-libcrypt-library/54548607#54548607", "title": "Install a project-only non-system version of OpenSSL and libcrypt library", "body": "<p>How about changing your makefile like this?</p>\n\n<pre><code>CC=mpicc\n\n# use headers from builds/openssl\nCFLAGS := -g -Ibuilds/openssl/include\n\n# look for library in builds/openssl\nLDFLAGS := -Lbuilds/openssl/lib\nLIBS    := -lcrypto -lssl\n\n.PHONY: all\nall: builds/main\n\nbuilds:\n    mkdir -p $@\n\nbuilds/main: builds/dh.o builds/message.o\nbuilds/main: main.c\n    $(CC) $(CFLAGS) -o $@ $&lt; builds/dh.o builds/message.o $(LDFLAGS) $(LIBS)\n\nbuilds/dh.o: dh.h\nbuilds/dh.o: dh.c\n    $(CC) $(CFLAGS) -o $@ -c $&lt;\n\nbuilds/message.o: message.h\nbuilds/message.o: message.c\n    $(CC) $(CFLAGS) -o $@ -c $&lt;\n\nbuilds/dh.o builds/message.o builds/main: builds\n\n# if you want to build openssl with your makefile...\nbuilds/dh.o builds/message.o builds/main: builds/openssl\nbuilds/openssl: builds\n       .... your openssl build command ....\n</code></pre>\n\n<p>Please check the layout of <code>builds/openssl</code> for the correct include &amp; library paths.</p>\n\n<hr>\n\n<p><strong>BONUS CODE</strong> personally I would restructure the makefile. Why not let make handle the heavy lifting?</p>\n\n<pre><code>LDFLAGS := -g -Lbuilds/openssl/lib\n\nSRCS := main.c dh.c message.c\nOBJS := $(SRCS:%.c=builds/%.o)\n...\nbuilds/main: $(OBJS)\n    $(CC) $(LDFLAGS) -o $@ $^ $(LIBS)\n\n# do not re-build when \"builds\" directory contents change\n$(OBJS): | builds\n$(OBJS): builds/%.o: %.c\n    $(CC) $(CFLAGS) -o $@ -c $&lt;\n\n# if you want to build openssl with your makefile...\n$(OBJS): builds/openssl\n</code></pre>\n"}], "owner": {"reputation": 6282, "user_id": 4706711, "user_type": "registered", "accept_rate": 87, "profile_image": "https://lh3.googleusercontent.com/-dlNFOguGD_A/AAAAAAAAAAI/AAAAAAAABwA/BMlWtrTgZtY/photo.jpg?sz=128", "display_name": "Dimitrios Desyllas", "link": "https://stackoverflow.com/users/4706711/dimitrios-desyllas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 54548607, "answer_count": 1, "score": 0, "last_activity_date": 1549459160, "creation_date": 1549402256, "last_edit_date": 1549406570, "question_id": 54543348, "link": "https://stackoverflow.com/questions/54543348/install-a-project-only-non-system-version-of-openssl-and-libcrypt-library", "title": "Install a project-only non-system version of OpenSSL and libcrypt library", "body": "<p>I have a C project with the following <code>Makefile</code>:</p>\n\n\n\n<pre><code>CC=mpicc\n\nbuildsDir: ./builds\n    mkdir ./builds\n\nmain: ./builds message dh main.c \n    $(CC) -o ./builds/main main.c ./builds/dh.o ./builds/message.o  -g -lcrypto -lssl\n\ndh: ./builds dh.c dh.h\n    $(CC) -c -o ./builds/dh.o dh.c -g -lcrypto -lssl\n\nmessage: message.c message.h\n    $(CC) -c -o ./builds/message.o -g ./message.c\n\nrun: main\n    mpirun -quiet -np 3 xterm -hold -e ./builds/main &amp;\n\ndebug: main\n    mpirun -quiet -np 3 xterm -e gdb ./builds/main\n\n.PHONY: clean\n\nclean:\n    rm -rf ./builds &amp;&amp; mkdir ./builds\n</code></pre>\n\n<p>And in my system I have the OpenSSL 1.0.2g:</p>\n\n<pre><code>OpenSSL 1.0.2g  1 Mar 2016\nbuilt on: reproducible build, date unspecified\nplatform: debian-amd64\noptions:  bn(64,64) rc4(16x,int) des(idx,cisc,16,int) blowfish(idx) \ncompiler: cc -I. -I.. -I../include  -fPIC -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -m64 -DL_ENDIAN -g -O2 -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -Wl,-Bsymbolic-functions -Wl,-z,relro -Wa,--noexecstack -Wall -DMD32_REG_T=int -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM\nOPENSSLDIR: \"/usr/lib/ssl\"\n</code></pre>\n\n<p>But on my prototype software I need a later version of it due to lack of the system-provided one and I want to avoid to install it globally. Thus I thought to use a local-only version limited pro project's scope. I found <a href=\"https://www.howtoforge.com/tutorial/how-to-install-openssl-from-source-on-linux/\" rel=\"nofollow noreferrer\">these</a> instructions that offer me a great framework.</p>\n\n<p>Also I did the first step to add is as a submodule to my project:</p>\n\n<pre><code>[submodule \"openssl\"]\n    path = openssl\n    url = https://github.com/openssl/openssl.git\n    branch = OPENSSL_1_1_1a\n</code></pre>\n\n<p>On console I tried to build it manually using the following command set:</p>\n\n<pre><code>cd openssl\n./config --prefix=$(pwd)/../builds/openssl --openssldir=$(pwd)/../builds/openssl\nmake &amp;&amp; make test &amp;&amp; make install\n</code></pre>\n\n<p>And now I want to go further and somehow to tel the <code>mpicc</code> to link the build openssl lib located somehow the <code>builds</code> dir but I do not know that.</p>\n"}, {"tags": ["c", "multithreading", "parallel-processing", "task", "openmp"], "comments": [{"owner": {"reputation": 44162, "user_id": 752843, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/dfab97c10311207545414b6d7d9bde93?s=128&d=identicon&r=PG", "display_name": "Richard", "link": "https://stackoverflow.com/users/752843/richard"}, "edited": false, "score": 0, "creation_date": 1549402752, "post_id": 54543283, "comment_id": 95888023, "body": "Use a thread safe queue from, say, TBB to set up a producer-consumer system using busy waiting?"}, {"owner": {"reputation": 13, "user_id": 11019779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21a519f7d86d6afcc7740c45f5c99f4?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Tavares", "link": "https://stackoverflow.com/users/11019779/matheus-tavares"}, "reply_to_user": {"reputation": 44162, "user_id": 752843, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/dfab97c10311207545414b6d7d9bde93?s=128&d=identicon&r=PG", "display_name": "Richard", "link": "https://stackoverflow.com/users/752843/richard"}, "edited": false, "score": 1, "creation_date": 1549403215, "post_id": 54543283, "comment_id": 95888224, "body": "@Richard Thanks for commenting. It would be a nice option, but if I had to abandon OpenMP, I think I would use Pthreads directly. Maybe having semaphores to control the producer-consumer mechanism. But I would like to continue using OpenMP, for simplicity."}, {"owner": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "edited": false, "score": 0, "creation_date": 1549441851, "post_id": 54543283, "comment_id": 95898814, "body": "Why do you care if things are getting done? Typically it is the right thing that the master executes some of the tasks if the task queue is filling up and no thread is available. What is the reason you do not want to exploit that? Also note that this is generally implementation dependent, so you should add your implementation and version."}, {"owner": {"reputation": 13, "user_id": 11019779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21a519f7d86d6afcc7740c45f5c99f4?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Tavares", "link": "https://stackoverflow.com/users/11019779/matheus-tavares"}, "reply_to_user": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "edited": false, "score": 0, "creation_date": 1549463024, "post_id": 54543283, "comment_id": 95911287, "body": "@Zulan I don&#39;t want master thread to work on the tasks because it needs to be 100% dedicated to talking with an external device (which is a GPU). If master starts working on CPU tasks, it won&#39;t be able to keep a live connection to GPU, sending work to it as soon as it finishes the previous work, which would be a wast of computational resource (in my application)."}, {"owner": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "edited": false, "score": 0, "creation_date": 1549464007, "post_id": 54543283, "comment_id": 95911933, "body": "What would happen in your envisioned application if all workers are busy and CPU tasks aren&#39;t getting done? Would that impact performance?"}, {"owner": {"reputation": 13, "user_id": 11019779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21a519f7d86d6afcc7740c45f5c99f4?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Tavares", "link": "https://stackoverflow.com/users/11019779/matheus-tavares"}, "reply_to_user": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "edited": false, "score": 0, "creation_date": 1549464098, "post_id": 54543283, "comment_id": 95911999, "body": "@Zulan No, because what dictates the execution time is the GPU work (task on CPU are just leftovers from GPU, to get a little more speedup)."}], "answers": [{"tags": [], "owner": {"reputation": 20828, "user_id": 620382, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf285996e4e7188feac84786a47d9f3a?s=128&d=identicon&r=PG", "display_name": "Zulan", "link": "https://stackoverflow.com/users/620382/zulan"}, "is_accepted": false, "score": 2, "last_activity_date": 1549530583, "creation_date": 1549530583, "answer_id": 54569776, "question_id": 54543283, "link": "https://stackoverflow.com/questions/54543283/how-to-make-a-producer-consumer-code-with-openmp/54569776#54569776", "title": "How to make a producer-consumer code with OpenMP?", "body": "<p>The answer is a bit longer than practically necessary, please make sure to read it all. I wanted to include also the theoretical parts, which unfortunately don't matter practically.</p>\n\n<p>Generally, OpenMP gives a lot of freedom about the execution to the implementation. This can allow optimizations in the implementation - and I encourage you to do the same: Allow the implementation - compiler &amp; library - to do what it thinks is best while giving it the most information possible. At the same time, measure the performance end-to-end and with tools that understand OpenMP. Try to understand what actually happens, rather than rely <em>only</em> on your intuitive understanding what's optimal.</p>\n\n<p>OpenMP 4.5 gives you one way to tell kind-of the compiler what you want - task priorities. i.e.</p>\n\n<pre><code>#pragma omp single\n{\n    #pragma omp task priority(10)\n    {\n        printf(\"MASTER START\\n\");\n        fflush(stdout);\n        for (int i = 0; i &lt; 1000; ++i)\n        {\n            #pragma omp task priority(0)\n            {\n                    printf(\"[Thread %d] working on task %d\\n\", omp_get_thread_num(), i);\n</code></pre>\n\n<p>As per the standard, tasks with a higher numerical priority value are recommended to execute before lower priority ones. This is only a <strong>hint</strong> and the implementation is free to ignore this.</p>\n\n<p>The freedom given by the standard also allows <a href=\"https://stackoverflow.com/q/46601207/620382\">lazy impementations</a>. <code>libgomp</code> (gcc's OpenMP library), for instance, has <a href=\"https://github.com/gcc-mirror/gcc/blob/fbd263526ad105a953fd51d9f7bca2c3f268cf82/libgomp/task.c#L388\" rel=\"nofollow noreferrer\">a hard-coded logic</a> to immediately execute all spawned tasks if there are more than 64 queued tasks per thread. I don't believe the priority matters in the decision to defer a task or not, only for queued tasks.</p>\n\n<p>Which you can observe using something like this:</p>\n\n<pre><code>int task_count = 1;\n#pragma omp parallel\n{\n    #pragma omp single\n    {\n        printf(\"MASTER START (%d)\\n\", omp_get_thread_num());\n        fflush(stdout);\n        for (int i = 0; i &lt; 1000; ++i)\n        {\n            #pragma omp atomic\n            task_count++;\n            #pragma omp task\n            {\n                int q;\n                #pragma omp atomic capture\n                q = task_count--;\n                printf(\"[Thread %d] working on task %d (%d queued)\\n\", omp_get_thread_num(), i, q);\n</code></pre>\n\n<p>You could use that information to prevent spawning tasks in the first place if there are too many tasks in flight already. Now you say, it doesn't matter if CPU tasks aren't getting done. I doubt that, somehow they have to eventually complete. So you may want to avoid spawning too many CPU tasks anyway. Unfortunately you end up with a implementation-specific solution that is based on understanding of how this implementation works. On the other hand, it will probably also help with the other major OpenMP library used by Intel/clang. It is up to you to figure out if this is a better solution than rolling out your own tasks queue management - be it on top of OpenMP, pthreads, tbb or whatever.</p>\n"}], "owner": {"reputation": 13, "user_id": 11019779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21a519f7d86d6afcc7740c45f5c99f4?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Tavares", "link": "https://stackoverflow.com/users/11019779/matheus-tavares"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1026, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549530583, "creation_date": 1549401965, "last_edit_date": 1549463518, "question_id": 54543283, "link": "https://stackoverflow.com/questions/54543283/how-to-make-a-producer-consumer-code-with-openmp", "title": "How to make a producer-consumer code with OpenMP?", "body": "<p>I'm trying to make a single thread (master), in an OpenMP C code, continuously work in a single operation (which is to produce tasks) while the others (slaves) wait for the tasks produced by the master to work on. Is it possible to make the master thread work only on it's specific task, without having other tasks scheduled to it?</p>\n\n<p>The purpose of this, is to have a single thread, communicating all the time with an external device and producing tasks to be executed by the other threads.</p>\n\n<p>Here is an example of what I'm trying:</p>\n\n<pre><code>#pragma omp parallel\n{\n    #pragma omp master\n    {\n        printf(\"MASTER START\\n\"); fflush(stdout);\n        for(int i = 0; i &lt; 1000; ++i) {\n            #pragma omp task\n            {\n                printf(\"[Thread %d] working on task %d\\n\", omp_get_thread_num(), i);\n                fflush(stdout);\n            }\n        }\n        printf(\"MASTER END\\n\"); fflush(stdout);\n    }\n}\n</code></pre>\n\n<p>Executing the code above with two threads, I get something like this:</p>\n\n<pre><code>MASTER START\n...\n[Thread 1] working on task 998\n[Thread 0] working on task 999\n...\nMASTER END\n[Thread 1] working on task 694\n[Thread 0] working on task 696\n...\n</code></pre>\n\n<p>Which clearly shows that the master thread is working in the tasks it created before it finished its work. That's what I want to avoid. Master thread should work exclusively on it's work before helping the others on the tasks.</p>\n\n<p>Note: I know OpenMP specification says tasks may be executed right as they are created (by the creator) instead of going to the queue. So maybe I cannot use tasks directives to achieve the result I want? Is there any other way to do that with OpenMP?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Just to clarify why I want master thread NOT to work on the tasks: Master thread, in my application, is responsible for sending tasks to GPU and receiving results. Some of the work that is not done at GPU is them delegated to the CPU threads (in the form of omp tasks, for now). If master thread starts working on the CPU tasks, them it won't communicate with GPU and GPU will be idle.</p>\n\n<p>The compiler I'm using is nvcc 10.0.130 and gcc 8.2.1</p>\n"}, {"tags": ["c", "pointers", "scope", "stm32", "dma"], "comments": [{"owner": {"reputation": 3612, "user_id": 1813336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1zONI.jpg?s=128&g=1", "display_name": "cleblanc", "link": "https://stackoverflow.com/users/1813336/cleblanc"}, "edited": false, "score": 2, "creation_date": 1549398233, "post_id": 54542414, "comment_id": 95886068, "body": "You&#39;re correct to be suspicious, it&#39;s not safe.  Just make it <code>static uint16_t distance</code> and your scope will remain."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1549398500, "post_id": 54542414, "comment_id": 95886171, "body": "... but if you do make it <code>static</code>, make sure that you don&#39;t reinitialize another transfer with the same buffer before the first one have finished."}, {"owner": {"reputation": 1036, "user_id": 8848476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/irmYE.jpg?s=128&g=1", "display_name": "ReAl", "link": "https://stackoverflow.com/users/8848476/real"}, "edited": false, "score": 0, "creation_date": 1549456817, "post_id": 54542414, "comment_id": 95907539, "body": "You should add something like <code>wait_DMA_not_busy()</code> after <code>doOtherStuff()</code> (or before <code>getDistance()</code>) otherwise <code>distance</code> could be overridden not depend on static/auto storage type."}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 9462426, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dHbd7XEUB4M/AAAAAAAAAAI/AAAAAAAABuQ/0QrbML4_3b0/photo.jpg?sz=128", "display_name": "Gregorio Aiello", "link": "https://stackoverflow.com/users/9462426/gregorio-aiello"}, "is_accepted": true, "score": 1, "last_activity_date": 1549664243, "creation_date": 1549664243, "answer_id": 54601012, "question_id": 54542414, "link": "https://stackoverflow.com/questions/54542414/passing-pointer-of-automatic-variable-to-dma-function/54601012#54601012", "title": "Passing pointer of automatic variable to DMA function", "body": "<p>The function</p>\n\n<pre><code>HAL_UART_Transmit_DMA(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size)\n</code></pre>\n\n<p>takes the pointer pData which is copied immediately in</p>\n\n<pre><code>huart-&gt;pTxBuffPtr = pData;\n</code></pre>\n\n<p>But that value is not actually used or sent because after few lines you can find:</p>\n\n<pre><code>tmp = (uint32_t*)&amp;pData;\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>HAL_DMA_Start_IT(huart-&gt;hdmatx, *(uint32_t*)tmp, (uint32_t)&amp;huart-&gt;Instance-&gt;DR, Size);\n</code></pre>\n\n<p>So your pointer is used when <i>&amp;pData</i> is copied into <i>tmp</i> and then is still used in the DMA call all the way down until the DMA is configured with:</p>\n\n<pre><code>hdma-&gt;Instance-&gt;M0AR = SrcAddress;\n</code></pre>\n\n<p>thus this is not safe since from there the next thing you know is the interrupt of TX complete from the DMA. So in the end when you return from </p>\n\n<pre><code>HAL_UART_Transmit_DMA\n</code></pre>\n\n<p>and branch to</p>\n\n<pre><code>doOtherStuff();\n</code></pre>\n\n<p>You may still be using the pointer. As already mentioned declaring it static is a solution because the internal state machine is preventing to get problems if you recall the DMA transfer again with <i>&amp;distance</i>.</p>\n"}], "owner": {"reputation": 141, "user_id": 7815959, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/21d098bcfefc6f9ffec471c8f595254b?s=128&d=identicon&r=PG&f=1", "display_name": "Tryphon", "link": "https://stackoverflow.com/users/7815959/tryphon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 54601012, "answer_count": 1, "score": 0, "last_activity_date": 1549664243, "creation_date": 1549398018, "question_id": 54542414, "link": "https://stackoverflow.com/questions/54542414/passing-pointer-of-automatic-variable-to-dma-function", "title": "Passing pointer of automatic variable to DMA function", "body": "<p>Question is specifically about the STM32 microcontrollers using DMA. </p>\n\n<p>Consider the following:</p>\n\n<pre><code>while(true){\n    randomStuff();\n    uint16_t distance;\n    getDistance(&amp;distance);\n    HAL_UART_Transmit_DMA((uint8_t*)&amp;distance, 2);\n    doOtherStuff();\n}\n</code></pre>\n\n<p>Now normally when using a single thread this would be fine since the execution follows a linear flow and distance will not go out of scope before the called function finishes. However this is a special call to a DMA peripheral that doesn't block and allows execution to continue, and thus go out of scope for the \"distance\" variable. </p>\n\n<p>Inside this DMA function I can see the pointer gets copied:</p>\n\n<pre><code>huart-&gt;pTxBuffPtr = pData;\n</code></pre>\n\n<p>After that it calls this where TDR is supposed to be destination address:</p>\n\n<pre><code>HAL_DMA_Start_IT(huart-&gt;hdmatx, (uint32_t)huart-&gt;pTxBuffPtr, (uint32_t)&amp;huart-&gt;Instance-&gt;TDR, Size);\n</code></pre>\n\n<p>It's not clear to me at what point the usage of my pointer ends and when my scope here ends. Is this safe to do? </p>\n\n<p>I want to avoid using dynamic allocation because it's an embedded system, which has a tendency to get fragmented and crash if you overuse dynamic allocations.</p>\n"}, {"tags": ["c", "raku", "nativecall"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1549397650, "post_id": 54542286, "comment_id": 95885814, "body": "Please provide much more information. &quot;bug in Rakudo&quot;? What did you try? How did it fail? Also please try to avoid the impression that this is not a programming question, i.e. that it is a question on using an editor feature."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1549397714, "post_id": 54542286, "comment_id": 95885845, "body": "You want to use &quot;using a double pointer in cipher_context_init and returning an int&quot; to align code in an editor?"}, {"owner": {"reputation": 3151, "user_id": 9574771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d205b5efbf77202893f777a90fde50d?s=128&d=identicon&r=PG&f=1", "display_name": "Kaiepi", "link": "https://stackoverflow.com/users/9574771/kaiepi"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1549397797, "post_id": 54542286, "comment_id": 95885883, "body": "My bad @Yunnosch, i&#39;ll include more information"}, {"owner": {"reputation": 3151, "user_id": 9574771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d205b5efbf77202893f777a90fde50d?s=128&d=identicon&r=PG&f=1", "display_name": "Kaiepi", "link": "https://stackoverflow.com/users/9574771/kaiepi"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1549398176, "post_id": 54542286, "comment_id": 95886038, "body": "I made an issue about this. It provides much more information as to what the problem is <a href=\"https://github.com/rakudo/rakudo/issues/2673\" rel=\"nofollow noreferrer\">github.com/rakudo/rakudo/issues/2673</a>"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1549398320, "post_id": 54542286, "comment_id": 95886093, "body": "So the problem is a bug which you already reported to the appropriate person. What is it you want here? A workaround for a bug? Also questions on StackOverflow are expected to contain all needed information. A link is considered a weakness because of the risk that it becomes unavailable. Also all info should be in the question itself and not hidden in comments."}, {"owner": {"reputation": 3151, "user_id": 9574771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d205b5efbf77202893f777a90fde50d?s=128&d=identicon&r=PG&f=1", "display_name": "Kaiepi", "link": "https://stackoverflow.com/users/9574771/kaiepi"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1549398477, "post_id": 54542286, "comment_id": 95886162, "body": "Sorry about the haphazardness in the question. I&#39;m looking for a workaround for the bug"}, {"owner": {"reputation": 2965, "user_id": 5548927, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/56e4d9e2488329026ab4b65d05cda3fb?s=128&d=identicon&r=PG", "display_name": "Curt Tilmes", "link": "https://stackoverflow.com/users/5548927/curt-tilmes"}, "edited": false, "score": 0, "creation_date": 1549400556, "post_id": 54542286, "comment_id": 95887047, "body": "Simplify the example as much as possible.  Would a single struct member and a single function demonstrate the issue?  I&#39;m still trying to figure out with all of that exactly what the question is."}, {"owner": {"reputation": 2965, "user_id": 5548927, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/56e4d9e2488329026ab4b65d05cda3fb?s=128&d=identicon&r=PG", "display_name": "Curt Tilmes", "link": "https://stackoverflow.com/users/5548927/curt-tilmes"}, "edited": false, "score": 1, "creation_date": 1549400618, "post_id": 54542286, "comment_id": 95887080, "body": "A &#39;double pointer&#39; is just a Pointer that happens to point to a Pointer.  You can usually just tell Perl 6 it is a Pointer and just make sure you set its value correctly."}, {"owner": {"reputation": 2965, "user_id": 5548927, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/56e4d9e2488329026ab4b65d05cda3fb?s=128&d=identicon&r=PG", "display_name": "Curt Tilmes", "link": "https://stackoverflow.com/users/5548927/curt-tilmes"}, "edited": false, "score": 0, "creation_date": 1549400789, "post_id": 54542286, "comment_id": 95887136, "body": "Difficult to say without more detail, but perhaps <code>cipher_context_init()</code> wants a pointer to a pointer that it will then set to point to some memory it allocates for you?  You can usually do that with a <code>Pointer is rw</code>."}, {"owner": {"reputation": 3151, "user_id": 9574771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d205b5efbf77202893f777a90fde50d?s=128&d=identicon&r=PG&f=1", "display_name": "Kaiepi", "link": "https://stackoverflow.com/users/9574771/kaiepi"}, "edited": false, "score": 0, "creation_date": 1549401998, "post_id": 54542286, "comment_id": 95887669, "body": "I was using <code>Pointer[::?CLASS]  is rw</code>. The question&#39;s been updated"}], "answers": [{"tags": [], "owner": {"reputation": 31843, "user_id": 1337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/72de240484e389dbedb6a3e428b9f0c1?s=128&d=identicon&r=PG", "display_name": "Brad Gilbert", "link": "https://stackoverflow.com/users/1337/brad-gilbert"}, "is_accepted": true, "score": 5, "last_activity_date": 1549404888, "creation_date": 1549404888, "answer_id": 54543886, "question_id": 54542286, "link": "https://stackoverflow.com/questions/54542286/how-to-mitigate-a-bug-in-rakudo-with-nativecall/54543886#54543886", "title": "How to mitigate a bug in Rakudo with NativeCall?", "body": "<p>That fails for the same reason this fails:</p>\n\n<pre><code>class Foo {...}\n\nBEGIN Foo ~~ Bool; # &lt;------\n\nclass Foo{\n}\n</code></pre>\n\n<p>Part of the problem seems to be that <code>Foo</code> isn't composed yet when the <code>Pointer.^parameterize</code> method gets called.</p>\n\n<p>So it isn't a subtype of <code>Any</code> yet. (or even <code>Mu</code>)</p>\n\n<p>A workaround is to add a <code>.^compose</code> call in a <code>BEGIN</code> phaser before you use <code>Pointer[::?\ufeffCLASS]</code>.</p>\n\n<pre><code>class Foo is repr('CPointer') {\n  BEGIN ::?CLASS.^compose;\n\n  my Pointer[::?CLASS] $foo .= new;\n}\n</code></pre>\n\n<hr>\n\n<p>My guess is that the real fix will be to change the <code>Bool.ACCEPTS(Bool:U:\u00a0\\topic)</code> candidate to <code>Bool.ACCEPTS(Bool:U:\u00a0Mu\u00a0\\topic)</code>.</p>\n\n<p>The reason I think that is because this also fails with basically the same error:</p>\n\n<pre><code>Mu ~~ Bool\n</code></pre>\n"}], "owner": {"reputation": 3151, "user_id": 9574771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d205b5efbf77202893f777a90fde50d?s=128&d=identicon&r=PG&f=1", "display_name": "Kaiepi", "link": "https://stackoverflow.com/users/9574771/kaiepi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 54543886, "answer_count": 1, "score": 4, "last_activity_date": 1549404888, "creation_date": 1549397460, "last_edit_date": 1549403133, "question_id": 54542286, "link": "https://stackoverflow.com/questions/54542286/how-to-mitigate-a-bug-in-rakudo-with-nativecall", "title": "How to mitigate a bug in Rakudo with NativeCall?", "body": "<p>I want to be able to use a double pointer in a class with REPR CStruct/CPointer:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef struct CipherContext {\n          void    *cipher;\n    const uint8_t *key;\n          size_t   key_len;\n    const uint8_t *path;\n          size_t   path_len;\n          size_t   block_size;\n          void    *handle;\n\n          int      (*cipher_init)(void **, const uint8_t *, size_t);\n          int      (*cipher_encode)(void *, const uint8_t *, uint8_t *, size_t);\n          int      (*cipher_decode)(void *, const uint8_t *, uint8_t *, size_t);\n          void     (*cipher_free)(void *);\n    const uint8_t *(*cipher_strerror)(int);\n} CipherContext;\n\n      int            cipher_context_init(CipherContext **, const uint8_t *, size_t, const uint8_t *, size_t, size_t);\n      int            cipher_context_encode(CipherContext *, const uint8_t *, uint8_t *, size_t);\n      int            cipher_context_decode(CipherContext *, const uint8_t *, uint8_t *, size_t);\n      void           cipher_context_free(CipherContext *);\nconst uint8_t       *cipher_context_strerror(int);\n</code></pre>\n\n<p>Perl 6 code:</p>\n\n<pre><code>method new(Blob :$key!, Str :$path!, Int :$block-size!) {\n    my Pointer[::?CLASS]     $ptr     .= new;\n    my Int                   $err      = cipher_context_init($ptr, $key, $key.elems, $path, $path.codes, $block-size);\n    return $ptr.deref unless $err;\n\n    my Str $errstr = cipher_context_strerror($err) || do {\n        my &amp;cipher-strerror = nativecast(:(int32 --&gt; Str), $!cipher-strerror);\n        cipher-strerror($err)\n    };\n    die \"Failed to initialize cipher context: $errstr\";\n}\n\nsubmethod DESTROY() {\n    cipher_context_free(self)\n}\n</code></pre>\n\n<p>Short golf:</p>\n\n<pre><code>use v6.d;\nuse Nativecall;\n\nclass Foo is repr('CPointer') { \n    my Pointer[::?CLASS] $foo .= nw;\n}\n</code></pre>\n\n<p>Only I can't figure out how to do it due to a <a href=\"https://github.com/rakudo/rakudo/issues/2673\" rel=\"nofollow noreferrer\">bug in Rakudo</a>. Is there a better way I could be handling errors in the C portion of the code (which is why I'm writing it like this)?</p>\n"}, {"tags": ["c", "struct", "macros"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1549395711, "post_id": 54541870, "comment_id": 95884924, "body": "^this is a macro, you cannot use the function decl. syntax, then <code>v</code> isn&#39;t defined"}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1549395801, "post_id": 54541870, "comment_id": 95884965, "body": "maybe <code>#define vectorSub(c,v) {(v)-&gt;x * (c), (v)-&gt;y * (c), (v)-&gt;z * (c) }</code>"}, {"owner": {"reputation": 127, "user_id": 5071756, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5319a94ce4c42a0f7337378721895224?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Ravi", "link": "https://stackoverflow.com/users/5071756/abhishek-ravi"}, "reply_to_user": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1549395897, "post_id": 54541870, "comment_id": 95885015, "body": "sorry that was a typo, I&#39;ll edit it"}, {"owner": {"reputation": 673100, "user_id": 335858, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4af3541c00d591e9a518b9c0b3b1190a?s=128&d=identicon&r=PG", "display_name": "Sergey Kalinichenko", "link": "https://stackoverflow.com/users/335858/sergey-kalinichenko"}, "reply_to_user": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1549396021, "post_id": 54541870, "comment_id": 95885078, "body": "@Jean-Fran&#231;oisFabre That may cause trouble when <code>c</code> or <code>v</code> expression happens to have side effects."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 4, "creation_date": 1549396044, "post_id": 54541870, "comment_id": 95885090, "body": "An inline function would be superior to a macro."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 673100, "user_id": 335858, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4af3541c00d591e9a518b9c0b3b1190a?s=128&d=identicon&r=PG", "display_name": "Sergey Kalinichenko", "link": "https://stackoverflow.com/users/335858/sergey-kalinichenko"}, "edited": false, "score": 1, "creation_date": 1549396095, "post_id": 54541870, "comment_id": 95885114, "body": "@dasblinkenlight couldn&#39;t agree more. Hence the warning in my answer"}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1549396226, "post_id": 54541870, "comment_id": 95885167, "body": "@bruno okay. It happens. There aren&#39;t many other options (besides <i>not</i> creating a macro). I&#39;m thinking about inlining right now :)"}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1549396359, "post_id": 54541870, "comment_id": 95885235, "body": "oh, didn&#39;t even read this comment. of course !"}, {"owner": {"reputation": 673100, "user_id": 335858, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4af3541c00d591e9a518b9c0b3b1190a?s=128&d=identicon&r=PG", "display_name": "Sergey Kalinichenko", "link": "https://stackoverflow.com/users/335858/sergey-kalinichenko"}, "edited": false, "score": 2, "creation_date": 1549396657, "post_id": 54541870, "comment_id": 95885350, "body": "I suggest <a href=\"https://ideone.com/U7OKx9\" rel=\"nofollow noreferrer\">inlining the function</a>."}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 5071756, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5319a94ce4c42a0f7337378721895224?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Ravi", "link": "https://stackoverflow.com/users/5071756/abhishek-ravi"}, "edited": false, "score": 0, "creation_date": 1549396788, "post_id": 54541970, "comment_id": 95885403, "body": "I understand it is best practice to use inlines, when I use static inline and try compiling it I get the following error:  cc -xinline=%vectorScale q1/test.c -o bin/test cc: error: language inline=%vectorScale not recognized"}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 127, "user_id": 5071756, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5319a94ce4c42a0f7337378721895224?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Ravi", "link": "https://stackoverflow.com/users/5071756/abhishek-ravi"}, "edited": false, "score": 0, "creation_date": 1549396849, "post_id": 54541970, "comment_id": 95885437, "body": "that&#39;s a completely different issue with your exotic/old compiler and its command line options."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 127, "user_id": 5071756, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5319a94ce4c42a0f7337378721895224?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Ravi", "link": "https://stackoverflow.com/users/5071756/abhishek-ravi"}, "edited": false, "score": 2, "creation_date": 1549396924, "post_id": 54541970, "comment_id": 95885472, "body": "@AbhishekRavi do you understand the danger with the macro in case at least a parameter contains side effect ?"}, {"owner": {"reputation": 127, "user_id": 5071756, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5319a94ce4c42a0f7337378721895224?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Ravi", "link": "https://stackoverflow.com/users/5071756/abhishek-ravi"}, "edited": false, "score": 0, "creation_date": 1549397772, "post_id": 54541970, "comment_id": 95885870, "body": "I do see the dangers, this is for understanding purposes mainly, not going to any important use cases."}, {"owner": {"reputation": 127, "user_id": 5071756, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5319a94ce4c42a0f7337378721895224?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Ravi", "link": "https://stackoverflow.com/users/5071756/abhishek-ravi"}, "edited": false, "score": 0, "creation_date": 1549397902, "post_id": 54541970, "comment_id": 95885937, "body": "Thank you so much, this helped a lot!"}], "tags": [], "owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "is_accepted": false, "score": 5, "last_activity_date": 1549396999, "last_edit_date": 1549396999, "creation_date": 1549396038, "answer_id": 54541970, "question_id": 54541870, "link": "https://stackoverflow.com/questions/54541870/c-macro-to-return-a-struct/54541970#54541970", "title": "C macro to return a Struct", "body": "<p>macros arguments don't have a type. You want:</p>\n\n<pre><code>#define vectorSub(c,v) {(v)-&gt;x * (c), (v)-&gt;y * (c), (v)-&gt;z * (c) } \n</code></pre>\n\n<p>That's the best equivalent unless someone calls your macro like this:</p>\n\n<pre><code>vector v2 = vectorSub(i++,v);\n</code></pre>\n\n<p>which is the common issue with macros using their parameters more than once because it will expand as:</p>\n\n<pre><code>{(v)-&gt;x * (i++), (v)-&gt;y * (i++), (v)-&gt;z * (i++) }\n</code></pre>\n\n<p>Complete self-contained and compiling example:</p>\n\n<pre><code>typedef struct  {\n  float x,y,z;\n} vector;\n\n#define vectorSub(c,v) {(v)-&gt;x * (c), (v)-&gt;y * (c), (v)-&gt;z * (c) } \n\nvector foo()\n{\n  vector v = {0,3,4};\n  vector v2 = vectorSub(12,&amp;v);\n  return v2;\n}\n</code></pre>\n\n<p>note that a good compiler can/will inline such short functions, as your original <code>vectorScale</code>, specially if the <code>inline</code> keyword is used to send a hint the compiler (compiler doesn't necessarily comply) and the function is in the header file, so macros aren't the best choice here, specially since they don't involve macro trickery like token-pasting or stringing.</p>\n"}, {"tags": [], "owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 5, "last_activity_date": 1549397008, "creation_date": 1549397008, "answer_id": 54542181, "question_id": 54541870, "link": "https://stackoverflow.com/questions/54541870/c-macro-to-return-a-struct/54542181#54542181", "title": "C macro to return a Struct", "body": "<pre><code>#define vectorScale(c, v) \\\n    ((vector) {(v)-&gt;x * (c), (v)-&gt;y * (c), (v)-&gt;z * (c) })\n</code></pre>\n\n<p>This construct, of the form <code>(type) { initial values }</code>, is called a compound literal. It is an object of the <code>type</code>.</p>\n\n<p>However, with a decent compiler, it should serve to use a static inline function:</p>\n\n<pre><code>static inline vector vectorScale(float c, vector *v)\n{\n    return (vector) {v-&gt;x * c, v-&gt;y * c, v-&gt;z * c };\n}\n</code></pre>\n\n<p>A good compiler should optimize this to be as efficient as the macro, and it avoids issues with <code>v</code> or <code>c</code> being expressions with side effects.</p>\n"}], "owner": {"reputation": 127, "user_id": 5071756, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5319a94ce4c42a0f7337378721895224?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Ravi", "link": "https://stackoverflow.com/users/5071756/abhishek-ravi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 766, "favorite_count": 0, "accepted_answer_id": 54542181, "answer_count": 2, "score": 5, "last_activity_date": 1549397008, "creation_date": 1549395624, "last_edit_date": 1549396555, "question_id": 54541870, "link": "https://stackoverflow.com/questions/54541870/c-macro-to-return-a-struct", "title": "C macro to return a Struct", "body": "<p>Is there a way to have a macro do exactly what this function does? I'm fairly new to C, any help is appreciated! </p>\n\n<pre><code>vector vectorScale(float c, vector *v){\n    vector result = {v-&gt;x * c, v-&gt;y * c, v-&gt;z * c };\n    return result;\n}\ntypedef struct{\n    float x,y,z;\n}vector;\n</code></pre>\n\n<p>I'm currently trying this but getting errors:</p>\n\n<pre><code>#define vectorScale(vector v, vector c)    vector {float (v-&gt;x * c); float (v-&gt;y * c); float (v-&gt;z * c); }\n</code></pre>\n"}, {"tags": ["c", "pointers", "strcpy"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 2, "creation_date": 1549395484, "post_id": 54541785, "comment_id": 95884822, "body": "Please post <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1549395948, "post_id": 54541785, "comment_id": 95885046, "body": "In <code>tripleptr[i] = malloc(sizeof(*(tripleptr[i]))*size);</code>, why is <code>size</code> used? <code>size</code> contains the number of lines, which was used to allocate space for <code>triplepointer</code>. Why is it used again to allocate space for <code>triplepointer[i]</code>? Are you making a square array? Why?"}, {"owner": {"reputation": 3853, "user_id": 2474248, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BDsoE.jpg?s=128&g=1", "display_name": "machine_1", "link": "https://stackoverflow.com/users/2474248/machine-1"}, "edited": false, "score": 0, "creation_date": 1549397732, "post_id": 54541785, "comment_id": 95885853, "body": "I was wondering when a three star programmer will turn up."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549496247, "post_id": 54541785, "comment_id": 95927270, "body": "OT: you might want to read <a href=\"http://wiki.c2.com/?ThreeStarProgrammer\" rel=\"nofollow noreferrer\">3starProgrammer</a>"}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": true, "score": 2, "last_activity_date": 1549395713, "creation_date": 1549395713, "answer_id": 54541889, "question_id": 54541785, "link": "https://stackoverflow.com/questions/54541785/c-triple-pointers-unable-to-copy-string-into-position-triplepointerxy-with/54541889#54541889", "title": "C triple pointers: Unable to copy string into position triplepointer[x][y] with [x] being greater than 1", "body": "<p>The problem is in your loops:</p>\n\n<pre><code>int i = 0, k = 0, j = 0;\nfor(; i &lt; size; i++){\n    tripleptr[i] = malloc(sizeof(*(tripleptr[i]))*size);\n    for(; k&lt; size; k++){\n        tripleptr[i][k] = malloc(sizeof(*(tripleptr[i][k]))*512);\n    }\n}\n</code></pre>\n\n<p>You initialized <code>i</code> and <code>k</code> before entering the nested loop, but you don't reset <code>k</code> when the inner loop restarts on the next iteration.  This means that you only allocated memory for the first row of strings.  So <code>tripleptr[1][0]</code> is uninitialized, and dereferencing that pointer gives you <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a>.</p>\n\n<p>Explicitly initialize youf loop control variables each time:</p>\n\n<pre><code>int i, k;\nfor(i=0; i &lt; size; i++){\n    tripleptr[i] = malloc(sizeof(*(tripleptr[i]))*size);\n    for(k=0; k&lt; size; k++){\n        tripleptr[i][k] = malloc(sizeof(*(tripleptr[i][k]))*512);\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 0, "last_activity_date": 1549495983, "creation_date": 1549495983, "answer_id": 54564192, "question_id": 54541785, "link": "https://stackoverflow.com/questions/54541785/c-triple-pointers-unable-to-copy-string-into-position-triplepointerxy-with/54564192#54564192", "title": "C triple pointers: Unable to copy string into position triplepointer[x][y] with [x] being greater than 1", "body": "<p>the following proposed code:</p>\n\n<ol>\n<li>illustrates how the block of code should be done</li>\n<li>indicates how much memory is actually being allocated</li>\n<li>reminds you that the code needs to check for errors</li>\n<li>indicates how to handle the error, if one occurs</li>\n</ol>\n\n<p>and now, the proposed code:</p>\n\n<pre><code>//In this case size will always be 4\nint size = countLines(file);\nprintf(\"size: %d\\n\", size);\n\nchar*** tripleptr = malloc(sizeof(*tripleptr)*size);\n\nfor(int i = 0; i &lt; size; i++)\n{\n    tripleptr[i] = malloc(sizeof(*(tripleptr[i]))*size); // is 16 bytes each iteration, assuming a pointer is 4 bytes\n\n    for(int k = 0; k&lt; size; k++)\n    {\n        tripleptr[i][k] = malloc(sizeof(*(tripleptr[i][k]))*512); // is 4k bytes each iteration\n    }\n}\n</code></pre>\n\n<p>Note:  for robustness:</p>\n\n<p>when calling any of the heap allocation functions: <code>malloc()</code>, <code>realloc()</code>, <code>calloc()</code> : always check (!=NULL) the returned value to assure the operation was successful.</p>\n\n<p>If not successful, call <code>perror( \"my error message\" );</code>  as that will output to <code>stderr</code>, both your error message and the text reason the system thinks the error occurred.  And remember to pass each successfully allocated heap memory pointer to <code>free()</code> before exiting</p>\n"}], "owner": {"reputation": 5, "user_id": 6539200, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MeLVt.jpg?s=128&g=1", "display_name": "CarbonaraSlayer", "link": "https://stackoverflow.com/users/6539200/carbonaraslayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 54541889, "answer_count": 2, "score": 0, "last_activity_date": 1549495983, "creation_date": 1549395227, "last_edit_date": 1549395309, "question_id": 54541785, "link": "https://stackoverflow.com/questions/54541785/c-triple-pointers-unable-to-copy-string-into-position-triplepointerxy-with", "title": "C triple pointers: Unable to copy string into position triplepointer[x][y] with [x] being greater than 1", "body": "<p>I'm trying out triple pointers for the first time.\n<a href=\"https://stackoverflow.com/a/25029444/6539200\">This question</a> is where I got the info on how to allocate a triple pointer and this is how the triple pointer has been allocated:</p>\n\n<pre><code>//In this case size will always be 4\nint size = countLines(file);\nprintf(\"size: %d\\n\", size);\nchar*** tripleptr = malloc(sizeof(*tripleptr)*size);\nint i = 0, k = 0, j = 0;\nfor(; i &lt; size; i++){\n    tripleptr[i] = malloc(sizeof(*(tripleptr[i]))*size);\n    for(; k&lt; size; k++){\n        tripleptr[i][k] = malloc(sizeof(*(tripleptr[i][k]))*512);\n    }\n}\n</code></pre>\n\n<p>If I try to copy a string literal into position [0][0] like this</p>\n\n<pre><code>strcpy(tripleptr[0][0], \"something\");\n</code></pre>\n\n<p>it works perfectly (same thing for [0][1] to [0][3]), but</p>\n\n<pre><code>strcpy(tripleptr[1][0], \"something\");\n</code></pre>\n\n<p>doesn't (it makes the program go into Segmentation Fault).\nWhat is it that could be causing such a weird behavior?\nI can't find any indexing mistake in the memory allocation part</p>\n"}, {"tags": ["c", "serial-port"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549394833, "post_id": 54541617, "comment_id": 95884549, "body": "How about <code>tcdrain</code>?"}, {"owner": {"reputation": 43, "user_id": 10807270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233398864fead426a023677dd908ae4f?s=128&d=identicon&r=PG&f=1", "display_name": "Bjduf123", "link": "https://stackoverflow.com/users/10807270/bjduf123"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549395603, "post_id": 54541617, "comment_id": 95884869, "body": "That does seem to work but it delays the line from being toggled for around 30 ms after it is called with any transmission length of 4 or higher and sometimes even 3 and with the encoder that i am using i need to toggle it 18 microseconds after the transmission finishes."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549395671, "post_id": 54541617, "comment_id": 95884903, "body": "What&#39;s your baud rate?"}, {"owner": {"reputation": 43, "user_id": 10807270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233398864fead426a023677dd908ae4f?s=128&d=identicon&r=PG&f=1", "display_name": "Bjduf123", "link": "https://stackoverflow.com/users/10807270/bjduf123"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549395817, "post_id": 54541617, "comment_id": 95884976, "body": "I am using a baud rate of 2000000"}], "owner": {"reputation": 43, "user_id": 10807270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233398864fead426a023677dd908ae4f?s=128&d=identicon&r=PG&f=1", "display_name": "Bjduf123", "link": "https://stackoverflow.com/users/10807270/bjduf123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549426862, "creation_date": 1549394530, "last_edit_date": 1549426862, "question_id": 54541617, "link": "https://stackoverflow.com/questions/54541617/waiting-for-serial-write-to-finish-before-continuing", "title": "Waiting for Serial write to finish before continuing", "body": "<p>I am attempting to talk with an encoder over the UART port on a Raspberry Pi 3 B+. I have disabled the Bluetooth on the Pi to enable full use of the UART port and am talking at 2000000b/s. </p>\n\n<p>I have verified this with an oscilloscope, but the problem that I am running into is that I must set a GPIO pin on the Raspberry Pi to high after the write has completely finished. Right now the write will always write just fine but the pin that I need to set will always go high in the middle of the write.</p>\n\n<pre><code>int sfd = open(\"/dev/serial0\", O_RDWR | O_NOCTTY); \nwiringPiSetup();\npinMode(21, OUTPUT);\nstruct termios options;\ntcgetattr(sfd, &amp;options);\ncfsetspeed(&amp;options, B2000000);\ncfmakeraw(&amp;options);\noptions.c_cflag &amp;= ~CSTOPB;\noptions.c_cflag |= CLOCAL;\noptions.c_cflag |= CREAD;\noptions.c_cc[VTIME]=1; \noptions.c_cc[VMIN]=100;\ntcsetattr(sfd, TCSANOW, &amp;options);\nchar buf[] = {\"T\"};\ndigitalWrite(21, LOW);\nint count = write(sfd, buf,strlen(buf));\ndigitalWrite(21, HIGH);\n</code></pre>\n\n<p>I would like the gpio pin to go high after the write has completely finished</p>\n"}, {"tags": ["c", "gcc", "lisp"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 4, "creation_date": 1549393199, "post_id": 54541273, "comment_id": 95883769, "body": "Are you asking if a preprocessor can generate random numbers? No, but you can pass the output of <code>&#47;dev&#47;urandom</code> to the compiler with <code>-D</code> and use the <code>#if</code> preprocessor directive."}, {"owner": {"reputation": 3612, "user_id": 1813336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1zONI.jpg?s=128&g=1", "display_name": "cleblanc", "link": "https://stackoverflow.com/users/1813336/cleblanc"}, "edited": false, "score": 2, "creation_date": 1549393199, "post_id": 54541273, "comment_id": 95883770, "body": "How about <code>gcc -DMACRO=printf(&quot;A&quot;); test.c</code> or <code>gcc -DMACRO=printf(&quot;B&quot;); test.c</code>"}, {"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 0, "creation_date": 1549393424, "post_id": 54541273, "comment_id": 95883876, "body": "When the preprocessor expands <code>MACRO;</code> it creates an empty statement <code>srand ... (&quot;B&quot;);;</code> because, unusually, your macro terminates with a semicolon. Just saying ... there is no problem with empty statements."}, {"owner": {"reputation": 7984, "user_id": 1398282, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/51ad9dc5224b0b292b820eeb71d17c9a?s=128&d=identicon&r=PG", "display_name": "foki", "link": "https://stackoverflow.com/users/1398282/foki"}, "reply_to_user": {"reputation": 3612, "user_id": 1813336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1zONI.jpg?s=128&g=1", "display_name": "cleblanc", "link": "https://stackoverflow.com/users/1813336/cleblanc"}, "edited": false, "score": 0, "creation_date": 1549405791, "post_id": 54541273, "comment_id": 95889100, "body": "Thank you @EugeneSh.and @cleblanc. With <code>-D</code> option we just supply the macro from outside of the codebase, right? It won&#39;t make preprocessor do any work different then it would do if we put the macro within the codebase."}, {"owner": {"reputation": 7984, "user_id": 1398282, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/51ad9dc5224b0b292b820eeb71d17c9a?s=128&d=identicon&r=PG", "display_name": "foki", "link": "https://stackoverflow.com/users/1398282/foki"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1549406139, "post_id": 54541273, "comment_id": 95889195, "body": "Thank you @ChristianGibbons, that was a typo. Although, when I looked at the description of <code>macro</code> tag and it probably isn&#39;t the best possible tag that I could put here. :)"}, {"owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549414826, "post_id": 54541273, "comment_id": 95891303, "body": "@EugeneSh. You made me realize that OP can actually achieve what he wants. Nice to know about <code>&#47;dev&#47;random</code>!"}], "answers": [{"comments": [{"owner": {"reputation": 7984, "user_id": 1398282, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/51ad9dc5224b0b292b820eeb71d17c9a?s=128&d=identicon&r=PG", "display_name": "foki", "link": "https://stackoverflow.com/users/1398282/foki"}, "edited": false, "score": 0, "creation_date": 1549405918, "post_id": 54541417, "comment_id": 95889137, "body": "Yes, that&#39;s what we do when we quote syntax in a Lisp macro, right?"}], "tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 1, "last_activity_date": 1549393650, "creation_date": 1549393650, "answer_id": 54541417, "question_id": 54541273, "link": "https://stackoverflow.com/questions/54541273/is-there-a-way-to-execute-arbitrary-code-in-c-preprocessor/54541417#54541417", "title": "Is there a way to execute arbitrary code in C preprocessor?", "body": "<p>You can't execute code in the preprocessor.  You can however create code that generates code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n\nint main() \n{\n    printf(\"#include &lt;stdio.h&gt;\\n\");\n    printf(\"\\n\");\n    printf(\"int main()\\n\");\n    printf(\"{\\n\");\n\n    srand(time(NULL));\n    if (rand() % 2)\n        printf(\"  printf(\\\"A\\\");\\n\");\n    else\n        printf(\"  printf(\\\"B\\\");\\n\");\n\n    printf(\"}\\n\");\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n  printf(\"A\");\n}\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n  printf(\"B\");\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7984, "user_id": 1398282, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/51ad9dc5224b0b292b820eeb71d17c9a?s=128&d=identicon&r=PG", "display_name": "foki", "link": "https://stackoverflow.com/users/1398282/foki"}, "edited": false, "score": 0, "creation_date": 1549406670, "post_id": 54541420, "comment_id": 95889356, "body": "Thank you for the answer. &quot;Why?&quot;. A colleague of mine asked me: &quot;How horrible is compiling arbitrary C code submitted to a server?&quot;. The answer that I had at the moment was &quot;Provided that you can write arbitrary code in macros, it&#39;s infinitely horrible.&quot; Then I tried to write some malicious code in macros to check my answer. I quickly realized that it&#39;s actually not that straight forward and that I was too Lisp-thinking at the moment."}, {"owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 0, "creation_date": 1549412345, "post_id": 54541420, "comment_id": 95890762, "body": "Actually, you can execute arbitrary code in CPP. <a href=\"https://www.boost.org/doc/libs/1_69_0/libs/preprocessor/doc/AppendixA-AnIntroductiontoPreprocessorMetaprogramming.html\" rel=\"nofollow noreferrer\">BoostPP</a> implements control structures, data types, and operations."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 0, "creation_date": 1549479904, "post_id": 54541420, "comment_id": 95920789, "body": "@okovko That doesn&#39;t qualify as &quot;arbitrary code execution&quot; for two reasons: it can&#39;t do arbitrary I/O, and it is subject to fixed upper limits on how many times you can iterate or recurse, making some algorithms unimplementable."}, {"owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 0, "creation_date": 1549492060, "post_id": 54541420, "comment_id": 95925916, "body": "@zwol The same limitation exists for any program. I/O is file based, which is inconvenient, but still I/O."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 0, "creation_date": 1549565283, "post_id": 54541420, "comment_id": 95957760, "body": "@okovko No, this is qualitatively different.  In CS-theoretic terms, I am ~95% certain the preprocessor can <i>at best</i> only compute <a href=\"http://mathworld.wolfram.com/PrimitiveRecursiveFunction.html\" rel=\"nofollow noreferrer\">primitive recursive</a> functions, which means for instance it is impossible to implement <a href=\"http://mathworld.wolfram.com/AckermannFunction.html\" rel=\"nofollow noreferrer\">the Ackermann function</a>"}, {"owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 0, "creation_date": 1549604215, "post_id": 54541420, "comment_id": 95969564, "body": "No, you can print the Ackermann function without a problem. You have genuine recursion, you just have a stack limit, just like any programming language."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "reply_to_user": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "edited": false, "score": 0, "creation_date": 1549637781, "post_id": 54541420, "comment_id": 95986050, "body": "@okovko I&#39;m going to need to see an actual implementation before I believe that. I really don&#39;t see how loops without a known-in-advance iteration count can be possible."}], "tags": [], "owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "is_accepted": true, "score": 3, "last_activity_date": 1549393664, "creation_date": 1549393664, "answer_id": 54541420, "question_id": 54541273, "link": "https://stackoverflow.com/questions/54541273/is-there-a-way-to-execute-arbitrary-code-in-c-preprocessor/54541420#54541420", "title": "Is there a way to execute arbitrary code in C preprocessor?", "body": "<blockquote>\n  <p>Is there a way to execute arbitrary code in C preprocessor?</p>\n</blockquote>\n\n<p>No, and this was an intentional design decision by the authors of the original (1989) C standard.  They were familiar with much more powerful macro systems (e.g. from Lisp, which does allow for arbitrary computation at compile time) and they thought those made it too hard to understand what an unfamiliar program means.</p>\n\n<p>It is not clear to me why you want to make a random choice at compile time.  If you explain your larger goals we may be able to be more helpful.</p>\n"}, {"tags": [], "owner": {"reputation": 1465, "user_id": 5122006, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d5d9f38947aef246351984de8786ce8c?s=128&d=identicon&r=PG&f=1", "display_name": "okovko", "link": "https://stackoverflow.com/users/5122006/okovko"}, "is_accepted": false, "score": 0, "last_activity_date": 1549414755, "last_edit_date": 1549414755, "creation_date": 1549411765, "answer_id": 54544931, "question_id": 54541273, "link": "https://stackoverflow.com/questions/54541273/is-there-a-way-to-execute-arbitrary-code-in-c-preprocessor/54544931#54544931", "title": "Is there a way to execute arbitrary code in C preprocessor?", "body": "<p>To compile based on the result of modulus by two of a random number, we'll need to use <a href=\"https://www.boost.org/doc/libs/1_69_0/libs/preprocessor/doc/index.html\" rel=\"nofollow noreferrer\">BoostPP</a>.</p>\n\n<pre><code>#include &lt;boost/preprocessor/control/if.hpp&gt;\n#include &lt;boost/preprocessor/arithmetic/mod.hpp&gt;\n\nBOOST_PP_IF(BOOST_PP_MOD(RAND, 2), printf(\"A\"); printf(\"B\");)\n</code></pre>\n\n<p>And you'll need to compile using the <code>-D</code> option to assign to <code>RAND</code> from <code>/dev/random</code>, like suggested to you in a comment.</p>\n\n<p>Here are some implementation details of a conditional macro to give you a taste of how it works. The modulus operation requires the implementation of data types and operations on them, which is too long to demonstrate here.</p>\n\n<pre><code>#define PRIMITIVE_CAT(a, ...) a ## __VA_ARGS__\n\n#define COMPL(b) PRIMITIVE_CAT(COMPL_, b)\n#define COMPL_0 1\n#define COMPL_1 0\n\n#define CHECK_N(x, n, ...) n\n#define CHECK(...) CHECK_N(__VA_ARGS__, 0,)\n#define PROBE(x) x, 1,\n\n#define NOT(x) CHECK(PRIMITIVE_CAT(NOT_, x))\n#define NOT_0 PROBE(~)\n\n#define BOOL(x) COMPL(NOT(x))\n\n#define IIF(c) PRIMITIVE_CAT(IIF_, c)\n#define IIF_0(t, ...) __VA_ARGS__\n#define IIF_1(t, ...) t\n\n#define IF(c) IIF(BOOL(c))\n\n#define EAT(...)\n#define EXPAND(...) __VA_ARGS__\n#define WHEN(c) IF(c)(EXPAND, EAT)\n</code></pre>\n\n<p>And the usage. Note that <code>WHEN(0)</code> does not expand, and any other <code>WHEN(arg)</code> will expand.</p>\n\n<pre><code>WHEN(0) ( \\\n  printf(\"A\"); \\\n)\nWHEN(1) ( \\\n  printf(\"B\"); \\\n)\nWHEN(whatever) ( \\\n  printf(\"this will expand too\"); \\\n)\n</code></pre>\n\n<p>Check out <a href=\"https://github.com/pfultz2/Cloak/wiki/C-Preprocessor-tricks,-tips,-and-idioms\" rel=\"nofollow noreferrer\">a concise intro to high level CPP</a> along with the <a href=\"https://github.com/pfultz2/Cloak/blob/master/cloak.h\" rel=\"nofollow noreferrer\">source for the macros in this example</a> for more details on the macros above.</p>\n"}], "owner": {"reputation": 7984, "user_id": 1398282, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/51ad9dc5224b0b292b820eeb71d17c9a?s=128&d=identicon&r=PG", "display_name": "foki", "link": "https://stackoverflow.com/users/1398282/foki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 54541420, "answer_count": 3, "score": 2, "last_activity_date": 1549414755, "creation_date": 1549393060, "last_edit_date": 1549405546, "question_id": 54541273, "link": "https://stackoverflow.com/questions/54541273/is-there-a-way-to-execute-arbitrary-code-in-c-preprocessor", "title": "Is there a way to execute arbitrary code in C preprocessor?", "body": "<p>Consider this program:</p>\n\n<pre><code>#define MACRO                                   \\\n    srand(time(NULL));                          \\\n    if (rand() % 2)                             \\\n        printf(\"A\");                            \\\n    else                                        \\\n        printf(\"B\");\n\nint main() {\n    MACRO;\n}\n</code></pre>\n\n<p>It is the equivalent of the following macro-expanded program:</p>\n\n<pre><code>int main() {\n    srand(time(NULL));\n    if (rand() % 2)\n        printf(\"A\");\n    else\n        printf(\"B\");\n}\n</code></pre>\n\n<p>Obviously, the <code>if</code> statement is executed in runtime and not in macro-expansion phase. If the <code>if</code> statement was executed in compile time and if there was syntax quoting (as in Lisp), we could get programs A and A' with (almost) equal probability. Where A:</p>\n\n<pre><code>int main() {\n    printf(\"A\");\n}\n</code></pre>\n\n<p>and A':</p>\n\n<pre><code>int main() {\n    printf(\"B\");\n}\n</code></pre>\n\n<p>Is there a way to make GCC emit A or A' with regard to a condition evaluated in compile time?</p>\n"}, {"tags": ["c", "parallel-processing", "character", "intel", "simd"], "comments": [{"owner": {"reputation": 23944, "user_id": 1305969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wlo8z.png?s=128&g=1", "display_name": "zx485", "link": "https://stackoverflow.com/users/1305969/zx485"}, "edited": false, "score": 0, "creation_date": 1549392874, "post_id": 54541129, "comment_id": 95883604, "body": "What is your character format? ASCII or some kind of Unicode?"}, {"owner": {"reputation": 91, "user_id": 2373798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ae210c40a6678dd8ec39259564643cc?s=128&d=identicon&r=PG", "display_name": "Adamos2468", "link": "https://stackoverflow.com/users/2373798/adamos2468"}, "reply_to_user": {"reputation": 23944, "user_id": 1305969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wlo8z.png?s=128&g=1", "display_name": "zx485", "link": "https://stackoverflow.com/users/1305969/zx485"}, "edited": false, "score": 0, "creation_date": 1549393197, "post_id": 54541129, "comment_id": 95883768, "body": "The format is ASCII"}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 2, "creation_date": 1549393260, "post_id": 54541129, "comment_id": 95883807, "body": "AVX1 or AVX2? What have you tried? Hint: Check <code>_mm256_cmpeq_epi8</code> and <code>_mm256_sub_epi8</code> for the most inner loop. After 255 iterations you need to start combining two bytes into one <code>uint16</code>, and so on"}, {"owner": {"reputation": 91, "user_id": 2373798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ae210c40a6678dd8ec39259564643cc?s=128&d=identicon&r=PG", "display_name": "Adamos2468", "link": "https://stackoverflow.com/users/2373798/adamos2468"}, "edited": false, "score": 0, "creation_date": 1549393505, "post_id": 54541129, "comment_id": 95883928, "body": "AVX2, well until now I have an array of 4 __m256i variables and I am pushing the overflow from index 0 until 3."}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 0, "creation_date": 1549395168, "post_id": 54541129, "comment_id": 95884690, "body": "Can you show some code of what you did? For adding 8bit integers to larger integers, what this question: <a href=\"https://stackoverflow.com/questions/54541127/\">stackoverflow.com/questions/54541127</a>"}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 1, "creation_date": 1549396169, "post_id": 54541129, "comment_id": 95885140, "body": "<code>_mm256_cmpeq_epi8</code> will get you a <code>-1</code> in each byte. If you subtract that from a counter (using <code>_mm256_sub_epi8</code>) you can directly count up to 255 or 128, i.e., your most inner loop should just contain these two intrinsics."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1549431848, "post_id": 54541129, "comment_id": 95894930, "body": "@Adamos2468: I added efficient horizontal-sum code to chtz&#39;s answer, using <code>vpsadbw</code> against zero for byte to qword.  And efficient shuffles for 256-bit down to 64-bit like <a href=\"//stackoverflow.com/q/6996764\">Fastest way to do horizontal float vector sum on x86</a>."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1549432043, "post_id": 54541129, "comment_id": 95895002, "body": "One core can&#39;t usually saturate DRAM bandwidth, so for <i>large</i> inputs it might be worth using multiple threads (especially if you already have a worker thread started and can just send it a function pointer and args).  You tagged this <a href=\"https://stackoverflow.com/questions/tagged/parallel-processing\">parallel-processing</a>, are you asking for OpenMP or something as well?"}], "answers": [{"comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 0, "creation_date": 1549397707, "post_id": 54542267, "comment_id": 95885842, "body": "I had the same idea in OP&#39;s other, now-deleted question. GMTA."}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "edited": false, "score": 1, "creation_date": 1549398788, "post_id": 54542267, "comment_id": 95886295, "body": "Doing <code>_mm256_movemask_epi8</code> and <code>_mm_popcnt_u32</code> in the inner loop is far less efficient than <code>_mm256_sub_epi8</code>"}, {"owner": {"reputation": 23944, "user_id": 1305969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wlo8z.png?s=128&g=1", "display_name": "zx485", "link": "https://stackoverflow.com/users/1305969/zx485"}, "edited": false, "score": 0, "creation_date": 1549399298, "post_id": 54542267, "comment_id": 95886502, "body": "I guess so. But it is an alternative that is worth mentioning for its simplicity."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1549431318, "post_id": 54542267, "comment_id": 95894765, "body": "Possibly useful as part of a cleanup loop, or <b>for an unaligned start/end where you shift out some of the bits before you popcnt, using a shift count calculated from the overlap</b>.  Otherwise the more reasonable &quot;simple&quot; version is putting the <code>psadbw</code> epu8-&gt;epu64 hsum inside the inner loop and using <code>_mm256_add_epi64</code>.  That&#39;s only 1 extra instruction per vector vs. the efficient way, vs. 2 (<code>vpcmpeqb</code> + <code>vpmovmskb</code> + <code>popcnt</code> + <code>add</code> vs. <code>vpcmpeqb</code> (+<code>vpsadbw</code>) + <code>vpsubb</code> / <code>q</code>)."}], "tags": [], "owner": {"reputation": 23944, "user_id": 1305969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wlo8z.png?s=128&g=1", "display_name": "zx485", "link": "https://stackoverflow.com/users/1305969/zx485"}, "is_accepted": false, "score": 2, "last_activity_date": 1549397378, "creation_date": 1549397378, "answer_id": 54542267, "question_id": 54541129, "link": "https://stackoverflow.com/questions/54541129/how-to-count-character-occurrences-using-simd/54542267#54542267", "title": "How to count character occurrences using SIMD", "body": "<p>If you don't insist on using only SIMD instructions, you can make use<br>\nof the <a href=\"https://www.felixcloutier.com/x86/pmovmskb\" rel=\"nofollow noreferrer\">VPMOVMSKB</a> instruction in combination with the <a href=\"https://www.felixcloutier.com/x86/popcnt\" rel=\"nofollow noreferrer\">POPCNT</a> instruction. The former combines the highest bits of each byte into a 32-bit integer mask and the latter counts the <code>1</code> bits in this integer (=the count of char matches).</p>\n\n<pre><code>int couter=0;\nfor(i=0; i&lt;size; i+=32) {\n  ...\n  couter += \n    _mm_popcnt_u32( \n      (unsigned int)_mm256_movemask_epi8( \n        _mm256_cmpeq_epi8( C, *((__m256i*)(vector+i) ))\n      ) \n    );\n  ...\n}    \n</code></pre>\n\n<p>I haven't tested this solution, but you should get the gist.</p>\n"}, {"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1549427830, "post_id": 54543009, "comment_id": 95893800, "body": "The widening to epu64 can and should be done with <code>_mm256_sad_epu8(counter, _mm256_setzero_si256())</code>, then <code>_mm256_add_epi64</code> into one vector which you hsum at the very end."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1549431676, "post_id": 54543009, "comment_id": 95894864, "body": "I added code that does that hsum, and an outer loop size limit.  Note that clang uses indexed addressing modes, so it&#39;s no closer than gcc to running at 2 loads per clock on Haswell/Skylake. :(  They&#39;ll unlaminate from <code>vpcmpeqb</code> into separate uops in the issue stage.  Writing it with the loop bounds as pointer-comparison might be a better bet, and get clang to just do pure pointer increments instead of silly indexing.  e.g. <code>const char *endp = min(buf + size, buf + 4*255*32)</code> or something."}, {"owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1549438304, "post_id": 54543009, "comment_id": 95897344, "body": "Thanks @PeterCordes for improving this! I guess for gcc it would be better to manually unroll the inner loop (i.e., create 4 variables instead of an array). Nice trick with <code>vpsadbw</code>."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1549438535, "post_id": 54543009, "comment_id": 95897460, "body": "Yeah, that might help GCC avoid the stupid <code>vmovdqa</code> instructions.  Worth trying if you&#39;re curious.  Or file a missed-optimization bug; it&#39;s already optimized away any store/reload of the array of 4 vectors, and this is clearly something that it <i>should</i> be able to optimize.  Anyway, gcc&#39;s <code>-funroll-loops</code> is only enabled manually or as part of <code>-fprofile-use</code>; for large codebases unrolling every loop hurts more than it helps, but profile-use will identify the hot loops and unroll them.  I&#39;d assume unrolling would let it avoid extra movdqa as well."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1549438666, "post_id": 54543009, "comment_id": 95897511, "body": "The <code>vpsadbw</code> trick is relatively well known for hsumming 8-bit data, and worth using even for signed by XORing to range-shift and then subtracting the <code>16 or 32 * 128</code> bias at the end.  I think Agner Fog&#39;s optimization guide mentions it, or at least his VectorClass library uses it."}], "tags": [], "owner": {"reputation": 14588, "user_id": 6870253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c7ce91530d2dddae7b9fc2bd828ed78?s=128&d=identicon&r=PG&f=1", "display_name": "chtz", "link": "https://stackoverflow.com/users/6870253/chtz"}, "is_accepted": false, "score": 3, "last_activity_date": 1549437310, "last_edit_date": 1549437310, "creation_date": 1549400649, "answer_id": 54543009, "question_id": 54541129, "link": "https://stackoverflow.com/questions/54541129/how-to-count-character-occurrences-using-simd/54543009#54543009", "title": "How to count character occurrences using SIMD", "body": "<p>I'm intentionally leaving out some parts, which you need to figure out yourself (e.g. handling lengths that aren't a multiple of <code>4*255*32</code> bytes), but your most inner loop should look something like the one starting with <code>for(int i...)</code>:</p>\n\n<p><strong><code>_mm256_cmpeq_epi8</code> will get you a -1 in each byte, which you can use as an integer</strong>. If you subtract that from a counter (using <code>_mm256_sub_epi8</code>) you can directly count up to 255 or 128.  The inner loop contains just these two intrinsics.  You have to stop and </p>\n\n<pre><code>#include &lt;immintrin.h&gt;\n#include &lt;stdint.h&gt;\n\nstatic inline\n__m256i hsum_epu8_epu64(__m256i v) {\n    return _mm256_sad_epu8(v, _mm256_setzero_si256());  // SAD against zero is a handy trick\n}\n\nstatic inline\nuint64_t hsum_epu64_scalar(__m256i v) {\n    __m128i lo = _mm256_castsi256_si128(v);\n    __m128i hi = _mm256_extracti128_si256(v, 1);\n    __m128i sum2x64 = _mm_add_epi64(lo, hi);   // narrow to 128\n\n    hi = _mm_unpackhi_epi64(sum2x64, sum2x64);\n    __m128i sum = _mm_add_epi64(hi, sum2x64);  // narrow to 64\n    return _mm_cvtsi128_si64(sum);\n}\n\n\nunsigned long long char_count_AVX2(char const* vector, size_t size, char c)\n{\n    __m256i C=_mm256_set1_epi8(c);\n\n    // todo: count elements and increment `vector` until it is aligned to 256bits (=32 bytes)\n    __m256i const * simd_vector = (__m256i const *) vector;\n     // *simd_vector is an alignment-required load, unlike _mm256_loadu_si256()\n\n    __m256i sum64 = _mm256_setzero_si256();\n    size_t unrolled_size_limit = size - 4*255*32 + 1;\n    for(size_t k=0; k&lt;unrolled_size_limit ; k+=4*255*32) // outer loop: TODO\n    {\n        __m256i counter[4]; // multiple counter registers to hide latencies\n        for(int j=0; j&lt;4; j++)\n            counter[j]=_mm256_setzero_si256();\n        // inner loop: make sure that you don't go beyond the data you can read\n        for(int i=0; i&lt;255; ++i)\n        {   // or limit this inner loop to ~22 to avoid branch mispredicts\n            for(int j=0; j&lt;4; ++j)\n            {\n                counter[j]=_mm256_sub_epi8(counter[j],           // count -= 0 or -1\n                                           _mm256_cmpeq_epi8(*simd_vector, C));\n                ++simd_vector;\n            }\n        }\n\n        // only need one outer accumulator: OoO exec hides the latency of adding into it\n        sum64 = _mm256_add_epi64(sum64, hsum_epu8_epu64(counter[0]));\n        sum64 = _mm256_add_epi64(sum64, hsum_epu8_epu64(counter[1]));\n        sum64 = _mm256_add_epi64(sum64, hsum_epu8_epu64(counter[2]));\n        sum64 = _mm256_add_epi64(sum64, hsum_epu8_epu64(counter[3]));\n    }\n\n    uint64_t sum = hsum_epu64_scalar(sum64);\n\n    // TODO add up remaining bytes with sum.\n    // Including a rolled-up vector loop before going scalar\n    //  because we're potentially a *long* way from the end\n\n    // Maybe put some logic into the main loop to shorten the 255 inner iterations\n    // if we're close to the end.  A little bit of scalar work there shouldn't hurt every 255 iters.\n\n    return sum;\n}\n</code></pre>\n\n<p>Godbolt link: <a href=\"https://godbolt.org/z/do5e3-\" rel=\"nofollow noreferrer\">https://godbolt.org/z/do5e3-</a> (clang is slightly better than gcc at unrolling the most inner loop: gcc includes some useless <code>vmovdqa</code> instructions that will bottleneck the front-end if the data is hot in L1d cache, preventing us from running close to 2x 32-byte loads per clock)</p>\n"}, {"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1568692789, "post_id": 57929966, "comment_id": 102344748, "body": "You can use <code>_mm256_sub_epi8</code> to accumulate the cmpeq results instead of wasting instructions in the outer loop.  Also, this code is too compact for its own good and not indented properly.  (Maybe a tab vs. space problem in the SO markdown?)  It took me a while to find where you were zeroing <code>acr0..3</code> between inner-loop iterations; would make more sense to declare them <i>inside</i> the outer loop.  I don&#39;t think there are any compilers that support AVX2 but not C99.  I&#39;d also do the end-pointer calculations on separate source lines."}, {"owner": {"reputation": 131, "user_id": 6264478, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aZxrCWP6hD4/AAAAAAAAAAI/AAAAAAAAAB8/M4sG_ekFO48/photo.jpg?sz=128", "display_name": "powturbo", "link": "https://stackoverflow.com/users/6264478/powturbo"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1568700077, "post_id": 57929966, "comment_id": 102346600, "body": "I don&#39;t see what you mean, by wasting instructions"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1568701046, "post_id": 57929966, "comment_id": 102347013, "body": "If you use <code>acr0 = _mm256_sub_epi8(acr0, cmp(...))</code> then the outer loop can just use <code>acr0</code> instead of <code>_mm256_sub_epi8(zv, acr0)</code>.  Use <code>x -= -1</code> instead of <code>x += -1</code> inside the inner loop.  That <code>sub</code> is a wasted instruction in your version."}, {"owner": {"reputation": 131, "user_id": 6264478, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aZxrCWP6hD4/AAAAAAAAAAI/AAAAAAAAAB8/M4sG_ekFO48/photo.jpg?sz=128", "display_name": "powturbo", "link": "https://stackoverflow.com/users/6264478/powturbo"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1568707017, "post_id": 57929966, "comment_id": 102349722, "body": "Thanks Peter, I&#39;ve made the changes and a new benchmark"}], "tags": [], "owner": {"reputation": 131, "user_id": 6264478, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aZxrCWP6hD4/AAAAAAAAAAI/AAAAAAAAAB8/M4sG_ekFO48/photo.jpg?sz=128", "display_name": "powturbo", "link": "https://stackoverflow.com/users/6264478/powturbo"}, "is_accepted": false, "score": 1, "last_activity_date": 1568711695, "last_edit_date": 1568711695, "creation_date": 1568406375, "answer_id": 57929966, "question_id": 54541129, "link": "https://stackoverflow.com/questions/54541129/how-to-count-character-occurrences-using-simd/57929966#57929966", "title": "How to count character occurrences using SIMD", "body": "<p>Probably the fastest: <a href=\"https://gist.github.com/powturbo/2b06a84b6008dfffef11e53edba297d3\" rel=\"nofollow noreferrer\">memcount_avx2</a> and <a href=\"https://gist.github.com/powturbo/456edcae788a61ebe2fc\" rel=\"nofollow noreferrer\">memcount_sse2</a></p>\n\n<pre><code>size_t memcount_avx2(const void *s, int c, size_t n) \n{    \n  __m256i cv = _mm256_set1_epi8(c), \n          zv = _mm256_setzero_si256(), \n         sum = zv, acr0,acr1,acr2,acr3;\n  const char *p,*pe;    \n\n  for(p = s; p != (char *)s+(n- (n % (252*32)));) \n  { \n    for(acr0 = acr1 = acr2 = acr3 = zv, pe = p+252*32; p != pe; p += 128) \n    {\n      acr0 = _mm256_sub_epi8(acr0, _mm256_cmpeq_epi8(cv, _mm256_lddqu_si256((const __m256i *)p))); \n      acr1 = _mm256_sub_epi8(acr1, _mm256_cmpeq_epi8(cv, _mm256_lddqu_si256((const __m256i *)(p+32)))); \n      acr2 = _mm256_sub_epi8(acr2, _mm256_cmpeq_epi8(cv, _mm256_lddqu_si256((const __m256i *)(p+64)))); \n      acr3 = _mm256_sub_epi8(acr3, _mm256_cmpeq_epi8(cv, _mm256_lddqu_si256((const __m256i *)(p+96)))); \n      __builtin_prefetch(p+1024);\n    }\n    sum = _mm256_add_epi64(sum, _mm256_sad_epu8(acr0, zv));\n    sum = _mm256_add_epi64(sum, _mm256_sad_epu8(acr1, zv));\n    sum = _mm256_add_epi64(sum, _mm256_sad_epu8(acr2, zv));\n    sum = _mm256_add_epi64(sum, _mm256_sad_epu8(acr3, zv));\n  } \n\n  for(acr0 = zv; p+32 &lt; (char *)s + n; p += 32)  \n    acr0 = _mm256_sub_epi8(acr0, _mm256_cmpeq_epi8(cv, _mm256_lddqu_si256((const __m256i *)p))); \n  sum = _mm256_add_epi64(sum, _mm256_sad_epu8(acr0, zv));\n\n  size_t count = _mm256_extract_epi64(sum, 0) \n               + _mm256_extract_epi64(sum, 1) \n               + _mm256_extract_epi64(sum, 2) \n               + _mm256_extract_epi64(sum, 3);  \n\n  while(p != (char *)s + n) \n      count += *p++ == c;\n  return count;\n}\n</code></pre>\n\n<p>Benchmark skylake i7-6700 - 3.4GHz - gcc 8.3:</p>\n\n<p>memcount_avx2 : 28 GB/s<br/>\nmemcount_sse: 23 GB/s<br/>\nchar_count_AVX2 : 23 GB/s (from <a href=\"https://stackoverflow.com/a/54543009/6264478\">post</a>)\n"}], "owner": {"reputation": 91, "user_id": 2373798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ae210c40a6678dd8ec39259564643cc?s=128&d=identicon&r=PG", "display_name": "Adamos2468", "link": "https://stackoverflow.com/users/2373798/adamos2468"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1163, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1568711695, "creation_date": 1549392433, "last_edit_date": 1549395335, "question_id": 54541129, "link": "https://stackoverflow.com/questions/54541129/how-to-count-character-occurrences-using-simd", "title": "How to count character occurrences using SIMD", "body": "<p>I am given a array of lowercase characters (up to 1.5Gb) and a character c. And I want to find how many occurrences are of the character c using AVX instructions.</p>\n\n<pre><code>unsigned long long char_count_AVX2(char * vector, int size, char c){\nunsigned long long sum =0;\nint i, j;\nconst int con=3;\n__m256i ans[con];\nfor(i=0; i&lt;con; i++)\n    ans[i]=_mm256_setzero_si256();\n\n__m256i Zer=_mm256_setzero_si256();\n__m256i C=_mm256_set1_epi8(c);\n__m256i Assos=_mm256_set1_epi8(0x01);\n__m256i FF=_mm256_set1_epi8(0xFF);\n__m256i shield=_mm256_set1_epi8(0xFF);\n__m256i temp;\nint couter=0;\nfor(i=0; i&lt;size; i+=32){\n    couter++;\n    shield=_mm256_xor_si256(_mm256_cmpeq_epi8(ans[0], Zer), FF);\n    temp=_mm256_cmpeq_epi8(C, *((__m256i*)(vector+i)));\n    temp=_mm256_xor_si256(temp, FF);\n    temp=_mm256_add_epi8(temp, Assos);\n    ans[0]=_mm256_add_epi8(temp, ans[0]);\n    for(j=1; j&lt;con; j++){\n        temp=_mm256_cmpeq_epi8(ans[j-1], Zer);\n        shield=_mm256_and_si256(shield, temp);\n        temp=_mm256_xor_si256(shield, FF);\n        temp=_mm256_add_epi8(temp, Assos);\n        ans[j]=_mm256_add_epi8(temp, ans[j]);\n    }\n}\nfor(j=con-1; j&gt;=0; j--){\n    sum&lt;&lt;=8;\n    unsigned char *ptr = (unsigned char*)&amp;(ans[j]);\n    for(i=0; i&lt;32; i++){\n        sum+=*(ptr+i);\n    }\n}\nreturn sum;\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["c", "binary-tree"], "comments": [{"owner": {"reputation": 2202, "user_id": 8911175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2000c44d0ba4a2642e8846064a77ee34?s=128&d=identicon&r=PG&f=1", "display_name": "taurus05", "link": "https://stackoverflow.com/users/8911175/taurus05"}, "edited": false, "score": 1, "creation_date": 1549392212, "post_id": 54540997, "comment_id": 95883269, "body": "Insert elements into an array and make a min/max heap out of it, using index values. The resulting tree will be a binary tree."}, {"owner": {"reputation": 703, "user_id": 6720343, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-jaLgR5uWJbw/AAAAAAAAAAI/AAAAAAAABW4/ejlO2gU-IDs/photo.jpg?sz=128", "display_name": "Anuj Vishwakarma", "link": "https://stackoverflow.com/users/6720343/anuj-vishwakarma"}, "edited": false, "score": 0, "creation_date": 1549392286, "post_id": 54540997, "comment_id": 95883315, "body": "Simple implement min/max heap."}, {"owner": {"reputation": 1, "user_id": 11019305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0f252ef52f7476d2d68cb40c803227?s=128&d=identicon&r=PG&f=1", "display_name": "nawh", "link": "https://stackoverflow.com/users/11019305/nawh"}, "edited": false, "score": 0, "creation_date": 1549392926, "post_id": 54540997, "comment_id": 95883632, "body": "Thank you, but don&#39;t min/max heaps have restrictions on the root value (i.e. it must be the minimum or the maximum)?"}, {"owner": {"reputation": 864, "user_id": 10913596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1cf12cce6499d0cf89a03500f0808ab?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/10913596/daniel"}, "edited": false, "score": 0, "creation_date": 1549392971, "post_id": 54540997, "comment_id": 95883654, "body": "To be clear, you just want some key arbitrarily inserted into a tree?"}, {"owner": {"reputation": 1, "user_id": 11019305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0f252ef52f7476d2d68cb40c803227?s=128&d=identicon&r=PG&f=1", "display_name": "nawh", "link": "https://stackoverflow.com/users/11019305/nawh"}, "edited": false, "score": 0, "creation_date": 1549393218, "post_id": 54540997, "comment_id": 95883779, "body": "Yes, the key values are actually pointers, rather than integers. When a key is created, it should go to the first available space."}, {"owner": {"reputation": 864, "user_id": 10913596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1cf12cce6499d0cf89a03500f0808ab?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/10913596/daniel"}, "edited": false, "score": 0, "creation_date": 1549393429, "post_id": 54540997, "comment_id": 95883880, "body": "While I made an answer, perhaps I&#39;m missing the point. What are you actually trying to achieve by using a tree? What purpose are you trying to use it to serve?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11019305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0f252ef52f7476d2d68cb40c803227?s=128&d=identicon&r=PG&f=1", "display_name": "nawh", "link": "https://stackoverflow.com/users/11019305/nawh"}, "edited": false, "score": 0, "creation_date": 1549393396, "post_id": 54541274, "comment_id": 95883863, "body": "An element may be linked to two other elements rather than one."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 1, "user_id": 11019305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0f252ef52f7476d2d68cb40c803227?s=128&d=identicon&r=PG&f=1", "display_name": "nawh", "link": "https://stackoverflow.com/users/11019305/nawh"}, "edited": false, "score": 0, "creation_date": 1549393441, "post_id": 54541274, "comment_id": 95883892, "body": "@nawh I removed my remark, editing my answer, you have to consider the key now"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 0, "last_activity_date": 1549393449, "last_edit_date": 1549393449, "creation_date": 1549393063, "answer_id": 54541274, "question_id": 54540997, "link": "https://stackoverflow.com/questions/54540997/binary-tree-insert-without-ordering/54541274#54541274", "title": "Binary Tree Insert without ordering", "body": "<p>In</p>\n\n<pre><code>else if (root-&gt;left == NULL)\n  root-&gt;left=insert(root-&gt;left,key);\n</code></pre>\n\n<p>you know <code>root-&gt;left</code> is NULL so why to do the recursive call ?</p>\n\n<p>Of course same for the next <em>else</em></p>\n\n<blockquote>\n  <p>The following code only works for the very first three nodes.</p>\n</blockquote>\n\n<p>If both <em>left</em> and <em>right</em> are non NULL you do not insert, that time it was necessary to do the recursive call on one of the two branches, and you will consider the key (so insert ordered) to decide which one. Note that the 2 tests to NULL you did are not correct if you insert to have a sorted tree ...</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 11019305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0f252ef52f7476d2d68cb40c803227?s=128&d=identicon&r=PG&f=1", "display_name": "nawh", "link": "https://stackoverflow.com/users/11019305/nawh"}, "edited": false, "score": 0, "creation_date": 1549393437, "post_id": 54541309, "comment_id": 95883888, "body": "Thank you very much, will try this asap."}, {"owner": {"reputation": 864, "user_id": 10913596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1cf12cce6499d0cf89a03500f0808ab?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/10913596/daniel"}, "reply_to_user": {"reputation": 1, "user_id": 11019305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0f252ef52f7476d2d68cb40c803227?s=128&d=identicon&r=PG&f=1", "display_name": "nawh", "link": "https://stackoverflow.com/users/11019305/nawh"}, "edited": false, "score": 0, "creation_date": 1549393531, "post_id": 54541309, "comment_id": 95883947, "body": "The signature of <code>node *&amp;root</code> could be dead wrong, as a heads up. If that fails, a pointer to the root pointer would also be a pragmatic solution. Also, this basically treats the tree like a linked list, so it might not really be what you&#39;re looking for."}], "tags": [], "owner": {"reputation": 864, "user_id": 10913596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1cf12cce6499d0cf89a03500f0808ab?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/10913596/daniel"}, "is_accepted": false, "score": 0, "last_activity_date": 1549393213, "creation_date": 1549393213, "answer_id": 54541309, "question_id": 54540997, "link": "https://stackoverflow.com/questions/54540997/binary-tree-insert-without-ordering/54541309#54541309", "title": "Binary Tree Insert without ordering", "body": "<p>Comparing values is actually irrelevant, the only think you need to do is set a pointer. Since you didn't specify any real requirements, one solution could be as follows:</p>\n\n<p>Changing the signature a bit so now you have a pointer to an already allocated node:</p>\n\n<pre><code>void insertNode(node *&amp;root, node *newNode) {\n    if (root == NULL) { \n         root = newNode;\n         return;\n    }\n    if (root-&gt;left == NULL) {\n        root-left = newNode;\n        return;\n    }\n    helperInsert(root-&gt;left, newNode);\n    return;\n}\n</code></pre>\n\n<p>This will set the head (assuming I got the signature right), and otherwise check the left child. </p>\n\n<pre><code>void helperInsert(node *it, node *newNode) {\n    if (it-&gt;left == NULL) {\n        it-&gt;left = newNode;\n        return;\n    }\n    helperInsert(it-&gt;left, newNode);\n    return;\n}\n</code></pre>\n\n<p>This is obviously a flawed approach (the tree will not be balanced at the slightest), almost treating the tree as a linked list, but to my best understanding of the  question, this is an example of how it can be done. </p>\n"}, {"tags": [], "owner": {"reputation": 620, "user_id": 6660678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/650f0bb98fc9fde7f182cd0b810bc25b?s=128&d=identicon&r=PG&f=1", "display_name": "mdfst13", "link": "https://stackoverflow.com/users/6660678/mdfst13"}, "is_accepted": false, "score": 1, "last_activity_date": 1549393374, "creation_date": 1549393374, "answer_id": 54541342, "question_id": 54540997, "link": "https://stackoverflow.com/questions/54540997/binary-tree-insert-without-ordering/54541342#54541342", "title": "Binary Tree Insert without ordering", "body": "<p>If you change </p>\n\n<pre><code>else if  (root-&gt; right == NULL)\n</code></pre>\n\n<p>to just </p>\n\n<pre><code>else\n</code></pre>\n\n<p>Then it would have the effect of always adding to the right.  </p>\n\n<hr>\n\n<p>If you want it to randomly pick, add a call to <code>srand</code> outside this function.  </p>\n\n<pre><code>srand(time(NULL));\n</code></pre>\n\n<p>Then in this function, call </p>\n\n<pre><code>else if (rand() &gt; MAX_RAND / 2) {\n    root-&gt;right = insert(root-&gt;right, key);\n} else {\n    root-&gt;left = insert(root-&gt;left, key);\n}\n</code></pre>\n\n<p>at the end of your existing <code>if</code>/<code>else</code> structure.</p>\n\n<p>See also:  </p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/11418113/6660678\">Lack of randomness in C rand()</a></li>\n</ul>\n\n<hr>\n\n<p>If your tree tracks its height at each node, you could add after your null checks something like </p>\n\n<pre><code>else if (root-&gt;left-&gt;height &lt;= root-&gt;right-&gt;height) {\n    root-&gt;left = insert(root-&gt;left, key);\n} else {\n    root-&gt;right = insert(root-&gt;right, key);\n}\n</code></pre>\n\n<p>That would keep the tree balanced automatically.  But it requires additional code to manage the height.  E.g. </p>\n\n<pre><code>root-&gt;height = 1 + ((root-&gt;left-&gt;height &gt; root-&gt;right-&gt;height) ? root-&gt;left-&gt;height : root-&gt;right-&gt;height);\n</code></pre>\n\n<p>I leave it up to you whether that additional overhead is worth it.  </p>\n\n<hr>\n\n<p>The people suggesting using a heap are suggesting using the indexes as the ordering.  This is kind of useless as a heap, but it would make a balanced binary tree.  So the root node would be the first inserted and the most recent inserted would be the rightmost leaf.  </p>\n"}, {"comments": [{"owner": {"reputation": 620, "user_id": 6660678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/650f0bb98fc9fde7f182cd0b810bc25b?s=128&d=identicon&r=PG&f=1", "display_name": "mdfst13", "link": "https://stackoverflow.com/users/6660678/mdfst13"}, "edited": false, "score": 0, "creation_date": 1549413625, "post_id": 54541407, "comment_id": 95891047, "body": "As written, what you are calling height actually holds the size of the tree (or subtree).  I say this because you always increment the value on <code>insert</code>.  It will work with size, but it would be better to use the <a href=\"https://en.wikipedia.org/wiki/Tree_(data_structure)#Terminology_used_in_trees\" rel=\"nofollow noreferrer\">more common terminology</a>.  Height measures how many levels of children there are.  What you&#39;re measuring is the total number of descendants."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 1, "last_activity_date": 1549393606, "creation_date": 1549393606, "answer_id": 54541407, "question_id": 54540997, "link": "https://stackoverflow.com/questions/54540997/binary-tree-insert-without-ordering/54541407#54541407", "title": "Binary Tree Insert without ordering", "body": "<p>You could just keep track of the height of each node, and always insert it into the side with fewer children:</p>\n\n<pre><code>node *insert (node *root, int *key) {\n    if (root==NULL) {\n        root=newNode(root, key);\n        root-&gt;height = 0\n    }\n    else if (root-&gt;left == NULL) {\n        insert(root-&gt;left,key);\n    }\n    else if (root-&gt;right == NULL) {\n        insert(root-&gt;right,key);\n    }\n    else if (root-&gt;left-&gt;height &lt;= root-&gt;right-&gt;height) {\n        insert(root-&gt;left,key);\n    } else {\n        insert(root-&gt;right,key);\n    }\n    root-&gt;height++\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "is_accepted": false, "score": 0, "last_activity_date": 1549402443, "creation_date": 1549402443, "answer_id": 54543402, "question_id": 54540997, "link": "https://stackoverflow.com/questions/54540997/binary-tree-insert-without-ordering/54543402#54543402", "title": "Binary Tree Insert without ordering", "body": "<p>The heap advice is most sound. You don't need to heapify anything, just follow the rules that an element at index <code>k</code> has children at <code>2*k + 1</code> and <code>2*k + 2</code>.</p>\n\n<p>Another approach, useful when there is no array, but the nodes are generated on the fly, is to fill the tree level-wise. Notice that at level <code>k</code> there are <code>2 ** k</code> slots, conveniently indexed by a k-bit integer. Interpret the index as a path down the tree (clear bit tells to follow left child, set bit tells to follow a right one), along the lines of:</p>\n\n<pre><code>        void insert_node(struct node * root, struct node * node, unsigned mask, unsigned path)\n        {\n            while ((mask &gt;&gt; 1) != 1) {\n                root = mask &amp; path? root-&gt;right: root-&gt;left;\n            }\n            if (mask &amp; path) {\n                assert (root-&gt;right == NULL);\n                root-&gt;right = node;\n            } else {\n                assert (root-&gt;left == NULL);\n                root-&gt;left = node;\n            }\n        }\n\n        void fill_level_k(struct node * root, unsigned k)\n        {\n            unsigned slots = 1 &lt;&lt; k;\n            for (unsigned slot = 0; slot &lt; slots; slot++) {\n                struct node * node = generate_new_node();\n                insert_node(root, node, slots, slot);\n            }\n        }\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11019305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c0f252ef52f7476d2d68cb40c803227?s=128&d=identicon&r=PG&f=1", "display_name": "nawh", "link": "https://stackoverflow.com/users/11019305/nawh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "answer_count": 5, "score": 0, "last_activity_date": 1549402443, "creation_date": 1549391967, "question_id": 54540997, "link": "https://stackoverflow.com/questions/54540997/binary-tree-insert-without-ordering", "title": "Binary Tree Insert without ordering", "body": "<p>Is there any way to insert a new node in a binary tree (not bst) without comparing key values? The following code only works for the very first three nodes. </p>\n\n<pre><code>node *insert (node *root, int *key) {\n\nif (root==NULL) {\n    root=newNode(root, key);\n    return root;\n}\n\nelse if (root-&gt;left == NULL)\n    root-&gt;left=insert(root-&gt;left,key);\nelse if  (root-&gt; right == NULL)\n    root-&gt;right=insert(root-&gt;right,key);\n\nreturn root;\n\n}\n</code></pre>\n"}, {"tags": ["c", "typedef", "type-definition"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 1, "creation_date": 1549390688, "post_id": 54540664, "comment_id": 95882543, "body": "Looks more like an array of function pointers to me."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 5, "creation_date": 1549390699, "post_id": 54540664, "comment_id": 95882551, "body": "<a href=\"https://cdecl.org/?q=void+%28%2A%28workers%5B2%5D%29%29%28char+%2A%2C+char+%2A%2C+int%29%3B\" rel=\"nofollow noreferrer\">cdecl</a>"}, {"owner": {"reputation": 20722, "user_id": 1625187, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/6vWOZ.jpg?s=128&g=1", "display_name": "Evg", "link": "https://stackoverflow.com/users/1625187/evg"}, "edited": false, "score": 1, "creation_date": 1549390720, "post_id": 54540664, "comment_id": 95882567, "body": "Two function pointers, each function returns nothing and takes 3 parameters."}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 1, "creation_date": 1549390722, "post_id": 54540664, "comment_id": 95882571, "body": "Close. Better worded as <i>points to a function that returns <code>void</code> and accepts accepts the mentioned arguments.</i>"}, {"owner": {"reputation": 65491, "user_id": 986, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0317df30e04cc468688b0f00adbb7037?s=128&d=identicon&r=PG", "display_name": "Mark Ingram", "link": "https://stackoverflow.com/users/986/mark-ingram"}, "edited": false, "score": 0, "creation_date": 1549390775, "post_id": 54540664, "comment_id": 95882592, "body": "What happens when you tried it?"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 4, "creation_date": 1549390788, "post_id": 54540664, "comment_id": 95882599, "body": "It would be better to separate the function pointer declaration from the array declaration to make things easier to read and understand: <code>typedef void (*worker)(char *, char *, int); worker workers[2];</code>"}, {"owner": {"reputation": 1311, "user_id": 336312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/366f157834179a500384dddb8b4ca98b?s=128&d=identicon&r=PG", "display_name": "code2be", "link": "https://stackoverflow.com/users/336312/code2be"}, "edited": false, "score": 0, "creation_date": 1549391841, "post_id": 54540664, "comment_id": 95883104, "body": "Thanks for commenting everybody, I did update the question with my trial, can you check please ?"}, {"owner": {"reputation": 12461, "user_id": 266487, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/585595b6a24df9b742ebc186788e9a8e?s=128&d=identicon&r=PG", "display_name": "harper", "link": "https://stackoverflow.com/users/266487/harper"}, "edited": false, "score": 1, "creation_date": 1549392909, "post_id": 54540664, "comment_id": 95883623, "body": "@thb has provided a complete example. If it works, you can &quot;accept&quot; the answer. If it doesn&#39;t you can comment the answer. If you change your question, everybody get&#39;s confused, including yourself. That&#39;s especially true if you add code that is just wrong like a <code>workers W;</code> (with uppercase W) and <code>w[0] = worker1;</code> with lowercase w;"}, {"owner": {"reputation": 2647, "user_id": 9829403, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RvgmsYSS48c/AAAAAAAAAAI/AAAAAAAAAAw/pUPnPAhmDec/photo.jpg?sz=128", "display_name": "Tim Randall", "link": "https://stackoverflow.com/users/9829403/tim-randall"}, "edited": false, "score": 0, "creation_date": 1549394017, "post_id": 54540664, "comment_id": 95884176, "body": "Isn&#39;t there a handy web util that lets you enter this sort of thing and spits out the result of parsing?"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "reply_to_user": {"reputation": 2647, "user_id": 9829403, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RvgmsYSS48c/AAAAAAAAAAI/AAAAAAAAAAw/pUPnPAhmDec/photo.jpg?sz=128", "display_name": "Tim Randall", "link": "https://stackoverflow.com/users/9829403/tim-randall"}, "edited": false, "score": 0, "creation_date": 1549394983, "post_id": 54540664, "comment_id": 95884610, "body": "@TimRandall cdecl. See Eugene&#39;s comment (currently) second from the top."}, {"owner": {"reputation": 1311, "user_id": 336312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/366f157834179a500384dddb8b4ca98b?s=128&d=identicon&r=PG", "display_name": "code2be", "link": "https://stackoverflow.com/users/336312/code2be"}, "reply_to_user": {"reputation": 12461, "user_id": 266487, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/585595b6a24df9b742ebc186788e9a8e?s=128&d=identicon&r=PG", "display_name": "harper", "link": "https://stackoverflow.com/users/266487/harper"}, "edited": false, "score": 0, "creation_date": 1549407777, "post_id": 54540664, "comment_id": 95889688, "body": "@harper, I did fix the typo, thanks"}], "answers": [{"comments": [{"owner": {"reputation": 1311, "user_id": 336312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/366f157834179a500384dddb8b4ca98b?s=128&d=identicon&r=PG", "display_name": "code2be", "link": "https://stackoverflow.com/users/336312/code2be"}, "edited": false, "score": 0, "creation_date": 1549391815, "post_id": 54540754, "comment_id": 95883090, "body": "I did try and updated the question, can you check please ?"}, {"owner": {"reputation": 1311, "user_id": 336312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/366f157834179a500384dddb8b4ca98b?s=128&d=identicon&r=PG", "display_name": "code2be", "link": "https://stackoverflow.com/users/336312/code2be"}, "edited": false, "score": 0, "creation_date": 1549397631, "post_id": 54540754, "comment_id": 95885804, "body": "Thanks, it is clear for me and could implement and use it smoothly, thanks."}], "tags": [], "owner": {"reputation": 11771, "user_id": 1275653, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cb781e5bd49c5d403228b98859d8b6dd?s=128&d=identicon&r=PG", "display_name": "thb", "link": "https://stackoverflow.com/users/1275653/thb"}, "is_accepted": false, "score": 1, "last_activity_date": 1549392519, "last_edit_date": 1549392519, "creation_date": 1549390991, "answer_id": 54540754, "question_id": 54540664, "link": "https://stackoverflow.com/questions/54540664/how-to-use-this-defined-type-in-c/54540754#54540754", "title": "How to use this defined type in C?", "body": "<p>Suppose:</p>\n\n<pre><code>typedef void (*(workers[2]))(char *, char *, int);\nworkers my_workers;\n</code></pre>\n\n<p>The <code>workers</code> is a type (really, an alias for a type). The <code>my_workers</code> is an object of the <code>workers</code> type.</p>\n\n<p>The <code>my_workers</code> is an array of two pointers, each pointing to a <em>function.</em> Each such function accepts the mentioned arguments and returns <code>void</code>.</p>\n\n<p><strong>TRIAL</strong></p>\n\n<p>As your request, I have tried your code as follows.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\ntypedef void (*(workers[2]))(char *, char *, int);\n\nvoid worker1(char * x, char * y, int z) {\n    printf(\"1: [%s] [%s] [%d]\\n\", x, y, z);\n}\n\nvoid worker2(char * x, char * y, int z) {\n    printf(\"2: [%s] [%s] [%d]\\n\", x, y, z);\n}\n\nint main() {\n    char sa[] = \"here\";\n    char sb[] = \"there\";\n    char sc[] = \"everywhere\";\n    char sd[] = \"nowhere\";\n    workers w;\n    w[0] = worker1;\n    w[1] = worker2;\n    (w[0])(sa, sb, 50);\n    (w[1])(sc, sd, 70);\n    return 0;\n}\n</code></pre>\n\n<p>Try that. For me, it compiles and runs with no warnings, no errors.</p>\n"}, {"comments": [{"owner": {"reputation": 1311, "user_id": 336312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/366f157834179a500384dddb8b4ca98b?s=128&d=identicon&r=PG", "display_name": "code2be", "link": "https://stackoverflow.com/users/336312/code2be"}, "edited": false, "score": 0, "creation_date": 1549407685, "post_id": 54541031, "comment_id": 95889660, "body": "Thanks a lot for the detailed clarification."}], "tags": [], "owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "is_accepted": true, "score": 3, "last_activity_date": 1549392069, "creation_date": 1549392069, "answer_id": 54541031, "question_id": 54540664, "link": "https://stackoverflow.com/questions/54540664/how-to-use-this-defined-type-in-c/54541031#54541031", "title": "How to use this defined type in C?", "body": "<p><code>workers</code> is an alias for the type \"2-element array of pointers to functions taking two <code>char *</code> and an <code>int</code> as arguments and returning <code>void</code>\".  </p>\n\n<p>Here's an example of what this beast might look like in practice.  </p>\n\n<pre><code>void f0( char *foo, char *bar, int bletch )\n{\n  // do something interesting with foo, bar, and bletch\n}\n\nvoid f1( char *foo, char *bar, int bletch )\n{\n  // do something else interesting with foo, bar, and bletch\n}\n\nint main( void )\n{\n  workers w = { f0, f1 }; // equivalent to void (*w[2])(char *, char *, int ) = { f0, f1 };\n\n  // call f0 through w:\n  w[0]( \"blah\", \"blah\", 1 );\n\n  // call f1 through w:\n  w[1]( \"ugh\", \"blah\", 2 );\n  ...\n}\n</code></pre>\n\n<p>The <code>workers</code> typedef basically creates a shorter name for a complicated, hard-to-read type.  In practice, it would probably be better to create a typedef for just the function type, then create an array of that:</p>\n\n<pre><code>typedef (*worker)(char *, char *, int );\nworker w[2] = { f0, f1 };\n</code></pre>\n\n<p>The problem with a declaration like</p>\n\n<pre><code>workers w = { f0, f1 };\n</code></pre>\n\n<p>is that it's not immediately obvious that <code>w</code> has an array type, so the initialization looks confusing.  It also relies on the person using this type to <em>know</em> that it's an array type of a certain size.  We call that a \"leaky abstraction\", and they lead to confusion and maintenance headaches.  </p>\n\n<p>You still have to know that each <code>w[i]</code> is a function type that takes a certain number and type of arguments, so ideally that should be hidden behind an interface as well (i.e., you pass <code>w[i]</code> to a function that knows how to call it, rather than calling it yourself).  </p>\n"}], "owner": {"reputation": 1311, "user_id": 336312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/366f157834179a500384dddb8b4ca98b?s=128&d=identicon&r=PG", "display_name": "code2be", "link": "https://stackoverflow.com/users/336312/code2be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "accepted_answer_id": 54541031, "answer_count": 2, "score": 1, "last_activity_date": 1549407745, "creation_date": 1549390601, "last_edit_date": 1549407745, "question_id": 54540664, "link": "https://stackoverflow.com/questions/54540664/how-to-use-this-defined-type-in-c", "title": "How to use this defined type in C?", "body": "<p>How can I use this defined type ?</p>\n\n<pre><code>typedef void (*(workers[2]))(char *, char *, int);\n</code></pre>\n\n<p>What I could understand, that I'll have <code>workers</code>, which is an <code>array</code> of <code>two</code> <code>pointers</code>, each one points to a <code>void</code>, which accepts the mentioned arguments.</p>\n\n<p>Is that correct ?</p>\n\n<p><strong>Trial #1</strong></p>\n\n<pre><code>void worker1(char * x, char * y, int z) {\n\n}\n\nvoid worker2(char * x, char * y, int z) {\n\n}\n</code></pre>\n\n<p>and then inside some another void, I did:</p>\n\n<pre><code>workers w;\nw[0] = worker1;\nw[1] = worker2;\n</code></pre>\n\n<p>Compiling, I get:\n<code>error: cannot convert `void (**)(char*, char*, int)' to `void (* (*)[2])(char*, char*, int)'</code></p>\n"}, {"tags": ["c", "arrays", "sorting", "shuffle"], "comments": [{"owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "edited": false, "score": 0, "creation_date": 1549390095, "post_id": 54540513, "comment_id": 95882264, "body": "That sounds like a really interesting problem. Do you have a question, though?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1549390393, "post_id": 54540513, "comment_id": 95882403, "body": "What have you tried so far?"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1549390603, "post_id": 54540513, "comment_id": 95882501, "body": "As a hint, read the time and use it to seed a pseudo random number generator. Since you cannot include any extra header files, and using an external declarations to C standard library functions is probably considered cheating, you could implement your own PRNG using a linear congruential generator. That&#39;s a lot easier than it sounds."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1549391067, "post_id": 54540513, "comment_id": 95882723, "body": "Some problems with your code are: (1) you cannot assign array elements that are themselves arrays; (2) it does not shuffle - you could get duplicate values in the resulting array; (3) you generate random numbers from 0 to 16, but 16 is out of range for your array. To solve (1), use a loop to copy the array elements (assuming you cannot <code>#include &lt;string.h&gt;</code> and use <code>memcpy</code> or <code>strncpy</code>). To solve (2), investigate the Fisher-Yates shuffle algorithm."}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 10966879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f730cd73bfad797eb190a7a822f9126?s=128&d=identicon&r=PG&f=1", "display_name": "denederlander", "link": "https://stackoverflow.com/users/10966879/denederlander"}, "edited": false, "score": 0, "creation_date": 1549390484, "post_id": 54540592, "comment_id": 95882445, "body": "Thanks. Strcpy might be the way?"}, {"owner": {"reputation": 9, "user_id": 10966879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f730cd73bfad797eb190a7a822f9126?s=128&d=identicon&r=PG&f=1", "display_name": "denederlander", "link": "https://stackoverflow.com/users/10966879/denederlander"}, "edited": false, "score": 0, "creation_date": 1549390581, "post_id": 54540592, "comment_id": 95882493, "body": "tnx that&#39;s a helpful tip"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 9, "user_id": 10966879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f730cd73bfad797eb190a7a822f9126?s=128&d=identicon&r=PG&f=1", "display_name": "denederlander", "link": "https://stackoverflow.com/users/10966879/denederlander"}, "edited": false, "score": 0, "creation_date": 1549390590, "post_id": 54540592, "comment_id": 95882497, "body": "With the code you have both are ok, the vector ([]) uses less memory that the array ([][]) because the strings are still unique rather than duplicated, after all depends if you want after to modify or the string stored in <i>randomnames</i> but not <i>names</i>, if yes you need the array and the <i>strcpy</i>"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 9, "user_id": 10966879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f730cd73bfad797eb190a7a822f9126?s=128&d=identicon&r=PG&f=1", "display_name": "denederlander", "link": "https://stackoverflow.com/users/10966879/denederlander"}, "edited": false, "score": 0, "creation_date": 1549392197, "post_id": 54540592, "comment_id": 95883265, "body": "@denederlander looking at the link you given first your way is not the expected one, I edited my answer"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 9, "user_id": 10966879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f730cd73bfad797eb190a7a822f9126?s=128&d=identicon&r=PG&f=1", "display_name": "denederlander", "link": "https://stackoverflow.com/users/10966879/denederlander"}, "edited": false, "score": 0, "creation_date": 1549393670, "post_id": 54540592, "comment_id": 95884021, "body": "@denederlander <b>no</b> you redo the initial error, <code>temp = names[j];</code> is wrong, follow my code"}, {"owner": {"reputation": 9, "user_id": 10966879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f730cd73bfad797eb190a7a822f9126?s=128&d=identicon&r=PG&f=1", "display_name": "denederlander", "link": "https://stackoverflow.com/users/10966879/denederlander"}, "edited": false, "score": 0, "creation_date": 1549393714, "post_id": 54540592, "comment_id": 95884051, "body": "Thanks a lot! Really helpful :)"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 1, "last_activity_date": 1549392125, "last_edit_date": 1549392125, "creation_date": 1549390372, "answer_id": 54540592, "question_id": 54540513, "link": "https://stackoverflow.com/questions/54540513/shuffle-character-array-in-c/54540592#54540592", "title": "Shuffle character array in C", "body": "<p>Having</p>\n\n<pre><code>char names[16][20] = ...;\nchar randomnames[16][20];\n</code></pre>\n\n<p>you cannot do</p>\n\n<pre><code>randomnames[i] = names[j];\n</code></pre>\n\n<p>but</p>\n\n<pre><code>char names[16][20] = ...;\nchar * randomnames[16];\n...\nrandomnames[i] = names[j];\n</code></pre>\n\n<p>or</p>\n\n<pre><code>char names[16][20] = ...;\nchar randomnames[16][20];\n...\nstrcpy(randomnames[i], names[j]);\n</code></pre>\n\n<hr>\n\n<p>Warning when I see your first version of the question you have to print <em>names</em> rather than <em>randomnames</em>, that means you need to modify <em>randomnames</em> and the <code>char temp[20]</code> clearly indicates you have to swap the names inside <em>randomnames</em></p>\n\n<p>So something like that :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint main(void)\n{\n  int i, j, k;\n  char temp[20];\n  char names[16][20] = { \"Anne\" , \"Carmen\" , \"David\" , \"Jesmond\" ,\n                         \"John\" , \"Joseph\" , \"Karen\" , \"Kevin\" ,\n                         \"Manuel\" , \"Maria\" , \"Matthew\" , \"Michaela\" ,\n                         \"Paul\" , \"Sandra\" , \"William\" , \"Yilenia\" };\n\n  //--------------------------- The Code between the dotted lines is the one I still need to write -----------------\n  srand(time(NULL));\n\n  for (i = 0; i &lt; 16; i++) /* can be an other number of loop */\n  {\n    j = rand() % 17;\n    k = rand() % 17;\n    if (j != k) {\n      strcpy(temp, names[j]);\n      strcpy(names[j], names[k]);\n      strcpy(names[k], temp);\n    }\n  }\n  //---------------------------------------------------------------------------\n\n  for (i = 0; i &lt; 16; i++)\n  {\n    puts(names[i]);\n  }\n  getchar();\n  return 0;\n}\n</code></pre>\n\n<p>As you see I use all the variables and no additional ones.</p>\n\n<p>Example of compilation and execution :</p>\n\n<pre><code>pi@raspberrypi:~ $ gcc -pedantic -Wall s.c\npi@raspberrypi:~ $ ./a.out\nSandra\nJohn\nWilliam\nKaren\nJoseph\nKevin\nManuel\nCarmen\nAnne\nJesmond\nMichaela\nMaria\nPaul\nMatthew\nDavid\nYilenia\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 10966879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f730cd73bfad797eb190a7a822f9126?s=128&d=identicon&r=PG&f=1", "display_name": "denederlander", "link": "https://stackoverflow.com/users/10966879/denederlander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "accepted_answer_id": 54540592, "answer_count": 1, "score": -8, "last_activity_date": 1549392125, "creation_date": 1549389954, "last_edit_date": 1549390654, "question_id": 54540513, "link": "https://stackoverflow.com/questions/54540513/shuffle-character-array-in-c", "title": "Shuffle character array in C", "body": "<p>I have to solve the following problem:</p>\n\n<p>The following incomplete code illustrates a program that consists of an array holding 16 sorted names. The last part of the program displays these names on the screen. You are required to write code in the part which is being marked with an empty rectangle so that the names will be shuffled. When the names are outputted they should not be outputted in ascending order but in a random order. You are only required to write in you examination script the missing code and not the entire program.</p>\n\n<p>How can I write this code in the most simple/intuitive way?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\nint main(void)\n{\n    int i, j, k;\n    char temp[20];\n    char names[16][20] = { \"Anne\" , \"Carmen\" , \"David\" , \"Jesmond\" ,\n    \"John\" , \"Joseph\" , \"Karen\" , \"Kevin\" ,\n    \"Manuel\" , \"Maria\" , \"Matthew\" , \"Michaela\" ,\n    \"Paul\" , \"Sandra\" , \"William\" , \"Yilenia\" };\n\n    //--------------------------- The Code between the dotted lines is the one I still need to write -----------------\n    char randomnames[16][20];\n    srand(time(NULL));\n    for (i = 0; i &lt; 16; i++)\n    {\n        j = rand() % 17;\n        printf(\"%d\\n\", j);\n        randomnames[i] = names[j];\n    }\n    //---------------------------------------------------------------------------\n\n\n    for (i = 0; i &lt; 16; i++)\n    {\n        puts(randomnames[i]);\n    }\n    getchar();\n    return 0;\n\n}\n</code></pre>\n"}, {"tags": ["c", "ascii"], "comments": [{"owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "edited": false, "score": 4, "creation_date": 1549389941, "post_id": 54540485, "comment_id": 95882209, "body": "That looks like UTF-32, not ASCII"}, {"owner": {"reputation": 45, "user_id": 10930075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51bf0198e33a43b9f75ddc638d9c7938?s=128&d=identicon&r=PG&f=1", "display_name": "StrangerThings", "link": "https://stackoverflow.com/users/10930075/strangerthings"}, "reply_to_user": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "edited": false, "score": 0, "creation_date": 1549390189, "post_id": 54540485, "comment_id": 95882308, "body": "Sorry, i have updated my question."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549390211, "post_id": 54540485, "comment_id": 95882324, "body": "So.. it looks like a text file in UTF32 encoding. No conversion is needed.. Unless you want to convert it to ASCII. But that would simply taking every 4th byte starting with the first one.."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1549390319, "post_id": 54540485, "comment_id": 95882365, "body": "The key here is to open the file and use the proper encoding to decode it."}, {"owner": {"reputation": 45, "user_id": 10930075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51bf0198e33a43b9f75ddc638d9c7938?s=128&d=identicon&r=PG&f=1", "display_name": "StrangerThings", "link": "https://stackoverflow.com/users/10930075/strangerthings"}, "edited": false, "score": 0, "creation_date": 1549390363, "post_id": 54540485, "comment_id": 95882385, "body": "But the result is <code>H   e   l   l   o</code> when i open the file (3 whitespaces between every character)."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 1, "creation_date": 1549390401, "post_id": 54540485, "comment_id": 95882411, "body": "Show the code that you are using to open and read the file. Most likely you are not decoding it with the correct encoding."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1549390402, "post_id": 54540485, "comment_id": 95882412, "body": "You can &quot;open&quot; a file in zillion of ways. Which one are you referring to?"}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1549390455, "post_id": 54540485, "comment_id": 95882429, "body": "Read an <code>int</code> at a time, copy the value into a <code>char</code> then write the <code>char</code>."}, {"owner": {"reputation": 45, "user_id": 10930075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51bf0198e33a43b9f75ddc638d9c7938?s=128&d=identicon&r=PG&f=1", "display_name": "StrangerThings", "link": "https://stackoverflow.com/users/10930075/strangerthings"}, "reply_to_user": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1549390551, "post_id": 54540485, "comment_id": 95882479, "body": "@Code-Apprentice i am writing to a file and open it with notepad. I also use PSPad for encoding."}, {"owner": {"reputation": 45, "user_id": 10930075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51bf0198e33a43b9f75ddc638d9c7938?s=128&d=identicon&r=PG&f=1", "display_name": "StrangerThings", "link": "https://stackoverflow.com/users/10930075/strangerthings"}, "edited": false, "score": 0, "creation_date": 1549390707, "post_id": 54540485, "comment_id": 95882556, "body": "The code where i write the file is <code>fwrite(decoded, sizeof(int), len, decodedFile);</code> and file is open in <code>wb</code> mode"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1549390826, "post_id": 54540485, "comment_id": 95882617, "body": "You better show your code in a form of <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1549393083, "post_id": 54540485, "comment_id": 95883711, "body": "What is the reason you are writing the file in binary mode rather than text mode?"}, {"owner": {"reputation": 45, "user_id": 10930075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51bf0198e33a43b9f75ddc638d9c7938?s=128&d=identicon&r=PG&f=1", "display_name": "StrangerThings", "link": "https://stackoverflow.com/users/10930075/strangerthings"}, "edited": false, "score": 0, "creation_date": 1549403820, "post_id": 54540485, "comment_id": 95888458, "body": "because it will get encrypted so i need an exponent&gt;128"}], "answers": [{"tags": [], "owner": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "is_accepted": false, "score": 1, "last_activity_date": 1549400268, "creation_date": 1549400268, "answer_id": 54542929, "question_id": 54540485, "link": "https://stackoverflow.com/questions/54540485/convert-a-binary-file-with-integers-to-its-ascii-representation/54542929#54542929", "title": "Convert a binary file with integers to its ascii representation", "body": "<p>Characters are just integers that are displayed according to some arbitrary rules. Because the rules are arbitrary there are infinite possibilities. Of those infinite possibilities there are multiple standards (EBDIC, ASCII, many variations of \"extended ASCII\", Unicode, etc) and because they're all just integers there's many ways to encode them (\"as is\", UTF-8, UTF-16LE, UTF-16BE, ..).</p>\n\n<p>To convert from anything to anything, you need to decode the original encoding (if any), convert the resulting character into the new character set (possibly via. lookup tables), then re-encode the character in the target encoding (if any).</p>\n\n<p>The data you've shown looks like \"Unicode with UTF-32LE encoding\". To convert it to \"ASCII with as-is encoding\" (in a portable way) you'd need to start by decoding the original encoding (e.g. <code>codepoint = buffer[0] | (buffer[1] &lt;&lt; 8)  | (buffer[2] &lt;&lt; 16) | (buffer[3] &lt;&lt; 24)</code>). Then you'd need to convert the resulting codepoint (\"character\") into the ASCII character set. Fortunately, the first 128 codepoints in Unicode are identical to ASCII. Unfortunately almost all of the other codepoints in Unicode can't be converted to ASCII, so you'll need to decide what to do about that (replace them with a <code>'?'</code> character in ASCII? Generate a \"Can't convert\" error message and give up?). In any case it'll probably look something like <code>if(codepoint &lt; 128) { character = codepoint; } else {</code>. Finally, because ASCII uses an \"as is\" encoding you can just slap the resulting byte into memory (there's no work involved in \"re-encode\").</p>\n"}, {"tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": false, "score": 0, "last_activity_date": 1549404232, "creation_date": 1549404232, "answer_id": 54543759, "question_id": 54540485, "link": "https://stackoverflow.com/questions/54540485/convert-a-binary-file-with-integers-to-its-ascii-representation/54543759#54543759", "title": "Convert a binary file with integers to its ascii representation", "body": "<p>Haven't tested, but something like this:</p>\n\n<pre><code>int utf32le2ascii(uint32_t *instr, size_t len, char *outstr, size_t outlen)\n{\n    size_t i, j = 0;\n    for (i = 0; i &lt; len; i++)\n    {\n        if (j &gt;= outlen)\n        {\n            return -1;\n        }\n\n        if (instr[i] &lt; 128)\n        {\n            outstr[j] = instr[i];\n        }\n\n        else\n        {\n            outstr[j] = '?'; \n        }\n\n        j++;\n    }\n    if (j &gt;= outlen)\n    {\n        return -1;\n    }\n\n    outstr[j] = '\\0';\n    return 0;\n}\n</code></pre>\n\n<p>A return value of <code>-1</code> indicates failure; <code>0</code> indicates success.</p>\n"}], "owner": {"reputation": 45, "user_id": 10930075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51bf0198e33a43b9f75ddc638d9c7938?s=128&d=identicon&r=PG&f=1", "display_name": "StrangerThings", "link": "https://stackoverflow.com/users/10930075/strangerthings"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1549404232, "creation_date": 1549389840, "last_edit_date": 1549403655, "question_id": 54540485, "link": "https://stackoverflow.com/questions/54540485/convert-a-binary-file-with-integers-to-its-ascii-representation", "title": "Convert a binary file with integers to its ascii representation", "body": "<p>I have a binary file including integers that represents an ascii file. For example a file containing <code>hello</code> has a value of (using xxd)</p>\n\n<pre><code>0000000: 4800 0000 6500 0000 6c00 0000 6c00 0000  H...e...l...l...\n0000010: 6f00 0000 0000 0000                      o.......\n</code></pre>\n\n<p>How can i read the file and convert it to the ascii string <code>Hello</code>?</p>\n\n<p><strong>Edit</strong> An example that shows exactly what i do and what i get. Just compile and run it. Put a file named \"test.txt inside the pwd thats the plaintext message. The result are 2 files test.enc and test.dec. I know it is unsecure at all but i want to create this anyway.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n#include &lt;string.h&gt;\n\n#define ACCURACY 5\n#define SINGLE_MAX 100000\n#define EXPONENT_MAX 10000\n#define BUF_SIZE 1024\n#define DEBUG 0\n\nint modpow(long long a, long long b, int c) {\n    int res = 1;\n    while(b &gt; 0) {\n        /* Need long multiplication else this will overflow... */\n        if(b &amp; 1) {\n            res = (res * a) % c;\n        }\n        b = b &gt;&gt; 1;\n        a = (a * a) % c; /* Same deal here */\n    }\n    return res;\n}\n\nint jacobi(int a, int n) {\n    int twos, temp;\n    int mult = 1;\n    while(a &gt; 1 &amp;&amp; a != n) {\n        a = a % n;\n        if(a &lt;= 1 || a == n) break;\n        twos = 0;\n        while(a % 2 == 0 &amp;&amp; ++twos) a /= 2; /* Factor out multiples of 2 */\n        if(twos &gt; 0 &amp;&amp; twos % 2 == 1) mult *= (n % 8 == 1 || n % 8 == 7) * 2 - 1;\n        if(a &lt;= 1 || a == n) break;\n        if(n % 4 != 1 &amp;&amp; a % 4 != 1) mult *= -1; /* Coefficient for flipping */\n        temp = a;\n        a = n;\n        n = temp;\n    }\n    if(a == 0) return 0;\n    else if(a == 1) return mult;\n    else return 0; /* a == n =&gt; gcd(a, n) != 1 */\n}\n\nint solovayPrime(int a, int n) {\n    int x = jacobi(a, n);\n    if(x == -1) x = n - 1;\n    return x != 0 &amp;&amp; modpow(a, (n - 1)/2, n) == x;\n}\n\nint probablePrime(int n, int k) {\n    if(n == 2) return 1;\n    else if(n % 2 == 0 || n == 1) return 0;\n    while(k-- &gt; 0) {\n        if(!solovayPrime(rand() % (n - 2) + 2, n)) return 0;\n    }\n    return 1;\n}\n\nint randPrime(int n) {\n    int prime = rand() % n;\n    n += n % 2; /* n needs to be even so modulo wrapping preserves oddness */\n    prime += 1 - prime % 2;\n    while(1) {\n        if(probablePrime(prime, ACCURACY)) return prime;\n        prime = (prime + 2) % n;\n    }\n}\n\nint gcd(int a, int b) {\n    int temp;\n    while(b != 0) {\n        temp = b;\n        b = a % b;\n        a = temp;\n    }\n    return a;\n}\n\nint randExponent(int phi, int n) {\n    int e = rand() % n;\n    while(1) {\n        if(gcd(e, phi) == 1) return e;\n        e = (e + 1) % n;\n        if(e &lt;= 2) e = 3;\n    }\n}\n\nint inverse(int n, int modulus) {\n    int a = n, b = modulus;\n    int x = 0, y = 1, x0 = 1, y0 = 0, q, temp;\n    while(b != 0) {\n        q = a / b;\n        temp = a % b;\n        a = b;\n        b = temp;\n        temp = x; x = x0 - q * x; x0 = temp;\n        temp = y; y = y0 - q * y; y0 = temp;\n    }\n    if(x0 &lt; 0) x0 += modulus;\n    return x0;\n}\n\nint readFile(FILE* fd, char** buffer, int bytes) {\n    int len = 0, cap = BUF_SIZE, r;\n    char buf[BUF_SIZE];\n    *buffer = malloc(BUF_SIZE * sizeof(char));\n    while((r = fread(buf, sizeof(char), BUF_SIZE, fd)) &gt; 0) {\n        if(len + r &gt;= cap) {\n            cap *= 2;\n            *buffer = realloc(*buffer, cap);\n        }\n        memcpy(&amp;(*buffer)[len], buf, r);\n        len += r;\n    }\n    /* Pad the last block with zeros to signal end of cryptogram. An additional block is added if there is no room */\n    if(len + bytes - len % bytes &gt; cap) *buffer = realloc(*buffer, len + bytes - len % bytes);\n    do {\n        (*buffer)[len] = '\\0';\n        len++;\n    }\n    while(len % bytes != 0);\n    return len;\n}\n\nint encode(int m, int e, int n) {\n    return modpow(m, e, n);\n}\n\nint decode(int c, int d, int n) {\n    return modpow(c, d, n);\n}\n\nint* encodeMessage(int len, int bytes, char* message, int exponent, int modulus) {\n    int *encoded = malloc((len/bytes) * sizeof(int));\n    int x, i, j;\n    for(i = 0; i &lt; len; i += bytes) {\n        x = 0;\n        for(j = 0; j &lt; bytes; j++) x += message[i + j] * (1 &lt;&lt; (7 * j));\n        encoded[i/bytes] = encode(x, exponent, modulus);\n        if(DEBUG) printf(\"%d \", encoded[i/bytes]);\n    }\n    return encoded;\n}\n\nint* decodeMessage(int len, int bytes, int* cryptogram, int exponent, int modulus) {\n    int *decoded = malloc(len * bytes * sizeof(int));\n    int x, i, j;\n    for(i = 0; i &lt; len; i++) {\n        x = decode(cryptogram[i], exponent, modulus);\n        for(j = 0; j &lt; bytes; j++) {\n            decoded[i*bytes + j] = (x &gt;&gt; (7 * j)) % 128;\n            if(DEBUG) if(decoded[i*bytes + j] != '\\0') printf(\"%c\", decoded[i*bytes + j]);\n        }\n    }\n    return decoded;\n}       \n\nint main(void) {\n\n    int p, q, n, phi, e, d;\n    int len;\n    int bytes = 1;\n    int *encoded, *decoded;\n    char *buffer;\n    FILE *f;\n    srand(time(NULL));\n\n    while(1) {\n\n        p = randPrime(SINGLE_MAX);              \n        q = randPrime(SINGLE_MAX);      \n        n = p * q;\n        if(n &lt; 128) {\n            printf(\"Modulus is less than 128, trying again\\n\");\n        } else {\n            break;\n        }\n\n    }   \n\n    phi = (p - 1) * (q - 1);\n    e = randExponent(phi, EXPONENT_MAX);    \n    d = inverse(e, phi);\n\n    // read the file\n    f = fopen(\"test.txt\", \"r\");\n    if(f == NULL) return EXIT_FAILURE;\n    len = readFile(f, &amp;buffer, bytes); // len will be a multiple of bytes, to send whole chunks \n    fclose(f);\n\n    if(DEBUG) printf(\"Encoded: \");\n    encoded = encodeMessage(len, bytes, buffer, e, n);\n\n    // save the encoded binary! to file\n    FILE *encodedFile;\n    encodedFile = fopen(\"tmp.enc\", \"wb\");\n    fwrite(encoded, sizeof(int), len, encodedFile);\n    fclose(encodedFile);\n\n    // read the encodedFile binary! overwrite encoded!!!\n    FILE *newEncodedFile;\n    newEncodedFile = fopen(\"tmp.enc\", \"rb\");\n    fread(encoded, sizeof(int), len, newEncodedFile);\n    fclose(newEncodedFile);\n\n    if(DEBUG) printf(\"\\nDecoded: \");\n    decoded = decodeMessage(len/bytes, bytes, encoded, d, n);\n\n    // save the decoded binary! to file\n    FILE *decodedFile;\n    decodedFile = fopen(\"tmp.dec\", \"wb\");\n    fwrite(decoded, sizeof(int), len/bytes, decodedFile);\n    fclose(decodedFile);\n\n    free(encoded);\n    free(decoded);\n    free(buffer);\n\n    return EXIT_SUCCESS;\n}\n</code></pre>\n"}, {"tags": ["c", "server", "client", "valgrind"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1549387988, "post_id": 54539980, "comment_id": 95881297, "body": "Given that it&#39;s <code>strlen()</code> and you&#39;re printing <code>msg-&gt;data.buf</code>, the chances are high that you&#39;ve not null-terminated the string and therefore the printing code is reading out of bounds, triggering the Valgrind warning.  You could use <code>%.*s</code> in the format and then pass an <code>int</code> value saying how long the data in <code>msg-&gt;data.buf</code> is."}], "answers": [{"tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 1, "last_activity_date": 1549388390, "last_edit_date": 1549388390, "creation_date": 1549388002, "answer_id": 54540048, "question_id": 54539980, "link": "https://stackoverflow.com/questions/54539980/c-cant-solve-invalid-read-of-size-1-on-a-client-server-program/54540048#54540048", "title": "c - can&#39;t solve Invalid read of size 1 on a client-server program", "body": "<p>probably</p>\n\n<pre><code>msg-&gt;data.buf=malloc(msg-&gt;data.hdr.len*sizeof(char));\nSYSCALL(notused,readn(fd,msg-&gt;data.buf,msg-&gt;data.hdr.len*sizeof(char)),\"read_data_buf\");            \n</code></pre>\n\n<p>must be</p>\n\n<pre><code>msg-&gt;data.buf=malloc(msg-&gt;data.hdr.len + 1);\nSYSCALL(notused,readn(fd,msg-&gt;data.buf,msg-&gt;data.hdr.len),\"read_data_buf\");            \nmsg-&gt;data.buf[msg-&gt;data.hdr.len] = 0;\n</code></pre>\n\n<p>to add place for the ending null character and set it</p>\n\n<p><strong>However</strong> are you sure <code>msg-&gt;data.buf</code> is a printable string ? How do you encode your structs during the exchanges ?</p>\n\n<hr>\n\n<p>Again <code>sizeof(char)</code> is 1 by definition, it is useless to multiply by it</p>\n"}, {"tags": [], "owner": {"reputation": 6679, "user_id": 10622916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21bd4eeaa5ba60dc021c5ccfbf4a963d?s=128&d=identicon&r=PG&f=1", "display_name": "Bodo", "link": "https://stackoverflow.com/users/10622916/bodo"}, "is_accepted": false, "score": 1, "last_activity_date": 1549388276, "creation_date": 1549388276, "answer_id": 54540112, "question_id": 54539980, "link": "https://stackoverflow.com/questions/54539980/c-cant-solve-invalid-read-of-size-1-on-a-client-server-program/54540112#54540112", "title": "c - can&#39;t solve Invalid read of size 1 on a client-server program", "body": "<p>According to this message</p>\n\n<pre><code>==4179==  Address 0x5452134 is 0 bytes after a block of size 4 alloc'd\n</code></pre>\n\n<p>you have allocated 4 bytes.</p>\n\n<p>Your <code>printf</code> call</p>\n\n<pre><code>printf(\"BODY: %s\\n\",msg-&gt;data.buf);\n</code></pre>\n\n<p>expects to find a string terminated with <code>\\0</code></p>\n\n<p>Probably the bytes you read with <code>SYSCALL(notused,readn(...</code> do not contain a <code>'\\0'</code> within these 4 bytes, so <code>strlen</code> reads the next byte after the end of the allocated memory.</p>\n\n<p>One option to solve this would be to allocate one byte more and append <code>'\\0'</code> to the received data.</p>\n"}], "owner": {"reputation": 409, "user_id": 10181236, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-5bQoI5Vh3P0/AAAAAAAAAAI/AAAAAAAAB_c/z8TUCALIFNk/photo.jpg?sz=128", "display_name": "JayJona", "link": "https://stackoverflow.com/users/10181236/jayjona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 54540048, "answer_count": 2, "score": 0, "last_activity_date": 1549388390, "creation_date": 1549387757, "last_edit_date": 1549387999, "question_id": 54539980, "link": "https://stackoverflow.com/questions/54539980/c-cant-solve-invalid-read-of-size-1-on-a-client-server-program", "title": "c - can&#39;t solve Invalid read of size 1 on a client-server program", "body": "<p>client and server exchange messages by sending structures of this type:</p>\n\n<pre><code>typedef struct {\n    op_t     op;   \n    char sender[MAX_NAME_LENGTH+1];\n} message_hdr_t;\n\ntypedef struct {\n    char receiver[MAX_NAME_LENGTH+1];\n    unsigned int   len;  \n} message_data_hdr_t;\n\ntypedef struct {\n    message_data_hdr_t  hdr;\n    char               *buf;\n} message_data_t;\n\ntypedef struct {\n    message_hdr_t  hdr;\n    message_data_t data;\n} message_t;\n</code></pre>\n\n<p>the messages exchanged between client and server arrive correctly and execution proceeds but valgrind returns error:</p>\n\n<pre><code>==4179== Invalid read of size 1\n==4179==    at 0x4C32D04: strlen (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==4179==    by 0x50B84D2: vfprintf (vfprintf.c:1643)\n==4179==    by 0x50BFF25: printf (printf.c:33)\n==4179==    by 0x10A122: threadF (main.c:151)\n==4179==    by 0x4E436DA: start_thread (pthread_create.c:463)\n==4179==    by 0x517C88E: clone (clone.S:95)\n==4179==  Address 0x5452134 is 0 bytes after a block of size 4 alloc'd\n==4179==    at 0x4C2FB0F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==4179==    by 0x109B2B: readData (connections.h:103)\n==4179==    by 0x109C17: readMsg (connections.h:134)\n==4179==    by 0x10A0B0: threadF (main.c:146)\n==4179==    by 0x4E436DA: start_thread (pthread_create.c:463)\n==4179==    by 0x517C88E: clone (clone.S:95)\n</code></pre>\n\n<p>this is how I fill the structure in the server in the readData();\nyou can consider readn as read.</p>\n\n<pre><code>#define SYSCALL(r,c,msg) \\\n    if((r=c)==-1) {perror(msg);\n\n//other reads and writes\nmsg-&gt;data.buf=malloc(msg-&gt;data.hdr.len*sizeof(char));\nSYSCALL(notused,readn(fd,msg-&gt;data.buf,msg-&gt;data.hdr.len*sizeof(char)),\"read_data_buf\");            \nif(notused==0){\n    return -1;\n}\n</code></pre>\n\n<p>and i get error when i do the printf on main.c:151</p>\n\n<pre><code>printf(\"BODY: %s\\n\",msg-&gt;data.buf);\n</code></pre>\n"}, {"tags": ["c", "global-variables", "fpic"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1549387020, "post_id": 54539749, "comment_id": 95880752, "body": "ASLR \u2014 Address Space Layout Randomization"}, {"owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1549387181, "post_id": 54539749, "comment_id": 95880832, "body": "I thought ASLR is only for the stack memory"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1549387291, "post_id": 54539749, "comment_id": 95880894, "body": "OK \u2014 maybe it isn&#39;t ASLR.  Not that I&#39;ve heard that ASLR only applies to stack memory \u2014 if you&#39;d said &quot;only shared library addresses&quot; I&#39;d be less surprised.  You&#39;ll have to wait for someone else with an alternative idea.  Sorry I can&#39;t help more."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1549387722, "post_id": 54539749, "comment_id": 95881142, "body": "Wikipedia on <a href=\"https://en.wikipedia.org/wiki/Address_space_layout_randomization\" rel=\"nofollow noreferrer\">ASLR</a> \u2014 mentions <i>&quot;ASLR randomly arranges the address space positions of key data areas of a process, including the base of the executable and the positions of the stack, heap and libraries.&quot;</i>"}, {"owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1549388074, "post_id": 54539749, "comment_id": 95881335, "body": "I used <code>echo 0 | sudo tee &#47;proc&#47;sys&#47;kernel&#47;randomize_va_space</code> to turn ASLR off and indeed the addresses are the same across runs. Either with or without <code>-fPIC</code>."}], "answers": [{"tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": true, "score": 2, "last_activity_date": 1549389262, "last_edit_date": 1549389262, "creation_date": 1549388559, "answer_id": 54540179, "question_id": 54539749, "link": "https://stackoverflow.com/questions/54539749/location-of-global-variables-w-o-fpic/54540179#54540179", "title": "Location of global variables w/o -fPIC", "body": "<p>In an acronym (or <a href=\"https://www.dailywritingtips.com/acronym-vs-initialism/\" rel=\"nofollow noreferrer\">initialism</a>): ASLR \u2014 Address Space Layout Randomization.</p>\n\n<p>Wikipedia on <a href=\"https://en.wikipedia.org/wiki/Address_space_layout_randomization\" rel=\"nofollow noreferrer\">ASLR</a> says:</p>\n\n<blockquote>\n  <p>ASLR randomly arranges the address space positions of key data areas of a process, including the base of the executable and the positions of the stack, heap and libraries.</p>\n</blockquote>\n\n<p>This describes what you're seeing.  You subsequently found that using:</p>\n\n<pre><code> echo 0 | sudo tee /proc/sys/kernel/randomize_va_space\n</code></pre>\n\n<p>to turn ASLR off meant that the addresses are the same across runs, either with or without <code>-fPIC</code>, thus confirming that ASLR was the cause of the address changes.</p>\n\n<p>Note that your address printing should probably use the <code>%p</code> format and <code>void *</code> arguments (though you have a potentially truncating data conversion when you apply the <code>(int)</code> cast to the addresses \u2014 but the format is correct to use <code>%d</code>).  The type modifier <code>t</code> is for <code>ptrdiff_t</code>, the difference between two pointers.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint var1 = 94;\nint var2 = 76;\n\nint main(void)\n{\n    void *var1Loc = &amp;var1;\n    void *var2Loc = &amp;var2;\n    printf(\"var1 address is: %p\\n\", var1Loc);\n    printf(\"var2 address is: %p\\n\", var2Loc);\n    printf(\"diff         is: %td\\n\", &amp;var2 - &amp;var1);\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 3212, "user_id": 3357352, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/nfb7n.jpg?s=128&g=1", "display_name": "OrenIshShalom", "link": "https://stackoverflow.com/users/3357352/orenishshalom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "accepted_answer_id": 54540179, "answer_count": 1, "score": 0, "last_activity_date": 1549389262, "creation_date": 1549386859, "question_id": 54539749, "link": "https://stackoverflow.com/questions/54539749/location-of-global-variables-w-o-fpic", "title": "Location of global variables w/o -fPIC", "body": "<p>Though some posts exist about the <code>-fPIC</code> effect (see <a href=\"https://stackoverflow.com/questions/7298186/global-variables-shared-libraries-and-fpic-effect\">this SO post</a> for example) most of them are unclear. I wrote an extremely simple example and I still can't figure out what happens w/o <code>-fPIC</code> regarding the location of global variables. Here is my C file:</p>\n\n<pre><code>$ cat main.c\n#include &lt;stdio.h&gt;\nint var1 = 94;\nint var2 = 76;\n\nint main(int argc, char **argv)\n{\n    int var1Loc = (int) &amp;var1;\n    int var2Loc = (int) &amp;var2;\n    printf(\"var1 address is: %d\\n\",var1Loc);\n    printf(\"var2 address is: %d\\n\",var2Loc);\n    printf(\"diff         is: %d\\n\",var2Loc-var1Loc);\n\n    return var1+var2;\n}\n</code></pre>\n\n<p>Then I compile it <strong>with</strong> <code>-fPIC</code> and run it twice:</p>\n\n<pre><code>$ gcc -Wno-pointer-to-int-cast -O0 -g -o main main.c\n$ ./main\nvar1 address is: -2019672048\nvar2 address is: -2019672044\ndiff         is: 4\n$ ./main\nvar1 address is: 1441697808\nvar2 address is: 1441697812\ndiff         is: 4\n</code></pre>\n\n<p>When I do the exact same thing <strong>without</strong> <code>-fPIC</code>\nI get similar results. I thought that without the <code>-fPIC</code> the addresses\nshould be identical across runs no?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 6, "creation_date": 1549385887, "post_id": 54539405, "comment_id": 95880090, "body": "OMG, please do yourself a favor and format your program properly."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1549385901, "post_id": 54539405, "comment_id": 95880097, "body": "While things like indentation is irrelevant for the compiler, it&#39;s very much needed by humans attempting to read your code. I also doubt you need <i>all</i> those header files. And the code you show won&#39;t even build. Please create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that replicates your problem that you copy-paste into the question. Also please read about <a href=\"http://stackoverflow.com/help/how-to-ask\">how to ask good questions</a>, as well as <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 3, "creation_date": 1549386309, "post_id": 54539405, "comment_id": 95880329, "body": "Why is there a line that reads <code>&quot;hello.c&quot; 65L, 1168C</code> in the middle of your code?"}, {"owner": {"reputation": 3107, "user_id": 3423234, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49Nfn.gif?s=128&g=1", "display_name": "mfro", "link": "https://stackoverflow.com/users/3423234/mfro"}, "edited": false, "score": 0, "creation_date": 1549386690, "post_id": 54539405, "comment_id": 95880529, "body": "a vim statusline, apparently"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1549386832, "post_id": 54539405, "comment_id": 95880626, "body": "I suspect a big problem during the copy / paste ^^ Code indented, missing } added and extra line removed."}, {"owner": {"reputation": 3107, "user_id": 3423234, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49Nfn.gif?s=128&g=1", "display_name": "mfro", "link": "https://stackoverflow.com/users/3423234/mfro"}, "edited": false, "score": 0, "creation_date": 1549386837, "post_id": 54539405, "comment_id": 95880632, "body": "I would bet there is a <code>fork()</code> missing somewhere in that mess..."}], "answers": [{"tags": [], "owner": {"reputation": 1190, "user_id": 3344587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d246b94ff48978d81b706630d0102196?s=128&d=identicon&r=PG&f=1", "display_name": "Loc Tran", "link": "https://stackoverflow.com/users/3344587/loc-tran"}, "is_accepted": false, "score": 0, "last_activity_date": 1549389562, "creation_date": 1549389562, "answer_id": 54540415, "question_id": 54539405, "link": "https://stackoverflow.com/questions/54539405/getting-the-error-of-null-when-running-bash-c-program/54540415#54540415", "title": "Getting the error of null when running Bash C Program", "body": "<p>Your manipulated the wrong way on ptr pointer. When use it please use the deference operator *</p>\n\n<p>this line:</p>\n\n<pre><code>ptr+=startTime;\n</code></pre>\n\n<p>should be</p>\n\n<p>*ptr += startTime;</p>\n"}, {"tags": [], "owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "is_accepted": false, "score": 0, "last_activity_date": 1549431319, "creation_date": 1549431319, "answer_id": 54547173, "question_id": 54539405, "link": "https://stackoverflow.com/questions/54539405/getting-the-error-of-null-when-running-bash-c-program/54547173#54547173", "title": "Getting the error of null when running Bash C Program", "body": "<p>Several things:</p>\n\n<ul>\n<li><p>you have the following code testing on an uninitialised variable:</p>\n\n<pre><code>if(shmid &lt; 0){\n    printf(\"error getting shmid\");\n    exit(1);\n}\n</code></pre>\n\n<p>in the child process, so you'll get erratic behaviour as <code>shmid</code> will get rubbish and sometimes you'll get child <code>exit()</code>ing and some not.</p></li>\n<li><p>Second, <code>gettimeofday(2)</code> doesn't get a pointer to a <code>time_t</code> value, but a <code>struct timeval *</code>, so you are incurring in a buffer overrun (you are writing the timestamp data past the end of the <code>startTime</code> variable (<code>struct timeval</code> is larger than <code>time_t</code>), corrupting the stack.</p></li>\n<li>third, you add (supposedly, as the data was already wrong) a timestamp to a pointer, making the pointer to point to a garbage point.  After that the pointer is completely useles.  Are you adding apples with pears?</li>\n<li>next, <code>execvpe()</code> never returns, when called successfully, so you'll get a message of <code>\"successfully created child process\\n\"</code> <strong>only</strong> in case <code>execvpe()</code> fails, which is somewhat contradictory.</li>\n<li>finally, as you do a <code>waitpid()</code>, it is not necessary to retain the child pid and call <code>waitpid()</code> (you can simply call <code>wait(2)</code>, as you only create a single child, and you can trust that <code>wait(2)</code> will give an error, if the child finally could not be created, e.g. the <code>fork()</code> call didn't succeed)  Also, <code>returnStatus</code> is composed of more info than just the <code>exit(2)</code> value from the child process, so comparing it with <code>0</code> is not the proper way to check how did it go in the child.  See <code>wait(2)</code> for more info.</li>\n</ul>\n"}], "owner": {"reputation": 21, "user_id": 9922556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0fecaa4fb609eb570bc7c2e64a7a07c1?s=128&d=identicon&r=PG&f=1", "display_name": "siddarthk", "link": "https://stackoverflow.com/users/9922556/siddarthk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1549431319, "creation_date": 1549385720, "last_edit_date": 1549386748, "question_id": 54539405, "link": "https://stackoverflow.com/questions/54539405/getting-the-error-of-null-when-running-bash-c-program", "title": "Getting the error of null when running Bash C Program", "body": "<p>Why am I getting null in the ptr variable at the end when I compile? I am trying to get the start time after the program terminates. The output says that \"The code has successfully terminated\" or the child has successfully terminated, but the ptr variable at the end is set to null. Can anyone hypothesis as to why this is?      </p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;sys/types.h&gt;\n#include&lt;sys/shm.h&gt;\n#include&lt;sys/ipc.h&gt;\n#include&lt;unistd.h&gt;\n#include&lt;time.h&gt;\n#include&lt;sys/mman.h&gt;\n#include &lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n#include&lt;string.h&gt;\n#include&lt;fcntl.h&gt;\n#include&lt;sys/stat.h&gt;\n\nint main(){\n  const char *name = \"OS\";\n  long *ptr;\n  pid_t childPid;\n  childPid = fork();\n  int  shm;\n  if(childPid == 0){\n    char *args[] ={\"ls\",\"-l\",NULL};\n    int shmid;\n    int shsize = 5000000;\n    key_t key;\n\n    char *s;\n    key = 9876;\n    if(shmid &lt; 0){\n      printf(\"error getting shmid\");\n      exit(1);\n    }\n    shm = shm_open(name,O_CREAT| O_RDWR,0666);\n    if(shm == (char *) -1){\n      printf(\"error getting shared memory\");\n      exit(1);}\n    time_t startTime;\n    gettimeofday(&amp;startTime,0);\n    ptr = (long *) mmap(0,sizeof(startTime),PROT_READ | PROT_WRITE,MAP_SHARED,shm,0);\n    ptr+=startTime;\n    time_t endTime;\n    execvp(args[0],args);\n    printf(\"successfuly created child proceess\");\n    exit(0);\n  }\n\n  else if (childPid &lt;0){\n    printf(\"unsuccessfuly created child proccess\");\n  }\n  else{\n    int returnStatus;\n    waitpid(childPid,&amp;returnStatus,0);\n    if(returnStatus == 0){\n      printf(\"The chiild terminated normally\");\n      printf(\"%s\",ptr);\n      shm_unlink(name);\n    }\n\n    if(returnStatus == 1){\n\n      printf(\"The child terminated with error\");\n    }\n  }\n\n}\n</code></pre>\n"}, {"tags": ["c", "chatbot", "twitch"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1549384486, "post_id": 54538980, "comment_id": 95879238, "body": "Don&#39;t search on Google for DNS results. Use your command like tools like <code>nslookup</code> or <code>dig</code>. From there verify independently you can connect to that service with something like <code>telnet irc.chat.twitch.tv 6667</code>."}, {"owner": {"reputation": 45, "user_id": 10379717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cDrKAT58Mfw/AAAAAAAAAAI/AAAAAAAAAHY/yGP1Uglx4QU/photo.jpg?sz=128", "display_name": "Stefano Raneri", "link": "https://stackoverflow.com/users/10379717/stefano-raneri"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1549384829, "post_id": 54538980, "comment_id": 95879430, "body": "i tried connecting with telnet and it worked fine, i then used the ip address that telnet provided but still the connect function returns &quot;Connection Refused&quot;..."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1549384912, "post_id": 54538980, "comment_id": 95879487, "body": "I don&#39;t know where you got that IP from because it&#39;s not what <code>irc.chat.twitch.tv</code> resolves to right now. They&#39;re using Amazon AWS, apparently, so that IP can and will change frequently. You <i>must</i> use a tool like <code>nslookup</code> or <code>dig</code> to get current results."}, {"owner": {"reputation": 45, "user_id": 10379717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cDrKAT58Mfw/AAAAAAAAAAI/AAAAAAAAAHY/yGP1Uglx4QU/photo.jpg?sz=128", "display_name": "Stefano Raneri", "link": "https://stackoverflow.com/users/10379717/stefano-raneri"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1549385280, "post_id": 54538980, "comment_id": 95879696, "body": "I used <code>nslookup irc.chat.twitch.tv</code> and tried all the ip addresses, but still no fix"}, {"owner": {"reputation": 3691, "user_id": 1808989, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/3884a2f2ee43a4681967493905dcc20c?s=128&d=identicon&r=PG", "display_name": "Andrew Sun", "link": "https://stackoverflow.com/users/1808989/andrew-sun"}, "edited": false, "score": 2, "creation_date": 1549385760, "post_id": 54538980, "comment_id": 95880011, "body": "I believe you need to call <code>htons</code> on the port number to convert it to network endianness."}, {"owner": {"reputation": 45, "user_id": 10379717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cDrKAT58Mfw/AAAAAAAAAAI/AAAAAAAAAHY/yGP1Uglx4QU/photo.jpg?sz=128", "display_name": "Stefano Raneri", "link": "https://stackoverflow.com/users/10379717/stefano-raneri"}, "reply_to_user": {"reputation": 3691, "user_id": 1808989, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/3884a2f2ee43a4681967493905dcc20c?s=128&d=identicon&r=PG", "display_name": "Andrew Sun", "link": "https://stackoverflow.com/users/1808989/andrew-sun"}, "edited": false, "score": 1, "creation_date": 1549386056, "post_id": 54538980, "comment_id": 95880186, "body": "@AndrewSun OMG, i tried one of the ip addresses from nslookup, used htons() and now it works! Ty! At the end it was that stupid mistake :)"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549423905, "post_id": 54538980, "comment_id": 95892999, "body": "regarding the statements: <code>#include &quot;Authentication.h&quot;</code> and  <code>#include &quot;MessageHandlers.h&quot;</code>  The contents of those home grown header files are not posted, so we cannot reproduce the problem.  Please correct by posting the contents of those files"}, {"owner": {"reputation": 45, "user_id": 10379717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cDrKAT58Mfw/AAAAAAAAAAI/AAAAAAAAAHY/yGP1Uglx4QU/photo.jpg?sz=128", "display_name": "Stefano Raneri", "link": "https://stackoverflow.com/users/10379717/stefano-raneri"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549479599, "post_id": 54538980, "comment_id": 95920637, "body": "@user3629249 Those headers are not important since they just add the basic functionality of the chatbot, the problem was the missing <code>htons()</code> function."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1549494406, "post_id": 54538980, "comment_id": 95926716, "body": "When asking a question about a run time problem, as this question is doing, stackoverflow requires that a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> be posted.  Otherwise, the question is &#39;off topic&#39;"}], "answers": [{"tags": [], "owner": {"reputation": 3691, "user_id": 1808989, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/3884a2f2ee43a4681967493905dcc20c?s=128&d=identicon&r=PG", "display_name": "Andrew Sun", "link": "https://stackoverflow.com/users/1808989/andrew-sun"}, "is_accepted": true, "score": 2, "last_activity_date": 1549388443, "creation_date": 1549388443, "answer_id": 54540150, "question_id": 54538980, "link": "https://stackoverflow.com/questions/54538980/cant-connect-to-twitch-irc-server-problem-with-ip-address-c-language/54540150#54540150", "title": "Can&#39;t Connect to Twitch IRC Server, problem with IP address, C language", "body": "<p>Resolved in comments above. The port number in <code>struct sockaddr_in</code> is in network endianness (aka big endian), while your computer is likely running as little endian. To assign it, you must use</p>\n\n<pre><code>addr.sin_port = htons(6667);\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>addr.sin_port = 6667;\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 10379717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cDrKAT58Mfw/AAAAAAAAAAI/AAAAAAAAAHY/yGP1Uglx4QU/photo.jpg?sz=128", "display_name": "Stefano Raneri", "link": "https://stackoverflow.com/users/10379717/stefano-raneri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 1, "accepted_answer_id": 54540150, "answer_count": 1, "score": 0, "last_activity_date": 1549388443, "creation_date": 1549384370, "last_edit_date": 1549385974, "question_id": 54538980, "link": "https://stackoverflow.com/questions/54538980/cant-connect-to-twitch-irc-server-problem-with-ip-address-c-language", "title": "Can&#39;t Connect to Twitch IRC Server, problem with IP address, C language", "body": "<p>I'm trying to build a ChatBot for Twitch entirely in C Language. But i'm having problems in connecting to the server: <code>irc.chat.twitch.tv</code> with port <code>6667</code>. I'm calling <code>gethostbyname()</code> to retrieve the ip address of the hostname, but the connect function never establish the connection, and returns \"Connection Failed\". </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;netdb.h&gt;\n\n#include \"Authentication.h\"\n#include \"MessageHandlers.h\"\n\n\nint main()\n{\n    int sock;\n    struct sockaddr_in addr;\n    struct hostent * addr_info;\n    char * ip;\n    addr_info = gethostbyname(\"irc.chat.twitch.tv\");\n\n    ip = inet_ntoa(*(struct in_addr *)addr_info-&gt;h_name);\n    printf(\"%s\", ip);\n    addr.sin_family = AF_INET;\n    addr.sin_port = htons(6667);\n    addr.sin_addr.s_addr = inet_addr(ip);\n\n    sock = socket(AF_INET, SOCK_STREAM, 0);\n    if(sock &lt; 0)\n    {\n        fprintf(stderr, \"\\nSocket Creation Failed\\n\");\n        exit(EXIT_FAILURE);\n    }\n    printf(\"\\nConnecting to Twitch IRC Server...\\n\");\n    if(connect(sock, (struct sockaddr *)&amp;addr, sizeof(addr)) == -1)\n    {\n        fprintf(stderr, \"\\nConnection Failed\\n\");\n        exit(EXIT_FAILURE);\n    }\n\n   // SendAuthentication(sock);\n/*\n    while(1)\n    {\n     OnMessageEvents(sock);\n    }\n  */  \n\n   exit(EXIT_SUCCESS);\n}\n</code></pre>\n\n<p>Is there something i'm doing wrong? The twitch resolved ip address seems to be <code>105.114.99.45</code>. I searched on Google for the actual ip address, but i didn't find any answers.</p>\n\n<p>I used <code>nslookup irc.chat.twitch.tv</code> and tried all the ip addresses, but still i got \"Connection Failed\".</p>\n\n<p>If i use <code>telnet irc.chat.twitch.tv 6667</code> i get a connection and i can perform the login.</p>\n"}, {"tags": ["c", "arm", "armv7", "stm32f7", "libgcc"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1549384805, "post_id": 54538847, "comment_id": 95879419, "body": "Is performance critical enough that you need to optimize like this? Straight assignment should do it. This dark voodoo going on will need <i>extensive</i> tests if you&#39;re going to depend on that math being correct."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1549385084, "post_id": 54538847, "comment_id": 95879577, "body": "<i>Is my code (in C) correct?</i> yes it is, and if I do the two computations they calculate exactly the same value, a diff of them gives 0, there is no overflow going to double."}, {"owner": {"reputation": 4074, "user_id": 808101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb24053e79c428dad4e874daa4da0cb?s=128&d=identicon&r=PG", "display_name": "benjarobin", "link": "https://stackoverflow.com/users/808101/benjarobin"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1549385101, "post_id": 54538847, "comment_id": 95879590, "body": "@tadman Question updated, this is not a question about performance."}, {"owner": {"reputation": 4074, "user_id": 808101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb24053e79c428dad4e874daa4da0cb?s=128&d=identicon&r=PG", "display_name": "benjarobin", "link": "https://stackoverflow.com/users/808101/benjarobin"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1549385202, "post_id": 54538847, "comment_id": 95879640, "body": "@bruno I did test a little bit my code (About A million values tested), and for every tested value, the result is right."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1549385779, "post_id": 54538847, "comment_id": 95880022, "body": "even using input numbers using more bits than the mantissa of a double the result is exactly the same ! May be you will have to admit you are better than the lib ? ^^"}], "owner": {"reputation": 4074, "user_id": 808101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdb24053e79c428dad4e874daa4da0cb?s=128&d=identicon&r=PG", "display_name": "benjarobin", "link": "https://stackoverflow.com/users/808101/benjarobin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 361, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549388148, "creation_date": 1549384008, "last_edit_date": 1549388148, "question_id": 54538847, "link": "https://stackoverflow.com/questions/54538847/conversion-from-uint64-t-to-double", "title": "Conversion from uint64_t to double", "body": "<p>For an STM32F7, which includes instructions for double floating points, I want to convert an <code>uint64_t</code> to <code>double</code>.</p>\n\n<p>In order to test that, I used the following code:</p>\n\n<pre><code>volatile static uint64_t m_testU64 = 45uLL * 0xFFFFFFFFuLL;\nvolatile static double m_testD;\n\n#ifndef DO_NOT_USE_UL2D\n    m_testD = (double)m_testU64;\n#else\n    double t = (double)(uint32_t)(m_testU64 &gt;&gt; 32u);\n    t *= 4294967296.0;\n    t += (double)(uint32_t)(m_testU64 &amp; 0xFFFFFFFFu);\n    m_testD = t;\n#endif\n</code></pre>\n\n<p>By default (if <code>DO_NOT_USE_UL2D</code> is not defined) the compiler (gcc or clang) is calling the function: <code>__aeabi_ul2d()</code> which is kind of complex in number of executed instruction. See the assembly code here : <a href=\"https://github.com/gcc-mirror/gcc/blob/master/libgcc/config/arm/ieee754-df.S#L537\" rel=\"nofollow noreferrer\">https://github.com/gcc-mirror/gcc/blob/master/libgcc/config/arm/ieee754-df.S#L537</a></p>\n\n<p>For my particular example, it takes 20 instructions without entering in most of the branches</p>\n\n<p>And if  <code>DO_NOT_USE_UL2D</code> is defined, the compiler generate the following assembly code:</p>\n\n<pre><code>movw    r0, #1728       ; 0x6c0\nvldr    d2, [pc, #112]  ; 0x303fa0\nmovt    r0, #8192       ; 0x2000\nvldr    s0, [r0, #4]\nldr     r1, [r0, #0]\nvcvt.f64.u32    d0, s0\nvldr    s2, [r0]\nvcvt.f64.u32    d1, s2\nldr     r1, [r0, #4]\nvfma.f64        d1, d0, d2\nvstr    d1, [r0, #8]\n</code></pre>\n\n<p>The code is simpler, and it is only 10 instructions.</p>\n\n<p>So here the the questions (if <code>DO_NOT_USE_UL2D</code> is defined):</p>\n\n<ul>\n<li>Is my code (in C) correct?</li>\n<li>Is my code slower than the <code>__aeabi_ul2d()</code> function (not really important, but a  bit curious)?</li>\n</ul>\n\n<p>I have to do that, since I am not allowed to use function from libgcc (There are very good reasons for that...)</p>\n\n<p>Be aware that the main purpure of this question is not about performance, I am really curious about the implementation in libgcc, and I really want to know if there is something wrong in my code.</p>\n"}]