[{"tags": ["c", "pointers"], "comments": [{"owner": {"reputation": 4969, "user_id": 10971581, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPQr1.png?s=128&g=1", "display_name": "jhnc", "link": "https://stackoverflow.com/users/10971581/jhnc"}, "edited": false, "score": 2, "creation_date": 1556754147, "post_id": 55943951, "comment_id": 98540973, "body": "please compile with warnings enabled and then edit your code to remove the warnings"}, {"owner": {"reputation": 526, "user_id": 5365012, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_2kQk52HsJQ/AAAAAAAAAAI/AAAAAAAAESI/NauEwEkApuc/photo.jpg?sz=128", "display_name": "138", "link": "https://stackoverflow.com/users/5365012/138"}, "edited": false, "score": 2, "creation_date": 1556754518, "post_id": 55943951, "comment_id": 98541037, "body": "P is pointing at a 2 dimensional array. Essentially a pointer to a pointer. So * p gives you the address of the array {1,2,3}, p[0], while ** p is nearly equivalent to p[0][0]."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1556755450, "post_id": 55943951, "comment_id": 98541194, "body": "Don&#39;t use <code>%x</code> to print the value of a pointer, use <code>%p</code>."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556773110, "post_id": 55943951, "comment_id": 98544338, "body": "Also <code>*p + 0</code> is nonsense. Or it isn&#39;t but doesn&#39;t tell anything"}, {"owner": {"reputation": 534, "user_id": 2251364, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c387b641bba38ce5779f088c8f24ebdf?s=128&d=identicon&r=PG", "display_name": "Hritik", "link": "https://stackoverflow.com/users/2251364/hritik"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1557086970, "post_id": 55943951, "comment_id": 98639043, "body": "@AnttiHaapala <code>*p</code>, by itself represents an array. As per rules, <code>sizeof</code> operator doesn&#39;t convert the array name to a pointer. <code>+0</code> turns it into a pointer."}, {"owner": {"reputation": 534, "user_id": 2251364, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c387b641bba38ce5779f088c8f24ebdf?s=128&d=identicon&r=PG", "display_name": "Hritik", "link": "https://stackoverflow.com/users/2251364/hritik"}, "reply_to_user": {"reputation": 526, "user_id": 5365012, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_2kQk52HsJQ/AAAAAAAAAAI/AAAAAAAAESI/NauEwEkApuc/photo.jpg?sz=128", "display_name": "138", "link": "https://stackoverflow.com/users/5365012/138"}, "edited": false, "score": 0, "creation_date": 1557087191, "post_id": 55943951, "comment_id": 98639109, "body": "@138 If *p gives the address of array {1,2,3} to which it points, then why does p also give the same address ? Doesn&#39;t p point to a multi D array ?"}], "answers": [{"comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556772412, "post_id": 55945712, "comment_id": 98544159, "body": "The behaviour is not undefined <i>there</i>, but it is constraint violation, so a compiler <b>must</b> issue a diagnostics message."}, {"owner": {"reputation": 24693, "user_id": 10190237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f95f50f67af8a9658c5d76df263b323?s=128&d=identicon&r=PG&f=1", "display_name": "P.W", "link": "https://stackoverflow.com/users/10190237/p-w"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556772591, "post_id": 55945712, "comment_id": 98544214, "body": "That&#39;s what I thought too at first. But found the quote in the Annex. Please let me know if my interpretation of the quote is wrong."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556772698, "post_id": 55945712, "comment_id": 98544238, "body": "The annex is not normative. In addition, there is a clause <a href=\"http://port70.net/~nsz/c/c11/n1570.html#5.1.1.3p1\" rel=\"nofollow noreferrer\">C11 5.1.1.3p1</a> <i>&quot; A conforming implementation shall produce at least one diagnostic message (identified in an implementation-defined manner) if a preprocessing translation unit or translation unit contains a violation of any syntax rule or constraint, <b>even if the behavior is also explicitly specified as undefined or implementation-defined.</b>&quot;</i>"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556772946, "post_id": 55945712, "comment_id": 98544293, "body": "<a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.7.9p11\" rel=\"nofollow noreferrer\">6.7.9p11</a> says that the semantic rules of initialization are the same as for simple assignment and simple assignment says in constraints that the pointers must be compatible"}, {"owner": {"reputation": 24693, "user_id": 10190237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f95f50f67af8a9658c5d76df263b323?s=128&d=identicon&r=PG&f=1", "display_name": "P.W", "link": "https://stackoverflow.com/users/10190237/p-w"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556773907, "post_id": 55945712, "comment_id": 98544567, "body": "Thank you. I have revised the answer as per your inputs. Just curious to know: If the annex on undefined behavior is not normative , does it mean that the compiler can make some of the points listed there <i>defined</i> behavior? In that case, is the compiler required to document it?"}, {"owner": {"reputation": 534, "user_id": 2251364, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c387b641bba38ce5779f088c8f24ebdf?s=128&d=identicon&r=PG", "display_name": "Hritik", "link": "https://stackoverflow.com/users/2251364/hritik"}, "edited": false, "score": 0, "creation_date": 1557086863, "post_id": 55945712, "comment_id": 98639002, "body": "Does that mean conversion between pointers is not defined by the language ?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 534, "user_id": 2251364, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c387b641bba38ce5779f088c8f24ebdf?s=128&d=identicon&r=PG", "display_name": "Hritik", "link": "https://stackoverflow.com/users/2251364/hritik"}, "edited": false, "score": 0, "creation_date": 1557106817, "post_id": 55945712, "comment_id": 98642627, "body": "@Hritik yes, it is defined, It is defined that you must use a <i>cast</i> (explicit conversion)"}], "tags": [], "owner": {"reputation": 24693, "user_id": 10190237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f95f50f67af8a9658c5d76df263b323?s=128&d=identicon&r=PG&f=1", "display_name": "P.W", "link": "https://stackoverflow.com/users/10190237/p-w"}, "is_accepted": false, "score": 0, "last_activity_date": 1556773984, "last_edit_date": 1556773984, "creation_date": 1556771595, "answer_id": 55945712, "question_id": 55943951, "link": "https://stackoverflow.com/questions/55943951/pointer-pointing-to-itself/55945712#55945712", "title": "Pointer pointing to itself", "body": "<p>What you have here is constraint violation because you are using incompatible pointer types in the following initialization:</p>\n\n<pre><code>int *ip = a;\n</code></pre>\n\n<p>As per C11 standard section on <a href=\"https://port70.net/~nsz/c/c11/n1570.html#6.7.6.1p2\" rel=\"nofollow noreferrer\">Pointer declarators</a></p>\n\n<blockquote>\n  <p>For two pointer types to be compatible, both shall be identically qualified and both shall be pointers to compatible types.</p>\n</blockquote>\n\n<p>and on <a href=\"http://port70.net/~nsz/c/c11/n1570.html#6.5.16.1p1\" rel=\"nofollow noreferrer\">Simple assignment/Constraints</a></p>\n\n<blockquote>\n  <p>the left operand has atomic, qualified, or unqualified pointer type, and (considering the type the left operand would have after lvalue conversion) both operands are pointers to qualified or unqualified versions of compatible types, and the type pointed to by the left has all the qualifiers of the type pointed to by the right;</p>\n</blockquote>\n\n<p>The compiler is require to emit a diagnostic in this case which it does:</p>\n\n<blockquote>\n<pre><code>&lt;source&gt;:8:15: warning: initialization of 'int *' from incompatible pointer type 'int (*)[3]' [-Wincompatible-pointer-types]\n\n     int *ip = a;\n</code></pre>\n</blockquote>\n\n<p>See <a href=\"https://godbolt.org/z/s87bxA\" rel=\"nofollow noreferrer\">Demo</a></p>\n\n<p>When you compile a program, it is good practice to enable all warnings and treat warnings as errors so as to avoid (as far as possible) this kind of behavior.</p>\n"}, {"comments": [{"owner": {"reputation": 534, "user_id": 2251364, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c387b641bba38ce5779f088c8f24ebdf?s=128&d=identicon&r=PG", "display_name": "Hritik", "link": "https://stackoverflow.com/users/2251364/hritik"}, "edited": false, "score": 0, "creation_date": 1557087814, "post_id": 55961070, "comment_id": 98639281, "body": "The question is not about the warnings but the language&#39;s definition."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 534, "user_id": 2251364, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c387b641bba38ce5779f088c8f24ebdf?s=128&d=identicon&r=PG", "display_name": "Hritik", "link": "https://stackoverflow.com/users/2251364/hritik"}, "edited": false, "score": 2, "creation_date": 1557106852, "post_id": 55961070, "comment_id": 98642631, "body": "@Hritik of course it is about the warnings: each and every warning there is about the language definition that you broke."}], "tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 1, "last_activity_date": 1556836324, "creation_date": 1556836324, "answer_id": 55961070, "question_id": 55943951, "link": "https://stackoverflow.com/questions/55943951/pointer-pointing-to-itself/55961070#55961070", "title": "Pointer pointing to itself", "body": "<p>the posted code, when compiled with:</p>\n\n<pre><code>gcc -c -Wall -Wextra -Wconversion -pedantic -std=gnu11 \n</code></pre>\n\n<p>results in the following compiler messages:</p>\n\n<pre><code>gcc    -ggdb -Wall -Wextra -Wconversion -pedantic -std=gnu11 -c \"untitled.c\"  (in directory: /home/richard/Documents/forum)\nuntitled.c: In function \u2018main\u2019:\nuntitled.c:6:15: warning: initialization from incompatible pointer type [-Wincompatible-pointer-types]\n     int *ip = a;\n               ^\nuntitled.c:7:26: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 2 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                         ~^\n                         %ld\nuntitled.c:7:38: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 3 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                                     ~^\n                                     %ld\nuntitled.c:7:47: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 4 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                                              ~^\n                                              %ld\nuntitled.c:7:55: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 5 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                                                      ~^\n                                                      %ld\nuntitled.c:7:64: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 6 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                                                               ~^\n                                                               %ld\nuntitled.c:9:17: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 2 has type \u2018int (*)[3]\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                ~^\nuntitled.c:9:26: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 3 has type \u2018int (*)[3]\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                         ~^                                                ~~~\nuntitled.c:9:34: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 4 has type \u2018int *\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                                 ~^\n                                 %ls\nuntitled.c:9:44: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 5 has type \u2018int *\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                                           ~^                                     ~~~~\n                                           %ls\nuntitled.c:9:61: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 7 has type \u2018int *\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                                                            ~^\n                                                            %ls\nCompilation finished successfully.\n</code></pre>\n\n<p>The compiler finishes up by saying the compilation was successful.  That does NOT mean that it is ok to run this code and expect valid results/output.</p>\n\n<p>When you correct the code so it cleanly compiles, then please post a EDIT to your question that contains the modified/corrected code.</p>\n\n<pre><code>gcc    -ggdb -Wall -Wextra -Wconversion -pedantic -std=gnu11 -c \"untitled.c\"  (in directory: /home/richard/Documents/forum)\nuntitled.c: In function \u2018main\u2019:\nuntitled.c:6:15: warning: initialization from incompatible pointer type [-Wincompatible-pointer-types]\n     int *ip = a;\n               ^\nuntitled.c:7:26: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 2 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                         ~^\n                         %ld\nuntitled.c:7:38: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 3 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                                     ~^\n                                     %ld\nuntitled.c:7:47: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 4 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                                              ~^\n                                              %ld\nuntitled.c:7:55: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 5 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                                                      ~^\n                                                      %ld\nuntitled.c:7:64: warning: format \u2018%d\u2019 expects argument of type \u2018int\u2019, but argument 6 has type \u2018long unsigned int\u2019 [-Wformat=]\n     printf(\"sizeof:\\np: %d\\n(*p+0): %d\\n**p: %d\\nip: %d\\n*ip: %d\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n                                                               ~^\n                                                               %ld\nuntitled.c:9:17: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 2 has type \u2018int (*)[3]\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                ~^\nuntitled.c:9:26: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 3 has type \u2018int (*)[3]\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                         ~^                                                ~~~\nuntitled.c:9:34: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 4 has type \u2018int *\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                                 ~^\n                                 %ls\nuntitled.c:9:44: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 5 has type \u2018int *\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                                           ~^                                     ~~~~\n                                           %ls\nuntitled.c:9:61: warning: format \u2018%x\u2019 expects argument of type \u2018unsigned int\u2019, but argument 7 has type \u2018int *\u2019 [-Wformat=]\n     printf(\"p: %x\\tp+1: %x\\n*p: %x\\t*p+1: %x\\n**p: %d\\nip: %x\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n                                                            ~^\n                                                            %ls\nCompilation finished successfully.\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": true, "score": 2, "last_activity_date": 1557153186, "creation_date": 1557153186, "answer_id": 56007295, "question_id": 55943951, "link": "https://stackoverflow.com/questions/55943951/pointer-pointing-to-itself/56007295#56007295", "title": "Pointer pointing to itself", "body": "<p>First, note that this code in a confusing mish-mash of constraint violations combined with <a href=\"https://stackoverflow.com/questions/1461432/what-is-array-decaying\">array decay</a> to generate output of questionable usefulness.  But I'll try to answer your question as to what's going on, and try using mundane explanations without resorting to citations from the C Standard, as others already have answered in that manner.</p>\n\n<blockquote>\n  <p>How can *p and **p have same address but different value ? </p>\n</blockquote>\n\n<p>Because <code>p</code> is a pointer to an array.</p>\n\n<p>Given </p>\n\n<pre><code>typedef int int3[3];\nint3 *p;\n</code></pre>\n\n<p>that means <code>*p</code> is a three-dimensional array.  Note that</p>\n\n<pre><code>int3 *p = a;\n</code></pre>\n\n<p>is a constraint violation, as noted elsewhere.  You can <em>force</em> that to \"work\" with a cast, but it's still fundamentally wrong and the code only \"gets away\" with it because the address of an array is the address of the first element of that array - <strong>and</strong> your current implementation doesn't differentiate the pointer types in a significant-enough fashion they they're fundamentally incompatible.  Pick an implementation where a plain <code>int *</code> is, say, a 32-bit offset value while an array would have as its address both a 32-bit segment <strong>and</strong> a 32-bit offset value, and the code would likely generate nonsense if it didn't fail utterly.  That's why the C Standard requires pointers to be to \"compatible types\" - because pointers don't have to be compatible at all.</p>\n\n<p>That problem aside, the initialization/assignment on your implementation can seemingly be treated as</p>\n\n<pre><code>int3 *p = ( int3 * ) a;\n</code></pre>\n\n<p>Since that \"works\", that means <code>p</code> contains the address of a three-element array of <code>int</code> values.  So dereferencing <code>p</code> with <code>*p</code> is the same as <code>a[0]</code>, or the first three-element <code>int</code> array in the two-dimensional <code>a</code> array.</p>\n\n<p>So what is <code>*p</code>, then?</p>\n\n<p>It's exactly the same in this case as <code>a[0]</code>, an array.  And such a bare array reference <a href=\"https://stackoverflow.com/questions/1461432/what-is-array-decaying\">decays to an address</a>*, and that address is of the same <strong>type</strong> as a pointer to an element of the array.  And the value of that address will be that of the address of the first element of the array.</p>\n\n<p>So <code>*p</code>, which is a three-element array of <code>int</code>, can itself be dereferenced and evaluate to the first element of <code>a[0]</code>, or <code>a[0][0]</code>.  So <code>**p</code> is the same as <code>a[0][0]</code>.</p>\n\n<p>And <code>a[0][0]</code> - or <code>**p</code> - is an <code>int</code> that is initialized with the value of <code>1</code>.</p>\n\n<p>While <code>*p</code> is <code>a[0]</code> and the <strong>address</strong> of that first element.</p>\n\n<p>* - A lot of people say an array \"decays to a pointer\" or \"an array is a pointer\", but I like \"decays to an address\" because a pointer can be assigned to but an address simply <strong>is</strong> - it can't be assigned to itself, just like an array itself can't be assigned to, but the address can be assigned to something else, like a pointer.  Note than when an array is passed to a function, the <strong>address</strong> of the array actually is passed as an actual pointer.  The pointer is the function's parameter and that function parameter can be assigned to...</p>\n"}], "owner": {"reputation": 534, "user_id": 2251364, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c387b641bba38ce5779f088c8f24ebdf?s=128&d=identicon&r=PG", "display_name": "Hritik", "link": "https://stackoverflow.com/users/2251364/hritik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 56007295, "answer_count": 3, "score": 0, "last_activity_date": 1557153186, "creation_date": 1556753728, "last_edit_date": 1557146371, "question_id": 55943951, "link": "https://stackoverflow.com/questions/55943951/pointer-pointing-to-itself", "title": "Pointer pointing to itself", "body": "<p>I was exploring typedefs and stumbled upon this program</p>\n\n<p><strong>EDIT</strong>: Nearly all the answers were concerned about the warnings it generates. So, I went ahead and removed all the warnings but the question remains the same.</p>\n\n<pre><code>#include&lt;stdio.h&gt;\ntypedef int int3[3];\nint main(){\n    int a[2][3] = {{1,2,3}, {4,5}};\n    int3 *p = a;\n    int *ip = (int *) a;\n    printf(\"sizeof:\\np: %lu\\n(*p+0): %lu\\n**p: %lu\\nip: %lu\\n*ip: %lu\\n\",sizeof p, sizeof (*p+0), sizeof **p, sizeof ip, sizeof *ip);\n    printf(\"---\\n\");\n    printf(\"p: %p\\tp+1: %p\\n*p: %p\\t*p+1: %p\\n**p: %d\\nip: %p\\n*ip: %d\",p,p+1,*p,*p+1,**p,ip,*ip);\n    return 0;\n}\n</code></pre>\n\n<p>on one run it shows:</p>\n\n<pre><code>sizeof:\np: 8\n(*p+0): 8\n**p: 4\nip: 8\n*ip: 4\n---\np: 0x7ffe36df31b0   p+1: 0x7ffe36df31bc\n*p: 0x7ffe36df31b0  *p+1: 0x7ffe36df31b4\n**p: 1\nip: 0x7ffe36df31b0\n*ip: 1\n</code></pre>\n\n<p>My question is:\nIf p and *p are equal<br>\nand **p = 1<br>\nthen why not *p = 1 as well ?    </p>\n\n<p>Provided size of pointer = 8 and size of int = 4<br>\n   Even if taking in account pointer arithmetic, then *p should at least be 0xkk kk kk kk 00 00 00 01<br>\n   k being any hex number (consider little-endian)<br>\n   because de-referencing the same address as int should give 1   </p>\n\n<p><strong>EDIT</strong>:\nTo make things clearer, consider this table:</p>\n\n<pre><code>+-----------+----------------------+------------------+\n|Variable   | Value                | Address          |\n|           |                      |                  |\n|           |                      |                  |\n| p         | 0x7ffe36df31b0       |                  |\n|           |                      |                  |\n|*p         | 0x7ffe36df31b0       |  0x7ffe36df31b0  |\n|           |                      |                  |\n|**p        | 1                    |  0x7ffe36df31b0  |\n+-----------+----------------------+------------------+\n</code></pre>\n\n<p>How can *p and **p have same address but different value ? </p>\n"}, {"tags": ["c", "stack", "postfix-notation"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556750908, "post_id": 55943543, "comment_id": 98540359, "body": "Unrelated to your problem, but for <code>scanf</code> the format specifier <code>&quot;%s&quot;</code> expects the pointer to the first character or an array, of type <code>char *</code>. In your case that would be <code>&amp;exp[0]</code> (which is what plain <code>exp</code> by itself decays to). The expression <code>&amp;exp</code> is a pointer to the array itself, and have the type <code>char (*)[20]</code>, which is semantically very different from what&#39;s expected."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556751011, "post_id": 55943543, "comment_id": 98540380, "body": "As for your problem, now seems like a very good time to <a href=\"https://ericlippert.com/2014/03/05/how-to-debug-small-programs/\" rel=\"nofollow noreferrer\">learn how to debug your programs</a>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556751061, "post_id": 55943543, "comment_id": 98540390, "body": "And a general tip: Stop using global variables! If you need multiple functions to access something, pass it as arguments. And if you want a function to return something, have it actually return that."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1556751105, "post_id": 55943543, "comment_id": 98540410, "body": "Finally, please read about <a href=\"http://stackoverflow.com/help/how-to-ask\">how to ask good questions</a>, as well as <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>. And please learn how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to show us."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556751419, "post_id": 55943543, "comment_id": 98540473, "body": "Oh, and a final hint about a possible reason for your problem: How many variables named <code>p</code> do you have? How are they related (if related at all)?"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1556753471, "post_id": 55943543, "comment_id": 98540835, "body": "<code>while(i != (p+1))</code> never executes the body. <code>i == 0</code>, <code>p == -1</code>, hence <code>p+1 == 0</code>. So the loop ends immediately."}, {"owner": {"reputation": 43, "user_id": 9054642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76a80fd4eaf6b2561faf83708f532eec?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Salles Blanco", "link": "https://stackoverflow.com/users/9054642/matheus-salles-blanco"}, "edited": false, "score": 0, "creation_date": 1556761040, "post_id": 55943543, "comment_id": 98542086, "body": "Thank you for all the advises. Indeed it&#39;s time for me to learn how to debug the code. But in the end a friend gave me a tip about passing &#39;p&#39; variable as parameter and it worked"}], "owner": {"reputation": 43, "user_id": 9054642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76a80fd4eaf6b2561faf83708f532eec?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Salles Blanco", "link": "https://stackoverflow.com/users/9054642/matheus-salles-blanco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1556750208, "creation_date": 1556750040, "last_edit_date": 1556750208, "question_id": 55943543, "link": "https://stackoverflow.com/questions/55943543/polish-postfix-notation-not-calculating-always-showing-0-as-result", "title": "Polish postfix notation not calculating, always showing &#39;0&#39; as result", "body": "<p>I'm studying a stack-based polish notation calculator, which reads an infix expression, validates if the parentheses are correct, converts it to postfix and then evaluates it for the end result. But I am having some problems with the evaluation part, the code is skipping an entire 'while' loop (I've added some printf's to it, to find out exactly where it stops working), and always shows the end result as '0'.</p>\n\n<p>This is for my data structure studies. Everything seems to be working fine, but the evaluation part. I've tried adding some variables, but it did not work.</p>\n\n<pre><code>void postfix(){\n    int i = 0, op1, op2;\n    char ch;\n    int p =-1;\n    char exp[20];\n    char *e, x;\n    e = exp;\n\n    printf(\"Input the expression again: \");\n    scanf(\"%s\", &amp;exp);\n    printf(\"\\nThe postfix expression is: \");\n\n    while(*e != 0){\n        if(isalnum(*e)){\n            printf(\"%c\",*e);\n            post[++p]=*e;\n        } else if(*e == '(')\n            push(*e);\n        else if(*e == ')'){\n            while((x = pop()) != '('){\n                printf(\"%c\", x);\n                post[++p]=x;\n            }\n        } else{\n            while(priority(pilha[top]) &gt;= priority(*e)){\n                char a;\n                a= pop();\n                printf(\"%c\",a);\n                post[++p]=a;\n            }\n            push(*e);\n        }\n        e++;\n     }\n\n    while(top != -1){\n        char avaliada;\n        avaliada = pop();\n\n        printf(\"%c\",avaliada);\n        post[++p] = avaliada;\n    }\n}\n\nvoid evaluation(){\n    int i = 0, op1, op2;\n    char ch;\n    int p =-1;\n    char exp[20];\n    char *e, x;\n    e = exp;\n\n    postfix();\n\n    while(i != (p+1)){\n        ch=post[i];\n        i++;\n\n        if(isdigit(ch)){\n            xpush(ch - '0');\n        } else{\n            op2=xpop();\n            op1=xpop();\n\n            switch(ch){\n                case '+':xpush(op1+op2);break;\n                case '-':xpush(op1-op2);break;\n                case '*':xpush(op1*op2);break;\n                case '/':xpush(op1/op2);break;\n            }\n        }\n\n     printf(\"\\n\\nResult: %d\\n\",s[xtop]);\n}\n</code></pre>\n\n<p>For example, if I input the '2-1' expression in the console, I expect it to show the postfix notation, which would be '21-', and the calculated result, which would be '1', but the actual output is '0'.</p>\n"}, {"tags": ["c", "microcontroller", "pic"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1556749004, "post_id": 55943220, "comment_id": 98539913, "body": "Every microcontroller is different and the answer depends on checking the documentation for it."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1556749377, "post_id": 55943220, "comment_id": 98540013, "body": "Does &quot;soft start&quot; refer to the microcontroller power-up? Or does it simply mean that the elevator acceleration increases slowly?"}, {"owner": {"reputation": 9, "user_id": 11058403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d0dab596f99768ec0fcf658d88361e3?s=128&d=identicon&r=PG&f=1", "display_name": "hubbywubby", "link": "https://stackoverflow.com/users/11058403/hubbywubby"}, "edited": false, "score": 0, "creation_date": 1556751452, "post_id": 55943220, "comment_id": 98540483, "body": "The teacher doesn&#39;t have a lot of information for us, so my guess was that it is with the power-up since I don&#39;t have any information at all how to even address the acceleration."}, {"owner": {"reputation": 9, "user_id": 11058403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d0dab596f99768ec0fcf658d88361e3?s=128&d=identicon&r=PG&f=1", "display_name": "hubbywubby", "link": "https://stackoverflow.com/users/11058403/hubbywubby"}, "edited": false, "score": 0, "creation_date": 1556751656, "post_id": 55943220, "comment_id": 98540521, "body": "And also since we&#39;re also working with how to connect the PIC to different voltage and getting the right amount of voltage over the VDD and VSS. So that&#39;s why I also think it&#39;s about power-up"}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 11058403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d0dab596f99768ec0fcf658d88361e3?s=128&d=identicon&r=PG&f=1", "display_name": "hubbywubby", "link": "https://stackoverflow.com/users/11058403/hubbywubby"}, "edited": false, "score": 0, "creation_date": 1556781088, "post_id": 55945737, "comment_id": 98547219, "body": "thank you! Any idea to code the escelation of the PWM?"}, {"owner": {"reputation": 6300, "user_id": 2331592, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/befb1bd6b66c01fed1d2384a405e6f7e?s=128&d=identicon&r=PG&f=1", "display_name": "vlad_tepesch", "link": "https://stackoverflow.com/users/2331592/vlad-tepesch"}, "edited": false, "score": 0, "creation_date": 1556830079, "post_id": 55945737, "comment_id": 98571642, "body": "ty for the second sentence - ymmd  \ud83d\ude02"}, {"owner": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "edited": false, "score": 0, "creation_date": 1556833023, "post_id": 55945737, "comment_id": 98572703, "body": "PWM is just turning on and off rapidly, most microcontrollers have some I/Os than can be programmed to produce PWM, or you can just use a timing loop."}], "tags": [], "owner": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "is_accepted": false, "score": 3, "last_activity_date": 1556771840, "creation_date": 1556771840, "answer_id": 55945737, "question_id": 55943220, "link": "https://stackoverflow.com/questions/55943220/how-do-i-write-to-a-pin-on-a-microcontroller/55945737#55945737", "title": "How do I write to a pin on a Microcontroller?", "body": "<p>Soft start is where the motor starts slowly and gradually increases speed. </p>\n\n<p>This is very useful especially in high-speed elevators as it keeps the passengers alive and happy.</p>\n\n<p>If it's a brush motor use PWM. If it's a stepper vary the step rate and maybe use microstepping. if it's an induction motor your task is to build a VFD, good luck!</p>\n"}], "owner": {"reputation": 9, "user_id": 11058403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d0dab596f99768ec0fcf658d88361e3?s=128&d=identicon&r=PG&f=1", "display_name": "hubbywubby", "link": "https://stackoverflow.com/users/11058403/hubbywubby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "closed_date": 1556777541, "answer_count": 1, "score": -6, "last_activity_date": 1556771840, "creation_date": 1556748017, "question_id": 55943220, "link": "https://stackoverflow.com/questions/55943220/how-do-i-write-to-a-pin-on-a-microcontroller", "closed_reason": "Needs more focus", "title": "How do I write to a pin on a Microcontroller?", "body": "<p>In our school project, we have to write a code for a \"soft start\" to our miniature elevator. I'm supposing what they mean is that we should use the POWER-UP-timer so that the voltage levels stabilize after a restart. So in the block diagram, it seemed to be connected to VDD and VSS, which is ports 5 and 14. How do I write the code? Is there something I'm forgetting? </p>\n\n<p>I don't really know where to start.</p>\n"}, {"tags": ["c", "windows", "sockets"], "comments": [{"owner": {"reputation": 78607, "user_id": 319403, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e92a9af9e53cc8e5af575c4b18b34c21?s=128&d=identicon&r=PG", "display_name": "cHao", "link": "https://stackoverflow.com/users/319403/chao"}, "edited": false, "score": 1, "creation_date": 1556747687, "post_id": 55943056, "comment_id": 98539528, "body": "The loop looks somewhere between superfluous and broken. (It only cares about the first address. If that first address isn&#39;t IPv4 or IPv6, the code will break....but that&#39;s exceedingly unlikely in today&#39;s internet.)"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1556747701, "post_id": 55943056, "comment_id": 98539532, "body": "FWIW, I agree with you that the <code>for</code> statement does nothing except verify that <code>list</code> is not equal to <code>NULL</code>. The loop would make sense if the goal was to find an IPv4 address, while skipping IPv6 addresses. But that&#39;s not what the loop is doing."}, {"owner": {"reputation": 308, "user_id": 10588548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b550512336a5d7d12b12a50bce00692?s=128&d=identicon&r=PG&f=1", "display_name": "Halloween", "link": "https://stackoverflow.com/users/10588548/halloween"}, "edited": false, "score": 0, "creation_date": 1556747977, "post_id": 55943056, "comment_id": 98539606, "body": "What would be in the list? Other IP address to the address it did getaddrinfo() on? If I understood what the list getaddrinfo() was supposed to return looked like with multiple links, then I could probably get this fixed. However I am not sure."}], "answers": [{"comments": [{"owner": {"reputation": 308, "user_id": 10588548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b550512336a5d7d12b12a50bce00692?s=128&d=identicon&r=PG&f=1", "display_name": "Halloween", "link": "https://stackoverflow.com/users/10588548/halloween"}, "edited": false, "score": 0, "creation_date": 1556756197, "post_id": 55943719, "comment_id": 98541309, "body": "I generally stay away from the man pages but these seems to explain everything I needed to know. I understand what it is going to return now. Thank you so much for your help!"}, {"owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "edited": false, "score": 0, "creation_date": 1556773585, "post_id": 55943719, "comment_id": 98544460, "body": "The loop doesn&#39;t check the family of the first (or any) returned entry, which would be <code>e-&gt;ai_family</code>; it checks the <i>function parameter</i> <code>family</code>, which is also put into <code>hints.ai_family</code>, requiring that all and any entries returned by gai must have that family, and thus if more than one all will be the same."}], "tags": [], "owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "is_accepted": true, "score": 4, "last_activity_date": 1556751403, "creation_date": 1556751403, "answer_id": 55943719, "question_id": 55943056, "link": "https://stackoverflow.com/questions/55943056/when-does-getaddrinfo-return-more-than-one-sockaddr-struct-in-the-list/55943719#55943719", "title": "When does getaddrinfo return more than one sockaddr struct in the list?", "body": "<p><strong>What would be in the list?</strong></p>\n\n<p>The following quote is from the <a href=\"http://man7.org/linux/man-pages/man3/gai_strerror.3.html\" rel=\"nofollow noreferrer\">man page of <code>getaddrinfo</code> of glibc</a>, but AFAIK it applies equally to the Windows version:</p>\n\n<blockquote>\n  <p>There are several reasons why the linked list may have more than one\n         addrinfo structure, including: the network host is multihomed, accessible over multiple protocols (e.g., both AF_INET and AF_INET6); or\n         the same service is available from multiple socket types (one\n         SOCK_STREAM address and another SOCK_DGRAM address, for example).</p>\n</blockquote>\n\n<p>So, basically the host could have multiple ways to contact it, and <code>getaddrinfo</code> is listing all (known) ways.  Note that the same man page further states:</p>\n\n<blockquote>\n  <p>Normally, the application should try using the addresses in the order\n         in which they are returned.  The sorting function used within getaddrinfo() is defined in RFC 3484;</p>\n</blockquote>\n\n<p>Of course, here too we don't know whether this also holds for the Windows implementation(s), but if it's specified in an <a href=\"https://www.ietf.org/rfc/rfc3484.txt\" rel=\"nofollow noreferrer\">RFC</a> then that might be the case.</p>\n\n<p><strong>What is this for loop trying to accomplish?</strong></p>\n\n<p>As it stands you could remove the loop.  I think there might be a reason to keep  (= fix) it, though:  Consider the case where the first returned entry has a <code>family</code> of neither <code>AF_INET</code> nor <code>AF_INET6</code>.  The code in your questions then just fails (<code>return NULL;</code>), but there could be a later entry in the list which could have that family.</p>\n"}], "owner": {"reputation": 308, "user_id": 10588548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b550512336a5d7d12b12a50bce00692?s=128&d=identicon&r=PG&f=1", "display_name": "Halloween", "link": "https://stackoverflow.com/users/10588548/halloween"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 1, "accepted_answer_id": 55943719, "answer_count": 1, "score": 2, "last_activity_date": 1556751403, "creation_date": 1556746897, "question_id": 55943056, "link": "https://stackoverflow.com/questions/55943056/when-does-getaddrinfo-return-more-than-one-sockaddr-struct-in-the-list", "title": "When does getaddrinfo return more than one sockaddr struct in the list?", "body": "<p>I am working with some code I found and I am trying to understand the <strong><em>for loop</em></strong> logic in this. </p>\n\n<p>It seems like the for loop is not being used and it is always going to break. So I am not understanding what sort of information is returned from getaddrinfo() that would cause this to loop over again and check for something?</p>\n\n<p>Question: Basically what is this for loop trying to accomplish? It seems to me it is just checking that list is not NULL because no loop is occurring, ever.</p>\n\n<pre><code>tcp_ctx* tcp_new_ctx(INT family, CHAR *host, CHAR *port) {\n    struct addrinfo *list = NULL;\n    struct addrinfo *e = NULL;\n    struct addrinfo hints;\n    tcp_ctx         *c = NULL;\n    WSADATA         wsa;\n    INT             on = 1;\n\n    WSAStartup(MAKEWORD(2, 0), &amp;wsa);\n\n    ZeroMemory(&amp;hints, sizeof(hints));\n\n    hints.ai_family = family;\n    hints.ai_socktype = SOCK_STREAM;\n    hints.ai_protocol = IPPROTO_TCP;\n\n    // try to resolve network address for host\n    //list contains linked list of addrinfo structs containing information on the host\n    if (getaddrinfo(host, port, &amp;hints, &amp;list) != 0) {\n        return NULL;\n    }\n    c = tcp_alloc(sizeof(tcp_ctx));\n\n    // Traverse linked list from getaddr info\n    for (e = list; e != NULL; e = e-&gt;ai_next) {\n        if (family == AF_INET) {\n            memcpy(&amp;c-&gt;v4, e-&gt;ai_addr, e-&gt;ai_addrlen);\n            c-&gt;ai_addr = (SOCKADDR*)&amp;c-&gt;v4;\n        } else if (family == AF_INET6) {\n            memcpy(&amp;c-&gt;v6, e-&gt;ai_addr, e-&gt;ai_addrlen);\n            c-&gt;ai_addr = (SOCKADDR*)&amp;c-&gt;v6;\n        } else {\n            return NULL;\n        }\n        c-&gt;ai_addrlen = e-&gt;ai_addrlen;\n        // create socket and event for signalling\n        c-&gt;s = socket(family, SOCK_STREAM, IPPROTO_TCP);\n        if (c-&gt;s != SOCKET_ERROR) {\n            // ensure we can reuse same port later\n            setsockopt(c-&gt;s, SOL_SOCKET, SO_REUSEADDR, (CHAR*)&amp;on, sizeof(on));\n        }\n        break;\n    }\n    freeaddrinfo(list);\n    return c;\n}\n</code></pre>\n"}, {"tags": ["c", "while-loop", "do-while"], "comments": [{"owner": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "edited": false, "score": 0, "creation_date": 1556771140, "post_id": 55942983, "comment_id": 98543915, "body": "move the initialisation of j and k into the big loop."}], "answers": [{"comments": [{"owner": {"reputation": 1101, "user_id": 3958521, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GorZx.jpg?s=128&g=1", "display_name": "bigwillydos", "link": "https://stackoverflow.com/users/3958521/bigwillydos"}, "edited": false, "score": 0, "creation_date": 1556747255, "post_id": 55943045, "comment_id": 98539400, "body": "I&#39;m down voting this not because the answer was wrong but because your solution has C++ code in it and this question is tagged specifically for C"}], "tags": [], "owner": {"reputation": 31, "user_id": 2061820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d327e554185a444de5abfc954dc3f62?s=128&d=identicon&r=PG", "display_name": "infinitum", "link": "https://stackoverflow.com/users/2061820/infinitum"}, "is_accepted": false, "score": 0, "last_activity_date": 1556831208, "last_edit_date": 1556831208, "creation_date": 1556746827, "answer_id": 55943045, "question_id": 55942983, "link": "https://stackoverflow.com/questions/55942983/star-patterns-using-while-loops/55943045#55943045", "title": "star patterns using while loops", "body": "<p>You code doesn't work because you are not initialising the variables properly inside your while loop. I have made corrections and the following code works.</p>\n\n<p>Make sure you set the values of j and k back to the initial values for each iteration</p>\n\n<pre><code>int main(){\nint i,j,k;\ni = 5;\nj = 1;\nk = 5;\n\nwhile (i &gt; 0)\n{   \n    while (j &lt; i)\n    {\n        printf(\" \");\n        j++;\n    }\n    while (k &gt;= i)\n    {\n        printf(\"*\");\n        k--;\n    }\n    printf(\"\\n\");\n    i--;\n    j=1;\n    k=5;\n}\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 11438995, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XKSJJFh2uYU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc-HOjZfgF60oxm_djmGPevfSc3ag/mo/photo.jpg?sz=128", "display_name": "\ub0a8\uc8fc\ud61c", "link": "https://stackoverflow.com/users/11438995/%eb%82%a8%ec%a3%bc%ed%98%9c"}, "edited": false, "score": 0, "creation_date": 1556747646, "post_id": 55943095, "comment_id": 98539519, "body": "thank you so much!! can you help me make this to do-while loop? it&#39;s not working by just switching statements"}], "tags": [], "owner": {"reputation": 1101, "user_id": 3958521, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GorZx.jpg?s=128&g=1", "display_name": "bigwillydos", "link": "https://stackoverflow.com/users/3958521/bigwillydos"}, "is_accepted": true, "score": 0, "last_activity_date": 1556747129, "creation_date": 1556747129, "answer_id": 55943095, "question_id": 55942983, "link": "https://stackoverflow.com/questions/55942983/star-patterns-using-while-loops/55943095#55943095", "title": "star patterns using while loops", "body": "<p>You need to reinitialize <code>j</code> and <code>k</code> after <code>i--</code></p>\n\n<pre><code>j=1;\nk=5;\n</code></pre>\n\n<p>Like so:</p>\n\n<pre><code>int i,j,k;\ni = 5;\nj = 1;\nk = 5;\n\nwhile (i &gt; 0)\n{   \n    while (j &lt; i)\n    {\n        printf(\" \");\n        j++;\n    }\n    while (k &gt;= i)\n    {\n        printf(\"*\");\n        k--;\n    }\n    printf(\"\\n\");\n    i--;\n    j = 1;\n    k = 5;\n}\n</code></pre>\n\n<p>Tested this here: <a href=\"https://onlinegdb.com/r1-_m9Pj4\" rel=\"nofollow noreferrer\">https://onlinegdb.com/r1-_m9Pj4</a></p>\n"}], "owner": {"reputation": 1, "user_id": 11438995, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XKSJJFh2uYU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc-HOjZfgF60oxm_djmGPevfSc3ag/mo/photo.jpg?sz=128", "display_name": "\ub0a8\uc8fc\ud61c", "link": "https://stackoverflow.com/users/11438995/%eb%82%a8%ec%a3%bc%ed%98%9c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "closed_date": 1556786470, "accepted_answer_id": 55943095, "answer_count": 2, "score": -1, "last_activity_date": 1556831208, "creation_date": 1556746415, "question_id": 55942983, "link": "https://stackoverflow.com/questions/55942983/star-patterns-using-while-loops", "closed_reason": "Not suitable for this site", "title": "star patterns using while loops", "body": "<p>I'd like to make star patterns in this link</p>\n\n<p><a href=\"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTpq63AaQe8nlrbBKskHUlz2fLu3U6-7KJbNqXgDDqLujjhJm8r\" rel=\"nofollow noreferrer\">https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTpq63AaQe8nlrbBKskHUlz2fLu3U6-7KJbNqXgDDqLujjhJm8r</a></p>\n\n<p>by while loops and do-while loops, but have some problems plz help</p>\n\n<pre><code>int i,j,k;\ni = 5;\nj = 1;\nk = 5;\n\nwhile (i &gt; 0)\n{   \n    while (j &lt; i)\n    {\n        printf(\" \");\n        j++;\n    }\n    while (k &gt;= i)\n    {\n        printf(\"*\");\n        k--;\n    }\n    printf(\"\\n\");\n    i--;\n}\n</code></pre>\n\n<p>why isn't it working? where should I fix?</p>\n"}, {"tags": ["c", "function", "while-loop", "call"], "comments": [{"owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "edited": false, "score": 0, "creation_date": 1556742731, "post_id": 55942340, "comment_id": 98537908, "body": "Will <code>&#47;&#47; do some code</code> eventually call the function or are we looking at concurrent code here?"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 2, "creation_date": 1556743178, "post_id": 55942340, "comment_id": 98538079, "body": "That code doesn&#39;t make any sense. Perhaps the <code>while</code> was intended to be an <code>if</code>. Otherwise, you need to explain how the the function gets called when the code is stuck in the <code>while</code> loop (as Daniel pointed out)."}], "answers": [{"comments": [{"owner": {"reputation": 2323, "user_id": 8350647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJNHD.png?s=128&g=1", "display_name": "Nina", "link": "https://stackoverflow.com/users/8350647/nina"}, "edited": false, "score": 0, "creation_date": 1556743079, "post_id": 55942411, "comment_id": 98538035, "body": "static int works and should be pointed out that static variables by default have an initial value of 0 and are stored in the .data section rather than local to a stack. There&#39;s nothing magical about them, it would be the same as using a global variable."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "reply_to_user": {"reputation": 2323, "user_id": 8350647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJNHD.png?s=128&g=1", "display_name": "Nina", "link": "https://stackoverflow.com/users/8350647/nina"}, "edited": false, "score": 3, "creation_date": 1556743351, "post_id": 55942411, "comment_id": 98538143, "body": "@Nina While what all you&#39;re saying is true, I don&#39;t see the point in pointing it out. I always initialize both globals and statics even if they should be set to zero."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556745943, "post_id": 55942411, "comment_id": 98539029, "body": "The only problem with this technique is if the code could be used from multiple threads.  Several of them might then do the initialization at once.  POSIX provides <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/pthread_once.html\" rel=\"nofollow noreferrer\"><code>pthread_once()</code></a> to solve that problem.  It likely isn&#39;t an issue for the OP (yet)."}], "tags": [], "owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "is_accepted": false, "score": 6, "last_activity_date": 1556743895, "last_edit_date": 1556743895, "creation_date": 1556742918, "answer_id": 55942411, "question_id": 55942340, "link": "https://stackoverflow.com/questions/55942340/how-to-implement-do-something-if-the-function-hasnt-been-called-yet/55942411#55942411", "title": "How to implement: do something if the function hasn&#39;t been called yet?", "body": "<p>Well, it's pretty easy. Just use a static variable.</p>\n\n<pre><code>void foo() {\n    static int hasBeenCalled = 0;\n    if(!hasBeenCalled) {\n        /* Do stuff */\n        hasBeenCalled = 1;\n    }\n}\n</code></pre>\n\n<p>You don't have to perform the initialization for globals and statics, since they have the default value of 0, which local variables does not. But imho it looks way better. Globals and statics are used so rarely that I don't see the point in utilizing this 'feature'.</p>\n\n<p>Technically, you're still calling the function with above method. If that's a problem, you can use a global variable and put the logic I used outside. Here is a working example:</p>\n\n<pre><code>int hasBeenCalled = 0;\n\nvoid foo() {\n    while(!hasBeenCalled) {\n        /* Do stuff that eventually calls bar() */\n    }\n}\n\nvoid bar() {\n    hasBeenCalled=1;\n    /* Do stuff */\n}\n\nint main() {\n    foo();\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": false, "score": 0, "last_activity_date": 1556746372, "creation_date": 1556746372, "answer_id": 55942976, "question_id": 55942340, "link": "https://stackoverflow.com/questions/55942340/how-to-implement-do-something-if-the-function-hasnt-been-called-yet/55942976#55942976", "title": "How to implement: do something if the function hasn&#39;t been called yet?", "body": "<p>Unfortunately, the code your are using to illustrate your intention is not very clear. But, you did ask this:</p>\n\n<blockquote>\n  <p>... if a function hasn't been called before in a previous part of the code then call it, otherwise if it has been called before then don't call it?</p>\n</blockquote>\n\n<p>Besides using a boolean, you can also use a function pointer. The function pointer points to a function that should be called the first time the function is invoked. This function then changes the function pointer to point to the function that should be called after the first time.</p>\n\n<pre><code>static void foo_first_time(void);\nstatic void foo_after_first_time(void);\n\nvoid (*foo)(void) = foo_first_time;\n\nstatic void foo_first_time(void) {\n    foo = foo_after_first_time;\n    // do some code\n    // ...\n}\n\nstatic void foo_after_first_time(void) {\n    // do something else\n    // ...\n}\n</code></pre>\n\n<p>Now, the caller simply invokes <code>foo()</code> normally. The first time would invoke <code>foo_first_time</code>, but subsequent calls would invoke <code>foo_after_first_time</code>.</p>\n\n<pre><code>int main () {\n    foo(); // calls foo_first_time\n    foo(); // calls foo_after_first_time\n    foo(); // calls foo_after_first_time again\n}\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 10614090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2db4ada90893e9ee7e67ab3c47151f3a?s=128&d=identicon&r=PG&f=1", "display_name": "Sawy3r", "link": "https://stackoverflow.com/users/10614090/sawy3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1556746372, "creation_date": 1556742586, "question_id": 55942340, "link": "https://stackoverflow.com/questions/55942340/how-to-implement-do-something-if-the-function-hasnt-been-called-yet", "title": "How to implement: do something if the function hasn&#39;t been called yet?", "body": "<p>Is there a way in C that you can do: if a function hasn't been called before in a previous part of the code then call it, otherwise if it has been called before then don't call it?</p>\n\n<p>Heres some code:</p>\n\n<pre><code>while (function hasn't been called)\n{\n    // do some code\n}\nelse (call the function)\n{\n    // do something else\n}\n</code></pre>\n\n<p>Something like that?</p>\n"}, {"tags": ["c", "signals"], "comments": [{"owner": {"reputation": 2385, "user_id": 1009270, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/33fcdc9c0604cf69abb15e17840d2a3c?s=128&d=identicon&r=PG", "display_name": "john elemans", "link": "https://stackoverflow.com/users/1009270/john-elemans"}, "edited": false, "score": 0, "creation_date": 1556739878, "post_id": 55941770, "comment_id": 98536834, "body": "Likely c = -1, the fork failed. Check for that."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1556740090, "post_id": 55941770, "comment_id": 98536937, "body": "Your signal handler function does not have the correct type.  In addition to returning an <code>int</code>, it must accept one argument of type <code>int</code>."}], "answers": [{"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1556740478, "post_id": 55941845, "comment_id": 98537079, "body": "In fact, even that&#39;s not enough, as it produces a race between the parent calling <code>kill()</code> and the child calling <code>signal()</code>.  The <i>parent</i> should register the handler, before it forks, so that the registration is inherited by the child.  That way, the signal cannot be delivered before the child is ready for it.  Alternatively, the parent could block the signal before forking, and the child could use <code>sigsuspend()</code> instead of <code>pause()</code>."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556740701, "post_id": 55941845, "comment_id": 98537185, "body": "True. While not completely reliable, the parent&#39;s <code>sleep(1);</code> is presumably intended to allow time for the child to establish the handler."}], "tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": false, "score": 4, "last_activity_date": 1556740064, "creation_date": 1556740064, "answer_id": 55941845, "question_id": 55941770, "link": "https://stackoverflow.com/questions/55941770/using-signals-in-c/55941845#55941845", "title": "Using signals in c", "body": "<p>You need to set up the handler <em>before</em> you pause. Otherwise, <code>pause()</code> will be interrupted by the signal, then the default action of the signal will be taken, which is to terminate the process. It will never add the handler because the process is killed first.</p>\n\n<pre><code>    if(c==0){\n        signal(SIGINT,handler);\n        pause();\n        printf(\"child:pid is %d \\n\",getpid());\n    }\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11432153"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556740064, "creation_date": 1556739694, "last_edit_date": 1556739940, "question_id": 55941770, "link": "https://stackoverflow.com/questions/55941770/using-signals-in-c", "title": "Using signals in c", "body": "<p>I was writing a simple program in c where via fork i create i child process:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include&lt;signal.h&gt;\n#include&lt;sys/types.h&gt;\n\nint handler(){\n\n}\nint main(int argc, char **argv)\n{\n\n    pid_t c=fork();\n    if(c&gt;0){\n        sleep(1);\n        printf(\"f:pid is %d \\n\",getpid());\n        kill(c,SIGINT);\n        wait(NULL);\n    }\n\n    if(c==0){\n        pause();\n        signal(SIGINT,handler);\n        printf(\"child:pid is %d \\n\",getpid());\n    }\n}\n</code></pre>\n\n<p>The problem is that the child prints nothing. I thought that pause just waits for a signal to unpause the process and i can't understand why the print never happens.Any ideas?</p>\n"}, {"tags": ["c", "file", "compression"], "comments": [{"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 0, "creation_date": 1556738948, "post_id": 55941605, "comment_id": 98536433, "body": "Please share your code, so we can help you."}, {"owner": {"reputation": 1098, "user_id": 6694684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a3b34689f308f4a92ad3002622bd6d3?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin J.", "link": "https://stackoverflow.com/users/6694684/benjamin-j"}, "edited": false, "score": 0, "creation_date": 1556739022, "post_id": 55941605, "comment_id": 98536469, "body": "Please share your code and read <a href=\"https://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556739143, "post_id": 55941605, "comment_id": 98536508, "body": "There might be data remaining in the compression buffer which needs writing to file before you close the file. For example, if I am doing <a href=\"https://en.wikipedia.org/wiki/Run-length_encoding\" rel=\"nofollow noreferrer\">RLE</a> there might be a final run length to write."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1556739279, "post_id": 55941605, "comment_id": 98536574, "body": "Side note: <code>if ((!f_d) &amp;&amp; (!f_s))</code> should be <code>if ((!f_d) || (!f_s))</code>. Both files must be opened."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556740143, "post_id": 55941605, "comment_id": 98536961, "body": "Another aside: I can&#39;t see why <code>save_pos = ftell(f_d); fseek(f_d, save_pos, SEEK_SET);</code> is needed, it does nothing. Also there is another strange sequence, you are checking <code>result</code> after the file write was done. The first check of <code>while ((result...))</code> is the result from the <code>BZ2_bzCompressInit()</code> call, but in subsequent loops of <code>while ((result...))</code> none of the values checked are ones that are set by the ternary operator on <code>BZ2_bzCompress()</code> futher on in the loop, for the next loop... and <i>after</i> writing to the file."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556741246, "post_id": 55941605, "comment_id": 98537385, "body": "You&#39;re careful to open the output file as a binary file, which is good, but it&#39;s unclear why you do not do the same for the input file.  Depending on your platform, it might not make a practical difference, but the discrepancy stands out."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 1792727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/148c5b8d5b18135ecc679feda6dfe0a7?s=128&d=identicon&r=PG", "display_name": "user1792727", "link": "https://stackoverflow.com/users/1792727/user1792727"}, "edited": false, "score": 0, "creation_date": 1556746204, "post_id": 55942730, "comment_id": 98539119, "body": "John Bollinger: Thank you for the tip of setting bz.avail_in to strlen(buf_read). This solved my problem."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 1, "last_activity_date": 1556744917, "creation_date": 1556744917, "answer_id": 55942730, "question_id": 55941605, "link": "https://stackoverflow.com/questions/55941605/failure-to-write-subsquent-compressed-data-to-an-output-file-in-c/55942730#55942730", "title": "Failure to write subsquent compressed data to an output file in C", "body": "<p><strong>TL;DR:</strong> there are multiple problems, but the main one that explains the problem you asked about is likely that you compress each line of the file independently, instead of the whole file as a unit.</p>\n\n<hr>\n\n<ol>\n<li><p>According to the docs of <code>BZ2_bzCompressInit</code>, the <code>bz_stream</code> argument should be allocated <em>and initialized</em> before the call.  Yours is (automatically) allocated, but not (fully) initialized.  It would be clearer and easier to change to</p>\n\n<pre><code>    bz_stream bz = { 0 };\n</code></pre>\n\n<p>and then skip the assignments to <code>bz.opaque</code>, <code>bz.alloc</code>, and <code>bz.free</code>.</p></li>\n<li><p>You store but do not really check the return value of your <code>BZ2_bzCompressInit</code> call.  It does eventually get tested in the condition of the inner <code>while</code> loop, but you do not detect error conditions there, but instead just success and normal completion conditions.</p></li>\n<li><p>Your handling of the input buffer is significantly flawed.</p>\n\n<ul>\n<li><p>In the first place, you set the number of available input bytes incorrectly:</p>\n\n<pre><code>bz.avail_in = sizeof(buf_read);\n</code></pre>\n\n<p>Since you're using <code>fgets()</code> to read data into the buffer, under no circumstances is the full size of the buffer occupied by input data, because <code>fgets()</code> ensures that a string terminator is written into the array.  In fact, it could be worse because <code>fgets()</code> will stop at after newlines, so it may provide as few as just one input byte on a successful read.</p>\n\n<p>If you want to stick with <code>fgets()</code> then you need to use <code>strlen()</code> to determine the number of bytes available from each read, but I would suggest that you instead switch to <code>fread()</code>, which will more reliably fill the buffer, indicate with its return value how many bytes were read, and correctly handle inputs containing null bytes.</p></li>\n<li><p>In the second place, <strong><em>you use <code>BZ2_bzCompress()</code> to compress each buffer of input as if it were a complete file</em></strong>.  When you come to the end of the buffer, you finish a compression run and reinitialize the bz_stream.  This will definitely interfere with decompressing, and it may explain why your program (seems to) compress only the first line of its input.  You should be reading the whole content of the file (in suitably-sized chunks) and feeding all of it to <code>BZ2_bzCompress(... BZ_RUN)</code> before you finish up.  There should be one sequence of calls to <code>BZ2_bzCompress(... BZ_FINISH)</code> and finally one call to <code>BZ2_bzCompressEnd()</code> for the whole file, not per line.</p></li>\n</ul></li>\n<li><p>You do not perform error detection or handling for any of your calls to standard library or bzip functions.  You do handle the expected <em>success-case</em> return values for some of these, but you need to be rpepared for errors, too.</p></li>\n<li><p>There are some additional oddities</p>\n\n<ul>\n<li>you have unused variables <code>nbytes_in</code>, <code>nbytes_out</code>, <code>bzerror</code>, and <code>b</code>.</li>\n<li>you open the input file as a <em>text</em> file, though whether that makes any difference is platform-dependent.</li>\n<li>the <code>ftell()</code> / <code>fseek()</code> pair has no overall effect other than setting <code>save_pos</code>, which is not otherwise used.</li>\n<li>although it is not harmful, it also is not <em>useful</em> to <code>memset()</code> the output buffer to all-zeroes at the end of each line (or initially).</li>\n<li>Given that you're <em>compressing</em> the input, it's odd (but again not harmful) that you provide six times as much output buffer as you do input buffer.</li>\n</ul></li>\n</ol>\n"}], "owner": {"reputation": 43, "user_id": 1792727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/148c5b8d5b18135ecc679feda6dfe0a7?s=128&d=identicon&r=PG", "display_name": "user1792727", "link": "https://stackoverflow.com/users/1792727/user1792727"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 55942730, "answer_count": 1, "score": 0, "last_activity_date": 1556744917, "creation_date": 1556738867, "last_edit_date": 1556739191, "question_id": 55941605, "link": "https://stackoverflow.com/questions/55941605/failure-to-write-subsquent-compressed-data-to-an-output-file-in-c", "title": "Failure to write subsquent compressed data to an output file in C", "body": "<p>I am reading data from an input file and compressing it with bzip library function calls BZ2_bzCompress in C. I can compress the data successfully. But I cannot write all the compressed data to an output file. Only the first compressed line can be written. Am I missing something here.</p>\n\n<pre><code>int main()\n{\n    bz_stream bz;   \n    FILE*   f_d;\n    FILE* f_s;\n    BZFILE* b;  \n    int     bzerror = -10;  \n    unsigned int nbytes_in;\n    unsigned int nbytes_out;\n    char buf[3000] = {0};\n    int result = 0;\n    char buf_read[500];\n    char file_name[] = \"/path/file_name\";\n    long int save_pos;\n\n    f_d = fopen ( \"myfile.bz2\", \"wb+\" );    \n    f_s = fopen(file_name, \"r\");\n\n    if ((!f_d) &amp;&amp; (!f_s)) {\n\n        printf(\"Cannot open files\");\n        return(-1);\n    }\n\n    bz.opaque = NULL;\n    bz.bzalloc = NULL;\n    bz.bzfree = NULL;\n\n\n    result = BZ2_bzCompressInit(&amp;bz, 1, 2, 30); \n\n\n    while (fgets(buf_read, sizeof(buf_read), f_s) != NULL)\n    {       \n        bz.next_in = buf_read;\n        bz.avail_in = sizeof(buf_read);\n        bz.next_out = buf;\n        bz.avail_out = sizeof(buf);\n\n        printf(\"%s\\n\", buf_read);\n        save_pos = ftell(f_d);\n        fseek(f_d, save_pos, SEEK_SET);\n        while ((result == BZ_RUN_OK) || (result == 0) || (result ==  BZ_FINISH_OK))\n        {\n            result = BZ2_bzCompress(&amp;bz, (bz.avail_in) ? BZ_RUN : BZ_FINISH);                       \n\n            printf(\"2 result:%d,in:%d,outhi:%d, outlo:%d \\n\",result, bz.total_in_lo32, bz.total_out_hi32, bz.total_out_lo32);\n            fwrite(buf, 1, bz.total_out_lo32, f_d);         \n\n        }\n        if (result == BZ_STREAM_END)\n        {\n            result = BZ2_bzCompressEnd(&amp;bz);                    \n        }\n\n        printf(\"3 result:%d, out:%d\\n\", result, bz.total_out_lo32);\n        result = BZ2_bzCompressInit(&amp;bz, 1, 2, 30); \n        memset(buf, 0, sizeof(buf));\n    }   \n\n    fclose(f_d);\n    fclose(f_s);        \n    return(0);\n}\n</code></pre>\n"}, {"tags": ["ios", "c", "swift"], "comments": [{"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "edited": false, "score": 0, "creation_date": 1556739644, "post_id": 55941571, "comment_id": 98536711, "body": "I don&#39;t have time to look into this right now, but I just have to say that this is a really well written question."}], "answers": [{"tags": [], "owner": {"reputation": 486140, "user_id": 1187415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/LpTRB.png?s=128&g=1", "display_name": "Martin R", "link": "https://stackoverflow.com/users/1187415/martin-r"}, "is_accepted": true, "score": 5, "last_activity_date": 1556741143, "creation_date": 1556741143, "answer_id": 55942059, "question_id": 55941571, "link": "https://stackoverflow.com/questions/55941571/passing-a-swift-string-to-c/55942059#55942059", "title": "Passing a Swift string to C", "body": "<p>The Swift equivalent of <code>const char *</code> is <code>UnsafePointer&lt;CChar&gt;?</code>, so that's the correct return value. Then you have to think about memory management. One options is do allocate memory for the C string in the Swift function, and leave it to the caller to release the memory eventually:</p>\n\n<pre><code>public func mySwiftFunc(number: Int) -&gt; UnsafePointer&lt;CChar&gt;? {\n    print(\"Hello from Swift: \\(number)\")\n\n    let address = \"hello there\"\n    let newString = strdup(address)\n    return UnsafePointer(newString)\n}\n</code></pre>\n\n<p>passes a Swift string to <code>strdup()</code> so that a (temporary) C string representation is created automatically. This C string is then duplicated. The calling C function has to release that memory when it is no longer needed:</p>\n\n<pre><code>int blah() {\n    const char *retVal = mySwiftFunc(42);\n    printf(\"Hello from C: %s\\n\", retVal);\n    free((char *)retVal);\n    return 0;\n}\n</code></pre>\n\n<p><strong>\u26a0\ufe0f  BUT:</strong> Please note that there are more problems in your code:</p>\n\n<ul>\n<li><code>mySwiftFunc()</code> is an <em>instance method</em> of a class, and therefore has an implicit <code>self</code> argument, which is ignored by the calling C function. That might work by chance, or cause strange failures.</li>\n<li><code>@_silgen_name</code> should not be used outside of the Swift standard library, see <a href=\"https://forums.swift.org/t/should-anyone-be-using-silgen-name-outside-of-the-standard-library-developers/19396\" rel=\"noreferrer\">this discusssion</a> in the Swift forum.</li>\n<li>A slightly better alternative is <code>@_cdecl</code> but even that is not officially supported. <code>@_cdecl</code> can only be used with global functions.</li>\n<li>Generally, calling Swift functions directly from C is <em>not officially supported,</em> see <a href=\"https://forums.swift.org/t/best-way-to-call-a-swift-function-from-c/9829\" rel=\"noreferrer\">this discussion</a> in the Swift forum for the reasons and possible alternatives.</li>\n</ul>\n"}], "owner": {"reputation": 854, "user_id": 6362677, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13be8d12cbcbc70c36fc66f7321d300d?s=128&d=identicon&r=PG&f=1", "display_name": "Lou", "link": "https://stackoverflow.com/users/6362677/lou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 0, "accepted_answer_id": 55942059, "answer_count": 1, "score": 1, "last_activity_date": 1556741143, "creation_date": 1556738715, "last_edit_date": 1556739931, "question_id": 55941571, "link": "https://stackoverflow.com/questions/55941571/passing-a-swift-string-to-c", "title": "Passing a Swift string to C", "body": "<p>I am pretty new to Swift, and I don't have much exposure to C. </p>\n\n<p>I am trying to write a function in C that will get a Swift string that I can then do something with. The problem is that I'm not 100% sure what the type should be in Swift to make C like what it sees. </p>\n\n<p>So far, I have found several examples on Stack that seem like good starting points, but some examples seem dated for the current version of Swift. </p>\n\n<p>I first started by using this example to get C and Swift talking to one another: <a href=\"https://stackoverflow.com/questions/43672263/swift-call-c-call-swift\">Swift call C call Swift?</a> I then took that and tried updating the Swift function to return a string of some kind. I understand that it needs to be a UTF-8 return type, but I'm not sure how to go about sending things properly. I've looked at <a href=\"https://stackoverflow.com/questions/25378954/how-to-pass-a-swift-string-to-a-c-function\">How to pass a Swift string to a c function?</a>, <a href=\"https://stackoverflow.com/questions/25554986/how-to-convert-string-to-unsafepointeruint8-and-length\">How to convert String to UnsafePointer&lt;UInt8&gt; and length</a>, and <a href=\"https://stackoverflow.com/questions/37087325/how-to-convert-string-to-unicodeutf-8-string-in-swift\">How to convert string to unicode(UTF-8) string in Swift?</a>, but none of them really work for a solution. Or I'm just typing it in incorrectly. So far, the closest I can get to returning something is as follows.</p>\n\n<p>In Swift, my <code>ViewController</code> is:</p>\n\n<pre><code>import UIKit\n\nclass ViewController: UIViewController {\n\n    @_silgen_name(\"mySwiftFunc\") // give the function a C name\n    public func mySwiftFunc(number: Int) -&gt; [CChar]\n    {\n        print(\"Hello from Swift: \\(number)\")\n\n        let address: String = \"hello there\";\n        let newString = address.cString(using: String.Encoding.utf8)\n        return newString!\n    }\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n        // Do any additional setup after loading the view.\n\n        blah()\n\n    }\n}\n</code></pre>\n\n<p>And in C, the header is like:</p>\n\n<pre><code>#ifndef cfile_h\n#define cfile_h\n\n#include &lt;stdio.h&gt;\n\nconst char * mySwiftFunc(int);\nint blah(void);\n\n#endif /* cfile_h */\n</code></pre>\n\n<p>And the source is like:</p>\n\n<pre><code>#include \"cfile.h\"\n\nint blah() {\n\n    const char * retVal = mySwiftFunc(42); // call swift function\n    printf(\"Hello from C: %s\", retVal);\n\n    return 0;\n}\n</code></pre>\n\n<p>There is a bridging header file that just has <code>#include \"cfile.h\"</code>. Obviously, there is still a lot of remnants from the first example, and these will be cleaned up later. </p>\n\n<p>What needs to change to make this work? Right now, the console spits out </p>\n\n<pre><code>Hello from Swift: 42\nHello from C: (B\\214\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1556737724, "post_id": 55941295, "comment_id": 98535988, "body": "I would guess that you are overflowing <code>MACAddress</code>. Can&#39;t see where though. Anyway, remove the <code>&amp;</code> in front of it in <code>memset</code>."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1556737978, "post_id": 55941295, "comment_id": 98536086, "body": "Not sure if this will cause your fault, but notice the discrepancy between <code>memset(&amp;MACAddress, ...)</code> and <code>memcpy(MACAddress, ...)</code> where I would expect to see the same first argument. Also, it is unclear what your types are in the code, and so does <code>sizeof</code> give the size of what you think it is giving?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556738067, "post_id": 55941295, "comment_id": 98536111, "body": "@WeatherVane The types are the MS API ones"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1556738136, "post_id": 55941295, "comment_id": 98536133, "body": "@Eugene Sh. <code>memcpy</code> and <code>memset</code> should take <i>exactly the same</i> first argument."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556738177, "post_id": 55941295, "comment_id": 98536145, "body": "<code>memcpy(&amp;IpNetRow2.Address, &amp;ClientAddr, sizeof(SOCKADDR_IN));</code> looks suspicious."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556738204, "post_id": 55941295, "comment_id": 98536157, "body": "@WeatherVane This is what I said in the first comment"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1556738227, "post_id": 55941295, "comment_id": 98536163, "body": "@Eugene Sh. perhaps your edit was while I was typing."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1556738322, "post_id": 55941295, "comment_id": 98536200, "body": "I don&#39;t see any obvious issue here... Maybe a bigger snippet with the function call help"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1556738409, "post_id": 55941295, "comment_id": 98536229, "body": "What&#39;s <code>strMACAddress</code>?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556738641, "post_id": 55941295, "comment_id": 98536314, "body": "With <code>MACAddress</code> being an array, <code>&amp;MACAddress</code> and <code>MACAddress</code> evaluate to pointers to the same address, with different types.  Using both is poor form, but of little practical import since they are both converted to type <code>void *</code> in preparation for the function call anyway."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556738753, "post_id": 55941295, "comment_id": 98536352, "body": "Moreover, it is not useful to <code>memset()</code> the array contents before overwriting them (all) with <code>memcpy()</code>, though it&#39;s not actually harmful to do so."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556739748, "post_id": 55941295, "comment_id": 98536770, "body": "Not being able to find any issues with anything else, I am inclined to suspect that one of the winsock function calls, <code>GetIpNetEntry2(&amp;IpNetRow2)</code> or <code>ResolveIpNetEntry2(&amp;IpNetRow2, NULL)</code>, is writing out of bounds.  If so, that would more likely be because something is wrong with the arguments than because the functions are broken, but I&#39;ve dug about as much into this as I&#39;m prepared to do for the time being."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556739964, "post_id": 55941295, "comment_id": 98536876, "body": "... though there is the question of what <code>strMACAddress</code> is and whether it&#39;s large enough.  But even if there were an issue there, that does not appear likely to cause corruption of the function&#39;s stack frame."}, {"owner": {"reputation": 1, "user_id": 2665534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87b5fae0ae5b6a8472052f18d3439b66?s=128&d=identicon&r=PG&f=1", "display_name": "rqg0717", "link": "https://stackoverflow.com/users/2665534/rqg0717"}, "edited": false, "score": 0, "creation_date": 1556744318, "post_id": 55941295, "comment_id": 98538446, "body": "Thank you all for your comments. I have removed unnecessary variables, but I still get the same <code>Run-Time Check Failure #2</code>. <code>GetIpNetEntry2</code> function returns successfully. <code>nRet</code> is <code>NO_ERROR</code>. I am wondering if  it would be something wrong inside <code>GetIpNetEntry2</code> function. Please advise. Thank you."}, {"owner": {"reputation": 2449, "user_id": 500276, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/200bf76976f24add540182f5c3a42788?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Benningfield", "link": "https://stackoverflow.com/users/500276/mark-benningfield"}, "edited": false, "score": 0, "creation_date": 1556759602, "post_id": 55941295, "comment_id": 98541865, "body": "Verify that <code>dwBestIfIndex</code> has a valid, non-zero value before the call to <code>GetIpNetEntry2()</code>. I know it&#39;s supposed to return <code>ERROR_INVALID_PARAMETER</code> if it is, but past experience with Windows return values tells me to advise you the verify the inputs yourself."}, {"owner": {"reputation": 1, "user_id": 2665534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87b5fae0ae5b6a8472052f18d3439b66?s=128&d=identicon&r=PG&f=1", "display_name": "rqg0717", "link": "https://stackoverflow.com/users/2665534/rqg0717"}, "reply_to_user": {"reputation": 2449, "user_id": 500276, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/200bf76976f24add540182f5c3a42788?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Benningfield", "link": "https://stackoverflow.com/users/500276/mark-benningfield"}, "edited": false, "score": 0, "creation_date": 1556810071, "post_id": 55941295, "comment_id": 98562713, "body": "@MarkBenningfield Thank you for your advice. I have verified that `dwBestIfIndex&#39; is a valid value. BTW, someone stated that this code runs on WIndows 8.1 without the issue. I am using Windows 10 and Visual Studio 2017. I am not sure if the environment matters..."}, {"owner": {"reputation": 1, "user_id": 2665534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87b5fae0ae5b6a8472052f18d3439b66?s=128&d=identicon&r=PG&f=1", "display_name": "rqg0717", "link": "https://stackoverflow.com/users/2665534/rqg0717"}, "edited": false, "score": 0, "creation_date": 1556826452, "post_id": 55941295, "comment_id": 98570275, "body": "Thank you all for your help. I really appreciate it. Eventually I figured it out. It is not a code issue but a configuration issue. The Struct Member Alignment (Visual Studio Project Property -&gt; C/C++ -&gt; Code Generation) was set to 1 byte which caused the issue. I changed it back to &#39;Default&#39; then the exception is gone. Learned a lesson. Thank you."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 2665534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87b5fae0ae5b6a8472052f18d3439b66?s=128&d=identicon&r=PG&f=1", "display_name": "rqg0717", "link": "https://stackoverflow.com/users/2665534/rqg0717"}, "is_accepted": true, "score": 0, "last_activity_date": 1556826981, "creation_date": 1556826981, "answer_id": 55959380, "question_id": 55941295, "link": "https://stackoverflow.com/questions/55941295/debug-info-run-time-check-failure-2-stack-around-the-variable-ipnetrow2-wa/55959380#55959380", "title": "Debug Info: Run-Time Check Failure #2 - Stack around the variable &#39;IpNetRow2&#39; was corrupted", "body": "<p>Thank you all for your help. I really appreciate it. Eventually I figured it out. It is not a code issue but a configuration issue. The Struct Member Alignment (Visual Studio Project Property -> C/C++ -> Code Generation) was set to 1 byte which caused the issue. I changed it back to 'Default' then the exception is gone. Learned a lesson. Thank you.</p>\n"}], "owner": {"reputation": 1, "user_id": 2665534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87b5fae0ae5b6a8472052f18d3439b66?s=128&d=identicon&r=PG&f=1", "display_name": "rqg0717", "link": "https://stackoverflow.com/users/2665534/rqg0717"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 55959380, "answer_count": 1, "score": 0, "last_activity_date": 1557654031, "creation_date": 1556737406, "last_edit_date": 1557654031, "question_id": 55941295, "link": "https://stackoverflow.com/questions/55941295/debug-info-run-time-check-failure-2-stack-around-the-variable-ipnetrow2-wa", "title": "Debug Info: Run-Time Check Failure #2 - Stack around the variable &#39;IpNetRow2&#39; was corrupted", "body": "<p>I have been trying to use <em>GetIpNetEntry2</em> and <em>ResolveIpNetEntry2</em> functions to get MAC address from a IPv4 in Visual Studio 2017 (SDK 8.1) on Windows 10 (Enterprise 1803). I have been getting:</p>\n\n<blockquote>\n  <p>Run-Time Check Failure #2 - Stack around the variable 'IpNetRow2' was corrupted.</p>\n</blockquote>\n\n<p>by the end of the following function:</p>\n\n<pre><code>static int GetMacAddress(SOCKADDR_IN ClientAddr)\n{\n    MIB_IPNET_ROW2 IpNetRow2 = { 0 };\n    DWORD dwBestIfIndex = 0;\n    int nRet = -1;\n\n    // Retrieves the index of the interface that has the best route to the client IP address.\n    GetBestInterface(inet_addr(inet_ntoa(ClientAddr.sin_addr)), &amp;dwBestIfIndex);\n    // Finds MAC address from the local computer\n    IpNetRow2.InterfaceIndex = dwBestIfIndex;\n    IpNetRow2.Address.si_family = AF_INET;\n    IpNetRow2.Address.Ipv4.sin_addr.s_addr = ClientAddr.sin_addr.S_un.S_addr;\n\n    nRet = GetIpNetEntry2(&amp;IpNetRow2);\n    if (nRet != NO_ERROR)\n    {\n        // Could not find the MAC address in the cache, lets hit the wire.\n        nRet = ResolveIpNetEntry2(&amp;IpNetRow2, NULL);\n    }\n\n    return nRet;\n}\n</code></pre>\n\n<p>Returned results are valid with <code>nRet</code> = 0 and <code>dwBestIfIndex</code> = 22.\nI have searched as much as I can for a description of how to diagnose the issue; however I have not found any solution that is relevant. The code is so simple and I have on idea on what part of the code would cause such issue.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 0, "creation_date": 1556737132, "post_id": 55941209, "comment_id": 98535767, "body": "C and C++ are different languages, you can&#39;t implement everything from one language to the other"}, {"owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "edited": false, "score": 1, "creation_date": 1556737166, "post_id": 55941209, "comment_id": 98535787, "body": "C doesn&#39;t have such protection mechanism as C++."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 1, "creation_date": 1556737200, "post_id": 55941209, "comment_id": 98535794, "body": "return a pointer on a private structure. Noone can guess the size and copy it. you have to provide functions to access to &quot;members&quot; too then"}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 5, "creation_date": 1556737217, "post_id": 55941209, "comment_id": 98535799, "body": "I feel there&#39;s an ulterior motive to this question. Why do you think you need it? I ask because C code generally deals in different idioms."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556737318, "post_id": 55941209, "comment_id": 98535833, "body": "If you can&#39;t copy it, it won&#39;t even be readable, so what use is it, unless the module where it is defined provides an interface for those operations which you allow."}, {"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1556737513, "post_id": 55941209, "comment_id": 98535910, "body": "Totally different languages. Languages like C++ try to prevent the programmer from doing stupid things. C lets you do anything you want--it&#39;s up to the programmer not to do stupid things."}, {"owner": {"reputation": 439, "user_id": 11438511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41221888cd52d52320d8209a27e6126?s=128&d=identicon&r=PG&f=1", "display_name": "curlywei", "link": "https://stackoverflow.com/users/11438511/curlywei"}, "edited": false, "score": 0, "creation_date": 1556737531, "post_id": 55941209, "comment_id": 98535914, "body": "I tried to implement a singleton object in C. I think that this object is non-copyable struct."}, {"owner": {"reputation": 1028, "user_id": 2654470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09fdaef3f1f52aaf47067f1050b27013?s=128&d=identicon&r=PG", "display_name": "Spencer", "link": "https://stackoverflow.com/users/2654470/spencer"}, "edited": false, "score": 0, "creation_date": 1556737728, "post_id": 55941209, "comment_id": 98535990, "body": "@curlywei The <a href=\"https://en.wikipedia.org/wiki/Singleton_pattern\" rel=\"nofollow noreferrer\">singleton pattern</a> is a solution in search of a problem -- it&#39;s not so much a case of object design as much as controlling how many objects you create.  The answer is: Never make more than one in your code.  Use <code>static</code> if you have to."}, {"owner": {"reputation": 439, "user_id": 11438511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41221888cd52d52320d8209a27e6126?s=128&d=identicon&r=PG&f=1", "display_name": "curlywei", "link": "https://stackoverflow.com/users/11438511/curlywei"}, "reply_to_user": {"reputation": 1028, "user_id": 2654470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09fdaef3f1f52aaf47067f1050b27013?s=128&d=identicon&r=PG", "display_name": "Spencer", "link": "https://stackoverflow.com/users/2654470/spencer"}, "edited": false, "score": 0, "creation_date": 1556737855, "post_id": 55941209, "comment_id": 98536037, "body": "@Spencer thanks! I understand!"}, {"owner": {"reputation": 1028, "user_id": 2654470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09fdaef3f1f52aaf47067f1050b27013?s=128&d=identicon&r=PG", "display_name": "Spencer", "link": "https://stackoverflow.com/users/2654470/spencer"}, "edited": false, "score": 0, "creation_date": 1556738120, "post_id": 55941209, "comment_id": 98536128, "body": "@curlywei If you post a new question that asks for what you really want, then it may be possible to get an &quot;answer&quot; answer, or at least be linked to a more appropriate duplicate.  For example, <a href=\"https://stackoverflow.com/questions/8932707/what-are-anonymous-structs-and-unions-useful-for-in-c11\" title=\"what are anonymous structs and unions useful for in c11\">stackoverflow.com/questions/8932707/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26917, "user_id": 1892179, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/umfON.jpg?s=128&g=1", "display_name": "Theodoros Chatzigiannakis", "link": "https://stackoverflow.com/users/1892179/theodoros-chatzigiannakis"}, "is_accepted": true, "score": 4, "last_activity_date": 1556737725, "creation_date": 1556737725, "answer_id": 55941365, "question_id": 55941209, "link": "https://stackoverflow.com/questions/55941209/non-copyable-struct-in-c/55941365#55941365", "title": "Non-copyable struct in C?", "body": "<p>You can do this using <a href=\"https://stackoverflow.com/questions/7553750/what-is-an-opaque-pointer-in-c\">opaque pointers</a>. The idea is:</p>\n\n<ul>\n<li>You define a struct somewhere and you define all of its operations in terms of a pointer to that struct. That would probably be a standalone compilation unit.</li>\n<li>The consumers of your struct only get a declaration but not the full definition of that struct, which means that they don't know the layout or even the size of the struct. It follows that they are able to receive, store, and pass around any <em>pointers</em> to that struct, but not <em>values</em> of it.</li>\n</ul>\n"}], "owner": {"reputation": 439, "user_id": 11438511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41221888cd52d52320d8209a27e6126?s=128&d=identicon&r=PG&f=1", "display_name": "curlywei", "link": "https://stackoverflow.com/users/11438511/curlywei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "closed_date": 1556737718, "accepted_answer_id": 55941365, "answer_count": 1, "score": 0, "last_activity_date": 1556737725, "creation_date": 1556736941, "question_id": 55941209, "link": "https://stackoverflow.com/questions/55941209/non-copyable-struct-in-c", "closed_reason": "Duplicate", "title": "Non-copyable struct in C?", "body": "<p>After reading this page, I already know how to implement non-copyable \nclasses in C++.</p>\n\n<p>(<a href=\"https://stackoverflow.com/questions/2173746/how-do-i-make-this-c-object-non-copyable\">How do I make this C++ object non-copyable?</a>)</p>\n\n<p>Now I want implement non-copyable in C,</p>\n\n<p>But I don't find similar code in C.</p>\n\n<p>So I want to ask how to implement in C.</p>\n"}, {"tags": ["c", "memory", "memory-management", "x86", "operating-system"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 3, "creation_date": 1556735407, "post_id": 55940833, "comment_id": 98535066, "body": "Nowadays, the lowest level is a <a href=\"https://en.wikipedia.org/wiki/Virtual_memory\" rel=\"nofollow noreferrer\">virtual memory manager</a>."}, {"owner": {"reputation": 1060, "user_id": 60694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cca9a181914a4b975f99766275db7788?s=128&d=identicon&r=PG", "display_name": "Chris White", "link": "https://stackoverflow.com/users/60694/chris-white"}, "edited": false, "score": 1, "creation_date": 1556735559, "post_id": 55940833, "comment_id": 98535122, "body": "This might help some: <a href=\"https://manybutfinite.com/post/anatomy-of-a-program-in-memory/\" rel=\"nofollow noreferrer\">manybutfinite.com/post/anatomy-of-a-program-in-memory</a>"}, {"owner": {"reputation": 99, "user_id": 6452332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jBTRu.jpg?s=128&g=1", "display_name": "AaronV77", "link": "https://stackoverflow.com/users/6452332/aaronv77"}, "edited": false, "score": 0, "creation_date": 1556735607, "post_id": 55940833, "comment_id": 98535140, "body": "I wanted to implement this before I start paging."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1556736854, "post_id": 55940833, "comment_id": 98535643, "body": "Please note that <code>char * ptr = malloc(5); printf(&quot;The memory address for this pointer is at: %d\\n&quot;, &amp;ptr);</code> is incorrect for two reasons: the wrong format specifier, and it is passing the location of the pointer, not its value. It should be <code>printf(&quot;%p\\n&quot;, (void*)ptr);</code>"}, {"owner": {"reputation": 99, "user_id": 6452332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jBTRu.jpg?s=128&g=1", "display_name": "AaronV77", "link": "https://stackoverflow.com/users/6452332/aaronv77"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556737373, "post_id": 55940833, "comment_id": 98535859, "body": "@WeatherVane Thank you so much, I didn&#39;t think I was doing it incorrectly, you basically answered my question. Thanks."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1556737535, "post_id": 55940833, "comment_id": 98535916, "body": "In some systems you might &quot;get away with&quot; using the wrong format specifier, but, as is often the case, if <code>int*</code> takes 8 bytes and <code>int</code> takes 4 bytes, you won&#39;t be reporting the correct address."}], "answers": [{"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1556765764, "post_id": 55941163, "comment_id": 98542914, "body": "On POSIX OSes, <code>malloc</code> implementations typically use <code>mmap(MAP_ANONYMOUS)</code> and/or <code>brk()</code> / <code>sbrk()</code> to get fresh pages from the kernel (glibc uses <code>brk</code> for small allocations, <code>mmap</code> for large ones so it can always return the memory to the kernel on <code>free</code> instead of having a huge allocation on the user-space free list).  On Windows, <code>VirtualAlloc()</code>."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 5, "last_activity_date": 1556736702, "creation_date": 1556736702, "answer_id": 55941163, "question_id": 55940833, "link": "https://stackoverflow.com/questions/55940833/how-does-memory-allocation-happen-at-the-lowest-level-in-an-operating-system/55941163#55941163", "title": "How does memory allocation happen at the lowest level in an operating system?", "body": "<blockquote>\n  <p>I'm trying to figure out how memory is allocated at the lowest level\n  in an operating system. From what I can gather is that the operating\n  system is just doing the book keeping of the memory that is available\n  and not available, and it is the C programming language that will do\n  the allocation at the lowest level.</p>\n</blockquote>\n\n<p>The OS certainly does do bookkeeping for what memory is available and what not, but putting it in those terms vastly oversimplifies, and I suspect you have a different idea of what \"memory\" means here than best fits.</p>\n\n<p>The OS's virtual memory management subsystem manages how physical memory and other storage resources, such as disk-based swap space, are mapped to each process's virtual address space, including <em>how much</em> and which parts of a process's virtual address space maps to usable memory.  It serves requests to increase and decrease a process's available virtual memory, as well as explicit requests to create memory mappings, such as those based on ordinary files.</p>\n\n<p>As far as servicing <code>malloc()</code> calls in a userspace program, you are more or less correct.  Programs generally obtain memory from the OS in sizeable blocks, which <code>malloc()</code>, <code>free()</code>, and friends carve up and manage.  Typically, those details involve the kernel only when the process fills up the memory already available to it, and needs to request more from the kernel.</p>\n\n<p>But the lowest level is definitely in the kernel.  The C library's memory-management functions can work only with memory allocated to the process by the OS.</p>\n\n<blockquote>\n  <p>From both examples I expected memory that I allocated from malloc()\n  would have the same starting address as to where I allocated it at, if\n  that makes sense? If I know the end of my kernel is at the 0x9000\n  mark, and I want to start allocating memory at the 1 MB mark. Yes, I\n  know where my kernel is in memory is weird and not conventional, but I\n  know that memory is free past the 1 MB mark.</p>\n</blockquote>\n\n<p>The kernel's view of memory is different from userspace processes'.  Each process runs in its own virtual address space, without any visibility into which <em>physical</em> addresses it is using.</p>\n"}, {"tags": [], "owner": {"reputation": 18530, "user_id": 3344003, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/988af95d5692ee66b1fc2fe725ba738e?s=128&d=identicon&r=PG&f=1", "display_name": "user3344003", "link": "https://stackoverflow.com/users/3344003/user3344003"}, "is_accepted": false, "score": 1, "last_activity_date": 1556813169, "creation_date": 1556813169, "answer_id": 55956322, "question_id": 55940833, "link": "https://stackoverflow.com/questions/55940833/how-does-memory-allocation-happen-at-the-lowest-level-in-an-operating-system/55956322#55956322", "title": "How does memory allocation happen at the lowest level in an operating system?", "body": "<blockquote>\n  <p>I'm trying to figure out how memory is allocated at the lowest level in an operating system.</p>\n</blockquote>\n\n<p>Your problem is that you are not looking at how the operating system allocates memory. You are looking at application level memory allocation.</p>\n\n<p>For processes, the operating system only allocates memory in PAGES. A process gains more memory by calling a system service that maps more pages into the process address (ie makes more pages valid).</p>\n\n<p>Because applications usually need memory allocations smaller than a page (for things like strings), heap management functions are often used. malloc and free are rarely (if ever) operating system services.The are simply functions that can allocate memory in increments smaller than a page.</p>\n\n<p>Typically, a call to malloc results in the function trying to find a block of memory large enough to return to the caller. If such a block is not available, malloc will call the operating system service to map pages into the address space to increase the amount of available memory in the heap so that it can return a large enough block of memory.</p>\n"}], "owner": {"reputation": 99, "user_id": 6452332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jBTRu.jpg?s=128&g=1", "display_name": "AaronV77", "link": "https://stackoverflow.com/users/6452332/aaronv77"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1556813169, "creation_date": 1556735052, "last_edit_date": 1556765591, "question_id": 55940833, "link": "https://stackoverflow.com/questions/55940833/how-does-memory-allocation-happen-at-the-lowest-level-in-an-operating-system", "title": "How does memory allocation happen at the lowest level in an operating system?", "body": "<p>I'm trying to figure out how memory is allocated at the lowest level in an operating system. From what I can gather is that the operating system is just doing the book keeping of the memory that is available and not available, and it is the C programming language that will do the allocation at the lowest level. </p>\n\n<p>So, the first example is what I came up with as a simple memory allocation system, and then I took an example from the following resource: <a href=\"https://github.com/levex/osdev\" rel=\"nofollow noreferrer\">https://github.com/levex/osdev</a>. </p>\n\n<p>Example-1:</p>\n\n<pre><code>    struct heap_elements {\n        int start_address;\n        int end_address;\n        int size;\n        int reservation;\n    };\n\n    struct heap_elements heap[25];\n\n    // Write len copies of val into dest.\n    void memset(int *dest, int val, int len)\n    {\n        int *temp = (int *)dest;\n        for ( ; len != 0; len--) *temp++ = val;\n    }\n\n    /*\n    * This function will take a source and destination and copy n amount\n    * - of bytes from the source to the destination address. \n    */ \n    void memory_copy(unsigned char *source, unsigned char *destination, int bytes) {\n        for (int i = 0; i &lt; bytes; i++) {\n            *(destination + i) = *(source + i);\n        }\n    }\n\n    int find_memory_hole(int size) {\n\n        for (int i = 0; i &lt; total_elements; i++) {\n            if (heap[i].reservation == 0) {\n                if (heap[i].size &gt;= size || heap[i].size == 0) {\n                return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n    int * malloc(int size) {   \n        int hole = find_memory_hole(size);\n        if (hole != -1) {\n            if (heap[hole].start_address == 0) {\n                heap[hole].start_address = ending_address;\n                ending_address += size;\n                heap[hole].end_address = ending_address;\n                heap[hole].size = size;\n                heap[hole].reservation = 1;\n                kprintf(\"Starting address: %d\\n\", heap[hole].start_address);\n                kprintf(\"Ending address: %d\\n\", heap[hole].end_address);\n            } else {\n                heap[hole].size = size;\n                heap[hole].reservation = 1;\n            }\n            memset((int*)heap[hole].start_address, 0, size);\n            return (int*)heap[hole].start_address;\n        } else {\n            kprintf(\"FREE SOME MEMORY~!\\n\");\n            kprintf(\"WE NEED ROOM IN HERE~!\\n\");\n            return 0;\n        }\n    }\n\n    void heap_install() {\n        total_elements = 25;\n        starting_address = 0x100000;  // 1 - MB\n        ending_address = 0x100000;    // 1 - MB\n        max_memory_address = 0xEEE00000;  // 4 - GB\n\n        for (int i = 0; i &lt; total_elements; i++) {\n            heap[i].start_address = 0;\n            heap[i].end_address = 0;\n            heap[i].size = 0;\n            heap[i].reservation = 0;\n        }\n\n        return;\n    }\n\n    void free(void * pointer) {\n\n        int memory_found = 0;\n        kprintf(\"Address %d\\n\", &amp;pointer);\n        int memory_address = &amp;pointer;\n\n        for (int i = 0; i &lt; total_elements; i++) {\n            if (heap[i].start_address == memory_address) {\n                heap[i].size = 0;\n                heap[i].reservation = 0;\n                memory_found = 1;\n                break;\n            }\n        }\n\n        if (memory_found == 0)\n            kprintf(\"Memory could not bee free'd (NOT FOUND).\\n\");\n\n        return;\n    }\n</code></pre>\n\n<p>Example-2:</p>\n\n<pre><code>    void mm_init(unsigned kernel_end)\n    {\n        kprintf(\"The kernel end is: %d\\n\", kernel_end);\n        last_alloc = kernel_end + 0x1000;   // Set our starting point.\n        heap_begin = last_alloc;\n        heap_end = 0x5B8D80;                // Set the bar to 6 MB\n        memset((char *)heap_begin, 0, heap_end - heap_begin);\n    }\n\n    void mm_print_out()\n    {\n        kprintf(\"Memory used: %d bytes\\n\", memory_used);\n        kprintf(\"Memory free: %d bytes\\n\", heap_end - heap_begin - memory_used);\n        kprintf(\"Heap size: %d bytes\\n\", heap_end - heap_begin);\n        kprintf(\"Heap start: 0x%x\\n\", heap_begin);\n        kprintf(\"Heap end: 0x%x\\n\", heap_end);\n    }\n\n    void free(void *mem)\n    {\n        alloc_t *alloc = (mem - sizeof(alloc_t));\n        memory_used -= alloc-&gt;size + sizeof(alloc_t);\n        alloc-&gt;status = 0;\n    }\n\n    char* malloc(unsigned size)\n    {\n        if(!size) return 0;\n\n        /* Loop through blocks and find a block sized the same or bigger */\n        unsigned char *mem = (unsigned char *)heap_begin;\n        while((unsigned)mem &lt; last_alloc)\n        {\n            alloc_t *a = (alloc_t *)mem;\n            /* If the alloc has no size, we have reaced the end of allocation */\n\n            if(!a-&gt;size)\n                goto nalloc;\n            /* If the alloc has a status of 1 (allocated), then add its size\n            * and the sizeof alloc_t to the memory and continue looking.\n            */\n            if(a-&gt;status) {\n                mem += a-&gt;size;\n                mem += sizeof(alloc_t);\n                mem += 4;\n                continue;\n            }\n            /* If the is not allocated, and its size is bigger or equal to the\n            * requested size, then adjust its size, set status and return the location.\n            */\n            if(a-&gt;size &gt;= size)\n            {\n                /* Set to allocated */\n                a-&gt;status = 1;\n                memset(mem + sizeof(alloc_t), 0, size);\n                memory_used += size + sizeof(alloc_t);\n                return (char *)(mem + sizeof(alloc_t));\n            }\n            /* If it isn't allocated, but the size is not good, then\n            * add its size and the sizeof alloc_t to the pointer and\n            * continue;\n            */\n            mem += a-&gt;size;\n            mem += sizeof(alloc_t);\n            mem += 4;\n        }\n\n        nalloc:;\n        if(last_alloc+size+sizeof(alloc_t) &gt;= heap_end)\n        {\n            panic(\"From Memory.c\", \"Something\", 0);\n        }\n        alloc_t *alloc = (alloc_t *)last_alloc;\n        alloc-&gt;status = 1;\n        alloc-&gt;size = size;\n\n        last_alloc += size;\n        last_alloc += sizeof(alloc_t);\n        last_alloc += 4;\n\n        memory_used += size + 4 + sizeof(alloc_t);\n        memset((char *)((unsigned)alloc + sizeof(alloc_t)), 0, size);\n        return (char *)((unsigned)alloc + sizeof(alloc_t));\n\n    }\n</code></pre>\n\n<p>From both examples I expected memory that I allocated from malloc() would have the same starting address as to where I allocated it at, if that makes sense? If I know the end of my kernel is at the 0x9000 mark, and I want to start allocating memory at the 1 MB mark. Yes, I know where my kernel is in memory is weird and not conventional, but I know that memory is free past the 1 MB mark.</p>\n\n<p>So, if I know the following:</p>\n\n<pre><code>kernel_end = 0x9000;\nheap_starts = 0x100000;\nheap_ends = 0x5B8D80;\n</code></pre>\n\n<p>I would expect that this:</p>\n\n<pre><code>char * ptr = malloc(5)\n\nprintf(\"The memory address for this pointer is at: %d\\n\", &amp;ptr);\n</code></pre>\n\n<p>Would be near the 0x100000 memory address but it is not. It is some where completely different and is the reason why I think that I'm not physically telling where the char pointer to be at in memory and that it is the C programming language putting it somewhere differently. I can't figure out what I am doing wrong and it shouldn't be this hard to understand this. Also, I have looked in OSDev Wiki and haven't found anything.</p>\n"}, {"tags": ["c", "avr", "strcmp", "atmel"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1556735042, "post_id": 55940811, "comment_id": 98534927, "body": "What&#39;s the <i>exact error message</i> you get when compiling this? Did you <code>#include</code> the header for <code>strcmp</code>?"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 1, "creation_date": 1556735230, "post_id": 55940811, "comment_id": 98534998, "body": "<code>*parsedCommand -&gt;address</code> --&gt; <code>parsedCommand-&gt;address</code>"}, {"owner": {"reputation": 69, "user_id": 5950255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d914f859e34a8e32968c0cc1e4790843?s=128&d=identicon&r=PG&f=1", "display_name": "lgabryel", "link": "https://stackoverflow.com/users/5950255/lgabryel"}, "edited": false, "score": 0, "creation_date": 1556735271, "post_id": 55940811, "comment_id": 98535018, "body": "Error <code>dereferencing pointer to incomplete type</code>. I include <code>stdlib.h</code> and <code>stdio.h</code>. In WIn32 Target compile ok."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1556735566, "post_id": 55940811, "comment_id": 98535124, "body": "How is <code>ADRES</code> defined?"}, {"owner": {"reputation": 69, "user_id": 5950255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d914f859e34a8e32968c0cc1e4790843?s=128&d=identicon&r=PG&f=1", "display_name": "lgabryel", "link": "https://stackoverflow.com/users/5950255/lgabryel"}, "edited": false, "score": 0, "creation_date": 1556735820, "post_id": 55940811, "comment_id": 98535226, "body": "<code>char ADRES[] = &quot;123&quot;;</code>"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1556738492, "post_id": 55940811, "comment_id": 98536266, "body": "you are going to have to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 5950255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d914f859e34a8e32968c0cc1e4790843?s=128&d=identicon&r=PG&f=1", "display_name": "lgabryel", "link": "https://stackoverflow.com/users/5950255/lgabryel"}, "edited": false, "score": 0, "creation_date": 1556735573, "post_id": 55940873, "comment_id": 98535129, "body": "This not work. I use Atmel Avr Toolchain to compile hec for atmega microprocessors."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 69, "user_id": 5950255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d914f859e34a8e32968c0cc1e4790843?s=128&d=identicon&r=PG&f=1", "display_name": "lgabryel", "link": "https://stackoverflow.com/users/5950255/lgabryel"}, "edited": false, "score": 0, "creation_date": 1556735763, "post_id": 55940873, "comment_id": 98535197, "body": "@lgabryel I do not understand your objection to this answer.  What about it does not work as a result using the Atmel Avr Toolchain?"}, {"owner": {"reputation": 69, "user_id": 5950255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d914f859e34a8e32968c0cc1e4790843?s=128&d=identicon&r=PG&f=1", "display_name": "lgabryel", "link": "https://stackoverflow.com/users/5950255/lgabryel"}, "edited": false, "score": 0, "creation_date": 1556735875, "post_id": 55940873, "comment_id": 98535247, "body": "I change code as you advise and I have this same compile error."}, {"owner": {"reputation": 478, "user_id": 10344058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3207ec849f10bb519e1e1ab04336ad18?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Marshall", "link": "https://stackoverflow.com/users/10344058/tyler-marshall"}, "edited": false, "score": 0, "creation_date": 1556736276, "post_id": 55940873, "comment_id": 98535403, "body": "Does the compiler give you a line number? There&#39;s nothing wrong with <code>strcmp</code>. The compiler is complaining about use of the struct. Not sure why it could complain about the dereference because you declared it with <code>struct Command</code>"}, {"owner": {"reputation": 69, "user_id": 5950255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d914f859e34a8e32968c0cc1e4790843?s=128&d=identicon&r=PG&f=1", "display_name": "lgabryel", "link": "https://stackoverflow.com/users/5950255/lgabryel"}, "edited": false, "score": 0, "creation_date": 1556736944, "post_id": 55940873, "comment_id": 98535697, "body": "Compile give line of <code>if(strcmp(ADRES, *parsedCommand -&gt;address) == 0)</code>"}], "tags": [], "owner": {"reputation": 478, "user_id": 10344058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3207ec849f10bb519e1e1ab04336ad18?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Marshall", "link": "https://stackoverflow.com/users/10344058/tyler-marshall"}, "is_accepted": false, "score": 1, "last_activity_date": 1556735259, "creation_date": 1556735259, "answer_id": 55940873, "question_id": 55940811, "link": "https://stackoverflow.com/questions/55940811/dereferencing-pointer-to-incomplete-type-error-using-strcmp/55940873#55940873", "title": "dereferencing pointer to incomplete type error using strcmp", "body": "<p>The issue is that you are both dereferencing <code>parsedCommand</code> and using the arrow notation to access the address.</p>\n\n<p>Change</p>\n\n<pre><code>*parsedCommand -&gt;address\n</code></pre>\n\n<p>to either</p>\n\n<pre><code>parsedCommand-&gt;address\n</code></pre>\n\n<p>or</p>\n\n<pre><code>(*parsedCommand).address\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 69, "user_id": 5950255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d914f859e34a8e32968c0cc1e4790843?s=128&d=identicon&r=PG&f=1", "display_name": "lgabryel", "link": "https://stackoverflow.com/users/5950255/lgabryel"}, "is_accepted": true, "score": 0, "last_activity_date": 1557173822, "last_edit_date": 1557173822, "creation_date": 1556739415, "answer_id": 55941716, "question_id": 55940811, "link": "https://stackoverflow.com/questions/55940811/dereferencing-pointer-to-incomplete-type-error-using-strcmp/55941716#55941716", "title": "dereferencing pointer to incomplete type error using strcmp", "body": "<p>I was not including the definition of the Command strucutre. When I include the definition of the structure, all is fine.</p>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 11145698, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Uc1is-_2Ghk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcKVzoympboZkk5Q3y2tXILzSLWeg/mo/photo.jpg?sz=128", "display_name": "Martin Wanvik", "link": "https://stackoverflow.com/users/11145698/martin-wanvik"}, "is_accepted": false, "score": 1, "last_activity_date": 1556740037, "creation_date": 1556740037, "answer_id": 55941841, "question_id": 55940811, "link": "https://stackoverflow.com/questions/55940811/dereferencing-pointer-to-incomplete-type-error-using-strcmp/55941841#55941841", "title": "dereferencing pointer to incomplete type error using strcmp", "body": "<p><em>I lack the requisite reputation to comment, so I'll temporarily post this as an answer and then delete/edit as appropriate.</em> I suspect that your brief code listing leaves out some information about where the structure is declared and where the problematic code resides. Are they in the same file, or different files? Which files include which other files? Why do I want to know? Because the following code will give you a similar compilation error: </p>\n\n<pre><code>parsecmd.c:\n\n#include &lt;stdlib.h&gt;\n\nstruct command {\n    char *addr;\n    char *cmd;\n};\n\nstruct command *\nparse_command(char *str)\n{\n    struct command *ret = malloc(sizeof *ret);\n    if (ret == 0) return 0;\n    ret-&gt;addr = ....\n    ret-&gt;cmd = ....\n    return ret;\n}\n\n</code></pre>\n\n<pre><code>main.c:\n\n#include &lt;string.h&gt;\n\nstruct command *parse_command(char *str);\n\nint\nmain(void)\n{\n    ...\n    struct command *cmd = parse_command(pcmd);\n\n    if (cmd != 0) {\n        if (strcmp(address, cmd-&gt;addr) == 0) ... \n    }     \n}\n\n</code></pre>\n\n<p>When compiling <code>main.c</code>, the compiler isn't aware of any complete declaration of the structure, which is why it is called an incomplete type. It also has no idea about what fields the structure has (or even its size), so it doesn't know what to make of the expression <code>cmd-&gt;addr</code>. </p>\n\n<p>Does this apply to you, or have I completely missed the mark here? If so, moving the complete struct declaration into a header file which is included both in all source files that use the structure should fix the problem.</p>\n"}], "owner": {"reputation": 69, "user_id": 5950255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d914f859e34a8e32968c0cc1e4790843?s=128&d=identicon&r=PG&f=1", "display_name": "lgabryel", "link": "https://stackoverflow.com/users/5950255/lgabryel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "closed_date": 1557173833, "accepted_answer_id": 55941716, "answer_count": 3, "score": -1, "last_activity_date": 1557173822, "creation_date": 1556734963, "last_edit_date": 1556735418, "question_id": 55940811, "link": "https://stackoverflow.com/questions/55940811/dereferencing-pointer-to-incomplete-type-error-using-strcmp", "closed_reason": "Not suitable for this site", "title": "dereferencing pointer to incomplete type error using strcmp", "body": "<p>I try to use strcmp. In Win32 C project all work, byt when I try compile this code in Eclipse Mars Atmel Avr Toolchain, then fail compile. </p>\n\n<p>compile error in use of strcmp: </p>\n\n<blockquote>\n  <p>dereferencing pointer to incomplete type   </p>\n</blockquote>\n\n<pre><code>struct Command{\n    char* address;\n    char* cmd; \n };\n\n struct Command* parsedCommand = ParseCommand(PCmd); //PCmd - char* \n if(parsedCommand != NULL)\n {\n     if(strcmp(ADRES, *parsedCommand -&gt;address) == 0)\n</code></pre>\n"}, {"tags": ["c", "pointers", "struct"], "comments": [{"owner": {"reputation": 1056, "user_id": 4319483, "user_type": "registered", "profile_image": "https://graph.facebook.com/668992100/picture?type=large", "display_name": "Bjorn A.", "link": "https://stackoverflow.com/users/4319483/bjorn-a"}, "edited": false, "score": 1, "creation_date": 1556733461, "post_id": 55940490, "comment_id": 98534277, "body": "userin is a char, not a string. strcmp() will most likely fail with &amp;userin as arg"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1556733466, "post_id": 55940490, "comment_id": 98534278, "body": "&quot;Just doesn&#39;t work&quot; just isn&#39;t informative.  Does your program fail to compile (with what diagnostic)?  Does it fail at runtime (with what specific observable behavior)?"}, {"owner": {"reputation": 41, "user_id": 10601256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IVzkA.jpg?s=128&g=1", "display_name": "MichaelP", "link": "https://stackoverflow.com/users/10601256/michaelp"}, "edited": false, "score": 0, "creation_date": 1556733746, "post_id": 55940490, "comment_id": 98534415, "body": "the program compiles. it just ignores the function call, so I am guessing the call doesn&#39;t work. i can&#39;t use debug mode, as it isn&#39;t supported in CLion with Visual Studio. so I have exactly zero information as to why it won&#39;t work. all I can see is that it doesn&#39;t."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556733760, "post_id": 55940490, "comment_id": 98534423, "body": "why the <i>name</i> given in argument is not the one you want to search on ? initialize <i>name</i> out of <i>search</i> seems more logical. Note also <i>search</i> always returns 0, it must return the index in the array of contact, else for instance -1 no ?"}, {"owner": {"reputation": 41, "user_id": 10601256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IVzkA.jpg?s=128&g=1", "display_name": "MichaelP", "link": "https://stackoverflow.com/users/10601256/michaelp"}, "edited": false, "score": 0, "creation_date": 1556733858, "post_id": 55940490, "comment_id": 98534459, "body": "Bjorn A. thank you. but as there are no error messages, I guess that something else must be the problem regarding why the function call is completely ignored. but I will use your input and try to fix the problem with strcmp()&#39;s argument."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1556733887, "post_id": 55940490, "comment_id": 98534468, "body": "If the program in fact does not call the function, then the problem is in the code you have omitted, where the call appears.  Please present a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that reproduces the issue, not merely a selection of excerpts that you think relevant."}, {"owner": {"reputation": 41, "user_id": 10601256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IVzkA.jpg?s=128&g=1", "display_name": "MichaelP", "link": "https://stackoverflow.com/users/10601256/michaelp"}, "edited": false, "score": 0, "creation_date": 1556734097, "post_id": 55940490, "comment_id": 98534558, "body": "bruno return 0 is needed to know if everything went as expected. it doesn&#39;t return 0 alone, if it works as supposed, it should print out the entry and then return 0, so that I know everything worked out. as for <code>name</code> I am trying to access array <code>contacts</code> where all the information from the struct are saved. so I should be able to type in &quot;Arnold&quot; and find the contact.name which is &quot;Arnold&quot; and then print out the rest of Arnold&#39;s information."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1556734516, "post_id": 55940490, "comment_id": 98534718, "body": "@MichaelPrammer, I believe bruno&#39;s point is that your search function, as presented, never returns any value other than zero, so its return value does not convey any actionable information to the caller.  In particular, it does not tell you whether <i>anything</i> worked out, because 0 is returned either way.  If indeed you do not intend ever to return a different value, then it would be cleaner to declare the function to return nothing (<code>void</code>), and to not return any value at all."}, {"owner": {"reputation": 41, "user_id": 10601256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IVzkA.jpg?s=128&g=1", "display_name": "MichaelP", "link": "https://stackoverflow.com/users/10601256/michaelp"}, "edited": false, "score": 0, "creation_date": 1556734754, "post_id": 55940490, "comment_id": 98534814, "body": "The &quot;Minimal, Complete, and Verifiable&quot; essence is that I don&#39;t know what I am doing wrong. I thought I kinda understood C but it seems that I don&#39;t. No matter where I put the function call - which, by the way, looks something like &#180;search();&#180; with params for name, contacts, and size, - it is just ignored. As is probably the rest of the search function which seems to be full of holes too. So maybe it&#39;s a scope thing. But I&#39;ll dig into that myself, as the only thing I can count on here seems to be snide remarks and downvotes."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556745469, "post_id": 55940490, "comment_id": 98538846, "body": "First solve the problem with <code>char userin</code> and then update the question. It&#39;s vital to the function, I think."}], "answers": [{"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1556733708, "post_id": 55940521, "comment_id": 98534399, "body": "Moreover, <code>userin</code> seems unlikely to be what the OP wants to compare to in the first place.  It seems likely that they actually want <code>strcmp(contacts[i].name, name)</code>."}, {"owner": {"reputation": 41, "user_id": 10601256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IVzkA.jpg?s=128&g=1", "display_name": "MichaelP", "link": "https://stackoverflow.com/users/10601256/michaelp"}, "edited": false, "score": 1, "creation_date": 1556735034, "post_id": 55940521, "comment_id": 98534922, "body": "ok. it seems that my search function is crap. that doesn&#39;t surprise me though as I am a programming novice at best. but CLion doesn&#39;t complain and just compiles. so probably the scope is broken and that&#39;s why my function call is lost to the void too. so I&#39;ll just check this as the answer and we can all focus on something else."}], "tags": [], "owner": {"reputation": 35932, "user_id": 1606345, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/IwiIM.png?s=128&g=1", "display_name": "David Ranieri", "link": "https://stackoverflow.com/users/1606345/david-ranieri"}, "is_accepted": true, "score": 4, "last_activity_date": 1556734295, "last_edit_date": 1556734295, "creation_date": 1556733466, "answer_id": 55940521, "question_id": 55940490, "link": "https://stackoverflow.com/questions/55940490/dont-know-how-to-call-function/55940521#55940521", "title": "Don&#39;t know how to call function", "body": "<pre><code>char userin = scanf(\"%s\", name);\n\n    for(i = 0; i &lt; size; i++)\n    {\n        if (strcmp(contacts[i].name, &amp;userin) == 0)\n</code></pre>\n\n<p>You can not use <code>strcmp</code> with a <code>char</code>, <code>userin</code> must be a NUL terminated array of <code>char</code>s</p>\n\n<p>And as pointed out by @JohnBollinger in comments, it seems you want to compare the <code>name</code>, not the result of <code>scanf</code></p>\n"}], "owner": {"reputation": 41, "user_id": 10601256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IVzkA.jpg?s=128&g=1", "display_name": "MichaelP", "link": "https://stackoverflow.com/users/10601256/michaelp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 55940521, "answer_count": 1, "score": -1, "last_activity_date": 1556734295, "creation_date": 1556733266, "question_id": 55940490, "link": "https://stackoverflow.com/questions/55940490/dont-know-how-to-call-function", "title": "Don&#39;t know how to call function", "body": "<p>I am writing a search function in C which uses pointers and structs. Search is possible by name using an array called <code>contatcs</code> with ten entries. The array has already been initialized and populated and works as intended.</p>\n\n<p>I have tried to fix the problem by restructuring my code, but it only made matters worse. Maybe there is some flaw in the design logic that I cannot find.</p>\n\n<pre><code>typedef struct\n{\n    char streetname[150];\n    char city[50];\n    int zipcode;\n}address;\n\ntypedef struct\n{\n    char name[50];\n    int age;\n    address homeaddress;\n}person;\n\nint search (char* name, person *contacts, int size);\n\n[...] // initialization and population of array omitted\n\nint search (char *name, person *contacts, int size)\n{\n    int i;\n    printf(\"Input name: \");\n    char userin = scanf(\"%s\", name);\n\n    for(i = 0; i &lt; size; i++)\n    {\n        if (strcmp(contacts[i].name, &amp;userin) == 0)\n        {\n            printf(\"Name: %s;\", contacts[i].name);\n            printf(\" Age: %d;\", contacts[i].age);\n            printf(\" Adress: %s, \", contacts[i].homeaddress.streetname);\n            printf(\"%s, \", contacts[i].homeaddress.city);\n            printf(\"%d\\n\", contacts[i].homeaddress.zipcode);\n        }\n    }\n    return 0;\n}\n</code></pre>\n\n<p>I am just trying to call the function. But every time I try to do so, it just doesn't work. I know this question is rather basic, but I can't seem to find the solution.</p>\n"}, {"tags": ["c", "multithreading", "pthreads"], "comments": [{"owner": {"reputation": 56858, "user_id": 131930, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91536fe27d32713b8a154a0bf42f6748?s=128&d=identicon&r=PG", "display_name": "Jeremy Friesner", "link": "https://stackoverflow.com/users/131930/jeremy-friesner"}, "edited": false, "score": 0, "creation_date": 1556733422, "post_id": 55940432, "comment_id": 98534259, "body": "Since C uses 0-based array-indexing, I&#39;m 99.999% positive your for-loops should be of the form <code>for (int i=0; i&lt;threadNum; i++)</code> and not <code>for (int i=1; i&lt;=threadNum; i++)</code>"}, {"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "reply_to_user": {"reputation": 56858, "user_id": 131930, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91536fe27d32713b8a154a0bf42f6748?s=128&d=identicon&r=PG", "display_name": "Jeremy Friesner", "link": "https://stackoverflow.com/users/131930/jeremy-friesner"}, "edited": false, "score": 0, "creation_date": 1556733534, "post_id": 55940432, "comment_id": 98534310, "body": "@JeremyFriesner Yes I initially had it as you described, but one thing I tried was dividing <code>sizeOfAllFiles</code> by <code>threadNum</code> so, by starting at zero, I got a floating point exception. Hence, the starting at one."}, {"owner": {"reputation": 1098, "user_id": 6694684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a3b34689f308f4a92ad3002622bd6d3?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin J.", "link": "https://stackoverflow.com/users/6694684/benjamin-j"}, "reply_to_user": {"reputation": 56858, "user_id": 131930, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91536fe27d32713b8a154a0bf42f6748?s=128&d=identicon&r=PG", "display_name": "Jeremy Friesner", "link": "https://stackoverflow.com/users/131930/jeremy-friesner"}, "edited": false, "score": 0, "creation_date": 1556733587, "post_id": 55940432, "comment_id": 98534336, "body": "I agree with @JeremyFriesner. But then you should assign <code>j + 1</code> to <code>*k</code>. This should solve the <code>floating point exception</code> you described."}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1556733817, "post_id": 55940432, "comment_id": 98534442, "body": "If you have 2 threads using common data then either 1) One thread is running at a time, or 2) they run on different cores and get worse performance due to data being in the wrong cache.  Which one were you hoping for?"}, {"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "reply_to_user": {"reputation": 1098, "user_id": 6694684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a3b34689f308f4a92ad3002622bd6d3?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin J.", "link": "https://stackoverflow.com/users/6694684/benjamin-j"}, "edited": false, "score": 0, "creation_date": 1556733834, "post_id": 55940432, "comment_id": 98534448, "body": "@BenjaminJ. Ok I have done as described. Thanks for the tip."}, {"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "reply_to_user": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1556734016, "post_id": 55940432, "comment_id": 98534523, "body": "@stark I want the threads to be running concurrently, so that the whole thing is done faster."}, {"owner": {"reputation": 1098, "user_id": 6694684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a3b34689f308f4a92ad3002622bd6d3?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin J.", "link": "https://stackoverflow.com/users/6694684/benjamin-j"}, "edited": false, "score": 0, "creation_date": 1556734336, "post_id": 55940432, "comment_id": 98534658, "body": "@ipodfreak0313: Maybe you could read in the file in multiple blocks and then pass the single blocks to each thread."}, {"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "reply_to_user": {"reputation": 1098, "user_id": 6694684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a3b34689f308f4a92ad3002622bd6d3?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin J.", "link": "https://stackoverflow.com/users/6694684/benjamin-j"}, "edited": false, "score": 0, "creation_date": 1556734510, "post_id": 55940432, "comment_id": 98534714, "body": "@BenjaminJ. I would do that, but I am reading in multiple files and then appending them all together into a single <code>char*</code>, which is <code>allFiles</code>. Unless you mean breaking them up into blocks there, and then passing those blocks to <code>zip</code> with <code>pthread_create</code>?"}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1556734623, "post_id": 55940432, "comment_id": 98534764, "body": "What does &quot;read a character array&quot; mean? Sounds like you have an array of characters that already has somehow been placed in memory, and now you want to create <i>N</i> new threads that will access it for some purpose. What is that purpose? I ask because the host that runs your program probably has only one memory bus, and if the time that it takes your threads to do whatever it is that they do with the characters is dominated by the time that it takes to <i>fetch</i> the characters from main memory into local data caches, then adding more threads is unlikely to make it go any faster."}, {"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1556734821, "post_id": 55940432, "comment_id": 98534840, "body": "@SolomonSlow I want to read the character array, which is a bunch of files appended together. Then, I want to create a number of threads to do a run-length compression on the text in that character array. By breaking up the array into a certain number of parts and compressing them concurrently, I want to be able to perform the compression faster."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1556735253, "post_id": 55940432, "comment_id": 98535008, "body": "Run-length encoding is not compute-intensive. Each of your threads will spend most of its time in a loop, fetching the next byte from the source array, and comparing it to the previous byte. Sometimes, it will increment a counter. Other times it will write bytes to a destination array. My point is, it&#39;s going to spend a lot of time fetching data from the source, and that is not something that two threads can do at the same time. Every time one of your threads wants to fill a cache line with more source bytes, it will compete with other threads for access to the main memory bus."}, {"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1556735389, "post_id": 55940432, "comment_id": 98535059, "body": "@SolomonSlow is there a way I can implement multithreading in this scenario to see performance gains then? Should I be using a mutex or something on the character array? This is for a school assignment, we have to able to show that we can see performance gains by increasing the number of threads."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1556736177, "post_id": 55940432, "comment_id": 98535361, "body": "I don&#39;t know. Are any of your classmates doing any better? The problem that you have been asked to solve does not sound like a good candidate for multi-threading. It would be different if you had been asked to implement some encryption algorithm or some image processing algorithm where the threads would spend a larger portion of their time accessing their own private data. Operations on private data scale well with number of threads. Operations on shared data, not so much."}, {"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1556738668, "post_id": 55940432, "comment_id": 98536326, "body": "@SolomonSlow maybe I am supposed to substring the <code>allFiles</code> character array, and then pass each substring to its own thread? That way the threads aren&#39;t accessing shared data"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1556769796, "post_id": 55940432, "comment_id": 98543668, "body": "Why are you dividing <code>sizeOfAllFiles</code> by <code>threadNum</code>? That makes no sense. Try printing out the byte range each thread is working on, and you should immediately see the problem."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1556892400, "post_id": 55940432, "comment_id": 98593661, "body": "Re, &quot;substring the allFiles array...&quot; It won&#39;t matter if the bytes start out in one big array or, in several smaller ones. Either way, the bytes are in main memory, and the threads will have to take turns using the <i><a href=\"https://en.wikipedia.org/wiki/Bus_(computing)\" rel=\"nofollow noreferrer\">system bus</a></i> to fetch them. Throwing more CPUs at a problem helps when each CPU spends most of its time working in its own local <i><a href=\"https://en.wikipedia.org/wiki/CPU_cache\" rel=\"nofollow noreferrer\">data cache</a></i>. But run-length encoding is such a simple algorithm, that the CPUs will spend a large portion of time fetching bytes from main memory."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 1, "creation_date": 1556892813, "post_id": 55940432, "comment_id": 98593899, "body": "Re, Daniel Jour&#39;s answer: If different threads read different files, that may help somewhat, but if all of the files are on the same drive,... Your computer has only one interface to that drive, and all of the data will have to be moved through the interface in serial fashion, no matter how many threads are waiting for it."}], "answers": [{"comments": [{"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "edited": false, "score": 0, "creation_date": 1556806930, "post_id": 55942128, "comment_id": 98560929, "body": "This was extremely helpful, thank you for putting so much effort into this. I have a question though. What do you mean by creating a pool of threads with variable size? And by a pool of tasks?"}], "tags": [], "owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "is_accepted": true, "score": 2, "last_activity_date": 1556742434, "last_edit_date": 1556742434, "creation_date": 1556741462, "answer_id": 55942128, "question_id": 55940432, "link": "https://stackoverflow.com/questions/55940432/multithreaded-reading-doing-things-with-chars-from-character-array-in-c/55942128#55942128", "title": "Multithreaded reading/doing things with chars from character array in C", "body": "<p>I'm starting by throwing a test program at you:</p>\n\n<pre><code>#include &lt;assert.h&gt;\n#include &lt;stdbool.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stddef.h&gt;\n#include &lt;time.h&gt;\n\n\nbool\nEnlargeBuffer(char ** const buffer_pointer,\n              size_t * const buffer_size)\n{\n  char * larger_buffer = realloc(*buffer_pointer,\n                                 2 * *buffer_size);\n  if (! larger_buffer) {\n    larger_buffer = realloc(*buffer_pointer,\n                            *buffer_size + 100);\n    if (! larger_buffer) {\n      return false;\n    }\n    *buffer_size += 100;\n  } else {\n    *buffer_size *= 2;\n  }\n  *buffer_pointer = larger_buffer;\n  printf(\"(Buffer size now at %zu)\\n\", *buffer_size);\n  return true;\n}\n\n\n\nbool\nReadAll(FILE * const source,\n        char ** pbuffer,\n        size_t * pbuffer_size,\n        size_t * pwrite_index)\n{\n  int c;\n  while ((c = fgetc(source)) != EOF) {\n    assert(*pwrite_index &lt; *pbuffer_size);\n    (*pbuffer)[(*pwrite_index)++] = c;\n    if (*pwrite_index == *pbuffer_size) {\n      if (! EnlargeBuffer(pbuffer, pbuffer_size)) {\n        free(*pbuffer);\n        return false;\n      }\n    }\n  }\n  if (ferror(source)) {\n    free(*pbuffer);\n    return false;\n  }\n  return true;\n}\n\n\nunsigned\nCountAs(char const * const buffer,\n        size_t size)\n{\n  unsigned count = 0;\n  while (size--)\n    {\n      if (buffer[size] == 'A') ++count;\n    }\n  return count;\n}\n\n\nint\nmain(int argc, char ** argv)\n{\n  char * buffer = malloc(100);\n  if (! buffer) return 1;\n  size_t buffer_size = 100;\n  size_t write_index = 0;\n  clock_t begin = clock();\n  for (int i = 1; i &lt; argc; ++i)\n    {\n      printf(\"Reading %s now ... \\n\", argv[i]);\n      FILE * const file = fopen(argv[i], \"r\");\n      if (! file) return 1;\n      if (! ReadAll(file, &amp;buffer, &amp;buffer_size, &amp;write_index))\n        {\n          return 1;\n        }\n      fclose(file);\n    }\n  clock_t end = clock();\n  printf(\"Reading done, took %f seconds\\n\",\n         (double)(end - begin) / CLOCKS_PER_SEC);\n  begin = clock();\n  unsigned const as = CountAs(buffer, write_index);\n  end = clock();\n  printf(\"All files have %u 'A's, counting took %f seconds\\n\",\n         as,\n         (double)(end - begin) / CLOCKS_PER_SEC);\n}\n\n</code></pre>\n\n<p>This program reads all files (passed as command line arguments) into <strong>one</strong> big large <code>char * buffer</code>, and then counts all bytes which are <code>== 'A'</code>.  It also <em>times</em> both of these steps.</p>\n\n<p>Example run with (shortened) output on my system:</p>\n\n<pre><code># gcc -Wall -Wextra -std=c11 -pedantic allthefiles.c\n# dd if=/dev/zero of=large_file bs=1M count=1000\n# ./a.out allthefiles.c large_file\nReading allthefiles.c now ... \n(Buffer size now at 200)\n...\n(Buffer size now at 3200)\nReading large_file now ... \n(Buffer size now at 6400)\n(Buffer size now at 12800)\n...\n(Buffer size now at 1677721600)\nReading done, took 4.828559 seconds\nAll files have 7 'A's, counting took 0.764503 seconds\n\n</code></pre>\n\n<p>Reading took <strong>almost 5 seconds</strong>, but counting (= iterating once, in a single thread, over <em>all</em> bytes) took a bit <strong>less than 1 second</strong>.</p>\n\n<p><strong><a href=\"https://en.wikipedia.org/wiki/Amdahl%27s_law\" rel=\"nofollow noreferrer\">You're optimizing at the wrong place!</a></strong></p>\n\n<p>Using 1 thread to read <em>all</em> files, and then using <em>N</em> threads to operate on that <em>one</em> buffer isn't going to bring you places. <strong>The fastest way to read 1 file is to use 1 thread.</strong>  For multiple files, <a href=\"https://stackoverflow.com/a/3055497/1116364\">use 1 thread per file</a>!</p>\n\n<p>So, in order to achieve the speedup that you need to show for your assignment:</p>\n\n<ul>\n<li><p>Create a pool of threads with variable size.</p></li>\n<li><p>Have a pool of tasks, where each task consists of</p>\n\n<ul>\n<li>read one file</li>\n<li>compute it's run-length encoding</li>\n<li>store the run-length encoded file</li>\n</ul></li>\n<li><p>let the threads take tasks from your task pool.</p></li>\n</ul>\n\n<p><strong>Things to consider:</strong> How do you <em>combine</em> the results of each task? Without requiring (costly) synchronization.</p>\n"}], "owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 55942128, "answer_count": 1, "score": 2, "last_activity_date": 1556742434, "creation_date": 1556732980, "question_id": 55940432, "link": "https://stackoverflow.com/questions/55940432/multithreaded-reading-doing-things-with-chars-from-character-array-in-c", "title": "Multithreaded reading/doing things with chars from character array in C", "body": "<p>I am trying to read a character array that contains the contents of many large files. The character array is going to be quite large, because the files are large, so I want to do it using multithreading (pthread). I want the user to be able to designate how many threads they want to run. I have something working, but increasing the number of threads does nothing to affect performance (i.e. 1 thread finishes just as fast as 10). In fact, it seems to be just the opposite: telling the program to use 10 threads runs much slower than telling it to use 1.</p>\n\n<p>Here is the method for slicing up the character array according to the number of threads the user passes to the program. I know this is wrong, I could use some advice here.</p>\n\n<pre><code>//Universal variables\nint numThreads;\nsize_t sizeOfAllFiles; // Size, in bytes, of allFiles\nchar* allFiles; // Where all of the files are stored, together\nvoid *zip(void *nthread);\nvoid *zip(void *nThread) {\n     int currentThread = *(int*)nThread;\n     int remainder = sizeOfAllFiles % currentThread;\n     int slice = (sizeOfAllFiles-remainder) / currentThread;\n\n     // I subtracted the remainder for my testing\n     // because I didn't want to worry about whether\n     // the char array's size is evenly divisible by numThreads\n\n     int i = (slice * (currentThread-1));\n     char currentChar = allFiles[i]; //Used for iterating\n\n     while(i&lt;(slice * currentThread) &amp;&amp; i&gt;=(slice * (currentThread-1))) {\n        i++;\n        // Do things with the respective thread's\n        // 'slice' of the array.\n        .....\n    }\nreturn 0;\n}\n</code></pre>\n\n<p>And here is how I am spawning the threads, which I am almost positive that I am doing correctly:</p>\n\n<pre><code>for (int j = 1; j &lt;= threadNum; j++) {\n    k = malloc(sizeof(int));\n    *k = j;\n    if (pthread_create (&amp;thread[j], NULL, zip, k) != 0) {\n        printf(\"Error\\n\");\n        free(thread);\n        exit(EXIT_FAILURE);\n    }\n  }\nfor (int i = 1; i &lt;= threadNum; i++)\n     pthread_join (thread[i], NULL);\n</code></pre>\n\n<p>This is all really confusing for me so if I could get some help on this, I'd greatly appreciate it. I specifically am struggling with the slicing part (cutting it up correctly), and with not seeing performance gains by using more than one thread. Thanks in advance.</p>\n"}, {"tags": ["c", "reference", "ipc", "message-queue"], "comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556734106, "post_id": 55940270, "comment_id": 98534567, "body": "can you show the call of <i>checkMsg</i> ? If to dereference these pointers stops (<i>crashes</i>) the execution that means at least one of them does not point to something valid"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1556734316, "post_id": 55940270, "comment_id": 98534651, "body": "Please <a href=\"https://stackoverflow.com/posts/55940270/edit\">edit</a> to make a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Use formatting to improve readability. <a href=\"https://stackoverflow.com/editing-help\">stackoverflow.com/editing-help</a>"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556734896, "post_id": 55940270, "comment_id": 98534879, "body": "@ButtonMasher these vars have a right type and the signature of <i>checkMsg</i> is known when calling it ? Can you execute your program under <i>valgrind</i> ?"}, {"owner": {"reputation": 1, "user_id": 11438139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cffc7ccdd588c476e1348382fe5e48fa?s=128&d=identicon&r=PG&f=1", "display_name": "Button Masher", "link": "https://stackoverflow.com/users/11438139/button-masher"}, "edited": false, "score": 0, "creation_date": 1556736633, "post_id": 55940270, "comment_id": 98535544, "body": "I executed the program under valgrind but it outputs a lot of data, what should I look for, exactly?"}], "owner": {"reputation": 1, "user_id": 11438139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cffc7ccdd588c476e1348382fe5e48fa?s=128&d=identicon&r=PG&f=1", "display_name": "Button Masher", "link": "https://stackoverflow.com/users/11438139/button-masher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556736570, "creation_date": 1556732256, "last_edit_date": 1556736570, "question_id": 55940270, "link": "https://stackoverflow.com/questions/55940270/c-accessing-or-trying-to-alter-a-passed-variable-in-a-particular-segment-of-a-f", "title": "C: Accessing or trying to alter a passed variable in a particular segment of a function involving message queues stops the process", "body": "<p>I am trying to get processes to communicate and form groups through message queues.\nIn this case, a process forks into a number of children that communicate.\nWhat bugs me, actually, is the fact that when entering a particular function that uses both the message queue and some variables i need to change with it, accessing the dereferencered values seems to stop the execution of the process (and the others too since it doesn't \"release\" the semaphore they share) until the parent process stops its children and starts doing something else.</p>\n\n<p><code>struct msgbuf {\n    long mtype;\n    int mtext[2];\n};</code></p>\n\n<p>This is the msgbuf i'm using.</p>\n\n<p><code>int checkMsg(int msgid, struct msgbuf messaggio, int voto, int * partner, int * took, int * rejects, int *pending){\n    ...\n    while(msgrcv(msgid, &amp;messaggio, sizeof(messaggio), getpid(), IPC_NOWAIT) != -1){\n        if(messaggio.mtext[0]==1){\n            printf(\"%s\\n\", strerror(errno)); // this is shown in the terminal\n            printf(\"%d\\n\", * partner); // this is not shown, blocking the execution\n            * partner = messaggio.mtext[1];\n            * took = 1;\n            * pending = *pending - 1;\n            refuseInvites(msgid, messaggio);\n            return 1;\n        }\n    ...\n    }\n...\n}</code></p>\n\n<p>And this is the problematic piece of code.</p>\n\n<p>I tried changing the second printf to output *took and it does, but then the execution stops again (i presume the moment *partner is taken into consideration). the value of partner should be set to 0 before entering the function and messaggio.mtext[1] is a process ID. \nI expect the function to not stop and returning successfully, mantaining the consistency of the data.</p>\n\n<p>EDIT : The call to checkMsg() is this one:\n<code>taken = checkMsg(msgid, messaggio, voto, &amp;partner, &amp;took, &amp;rejects, &amp;pending);</code></p>\n\n<p>partner, took, rejects and pending are set to 0 before the forking</p>\n\n<p>EDIT 2: all the variables are of type int and the signature of the checkMsg is included in a header before the program starts.</p>\n"}, {"tags": ["c++", "c", "posix", "semaphore"], "comments": [{"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 1, "creation_date": 1556732122, "post_id": 55940188, "comment_id": 98533605, "body": "You are aware that the two threads run in different process contexts, are you? They are not using the same semaphore instances anymore."}, {"owner": {"reputation": 11, "user_id": 7435950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4740d4e4c7b21c2656d5d9f171540ed2?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Hassnain", "link": "https://stackoverflow.com/users/7435950/muhammad-hassnain"}, "reply_to_user": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1556732217, "post_id": 55940188, "comment_id": 98533650, "body": "Ok i got the point.  I want child process thread to wake up parent process thread. What is the other method to do it."}, {"owner": {"reputation": 22416, "user_id": 5494370, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152989584621642/picture?type=large", "display_name": "Alan Birtles", "link": "https://stackoverflow.com/users/5494370/alan-birtles"}, "edited": false, "score": 0, "creation_date": 1556732283, "post_id": 55940188, "comment_id": 98533694, "body": "You need to use a named semaphore or other IPC mechanism"}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1556732315, "post_id": 55940188, "comment_id": 98533702, "body": "You&#39;ll need some IPC mechanism. Maybe a pipe or ZMQ sockets can help to solve your problem."}, {"owner": {"reputation": 11, "user_id": 7435950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4740d4e4c7b21c2656d5d9f171540ed2?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Hassnain", "link": "https://stackoverflow.com/users/7435950/muhammad-hassnain"}, "edited": false, "score": 0, "creation_date": 1556732331, "post_id": 55940188, "comment_id": 98533715, "body": "ok. Thanks you."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1556732700, "post_id": 55940188, "comment_id": 98533891, "body": "another semaphore option to consider are the Sys V semaphores."}, {"owner": {"reputation": 5162, "user_id": 2785528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fc85984f1234637fa4ec24d93ae51bc?s=128&d=identicon&r=PG&f=1", "display_name": "2785528", "link": "https://stackoverflow.com/users/2785528/2785528"}, "edited": false, "score": 0, "creation_date": 1556736037, "post_id": 55940188, "comment_id": 98535308, "body": "From &quot;man sem_overview&quot; on Lubuntu 18.04 - &quot;POSIX semaphores come in two forms: named semaphores and unnamed semaphores.&quot;   also   &quot;Two processes can operate  on  the  same  named  semaphore  by  passing the  same  name  to sem_open(3) (in each process). Note: the sem_open must be performed in each process."}], "owner": {"reputation": 11, "user_id": 7435950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4740d4e4c7b21c2656d5d9f171540ed2?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Hassnain", "link": "https://stackoverflow.com/users/7435950/muhammad-hassnain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 177, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556733352, "creation_date": 1556731921, "last_edit_date": 1556733352, "question_id": 55940188, "link": "https://stackoverflow.com/questions/55940188/posix-semaphores-function-sem-post-doesnt-wake-sem-wait-problem", "title": "POSIX semaphores function sem_post() doesn&#39;t wake sem_wait() problem", "body": "<p>I am creating a Process P and Process P has child C. Both Process create one thread each. And i want to synchronize both thread using semaphore.\nProblem is that sem_post from child process thread doesn't wake up sem_wait of parent process thread. </p>\n\n<pre><code>sem_t sem;\nvoid* th(void* arg){\n    sem_wait(&amp;sem);\n    printf(\"DONE\");\n}\nvoid* th1(void* arg){\n    printf(\"%d\",sem_post(&amp;sem));\n}\npthread_t id[2];\nint main(){\n    sem_init(&amp;sem,2,1);\n    sem_wait(&amp;sem);\n    pid_t id1 = fork();\n    if(id1==0){\n        pthread_create(&amp;id[0],NULL,th,NULL);\n        pthread_join(id[0],NULL);\n    }\n    else if(id1&gt;0){ \n        pthread_create(&amp;id[1],NULL,th1,NULL);\n        pthread_join(id[1],NULL);\n        wait(NULL);\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "cmake", "mingw", "clion"], "comments": [{"owner": {"reputation": 2226, "user_id": 1842273, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/swv3k.jpg?s=128&g=1", "display_name": "Chris Albert", "link": "https://stackoverflow.com/users/1842273/chris-albert"}, "edited": false, "score": 0, "creation_date": 1556732051, "post_id": 55940045, "comment_id": 98533577, "body": "Welcome to StackOverflow! Your question needs some work so the community can better help you. Take a look at <a href=\"https://stackoverflow.com/help/how-to-ask\">how to ask a good question</a> and give it another try."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 3, "creation_date": 1556732145, "post_id": 55940045, "comment_id": 98533610, "body": "the problem is in the file name, obviously. Something funny is happening with unicode letters there. I guess you named the folder &#220;bung? Try calling it <code>exercise</code> instead"}], "answers": [{"tags": [], "owner": {"reputation": 163, "user_id": 6375964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5E0bH.jpg?s=128&g=1", "display_name": "0xAA55", "link": "https://stackoverflow.com/users/6375964/0xaa55"}, "is_accepted": false, "score": 0, "last_activity_date": 1556743378, "last_edit_date": 1556743378, "creation_date": 1556740384, "answer_id": 55941909, "question_id": 55940045, "link": "https://stackoverflow.com/questions/55940045/c-compiler-broken-is-not-able-to-compile-a-simple-test-program/55941909#55941909", "title": "C compiler broken: is not able to compile a simple test program", "body": "<p>Check out the previous answer to the title: How to use CMAKE in MinGW or MinGW-w64 to compile Clion:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/29883383/clion-errorthe-c-compiler-c-mingw-bin-gcc-exe-is-not-able-to-compile-a-simp\">CLion: Error:The C compiler &quot;C:/MinGW/bin/gcc.exe&quot; is not able to compile a simple test program</a></p>\n\n<p>The answer is: you shouldn't let <code>sh.exe</code> in your <code>PATH</code> environment variable, it's <a href=\"https://gitlab.kitware.com/cmake/community/wikis/doc/cmake/platform_dependent_issues/MinGW-Compiler-Issues\" rel=\"nofollow noreferrer\">known to cause problem.</a></p>\n\n<p>Or to use <a href=\"https://github.com/ninja-build/ninja/releases\" rel=\"nofollow noreferrer\">ninja</a> as an alternative to make.</p>\n"}], "owner": {"reputation": 21, "user_id": 11438195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8835f44a97ff274e252ad94a3d3060e4?s=128&d=identicon&r=PG&f=1", "display_name": "alecander", "link": "https://stackoverflow.com/users/11438195/alecander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 5965, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1556743378, "creation_date": 1556731278, "last_edit_date": 1556734450, "question_id": 55940045, "link": "https://stackoverflow.com/questions/55940045/c-compiler-broken-is-not-able-to-compile-a-simple-test-program", "title": "C compiler broken: is not able to compile a simple test program", "body": "<p>On my Dektop and on my Surface Pro 6 CLion has stopped working and I don\u00b4t know exactly why.</p>\n\n<p>That is written on my Desktop:</p>\n\n<pre><code>\"C:\\Program Files\\JetBrains\\CLion 2018.3.2\\bin\\cmake\\win\\bin\\cmake.exe\" -DCMAKE_BUILD_TYPE=Debug -G \"CodeBlocks - MinGW Makefiles\" C:\\Users\\Alexander\\Desktop\\Clion\\\u00fcbung \n-- The C compiler identification is GNU 6.3.0 \n-- Check for working C compiler: C:/MinGW/bin/gcc.exe \n-- Check for working C compiler: C:/MinGW/bin/gcc.exe -- broken \nCMake Error at C:/Program Files/JetBrains/CLion 2018.3.2/bin/cmake/win/share/cmake-3.13/Modules/CMakeTestCCompiler.cmake:52 (message): \nThe C compiler\n\n\"C:/MinGW/bin/gcc.exe\"\n\nis not able to compile a simple test program.\n\nIt fails with the following output:\n\nChange Dir: C:/Users/Alexander/Desktop/Clion/\u00c3\u00bcbung/cmake-build-debug/CMakeFiles/CMakeTmp \n\nRun Build Command:\"C:/MinGW/bin/mingw32-make.exe\" \"cmTC_254a1/fast\" \nC:/MinGW/bin/mingw32-make.exe -f CMakeFiles\\cmTC_254a1.dir\\build.make CMakeFiles/cmTC_254a1.dir/build \nmingw32-make.exe[1]: Entering directory 'C:/Users/Alexander/Desktop/Clion/\u00c2\u00b3bung/cmake-build-debug/CMakeFiles/CMakeTmp' \nBuilding C object CMakeFiles/cmTC_254a1.dir/testCCompiler.c.obj \nC:\\MinGW\\bin\\gcc.exe -o CMakeFiles\\cmTC_254a1.dir\\testCCompiler.c.obj -c C:\\Users\\Alexander\\Desktop\\Clion\\\u00e2\u201d\u0153\u00e2\u2022\ufffdbung\\cmake-build-debug\\CMakeFiles\\CMakeTmp\\testCCompiler.c \ngcc.exe: error: C:\\Users\\Alexander\\Desktop\\Clion\\\u00e2\u201d\u0153\u00e2\u2022\ufffdbung\\cmake-build-debug\\CMakeFiles\\CMakeTmp\\testCCompiler.c: No such file or directory \ngcc.exe: fatal error: no input files \ncompilation terminated. \nCMakeFiles\\cmTC_254a1.dir\\build.make:64: recipe for target 'CMakeFiles/cmTC_254a1.dir/testCCompiler.c.obj' failed \nmingw32-make.exe[1]: *** [CMakeFiles/cmTC_254a1.dir/testCCompiler.c.obj] Error 1 \nmingw32-make.exe[1]: Leaving directory 'C:/Users/Alexander/Desktop/Clion/\u00c2\u00b3bung/cmake-build-debug/CMakeFiles/CMakeTmp' \nMakefile:120: recipe for target 'cmTC_254a1/fast' failed \nmingw32-make.exe: *** [cmTC_254a1/fast] Error 2 \nCMake will not be able to correctly generate this project. \nCall Stack (most recent call first): \nCMakeLists.txt:2 (project)\n\n-- Configuring incomplete, errors occurred! \nSee also \"C:/Users/Alexander/Desktop/Clion/\u00c3\u00bcbung/cmake-build-debug/CMakeFiles/CMakeOutput.log\". \nSee also \"C:/Users/Alexander/Desktop/Clion/\u00c3\u00bcbung/cmake-build-debug/CMakeFiles/CMakeError.log\".\n</code></pre>\n\n<p>And for my Surface Pro 6:</p>\n\n<pre><code>\"C:\\Program Files\\JetBrains\\CLion 2018.3.2\\bin\\cmake\\win\\bin\\cmake.exe\" -DCMAKE_BUILD_TYPE=Debug -G \"CodeBlocks - MinGW Makefiles\" C:\\Users\\Alexander\\Desktop\\CLion\\udemy-\u00fcbung-arrays \n-- The C compiler identification is GNU 7.1.0 \n-- Check for working C compiler: C:/Program Files/mingw-w64/x86_64-7.1.0-posix-seh-rt_v5-rev0/mingw64/bin/gcc.exe \n-- Check for working C compiler: C:/Program Files/mingw-w64/x86_64-7.1.0-posix-seh-rt_v5-rev0/mingw64/bin/gcc.exe -- broken \nCMake Error at C:/Program Files/JetBrains/CLion 2018.3.2/bin/cmake/win/share/cmake-3.13/Modules/CMakeTestCCompiler.cmake:52 (message): \nThe C compiler\n\n\"C:/Program Files/mingw-w64/x86_64-7.1.0-posix-seh-rt_v5-rev0/mingw64/bin/gcc.exe\"\n\nis not able to compile a simple test program.\n\nIt fails with the following output:\n\nChange Dir: C:/Users/Alexander/Desktop/CLion/udemy-\u00c3\u00bcbung-arrays/cmake-build-debug/CMakeFiles/CMakeTmp\n\nRun Build Command:\"C:/PROGRA~1/MINGW-~1/X86_64~1.0-P/mingw64/bin/mingw32-make.exe\" \"cmTC_d8abd/fast\" \nC:/PROGRA~1/MINGW-~1/X86_64~1.0-P/mingw64/bin/mingw32-make.exe -f CMakeFiles\\cmTC_d8abd.dir\\build.make CMakeFiles/cmTC_d8abd.dir/build \nmingw32-make.exe[1]: Entering directory 'C:/Users/Alexander/Desktop/CLion/udemy-\u00c2\u00b3bung-arrays/cmake-build-debug/CMakeFiles/CMakeTmp' \nBuilding C object CMakeFiles/cmTC_d8abd.dir/testCCompiler.c.obj \nC:\\PROGRA~1\\MINGW-~1\\X86_64~1.0-P\\mingw64\\bin\\gcc.exe -o CMakeFiles\\cmTC_d8abd.dir\\testCCompiler.c.obj -c C:\\Users\\Alexander\\Desktop\\CLion\\udemy-\u00e2\u201d\u0153\u00e2\u2022\ufffdbung-arrays\\cmake-build-debug\\CMakeFiles\\CMakeTmp\\testCCompiler.c \ngcc.exe: error: C:\\Users\\Alexander\\Desktop\\CLion\\udemy-\u00e2\u201d\u0153\u00e2\u2022\ufffdbung-arrays\\cmake-build-debug\\CMakeFiles\\CMakeTmp\\testCCompiler.c: No such file or directory \ngcc.exe: fatal error: no input files \ncompilation terminated. \nCMakeFiles\\cmTC_d8abd.dir\\build.make:64: recipe for target 'CMakeFiles/cmTC_d8abd.dir/testCCompiler.c.obj' failed \nmingw32-make.exe[1]: *** [CMakeFiles/cmTC_d8abd.dir/testCCompiler.c.obj] Error 1 \nmingw32-make.exe[1]: Leaving directory 'C:/Users/Alexander/Desktop/CLion/udemy-\u00c2\u00b3bung-arrays/cmake-build-debug/CMakeFiles/CMakeTmp' \nMakefile:120: recipe for target 'cmTC_d8abd/fast' failed \nmingw32-make.exe: *** [cmTC_d8abd/fast] Error 2 \nCMake will not be able to correctly generate this project. \nCall Stack (most recent call first): \nCMakeLists.txt:2 (project)\n\n-- Configuring incomplete, errors occurred! \nSee also \"C:/Users/Alexander/Desktop/CLion/udemy-\u00c3\u00bcbung-arrays/cmake-build-debug/CMakeFiles/CMakeOutput.log\". \nSee also \"C:/Users/Alexander/Desktop/CLion/udemy-\u00c3\u00bcbung-arrays/cmake-build-debug/CMakeFiles/CMakeError.log\".\n</code></pre>\n\n<p>[Failed to reload]</p>\n"}, {"tags": ["c++", "c", "glut"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1556731050, "post_id": 55939984, "comment_id": 98533103, "body": "First you need the bounds of the object."}], "answers": [{"tags": [], "owner": {"reputation": 768, "user_id": 5032541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bb5ebe3503f96f4e000715c50b35367?s=128&d=identicon&r=PG", "display_name": "Erwan Daniel", "link": "https://stackoverflow.com/users/5032541/erwan-daniel"}, "is_accepted": false, "score": 1, "last_activity_date": 1557330431, "last_edit_date": 1557330431, "creation_date": 1556734380, "answer_id": 55940685, "question_id": 55939984, "link": "https://stackoverflow.com/questions/55939984/how-to-check-if-the-mouse-is-on-one-side-of-the-screen-in-opengl/55940685#55940685", "title": "How to check if the mouse is on one side of the screen in OpenGl?", "body": "<p>I guess that you want to retrieve which object is under your mouse or under the clicked pixel.\nThere is a method called 3d picking. It consist of drawing your scene on a texture created specifically for this purpose. It must have same dimension as your window.\nYou will draw your scene with a special shader that will draw the id of your objects on the texture. After what you just need to read the pixel where the mouse is to know which object is selected. </p>\n\n<p>There is my fragment shader, it takes the id of the current object:</p>\n\n<pre><code>#version 330 core\n\nuniform uint id;\n\nlayout(location = 0) out uvec4 out_color;\n\nvoid main()\n{\n    uvec4 color;\n    color.x = (id &amp; 0xff0000u) &gt;&gt; 16;\n    color.y = (id &amp; 0x00ff00u) &gt;&gt;  8;\n    color.z = (id &amp; 0x0000ffu) &gt;&gt;  0;\n    color.w = uint(255);\n\n    out_color = color;\n    return;\n}\n</code></pre>\n\n<p>You can check out this tutorial also : <a href=\"http://ogldev.atspace.co.uk/www/tutorial29/tutorial29.html\" rel=\"nofollow noreferrer\">http://ogldev.atspace.co.uk/www/tutorial29/tutorial29.html</a></p>\n"}], "owner": {"reputation": 51, "user_id": 11295496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5b4f9d44030db5ecf9576c90d84f1a9?s=128&d=identicon&r=PG&f=1", "display_name": "anaksky2k19", "link": "https://stackoverflow.com/users/11295496/anaksky2k19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557330431, "creation_date": 1556730985, "last_edit_date": 1556731619, "question_id": 55939984, "link": "https://stackoverflow.com/questions/55939984/how-to-check-if-the-mouse-is-on-one-side-of-the-screen-in-opengl", "title": "How to check if the mouse is on one side of the screen in OpenGl?", "body": "<p>In opengl, how would I be able to check if the mouse pointer is inside an object. So far, I can only check if its inside the screen, using <code>glutPassiveMotionFunc</code>.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 5623, "user_id": 1347519, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9e1eb6e25803528d25f57f3df79e115?s=128&d=identicon&r=PG", "display_name": "Attie", "link": "https://stackoverflow.com/users/1347519/attie"}, "edited": false, "score": 3, "creation_date": 1556728341, "post_id": 55939740, "comment_id": 98532616, "body": "I wouldn&#39;t expect this exact code to have significantly different memory requirements with / without the for loop (perhaps one <code>int</code>)... Recursion will cause you problems. You could try using <code>valgrind</code> or some memory analysis to get some visibility on what&#39;s happening."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1556730082, "post_id": 55939740, "comment_id": 98532743, "body": "The problem is <b><i>not</i></b> the nested function. The problem is that you allocate large arrays on the stack. <code>double Var[100000];</code> should be <code>double *Var = malloc(100000 * sizeof(double));</code> Of course, you&#39;ll need to <code>free</code> the memory when it&#39;s no longer needed."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 1, "creation_date": 1556730083, "post_id": 55939740, "comment_id": 98532744, "body": "There is no particular reason why it should use more stack memory just because it is called from a <code>for</code> loop unless you are &quot;parallelizing&quot; the code (e.g. with OpenMP)."}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 0, "creation_date": 1556730093, "post_id": 55939740, "comment_id": 98532750, "body": "Usually your compiler will inline short function on usual optimisation levels if it sees the functions body (independent of marking them inline). In -O3 it will inline nearly everything it sees."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 4, "creation_date": 1556730128, "post_id": 55939740, "comment_id": 98532765, "body": "You can&#39;t make a function call except from within a function, so the answer to the headline question is &quot;yes: it is not only good practice; it is unavoidable&quot;.  But your main question is about stack memory usage.  You&#39;ll need to use dynamically allocated memory (<code>malloc()</code> et al) as your problem size gets bigger.  Stack is a limited resource; the default is typically about 1 MiB on Windows and 8 MiB on Unix-like systems.  Don&#39;t allocate megabytes of memory on the stack as in your <code>function2()</code>."}, {"owner": {"reputation": 2882, "user_id": 6943197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbce82fcea72325bc7cc3f874b5cf3ab?s=128&d=identicon&r=PG", "display_name": "Hogstrom", "link": "https://stackoverflow.com/users/6943197/hogstrom"}, "edited": false, "score": 0, "creation_date": 1556730280, "post_id": 55939740, "comment_id": 98532819, "body": "The main issue with memory would be if you were recursively calling a function from within itself given the use case you outlined.  So, if you called function2() and it called itself 100,000 times then your stack usage would increase.  That isn&#39;t the case with the code you presented."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 0, "creation_date": 1556730608, "post_id": 55939740, "comment_id": 98532940, "body": "@user6556709: I reread the question and edited my comment. However, it did once include &quot;If all the functions are 2-5 lines each, then you end up with incomprehensible code&quot;. I&#39;m a strong advocate of small functions, but I mean 5-20 lines rather than 2-5 lines typically. (I work on a code base where functions are routinely several hundred lines long, or more. It annoys me, but can&#39;t easily be fixed.) Yes, naming can help, but there comes a point at which the necessary paragraph of name becomes counter-productive. It&#39;s a balance. It depends on context. More small functions are usually better."}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556730731, "post_id": 55939740, "comment_id": 98532984, "body": "@JonathanLeffler Sorry, then I&#39;ve misunderstood you. 5-20 is good a range."}], "answers": [{"tags": [], "owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "is_accepted": true, "score": 4, "last_activity_date": 1556732859, "last_edit_date": 1556732859, "creation_date": 1556731203, "answer_id": 55940033, "question_id": 55939740, "link": "https://stackoverflow.com/questions/55939740/is-it-a-good-practice-to-use-a-function-call-inside-a-function/55940033#55940033", "title": "Is it a good practice to use a function call inside a function?", "body": "<blockquote>\n  <p>Q1. I want to know if there is any way to check how much stack memory my code is going to use, performance check of the code(optimization), memory leakage.</p>\n</blockquote>\n\n<p>Not really. The C standard does not even mention the stack, and any C compiler can create binaries that does not use the stack and still conform to the C standard.</p>\n\n<p>However, in reality a stack is almost always used and the overhead is very small. Just sum up all the local variables and you will get a good estimate.</p>\n\n<p>Performance should not be predicted. It should be measured, and then you optimize if necessary.</p>\n\n<p>It's very hard, if not impossible, for a compiler to detect memory leaks in a reliable way. You can use programs like Valgrind for that. </p>\n\n<blockquote>\n  <p>Q2. if the structure of my code is like,nested functions,\n  because of the function2 call inside a for loop is it going to use more stack memory than using once only? </p>\n</blockquote>\n\n<p>No. Each time <code>function2()</code> is called, a new stackframe is created with enough space for 100000 doubles. But it will be released immediately when the function returns. The problem here is not calling a function in a loop. The problem is that you're allocating HUGE arrays on the stack, which might become a problem. You should consider allocating them dynamically instead. Basically, it will look like this:</p>\n\n<pre><code>void function2\n{\n    double *var = malloc(100000*sizeof(*var));\n    /* Code */\n    free(var);\n}\n</code></pre>\n\n<p>If you are using recursive functions, the stack might become a problem. Let's consider this sum function that sums all natural numbers up to num:</p>\n\n<pre><code>unsigned long long sum(unsigned long long num)\n{\n    if(num == 0) return num;\n    return num + sum(n-1);\n}\n</code></pre>\n\n<p>A <code>long long</code> is typically 8 bytes, so if you use this function for very large num (maybe 100000 or 1000000) you might encounter stack problems.</p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 2, "last_activity_date": 1556731656, "creation_date": 1556731656, "answer_id": 55940131, "question_id": 55939740, "link": "https://stackoverflow.com/questions/55939740/is-it-a-good-practice-to-use-a-function-call-inside-a-function/55940131#55940131", "title": "Is it a good practice to use a function call inside a function?", "body": "<blockquote>\n  <p><strong>Q1</strong>. I want to know if there is any way to check how much stack memory my code is going to use, performance check of the code(optimization), memory leakage.</p>\n</blockquote>\n\n<p>You may be able to estimate how much stack space your program will require by analyzing the call graph and the variables declared in each function, but this is not easy for a complex program.  It is much more difficult if any recursion is involved, but one should at least be able to place a rough upper bound.  But the easy way is to <em>measure</em> the usage when running on characteristic inputs.</p>\n\n<p>Absolute performance is <em>extremely</em> hard for humans to predict.  The best we can usually do reliably is to characterize how performance will scale with problem size.  Comparative performance should always be measured.</p>\n\n<p>As for memory leakage, careful code analysis by humans can usually detect memory leaks, but it is wise to complement that with usage of a runtime memory-usage analysis tool such as Valgrind.  Such tools turn up leaks even in well-analyzed code with distressing frequency.</p>\n\n<blockquote>\n  <p><strong>Q2</strong>. if the structure of my code is like,nested functions,\n  [...]\n  because of the function2 call inside a for loop is it going to use\n  more stack memory than using once only?</p>\n</blockquote>\n\n<p>No.  A function's automatically-allocated resources are released when control leaves that function.  Calling the same function multiple times, whether in a loop or otherwise, does not use more automatic (stack) resources than the most demanding individual call does.</p>\n\n<p>However, when a function <em>recurses</em> by directly or indirectly calling itself, it probably does use additional resources proportional to the recursion depth.  I say \"probably\" because in some cases the compiler may be able to convert the recursion into an iteration within a single function call.</p>\n"}, {"tags": [], "owner": {"reputation": 4732, "user_id": 8477999, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8172e1919af53269de92316dcf03a03?s=128&d=identicon&r=PG&f=1", "display_name": "Gem Taylor", "link": "https://stackoverflow.com/users/8477999/gem-taylor"}, "is_accepted": false, "score": 0, "last_activity_date": 1556735690, "creation_date": 1556735690, "answer_id": 55940961, "question_id": 55939740, "link": "https://stackoverflow.com/questions/55939740/is-it-a-good-practice-to-use-a-function-call-inside-a-function/55940961#55940961", "title": "Is it a good practice to use a function call inside a function?", "body": "<p>It is best practice not to create large objects on the stack. They should instead be allocated dynamically with <code>malloc</code> in C or <code>new</code> in C++.</p>\n\n<p>Your program can then recover if the allocation request is refused by the program.</p>\n\n<p>By using the new smart pointers in C++ you can help ensure that all allocations get freed and that no leaks occur, otherwise you just have to \"write your code carefully\", which is the downside of C programming.</p>\n"}], "migrated_from": {"other_site": {"markdown_extensions": ["Prettify"], "launch_date": 1250553600, "open_beta_date": 1247529600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png", "twitter_account": "super_user", "favicon_url": "https://cdn.sstatic.net/Sites/superuser/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon.png", "audience": "computer enthusiasts and power users", "site_url": "https://superuser.com", "api_site_parameter": "superuser", "logo_url": "https://cdn.sstatic.net/Sites/superuser/Img/logo.png", "name": "Super User", "site_type": "main_site"}, "on_date": 1556729754, "question_id": 1431821}, "owner": {"reputation": 101, "user_id": 10805553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fa6d757c3ae93560e6ac7d8869b25e6?s=128&d=identicon&r=PG&f=1", "display_name": "yasir", "link": "https://stackoverflow.com/users/10805553/yasir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 582, "favorite_count": 0, "accepted_answer_id": 55940033, "answer_count": 3, "score": 1, "last_activity_date": 1556735690, "creation_date": 1556727992, "last_edit_date": 1556732530, "question_id": 55939740, "link": "https://stackoverflow.com/questions/55939740/is-it-a-good-practice-to-use-a-function-call-inside-a-function", "title": "Is it a good practice to use a function call inside a function?", "body": "<p>I have a very large C program for Molecular dynamics. It works correctly with N=10000 particles.  When I increase the particles to N=100000 by increasing the variable size, it generated a segmentation fault.</p>\n\n<p>I executed <code>ulimit -s unlimited</code> and problem was resolved. </p>\n\n<p><strong>Q1.</strong>\nIs any way to check how much stack memory my code is going to use, performance check of the code(optimization), memory leakage. </p>\n\n<p><strong>Q2.</strong>\nIf the structure of my code is like, nested functions,</p>\n\n<pre><code>int main() {\n    function1();\n    return 0;\n}\n\nvoid function1() {\n    for(int i=0;i&lt;1000;i++) {\n        function2();\n    }\n}\n\nvoid function2() { \n    double Var[100000];\n}\n</code></pre>\n\n<p>Will the use of <code>function2()</code> inside a for loop use more stack memory than executing it only one time?    </p>\n"}, {"tags": ["c", "file", "structure"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556728880, "post_id": 55939376, "comment_id": 98532229, "body": "Your flow is a mess. You open a file in a couple of <code>case</code> but don&#39;t close it, then you close in another couple of <code>case</code>. How do you keep track of which one should open and close? And you have two different <code>userRec</code> structures, <code>x</code> and <code>user</code>, which one is valid at which point in time? What if you filled in <code>user</code> and then save <code>x</code>? Or read into <code>user</code> and show <code>x</code>? There&#39;s also a lot of fall-through points in that <code>switch</code>, which makes it tough to follow along as well."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1556728950, "post_id": 55939376, "comment_id": 98532270, "body": "Don&#39;t put <code>case 5:</code> between <code>case 1:</code> and <code>case 2:</code>.  Don&#39;t forget to include <code>break;</code> at the end of each <code>case</code> block.  Use functions."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1556729038, "post_id": 55939376, "comment_id": 98532313, "body": "@Someprogrammerdude \u2014 since the variable declarations aren&#39;t immediately after the case labels, they&#39;re allowed without comment.  The scopes of the variables are weird, but there isn&#39;t actually a compiler-reportable problem with the code."}], "answers": [{"comments": [{"owner": {"reputation": 1996, "user_id": 5161718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/448f457d74b98db25dd6bcccfa73a32c?s=128&d=identicon&r=PG&f=1", "display_name": "Bojan Petkovic", "link": "https://stackoverflow.com/users/5161718/bojan-petkovic"}, "edited": false, "score": 0, "creation_date": 1556730579, "post_id": 55939808, "comment_id": 98532928, "body": "please provide the answer here, the link can expire... Referencing the link is a good idea, but think of it as a reference, rather than part of answer. I would advise not to have a redirect form google, but the direct link."}], "tags": [], "owner": {"reputation": 1, "user_id": 6696865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8751df630fe964c6fbe5aea42a3a9d16?s=128&d=identicon&r=PG&f=1", "display_name": "skowronsky98", "link": "https://stackoverflow.com/users/6696865/skowronsky98"}, "is_accepted": false, "score": 0, "last_activity_date": 1556730043, "creation_date": 1556730043, "answer_id": 55939808, "question_id": 55939376, "link": "https://stackoverflow.com/questions/55939376/how-can-i-read-and-write-user-information-to-file-with-structure/55939808#55939808", "title": "How Can I Read and Write User Information to file with structure", "body": "<p>Try to use .dat file. You can write and read whole structure.\n<a href=\"https://www.google.com/amp/s/www.geeksforgeeks.org/readwrite-structure-file-c/amp/\" rel=\"nofollow noreferrer\">https://www.google.com/amp/s/www.geeksforgeeks.org/readwrite-structure-file-c/amp/</a></p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 11301964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11f93ab29e38c78d2075c2a4073dd690?s=128&d=identicon&r=PG&f=1", "display_name": "Exciless", "link": "https://stackoverflow.com/users/11301964/exciless"}, "edited": false, "score": 0, "creation_date": 1556740028, "post_id": 55941176, "comment_id": 98536906, "body": "This is my kind of term project I should definitely do this but I I can&#39;t solve the problem I try different ways but I couldn&#39;t find the problem"}], "tags": [], "owner": {"reputation": 4732, "user_id": 8477999, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8172e1919af53269de92316dcf03a03?s=128&d=identicon&r=PG&f=1", "display_name": "Gem Taylor", "link": "https://stackoverflow.com/users/8477999/gem-taylor"}, "is_accepted": false, "score": 1, "last_activity_date": 1556736778, "creation_date": 1556736778, "answer_id": 55941176, "question_id": 55939376, "link": "https://stackoverflow.com/questions/55939376/how-can-i-read-and-write-user-information-to-file-with-structure/55941176#55941176", "title": "How Can I Read and Write User Information to file with structure", "body": "<p>You certainly <em>can</em> do this, but do you really want to? </p>\n\n<p>Main disadvantages are to do with portability of the file: endians, alignments, processor size, and versions</p>\n\n<p>The endian problem is that a number type that stores more than 128 or 256 needs to use multiple bytes, and there are two main schemas depending whether the first byte stores the highest part of the number (big endian) or the lowest part (little endian). If a file is stored in one form on one computer, then it can't be correctly read back on a computer configured the other way. Much of the world is running on Intel or little-endian mode ARM, so it may seem that little endian has won, but it may not always be the case.</p>\n\n<p>Alignments are where the compiler aligns each of the fields of your structure to provide better performance, leaving the odd spare byte. Different processors have different alignment rules, so again the file may be misread on a different processor, or even the same platform with your program built with slightly different options.</p>\n\n<p>The processor size is an issue that the default size of an integer has grown over the years. Had you saved your file in 1980, your int might have only taken up 2 bytes, as that was the processor int size back then. In steps it has grown to 4 bytes, 8 bytes, and now 16 byte integer size is not unheard of. You can mitigate this issue by using the ansi standard names int32_t or int64_t.</p>\n\n<p>Versioning is a problem you make for yourself. What happens in 6 months time when you decide you need an extra field, say <code>middleInitial</code>? How will your new program be able to read your old data files as well as its new files? How will your old program know to reject the new data if it encounters it?</p>\n"}], "owner": {"reputation": 1, "user_id": 11301964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11f93ab29e38c78d2075c2a4073dd690?s=128&d=identicon&r=PG&f=1", "display_name": "Exciless", "link": "https://stackoverflow.com/users/11301964/exciless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1556736778, "creation_date": 1556727952, "last_edit_date": 1556728899, "question_id": 55939376, "link": "https://stackoverflow.com/questions/55939376/how-can-i-read-and-write-user-information-to-file-with-structure", "title": "How Can I Read and Write User Information to file with structure", "body": "<p>I Create file and I want to get information from users and write in file or read informations from data ? I want to use in Switch </p>\n\n<p>The code I use to write data to a file: <code>fwrite(&amp;x, sizeof(struct userRec), 1, fout); \nfclose(fout);</code></p>\n\n<p>The code I use to write data to a file: <code>fread(&amp;x, sizeof(struct userRec), 1, fin);</code></p>\n\n<p>When I try to write some information on file and I open with notepad, I see just some NULL characters.</p>\n\n<pre><code>struct userRec{\n\n    char firstName[25];\n    char lastName[25];\n    int UserID; \n    int day;\n    int month;\n    int year;\n    char adress[200];\n    float money;\n\n};\n\nint main(){\n\n    struct userRec user;\n    struct userRec x;\n    int menu1, answer;\n    char login[10];\n    char answer2;\n    char file_name[100];\n    float deposit, withdraw;\n\n    printf(\"Welcome to the IAU BANK !\\n\");\n\n    printf(\"Please enter any character to sign in : \");\n    scanf(\"%c\",&amp;login);\n\n    printf(\"\\n\\n\\tMENU\\n1.Create User Registration\\n2.Login to Account\\n\");\n    scanf(\"%d\",&amp;menu1); \n\n    switch (menu1){\n\n        case 1:\n\n            printf(\"Please write your ID Number : \");\n            scanf(\"%s\",&amp;file_name);\n            FILE *fout;\n            fout = fopen(file_name , \"wb\");\n\n            printf(\"Please Enter Your First Name : \");\n            scanf(\"%s\",&amp;x.firstName);\n\n            printf(\"Please Enter Your Last Name : \");\n            scanf(\"%s\",&amp;x.lastName);    \n\n            printf(\"Please Enter Your Identification Number Again : \");\n            scanf(\"%d\",&amp;x.UserID);\n\n            printf(\"Please Enter Your Birthday Date (dd/mm/yyyy) Format : \");\n            scanf(\"%d / %d / %d\",&amp;x.day,&amp;x.month,&amp;x.year);\n\n            printf(\"Please Enter Your Adress : \");\n            scanf(\"%s\",&amp;x.adress);\n\n            printf(\"\\n\\n\\tYour Information is :\\nFirst Name : %s\\nLast Name : %s \\nIdentification Number : %d \\nBirthday Date : %d/%d/%d\\nAdress : %s\",x.firstName,x.lastName,x.UserID,x.day,x.month,x.year,x.adress);\n\n            printf(\"\\n\\n\\tDo You Approve Your Information ? Yes:5 No:6 Enter 5 or 6\\n\");\n            scanf(\"%d\",&amp;answer);\n\n        case 5:\n\n            printf(\"Your information has been saved!\\n\");\n\n            fwrite(&amp;user, sizeof(struct userRec), 1, fout); \n            fclose(fout);           \n\n            printf(\"\\nPress the 2 button to log in to your account : \");\n            scanf(\"%d\",&amp;answer);\n\n        case 2:\n\n            printf(\"Please write your ID Number : \");\n            scanf(\"%s\",&amp;file_name);\n\n            FILE *fin;\n            fin = fopen(file_name , \"r\");\n\n            fread(&amp;x, sizeof(struct userRec), 1, fin);\n\n            printf(\"Welcome %s %s your ID : %d Your Date : %d / %d / %d Your Address : %s\", x.firstName,x.lastName,x.UserID,x.day,x.month,x.year,x.adress);\n\n\n            printf(\"\\nThe amount of money in your account : %.2f\",x.money);\n\n            printf(\"\\n\\n\\tMENU\\n3.Deposit Money\\n4.Withdraw Money\\n\");\n            scanf(\"%d\",&amp;menu1);\n            break;\n\n        case 3:\n            printf(\"Please enter the amount of money you want to deposit : \");\n            scanf(\"%f\",&amp;deposit);\n\n            printf(\"\\nThe amount of money you deposit : %.2f\\n\", deposit);\n\n            x.money = deposit + x.money;\n\n            fwrite(&amp;x, sizeof(struct userRec), 1, fout); \n            fclose(fout);\n            printf(\"\\nThe total amount of money you deposit : %.2f\\n\",x.money);\n            break;\n\n        case 4:\n\n            printf(\"Please enter the amount of money you want to withdraw : \");\n            scanf(\"%f\",&amp;withdraw);\n\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "algorithm", "memory-management", "data-structures", "out-of-memory"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1556727594, "post_id": 55939280, "comment_id": 98531680, "body": "It sounds like your want the operations to be in a &quot;transaction&quot;. Searching for that or Software Transactional Memory may turn up answers."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1556728163, "post_id": 55939280, "comment_id": 98531936, "body": "Have you actually observed <code>malloc</code> returning <code>NULL</code>. One of the dirty little secrets of modern operating systems is that <code>malloc</code> may return a non-NULL pointer even when no memory is available. See for example, <a href=\"https://stackoverflow.com/questions/19750796\">this question</a>."}, {"owner": {"reputation": 155, "user_id": 11437601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db162dbf9d4406c30e63b1a1aa4c49ff?s=128&d=identicon&r=PG&f=1", "display_name": "Quo Si Than", "link": "https://stackoverflow.com/users/11437601/quo-si-than"}, "edited": false, "score": 0, "creation_date": 1556728512, "post_id": 55939280, "comment_id": 98532070, "body": "I&#39;m more interested in conceptual techniques of handling this issue. I am implementing this in C, but would like to be able to adopt similar techniques in case of other languages."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1556729303, "post_id": 55939280, "comment_id": 98532421, "body": "The cleanup code typically ends up being much longer and more convoluted than the allocation code it is cleaning up. Absent automatic support via software transactional memory, you have to keep appropriate records of the &#39;before&#39; state and make the changes carefully so that you can recover it.  You also need to decide what to do if a <code>realloc()</code> changes the location of a grown block of memory. Is it OK to resize the new block down to the original size, or must you be able to return the original pointer. If you must return the original pointer, the chances are that you can&#39;t use <code>realloc()</code>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1556729431, "post_id": 55939280, "comment_id": 98532470, "body": "As an example, see the 3D memory allocation code discussed in <a href=\"https://stackoverflow.com/questions/18579583/segmentation-fault-error-in-3d-array-memory-allocation\">Segmentation fault error in 3D array memory allocation</a>.   Since you mention C++, you might want to think about using it.  Its constructors and destructors and modern C++ idioms for moving memory/objects makes the process easier to manage."}], "answers": [{"comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1556729743, "post_id": 55939636, "comment_id": 98532604, "body": "I agree with the dry run approach. But duplication seems like it makes the problem worse, since you&#39;ll need to allocate memory to create the duplicate."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1556730343, "post_id": 55939636, "comment_id": 98532845, "body": "@user3386109 yes, but if that allocation fails you can abort easily since you haven&#39;t modified anything yet. I agree it is not the best solution but some times it is the only suitable solution especially if rollback wasn&#39;t included in the design from the very beginning."}], "tags": [], "owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "is_accepted": true, "score": 5, "last_activity_date": 1556729246, "creation_date": 1556729246, "answer_id": 55939636, "question_id": 55939280, "link": "https://stackoverflow.com/questions/55939280/undoing-changes-in-c-dynamic-data-structures-when-memory-shortage-occurs-in-the/55939636#55939636", "title": "Undoing changes in C dynamic data structures when memory shortage occurs in the middle of operation", "body": "<p>The usual approach for handling such cases, is you first do a dry run and allocate the memory required for the entire operation. And actually make the update only if all the allocations succeed. </p>\n\n<p>Of course this might not <em>always</em> be possible because you might have to call other operations that do not have the \"dry run\" mode or some allocations might not be revealed until you actually perform the operation. For such cases, duplicating the data structure is usually the best option. Again, since the duplication is a read only operation, it is easy to abort and reverse. </p>\n\n<p>The user might want to avoid the overhead of duplication and tracking extra data structures or doing dry runs. So this feature can be made as an optional feature (maybe use <code>#ifdef</code>), where the user can choose between reversing the operation or terminating the entire program. </p>\n"}, {"tags": [], "owner": {"reputation": 8739, "user_id": 5603247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c27998979eedac7a3737411e77b0bf4b?s=128&d=identicon&r=PG&f=1", "display_name": "Hans Olsson", "link": "https://stackoverflow.com/users/5603247/hans-olsson"}, "is_accepted": false, "score": 1, "last_activity_date": 1556793678, "creation_date": 1556793678, "answer_id": 55950654, "question_id": 55939280, "link": "https://stackoverflow.com/questions/55939280/undoing-changes-in-c-dynamic-data-structures-when-memory-shortage-occurs-in-the/55950654#55950654", "title": "Undoing changes in C dynamic data structures when memory shortage occurs in the middle of operation", "body": "<p>In C++ one common approach is to construct the result in a form of \"temporary\" and then  swap the temporary and the result. You might also do additional changes that cannot fail after the swap.</p>\n\n<p>You might look at <a href=\"https://stackoverflow.com/questions/3279543/what-is-the-copy-and-swap-idiom\">What is the copy-and-swap idiom?</a> for inspiration - even if that is a specific use of the swap, and you might not need the copy-part.</p>\n"}], "owner": {"reputation": 155, "user_id": 11437601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db162dbf9d4406c30e63b1a1aa4c49ff?s=128&d=identicon&r=PG&f=1", "display_name": "Quo Si Than", "link": "https://stackoverflow.com/users/11437601/quo-si-than"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 2, "accepted_answer_id": 55939636, "answer_count": 2, "score": 3, "last_activity_date": 1556793678, "creation_date": 1556727411, "last_edit_date": 1556728965, "question_id": 55939280, "link": "https://stackoverflow.com/questions/55939280/undoing-changes-in-c-dynamic-data-structures-when-memory-shortage-occurs-in-the", "title": "Undoing changes in C dynamic data structures when memory shortage occurs in the middle of operation", "body": "<p>I'm implementing some complicated data structure in C supporting various operations. This data structure uses many other dynamic structures (graphs, AVL trees, linked lists) and everything is using dynamic memory.</p>\n\n<p>When doing some operation, for example insertion to my data structure, obviously I have to allocate memory, sometimes lots of it (so the structure grows). This can lead to memory shortage (malloc() returning NULL) in the middle of performing some operation. Now, I would like not to terminate my program, but let the caller of the operation know that operation failed and let the caller continue executing.</p>\n\n<p>My problem is that when operation fails in the middle of its execution due to memory allocation failure, I would like to undo what was done since calling of the operation, undo those changes in the data structure, so as if this operation was never called (so revert the data structure to the state right before executing the operation). I need this because I want my data structure to be in a valid and usable state even if an operation fails, so I can continue using it.</p>\n\n<p>Since the data structure is quite advanced, I'm looking for general methods, hints and tips regarding reverting dynamic data structure to its' state right before calling an operation. Maybe you have some experience in handling such issues, heard of this problem or can suggest some books/articles regarding it or related source codes.</p>\n\n<p>EDIT: A little simplified example would be set&lt;> from C++. According to STL documentation, set::insert works well even when exception is thrown, so it is somehow able to revert changes made during execution of set::insert even though underlying data structure of set (red-black trees probably) is quite advanced.</p>\n\n<p>Quote from cplusplus.com: \"If a single element is to be inserted, there are no changes in the container in case of exception (strong guarantee).\nOtherwise, the container is guaranteed to end in a valid state (basic guarantee).\"</p>\n"}, {"tags": ["c", "substring"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1556726759, "post_id": 55938929, "comment_id": 98531327, "body": "All information needed to answer the question should appear in the question itself. In addition to example code demonstrating the problem, that should include any required input data (small, please), the expected output, and the actual output.  As text, if in fact the output is textual.  Links to external sites are not acceptable for this purpose."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1556727071, "post_id": 55938929, "comment_id": 98531475, "body": "<code>memcpy(substring, char_start, char_end - char_start + 1);</code> You forgot to NUL-terminate the string.(plus:you (probably) dont need the+1)"}], "answers": [{"tags": [], "owner": {"reputation": 1180, "user_id": 4766261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dd4d03badb6ebc92b17af75766fdd57?s=128&d=identicon&r=PG", "display_name": "SiggiSv", "link": "https://stackoverflow.com/users/4766261/siggisv"}, "is_accepted": true, "score": 1, "last_activity_date": 1556813265, "last_edit_date": 1556813265, "creation_date": 1556745303, "answer_id": 55942789, "question_id": 55938929, "link": "https://stackoverflow.com/questions/55938929/print-all-k-mer-of-strings-that-are-in-a-file/55942789#55942789", "title": "Print all k-mer of strings that are in a file", "body": "<p>I noticed that every line in your file except the last one ends with a <code>'\\n'</code>. Since <code>getline()</code> also writes the <code>\\n</code> into <code>line</code> (when it is found in the file), then <code>strlen(line)</code> will always be one more than the number of visible characters in that line, EXCEPT when working with the last line since it doesn't contain <code>'\\n'</code>.</p>\n\n<p>As an example, when working with the second to last line in your file, <code>line</code> will contain <code>\"CAGTGAA\\n\\0\"</code>. Not counting the terminating <code>'\\0'</code>, those are 7 alphabetic character + the <code>'\\n'</code>-character. A total of 8 which will be what <code>strlen(line)</code> will return. Therefore <code>strlen(line) - k</code> will be equal to 3 resulting in the <code>for</code>-loop looping 3 times.</p>\n\n<p>But when working with the last line in your file, <code>line</code> will contain <code>\"TGAACGGTA\\0\"</code>. Not counting the terminating <code>'\\0'</code>, those are 9 alphabetic character but NO <code>'\\n'</code>-character so <code>strlen(line)</code> will only return 9. Therefore <code>strlen(line) - k</code> will be equal to 4 resulting in the <code>for</code>-loop only looping 4 times instead of 5 times resulting in the 5th k-mer not being generated.</p>\n\n<p>What you need to do is one of the following:</p>\n\n<p>A)\nAdd an empty line at the end of your file so that the currently last line also ends with a <code>'\\n'</code>.</p>\n\n<p>or: \nB)\nChange the <code>for</code>-loop:</p>\n\n<pre><code>  while ( (read = getline(&amp;line, &amp;len, stdin)) != -1 ) {\n    for ( i = 0; line[i+k-1] != '\\n' &amp;&amp; line[i+k-1] != '\\0'; i++ )\n</code></pre>\n\n<p>or:\nC)\nOverwrite <code>'\\n'</code> when it's at the end of the line with a terminating <code>'\\0'</code> so that the lines only contain the alphabetic characters you want to work with. Then change the condition in the <code>for</code>-loop to take into account that the lines are now one character shorter than before. (Note that since <code>getline()</code> returns the number of characters writen,not counting <code>'\\0'</code>, and you store that in <code>read</code>, then there is no need to recalculate the lenght of the string again and again):</p>\n\n<pre><code>  while ( (read = getline(&amp;line, &amp;len, stdin)) != -1 ) {\n    if (line[read - 1] == '\\n') line[--read] = '\\0';\n    for ( i = 0; i &lt;= read - k; i++ )\n</code></pre>\n\n<hr>\n\n<p>There is at least one more problems with your code. You allocate space for <code>substring</code> each time <code>substr()</code> is called but you never free it, resulting in a memory leak (strictly speaking you should also free <code>line</code>). </p>\n"}], "owner": {"reputation": 1134, "user_id": 6608222, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rO2Iu.png?s=128&g=1", "display_name": "th3g3ntl3man", "link": "https://stackoverflow.com/users/6608222/th3g3ntl3man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "closed_date": 1556788822, "accepted_answer_id": 55942789, "answer_count": 1, "score": 0, "last_activity_date": 1556813265, "creation_date": 1556725604, "last_edit_date": 1556749197, "question_id": 55938929, "link": "https://stackoverflow.com/questions/55938929/print-all-k-mer-of-strings-that-are-in-a-file", "closed_reason": "Not suitable for this site", "title": "Print all k-mer of strings that are in a file", "body": "<p>I have a file that contains a list of strings. I try to generate all k-mer of these. This is my code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nchar* substr(const char *string, size_t start, size_t end) {\n\n  const char *char_start = &amp;string[start];\n  const char *char_end = &amp;string[end];\n\n  char *substring = (char *) calloc(1, char_end - char_start + 1);\n  memcpy(substring, char_start, char_end - char_start + 1);\n\n  return substring;\n}\n\nint main(void) {\n  FILE *file;\n  file = fopen(\"out/clean_read_1.txt\", \"r\");\n  if (file == NULL) {\n    perror(\"File not found!\\n\");\n    exit(0);\n  } \n\n  char *line = NULL;\n  size_t i, len = 0, k = 5;\n  ssize_t read;\n\n  while ( (read = getline(&amp;line, &amp;len, file)) != -1 ) {\n    for ( i = 0; i &lt; strlen(line) - k; i++ )\n      printf(\"%s\\n\", substr(line, i, i + k - 1));\n  }\n\n  printf(\"\\n\");\n\n  fclose(file);\n\n  return 0;\n}\n</code></pre>\n\n<p>This is the file:</p>\n\n<pre><code>ACCAG\nCAGTGAA\nTGAACGGTA\n</code></pre>\n\n<p>I don't understand why the code don't generate the last k-mer.</p>\n\n<p>Expected correct output:</p>\n\n<pre><code>ACCAG\nCAGTG\nAGTGA\nGTGAA\nTGAAC\nGAACG\nAACGG\nACGGT\nCGGTA\n</code></pre>\n\n<p>Incorrect output of my code:</p>\n\n<pre><code>ACCAG\nCAGTG\nAGTGA\nGTGAA\nTGAAC\nGAACG\nAACGG\nACGGT\n</code></pre>\n"}, {"tags": ["c", "file"], "comments": [{"owner": {"reputation": 1, "user_id": 11437728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/065408d5305a64c4416b102d28df8ee3?s=128&d=identicon&r=PG", "display_name": "Peti", "link": "https://stackoverflow.com/users/11437728/peti"}, "edited": false, "score": 0, "creation_date": 1556725024, "post_id": 55938796, "comment_id": 98530537, "body": "Forgot the Netstat.txt: <a href=\"https://drive.google.com/open?id=1J6IdaSOCLwKXOepBMAf0aPjjk15DIN_q\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1556725395, "post_id": 55938796, "comment_id": 98530704, "body": "Please indent your code consistently"}, {"owner": {"reputation": 1, "user_id": 11437728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/065408d5305a64c4416b102d28df8ee3?s=128&d=identicon&r=PG", "display_name": "Peti", "link": "https://stackoverflow.com/users/11437728/peti"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556725519, "post_id": 55938796, "comment_id": 98530760, "body": "What do you mean? This is the whole code"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1556725858, "post_id": 55938796, "comment_id": 98530942, "body": "Call <code>rewind(file);</code> to reset the file position back to the start of the file before the second pass."}], "owner": {"reputation": 1, "user_id": 11437728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/065408d5305a64c4416b102d28df8ee3?s=128&d=identicon&r=PG", "display_name": "Peti", "link": "https://stackoverflow.com/users/11437728/peti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556726274, "creation_date": 1556724996, "last_edit_date": 1556726274, "question_id": 55938796, "link": "https://stackoverflow.com/questions/55938796/counting-the-number-of-rows-of-a-program-then-working-with-them-not-working-toge", "title": "Counting the number of rows of a program then working with them not working together", "body": "<p>I wrote a code that first counts all the rows of a file, then I want it to re-check the rows for word filters and get info out of them. If I have both functions at once, the first function (counting the rows) blocks the second one (filtering for stuff).</p>\n\n<p>Both of the functions work (counting all the rows and printing out the IP/Port), but only if one of them is deleted.</p>\n\n<p>I think that the second while, that starts the filtering, wants to start at the bottom of the file and doesn't find anything and just stops.</p>\n\n<pre><code>char getIP(const char source[300], char result[300])\n{\n    int cnt;\n    const char *readIn;\n    readIn = strstr(source, \"172\");\n\n    for(cnt = 0; readIn[cnt] != ':'; cnt++)\n        result[cnt] = readIn[cnt];\n    result[cnt] = '\\0';\n    return 0;\n}\n\nchar getPort(const char source[300], char result[300])\n{\n    int cnt;\n    const char *readIn;\n    readIn = strchr(source, ':');\n\n    for(cnt = 0; readIn[cnt] != ' '; cnt++)\n        result[cnt] = readIn[cnt];\n    result[cnt] = '\\0';\n    return 0;\n}\n\nint main()\n{\n    FILE *file;\n    file = fopen(\"Netstat.txt\", \"r+\");\n    if(file == NULL)\n    {\n        perror(\"Netstat.txt\");\n        return 1;\n    }\n    char row[300], IP[30], Port[10];\n    char *temp;\n    int row_cnt = 0, readytostart = 0, cnt;\n    while(fgets(row, 300, file) != NULL)\n        row_cnt++;\n    printf(\"Number of Rows: %d\\n\", row_cnt);\n\n    while(fgets(row, 300, file) != NULL)\n    {\n        temp = row;\n        if(temp[0] == '#' &amp;&amp; temp[1] == '#' &amp;&amp; temp[2] == '#')\n            readytostart = 1;\n        if(readytostart &gt; 0)\n        {\n            if(strstr(row, \"HERGESTELLT\") != NULL &amp;&amp; strstr(row, \"127.0.0.1\") == NULL)\n            {\n              getIP(row, IP); getPort(row, Port);\n              printf(\"IP Adresse: %s  Port: %s\\n\", IP, Port);\n            }\n        }\n    }\n    fclose(file);\n    return 0;\n}\n</code></pre>\n\n<p>I want my code to count all the rows first, so I get a number at the end, then look through all the rows again that has the word \"HERGESTELLT\" but not the IP Address of 127.0.0.1. If that's the case, the IP address and Port should be copied into new arrays and then printed out with printf.</p>\n"}, {"tags": ["c", "operating-system"], "comments": [{"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556725366, "post_id": 55938779, "comment_id": 98530700, "body": "First of all indent your code properly."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11432153"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556725768, "post_id": 55938779, "comment_id": 98530888, "body": "@Jabberwocky I am sorry i edited it."}], "owner": {"user_type": "does_not_exist", "display_name": "user11432153"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556728809, "creation_date": 1556724932, "last_edit_date": 1556728809, "question_id": 55938779, "link": "https://stackoverflow.com/questions/55938779/passing-a-value-via-named-pipes-in-c", "title": "Passing a value via named pipes in c", "body": "<p>I have this code that creates 3 child processes from a father. For each child, I have an array <code>pid[i]</code> that has -1 values for every <code>i != i (number)</code> of the child so I can isolate each child code using <code>if(pid[i]==0)</code>. First child passes value 1 to second child. Second child computes <code>1*2</code> and passes it to third child and third child computes <code>(1*2)*3</code>. </p>\n\n<p>Code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;fcntl.h&gt;\n\nint mkfifo(const char *path, mode_t mode);\n\nint main(int argc, char **argv)\n{\n    int fd,rec,recs;\n    char * myfifo = \"/tmp/myfifo\";\n    mkfifo(myfifo, 0666);\n    pid_t pid[4];\n    pid[1]=fork();\n    if(pid[1]==0){\n        pid[2]=-1;\n        pid[3]=-1;\n             }\n    if(pid[1]&gt;0){\n       pid[2]=fork();\n       if(pid[2]==0){\n          pid[1]=-1;\n          pid[3]=-1;\n       }\n         if(pid[2]&gt;0){\n           pid[3]=fork();\n           if(pid[3]==0){\n              pid[1]=-1;\n              pid[2]=-1;\n           }\n             }\n    wait(0);\n    }\n\n    if(pid[1]==0){\n      rec=1;\n      fd = open(myfifo, O_WRONLY);\n      write(fd, &amp;rec, sizeof(rec));\n      close(fd);\n    }\n    if(pid[2]==0){\n        fd = open(myfifo, O_RDONLY);\n        read(fd, &amp;recs, sizeof(recs));\n        rec=recs*2;\n        printf(\" passed value is %d \\n\",rec);\n        fd = open(myfifo, O_WRONLY);\n        write(fd, &amp;rec, sizeof(rec));\n        close(fd);\n    }\n    if(pid[3]==0){\n        fd = open(myfifo, O_RDONLY);\n        read(fd, &amp;recs, sizeof(recs));\n        rec=recs*3;\n        printf(\" passed value is %d \\n\",rec);\n        fd = open(myfifo, O_WRONLY);\n        write(fd, &amp;rec, sizeof(rec));\n        close(fd);\n    }\n}\n</code></pre>\n\n<p>I expect this program to print:</p>\n\n<pre><code>passed value is 2\npassed value is 6\n</code></pre>\n\n<p>However I get different results every time I run it (it may produce the right result). Why is this happening and how can I control this?</p>\n"}, {"tags": ["c", "multithreading", "struct"], "comments": [{"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1556725036, "post_id": 55938769, "comment_id": 98530547, "body": "<code>(void *)&amp;customer</code> is a pointer-to-pointer."}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1556725072, "post_id": 55938769, "comment_id": 98530564, "body": "Also, <code>CustomerFunc</code> should return a value."}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 1, "creation_date": 1556725113, "post_id": 55938769, "comment_id": 98530581, "body": "Also, you should wait for the thread to complete before trying to print the result."}, {"owner": {"reputation": 743, "user_id": 10037034, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3uWGEEAh9Xg/AAAAAAAAAAI/AAAAAAAAAAc/AerrmoOrjqM/photo.jpg?sz=128", "display_name": "\u015eevval Kahraman", "link": "https://stackoverflow.com/users/10037034/%c5%9eevval-kahraman"}, "reply_to_user": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1556725129, "post_id": 55938769, "comment_id": 98530591, "body": "but i dont want this func to return value @JohnnyMopp"}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1556725229, "post_id": 55938769, "comment_id": 98530643, "body": "The function prototype says it should return a <code>void *</code>. If you don&#39;t want to return anything, change to <code>void CustomerFunc(void *customer) {</code>."}, {"owner": {"reputation": 743, "user_id": 10037034, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3uWGEEAh9Xg/AAAAAAAAAAI/AAAAAAAAAAc/AerrmoOrjqM/photo.jpg?sz=128", "display_name": "\u015eevval Kahraman", "link": "https://stackoverflow.com/users/10037034/%c5%9eevval-kahraman"}, "reply_to_user": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 0, "creation_date": 1556725432, "post_id": 55938769, "comment_id": 98530722, "body": "okey, can we think about the main problem ?"}], "answers": [{"comments": [{"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1556730414, "post_id": 55938951, "comment_id": 98532862, "body": "Re, &quot;...You could also use a mutex lock for this...&quot; That makes it sound as if using the mutex would somehow ensure that the threads access the variable in the right order. But a mutex alone can never do that. Wrapping the shared variable access in a mutex would ensure that both threads see a consistent view of the shared data, but the outcome of the program still would depend on a race: It would depend on which thread won the race to lock the mutex."}, {"owner": {"reputation": 25637, "user_id": 6243352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/715f60f9edc65642a6805752cfeebb27?s=128&d=identicon&r=PG&f=1", "display_name": "ggorlen", "link": "https://stackoverflow.com/users/6243352/ggorlen"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1556731930, "post_id": 55938951, "comment_id": 98533512, "body": "That&#39;s a good point, mutex isn&#39;t going to ensure ordering without a condition variable or semaphore. Corrected."}], "tags": [], "owner": {"reputation": 25637, "user_id": 6243352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/715f60f9edc65642a6805752cfeebb27?s=128&d=identicon&r=PG&f=1", "display_name": "ggorlen", "link": "https://stackoverflow.com/users/6243352/ggorlen"}, "is_accepted": true, "score": 3, "last_activity_date": 1556732092, "last_edit_date": 1592644375, "creation_date": 1556725706, "answer_id": 55938951, "question_id": 55938769, "link": "https://stackoverflow.com/questions/55938769/how-can-i-change-structs-variable-in-function-by-using-threads/55938951#55938951", "title": "How can I change struct&#39;s variable in function by using threads?", "body": "<p>There are a couple issues to resolve:</p>\n<ol>\n<li><p>You have a <a href=\"https://en.wikipedia.org/wiki/Race_condition#Software\" rel=\"nofollow noreferrer\">race condition</a> between the <code>main</code> and the worker thread on the <code>customer</code> struct. The threads rush in at the same time trying to access the <code>reservable</code> field and it's non-deterministic as to which thread makes it there first.</p>\n<p>One option is to make the <code>main</code> thread wait for the worker thread to finish (using <a href=\"http://man7.org/linux/man-pages/man3/pthread_join.3.html\" rel=\"nofollow noreferrer\"><code>pthread_join</code></a>) before attempting to print the updated value, or use a conditional construct like a semaphore to ensure ordering (depending on your application goals). Always <code>detach</code> or <code>join</code> your threads.</p>\n</li>\n<li><p><code>customer</code> is already a pointer, so you can just pass it into the worker function as-is, without taking the address using <code>&amp;</code>, which makes its type <code>Customer **</code>. Had you allocated <code>customer</code> on the local function stack rather than the heap, it'd be appropriate to use <code>&amp;</code>.</p>\n</li>\n</ol>\n<p>...and a few less critical suggestions...</p>\n<ol start=\"3\">\n<li><p>Remember to free <code>customer</code>'s memory to avoid a leak.</p>\n</li>\n<li><p>Return a <code>void *</code> value from the worker function.</p>\n</li>\n<li><p><code>abc</code> is a confusing variable name--<code>threads</code> is more accurate. Same for <code>t</code>, <code>rc</code> and <code>a</code>.</p>\n</li>\n<li><p><a href=\"https://stackoverflow.com/questions/605845/do-i-cast-the-result-of-malloc\">No need</a> to cast the return value of <code>malloc</code>.</p>\n</li>\n</ol>\n<p>Here's an updated version:</p>\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define NUM_THREADS 1\n\ntypedef struct {\n    int id;\n    int reservable;\n} Customer;\n\nvoid *CustomerFunc(void *arg) {\n    Customer *customer = (Customer *)arg;\n    printf(&quot;reservable %d\\n&quot;, customer-&gt;reservable);\n    customer-&gt;reservable = 5;\n    return NULL;\n}\n\nint main(int argc, char *argv[]) {\n    pthread_t threads[NUM_THREADS];\n    Customer *customer = malloc(sizeof(Customer));\n    customer-&gt;id = 1;\n    customer-&gt;reservable = 2;\n\n    pthread_create(&amp;threads[0], NULL, CustomerFunc, customer);\n    pthread_join(threads[0], NULL);\n\n    printf(&quot;reservable MAIN %d\\n&quot;, customer-&gt;reservable);\n    free(customer);    \n    return 0;\n}\n</code></pre>\n<p>Output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>reservable 2\nreservable MAIN 5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 1, "last_activity_date": 1556725866, "creation_date": 1556725866, "answer_id": 55938982, "question_id": 55938769, "link": "https://stackoverflow.com/questions/55938769/how-can-i-change-structs-variable-in-function-by-using-threads/55938982#55938982", "title": "How can I change struct&#39;s variable in function by using threads?", "body": "<p>When you create a new thread, it runs independently of the main thread.  This means that nothing is stopping the <code>printf</code> in <code>main</code> from executing before <code>CustomerFunc</code> makes any change.</p>\n\n<p>A simple way to fix this is for the main thread to wait until the new thread finishes by calling <code>pthread_join</code>.</p>\n\n<p>You're also not passing <code>customer</code> to <code>pthread_create</code> properly.  <code>&amp;customer</code> has type <code>Customer **</code> but your thread function is expecting a <code>Customer *</code>, so remove the address-of operator <code>&amp;</code>.</p>\n\n<pre><code>rc = pthread_create(&amp;abc[0],NULL,CustomerFunc, customer);\npthread_join(abc[0], NULL);\n\nprintf(\"reservable MAIN%d\", customer-&gt;reservable);\n</code></pre>\n"}], "owner": {"reputation": 743, "user_id": 10037034, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3uWGEEAh9Xg/AAAAAAAAAAI/AAAAAAAAAAc/AerrmoOrjqM/photo.jpg?sz=128", "display_name": "\u015eevval Kahraman", "link": "https://stackoverflow.com/users/10037034/%c5%9eevval-kahraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 55938951, "answer_count": 2, "score": 1, "last_activity_date": 1556732092, "creation_date": 1556724885, "last_edit_date": 1556725187, "question_id": 55938769, "link": "https://stackoverflow.com/questions/55938769/how-can-i-change-structs-variable-in-function-by-using-threads", "title": "How can I change struct&#39;s variable in function by using threads?", "body": "<p>I want to change the <code>struct</code> variable in the <code>thread</code> function as <code>global</code>.\nBut this doesn't work.</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#define NUM_THREADS 1\n\ntypedef struct{\nint id;\nint reservable;\n}Customer;\n\n\nvoid *CustomerFunc(void *customer){\nCustomer *a;\na = (Customer *)customer;\n  printf(\"reservable %d\", a-&gt;reservable);\na-&gt;reservable = 5;\n}\n\n\nint main (int argc, char *argv[]) {\npthread_t abc[NUM_THREADS];\nint rc; \nlong t;\nCustomer *customer = (Customer*)malloc(sizeof(Customer));\ncustomer-&gt;id = 1;\ncustomer-&gt;reservable = 2;\n\nrc = pthread_create(&amp;abc[0],NULL,CustomerFunc,(void *)&amp;customer);\n\nprintf(\"reservable MAIN%d\", customer-&gt;reservable);\npthread_exit(NULL);\n\n\n}\n</code></pre>\n\n<p>This code result is: </p>\n\n<blockquote>\n  <p><code>reservable: 0 reservable MAIN: 2</code></p>\n</blockquote>\n\n<p>But I want to see:</p>\n\n<blockquote>\n  <p><code>reservable: 2 reservable MAIN: 5</code></p>\n</blockquote>\n"}, {"tags": ["c", "struct", "copy"], "comments": [{"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 1, "creation_date": 1556724106, "post_id": 55938560, "comment_id": 98530064, "body": "What&#39;s wrong with using the parameter <code>A</code>?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556724207, "post_id": 55938560, "comment_id": 98530122, "body": "do you want the copy of the global A or from parameter  ?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556724229, "post_id": 55938560, "comment_id": 98530133, "body": "so what&#39;s wrong with <code>struct point Alocal = *A</code>?"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1556724277, "post_id": 55938560, "comment_id": 98530157, "body": "The name of the array is not <code>A[N]</code>. It is just <code>A</code>."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1556724354, "post_id": 55938560, "comment_id": 98530196, "body": "@AnttiHaapala That gives you a copy of the first <code>point</code> in the array. That&#39;s nothing like what the OP is asking for."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1556724611, "post_id": 55938560, "comment_id": 98530325, "body": "@LightnessRacesinOrbit who knows."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556724630, "post_id": 55938560, "comment_id": 98530333, "body": "First of all you need to determine if you <i>actually</i> need a copy in the function. If the function won&#39;t modify the local copy, it is pointless to make a copy, then you can just use the parameter <code>A</code>."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556724637, "post_id": 55938560, "comment_id": 98530339, "body": "@AnttiHaapala Who knows what?"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556724675, "post_id": 55938560, "comment_id": 98530359, "body": "@Jabberwocky Do we have any evidence that the OP hasn&#39;t made that determination before asking how to do it? This question is pretty straightforward and clear."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1556724724, "post_id": 55938560, "comment_id": 98530386, "body": "@LightnessRacesinOrbit this sounds like a beginner&#39;s question, and beginners often ask weird questions such as XY problems. BTW I upvoted your answer."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556724779, "post_id": 55938560, "comment_id": 98530411, "body": "@Jabberwocky Copying an array is not weird. And thanks!"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "reply_to_user": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1556724873, "post_id": 55938560, "comment_id": 98530462, "body": "@LightnessRacesinOrbit sorry if I my comment was poorly worded, of course copying an array isn&#39;t weird, but a the OP may asking the right question for a wrong reason."}], "answers": [{"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556725058, "post_id": 55938688, "comment_id": 98530557, "body": "you suppose the argument is the address of an array and also that array has N elements, you cannot know that (it can also be NULL but that is an other history)"}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556725149, "post_id": 55938688, "comment_id": 98530598, "body": "@bruno Yes, I spoke about <code>N</code> in the answer. And the function assumes that the argument <code>A</code> points to the array that the OP says it does."}], "tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": false, "score": 0, "last_activity_date": 1556724513, "creation_date": 1556724513, "answer_id": 55938688, "question_id": 55938560, "link": "https://stackoverflow.com/questions/55938560/c-struct-local-copy-inside-a-function/55938688#55938688", "title": "C struct local copy inside a function", "body": "<p>There is no one-step way to clone an array in C, so you're stuck creating a new one and copying contents:</p>\n\n<pre><code>struct point A[N];\n\nint function(struct point *A)\n{\n   int i = 0;\n   struct point ALocal[N];\n\n   memcpy(ALocal, A, sizeof(ALocal));\n}\n</code></pre>\n\n<p>Actually, I guess that's one step.</p>\n\n<p>Notice how you again have to know what <code>N</code> is. Consider passing it into <code>function</code> as a parameter, so that you can make sure it's right for that array.</p>\n\n<p>Also be careful to use <code>sizeof(ALocal)</code>, not <code>sizeof(A)</code>, because inside the function the name <code>A</code> just refers to a pointer, not the array itself, so the resulting <code>sizeof</code> it may not be what you expect.</p>\n"}, {"comments": [{"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 1, "creation_date": 1556725225, "post_id": 55938826, "comment_id": 98530640, "body": "Don&#39;t just dump code. Explain your solution and why it&#39;s good to use (which, in this case, it is!)"}], "tags": [], "owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "is_accepted": false, "score": 0, "last_activity_date": 1556725369, "last_edit_date": 1556725369, "creation_date": 1556725163, "answer_id": 55938826, "question_id": 55938560, "link": "https://stackoverflow.com/questions/55938560/c-struct-local-copy-inside-a-function/55938826#55938826", "title": "C struct local copy inside a function", "body": "<pre><code>struct  point_A_N\n{\n      struct point A[N];\n};\n\n\nint function(struct point_A_N an) \n{\n    struct point_A_N  z = an;\n}\n\n\n</code></pre>\n\n<p>structs are passed by value and are assigned by value. So when you assign the struct is copied to another. If you pass struct as a parameter you pass the copy of the whole structure. Same is if you return the structure (or union as well).</p>\n"}, {"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556725453, "post_id": 55938840, "comment_id": 98530733, "body": "you do not do a &quot;local copy&quot; (I UV anyway because I globally agree with you ;-) )"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556725778, "post_id": 55938840, "comment_id": 98530892, "body": "Thanks for the UV, @bruno.  This answer most certainly does provide for the obtaining a local copy of the array, however, as the OP asked.  What it does not do is arrange to pass the array by value, but that is only one avenue to the requested result, and one that would require substantial restructuring of the OP&#39;s other code."}, {"owner": {"reputation": 13, "user_id": 8923882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1019f31907ff5b9f0c3a0c8ddb07eaf7?s=128&d=identicon&r=PG&f=1", "display_name": "DanielC", "link": "https://stackoverflow.com/users/8923882/danielc"}, "edited": false, "score": 0, "creation_date": 1556725844, "post_id": 55938840, "comment_id": 98530930, "body": "why not   sizeof(struct point)   instead of sizeof(*localA)   ?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 13, "user_id": 8923882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1019f31907ff5b9f0c3a0c8ddb07eaf7?s=128&d=identicon&r=PG&f=1", "display_name": "DanielC", "link": "https://stackoverflow.com/users/8923882/danielc"}, "edited": false, "score": 3, "creation_date": 1556726034, "post_id": 55938840, "comment_id": 98531022, "body": "Because <code>sizeof(*localA)</code> is better style, @DanielC.  It minimizes the possibility of making a mistake in what size you actually need, and it adapts automatically if you later change the type to which the pointer points.  With the declarations given, however, <code>sizeof(*localA)</code> will evaluate to the same value as <code>sizeof(struct point)</code>."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 2, "last_activity_date": 1556726561, "last_edit_date": 1556726561, "creation_date": 1556725236, "answer_id": 55938840, "question_id": 55938560, "link": "https://stackoverflow.com/questions/55938560/c-struct-local-copy-inside-a-function/55938840#55938840", "title": "C struct local copy inside a function", "body": "<p>Your function signature is not appropriate for making a local copy of an array whose address it receives via its argument.  In order to do that, the function needs to know how many elements the array contains, and the function parameters do not convey that information.  Perhaps, then, you want a signature more like this:</p>\n\n<pre><code>int function(struct point *A, size_t N) {\n    // ...\n</code></pre>\n\n<p>In that case, your most reliable move is to allocate the local copy dynamically:</p>\n\n<pre><code>    struct point *localA = malloc(N * sizeof(*localA));\n\n    if (!localA) {\n        // fail, maybe with:\n        return -1;\n    }\n</code></pre>\n\n<p>Having successfully allocated space, you can make a shallow copy of the array via the <code>memcpy()</code> function:</p>\n\n<pre><code>    memcpy(localA, A, N * sizeof(*localA));\n</code></pre>\n\n<p>You can then perform whatever operations you want on the local copy, but note that it is a <em>shallow</em> copy.  That is, if <code>struct point</code> contains any pointers then it is the pointers themselves that will be copied, not the data to which they point.</p>\n\n<pre><code>    // do something ...\n</code></pre>\n\n<p>Ultimately, you must be certain that on every code path, the allocated space is freed before the function returns, or that in some way responsibility for freeing it is handed off.</p>\n\n<pre><code>    free(localA);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8923882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1019f31907ff5b9f0c3a0c8ddb07eaf7?s=128&d=identicon&r=PG&f=1", "display_name": "DanielC", "link": "https://stackoverflow.com/users/8923882/danielc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "closed_date": 1556747749, "accepted_answer_id": 55938840, "answer_count": 3, "score": -2, "last_activity_date": 1556726561, "creation_date": 1556723992, "question_id": 55938560, "link": "https://stackoverflow.com/questions/55938560/c-struct-local-copy-inside-a-function", "closed_reason": "Needs details or clarity", "title": "C struct local copy inside a function", "body": "<p>I have a struct named \"point\", and an array of \"points\", named \"A[N]\". \nI also have a function, where I want to have a local copy of \"A\".\nHow should I do in order to optain a local copy of \"A\", inside the function?</p>\n\n<pre><code>struct point A[N];\nint function(struct point *A)\n{\n   struct point *ALocal;\n\n   ...\n\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "multithreading"], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 7153674, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072831586147917/picture?type=large", "display_name": "S&#238;rb Sebastian", "link": "https://stackoverflow.com/users/7153674/s%c3%aerb-sebastian"}, "edited": false, "score": 0, "creation_date": 1556787580, "post_id": 55939405, "comment_id": 98550400, "body": "Can u be more specific how can I use posix semaphores? How the thread from another process could know about the ending of another thread from another process?"}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "reply_to_user": {"reputation": 19, "user_id": 7153674, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072831586147917/picture?type=large", "display_name": "S&#238;rb Sebastian", "link": "https://stackoverflow.com/users/7153674/s%c3%aerb-sebastian"}, "edited": false, "score": 0, "creation_date": 1556788610, "post_id": 55939405, "comment_id": 98550943, "body": "@S&#238;rbSebastian You can make each of the events you wait for a semaphore. Then just wait and signal those semaphores."}, {"owner": {"reputation": 19, "user_id": 7153674, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072831586147917/picture?type=large", "display_name": "S&#238;rb Sebastian", "link": "https://stackoverflow.com/users/7153674/s%c3%aerb-sebastian"}, "edited": false, "score": 0, "creation_date": 1556789292, "post_id": 55939405, "comment_id": 98551289, "body": "So in a process I make the thread wait with sem_wait and in the other one when the thread I&#39;m waiting ends I do a sem_post?"}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "reply_to_user": {"reputation": 19, "user_id": 7153674, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072831586147917/picture?type=large", "display_name": "S&#238;rb Sebastian", "link": "https://stackoverflow.com/users/7153674/s%c3%aerb-sebastian"}, "edited": false, "score": 0, "creation_date": 1556789655, "post_id": 55939405, "comment_id": 98551465, "body": "@S&#238;rbSebastian Yes, exactly that."}, {"owner": {"reputation": 19, "user_id": 7153674, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072831586147917/picture?type=large", "display_name": "S&#238;rb Sebastian", "link": "https://stackoverflow.com/users/7153674/s%c3%aerb-sebastian"}, "edited": false, "score": 0, "creation_date": 1556790003, "post_id": 55939405, "comment_id": 98551641, "body": "Thanks a lot. And if I don&#39;t want to block the process, I must delete wait(NULL) for that process?"}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "reply_to_user": {"reputation": 19, "user_id": 7153674, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072831586147917/picture?type=large", "display_name": "S&#238;rb Sebastian", "link": "https://stackoverflow.com/users/7153674/s%c3%aerb-sebastian"}, "edited": false, "score": 0, "creation_date": 1556790563, "post_id": 55939405, "comment_id": 98551904, "body": "@S&#238;rbSebastian It probably calls <code>wait</code> too early."}], "tags": [], "owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "is_accepted": true, "score": 1, "last_activity_date": 1556728104, "creation_date": 1556728104, "answer_id": 55939405, "question_id": 55938419, "link": "https://stackoverflow.com/questions/55938419/process-stuck-in-waiting/55939405#55939405", "title": "process stuck in waiting", "body": "<p>To generate that process tree the main process must do 2 calls to <code>fork</code> to create 2 child processes. This code blocks the main process after the first <code>fork</code>. The process creating code must be redone.</p>\n\n<p>The mutexes and condition variables are not shared between the processes because each process has its own private address space. The mutexes and condition variables must be placed in shared memory in order to be shared across processes. Alteratively, use <a href=\"http://man7.org/linux/man-pages/man7/sem_overview.7.html\" rel=\"nofollow noreferrer\">POSIX semaphores</a>.</p>\n"}], "owner": {"reputation": 19, "user_id": 7153674, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072831586147917/picture?type=large", "display_name": "S&#238;rb Sebastian", "link": "https://stackoverflow.com/users/7153674/s%c3%aerb-sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 55939405, "answer_count": 1, "score": 0, "last_activity_date": 1556728104, "creation_date": 1556723419, "question_id": 55938419, "link": "https://stackoverflow.com/questions/55938419/process-stuck-in-waiting", "title": "process stuck in waiting", "body": "<p>I'm having trouble with threads synchronization on Linux.  I must generate the process hierarchy from this picture ( this part i managed to do)<a href=\"https://i.stack.imgur.com/hhxNV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hhxNV.png\" alt=\"enter image description here\"></a>.</p>\n\n<p>But next I have to synchronize threads from different processes. The process P2 must create 6 threads and the process P6 must create 5 threads. And then the thread 5 from P2 must only start after the thread 3 from P6 has completed. I use conditional variables, but while I'm waiting for the thread 3 from P6 to end, process 2 remain blocked and I never reach to process 6 to create his threads. The function info is used to display the beginning and the end of the thread.\nI cannot use sleep or usleep</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;semaphore.h&gt;\n\n\npthread_cond_t p2_t4=PTHREAD_COND_INITIALIZER;\npthread_mutex_t lock1=PTHREAD_MUTEX_INITIALIZER;\nint end=-1;\n\nvoid* function(void* arg)\n{\n    int* nrth=(int*) arg;\n    info(BEGIN,6,*nrth);\n    info(END,6,*nrth);\n\n    pthread_mutex_lock(&amp;lock1);\n    if(*nrth==3)\n    {\n        end=1;\n        pthread_cond_signal(&amp;p2_t4);\n    }\n    pthread_mutex_unlock(&amp;lock1);\n\n    return 0;\n}\n\n\nvoid* function2(void* arg)\n{\nint* nrth=(int*) arg;\n\npthread_mutex_lock(&amp;lock1);\nif(*nrth==4)\n{\n    while(end==-1)\n        pthread_cond_wait(&amp;p2_t4,&amp;lock1);\n}\npthread_mutex_unlock(&amp;lock1);\n\ninfo(BEGIN,2,*nrth);\ninfo(END,2,*nrth);\nreturn 0;\n}\n\n\nint main()\n{\n\npthread_t threads[6];\nint index[5];\n\npthread_t threads2[7];\nint index2[7];\n\n\nif(fork()!=0)\n{\n    //info(BEGIN,1,0);\n    wait(NULL);\n\n    if(fork()!=0)\n    {\n        wait(NULL);\n    }\n    else\n    {\n        //info(BEGIN,3,0);\n\n        if(fork()!=0)\n        {\n            wait(NULL);\n            if(fork()!=0)\n            {\n                wait(NULL);\n            }\n            else\n            {\n                //info(BEGIN,6,0);\n\n\n                for(int i=1; i&lt;=5; i++)\n                {\n                    index[i]=i;\n                    pthread_create(&amp;threads[i],NULL,function,&amp;index[i]);\n                }\n\n                for(int i=1; i&lt;=5; i++)\n                {\n                    pthread_join(threads[i],NULL);\n                }\n\n                //info(END,6,0);\n                //info(END,3,0);\n                //info(END,1,0);\n            }\n        }\n        else\n        {\n            //info(BEGIN,5,0);\n            //info(END,5,0);\n        }\n    }\n}\nelse\n{\n    //info(BEGIN,7,0);\n    wait(NULL);\n\n    for(int i=1; i&lt;=6; i++)\n    {\n        index2[i]=i;\n        pthread_create(&amp;threads2[i],NULL,function2,&amp;index2[i]);\n    }\n\n    for(int i=1; i&lt;=6; i++)\n    {\n        pthread_join(threads2[i],NULL);\n    }\n\n\n    if(fork()!=0)\n    {\n        wait(NULL);\n        if(fork()!=0)\n        {\n            wait(NULL);\n        }\n        else\n        {\n            //info(BEGIN,7,0);\n            //info(END,7,0);\n            //info(END,2,0);\n        }\n    }\n    else\n    {\n        //info(BEGIN,4,0);\n        //info(END,4,0);\n    }\n\n}\nreturn 0;\n}\n</code></pre>\n"}, {"tags": ["c", "malloc", "free"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1556718473, "post_id": 55937242, "comment_id": 98527195, "body": "What do you mean by &quot;fail&quot;?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1556718871, "post_id": 55937242, "comment_id": 98527396, "body": "There is a difference between a pointer and the data to which it points, and it is crucial that you understand it.  Freeing the memory in which a pointer is stored, such as the memory of the members of an instance of your structure, has no effect on data to which that pointer points."}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "edited": false, "score": 1, "creation_date": 1556718879, "post_id": 55937242, "comment_id": 98527400, "body": "Notice that the code does <b>not</b> access any members <b>after</b> call of <code>free</code>! You only access <code>a</code> and <code>b</code> which contains a <b>copy</b> of the member values <b>before</b> the <code>free</code>. It&#39;s perfectly valid code."}, {"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 2, "creation_date": 1556718931, "post_id": 55937242, "comment_id": 98527427, "body": "You&#39;re allocating into <code>elem1</code> then using <code>node</code>. I assume you meant to use <code>elem1</code> throughout."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 2, "creation_date": 1556718977, "post_id": 55937242, "comment_id": 98527455, "body": "@Downvoters: This question is well written, compiles, runs, and the OP has taken the time to document the actual and expected behaviour,  and it&#39;s not of the &quot;this is ub get over it&quot; ilk. Hence my upvote (and answer)."}, {"owner": {"reputation": 39, "user_id": 11437218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/658058060fbaf20715845eb25c86e46d?s=128&d=identicon&r=PG&f=1", "display_name": "Fareza Aditya H", "link": "https://stackoverflow.com/users/11437218/fareza-aditya-h"}, "reply_to_user": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 1, "creation_date": 1556720003, "post_id": 55937242, "comment_id": 98527937, "body": "@pmg yes sorry it was a mistake. I have edited it."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1556720190, "post_id": 55937242, "comment_id": 98528020, "body": "@Bathsheba No, the expected behavior is missing from the question."}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1556720378, "post_id": 55937242, "comment_id": 98528112, "body": "After freeing make <code>elem1</code> to point to <code>NULL</code> and do proper error handling i.e if <code>elem1</code> is not <code>NULL</code> then only allow to access <code>elem1-&gt;data1</code>."}, {"owner": {"reputation": 97, "user_id": 11390586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VGdy.jpg?s=128&g=1", "display_name": "Mr. Suklav Ghosh", "link": "https://stackoverflow.com/users/11390586/mr-suklav-ghosh"}, "edited": false, "score": 0, "creation_date": 1556723389, "post_id": 55937242, "comment_id": 98529677, "body": "Yes, the members of that particular structure are also freed."}], "answers": [{"comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 4, "creation_date": 1556718795, "post_id": 55937300, "comment_id": 98527359, "body": "<i>&quot;and therefore you must not use a free&quot;</i> - And indeed, that makes it a <i>good</i> thing that <code>free</code> doesn&#39;t &quot;recurse&quot;."}], "tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": false, "score": 7, "last_activity_date": 1556718910, "last_edit_date": 1556718910, "creation_date": 1556718546, "answer_id": 55937300, "question_id": 55937242, "link": "https://stackoverflow.com/questions/55937242/does-freeing-structures-in-c-also-delete-its-members/55937300#55937300", "title": "Does freeing structures in C also delete its members?", "body": "<p><em>Every</em> <code>malloc</code> has to be balanced with a corresponding <code>free</code>.</p>\n\n<p>Your assignment <code>node-&gt;data1 = \"abc\";</code> assigns a pointer to the <em>read-only</em> literal <code>\"abc\"</code>, so there is no dynamic memory here, and therefore you must not use a <code>free</code>.</p>\n\n<p>In your <em>particular</em> case, you are able to retain that pointer <code>a</code> having called <code>free</code> on the <code>struct</code> since you did not have to <code>free</code> that memory and it didn't ever belong to the <code>struct</code>. But that does not work in general: if you had used <code>malloc</code> to set <code>node-&gt;data1</code> then (1) you would have to call <code>free</code> on that pointer <em>before</em> you attempt to call <code>free</code> on the <code>struct</code>, and (2) the behaviour of a subsequent deference of <code>node-&gt;data1</code> would be undefined.</p>\n"}, {"comments": [{"owner": {"reputation": 39, "user_id": 11437218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/658058060fbaf20715845eb25c86e46d?s=128&d=identicon&r=PG&f=1", "display_name": "Fareza Aditya H", "link": "https://stackoverflow.com/users/11437218/fareza-aditya-h"}, "edited": false, "score": 0, "creation_date": 1556720282, "post_id": 55937357, "comment_id": 98528071, "body": "thank you so much I understand it now."}], "tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": true, "score": 9, "last_activity_date": 1556718788, "creation_date": 1556718788, "answer_id": 55937357, "question_id": 55937242, "link": "https://stackoverflow.com/questions/55937242/does-freeing-structures-in-c-also-delete-its-members/55937357#55937357", "title": "Does freeing structures in C also delete its members?", "body": "<p>The members are part of the structure. Freeing the structure deallocates all of its members.</p>\n\n<p>However, in your example, the members are just pointers. You're copying a pointer into the structure (<code>node-&gt;data1 = ...</code>), then out of the structure (<code>... = node-&gt;data1</code>), then freeing the structure. None of this affects the memory that the pointer is pointing to.</p>\n\n<p>In your example the actual strings are stored in static memory (they're string literals). That means they're never destroyed; they live as long as the program is running. That's why it's perfectly safe to print them. Your code is fine.</p>\n\n<p>Finally, accessing freed memory has undefined behavior (meaning anything can happen, including a program crash or appearing to work correctly). If you want to access members of a structure that has been freed, just do that:</p>\n\n<pre><code>struct elem *p = malloc(sizeof *p);\nfree(p);\np-&gt;data1 = \"boom!\";  // Undefined behavior!\n</code></pre>\n\n<p>However, that would be a bug, so ... don't, please.</p>\n"}], "owner": {"reputation": 39, "user_id": 11437218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/658058060fbaf20715845eb25c86e46d?s=128&d=identicon&r=PG&f=1", "display_name": "Fareza Aditya H", "link": "https://stackoverflow.com/users/11437218/fareza-aditya-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 1, "closed_date": 1556721415, "accepted_answer_id": 55937357, "answer_count": 2, "score": 0, "last_activity_date": 1556719920, "creation_date": 1556718261, "last_edit_date": 1556719920, "question_id": 55937242, "link": "https://stackoverflow.com/questions/55937242/does-freeing-structures-in-c-also-delete-its-members", "closed_reason": "Duplicate", "title": "Does freeing structures in C also delete its members?", "body": "<p>I'm pretty much new to C and i have a question about allocating memory. So I tried this code below that should free the structure elem1.</p>\n\n<pre><code>struct elem{\n\n    char *data1;\n    char *data2;\n\n};\n\nint main()\n{\n\n    struct elem *elem1 = malloc(sizeof(struct elem));\n    elem1-&gt;data1 = \"abc\";\n    elem1-&gt;data2 = \"def\";\n    char *a = elem1-&gt;data1;\n    char *b = elem1-&gt;data2;\n    free(elem1);\n\n    printf(\"%s\\n%s\\n\",a,b);\n    return 0;\n}\n</code></pre>\n\n<p>The code compiles just fine and it gives back, </p>\n\n<pre><code>abc \ndef\n</code></pre>\n\n<p>I expected it to fail since free should also free the memory of its members. But why does it work? And what should I do if I want to access the members of the structure after I free the structure?</p>\n"}, {"tags": ["c", "multithreading", "pthreads", "producer-consumer"], "comments": [{"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1556718134, "post_id": 55937128, "comment_id": 98527029, "body": "You&#39;re really using way to much comments. None of the comments adds any value. Remember that &quot;well commented code&quot; does not imply anything about the amount of comments."}, {"owner": {"reputation": 591, "user_id": 4054546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78aa1f3e1fc65e8b2e8d67f34689fd81?s=128&d=identicon&r=PG", "display_name": "Shawn", "link": "https://stackoverflow.com/users/4054546/shawn"}, "edited": false, "score": 0, "creation_date": 1556718198, "post_id": 55937128, "comment_id": 98527060, "body": "What&#39;s the purpose of <code>sem_wait(&amp;full)%100;</code>?  The %100 has no effect.  You should try compiling with -Wall if not already"}, {"owner": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "reply_to_user": {"reputation": 591, "user_id": 4054546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78aa1f3e1fc65e8b2e8d67f34689fd81?s=128&d=identicon&r=PG", "display_name": "Shawn", "link": "https://stackoverflow.com/users/4054546/shawn"}, "edited": false, "score": 0, "creation_date": 1556718265, "post_id": 55937128, "comment_id": 98527090, "body": "@Shawn Sorry,I edited."}, {"owner": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "reply_to_user": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1556718522, "post_id": 55937128, "comment_id": 98527229, "body": "@Broman I edited the code, sorry for that."}, {"owner": {"reputation": 25106, "user_id": 6699433, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/1mOTM.jpg?s=128&g=1", "display_name": "klutt", "link": "https://stackoverflow.com/users/6699433/klutt"}, "edited": false, "score": 0, "creation_date": 1556719061, "post_id": 55937128, "comment_id": 98527494, "body": "It&#39;s for your own sake too. It takes more place on the screen, takes longer to write, and makes the code harder to maintain."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1556728808, "post_id": 55937128, "comment_id": 98532202, "body": "If you look at your own code after three months vacation on an island and you understand it immediatly, then it is well commented. If you do not understand your code, you should probably have commented more. If comment and code disagree/mismatch then probably both are wrong. This is what I answer if trainees ask me how to write good comments (which are strictly required in our environment)."}], "answers": [{"comments": [{"owner": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "edited": false, "score": 0, "creation_date": 1556719323, "post_id": 55937365, "comment_id": 98527628, "body": "thanks but I add sleep function after the pthread_create, and there is no change. Also @Maximus answer is works good and he/she even didn&#39;t use  the semaphore or sleep stuffs."}, {"owner": {"reputation": 591, "user_id": 4054546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78aa1f3e1fc65e8b2e8d67f34689fd81?s=128&d=identicon&r=PG", "display_name": "Shawn", "link": "https://stackoverflow.com/users/4054546/shawn"}, "reply_to_user": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "edited": false, "score": 0, "creation_date": 1556719632, "post_id": 55937365, "comment_id": 98527770, "body": "Well yes, but did you also stop copying the pointer in the thread functions?  in other words do <code>int consumerID = *(int*)param;</code> instead of what you had.  Using a pointer into a predefined array is fine here, but what if you need 10,000 consumers?"}, {"owner": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "edited": false, "score": 0, "creation_date": 1556720269, "post_id": 55937365, "comment_id": 98528066, "body": "And then, what should I do when there are 10,000 consumers?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "reply_to_user": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "edited": false, "score": 0, "creation_date": 1556720977, "post_id": 55937365, "comment_id": 98528403, "body": "@EasterGamer You can use a copy instruction on consumerID instead of a pointer, however, you have to make sure to put a lock mechanism on that operation so that it is similar to an atomic operation as such: consumerID = getAndIncrement(i), or else some of your consumers will get same ID. Another solution: you can create a dynamic array with for example calloc and put the &quot;i&quot; values inside the calloc array and make the taskID point to the calloc array[i] location. In either case, you will be storing 10000 int&#39;s in your memory."}], "tags": [], "owner": {"reputation": 591, "user_id": 4054546, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78aa1f3e1fc65e8b2e8d67f34689fd81?s=128&d=identicon&r=PG", "display_name": "Shawn", "link": "https://stackoverflow.com/users/4054546/shawn"}, "is_accepted": false, "score": 1, "last_activity_date": 1556719152, "last_edit_date": 1556719152, "creation_date": 1556718818, "answer_id": 55937365, "question_id": 55937128, "link": "https://stackoverflow.com/questions/55937128/everytime-works-last-consumer-producer-consumer-problem-in-c/55937365#55937365", "title": "Everytime works last consumer (producer consumer problem) in C", "body": "<p>In:</p>\n\n<pre><code>for(i = 0; i &lt; numCons; i++) {\n/* Create the thread */\npthread_create(&amp;tid,&amp;attr,consumer,(void*)&amp;i);\n</code></pre>\n\n<p>You're passing each thread a pointer to <code>i</code> and keeping a pointer to it, which will follow the value of <code>i</code> </p>\n\n<p>You need to copy to a new variable in the beginning of the thread function, but it's important to know that <strong>the thread function will not start immediately</strong> when pthread_create is called.  It's likely that they won't start until the loop is finished and i = 10.  So what's likely happening is that you do in fact have 10 consumers, but they all have the same number.</p>\n\n<p>If you want to use <code>i</code> as the ID, you should wait on a semaphore from the target thread (which would be posted after assigning from *param) before creating a new thread.  </p>\n\n<p>If you want a very simple test for this, you can add a sleep(1) call after calling each pthread_create.  That should give each thread time to start and correctly assign an ID.</p>\n"}, {"comments": [{"owner": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "edited": false, "score": 0, "creation_date": 1556719497, "post_id": 55937415, "comment_id": 98527713, "body": "could you explain how could it be work? What kind of a benefit to declare an taskids array? And Shawn adviced to another solution which one is better solution?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "reply_to_user": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "edited": false, "score": 0, "creation_date": 1556719859, "post_id": 55937415, "comment_id": 98527879, "body": "@EasterGamer Just like Shawn says, when you use the &quot;i&quot; in the for loop for the ID number of your threads, the for loop completes before any of the threads start. Therefore, when the threads start, they all see that &quot;i = 10&quot;. That&#39;s why their ID&#39;s are the same. You need to create a taskID array and name the threads using that array because you do not know when the threads will be started, you do not know if they will be started in order (as you can see from the output I&#39;ve posted, their order is not sorted, as you may have expected or not). So, one simple solution is to use an id array."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "reply_to_user": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "edited": false, "score": 0, "creation_date": 1556720035, "post_id": 55937415, "comment_id": 98527954, "body": "@EasterGamer In any case, taskID&#39;s take a pointer to some variable, and you need to make sure that those ID&#39;s point to different variables, or else, you will get same taskID and a number of problems will follow, afterwards."}, {"owner": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "edited": false, "score": 0, "creation_date": 1556720298, "post_id": 55937415, "comment_id": 98528080, "body": "Thanks a lot , I understood very well."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "is_accepted": true, "score": 3, "last_activity_date": 1556719042, "creation_date": 1556719042, "answer_id": 55937415, "question_id": 55937128, "link": "https://stackoverflow.com/questions/55937128/everytime-works-last-consumer-producer-consumer-problem-in-c/55937415#55937415", "title": "Everytime works last consumer (producer consumer problem) in C", "body": "<p>Shawn has beat me to it, but yes he is correct. See the following implementation:</p>\n\n<pre><code>/* Consumer Thread */\nvoid *consumer(void *param) {\n    buffer_item item;\n    int* consumerID=(int*)param;\n\n    printf(\"consumer %d created\\n\" ,*consumerID);\n\n    while(TRUE) {\n        /* sleep for a random period of time */\n        int rNum = rand() / RAND_DIVISOR;\n        sleep(1);\n\n        /* aquire the full lock */\n        sem_wait(&amp;full)%100;\n        /* aquire the mutex lock */\n        pthread_mutex_lock(&amp;mutex);\n        if(remove_item(&amp;item)) {\n            //fprintf(stderr, \"Consumer report error condition: consumer %d item: %d\\n\", *consumerID, item);\n        }\n        else {\n            printf(\"consumer %d consumed %d\\n\" ,*consumerID, item);\n\n        }\n        /* release the mutex lock */\n        pthread_mutex_unlock(&amp;mutex);\n        /* signal empty */\n        sem_post(&amp;empty);\n    }\n}\n\nlong taskids[] = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9};\n\n    /* Create the consumer threads */\n    for(i = 0; i &lt; numCons; i++) {\n        taskids[i] = i;\n        /* Create the thread */\n        pthread_create(&amp;tid,&amp;attr,consumer, taskids + i);\n    }\n</code></pre>\n\n<p>Which results in:</p>\n\n<pre><code>consumer 0 created\nconsumer 1 created\nconsumer 2 created\nconsumer 5 created\nconsumer 3 created\nconsumer 6 created\nconsumer 9 created\nconsumer 7 created\nconsumer 8 created\nconsumer 4 created\nproducer produced 65\nconsumer 9 consumed 65\nproducer produced 57\nconsumer 6 consumed 57\nproducer produced 33\nconsumer 5 consumed 33\nproducer produced 57\nconsumer 1 consumed 57\nproducer produced 3\nconsumer 3 consumed 3\nproducer produced 81\nconsumer 9 consumed 81\nproducer produced 1\nconsumer 5 consumed 1\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 9093787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0836609c8efb77c82494e4c123f29509?s=128&d=identicon&r=PG&f=1", "display_name": "javac", "link": "https://stackoverflow.com/users/9093787/javac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1469, "favorite_count": 0, "accepted_answer_id": 55937415, "answer_count": 2, "score": 1, "last_activity_date": 1556719152, "creation_date": 1556717777, "last_edit_date": 1556718572, "question_id": 55937128, "link": "https://stackoverflow.com/questions/55937128/everytime-works-last-consumer-producer-consumer-problem-in-c", "title": "Everytime works last consumer (producer consumer problem) in C", "body": "<p>I have 10 consumer and 1 producer threads. Producer thread produce a random integer and insert it into buffer. Consumer threads take and remove an item from this buffer and print it. </p>\n\n<p>Everything is works good(I am in, there is no endless loop or blocking stuffs). But I think, there is only one working consumer thread which is 10th(last) consumer thread. The other 9 consumer threads doesn't work. I realize that when I print the consumer id in consumer thread method. Why the other 9 consumer threads doesn't work and what can do for this kind of problem?</p>\n\n<p>Below is my code:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;semaphore.h&gt;\n#include &lt;unistd.h&gt;\ntypedef int buffer_item;\n#define BUFFER_SIZE 5\n\n#define RAND_DIVISOR 100000000\n#define TRUE 1\n\npthread_mutex_t mutex;\n\nsem_t full, empty;\n\nbuffer_item buffer[BUFFER_SIZE];\n\nint counter;\n\npthread_t tid;      \npthread_attr_t attr; \n\nvoid *producer(void *param); \nvoid *consumer(void *param); \n\nint insert_item(buffer_item item) {\n\n   if(counter &lt; BUFFER_SIZE) {\n      buffer[counter] = item;\n      counter++;\n      return 0;\n   }\n   else { \n      return -1;\n   }\n}\n\nint remove_item(buffer_item *item) {\n   if(counter &gt; 0) {\n      *item = buffer[(counter-1)];\n      counter--;\n      return 0;\n   }\n   else {\n      return -1;\n   }\n}\n\nvoid initializeData() {\n\n   pthread_mutex_init(&amp;mutex, NULL);\n\n   sem_init(&amp;full, 0, 0);\n\n   sem_init(&amp;empty, 0, BUFFER_SIZE);\n\n   pthread_attr_init(&amp;attr);\n\n   counter = 0;\n}\n\nvoid *producer(void *param) {\n   buffer_item item;\n\n   while(TRUE) {\n      int rNum = rand() / RAND_DIVISOR;\n      sleep(1);\n\n      item = rand()%100;\n\n      sem_wait(&amp;empty);\n      pthread_mutex_lock(&amp;mutex);\n\n      if(insert_item(item)) {\n         fprintf(stderr, \" Producer report error condition\\n\");\n      }\n      else {\n         printf(\"producer produced %d\\n\", item);\n      }\n      pthread_mutex_unlock(&amp;mutex);\n      sem_post(&amp;full);\n   }\n}\n\nvoid *consumer(void *param) {\n   buffer_item item;\n   int* consumerID=(int*)param;\n\n   while(TRUE) {\n      int rNum = rand() / RAND_DIVISOR;\n      sleep(1);\n\n      sem_wait(&amp;full);\n      pthread_mutex_lock(&amp;mutex);\n      if(remove_item(&amp;item)) {\n         fprintf(stderr, \"Consumer report error condition\\n\");\n      }\n      else {\n         printf(\"consumer %d consumed %d\\n\" ,*consumerID, item);\n\n      }\n      pthread_mutex_unlock(&amp;mutex);\n      sem_post(&amp;empty);\n   }\n}\n\nint main(int argc, char *argv[]) {\n   /* Loop counter */\n   int i;\n\n\n   int numProd = 1; /* Number of producer threads */\n   int numCons = 10; /* Number of consumer threads */\n\n   /* Initialize the app */\n   initializeData();\n\n   /* Create the producer threads */\n   for(i = 0; i &lt; numProd; i++) {\n      /* Create the thread */\n      pthread_create(&amp;tid,&amp;attr,producer,NULL);\n    }\n\n   /* Create the consumer threads */\n   for(i = 0; i &lt; numCons; i++) {\n      /* Create the thread */\n      pthread_create(&amp;tid,&amp;attr,consumer,(void*)&amp;i);\n   }\n\n   /* Sleep for the specified amount of time in milliseconds */\n   sleep(10);\n\n   /* Exit the program */\n   printf(\"Exit the program\\n\");\n   exit(0);\n}\n</code></pre>\n\n<p>My output is :</p>\n\n<pre><code>producer produced 27\nconsumer 10 consumed 27\nproducer produced 63\nconsumer 10 consumed 63\nproducer produced 26\nconsumer 10 consumed 26\nproducer produced 11\nconsumer 10 consumed 11\nproducer produced 29\nconsumer 10 consumed 29\nproducer produced 62\nconsumer 10 consumed 62\nproducer produced 35\nconsumer 10 consumed 35\nproducer produced 22\nconsumer 10 consumed 22\nproducer produced 67\nconsumer 10 consumed 67\nExit the program\n</code></pre>\n"}, {"tags": ["c", "boehm-gc"], "answers": [{"comments": [{"owner": {"reputation": 1283, "user_id": 3897333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51d784367ca82572dea0a2c43217770b?s=128&d=identicon&r=PG", "display_name": "Paul Stelian", "link": "https://stackoverflow.com/users/3897333/paul-stelian"}, "edited": false, "score": 0, "creation_date": 1556721755, "post_id": 55937989, "comment_id": 98528830, "body": "So basically I should make a sort of handle object, store the actual reference into an area that the collector doesn&#39;t look in, register a finalizer (how do I get the handle object instead of the actual being-finalized object?) and use that to zero out the pointer whenever that object is collected?"}, {"owner": {"reputation": 1283, "user_id": 3897333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51d784367ca82572dea0a2c43217770b?s=128&d=identicon&r=PG", "display_name": "Paul Stelian", "link": "https://stackoverflow.com/users/3897333/paul-stelian"}, "edited": false, "score": 0, "creation_date": 1556721809, "post_id": 55937989, "comment_id": 98528855, "body": "Also, is that GC_register_disappearing_link going to do anything useful for me?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 1283, "user_id": 3897333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51d784367ca82572dea0a2c43217770b?s=128&d=identicon&r=PG", "display_name": "Paul Stelian", "link": "https://stackoverflow.com/users/3897333/paul-stelian"}, "edited": false, "score": 0, "creation_date": 1556722207, "post_id": 55937989, "comment_id": 98529063, "body": "No, I don&#39;t think <code>GC_register_disappearing_link</code> is going to be useful to you for this purpose.  It causes a pointer to be zeroed out when <i>the object containing it</i> is found to be inaccessible, but you want to clear pointers when <i>the object they point to</i> becomes inaccessible, which of course doesn&#39;t happen as long as a pointer that GC knows about points to that object."}, {"owner": {"reputation": 1283, "user_id": 3897333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51d784367ca82572dea0a2c43217770b?s=128&d=identicon&r=PG", "display_name": "Paul Stelian", "link": "https://stackoverflow.com/users/3897333/paul-stelian"}, "edited": false, "score": 0, "creation_date": 1556722220, "post_id": 55937989, "comment_id": 98529070, "body": "Apparently GC_register_finalizer takes a pointer to my handle object, so that&#39;s done. Then simply I should allocate the contents of the handle object with GC_MALLOC_ATOMIC, set to zero (I think BOEHM does it for me), register a finalizer that zeroes out when the object itself is collected and then set the contents of the handler object... I think this may work as an answer."}, {"owner": {"reputation": 1283, "user_id": 3897333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51d784367ca82572dea0a2c43217770b?s=128&d=identicon&r=PG", "display_name": "Paul Stelian", "link": "https://stackoverflow.com/users/3897333/paul-stelian"}, "edited": false, "score": 0, "creation_date": 1556722376, "post_id": 55937989, "comment_id": 98529155, "body": "I would like you to put it in your answer then for future reference. The design if not actual code."}, {"owner": {"reputation": 1283, "user_id": 3897333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51d784367ca82572dea0a2c43217770b?s=128&d=identicon&r=PG", "display_name": "Paul Stelian", "link": "https://stackoverflow.com/users/3897333/paul-stelian"}, "edited": false, "score": 0, "creation_date": 1556722436, "post_id": 55937989, "comment_id": 98529198, "body": "(I wonder if it&#39;s actually thread safe though... It should, but I&#39;ll still ponder on it)"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 1283, "user_id": 3897333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51d784367ca82572dea0a2c43217770b?s=128&d=identicon&r=PG", "display_name": "Paul Stelian", "link": "https://stackoverflow.com/users/3897333/paul-stelian"}, "edited": false, "score": 1, "creation_date": 1556722914, "post_id": 55937989, "comment_id": 98529438, "body": "Ok, @PaulStelian, I have updated the answer with a high-level outline of the suggested approach."}, {"owner": {"reputation": 1283, "user_id": 3897333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51d784367ca82572dea0a2c43217770b?s=128&d=identicon&r=PG", "display_name": "Paul Stelian", "link": "https://stackoverflow.com/users/3897333/paul-stelian"}, "edited": false, "score": 0, "creation_date": 1556723271, "post_id": 55937989, "comment_id": 98529609, "body": "That&#39;s perfect, thanks. When I&#39;ll actually be working on the project I&#39;ll implement it."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": true, "score": 3, "last_activity_date": 1556722876, "last_edit_date": 1556722876, "creation_date": 1556721637, "answer_id": 55937989, "question_id": 55937116, "link": "https://stackoverflow.com/questions/55937116/how-does-one-implement-weak-references-with-boehm-gc/55937989#55937989", "title": "How does one implement weak references with Boehm GC?", "body": "<p>The Boehm GC does not have a concept of weak references <em>per se</em>.  However, it does not scan memory allocated by the system <code>malloc</code> for references to managed objects, so pointers stored in such memory do not prevent the pointed-to object from being collected.  Of course, that approach means that the objects containing the pointers will not be managed by the collector.</p>\n\n<p>Alternatively, it should be possible to abuse <code>GC_MALLOC_ATOMIC()</code> or <code>GC_malloc_explicitly_typed()</code> to obtain a managed object that can contain pointers to other managed objects without preventing those other objects from being collected.  That involves basically lying to GC about whether some members are pointers, so as to prevent them from being scanned.</p>\n\n<p>Either way, you also require some mechanism for receiving notice when weakly-referenced objects are collected, so as to avoid attempting to access them afterward.  GC has an interface for registering <a href=\"https://www.hboehm.info/gc/finalization.html\" rel=\"nofollow noreferrer\">finalizer</a> callbacks to be invoked before an object is collected, and that looks like your best available option for the purpose.</p>\n\n<p>Overall, I think what you're asking for is doable, but with a lot of DIY involved.  At a high level,</p>\n\n<ul>\n<li>use <code>GC_MALLOC_ATOMIC()</code> to allocate a wrapper object around a pointer to the weakly referenced object.  Allocating it this way allows the wrapper to itself be managed by GC, without the pointer within being scanned during GC's reachability analyses.</li>\n<li>use <code>GC_register_finalizer</code> to register a finalizer function that sets the wrapper's pointer to <code>NULL</code> when GC decides that the pointed-to object is inaccessible.</li>\n<li>users of the wrapper are obligated to check whether the pointer within is <code>NULL</code> before attempting to dereference it.</li>\n</ul>\n"}], "owner": {"reputation": 1283, "user_id": 3897333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51d784367ca82572dea0a2c43217770b?s=128&d=identicon&r=PG", "display_name": "Paul Stelian", "link": "https://stackoverflow.com/users/3897333/paul-stelian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 55937989, "answer_count": 1, "score": 1, "last_activity_date": 1556722876, "creation_date": 1556717715, "question_id": 55937116, "link": "https://stackoverflow.com/questions/55937116/how-does-one-implement-weak-references-with-boehm-gc", "title": "How does one implement weak references with Boehm GC?", "body": "<p>I have a personal project which I implement using the Boehm GC. I need to implement a sort of event type, which should hold references to other events. But I also need to ensure that the events pointed to are still collectable, thus I need weak references for this.</p>\n\n<p>Let's say we have events A, B and C. I configure these events to signal event X whenever any of them is signaled. This means A, B and C must hold a reference to event X. What I want is that if event X is unreachable the events A, B and C don't need to signal it anymore. Thus a weak reference is what I thought of.</p>\n\n<p>Is there any other way to do this? I don't want to change the GC but if necessary (the allocation interface remains clean) I could.</p>\n\n<p>The project is written in C. If need be, I will provide more info. Notably, if there is any way to implement such events directly with this semantics, there's no need for actual weak references (events MAY have a reference cycle though while they are not signaled).</p>\n"}, {"tags": ["c", "arrays", "pointers"], "comments": [{"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 4, "creation_date": 1556717647, "post_id": 55937071, "comment_id": 98526837, "body": "<i>&quot;A[0] and A[1] are clearly pointers without any doubt&quot;</i> - no, they aren&#39;t"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1556717660, "post_id": 55937071, "comment_id": 98526842, "body": "Pointers and arrays are not synonymous.  Pointers can use array notation to access, but they are different constructs with different properties."}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1556717660, "post_id": 55937071, "comment_id": 98526843, "body": "<i>&quot;shouldn&#39;t A be a pointer as well [...] argument 2 has type <code>int*</code> &quot;</i> I don&#39;t see the problem. It&#39;s saying that it&#39;s a pointer right there. Either way it would help illustrating your problem if you posted code that shows how <code>A</code> is defined."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1556717729, "post_id": 55937071, "comment_id": 98526862, "body": "@Blaze My interpretation of the question is that OP expects it to be <code>int **</code>"}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 2, "creation_date": 1556717828, "post_id": 55937071, "comment_id": 98526910, "body": "@ChristianGibbons I think you&#39;re right. Perhaps the OP can clarify by posting the code that leads to this issue."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556717938, "post_id": 55937071, "comment_id": 98526955, "body": "The format specifier for pointer values is <code>%p</code>, not <code>%d</code>. Using <code>%d</code> for printing a pointer value is UB."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556718082, "post_id": 55937071, "comment_id": 98527014, "body": "<code>printf(&quot;%d&quot;, *(A+1)[0])</code> compiles fine because the type of <code>*(A+1)[0]</code> is <code>int</code>, but the type of <code>A</code> is not <code>int</code> but <code>int[2][2]</code> (or more or less <code>int*</code>)."}, {"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 0, "creation_date": 1556719186, "post_id": 55937071, "comment_id": 98527558, "body": "You might like section 6 of <a href=\"http://c-faq.com/\" rel=\"nofollow noreferrer\">the C faq</a>."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1556719437, "post_id": 55937071, "comment_id": 98527693, "body": "This question does not show a definition of <code>A</code> and is therefore unclear. The \u201cA[m][n]\u201d in the title might be intended to be part of a definition of <code>A</code>, but it is unclear."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1556720708, "post_id": 55937071, "comment_id": 98528270, "body": "Post definition of <code>A</code>."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1556725892, "post_id": 55937071, "comment_id": 98530953, "body": "@Hackarp: although the question is now marked as a duplicate, you can accept one of the answers by clicking on the grey checkmark below its score."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1556747839, "post_id": 55937071, "comment_id": 98539565, "body": "@chux The only definition resembling an array (<code>A</code>) that can be interpreted by the compiler as a pointer (that I can think of) is when it is an argument of a function."}], "answers": [{"tags": [], "owner": {"reputation": 623, "user_id": 2491350, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/21b00afe3f3ab6235649f62a35132ac7?s=128&d=identicon&r=PG", "display_name": "SilverTear", "link": "https://stackoverflow.com/users/2491350/silvertear"}, "is_accepted": false, "score": 1, "last_activity_date": 1556719131, "last_edit_date": 1556719131, "creation_date": 1556717829, "answer_id": 55937143, "question_id": 55937071, "link": "https://stackoverflow.com/questions/55937071/isnt-a-in-amn-a-pointerdrawing-analogy-from-when-we-define-2-dimensional-m/55937143#55937143", "title": "Isn&#39;t A in A[m][n] a pointer(drawing analogy from when we define 2 dimensional matrix using pointers)", "body": "<p>This question boils down to whether or not arrays are pointers, which is <em>not</em> the case. See this question: <a href=\"https://stackoverflow.com/questions/3959705/arrays-are-pointers\">Arrays are Pointers?</a>.</p>\n\n<p>When you use </p>\n\n<pre><code>int arr = {1, 2, 3, 4};\nint *p = arr;\n</code></pre>\n\n<p>arr is converted from an array of ints to a pointer to an int. \nIt is the same as doing.</p>\n\n<pre><code>int *p = &amp;arr[0]\n</code></pre>\n\n<p>The same is happening with</p>\n\n<pre><code>printf(\"%d\", A)\n</code></pre>\n\n<p>Which is why the compilers gives you the message, but this can be confusing and might lead one to think that pointers and arrays are indeed the same. </p>\n"}, {"tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 1, "last_activity_date": 1556719660, "last_edit_date": 1556719660, "creation_date": 1556718858, "answer_id": 55937375, "question_id": 55937071, "link": "https://stackoverflow.com/questions/55937071/isnt-a-in-amn-a-pointerdrawing-analogy-from-when-we-define-2-dimensional-m/55937375#55937375", "title": "Isn&#39;t A in A[m][n] a pointer(drawing analogy from when we define 2 dimensional matrix using pointers)", "body": "<p>There are many different ways to create so-called <em>2D matrices</em> of <code>int</code>, each defining a very different type of object:</p>\n\n<ol>\n<li><p>as an array of arrays of <code>int</code>:</p>\n\n<pre><code>int A[ROWS][COLS] = { 0 };\n</code></pre></li>\n<li><p>as an array of pointers to arrays of <code>int</code>:</p>\n\n<pre><code>int *A[ROWS];\nfor (int i = 0; i &lt; ROWS; i++)\n    A[i] = calloc(sizeof(int), COLS);\n</code></pre></li>\n<li><p>as pointer to an array of arrays of <code>int</code>:</p>\n\n<pre><code>int (*A)[COLS] = calloc(sizeof(*A), ROWS);\n</code></pre></li>\n<li><p>as a pointer to an array of pointers to arrays of <code>int</code>:</p>\n\n<pre><code>int **A = calloc(sizeof(*A), ROWS);\nfor (int i = 0; i &lt; ROWS; i++)\n    A[i] = calloc(sizeof(int), COLS);\n</code></pre></li>\n</ol>\n\n<p>In all cases, the syntax to access the matrix elements is the same: <code>A[row][col]</code>, or any of the equivalent <em>pointer notation</em> variants:</p>\n\n<pre><code>    *(*(A + row) + col)\n    *(A[row] + col)\n    (*(A + row))[col]\n</code></pre>\n\n<p>In all cases, <code>A</code>, and <code>A[row]</code> can be used where a pointer is expected, either because they are indeed pointers (cases 3 and 4) or because arrays (cases 1 and 2) decay to a pointer to their first element when used in an expression context (except as an argument to <code>sizeof</code>), such as when passed as an argument to <code>printf</code>.</p>\n\n<p>Printing pointer values with <code>printf</code> requires the <code>%p</code> conversion format.</p>\n\n<p><code>%d</code> expects an <code>int</code>, which is not the same as a pointer, may have a different size and may be passed to <code>printf</code> differently, all causing undefined behavior. The compiler emits a very useful warning about this. It is a good idea to configure the compiler with as many warnings as possible to detect silly mistakes.These warnings are sometimes difficult to understand, but are almost always an indication of something that needs fixing.</p>\n\n<p>You can use <code>printf(\"%p\", (void*)A)</code> which is equivalent to <code>printf(\"%p\", (void*)&amp;A[0])</code> and <code>printf(\"%p\", (void*)A[0])</code>, equivalent to <code>printf(\"%p\", (void*)&amp;A[0][0])</code>. All 4 should print the same address.</p>\n"}], "owner": {"reputation": 41, "user_id": 10739888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/768d61995ed0f7e4d1b43137c6013bf9?s=128&d=identicon&r=PG&f=1", "display_name": "Hackarp", "link": "https://stackoverflow.com/users/10739888/hackarp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "closed_date": 1556721457, "answer_count": 2, "score": -2, "last_activity_date": 1556719660, "creation_date": 1556717487, "last_edit_date": 1556718102, "question_id": 55937071, "link": "https://stackoverflow.com/questions/55937071/isnt-a-in-amn-a-pointerdrawing-analogy-from-when-we-define-2-dimensional-m", "closed_reason": "Duplicate", "title": "Isn&#39;t A in A[m][n] a pointer(drawing analogy from when we define 2 dimensional matrix using pointers)", "body": "<p><code>A[0]</code> and <code>A[1]</code> are clearly pointers without any doubt which point to respective arrays. But shouldn't <code>A</code> be a pointer as well pointing to <code>A[0]</code> because compileing <code>printf(\"%d\", A)</code> in GCC results in the following error:</p>\n\n<blockquote>\n  <p>format <code>%d</code> expects argument of type <code>int</code>, but argument 2 has type <code>int *</code></p>\n</blockquote>\n\n<p>If <code>A</code> is not a pointer then why is it considered a pointer when defining 2D matrix using pointers.</p>\n\n<p>Moreover, <code>printf(\"%d\", *(A+1)[0]);</code> works pretty fine implying that <code>A</code> is rendered as a pointer. And if that is the case <code>printf(\"%d\", A)</code> should print the address of <code>A[0]</code> but it shows compilation error. </p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 2, "creation_date": 1556716902, "post_id": 55936901, "comment_id": 98526510, "body": "<a href=\"https://ideone.com/kulrQH\" rel=\"nofollow noreferrer\">int a=20;main(){int *ga=&amp;a;int a=10;printf(&quot;%d\\n&quot;,*gaa);}</a> -- not use extern: check -- not comment local: check -- not shift printf: check"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1556717386, "post_id": 55936901, "comment_id": 98526738, "body": "You should avoid name conflicts like this in first place."}, {"owner": {"reputation": 55516, "user_id": 892256, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/15FJW.png?s=128&g=1", "display_name": "Ed Heal", "link": "https://stackoverflow.com/users/892256/ed-heal"}, "edited": false, "score": 0, "creation_date": 1556717757, "post_id": 55936901, "comment_id": 98526870, "body": "You should avoid global variables"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556722096, "post_id": 55936901, "comment_id": 98528998, "body": "In C, there isn\u2019t a sensible way to do it, unless you add <code>#define a z</code> before the definition in <code>main()</code> and <code>#undef a</code> after it or something equally silly. In C++, the scope resolution operator might help, but would modify the <code>printf()</code> statement.  Whatever technique your faculty have in mind is unlikely to be useful professionally; writing clear code is the primary requirement."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11437151, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--l8CMoa5Ir8/AAAAAAAAAAI/AAAAAAAAAG0/EJTAzYBkQew/photo.jpg?sz=128", "display_name": "AMARAVATI NAGASIVASAI", "link": "https://stackoverflow.com/users/11437151/amaravati-nagasivasai"}, "edited": false, "score": 0, "creation_date": 1556717498, "post_id": 55936944, "comment_id": 98526777, "body": "No, it should be global a=20 &amp; local a=10."}, {"owner": {"reputation": 1, "user_id": 11437151, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--l8CMoa5Ir8/AAAAAAAAAAI/AAAAAAAAAG0/EJTAzYBkQew/photo.jpg?sz=128", "display_name": "AMARAVATI NAGASIVASAI", "link": "https://stackoverflow.com/users/11437151/amaravati-nagasivasai"}, "edited": false, "score": 0, "creation_date": 1556717526, "post_id": 55936944, "comment_id": 98526786, "body": "It was asked by my faculty in yesterdays test."}], "tags": [], "owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "is_accepted": false, "score": 2, "last_activity_date": 1556716899, "creation_date": 1556716899, "answer_id": 55936944, "question_id": 55936901, "link": "https://stackoverflow.com/questions/55936901/how-to-access-global-value-without-using-extern-keyword/55936944#55936944", "title": "How to access global value without using extern keyword?", "body": "<p>extern will not help as you have another variable with the same name in most inner scope (in this case scope of function main). So you will see this variable instead if the global one. </p>\n\n<p>You need to rename one of those variables.</p>\n\n<pre><code>int a=20;\nint main()\n{\n    int b=10;\n    printf(\"%d\",a);\n}\n</code></pre>\n\n<p>you may have more inner scopes:</p>\n\n<pre><code>int a=20;\nint main()\n{\n    int a=10;\n    {   \n        int a = 5;\n        {\n            int a = 2;\n            printf(\"%d\",a);\n        }\n    }\n}\n</code></pre>\n\n<p>and the result is 2 </p>\n"}], "owner": {"reputation": 1, "user_id": 11437151, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--l8CMoa5Ir8/AAAAAAAAAAI/AAAAAAAAAG0/EJTAzYBkQew/photo.jpg?sz=128", "display_name": "AMARAVATI NAGASIVASAI", "link": "https://stackoverflow.com/users/11437151/amaravati-nagasivasai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "closed_date": 1556717466, "answer_count": 1, "score": 0, "last_activity_date": 1556717613, "creation_date": 1556716702, "last_edit_date": 1556717613, "question_id": 55936901, "link": "https://stackoverflow.com/questions/55936901/how-to-access-global-value-without-using-extern-keyword", "closed_reason": "Duplicate", "title": "How to access global value without using extern keyword?", "body": "<p>From the below code how to print global value:</p>\n\n<p>Conditions are that, we must not use extern keyword, should not comment the local initialization &amp; should not shift the printf function.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint a = 20;\n\nint main()\n{\n    int a = 10;\n    printf(\"%d\",a);\n}\n</code></pre>\n\n<p>I expect the output of <code>20</code>.</p>\n"}, {"tags": ["c", "lua"], "answers": [{"tags": [], "owner": {"reputation": 3359, "user_id": 7396148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yIsr8.jpg?s=128&g=1", "display_name": "Nifim", "link": "https://stackoverflow.com/users/7396148/nifim"}, "is_accepted": true, "score": 2, "last_activity_date": 1556718034, "creation_date": 1556718034, "answer_id": 55937186, "question_id": 55936608, "link": "https://stackoverflow.com/questions/55936608/how-to-check-for-boolean-argument-in-lua-function/55937186#55937186", "title": "How to check for boolean argument in lua function", "body": "<p>You can used <code>lua_toboolean</code>.</p>\n\n<p>Just remember any value, in lua, other then <code>false</code> and <code>nil</code> evaluate as <code>true</code> </p>\n\n<p>If necessary you can validate the value is a bool using <code>lua_isboolean</code> before <code>lua_toboolean</code></p>\n\n<p>Reference: <a href=\"https://www.lua.org/manual/5.3/manual.html#lua_toboolean\" rel=\"nofollow noreferrer\">https://www.lua.org/manual/5.3/manual.html#lua_toboolean</a></p>\n"}], "owner": {"reputation": 1895, "user_id": 10505778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d48a83c7fb094806cc998ecd3685e06?s=128&d=identicon&r=PG&f=1", "display_name": "DarkAtom", "link": "https://stackoverflow.com/users/10505778/darkatom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1925, "favorite_count": 0, "accepted_answer_id": 55937186, "answer_count": 1, "score": 3, "last_activity_date": 1556718069, "creation_date": 1556715228, "last_edit_date": 1556717255, "question_id": 55936608, "link": "https://stackoverflow.com/questions/55936608/how-to-check-for-boolean-argument-in-lua-function", "title": "How to check for boolean argument in lua function", "body": "<p>To get integer arguments into from the script into my C code, I can use <code>luaL_checknumber()</code>, but there is no function called <code>luaL_checkboolean()</code> that would allow me to get <code>bool</code> arguments. Is there any workaround for this?</p>\n"}, {"tags": ["c", "opencl", "sse", "simd", "differential-equations"], "comments": [{"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556716596, "post_id": 55936556, "comment_id": 98526359, "body": "@PeterCordes Looking up for some SSE gurus ;-) How would you solve this etude?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556716746, "post_id": 55936556, "comment_id": 98526447, "body": "These calculations are very simple, there is not much room for optimisation here. BTW why do you use <code>float</code> instead of <code>double</code>?"}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556716871, "post_id": 55936556, "comment_id": 98526489, "body": "@Jabberwocky There are at least 3 variants, I feel like something is incorrect even in such simple thing, as I wrote it (q1). Also, whats difference between parallel and serial? (q2) <code>float</code> is just a habit, shorter to type :) Precision here is of no matter, they are just a clues for types (eg &quot;here are some floating point variables&quot;)"}], "answers": [{"comments": [{"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556724761, "post_id": 55938730, "comment_id": 98530397, "body": "They would produce different results ;)"}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 1, "creation_date": 1556724928, "post_id": 55938730, "comment_id": 98530486, "body": "@xakepp35 I even described you why. But that is a discrete simulation so you will always have errors in it and you have to know the limitations of your simulation."}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556726533, "post_id": 55938730, "comment_id": 98531240, "body": "Parallel code seems allows for more optimisations than serial, as it updates I by Iprev, and V by Vprev, at the cost of extra register. But are all three conditions right and equal?"}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556727038, "post_id": 55938730, "comment_id": 98531455, "body": "@xakepp35 Yes a little bit more maybe possible. But not munch. You may run one multiplication more in parallel. But I wouldn&#39;t bet on a better performance. You may get more by reordering the multiplications to have the common terms in front. The conditions are equal as long as you keep the different stepping in mind. So the results will not be equal but equivalent."}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556727978, "post_id": 55938730, "comment_id": 98531857, "body": "If you&#39;re &quot;throwing a rock&quot;, aiming at algorightm precision - you&#39;d need to integrate coordinate <code>x</code>, and velocity <code>v</code> in steps, according to newton law. Which of two schemes would give you least error at the end - serial or parallel?"}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556728371, "post_id": 55938730, "comment_id": 98532003, "body": "@xakepp35 Depends on what you simulate. If you are doing it in free space. x(t) is independent of v(t) and the other way around. You can describe both only depending on t. If you simulate it with air resistance you have F(t) ~ v^2(t) and should use a higher order ode solver."}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556728568, "post_id": 55938730, "comment_id": 98532098, "body": "(you mean that is what I call &quot;parallel&quot;?)"}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556728655, "post_id": 55938730, "comment_id": 98532128, "body": "@xakepp35 No, first one is the same in &quot;parallel&quot; and &quot;serial&quot; and second depends on your solver."}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556728927, "post_id": 55938730, "comment_id": 98532255, "body": "I am not good at therminology, eg solver/order.. i forget that for years, trying to relearn.. look, in first two idea is sequential &quot;voltage builds up, then checking for gate to release it, then updating current, then checking if gate is holding open next time we build up voltage&quot;. and third idea is that in real world all processes are simultaneous, so we must tie to steps as precisely as possible&quot;. i dont remember what is higher order ode, and even cant write runge-kutta solver by memory. so sorry, dont understant quite (probably i werent asking this..)"}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 2, "creation_date": 1556729472, "post_id": 55938730, "comment_id": 98532485, "body": "@xakepp35 Your real world not only run in parallel but also in a continuous and not discrete time. Therefore, both version are valid if you understand how your discrete time is mapped to the continuous time in real life and vice versa. Both version have different mapping and will therefore result in slightly different results but not in a substantial way if you keep dt small enough."}, {"owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "edited": false, "score": 0, "creation_date": 1556733446, "post_id": 55938730, "comment_id": 98534272, "body": "How to turn this to verlet integration scheme?"}], "tags": [], "owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "is_accepted": true, "score": 1, "last_activity_date": 1556724709, "last_edit_date": 1592644375, "creation_date": 1556724709, "answer_id": 55938730, "question_id": 55936556, "link": "https://stackoverflow.com/questions/55936556/how-to-optimize-valve-simulation-logic/55938730#55938730", "title": "How to optimize valve simulation logic?", "body": "<ol>\n<li><p>By the overall description they are the same and should all fulfil your needs.</p>\n</li>\n<li><p>Your serial code will produce half-steps. That means if you break it down to the discrete description V(t) can be described as being 1/2 dt in front of I(t). The fist one will keep G changing in every half-step and the second one will synchronise it to I. But since you are not evaluating G in between in doesn't really matter. There is also no real problem with V and I being a half step apart but you should keep it in mind but maybe you should use for plotting/evaluation the vector {V(t),(I(t-1)+I(t))/2,G(t)}.</p>\n<p>The parallel code will keep them all in the same time step.</p>\n</li>\n<li><p>For your pure linear problem the direct integration is a good solution. Higher order ode solver won't buy you anything. State-space representation for pure linear systems only write the same direct integration in a different way.</p>\n</li>\n</ol>\n<p>For SIMD optimisation there isn't munch to do. You need to evaluate step-wise since you are updating I by V and V by I. That means you can't run the steps in parallel which makes many interesting optimisation not possible.</p>\n"}], "owner": {"reputation": 1929, "user_id": 1976993, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b45ba47b05c15f41c27efcc98f11a193?s=128&d=identicon&r=PG", "display_name": "xakepp35", "link": "https://stackoverflow.com/users/1976993/xakepp35"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "closed_date": 1556882333, "accepted_answer_id": 55938730, "answer_count": 1, "score": 1, "last_activity_date": 1556724988, "creation_date": 1556714947, "last_edit_date": 1592644375, "question_id": 55936556, "link": "https://stackoverflow.com/questions/55936556/how-to-optimize-valve-simulation-logic", "closed_reason": "Needs more focus", "title": "How to optimize valve simulation logic?", "body": "<p>This is an simple logic-programming and optimisation etude, that I've created for myself, and somewhat stumbled upon it.</p>\n<p>I have a numerical simulation of simple scheme. Consider some reservoir (or a capacitor) <code>Cm</code>, which is constantly pumping up with pressure. Lets call its current state <code>Vm</code>:</p>\n<p><a href=\"https://i.stack.imgur.com/POpeC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/POpeC.png\" alt=\"enter image description here\" /></a></p>\n<p>At its output it has a valve, or a gate, <code>G</code>, that could be open or closed, according to following logic:</p>\n<ul>\n<li>Gate opens, when pressure(or voltage) <code>Vm</code> exceeds some threshold, call it <code>Vopen</code>: <code>Vm &gt; Vopen</code></li>\n<li>Gate remains open, while current outrush <code>Ia</code> is greater than some <code>Ihold</code>: <code>Ia &gt; IHold</code></li>\n<li>Gate conducts power only out of reservoir (like a diode)</li>\n</ul>\n<p>I am doing numerical ODE solving of this, i.e. determining <code>Vm</code> and <code>Ia</code> at each (equal, small) timestep dt. Have three variants of this:</p>\n<hr />\n<h2>Variable types:</h2>\n<pre><code>float Vm=0.0, Ia=0.0, Vopen, Ihold, Ra, dt;\nint G=0;\n</code></pre>\n<hr />\n<h2>Loop body v1 (serial):</h2>\n<pre><code>Vm = Vm + (-Ia*G)*dt;\nG |= (Vm &gt; Vopen);\nIa = Ia + (Vm*Ra*G)*dt;\nG &amp;= (Ia &gt; Ihold);\n</code></pre>\n<hr />\n<h2>Loop body v2 (serial, with temp var, ternary conditionals):</h2>\n<pre><code>int Gv; // temporary var\nVm = Vm + (-Ia*G)*dt;\nGv = (Vm &gt; Vopen) ? 1 : G; \nIa = Ia + (Vm*Ra*Gv)*dt;\nG = (Ia &gt; Ihold) ? Gv : 0;\n</code></pre>\n<hr />\n<h2>Loop body v3 (parallel, with cache):</h2>\n<pre><code>// cache new state first\nfloat Vm1 = Vm + (-Ia*G)*dt;\nfloat Ia1 = Ia + (Vm*Ra*G)*dt;\n// update memory\nG = ( Vm1 &gt; Vopen ) || (( Ia1 &gt; Ihold ) &amp;&amp; G);\nVm = Vm1;\nIa = Ia1; // not nesesary to cache, done for readibility\n</code></pre>\n<p>the G was taken from building up the following truth table, plus imagination:\n<a href=\"https://i.stack.imgur.com/zLfxJ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zLfxJ.png\" alt=\"enter image description here\" /></a></p>\n<hr />\n<h2>Q:</h2>\n<ul>\n<li>Which is correct? Are they?</li>\n<li>How third variant(parallel logic) differs from first two(serial logic)?</li>\n<li>Are there more effective ways of doing this logic?</li>\n</ul>\n<p>PS. I am trying to optimize it for SSE, and then (separately) for OpenCL (if that gives optimisation hints)</p>\n<p>PPS. For those who is curious, here is <a href=\"https://jsfiddle.net/zo2xuhds/embedded/result\" rel=\"nofollow noreferrer\">my working simulator</a>, involving this gate (html/js)</p>\n"}, {"tags": ["c", "arrays", "segmentation-fault", "runtime-error"], "comments": [{"owner": {"reputation": 19, "user_id": 11409664, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-trifoa9LQRI/AAAAAAAAAAI/AAAAAAAAAHM/d7Bcu6mCoAg/photo.jpg?sz=128", "display_name": "blackbirb", "link": "https://stackoverflow.com/users/11409664/blackbirb"}, "edited": false, "score": 0, "creation_date": 1556714983, "post_id": 55936537, "comment_id": 98525659, "body": "just a note, I accidentally deleted the closing brace at the end of the reverse function, this is not my issue."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556715461, "post_id": 55936537, "comment_id": 98525868, "body": "Note that even the second edition of K&amp;R is very dated.  Despite my respect for the authors, I recommend choosing a book better aligned with the current version of the language."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1556715482, "post_id": 55936537, "comment_id": 98525884, "body": "<code>printf(&quot;%s\\n&quot;, c);</code> in <code>main()</code>, expects a <code>char *</code> but <code>c</code> is an <code>int</code>."}, {"owner": {"reputation": 26377, "user_id": 7734, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/ced37e94f2fabfd8b4bb78e573947a68?s=128&d=identicon&r=PG", "display_name": "EvilTeach", "link": "https://stackoverflow.com/users/7734/evilteach"}, "edited": false, "score": 0, "creation_date": 1556716163, "post_id": 55936537, "comment_id": 98526167, "body": "@blackbirb - you can edit the question and insert the missing brace."}, {"owner": {"reputation": 15297, "user_id": 7631480, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zcBMm.png?s=128&g=1", "display_name": "CryptoFool", "link": "https://stackoverflow.com/users/7631480/cryptofool"}, "edited": false, "score": 0, "creation_date": 1556770717, "post_id": 55936537, "comment_id": 98543839, "body": "You&#39;re comparing two integers.  That doesn&#39;t involve any memory access that should cause a segmentation fault.  How are you so sure that that&#39;s the line where the seg fault is occurring?  If it&#39;s really occurring there, then something has probably corrupted your stack because code that compares two stack variables shouldn&#39;t be able to seg fault.  Do the print statements just before that statement print the values you&#39;d expect .  If so then that really suggests that it isn&#39;t that comparison that&#39;s causing the seg fault."}], "answers": [{"tags": [], "owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "is_accepted": false, "score": 4, "last_activity_date": 1556715510, "creation_date": 1556715510, "answer_id": 55936666, "question_id": 55936537, "link": "https://stackoverflow.com/questions/55936537/i-cant-understand-this-segmentation-fault/55936666#55936666", "title": "I can&#39;t understand this segmentation fault", "body": "<p>The <code>j == i;</code> line is not causing the problem, it's not doing anything. The issue is here:</p>\n\n<pre><code>while ((c = reverse(line)) != EOF) {\n    printf(\"%s\\n\", c);\n}\n</code></pre>\n\n<p>You're trying to print a string, but you're giving it <code>c</code>, which is an <code>int</code>. Passing the wrong data type to <code>printf</code> is undefined behavior and that's what causes your segmentation fault. You probably wanted this instead:</p>\n\n<pre><code>printf(\"%s\\n\", line);\n</code></pre>\n\n<p>Also note that you didn't null-terminate your string yet. In your <code>reverse</code> function, you  need this:</p>\n\n<pre><code>printf(\"BEFORE REVERSING\\n\");\nline[i] = '\\0';\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2323, "user_id": 8350647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJNHD.png?s=128&g=1", "display_name": "Nina", "link": "https://stackoverflow.com/users/8350647/nina"}, "is_accepted": false, "score": 2, "last_activity_date": 1556715742, "creation_date": 1556715742, "answer_id": 55936701, "question_id": 55936537, "link": "https://stackoverflow.com/questions/55936537/i-cant-understand-this-segmentation-fault/55936701#55936701", "title": "I can&#39;t understand this segmentation fault", "body": "<p>The line <code>j == i</code> is completely irrelevant to your segmentation fault. The main issue for your segmentation fault is your <code>printf(\"%s\\n\", c);</code> statement. Because you're trying to print a string while passing an int as the argument. If you want to print the result of <code>getchar</code>, you can use the function <code>putchar</code> or as the alternative <code>printf(\"%c\")</code>. Try this and it shouldn't crash.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define MAXLENGTH 1000\nint reverse(char line[]);\n\nint main()\n{\n    int c = 0;\n    char line[MAXLENGTH];\n\n    while ((c = reverse(line)) != EOF) {\n        putchar(c);\n    }\n\n    return 0;\n}\n\nint reverse(char line[])\n{\n\n    int i, c, j, l;\n    i = c = j = l = 0;\n\n    printf(\"BEFORE GETARRAY\\n\");\n    while ((c = getchar()) != '\\n' &amp;&amp; c != EOF) {\n        line[i] = c;\n        i++;\n        printf(\"i: %d\\n\", i);\n    }\n\n    l = i - 1;\n    printf(\"i: %d\\n\", i);\n    printf(\"l: %d\\n\", l);\n    printf(\"j: %d\\n\", j);\n    printf(\"BEFORE REVERSING\\n\");\n\n    return c;\n}\n</code></pre>\n\n<p>I removed the redundant <code>j == i</code> statement as well.</p>\n"}], "owner": {"reputation": 19, "user_id": 11409664, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-trifoa9LQRI/AAAAAAAAAAI/AAAAAAAAAHM/d7Bcu6mCoAg/photo.jpg?sz=128", "display_name": "blackbirb", "link": "https://stackoverflow.com/users/11409664/blackbirb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1556720795, "creation_date": 1556714879, "question_id": 55936537, "link": "https://stackoverflow.com/questions/55936537/i-cant-understand-this-segmentation-fault", "title": "I can&#39;t understand this segmentation fault", "body": "<p>To preface: I am very new to both programming and C in general. I am going through K&amp;R and I am trying to solve exercise 1-19. </p>\n\n<p>I don't understand what is causing this segmentation fault in the line j == i;.</p>\n\n<p>I've been trying various combinations of code to find out whats wrong.</p>\n\n<p>I originally had a loop to try and reverse the character array, as per the exercise, but through troubleshooting I arrived at the j == i; line. </p>\n\n<p>Nothing seems wrong with these two values, but trying to compare them gives me an error.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define MAXLENGTH 1000\nint reverse(char line[]);\n\nmain()\n{\n  int c = 0;\n  char line[MAXLENGTH];\n\n  while ((c = reverse(line)) != EOF) {\n    printf(\"%s\\n\", c);\n  }\n\n  return 0;\n}\n\nint reverse(char line[])\n{\n  char r[MAXLENGTH];\n\n  int i, c, j, l;\n  i = c = j = l = 0;\n\n  printf(\"BEFORE GETARRAY\\n\");\n  while ((c = getchar()) != '\\n' &amp;&amp; c != EOF) {\n    line[i] = c;\n    i++;\n    printf(\"i: %d\\n\", i);\n  }\n\n  l = i - 1;\n  printf(\"i: %d\\n\", i);\n  printf(\"l: %d\\n\", l);\n  printf(\"j: %d\\n\", j);\n  printf(\"BEFORE REVERSING\\n\");\n\n  j == i;\n  return c;\n</code></pre>\n\n<p>I would expect the comparison to conclude without error.</p>\n\n<p>If you could describe not just what is wrong, but why, so that I can try improving, that would be wonderful.</p>\n"}, {"tags": ["c", "pointers", "directory"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 2, "creation_date": 1556715091, "post_id": 55936518, "comment_id": 98525717, "body": "Please adopt a less spacy formatting style and a more consistent indentation style. Also please learn about formatting here <a href=\"https://stackoverflow.com/editing-help\">stackoverflow.com/editing-help</a>"}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1556715159, "post_id": 55936518, "comment_id": 98525744, "body": "I understand that input is important for your problem, please augment your <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> with pairs of sample input and expected output."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556721001, "post_id": 55936518, "comment_id": 98528423, "body": "the posted code does not compile!  Amongst other things, it is missing the needed include statements for the needed header files.  Are you expecting us to guess as to what header files your code actually uses?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556721236, "post_id": 55936518, "comment_id": 98528546, "body": "OT:  regarding this kind of statement: <code>path=(char*)malloc(sizeof(char)*50);</code>   1) the returned type is <code>void*</code> which can be assigned to any pointer.  Casting just clutters the code, making it more difficult to understand, debug, etc.  2) the expression: <code>sizeof(char)</code>  is defined in the C standard as 1.  Multiplying anything by 1 had no effect.  Suggest removing that expression  3) when calling any of the heap allocation functions, always check (!=NULL) the returned value to assure the operation was successful"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556721487, "post_id": 55936518, "comment_id": 98528680, "body": "OT:  regarding: <code>scanf(&quot;%s&quot;,username);</code>  1) always check the returned value (not the parameter values) to assure the operation was successful.  2) to avoid a possible buffer overflow and the resulting undefined behavior,  when using the input format specifiers &#39;%s&#39; and/or &#39;%[...]&#39;, always include a MAX CHARACTERS modifier that is one less than the length of the input buffer because those format specifiers always append a NUL byte to the input.  I.E.  if( scanf(&quot;%49s&quot;,username) != 1 ) { // handle error }`"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556721852, "post_id": 55936518, "comment_id": 98528880, "body": "the function: <code>modifier()</code> is being called before it is defined.  The result is the initial call will be seen by the compiler as having <code>int</code> return type and <code>int</code> parameter.   Your compiler should have told you about this problem.   When compiling, always enable the warnings, then fix those warnings.  ( for <code>gcc</code>, at a minimum use: <code>-Wall -Wextra -Wconversion -pedantic -std=gnu11</code> )  Note other compilers use different options to obtain the same results"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556721967, "post_id": 55936518, "comment_id": 98528918, "body": "the posted code is missing the function: <code>transform()</code>  Please add that function"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556722323, "post_id": 55936518, "comment_id": 98529133, "body": "regarding: <code>printf(&quot;%s\\n&quot;, dir-&gt;d_name);</code>  the field <code>d_name</code> will contain NULL when the entry is not a directory, (I.E. a normal file or a link).   Regarding: <code>strcpy(username1,dir-&gt;d_name);</code>  When the entry in the directory is not for a sub directory, this will try to read from address 0.  The result is undefined behavior and will result in a seg fault event"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556722470, "post_id": 55936518, "comment_id": 98529217, "body": "OT: a path can easily exceed 49 characters, Suggest the heap allocation of 50 characters be expanded, to (for instance) 1024 characters"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556722589, "post_id": 55936518, "comment_id": 98529267, "body": "OT: regarding: <code>for(temp=0; temp&lt;50; temp++)       {         *(username1+temp)=&#39;\\0&#39;;       }</code>  What are you expecting this to do?  Suggest: <code>memset( username1, &#39;\\0&#39;, 50 );</code>  and it is not necessary as the statements:  <code>strcpy(username1,dir-&gt;d_name);       printf(&quot;%s&quot;,username1);</code> will properly display the directory name"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556722833, "post_id": 55936518, "comment_id": 98529397, "body": "in function: <code>main()</code> the local variable <code>i</code> is declared, but never used.  Suggest removing that declaration"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556723040, "post_id": 55936518, "comment_id": 98529507, "body": "regarding: <code>temp_filename= (char*)malloc(sizeof(int)*100);</code>  this allocates (depending on the underlying hardware architecture) 400 or 800 bytes.  However, the code fails to ever return that allocation to the heap.   The result is a memory leak each time the function <code>modifier()</code> is called"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556754653, "post_id": 55936518, "comment_id": 98541059, "body": "OT:  regarding: <code>username1=(char*)malloc(sizeof(char)*50);</code> and <code>for(temp=0; temp&lt;50; temp++) { *(username1+temp)=&#39;\\0&#39;; }</code>  Suggest simply calling: <code>username1 = calloc(50,1);</code>  as that will result in the 50 byte allocation, already initialized to all &#39;\\0&#39;."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556754930, "post_id": 55936518, "comment_id": 98541102, "body": "regarding: <code>char *path;   path=(char*)malloc(sizeof(char)*50);</code> This allocation, is never returned to the heap (via <code>free()</code>) so it results in a memory leak"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556755125, "post_id": 55936518, "comment_id": 98541140, "body": "OT: regarding: <code>void counterfile(char *username)</code>  the parameter is actually a directory name, not a user name.  Variable ( and parameter) names should indicate <code>content</code> or <code>usage</code> ( or better, both )"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556755175, "post_id": 55936518, "comment_id": 98541148, "body": "OT:  an indent level of 2 characters will &#39;disappear&#39; when using variable width fonts.  Suggest each indent level be 4 spaces"}], "owner": {"user_type": "does_not_exist", "display_name": "user11436977"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1556714981, "creation_date": 1556714769, "last_edit_date": 1556714981, "question_id": 55936518, "link": "https://stackoverflow.com/questions/55936518/why-error-in-code-where-i-am-trying-to-display-the-files-present-in-a-directory", "title": "why error in code where i am trying to display the files present in a directory", "body": "<p>The code below is about displaying all the file present in the directory(path for the directory is extracted from the username), but it is printing only one file and not able to run the modifier function[given in the code].</p>\n\n<p>counterfile funtion is being used to determine the name of the files in the directory.</p>\n\n<p>modifier function is being used to change the obtained filename in a definite layout i.e</p>\n\n<p>-----filename--------------date &amp; time ----------</p>\n\n<pre><code>void counterfile(char *username)    \n{    \n  DIR *d;    \n  struct dirent *dir;\n\n  char *username1; \n  char *path;\n  path=(char*)malloc(sizeof(char)*50);\n  username1=(char*)malloc(sizeof(char)*50);\n  strcpy(path,\"/home/kuut/project/\");\n  strcat(path,transform(username));      \n\n  int i=1, temp, choice;      \n\n  system(\"clear\");\n  d = opendir(path); \n\n  if (d)\n  {\n    while ((dir = readdir(d)) != NULL)\n    {          \n      if(strcmp(dir-&gt;d_name,\"..\")==0|| strcmp(dir-&gt;d_name, \".\")==0)\n          continue;          \n\n      printf(\"%d. \",i);\n      printf(\"%s\\n\", dir-&gt;d_name);\n      //send(fd1, dir-&gt;d_name, 100, 0);\n      for(temp=0; temp&lt;50; temp++)\n      {\n        *(username1+temp)='\\0';\n      }\n\n      strcpy(username1,dir-&gt;d_name);\n      printf(\"%s\",username1);\n\n      modifier(username1);\n      i++;          \n    }    \n    closedir(d);\n  }      \n}\n\nvoid modifier(char *filename)\n{\n    char *temp_filename;\n    int length,i,j;\n    printf(\"h\");\n    temp_filename= (char*)malloc(sizeof(int)*100);\n    length= strlen(filename);\n\n    for(j=0; j&lt;3; j++)\n    {\n        *(temp_filename + j)=' ';\n    }\n    for(i=0; *(filename+i)!='@'; i++)\n    {\n        *(temp_filename + j)=*(filename+i);\n        j++;\n    }\n\n    while(j!=40)\n    {\n        *(temp_filename + j)=' ';\n        j++;            \n    }\n    i++;\n    while(*(filename+i) !='.')\n    {\n        *(temp_filename + j)=*(filename+i);\n        i++;\n        j++;\n    }       \n    printf(\"%s\",temp_filename);\n}    \n\nint main()\n{\n    char *username;\n    username=(char*)malloc(sizeof(char)*50);\n    //username1=(char*)malloc(sizeof(char)*50);\n    int i;\n    printf(\"Enter the username: \");\n    scanf(\"%s\",username);\n\n    counterfile(username);\n    return 0;\n}\n</code></pre>\n\n<ol>\n<li>rabbit May  1 13:28:14 2019\n.txt</li>\n</ol>\n\n<p>rabbit May  1 13:28:14 2019</p>\n\n<p>Segmentation fault (core dumped)</p>\n"}, {"tags": ["php", "c", "php-extension"], "comments": [{"owner": {"reputation": 482, "user_id": 5398951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345993ff7c013e128f90bbcbb17a9da3?s=128&d=identicon&r=PG&f=1", "display_name": "SpacePhoenix", "link": "https://stackoverflow.com/users/5398951/spacephoenix"}, "edited": false, "score": 0, "creation_date": 1556715255, "post_id": 55936245, "comment_id": 98525782, "body": "I don&#39;t know anything about C but does this line just set default values?  int ssh_port = 0, remote_port = 0, local_port = 0, to_close_tunnel = 0, thread_is_runnning = 0, is_authenticated = 0;"}, {"owner": {"reputation": 891, "user_id": 7831222, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/76aef9f71e92e71386e40601e739f908?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7831222/mikael"}, "reply_to_user": {"reputation": 482, "user_id": 5398951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345993ff7c013e128f90bbcbb17a9da3?s=128&d=identicon&r=PG&f=1", "display_name": "SpacePhoenix", "link": "https://stackoverflow.com/users/5398951/spacephoenix"}, "edited": false, "score": 0, "creation_date": 1556715337, "post_id": 55936245, "comment_id": 98525813, "body": "I am also not expert in C. This is why I am asking here. As I guess yes - it should define variable with int type and set 0 value"}], "answers": [{"comments": [{"owner": {"reputation": 891, "user_id": 7831222, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/76aef9f71e92e71386e40601e739f908?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7831222/mikael"}, "edited": false, "score": 0, "creation_date": 1556716894, "post_id": 55936827, "comment_id": 98526505, "body": "Thank u for your answer, but I just checked, zend_parse_parameters - doesn&#39;t fail"}, {"owner": {"reputation": 834, "user_id": 9295224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f257d8a2c3096d45044d0807a2f8e43?s=128&d=identicon&r=PG&f=1", "display_name": "bogdan tudose", "link": "https://stackoverflow.com/users/9295224/bogdan-tudose"}, "reply_to_user": {"reputation": 891, "user_id": 7831222, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/76aef9f71e92e71386e40601e739f908?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7831222/mikael"}, "edited": false, "score": 0, "creation_date": 1556717235, "post_id": 55936827, "comment_id": 98526675, "body": "I just saw your edit. If you commented the code and correct value for <code>ssh_port</code> is displayed doesn&#39;t this mean that the <code>if</code> clause commented made the function to return early by calling <code>return;</code> and the <code>var_dump</code> to display what <code>return;</code> gives which happen to be a 0?"}, {"owner": {"reputation": 891, "user_id": 7831222, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/76aef9f71e92e71386e40601e739f908?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7831222/mikael"}, "edited": false, "score": 0, "creation_date": 1556717558, "post_id": 55936827, "comment_id": 98526802, "body": "You know, not a fact. I am sure that zend_parse_parameters is success and it doesn&#39;t go into if(zend_parse_parameters) block. I think really it set 0 to ssh_port variable for some reason"}, {"owner": {"reputation": 891, "user_id": 7831222, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/76aef9f71e92e71386e40601e739f908?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7831222/mikael"}, "edited": false, "score": 0, "creation_date": 1556717756, "post_id": 55936827, "comment_id": 98526868, "body": "Also I noticed that remote_port also has 0 value. But local_port gets right value"}], "tags": [], "owner": {"reputation": 834, "user_id": 9295224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f257d8a2c3096d45044d0807a2f8e43?s=128&d=identicon&r=PG&f=1", "display_name": "bogdan tudose", "link": "https://stackoverflow.com/users/9295224/bogdan-tudose"}, "is_accepted": false, "score": 0, "last_activity_date": 1556716382, "creation_date": 1556716382, "answer_id": 55936827, "question_id": 55936245, "link": "https://stackoverflow.com/questions/55936245/php-extension-why-int-var-changes-to-0/55936827#55936827", "title": "PHP extension: why int var changes to 0?", "body": "<p>Actually, I think you have is an undefined behavior. </p>\n\n<p>Firstly <code>PHP_FUNCTION</code> is expanded to <code>void zif_FUNCNAME(zend_execute_data *execute_data, zval *return_value)</code>.</p>\n\n<p>According to <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1124.pdf\" rel=\"nofollow noreferrer\">C Standard</a>:</p>\n\n<blockquote>\n  <p><strong>6.8.6.4 The return statement</strong></p>\n  \n  <p><strong>Constraints</strong></p>\n  \n  <ol>\n  <li>A return statement with an expression shall not appear in a function whose return type is void. A return statement without an expression shall only appear in a function whose return type is void.</li>\n  </ol>\n  \n  <p><strong>6.9.1 Function definitions</strong></p>\n  \n  <ol start=\"12\">\n  <li>If the } that terminates a function is reached, and the value of the function call is used by the caller, the behavior is undefined.</li>\n  </ol>\n</blockquote>\n\n<p>So, in your case <code>zend_parse_parameters</code> returns <code>FAILURE</code> which is then translated into \"ending before reaching closing <code>{</code>, so that's why the value of <code>ssh_port</code> is never returned.</p>\n\n<p>The reason why <code>zend_parse_parameters</code> fails is because one of the arguments is not initialized different than 0</p>\n"}], "owner": {"reputation": 891, "user_id": 7831222, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/76aef9f71e92e71386e40601e739f908?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7831222/mikael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1556716382, "creation_date": 1556713464, "last_edit_date": 1556715258, "question_id": 55936245, "link": "https://stackoverflow.com/questions/55936245/php-extension-why-int-var-changes-to-0", "title": "PHP extension: why int var changes to 0?", "body": "<p>I am developing some PHP extension on C. I have few functions and several variables (char and int) defined globally at the top of C code. At php side I call the first function and pass some value for ssh_port argument - 22. this value set to global var. Then I call second function. But when I call third function - ssh_port variable suddenly gets 0 value ? Why ? The code is following:</p>\n\n<pre><code>#include &lt;php.h&gt;\n#include \"super_ssh.h\"\n\n#include &lt;libssh2.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n\n#include &lt;fcntl.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;stdio.h&gt;\n#ifdef HAVE_STDLIB_H\n#include &lt;stdlib.h&gt;\n#endif\n#ifdef HAVE_UNISTD_H\n#include &lt;unistd.h&gt;\n#endif\n#include &lt;sys/types.h&gt;\n#ifdef HAVE_SYS_SELECT_H\n#include &lt;sys/select.h&gt;\n#endif\n\n#ifndef INADDR_NONE\n#define INADDR_NONE (in_addr_t)-1\n#endif\n\n    char *ssh_ip, *ssh_username, *ssh_password, *remote_host, *last_error = \"\";\n    size_t ssh_ip_len, ssh_username_len, ssh_password_len, remote_host_len;\n\n    int ssh_port = 0, remote_port = 0, local_port = 0, to_close_tunnel = 0, thread_is_runnning = 0, is_authenticated = 0;\n\n    PHP_FUNCTION(super_ssh_connect) {\n      if (zend_parse_parameters(\n        ZEND_NUM_ARGS(),\n        \"sl\",\n        &amp;ssh_ip,\n        &amp;ssh_ip_len,\n        &amp;ssh_port\n      ) == FAILURE) {\n          return;\n      }\n\n      RETURN_LONG(ssh_port);\n\n    }\n\n    PHP_FUNCTION(super_ssh_authenticate) {\n      if (zend_parse_parameters(\n        ZEND_NUM_ARGS(),\n        \"ss\",\n        &amp;ssh_username,\n        &amp;ssh_username_len,\n        &amp;ssh_password,\n        &amp;ssh_password_len\n      ) == FAILURE) {\n          return;\n      }\n\n      RETURN_LONG(ssh_port);\n    }\n\n    PHP_FUNCTION(super_ssh_open_tunnel) {\n\n      if (zend_parse_parameters(\n        ZEND_NUM_ARGS(),\n        \"sll\",\n        &amp;remote_host,\n        &amp;remote_host_len,\n        &amp;remote_port,\n        &amp;local_port\n      ) == FAILURE) {\n          return;\n      }\n\n      RETURN_LONG(ssh_port);\n\n    }\n\n\n\n\n\n    ZEND_BEGIN_ARG_INFO_EX(arginfo_super_ssh_connect, 0, 0, 2)\n      ZEND_ARG_INFO(0, ssh_ip)\n      ZEND_ARG_INFO(0, ssh_port)\n    ZEND_END_ARG_INFO()\n\n    ZEND_BEGIN_ARG_INFO_EX(arginfo_super_ssh_authenticate, 0, 0, 2)\n        ZEND_ARG_INFO(0, ssh_username)\n      ZEND_ARG_INFO(0, ssh_password)\n    ZEND_END_ARG_INFO()\n\n    ZEND_BEGIN_ARG_INFO_EX(arginfo_super_ssh_open_tunnel, 0, 0, 3)\n      ZEND_ARG_INFO(0, remote_host)\n      ZEND_ARG_INFO(0, remote_port)\n      ZEND_ARG_INFO(0, local_port)\n    ZEND_END_ARG_INFO()\n\n    zend_function_entry super_ssh_functions[] = {\n      PHP_FE(super_ssh_connect, arginfo_super_ssh_connect)\n      PHP_FE(super_ssh_authenticate, arginfo_super_ssh_authenticate)\n      PHP_FE(super_ssh_open_tunnel, arginfo_super_ssh_open_tunnel)\n      PHP_FE_END\n    };\n\n    zend_module_entry super_ssh_module_entry = {\n      STANDARD_MODULE_HEADER,\n      PHP_SUPER_SSH_EXTNAME,\n      super_ssh_functions,\n      NULL,\n      PHP_MSHUTDOWN(super_ssh),\n      NULL,\n      NULL,\n      NULL,\n      PHP_SUPER_SSH_VERSION,\n      STANDARD_MODULE_PROPERTIES,\n    };\n\n    ZEND_GET_MODULE(super_ssh);\n</code></pre>\n\n<p>And the code of PHP side:</p>\n\n<pre><code>&lt;?php\n\nvar_dump(super_ssh_connect(\"234.43.23.3\", 22));\nvar_dump(super_ssh_authenticate(\"dfds\", \"mofsdfdsnitor\"));\nvar_dump(super_ssh_open_tunnel(\"server\", 993, 4444));\n</code></pre>\n\n<p>Actual result is:</p>\n\n<p>int(22) int(22) int(0)</p>\n\n<p>Expected result is:</p>\n\n<p>int(22) int(22) int(22)</p>\n\n<p>So the question is why the ssh_port variable gets 0 value ? I don't set it anywhere! Really can't understand it :(</p>\n\n<p>The interesting thing is that the problem is actual for apache php. So it happens when I run the script from browser. (apache2 + php)</p>\n\n<p>If I try the same compilation for PHP CLI it works as expected, the output is:</p>\n\n<p>int(22) int(22) int(22)</p>\n\n<p>May be it is somehow touching with garbage collector ? Or maybe you just can me suggest better way for my code how to work with variables?</p>\n\n<p>My environment:  </p>\n\n<p>Ubuntu 18.04.1 LTS, apache2 + PHP Version 7.2.17-1, and PHP CLI is PHP 7.2.2 (cli) (built: Apr 29 2019 09:57:40) ( ZTS DEBUG )</p>\n\n<p>I noticed problematic code, if I comment the following code frpm third super_ssh_open_tunnel function - it works.</p>\n\n<p>Commenting this code make it work, without this code I still have 22 in the ssh_port var</p>\n\n<pre><code> if (zend_parse_parameters(\n        ZEND_NUM_ARGS(),\n        \"sll\",\n        &amp;remote_host,\n        &amp;remote_host_len,\n        &amp;remote_port,\n        &amp;local_port\n      ) == FAILURE) {\n          return;\n      }\n</code></pre>\n"}, {"tags": ["c", "wiringpi"], "comments": [{"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1556713310, "post_id": 55935864, "comment_id": 98524903, "body": "Why the threads?"}, {"owner": {"reputation": 5, "user_id": 10967774, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ILQLQnVFNEk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOjn7YBmfrs3YaIP1cwPaA1_79LZQ/mo/photo.jpg?sz=128", "display_name": "God Himself", "link": "https://stackoverflow.com/users/10967774/god-himself"}, "reply_to_user": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1556713473, "post_id": 55935864, "comment_id": 98524974, "body": "so multiple can be done at once .-."}, {"owner": {"reputation": 764, "user_id": 2899478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/juuUm.jpg?s=128&g=1", "display_name": "o_weisman", "link": "https://stackoverflow.com/users/2899478/o-weisman"}, "edited": false, "score": 1, "creation_date": 1556714149, "post_id": 55935864, "comment_id": 98525288, "body": "I don&#39;t know wiringpi but does judging from your code, it doesn&#39;t define the concept of simultaneous button presses meaning you probably need to start some sort of timer as soon as one button pressed is recognized and wait a previously defined amount of time before giving up on the second button press and declaring it non-simultaneous."}, {"owner": {"reputation": 5, "user_id": 10967774, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ILQLQnVFNEk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOjn7YBmfrs3YaIP1cwPaA1_79LZQ/mo/photo.jpg?sz=128", "display_name": "God Himself", "link": "https://stackoverflow.com/users/10967774/god-himself"}, "edited": false, "score": 0, "creation_date": 1556714603, "post_id": 55935864, "comment_id": 98525479, "body": "Do you know any that do work with simultaneous button presses without the use of timers etc?"}, {"owner": {"reputation": 10359, "user_id": 1216776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504692de390dabd9ca22fd716e178993?s=128&d=identicon&r=PG", "display_name": "stark", "link": "https://stackoverflow.com/users/1216776/stark"}, "edited": false, "score": 0, "creation_date": 1556714659, "post_id": 55935864, "comment_id": 98525503, "body": "Multiple threads don&#39;t run at the same time.  It is inefficient to put threads in the same process on different cores, since it breaks caching."}, {"owner": {"reputation": 5, "user_id": 10967774, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ILQLQnVFNEk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOjn7YBmfrs3YaIP1cwPaA1_79LZQ/mo/photo.jpg?sz=128", "display_name": "God Himself", "link": "https://stackoverflow.com/users/10967774/god-himself"}, "edited": false, "score": 0, "creation_date": 1556714870, "post_id": 55935864, "comment_id": 98525611, "body": "Nope? I&#39;ve already tried without threads, doesn&#39;t work the same way lawl"}], "owner": {"reputation": 5, "user_id": 10967774, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ILQLQnVFNEk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOjn7YBmfrs3YaIP1cwPaA1_79LZQ/mo/photo.jpg?sz=128", "display_name": "God Himself", "link": "https://stackoverflow.com/users/10967774/god-himself"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556711715, "creation_date": 1556711715, "question_id": 55935864, "link": "https://stackoverflow.com/questions/55935864/how-can-i-detect-simultaneous-button-presses", "title": "How can I detect simultaneous button presses", "body": "<p>I want to make button 1 and 2 silent when both are pressed at the same time. It works... but only sometimes. Sometimes it will only print \"sim pressed\" and other times it will say \"Button-1 Clicked\" and \"Sim pressed\"</p>\n\n<p>I want to make it so when btn 1 and btn 2 are pressed at the same time they don't print \"button-1 clicked\" or \"button-2 clicked\" but they print \"sim pressed\"</p>\n\n<p>How could I make this happen?</p>\n\n<p>I've tried researching simultaneous button presses but I myself couldn't find anything for wiringPi</p>\n\n<p>Includes</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;wiringPi.h&gt;\n\n#define sd 200\n#define pin1 8\n#define pin2 7\n\nint a, b, c = 1;\n</code></pre>\n\n<p>Button 1 button Press</p>\n\n<pre><code>void *btn1() {\n    while(1) {\n        if(!digitalRead(pin1) &amp;&amp; digitalRead(pin2) &amp;&amp; a) {\n            a = 0;\n            printf(\"Button-1 pressed\\n\");\n            delay(sd);\n        }\n        if(digitalRead(pin1) &amp;&amp; !a) {\n            a = 1;\n        }\n    }\n}\n</code></pre>\n\n<p>Button 2 button press</p>\n\n<pre><code>void *btn2() {\n    while(1) {\n        if(!digitalRead(pin2) &amp;&amp; digitalRead(pin1) &amp;&amp; b) {\n            b = 0;\n            printf(\"Button-2 pressed\\n\");\n            delay(sd);\n        }\n        if(digitalRead(pin2) &amp;&amp; !b) {\n            b = 1;\n        }\n    }\n}\n</code></pre>\n\n<p>Simultaneous button press</p>\n\n<pre><code>void *simbtn() {\n    while(1) {\n        if(!digitalRead(pin1) &amp;&amp; !digitalRead(pin2) &amp;&amp; c) {\n            c = 0;\n            printf(\"Sim pressed\\n\");\n            delay(sd);\n        }\n        if(digitalRead(pin1) &amp;&amp; digitalRead(pin2) &amp;&amp; !c) {\n            c = 1;\n        }\n    }\n}\n</code></pre>\n\n<p>Creating the thread</p>\n\n<pre><code>int main(void) {\n    wiringPiSetupGpio();\n\n    pthread_t tid[2];\n    pthread_create(&amp;tid[0], NULL, btn1, NULL);\n    pthread_create(&amp;tid[1], NULL, btn2, NULL);\n    pthread_create(&amp;tid[2], NULL, simbtn, NULL);\n\n    while(1) {}\n\n    return 0;\n}\n</code></pre>\n\n<p>Expected result once btn 1 and 2 pressed simultaneously:</p>\n\n<pre><code>Sim pressed\n</code></pre>\n\n<p>Actual result when both are pressed (6 times to give a good example):</p>\n\n<pre><code>Button-1 pressed\nSim pressed\nButton-1 pressed\nsim pressed\nbutton-2 pressed\nsim pressed\nButton-1 pressed\nSim pressed\nButton-2 pressed\nsim pressed\nbutton-2 pressed\nsim pressed\n</code></pre>\n"}, {"tags": ["c", "sum", "integer", "primes"], "comments": [{"owner": {"reputation": 43256, "user_id": 36866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae5de8fa45f79815c64b98690088a48d?s=128&d=identicon&r=PG", "display_name": "some", "link": "https://stackoverflow.com/users/36866/some"}, "edited": false, "score": 0, "creation_date": 1556710034, "post_id": 55935460, "comment_id": 98523580, "body": "Isn&#39;t is just because there are larger gaps between the prime numbers? (and if you are searching for prime numbers, you don&#39;t need to check even numbers)"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1556710342, "post_id": 55935460, "comment_id": 98523697, "body": "What do you mean by &quot;won&#39;t run&quot;? Does the program crash? Have you tried to catch the crash in a debugger?"}, {"owner": {"reputation": 27045, "user_id": 5923139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dvoYw.png?s=128&g=1", "display_name": "Aplet123", "link": "https://stackoverflow.com/users/5923139/aplet123"}, "edited": false, "score": 1, "creation_date": 1556710348, "post_id": 55935460, "comment_id": 98523699, "body": "By running endlessly, do you mean that it outputs numbers above the upper bound, or do you mean that it just takes a long time? Because for such large numbers it will take a very long time."}, {"owner": {"reputation": 53, "user_id": 11436716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6c643a060a58312265948605b11e0b1?s=128&d=identicon&r=PG&f=1", "display_name": "Takelovski", "link": "https://stackoverflow.com/users/11436716/takelovski"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556714360, "post_id": 55935460, "comment_id": 98525371, "body": "@some yeah i know man but i am asking in general because i have encountered this problem many times"}, {"owner": {"reputation": 53, "user_id": 11436716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6c643a060a58312265948605b11e0b1?s=128&d=identicon&r=PG&f=1", "display_name": "Takelovski", "link": "https://stackoverflow.com/users/11436716/takelovski"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556714518, "post_id": 55935460, "comment_id": 98525444, "body": "@Someprogrammerdude sorry for that, yes it runs but endlessly yeah with no output"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 11436716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6c643a060a58312265948605b11e0b1?s=128&d=identicon&r=PG&f=1", "display_name": "Takelovski", "link": "https://stackoverflow.com/users/11436716/takelovski"}, "edited": false, "score": 0, "creation_date": 1556715532, "post_id": 55935644, "comment_id": 98525908, "body": "Never considered debugging because i&#39;ve always thought of it as a hardware limitation, now i see ! thank you so much man"}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "reply_to_user": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1556722124, "post_id": 55935644, "comment_id": 98529018, "body": "@chqrlie sometimes I forget that there are at least some guarantees on integer sizes. :) thanks for the hint, it&#39;s fixed now."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 1, "creation_date": 1556722458, "post_id": 55935644, "comment_id": 98529209, "body": "OK, it is actually at least 63 value bits plus a sign bit :)"}], "tags": [], "owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "is_accepted": true, "score": 2, "last_activity_date": 1556777278, "last_edit_date": 1556777278, "creation_date": 1556710594, "answer_id": 55935644, "question_id": 55935460, "link": "https://stackoverflow.com/questions/55935460/why-does-a-code-keeps-running-endlessly-after-a-certain-number-of-iterations/55935644#55935644", "title": "Why does a code keeps running endlessly after a certain number of iterations?", "body": "<p>This is going to overflow with 32 bit integers. That's undefined behavior and while that typically won't cause your program to run endlessly, that's a possibility, because there's no guarantee whatsoever on what happens when your program exhibits undefined behavior. Try <code>long long</code> instead, which is at least 64 bit (for the signed version, that's at least 63 bits and one sign bit).</p>\n\n<pre><code>long long s = 17;\n</code></pre>\n\n<p>And print it this way:</p>\n\n<pre><code>printf(\"%lld\", s);\n</code></pre>\n\n<p>This unoptimized version of a prime number search will take quite a while for all numbers up to <code>2000000</code>, so perhaps you just think it's running endlessly when it isn't. I recommend debugging by putting a print like <code>if (i % 1000 == 0) printf(\"%d %lld\\n\", i, s);</code> into the loop, then you can see how far along it is and if it is still working. For me, it's working (with that <code>long long</code> fix, of course).</p>\n"}, {"tags": [], "owner": {"reputation": 74, "user_id": 10641939, "user_type": "registered", "profile_image": "https://graph.facebook.com/1364723136992195/picture?type=large", "display_name": "Nikos Issaris", "link": "https://stackoverflow.com/users/10641939/nikos-issaris"}, "is_accepted": false, "score": 1, "last_activity_date": 1556719853, "creation_date": 1556719853, "answer_id": 55937617, "question_id": 55935460, "link": "https://stackoverflow.com/questions/55935460/why-does-a-code-keeps-running-endlessly-after-a-certain-number-of-iterations/55937617#55937617", "title": "Why does a code keeps running endlessly after a certain number of iterations?", "body": "<p>because you know that will be positive you can use </p>\n\n<pre><code>unsigned long long s = 17;\n</code></pre>\n\n<p>and then print it with </p>\n\n<pre><code>printf(\"%llu\",s);\n</code></pre>\n\n<p>also you can use that for i</p>\n"}], "owner": {"reputation": 53, "user_id": 11436716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6c643a060a58312265948605b11e0b1?s=128&d=identicon&r=PG&f=1", "display_name": "Takelovski", "link": "https://stackoverflow.com/users/11436716/takelovski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 55935644, "answer_count": 2, "score": 1, "last_activity_date": 1569400443, "creation_date": 1556709732, "last_edit_date": 1569400443, "question_id": 55935460, "link": "https://stackoverflow.com/questions/55935460/why-does-a-code-keeps-running-endlessly-after-a-certain-number-of-iterations", "title": "Why does a code keeps running endlessly after a certain number of iterations?", "body": "<p>Please consider this C Code</p>\n\n<pre><code>void main() {\n    int i, s = 17;\n    for (i = 8; i &lt; 2000000; i++) {\n        if (ifprime(i))\n            s += i;\n    }\n    printf(\"%d\", s);\n}\n</code></pre>\n\n<p>It won't run with this number of iterations but produces some result with lower iterations like <code>while (i &lt; 200000)</code></p>\n\n<p>Why is that?</p>\n\n<p>(Note that I am not asking for a solution, Many thanks)</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 2, "creation_date": 1556709454, "post_id": 55935368, "comment_id": 98523357, "body": "No, that doesn&#39;t work in C. The error is telling you the truth. Why not have the function return a value (like 1 for yes and 0 for no) that you can test directly inside the switch and break on that? It could be as simple as <code>if (goback()) break;</code>"}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 0, "creation_date": 1556709754, "post_id": 55935368, "comment_id": 98523474, "body": "Wot no <code>break</code> statements?"}, {"owner": {"reputation": 11, "user_id": 11426315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6217a2b3d269d3c12c8fc738dd736dc?s=128&d=identicon&r=PG&f=1", "display_name": "Saltwalker", "link": "https://stackoverflow.com/users/11426315/saltwalker"}, "reply_to_user": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 0, "creation_date": 1556710828, "post_id": 55935368, "comment_id": 98523891, "body": "@lurker That returns error: void value not ignored as it ought to be|"}, {"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 0, "creation_date": 1556717671, "post_id": 55935368, "comment_id": 98526845, "body": "Not if done correctly. You need to modify the function to return a value. Think through it."}], "answers": [{"tags": [], "owner": {"reputation": 17, "user_id": 11052787, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eyhhN.jpg?s=128&g=1", "display_name": "Narmondil", "link": "https://stackoverflow.com/users/11052787/narmondil"}, "is_accepted": false, "score": -1, "last_activity_date": 1556710245, "last_edit_date": 1556710245, "creation_date": 1556709770, "answer_id": 55935474, "question_id": 55935368, "link": "https://stackoverflow.com/questions/55935368/can-this-if-be-added-to-this-switch-statement/55935474#55935474", "title": "Can this if be added to this switch statement?", "body": "<p>I'm not sure but you might want to add breaks after your statements if they are to be executed separately and not in sequence. here I only see your case 7 contains a break, which means all cases until that one will be executed, if that's what you want it's fine, otherwise maybe try something like this</p>\n\n<pre><code>switch (w){\ncase 1:\n    clrscr();\n    newroom();\n    goback();\n    break;\ncase 2:\n    clrscr();\n    roomscan();\n    goback();\n    break;\ncase 3:\n    ...\n\n</code></pre>\n\n<p>Here it seems that your goback() function tries to do that break but what it does it's it tries to break from the context where it if called, here an \"if\" bloc, which can't have a break inside it. That's what the compiler is saying I guess.</p>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 7756572, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d19e520856c422359d2fe5e6c99876ad?s=128&d=identicon&r=PG&f=1", "display_name": "SIDOU", "link": "https://stackoverflow.com/users/7756572/sidou"}, "is_accepted": false, "score": 0, "last_activity_date": 1556710576, "creation_date": 1556710576, "answer_id": 55935640, "question_id": 55935368, "link": "https://stackoverflow.com/questions/55935368/can-this-if-be-added-to-this-switch-statement/55935640#55935640", "title": "Can this if be added to this switch statement?", "body": "<p>of course, you got an error because of the <code>break;</code> statement break you from your <code>goback()</code> function and not from <code>case</code>.</p>\n\n<p>As you know each <code>case</code> block must end with <code>break;</code>.</p>\n\n<p>In your case, you must put the <code>break;</code> statement at the end of each <code>case</code> block and you can make the <code>goback()</code> function returning a boolean to decide if you go back or not, but you must define what to do if the user does not want to go back.</p>\n"}], "owner": {"reputation": 11, "user_id": 11426315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6217a2b3d269d3c12c8fc738dd736dc?s=128&d=identicon&r=PG&f=1", "display_name": "Saltwalker", "link": "https://stackoverflow.com/users/11426315/saltwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1556710576, "creation_date": 1556709301, "last_edit_date": 1556709534, "question_id": 55935368, "link": "https://stackoverflow.com/questions/55935368/can-this-if-be-added-to-this-switch-statement", "title": "Can this if be added to this switch statement?", "body": "<p>Hi so I'm building a hotel management program and I'm trying to make my switch statement short but it's not working. I tried to add a function that had the break inside but I get an error saying break not within a loop or a switch statement:</p>\n\n<pre><code>void goback()\n{\n    char y;\n    printf(\"Would you like to go back?(Y/N)\");\n    scanf(\"%c\",&amp;y);\n    if (y=='Y' || y=='y')\n    {\n        break;\n    }\n}\nint main(){\n    do\n    {\n        printf (\" 1. Add a Room\\n 2. Current rooms\\n 3. Add a booking\\n 4. Current bookings \\n 5. Modify a booking\\n 6. Print bill\\n 7. Exit\\n\\n\");\n        printf (\"Which section would you like to access:\");\n        scanf (\"%d\",&amp;w);\n        switch (w){\n            case 1:\n                clrscr();\n                newroom();\n                goback();\n            case 2:\n                clrscr();\n                roomscan();\n                goback();\n            case 3:\n                clrscr();\n                addbooking();\n                goback();\n            case 4:\n                clrscr();\n                currentbooking();\n                goback();\n            case 5:\n                clrscr();\n                printf(\"not ready\\n\");\n            case 6:\n                clrscr();\n                printf(\"not ready\\n\");\n            case 7:\n                clrscr();\n                printf(\"\\t\\t\\t\\tLogging out... See you next time!\");\n                exit (1);\n                break;\n            default:\n                printf(\"try again\");\n        }\n    }\n    while (w!=7);\n\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 0, "creation_date": 1556709058, "post_id": 55935280, "comment_id": 98523212, "body": "<code>printf(&quot;%4d|&quot;,person[j].assignment[i]);</code> is wrong."}, {"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 0, "creation_date": 1556709088, "post_id": 55935280, "comment_id": 98523223, "body": "Also <code>printf(&quot;%4d|&quot;,person[k].quiz[i]);</code> is wrong."}, {"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 1, "creation_date": 1556709157, "post_id": 55935280, "comment_id": 98523252, "body": "Also <code>scanf(&quot;%d&quot;,&amp;person[k].quiz[i] );</code> - it looks like you are confused about how indices work ?"}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 8367675, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uGjIyBtUM_c/AAAAAAAAAAI/AAAAAAAAADk/Fr5v_eY3fug/photo.jpg?sz=128", "display_name": "Prince", "link": "https://stackoverflow.com/users/8367675/prince"}, "edited": false, "score": 0, "creation_date": 1556725201, "post_id": 55938305, "comment_id": 98530628, "body": "i forget about that. Your answer is so helpful and the code works. Thanks!"}], "tags": [], "owner": {"reputation": 74, "user_id": 10641939, "user_type": "registered", "profile_image": "https://graph.facebook.com/1364723136992195/picture?type=large", "display_name": "Nikos Issaris", "link": "https://stackoverflow.com/users/10641939/nikos-issaris"}, "is_accepted": true, "score": 1, "last_activity_date": 1556722928, "creation_date": 1556722928, "answer_id": 55938305, "question_id": 55935280, "link": "https://stackoverflow.com/questions/55935280/error-when-calculating-the-final-result-in-the-second-person-using-array/55938305#55938305", "title": "error when calculating the final result in the second person using array", "body": "<p>i think your problem is when you start the first for loop ,you don't set the count and count2 to zero so when you type the information the second time count and count2 have values from the first time.\nso your code in main function should be something like this </p>\n\n<pre><code>int main(int argc, char const *argv[]) {\n  struct student person[10];\n  int input,count=0,count2=0,choose;\n\n  printf(\"Input Student : \");\n  scanf(\"%d\",&amp;input );\n  printf(\"\\n\");\n\n  int i,j,k;\n  for ( i = 0; i &lt; input; i++) {\n    count=0;\n    count2=0;\n    printf(\"Input Id : \");\n    scanf(\"%s\",person[i].id);\n    printf(\"Input Name : \");\n    scanf(\"%s\",person[i].fname);\n    ....\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 8367675, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uGjIyBtUM_c/AAAAAAAAAAI/AAAAAAAAADk/Fr5v_eY3fug/photo.jpg?sz=128", "display_name": "Prince", "link": "https://stackoverflow.com/users/8367675/prince"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26, "favorite_count": 0, "accepted_answer_id": 55938305, "answer_count": 1, "score": 0, "last_activity_date": 1556722928, "creation_date": 1556708877, "last_edit_date": 1556709152, "question_id": 55935280, "link": "https://stackoverflow.com/questions/55935280/error-when-calculating-the-final-result-in-the-second-person-using-array", "title": "error when calculating the final result in the second person using array", "body": "<p>after get the average of assignment and quiz, the program count the value of average.Average*0.20 for assignment and average*0.10 for quiz.The results of calculations for the first person are correct, but when it comes to the second person,the results produced are not in accordance with the calculations.</p>\n\n<p>the code:</p>\n\n<pre><code>struct student{\n  char id[10];\n  char fname[25];\n  char lname[25];\n  char letter[10];\n  int quiz[3];\n  int assignment[3];\n  int project;\n  int MID;\n  int Final;\n  int grade;\n  int percentage;\n  int average;\n  int sum;\n};\n\nint main(int argc, char const *argv[]) {\n  struct student person[10];\n  int input,count=0,count2=0,choose;\n\n  printf(\"Input Student : \");\n  scanf(\"%d\",&amp;input );\n  printf(\"\\n\");\n\n  int i,j,k;\n  for ( i = 0; i &lt; input; i++) {\n    printf(\"Input Id : \");\n    scanf(\"%s\",person[i].id);\n    printf(\"Input Name : \");\n    scanf(\"%s\",person[i].fname);\n    scanf(\"%s\",person[i].lname);\n    printf(\"\\n\");\n\n    //input assignment\n    for ( j = 0; j &lt; 3; j++) {\n      printf(\"Input Assignment%d : \",j );\n      scanf(\"%d\",&amp;person[j].assignment[i] );\n      count+=person[j].assignment[i];\n      person[i].average = count/3;\n    }\n    person[i].percentage = person[i].average*0.20;\n\n    printf(\"\\n\");\n    //input quiz\n    for ( k = 0; k &lt; 4; k++) {\n      printf(\"Input Quiz%d : \",k );\n      scanf(\"%d\",&amp;person[k].quiz[i] );\n      count2+=person[k].quiz[i];\n      person[i].average = count2/4;\n    }\n    person[i].sum = person[i].average*0.10;\n    printf(\"\\n\");\n\n    //input Project\n    printf(\"Input Project Value%d : \",i );\n    scanf(\"%d\",&amp;person[i].project );\n    person[i].project= person[i].project * 0.15;\n    printf(\"\\n\");\n\n    //input MID\n    printf(\"Input Project Value%d : \",i );\n    scanf(\"%d\",&amp;person[i].MID );\n    person[i].MID= person[i].MID * 0.25;\n    printf(\"\\n\");\n\n    //input Final\n    printf(\"Input Project Value%d : \",i );\n    scanf(\"%d\",&amp;person[i].Final );\n    person[i].Final= person[i].Final * 0.25;\n\n    //count Grade\n    person[i].grade = person[i].percentage + person[i].sum + person[i].project + person[i].MID + person[i].Final;\n\n    printf(\"\\n\");\n  }\n\nswitch (choose) {\n    case 1:\n      printf(\"+--------+----------------+------------------------------------------------------------------------------------------------------+\\n\");\n      printf(\"|%8s|%16s|%20s|%25s|%10s|%10s|%10s|%10s|%10s|\\n\", \"NIM\", \"Name\", \"Assignment 20%\",\"Quiz 10%\",\"Project 15%\",\"MID 25%\",\"Final 25%\",\"Grade\",\"Huruf\");\n      printf(\"|\\t |\\t\\t  |%4s|%4s|%4s|%5s|\",\"I\",\"II\",\"III\",\"20%\");\n      printf(\"%4s|%4s|%4s|%4s|%5s|\",\"I\",\"II\",\"III\",\"IV\",\"10%\");\n      printf(\"%11s|%10s|%10s|\",\"15%\",\"25%\",\"25%\" );\n      printf(\"%10s|%10s|\\n\",\" \",\" \");\n      printf(\"+--------+----------------+------------------------------------------------------------------------------------------------------+\\n\");\n      for ( i = 0; i &lt; input; i++) {\n        printf(\"|%8s|%8s %-7s|\", person[i].id,person[i].fname, person[i].lname );\n\n        // count assignment\n        for ( j = 0; j &lt; 3; j++) {\n          printf(\"%4d|\",person[j].assignment[i]);\n        }\n        printf(\"%5d|\",person[i].percentage);\n\n        // count the quiz\n        for ( k = 0; k &lt; 4; k++) {\n          printf(\"%4d|\",person[k].quiz[i]);\n        }\n        printf(\"%5d|\",person[i].sum);\n\n        //print the Project\n        printf(\"%11d|\",person[i].project );\n        //print the MID\n        printf(\"%10d|\",person[i].MID );\n        //print the Final\n        printf(\"%10d|\",person[i].Final );\n        //print Grade\n        if (person[i].grade &lt;=100) {\n          printf(\"%10d|%10s|\\n\",person[i].grade,\"A\" );\n        }\n        else if (person[i].grade &gt;84) {\n          printf(\"%10d|%10s|\\n\",person[i].grade,\"A-\" );\n        }\n        else if (person[i].grade &gt;81) {\n          printf(\"%10d|%10s|\\n\",person[i].grade,\"B+\" );\n        }\n        else if (person[i].grade &gt;77) {\n          printf(\"%10d|%10s|\\n\",person[i].grade,\"B\" );\n        }\n        else if (person[i].grade &gt;74) {\n          printf(\"%10d|%10s|\\n\",person[i].grade,\"B-\" );\n        }\n        else if (person[i].grade &gt;69) {\n          printf(\"%10d|%10s|\\n\",person[i].grade,\"C+\" );\n        }\n        else if (person[i].grade &gt;66) {\n          printf(\"%10d|%10s|\\n\",person[i].grade,\"C\" );\n        }\n        else if (person[i].grade &gt;59) {\n          printf(\"%10d|%10s|\\n\",person[i].grade,\"C-\" );\n        }\n        else if (person[i].grade &gt;39) {\n          printf(\"%10d|%10s|\\n\",person[i].grade,\"D\" );\n\n        }\n      }\n      printf(\"+--------+----------------+------------------------------------------------------------------------------------------------------+\\n\");\n    break;\n\n    case 2:\n      printf(\"%5s %14s\\n\",\"Final Value\",\"Grade\" );\n      printf(\"=============%6s=========\\n\",\" \");\n      printf(\"%5s %17s\\n\",\"91-100\",\"A\" );\n      printf(\"%5s %19s\\n\",\"85-90\",\"A-\" );\n      printf(\"%5s %19s\\n\",\"82-84\",\"B+\" );\n      printf(\"%5s %18s\\n\",\"78-81\",\"B\" );\n      printf(\"%5s %19s\\n\",\"75-77\",\"B-\" );\n      printf(\"%5s %19s\\n\",\"70-74\",\"C+\" );\n      printf(\"%5s %18s\\n\",\"67-69\",\"C\" );\n      printf(\"%5s %19s\\n\",\"60-66\",\"C-\" );\n      printf(\"%5s %18s\\n\",\"40-59\",\"D\" );\n    break;\n    default:\n    printf(\"error\");\n    return 0;\n}\n</code></pre>\n\n<p>expected output :\nif i input 60 three times for assignment and 60 four times for quiz, and  count each average then the result of each average multiply with 0.20 for assignment and 0.10 for quiz.</p>\n\n<p>here's the source code : <a href=\"https://github.com/PrinceSP/compro-1/blob/master/compro2/Structure/Exercise2.c\" rel=\"nofollow noreferrer\">https://github.com/PrinceSP/compro-1/blob/master/compro2/Structure/Exercise2.c</a></p>\n"}, {"tags": ["c", "multithreading", "pthreads", "condition-variable"], "comments": [{"owner": {"reputation": 8101, "user_id": 7691729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2568514188dfa24ecc3c1884e481834?s=128&d=identicon&r=PG&f=1", "display_name": "Quimby", "link": "https://stackoverflow.com/users/7691729/quimby"}, "edited": false, "score": 1, "creation_date": 1556708551, "post_id": 55935188, "comment_id": 98523020, "body": "I would guess that the function might generate spurious wake-ups but does not guarantee to wake them all like broadcast does."}], "answers": [{"comments": [{"owner": {"reputation": 13191, "user_id": 4990642, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/xY0PD.jpg?s=128&g=1", "display_name": "snr", "link": "https://stackoverflow.com/users/4990642/snr"}, "edited": false, "score": 0, "creation_date": 1556708762, "post_id": 55935205, "comment_id": 98523096, "body": "Thanks for your answer sir. What about the second one with the code part?"}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "reply_to_user": {"reputation": 13191, "user_id": 4990642, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/xY0PD.jpg?s=128&g=1", "display_name": "snr", "link": "https://stackoverflow.com/users/4990642/snr"}, "edited": false, "score": 0, "creation_date": 1556708997, "post_id": 55935205, "comment_id": 98523190, "body": "@snr Added a note about <code>waitbarrier</code> for you."}, {"owner": {"reputation": 13191, "user_id": 4990642, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/xY0PD.jpg?s=128&g=1", "display_name": "snr", "link": "https://stackoverflow.com/users/4990642/snr"}, "edited": false, "score": 0, "creation_date": 1556709255, "post_id": 55935205, "comment_id": 98523280, "body": "Thanks but seemingly <i>pthread_cond_signal</i> does give same output as well. By signaling one-by-one with <i>pthread_cond_signal</i> doesn&#39;t make any sense w.r.t. <i>pthread_cond_broadcast</i>. Does it? That&#39;s what I don&#39;t understand."}, {"owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "reply_to_user": {"reputation": 13191, "user_id": 4990642, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/xY0PD.jpg?s=128&g=1", "display_name": "snr", "link": "https://stackoverflow.com/users/4990642/snr"}, "edited": false, "score": 0, "creation_date": 1556709973, "post_id": 55935205, "comment_id": 98523550, "body": "@snr <code>waitbarrier</code> must wake up <i>all</i> waiting threads at the same time, this is why it uses <code>pthread_cond_broadcast</code>."}], "tags": [], "owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "is_accepted": false, "score": 2, "last_activity_date": 1556708979, "last_edit_date": 1556708979, "creation_date": 1556708513, "answer_id": 55935205, "question_id": 55935188, "link": "https://stackoverflow.com/questions/55935188/can-pthread-cond-signal-make-more-than-one-thread-to-wake-up/55935205#55935205", "title": "can pthread_cond_signal make more than one thread to wake up?", "body": "<p>Due to <a href=\"https://en.wikipedia.org/wiki/Spurious_wakeup\" rel=\"nofollow noreferrer\">spurious wake-ups</a> <code>pthread_cond_signal</code> could wake up more than one thread.</p>\n\n<p>Look for word \"spurious\" in <a href=\"https://sourceware.org/git/?p=glibc.git;a=blob;f=nptl/pthread_cond_wait.c;hb=c57afec0a9b318bb691e0f5fa4e9681cf30df7a4#l108\" rel=\"nofollow noreferrer\">pthread_cond_wait.c</a> from glibc.</p>\n\n<hr>\n\n<p>In <code>waitbarrier</code> it must wake up all threads when they all have arrived to that point, hence it uses <code>pthread_cond_broadcast</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "is_accepted": false, "score": 0, "last_activity_date": 1556714655, "last_edit_date": 1556714655, "creation_date": 1556714311, "answer_id": 55936420, "question_id": 55935188, "link": "https://stackoverflow.com/questions/55935188/can-pthread-cond-signal-make-more-than-one-thread-to-wake-up/55936420#55936420", "title": "can pthread_cond_signal make more than one thread to wake up?", "body": "<blockquote>\n  <p>Can [<code>pthread_cond_signal()</code>] make more than one thread wake up?</p>\n</blockquote>\n\n<p>That's not guaranteed.  On some operating system, on some hardware platform, under some circumstances it <em>could</em> wake more than one thread. It is <em>allowed</em> to wake more than one thread because that gives the implementer more freedom to make it work in the most efficient way possible for any given hardware and OS.</p>\n\n<p>It <em>must</em> wake at least one waiting thread, because otherwise, what would be the point of calling it?</p>\n\n<p>But, if your applicaton needs a signal that is guaranteed to wake all of the waiting threads, then that is what <code>pthread_cond_broadcast()</code> is for.</p>\n\n<hr>\n\n<p>Making efficient use of a multi-processor system is hard.  <a href=\"https://www.e-reading.club/bookreader.php/134637/Herlihy,_Shavit_-_The_art_of_multiprocessor_programming.pdf\" rel=\"nofollow noreferrer\">https://www.e-reading.club/bookreader.php/134637/Herlihy,<em>Shavit</em>-_The_art_of_multiprocessor_programming.pdf</a></p>\n\n<p>Most programming language and library standards allow similar freedoms in the behavior of multi-threaded programs, for the same reason: To allow programs to achieve high performance on a variety of different platforms.</p>\n"}], "owner": {"reputation": 13191, "user_id": 4990642, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/xY0PD.jpg?s=128&g=1", "display_name": "snr", "link": "https://stackoverflow.com/users/4990642/snr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 787, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1556714655, "creation_date": 1556708442, "last_edit_date": 1556709310, "question_id": 55935188, "link": "https://stackoverflow.com/questions/55935188/can-pthread-cond-signal-make-more-than-one-thread-to-wake-up", "title": "can pthread_cond_signal make more than one thread to wake up?", "body": "<p>I'm studying on condition variables of Pthread. When I'm reading the explanation of <code>pthread_cond_signal</code>, I see the following.</p>\n\n<blockquote>\n  <p>The <code>pthread_cond_signal()</code> function shall unblock <strong>at least one</strong> of\n  the\n         threads that are blocked on the specified condition variable cond (if\n         any threads are blocked on <code>cond</code>).</p>\n</blockquote>\n\n<p>Till now I knew <code>pthread_cond_signal()</code> would make only one thread to wake up at a time. But, the quoted explanation says <em>at least one</em>. What does it mean? Can it make more than one thread wake up? If yes, why is there <code>pthread_cond_broadcast()</code>?</p>\n\n<hr>\n\n<p>En passant, I wish the following code taken from <a href=\"https://www.oreilly.com/library/view/unixtm-systems-programming/0130424110/\" rel=\"nofollow noreferrer\">UNIX Systems Programming book of Robbins</a> is also related to my question. Is there any reason the author's <code>pthread_cond_broadcast()</code> usage instead of <code>pthread_cond_signal()</code> in <em>waitbarrier</em> function? <em>As a minor point, why is <strong><code>!berror</code></strong> checking needed too as a part of the predicate?</em>  When I try both of them by changing, I cannot see any difference. </p>\n\n<pre><code>/*\n\n The program implements a thread-safe barrier by using condition variables. The limit\n variable specifies how many threads must arrive at the barrier (execute the\n waitbarrier)  before the threads are released from the barrier.\n The count variable specifies how many threads are currently waiting at the barrier.\n Both variables are declared with the static attribute to force access through\n initbarrier and waitbarrier. If successful, the initbarrier and waitbarrier\n functions return 0. If unsuccessful, these functions return a nonzero error code.\n\n */\n\n#include &lt;errno.h&gt;\n#include &lt;pthread.h&gt;\n#include &lt;stdio.h&gt;\n\nstatic pthread_cond_t bcond = PTHREAD_COND_INITIALIZER;\nstatic pthread_mutex_t bmutex = PTHREAD_MUTEX_INITIALIZER;\nstatic int count = 0;\nstatic int limit = 0;\n\nint initbarrier(int n) {              /* initialize the barrier to be size n */\n    int error;\n\n    if (error = pthread_mutex_lock(&amp;bmutex))        /* couldn't lock, give up */\n        return error;\n    if (limit != 0) {                 /* barrier can only be initialized once */\n        pthread_mutex_unlock(&amp;bmutex);\n        return EINVAL;\n    }\n    limit = n;\n    return pthread_mutex_unlock(&amp;bmutex);\n}\n\nint waitbarrier(void) {    /* wait at the barrier until all n threads arrive */\n    int berror = 0;\n    int error;\n\n    if (error = pthread_mutex_lock(&amp;bmutex))        /* couldn't lock, give up */\n        return error;\n    if (limit &lt;=  0) {                       /* make sure barrier initialized */\n        pthread_mutex_unlock(&amp;bmutex);\n        return EINVAL;\n    }\n    count++;\n    while ((count &lt; limit) &amp;&amp; !berror)\n        berror =  pthread_cond_wait(&amp;bcond, &amp;bmutex);\n    if (!berror) {\n        fprintf(stderr,\"soner %d\\n\",\n                (int)pthread_self());\n        berror = pthread_cond_broadcast(&amp;bcond);           /* wake up everyone */\n        }\n    error = pthread_mutex_unlock(&amp;bmutex);\n    if (berror)\n        return berror;\n    return error;\n}\n\n/* ARGSUSED */\nstatic void *printthread(void *arg) {\n    fprintf(stderr,\"This is the first print of thread %d\\n\",\n            (int)pthread_self());\n    waitbarrier();\n    fprintf(stderr,\"This is the second print of thread %d\\n\",\n            (int)pthread_self());\n    return NULL;\n}\n\nint main(void) {\n    pthread_t t0,t1,t2;\n\n    if (initbarrier(3)) {\n        fprintf(stderr,\"Error initilizing barrier\\n\");\n        return 1;\n    }\n    if (pthread_create(&amp;t0,NULL,printthread,NULL))\n        fprintf(stderr,\"Error creating thread 0.\\n\");\n    if (pthread_create(&amp;t1,NULL,printthread,NULL))\n        fprintf(stderr,\"Error creating thread 1.\\n\");\n    if (pthread_create(&amp;t2,NULL,printthread,NULL))\n        fprintf(stderr,\"Error creating thread 2.\\n\");\n    if (pthread_join(t0,NULL))\n        fprintf(stderr,\"Error joining thread 0.\\n\");\n    if (pthread_join(t1,NULL))\n        fprintf(stderr,\"Error joining thread 1.\\n\");\n    if (pthread_join(t2,NULL))\n        fprintf(stderr,\"Error joining thread 2.\\n\");\n    fprintf(stderr,\"All threads complete.\\n\");\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "memory", "memory-management", "malloc", "heap-memory"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556708987, "post_id": 55935154, "comment_id": 98523186, "body": "The first thing you need to know is that the memory allocated by <code>malloc</code> is not initialized in any way, its contents is <i>indeterminate</i> (and could be seen as random or garbage). The second thing you need to know is that you should never reassign back to the pointer you pass to <code>realloc</code>, if <code>realloc</code> fails it will return a null pointer but not free the memory pointed to by the first argument (leading to a memory leak as you loose the original pointer)."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556709145, "post_id": 55935154, "comment_id": 98523245, "body": "Also, all pointers in C are implicitly convertible to <code>void *</code>, and <code>void *</code> is implicitly convertible to any other pointer. Which is why you <a href=\"https://stackoverflow.com/questions/605845/do-i-cast-the-result-of-malloc/\">shouldn&#39;t cast the result of <code>malloc</code> (or it siblings)</a>."}, {"owner": {"reputation": 1599, "user_id": 9948091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JANyt.png?s=128&g=1", "display_name": "HAL9000", "link": "https://stackoverflow.com/users/9948091/hal9000"}, "edited": false, "score": 0, "creation_date": 1556724878, "post_id": 55935154, "comment_id": 98530466, "body": "After the first call to <code>p = realloc(p, ...);</code>, <code>o</code> is not valid, or points to the same memory as <code>p</code>. So you should not call <code>free(o)</code>. You have three <code>free()</code>, but only two <code>malloc()</code>."}], "answers": [{"tags": [], "owner": {"reputation": 8101, "user_id": 7691729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2568514188dfa24ecc3c1884e481834?s=128&d=identicon&r=PG&f=1", "display_name": "Quimby", "link": "https://stackoverflow.com/users/7691729/quimby"}, "is_accepted": false, "score": 0, "last_activity_date": 1556709128, "creation_date": 1556709128, "answer_id": 55935335, "question_id": 55935154, "link": "https://stackoverflow.com/questions/55935154/understanding-malloc-realloc-and-free-in-c-from-reading-an-output/55935335#55935335", "title": "Understanding malloc(), realloc() and free() in C from reading an output", "body": "<p><code>malloc</code> might allocate more than the <em>n</em> bytes required. It has to do some book-keeping so that e.g. <code>free</code> knows how big the block was in order to fully deallocate it. </p>\n\n<p>It's implementation-specific how <code>malloc</code> does that, either it can prepend each block by some known structure that <code>free,realloc</code> can read like here or it can keep some kind of searchable structure with block information. This is subject to heavy optimizations so it might get quite complicated, try to search for \"memory allocation algorithm\" or similar.</p>\n"}], "owner": {"reputation": 1, "user_id": 11436671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd318f7983d1f2ac64ef67186360214?s=128&d=identicon&r=PG&f=1", "display_name": "Xiana", "link": "https://stackoverflow.com/users/11436671/xiana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1556709128, "creation_date": 1556708283, "question_id": 55935154, "link": "https://stackoverflow.com/questions/55935154/understanding-malloc-realloc-and-free-in-c-from-reading-an-output", "title": "Understanding malloc(), realloc() and free() in C from reading an output", "body": "<p>I need to write an assignement regarding how memory managment is implemented in order to understand what do the few non-zero numbers in the output of this code represent. </p>\n\n<p>I do know that the malloc() function reserves a block of memory of the specified number of bytes. And, it returns a pointer of type void which can be casted into pointer of any form. I also know that if the dynamically allocated memory is insufficient or more than required, you can change the size of previously allocated memory using realloc() function.</p>\n\n<p>Here is the code I have to analyze:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\n/*** Just playing with the malloc(), realloc(), free()\n *** in order to guess how memory management\n *** is implemented on this machine. If you get SEGMENTATION\n *** FAULT while addressing unallocated memory, just run\n *** the program with different \"min\" and/or \"max\" values,\n *** explicitly given on the command line through argv[]\n *** NOTICE: the default values are appropriate for the 32bit systems\n *** available in the labs ***/\n\n\nvoid showmem (unsigned char *ptr, int min, int max, char name) {\n    int i;\n    for (i = min; i &lt; 0; i++)           \n      printf (\"%hhu \",ptr[i]);          \n    printf (\"*%c=%hhu \",name,*ptr);     \n    for (i = 1; i &lt;= max; i++)          \n      printf (\"%hhu \",ptr[i]);\n    printf (\"\\n\\n\");\n}\n\n\nint main(int argc, char**argv) {\n    unsigned char *p, *q, *o;\n    int sz=1, min=-8, max=60;\n\n    if ( argc &gt; 1 )             \n        sscanf(argv[1],\"%d\",&amp;sz);       \n    if ( sz &lt;= 0 )\n        sz = 1;\n    else if ( sz &gt; 300 )\n        sz = 300;\n    if ( argc &gt; 2 )             \n        sscanf(argv[2],\"%d\",&amp;min);\n    if ( min &gt; -1 )\n        min = -1;\n    else if ( min &lt; -50 )\n        min = -50;\n    if ( argc &gt; 3 )             \n        sscanf(argv[3],\"%d\",&amp;max);\n    if ( max &lt; sz )\n        max = sz;\n    else if ( max &gt; (sz+100) )\n        max = sz+100;\n\n    printf(\"... allocating %d bytes to p[] (show memory from p[%d] to p[%d])\\n\\n\",sz,min,max);\n    p = (unsigned char*)malloc(sz);     \n    if ( p == NULL ) {\n        perror (\"Error allocating p\\n\");\n        return -1;\n    }\n    showmem (p,min,max,'p');\n\n    printf(\"... allocating %d bytes to q[]\\n\\n\",sz);\n    q = (unsigned char*)malloc(sz);     \n    if ( q == NULL ) {\n        perror (\"Error allocating q\\n\");\n        return -1;\n    }\n    showmem (p,min,max,'p');\n    showmem (q,min,max,'q');\n\n    sz += 10;                   \n    printf(\"... reallocating p[] to %d bytes (show old p[], new p[], and q[])\\n\\n\",sz);\n    o = p;\n    p = (unsigned char*)realloc((void*)p,sz);   \n    showmem (o,min,max,'o');\n    showmem (p,min,max,'p');\n    showmem (q,min,max,'q');\n\n    sz += 15;                   \n    printf(\"... reallocating p[] to %d bytes\\n\\n\",sz);\n    p = (unsigned char*)realloc((void*)p,sz);   //void e' l'indirizzo di memoria. sz e' la nuova dimensione\n    showmem (o,min,max,'o');\n    showmem (q,min,max,'q');\n    showmem (p,min,max,'p');\n\n    sz -= 25;                   \n    printf(\"... reallocating p[] to %d bytes\\n\\n\",sz);\n    p = (unsigned char*)realloc((void*)p,sz);\n    showmem (o,min,max,'o');\n    showmem (q,min,max,'q');\n    showmem (p,min,max,'p');\n\n    printf(\"... freeing p\\n\\n\");\n    free((void*)p);     `       \n    showmem (o,min,max,'o');\n    showmem (q,min,max,'q');\n    showmem (p,min,max,'p');\n\n    printf(\"... freeing q\\n\\n\");\n    free((void*)q);\n    showmem (o,min,max,'o');\n    showmem (q,min,max,'q');\n    showmem (p,min,max,'p');\n\n    printf(\"... freeing old p\\n\\n\");\n    free((void*)o);\n    showmem (o,min,max,'o');\n    showmem (q,min,max,'q');\n    showmem (p,min,max,'p');\n\n    return 0;\n\n}\n</code></pre>\n\n<p>And here is the ouput compiling the file without any other inputs:</p>\n\n<pre><code>\n... allocating 1 bytes to p[] (show memory from p[-8] to p[60])\n\n33 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 129 253 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... allocating 1 bytes to q[]\n\n33 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 97 253 1 0 0 \n\n33 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 97 253 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... reallocating p[] to 11 bytes (show old p[], new p[], and q[])\n\n33 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 97 253 1 0 0 \n\n33 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 97 253 1 0 0 \n\n33 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 97 253 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... reallocating p[] to 26 bytes\n\n33 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 \n\n33 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n49 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 253 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... reallocating p[] to 1 bytes\n\n33 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 \n\n33 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n49 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 253 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... freeing p\n\n33 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 \n\n33 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n49 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 253 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... freeing q\n\n33 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 0 0 0 0 0 0 112 210 6 212 50 86 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 \n\n33 0 0 0 0 0 0 0 *q=112 210 6 212 50 86 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n49 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 253 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... freeing old p\n\n33 0 0 0 0 0 0 0 *o=144 210 6 212 50 86 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 0 0 0 0 0 0 112 210 6 212 50 86 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 \n\n33 0 0 0 0 0 0 0 *q=112 210 6 212 50 86 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n49 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 49 253 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n\n</code></pre>\n\n<p>Here is the output while compiling with the input '64':</p>\n\n<pre><code>\n... allocating 64 bytes to p[] (show memory from p[-8] to p[64])\n\n81 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... allocating 64 bytes to q[]\n\n81 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... reallocating p[] to 74 bytes (show old p[], new p[], and q[])\n\n81 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n97 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... reallocating p[] to 89 bytes\n\n81 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n113 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... reallocating p[] to 64 bytes\n\n81 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *p=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... freeing p\n\n81 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *q=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *p=112 210 66 144 174 85 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... freeing q\n\n81 0 0 0 0 0 0 0 *o=0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *q=16 211 66 144 174 85 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *p=112 210 66 144 174 85 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n... freeing old p\n\n81 0 0 0 0 0 0 0 *o=192 210 66 144 174 85 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *q=16 211 66 144 174 85 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n81 0 0 0 0 0 0 0 *p=112 210 66 144 174 85 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 \n\n\n\n</code></pre>\n\n<p>I did notice how in the memory pointed by q there is a piece of what was pointed by the p one.</p>\n\n<p>What should I focus on while analyzing the output, and most importantly, what do those numbers represent in relation to the definition of malloc, realloc and free?</p>\n\n<p>Thank you in advance for you help.</p>\n"}, {"tags": ["c", "data-structures", "embedded", "stm32"], "comments": [{"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 1, "creation_date": 1556708276, "post_id": 55935135, "comment_id": 98522902, "body": "What is the type of <code>self</code>? There is missing ending of the <code>stm32fxxx_state</code> structure declaration. The enclosing <code>};</code> is missing. Does <code>stm32fxxx_state</code> has any other members?"}, {"owner": {"reputation": 8101, "user_id": 7691729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2568514188dfa24ecc3c1884e481834?s=128&d=identicon&r=PG&f=1", "display_name": "Quimby", "link": "https://stackoverflow.com/users/7691729/quimby"}, "edited": false, "score": 0, "creation_date": 1556708376, "post_id": 55935135, "comment_id": 98522935, "body": "The first snippet should not compile. Possible duplicate of <a href=\"https://stackoverflow.com/questions/1815677/nested-structures\">stackoverflow.com/questions/1815677/nested-structures</a>"}, {"owner": {"reputation": 741, "user_id": 10376824, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QJhJZUD1UCw/AAAAAAAAAAI/AAAAAAAADbA/_BZuute3iuE/photo.jpg?sz=128", "display_name": "Chandrika Joshi", "link": "https://stackoverflow.com/users/10376824/chandrika-joshi"}, "edited": false, "score": 0, "creation_date": 1556708434, "post_id": 55935135, "comment_id": 98522963, "body": "self is defined as struct stm32fxxx_gpio *self. So its a pointer of type struct stm32fxxx_gpio."}, {"owner": {"reputation": 741, "user_id": 10376824, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QJhJZUD1UCw/AAAAAAAAAAI/AAAAAAAADbA/_BZuute3iuE/photo.jpg?sz=128", "display_name": "Chandrika Joshi", "link": "https://stackoverflow.com/users/10376824/chandrika-joshi"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1556709146, "post_id": 55935135, "comment_id": 98523246, "body": "@KamilCuk : yes, the structure has few more members same like gpio_state. Answering your questions kind of now giving me an idea why this might have been done. But it would be great, if you explain as i&#39;m new to data structures."}, {"owner": {"reputation": 123, "user_id": 11003129, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-0Oi72szkaGo/AAAAAAAAAAI/AAAAAAAABLo/qUUw6k-Ze_0/photo.jpg?sz=128", "display_name": "Bhargav Kinnal", "link": "https://stackoverflow.com/users/11003129/bhargav-kinnal"}, "edited": false, "score": 0, "creation_date": 1556711318, "post_id": 55935135, "comment_id": 98524064, "body": "<code>state</code> is an array of struct <code>stm32fxxx_state</code> while <code>regs</code> is a struct <code>stm32fxxx_gpio_state</code> . That is the difference if that is what you are asking"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1556721523, "post_id": 55935135, "comment_id": 98528702, "body": "<code>self-&gt;regs-&gt;OTYPER;</code> this will definitely not compile. <code>regs</code> is the array of integers not the pointer to the structure or union"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1556721590, "post_id": 55935135, "comment_id": 98528737, "body": "@ChandrikaJoshi btw you try to reinvernt the wheel - all is already defined and can be used straight away."}, {"owner": {"reputation": 5681, "user_id": 1150918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e81acdd9b6273c7860ac440c99eb747c?s=128&d=identicon&r=PG", "display_name": "Kamiccolo", "link": "https://stackoverflow.com/users/1150918/kamiccolo"}, "edited": false, "score": 0, "creation_date": 1556725212, "post_id": 55935135, "comment_id": 98530635, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/1815677/nested-structures\">Nested structures</a>"}, {"owner": {"reputation": 5703, "user_id": 1401213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccb697eb985c37893ed06f3c3324c7c8?s=128&d=identicon&r=PG&f=1", "display_name": "kkrambo", "link": "https://stackoverflow.com/users/1401213/kkrambo"}, "edited": false, "score": 0, "creation_date": 1556738917, "post_id": 55935135, "comment_id": 98536420, "body": "You haven&#39;t shown the initialization of <code>self-&gt;state</code> and <code>self-&gt;regs</code>.  All you&#39;ve shown is that they are declared as pointers to structures.  Show us how the pointers are initialized.  Also show how <code>self</code> is initialized."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1556780412, "post_id": 55935135, "comment_id": 98546922, "body": "Is the question why <code>self-&gt;regs-&gt;OTYPER;</code> works without array indexing? If so, it works as a sloppy but valid way to access the first element of the array. Bad code."}, {"owner": {"reputation": 741, "user_id": 10376824, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QJhJZUD1UCw/AAAAAAAAAAI/AAAAAAAADbA/_BZuute3iuE/photo.jpg?sz=128", "display_name": "Chandrika Joshi", "link": "https://stackoverflow.com/users/10376824/chandrika-joshi"}, "edited": false, "score": 0, "creation_date": 1556782770, "post_id": 55935135, "comment_id": 98548051, "body": "I thank you guys for pointing out the mistakes in the code and how it might or might not compile(which it does, probably you cant see it because you dont know the complete code?). But I&#39;m not asking that.  I&#39;m asking, when nested structures are used , how this kind of access to structures works?"}, {"owner": {"reputation": 741, "user_id": 10376824, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QJhJZUD1UCw/AAAAAAAAAAI/AAAAAAAADbA/_BZuute3iuE/photo.jpg?sz=128", "display_name": "Chandrika Joshi", "link": "https://stackoverflow.com/users/10376824/chandrika-joshi"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1556797474, "post_id": 55935135, "comment_id": 98555344, "body": "@P__J__ : I think you confused regs of array and regs of type struct stm32fxxx_gpio_state, I have changed it to gregs. I hope its clear now"}], "answers": [{"tags": [], "owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "is_accepted": false, "score": 0, "last_activity_date": 1557835303, "last_edit_date": 1557835303, "creation_date": 1556722206, "answer_id": 55938127, "question_id": 55935135, "link": "https://stackoverflow.com/questions/55935135/accessing-a-nested-structure/55938127#55938127", "title": "Accessing a nested structure", "body": "<p>You try to reinvent the wheel and you did it wrong. </p>\n\n<ol>\n<li>you have defined structures with the hardware registers.</li>\n<li>Your declarations are not \"generic\" as many families have different registers. For example F3xx has additional <code>BRR</code> register.</li>\n<li>Order of the registers is wrong.</li>\n<li>Some peripherals have unused space between the registers. For example</li>\n</ol>\n\n<pre><code>     typedef struct\n    {\n      __IO uint32_t ACR;          /*!&lt; FLASH access control register,              Address offset: 0x00 */\n      __IO uint32_t KEYR;         /*!&lt; FLASH key register,                         Address offset: 0x04 */\n      __IO uint32_t OPTKEYR;      /*!&lt; FLASH option key register,                  Address offset: 0x08 */\n      __IO uint32_t SR;           /*!&lt; FLASH status register,                      Address offset: 0x0C */\n      __IO uint32_t CR;           /*!&lt; FLASH control register,                     Address offset: 0x10 */\n      __IO uint32_t AR;           /*!&lt; FLASH address register,                     Address offset: 0x14 */\n      uint32_t      RESERVED;     /*!&lt; Reserved, 0x18                                                   */\n      __IO uint32_t OBR;          /*!&lt; FLASH Option byte register,                 Address offset: 0x1C */\n      __IO uint32_t WRPR;         /*!&lt; FLASH Write register,                       Address offset: 0x20 */\n\n    } FLASH_TypeDef;\n</code></pre>\n\n<p>If your idea is to save registers in the RAM it is enough to</p>\n\n<p><code>GPIO_TypeDef savedGPIOs[NUMBER_OF_GPIOS];</code></p>\n\n<p>and </p>\n\n<p><code>savedGPIOs[0] = *GPIOA;</code></p>\n\n<p>but I do not see too much sense in it.</p>\n"}, {"comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1556780205, "post_id": 55938172, "comment_id": 98546844, "body": "They are two completely unrelated types so why would they point at the same structure?"}, {"owner": {"reputation": 741, "user_id": 10376824, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QJhJZUD1UCw/AAAAAAAAAAI/AAAAAAAADbA/_BZuute3iuE/photo.jpg?sz=128", "display_name": "Chandrika Joshi", "link": "https://stackoverflow.com/users/10376824/chandrika-joshi"}, "edited": false, "score": 0, "creation_date": 1556783484, "post_id": 55938172, "comment_id": 98548373, "body": "Thanks for editing the code. I should have taken care of indentation. Secondly you are right. But I do not understand how to access these attributes of the union and structures. The code is a sample code developed by someone else and it works, I&#39;m trying to use the same but understand how he has accessed these structures and unions"}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": false, "score": 1, "last_activity_date": 1556722378, "creation_date": 1556722378, "answer_id": 55938172, "question_id": 55935135, "link": "https://stackoverflow.com/questions/55935135/accessing-a-nested-structure/55938172#55938172", "title": "Accessing a nested structure", "body": "<p><code>self-&gt;state</code> and <code>self-&gt;regs</code> are 2 different pointers. The code probably initializes these fields to point to parts of the same structure.</p>\n"}], "owner": {"reputation": 741, "user_id": 10376824, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QJhJZUD1UCw/AAAAAAAAAAI/AAAAAAAADbA/_BZuute3iuE/photo.jpg?sz=128", "display_name": "Chandrika Joshi", "link": "https://stackoverflow.com/users/10376824/chandrika-joshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1557835303, "creation_date": 1556708193, "last_edit_date": 1556866401, "question_id": 55935135, "link": "https://stackoverflow.com/questions/55935135/accessing-a-nested-structure", "title": "Accessing a nested structure", "body": "<p>I have a nested structure like below:</p>\n\n<pre><code>struct stm32fxxx_state {\n    struct stm32fxxx_gpio_state {\n        union {\n            uint32_t regs[10];\n            struct {\n                uint32_t MODER;\n                uint32_t OTYPER;\n                uint32_t OSPEEDR;\n                uint32_t PUPDR;\n                uint32_t IDR;\n                uint32_t ODR;\n                uint32_t BSRR;\n                uint32_t LCKR;\n                uint32_t AFRL;\n                uint32_t AFRH;\n            };\n        };\n    } GPIO[STM32FXXX_NUM_GPIOS];\n\n    struct stm32fxxx_spi_regs {\n        union {\n            uint16_t regs[9];\n            struct {\n                uint16_t CR1;\n                uint16_t CR2;\n                uint16_t SR;\n                uint16_t DR;\n                uint16_t CRCPR;\n                uint16_t RXCRCR;\n                uint16_t TXCRCR;\n                uint16_t I2SCFGR;\n                uint16_t I2SPR;\n            };\n        };\n    } SPI[STM32FXXX_NUM_SPIS];\n    uint32_t PWR_CR;\n    uint32_t PWR_CSR;\n};\n</code></pre>\n\n<p>This structure has been instantiated in the <code>main</code> function in a structure as below:  </p>\n\n<pre><code>struct stm32fxxx_gpio {\n    SysBusDevice parent;\n\n    MemoryRegion mmio;\n    qemu_irq irq;\n\n    uint8_t port_id, _port_id;\n\n    struct stm32fxxx_state *state;\n    struct stm32fxxx_gpio_state *gregs;\n};\n</code></pre>\n\n<p>Somewhere further in the code, the structure is accessed as follows:</p>\n\n<pre><code>uint32_t valx = val ^ self-&gt;state-&gt;GPIO[self-&gt;port_id].MODER;\n</code></pre>\n\n<p>and </p>\n\n<pre><code>uint32_t valx = val ^ self-&gt;gregs-&gt;OTYPER;\n</code></pre>\n\n<p>Where <code>self</code> is declared as <code>struct stm32fxxx_gpio *self</code></p>\n\n<p>My question is: how is <code>self-&gt;state</code> different from <code>self-&gt;gregs</code>? How are these two access to the structure is different. </p>\n\n<p>The code is compiled and runs fine. I want to know how these two access return different data? Or what is the use of such nested structures?</p>\n\n<p>I understand <code>state</code> contains the <code>gpio_state</code> attributes as well. But <code>state</code> structure does not have attributes different from <code>gpio_state</code> structure, then why do we need structures in this case?</p>\n"}, {"tags": ["python", "c", "dll", "32bit-64bit"], "owner": {"reputation": 11, "user_id": 9475854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7aaead9d4ec6b8ebeb0d2d8ae6e9991f?s=128&d=identicon&r=PG&f=1", "display_name": "Lior Shemaya", "link": "https://stackoverflow.com/users/9475854/lior-shemaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 306, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1556718198, "creation_date": 1556707369, "last_edit_date": 1556718198, "question_id": 55934964, "link": "https://stackoverflow.com/questions/55934964/cant-run-32-bit-dll-in-python-32-bit-on-64-bit-platform", "title": "can&#39;t run 32 bit dll in python 32 bit on 64 bit platform", "body": "<p><strong>short summary:</strong>\nI have a DLL that detects hooks in the computer (it's a version I found on the internet) and it's working on 32-bit so I figured I should also use the 32-bit version of Python.\nNow, my OS is 64-bit but I read other problems and they said it shouldn't be a problem as long as the process that is running it (Python) is in 32-bit.\nso I ran the program and it said:</p>\n\n<blockquote>\n  <p>'''This program does not currently support 64-bit hosts. Failed to\n  attach to desktop 'Default'.'''</p>\n  \n  <p>'''FATAL: c:\\users\\1\\downloads\\hookd1\\hookdll\\desktop.c line 781, \n  init_global_desktop_store(): add_all_desktops() failed. Couldn't add\n  any desktops.'''</p>\n</blockquote>\n\n<p>Which means 64 bit machine can't run it but as you can see in the code below it is just a warning and should work (I think):</p>\n\n<pre><code>void warn_x64( void )\n{\n    USHORT x64_host = 0;\n\n\n    /* IsWow64Process() is not always available. alternative:\n    Windows x86 host GS register is 0, x64 GS register is not\n    */\n#if defined( _MSC_VER )\n    __asm\n    {\n        mov x64_host, gs\n    }\n#else\n    asm( \"mov %%gs, %0\" : \"=r\" (x64_host) );\n#endif\n\n    if( x64_host )\n        MSG_WARNING( \"This program does not currently support 64-bit hosts.\" );\n\n    return;\n}\n</code></pre>\n\n<p><strong>my attempts to fix the problem:</strong></p>\n\n<ul>\n<li><p>changing python to the 32-bit version</p></li>\n<li><p>running the DLL in <code>sysWOw64</code> using <code>regsvr32</code> (didn't quite understand the solution but the DLL seems to not work unless I'm missing something).</p></li>\n<li><p>changed my Visual Studio project from debug version to release because dependency check said it uses <code>msvcr100d.dll</code> which I didn't have so I changed the DLL to release version.</p></li>\n<li><p>Another solution I tried and didn't work:\nA fix I saw somewhere was to change from <code>Any CPU</code> to <code>x86</code> in the solution, but my solution has only 2 other options which are 'active(win32)' and <code>win32</code>.\nMine currently sits on <code>active(win32)</code> and I think it's the one that should support and for those who are saying I should try win32 as well, I rebuilt the solution with <code>win32</code> and it gave the same problem.</p></li>\n</ul>\n\n<p><strong>brief final explanation of what I want:</strong>\nI've read similar questions to mine and tried their solutions but none of them fixed my problem, all I want is to run my 32-bit DLL in Python 32-bit although my os is 64-bit (the C program said it doesn't accept 64 hosts but it should according to other solutions pointed in stackoverflow, it is also just a warning).\nconclusion: \nI excepted it to run in this 64-bit environment (because the DLL runner, Python, is in 32-bit).\nbut instead, it didn't run because the program seems to warn about 64 hosts.</p>\n\n<p><strong>EDIT</strong>:\nI should also mention the source <a href=\"https://github.com/jay/gethooks\" rel=\"nofollow noreferrer\">code</a>. Although I made changes to the output the DLL gives is different, but I didn't change anything else except for the output.</p>\n\n<p>Thanks to anyone who tries to help me fix this very annoying problem!</p>\n"}, {"tags": ["c", "dynamic", "malloc", "scanf", "allocation"], "comments": [{"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1556707271, "post_id": 55934924, "comment_id": 98522555, "body": "The variable <code>sum</code> is not initialized. Initialize it like <code>long sum = 0</code>."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 10596331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e159eade9224edf26785954f4ddec5f?s=128&d=identicon&r=PG&f=1", "display_name": "xp10r3r", "link": "https://stackoverflow.com/users/10596331/xp10r3r"}, "edited": false, "score": 0, "creation_date": 1556708220, "post_id": 55934978, "comment_id": 98522884, "body": "Yeah you&#39;re right. I found it in the meanwhile as well."}], "tags": [], "owner": {"reputation": 59, "user_id": 9956378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9cb32b7b8e58dd5030e827bfe6c31d3?s=128&d=identicon&r=PG&f=1", "display_name": "abc", "link": "https://stackoverflow.com/users/9956378/abc"}, "is_accepted": false, "score": 1, "last_activity_date": 1556707483, "creation_date": 1556707483, "answer_id": 55934978, "question_id": 55934924, "link": "https://stackoverflow.com/questions/55934924/assigning-ints-of-pointer-with-scanf/55934978#55934978", "title": "Assigning ints of pointer with scanf", "body": "<p>Instead of (pi+1) it should be (pi+i). </p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 10596331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e159eade9224edf26785954f4ddec5f?s=128&d=identicon&r=PG&f=1", "display_name": "xp10r3r", "link": "https://stackoverflow.com/users/10596331/xp10r3r"}, "edited": false, "score": 0, "creation_date": 1556708577, "post_id": 55935037, "comment_id": 98523023, "body": "Typecasting is required by the tutor, however, I&#39;ll keep it in mind that it&#39;s not necessarily needed. I found the error with 1 instead of i in the meanwhile as well."}], "tags": [], "owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "is_accepted": false, "score": 1, "last_activity_date": 1556708533, "last_edit_date": 1556708533, "creation_date": 1556707781, "answer_id": 55935037, "question_id": 55934924, "link": "https://stackoverflow.com/questions/55934924/assigning-ints-of-pointer-with-scanf/55935037#55935037", "title": "Assigning ints of pointer with scanf", "body": "<blockquote>\n  <p><em>After inserting 10 values the output is 6474931 which is I guess the initial value ?</em></p>\n</blockquote>\n\n<p>Its because the variable <code>sum</code> is not initialized, <em>default it contains some junk data</em> due to <strong>automatic</strong> storage. </p>\n\n<p>Initialize it with zero.</p>\n\n<pre><code>long sum = 0;\n</code></pre>\n\n<p>Also here</p>\n\n<pre><code>pi = (int *)malloc(10 * sizeof(int));\n</code></pre>\n\n<p>typecasting <code>malloc()</code> isn't necessary as <code>malloc()</code> return type is of <code>void*</code> type &amp; it's safely converted to desired pointer type automatically. For e.g</p>\n\n<pre><code>pi = malloc(10 * sizeof(*pi));\nif(pi == NULL) {\n  /* @TODO error handling */\n}\n</code></pre>\n\n<p>Do Read <a href=\"https://stackoverflow.com/questions/605845/do-i-cast-the-result-of-malloc\">Do I cast the result of malloc?</a></p>\n\n<p>Also here</p>\n\n<pre><code>scanf(\"%d\", pi + 1);\nsum += *(pi + 1);\n</code></pre>\n\n<p>you wanted to use <code>pi + i</code> as <code>scanf(\"%d\", pi + 1);</code> every time scans data in same <code>pi+1</code> memory location, other memory location like <code>pi +2</code>, <code>pi + 3</code> .. <code>pi + 9</code> are <em>unused</em>. So change it to</p>\n\n<pre><code>scanf(\"%d\", pi + i);\nsum += *(pi + i);\n</code></pre>\n\n<p>Sample code :</p>\n\n<pre><code>int main(void) {\n    long sum = 0;\n    int *pi = malloc(10 * sizeof(*pi));\n    if(pi == NULL) {\n        /* @TODO Error Handling */\n    }\n    printf(\"\\n\\nPlease put in 10 values.\\n\\n\");\n    for(int i = 0; i &lt; 10; i++) {\n        printf(\"%d. Value: \", i + 1);\n        scanf(\"%d\", pi + i);\n        sum += *(pi + i);\n    }\n    printf(\"\\nSum of dynamic allocated memory: %ld\", sum);\n    free(pi);\n    return 0;\n}\n</code></pre>\n\n<p><strong>O/p :</strong></p>\n\n<blockquote>\n  <p>Please put in 10 values.</p>\n  \n  <ol>\n  <li>Value: 1</li>\n  <li>Value: 2</li>\n  <li>Value: 3</li>\n  <li>Value: 4</li>\n  <li>Value: 5</li>\n  <li>Value: 6</li>\n  <li>Value: 7</li>\n  <li>Value: 8</li>\n  <li>Value: 9</li>\n  <li>Value: 10</li>\n  </ol>\n  \n  <p>Sum of dynamic allocated memory: 55</p>\n</blockquote>\n"}], "owner": {"reputation": 31, "user_id": 10596331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e159eade9224edf26785954f4ddec5f?s=128&d=identicon&r=PG&f=1", "display_name": "xp10r3r", "link": "https://stackoverflow.com/users/10596331/xp10r3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1556708712, "creation_date": 1556707177, "last_edit_date": 1556708712, "question_id": 55934924, "link": "https://stackoverflow.com/questions/55934924/assigning-ints-of-pointer-with-scanf", "title": "Assigning ints of pointer with scanf", "body": "<p>I've a question similar to this one: <a href=\"https://stackoverflow.com/questions/29491530/assigning-char-array-of-pointers-with-scanf\">Assigning char array of pointers with scanf</a></p>\n\n<p>Rather of assigning char values to an array of pointers I'd like to assign values to int of pointers with scanf. In the following example I'd assign 10 int values and that's the reason why it's hard-coded.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void main(void) {\n    int *pi;\n\n    long sum;\n\n    pi = (int *)malloc(10 * sizeof(int));\n\n    if(pi == NULL)\n        /* Error Handling */\n\n    printf(\"\\n\\nPlease put in 10 values.\\n\\n\");\n\n    for(int i = 0; i &lt; 10; i++) {\n        printf(\"%d. Value: \", i + 1);\n        scanf(\"%d\", pi + i);\n        /* It was scanf(\"%d\", pi + 1) in previous version. */\n\n        sum += *(pi + i);\n        /* Same issue, it was sum += *(pi + 1) in the previous version. */\n    }\n\n    printf(\"\\nSum of dynamic allocated memory: %ld\", sum);\n\n    free(pi);\n}\n</code></pre>\n\n<p>After inserting 10 values the output is 6474931 which is I guess the initial value. Any idea what I'm doing wrong?</p>\n\n<p>Thanks for any help which is much appreciated.</p>\n"}, {"tags": ["c", "arrays", "list", "loops", "multidimensional-array"], "comments": [{"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 0, "creation_date": 1556707278, "post_id": 55934917, "comment_id": 98522557, "body": "Semi-related, if you only care about improving speed (and not learning C) you might consider NumPy or Cython first"}, {"owner": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "reply_to_user": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 0, "creation_date": 1556708476, "post_id": 55934917, "comment_id": 98522986, "body": "@UnholySheep Thanks but I already wrote wrote it code in c, just I need now to store the results!"}, {"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 0, "creation_date": 1556708685, "post_id": 55934917, "comment_id": 98523068, "body": "Based on your expected result you should go with creating a <code>struct</code> to hold the values you want to store and then make an array of that <code>struct</code> that you fill in the loop"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556711613, "post_id": 55934917, "comment_id": 98524193, "body": "@Noah16 I put an answer allowing to save the datas then for instance to print them after without supposing <code>igraph_vector_size()</code> always return the same value"}], "answers": [{"comments": [{"owner": {"reputation": 119716, "user_id": 643383, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/uQ5JF.png?s=128&g=1", "display_name": "Caleb", "link": "https://stackoverflow.com/users/643383/caleb"}, "edited": false, "score": 0, "creation_date": 1556712155, "post_id": 55935250, "comment_id": 98524419, "body": "Names more descriptive than <code>Data</code> and <code>Datas</code> (which is extra strange as a plural of an already plural term) would help. How about <code>Edge</code> and <code>Edges</code>? Also, it&#39;d be good to explain that the reason a struct is needed is that in C, an array can only store one type of value -- you can&#39;t have an array that contains both ints and  floats."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 119716, "user_id": 643383, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/uQ5JF.png?s=128&g=1", "display_name": "Caleb", "link": "https://stackoverflow.com/users/643383/caleb"}, "edited": false, "score": 0, "creation_date": 1556713125, "post_id": 55935250, "comment_id": 98524811, "body": "@Caleb I use <i>Data</i> and <i>Datas</i> for the simple reason I do not know the semantic of these information so I am not able to give better names, the OP is able to rename them, this is just a detail. <i>Datas</i> is a vector of <i>Data</i>, with size and value. About the second part of your remark I am also surprised because I said it is better to have the <i>struct</i> rather than just <code>floats ***</code> ;-)"}, {"owner": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 0, "creation_date": 1556713571, "post_id": 55935250, "comment_id": 98525018, "body": "@bruno Thanks for this cooperation. I am in need to call the element in this way data[0][2][3]= [4.000000] because after once I will access the list of arrays to make a comparison with each element like: if (data[i][x][y]== j ) { ....}"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 0, "creation_date": 1556713919, "post_id": 55935250, "comment_id": 98525166, "body": "@Noah16 I written all without any compilation nor execution, I do not have <i>igraph</i> nor your input file. About <code>data[0][2][3]= [4.000000]</code> you probably mean 4.0 only rather than again an array, and to do that supposes you only have a three dimensional array of float rather than a double dimensional array of struct, do you <b>really</b> want to have that ?"}, {"owner": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 0, "creation_date": 1556714198, "post_id": 55935250, "comment_id": 98525305, "body": "@bruno Ya  you are right in this way data[0][2][3]= 4.0. But the printed data is so strange with a strange values and sizes in addition to a segmentation fault at the end :)"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 0, "creation_date": 1556714361, "post_id": 55935250, "comment_id": 98525372, "body": "@Noah16 how to install igraph ? I have to get from <a href=\"https://github.com/igraph\" rel=\"nofollow noreferrer\">github.com/igraph</a> ? Your file <i>attempt</i> contains <i>1 2 2 3 2 4 3 4 4</i> ?"}, {"owner": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 0, "creation_date": 1556714505, "post_id": 55935250, "comment_id": 98525437, "body": "Yes exactly or from <a href=\"https://igraph.org/c/\" rel=\"nofollow noreferrer\">here</a> and the file contains these values (1 2 2 3 2 4 3 4 4 5) sorted in 5 lines where in each line there are 2 values separated by a space"}, {"owner": {"reputation": 119716, "user_id": 643383, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/uQ5JF.png?s=128&g=1", "display_name": "Caleb", "link": "https://stackoverflow.com/users/643383/caleb"}, "edited": false, "score": 0, "creation_date": 1556714938, "post_id": 55935250, "comment_id": 98525643, "body": "@bruno Python doesn&#39;t have C-style arrays, but it&#39;s list type can store different types, so the OP is likely unaware that in C arrays are restricted to a single type."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 119716, "user_id": 643383, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/uQ5JF.png?s=128&g=1", "display_name": "Caleb", "link": "https://stackoverflow.com/users/643383/caleb"}, "edited": false, "score": 0, "creation_date": 1556715466, "post_id": 55935250, "comment_id": 98525871, "body": "@Caleb it is possible to use <a href=\"https://docs.python.org/fr/3/tutorial/classes.html\" rel=\"nofollow noreferrer\">classes</a> in Python, Python does not force to use an array to aggregate values"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 0, "creation_date": 1556717859, "post_id": 55935250, "comment_id": 98526920, "body": "@Noah16 I just had a typo in the loop to print, I reused the variable <i>i</i> by error, I corrected and added the full program and execution"}, {"owner": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 0, "creation_date": 1556718652, "post_id": 55935250, "comment_id": 98527296, "body": "@bruno Many thanks for this great help, it is working perfectly. Just a last question, why in the printing step you used (j != all[i].n) in last loop? why not (j &lt; all[i].n;)? I didn&#39;t get it"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 1, "creation_date": 1556718757, "post_id": 55935250, "comment_id": 98527336, "body": "@Noah16 you can do <code>&lt;</code> if you prefer, but while <i>n</i> is an non negative number and starting from 0 the behavior is the same"}, {"owner": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 0, "creation_date": 1557235997, "post_id": 55935250, "comment_id": 98691348, "body": "@bruno thanks again. As I saw it is neseccary in c to free the array and structure after using them. For the structure you constructed, I did: free(Data); then free(Datas); but it keeps giving me an error. Do I miss something in your work?"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "edited": false, "score": 0, "creation_date": 1557238035, "post_id": 55935250, "comment_id": 98692607, "body": "@Noah16 after looking at <i>igraph</i> documentation (I do not know at all that lib)  I edited my answer to free the resources, look at the new definition of <i>main</i> calling igraph destroy functions and necessary <i>free</i> at the end"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 2, "last_activity_date": 1557237896, "last_edit_date": 1557237896, "creation_date": 1556708741, "answer_id": 55935250, "question_id": 55934917, "link": "https://stackoverflow.com/questions/55934917/store-the-result-of-many-for-loops/55935250#55935250", "title": "Store the result of many for loops", "body": "<blockquote>\n  <p>would like to store it </p>\n</blockquote>\n\n<p>you need a struct for each element, like</p>\n\n<pre><code>typedef Struct Data {\n  int from;\n  float vfrom;\n  int to;\n  float vto;\n} Data;\n</code></pre>\n\n<p>Then an <code>Data**</code>.</p>\n\n<p>Note doing that does not allow to have <code>data[0][2][3]= [4.000000]</code> else it is needed to have a <code>float ***</code> and this is not practical, it is <code>data[0][2].vto == 4.000000</code></p>\n\n<p>For instance replace</p>\n\n<pre><code> for (i=0; i&lt;m; i++){\n    igraph_edge(&amp;graph, i, &amp;from, &amp;to);\n    igraph_neighbors(&amp;graph, &amp;v1, from, IGRAPH_ALL);\n    igraph_neighbors(&amp;graph, &amp;v2, to, IGRAPH_ALL);\n    for (j=0; j &lt; igraph_vector_size(&amp;v2); j++) {\n      for (k=0; k &lt; igraph_vector_size(&amp;v1); k++) {\n        printf(\"%li %d %f %d %f\\n\", i, from, VECTOR(v1)[k] ,to, VECTOR(v2)[j]);                        \n      }\n    }\n }\n</code></pre>\n\n<p>by</p>\n\n<pre><code> Data ** all = malloc(m * sizeof(Data*));\n\n for (i=0; i&lt;m; i++){\n    igraph_edge(&amp;graph, i, &amp;from, &amp;to);\n    igraph_neighbors(&amp;graph, &amp;v1, from, IGRAPH_ALL);\n    igraph_neighbors(&amp;graph, &amp;v2, to, IGRAPH_ALL);\n    all[i] = malloc(igraph_vector_size(&amp;v2)*graph_vector_size(&amp;v1)*sizeof(Data));\n\n    int idx = 0;\n\n    for (j=0; j &lt; igraph_vector_size(&amp;v2); j++) {\n      for (k=0; k &lt; igraph_vector_size(&amp;v1); k++) {\n        all[i][idx].from = from;\n        all[i][idx].vfrom = VECTOR(v1)[k];\n        all[i][idx].to = to;\n        all[i][idx].vto = VECTOR(v2)[j];\n        idx += 1;\n      }\n    }\n }\n</code></pre>\n\n<p>Note it will be difficult to use the <code>Data**</code> after in case the number of entries in all the sub arrays is not known and the same, may be you need to save that numbers, for that :</p>\n\n<pre><code>typedef Struct Data {\n  int from;\n  float vfrom;\n  int to;\n  float vto;\n} Data;\n\ntypedef Datas {\n   int n;\n   Data * datas;\n} Datas;\n</code></pre>\n\n<p>allowing to do:</p>\n\n<pre><code> Datas * all = malloc(m * sizeof(Datas));\n\n for (i=0; i&lt;m; i++){\n    igraph_edge(&amp;graph, i, &amp;from, &amp;to);\n    igraph_neighbors(&amp;graph, &amp;v1, from, IGRAPH_ALL);\n    igraph_neighbors(&amp;graph, &amp;v2, to, IGRAPH_ALL);\n\n    int jsup = igraph_vector_size(&amp;v2);\n    int ksup = igraph_vector_size(&amp;v1);\n    Data * a = malloc(jsup * ksup * sizeof(Data));\n\n    all[i].n = jsup * ksup;\n    all[i].datas = a;\n\n    for (j=0; j &lt; jsup; j++) {\n      for (k=0; k &lt; ksup; k++) {\n        a-&gt;from = from;\n        a-&gt;vfrom = VECTOR(v1)[k];\n        a-&gt;to = to;\n        a-&gt;vto = VECTOR(v2)[j];\n        a += 1;\n      }\n    }\n }\n</code></pre>\n\n<p>then</p>\n\n<pre><code>printf(\"data : [\");\n\nfor (i=0; i&lt;m; i++) {\n  Data * a = all[i].datas;\n\n  printf(\" [\");\n\n  for (int j = 0; j != all[i].n; ++j)\n    printf(\" [%d %f %d %f]\", a[j].from, a[j].vfrom, a[j].to, a[j].vto);\n\n  printf(\" ]\");\n}\n\nputs(\" ]\");\n</code></pre>\n\n<hr>\n\n<p>Here the full program :</p>\n\n<pre><code>#include &lt;igraph/igraph.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define sigma 1\n\nvoid print_vector(igraph_vector_t *v, FILE *file) {\n     long int i;\n     for (i=0; i &lt; igraph_vector_size(v); i++) {\n        fprintf(file, \"%li \\n\", (long int) VECTOR(*v)[i]);\n     }\n     fprintf(file,\"\\n\");\n }\n\n\nfloat rbf(int a, int b);\n\nfloat rbf(int a, int b) {\n  double inverse;\n  double exp(double x;);\n  double x;\n  double result;\n\n  inverse = ( 1/(sigma*sigma) );\n  x = (- inverse * ( (a - b)*(a - b) ) );\n  result = exp(x);\n  return (result); \n} \n\ntypedef struct Data {\n  int from;\n  float vfrom;\n  int to;\n  float vto;\n} Data;\n\ntypedef struct Datas {\n   int n;\n   Data * datas;\n} Datas;\n\n\nint main(void)\n{\n\n     igraph_t graph; \n     igraph_bool_t false;\n     igraph_bool_t connected1, connected2, connected3, connected4, connected5, connected6;\n     int ret;\n     float rhs1;\n     float rhs2;\n     igraph_vector_t v1, v2;\n     long int i, j, k, n, m ;\n     igraph_integer_t from, to;\n     igraph_adjlist_t adjlist;\n     FILE *file;\n     file = fopen(\"attempt\", \"r\");\n     if(!file){\n        return 1;\n     }\n\n     igraph_read_graph_edgelist(&amp;graph, file, \n                                0, false);\n\n     fclose(file);\n\n     igraph_vector_init(&amp;v1, (igraph_vcount(&amp;graph)) );\n     igraph_vector_init(&amp;v2, (igraph_vcount(&amp;graph)) );\n     igraph_adjlist_init(&amp;graph, &amp;adjlist, IGRAPH_ALL);\n\n     n = igraph_vcount(&amp;graph);\n     m = igraph_ecount(&amp;graph);\n     Datas * all = malloc(m * sizeof(Datas));\n\n     for (i=0; i&lt;m; i++){\n       igraph_edge(&amp;graph, i, &amp;from, &amp;to);\n       igraph_neighbors(&amp;graph, &amp;v1, from, IGRAPH_ALL);\n       igraph_neighbors(&amp;graph, &amp;v2, to, IGRAPH_ALL);\n\n       int jsup = igraph_vector_size(&amp;v2);\n       int ksup = igraph_vector_size(&amp;v1);\n       Data * a = malloc(jsup * ksup * sizeof(Data));\n\n       all[i].n = jsup * ksup;\n       all[i].datas = a;\n\n       for (j=0; j &lt; jsup; j++) {\n         for (k=0; k &lt; ksup; k++) {\n           a-&gt;from = from;\n           a-&gt;vfrom = VECTOR(v1)[k];\n           a-&gt;to = to;\n           a-&gt;vto = VECTOR(v2)[j];\n           printf(\"%d %f %d %f\\n\", a-&gt;from, a-&gt;vfrom, a-&gt;to, a-&gt;vto);\n           a += 1;\n         }\n       }\n     }\n\n     printf(\"data : [\");\n\n     for (i=0; i&lt;m; i++) {\n       Data * a = all[i].datas;\n\n       printf(\" [\");\n\n       for (int j = 0; j != all[i].n; ++j)\n         printf(\" [%d %f %d %f]\", a[j].from, a[j].vfrom, a[j].to, a[j].vto);\n\n       printf(\" ]\");\n     }\n\n     puts(\" ]\");\n\n     /* free resources */\n     igraph_destroy(&amp;graph);\n     igraph_vector_destroy(&amp;v1);\n     igraph_vector_destroy(&amp;v2);\n     igraph_adjlist_destroy(&amp;adjlist);\n\n     for (i=0; i&lt;m; i++)\n       free(all[i].datas);\n     free(all);         \n\n     return 0;\n}\n</code></pre>\n\n<p>with the file <em>attempt</em> containing</p>\n\n<pre><code>1 2\n2 3\n2 4\n3 4\n4 5\n</code></pre>\n\n<p>execution :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ ./a.out\n1 2.000000 2 1.000000\n1 2.000000 2 3.000000\n1 2.000000 2 4.000000\n2 1.000000 3 2.000000\n2 3.000000 3 2.000000\n2 4.000000 3 2.000000\n2 1.000000 3 4.000000\n2 3.000000 3 4.000000\n2 4.000000 3 4.000000\n2 1.000000 4 2.000000\n2 3.000000 4 2.000000\n2 4.000000 4 2.000000\n2 1.000000 4 3.000000\n2 3.000000 4 3.000000\n2 4.000000 4 3.000000\n2 1.000000 4 5.000000\n2 3.000000 4 5.000000\n2 4.000000 4 5.000000\n3 2.000000 4 2.000000\n3 4.000000 4 2.000000\n3 2.000000 4 3.000000\n3 4.000000 4 3.000000\n3 2.000000 4 5.000000\n3 4.000000 4 5.000000\n4 2.000000 5 4.000000\n4 3.000000 5 4.000000\n4 5.000000 5 4.000000\ndata : [ [ [1 2.000000 2 1.000000] [1 2.000000 2 3.000000] [1 2.000000 2 4.000000] ] [ [2 1.000000 3 2.000000] [2 3.000000 3 2.000000] [2 4.000000 3 2.000000] [2 1.000000 3 4.000000] [2 3.000000 3 4.000000] [2 4.000000 3 4.000000] ] [ [2 1.000000 4 2.000000] [2 3.000000 4 2.000000] [2 4.000000 4 2.000000] [2 1.000000 4 3.000000] [2 3.000000 4 3.000000] [2 4.000000 4 3.000000] [2 1.000000 4 5.000000] [2 3.000000 4 5.000000] [2 4.000000 4 5.000000] ] [ [3 2.000000 4 2.000000] [3 4.000000 4 2.000000] [3 2.000000 4 3.000000] [3 4.000000 4 3.000000] [3 2.000000 4 5.000000] [3 4.000000 4 5.000000] ] [ [4 2.000000 5 4.000000] [4 3.000000 5 4.000000] [4 5.000000 5 4.000000] ] ]\n</code></pre>\n"}], "owner": {"reputation": 296, "user_id": 7230777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7ca80d30fbd9c2718cedc2b549310972?s=128&d=identicon&r=PG&f=1", "display_name": "Noah16", "link": "https://stackoverflow.com/users/7230777/noah16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 55935250, "answer_count": 1, "score": 1, "last_activity_date": 1557237896, "creation_date": 1556707139, "last_edit_date": 1556717771, "question_id": 55934917, "link": "https://stackoverflow.com/questions/55934917/store-the-result-of-many-for-loops", "title": "Store the result of many for loops", "body": "<p>I have a code in python and now I am struggling to write it in c (to optimize the speed) because I've never used c!</p>\n\n<p>Previously I used to store the resulted data in a dictionary or in a list of arrays but I don't know what is the suitable structure and how to store it here in c.</p>\n\n<p>I read the data from a file called (attempt) then I process it using the functions written in the code. Three <code>for loops</code> are used to produce the required data but I don't know how to store it!</p>\n\n<p>the code which contains the loops</p>\n\n<pre><code>for (i=0; i&lt;m; i++){\n   igraph_edge(&amp;graph, i, &amp;from, &amp;to);\n   igraph_neighbors(&amp;graph, &amp;v1, from, IGRAPH_ALL);\n   igraph_neighbors(&amp;graph, &amp;v2, to, IGRAPH_ALL);\n   for (j=0; j &lt; igraph_vector_size(&amp;v2); j++) {\n     for (k=0; k &lt; igraph_vector_size(&amp;v1); k++) {\n       printf(\"%li %d %f %d %f\\n\", i, from, VECTOR(v1)[k] ,to, VECTOR(v2)[j]);     \n     } \n   }\n}     \n\n //EDIT: concerning the different data types, at the end all elements inside the loops could have have the same type so\n\n\nint n1, n2;\nfor (i=0; i&lt;m; i++){\n    igraph_edge(&amp;graph, i, &amp;from, &amp;to);\n    igraph_neighbors(&amp;graph, &amp;v1, from, IGRAPH_ALL);\n    igraph_neighbors(&amp;graph, &amp;v2, to, IGRAPH_ALL);\n    for (j=0; j &lt; igraph_vector_size(&amp;v2); j++) {\n      for (k=0; k &lt; igraph_vector_size(&amp;v1); k++) {\n        n1 =  floor(VECTOR(v1)[k]);\n        n2 =  floor(VECTOR(v2)[j]);\n        printf(\"%li %d %d %d %d\\n\", i, from, n1 ,to, n2);                        \n      }\n    }\n }  \n</code></pre>\n\n<p>The result is on the form</p>\n\n<pre><code>0 1 2.000000 2 1.000000\n0 1 2.000000 2 3.000000\n0 1 2.000000 2 4.000000\n1 2 1.000000 3 2.000000\n1 2 3.000000 3 2.000000\n1 2 4.000000 3 2.000000\n          .\n          .\n          .\n</code></pre>\n\n<p>Instead of printing this data, I would like to store it as </p>\n\n<pre><code>data = [ [ [1, 2.000000, 2 ,1.000000], [1, 2.000000, 2, 3.000000], [1, 2.000000, 2, 4.000000] ], [  [2, 1.000000, 3, 2.000000], [2, 3.000000, 3, 2.000000], ...  ], ... ]\n</code></pre>\n\n<p>Then if I need to access the data </p>\n\n<ol>\n<li><p>for index 0, <code>data[0]= [ [1, 2.000000, 2 1.000000], [1, 2.000000, 2, 3.000000], [1, 2.000000, 2, 4.000000] ]</code> </p></li>\n<li><p>and <code>data[0][2]=[1 2.000000 2 4.000000]</code></p></li>\n<li>and <s><code>data[0][2][3]= [4.000000]</code></s> <code>data[0][2][3]= 4.000000</code></li>\n</ol>\n\n<p>Is this possible in my case? I would be very very grateful for any help.</p>\n\n<p>P.S: I will be very happy to explain anything not clear.</p>\n\n<p><strong>ADDITION</strong></p>\n\n<p>Here is the full code (if needed)</p>\n\n<pre><code>#include &lt;igraph/igraph.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define sigma 1\n\nvoid print_vector(igraph_vector_t *v, FILE *file) {\n     long int i;\n     for (i=0; i &lt; igraph_vector_size(v); i++) {\n        fprintf(file, \"%li \\n\", (long int) VECTOR(*v)[i]);\n     }\n     fprintf(file,\"\\n\");\n }\n\n\nfloat rbf(int a, int b);\n\nfloat rbf(int a, int b) {\n  double inverse;\n  double exp(double x;);\n  double x;\n  double result;\n\n  inverse = ( 1/(sigma*sigma) );\n  x = (- inverse * ( (a - b)*(a - b) ) );\n  result = exp(x);\n  return (result); \n} \n\nint main(void)\n{\n\n     igraph_t graph; \n     igraph_bool_t false;\n     igraph_bool_t connected1, connected2, connected3, connected4, connected5, connected6;\n     int ret;\n     float rhs1;\n     float rhs2;\n     igraph_vector_t v1, v2;\n     long int i, j, k, n, m ;\n     igraph_integer_t from, to;\n     igraph_adjlist_t adjlist;\n     FILE *file;\n     file = fopen(\"attempt\", \"r\");\n     if(!file){\n        return 1;\n     }\n\n     igraph_read_graph_edgelist(&amp;graph, file, \n                                0, false);\n\n     fclose(file);\n\n     igraph_vector_init(&amp;v1, (igraph_vcount(&amp;graph)) );\n     igraph_vector_init(&amp;v2, (igraph_vcount(&amp;graph)) );\n     igraph_adjlist_init(&amp;graph, &amp;adjlist, IGRAPH_ALL);\n\n     n = igraph_vcount(&amp;graph);\n     m = igraph_ecount(&amp;graph);\n     for (i=0; i&lt;m; i++){\n        igraph_edge(&amp;graph, i, &amp;from, &amp;to);\n        igraph_neighbors(&amp;graph, &amp;v1, from, IGRAPH_ALL);\n        igraph_neighbors(&amp;graph, &amp;v2, to, IGRAPH_ALL);\n        for (j=0; j &lt; igraph_vector_size(&amp;v2); j++) {\n          for (k=0; k &lt; igraph_vector_size(&amp;v1); k++) {\n            printf(\"%li %d %f %d %f\\n\", i, from, VECTOR(v1)[k] ,to, VECTOR(v2)[j]);                        \n          }\n        }\n     }\n\n     //igraph_destroy(&amp;graph);\n}\n</code></pre>\n\n<p>and the file attempt contains this trial data</p>\n\n<pre><code>1 2\n2 3\n2 4\n3 4\n4 5\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1556707065, "post_id": 55934848, "comment_id": 98522474, "body": "Also you need to pass <code>&amp;t</code> as argument to <code>foo()</code> function. <code>foo(t);</code> --&gt; <code>foo(&amp;t);</code>"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 1, "creation_date": 1556707123, "post_id": 55934848, "comment_id": 98522499, "body": "The term &quot;free&quot; is actually only used to <code>free</code> something that was previously allocated with <code>malloc</code>. Otherwise the term &quot;released&quot; is more appropriate."}, {"owner": {"reputation": 131, "user_id": 11436577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ec0e4cf61b93dd9ccd3413a366209f2?s=128&d=identicon&r=PG&f=1", "display_name": "verifying", "link": "https://stackoverflow.com/users/11436577/verifying"}, "edited": false, "score": 0, "creation_date": 1556707235, "post_id": 55934848, "comment_id": 98522543, "body": "thanks for the comments. corrected now."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556707641, "post_id": 55934848, "comment_id": 98522689, "body": "@verifying see my answer"}], "answers": [{"comments": [{"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1556717086, "post_id": 55934895, "comment_id": 98526605, "body": "It is preferable to explain C semantics in the way they are described in the C standard. This answer subtly mixes abstract semantics with practical implementations. When refers to something being in \u201cthe heap\u201d or \u201cthe stack,\u201d it is talking about specific implementations, which are fine for examples but are not correct statements of C semantics. And, in C semantics, when <code>foo</code> returns, <code>u</code> ceases to exist. But this answer described <code>u</code> as \u201cplaced on the stack.\u201d If <code>u</code> is regarded as on the stack, it it not correct to say it \u201cdoes not exist anymore,\u201d because the stack does not go away\u2026"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1556717103, "post_id": 55934895, "comment_id": 98526611, "body": "\u2026 when a function returns (although data below the stack pointer becomes unreliable). The statement \u201cthe memory used\u2026 does not exist anymore\u201d is false. The memory exists. It is in a chip in the computer. It did not vanish in a puff of smoke when the routine returned. When you mix different descriptions, the writing becomes imprecise and unclear. And it is not enough that you or experienced readers \u201cknow what you mean.\u201d Answers are for people who do <b>not</b> know what you mean. They need to be written clearly using a consistent and correct model."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1556718166, "post_id": 55934895, "comment_id": 98527045, "body": "@EricPostpischil frankly speaking it is not honest nor serious to get two parts of a sentence removing the middle and from that to say it is wrong. I <b>never</b> said &quot;the memory does not exist anymore&quot;. What do you will think if I do the same from your answer ? ;-) It is also not gentle to consider the OP stupid ..."}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1556718218, "post_id": 55934895, "comment_id": 98527070, "body": "When a criticism shows me a potential improvement in my answer, I consider it and sometimes edit the answer. I have done that many times. The fact is this answer mixes models and could be better written."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1556718319, "post_id": 55934895, "comment_id": 98527119, "body": "@EricPostpischil thank you, and I do the same when I think this is justified, but here you push the plug too far ^^ (not sure that french expression can be translated like that)"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 2, "last_activity_date": 1556707754, "last_edit_date": 1556707754, "creation_date": 1556707025, "answer_id": 55934895, "question_id": 55934848, "link": "https://stackoverflow.com/questions/55934848/local-struct-variables-vs-assignement-of-structs/55934895#55934895", "title": "Local Struct Variables vs Assignement of Structs", "body": "<blockquote>\n  <p>What happens with the variables u and t after the function foo is executed?</p>\n</blockquote>\n\n<p>nothing with the code you give because it cannot compile for a lot of reasons :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc -pedantic -Wextra -Wall c.c\nc.c: In function \u2018foo\u2019:\nc.c:7:21: error: expected \u2018}\u2019 before \u2018;\u2019 token\n     test u = {.a = 1; .b = (test*) malloc(3*sizeof(test))}\n                     ^\nc.c:8:5: error: expected \u2018,\u2019 or \u2018;\u2019 before \u2018u\u2019\n     u.b[0]=0;\n     ^\nc.c:11:6: error: incompatible types when assigning to type \u2018test * {aka struct &lt;anonymous&gt; *}\u2019 from type \u2018test {aka struct &lt;anonymous&gt;}\u2019\n     t=u;\n      ^\nc.c:6:16: warning: parameter \u2018t\u2019 set but not used [-Wunused-but-set-parameter]\n void foo(test* t){\n                ^\nc.c: At top level:\nc.c:14:6: warning: return type of \u2018main\u2019 is not \u2018int\u2019 [-Wmain]\n void main(){\n      ^~~~\nc.c: In function \u2018main\u2019:\nc.c:16:9: error: incompatible type for argument 1 of \u2018foo\u2019\n     foo(t);\n         ^\nc.c:6:6: note: expected \u2018test * {aka struct &lt;anonymous&gt; *}\u2019 but argument is of type \u2018test {aka struct &lt;anonymous&gt;}\u2019\n void foo(test* t){\n      ^~~\n</code></pre>\n\n<hr>\n\n<p>A corrected version of the code is :</p>\n\n<pre><code>#include &lt;malloc.h&gt;\n\ntypedef struct{\n    int a;\n    int* b; \n} test; \n\nvoid foo(test* t){\n    test u = {.a = 1, .b = (int*) malloc(3*sizeof(test))};\n    u.b[0]=0;\n    u.b[1]=1;\n    u.b[2]=2;\n    *t=u; \n}\n\nint main(){\n    test t;\n    foo(&amp;t);\n}\n</code></pre>\n\n<p>Using the corrected version :</p>\n\n<blockquote>\n  <ol>\n  <li>Is the memory allocated for u.a freed? </li>\n  </ol>\n</blockquote>\n\n<p><em>u</em> is a local variable, it is not allocated in the heap but placed in the stack, after returning from <em>foo</em> the local variable does not exist anymore, so the same for the field <em>u.a</em> </p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>Is the memory allocated for u.b freed?</li>\n  </ol>\n</blockquote>\n\n<p>the memory allocated by <em>malloc</em> whose pointer was saved in <em>u.b</em> is not freed, but the memory used for <em>u.b</em> is in the stack as for <em>u.a</em> or <em>u</em> itself so after the return that fields does not exist anymore</p>\n\n<blockquote>\n  <ol start=\"3\">\n  <li>Is t.b equal to the vector [0,1,2]?</li>\n  </ol>\n</blockquote>\n\n<p>yes after the correction copying deeply, <em>t.b</em> in <em>main</em> points to the array allocated by <em>malloc</em> then set in <em>foo</em></p>\n\n<p>if you add <code>printf(\"%d %d %d\\n\", t.b[0], t.b[1], t.b[2]);</code> at the end of <em>main</em> it will print <code>0 1 2</code></p>\n"}], "owner": {"reputation": 131, "user_id": 11436577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ec0e4cf61b93dd9ccd3413a366209f2?s=128&d=identicon&r=PG&f=1", "display_name": "verifying", "link": "https://stackoverflow.com/users/11436577/verifying"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 1, "accepted_answer_id": 55934895, "answer_count": 1, "score": 0, "last_activity_date": 1556707754, "creation_date": 1556706673, "last_edit_date": 1556707601, "question_id": 55934848, "link": "https://stackoverflow.com/questions/55934848/local-struct-variables-vs-assignement-of-structs", "title": "Local Struct Variables vs Assignement of Structs", "body": "<p>Consider the following code: </p>\n\n<pre><code>#include &lt;malloc.h&gt;\n\ntypedef struct{\n    int a;\n    int* b; \n} test; \n\nvoid foo(test* t){\n    test u = {.a = 1; .b = (test*) malloc(3*sizeof(test))}\n    u.b[0]=0;\n    u.b[1]=1;\n    u.b[2]=2;\n    *t=u; \n}\n\nvoid main(){\n    test t;\n    foo(&amp;t);\n}\n\n</code></pre>\n\n<p>The variable u is local to the function foo. </p>\n\n<p><strong>My question is:</strong> What happens with the variables u and t after\nthe function foo is executed?</p>\n\n<pre><code>1. Is the memory allocated for u.a released? \n2. Is the memory allocated for u.b freed?\n3. Is t.b equal to the vector [0,1,2]?\n</code></pre>\n"}, {"tags": ["java", "c", "file", "text-files", "binaryfiles"], "comments": [{"owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "edited": false, "score": 0, "creation_date": 1556710033, "post_id": 55934779, "comment_id": 98523578, "body": "Could the down voter explain why and how I can improve?"}], "answers": [{"comments": [{"owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "edited": false, "score": 0, "creation_date": 1556709763, "post_id": 55934853, "comment_id": 98523477, "body": "Thanks. This worked. But, is there a solution in Java code also?"}, {"owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "edited": false, "score": 0, "creation_date": 1556710462, "post_id": 55934853, "comment_id": 98523747, "body": "I&#39;m asking this because, it is difficult to identify where a string ends if you don&#39;t know the size. What if I have a an integer after a string, which I cannot know."}, {"owner": {"reputation": 85518, "user_id": 1593077, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/10c44e0d9568e48d05708ae196ad936f?s=128&d=identicon&r=PG", "display_name": "einpoklum", "link": "https://stackoverflow.com/users/1593077/einpoklum"}, "reply_to_user": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "edited": false, "score": 0, "creation_date": 1556720559, "post_id": 55934853, "comment_id": 98528195, "body": "@TarunMaganti: That would be a different question, but - that seems trivial: Do the opposite of what you&#39;ve done for writing. Just <a href=\"https://docs.oracle.com/javase/7/docs/api/java/nio/channels/FileChannel.html\" rel=\"nofollow noreferrer\">read into the bytebuffer from the file via a channel</a>, then use <a href=\"https://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html\" rel=\"nofollow noreferrer\"><code>getInt()</code></a> to obtain an Integer from the ByteBuffer. Easy peasy."}, {"owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "edited": false, "score": 0, "creation_date": 1556770975, "post_id": 55934853, "comment_id": 98543888, "body": "I maybe asking the question vaguely. How to write using Java and read into C so that I can easily detect an Integer or a string or a float?"}, {"owner": {"reputation": 85518, "user_id": 1593077, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/10c44e0d9568e48d05708ae196ad936f?s=128&d=identicon&r=PG", "display_name": "einpoklum", "link": "https://stackoverflow.com/users/1593077/einpoklum"}, "reply_to_user": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "edited": false, "score": 0, "creation_date": 1556780469, "post_id": 55934853, "comment_id": 98546942, "body": "@TarunMaganti: I&#39;m not sure what you mean by &quot;easily detect&quot;. But - you could use a common format, like JSON and use libraries both in Java and in C to write and read that. Doing so will (sort of) ensure you don&#39;t get the type wrong. It will be slower though."}, {"owner": {"reputation": 380, "user_id": 5627004, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/3d69032ea3d27e87d4303b8ae5e3ee07?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfgang Roth", "link": "https://stackoverflow.com/users/5627004/wolfgang-roth"}, "reply_to_user": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "edited": false, "score": 1, "creation_date": 1556780686, "post_id": 55934853, "comment_id": 98547037, "body": "@TarunMaganti: If a given program writes a binary representation of its integers or bytes or chars or array of chars (strings?), this needs to be read in exactly the same manner as its being written. You have to follow a &quot;contract&quot; when writing and reading those data."}, {"owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "edited": false, "score": 0, "creation_date": 1556793245, "post_id": 55934853, "comment_id": 98553289, "body": "I understand now."}], "tags": [], "owner": {"reputation": 85518, "user_id": 1593077, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/10c44e0d9568e48d05708ae196ad936f?s=128&d=identicon&r=PG", "display_name": "einpoklum", "link": "https://stackoverflow.com/users/1593077/einpoklum"}, "is_accepted": true, "score": 1, "last_activity_date": 1556793453, "last_edit_date": 1556793453, "creation_date": 1556706710, "answer_id": 55934853, "question_id": 55934779, "link": "https://stackoverflow.com/questions/55934779/how-to-read-data-either-binary-or-text-in-c-from-a-file-written-in-java/55934853#55934853", "title": "How to read data (either binary or text) in C from a file written in Java?", "body": "<p>My Java is kind of rusty, but it seems what you're writing to the file is three 4-byte integers, in sequence, and in machine order of bytes (so probably little-endian). That means your file should have (in hex):</p>\n\n<pre><code>9a 00 00 00 62 00 00 00 06 00 00 00\n</code></pre>\n\n<p>But your scan expected to see the numbers as space-separated text, e.g. (in hex)</p>\n\n<pre><code>31 35 34 20 39 38 20 36 0a\n</code></pre>\n\n<p>You should probably use something like <code>fread()</code>, which doesn't do parsing:</p>\n\n<pre><code>size_t fread(void *ptr, size_t size, size_t nmemb, FILE *stream);\n</code></pre>\n\n<p>and the target should be the address of something like an <code>int[3]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "is_accepted": false, "score": 0, "last_activity_date": 1556779414, "creation_date": 1556779414, "answer_id": 55946962, "question_id": 55934779, "link": "https://stackoverflow.com/questions/55934779/how-to-read-data-either-binary-or-text-in-c-from-a-file-written-in-java/55946962#55946962", "title": "How to read data (either binary or text) in C from a file written in Java?", "body": "<p>I understand that <code>fscanf</code> reads a stream of characters which are then parsed according to the given format. Which means we should write the file in Java in character format which is supported by C.</p>\n\n<p>This is what I did: </p>\n\n<p>Java code:</p>\n\n<pre><code>package scratchpad;\n\nimport java.io.BufferedWriter;\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.OutputStreamWriter;\nimport java.nio.charset.StandardCharsets;\nimport java.util.logging.Level;\nimport java.util.logging.Logger;\n\npublic class WriteClass {\n    void writeFunction() {\n        File defgFile = new File(\"/home/thor/Documents/ScratchPad/def.bin\");\n        try(FileOutputStream fos = new FileOutputStream(defgFile)){\n            BufferedWriter bos = new BufferedWriter(new OutputStreamWriter(fos,StandardCharsets.US_ASCII));\n            bos.write(Integer.toString(123));\n            bos.newLine();\n            bos.write(Integer.toString(96));\n            bos.newLine();\n            bos.write(Integer.toString(1));\n            bos.newLine();\n            bos.write(\"Water\");\n            bos.newLine();\n            bos.write(Integer.toString(2));\n            bos.newLine();\n            bos.write(\"Forest\");\n            bos.newLine();\n\n            bos.flush();\n            bos.close();\n        }\n        catch(IOException ex) {\n            Logger.getLogger(WriteClass.class.getName()).log(Level.SEVERE,\"Can't open a new file\",ex);\n        }\n    }\n}\n</code></pre>\n\n<p>Important thing to notice is that I have used <code>OutputStreamWriter</code> to write text file in ASCII format. Another point is that we need not worry about the <code>ByteOrder</code> in which an ASCII value is written to a file. It seems like Java is taking care of it.</p>\n\n<p>The <code>bos.newLine()</code> is platform independent way to write a new line.\n<code>bos.flush()</code> is mandatory or else the data won't be written. </p>\n\n<p>The C code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;   \n\nint main() {\n\n    FILE *fp = fopen(\"def.bin\",\"r\");\n    int one,two,three;\n    fscanf(fp,\"%d\",&amp;one);\n    fscanf(fp,\"%d\",&amp;two);\n    printf(\"%d\\n%d\\n\",one,two);\n\n    int index;\n    fscanf(fp,\"%d\",&amp;index);\n    char* string;\n    fscanf(fp,\"%s\",string); \n    printf(\"%d\\n%s\\n\",classno,string);\n    return 0;\n}\n</code></pre>\n\n<p>I have noticed that string <code>char*</code> was not allocated memory and still worked.</p>\n"}], "owner": {"reputation": 2234, "user_id": 4669984, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6e14021aae7f6d223e60ac4bd035440f?s=128&d=identicon&r=PG", "display_name": "Tarun Maganti", "link": "https://stackoverflow.com/users/4669984/tarun-maganti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 55934853, "answer_count": 2, "score": -1, "last_activity_date": 1556793453, "creation_date": 1556706208, "last_edit_date": 1556710628, "question_id": 55934779, "link": "https://stackoverflow.com/questions/55934779/how-to-read-data-either-binary-or-text-in-c-from-a-file-written-in-java", "title": "How to read data (either binary or text) in C from a file written in Java?", "body": "<p>Writing in Java:</p>\n\n<pre><code>File file = new File(\"abc\");\ntry(FileOutputStream fos = new FileOutputStream(file)) {\n    FileChannel outChannel = fos.getChannel();\n    ByteBuffer buffer = ByteBuffer.allocate(Integer.BYTES*3).order(ByteOrder.nativeOrder());\n    buffer.putInt(154);\n    buffer.putint(98);\n    buffer.putInt(6);\n    outChannel.write(buffer);\n\n\n    IntStream.rangeClosed(1,3).forEach((iter) -&gt; {\n        String reqString = (Integer.toString(iter) + \"_string\");\n        byte[] bytes = reqString.getBytes(Charset.forName(\"US-ASCII\"));\n        ByteBuffer byteBuffer = ByteBuffer.allocate(bytes.length).order(ByteOrder.nativeOrder());\n        byteBuffer.put(bytes);\n        try {\n            outChannel.write(byteBuffer);\n        }\n        catch(IOException ex) {\n            ex.printStackTrace();\n        }\n    });\n}   \ncatch(IOException ex) {\n    ex.printStackTrace();\n}\n</code></pre>\n\n<p>Reading in C:\n    int main() {\n    int one,two,three;\n    FILE *fp = fopen(\"abc\",\"r+\");</p>\n\n<pre><code>fscanf(fp,\"%d\",&amp;one);\nfscanf(fp,\"%d\",&amp;two);\nfscanf(fp,\"%d\",&amp;three);\n\nprintf(\"%d %d %d\",one,two,three);\n\nchar ch;\nfread(&amp;ch,sizeof(char),1,fp);\nwhile(ch!= '\\0') {\n    printf(\"%c\",ch);\n    fread(&amp;ch,sizeof(char),1,fp);\n} \nreturn 0;\n}\n</code></pre>\n\n<p>To which the output is:\n<a href=\"https://i.stack.imgur.com/74Vjc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/74Vjc.png\" alt=\"[output1]\"></a></p>\n\n<p>I don't understand what I see. There are three value and none of which were written by me. Are they memory locations? or Garbage values?</p>\n\n<p>In which format does the Java write a file. Since, C reads in native order of the underlying platform I tried to use ByteBuffer. If I use DataOutputService, I though that the Java writes in `BIG_ENDIAN' format and C might not be able to read a proper value.</p>\n\n<p>Also, how do I write and read a string in this scenario. Java, by default uses UTF-8, hence, I didn't use FileOutputStream directly, instead converted they into bytes of ASCII format so that I can read them character by character. But, no output is shown. When can I use <code>fscanf(fp,\"%s\",string)</code> <em>(string is a char</em> datatype variable with sufficient memory allocated)*?</p>\n\n<hr>\n\n<p>Ideal solution would be where Java is able to write Data in particular order and C is able to read it using <code>fscanf()</code>, as a result it would be easier to identify integers/floats/strings.</p>\n"}, {"tags": ["c", "do-while"], "comments": [{"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 6, "creation_date": 1556704472, "post_id": 55934431, "comment_id": 98521538, "body": "<code>scanf(&quot;%c\\n&quot;, &amp;c);</code> --&gt; <code>scanf(&quot; %c&quot;, &amp;c);</code> The <code>\\n</code> character in <code>scanf()</code> waits for another input."}], "answers": [{"tags": [], "owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "is_accepted": true, "score": 2, "last_activity_date": 1556705422, "last_edit_date": 1556705422, "creation_date": 1556705045, "answer_id": 55934565, "question_id": 55934431, "link": "https://stackoverflow.com/questions/55934431/do-while-not-looping/55934565#55934565", "title": "Do while not looping?", "body": "<p>You problem is a combination of two separate problems.</p>\n\n<p>The first is that any white-space characters in a <code>scanf</code> format string tells <code>scanf</code> to read (and throw away) any consecutive white-space in the input.</p>\n\n<p>But to know where the white-space in the input ends, it needs to see something that is <em>not</em> a white-space. That's why trailing space in the format string forces you (the user) to input something else.</p>\n\n<p>The second problem is that for the previous input operation (<code>scanf(\"%d\", &amp;a)</code>) you probably pressed the <kbd>Enter</kbd> key to \"send\" the input to the program. This <kbd>Enter</kbd> key will be put into the input buffer as a newline (which is a white-space character). When you then read your characters with the <code>\"%c\"</code> format, it will read that newline. You need to skip that newline.</p>\n\n<p>Both problems are solved the same way: Ask <code>scanf</code> to read (and throw away) <em>leading</em> white-space. Which is done by putting the space at the beginning of the format string, as in</p>\n\n<pre><code>scanf(\" %c\", &amp;c);\n//     ^\n// Note space here instead\n</code></pre>\n\n<p>Also note that this explicit skipping of leading white-space is only needed for the <code>\"%c\"</code> and <code>\"%[\"</code> formats, all other formats do this implicitly.</p>\n"}, {"tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 0, "last_activity_date": 1556705048, "creation_date": 1556705048, "answer_id": 55934568, "question_id": 55934431, "link": "https://stackoverflow.com/questions/55934431/do-while-not-looping/55934568#55934568", "title": "Do while not looping?", "body": "<p>You mix read of a number and read of a character you do not want to get the character enter just after the number being generally a newline, but currently you get that newline.</p>\n\n<p>To bypass the separators (space / newline) just add a space in the format before <code>%c</code> and you do not need to specify a newline : <code>scanf(\" %c\", &amp;c);</code></p>\n\n<p>After that :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc -pedantic -Wextra -Wall c.c\npi@raspberrypi:/tmp $ ./a.out\nenter a no.\n4\ninput more no.? y or n\ny\nenter a no.\n3\ninput more no.? y or n\ny\nenter a no.\n-1\ninput more no.? y or n\nn\nthe total count of positive, negative and zeros are 2 1 0\npi@raspberrypi:/tmp $ \n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11436401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/190eff5d564b454a0776535fbba543f4?s=128&d=identicon&r=PG&f=1", "display_name": "Newbee", "link": "https://stackoverflow.com/users/11436401/newbee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 55934565, "answer_count": 2, "score": -1, "last_activity_date": 1556705422, "creation_date": 1556704310, "last_edit_date": 1556704835, "question_id": 55934431, "link": "https://stackoverflow.com/questions/55934431/do-while-not-looping", "title": "Do while not looping?", "body": "<p>I am a beginner who has started learning C. I want to write a program using C which helps users to input nos. as much as they want and once they are done, the program shows the no. of positive, negative and zeros entered. I am trying to do this using do-while lopp. It is executing once, but it isnt going on loop. I want to know what am i doing wrong here?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main ()\n{\n    int a,p=0,n=0,z=0;\n    char c;\n\n    do\n    {\n       printf(\"enter a no.\\n\");\n       scanf(\"%d\", &amp;a);\n\n       if (a&gt;0)\n       {\n            p++;\n       }\n       else if (a==0)\n       {\n            z++;\n       }\n       else if(a&lt;0)\n       {\n            n++;\n       }\n\n       printf(\"input more no.? y or n\\n\");\n       scanf(\"%c\\n\", &amp;c);\n    } while (c=='y');\n\n    printf(\"the total count of positive, negative and zeros are %d %d %d\\n\", p,n,z);\n\n    return 0;\n}\n</code></pre>\n\n<p><strong>Expected result is:</strong></p>\n\n<blockquote>\n  <p>enter a no.</p>\n  \n  <p>4</p>\n  \n  <p>input more no.? y or n</p>\n  \n  <p>y</p>\n  \n  <p>enter a no.</p>\n  \n  <p>3</p>\n  \n  <p>input more no.? y or n</p>\n  \n  <p>y</p>\n  \n  <p>enter a no.</p>\n  \n  <p>-1</p>\n  \n  <p>input more no.? y or n</p>\n  \n  <p>n</p>\n</blockquote>\n\n<p>the final count of positive, negative and zeros are 2 1 0</p>\n\n<p><strong>But the actual output coming is:</strong></p>\n\n<blockquote>\n  <p>enter a no.</p>\n  \n  <p>4</p>\n  \n  <p>input more no.? y or n</p>\n  \n  <p>y</p>\n</blockquote>\n\n<p>the final count of positive, negative and zeros are 1 0 0</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556703355, "post_id": 55934230, "comment_id": 98521123, "body": "You need to run this with a debugger, which will show you where exactly the crash occurs. And the problem is elsewhere is your code, there is nothong obviously wrong in the part of your code you show here. You need to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556703912, "post_id": 55934230, "comment_id": 98521342, "body": "With the code you show there&#39;s three possibilities of undefined behavior and possible crashes: You using <code>file</code> without checking if it&#39;s a <code>NULL</code> pointer; <code>CHUNK</code> being to large (larger than the size of <code>buf</code>) leading to <code>fread</code> writing out of bounds; Or <code>total</code> being zero so you have a division by zero."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556704087, "post_id": 55934230, "comment_id": 98521404, "body": "There are other possibilities of undefined behavior in your code, but ones that should not lead to crashes. For example arithmetic overflow for signed integers, and using the wrong <code>printf</code> format specifier for the arguments you pass."}, {"owner": {"reputation": 29, "user_id": 9842741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dec8809c71f6c9c638e2d4fc351053eb?s=128&d=identicon&r=PG&f=1", "display_name": "B. Ania", "link": "https://stackoverflow.com/users/9842741/b-ania"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556705007, "post_id": 55934230, "comment_id": 98521721, "body": "Here is a <a href=\"https://pastebin.com/MWbktM9v\" rel=\"nofollow noreferrer\">minimalist code</a>. In the bigger project, I have checked all the possibilities that you mentioned @Someprogrammerdude, but at the last comment, I guess you are correct. It does not crash as in the program stops, it goes for example like 6%.. 7% .. -7%, -8% and I guess it is overflowing, but how can I fix it? Since the files are larger than the limit in bytes for int, or long int, how can I fix the problem to keep the file proportionate in the limits? I have attached the code, at 200MBs file, it doesn&#39;t show correctly after a few seconds."}, {"owner": {"reputation": 29, "user_id": 9842741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dec8809c71f6c9c638e2d4fc351053eb?s=128&d=identicon&r=PG&f=1", "display_name": "B. Ania", "link": "https://stackoverflow.com/users/9842741/b-ania"}, "edited": false, "score": 0, "creation_date": 1556705127, "post_id": 55934230, "comment_id": 98521767, "body": "At my previous code, I have used safe_malloc, it should have been simply malloc."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556705243, "post_id": 55934230, "comment_id": 98521803, "body": "@B.Ania please don&#39;t post links to your code in a comment, but <a href=\"https://stackoverflow.com/posts/55934230/edit\">edit</a>  your question and put your code <i>there</i>."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556705420, "post_id": 55934230, "comment_id": 98521862, "body": "@B.Ania and is there a reason why <code>CHUNK</code> is <code>10000000</code>? This is huge, <code>CHUNK</code> shouldn&#39;t be larger than a Mbyte or so. Did you try your code with <code>CHUNK</code> being smaller? But that&#39;s probably not the reason for the crash..."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1556705563, "post_id": 55934230, "comment_id": 98521913, "body": "Are you on a system where <code>long</code> is 32 bits? Try using <code>size_t</code> and the <code>&quot;%zu&quot;</code> format specifier (or perhaps <code>unsigned long long</code> and the <code>&quot;%llu&quot;</code> format specifier)."}, {"owner": {"reputation": 29, "user_id": 9842741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dec8809c71f6c9c638e2d4fc351053eb?s=128&d=identicon&r=PG&f=1", "display_name": "B. Ania", "link": "https://stackoverflow.com/users/9842741/b-ania"}, "edited": false, "score": 0, "creation_date": 1556705737, "post_id": 55934230, "comment_id": 98521986, "body": "Yes, I am implementing searching of large patterns (&gt;10MBs) and I need the big chunks of the files, as big as the pattern since the files are a few GBs. The searching using chunks part is done searching first if the chunk is the pattern and then enlarging the chunk by chunk*2-1 and search if the pattern was cut somehow by the chunk when it was first taken, so that the search can be correct."}, {"owner": {"reputation": 29, "user_id": 9842741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dec8809c71f6c9c638e2d4fc351053eb?s=128&d=identicon&r=PG&f=1", "display_name": "B. Ania", "link": "https://stackoverflow.com/users/9842741/b-ania"}, "edited": false, "score": 0, "creation_date": 1556706483, "post_id": 55934230, "comment_id": 98522257, "body": "Yes, long is on 32 bits and unsigned long long int is on 8 bytes. I adjusted those and I still get the same problem. I was thinking if maybe is there a way to somehow proportionate the file size inside the limit of a long or int? Probably something like from 0 to 1 in int, this counts actually for x bytes read. And the total file size to be proportionate with the max limit of int. I don&#39;t know how to explain this well nor if it is possible."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1556711665, "post_id": 55934230, "comment_id": 98524217, "body": "@B.Ania instead of editing yout question and put &quot;solved&quot; you should rathe ranswer you own question."}], "answers": [{"tags": [], "owner": {"reputation": 29, "user_id": 9842741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dec8809c71f6c9c638e2d4fc351053eb?s=128&d=identicon&r=PG&f=1", "display_name": "B. Ania", "link": "https://stackoverflow.com/users/9842741/b-ania"}, "is_accepted": false, "score": 0, "last_activity_date": 1556828615, "creation_date": 1556828615, "answer_id": 55959737, "question_id": 55934230, "link": "https://stackoverflow.com/questions/55934230/percentage-of-a-file-c-how-to-fix-sizes-to-stay-in-a-limit/55959737#55959737", "title": "Percentage of a file C. How to fix sizes to stay in a limit?", "body": "<p>The problem is with the data types. The answer was to use instead of int data type, the unsigned long long int datatype in order to compute the percentage.</p>\n\n<pre><code>FILE *file;\nfile = fopen(\"test.txt\", \"r\");\nsize_t nread;\nchar * buf  = (char*)malloc(sizeof(char) * CHUNK);\nunsigned long long total = 0, keeptrack_sum, percentage;\nfseek(file, 0L, SEEK_END);\ntotal = ftell(file);\nfseek(file, 0L, SEEK_SET);\n\nif (file)\n    {\n    while ((nread = fread(buf, 1, CHUNK, file)) &gt; 0)\n        {\n\n           keeptrack_sum += nread;\n           percentage = keeptrack_sum*100/total\n           printf(\" loading: %d \\n\", percentage);\n        }\n    }\n\nfclose(file);\n\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 9842741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dec8809c71f6c9c638e2d4fc351053eb?s=128&d=identicon&r=PG&f=1", "display_name": "B. Ania", "link": "https://stackoverflow.com/users/9842741/b-ania"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556828641, "creation_date": 1556703168, "last_edit_date": 1556828641, "question_id": 55934230, "link": "https://stackoverflow.com/questions/55934230/percentage-of-a-file-c-how-to-fix-sizes-to-stay-in-a-limit", "title": "Percentage of a file C. How to fix sizes to stay in a limit?", "body": "<p>I am trying to read a file in C and make some loading print that will show me how much of the file I have read so far (I am reading the file in chunks). My problem is when it comes to files larger (>100MBs), the loading crashes and I know that it is because there are limits of data types in C, yet I do not know how to fix it, or how to approach it. </p>\n\n<p>Firstly, before I start the reading chunks the file part, I am computing the file size and then, I use a mathematical formula that would compute percentage since I make a sum of how much I have read and how much is total.</p>\n\n<pre><code>FILE *file;\nfile = fopen(\"test.txt\", \"r\");\nsize_t nread;\nchar * buf  = (char*)malloc(sizeof(char) * CHUNK);\nlong total = 0;\nfseek(file, 0L, SEEK_END);\ntotal = ftell(file);\nfseek(file, 0L, SEEK_SET);\n\nif (file)\n    {\n    while ((nread = fread(buf, 1, CHUNK, file)) &gt; 0)\n        {\n                printf(\" loading: %d \\n\", ftell(file)*100/total);\n        }\n    }\n\nfclose(file);\n</code></pre>\n\n<p>The problem is at the sizes in C, since the files are larger then the int/long int limits, it overflows, is there a way to correctly display how much of the file I have parsed? I cannot store the result of \"ftell(file)*100/total\" in an int or long int.</p>\n"}, {"tags": ["c", "pointers", "linked-list", "segmentation-fault", "self-reference"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1556702915, "post_id": 55934117, "comment_id": 98520952, "body": "please unlearn the habit of naming a type as <code>PtrSomething</code> or similar. There is a perfectly fine way in C of telling that something is a pointer - just put an asterisk after the type name!"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556703063, "post_id": 55934117, "comment_id": 98521003, "body": "There is no <b>object</b> of type pointer to pointer to node in the tutorial. There is an object of type pointer to node and a pointer to that gets passed in. A <code>Head</code> is not a sensible type, it is just a reference to the <code>Node *</code> object outside <code>add_to_beginning</code> that needs to be modified inside."}], "answers": [{"tags": [], "owner": {"reputation": 769, "user_id": 1509248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9fdfd9858e888b2f195a055830afdab?s=128&d=identicon&r=PG", "display_name": "gerwin", "link": "https://stackoverflow.com/users/1509248/gerwin"}, "is_accepted": true, "score": 3, "last_activity_date": 1556703030, "creation_date": 1556703030, "answer_id": 55934201, "question_id": 55934117, "link": "https://stackoverflow.com/questions/55934117/how-can-i-fix-this-segfault-issue-when-manipulating-linked-lists-in-c/55934201#55934201", "title": "How can I fix this segfault issue when manipulating linked-lists in C?", "body": "<p>You define the Head pointer to be 0:</p>\n\n<blockquote>\n  <p>h0 = NULL;</p>\n</blockquote>\n\n<p>Then you dereference it here:</p>\n\n<blockquote>\n  <p>new_node->next = (*h);</p>\n</blockquote>\n\n<p>The pointer points to address zero and you get a segfault. Make sure it points to valid memory :)</p>\n"}], "owner": {"reputation": 17, "user_id": 11052787, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eyhhN.jpg?s=128&g=1", "display_name": "Narmondil", "link": "https://stackoverflow.com/users/11052787/narmondil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 55934201, "answer_count": 1, "score": 0, "last_activity_date": 1556703030, "creation_date": 1556702647, "question_id": 55934117, "link": "https://stackoverflow.com/questions/55934117/how-can-i-fix-this-segfault-issue-when-manipulating-linked-lists-in-c", "title": "How can I fix this segfault issue when manipulating linked-lists in C?", "body": "<p>I have been working on self-referential structures and Linked-Lists in particular for a C assignment. The problem is that when I try to de-reference the pointer to the head of the list I get either a segfault or an \"assignment from incompatible pointer type\".</p>\n\n<p>I have looked at <a href=\"https://www.geeksforgeeks.org/delete-a-linked-list-node-at-a-given-position/\" rel=\"nofollow noreferrer\">this explanation</a> on manipulating linked-lists and tried to follow their example on de-referencing the head but I keep getting a segfault when I do it.\nI have also used onlinegdb to debug, the segfaults came from:</p>\n\n<pre><code>new_node-&gt;next = (*h);\n(*h) = new_node;\ncrawler = (*head_of_list);\n</code></pre>\n\n<p>so I tried to avoid de-referencing, it stopped segfaulting but still not working. It thought de-referencing the head of the list was what this was all about so a little confused here.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n\n/*DATA STRUCTURES*/\n\ntypedef struct Node_s* Ptr_Node; /*Ptr_Node = pointer to struct node_s*/\n\ntypedef struct Node_s{\n  int data;\n  Ptr_Node next;\n} Node_t;\n\ntypedef Ptr_Node* Head; /*a head = pointer to pointer of node*/\n\n/*FUNCTIONS*/\n\n/*Adds integer x in first position of the linked list*/\nHead add_to_beginning(Head head_of_list, int x){\n  Head h;\n  h = head_of_list;\n  Ptr_Node new_node;\n  new_node = (Ptr_Node) malloc(sizeof(Node_t)); /*casting pointer type*/\n  new_node-&gt;data = x;\n  new_node-&gt;next = (*h); /*de-ref head to obtain pointer to first node*/\n  (*h) = new_node; /*de-ref head to change what it points to*/\n  return h;\n}\n\n\nvoid print_list(Head head_of_list){\n  Ptr_Node crawler;\n  crawler = (*head_of_list); /*points to first cell of list*/\n  while(crawler != NULL){\n    printf(\"%d\\n\", crawler-&gt;data );\n    crawler = crawler-&gt;next;\n  }\n}\n\n/*driver for testing*/\nint main(void){\n  Head h0, h1, h2;\n  h0 = NULL;\n  h1 = add_to_beginning(h0, 0);\n  h2 = add_to_beginning(h1, 1);\n  h3 = add_to_beginning(h2, 2);\n\n  print_list(head_of_list);\n\n  return 0;\n}\n\n</code></pre>\n\n<p>Any help on how to work around this much appreciated.</p>\n"}, {"tags": ["c", "vector"], "comments": [{"owner": {"reputation": 6673, "user_id": 777689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19JOo.jpg?s=128&g=1", "display_name": "PeterT", "link": "https://stackoverflow.com/users/777689/petert"}, "edited": false, "score": 0, "creation_date": 1556703608, "post_id": 55934110, "comment_id": 98521218, "body": "This is way too much code. You should reduce the amount of code to a smaller example and actually mention that you want help with <code>v_pop_back</code>. Anyway, you are supposed to allocate a new array the size of <code>cur_cap</code> (which has been halfed at that point). You can either use <code>realloc</code> for that or you <code>malloc</code> then <code>memcpy</code> the <code>e</code> first element and free the old memory . Btw. e has also already been decreased you don&#39;t need to change it) first elements."}, {"owner": {"reputation": 45, "user_id": 10575383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d274f404739952d6f044dcf52e5d742?s=128&d=identicon&r=PG&f=1", "display_name": "Chiara", "link": "https://stackoverflow.com/users/10575383/chiara"}, "reply_to_user": {"reputation": 6673, "user_id": 777689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19JOo.jpg?s=128&g=1", "display_name": "PeterT", "link": "https://stackoverflow.com/users/777689/petert"}, "edited": false, "score": 0, "creation_date": 1557053147, "post_id": 55934110, "comment_id": 98630145, "body": "Would this v_pop_back function be correct? <code>&#47;*** TO BE DONE START ***&#47; realloc((void*)v, v-&gt;cur_cap) &#47;*** TO BE DONE END ***&#47; </code> Thank you for the help, I&#39;ll edit the question to make reduce the code!"}, {"owner": {"reputation": 45, "user_id": 10575383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d274f404739952d6f044dcf52e5d742?s=128&d=identicon&r=PG&f=1", "display_name": "Chiara", "link": "https://stackoverflow.com/users/10575383/chiara"}, "reply_to_user": {"reputation": 6673, "user_id": 777689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19JOo.jpg?s=128&g=1", "display_name": "PeterT", "link": "https://stackoverflow.com/users/777689/petert"}, "edited": false, "score": 0, "creation_date": 1557054659, "post_id": 55934110, "comment_id": 98630463, "body": "I&#39;m sorry I made a mistake, I&#39;ve ment to say: /*** TO BE DONE START <b><i>/ v=realloc((void</i>)v, v-&gt;cur_cap) /*</b> TO BE DONE END ***/"}, {"owner": {"reputation": 6673, "user_id": 777689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19JOo.jpg?s=128&g=1", "display_name": "PeterT", "link": "https://stackoverflow.com/users/777689/petert"}, "edited": false, "score": 0, "creation_date": 1557066395, "post_id": 55934110, "comment_id": 98633631, "body": "it&#39;s more like <code>v-&gt;e_array = realloc(v-&gt;e_array, v-&gt;cur_cap*v-&gt;e_sz);</code>. I get the feeling from some of the other code-snippets that you don&#39;t really understand the purpose of all the data members. Maybe try and do the exercise together with other students, ask you tutor some questions or re-read the other material."}], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 7903641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KBkoO.jpg?s=128&g=1", "display_name": "Faizan Shah", "link": "https://stackoverflow.com/users/7903641/faizan-shah"}, "is_accepted": false, "score": 1, "last_activity_date": 1558095055, "creation_date": 1558095055, "answer_id": 56186144, "question_id": 55934110, "link": "https://stackoverflow.com/questions/55934110/implementing-vector-dynamic-array-in-c-functions-and-main-file/56186144#56186144", "title": "Implementing vector (dynamic array) in C - functions and main file", "body": "<p>inside <code>V_AT()</code> Return <code>return (v-&gt;e_array+i*v-&gt;e_sz); //return element</code></p>\n\n<pre><code>void* v_at(vector_type v, iterator i) {\n    if ( v == NULL )\n        fail(\"v_at() Error: no such vector\");\n    if ( i == iterator_end )\n        i = v-&gt;no_e -1;\n    if ( i &lt; 0 || i &gt;= v-&gt;no_e )\n        fail(\"v_at() Error: no such element in this vector\");\n/*** TO BE DONE START ***/\n    return (v-&gt;e_array+i*v-&gt;e_sz); //return element\n/*** TO BE DONE END ***/\n\n}\n</code></pre>\n\n<p>Similarly at V_push_back:</p>\n\n<pre><code>void v_push_back(vector_type v, void* new_val){\n    if ( v-&gt;no_e &gt;= v-&gt;cur_cap ) {\n        /*** need to expand the array ***/\n        v-&gt;cur_cap += (v-&gt;cur_cap)? v-&gt;cur_cap : 2;\n/*** TO BE DONE START ***/\n        v-&gt;e_array = check_a(realloc(v-&gt;e_array, sizeof(void*) * v-&gt;cur_cap));\n        //allocate memory\n/*** TO BE DONE END ***/\n\n    }\n    /*** copy new_val into the array at end position (v-&gt;no_e) ***/\n/*** TO BE DONE START ***/\n    if(v-&gt;e_type==V_CHAR){\n        memcpy(\n              v-&gt;e_array +(v-&gt;no_e)*v-&gt;e_sz,\n              new_val,\n              v-&gt;e_sz\n              );\n    }else{\n        v-&gt;e_array = check_a(realloc(v-&gt;e_array, v-&gt;e_sz * v-&gt;cur_cap));\n        memcpy(\n              v-&gt;e_array +(v-&gt;no_e*v-&gt;e_sz),\n              new_val,\n              v-&gt;e_sz\n              );\n    }\n/*** TO BE DONE END ***/\n\n    (v-&gt;no_e)++;\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 10575383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d274f404739952d6f044dcf52e5d742?s=128&d=identicon&r=PG&f=1", "display_name": "Chiara", "link": "https://stackoverflow.com/users/10575383/chiara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1558095055, "creation_date": 1556702597, "last_edit_date": 1556702995, "question_id": 55934110, "link": "https://stackoverflow.com/questions/55934110/implementing-vector-dynamic-array-in-c-functions-and-main-file", "title": "Implementing vector (dynamic array) in C - functions and main file", "body": "<p>This is a memory allocation program: I have to complete a given code (main and function file) given a header that has to implement the C++ vector functions in C. Here is the expected output (but of course the code has to be generalized enough not to just copy the output):</p>\n\n<pre><code>\nVector vc1 now contains 5 characters (capacity=8): ciao\nVector vc2 now contains 9 characters (capacity=16): ciaociao\nVector vc2 now contains 11 characters (capacity=16): ciao--ciao\nVector vi1 now contains 10 integers:  0 1 2 3 4 5 6 7 8 9\nVector vc2 now contains 21 characters (capacity=32): ciao-0123456789-ciao\nVector vc2 now contains 5 characters (capacity=8): ciao\nVector vd1 now contains 10 doubles (capacity=16):  9.5 8.5 6.5 5.5 3.14159 4.5 3.5 2.5 1.5 0.5\nVector vd1 now contains 1 double (capacity=2):  6.28318\nVector vi1 now contains 2 integers (capacity=4):  0 9\n</code></pre>\n\n<p>I can only modify the code between the \"TO BE DONE START\" and \"TO BE DONE END\". I need to modify both the function file and the main file in order to make the program work. </p>\n\n<p>Here is the function file (vector.c), and what I've already done is commented on the side with \"THIS IS WHAT I'VE ADDED\":</p>\n\n<pre><code>#include \"vector.h\"\n\n\nvoid fail(const char* msg){\n    fprintf(stderr,\"\\nERROR: %s\\n\\n\",msg);\n    exit(1);\n}\n\n\nvoid * check_a(void*p){\n    if ( p == NULL )\n        fail(\"check_a(): NULL pointer\");\n    return p;\n}\n\n\nvector_type v_create_empty(char type){\n    vector_type my_v = (vector_type)check_a(malloc(sizeof(struct vector_struct)));\n\n    my_v-&gt;e_sz = (type == V_INT ? sizeof(int) : type == V_DOUBLE ? sizeof(double) : 1);\n\n    my_v-&gt;e_type = type;\n    my_v-&gt;no_e = my_v-&gt;cur_cap = 0;\n    my_v-&gt;e_array = NULL;\n    return my_v;\n}\n\n\nvoid v_destroy(vector_type my_v){\n    if ( my_v == NULL )\n        return;\n\n/*** TO BE DONE START ***/\n    free(my_v-&gt;e_array);          //THIS IS WHAT I'VE ADDED\n/*** TO BE DONE END ***/\n\n    free((void*)my_v);\n}\n\n\nvoid* v_at(vector_type v, iterator i) {\n    if ( v == NULL )\n        fail(\"v_at() Error: no such vector\");\n    if ( i == iterator_end )\n        i = v-&gt;no_e -1;\n    if ( i &lt; 0 || i &gt;= v-&gt;no_e )\n        fail(\"v_at() Error: no such element in this vector\");\n\n/*** TO BE DONE START ***/\n    else                           //THIS IS WHAT I'VE ADDED\n    v-&gt;e_array[i];\n/*** TO BE DONE END ***/\n\n}\n\n\nvoid v_push_back(vector_type v, void* new_val){\n    if ( v-&gt;no_e &gt;= v-&gt;cur_cap ) {\n        /*** need to expand the array ***/\n        v-&gt;cur_cap += (v-&gt;cur_cap)? v-&gt;cur_cap : 2;\n\n/*** TO BE DONE START ***/\n\n/*** TO BE DONE END ***/\n\n    }\n    /*** copy new_val into the array at end position (v-&gt;no_e) ***/\n\n/*** TO BE DONE START ***/\n      v-&gt;e_array[v-&gt;no_e] = e_array      //THIS IS WHAT I'VE ADDED     \n    v-&gt;e_array[v-&gt;e_sz++] = e_array;\n/*** TO BE DONE END ***/\n\n    (v-&gt;no_e)++;\n}\n\n\nvoid v_pop_back(vector_type v){\n    if ( v == NULL )\n        fail(\"v_pop_back(): no such vector\");\n    if ( v-&gt;no_e == 0 )\n        return;\n    if ( --(v-&gt;no_e) &lt; ((v-&gt;cur_cap)&gt;&gt;1) ) {\n        /*** reallocate a smaller array ***/\n        (v-&gt;cur_cap) &gt;&gt;= 1;\n\n/*** TO BE DONE START ***/                      //THIS IS WHAT I'VE ADDED (but I'm lost on this one)\n//    for (int i = 0; i &lt; v-&gt;no_e - 1; i++) {\n//        v-&gt;e_array[i] = v-&gt;e_array[i + 1];\n//        v-&gt;e_array[i + 1] = NULL;\n//    }\n//   v-&gt;no_e--;\n/*** TO BE DONE END ***/\n\n    }\n}\n\n\nvoid v_insert_n(vector_type v,iterator start_i,unsigned n,void* new_val){\n    char tmp[v-&gt;e_sz];\n    int i;\n    unsigned to_move;\n\n    if ( n==0 ) /*** nothing to insert ***/\n        return;\n    if ( v == NULL )\n        fail(\"v_insert_n(): no such vector\");\n    if ( start_i == iterator_end )\n        start_i = v-&gt;no_e;\n    if ( start_i &lt; 0 )\n        fail(\"v_insert_n(): bad iterator\");\n\n    /*** a zero element of suitable size ***/\n    memset((void*)tmp,0,v-&gt;e_sz);\n\n    if ( start_i &gt;= v-&gt;no_e ) {\n        /*** want to append past the end ***/\n        /*** fill the possible gap with zero elements... ***/\n        while ( start_i &gt; v-&gt;no_e )\n            v_push_back(v,(void*)tmp);\n        /*** ...then append new elements at end ***/\n        for (i=0; i&lt;n; i++)\n            v_push_back(v,new_val);\n        return;\n    }\n\n    /*** want to insert at intermediate position ***/\n    /*** expand the array by appending zero elements ***/\n    /*** then move some elements towards end to make room ***/\n\n    to_move = v-&gt;no_e - start_i;\n\n    for (i=0; i&lt;n; i++)\n        v_push_back(v,tmp);\n\n    for (i=0; i&lt;to_move; i++)\n        memcpy (\n            v-&gt;e_array + (v-&gt;no_e-1-i) * v-&gt;e_sz,\n            v-&gt;e_array + (v-&gt;no_e-1-i-n) * v-&gt;e_sz,\n            v-&gt;e_sz);\n\n    /*** now copy new elements in the room ***/\n    for (i=0; i&lt;n; i++) {\n\n/*** TO BE DONE START ***/\n\n/*** TO BE DONE END ***/\n\n    }\n}\n\n\nvoid v_erase_range(vector_type v,iterator start_i,iterator end_i){\n    int i, j;\n\n    if ( v == NULL )\n        fail(\"v_erase_range(): no such vector\");\n    if ( start_i == iterator_end )\n        start_i = v-&gt;no_e-1;\n    if ( end_i == iterator_end )\n        end_i = v-&gt;no_e;\n    if ( start_i &lt; 0 || start_i &gt;= v-&gt;no_e || end_i &lt; 0 )\n        fail(\"v_erase_range(): bad iterator\");\n    if ( start_i &gt;= end_i ) /*** nothing to erase ***/\n        return;\n\n    for ( i = start_i, j = end_i ; j &lt; v-&gt;no_e ; i++, j++ )\n        memcpy(\n            v-&gt;e_array + (v-&gt;e_sz) * i,\n            v-&gt;e_array + (v-&gt;e_sz) * j,\n            v-&gt;e_sz);\n\n    /*** call v_pop_back() to actually erase elements ***/\n/*** TO BE DONE START ***/\n\n/*** TO BE DONE END ***/\n\n}\n</code></pre>\n\n<p>This is the main file I've got to modify:</p>\n\n<pre><code>#include \"vector.h\"\n\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(){\n    vector_type vi1, vd1, vc1, vc2;\n    char c1;\n    int i1;\n    double d1;\n\n    vi1 = v_create_empty(V_INT);\n    vd1 = v_create_empty(V_DOUBLE);\n    vc1 = v_create_empty(V_CHAR);\n    vc2 = v_create_empty(V_CHAR);\n\n    c1 = 'c'; v_push_back(vc1,(void*)&amp;c1);\n    c1 = 'i'; v_push_back(vc1,(void*)&amp;c1);\n    c1 = 'a'; v_push_back(vc1,(void*)&amp;c1);\n    c1 = 'o'; v_push_back(vc1,(void*)&amp;c1);\n    c1 = 0; v_push_back(vc1,(void*)&amp;c1);\n\n    printf(\"Vector vc1 now contains %d characters (capacity=%1d): %s\\n\",\n           vector_size(vc1),vector_capacity(vc1),vector_string(vc1));\n\n    for ( i1 = 0, c1 = vector_char_at(vc1,i1) ; c1 ; i1++, c1 = vector_char_at(vc1,i1) )\n        v_push_back(vc2,(void*)&amp;c1);\n    for ( i1 = 0, c1 = vector_char_at(vc1,i1) ; c1 ; i1++, c1 = vector_char_at(vc1,i1) )\n        v_push_back(vc2,(void*)&amp;c1);\n    v_insert_n(vc2,iterator_end,1,(void*)&amp;c1); /*** inserting 0 at the end ***/\n\n    printf(\"Vector vc2 now contains %d characters (capacity=%1d): %s\\n\",\n           vector_size(vc2),vector_capacity(vc2),vector_string(vc2));\n\n    c1 = '-'; v_insert_n(vc2,vector_size(vc1)-1,2,(void*)&amp;c1);\n\n    printf(\"Vector vc2 now contains %d characters (capacity=%1d): %s\\n\",\n           vector_size(vc2),vector_capacity(vc2),vector_string(vc2));\n\n    for ( i1 = 0 ; i1 &lt; 10 ; i1++ )\n        v_push_back(vi1,(void*)&amp;i1);\n\n    printf(\"Vector vi1 now contains %d integers: \",vector_size(vi1));\n    for ( i1 = 0 ; i1 &lt; vector_size(vi1) ; i1++ )\n        printf(\" %1d\",vector_int_at(vi1,i1));\n    printf(\"\\n\");\n\n    for ( i1 = 0 ; i1 &lt; vector_size(vi1) ; i1++ ) {\n        c1 = '0' + vector_int_at(vi1,i1); /*** converting decimal number to char ***/\n        v_insert_n(vc2,5+i1,1,(void*)&amp;c1);\n      }\n\n    printf(\"Vector vc2 now contains %d characters (capacity=%1d): %s\\n\",\n           vector_size(vc2),vector_capacity(vc2),vector_string(vc2));\n\n    v_erase_range(vc2,2,3+vector_size(vc1)+vector_size(vi1));\n\n    printf(\"Vector vc2 now contains %d characters (capacity=%1d): %s\\n\",\n           vector_size(vc2),vector_capacity(vc2),vector_string(vc2));\n\n    v_destroy(vc1); v_destroy(vc2);\n\n    for ( i1 = vector_size(vi1)-1 ; i1 &gt;= 0 ; i1-- ) {\n        d1 = 0.5 + (double)(vector_int_at(vi1,i1));\n        v_push_back(vd1,(void*)&amp;d1);\n      }\n    d1 = 3.14159192; /*** approximation of Pi ***/\n    v_insert_n(vd1,5,1,(void*)&amp;d1);\n    v_erase_range(vd1,2,3);\n\n    printf(\"Vector vd1 now contains %d doubles (capacity=%1d): \",\n           vector_size(vd1),vector_capacity(vd1));\n    for ( i1 = 0 ; i1 &lt; vector_size(vd1) ; i1++ )\n        printf(\" %lg\",vector_double_at(vd1,i1));\n    printf(\"\\n\");\n\n    d1 = vector_double_at(vd1,8) + vector_double_at(vd1,9); /*** d1 = 1.5+0.5 = 2.0 ***/\n    v_erase_range(vd1,0,4); /*** erase first 4 elements **/\n    vector_double_at(vd1,0) *= d1; /*** 2*Pi at index 0 ***/\n    v_erase_range(vd1,1,iterator_end); /*** erase all elements but the first ***/\n\n    printf(\"Vector vd1 now contains %d double (capacity=%1d): \",\n           vector_size(vd1),vector_capacity(vd1));\n    for ( i1 = 0 ; i1 &lt; vector_size(vd1) ; i1++ )\n        printf(\" %lg\",vector_double_at(vd1,i1));\n\n/*** TO BE DONE START ***/ //NOT SURE ABOUT HERE\n    d1 = vector_double_at(vd1,8) + vector_double_at(vd1,9) + vector_double_at(vd1,10) + vector_double_at(vd1,11); // d1 = 6.0+0.2+0.08+0.003+0.008 = 6.2838 \n/*** TO BE DONE END ***/\n\n    v_erase_range(vi1,1,9); /*** erase elements 1,...,8 ***/\n    printf(\"Vector vi1 now contains %d integers (capacity=%1d): \",\n           vector_size(vi1),vector_capacity(vi1));\n    for ( i1 = 0 ; i1 &lt; vector_size(vi1) ; i1++ )\n        printf(\" %1d\",vector_int_at(vi1,i1));\n    printf(\"\\n\");\n    v_destroy(vi1);\n\n    exit(0);\n}\n\n\n</code></pre>\n\n<p>This is the header file:</p>\n\n<pre><code>#ifndef vECTOR_h\n#define vECTOR_h\n\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\ntypedef int iterator;\n#define iterator_begin 0\n#define iterator_end -1\n\ntypedef struct vector_struct {\n    size_t e_sz;\n        char e_type;\n\n#define V_INT 1\n#define V_DOUBLE 2\n#define V_CHAR 3\n\n    unsigned no_e;\n    unsigned cur_cap;\n    void* e_array;\n\n}* vector_type;\n\n#define vector_size(v) ((v)-&gt;no_e)\n#define vector_capacity(v) ((v)-&gt;cur_cap)\n\n#define vector_int_at(v,i) (*((int*)v_at(v,i)))\n#define vector_double_at(v,i) (*((double*)v_at(v,i)))\n#define vector_char_at(v,i) (*((char*)v_at(v,i)))\n#define vector_string(v) ((char*)v_at(v,0))\n\n\nextern void* check_a(void*);\nextern void fail(const char*);\nextern vector_type v_create_empty(char);\nextern void v_destroy(vector_type);\nextern void* v_at(vector_type, iterator);\nextern void v_push_back(vector_type,void*);\nextern void v_pop_back(vector_type);\nextern void v_insert_n(vector_type,iterator,unsigned,void*);\nextern void v_erase_range(vector_type,iterator,iterator);\n\n#endif\n\n</code></pre>\n\n<p>Thanks in advance for any possible help!</p>\n"}, {"tags": ["c", "nested-if"], "comments": [{"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 0, "creation_date": 1556699541, "post_id": 55933541, "comment_id": 98519783, "body": "Most compilers have a flag to preprocess only. <code>gcc -E</code> for instance."}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 2, "creation_date": 1556699632, "post_id": 55933541, "comment_id": 98519808, "body": "Related, but not quite duplicates: <a href=\"https://stackoverflow.com/questions/35592063/how-do-you-parse-a-dangling-else\" title=\"how do you parse a dangling else\">stackoverflow.com/questions/35592063/&hellip;</a> and <a href=\"https://stackoverflow.com/questions/40825259/why-is-there-a-dangling-else-scenario-here\" title=\"why is there a dangling else scenario here\">stackoverflow.com/questions/40825259/&hellip;</a>"}, {"owner": {"reputation": 147719, "user_id": 817643, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3ec3655af26685ce29823b04cb6c78d5?s=128&d=identicon&r=PG", "display_name": "StoryTeller - Unslander Monica", "link": "https://stackoverflow.com/users/817643/storyteller-unslander-monica"}, "edited": false, "score": 1, "creation_date": 1556699845, "post_id": 55933541, "comment_id": 98519900, "body": "Also of import if one wishes to address the issue <a href=\"https://stackoverflow.com/questions/154136/why-use-apparently-meaningless-do-while-and-if-else-statements-in-macros\" title=\"why use apparently meaningless do while and if else statements in macros\">stackoverflow.com/questions/154136/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1556721514, "post_id": 55933569, "comment_id": 98528693, "body": "Technically, the replacement is <code>if (b &gt; 0) printf(&quot;Ouch\\n&quot;);;</code>. Furthermore you do not tell the OP how to correct this problem. Removing the trailing <code>;</code> as he may infer will cause another problem, much more difficult to spot."}, {"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "reply_to_user": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1556721658, "post_id": 55933569, "comment_id": 98528769, "body": "@chqrlie oh wow, I can&#39;t believe I missed that. Thanks for the correction, it&#39;s fixed now."}], "tags": [], "owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "is_accepted": false, "score": 7, "last_activity_date": 1556721629, "last_edit_date": 1556721629, "creation_date": 1556699520, "answer_id": 55933569, "question_id": 55933541, "link": "https://stackoverflow.com/questions/55933541/else-without-previous-if-error-when-defining-macro-with-arguments/55933569#55933569", "title": "&#39;else&#39; without previous &#39;if&#39; error when defining macro with arguments", "body": "<p>No, it's turning into this code:</p>\n\n<pre><code>if (a &gt; b)\n        if (b &gt; 0) printf(\"Ouch\\n\");;\n    else\n        printf(\"Arrg!\\n\");\n</code></pre>\n\n<p>Note that there are <strong>two</strong> semicolons after <code>(\"Ouch\\n\")</code>. This is what breaks the code. The <code>else</code> follows that second semicolon which is a null statement, not the <code>if</code> statement before that. The cause of this is that you have a semicolon in your macro definition and another one where you call the macro.</p>\n\n<p>I suggest putting the statement(s) of a function-like macro in its own block, like <a href=\"https://stackoverflow.com/a/55933720/10411602\">this answer</a> suggests. But that's a generall suggestion, in this specific example it's best to not have a macro at all.</p>\n"}, {"comments": [{"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 0, "creation_date": 1556721409, "post_id": 55933571, "comment_id": 98528638, "body": "This advice solves the symptoms, not the real issue. <code>#define foo(x) if (x&gt;0) printf(&quot;Ouch\\n&quot;);</code> is broken in multiple ways, curly braces will not save the OP from failing on <code>foo(b &amp; 1)</code>"}], "tags": [], "owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "is_accepted": false, "score": 2, "last_activity_date": 1556723881, "last_edit_date": 1556723881, "creation_date": 1556699545, "answer_id": 55933571, "question_id": 55933541, "link": "https://stackoverflow.com/questions/55933541/else-without-previous-if-error-when-defining-macro-with-arguments/55933571#55933571", "title": "&#39;else&#39; without previous &#39;if&#39; error when defining macro with arguments", "body": "<p>Its always considered as safe and good practice to use <code>{ }</code> after <code>if</code> and <code>else</code> block to avoid such issues.</p>\n\n<p>Correct one is</p>\n\n<pre><code>if(a&gt;b) { \n    foo(b) ; /* keep inside { } */\n}\nelse {\n    printf(\"Arrg!\\n\");\n}\n</code></pre>\n\n<blockquote>\n  <p>shouldn't the program transfer into the following code when written\n  with braces?</p>\n</blockquote>\n\n<p>No, compiler doesn't put manually curly braces. After Macro replacement <code>gcc -E test.c</code> looks like</p>\n\n<pre><code>int main()\n{\n    int a = 4;\n    int b = -3;\n\n    if(a&gt;b)\n        if (b&gt;0) printf(\"Ouch\\n\"); ; /* extra semicolon causes the issue */\n    else /* there is no if for this else block, previous one terminated by extra ; in above if */\n        printf(\"Arrg!\\n\");\n    printf(\"thanks\\n\");\n\n    return 0;\n}\n</code></pre>\n\n<p>sample code :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define foo(x) if ((x)&gt;0) printf(\"Ouch\\n\") /* if condition was wrong.. instead of x use (x) */\nint main(void)\n{\n    int a = 4;\n    int b = -3;\n    if(a&gt;b)\n    { /* always keep curly braces even though there is only one statement after if */\n        foo(b);\n    }\n    else\n    {\n        printf(\"Arrg!\\n\");\n    }\n    printf(\"thanks\\n\");\n    return 0;\n}\n</code></pre>\n\n<p>Though I would suggest to define MACRO like below</p>\n\n<pre><code>#define foo(x) \\\n    do {                   \\\n        if((x) &gt; 0)         \\\n        printf(\"Ouch\\n\");  \\\n    } while(0)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 848, "user_id": 5941564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1916422a9c9c1aef25c1c3e886725781?s=128&d=identicon&r=PG&f=1", "display_name": "Kyle A", "link": "https://stackoverflow.com/users/5941564/kyle-a"}, "edited": false, "score": 1, "creation_date": 1556711794, "post_id": 55933691, "comment_id": 98524267, "body": "I have run into one or two cases where a functional style macro was the best solution, but it is VERY rare. If you are using a macro, it&#39;s time for a code review."}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "edited": false, "score": 1, "creation_date": 1556721232, "post_id": 55933691, "comment_id": 98528543, "body": "Advice about how to <i>fix</i> the macro does teach the OP about macro traps and pitfalls. Your advice is superior, except for the use of <code>false</code> which may be undefined if the OP does not include <code>&lt;stdbool.h&gt;</code>"}], "tags": [], "owner": {"reputation": 767708, "user_id": 14860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vXG1F.png?s=128&g=1", "display_name": "paxdiablo", "link": "https://stackoverflow.com/users/14860/paxdiablo"}, "is_accepted": false, "score": 4, "last_activity_date": 1556747998, "last_edit_date": 1556747998, "creation_date": 1556700256, "answer_id": 55933691, "question_id": 55933541, "link": "https://stackoverflow.com/questions/55933541/else-without-previous-if-error-when-defining-macro-with-arguments/55933691#55933691", "title": "&#39;else&#39; without previous &#39;if&#39; error when defining macro with arguments", "body": "<p>My advice is to ignore any suggestions on how to <em>fix</em> that macro, the <em>real</em> problem is that you're using the macro <em>at all.</em></p>\n\n<p>There is almost <strong><em>no</em></strong> reason to use macros (which are really just slightly-less-than-dumb text substitutions) in modern C for anything other than conditional compilation.</p>\n\n<ul>\n<li>Value-type macros should generally be replaced with enumerations because they better preserve type information.</li>\n<li>Function type macros should just <em>be</em> functions since modern compilers have very little trouble making them inline if they need it.</li>\n</ul>\n\n<p>Using real functions also solves all those bizarre edge cases like:</p>\n\n<pre><code>#define calc(x) x * x\n:\nint a = 7;\nint b = calc(a + 1);   // a + (1 * a) + 1, NOT (a + 1) * (a + 1)\n</code></pre>\n\n<p>If you want that to work reliably, you need the macro to be something like <code>((x) * (x))</code>, but even <em>that</em> will fail with more complexity, such as <code>b = calc(a++)</code>.</p>\n\n<hr>\n\n<p>So, in short, what you <em>should</em> have in your code is:</p>\n\n<pre><code>void foo(int x) {\n    if (x &gt; 0)\n        printf(\"Ouch\\n\");\n}\n</code></pre>\n\n<hr>\n\n<p>If you <em>do</em> need to be able to use function macros <em>anywhere</em> (naked statement, statement within a braced if-block, statement within an unbraced if-block, braced and unbraced while statements and so on), you have to resort to bizarre macros such as (making sure to <code>#include &lt;stdbool.h&gt;</code> to get access to <code>false</code>, of course):</p>\n\n<pre><code>#define XYZZY(s) do {plugh(s);} while (false)\n</code></pre>\n\n<p>However, I would <em>strongly</em> suggest just making them functions in the first place.</p>\n"}, {"tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": true, "score": 5, "last_activity_date": 1556711867, "last_edit_date": 1556711867, "creation_date": 1556700377, "answer_id": 55933720, "question_id": 55933541, "link": "https://stackoverflow.com/questions/55933541/else-without-previous-if-error-when-defining-macro-with-arguments/55933720#55933720", "title": "&#39;else&#39; without previous &#39;if&#39; error when defining macro with arguments", "body": "<p>The problem is your macro expands to </p>\n\n<pre><code>if(a&gt;b)\n    if (b&gt;0) printf(\"Ouch\\n\"); ; \nelse \n    printf(\"Arrg!\\n\");\n//...\n</code></pre>\n\n<p>and that won't work with the <code>else</code> because of the extra <code>;</code>. (Also you could have parenthesesized the <code>x</code> argument (<code>#define foo(x) if ((x)&gt;0) printf(\"Ouch\\n\")</code>)).</p>\n\n<p>If you lost the <code>;</code> from the macro, you'd get a different parse: the <code>else</code> would match up with the inner <code>if</code> like so:</p>\n\n<pre><code>if(a&gt;b){ /*braces inserted to show the interpretation*/\n    if (b&gt;0) printf(\"Ouch\\n\");\n    else printf(\"Arrg!\\n\");\n}\n</code></pre>\n\n<p>and while you could solve the problem by making the macro with a dangling <code>else</code></p>\n\n<pre><code>#define foo(x) if ((x)&gt;0) printf(\"Ouch\\n\"); else\n//a ; after the macro else would complete the `else` with an empty branch\n</code></pre>\n\n<p>using this, especially inside other <code>if</code>-<code>else</code> triggers warnings in compilers like <code>gcc</code>/<code>clang</code> when compiling <code>-Wall</code> and similar options, so the best way to deal with is with the idiomatic</p>\n\n<pre><code>#define macro() do{/*macro_body*/}while(0)\n</code></pre>\n\n<p>In your case</p>\n\n<pre><code>#define foo(x) do{ if ((x)&gt;0) printf(\"Ouch\\n\"); }while(0)\n</code></pre>\n\n<p>Some people like to always use compound statements (surrounded by <code>{</code> <code>}</code>) with <code>if</code>/<code>else</code> statements, and while that would also solve the issue, I feel if you make function-like macros for other people to use, it's best not to force a style on them.</p>\n"}], "owner": {"reputation": 1472, "user_id": 7415247, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/vUnvj.jpg?s=128&g=1", "display_name": "Huzo", "link": "https://stackoverflow.com/users/7415247/huzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 0, "accepted_answer_id": 55933720, "answer_count": 4, "score": 3, "last_activity_date": 1556747998, "creation_date": 1556699349, "question_id": 55933541, "link": "https://stackoverflow.com/questions/55933541/else-without-previous-if-error-when-defining-macro-with-arguments", "title": "&#39;else&#39; without previous &#39;if&#39; error when defining macro with arguments", "body": "<p>Consider the C code below.   </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define foo(x) if (x&gt;0) printf(\"Ouch\\n\");\n\nint main()\n{\n    int a = 4;\n    int b = -3;\n\n    if(a&gt;b)\n        foo(b) ;\n    else\n        printf(\"Arrg!\\n\");\n    printf(\"thanks\\n\");\n\n    return 0;\n}\n</code></pre>\n\n<p>When the program is run, I get an error saying <code>error: \u2018else\u2019 without a previous \u2018if\u2019</code>. When we replace <code>foo(b)</code> with <code>if (b&gt;0) printf(\"Ouch\\n\")</code> according to the macro definition, shouldn't the program transfer into the following code when written with braces?  </p>\n\n<pre><code>if(a&gt;b){\n    if(x&gt;0){\n        printf(\"Ouch\\n\");\n    }\n}\nelse{\n    printf(\"Arrh!\\n\");\n}\nprintf(\"thanks\\n\");    \n</code></pre>\n\n<p>I don't see why the compiler complains. What does the program actually get transferred to?   </p>\n\n<p>Thanks</p>\n"}, {"tags": ["c", "swift", "ffi"], "comments": [{"owner": {"reputation": 80047, "user_id": 169346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645dbb4f7ba1ff9d7ff2de02f68fbe9c?s=128&d=identicon&r=PG", "display_name": "JeremyP", "link": "https://stackoverflow.com/users/169346/jeremyp"}, "edited": false, "score": 0, "creation_date": 1556701296, "post_id": 55933537, "comment_id": 98520417, "body": "Is the string generated dynamically by the callback or can it be pre-generated i.e. does the callback always return the same string?"}, {"owner": {"reputation": 340, "user_id": 1087576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc0840f7fd22073389276d85120e0884?s=128&d=identicon&r=PG", "display_name": "Tom K", "link": "https://stackoverflow.com/users/1087576/tom-k"}, "reply_to_user": {"reputation": 80047, "user_id": 169346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645dbb4f7ba1ff9d7ff2de02f68fbe9c?s=128&d=identicon&r=PG", "display_name": "JeremyP", "link": "https://stackoverflow.com/users/169346/jeremyp"}, "edited": false, "score": 0, "creation_date": 1556701533, "post_id": 55933537, "comment_id": 98520483, "body": "It will be dynamically created. My intention is to stuff the object that owns the dynamically-allocated memory in an array or map to keep it alive until I receive the corresponding free."}], "answers": [{"comments": [{"owner": {"reputation": 80047, "user_id": 169346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645dbb4f7ba1ff9d7ff2de02f68fbe9c?s=128&d=identicon&r=PG", "display_name": "JeremyP", "link": "https://stackoverflow.com/users/169346/jeremyp"}, "edited": false, "score": 0, "creation_date": 1556703201, "post_id": 55933991, "comment_id": 98521055, "body": "Or deallocate with <code>cStringPtr?.deallocate()</code> to be a bit more Swifty."}, {"owner": {"reputation": 486140, "user_id": 1187415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/LpTRB.png?s=128&g=1", "display_name": "Martin R", "link": "https://stackoverflow.com/users/1187415/martin-r"}, "reply_to_user": {"reputation": 80047, "user_id": 169346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645dbb4f7ba1ff9d7ff2de02f68fbe9c?s=128&d=identicon&r=PG", "display_name": "JeremyP", "link": "https://stackoverflow.com/users/169346/jeremyp"}, "edited": false, "score": 1, "creation_date": 1556703343, "post_id": 55933991, "comment_id": 98521119, "body": "@JeremyP: No. <code>.deallocate()</code> happens to be equivalent to <code>free()</code> (on Apple platforms) but that is not guaranteed. See the discussion at <a href=\"https://forums.swift.org/t/unsafemutablepointer-allocation-compatibility-with-c-malloc-free/21713\" rel=\"nofollow noreferrer\">forums.swift.org/t/&hellip;</a>"}, {"owner": {"reputation": 80047, "user_id": 169346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645dbb4f7ba1ff9d7ff2de02f68fbe9c?s=128&d=identicon&r=PG", "display_name": "JeremyP", "link": "https://stackoverflow.com/users/169346/jeremyp"}, "edited": false, "score": 1, "creation_date": 1556703740, "post_id": 55933991, "comment_id": 98521272, "body": "You learn something new every day. I was going to delete my comment, but I think we should both leave them in case anybody else comes along with the same idea."}, {"owner": {"reputation": 340, "user_id": 1087576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc0840f7fd22073389276d85120e0884?s=128&d=identicon&r=PG", "display_name": "Tom K", "link": "https://stackoverflow.com/users/1087576/tom-k"}, "edited": false, "score": 1, "creation_date": 1556705623, "post_id": 55933991, "comment_id": 98521941, "body": "Thanks all! <code>strdup</code>/<code>free</code> are precisely what I was looking for. It didn&#39;t cross my mind at all to use libc, and all of the search results I found concerned providing a string as an argument to a function, where the bridging and memory management is much simpler."}], "tags": [], "owner": {"reputation": 486140, "user_id": 1187415, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/LpTRB.png?s=128&g=1", "display_name": "Martin R", "link": "https://stackoverflow.com/users/1187415/martin-r"}, "is_accepted": true, "score": 4, "last_activity_date": 1556702007, "creation_date": 1556702007, "answer_id": 55933991, "question_id": 55933537, "link": "https://stackoverflow.com/questions/55933537/create-a-string-buffer-in-swift-for-c-to-consume-and-free-later/55933991#55933991", "title": "Create a String buffer in Swift for C to consume and free later", "body": "<p>Two possible options: </p>\n\n<pre><code>let swiftString = \"Hello world\"\nswiftString.withCString { cStringPtr in\n    // use `cStringPtr` ...\n\n}\n</code></pre>\n\n<p>calls the closure with a pointer a C string representation of the Swift string (UTF-8 encoded). That pointer is only valid during the execution of the closure.</p>\n\n<p>For a longer lifetime, you can do</p>\n\n<pre><code>let swiftString = \"Hello world\"\nlet cStringPtr = strdup(swiftString)\n// use `cStringPtr` ...\n</code></pre>\n\n<p>which allocates a new C String from the given Swift string, and release that memory later with</p>\n\n<pre><code>free(cStringPtr)\n</code></pre>\n"}], "owner": {"reputation": 340, "user_id": 1087576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc0840f7fd22073389276d85120e0884?s=128&d=identicon&r=PG", "display_name": "Tom K", "link": "https://stackoverflow.com/users/1087576/tom-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 55933991, "answer_count": 1, "score": 1, "last_activity_date": 1556702007, "creation_date": 1556699340, "question_id": 55933537, "link": "https://stackoverflow.com/questions/55933537/create-a-string-buffer-in-swift-for-c-to-consume-and-free-later", "title": "Create a String buffer in Swift for C to consume and free later", "body": "<p><strong>Quick form of the question for those who know Rust:</strong> is there a Swift 5 equivalent of <code>std::ffi::CString</code> that can own a String and turn it into a <code>char*</code> like <a href=\"https://doc.rust-lang.org/std/ffi/struct.CString.html#method.into_raw\" rel=\"nofollow noreferrer\">into_raw</a> and later free/drop it using something like <a href=\"https://doc.rust-lang.org/std/ffi/struct.CString.html#method.from_raw\" rel=\"nofollow noreferrer\">from_raw</a>?</p>\n\n<p><strong>Longer version:</strong></p>\n\n<p>I have a C API that I am consuming in Swift. I have to supply a callback function, which I am supplying as a closure argument, and that closure must return a null-terminated string as a <code>const char *</code>\u2014in Swift this is typed as <code>UnsafePointer&lt;Int8&gt;?</code>.</p>\n\n<p>Clearly somebody has to be responsible for that memory and when it will be freed. In this case I would like to say that it is heap-allocated, and Swift is responsible for it and it will keep that <code>const char *</code> alive until the C interface finishes with it and calls some sort of <code>free()</code> function.</p>\n\n<p>What is the least painful way to allocate some memory in Swift initialised with a UTF-8 string, provide a <code>const char *</code> to C, then free it later when instructed?</p>\n"}, {"tags": ["c", "pointers", "casting", "void"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1556698535, "post_id": 55933284, "comment_id": 98519453, "body": "Is another parameter an option, carrying the information on what type to assume? This is by the way an example why the temptingly &quot;versatile&quot; void pointers usually turn out to be a trap... What you are trying to do seems to be an &quot;overloaded&quot; function, which is an OOP concept, i.e. C++ would be the language which would provide that to you. Is using C++ an option?"}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1556698724, "post_id": 55933284, "comment_id": 98519506, "body": "The binary representation of an <code>int</code>, <code>float</code> and <code>double</code> are different, so when you do <code>(double*)v</code> you say to the compiler <i>treat this as a double</i> and that&#39;s exactly what it does. If you are not passing doubles, you end up with horrible errors."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1556698784, "post_id": 55933284, "comment_id": 98519525, "body": "You can sort of do this by making <code>foo</code> a macro, and <a href=\"https://stackoverflow.com/questions/40096584/c11-generic-usage\">using the <code>_Generic</code> keyword</a>."}, {"owner": {"reputation": 59, "user_id": 9851591, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "spx305", "link": "https://stackoverflow.com/users/9851591/spx305"}, "reply_to_user": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1556698800, "post_id": 55933284, "comment_id": 98519530, "body": "@Yunnosch No, unfortunately it&#39;s not an option... maybe the best option is to take a double pointer as parameter and let who calls the function casting its array to double..."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 1, "creation_date": 1556698808, "post_id": 55933284, "comment_id": 98519535, "body": "One way would be to pass the type of array as a third argument and the function would then decide how to cast to elements depending on the type."}], "answers": [{"tags": [], "owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "is_accepted": false, "score": 0, "last_activity_date": 1556700136, "last_edit_date": 1556700136, "creation_date": 1556699238, "answer_id": 55933505, "question_id": 55933284, "link": "https://stackoverflow.com/questions/55933284/cast-void-pointer-to-double-without-knowing-its-type-in-c/55933505#55933505", "title": "Cast void pointer to double without knowing its type in C", "body": "<blockquote>\n  <p>can I correctly cast the void pointer to a double one only knowing that it can be an array of integers or floats or doubles?</p>\n</blockquote>\n\n<p>No, you cannot. You need to pass the type information somehow.</p>\n\n<blockquote>\n  <p>And is it necessary to have the length of the array or I can calculate it somehow?</p>\n</blockquote>\n\n<p>It's necessary to pass the length.</p>\n\n<hr>\n\n<p>You can \"hide\" the information inside a struct</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nenum etype { INTEGER, FLOAT, DOUBLE };\nstruct data {\n    void *values;\n    size_t n;\n    enum etype type;\n};\n\nvoid foo(struct data *x) {\n    int *xd = x-&gt;values;\n    float *xf = x-&gt;values;\n    double *xg = x-&gt;values;\n    for (int k = 0; k &lt; x-&gt;n; k++) {\n        switch (x-&gt;type) {\n            default: printf(\"%g \", xg[k]); break;\n            case FLOAT: printf(\"%f \", xf[k]); break;\n            case INTEGER: printf(\"%d \", xd[k]); break;\n        }\n    }\n    puts(\"\");\n}\n\nint main(void) {\n    struct data x;\n\n    x.values = malloc(4 * sizeof(int));\n    ((int*)(x.values))[0] = 42;\n    ((int*)(x.values))[1] = -1;\n    ((int*)(x.values))[2] = 0;\n    ((int*)(x.values))[3] = 999;\n    x.n = 4;\n    x.type = INTEGER;\n    foo(&amp;x);\n\n    x.values = calloc(4, sizeof(float));\n    x.type = FLOAT;\n    float tmp = 3.14159;\n    memcpy(((float*)(x.values))+1, &amp;tmp, sizeof (float));\n    foo(&amp;x);\n    free(x.values);\n\n    x.values = calloc(4, sizeof(double));\n    x.type = DOUBLE;\n    ((double*)(x.values))[2] = 2.7182818;\n    foo(&amp;x);\n    free(x.values);\n}\n</code></pre>\n\n<p>See <a href=\"https://ideone.com/DTMMbW\" rel=\"nofollow noreferrer\">code running on ideone</a></p>\n"}], "owner": {"reputation": 59, "user_id": 9851591, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "spx305", "link": "https://stackoverflow.com/users/9851591/spx305"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 426, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556700136, "creation_date": 1556698146, "question_id": 55933284, "link": "https://stackoverflow.com/questions/55933284/cast-void-pointer-to-double-without-knowing-its-type-in-c", "title": "Cast void pointer to double without knowing its type in C", "body": "<p>I need to write a function which takes as parameters a void pointer (representing an array) and an integer which represents the length of the array. In the function, I need to cast this void pointer into a double one. The problem is that the void pointer can represent an array of integers or floats or doubles.\nSo the following is obviously not working in case the void pointer represents an array of integers or floats:</p>\n\n<pre><code>void foo(void *v,int n){\n    double *values;\n\n    values=(double*)v;\n    for(i=0;i&lt;n;i++)\n        printf(\"%f\\n\",values[i]);\n}\n</code></pre>\n\n<p>so this will print the correct output:</p>\n\n<pre><code>foo((double[]){1,2,3,4},4);\n</code></pre>\n\n<p>and this will print a wrong output:</p>\n\n<pre><code>foo((int[]){1,2,3,4},4);\nfoo((float[]){1,2,3,4},4);\n</code></pre>\n\n<p>So... can I correctly cast the void pointer to a double one only knowing that it can be an array of integers or floats or doubles? And is it necessary to have the length of the array or I can calculate it somehow?\nP.s. without using callbacks</p>\n"}, {"tags": ["c", "udp", "client-server", "send"], "comments": [{"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 2, "creation_date": 1556697344, "post_id": 55933125, "comment_id": 98519105, "body": "This <code>strcat(data_send,&amp;symbol);</code> does not what you might expect, but invoke undefined behaviour instead. The <code>str*()</code> family of functions works on <code>0</code>-terminated c-strings, which in fact are <code>char</code>-arrays carrying at least one <code>&#39;\\0&#39;</code> value. <code>symbol</code> is not a c-string."}, {"owner": {"reputation": 115, "user_id": 10597842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHQSK.jpg?s=128&g=1", "display_name": "Adarsh D", "link": "https://stackoverflow.com/users/10597842/adarsh-d"}, "reply_to_user": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1556697594, "post_id": 55933125, "comment_id": 98519181, "body": "reaplaced it with an fread(), now it&#39;s fine thank you"}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 1, "creation_date": 1556703259, "post_id": 55933125, "comment_id": 98521079, "body": "<code>fprintf(fp,&quot;%s&quot;,data_received);</code> expects <code>data_received</code> to be a null-terminated string, but <code>data_received</code> is just a pointer to a chunk of received bytes. Use <code>fwrite(data_received, 1, received_len, fp);</code> instead. (You will first need to declare <code>received_len</code> and assign it the value returned by <code>recvfrom()</code>.)"}], "owner": {"reputation": 115, "user_id": 10597842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHQSK.jpg?s=128&g=1", "display_name": "Adarsh D", "link": "https://stackoverflow.com/users/10597842/adarsh-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556697027, "creation_date": 1556697027, "question_id": 55933125, "link": "https://stackoverflow.com/questions/55933125/file-send-from-sever-to-client-corrupted-in-c", "title": "File send from sever to client corrupted in c", "body": "<p>I have this UDP client-server model where the server sends a file to the client. everything works fine except the file made at client side have some junk data. I don't know why this is happening.</p>\n\n<p><strong>server.c</strong></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;sys/socket.h&gt; //for sock()\n#include &lt;string.h&gt;//for using memset\n#include &lt;arpa/inet.h&gt;// for inet_addr()\n#include &lt;unistd.h&gt;//for using write() function\nint main(){\n\n\n    int sock=0;\n    char data_send[1024],file_name[1024],symbol;\n    struct sockaddr_in ServerIp;\n    struct sockaddr_storage ClientIp;\n\n    //AF_INET : The address family value for IPv4 addresses\n    // SOCK_DGRAM argument confirms that we are using UDP as a protocol in this communication\n    sock = socket(AF_INET, SOCK_DGRAM, 0);\n\n    socklen_t addr_len;\n    addr_len = sizeof(ClientIp);\n    //addr_len to store the length of client address\n\n\n    //https://stackoverflow.com/questions/13327155/memset-definition-and-use\n     memset(&amp;ServerIp,'0',sizeof(ServerIp) );\n\n\n     ServerIp.sin_family = AF_INET;\n     ServerIp.sin_port = htons(1234);\n     ServerIp.sin_addr . s_addr = inet_addr(\"127.0.0.1\");\n\n\n     if(   bind( sock,(struct sockaddr* )&amp;ServerIp, sizeof(ServerIp)) == -1 )\n        printf(\"\\n Socket binding failed \\n\");\n     else\n        printf(\"\\n Server Started !!\\n \");\n\n\n    // https://linux.die.net/man/2/recvfrom\n    recvfrom( sock,file_name, sizeof(file_name) ,0, (struct sockaddr *)&amp;ClientIp,&amp;addr_len );\n    printf(\"\\n filename received from client: %s \\n\",file_name);\n\n    FILE *fp = fopen(\"test.txt\", \"r\");\n    if(fp == NULL){\n        printf(\"cannot open file\");\n\n    }\n    else{\n        while((symbol = getc(fp)) != EOF) {\n            strcat(data_send,&amp;symbol);\n        }\n    }\n\n    fclose(fp);\n\n    if( (sendto(sock,data_send, sizeof(data_send) ,0, (struct sockaddr *)&amp;ClientIp, addr_len)) ==-1 )\n        printf(\"sending failed\\n\");\n\n    //sendto(sock,data_send,sizeof(data_send),0, (struct sockaddr *)&amp;ClientIp, sizeof(ClientIp) );\n    printf(\" Message send is : %s \\n\",data_send);\n\n    return 0;\n\n}\n</code></pre>\n\n<p><strong>client.c</strong></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;sys/socket.h&gt; //for sock()\n#include &lt;string.h&gt;//for using memset\n#include &lt;arpa/inet.h&gt;// for inet_addr()\n#include &lt;unistd.h&gt;//for using write() function\n#include &lt;netinet/in.h&gt;\nint main(){\n\n\n    int sock=0;\n    char data_send[1024],data_received[1024];\n\n    struct sockaddr_in ServerIp;\n\n\n    if( (sock = socket(AF_INET, SOCK_DGRAM, 0)) &lt; 0 )\n        printf(\"\\n Socket creation failed \\n\");\n\n    memset(&amp;ServerIp,'0',sizeof(ServerIp) );\n\n\n    ServerIp.sin_family = AF_INET;\n    ServerIp.sin_port = htons(1234);\n    ServerIp.sin_addr . s_addr = inet_addr(\"127.0.0.1\");\n\n    printf(\" Enter the file name to be send to server: \\n&gt;&gt; \");\n    fgets(data_send, sizeof(data_send), stdin ); \n\n    sendto(sock,data_send,sizeof(data_send),0, (struct sockaddr *)&amp;ServerIp, sizeof(ServerIp) );\n    printf(\" Message send to server is : %s \\n\",data_send);\n\n\n    recvfrom(sock,data_received,sizeof(data_received) ,0,NULL,NULL );\n\n    FILE *fp = fopen(\"response.txt\", \"w\");\n    if (fp == NULL){\n        printf(\"Error opening file!\\n\");\n    }\n    fprintf(fp,\"%s\",data_received);\n\n\n    printf(\"\\n Data received from server: %s \\n\",data_received);\n    return 0;\n\n}\n</code></pre>\n\n<p>if the \"test.txt\" file in server contain something like this </p>\n\n<pre><code>1. The server starts and waits for filename.\n2. The client sends a filename.\n3. The server receives filename.\n   If file is present, \n</code></pre>\n\n<p>Then the output file \"response.txt\" made by the client will have a &lt;0x10> between all characters of the output produced. but if I print that as output then it will be fine.</p>\n\n<p>I cannot paste it here because if I paste it here then it will look fine</p>\n"}, {"tags": ["c", "enums"], "comments": [{"owner": {"reputation": 2389, "user_id": 5151909, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/677946faa239045e9bb743ab5f9f8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "galah92", "link": "https://stackoverflow.com/users/5151909/galah92"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1556696511, "post_id": 55932786, "comment_id": 98518851, "body": "@user3386109 enum values (for errors) are unique, of course."}], "answers": [{"comments": [{"owner": {"reputation": 2389, "user_id": 5151909, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/677946faa239045e9bb743ab5f9f8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "galah92", "link": "https://stackoverflow.com/users/5151909/galah92"}, "edited": false, "score": 0, "creation_date": 1556697325, "post_id": 55933140, "comment_id": 98519096, "body": "Thanks. I should&#39;ve specify it probably, but I can&#39;t save all these error strings as part of the output binary (embedded constraints). That&#39;s why I&#39;m after &quot;static analysis&quot; solution."}, {"owner": {"reputation": 190, "user_id": 4016231, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aviv Goll", "link": "https://stackoverflow.com/users/4016231/aviv-goll"}, "reply_to_user": {"reputation": 2389, "user_id": 5151909, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/677946faa239045e9bb743ab5f9f8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "galah92", "link": "https://stackoverflow.com/users/5151909/galah92"}, "edited": false, "score": 1, "creation_date": 1556697488, "post_id": 55933140, "comment_id": 98519152, "body": "You can compile the static mapping separately on a PC and #ifdef it out on your embedded target.."}, {"owner": {"reputation": 2389, "user_id": 5151909, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/677946faa239045e9bb743ab5f9f8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "galah92", "link": "https://stackoverflow.com/users/5151909/galah92"}, "edited": false, "score": 0, "creation_date": 1556697769, "post_id": 55933140, "comment_id": 98519230, "body": "And then how will I be able to analyze the <code>backtrace</code> of embedded runs? I can&#39;t always reproduce the same run for embedded system on PC."}, {"owner": {"reputation": 190, "user_id": 4016231, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aviv Goll", "link": "https://stackoverflow.com/users/4016231/aviv-goll"}, "reply_to_user": {"reputation": 2389, "user_id": 5151909, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/677946faa239045e9bb743ab5f9f8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "galah92", "link": "https://stackoverflow.com/users/5151909/galah92"}, "edited": false, "score": 0, "creation_date": 1556697962, "post_id": 55933140, "comment_id": 98519284, "body": "I meant share the error codes between a PC C application that only analizes the backtrace and your embedded application. One compilation would generate the embedded target with some error code enum, and one compilation will create a PC application that analizes backtrace. The main thing is that the errors are defined only once between the applications."}, {"owner": {"reputation": 190, "user_id": 4016231, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aviv Goll", "link": "https://stackoverflow.com/users/4016231/aviv-goll"}, "reply_to_user": {"reputation": 2389, "user_id": 5151909, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/677946faa239045e9bb743ab5f9f8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "galah92", "link": "https://stackoverflow.com/users/5151909/galah92"}, "edited": false, "score": 0, "creation_date": 1556698304, "post_id": 55933140, "comment_id": 98519396, "body": "The PC C program may also only generate a dictionary for other tools of your choice, written in python/perl/ruby/..."}, {"owner": {"reputation": 2389, "user_id": 5151909, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/677946faa239045e9bb743ab5f9f8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "galah92", "link": "https://stackoverflow.com/users/5151909/galah92"}, "edited": false, "score": 0, "creation_date": 1556699701, "post_id": 55933140, "comment_id": 98519836, "body": "To my understanding, in order to create that dictionary I&#39;ll need to call a macro for every enum definition, which is what I&#39;m trying to save / automate."}], "tags": [], "owner": {"reputation": 190, "user_id": 4016231, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aviv Goll", "link": "https://stackoverflow.com/users/4016231/aviv-goll"}, "is_accepted": false, "score": 0, "last_activity_date": 1556697365, "last_edit_date": 1556697365, "creation_date": 1556697130, "answer_id": 55933140, "question_id": 55932786, "link": "https://stackoverflow.com/questions/55932786/best-way-to-extract-all-enums-from-c-project/55933140#55933140", "title": "Best way to extract all enums from C project", "body": "<p>Not sure how you log the errors, but how about:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef enum\n{\n  E_SUCCESS = 0,\n  E_FAIL,\n...\n} error_t;\n\ntypedef struct\n{\n  error_t code;\n  char * error_name;\n} backtrace_entry_t;\n\nbacktrace_entry_t backtrace[..];\n\n\n#define FUNC_EXIT(error_code__) \\\ndo { \\\n  backtrace[func_id].code = (error_code__); \\\n  backtrace[func_id].error_name = #error_code__; \\\n} while (0)\n</code></pre>\n\n<p>Then, when you call <code>FUNC_EXIT(E_SUCCESS);</code>, you'll get for the backtrace for the function to be: <code>{.code = 0, .error_name = \"E_SUCCESS\"}</code></p>\n\n<p>The problem is, you can't get the right name if you call <code>FUNC_EXIT(var);</code>, where <code>var</code> is some local variable.</p>\n\n<hr>\n\n<p>Another option, although still not an automagical one:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef enum\n{\n  E_SUCCESS = 0,\n  E_FAIL,\n...\n  NOF_ERROR_CODES\n} error_t;\n\n#define MAP_E_CODE_TO_NAME(error_code__)  [error_code__] = #error_code__\n\nconst char * error_to_name_mapping[NOF_ERROR_CODES] = {\n  MAP_E_CODE_TO_NAME(E_SUCCESS),\n  MAP_E_CODE_TO_NAME(E_FAIL),\n...\n};\n</code></pre>\n\n<p>Will give a <code>const char *</code> array with <code>{\"E_SUCCESS\", \"E_FAIL\", ...}</code>, which you can use like this: </p>\n\n<pre class=\"lang-c prettyprint-override\"><code>printf(\"The name of error code %d is '%s'\", error, error_to_name_mapping[error]);\n</code></pre>\n\n<p>The problem here is that you have to have positive value to errors with increasing values.</p>\n"}], "owner": {"reputation": 2389, "user_id": 5151909, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/677946faa239045e9bb743ab5f9f8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "galah92", "link": "https://stackoverflow.com/users/5151909/galah92"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556697365, "creation_date": 1556694834, "question_id": 55932786, "link": "https://stackoverflow.com/questions/55932786/best-way-to-extract-all-enums-from-c-project", "title": "Best way to extract all enums from C project", "body": "<p>I'm writing my own enums-based backtrace. Basically each function call will append it's error to a pre-defined stack which will eventually include all errors across all function calls.</p>\n\n<p>I want to create an efficient way to parse it. In the end I got <code>int backtrace[]</code> with enum values from all over my codebase, and I'd like to relate each enum value to it's name.</p>\n\n<p>This should of course be done post-failure (not at runtime), so what I'm missing is a way, maybe as a part of the compilation step, to dump all my enums and there values to a file. Then i can write a script that parse the errors.</p>\n\n<p>Is there an easy (cross-platform) static tool that does that?</p>\n"}, {"tags": ["c"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "AlexGlebe"}, "is_accepted": false, "score": 0, "last_activity_date": 1556703446, "creation_date": 1556697267, "answer_id": 55934284, "question_id": 55934283, "link": "https://stackoverflow.com/questions/55934283/about-arrays-and-functions-in-c/55934284#55934284", "title": "About Arrays and functions in C", "body": "<p>See the standard.</p>\n\n<p>On entry to the function, the size expressions of each variably modified parameter are\nevaluated and the value of each argument expression is converted to the type of the\ncorresponding parameter as if by assignment. (Array expressions and function\ndesignators as arguments were converted to pointers before the call.)</p>\n"}], "migrated_from": {"other_site": {"aliases": ["http://hashcode.ru", "http://stackoverflow.ru"], "markdown_extensions": ["Prettify"], "launch_date": 1449851367, "open_beta_date": 1427774754, "closed_beta_date": 1427436000, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/ru/Img/apple-touch-icon@2.png", "favicon_url": "https://cdn.sstatic.net/Sites/ru/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/ru/Img/apple-touch-icon.png", "audience": "\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0441\u0442\u043e\u0432", "site_url": "https://ru.stackoverflow.com", "api_site_parameter": "ru.stackoverflow", "logo_url": "https://cdn.sstatic.net/Sites/ru/Img/logo.png", "name": "Stack Overflow \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c", "site_type": "main_site"}, "on_date": 1556703469, "question_id": 976829}, "owner": {"user_type": "does_not_exist", "display_name": "user336603"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "closed_date": 1556703604, "answer_count": 1, "score": -1, "last_activity_date": 1556703729, "creation_date": 1556693383, "question_id": 55934283, "link": "https://stackoverflow.com/questions/55934283/about-arrays-and-functions-in-c", "closed_reason": "Duplicate", "title": "About Arrays and functions in C", "body": "<p>In C, if you pass an array as an argument to a function, what actually gets passed? And Why?</p>\n"}, {"tags": ["c", "pointers"], "comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1556691966, "post_id": 55932381, "comment_id": 98517688, "body": "One issue I see is that the assignment of nodes, e.g. <code>temp-&gt;data = temp-&gt;l-&gt;data;</code> (same for right) doesn&#39;t do anything with the node, it just assigns values. This is sometimes referred to as a &quot;dirty-delete&quot; because there is no actual deletion of removed nodes from the tree."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1556692647, "post_id": 55932381, "comment_id": 98517840, "body": "And how do you call the function"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10898753, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-J8z_MEdQ7RA/AAAAAAAAAAI/AAAAAAAAAcQ/XIKjHyOJvBc/photo.jpg?sz=128", "display_name": "Raghav Thakkar", "link": "https://stackoverflow.com/users/10898753/raghav-thakkar"}, "edited": false, "score": 0, "creation_date": 1556694457, "post_id": 55932468, "comment_id": 98518306, "body": "oh! I got it.. Thank you so much!!"}], "tags": [], "owner": {"reputation": 190, "user_id": 4016231, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aviv Goll", "link": "https://stackoverflow.com/users/4016231/aviv-goll"}, "is_accepted": false, "score": 2, "last_activity_date": 1556693896, "last_edit_date": 1556693896, "creation_date": 1556692480, "answer_id": 55932468, "question_id": 55932381, "link": "https://stackoverflow.com/questions/55932381/null-assignment-to-a-structure-pointer-is-not-working-through-function-what-to/55932468#55932468", "title": "NULL assignment to a structure pointer is not working through function. What to do?", "body": "<p><code>temp = 0;</code> doesn't delete the leaf from the tree, just nulls a local variable.\nYou want to null some node's <code>l</code> or <code>r</code> in order to remove a node from the tree.\nTry keeping the parent as well and once temp points to the leaf, nullify temp's parent <code>r</code> or <code>l</code>.</p>\n\n<p>Same goes for <code>t = 0;</code> later on.</p>\n\n<p>Note <a href=\"https://stackoverflow.com/questions/55932381/null-assignment-to-a-structure-pointer-is-not-working-through-function-what-to#comment98517688_55932381\">David's comment</a> about first releasing this memory..</p>\n\n<p>For example (assuming not deleting the root):</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>...\n        if(data &lt; temp-&gt;data)\n        {\n            i=2*i;\n            parent = temp;\n            temp = temp-&gt;l;\n        }\n        else if(data &gt; temp-&gt;data)\n        {\n            i = (2*i)+1;\n            parent = temp;\n            temp = temp-&gt;r ;\n        }\n        else\n        {\n            printf(\"%d\\n\",i);\n            break;\n        }\n...\n    if(temp-&gt;l == 0 &amp;&amp; temp-&gt;r == 0)\n    {\n        if (parent-&gt;l == temp)\n             parent-&gt;l = 0;\n        else\n             parent-&gt;r = 0;\n        // Free temp if needed\n        return root;\n    }\n...\n</code></pre>\n\n<p>Also note that you have:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>    else if(temp-&gt;l == 0)\n    {\n        temp-&gt;data = temp-&gt;l-&gt;data;\n</code></pre>\n\n<p>Which is a dereference of a null pointer (<code>temp-&gt;l</code> is NULL), and the same thing for <code>temp-&gt;r == 0</code> case.</p>\n\n<p>Then you have</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>         temp-&gt;l = 0;\n</code></pre>\n\n<p>but you're already in a <code>temp-&gt;l == 0</code> case, so I don't think this is what you meant.</p>\n"}], "owner": {"reputation": 3, "user_id": 10898753, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-J8z_MEdQ7RA/AAAAAAAAAAI/AAAAAAAAAcQ/XIKjHyOJvBc/photo.jpg?sz=128", "display_name": "Raghav Thakkar", "link": "https://stackoverflow.com/users/10898753/raghav-thakkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556693896, "creation_date": 1556691692, "question_id": 55932381, "link": "https://stackoverflow.com/questions/55932381/null-assignment-to-a-structure-pointer-is-not-working-through-function-what-to", "title": "NULL assignment to a structure pointer is not working through function. What to do?", "body": "<p>I am trying to implement BST deletion. According to algorithm, we can delete a leaf directly. Now I'm assigning NULL to leaf directly and still this node remains as it is. </p>\n\n<p>In the test case I gave tried to delete leaf and it is not working.</p>\n\n<p>Please help!</p>\n\n<pre><code>struct node * delet(long data, struct node* root)\n{\n    int i=1;\n    struct node *temp = root,*t;\n\n    while(temp != 0)\n    {\n        if(data &lt; temp-&gt;data)\n        {\n            i=2*i;\n            temp = temp-&gt;l;\n        }\n        else if(data &gt; temp-&gt;data)\n        {\n            i = (2*i)+1;\n            temp = temp-&gt;r ;\n        }\n        else\n        {\n            printf(\"%d\\n\",i);\n            break;\n        }\n    }\n    if(temp-&gt;l == 0 &amp;&amp; temp-&gt;r == 0)\n    {\n        temp = 0;\n        return root;\n    }\n    else if(temp-&gt;l == 0)\n    {\n        temp-&gt;data = temp-&gt;l-&gt;data;\n        temp-&gt;l = 0;\n    }\n    else if(temp-&gt;r == 0)\n    {\n        temp-&gt;data = temp-&gt;r-&gt;data;\n        temp-&gt;r = 0;\n    }\n    else\n    {\n        t = temp;\n        t = t-&gt;r;\n        while(t-&gt;l != 0)\n        {\n            t = t-&gt;l;\n        }\n        temp-&gt;data = t-&gt;data;\n        if(t-&gt;r != 0)\n        {\n            t-&gt;data = t-&gt;r-&gt;data;\n            t-&gt;r = 0;\n            return root;\n        }\n        else\n        {\n            t = 0;\n            return root;\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "pointers", "post-increment"], "comments": [{"owner": {"reputation": 81087, "user_id": 104458, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/cc46b8a10ecb92e61aaeb1efe436a0c8?s=128&d=identicon&r=PG", "display_name": "selbie", "link": "https://stackoverflow.com/users/104458/selbie"}, "edited": false, "score": 4, "creation_date": 1556691645, "post_id": 55932353, "comment_id": 98517609, "body": "In the first statement, <code>s</code> will wind up pointing one char past the null char when the while loop exits.  In the second example, <code>s</code> will wind up pointing to the null char when the while loop exits."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1556692142, "post_id": 55932353, "comment_id": 98517728, "body": "The loop control will be the same, it&#39;s just a matter of where <code>s</code> points after the loop completes."}], "answers": [{"tags": [], "owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "is_accepted": true, "score": 4, "last_activity_date": 1556691950, "creation_date": 1556691950, "answer_id": 55932410, "question_id": 55932353, "link": "https://stackoverflow.com/questions/55932353/while-sentinel-variable-with-post-increment-operator/55932410#55932410", "title": "while sentinel variable with post-increment operator", "body": "<p>In case of </p>\n\n<pre><code> while(*s++ != '\\0') {}\n</code></pre>\n\n<p>the increment is done as a post increment operator, in the condition-check statement itself. In this case, the value change (increment) is the side effect after the value computation for the operator. Thus, after the value is used (in comparison), <code>s</code> gets incremented.</p>\n\n<p>On the other hand,</p>\n\n<pre><code>while(*s != '\\0') {\n   s++;\n}\n</code></pre>\n\n<p>the increment takes place as post-increment inside the conditional block, which will only execute if the condition is TRUTHY. Once the condition is evaluated to be false, <code>s</code> is not incremented.</p>\n"}], "owner": {"reputation": 33, "user_id": 5846599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff06c844c7b10d83dadd9b2b8f826aac?s=128&d=identicon&r=PG&f=1", "display_name": "Yousef Rashidi", "link": "https://stackoverflow.com/users/5846599/yousef-rashidi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 55932410, "answer_count": 1, "score": 2, "last_activity_date": 1556692040, "creation_date": 1556691443, "last_edit_date": 1556692040, "question_id": 55932353, "link": "https://stackoverflow.com/questions/55932353/while-sentinel-variable-with-post-increment-operator", "title": "while sentinel variable with post-increment operator", "body": "<p>what's the difference between:</p>\n\n<pre><code>while(*s++ != '\\0') {}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>while(*s != '\\0') {\n   s++;\n}\n</code></pre>\n\n<p><code>s</code> is a <code>char *</code>. The latter works OK. but at the end of first loop, <code>*s</code> is not equal to <code>'\\0'</code>.</p>\n"}, {"tags": ["c", "dos", "mouse-position", "borland-c"], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 7054874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1997c1616628e0a1294c10ff7030db9d?s=128&d=identicon&r=PG&f=1", "display_name": "Juanti", "link": "https://stackoverflow.com/users/7054874/juanti"}, "edited": false, "score": 1, "creation_date": 1556695091, "post_id": 55932361, "comment_id": 98518450, "body": "i just wanted to add, in function setMousePossition you need to multiply x and y by 8."}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 75, "user_id": 7054874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1997c1616628e0a1294c10ff7030db9d?s=128&d=identicon&r=PG&f=1", "display_name": "Juanti", "link": "https://stackoverflow.com/users/7054874/juanti"}, "edited": false, "score": 0, "creation_date": 1556695357, "post_id": 55932361, "comment_id": 98518534, "body": "@Jivko Mouse position is in graphical not in text coordinates. Sorry, forget to mention that."}], "tags": [], "owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "is_accepted": true, "score": 1, "last_activity_date": 1556691518, "creation_date": 1556691518, "answer_id": 55932361, "question_id": 55932191, "link": "https://stackoverflow.com/questions/55932191/trying-to-set-mouse-cursor-possition-in-borland-c/55932361#55932361", "title": "Trying to set mouse cursor possition in borland C", "body": "<p>You do that simply the same way as you have done it in getMouse():</p>\n\n<pre><code>void setMousePosition(int x, int y)\n{\n  reg.r_ax=0x04;\n  reg.r_cx = x;\n  reg.r_dx = y;\n  intr(0x33,&amp;reg);\n}\n</code></pre>\n\n<p>Alternative you can use range limiter:</p>\n\n<pre><code>void setMouseHorizontalRange(int min, int max)\n{\n  reg.r_ax=0x07;\n  reg.r_cx = min;\n  reg.r_dx = max;\n  intr(0x33,&amp;reg);\n}\n\nvoid setMouseVerticalRange(int min, int max)\n{\n  reg.r_ax=0x08;\n  reg.r_cx = min;\n  reg.r_dx = max;\n  intr(0x33,&amp;reg);\n}\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 7054874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1997c1616628e0a1294c10ff7030db9d?s=128&d=identicon&r=PG&f=1", "display_name": "Juanti", "link": "https://stackoverflow.com/users/7054874/juanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 55932361, "answer_count": 1, "score": 2, "last_activity_date": 1556691518, "creation_date": 1556690136, "question_id": 55932191, "link": "https://stackoverflow.com/questions/55932191/trying-to-set-mouse-cursor-possition-in-borland-c", "title": "Trying to set mouse cursor possition in borland C", "body": "<p>I have a program which prints the current mouse cursor position into the console.</p>\n\n<p>I want to create bounds in which the mouse can go. ( 10,10) and (20,20)</p>\n\n<p>So here is my code so far:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;dos.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;conio.h&gt;\n#include &lt;string.h&gt;\n\nint x,y;\n\nstruct REGPACK reg;\n\nvoid getmousepos()\n{\n    reg.r_ax=0x03;\n    intr(0x33,&amp;reg);\n    x=reg.r_cx/8;\n    y=reg.r_dx/8;\n}\n\nint main()\n{\n    clrscr();\n    _setcursortype(_NOCURSOR);\n    reg.r_ax=0x01;\n    intr(0x33,&amp;reg);\n\n    do\n    {\n        getmousepos();\n        printf(\"                        \");\n        printf(\"                        \");\n        window(1,1,79,24);\n        printf(\"Current position : %3d, %3d\",x,y);\n\n        if(x &lt; 10)\n        //set the x cursor possition to 10\n        if(x &gt; 20)\n        //set the x cursor possition to 20\n        if(y &lt; 10)\n        //set the y cursor to 10\n        if(y &gt; 20)\n        //set the y cursor to 20\n\n    }while(!kbhit());\n\n    return 1;\n}\n</code></pre>\n\n<p>Is there any way of setting reg.r_cx and reg.r_dx registers with the cordinates i want, and then calling intr() with the proper interrupt ?</p>\n"}, {"tags": ["c", "visual-studio", "assembly"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 5, "creation_date": 1556687862, "post_id": 55931860, "comment_id": 98516834, "body": "You&#39;ll need to put the operands in the xmm registers and do a floating point multiply. The assembly code in the question treats <code>a</code> like an <code>int</code>, and multiplies it by a billion (approximately)."}], "owner": {"reputation": 57, "user_id": 10930244, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RowvZmsTkwI/AAAAAAAAAAI/AAAAAAAAAlQ/9uG-ZtcJweQ/photo.jpg?sz=128", "display_name": "robert parker", "link": "https://stackoverflow.com/users/10930244/robert-parker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "closed_date": 1556689642, "answer_count": 0, "score": 2, "last_activity_date": 1556687203, "creation_date": 1556687203, "question_id": 55931860, "link": "https://stackoverflow.com/questions/55931860/how-to-get-the-result-of-multiplying-two-numbers", "closed_reason": "Duplicate", "title": "how to get the result of multiplying two numbers", "body": "<p>I am trying to take a float as an arg input and do an equation in assembly using c only to get input and return the result.</p>\n\n<p>How do i store the result into r?</p>\n\n<pre><code>int main(int argc, char **argv)\n{\n    float a, r;\n\n    if (argc != 2) { printf(\"Invalid number of arguments\"); }\n\n    a = atof(argv[1]);\n\n    printf(\"2*%f = \", a);\n\n    __asm {\n        mov eax, a\n        mov ebx, 0x40000000//2.0\n        mul ebx\n        mov r, eax// always 0\n    }\n\n    printf(\"%f \\n\", r);\n\n    return r;\n}\n</code></pre>\n"}, {"tags": ["c", "parsing"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 2, "creation_date": 1556686645, "post_id": 55931784, "comment_id": 98516563, "body": "There are semantic rules that say some syntactically valid token sequences are not semantically valid.  You&#39;ve shown an instance."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556687327, "post_id": 55931784, "comment_id": 98516713, "body": "More in-depth discussion: <a href=\"https://stackoverflow.com/questions/55294667/why-is-int-test-a-function-definition-in-c-language-bnf\" title=\"why is int test a function definition in c language bnf\">stackoverflow.com/questions/55294667/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 25937, "user_id": 338904, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/dea29233fa03ea84f8a853102deb0344?s=128&d=identicon&r=PG", "display_name": "e2-e4", "link": "https://stackoverflow.com/users/338904/e2-e4"}, "edited": false, "score": 0, "creation_date": 1556687381, "post_id": 55931818, "comment_id": 98516727, "body": "Don&#39;t these rules belong to the grammar (like <i>lvalue</i> on the left), precisely?"}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 25937, "user_id": 338904, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/dea29233fa03ea84f8a853102deb0344?s=128&d=identicon&r=PG", "display_name": "e2-e4", "link": "https://stackoverflow.com/users/338904/e2-e4"}, "edited": false, "score": 0, "creation_date": 1556690833, "post_id": 55931818, "comment_id": 98517424, "body": "@Ring&#216; Yes, no and a little bit. The grammar in EBNF specifies the syntactical rules which means it specifies the structure of the code. But the type system for example specifies semantic rules which are not possible to describe in EBNF (with a context-sensitive grammar it would be possible but parser ugly to write with them). So in C you will usually need a semantic checker and therefore, stuff which are easier handled in the semantic checker are not part of the grammar."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 25937, "user_id": 338904, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/dea29233fa03ea84f8a853102deb0344?s=128&d=identicon&r=PG", "display_name": "e2-e4", "link": "https://stackoverflow.com/users/338904/e2-e4"}, "edited": false, "score": 0, "creation_date": 1556722289, "post_id": 55931818, "comment_id": 98529111, "body": "@Ring&#216;: For example, in C, <code>a = 1;</code> is invalid if <code>a</code> names an array or a function. That&#39;s impossible to express in a context-free grammar."}], "tags": [], "owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "is_accepted": true, "score": 4, "last_activity_date": 1556687191, "last_edit_date": 1556687191, "creation_date": 1556686849, "answer_id": 55931818, "question_id": 55931784, "link": "https://stackoverflow.com/questions/55931784/trying-to-understand-c-grammar/55931818#55931818", "title": "Trying to understand C Grammar", "body": "<p>C is not completely described by its grammar; a valid C program must conform to the grammar, but it also must conform to many other rules, e.g. rules relating to the type system.</p>\n\n<p>So, you're right: <code>1 = 1</code> conforms to the rule you've quoted, but it's invalid anyway, because the left-hand-side is not an lvalue.</p>\n\n<p>(Note that some compilers may actually treat <code>1 = 1</code> as a syntax error, because they may roll some of these other restrictions into the grammar that they apply. That's allowed; the spec gives compilers a lot of flexibility in how they implement things, as long as they handle valid programs correctly.)</p>\n"}], "owner": {"reputation": 623, "user_id": 695344, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d0c2f483e1b284df8bb5ab2cb4fb0c71?s=128&d=identicon&r=PG", "display_name": "Patric", "link": "https://stackoverflow.com/users/695344/patric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 55931818, "answer_count": 1, "score": 0, "last_activity_date": 1556687191, "creation_date": 1556686559, "last_edit_date": 1556686980, "question_id": 55931784, "link": "https://stackoverflow.com/questions/55931784/trying-to-understand-c-grammar", "title": "Trying to understand C Grammar", "body": "<p>I started my journey into recursive parsers, and was looking into C Grammar, trying to understand how it works to replicate it in my code.</p>\n\n<p>Then I saw this:</p>\n\n<pre><code>assignmentExpression\n:   conditionalExpression\n|   unaryExpression assignmentOperator assignmentExpression\n|   DigitSequence // for\n;\n</code></pre>\n\n<p>and this part in particular:</p>\n\n<pre><code>unaryExpression assignmentOperator assignmentExpression\n</code></pre>\n\n<p>With my (poor and probably wrong) understanding, a unary expression can be a Constant (if you follow the rest of the grammar), then it looks like this <code>1 = 1</code> is valid, which is obviously wrong. I searched for C parsers, even the GCC source code, and the assignmentExpression functions never really have any code related to the unaryExpression  part.</p>\n\n<p>So I'm really confused; I'm probably missing something very important here.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1556687815, "post_id": 55931600, "comment_id": 98516825, "body": "You don&#39;t have to. It depends entirely on the expectations of the users of the <code>struct</code>."}], "answers": [{"comments": [{"owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "reply_to_user": {"reputation": 51, "user_id": 9135852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dae35d5c3d3db9f3e569e5bdb0b16ee?s=128&d=identicon&r=PG&f=1", "display_name": "user9135852", "link": "https://stackoverflow.com/users/9135852/user9135852"}, "edited": false, "score": 0, "creation_date": 1556697236, "post_id": 55931977, "comment_id": 98519068, "body": "Also you should know that direct literal assignment is read-only you cannot modify its contents later stages."}], "tags": [], "owner": {"reputation": 12106, "user_id": 4431643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CoZjt.jpg?s=128&g=1", "display_name": "kiran Biradar", "link": "https://stackoverflow.com/users/4431643/kiran-biradar"}, "is_accepted": true, "score": 2, "last_activity_date": 1556688471, "creation_date": 1556688471, "answer_id": 55931977, "question_id": 55931600, "link": "https://stackoverflow.com/questions/55931600/difference-between-malloc-then-strcpy-vs-just-setting-it-equal-to-the-string/55931977#55931977", "title": "Difference between malloc then strcpy vs just setting it equal to the string", "body": "<p>If you know what value to copy before hand then you don't need <code>malloc</code></p>\n\n<pre><code>s.first_name = \"John\";\n</code></pre>\n\n<p>What if you are getting to know what value to copy during run time?\nIn that case you need <code>malloc</code> and <code>strcpy</code>.</p>\n\n<pre><code>fgets(tempbuf, sizeof tempbuf, stdin);\n\ns.first_name = malloc(somelength);\nstrcpy(s.first_name, tempbuf);\n</code></pre>\n\n<p>or</p>\n\n<pre><code>s.first_name = tempbuf; \n</code></pre>\n\n<p>In latter case <code>first_name</code> will be always be pointing to latest value stored in <code>tempbuf</code>.</p>\n"}], "owner": {"reputation": 51, "user_id": 9135852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dae35d5c3d3db9f3e569e5bdb0b16ee?s=128&d=identicon&r=PG&f=1", "display_name": "user9135852", "link": "https://stackoverflow.com/users/9135852/user9135852"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 55931977, "answer_count": 1, "score": 0, "last_activity_date": 1556688471, "creation_date": 1556684736, "question_id": 55931600, "link": "https://stackoverflow.com/questions/55931600/difference-between-malloc-then-strcpy-vs-just-setting-it-equal-to-the-string", "title": "Difference between malloc then strcpy vs just setting it equal to the string", "body": "<p>Let say I have</p>\n\n<pre><code>struct student\n{\n    char* first_name;\n};\n\ntypedef struct\n{\n    struct student name;\n} Person;\n\nchar* first_name_of_someone = \"John\";\n</code></pre>\n\n<p>Why do I have to malloc and then strcpy to put John in first_name? Why can't I just assign it like this</p>\n\n<pre><code>Person* person = malloc(sizeof(Person));\nstruct student s;\ns.first_name = \"John\";\nperson-&gt;name = s;\n\n</code></pre>\n"}, {"tags": ["c", "file", "include"], "comments": [{"owner": {"reputation": 2034, "user_id": 621883, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/H9fKc.jpg?s=128&g=1", "display_name": "Ito", "link": "https://stackoverflow.com/users/621883/ito"}, "edited": false, "score": 1, "creation_date": 1556679953, "post_id": 55931105, "comment_id": 98515354, "body": "I can see your question is not rather about arrays itself, but global variables and accessibility of them. You can make a singleton class and share it, you can make it static and share it as well. There are plenty ways to do that."}, {"owner": {"reputation": 20558, "user_id": 2864275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p2xKk.png?s=128&g=1", "display_name": "I\u0142ya Bursov", "link": "https://stackoverflow.com/users/2864275/i%c5%82ya-bursov"}, "edited": false, "score": 1, "creation_date": 1556680002, "post_id": 55931105, "comment_id": 98515365, "body": "declare as extern in <code>.h</code> and define in <code>.c</code>"}, {"owner": {"reputation": 657, "user_id": 8974764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b86ac9ae2eef2b628028f15b4d70a521?s=128&d=identicon&r=PG&f=1", "display_name": "weno", "link": "https://stackoverflow.com/users/8974764/weno"}, "reply_to_user": {"reputation": 20558, "user_id": 2864275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p2xKk.png?s=128&g=1", "display_name": "I\u0142ya Bursov", "link": "https://stackoverflow.com/users/2864275/i%c5%82ya-bursov"}, "edited": false, "score": 1, "creation_date": 1556680087, "post_id": 55931105, "comment_id": 98515386, "body": "@I\u0142yaBursov So define in <code>arr.c</code>, declare as <code>extern</code> in <code>arr.h</code> and then <code>#include &lt;arr.h&gt;</code> inside <code>.c</code> files that will use the array? :)"}, {"owner": {"reputation": 20558, "user_id": 2864275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p2xKk.png?s=128&g=1", "display_name": "I\u0142ya Bursov", "link": "https://stackoverflow.com/users/2864275/i%c5%82ya-bursov"}, "edited": false, "score": 1, "creation_date": 1556680111, "post_id": 55931105, "comment_id": 98515390, "body": "@weno yes, this is how it works in c"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1556683000, "post_id": 55931105, "comment_id": 98515875, "body": "<i>&quot;everytime passing the array to a function as an argument&quot;</i> Yes, that&#39;s the correct thing to do. Note that passing the array as an argument actually only passes a pointer to the first object in the array. So the performance impact is minimal."}, {"owner": {"reputation": 657, "user_id": 8974764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b86ac9ae2eef2b628028f15b4d70a521?s=128&d=identicon&r=PG&f=1", "display_name": "weno", "link": "https://stackoverflow.com/users/8974764/weno"}, "edited": false, "score": 0, "creation_date": 1556684842, "post_id": 55931105, "comment_id": 98516195, "body": "Actually, when I was posting that I didn&#39;t realize that the array I am creating is... global. So I kind of no need to pass it as an argument. I don&#39;t like the idea that it&#39;s global and no clue how to bypass it in my case."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556688242, "post_id": 55931105, "comment_id": 98516891, "body": "@weno there is hardly anything wrong with global const variables."}], "answers": [{"comments": [{"owner": {"reputation": 657, "user_id": 8974764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b86ac9ae2eef2b628028f15b4d70a521?s=128&d=identicon&r=PG&f=1", "display_name": "weno", "link": "https://stackoverflow.com/users/8974764/weno"}, "edited": false, "score": 0, "creation_date": 1556684942, "post_id": 55931518, "comment_id": 98516211, "body": "thanks. Do you perhaps see any idea to make this array not global? Defining it three times in <code>foo1()</code>, <code>foo2()</code>, <code>foo3()</code> or defining it in <code>main()</code> does not seem okay because this array definition&#39;s code is really long and makes everything unreadable. That&#39;s why separate file for the array in the first play. But any way to not make it global?"}, {"owner": {"reputation": 139291, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 657, "user_id": 8974764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b86ac9ae2eef2b628028f15b4d70a521?s=128&d=identicon&r=PG&f=1", "display_name": "weno", "link": "https://stackoverflow.com/users/8974764/weno"}, "edited": false, "score": 1, "creation_date": 1556709249, "post_id": 55931518, "comment_id": 98523276, "body": "@weno: \u201cGlobal\u201d is not a proper term in C. The name (identifier) for the array does not need to be visible at file scope other than in the file in which it is defined; it can be declared only inside functions where it is used. But it must have external linkage, so that the declarations refer to the same object as the definition."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1556713522, "post_id": 55931518, "comment_id": 98524996, "body": "weno This answer does not  &quot;Defining it three times in foo1(), foo2(), foo3()&quot;,  It is defined once, in <code>arr.c</code>."}], "tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": true, "score": 1, "last_activity_date": 1556683818, "creation_date": 1556683818, "answer_id": 55931518, "question_id": 55931105, "link": "https://stackoverflow.com/questions/55931105/static-array-where-should-i-define-it/55931518#55931518", "title": "Static array - where should I define it?", "body": "<p><em>Define</em> <code>const int arr[197] = ...</code> in <code>arr.c</code>.</p>\n\n<p><em>Declare</em> <code>extern const int arr[197];</code> in <code>arr.h</code></p>\n\n<p>Only include <code>arr.h</code> in <code>arr.c, file1.c, file2.c, file3.c</code> with <code>#include \"arr.h\"</code>, not <code>#include &lt;arr.h&gt;</code> almost like <a href=\"https://stackoverflow.com/questions/55931105/static-array-where-should-i-define-it/55931518#comment98515386_55931105\">@weno</a></p>\n"}, {"tags": [], "owner": {"reputation": 190, "user_id": 4016231, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aviv Goll", "link": "https://stackoverflow.com/users/4016231/aviv-goll"}, "is_accepted": false, "score": 1, "last_activity_date": 1556689959, "last_edit_date": 1556689959, "creation_date": 1556688364, "answer_id": 55931966, "question_id": 55931105, "link": "https://stackoverflow.com/questions/55931105/static-array-where-should-i-define-it/55931966#55931966", "title": "Static array - where should I define it?", "body": "<p>I can't comment on the accepted answer (newb), so here are some ways to define the array once, but not as a global variable:</p>\n\n<ol>\n<li>The ugly: Define the array in <code>arr.h</code>, then in <code>foo1/2/3()</code>, just <code>#include \"arr.h\"</code> (inside the function body).</li>\n</ol>\n\n<pre class=\"lang-c prettyprint-override\"><code>// arr.h\nconst int arr[197] = { 55, -63, 12, -17, 121 , ... };\n\n// file1.c\nvoid foo1()\n{\n#include \"arr.h\"\n    // Use arr like a local variable\n}\n</code></pre>\n\n<ol start=\"2\">\n<li>The less ugly but still pretty ugly: Define <code>arr</code> in <code>arr.h</code> but only include in main. Then, pass arr as an argument to <code>foo1/2/3</code></li>\n</ol>\n\n<pre class=\"lang-c prettyprint-override\"><code>int main()\n{\n#include \"arr.h\"\n    foo1(arr);\n    foo2(arr);\n    foo3(arr);\n}\n</code></pre>\n\n<ol start=\"3\">\n<li>The text book:</li>\n</ol>\n\n<pre class=\"lang-c prettyprint-override\"><code>// arr_init.c\nvoid init_arr(int arr[197])\n{\n    const int src_arr[197] = {55, -63, 12, -17, 121 , ...};\n    memcpy(arr, src_arr, sizeof(src_arr));\n}\n\n// arr_init.h\nextern void init_arr(int arr[197]);\n\n// main.c\n#include \"init_arr.h\"\nint main()\n{\n    int arr[197];\n    init_arr(arr);\n    foo1(arr);\n    foo2(arr);\n    foo3(arr);\n}\n\n// file1.c\nvoid foo1(const int arr[197])\n{\n...\n}\n\n...\n</code></pre>\n\n<ol start=\"4\">\n<li>Best: Use global const as <a href=\"https://stackoverflow.com/a/55931518/4016231\">@chux said</a>.</li>\n</ol>\n"}], "owner": {"reputation": 657, "user_id": 8974764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b86ac9ae2eef2b628028f15b4d70a521?s=128&d=identicon&r=PG&f=1", "display_name": "weno", "link": "https://stackoverflow.com/users/8974764/weno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 55931518, "answer_count": 2, "score": 0, "last_activity_date": 1556689959, "creation_date": 1556679519, "last_edit_date": 1556680006, "question_id": 55931105, "link": "https://stackoverflow.com/questions/55931105/static-array-where-should-i-define-it", "title": "Static array - where should I define it?", "body": "<p>I have defined the following static const array:</p>\n\n<pre><code>const int arr[197] = { 55, -63, 12, -17, 121 , ... };\n</code></pre>\n\n<p>The array never changes. It contains some specific numerical pattern eligible for my program. \nThis array is used in three different files:</p>\n\n<ul>\n<li><code>foo1()</code> in <code>file1.c</code></li>\n<li><code>foo2()</code> in <code>file2.c</code></li>\n<li><code>foo3()</code> in <code>file3.c</code></li>\n</ul>\n\n<p>everytime passing the array to a function as an argument.</p>\n\n<p>Because the definition of this array is quite long and extensive, I want to create separate file just to define and keep that array in there.</p>\n\n<p>How should that be done properly? Should I define that array in let's say <code>arr.h</code> and then put <code>#include &lt;arr.h&gt;</code> inside <code>.c</code> files that use this array?</p>\n"}, {"tags": ["c", "pipe", "multiple-processes"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1556692887, "post_id": 55931016, "comment_id": 98517897, "body": "Welcome to Stack Overflow.  Please read the <a href=\"https://stackoverflow.com/tour\">About</a> and <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> pages.  I&#39;d like to help, but the question is almost unanswerable because the sample code is nothing like an MCVE (<a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>) \u2014 it&#39;s probably why no-one has responded after 4 hours.  I&#39;m not going to try and guess what&#39;s going on in your code \u2014 especially not in the code you haven&#39;t shown.  The weird indentation scheme doesn&#39;t inspire confidence.  Congratulations on one thing: I&#39;ve not seen this indentation scheme before (and I&#39;ve seen quite a lot of them). It makes it very hard to read the code when you use such an unorthodox system."}, {"owner": {"reputation": 1693, "user_id": 6889435, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/DKfVf.png?s=128&g=1", "display_name": "Kamila Szewczyk", "link": "https://stackoverflow.com/users/6889435/kamila-szewczyk"}, "edited": false, "score": 2, "creation_date": 1556716752, "post_id": 55931016, "comment_id": 98526449, "body": "Please post MCVE."}, {"owner": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556731213, "post_id": 55931016, "comment_id": 98533170, "body": "@JonathanLeffler Hey, I fixed the awful formatting. It was not my fault, I made sure at first to check that the formatting was good. I dont know why it all of a sudden got screwed up. Should I repost so that this question can get more attention?"}, {"owner": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "reply_to_user": {"reputation": 1693, "user_id": 6889435, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/DKfVf.png?s=128&g=1", "display_name": "Kamila Szewczyk", "link": "https://stackoverflow.com/users/6889435/kamila-szewczyk"}, "edited": false, "score": 0, "creation_date": 1556731237, "post_id": 55931016, "comment_id": 98533179, "body": "@KrzysztofSzewczyk Please check my reply to JonathanLeffer"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556731470, "post_id": 55931016, "comment_id": 98533300, "body": "Those far right indented <code>}</code> are still weird.  Classic styles put the close brace at the same level of indent as the starting keywords of the block of code; the only major debate is where the open brace goes.  I prefer Allman; many prefer 1TBS.  See Wikipedia on <a href=\"https://en.wikipedia.org/wiki/Indentation_style\" rel=\"nofollow noreferrer\">Indentation Style</a>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556731553, "post_id": 55931016, "comment_id": 98533341, "body": "No; please don&#39;t repost the question.  Do include enough code that we can see what you&#39;re doing \u2014 ideally, we should be able to compile and run what you post, and see the problem you&#39;re seeing.  That&#39;s what an MCVE is all about."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556731870, "post_id": 55931016, "comment_id": 98533482, "body": "I&#39;ve just run your code through the code reformatter I use \u2014 <a href=\"http://uncrustify.sourceforge.net/\" rel=\"nofollow noreferrer\"><code>uncrustify</code></a> with a configuration that suits my preferred style. I&#39;d probably remove more blank lines, such as the ones before <code>else</code> lines. If you don&#39;t like it, revert my change (click on the timestamp above the edit record to see the edits, and rollback to your preferred version)."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556732182, "post_id": 55931016, "comment_id": 98533631, "body": "It isn&#39;t clear that you are ensuring that the argument list for a command is properly null terminated (the <code>argv</code> list needs a null pointer at the end).  You only wait for one child to exit even when many exist.  And you definitely do not close anywhere near enough file descriptors."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556732217, "post_id": 55931016, "comment_id": 98533649, "body": "You aren&#39;t closing enough file descriptors in the children. <b>Rule of thumb</b>: If you <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/dup2.html\" rel=\"nofollow noreferrer\"><code>dup2()</code></a> one end of a pipe to standard input or standard output, close both of the original file descriptors from <code>pipe()</code> as soon as possible. In particular, that means before using any of the <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/execvp.html\" rel=\"nofollow noreferrer\"><code>exec*()</code></a> family of functions. The rule also applies with either <code>dup()</code> or <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/fcntl.html\" rel=\"nofollow noreferrer\"><code>fcntl()</code></a> with <code>F_DUPFD</code>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556732268, "post_id": 55931016, "comment_id": 98533683, "body": "You also need to close the pipes in the parent before waiting for the children.  Otherwise, the children won&#39;t necessarily see EOF when they should.  Or they may block waiting for the parent to read from one of the pipes, even though the parent never will read from the pipe."}, {"owner": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556732728, "post_id": 55931016, "comment_id": 98533908, "body": "@JonathanLeffler Won&#39;t the exec not be able to read from the read side of each if I close them before execvp?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1556732978, "post_id": 55931016, "comment_id": 98534046, "body": "If you duplicate the read end of a pipe to standard input, you can (should) close the file descriptor returned by <code>pipe()</code> \u2014 and you should close the write end of the pipe because it is an unusual process that writes to and reads from the same pipe (rare enough that it is practically safe to say &quot;it is always wrong&quot;).  Similar considerations apply to the write end of a pipe and standard output.  And the first process in the pipeline doesn&#39;t need the pipe for the last process when there&#39;s more than two processes in total.  You need to write a lot of closes when you open pipes in a loop."}, {"owner": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "edited": false, "score": 0, "creation_date": 1556753189, "post_id": 55931016, "comment_id": 98540797, "body": "So does that mean that I have to close every end from every pipe in the array of pipes in every child except the ones that will duplicated(and consequently closed) by each child?"}, {"owner": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1557004119, "post_id": 55931016, "comment_id": 98622527, "body": "@JonathanLeffler Hey, I am sorry, I forgot to mention you in my last comment. I just did exactly what I thought I needed to do and closed all the pipes in all of the children + the parent.I am still not getting any results. I added more code(and took out some parts of the existing code)."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1557034549, "post_id": 55931016, "comment_id": 98626710, "body": "@NoobProgrammer it still isn&#39;t a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. What is more, the formatting is again weird."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "edited": false, "score": 0, "creation_date": 1557364874, "post_id": 55989112, "comment_id": 98743093, "body": "Where is the wait code that you added? I tried putting waitpid(pid, NULL, 0) so that the children are created and execute sequentially(one after the other) so that the parent has to wait for 1 child to terminate before continuing, but my program keeps hanging when I do that"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "edited": false, "score": 0, "creation_date": 1557364993, "post_id": 55989112, "comment_id": 98743110, "body": "The wait loop is after the call to <code>execute()</code> in <code>main()</code>."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "edited": false, "score": 0, "creation_date": 1557365168, "post_id": 55989112, "comment_id": 98743149, "body": "When you run a pipeline, the processes should run concurrently.  A pipe has a finite and fairly small capacity \u2014 classically 5 KiB, minimally 4 KiB, often 64 KiB these days, but rarely more.  So, you need to have all the processes running to prevent blockages."}, {"owner": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "edited": false, "score": 0, "creation_date": 1557366085, "post_id": 55989112, "comment_id": 98743343, "body": "But what is the wait loop exactly? What is main waiting for? I have been at this for a month already. I really dont know why this is so difficult for me. I also dont know what I was thinking when I decided to read from fd[i][1]. I changed that back after posting the edit."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "edited": false, "score": 0, "creation_date": 1557380209, "post_id": 55989112, "comment_id": 98746407, "body": "Programming a shell is a morbid business, with time spent waiting for dead children, and trying to avoid zombies.  The wait loop is waiting for child processes to die (complete their execution and exit).  When your shell runs a pipeline of four processes, it has to ensure that all four are started.  If you\u2019re not running them in background (usually an <code>&amp;</code> at the end for that), then your main shell has to wait for at least the last process in the pipeline to complete.  There are several ways to organize the pipeline. The Bash shell forks each child itself. Others have the children fork them."}, {"owner": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "edited": false, "score": 0, "creation_date": 1557600118, "post_id": 55989112, "comment_id": 98822602, "body": "Jesus Christ! Many of these errors were caused by stupid typos! The program does exactly what it needs to do now. But what I still dont understand is why it is that the processes exit in order when they each execute at different speeds? In your code for example, Process 8154 executed &quot;grep main&quot; first, without the input from process 8153(since that process is not done yet) and yet, it still finished after process 8153."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "reply_to_user": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "edited": false, "score": 0, "creation_date": 1557600519, "post_id": 55989112, "comment_id": 98822680, "body": "Process 8154 reported that it was started before 8153, but it&#39;s pretty much guaranteed that 8153 was forked first. However, it wouldn&#39;t actually matter much if the processes were forked in reverse order (except for the parent waiting for the pipeline to complete); the <code>grep</code> won&#39;t exit until it gets EOF on its input, and it won&#39;t get that until the <code>sort</code> (and the parent process) close the write end of the pipe. It also depends on the child not having the write end of the pipe open. So, in the pipeline, if the file descriptors are managed properly, <code>grep</code> waits for <code>sort</code> to complete."}], "tags": [], "owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "is_accepted": false, "score": 0, "last_activity_date": 1557601696, "last_edit_date": 1557601696, "creation_date": 1557034343, "answer_id": 55989112, "question_id": 55931016, "link": "https://stackoverflow.com/questions/55931016/issues-piping-with-c-could-an-extra-process-be-executing/55989112#55989112", "title": "Issues piping with C. Could an extra process be executing?", "body": "<p>There are a number of problems with your code:</p>\n\n<ul>\n<li>No calls to <code>wait()</code> or equivalent.</li>\n<li>Connecting the wrong end of a pipe to standard input or standard output.</li>\n<li>Accessing the wrong parts of the set of arguments \u2014 command name and arguments.</li>\n<li>Closing the wrong file descriptors for the pipes, potentially repeatedly.</li>\n</ul>\n\n<p>I think there are issues with memory leakage and unnecessary memory allocation in the <code>customStrCpy()</code> function and the <code>adjustArray()</code> function, but I have not addressed these \u2014 the code seems to work adequately when you don't need to worry about leaks.</p>\n\n<p>I needed to add diagnostics to find out what your code was doing wrong.  Consequently, I used the error reporting code that is available in my <a href=\"https://github.com/jleffler/soq\" rel=\"nofollow noreferrer\">SOQ</a> (Stack Overflow Questions) repository on GitHub as files <code>stderr.c</code> and <code>stderr.h</code> in the <a href=\"https://github.com/jleffler/soq/tree/master/src/libsoq\" rel=\"nofollow noreferrer\">src/libsoq</a> sub-directory.</p>\n\n<p>This code was based on the code shown in <a href=\"https://stackoverflow.com/revisions/55931016/6\">Revision 6</a> of the question \u2014 the code shown in the question has been modified since then.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;unistd.h&gt;\n\n#include \"stderr.h\"\n\n#define MAX_ARGS 20\n#define BUFSIZ 1024\n\nstatic\nint get_args(char *cmdline, char *args[])\n{\n    int i = 0;\n\n    /* if no args */\n    if ((args[0] = strtok(cmdline, \"\\n\\t \")) == NULL)\n        return 0;\n\n    while ((args[++i] = strtok(NULL, \"\\n\\t \")) != NULL)\n    {\n        if (i &gt;= MAX_ARGS)\n        {\n            printf(\"Too many arguments!\\n\");\n            exit(1);\n        }\n    }\n    /* the last one is always NULL */\n    return i;\n}\n\nstatic\nvoid customStrCpy(char **line1, char *line2)\n{\n    int strlen1 = strlen(*line1), strlen2 = strlen(line2);\n    if (strlen1 &lt; strlen2)\n    {\n        // Creates a dynamically allocated array that is big enough to store the contents of line2.\n        *line1 = calloc(strlen2, sizeof(char));\n    }\n    strcpy(*line1, line2);\n}\n\nstatic\nvoid adjustArray(char *args[], int args_itr, int *nargs)\n{\n    int i, j;\n\n    for (i = 0; i &lt; 2; i++)\n    {\n        for (j = args_itr; j &lt; (*nargs) - 1; j++)\n        {\n            customStrCpy(&amp;args[j], args[j + 1]);\n        }\n        args[(*nargs) - 1] = 0;\n        (*nargs)--;\n    }\n}\n\nstatic\nvoid process(int *greaterthan, int *d_greaterthan, char *args_pipe[],\n             int *nargs_p, int *fileno_out, int *fileno_in, int *lessthan,\n             FILE **fout, FILE **fin)\n{\n    int args_itr;\n    err_remark(\"--&gt;&gt; %s():\\n\", __func__);\n    for (args_itr = 0; args_itr &lt; *nargs_p; args_itr++)\n    {\n        if (strcmp(args_pipe[args_itr], \"&gt;\") == 0)\n        {\n            err_remark(\"---- %s(): &gt; %s\\n\", __func__, args_pipe[args_itr + 1]);\n            *fout = fopen(args_pipe[args_itr + 1], \"w\");\n            if (fout == NULL)\n                err_syserr(\"failed to open file '%s' for writing\\n\",\n                           args_pipe[args_itr + 1]);\n            *fileno_out = fileno(*fout);\n            *greaterthan = 1;\n            adjustArray(args_pipe, args_itr, nargs_p);\n            args_itr--;\n        }\n        else if (strcmp(args_pipe[args_itr], \"&gt;&gt;\") == 0)\n        {\n            err_remark(\"---- %s(): &gt;&gt; %s\\n\", __func__, args_pipe[args_itr + 1]);\n            *fout = fopen(args_pipe[args_itr + 1], \"a\");\n            if (fout == NULL)\n                err_syserr(\"failed to open file '%s' for appending\\n\",\n                           args_pipe[args_itr + 1]);\n            *fileno_out = fileno(*fout);\n            *d_greaterthan = 1;\n            adjustArray(args_pipe, args_itr, nargs_p);\n            args_itr--;\n        }\n        else if (strcmp(args_pipe[args_itr], \"&lt;\") == 0)\n        {\n            err_remark(\"---- %s(): &lt; %s\\n\", __func__, args_pipe[args_itr + 1]);\n            *fin = fopen(args_pipe[args_itr + 1], \"r\");\n            if (fin == NULL)\n                err_syserr(\"failed to open file '%s' for reading\\n\",\n                           args_pipe[args_itr + 1]);\n            *fileno_in = fileno(*fin);\n            *lessthan = 1;\n            adjustArray(args_pipe, args_itr, nargs_p);\n            args_itr--;\n        }\n    }\n    err_remark(\"&lt;&lt;-- %s()\\n\", __func__);\n}\n\nstatic\nvoid execute(char *cmdline)\n{\n    int lessthan = 0;\n    int greaterthan = 0, d_greaterthan = 0;\n    int args_itr, pipe_flag = 0;\n    int flag_count = 0, fileno_in, fileno_out;\n    char *args_pipe[MAX_ARGS];/*5 and 3 are test numbers.*/\n    char *args[MAX_ARGS];\n\n    int nargs = get_args(cmdline, args);\n    if (nargs &lt;= 0)\n        return;\n\n    if (!strcmp(args[0], \"quit\") || !strcmp(args[0], \"exit\"))\n    {\n        exit(0);\n    }\n\n    for (int x = 0; x &lt; nargs; x++)\n        err_remark(\"args[%d] = [%s]\\n\", x, args[x]);\n\n    FILE *fout = stdout;\n    FILE *fin = stdin;\n    for (args_itr = 0; args_itr &lt; nargs; args_itr++)\n    {\n        if (!strcmp(args[args_itr], \"|\"))\n        {\n            pipe_flag = 1;\n            flag_count++;\n        }\n    }\n\n    if (pipe_flag)\n    {\n        int num_commands = flag_count + 1, i = 0, j = 0;\n        int fd[flag_count][2];\n\n        for (i = 0; i &lt; flag_count; i++)\n        {\n            pipe(fd[i]);\n            err_remark(\"opened pipe - %d and %d\\n\", fd[i][0], fd[i][1]);\n        }\n\n        for (i = 0; i &lt; num_commands; i++)\n        {\n            int nargs_p = 0, args_pipe_itr = 0;\n            while (j &lt; nargs &amp;&amp; strcmp(args[j], \"|\"))\n            {\n                // Possibly make into for loop.\n                args_pipe[args_pipe_itr] = args[j];\n                args_pipe_itr++;\n                j++;\n                nargs_p++;\n            }\n            args_pipe[nargs_p] = NULL;  /* JL: Null-terminate argument list */\n\n            j++;    /* Skip pipe argument */\n\n            int pid = fork();\n\n            signal(SIGTTIN, SIG_IGN);\n            signal(SIGTTOU, SIG_IGN);\n\n            if (pid &lt; 0)\n            {\n                err_syserr(\"failed to fork a child process: \");\n                /*NOTREACHED*/\n            }\n            if (pid &gt; 0)\n            {\n                err_remark(\"Parent launched child %d\\n\", pid);\n                continue;\n            }\n            else // if (pid == 0)\n            {\n                err_remark(\"child at work (i == %d)\\n\", i);\n                if (i == 0)\n                {\n                    err_remark(\"first process in pipeline (i = %d, j = %d)\\n\", i, j);\n                    process(&amp;greaterthan, &amp;d_greaterthan, args_pipe,\n                            &amp;nargs_p, &amp;fileno_out, &amp;fileno_in, &amp;lessthan,\n                            &amp;fout, &amp;fin);\n                    if (lessthan)\n                        dup2(fileno_in, STDIN_FILENO);\n                    dup2(fd[i][1], STDOUT_FILENO);\n                }\n                else if (i != num_commands - 1)\n                {\n                    err_remark(\"middle process in pipeline (i = %d, j = %d)\\n\", i, j);\n                    dup2(fd[i - 1][0], STDIN_FILENO);   /* JL */\n                    /* Will need to process I/O redirections mid-pipeline */\n                    /* However, they're always a bug in the shell script */\n                    dup2(fd[i][1], STDOUT_FILENO);\n                }\n                else\n                {\n                    err_remark(\"final process in pipeline (i = %d, j = %d)\\n\", i, j);\n                    dup2(fd[i - 1][0], STDIN_FILENO);   /* JL */\n                    process(&amp;greaterthan, &amp;d_greaterthan, args_pipe,\n                            &amp;nargs_p, &amp;fileno_out, &amp;fileno_in, &amp;lessthan,\n                            &amp;fout, &amp;fin);\n                    if (greaterthan || d_greaterthan)\n                        err_remark(\"Redirection:\\n\"),\n                        dup2(fileno_out, STDOUT_FILENO);\n                }\n\n                err_remark(\"close pipes\\n\");\n                int close_pipes;\n                for (close_pipes = 0; close_pipes &lt; flag_count; close_pipes++)\n                {\n                    close(fd[close_pipes][0]);  /* JL */\n                    close(fd[close_pipes][1]);  /* JL */\n                }\n\n                if (fout != stdout)\n                    fclose(fout);\n                if (fin != stdin)\n                    fclose(fin);\n                err_remark(\"execute command [%s]\\n\", args_pipe[0]);\n                for (int i = 1; args_pipe[i] != NULL; i++)\n                    err_remark(\"argument %d [%s]\\n\", i, args_pipe[i]);\n                execvp(args_pipe[0], args_pipe);\n                err_syserr(\"Failed to execute (i=%d) '%s': \", i, args_pipe[0]);\n                /*NOTREACHED*/\n            }// end child.\n        }\n        /* Parent process closes its copy of each pipe */\n        for (i = 0; i &lt; flag_count; i++)\n        {\n            close(fd[i][0]);\n            close(fd[i][1]);\n        }\n        return;\n    }\n    else\n        err_remark(\"No pipe in input - no command executed\\n\");\n}\n\nint main(int argc, char **argv)\n{\n    if (argc &gt;= 0)\n        err_setarg0(argv[0]);\n    err_setlogopts(ERR_PID|ERR_MILLI);\n\n    for ( ; ; )\n    {\n        printf(\"COP4338$ \");\n\n        char cmdline[BUFSIZ];\n        if (fgets(cmdline, BUFSIZ, stdin) == NULL)\n        {\n            printf(\"EOF\\n\");\n            exit(1);\n        }\n        execute(cmdline);\n        int status;\n        int corpse;\n        while ((corpse = wait(&amp;status)) &gt; 0)\n            err_remark(\"PID %d exited with status 0x%.4X\\n\", corpse, status);\n    }\n}\n</code></pre>\n\n<p>The <code>process()</code> function shouldn't need to distinguish between <code>&gt;</code> and <code>&gt;&gt;</code> in the argument list; it would be sufficient to handle the standard output correctly.  The calling code would be simpler.  I'm not convinced that you should use <code>fopen()</code> \u2014 it would be more sensible to use <code>open()</code> with appropriate control arguments.</p>\n\n<p>However, this does at least seem to work.  The source code was <code>shell61.c</code>, compiled to the program <code>shell61</code>.</p>\n\n<pre><code>$ shell61\nCOP4338$ sort &lt; shell61.c | grep main | cat &gt; o.txt\nshell61: 2019-05-04 22:17:39.982 - pid=8150: args[0] = [sort]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: args[1] = [&lt;]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: args[2] = [shell61.c]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: args[3] = [|]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: args[4] = [grep]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: args[5] = [main]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: args[6] = [|]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: args[7] = [cat]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: args[8] = [&gt;]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: args[9] = [o.txt]\nshell61: 2019-05-04 22:17:39.983 - pid=8150: opened pipe - 3 and 4\nshell61: 2019-05-04 22:17:39.983 - pid=8150: opened pipe - 5 and 6\nshell61: 2019-05-04 22:17:39.984 - pid=8150: Parent launched child 8153\nshell61: 2019-05-04 22:17:39.984 - pid=8150: Parent launched child 8154\nshell61: 2019-05-04 22:17:39.984 - pid=8150: Parent launched child 8155\nshell61: 2019-05-04 22:17:39.984 - pid=8154: child at work (i == 1)\nshell61: 2019-05-04 22:17:39.984 - pid=8153: child at work (i == 0)\nshell61: 2019-05-04 22:17:39.984 - pid=8155: child at work (i == 2)\nshell61: 2019-05-04 22:17:39.985 - pid=8154: middle process in pipeline (i = 1, j = 7)\nshell61: 2019-05-04 22:17:39.985 - pid=8155: final process in pipeline (i = 2, j = 11)\nshell61: 2019-05-04 22:17:39.985 - pid=8153: first process in pipeline (i = 0, j = 4)\nshell61: 2019-05-04 22:17:39.985 - pid=8154: close pipes\nshell61: 2019-05-04 22:17:39.985 - pid=8155: --&gt;&gt; process():\nshell61: 2019-05-04 22:17:39.985 - pid=8153: --&gt;&gt; process():\nshell61: 2019-05-04 22:17:39.986 - pid=8154: execute command [grep]\nshell61: 2019-05-04 22:17:39.986 - pid=8155: ---- process(): &gt; o.txt\nshell61: 2019-05-04 22:17:39.986 - pid=8153: ---- process(): &lt; shell61.c\nshell61: 2019-05-04 22:17:39.986 - pid=8154: argument 1 [main]\nshell61: 2019-05-04 22:17:39.986 - pid=8155: &lt;&lt;-- process()\nshell61: 2019-05-04 22:17:39.986 - pid=8153: &lt;&lt;-- process()\nshell61: 2019-05-04 22:17:39.987 - pid=8155: Redirection:\nshell61: 2019-05-04 22:17:39.987 - pid=8153: close pipes\nshell61: 2019-05-04 22:17:39.987 - pid=8155: close pipes\nshell61: 2019-05-04 22:17:39.987 - pid=8153: execute command [sort]\nshell61: 2019-05-04 22:17:39.988 - pid=8155: execute command [cat]\nshell61: 2019-05-04 22:17:39.993 - pid=8150: PID 8153 exited with status 0x0000\nshell61: 2019-05-04 22:17:39.993 - pid=8150: PID 8154 exited with status 0x0000\nshell61: 2019-05-04 22:17:39.994 - pid=8150: PID 8155 exited with status 0x0000\nCOP4338$ cat o.txt | cat\nshell61: 2019-05-04 22:18:08.339 - pid=8150: args[0] = [cat]\nshell61: 2019-05-04 22:18:08.339 - pid=8150: args[1] = [o.txt]\nshell61: 2019-05-04 22:18:08.339 - pid=8150: args[2] = [|]\nshell61: 2019-05-04 22:18:08.339 - pid=8150: args[3] = [cat]\nshell61: 2019-05-04 22:18:08.339 - pid=8150: opened pipe - 3 and 4\nshell61: 2019-05-04 22:18:08.340 - pid=8150: Parent launched child 8157\nshell61: 2019-05-04 22:18:08.340 - pid=8150: Parent launched child 8158\nshell61: 2019-05-04 22:18:08.340 - pid=8157: child at work (i == 0)\nshell61: 2019-05-04 22:18:08.340 - pid=8158: child at work (i == 1)\nshell61: 2019-05-04 22:18:08.340 - pid=8157: first process in pipeline (i = 0, j = 3)\nshell61: 2019-05-04 22:18:08.341 - pid=8157: --&gt;&gt; process():\nshell61: 2019-05-04 22:18:08.341 - pid=8158: final process in pipeline (i = 1, j = 5)\nshell61: 2019-05-04 22:18:08.341 - pid=8157: &lt;&lt;-- process()\nshell61: 2019-05-04 22:18:08.341 - pid=8158: --&gt;&gt; process():\nshell61: 2019-05-04 22:18:08.342 - pid=8157: close pipes\nshell61: 2019-05-04 22:18:08.342 - pid=8158: &lt;&lt;-- process()\nshell61: 2019-05-04 22:18:08.342 - pid=8157: execute command [cat]\nshell61: 2019-05-04 22:18:08.342 - pid=8158: close pipes\nshell61: 2019-05-04 22:18:08.343 - pid=8157: argument 1 [o.txt]\nshell61: 2019-05-04 22:18:08.343 - pid=8158: execute command [cat]\nint main(int argc, char **argv)\nshell61: 2019-05-04 22:18:08.347 - pid=8150: PID 8158 exited with status 0x0000\nshell61: 2019-05-04 22:18:08.347 - pid=8150: PID 8157 exited with status 0x0000\nCOP4338$ ls\nshell61: 2019-05-04 22:18:41.516 - pid=8150: args[0] = [ls]\nshell61: 2019-05-04 22:18:41.516 - pid=8150: No pipe in input - no command executed\nCOP4338$ exit\n$\n</code></pre>\n\n<p>When I added the <code>wait()</code> code first, I got messages like:</p>\n\n<pre><code>$ shell61\nCOP4338$ ls | grep shell\nshell61: 2019-05-04 14:29:23.201 - pid=5181: args[0] = [ls]\nshell61: 2019-05-04 14:29:23.202 - pid=5181: args[1] = [|]\nshell61: 2019-05-04 14:29:23.202 - pid=5181: args[2] = [grep]\nshell61: 2019-05-04 14:29:23.202 - pid=5181: args[3] = [shell]\nshell61: 2019-05-04 14:29:23.202 - pid=5181: opened pipe - 3 and 4\nProcess ID: 5182\nProcess ID: 5183\nProcess ID: 0\nProcess ID: 0\nshell61: 2019-05-04 14:29:23.203 - pid=5183: child at work\nPID 5183 exited with status 0x000B\nshell61: 2019-05-04 14:29:23.203 - pid=5182: child at work\nPID 5182 exited with status 0x000D\nCOP4338$ exit\n$\n</code></pre>\n\n<p>The exit status from 5183 was 0x000B, which translates to \"died from signal 11 \u2014 SIGSEGV\"; the exit status from 5182 was 0x000D, which translates to \"died form signal 13 \u2014 SIGPIPE\".  This was important information.  The printing added, via <code>err_remark()</code> in particular, helped show where there were problems.  Spotting that you were calling <code>process()</code> with <code>&amp;args_pipe[i]</code> instead of <code>&amp;args_pipe[0]</code> or <code>args_pipe</code> was key, too.  </p>\n\n<p>When the trace looked like:</p>\n\n<pre><code>$ shell61\nCOP4338$ ls | grep shell\nshell61: 2019-05-04 16:24:24.297 - pid=6417: args[0] = [ls]\nshell61: 2019-05-04 16:24:24.298 - pid=6417: args[1] = [|]\nshell61: 2019-05-04 16:24:24.298 - pid=6417: args[2] = [grep]\nshell61: 2019-05-04 16:24:24.298 - pid=6417: args[3] = [shell]\nshell61: 2019-05-04 16:24:24.298 - pid=6417: opened pipe - 3 and 4\nshell61: 2019-05-04 16:24:24.299 - pid=6417: Parent launched child 6419\nshell61: 2019-05-04 16:24:24.299 - pid=6417: Parent launched child 6420\nshell61: 2019-05-04 16:24:24.300 - pid=6420: child at work (i == 1)\nshell61: 2019-05-04 16:24:24.299 - pid=6419: child at work (i == 0)\nshell61: 2019-05-04 16:24:24.300 - pid=6420: final process in pipeline (i = 1, j = 5)\nshell61: 2019-05-04 16:24:24.301 - pid=6419: first process in pipeline (i = 0, j = 2)\nshell61: 2019-05-04 16:24:24.301 - pid=6420: --&gt;&gt; process():\nshell61: 2019-05-04 16:24:24.302 - pid=6420: &lt;&lt;-- process()\ngreaterthan = 0\nd_greaterthan = 0\nshell61: 2019-05-04 16:24:24.302 - pid=6419: --&gt;&gt; process():\nshell61: 2019-05-04 16:24:24.302 - pid=6420: close pipes\nshell61: 2019-05-04 16:24:24.302 - pid=6419: &lt;&lt;-- process()\nLessthan = 0\nshell61: 2019-05-04 16:24:24.303 - pid=6420: execute command [grep]\nshell61: 2019-05-04 16:24:24.303 - pid=6420: argument 1 [shell]\nshell61: 2019-05-04 16:24:24.303 - pid=6419: close pipes\nshell61: 2019-05-04 16:24:24.304 - pid=6419: execute command [ls]\ngrep: (standard input): Bad file descriptor\nPID 6420 exited with status 0x0100\nPID 6419 exited with status 0x000D\nCOP4338$ exit\n$\n</code></pre>\n\n<p>it was clear that there was a problem with the redirection \u2014 it wasn't clear if the standard input was closed or if <code>grep</code> was being asked to read from a write-only file descriptor; code review showed that the latter was actually the problem (using <code>fd[i][1]</code> where <code>fd[i][0]</code> needed to be used).</p>\n\n<p>I can't emphasize enough how having powerful yet simple error reporting tools helps. I use the <code>stderr.c</code> and <code>stderr.h</code> code in most of my programs \u2014 it is rare in the extreme that I do not use them.  You should either acquire a copy of them or devise your own equivalent, but be aware that there's 30 years of refinements to that code (though there were some years when I didn't make any changes to it \u2014 2018 being the most recent such year, but it didn't change in 1992-1995, and in sundry other years since).  The earliest version I still have was dated 1988; the code was actually started before that, but I had a failure to transfer the data successfully when moving jobs (8\" floppy disk turned out to be a bad choice).</p>\n"}], "owner": {"reputation": 1, "user_id": 8929596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57b65e6b50850bbb1f9d2e1895bd9e54?s=128&d=identicon&r=PG&f=1", "display_name": "NoobProgrammer", "link": "https://stackoverflow.com/users/8929596/noobprogrammer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1557601696, "creation_date": 1556678395, "last_edit_date": 1557601185, "question_id": 55931016, "link": "https://stackoverflow.com/questions/55931016/issues-piping-with-c-could-an-extra-process-be-executing", "title": "Issues piping with C. Could an extra process be executing?", "body": "<p>I don't know what is wrong in this code. There are multiple errors with its output. This program is supposed to imitate a UNIX shell. It can run any command fine as long as it does not contain any pipes. However, when I include pipes, funny things start to occur.</p>\n\n<p>For example: When I type in <code>sort &lt; myshell1,c | grep main | cat &gt; o.txt</code></p>\n\n<p>it creates an extra process. You can see this because in the code, <code>perror(in)</code> gets executed 4 times (as per GDB):</p>\n\n<pre><code>COP4338$ sort &lt; myshell1.c | grep main | cat &gt; o.txt\nDetaching after fork from child process 16465.\nProcess ID: 16465\nProcess ID: 0\nin: Success\nDetaching after fork from child process 16466.\nProcess ID: 16466\nProcess ID: 0\nin: Success\nSomething happened in i != numcommands - 1: Success\nDetaching after fork from child process 16468.\nProcess ID: 16468\nCOP4338$ Process ID: 0\nin: Success\nELSE STATEMENT!\nDetaching after fork from child process 17403.\nin: Bad address\n</code></pre>\n\n<p>And then, the program goes to a new line and doesnt print COP4338$: like it should. Undefined behavior is exhibited. My guess as to why this is happening is because that 4th process is also continuing and thus heading back to main(), just like the parent, but I can't pinpoint why it is even being created.</p>\n\n<p>Undefined behavior is also exhibited when I try to run <code>ls -l | cat &gt; o.txt</code></p>\n\n<p>This is what GDB outputs:</p>\n\n<p>As far as trying to fix the issue, I have yet to know for sure what is causing this. I have tried to use gdb debugger to debug the 3rd child process by typing \"set follow-fork-mode child\" and using a breakpoint at the 1st line of the 3rd child process and nothing happens. I can only debug the 1st child process by doing this.</p>\n\n<pre><code>/* This code  was written by Dr. Raju Rangaswami and was expanded upon as per the instructions in Assignment3, by Michael Duboc(PID: 5706538)*/\n\n#include &lt;stdio.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#define MAX_ARGS 20\n#define BUFSIZ 1024\n\n\nint get_args(char* cmdline, char* args[]) \n{\n  int i = 0;\n\n  /* if no args */\n  if((args[0] = strtok(cmdline, \"\\n\\t \")) == NULL) \n    return 0; \n\n  while((args[++i] = strtok(NULL, \"\\n\\t \")) != NULL) \n  {\n    if(i &gt;= MAX_ARGS) \n    {\n      printf(\"Too many arguments!\\n\");\n      exit(1);\n    }\n  }\n  /* the last one is always NULL */\n  return i;\n}\n\n\n\n\nint customStrCpy(char** line1, char* line2)\n{\n    int strlen1 = strlen(*line1), strlen2 = strlen(line2);\n    if(strlen1 &lt; strlen2)\n    {\n        //Creates a dynamically allocated array that is big enough to store the contents of line2.\n        *line1 = calloc(strlen2, sizeof(char));\n\n    }\n    strcpy(*line1, line2);\n\n\n\n}\n\n\n\n\nvoid adjustArray(char* args[], int args_itr, int* nargs)\n{\n\n    int i, j;\n\n    for(i = 0; i &lt; 2; i++)\n    {\n\n        for(j = args_itr; j &lt; (*nargs) - 1; j++)\n        {\n            customStrCpy(&amp;args[j],args[j+1]);\n        }\n        args[(*nargs) - 1] = 0;\n        (*nargs)--;\n        }\n\n} \n\nint process(int* greaterthan, int* d_greaterthan, char* args_pipe[], int* \nnargs_p, int* fileno_out, int* fileno_in, int* lessthan, FILE** fout, \nFILE** fin)\n{\n    int greaterthan_strcmp = strcmp(args_pipe[args_itr], \"&gt;\");\n    int d_greaterthan_strcmp = strcmp(args_pipe[args_itr], \"&gt;&gt;\");\n            if(greaterthan_strcmp == 0 || d_greaterthan_strcmp  == 0)\n            {\n                    if(greaterthan_strcmp == 0)\n                            *fout = fopen(args_pipe[args_itr + 1], \"w\");\n                    else\n                            *fout = fopen(args_pipe[args_itr + 1], \"a\");\n                    *fileno_out = fileno(*fout);\n\n                    *greaterthan = 1;\n                    adjustArray(args_pipe, args_itr, nargs_p);\n                    args_itr--;\n                    int print_arr;\n                    for(print_arr = 0; print_arr \n                      (sizeof(args_pipe)/sizeof(args_pipe[0])); print_arr++) \n                      printf(\"%s \",args_pipe[print_arr]);\n                    printf(\"\\n\");\n            }\n\n\n\n\n\n         else if(strcmp(args_pipe[args_itr], \"&lt;\") == 0)\n         {\n\n\n            *fin = fopen(args_pipe[args_itr + 1], \"r\");\n            *fileno_in = fileno(*fin);\n\n            *lessthan = 1;\n            adjustArray(args_pipe, args_itr, nargs_p);\n            args_itr--;\n\n        }\n\n    }\n\n\n    return 0;\n\n\n}\n\n\n\n\nvoid execute(char* cmdline) \n{\n  int pid, async, lessthan = 0;\n  int greaterthan = 0, pipef = 0, d_greaterthan = 0;\n  int args_itr, pipe_flag = 0;\n  int flag_count = 0, fileno_in, fileno_out;\n  char* args_pipe[MAX_ARGS];/*5 and 3 are test numbers.*/\n  char* args[MAX_ARGS];\n\n\n  int nargs = get_args(cmdline, args);\n  if(nargs &lt;= 0) return;\n\n  if(!strcmp(args[0], \"quit\") || !strcmp(args[0], \"exit\")) \n  {\n\n    exit(0);\n  }\n\n  /* check if async call */\n  if(!strcmp(args[nargs-1], \"&amp;\")) { async = 1; args[--nargs] = 0; }\n  else async = 0;\n  FILE* fout = stdout;\n  FILE* fin = stdin; \n  for(args_itr = 0; args_itr &lt; nargs; args_itr++)\n  {\n    if(!strcmp(args[args_itr], \"|\")) {pipe_flag = 1; flag_count++;}\n    }\n\n\n\n  if(pipe_flag)\n  {\n    int num_commands = flag_count + 1, i = 0, j = 0;\n    int fd[num_commands][2];\n\n\n    for(i = 0; i &lt; flag_count; i++) {pipe(fd[i]);}\n\n    for(i = 0; i &lt; num_commands; i++)\n    {\n\n\n        int nargs_p = 0, args_pipe_itr = 0;\n        while(j &lt; nargs &amp;&amp; strcmp(args[j], \"|\")) \n        {//Possibly make into for loop.\n            args_pipe[args_pipe_itr] = args[j]; \n            args_pipe_itr++; \n            j++; \n            nargs_p++;\n        }\n\n        j++;    \n\n\n        int pid = fork();\n\n        signal(SIGTTIN, SIG_IGN);\n        signal(SIGTTOU, SIG_IGN);   \n        printf(\"Process ID: %d\\n\", pid);    \n\n        if(pid &lt; 0)\n        {\n            perror(\"Error forking!\");\n            return;\n        }\n\n        else if(pid &gt; 0) {continue;}\n\n        else //pid == 0\n        {\n\n            perror(\"in\");\n            if(i == 0)\n            {   \n                process(&amp;greaterthan, &amp;d_greaterthan, &amp;args_pipe[i] ,&amp;nargs_p, &amp;fileno_out, &amp;fileno_in, &amp;lessthan, &amp;fout, &amp;fin);\n                printf(\"Lessthan = %d\", lessthan);                               \n                if(lessthan) dup2(fileno_in, STDIN_FILENO);\n                dup2(fd[i][1], STDOUT_FILENO);\n\n                }\n\n            else if(i != num_commands - 1)\n            {\n\n                 dup2(fd[i - 1][1], STDIN_FILENO);\n\n            //process(&amp;greaterthan, &amp;d_greaterthan, &amp;args_pipe[i] ,&amp;nargs_p, &amp;fileno_out, &amp;fileno_in, &amp;lessthan, &amp;fout, &amp;fin);\n\n                dup2(fd[i][1], STDOUT_FILENO);\n            }\n\n            else\n            {           \n                dup2(fd[i - 1][1], STDIN_FILENO);   \n                process(&amp;greaterthan, &amp;d_greaterthan, &amp;args_pipe[i] ,&amp;nargs_p, &amp;fileno_out, &amp;fileno_in, &amp;lessthan, &amp;fout, &amp;fin);\n\n                printf(\"greaterthan = %d\", greaterthan);\n                printf(\"d_greaterthan = %d\", d_greaterthan);\n                if(greaterthan || d_greaterthan) dup2(fileno_out, STDOUT_FILENO);    \n                }\n\n            int close_pipes;\n            for(close_pipes = 0; close_pipes &lt; flag_count; close_pipes++) \n            {\n                //close(fd[i][0]); close(fd[i][1]); JUST, WHY?!? THIS IS WHAT HAPPENS WHEN YOU DON'T THINK!\n\n                close(fd[close_pipes][0]);\n                close(fd[close_pipes][1]);\n            }\n            if(fout != stdout) fclose(fout);\n            if(fin != stdin) fclose(fin);\n            execvp(args_pipe[0], args_pipe);\n            perror(\"Something happened.\");\n            exit(-1);\n       }//end child.\n\n\n\n\n    }   \n        for(i = 0; i &lt; flag_count; i++) {close(fd[i][0]); close(fd[i][1]);}\n        return;\n\n    }\n\n\n }\n\nint main (int argc, char* argv [])\n{\n      for(;;)\n      {\n          printf(\"COP4338$ \");\n\n         if(fgets(cmdline, BUFSIZ, stdin) == NULL)\n         {\n\n             perror(\"fgets failed\");\n             exit(1);\n         }\n            execute(cmdline);\n            int corpse;\n            int status;\n            while(corpse = wait(%status)) &gt; 0)\n                perror(pid %d exited with status: 0x%.4X\\n, corpse, status);\n       }\n\n}\n</code></pre>\n\n<p>The program is supposed to print out \"<code>int main (int argc, char* argv [])</code>\" to o.txt, but o.txt doesn't get changed at all.</p>\n\n<p>For those that are curious, the function process() scans through a string of arguments which constitute a command and sets flags depending on the symbols that the program sees.</p>\n"}, {"tags": ["c", "pointers", "struct"], "comments": [{"owner": {"reputation": 3599, "user_id": 2487517, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cRCpa.jpg?s=128&g=1", "display_name": "Tibrogargan", "link": "https://stackoverflow.com/users/2487517/tibrogargan"}, "edited": false, "score": 1, "creation_date": 1556676743, "post_id": 55930774, "comment_id": 98514862, "body": "This can help a lot: <a href=\"http://cseweb.ucsd.edu/~ricko/rt_lt.rule.html\" rel=\"nofollow noreferrer\">C Right-Left Rule</a>.  Your initial &quot;dereferencing&quot; says vform is a pointer to a pointer to a struct that contains a pointer that contains a pointer. Your code belows say vform is a dynamically allocated array of form (I&#39;m paraphrasing).  (Actually polygon[5]). You&#39;re already in trouble."}, {"owner": {"reputation": 8002, "user_id": 1143850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2927fac544c9960cd5433688fe4cae1d?s=128&d=identicon&r=PG", "display_name": "Serge", "link": "https://stackoverflow.com/users/1143850/serge"}, "edited": false, "score": 0, "creation_date": 1556677210, "post_id": 55930774, "comment_id": 98514944, "body": "there is no such field as <code>vpolygon</code> in <code>form</code>. It should be something like <code>(**(**vform).polygon).point-&gt;x</code> or <code>(*(*vform)-&gt;polygon)-&gt;point-&gt;x</code>"}, {"owner": {"reputation": 10300, "user_id": 2469027, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b62ce55f4f1a0eff6775e7863850a912?s=128&d=identicon&r=PG", "display_name": "Edward Karak", "link": "https://stackoverflow.com/users/2469027/edward-karak"}, "edited": false, "score": 0, "creation_date": 1556677307, "post_id": 55930774, "comment_id": 98514972, "body": "Also may be helpful <a href=\"http://c-faq.com/decl/spiral.anderson.html\" rel=\"nofollow noreferrer\">c-faq.com/decl/spiral.anderson.html</a>"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1556679010, "post_id": 55930774, "comment_id": 98515217, "body": "There is no need to cast the return of <code>malloc</code>, it is unnecessary. See: <a href=\"http://stackoverflow.com/q/605845/995714\">Do I cast the result of malloc?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11435212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yWkLr.jpg?s=128&g=1", "display_name": "Prot", "link": "https://stackoverflow.com/users/11435212/prot"}, "edited": false, "score": 0, "creation_date": 1556680353, "post_id": 55930999, "comment_id": 98515430, "body": "Wow, this cleared my mind. One last thing, what is the correct way to change the positions &quot;inside the polygon&quot;?  vform-&gt;(polygon+1)-&gt;point-&gt;x = 1; didn&#39;t work"}, {"owner": {"reputation": 3599, "user_id": 2487517, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cRCpa.jpg?s=128&g=1", "display_name": "Tibrogargan", "link": "https://stackoverflow.com/users/2487517/tibrogargan"}, "reply_to_user": {"reputation": 1, "user_id": 11435212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yWkLr.jpg?s=128&g=1", "display_name": "Prot", "link": "https://stackoverflow.com/users/11435212/prot"}, "edited": false, "score": 0, "creation_date": 1556681092, "post_id": 55930999, "comment_id": 98515559, "body": "@Prot to change which point <code>vform-&gt;polygon</code> refers to you can do <code>vform-&gt;polygon++</code> or <code>++vform-&gt;polygon</code> - or frankly any sort of <a href=\"/questions/394767/pointer-arithmetic\">pointer arithmetic</a>.  I think what you&#39;re after is <code>(vform-&gt;polygon + 1)-&gt;point-&gt;x = 1</code>;  But I need to caution you that without any form of bounds checking that&#39;s got a high risk"}], "tags": [], "owner": {"reputation": 3599, "user_id": 2487517, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cRCpa.jpg?s=128&g=1", "display_name": "Tibrogargan", "link": "https://stackoverflow.com/users/2487517/tibrogargan"}, "is_accepted": true, "score": 1, "last_activity_date": 1556679390, "last_edit_date": 1556679390, "creation_date": 1556678185, "answer_id": 55930999, "question_id": 55930774, "link": "https://stackoverflow.com/questions/55930774/access-value-from-a-pointer-to-a-pointer/55930999#55930999", "title": "Access value from a pointer to a pointer", "body": "<p>The code below should compile in what you seem to want.  There are however a lot of issues with what you're doing that may not be immediately obvious, but I'll go into that a little below.</p>\n\n<pre><code>typedef struct point {\n    int x;\n} point;\n\ntypedef struct polygon {\n    // dynamically allocated array of point\n    point *point;\n} polygon;\n\ntypedef struct form {\n    // dynamically allocated array of polygon\n    polygon *polygon;\n} form;\n\nform *vform;\nvform = malloc(sizeof(form) * 5);\nvform-&gt;polygon = malloc(sizeof(polygon) * 5);\nvform-&gt;polygon-&gt;point = malloc(sizeof(point) * 5);\nvform-&gt;polygon-&gt;point-&gt;x = 1;\n</code></pre>\n\n<p>First issue is that you're mixing up your <em>variables</em> with the members of your <em>structures</em>.  Your <code>form</code> structure has no element called \"vpolygon\".  Just because your  \"vpolygon\" variable is a <code>polygon</code> structure doesn't mean you can suddenly refer to the <code>polygon</code> member of a <code>form</code> variable by calling it \"vpolygon\".</p>\n\n<p>Secondly, you're casting the return value of <code>malloc</code>.  Don't do this.  See <a href=\"/questions/605845/do-i-cast-the-result-of-malloc\">do I cast the result of malloc</a></p>\n\n<p>Thirdly, your form <code>malloc</code> is allocationing enough memory for 5 form structures, but casting the result to a pointer to a pointer to form.  The malloc should possibly be <code>malloc(sizeof(form *) * 5)</code> but I'm guessing you really meant <code>(vform *)malloc...</code> not <code>(vform **)malloc...</code>.</p>\n\n<p>Fourth, you're dynamically allocating arrays and pointing your variables at the first element in the array but you don't seem to have any mechanism to detect the size of the array.  You need a method to track the size of the array so you don't accidentally cause a segmentation fault by going off the end of the array.  (Three common methods: 1) track the number of elements allocated. 2) Mark the end of the array with some marker value and check for if, 3) hard-code it.  All have trade-offs)</p>\n\n<p>Fifth.  You want to store the original value returned by <code>malloc</code> so you can <code>free</code> it at some point - if you modify what <code>vfrom</code> points to you'll lose that original address and cause memory leaks.</p>\n"}], "owner": {"reputation": 1, "user_id": 11435212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yWkLr.jpg?s=128&g=1", "display_name": "Prot", "link": "https://stackoverflow.com/users/11435212/prot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 55930999, "answer_count": 1, "score": -1, "last_activity_date": 1556679390, "creation_date": 1556675827, "last_edit_date": 1556675946, "question_id": 55930774, "link": "https://stackoverflow.com/questions/55930774/access-value-from-a-pointer-to-a-pointer", "title": "Access value from a pointer to a pointer", "body": "<p>I am trying to access a field from a struct through a pointer of pointer</p>\n\n<p>I tried:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>(**vform).vpolygon-&gt;point-&gt;x = 1;                                               \n</code></pre>\n\n<p>But doesn't worked.</p>\n\n<p>code:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef struct point{\n    int x;\n}point;\ntypedef struct polygon{\n    point *point;\n}polygon;\ntypedef struct form{\n    polygon **polygon;\n}form;\nvoid main(){\n      polygon *vpolygon;\n      form **vform;\n      vpolygon = (polygon *)malloc(sizeof(polygon)*5);\n      vform = (form **)malloc(sizeof(form)*5);\n      vpolygon-&gt;point-&gt;x = 1;\n      vform-&gt;vpolygon-&gt;point-&gt;x = 1;\n}\n\n</code></pre>\n\n<p>I expect the program compile, but the actual output is </p>\n\n<pre class=\"lang-c prettyprint-override\"><code>18:12: error: '*vform' is a pointer; did you mean to use '-&gt;'?\n       vform-&gt;vpolygon-&gt;point-&gt;x = 1;\n            ^~\n            -&gt;\n</code></pre>\n"}, {"tags": ["c++", "c", "scanf", "visual-c++-2013"], "comments": [{"owner": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 2, "creation_date": 1556675788, "post_id": 55930726, "comment_id": 98514697, "body": "The code seems to work for me.  Can you make an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>?"}, {"owner": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 0, "creation_date": 1556675805, "post_id": 55930726, "comment_id": 98514701, "body": "I am not sure this is related, but shouldn&#39;t you nul-terminate <code>buf</code>?"}, {"owner": {"reputation": 1680, "user_id": 5282154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a468ae12f72b587ad0c4e89ffde11839?s=128&d=identicon&r=PG", "display_name": "doug", "link": "https://stackoverflow.com/users/5282154/doug"}, "edited": false, "score": 0, "creation_date": 1556675896, "post_id": 55930726, "comment_id": 98514715, "body": "<code>fgets</code> stops at EOL or <code>\\0</code>  So it&#39;s dependent on the data stored go read correctly."}, {"owner": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 0, "creation_date": 1556675992, "post_id": 55930726, "comment_id": 98514729, "body": "Specifically, <a href=\"https://pastebin.com/qcRgef9V\" rel=\"nofollow noreferrer\">this code</a> outputs <code>0.993049, 0.993049, 0.993049</code> which seems to be right."}, {"owner": {"reputation": 4392, "user_id": 7098259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b6nWr.jpg?s=128&g=1", "display_name": "Patrick Parker", "link": "https://stackoverflow.com/users/7098259/patrick-parker"}, "reply_to_user": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 0, "creation_date": 1556676227, "post_id": 55930726, "comment_id": 98514768, "body": "@NateEldredge I posted the MCVE and added a note about my compiler"}, {"owner": {"reputation": 4392, "user_id": 7098259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b6nWr.jpg?s=128&g=1", "display_name": "Patrick Parker", "link": "https://stackoverflow.com/users/7098259/patrick-parker"}, "reply_to_user": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 0, "creation_date": 1556676538, "post_id": 55930726, "comment_id": 98514832, "body": "ok, I posted the entire main.cpp as requested @NateEldredge and I&#39;d be grateful if you undo your close vote if that was you"}, {"owner": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 2, "creation_date": 1556676689, "post_id": 55930726, "comment_id": 98514857, "body": "It wasn&#39;t me, I don&#39;t have enough reputation to cast close votes.  One thing I noticed, the documentation at <a href=\"https://docs.microsoft.com/en-us/cpp/c-runtime-library/scanf-width-specification?view=vs-2019\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/cpp/c-runtime-library/&hellip;</a> does not actually say that <code>%la</code> is allowed..."}, {"owner": {"reputation": 22422, "user_id": 634919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f4a87fe094961af20263d8e7ff445b2?s=128&d=identicon&r=PG", "display_name": "Nate Eldredge", "link": "https://stackoverflow.com/users/634919/nate-eldredge"}, "edited": false, "score": 0, "creation_date": 1556676950, "post_id": 55930726, "comment_id": 98514898, "body": "Just as a guess, if you change <code>%la</code> to <code>%lf</code>, what happens?  I think the standard says that all of <code>aeEfFgG</code> are supposed to behave identically for <code>scanf</code>, including the handling of hex floats (<a href=\"https://en.cppreference.com/w/c/io/fscanf\" rel=\"nofollow noreferrer\">en.cppreference.com/w/c/io/fscanf</a>).  The MS documentation I linked above doesn&#39;t mention handling hex floats with <code>f</code>, but maybe it will work anyway..."}, {"owner": {"reputation": 16020, "user_id": 9716597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f97c613dca0b157b40551a0d756abeb?s=128&d=identicon&r=PG&f=1", "display_name": "L. F.", "link": "https://stackoverflow.com/users/9716597/l-f"}, "edited": false, "score": 1, "creation_date": 1556677037, "post_id": 55930726, "comment_id": 98514915, "body": "This code <a href=\"https://wandbox.org/permlink/3mFxZf49Pobly5cG\" rel=\"nofollow noreferrer\">works on gcc</a>. This code <a href=\"https://wandbox.org/permlink/vHmtuZPGNBwVeYAC\" rel=\"nofollow noreferrer\">works on clang</a>."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1556677658, "post_id": 55930726, "comment_id": 98515032, "body": "Possible Duplicate <a href=\"https://stackoverflow.com/questions/47464440/sscanf0x80-9-f-value-sets-value-to-a-hex-float-not-a-float\">sscanf(\u201c0X80.9\u201d, \u201c%f\u201d, &amp;value) sets value to a hex float not a float</a> about VS13"}, {"owner": {"reputation": 4392, "user_id": 7098259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b6nWr.jpg?s=128&g=1", "display_name": "Patrick Parker", "link": "https://stackoverflow.com/users/7098259/patrick-parker"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1556727856, "post_id": 55930726, "comment_id": 98531797, "body": "@DavidC.Rankin thanks, although that one is trying to get 2013 behavior in 2015, whereas I am trying to get 2015 behavior in 2013. I am kinda shocked that they still had not implemented a compliant <code>strtod</code> in 2013. Now what? Write it myself?"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1556733071, "post_id": 55930726, "comment_id": 98534088, "body": "The challenge is that your hex values are hex-float values, otherwise if they were simply hex, you could read as unsigned long and then use a union between double and unsigned long. With the hexfloat format you will have to piece it together yourself. Presumably the information can be translated into a sign-bit, a biased exponent and normalized mantissa. At that point it is just a matter of shifting bits."}, {"owner": {"reputation": 4392, "user_id": 7098259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b6nWr.jpg?s=128&g=1", "display_name": "Patrick Parker", "link": "https://stackoverflow.com/users/7098259/patrick-parker"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1556739326, "post_id": 55930726, "comment_id": 98536598, "body": "@DavidC.Rankin by &quot;union&quot; you mean something equivalent to a reinterpret_cast, right? I need to send the source code and data files to a third party, who has his own compiler. And I assume I would lose platform-compatibility if I reinterpreted the double from raw bytes."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1556740291, "post_id": 55930726, "comment_id": 98537012, "body": "@PatrickParker Isn&#39;t it shocking that Microsoft doesn&#39;t want to make a <i>C</i> compiler for their platform &lt;3"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1556752065, "post_id": 55930726, "comment_id": 98540598, "body": "@PatrickParker yes that is the basic gest, but use of a <code>union</code> is the way provided by the C standard to avoid the <i>strict aliasing</i> violation. You generally want to avoid a direct cast."}], "answers": [{"tags": [], "owner": {"reputation": 4392, "user_id": 7098259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b6nWr.jpg?s=128&g=1", "display_name": "Patrick Parker", "link": "https://stackoverflow.com/users/7098259/patrick-parker"}, "is_accepted": true, "score": 1, "last_activity_date": 1556729028, "creation_date": 1556729028, "answer_id": 55939590, "question_id": 55930726, "link": "https://stackoverflow.com/questions/55930726/sscanf-fails-to-read-double-hex/55939590#55939590", "title": "sscanf fails to read double hex", "body": "<p>Microsoft VS2013 <code>strtod</code>, <code>sscanf</code>, and <code>istringstream</code>, etc. did <strong>not</strong> implement the c99 c++11 standard and they <strong>cannot</strong> parse hex floats or hex doubles.</p>\n\n<ul>\n<li><p>Related Bug Report:</p>\n\n<p><a href=\"https://github.com/JuliaLang/julia/issues/6349\" rel=\"nofollow noreferrer\">https://github.com/JuliaLang/julia/issues/6349</a></p></li>\n</ul>\n"}], "owner": {"reputation": 4392, "user_id": 7098259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b6nWr.jpg?s=128&g=1", "display_name": "Patrick Parker", "link": "https://stackoverflow.com/users/7098259/patrick-parker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 2, "accepted_answer_id": 55939590, "answer_count": 1, "score": 2, "last_activity_date": 1556739491, "creation_date": 1556675370, "last_edit_date": 1556739491, "question_id": 55930726, "link": "https://stackoverflow.com/questions/55930726/sscanf-fails-to-read-double-hex", "title": "sscanf fails to read double hex", "body": "<p>I need to preserve the exact binary representation of some doubles in a text file with other ascii values, so I am using \"%a\" as suggested in <a href=\"https://stackoverflow.com/a/4740044/7098259\">this</a> question.</p>\n\n<pre><code>fprintf (pFile, \"Scale: %a, %a, %a\\n\", scale.x, scale.y, scale.z);\n</code></pre>\n\n<p>However, when I try to read it in with \"%la\" the scanf returns 0 items read. </p>\n\n<pre><code>double x=0, y=0, z=0;\nfgets(buf, sizeof buf, pFile);\nint test = sscanf (buf, \"Scale: %la, %la, %la\\n\", &amp;x, &amp;y, &amp;z);\n// test is zero!\n</code></pre>\n\n<p>When I open up the debugger, I see that the string buffer is exactly as I expected it.</p>\n\n<blockquote>\n  <p>buf   ... \"Scale: 0x1.fc70e3p-1, 0x1.fc70e3p-1, 0x1.fc70e3p-1\\n\"  ...\n  char[1000]</p>\n</blockquote>\n\n<p>So why can't it read it?</p>\n\n<p>As requested by <a href=\"https://stackoverflow.com/users/634919/nate-eldredge\">Nate Eldredge</a>, here is my MCVE version:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nint main(int argc, char *argv[])\n{\n    double x=0, y=0, z=0;\n    const char* buf = \"Scale: 0x1.fc70e3p-1, 0x1.fc70e3p-1, 0x1.fc70e3p-1\\n\";\n    int test = sscanf(buf, \"Scale: %la , %la , %la\", &amp;x, &amp;y, &amp;z);\n    // test is zero!\n}\n</code></pre>\n\n<p>Note: I am using MS Visual Studio 2013</p>\n\n<p>Second Note:  I need to send the source code and data files to a third party, who has his own compiler. So the save format has to be relatively platform-independent.</p>\n"}, {"tags": ["c", "linux", "driver", "termios"], "comments": [{"owner": {"reputation": 100758, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 3, "creation_date": 1556675661, "post_id": 55930695, "comment_id": 98514681, "body": "That is not a form of echo. Programs do that by simply writing <code>*</code> in response to every character they read without echo."}, {"owner": {"reputation": 35, "user_id": 7543958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8d7609b291e7d1df1db94d88a6835e4?s=128&d=identicon&r=PG&f=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/7543958/nick"}, "reply_to_user": {"reputation": 100758, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "edited": false, "score": 0, "creation_date": 1556676098, "post_id": 55930695, "comment_id": 98514752, "body": "I am not sure I understand what you mean. When I have the flashing cursor, and I type &quot;password&quot;, I want to see &quot;********&quot; in the terminal. One * each time I press a key."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 7543958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8d7609b291e7d1df1db94d88a6835e4?s=128&d=identicon&r=PG&f=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/7543958/nick"}, "edited": false, "score": 0, "creation_date": 1556681696, "post_id": 55931083, "comment_id": 98515663, "body": "exactly what I was looking for. thank you. I only thought it had to do with ECHO because that is what was handling the output to the screen."}], "tags": [], "owner": {"reputation": 100758, "user_id": 1899640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47374ccb28e4b0d2454b64f7b975bc66?s=128&d=identicon&r=PG", "display_name": "that other guy", "link": "https://stackoverflow.com/users/1899640/that-other-guy"}, "is_accepted": true, "score": 3, "last_activity_date": 1556679245, "creation_date": 1556679245, "answer_id": 55931083, "question_id": 55930695, "link": "https://stackoverflow.com/questions/55930695/how-to-change-the-echo-character-in-a-linux-terminal/55931083#55931083", "title": "How to change the echo character in a linux terminal", "body": "<p>The feature you describe is unrelated to echo. Instead, you implement it yourself by simply reading a character and writing a <code>*</code> in a loop:</p>\n\n<pre><code>#include &lt;termios.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n\n\nint main() {\n    char c;\n    char p = '*';\n    struct termios term, original;\n    tcgetattr(STDIN_FILENO, &amp;term);\n    original = term;\n    term.c_lflag &amp;= ~ECHO &amp; ~ICANON;\n    tcsetattr(STDIN_FILENO, TCSANOW, &amp;term);\n\n    while (read(STDIN_FILENO, &amp;c, 1) == 1 &amp;&amp; c != '\\n')\n        write(STDOUT_FILENO, &amp;p, 1);\n    printf(\"\\n\");\n\n    tcsetattr(STDIN_FILENO, TCSANOW, &amp;original);\n    return 0;\n}\n</code></pre>\n\n<p>When you run it and type things, all you see are <code>*</code>s:</p>\n\n<pre><code>$ gcc foo.c &amp;&amp; ./foo\n***********\n</code></pre>\n\n<p>It's up to the program to store the string, handle backspace, and only show a single <code>*</code> per multibyte character.</p>\n"}], "owner": {"reputation": 35, "user_id": 7543958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8d7609b291e7d1df1db94d88a6835e4?s=128&d=identicon&r=PG&f=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/7543958/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 55931083, "answer_count": 1, "score": 1, "last_activity_date": 1556679245, "creation_date": 1556674997, "question_id": 55930695, "link": "https://stackoverflow.com/questions/55930695/how-to-change-the-echo-character-in-a-linux-terminal", "title": "How to change the echo character in a linux terminal", "body": "<p>I am interested in gathering a password from a user.</p>\n\n<p>When the user is prompted for their password, I want to echo back to them * (asterisks) for each character they input. </p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>void changeEcho() {\n    termios term;\n    tcgetattr(STDIN_FILENO, &amp;term);\n    term.c_lflag &amp;= ~ECHO;\n    tcsetattr(STDIN_FILENO, TCSANOW, &amp;term);\n}\n</code></pre>\n\n<p>I know that this will turn the echo off, but I am interested in echoing something that I choose, in my case '*'.</p>\n"}, {"tags": ["c", "gcc", "assembly", "x86-64"], "comments": [{"owner": {"reputation": 246, "user_id": 1415334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2b78189f4ac4aa554e638cdd3d6a6cb?s=128&d=identicon&r=PG", "display_name": "hingev", "link": "https://stackoverflow.com/users/1415334/hingev"}, "edited": false, "score": 2, "creation_date": 1556669578, "post_id": 55930120, "comment_id": 98513651, "body": "Canary is supposed the go into stack, it&#39;s the whole meaning of the stack canary. It is there as a simple protection from stack smashing attacks, where the return address is overwritten."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "reply_to_user": {"reputation": 246, "user_id": 1415334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2b78189f4ac4aa554e638cdd3d6a6cb?s=128&d=identicon&r=PG", "display_name": "hingev", "link": "https://stackoverflow.com/users/1415334/hingev"}, "edited": false, "score": 0, "creation_date": 1556670186, "post_id": 55930120, "comment_id": 98513762, "body": "So, if I&#39;m reading this correctly, it goes right above the return address? That makes sense, so what size is the canary ?"}, {"owner": {"reputation": 246, "user_id": 1415334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2b78189f4ac4aa554e638cdd3d6a6cb?s=128&d=identicon&r=PG", "display_name": "hingev", "link": "https://stackoverflow.com/users/1415334/hingev"}, "edited": false, "score": 0, "creation_date": 1556670495, "post_id": 55930120, "comment_id": 98513814, "body": "Yes, so that in case of an overflow, it would get overwritten, and before returning from the function, <b>stk_chck_fail</b> be called if the value put there is not the same read, so it could call <b>abort</b> and quit."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "reply_to_user": {"reputation": 246, "user_id": 1415334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2b78189f4ac4aa554e638cdd3d6a6cb?s=128&d=identicon&r=PG", "display_name": "hingev", "link": "https://stackoverflow.com/users/1415334/hingev"}, "edited": false, "score": 0, "creation_date": 1556670612, "post_id": 55930120, "comment_id": 98513836, "body": "Okay, so is that why it takes up 8 bits, because it takes a pointer on the frame all its own to protect the return value?"}, {"owner": {"reputation": 246, "user_id": 1415334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2b78189f4ac4aa554e638cdd3d6a6cb?s=128&d=identicon&r=PG", "display_name": "hingev", "link": "https://stackoverflow.com/users/1415334/hingev"}, "edited": false, "score": 0, "creation_date": 1556670751, "post_id": 55930120, "comment_id": 98513861, "body": "It takes 32 bits for x86 and 64 bits for x86-64. So 4 bytes or 8 bytes depending on the architecture."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "reply_to_user": {"reputation": 246, "user_id": 1415334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2b78189f4ac4aa554e638cdd3d6a6cb?s=128&d=identicon&r=PG", "display_name": "hingev", "link": "https://stackoverflow.com/users/1415334/hingev"}, "edited": false, "score": 0, "creation_date": 1556671278, "post_id": 55930120, "comment_id": 98513937, "body": "Okay, I&#39;m working with the x86-64 architecture so, 8 bytes. :)"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1556674888, "post_id": 55930120, "comment_id": 98514551, "body": "@Matthew_J_Barnes Inconsistency in your question: It&#39;s 8 <i>bytes</i>, not 8 <i>bits</i>. Do <i>not</i> confuse the two -- it can be very dangerous."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1556687598, "post_id": 55930120, "comment_id": 98516776, "body": "You should read a basic tutorial on assembler or something before trying to decipher anything. Anyone who has read the basic tutorial on 64-bit x86 asm would know instantly that <code>%rax</code> is 64 bit and the same information is carried by the <code>q</code> prefix of <code>mov</code> as well."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556724142, "post_id": 55930120, "comment_id": 98530087, "body": "@Antti Haapala. . .Yes, I know %rax is 64 bits. . . I read the chapter. . . I&#39;m well aware that movq is a  64 bit carrier. . . . Just as movl is 32 bits and movw is 16 and movb is 8. Why is that even being questioned?"}], "answers": [{"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556681531, "post_id": 55930195, "comment_id": 98515635, "body": "<i>Storing them in registers is only justified for speed optimizations.</i> But the OP <i>did</i> compile with optimization enabled.  Variables <i>are</i> stored in registers or optimized away, except of course for the array, and the var that has to be in memory when its address is passed to another function."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "edited": false, "score": 0, "creation_date": 1556723947, "post_id": 55930195, "comment_id": 98529961, "body": "I did not compile at all, this was literally an example IN the book Operating Systems a programmers perspective."}], "tags": [], "owner": {"reputation": 246, "user_id": 1415334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2b78189f4ac4aa554e638cdd3d6a6cb?s=128&d=identicon&r=PG", "display_name": "hingev", "link": "https://stackoverflow.com/users/1415334/hingev"}, "is_accepted": true, "score": 0, "last_activity_date": 1556669855, "creation_date": 1556669855, "answer_id": 55930195, "question_id": 55930120, "link": "https://stackoverflow.com/questions/55930120/why-does-this-program-dispense-the-following-canary-values-and-assembly-code/55930195#55930195", "title": "Why does this program dispense the following canary values and assembly code?", "body": "<p>Stack canary - is a method of protection against stack smashing attacks, which tend to be comment if an overflow is left. So that's why, by default, <em>gcc</em> will insert canary checks if a function has an internal buffer that's allocated from stack.</p>\n\n<p>This can be turned off, using <code>-fno-stack-protector</code>.</p>\n\n<p>Also the size which triggers <em>gcc</em> to add the canary is chosen by <code>ssp-buffer-size</code>.</p>\n\n<p>Find out more <a href=\"https://stackoverflow.com/a/24467902/1415334\">here</a></p>\n\n<p>As for <em>why are local variables stored in stack ?</em> - well, where else would you store them. You can specify that a variable be optimized as a register with the <code>register</code> keyword, but it's not a guarantee. The number of your registers is limited, far less than what stack could handle. Storing them in registers is only justified for speed optimizations.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "edited": false, "score": 0, "creation_date": 1556724318, "post_id": 55931881, "comment_id": 98530182, "body": "Okay, Peter. . . .This is not a book on 32 bit 86 it&#39;s a book on 86x64-bit. Secondly, I did not compile anything. Thirdly, I did not even write this program. . . This is a problem written in a book a homework for an entry level class on Computer Architecture is based on said problem. Half of the things you mentioned have never been brought up, suggested or used. . . . While your bredth of knowledge is VERY impressive, I&#39;m wondering what it&#39;s relevance is to my question."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556730920, "post_id": 55931881, "comment_id": 98533054, "body": "@Matthew_J_Barnes: I thought I made the first section of the answer pretty clear: the compiler is putting things in memory only when it has to because the code takes the address and passes it to another function.  And if your book is talking about x86-64, then maybe they mean 6 call-clobbered registers?  But that&#39;s not correct for the x86-64 System V calling convention they&#39;re using.  There are 6 arg-passing registers plus RAX, R10, and R11 which are also call-clobbered and thus can be freely used without save/restore."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "edited": false, "score": 0, "creation_date": 1556737880, "post_id": 55931881, "comment_id": 98536049, "body": "Jesus Christ you&#39;re brilliant. . . . . . So, what you&#39;re saying is. . . Because I have a variable that gets passed to another function, there is no need to store it in registers but rather the stack pointer, right? Also, can you recommend some text or learning tools to me? I would very much like to work at Silicon Valley before I&#39;m 30."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556738383, "post_id": 55931881, "comment_id": 98536220, "body": "@Matthew_J_Barnes: The compiler always <i>wants</i> to keep everything in registers, or optimize away completely.  So instead of saying &quot;no need&quot;, I&#39;d instead say &quot;no <i>opportunity</i>&quot;, because you don&#39;t do anything with the variable other than pass it <i>by reference</i> to another function.  If you passed it by value, the value would just get copied to a register."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556738495, "post_id": 55931881, "comment_id": 98536268, "body": "@Matthew_J_Barnes: If you want to learn more about asm, <a href=\"https://stackoverflow.com/tags/x86/info\">stackoverflow.com/tags/x86/info</a> has some good resources.  Looking at compiler output for simple functions like this is a good way to get started, though.  <a href=\"//stackoverflow.com/q/38552116\">How to remove &quot;noise&quot; from GCC/clang assembly output?</a> and especially Matt Godbolt&#39;s CppCon2017 talk <a href=\"https://youtu.be/bSkpMdDe4g4\" rel=\"nofollow noreferrer\">\u201cWhat Has My Compiler Done for Me Lately? Unbolting the Compiler&#39;s Lid\u201d</a> is great."}], "tags": [], "owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": false, "score": 0, "last_activity_date": 1556687435, "creation_date": 1556687435, "answer_id": 55931881, "question_id": 55930120, "link": "https://stackoverflow.com/questions/55930120/why-does-this-program-dispense-the-following-canary-values-and-assembly-code/55931881#55931881", "title": "Why does this program dispense the following canary values and assembly code?", "body": "<blockquote>\n  <p>the book makes it very clear that you have six registers available to put six variables into</p>\n</blockquote>\n\n<p>You're reading a book about 32-bit x86.  (And the book assumes EBP will be used as a frame pointer, leaving only 6 of the 8 integer regs as truly general purpose)</p>\n\n<p>You're compiling for x86-64 with optimization enabled, which includes <code>-fomit-frame-pointer</code>, so you actually have 15 general-purpose integer registers.</p>\n\n<blockquote>\n  <p>What I need to know is why the program [function] <code>intlen()</code> <strong>puts all of its values onto the stack</strong></p>\n</blockquote>\n\n<p>That's <em>not</em> quite what's going on.  <code>x</code> stays in RDI instead of being spilled to the stack on function entry, like you'd get if you disabled optimization (<code>gcc -O0</code>).  Compile without optimization to see a big difference.</p>\n\n<p>The compiler <em>is</em> keeping vars in regs as much as possible, but <code>v</code> and <code>buf</code> have to exist in memory because you pass pointers to them to a non-inline function.</p>\n\n<p>You seem to have disabled inlining of <code>iptoa</code> somehow.  Maybe you compiled with only <code>-O1</code>, because you don't have <code>__attribute__((noinline))</code> on your definition of <code>iptoa</code>.  If you enabled full optimization (<code>-O3</code>), you'd see that <code>v</code> is optimized away and you just get a <code>movq %rdi, %rdx</code> to pass <code>x</code> as the 3rd arg to <code>sprintf</code>.</p>\n\n<p><strong>Passing <code>&amp;v</code> to a non-inline <code>iptoa</code> means the memory for <code>v</code> has to be \"in sync\"</strong>, because <code>iptoa</code> is allowed to read that memory via the pointer you passed it.  See also <a href=\"https://en.wikipedia.org/wiki/Escape_analysis\" rel=\"nofollow noreferrer\">\"escape analysis\"</a> - if a pointer to a variable \"escapes\" the function, the compiler can't optimize it away or do too many weird things with it.</p>\n\n<p>IDK why you're passing an integer by reference; you've written code that forces the compiler to use memory for most of its variables.  (If it can't inline.)</p>\n\n<hr>\n\n<p>BTW, you know your function is very inefficient, right?  <strong>You don't need to calculate every decimal digit with sprintf</strong>, just find the first power of 10 that's greater-than the number.</p>\n\n<pre><code>int intlen_fast(long x) {\n    unsigned long absx = x;\n    unsigned len = 1;      // even 0..9 takes 1 decimal digit\n    if (x&lt;0) {\n        absx = -x;         // unsigned abs correctly handles the most-negative 2's complement integer\n        len = 2;           // the minus sign\n    }\n\n    // don't need to check for overflow of pow10 with 64-bit integers\n    // but in general we do to get the right count. (TODO)\n    for (unsigned long pow10 = 10; pow10 &lt;= absx ; pow10*=10) {\n        len++;\n    }\n    return len;\n}\n</code></pre>\n\n<p>Doing <code>pow10 *= 10;</code> is significantly more efficient than <code>x /= 10</code>, even with optimized division by a compile-time constant.</p>\n\n<p>For 64-bit <code>unsigned long</code>, this has the very nice property that <code>abs(LLONG_MIN) = 9223372036854775808ULL</code>, and the next highest power of 10 doesn't overflow <code>unsigned long long</code>.  (<code>ULLONG_MAX</code> = 18446744073709551615ULL)</p>\n\n<p>If that wasn't the case (like for 32-bit <code>unsigned long</code> in other ABIs), you'd need to check for the special case of <code>absx &gt;= 1000000000</code> to correctly handle input magnitudes in the range <code>1000000000</code> to <code>2147483648</code>, because 2^32-1 = <code>4294967296</code>.  (Fortunately we don't get an infinite loop, just 2 extra iterations until <code>pow10</code> = 0xd4a51000 which is unsigned above the magnitude of any signed 32-bit integer.  But it's still the wrong answer!)</p>\n\n<p>In general, C++ has <a href=\"https://en.cppreference.com/w/cpp/types/numeric_limits/digits10\" rel=\"nofollow noreferrer\"><code>std::numeric_limits&lt;long&gt;::digits10</code> vs. <code>std::numeric_limits&lt;unsigned long&gt;::digits10</code></a> might be useful for detecting at compile-time whether we need an extra check.  Or actually not, because it rounds down for the binary bit-width times <code>std::log10(2)</code>.</p>\n\n<p>Maybe a compile-time check based on  <a href=\"https://stackoverflow.com/questions/22491505/how-to-round-down-to-the-nearest-power-of-10\">How to round down to the nearest power of 10?</a> of <code>LONG_MAX</code> being less than that of <code>ULONG_MAX</code>, if your compiler can do constant-propagation through <code>floor(log10(ULONG_MAX))</code>.</p>\n\n<hr>\n\n<p>If you didn't want to worry about the details of <code>pow10</code> maybe overflowing, it would still be much faster than calling <code>sprintf</code> to just do repeated division by 10 to count digits.</p>\n\n<p>Or maybe do one division by 10, and then loop <code>pow10</code> upward.  That would be safe from overflow / wraparound, and simple.  (But you still have to handle negative input specially).</p>\n\n<hr>\n\n<p>But anyway, the optimized version from <code>gcc8.3 -O3</code> does keep all its variables in registers, of course (<a href=\"https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(fontScale:1.2899450879999999,j:1,lang:c%2B%2B,source:&#39;/*+C+Code+*/+%0A%23include+%3Cstring.h%3E%0A%23include+%3Cstdio.h%3E%0A%0Aint+len(char+*s)%7B%0A++return+strlen(s)%3B%0A%7D%0A%0A__attribute__((noinline))%0Avoid+iptoa(char+*s,+long+*p)%7B%0A++long+val+%3D+*p%3B+%0A++sprintf(s,+%22%25ld%22,+val)%3B+%0A%7D%0A%0Aint+intlen(long+x)%7B%0A++long+v%3B+%0A++char+buf%5B12%5D%3B%0A++v+%3D+x%3B+%0A++iptoa(buf,+%26v)%3B+%0A++return+len(buf)%3B+%0A%7D%0A%0A%0Aint+intlen_fast(long+x)+%7B%0A++++unsigned+long+absx+%3D+x%3B%0A++++unsigned+len+%3D+1%3B%0A++++if+(x%3C0)+%7B%0A++++++++absx+%3D+-x%3B+++++++++//+unsigned+abs+correctly+handles+the+most-negative+2!&#39;s+complement+integer%0A++++++++len+%3D+2%3B+++++++++++//+the+minus+sign%0A++++%7D%0A%0A++++//+don!&#39;t+need+to+check+for+overflow+of+pow10+with+64-bit+integers%0A++++//+but+in+general+we+do+to+get+the+right+count.+(TODO)%0A++++for+(unsigned+long+pow10+%3D+10%3B+pow10+%3C%3D+absx+%3B+pow10*%3D10)+%7B%0A++++++++len%2B%2B%3B%0A++++%7D%0A++++return+len%3B%0A%7D%0A%0A//+compile+with+-O3+to+evaluate+the+call+at+compile+time+so+the+result+is+in+the+asm%0Aint+test1()+%7B+return+intlen_fast(1001)%3B+%7D%0Aint+test2()+%7B+return+intlen_fast(-9)%3B+%7D%0Aint+test3()+%7B+return+intlen_fast(-10)%3B+%7D%0A%23include+%3Climits.h%3E%0Aint+test4()+%7B+return+intlen_fast(+INT_MIN+)%3B+%7D%0Aint+test5()+%7B+return+intlen_fast(+LONG_MIN+)%3B+%7D&#39;),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;C%2B%2B+source+%231&#39;,t:&#39;0&#39;)),k:50.67340067340067,l:&#39;4&#39;,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;),(g:!((h:compiler,i:(compiler:g83,filters:(b:&#39;0&#39;,binary:&#39;1&#39;,commentOnly:&#39;0&#39;,demangle:&#39;0&#39;,directives:&#39;0&#39;,execute:&#39;1&#39;,intel:&#39;1&#39;,libraryCode:&#39;1&#39;,trim:&#39;1&#39;),fontScale:1.2899450879999999,lang:c%2B%2B,libs:!(),options:&#39;-O3+-fstack-protector-strong+-fverbose-asm&#39;,source:1),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;x86-64+gcc+8.3+(Editor+%231,+Compiler+%232)+C%2B%2B&#39;,t:&#39;0&#39;)),k:49.32659932659933,l:&#39;4&#39;,m:100,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;)),l:&#39;2&#39;,n:&#39;0&#39;,o:&#39;&#39;,t:&#39;0&#39;)),version:4\" rel=\"nofollow noreferrer\"><strong>Godbolt compiler explorer</strong></a>).  <code>-fstack-protector-strong</code> has no effect on this function because it doesn't have any arrays.</p>\n\n<pre><code># gcc8.3 -O3 -fverbose-asm -fstack-protector-strong\nintlen_fast(long):\n        testq   %rdi, %rdi    # x\n        js      .L14        #,\n        movl    $1, %eax        #, &lt;retval&gt;\n        movl    $1, %edx        #, len\n.L15:\n        cmpq    $9, %rdi        #, absx\n        jbe     .L13      #,\n        movl    $10, %eax       #, pow10\n.L17:\n        leaq    (%rax,%rax,4), %rax     #, tmp95    # pow10 * 5\n        addl    $1, %edx        #, len\n        addq    %rax, %rax      # pow10             # pow10 *= 10\n        cmpq    %rax, %rdi      # pow10, absx\n        jnb     .L17      #,\n        movl    %edx, %eax      # len, &lt;retval&gt;\n.L13:\n        ret     \n.L14:\n        negq    %rdi    # absx\n        movl    $2, %eax        #, &lt;retval&gt;\n        movl    $2, %edx        #, len\n        jmp     .L15      #\n</code></pre>\n\n<p>(It looks like a missed optimization that gcc sets both EAX and EDX.  It should just use RDX inside the loop for <code>pow10</code> and use <code>len</code> in EAX.)</p>\n\n<p>See the Godbolt link for some test callers that show it works for corner cases like <code>-9</code>, <code>99</code>, <code>100</code>, and <code>101</code> without off-by-one errors.  And for large inputs.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10643054"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 0, "accepted_answer_id": 55930195, "answer_count": 2, "score": -1, "last_activity_date": 1556687435, "creation_date": 1556669013, "last_edit_date": 1556680381, "question_id": 55930120, "link": "https://stackoverflow.com/questions/55930120/why-does-this-program-dispense-the-following-canary-values-and-assembly-code", "title": "Why does this program dispense the following canary values and assembly code?", "body": "<p>So in the following program intlen() written in this book, when I read the assembly language that corresponds to this program intlen() provides a protected Canary value, as well as several values that are ALL placed onto the stack. </p>\n\n<p>My problem with this is that the book makes it very clear that you have six registers available to put six variables into, and once you put these variables into the registers and once you go past 6 registers, THEN everything goes onto the stack. </p>\n\n<p>What I need to know is why the program intlen() puts all of its values onto the stack and understand why the canary value is placed where it is.</p>\n\n<p>I've already tried google searching the answer as well as counting the variables and arguments in previous programs, because 'calling' is still a thing, right? Thing is, these variables in the previous programs only go up to a count of four.</p>\n\n<p>Edit: I also would like to know how much len allocates on the stack pointer when protected by a Canary value. Here is how I think len works. the argument *s is worth 8 bits, the stack protector is another 8 bits since we are on a 64 bit system, and the stack frame on return is 8 bits, so it requires a total of 24 bits, right? </p>\n\n<pre><code>/* C Code */ \nint len(char *s){\n  return strlen(s);\n}\n\nvoid iptoa(char *s, long *p){\n  long val = *p; \n  sprintf(s, \"%ld\", val); \n}\n\nint intlen(long x){\n  long v; \n  char buf[12]; \n  v = x; \n  iptoa(buf, &amp;v); \n  return len(buf); \n}\n</code></pre>\n\n<p>=====assembly counterpart=======</p>\n\n<p><strong>without stack protector</strong></p>\n\n<pre><code>1. intlen: \n2. subq  $40, %rsp \n3. movq %rdi, 24(rsp) \n4. leaq 24(%rsp), %rsi\n5. movq %rsp, %rdi \n6. call iptoa \n</code></pre>\n\n<p><strong>With protector</strong></p>\n\n<pre><code>0. intlen:\n1. subq $56, %rsp  \n2. movq %fs:40, %rax  &lt; Canary Value\n3. movq %rax, 40(%rsp)  &lt; Where the Canary goes (Why does this go here?) \n4. xorl %eax, %eax \n5. movq %rdi, 8(%rsp)\n6. leaq 8(%rsp), %rsi\n7. leaq 16(%rsp), %rdi \n8. call iptoa \n</code></pre>\n\n<p>I expect most of the variables to be in registers, but everything is put onto the stack pointer as you can see, and I don't really understand why yet. Thank you for your time.</p>\n"}, {"tags": ["c", "sockets", "server", "client"], "answers": [{"tags": [], "owner": {"reputation": 636, "user_id": 9335036, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HgMz6.jpg?s=128&g=1", "display_name": "Z. Kosanovic", "link": "https://stackoverflow.com/users/9335036/z-kosanovic"}, "is_accepted": false, "score": 3, "last_activity_date": 1600088251, "last_edit_date": 1600088251, "creation_date": 1556668107, "answer_id": 55930020, "question_id": 55929885, "link": "https://stackoverflow.com/questions/55929885/how-can-i-modify-the-server-client-to-take-the-port-number-and-or-host-as-an-opt/55930020#55930020", "title": "How can I modify the server/client to take the port number and/or host as an optional command line argument?", "body": "<p>There are two arguments to the <code>main</code> function: <code>argc</code> and <code>argv</code>.</p>\n<p><code>argc</code> is a number of command line arguments passed and <code>argv</code> is the array of command line arguments.</p>\n<p>See: <a href=\"https://www.gnu.org/software/libc/manual/html_node/Program-Arguments.html\" rel=\"nofollow noreferrer\">https://www.gnu.org/software/libc/manual/html_node/Program-Arguments.html</a></p>\n<p>In your case, you can check the <code>argc</code> first for how many arguments has the user passed to your program and act accordingly.</p>\n<p>So, for the host it could be:</p>\n<pre class=\"lang-c prettyprint-override\"><code>char* host;\nif (argc &gt; 1) {\n  host = argv[1];\n}\nelse {\n  host = DEFAULT_HOST;\n}\n</code></pre>\n<p>and for the port number:</p>\n<pre class=\"lang-c prettyprint-override\"><code>int port;\nif (argc &gt; 2) {\n  port = atoi(argv[2]);\n}\nelse {\n  port = DEFAULT_PORT;\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 7834854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a817f5e10a94cf7d67eb6475b58a477?s=128&d=identicon&r=PG&f=1", "display_name": "Y. J.", "link": "https://stackoverflow.com/users/7834854/y-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1600088251, "creation_date": 1556666882, "question_id": 55929885, "link": "https://stackoverflow.com/questions/55929885/how-can-i-modify-the-server-client-to-take-the-port-number-and-or-host-as-an-opt", "title": "How can I modify the server/client to take the port number and/or host as an optional command line argument?", "body": "<p>I want to use the default host name localhost and port 8080 when I don't specify the arguments.</p>\n\n<p>server.c</p>\n\n<pre><code>#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;dirent.h&gt;\n#include &lt;sys/wait.h&gt;\n#include &lt;assert.h&gt;\n\n#include \"command.h\"\n#include \"send.h\"\n#include \"receive.h\"\n#define DEFAULT_PORT 8080\n\nvoid checkError(int status)\n{\n    if (status &lt; 0) {\n        fprintf(stderr, \"Process %d: socket error: [%s]\\n\", getpid(),strerror(errno));\n        exit(-1);\n    }\n}\n\nvoid handleNewConnection(int chatSocket);\n\nint main(int argc,char* argv[])\n{\n   short int port;\n   port = atoi(argv[1]); //When the argument is specified\n\n(...)\n</code></pre>\n\n<p>client.c</p>\n\n<pre><code>(...)\nvoid doLSCommand(int sid);\nvoid doExitCommand(int sid);\nvoid doGETCommand(int sid);\nvoid doPUTCommand(int sid);\nvoid doSIZECommand(int sid);\nint  doMGETCommand(int sid);\n\nint main(int argc,char* argv[])\n{\n    char fName[BUF_SIZE];\n\n\n    char* host;\n    short int port;\n\n    host = atoi(argv[1]); //when argument specified in command line\n    port = atoi(argv[2]); //when argument specified in command line\n\n(...)\n</code></pre>\n\n<p>I used atoi to get the arguments when they're provided but I don't know how to set defaults if they are not provided. </p>\n"}, {"tags": ["c", "arrays", "struct"], "comments": [{"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 2, "creation_date": 1556669865, "post_id": 55929764, "comment_id": 98513701, "body": "A pointer is not an array"}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556670193, "post_id": 55929764, "comment_id": 98513763, "body": "You could use either allocated memory to store the pointers, a linked list (probably what you want), or an array of pointers big enough to hold all the pointers you may need (only valid if you know a reasonable limit, but in that case it&#39;s the best option, as it doesn&#39;t involve allocating and therefore freeing memory)."}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1556682865, "post_id": 55929764, "comment_id": 98515857, "body": "What is <code>NELEMS</code>? What does <code>NELEMS(obstacles)</code> return?"}, {"owner": {"reputation": 123, "user_id": 7131190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf9fc25cd941aa90e73ccdbbc7229318?s=128&d=identicon&r=PG&f=1", "display_name": "drheinrich940", "link": "https://stackoverflow.com/users/7131190/drheinrich940"}, "reply_to_user": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556699919, "post_id": 55929764, "comment_id": 98519923, "body": "@CacahueteFrito i updated the question, as i succedded in accessing the first element , but cannot access the second one. I will try the chained list and arry of pointers approach, but i wished there was a direct solution to the actual way i am doing things."}, {"owner": {"reputation": 123, "user_id": 7131190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf9fc25cd941aa90e73ccdbbc7229318?s=128&d=identicon&r=PG&f=1", "display_name": "drheinrich940", "link": "https://stackoverflow.com/users/7131190/drheinrich940"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1556699959, "post_id": 55929764, "comment_id": 98519940, "body": "@KamilCuk  <code>NELEMS</code> is : <code>#define NELEMS(x)  (sizeof(x) &#47; sizeof((x)[0]))</code> it was meant to return the size of the array, but maybe this is wrong too .. !"}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556707612, "post_id": 55929764, "comment_id": 98522675, "body": "@drheinrich940 <code>NELEMS(x)</code> is ok. Usually I&#39;ve seen that macro called <code>ARRAY_SIZE(arr)</code>.  Just remember its return type is <code>size_t</code>, which is unsigned.  There&#39;s many times where you need a signed size, so you either cast, or have another macro to hide the cast (in my case <code>#define ARRAY_SSIZE(arr) ((ptrdiff_t)ARRAY_SIZE(arr))</code>"}, {"owner": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1556707746, "post_id": 55929764, "comment_id": 98522731, "body": "Please include all the relevant source files, the <code>PointGPS</code> definition, all the includes and <code>main()</code> functions. Please post an MCVE - reproducible example, that others can copy into sites like <a href=\"http://onlinegdb.com\" rel=\"nofollow noreferrer\">onlinegdb.com</a> etc. There is much missing. I was not able to <a href=\"https://onlinegdb.com/Sy4SqlDi4\" rel=\"nofollow noreferrer\">reproduce</a> the behavior. The code you posted looks ok."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556708121, "post_id": 55929764, "comment_id": 98522847, "body": "How did you get the results in your update? One of the three methods you had tried? (If so, which?)"}, {"owner": {"reputation": 123, "user_id": 7131190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf9fc25cd941aa90e73ccdbbc7229318?s=128&d=identicon&r=PG&f=1", "display_name": "drheinrich940", "link": "https://stackoverflow.com/users/7131190/drheinrich940"}, "reply_to_user": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556711963, "post_id": 55929764, "comment_id": 98524340, "body": "@CacahueteFrito a simple <code>(int)</code> cast would not work ? I got the results with the first method introduced. I made some edits in the main post to clarify this."}, {"owner": {"reputation": 123, "user_id": 7131190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf9fc25cd941aa90e73ccdbbc7229318?s=128&d=identicon&r=PG&f=1", "display_name": "drheinrich940", "link": "https://stackoverflow.com/users/7131190/drheinrich940"}, "reply_to_user": {"reputation": 66560, "user_id": 9072753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EPmGy.jpg?s=128&g=1", "display_name": "KamilCuk", "link": "https://stackoverflow.com/users/9072753/kamilcuk"}, "edited": false, "score": 0, "creation_date": 1556712809, "post_id": 55929764, "comment_id": 98524685, "body": "@KamilCuk proceeded as you requested. You will find an MCVE - reproducible example at the end of my post in UPDATE 3. Sorry for the missing parts of code."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556743643, "post_id": 55929764, "comment_id": 98538225, "body": "For most cases, yes, a cast to <code>(int)</code> will work. More: <a href=\"https://stackoverflow.com/a/3174900/6872717\">stackoverflow.com/a/3174900/6872717</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 2, "creation_date": 1556731650, "post_id": 55937778, "comment_id": 98533377, "body": "Note that this works because the array is created in main, and therefore it exists during all the program (almost <code>static</code>).  If it were created in a normal function, the array would be local to that function and it would disappear the moment the function returns."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 1, "creation_date": 1556731737, "post_id": 55937778, "comment_id": 98533420, "body": "IMHO, I would even separate the <code>typedef</code> into its own statement."}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": true, "score": 2, "last_activity_date": 1556821376, "last_edit_date": 1556821376, "creation_date": 1556720574, "answer_id": 55937778, "question_id": 55929764, "link": "https://stackoverflow.com/questions/55929764/struct-containing-an-array-of-struct-cannot-be-allocated-by-values-from-a-list-o/55937778#55937778", "title": "Struct containing an array of struct cannot be allocated by values from a list of the same type", "body": "<p>There is a confusion between arrays and pointers. <code>obstacles</code> in your <code>main</code> function is an array of pointers to <code>Obstacle</code> structures. You probably want to define an array of <code>Obstacle</code> structures, initialized with copies of <code>obstacle1</code> and <code>obstacle2</code>, and pass that to <code>createEnvironment</code>. Passing an array as an argument effectively passes a pointer to its first element.</p>\n\n<p>Here is a modified version:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define NELEMS(x)  (sizeof(x) / sizeof((x)[0]))\n\nint main() {\n    PointGPS pointGps1 = createPoint(49.202538, 6.918930);\n    PointGPS pointGps2 = createPoint(49.202650, 6.925839);\n    PointGPS destination = createPoint(49.202660, 6.925849);\n    Obstacle obstacle1 = createObstacle(1, 10, pointGps1);\n    Obstacle obstacle2 = createObstacle(2, 30, pointGps2);\n    Obstacle obstacles[2];\n    obstacles[0] = obstacle1;\n    obstacles[1] = obstacle2;\n    // environment is global\n    environment = createEnvironment(destination, obstacles);\n    // The two following methods allow me to print the id of the first element\n    printf(\"%d\\n\", environment.obstacles-&gt;id);\n    printf(\"%d\\n\", environment.obstacles[0].id);\n    // This one should print the id of the second element\n    printf(\"%d\\n\", environment.obstacles[1].id);\n    return 0;\n}\n</code></pre>\n\n<p>Note also that your <code>tyedef</code> definitions are not idiomatic in C. The <code>typedef</code> keyword usually comes first:</p>\n\n<pre><code>typedef struct PointGPS {\n    double longitude;\n    double latitude;\n} PointGPS;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "is_accepted": false, "score": 1, "last_activity_date": 1556748683, "creation_date": 1556748683, "answer_id": 55943336, "question_id": 55929764, "link": "https://stackoverflow.com/questions/55929764/struct-containing-an-array-of-struct-cannot-be-allocated-by-values-from-a-list-o/55943336#55943336", "title": "Struct containing an array of struct cannot be allocated by values from a list of the same type", "body": "<p>Just to add pictures to the problem, this is what was defined in your code, (forgive my UML.)</p>\n\n<p><a href=\"https://i.stack.imgur.com/TmKJt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/TmKJt.png\" alt=\"The data types.\"></a></p>\n\n<p>What you've done is created this.</p>\n\n<p><a href=\"https://i.stack.imgur.com/UQvXS.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UQvXS.png\" alt=\"The data.\"></a></p>\n\n<p>Specifically, <code>*obstacles</code> is the same as <code>obstacles[0] = &amp;obstacle1</code>.</p>\n"}], "owner": {"reputation": 123, "user_id": 7131190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf9fc25cd941aa90e73ccdbbc7229318?s=128&d=identicon&r=PG&f=1", "display_name": "drheinrich940", "link": "https://stackoverflow.com/users/7131190/drheinrich940"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 55937778, "answer_count": 2, "score": 1, "last_activity_date": 1556821376, "creation_date": 1556665895, "last_edit_date": 1556720837, "question_id": 55929764, "link": "https://stackoverflow.com/questions/55929764/struct-containing-an-array-of-struct-cannot-be-allocated-by-values-from-a-list-o", "title": "Struct containing an array of struct cannot be allocated by values from a list of the same type", "body": "<p>My problem is the following: I have a structure called <code>Environment</code>, containing a list of <code>Obstacle</code> structures. I am not able to allocate this <code>environment.obstacles</code> from a existing list of <code>Obstacle</code> created manually in the code. </p>\n\n<p>I have the following definitions:</p>\n\n<pre><code>struct PointGPS {\n    double longitude;\n    double latitude;\n} typedef PointGPS;\n\nstruct Obstacle {\n    int id;\n    PointGPS position;\n    double radius;\n} typedef Obstacle;\n\nstruct Environment {\n    Obstacle *obstacles;\n    PointGPS destination;\n} typedef Environment;\n</code></pre>\n\n<p>And I am using the following functions to instantiate my values:</p>\n\n<pre><code>PointGPS createPoint(double longitude, double latitude) {\n    PointGPS point;\n    point.latitude = latitude;\n    point.longitude = longitude;\n    return point;\n}\n\nObstacle createObstacle(int id, double radius, PointGPS position) {\n    Obstacle obstacle;\n    obstacle.id = id;\n    obstacle.radius = radius;\n    obstacle.position = position;\n    return obstacle;\n}\n\nEnvironment createEnvironment(PointGPS destination, Obstacle *obstacles) {\n    Environment environment;\n    environment.destination = destination;\n    environment.obstacles = obstacles;\n    return environment;\n}\n\n</code></pre>\n\n<p>In my <code>main</code> function I am creating a list of obstacles:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;math.h&gt;\n#include &lt;stdlib.h&gt;\n#define NELEMS(x)  (sizeof(x) / sizeof((x)[0]))\n\nint main() {\n    PointGPS pointGps1 = createPoint(49.202538, 6.918930);\n    PointGPS pointGps2 = createPoint(49.202650, 6.925839);\n    PointGPS destination = createPoint(49.202660, 6.925849);\n    Obstacle obstacle1 = createObstacle(1, 10, pointGps1);\n    Obstacle obstacle2 = createObstacle(2, 30, pointGps2);\n    Obstacle *obstacles[2];\n    obstacles[0] = &amp;obstacle1;\n    obstacles[1] = &amp;obstacle2;\n    // environment is global\n    environment = createEnvironment(destination, *obstacles);\n    // The two following methods allow me to print the id of the first element\n    printf(\"%d\\n\", environment.obstacles-&gt;id);\n    printf(\"%d\\n\", environment.obstacles[0].id);\n    // But I cant access to the values -for exemple the id field- of the following obstacles\n    printf(\"%d\\n\", environment.obstacles[1].id);\n}\n</code></pre>\n\n<p>I want to give this list to my <code>environment</code>. But it fails allocating or pointing to the correct values. Testing by the <code>id</code> of some obstacles in <code>environment.obstacles</code> always returns some random integer values from the memory.</p>\n\n<p>I tried the following attempts :</p>\n\n<p>1)</p>\n\n<pre><code>// environment is global\nenvironment = createEnvironment(destination, *obstacles);\n</code></pre>\n\n<p>2)</p>\n\n<pre><code>environment.obstacles = (Obstacle *)malloc(sizeof(Obstacle *) * NELEMS(obstacles));\nenvironment.obstacles[0] = *obstacles[0];\nenvironment.obstacles[1] = *obstacles[1];\n</code></pre>\n\n<p>3)</p>\n\n<pre><code>environment.obstacles = (Obstacle *)malloc(sizeof(Obstacle *) * NELEMS(obstacles));\nenvironment.obstacles[0] = createObstacle(obstacles[0]-&gt;id, obstacles[0]-&gt;radius, createPoint(obstacles[0]-&gt;position.longitude, obstacles[0]-&gt;position.latitude));\nenvironment.obstacles[1] = createObstacle(obstacles[1]-&gt;id, obstacles[1]-&gt;radius, \ncreatePoint(obstacles[1]-&gt;position.longitude, obstacles[1]-&gt;position.latitude));\n</code></pre>\n\n<p>All these attempts failed, returning values like <code>-2144113376</code>, and not even creating an array of length = 2 in my <code>environment</code> variable. </p>\n\n<p>I am pretty sure I'm missing something obvious, as I have zero experience in this language, but I can't figure it out.\nHow could I proceed ?</p>\n\n<p><strong>UPDATE 1</strong>:</p>\n\n<p>This syntax allowed me to access the first obstacle using the method n\u00b01:  </p>\n\n<pre><code>printf(\"%d\\n\", environment.obstacles-&gt;id)\n</code></pre>\n\n<p>But I can't access to the second obstacle. Doing <code>printf(\"%d\\n\", environment.obstacles[1]-&gt;id);</code> returns this error :</p>\n\n<pre><code>Member reference type 'Obstacle' (aka 'struct Obstacle') is not a pointer, did you mean to use '.'?\n</code></pre>\n\n<p>And doing <code>printf(\"%d\\n\", environment.obstacles[1].id);</code> still returns random values.</p>\n\n<p><strong>UPDATE 2</strong>:</p>\n\n<p>As requested, i edited the structures, functions and main. </p>\n\n<p><strong>UPDATE 3</strong>: </p>\n\n<p>Here is a testable code doing what is attempted in my post.\n<a href=\"https://onlinegdb.com/S1342WPsN\" rel=\"nofollow noreferrer\">https://onlinegdb.com/S1342WPsN</a>\nIf I run the code on my computer I still have random values as described when trying to access the fields following the first one.\nBut if I run the code inside the website (see link), it seems to provide the correct value.</p>\n"}, {"tags": ["c", "pointers", "memory-management"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556666056, "post_id": 55929705, "comment_id": 98513008, "body": "You can only <code>realloc</code> a pointer that was not allocated if it is <code>NULL</code>. Some system will zero a memory allocation but that is not defined by the C standard. It is a bad idea to pass an uninitialised pointer to <code>realloc</code>. But things go wrong even before then with <code>*(temp+i)=*(str+i);</code> which derefences an uninitialised pointer."}, {"owner": {"reputation": 110, "user_id": 10523739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ba8959773da86ea57bc38719001b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dot.Volare", "link": "https://stackoverflow.com/users/10523739/dot-volare"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556666170, "post_id": 55929705, "comment_id": 98513039, "body": "But I already initially allocated the pointer(result) which I want to reallocate at the start of the code."}, {"owner": {"reputation": 110, "user_id": 10523739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ba8959773da86ea57bc38719001b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dot.Volare", "link": "https://stackoverflow.com/users/10523739/dot-volare"}, "edited": false, "score": 0, "creation_date": 1556666299, "post_id": 55929705, "comment_id": 98513061, "body": "It is allocated for c=0 already other than that I allocate it when I need it in the else statement."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556666789, "post_id": 55929705, "comment_id": 98513148, "body": "You allocated a double pointer, but not any offset you subsequently dereference."}, {"owner": {"reputation": 110, "user_id": 10523739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ba8959773da86ea57bc38719001b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dot.Volare", "link": "https://stackoverflow.com/users/10523739/dot-volare"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1558230053, "post_id": 55929705, "comment_id": 99030384, "body": "<i>(result + c) = (char</i>) malloc(sizeof(char)); isn&#39;t this line doing that allocation ?"}], "answers": [{"comments": [{"owner": {"reputation": 110, "user_id": 10523739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ba8959773da86ea57bc38719001b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dot.Volare", "link": "https://stackoverflow.com/users/10523739/dot-volare"}, "edited": false, "score": 0, "creation_date": 1556666419, "post_id": 55929807, "comment_id": 98513093, "body": "It is reasonable but I don&#39;t have the max number of substrings"}, {"owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "reply_to_user": {"reputation": 110, "user_id": 10523739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ba8959773da86ea57bc38719001b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dot.Volare", "link": "https://stackoverflow.com/users/10523739/dot-volare"}, "edited": false, "score": 0, "creation_date": 1556670397, "post_id": 55929807, "comment_id": 98513800, "body": "just throw in a large number and see if it helps.. ... sorry just a suggestion to try to get things working..."}, {"owner": {"reputation": 110, "user_id": 10523739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ba8959773da86ea57bc38719001b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dot.Volare", "link": "https://stackoverflow.com/users/10523739/dot-volare"}, "edited": false, "score": 0, "creation_date": 1558230027, "post_id": 55929807, "comment_id": 99030382, "body": "The whole point of this code is to work with a dynamic array, thanks anyway"}, {"owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "reply_to_user": {"reputation": 110, "user_id": 10523739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ba8959773da86ea57bc38719001b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dot.Volare", "link": "https://stackoverflow.com/users/10523739/dot-volare"}, "edited": false, "score": 0, "creation_date": 1558282129, "post_id": 55929807, "comment_id": 99040483, "body": "@Crazy_39365 Ok, - I was partly suggesting adding a number to see if that would solve the problem- or if the problem was elsewhere, but I see what you mean about working with a dynamic array."}], "tags": [], "owner": {"reputation": 1253, "user_id": 3596376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeldq.jpg?s=128&g=1", "display_name": "tom", "link": "https://stackoverflow.com/users/3596376/tom"}, "is_accepted": false, "score": 0, "last_activity_date": 1556666193, "creation_date": 1556666193, "answer_id": 55929807, "question_id": 55929705, "link": "https://stackoverflow.com/questions/55929705/pointer-being-reallocated-wasnt-allocated/55929807#55929807", "title": "Pointer being reallocated wasn&#39;t allocated", "body": "<p>Just from a first look I am suspicious of </p>\n\n<pre><code>result = (char **)malloc(sizeof(char*));\n</code></pre>\n\n<p>I think you should have something like</p>\n\n<pre><code>result = (char **)malloc(MAX_NUMBER_OF_DIFFERENT_SUBSTRINGS * sizeof(char*));\n</code></pre>\n\n<p>does that make sense?</p>\n\n<p>otherwise</p>\n\n<pre><code> *(result +c)\n</code></pre>\n\n<p>does not make sense....</p>\n\n<p>so try increasing the memory allocated to result....</p>\n\n<p>but this is probably only part of the story</p>\n"}, {"comments": [{"owner": {"reputation": 110, "user_id": 10523739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ba8959773da86ea57bc38719001b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dot.Volare", "link": "https://stackoverflow.com/users/10523739/dot-volare"}, "edited": false, "score": 0, "creation_date": 1558229922, "post_id": 55930186, "comment_id": 99030377, "body": "Thanks for the answer, test data ensures that there will be at least one delimeter and only one character for the delimeter.."}], "tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": true, "score": 0, "last_activity_date": 1556670157, "last_edit_date": 1556670157, "creation_date": 1556669793, "answer_id": 55930186, "question_id": 55929705, "link": "https://stackoverflow.com/questions/55929705/pointer-being-reallocated-wasnt-allocated/55930186#55930186", "title": "Pointer being reallocated wasn&#39;t allocated", "body": "<p>Insufficient allocation - by 1.</p>\n\n<p>A <em>string</em> of length <code>N</code> needs <code>N+1</code> <code>char</code>.  Cast not needed in C.</p>\n\n<pre><code>// cpr = (char *)malloc(sizeof(char)*strlen(\"winter-is-coming\"));\ncpr = malloc(strlen(\"winter-is-coming\") + 1);\n// Robust code would check for allocation success\nif (cpr == NULL) {\n  return EXIT_FAILURE;\n}\nstrcpy(cpr,\"winter-is-coming\");\n</code></pre>\n\n<hr>\n\n<p>Code can fail to return a good indication of the number of splits from <code>split()</code>.  Consider <code>char ** split(\"\", .-)</code> for example.  Also then <code>printf(\"%s\\n\",result[0]);</code> is UB.</p>\n\n<hr>\n\n<p>Other problems may exist.</p>\n"}], "owner": {"reputation": 110, "user_id": 10523739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8ba8959773da86ea57bc38719001b0?s=128&d=identicon&r=PG&f=1", "display_name": "Dot.Volare", "link": "https://stackoverflow.com/users/10523739/dot-volare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "accepted_answer_id": 55930186, "answer_count": 2, "score": 1, "last_activity_date": 1556679675, "creation_date": 1556665475, "last_edit_date": 1556679675, "question_id": 55929705, "link": "https://stackoverflow.com/questions/55929705/pointer-being-reallocated-wasnt-allocated", "title": "Pointer being reallocated wasn&#39;t allocated", "body": "<p>I want to make a function which separates a given string according to delimiter (winter-is-coming -> winter|is|coming) to its sub strings and returning a null string at the end of the double character pointer. When I run this code under mac os x in C90 standard, I get the first string as \"winter\" (~as w, wi, win, wint, winte, winter~ when I print temp in the loop) but then it suddenly crushes and gives this error:</p>\n\n<pre><code>untitled2(30275,0x109cf25c0) malloc: *** error for object 0x7fec9a400630: pointer being realloc'd was not allocated\nuntitled2(30275,0x109cf25c0) malloc: *** set a breakpoint in malloc_error_break to debug\n</code></pre>\n\n<p>My code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nchar ** split(char *str, char delimeter) {\n  int i = 0;\n  int c = 0;\n  int k = 1;\n  char **result;\n  result = (char **) malloc(sizeof(char*));\n  *result = (char *) malloc(sizeof(char));\n  char * temp;\n  temp = *result;\n  while (str[i] != '\\0') {\n\n    if (str[i] != delimeter) {\n      *(temp + i) = *(str + i);\n      i++;\n      temp = (char *) realloc(*(result + c), sizeof(char) * (i + 1));\n      continue;\n    }\n\n    else {\n      c++;\n      k++;\n      result = (char **) realloc(result, sizeof(char *) * k);\n\n      *(result + c) = (char*) malloc(sizeof(char));\n      i++;\n      *(temp + i) = '\\0';\n\n    }\n  }\n  printf(\"%s\\n\", result[0]);\n  return result;\n}\n\nint main() {\n  char *cpr;\n  cpr = (char *) malloc(sizeof(char) * strlen(\"winter-is-coming\"));\n  strcpy(cpr, \"winter-is-coming\");\n  printf(\"%s\\n\", split(cpr, '-')[0]);\n  return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "sorting"], "comments": [{"owner": {"reputation": 1973, "user_id": 7721600, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/WsGqD.jpg?s=128&g=1", "display_name": "Moritz Schmidt", "link": "https://stackoverflow.com/users/7721600/moritz-schmidt"}, "edited": false, "score": 4, "creation_date": 1556663784, "post_id": 55929478, "comment_id": 98512513, "body": "What did you try?"}, {"owner": {"reputation": 13, "user_id": 11434824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c41029b842aaa6061f55ada40d56ea8?s=128&d=identicon&r=PG&f=1", "display_name": "sarahi", "link": "https://stackoverflow.com/users/11434824/sarahi"}, "reply_to_user": {"reputation": 1973, "user_id": 7721600, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/WsGqD.jpg?s=128&g=1", "display_name": "Moritz Schmidt", "link": "https://stackoverflow.com/users/7721600/moritz-schmidt"}, "edited": false, "score": 0, "creation_date": 1556665048, "post_id": 55929478, "comment_id": 98512799, "body": "I have this array = {50 , 20 , 40 }  and i want to get result array containing the order {3,1,2}  (20 -&gt; 1 , 40 -&gt; 2 , 50 -&gt; 3)"}, {"owner": {"reputation": 1973, "user_id": 7721600, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/WsGqD.jpg?s=128&g=1", "display_name": "Moritz Schmidt", "link": "https://stackoverflow.com/users/7721600/moritz-schmidt"}, "edited": false, "score": 3, "creation_date": 1556665163, "post_id": 55929478, "comment_id": 98512827, "body": "and what did you try so far?"}, {"owner": {"reputation": 13, "user_id": 11434824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c41029b842aaa6061f55ada40d56ea8?s=128&d=identicon&r=PG&f=1", "display_name": "sarahi", "link": "https://stackoverflow.com/users/11434824/sarahi"}, "reply_to_user": {"reputation": 1973, "user_id": 7721600, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/WsGqD.jpg?s=128&g=1", "display_name": "Moritz Schmidt", "link": "https://stackoverflow.com/users/7721600/moritz-schmidt"}, "edited": false, "score": 0, "creation_date": 1556665466, "post_id": 55929478, "comment_id": 98512886, "body": "array1 = {0,2,5,1,4,3} i should exctact elements {2,5,1} and get their positions {3,1,2} and switch it with another array in the same positions.                              I have tried first sort the elements {2,5,1} == {1,2,5} and according a value to each one and reorder the first array but is not working"}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556672740, "post_id": 55929478, "comment_id": 98514190, "body": "Why is it not working? What&#39;s your code? What are the results of that code?"}, {"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 2, "creation_date": 1556674270, "post_id": 55929478, "comment_id": 98514455, "body": "This smells of &quot;gimme teh codez&quot;."}, {"owner": {"reputation": 97, "user_id": 11390586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VGdy.jpg?s=128&g=1", "display_name": "Mr. Suklav Ghosh", "link": "https://stackoverflow.com/users/11390586/mr-suklav-ghosh"}, "edited": false, "score": 0, "creation_date": 1556692620, "post_id": 55929478, "comment_id": 98517830, "body": "Provide your code that you have tried  ..."}, {"owner": {"reputation": 13, "user_id": 11434824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c41029b842aaa6061f55ada40d56ea8?s=128&d=identicon&r=PG&f=1", "display_name": "sarahi", "link": "https://stackoverflow.com/users/11434824/sarahi"}, "edited": false, "score": 0, "creation_date": 1556701992, "post_id": 55929478, "comment_id": 98520632, "body": "what i am try to do is exchanging order of a part of array element according to the order of {50,40,10} wich is {3,2,1} , till now i have done the exchange function it works perfectly when i provide the order by myself , now i want to reorder dynamicly  the array .   int* exchange(int *A,int *I){  \t int i, j, k; \t    for(i = 0; i &lt; NbrCities ; i++){ \t\tif(i != I[i]){ \t\t    j = i; \t\t    while(i != (k = I[j])){ \t\t        swap(A[j], A[k]); \t\t        I[j] = j; \t\t        j = k; \t\t    } \t\t    I[j] = j; \t\t} \t    } \treturn A; }"}, {"owner": {"reputation": 1973, "user_id": 7721600, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/WsGqD.jpg?s=128&g=1", "display_name": "Moritz Schmidt", "link": "https://stackoverflow.com/users/7721600/moritz-schmidt"}, "edited": false, "score": 0, "creation_date": 1556706164, "post_id": 55929478, "comment_id": 98522141, "body": "Please edit your post with your code example"}], "answers": [{"tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": true, "score": 1, "last_activity_date": 1558103071, "last_edit_date": 1558103071, "creation_date": 1556716104, "answer_id": 55936766, "question_id": 55929478, "link": "https://stackoverflow.com/questions/55929478/get-the-ascending-order-of-array-element-using-c-language/55936766#55936766", "title": "Get the ascending order of array element using c language", "body": "<p>If you can assume that all values are different, for each value in <code>tab</code>, its position in the sorted array is the number of values that are strictly lower in <code>tab</code>:</p>\n\n<p>Here is how it works:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n\nvoid getOrder(const int tab[], int n, int pos[]) {\n    for (int i = 0; i &lt; n; i++) {\n        int count = 0;\n        for (int j = 0; j &lt; n; j++)\n            count += (tab[j] &lt; tab[i]);\n        pos[i] = count;\n    }\n}\n\nint main() {\n    int tab[3] = { 5, 1, 4 };\n    int pos[3];\n    int n = sizeof(tab) / sizeof(tab[0]);\n\n    getOrder(tab, n, pos);\n    for (int i = 0; i &lt; n; i++)\n        printf(\"%d \", pos[i]);\n    printf(\"\\n\");\n    return 0;\n}\n</code></pre>\n\n<p>If you want different index values for duplicates, you can use 2 loops with slightly fewer tests:</p>\n\n<pre><code>void getOrder(const int tab[], int n, int pos[]) {\n    for (int i = 0; i &lt; n; i++) {\n        int j, count = 0;\n        for (j = 0; j &lt; i; j++)\n            count += (tab[j] &lt;= tab[i]);\n        while (++j &lt; n)\n            count += (tab[j] &lt; tab[i]);\n        pos[i] = count;\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11434824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c41029b842aaa6061f55ada40d56ea8?s=128&d=identicon&r=PG&f=1", "display_name": "sarahi", "link": "https://stackoverflow.com/users/11434824/sarahi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "closed_date": 1556782868, "accepted_answer_id": 55936766, "answer_count": 1, "score": -7, "last_activity_date": 1558103071, "creation_date": 1556663569, "last_edit_date": 1556717734, "question_id": 55929478, "link": "https://stackoverflow.com/questions/55929478/get-the-ascending-order-of-array-element-using-c-language", "closed_reason": "Needs more focus", "title": "Get the ascending order of array element using c language", "body": "<p>I want to replace input array by their order:</p>\n\n<p><code>array = { 5, 1, 4 }</code> ==> <code>result = { 2, 0 ,1 }</code></p>\n\n<p>But I am stuck on how to replace order elements in the same position.</p>\n\n<p>The output is: <code>0 1 2</code></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\n#include &lt;math.h&gt;\n\nvoid sort(int tab[], int n) {\n    int i, a, j;\n    for (i = 0; i &lt; n; ++i) {\n        for (j = i + 1; j &lt; n; ++j) {\n            if (tab[i] &gt; tab[j]) {\n                a =  tab[i];\n                tab[i] = tab[j];\n                tab[j] = a;\n            }\n        }\n    }\n}\n\nvoid getOrder(int tab[]) {\n    int i;\n    sort(tab, 3);\n    for (i = 0; i &lt; 3; i++)\n        tab[i] = i; // replace(tab[i],i)\n}\n\nint main() {\n    int tab[3] = { 5, 1, 4 }, i, j;\n    getOrder(tab);\n    for (i = 0; i &lt; 3; i++)\n        printf(\" %d \", tab[i]);\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "assembly", "arm", "embedded", "iar"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1556661692, "post_id": 55929150, "comment_id": 98511994, "body": "What compiler?  What level of optimization did you use?"}, {"owner": {"reputation": 656, "user_id": 9592917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fe6504c31f4954495f952699592361a?s=128&d=identicon&r=PG&f=1", "display_name": "Bwebb", "link": "https://stackoverflow.com/users/9592917/bwebb"}, "edited": false, "score": 0, "creation_date": 1556662333, "post_id": 55929150, "comment_id": 98512179, "body": "the first one you ment to write while(counter &lt; 6) right?"}, {"owner": {"reputation": 59, "user_id": 11424710, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LifGK1tfhbA/AAAAAAAAAAI/AAAAAAAAAJQ/7QI7L3n77eA/photo.jpg?sz=128", "display_name": "Ahmad Magrabi", "link": "https://stackoverflow.com/users/11424710/ahmad-magrabi"}, "edited": false, "score": 0, "creation_date": 1556663178, "post_id": 55929150, "comment_id": 98512387, "body": "using IAR Worbench it&#39;s a compiler and deugger level of optimization is low"}, {"owner": {"reputation": 59, "user_id": 11424710, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LifGK1tfhbA/AAAAAAAAAAI/AAAAAAAAAJQ/7QI7L3n77eA/photo.jpg?sz=128", "display_name": "Ahmad Magrabi", "link": "https://stackoverflow.com/users/11424710/ahmad-magrabi"}, "edited": false, "score": 0, "creation_date": 1556663279, "post_id": 55929150, "comment_id": 98512411, "body": "yes Bwebb I meant (counter&lt;6) as there is now pointer in this piece"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 2, "creation_date": 1556665971, "post_id": 55929150, "comment_id": 98512984, "body": "What made you &quot;realize&quot; it was faster? How did you measure it? Moreover without applying compiler optimisation, the result is largely irrelevant since if performance were critical you&#39;d use optimisation.  Unoptimised code favours debug experience over performance."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 2, "creation_date": 1556666636, "post_id": 55929150, "comment_id": 98513127, "body": "Avoid using off-site images, especially ones likely to be temporary in personal cloud storage. And don&#39;t post images of <i>text</i> as you have done here."}, {"owner": {"reputation": 59, "user_id": 11424710, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LifGK1tfhbA/AAAAAAAAAAI/AAAAAAAAAJQ/7QI7L3n77eA/photo.jpg?sz=128", "display_name": "Ahmad Magrabi", "link": "https://stackoverflow.com/users/11424710/ahmad-magrabi"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1556667445, "post_id": 55929150, "comment_id": 98513265, "body": "@Clifford I need more than 15 reputation to be able to post images, as for what me realize that: in the assembly code there is a whole Instruction LDR.N is reduced when using pointer,"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1556679330, "post_id": 55929150, "comment_id": 98515268, "body": "Benchmarking debug-mode code is pointless.  Enable optimization before benchmarking it or looking at it.  Anyway, copy/paste the asm output to make this a proper <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> if you&#39;re still wondering about the details of why one inefficient asm loop is after than another inefficient asm loop.  (And on what hardware?)"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556688387, "post_id": 55929150, "comment_id": 98516925, "body": "There is only one way to save this question: You need to edit it and tell <i>exactly</i> what you&#39;re doing for which processor and using which tools <i>and</i> the edit you did should be an <b>answer</b> to the question."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1556692942, "post_id": 55929150, "comment_id": 98517917, "body": "@AhmadMagrabi yes, but the dissassembly code is <i>text</i>, you need not have posted a screenshot in the first place. Moreover the first screenshot occludes part of the disassembly so that it is not possible to determine the target if the branch instructions"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1556693007, "post_id": 55929150, "comment_id": 98517933, "body": "Your update should be posted as an answer rather then an edit to the question.  You are allowed to answer and accept answers to your own question."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1556693119, "post_id": 55929150, "comment_id": 98517963, "body": "I wonder if the result differs if <code>counter</code> were a local variable?  It is both unnecessary and poor practice to declare it outside of <code>main()</code> in this case."}, {"owner": {"reputation": 59, "user_id": 11424710, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LifGK1tfhbA/AAAAAAAAAAI/AAAAAAAAAJQ/7QI7L3n77eA/photo.jpg?sz=128", "display_name": "Ahmad Magrabi", "link": "https://stackoverflow.com/users/11424710/ahmad-magrabi"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1556723572, "post_id": 55929150, "comment_id": 98529783, "body": "thanks for the tips @Clifford, Mr. chqrlie updated it in the best way possible, if counter was local to main there would be no difference, the assembly starts from LDR.N in both images, that was my first question I would use these tips for sure :)"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1556731566, "post_id": 55929150, "comment_id": 98533347, "body": "@Clifford, if local then it would be optimized out.   But based on the edit, this does seem like a simple case of the code needed to access a global variable makes for more instructions per loop.  would be easier to read if the code had just been pasted into the question rather than images."}, {"owner": {"reputation": 59, "user_id": 11424710, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LifGK1tfhbA/AAAAAAAAAAI/AAAAAAAAAJQ/7QI7L3n77eA/photo.jpg?sz=128", "display_name": "Ahmad Magrabi", "link": "https://stackoverflow.com/users/11424710/ahmad-magrabi"}, "edited": false, "score": 0, "creation_date": 1556732442, "post_id": 55929150, "comment_id": 98533767, "body": "You may want to check the tutorial <a href=\"https://www.youtube.com/watch?v=o9WpXYBqdPU&amp;t=148s\" rel=\"nofollow noreferrer\">Embedded Programming  Lesson 3  Variables and Pointers</a>"}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1556732556, "post_id": 55929150, "comment_id": 98533821, "body": "@old_timer It was a rhetorical question. The point being to worry about the compiler performance for good code rather than bad.  In this case the code is not optimised, but nonetheless a register might be used - I would not regard that as &quot;optimised out&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 1, "creation_date": 1556663114, "post_id": 55929363, "comment_id": 98512363, "body": "the &quot;extra instruction&quot; is because foo1 updates the global value of <code>p</code>  ; both <code>while</code> loops compile to the same assembly. I don&#39;t think that is what OP is asking about (although the question is not very clear); in OP code <code>p</code> was a local variable to the function"}, {"owner": {"reputation": 59, "user_id": 11424710, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LifGK1tfhbA/AAAAAAAAAAI/AAAAAAAAAJQ/7QI7L3n77eA/photo.jpg?sz=128", "display_name": "Ahmad Magrabi", "link": "https://stackoverflow.com/users/11424710/ahmad-magrabi"}, "edited": false, "score": 0, "creation_date": 1556663373, "post_id": 55929363, "comment_id": 98512432, "body": "Thanks for your comment, yes it&#39;s almost identical there is only one less LDR.N in the code with pointer"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1556663447, "post_id": 55929363, "comment_id": 98512449, "body": "@M.M I know why (did you missed the smiley?)"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 3, "creation_date": 1556663536, "post_id": 55929363, "comment_id": 98512465, "body": "@P__J__ I don&#39;t see how this answers the question"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1556663684, "post_id": 55929363, "comment_id": 98512485, "body": "@M.M There is no answer. Why is <code>a</code> larger than <code>b</code>?  But <code>b</code> is larger or equal <code>a</code> - so how how to answer the initial question"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1556679315, "post_id": 55929363, "comment_id": 98515264, "body": "Why make <code>int*p</code> a global?  The OP&#39;s code has it as a local.  This introduces a confusing unnecessary difference since your screenshot(!) of the Godbolt compiler explorer hides enough of the source pane that it&#39;s not really readable.  Plus, the OP is compiling for ARM with a different compiler in debug mode, and <i>that</i>&#39;s the problem."}], "tags": [], "owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "is_accepted": false, "score": -2, "last_activity_date": 1556662747, "creation_date": 1556662747, "answer_id": 55929363, "question_id": 55929150, "link": "https://stackoverflow.com/questions/55929150/why-using-pointers-with-low-optimization-makes-the-program-faster/55929363#55929363", "title": "Why using pointers (with low optimization) makes the program faster?", "body": "<p>it is right opposite (almost identical but one instruction more :):</p>\n\n<p><a href=\"https://godbolt.org/z/xDYecQ\" rel=\"nofollow noreferrer\">https://godbolt.org/z/xDYecQ</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/kqFPP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/kqFPP.png\" alt=\"enter image description here\"></a></p>\n"}, {"comments": [{"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556755689, "post_id": 55933866, "comment_id": 98541231, "body": "I think my previous title edit was confusing.  Both the OP&#39;s cases have optimization disabled, but introducing extra pointer variables actually helps instead of hurts like extra variables normally do, because ARM can&#39;t directly access static storage anyway; it has to construct a pointer in a register pretty similarly to using a local pointer variable.  I re-edited the title to avoid sounding like enabling optimization made it slower."}, {"owner": {"reputation": 1469, "user_id": 2105592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e0660c06174e5479ed2c6dcda818d0f?s=128&d=identicon&r=PG", "display_name": "Sean Houlihane", "link": "https://stackoverflow.com/users/2105592/sean-houlihane"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556786557, "post_id": 55933866, "comment_id": 98549916, "body": "@PeterCordes, does &#39;optimisation disabled&#39; actually have a formal meaning that can be extended to assuming that the lecturer&#39;s example will still behave in the same way in 10 years time? What I was trying to get at here is that the example doesn&#39;t support what seems to being taught. If what is being taught is that this &#39;leading the compiler in O0&#39; is viable, that actually starts to sound misleading."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556822185, "post_id": 55933866, "comment_id": 98568339, "body": "My understanding of &quot;optimization disabled&quot; is that each C statement is compiled to a separate block of asm, with all variables in memory between statements, nothing live in registers except stack and frame pointers.  (So vars can be modified by a debugger).  Within a single statement, the level of braindeadness varies wildly, e.g. GCC will still optimize <code>x &#47; 10</code> into a multiplicative inverse.  (Fun fact: <code>register int foo;</code> actually will stay live in a register with gcc; the <code>register</code> keyword actually does something at <code>-O0</code>, unlike other times.) But fair point, IDK if everyone agrees on it"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556822326, "post_id": 55933866, "comment_id": 98568408, "body": "I didn&#39;t think the question was saying anything was being specifically <i>taught</i> as something you should remember.  At least I hope not, for the reasons you point out!  The OP says they noticed (&quot;realized&quot;) the perf diff and asked the author of a tutorial about it.  (I think implying that it wasn&#39;t something the tutorial brought up).  So the &quot;update&quot; section was just an explanation of that curious behaviour in <i>this</i> specific case for this compiler for this ISA, since the OP asked specifically about it."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556822656, "post_id": 55933866, "comment_id": 98568558, "body": "Tuning C source to optimize for <code>-O0</code> is silly, but wondering about performance differences in different asm versions of a function can be interesting, ignoring the fact that they both come from compiler output.  I&#39;ve answered several x86 questions like that.  So this question is poorly worded, focusing on the C differences not the asm differences."}, {"owner": {"reputation": 1469, "user_id": 2105592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e0660c06174e5479ed2c6dcda818d0f?s=128&d=identicon&r=PG", "display_name": "Sean Houlihane", "link": "https://stackoverflow.com/users/2105592/sean-houlihane"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556829206, "post_id": 55933866, "comment_id": 98571301, "body": "For example, I had auto-inlining break one of my integration tests (I think with -O0), and I assume it was working several years ago."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1556886073, "post_id": 55933866, "comment_id": 98590018, "body": "BTW, I just noticed that the code in the question <i>doesn&#39;t</i> have optimization fully disabled, not like <code>gcc -O0</code>.  I retitled it again &gt;.&lt;.  The <code>++counter</code> version only loads the var&#39;s address once for both accesses, but it&#39;s inside the loop right before the first use.  And the pointer version <i>does</i> keep the pointer value in a register throughout the function, not reloading it from the stack.  So the difference is just failure to do the <code>ldr</code> before jumping into the loop.  Even more of a special-case than you were suggesting."}], "tags": [], "owner": {"reputation": 1469, "user_id": 2105592, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e0660c06174e5479ed2c6dcda818d0f?s=128&d=identicon&r=PG", "display_name": "Sean Houlihane", "link": "https://stackoverflow.com/users/2105592/sean-houlihane"}, "is_accepted": false, "score": 1, "last_activity_date": 1556703447, "last_edit_date": 1556703447, "creation_date": 1556701317, "answer_id": 55933866, "question_id": 55929150, "link": "https://stackoverflow.com/questions/55929150/why-using-pointers-with-low-optimization-makes-the-program-faster/55933866#55933866", "title": "Why using pointers (with low optimization) makes the program faster?", "body": "<p>Any behaviour of the compiler that varies between optimisation levels is <em>implementation specific</em>. So although you have been shown something which is maybe rather counterintuitive as a demonstration, you should not have been taught that this is a causal relationship.</p>\n\n<p>Writing code in a different way can <em>always</em> trigger performance improvements or regressions, and the different optimisation levels can <em>sometimes</em> result in changes that go the wrong way. It should be obvious, but any scenario where a higher optimisation level results on worse performance (not the case with this example) should be regarded as a problem for the compiler.</p>\n"}, {"tags": [], "owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "is_accepted": true, "score": 3, "last_activity_date": 1556783400, "creation_date": 1556783400, "answer_id": 55947860, "question_id": 55929150, "link": "https://stackoverflow.com/questions/55929150/why-using-pointers-with-low-optimization-makes-the-program-faster/55947860#55947860", "title": "Why using pointers (with low optimization) makes the program faster?", "body": "<p>In general: there is no reason why using pointers would make the program run faster. Discussing performance of programs without all optimizations enabled, like the course creator did in your quote, is not meaningful. It is certainly not a reason to change the way you write code.</p>\n\n<p>Another old, often used but obsolete trick, is to write such loops as down-counting instead of up-counting, since compares against zero are often faster than compares against values. But this is also something you should not let affect the way you write code, because a modern compiler can do that optimization for you.</p>\n\n<p>What programmers should do, and what people writing courses should teach, is to write the code as plain and readable as possible. Meaning that both your examples are bad, since they are needlessly obscure and examples of \"pre-mature optimization\". Better code would be:</p>\n\n<pre><code>  int counter;\n  ...\n  for(counter=0; counter &lt; 6; counter++)\n  {}\n</code></pre>\n\n<p>This is about as readable as code gets and there is no reason to believe that the above would perform worse than your examples on any known system. </p>\n\n<p>Do this:</p>\n\n<ul>\n<li>Write the most readable code you can.</li>\n<li>In release, enable optimizations.</li>\n<li>If there are performance problems, benchmark and find bottlenecks.</li>\n<li>Manually optimize the bottlenecks if needed. Possibly with a specific system in mind.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 539, "user_id": 11413329, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j1Efn.jpg?s=128&g=1", "display_name": "Richard at ImageCraft", "link": "https://stackoverflow.com/users/11413329/richard-at-imagecraft"}, "is_accepted": false, "score": 0, "last_activity_date": 1556873764, "creation_date": 1556873764, "answer_id": 55966408, "question_id": 55929150, "link": "https://stackoverflow.com/questions/55929150/why-using-pointers-with-low-optimization-makes-the-program-faster/55966408#55966408", "title": "Why using pointers (with low optimization) makes the program faster?", "body": "<p>The original <strong>Update</strong> provides a good answer. Furthermore, in the original, \"counter\" is a global variable, so each access on the ARM chip requires loading the variable into a register first. Depending on where the variable is located, and the optimization level, this is at least one LDR instruction (could be more), then the update counter++ requires the add instruction and the write back to the global variable.</p>\n\n<p>IF counter is declared as a local variable, then in fact, using the pointer version would be less optimal. In that case, most compilers would allocate counter into a register, then accessing it would be very fast. If a pointer is used, counter would be forced to be allocated to the stack (since its address is assigned to \"p\"), and more instructions would be needed to do the addition and access. </p>\n"}], "owner": {"reputation": 59, "user_id": 11424710, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LifGK1tfhbA/AAAAAAAAAAI/AAAAAAAAAJQ/7QI7L3n77eA/photo.jpg?sz=128", "display_name": "Ahmad Magrabi", "link": "https://stackoverflow.com/users/11424710/ahmad-magrabi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 659, "favorite_count": 1, "accepted_answer_id": 55947860, "answer_count": 4, "score": 0, "last_activity_date": 1556885913, "creation_date": 1556661402, "last_edit_date": 1556885913, "question_id": 55929150, "link": "https://stackoverflow.com/questions/55929150/why-using-pointers-with-low-optimization-makes-the-program-faster", "title": "Why using pointers (with low optimization) makes the program faster?", "body": "<p>I was following a tutorial on embedded C programming, then realized that using a pointer to point to variable, then using it to dereference makes the program faster!</p>\n\n<p>I've a basic knowledge of assembly, but I didn't figure why assigning the address of a variable to pointer would it make faster, we are not talking about pass by reference or by pointer or by value!</p>\n\n<p>As I can follow,</p>\n\n<ul>\n<li>code without pointer: the memory address has been assigned to register <code>R0</code>, \nlike exactly what happened in the code with the pointer.</li>\n<li>the <code>p_int</code> became an alias to the register <code>R0</code>, how this can help making the program faster?</li>\n</ul>\n\n<p>the code without using a pointer:</p>\n\n<pre><code>int counter = 0;\nint main() {\n    while (counter &lt; 6) {\n        ++(counter);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>then the assembly would be like in <a href=\"https://i.stack.imgur.com/CrZUW.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CrZUW.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>Conversely, here is the code with a pointer:</p>\n\n<pre><code>int counter = 0;\nint main() {\n    int *p;\n    p = &amp;counter;\n    while (*p &lt; 6) {\n        ++(*p);\n    }\n    return 0;\n}\n</code></pre>\n\n<p>then the assembly would be like in <a href=\"https://i.stack.imgur.com/fOywX.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fOywX.jpg\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<h2><strong>Update</strong></h2>\n\n<p>I reached out with the course creator and he was kind to replay and break it down for me, for the sake of help for others who may have encountered the same problem, I'll leave the question and the Answer </p>\n\n<blockquote>\n  <p>To access a variable in memory, the CPU needs the address  of this\n  variable in one of the registers. At the lowest levels of code\n  optimization, the compiler  loads this address from the code memory\n  before each and  every access to the variable.  The pointer speeds\n  this up, because being a local variable inside the main() function is\n  allocated to a register.  This means that the address sits in a\n  register (R0 in this case)  and does not need to be loaded and\n  re-loaded into a register each time.  At higher levels of optimization\n  the compiler generates a more sensible code  and the code without the\n  pointer is as fast as with the pointer. --MMS</p>\n</blockquote>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1556660642, "post_id": 55928972, "comment_id": 98511669, "body": "Please place quotes around your include and/or include real code.  Also include which symbol was unresolved.  Finally, make sure that all your source files are indeed linked together so that the files can see each other&#39;s globals."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1556660697, "post_id": 55928972, "comment_id": 98511681, "body": "Post the command line(s) that you used to compile the program."}, {"owner": {"reputation": 1135, "user_id": 5590742, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vNXUZ.png?s=128&g=1", "display_name": "jgreve", "link": "https://stackoverflow.com/users/5590742/jgreve"}, "edited": false, "score": 0, "creation_date": 1556660820, "post_id": 55928972, "comment_id": 98511733, "body": "Where do you define Data  ? (I see Data[i] in the for loop, but not a declaration)."}, {"owner": {"reputation": 12073, "user_id": 527574, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e5b251b4ac8f0cb7942587ee8077cddb?s=128&d=identicon&r=PG", "display_name": "Michael Dorgan", "link": "https://stackoverflow.com/users/527574/michael-dorgan"}, "edited": false, "score": 0, "creation_date": 1556660919, "post_id": 55928972, "comment_id": 98511766, "body": "His comment says it was passed as a function parameter.  Fully compiling code would help with these problems though..."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556661001, "post_id": 55928972, "comment_id": 98511790, "body": "what is/are the unresolved symbol(s)  ? Do you link all the needed objects or you missed file.o (whatever the way to give it, may be only one command to compile and link all)"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1556661830, "post_id": 55928972, "comment_id": 98512039, "body": "<code>#define get_arr(i)     (arr[i])</code> just obfuscates what the code does.  <code>get_arr( i )</code> doesn&#39;t provide any advantages over directly using <code>arr</code> with <code>arr[ i ]</code>, but it hides the use of the actual variable."}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556694084, "post_id": 55928972, "comment_id": 98518208, "body": "@moona did you read my answer ? Look in your makefile how the executable is made and you will see <i>file.o</i> is missing in the link"}], "answers": [{"tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": false, "score": 2, "last_activity_date": 1556661932, "creation_date": 1556661932, "answer_id": 55929232, "question_id": 55928972, "link": "https://stackoverflow.com/questions/55928972/accessing-array-indices-using-a-macro-in-c/55929232#55929232", "title": "Accessing array indices using a macro in C", "body": "<blockquote>\n  <p>I get a problem with linking: \"unresolved symbols\".</p>\n</blockquote>\n\n<p>if the unresolved symbols concern <em>arr</em> that means you missed to link with <em>file.o</em></p>\n\n<p>For instance having :</p>\n\n<p>file.h</p>\n\n<pre><code>#ifndef FILE_H\n#define FILE_H\n\ntypedef unsigned char uint8;\n\n#define SIZE 10\n\n#define get_arr(i)     (arr[i])\n\nextern const uint8 arr[SIZE];\n\n#endif\n</code></pre>\n\n<p>file.c</p>\n\n<pre><code>#include \"file.h\"\n\nconst uint8 arr[SIZE] = {0};\n</code></pre>\n\n<p>main.c</p>\n\n<pre><code>#include \"file.h\"\n\nvoid fill(uint8 * Data)\n{\n  for(uint8 i = 0; i&lt;SIZE; i++) {\n    Data[i] = get_arr(i); //Data is a pointer passed as a parameter to a function)\n  }\n}\n\nint main()\n{\n  uint8 a[SIZE];\n  fill(a);\n}\n</code></pre>\n\n<p>If I compile and link all file there is no error whatever the way :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc file.c main.c \npi@raspberrypi:/tmp $ \n</code></pre>\n\n<p>or</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc -c main.c\npi@raspberrypi:/tmp $ gcc -c file.c\npi@raspberrypi:/tmp $ gcc main.o file.o\npi@raspberrypi:/tmp $ \n</code></pre>\n\n<p>etc</p>\n\n<p>But if I miss to link with file.o :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc main.c\n/tmp/ccG9WO0e.o\u00a0: Dans la fonction \u00ab\u00a0fill\u00a0\u00bb\u00a0:\nmain.c:(.text+0x60)\u00a0: r\u00e9f\u00e9rence ind\u00e9finie vers \u00ab\u00a0arr\u00a0\u00bb\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>or</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc -c main.c\npi@raspberrypi:/tmp $ gcc -c file.c\npi@raspberrypi:/tmp $ gcc main.o\nmain.o\u00a0: Dans la fonction \u00ab\u00a0fill\u00a0\u00bb\u00a0:\nmain.c:(.text+0x60)\u00a0: r\u00e9f\u00e9rence ind\u00e9finie vers \u00ab\u00a0arr\u00a0\u00bb\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>etc</p>\n"}], "owner": {"reputation": 1, "user_id": 11364715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/433c453beaba36eb3fd578caec423aa8?s=128&d=identicon&r=PG&f=1", "display_name": "moona", "link": "https://stackoverflow.com/users/11364715/moona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1556666378, "creation_date": 1556660268, "last_edit_date": 1556666378, "question_id": 55928972, "link": "https://stackoverflow.com/questions/55928972/accessing-array-indices-using-a-macro-in-c", "title": "Accessing array indices using a macro in C", "body": "<p>I'm trying to access a C array using a macro. The array is declared as extern const in a header file and actually defined/initialized in a source file. The macro is in the header. I then want to access the array from another file. Both the other file and the file that defines the array #include the header.</p>\n\n<p>I've tried accessing the array directly from the other file and it works. I can also successfully use the macro if the array is defined in the header instead of a separate C file. But I need to access the array using a macro, and have the array defined in a separate source file, not the header.</p>\n\n<p>This is what I have in the header (let's call it file.h):</p>\n\n<pre><code>#define SIZE 10\n\n#define get_arr(i)     (arr[i])\n\nextern const uint8 arr[SIZE];\n</code></pre>\n\n<p>In the source with the array definition (this is file.c):</p>\n\n<pre><code>\"#include file.h\"\n\nconst uint8 arr[SIZE] = {0};\n</code></pre>\n\n<p>In the other source file that actually wants to use the array:</p>\n\n<pre><code>\"#include file.h\"\n\nfor(uint8 i = 0; i&lt;SIZE; i++) {\n   Data[i] = get_arr(i); //Data is a pointer passed as a parameter to a function)\n}\n</code></pre>\n\n<p>When I try to build, I get a problem with linking: \"unresolved symbols\".</p>\n"}, {"tags": ["c", "gcc", "makefile", "gnu-make"], "answers": [{"tags": [], "owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "is_accepted": false, "score": 0, "last_activity_date": 1556658698, "creation_date": 1556658698, "answer_id": 55928707, "question_id": 55928551, "link": "https://stackoverflow.com/questions/55928551/having-trouble-placing-object-files-in-a-new-directory-using-makefile/55928707#55928707", "title": "Having trouble placing object files in a new directory using makefile", "body": "<p>Any time you see a rule where the output generated does not go to the file <code>$@</code>, you know it's not right.  Make will set the <code>$@</code> automatic variable to the file name that it expects to be created and if the recipe does something different, the makefile will not work.</p>\n\n<p>Your rule sends the file to <code>$(OBJDIR)/$@</code>, not <code>$@</code>, so it's not right.</p>\n\n<p>So, you need to write your pattern rule like this:</p>\n\n<pre><code>%.o: %.c\n        @mkdir -p $(@D)\n        $(CC) $(CFLAGS) -c $&lt; -o $@\n</code></pre>\n\n<p>If that doesn't work you'll need to provide more information such as an example of the compile line make invokes, what errors you see, etc.</p>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 11376271, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1EZV9Bf2vcU/AAAAAAAAAAI/AAAAAAAAAFs/YNs2DQtIgb4/photo.jpg?sz=128", "display_name": "bitmeddler", "link": "https://stackoverflow.com/users/11376271/bitmeddler"}, "edited": false, "score": 0, "creation_date": 1556747557, "post_id": 55928857, "comment_id": 98539494, "body": "Thanks for the answer, but this is still not working. I get the following error: &quot;*** No rule to make target.&quot; I modified my code per your suggestions."}], "tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 0, "last_activity_date": 1556659583, "creation_date": 1556659583, "answer_id": 55928857, "question_id": 55928551, "link": "https://stackoverflow.com/questions/55928551/having-trouble-placing-object-files-in-a-new-directory-using-makefile/55928857#55928857", "title": "Having trouble placing object files in a new directory using makefile", "body": "<blockquote>\n  <p>I've been able to successfully create this directory, but I cannot\n  figure out how to place the files in it.</p>\n</blockquote>\n\n<p>There are two parts writing to doing that explicitly.</p>\n\n<ul>\n<li><p>First, and most fundamental, is that <strong>if you want <code>make</code> to create a file, you have to give it a rule for doing so</strong>.  You do have a pattern rule that could, in principle, have that effect ...</p>\n\n<blockquote>\n<pre><code>%.o: %.c\n  # ...\n</code></pre>\n</blockquote>\n\n<p>... but in practice, that rule cannot ever be matched to files in the <code>obj/</code> directory because your sources are not in that directory.  This might be more effective:</p>\n\n<pre><code>$(OBJDIR)/%.o: %.c\n    @mkdir -p $(@D)\n    $(CC) $(CFLAGS) -c $&lt; -o $@\n</code></pre>\n\n<p>Note in particular how now the target of the rule matches the artifact actually produced by that rule.</p></li>\n<li><p>Second, <strong>you must have a requirement to build the target of the rule</strong>, usually by having it be a dependency of some other rule.  Observe that your variable defining the object files contributing to <code>$(EXECUTABLE)</code> <em>does not</em> rely on objects from the <code>obj/</code> directory.  It is generated by this pattern substitution ...</p>\n\n<blockquote>\n<pre><code>OBJECTS     := $(patsubst %.c,%.o,$(SOURCES))\n</code></pre>\n</blockquote>\n\n<p>... which generates object names with the same path as the corresponding sources.  You probably want something more like this:</p>\n\n<pre><code>OBJECTS     := $(patsubst %.c,$(OBJDIR)/%.o,$(SOURCES))\n</code></pre>\n\n<p>You will note how that also corresponds to the change presented in the previous point.</p></li>\n</ul>\n\n<p>But that's a lot of work for little gain.  You would not have to modify your <code>clean</code> target very much to do without it there.  You could write your file in a somewhat simpler and more conventional form and still get output into a separate directory by leveraging <a href=\"https://www.gnu.org/software/make/manual/html_node/Directory-Search.html#index-vpath\" rel=\"nofollow noreferrer\">the VPATH feature of GNU (and some other) <code>make</code></a>.</p>\n"}], "owner": {"reputation": 29, "user_id": 11376271, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1EZV9Bf2vcU/AAAAAAAAAAI/AAAAAAAAAFs/YNs2DQtIgb4/photo.jpg?sz=128", "display_name": "bitmeddler", "link": "https://stackoverflow.com/users/11376271/bitmeddler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1556659583, "creation_date": 1556657742, "question_id": 55928551, "link": "https://stackoverflow.com/questions/55928551/having-trouble-placing-object-files-in-a-new-directory-using-makefile", "title": "Having trouble placing object files in a new directory using makefile", "body": "<p>I am very new at make. Thus far I've managed to create the following using some of GNU manual and tutorials found online. I'd like for make to place all of the created object files into the directory 'obj.' I've been able to successfully create this directory, but I cannot figure out how to place the files in it. Any suggestions or tips are appreciated. Also, on a general note, is there a good source for learning how to work with make besides the GNU documentation?</p>\n\n<pre><code># specify compiler\nCC          := gcc\n# set compiler flags\nCFLAGS      := -M -Igen/display -Igen/logic -Iman -Ilib/include -pipe -march=native -ftime-report\n# set linker flags\nLDFLAGS     := -lglut32 -loglx -lopengl32 -Llib\n# specify separate directory for objects\nOBJDIR      := obj\n# include all sources\nSOURCES     := $(wildcard gen/display/*.c gen/logic/*.c man/*.c)\n# create objects from the source files\nOBJECTS     := $(patsubst %.c,%.o,$(SOURCES)) \n# specify the name and the output directory of executable\nEXECUTABLE  := win32/demo\n\n# all isn't a real file\nall: $(EXECUTABLE)\n\n# compile\n%.o: %.c\n    @mkdir -p $(@D)\n    $(CC) $(CFLAGS) -c $&lt; -o $(OBJDIR)/$@   \n\n# link\n$(EXECUTABLE): $(OBJECTS)\n    $(CC) $^ $(LDFLAGS) -o $@\n\n# clean objects\nclean:\n    @$(RM) -rf $(OBJDIR)\n\n.PHONY: all clean\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1556658467, "post_id": 55928530, "comment_id": 98510937, "body": "Read <a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feoffile-always-wrong\"><b>Why is \u201cwhile (!feof(file))\u201d always wrong?</b></a>"}, {"owner": {"reputation": 2385, "user_id": 1009270, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/33fcdc9c0604cf69abb15e17840d2a3c?s=128&d=identicon&r=PG", "display_name": "john elemans", "link": "https://stackoverflow.com/users/1009270/john-elemans"}, "edited": false, "score": 0, "creation_date": 1556658636, "post_id": 55928530, "comment_id": 98510985, "body": "please look up formatting for code. A C function return value type is defined by putting the type in front of the function name. eg - int mySuperFunction()."}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1556658809, "post_id": 55928530, "comment_id": 98511043, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/14802470/read-list-of-numbers-in-txt-file-and-store-to-array-in-c\">Read list of numbers in txt file and store to array in C</a>"}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 1, "creation_date": 1556659035, "post_id": 55928530, "comment_id": 98511133, "body": "You can&#39;t return the address of a local variable (well, you <i>can</i> but using it is a bug).  So you&#39;ll need to figure something else out instead or returning <code>arr</code>. Either have the caller pass in the array or create it dynamically and return it. Also, why on earth is the array of <code>char</code> instead of <code>int</code> and what is the point of <code>bufsize</code>?"}, {"owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "edited": false, "score": 0, "creation_date": 1556659202, "post_id": 55928530, "comment_id": 98511181, "body": "Usually the user&#39;s prerogative where they want the file pointer, that is, you don&#39;t need <code>fseek</code>. Look at the documentation. <a href=\"https://pubs.opengroup.org/onlinepubs/007904875/functions/fscanf.html\" rel=\"nofollow noreferrer\">pubs.opengroup.org/onlinepubs/007904875/functions/fscanf.htm&zwnj;&#8203;l</a>"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1556663570, "post_id": 55928530, "comment_id": 98512470, "body": "<code>fscanf(file, &quot;%s&quot;, arr[i]);</code> will read a all characters up to the next <i>whitespace</i> (or EOF) whichever occurs first. You must either (1) dynamically allocate within your function for <code>arr</code> or (2) pass a pointer to a sufficiently allocated <code>arr</code> as a parameter. Then <code>while (fgets (arr[i], 100, file) { arr[i][strcspn(arr[i], &quot;\\r\\n&quot;)] = 0; i++; }</code>"}], "answers": [{"tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 2, "last_activity_date": 1556660192, "last_edit_date": 1556660192, "creation_date": 1556659041, "answer_id": 55928754, "question_id": 55928530, "link": "https://stackoverflow.com/questions/55928530/return-an-array-of-numbers-read-from-a-file/55928754#55928754", "title": "Return an array of numbers read from a file", "body": "<p>in</p>\n\n<blockquote>\n<pre><code>void to_array(FILE* file, int bufsize){\n  char arr[bufsize][100];\n  ...\n}\n</code></pre>\n</blockquote>\n\n<p>your array is local, if you return its address it will not be able to use it</p>\n\n<p>One way it to allocate it in the head by <em>malloc</em>, an other is to receive that array in argument to fill it. Note it cannot be static without having a constant size</p>\n\n<p>Do not use <em>feof</em> check the result of <em>fscanf</em></p>\n\n<p>You read numbers, so the array must be an array of numbers, let consider of <em>int</em></p>\n\n<p>Example where the function receives the file descriptor and a pointer to a variable which will contain the number of elements placed into the array, the function return the array allocated in the heap as you wanted</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint * to_array(FILE * fp, size_t * sz)\n{\n  int * a = malloc(0); /* initially empty */\n  int v;\n\n  *sz = 0; /* initially no element */\n\n  while (fscanf(fp, \"%d\", &amp;v) == 1) {\n    a = realloc(a, (++*sz)*sizeof(int)); /* add an entry */\n    a[*sz - 1] = v; /* set entry */\n  }\n\n  return a;\n}\n\nint main()\n{\n  size_t sz;\n  int * a = to_array(stdin, &amp;sz);\n\n  /* check */\n  for (size_t i = 0; i != sz; ++i)\n    printf(\"%d\\n\", a[i]);\n\n  /* free used memory */\n  free(a);\n\n  return 0;\n}\n</code></pre>\n\n<p>Compilation and execution :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ gcc -pedantic -Wextra -Wall a.c\npi@raspberrypi:/tmp $ echo 11 22 33 | ./a.out\n11\n22\n33\npi@raspberrypi:/tmp $\n</code></pre>\n\n<p>Execution under <em>valgrind</em> :</p>\n\n<pre><code>pi@raspberrypi:/tmp $ echo 11 22 33 | valgrind ./a.out\n==10080== Memcheck, a memory error detector\n==10080== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\n==10080== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info\n==10080== Command: ./a.out\n==10080== \n11\n22\n33\n==10080== \n==10080== HEAP SUMMARY:\n==10080==     in use at exit: 0 bytes in 0 blocks\n==10080==   total heap usage: 6 allocs, 6 frees, 5,144 bytes allocated\n==10080== \n==10080== All heap blocks were freed -- no leaks are possible\n==10080== \n==10080== For counts of detected and suppressed errors, rerun with: -v\n==10080== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 6 from 3)\n</code></pre>\n\n<p>The function allocate an additional entry each time, it is possible to do by block of a given number of entries to not have to do that each time an entry has to be added.</p>\n"}, {"tags": [], "owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "is_accepted": false, "score": 0, "last_activity_date": 1556668587, "last_edit_date": 1556668587, "creation_date": 1556663110, "answer_id": 55929430, "question_id": 55928530, "link": "https://stackoverflow.com/questions/55928530/return-an-array-of-numbers-read-from-a-file/55929430#55929430", "title": "Return an array of numbers read from a file", "body": "<p>Make sure to <code>#include &lt;stdio.h&gt;</code> when using it.</p>\n\n<p>Usually the user's prerogative where they want the file pointer, that is, you don't need <code>fseek</code>.</p>\n\n<p>One must accept the buffer size as well as the buffer, or one could use dynamic <code>realloc</code>, (more complicated error reporting and <code>free</code>.)</p>\n\n<p>Use the return values to decide whether to continue, not <code>feof</code>. I think you have chosen the right input-reading function with <code>fscanf</code>; be sure to read the <a href=\"https://pubs.opengroup.org/onlinepubs/007904875/functions/fscanf.html\" rel=\"nofollow noreferrer\">documentation</a>. Specifically, <code>%s</code> is almost certainly not what you want; perhaps <code>%d</code>?</p>\n\n<p><code>while</code> risks overflowing the buffer; if you have a fixed-size buffer, something like this:</p>\n\n<pre><code>size_t i;\nfor(i = 0; i &lt; bufsize &amp;&amp; scanf(\"%d\", buf + i) == 1; i++);\n</code></pre>\n\n<p>There are several things that can happen, including:</p>\n\n<ul>\n<li>Stream (file) error. Use <code>ferror</code> to test.</li>\n<li>You didn't hit the end of the file, this is appropriate to test with <code>feof</code>; if <code>i == bufsize</code> the programme has no more space to fit the number; otherwise, it's an invalid number. These conditions are awkward to handle, but I suggest <a href=\"https://en.wikipedia.org/wiki/Errno.h\" rel=\"nofollow noreferrer\">errno</a>.</li>\n<li>Success.</li>\n</ul>\n\n<p>Perhaps one wants to return a boolean value for success?</p>\n"}, {"tags": [], "owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "is_accepted": false, "score": 0, "last_activity_date": 1556667179, "last_edit_date": 1556667179, "creation_date": 1556665977, "answer_id": 55929777, "question_id": 55928530, "link": "https://stackoverflow.com/questions/55928530/return-an-array-of-numbers-read-from-a-file/55929777#55929777", "title": "Return an array of numbers read from a file", "body": "<p>If you choose to use an array with <em>automatic storage duration</em>, you must declare the array in the calling function and pass a pointer to the array to your function. You can then fill the array in the function. However, you must also provide a way to return the number of strings read. Your choice of a <code>void</code> type for your function complicates this (slightly) as you would normally choose a meaningful return type such as <code>size_t</code> allowing you to return the number of strings read. That notwithstanding, you can pass a pointer to a <code>size_t</code> value and update the value at that address within your function thereby making the number of strings available back in the calling function.</p>\n\n<p>A few notes:</p>\n\n<pre><code>/* if you need a constant, #define one (or more) */\n#define STRSZ  32       /* maximum string stize in array */\n#define NSTR  100       /* maximum number of strings in array */\n</code></pre>\n\n<p>(<em>don't skimp on buffer size</em>) The longest word in the unabridged dictionary (non-medical) is 29-characters and the longest 64-bit number is 20-character (including sign), so for normal use a buffer size of <code>30</code> will suffice, <code>32</code> will account for any trailing punctuation mark. (if space isn't a consideration for the number of strings you need to read, double <code>STRSZ</code> to <code>64</code>) Adjust the number of strings and the maximum characters in each as needed.</p>\n\n<p>Your function can then be written to take a <em>pointer to an array of char [32]</em>, e.g.</p>\n\n<pre><code> void to_array (char (*arr)[STRSZ], FILE *fp, size_t *nstr)\n{\n    *nstr = 0;  /* initialize number of strings to zero */\n\n    /* protect array bounds while reading each string from file */\n    while (*nstr &lt; NSTR &amp;&amp; fscanf (fp, \"%31s\" , arr[*nstr]) != EOF)\n        (*nstr)++;  /* increment number of strings */\n}\n</code></pre>\n\n<p>(<strong>note:</strong> the use of the <em>field-width</em> modifier <code>\"%31s\"</code> to protect the bounds of each string when reading from the file, and the use of <code>*nstr &lt; NSTR</code> to protect the array bounds for the number of strings read from the file)</p>\n\n<p>In <code>main()</code>, you can simply declare a 2D array with <em>automatic storage duration</em> and a variable to keep track of the number of strings filled, e.g.</p>\n\n<pre><code>    char arr[NSTR][STRSZ] = {{0}};  /* array to hold strings (max 31 char) */\n    size_t n = 0;                   /* number of strings read */\n</code></pre>\n\n<p>Now you can call your <code>to_array()</code> function as follows:</p>\n\n<pre><code>    to_array (arr, fp, &amp;n);     /* read strings from file, n holds number */\n</code></pre>\n\n<p>Putting it altogether along with proper validation that your file is open for reading before your call to <code>to_array()</code>, you could do:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n/* if you need a constant, #define one (or more) */\n#define STRSZ  32       /* maximum string size */\n#define NSTR  100       /* maximum number of strings in array */\n\nvoid to_array (char (*arr)[STRSZ], FILE *fp, size_t *nstr)\n{\n    *nstr = 0;  /* initialize number of strings to zero */\n\n    /* protect array bounds while reading each string from file */\n    while (*nstr &lt; NSTR &amp;&amp; fscanf (fp, \"%31s\" , arr[*nstr]) != EOF)\n        (*nstr)++;  /* increment number of strings */\n}\n\nint main (int argc, char **argv) {\n\n    char arr[NSTR][STRSZ] = {{0}};  /* array to hold strings (max 31 char) */\n    size_t n = 0;                   /* number of strings read */\n    /* use filename provided as 1st argument (stdin by default) */\n    FILE *fp = argc &gt; 1 ? fopen (argv[1], \"r\") : stdin;\n\n    if (!fp) {  /* validate file open for reading */\n        perror (\"file open failed\");\n        return 1;\n    }\n\n    to_array (arr, fp, &amp;n);     /* read strings from file, n holds number */\n\n    if (fp != stdin) fclose (fp);   /* close file if not stdin */\n\n    for (size_t i = 0; i &lt; n; i++)  /* output each string in arr */\n        printf (\"arr[%2zu] : '%s'\\n\", i, arr[i]);\n}\n</code></pre>\n\n<p><strong>Example Input File</strong></p>\n\n<pre><code>$ cat ../dat/10int_nl.txt\n8572\n-2213\n6434\n16330\n3034\n12346\n4855\n16985\n11250\n1495\n</code></pre>\n\n<p><strong>Example Use/Output</strong></p>\n\n<pre><code>$ ./bin/fscanffile ../dat/10int_nl.txt\narr[ 0] : '8572'\narr[ 1] : '-2213'\narr[ 2] : '6434'\narr[ 3] : '16330'\narr[ 4] : '3034'\narr[ 5] : '12346'\narr[ 6] : '4855'\narr[ 7] : '16985'\narr[ 8] : '11250'\narr[ 9] : '1495'\n</code></pre>\n\n<p>Look things over and let me know if you have further questions. Consider using <code>fgets()</code> if you need to read a line-at-a-time.</p>\n"}], "owner": {"reputation": 15, "user_id": 11176586, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-z4ZsFpX-x1M/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DWizv8l8uaHglNu5V_mRa1W-Z2khw/mo/photo.jpg?sz=128", "display_name": "otan", "link": "https://stackoverflow.com/users/11176586/otan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 55928754, "answer_count": 3, "score": 0, "last_activity_date": 1556668587, "creation_date": 1556657645, "last_edit_date": 1556657737, "question_id": 55928530, "link": "https://stackoverflow.com/questions/55928530/return-an-array-of-numbers-read-from-a-file", "title": "Return an array of numbers read from a file", "body": "<p>I have an assignment in which I need to write a function what reads numbers from file to an array and returns that array(pointer at the first element).\nI wrote a functions what reads from file to array but I have no idea how to return it.</p>\n\n<pre><code>void to_array(FILE* file, int bufsize){\nchar arr[bufsize][100];\nfseek(file, 0, SEEK_SET);\nint i = 0;\nwhile(!feof(file)){\n    fscanf(file, \"%s\", arr[i]);\n    i++;\n}\n</code></pre>\n\n<p>I would appreciate any ideas.</p>\n"}, {"tags": ["c", "arrays"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 2, "creation_date": 1556657507, "post_id": 55928474, "comment_id": 98510620, "body": "There&#39;s no point in reading files into their own buffer. Just read them into the single buffer."}, {"owner": {"reputation": 1149, "user_id": 2472827, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t5rYY.jpg?s=128&g=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/2472827/neil"}, "edited": false, "score": 0, "creation_date": 1556657664, "post_id": 55928474, "comment_id": 98510676, "body": "My guess would be you are overwriting the contents each time instead of appending, but it&#39;s difficult to know without some code."}], "answers": [{"comments": [{"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "edited": false, "score": 0, "creation_date": 1556657986, "post_id": 55928567, "comment_id": 98510777, "body": "this mostly makes sense to me, but can you explain what p and buf represent in this? Is buf the single buffer that all files are being written to, or a buffer for a single file?"}, {"owner": {"reputation": 136, "user_id": 2736641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5316d692cc603c3ad2df0f03869bb96b?s=128&d=identicon&r=PG", "display_name": "UziMonkey", "link": "https://stackoverflow.com/users/2736641/uzimonkey"}, "reply_to_user": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "edited": false, "score": 1, "creation_date": 1556658383, "post_id": 55928567, "comment_id": 98510909, "body": "<code>buf</code> is the buffer you allocate after you calculate how large all the files are. <code>p</code> is initially a pointer to that buffer, but as you read files in using <code>fread</code>, you add the number of bytes you read to <code>p</code> so that the next file will be read in after the previous file."}, {"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "edited": false, "score": 0, "creation_date": 1556658878, "post_id": 55928567, "comment_id": 98511075, "body": "this looks like it should work, but when I put it in my code and added a printf to print the <code>buf</code>, it still comes up empty."}, {"owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "edited": false, "score": 0, "creation_date": 1556659241, "post_id": 55928567, "comment_id": 98511198, "body": "I meant to say I printed <code>p</code>, and it still came up empty. Maybe I am allocating the space for the single buffer incorrectly?"}, {"owner": {"reputation": 136, "user_id": 2736641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5316d692cc603c3ad2df0f03869bb96b?s=128&d=identicon&r=PG", "display_name": "UziMonkey", "link": "https://stackoverflow.com/users/2736641/uzimonkey"}, "reply_to_user": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "edited": false, "score": 1, "creation_date": 1556659547, "post_id": 55928567, "comment_id": 98511277, "body": "<code>p</code> points to the end of <code>buf</code> after reading the files, to the very end of a very long string. Print <code>buf</code> to see the contents of all the files."}, {"owner": {"reputation": 136, "user_id": 2736641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5316d692cc603c3ad2df0f03869bb96b?s=128&d=identicon&r=PG", "display_name": "UziMonkey", "link": "https://stackoverflow.com/users/2736641/uzimonkey"}, "reply_to_user": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "edited": false, "score": 0, "creation_date": 1556660302, "post_id": 55928567, "comment_id": 98511540, "body": "Also, see the edit I made to the code. You really should close files when you&#39;re finished with them."}], "tags": [], "owner": {"reputation": 136, "user_id": 2736641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5316d692cc603c3ad2df0f03869bb96b?s=128&d=identicon&r=PG", "display_name": "UziMonkey", "link": "https://stackoverflow.com/users/2736641/uzimonkey"}, "is_accepted": true, "score": 2, "last_activity_date": 1556660270, "last_edit_date": 1556660270, "creation_date": 1556657830, "answer_id": 55928567, "question_id": 55928474, "link": "https://stackoverflow.com/questions/55928474/how-to-read-multiple-txt-files-into-a-single-buffer/55928567#55928567", "title": "How to read multiple .txt files into a single buffer?", "body": "<p>It sounds like you're doing everything correct, but you need to increment the pointer before you pass it to <code>fread</code> for the next file otherwise you'll overwrite the beginning of the file over and over.</p>\n\n<p>Assuming <code>buf</code> is the correct size for all the files +1 for the nul byte and files is an array of <code>char *</code>'s containing the filenames <code>NUM_FILES</code> long, you'll need to do something like this.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>char *p = buf;\nfor(int i = 0; i &lt; NUM_FILES; i++) {\n    FILE *f = fopen(files[i], \"rb\");\n\n    fseek(f, 0, SEEK_END);\n    long bytes = ftell(f);\n    fseek(f, 0, SEEK_SET);\n\n    fread(p, (size_t)bytes, 1, f);\n    p += bytes;\n\n    fclose(f);\n}\n*p = 0;\n</code></pre>\n"}], "owner": {"reputation": 748, "user_id": 609049, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a4590daa415e412830045e9c44b1619f?s=128&d=identicon&r=PG", "display_name": "skippy_winks", "link": "https://stackoverflow.com/users/609049/skippy-winks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 55928567, "answer_count": 1, "score": 0, "last_activity_date": 1556660270, "creation_date": 1556657334, "last_edit_date": 1556657832, "question_id": 55928474, "link": "https://stackoverflow.com/questions/55928474/how-to-read-multiple-txt-files-into-a-single-buffer", "title": "How to read multiple .txt files into a single buffer?", "body": "<p>I am trying to read multiple text files into a single char* array in C. I can get as far as allocating the char* to the correct size (i.e. the sizes of all the text files summed up). </p>\n\n<p>I tried to read each file, one by one, into their own buffer, then concatenate that buffer onto the end of the one that contains them all. This is all done in a for-loop. But when I print it out to make sure it worked, only the last file that was read is printed out.</p>\n\n<p>I have also tried fread, but that seems to overwrite the buffer that it writes to, rather than append to the end of it.</p>\n\n<p>Here is my code, most of it is from another SO thread:</p>\n\n<pre><code>for(int i = 2; i &lt; argc; i++) {\nchar *buffer = NULL;\nsize_t size = 0;\n\n/* Get the buffer size */\nfseek(file, 0, SEEK_END); /* Go to end of file */\nsize = ftell(file); /* How many bytes did we pass ? */\n/* Set position of stream to the beginning */\nrewind(file);\n/* Allocate the buffer (no need to initialize it with calloc) */\nbuffer = malloc((size + 1) * sizeof(*buffer)); /* size + 1 byte for the \\0 */\n/* Read the file into the buffer */\nfread(buffer, size, 1, file); /* Read 1 chunk of size bytes from fp into buffer */\n/* NULL-terminate the buffer */\nbuffer[size] = '\\0';\n\nallFiles = strcat(allFiles, buffer);\nfree(buffer);\nfclose(file);\n}\n</code></pre>\n\n<p>Please help me out, I am stumped by what seems like a simple thing to do in C. Thanks.</p>\n"}, {"tags": ["c", "cs50"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 5, "creation_date": 1556655394, "post_id": 55928086, "comment_id": 98509828, "body": "What is <code>hashtable</code>? Show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Emphasis on <b>complete</b>."}, {"owner": {"reputation": 2449, "user_id": 500276, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/200bf76976f24add540182f5c3a42788?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Benningfield", "link": "https://stackoverflow.com/users/500276/mark-benningfield"}, "edited": false, "score": 4, "creation_date": 1556655396, "post_id": 55928086, "comment_id": 98509830, "body": "Exactly where does the &quot;80,000,000&quot; number come from?"}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 3, "creation_date": 1556655494, "post_id": 55928086, "comment_id": 98509866, "body": "Did you know that it&#39;s a waste of time and CPU cycles to manually <code>free</code> everything right before exiting?  The operating system is going to deallocate all of the memory assigned to your program anyway, so all the bookkeeping work is wasted."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 4, "creation_date": 1556655797, "post_id": 55928086, "comment_id": 98509975, "body": "@zwol It&#39;s a good habit to clean up the mess after yourself. Once one learned it they can think when to apply or not this skill. But in this specific case it might have pointed to some bug."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556657171, "post_id": 55928086, "comment_id": 98510498, "body": "That only 143k <code>malloc</code>s are performed is excellent justification for saying that at most that many <code>free</code>s <b><i>should</i></b> be performed, but it&#39;s no justification at all for believing that no more <i>will</i> be performed.  The latter is determined by your program, and the discrepancy is indeed something to worry about.  It means your program is wrong."}, {"owner": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "edited": false, "score": 0, "creation_date": 1556658293, "post_id": 55928086, "comment_id": 98510877, "body": "I can see what you&#39;ve done. but what are you trying to do?  hint: the structure built by <code>load()</code> is totally wrong. the definition of <code>node</code> could be useful too."}, {"owner": {"reputation": 1, "user_id": 10485778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a014952788ab25082e287527d50c7e?s=128&d=identicon&r=PG&f=1", "display_name": "Alkh", "link": "https://stackoverflow.com/users/10485778/alkh"}, "reply_to_user": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "edited": false, "score": 0, "creation_date": 1556658569, "post_id": 55928086, "comment_id": 98510967, "body": "@Jasen I have thought about it, but when I run it with check50, which submits the program to some tests, it works fine until unload messes it up, that&#39;s why I didn&#39;t look further into the other functions. Could you please point the main problem?"}, {"owner": {"reputation": 1, "user_id": 10485778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a014952788ab25082e287527d50c7e?s=128&d=identicon&r=PG&f=1", "display_name": "Alkh", "link": "https://stackoverflow.com/users/10485778/alkh"}, "reply_to_user": {"reputation": 2449, "user_id": 500276, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/200bf76976f24add540182f5c3a42788?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Benningfield", "link": "https://stackoverflow.com/users/500276/mark-benningfield"}, "edited": false, "score": 0, "creation_date": 1556659084, "post_id": 55928086, "comment_id": 98511146, "body": "@MarkBenningfield  It comes from running valgrind: ==9416== HEAP SUMMARY: ==9416==     in use at exit: 1,240 bytes in 13 blocks ==9416==   total heap usage: 143,094 allocs, 85,679,521 frees, 8,014,288 bytes allocated"}, {"owner": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "edited": false, "score": 0, "creation_date": 1556659287, "post_id": 55928086, "comment_id": 98511210, "body": "the main error is that load() is building the wrong structure.  what structure do you think load() should be building?"}, {"owner": {"reputation": 1, "user_id": 10485778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a014952788ab25082e287527d50c7e?s=128&d=identicon&r=PG&f=1", "display_name": "Alkh", "link": "https://stackoverflow.com/users/10485778/alkh"}, "reply_to_user": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "edited": false, "score": 0, "creation_date": 1556659614, "post_id": 55928086, "comment_id": 98511301, "body": "@Jasen I intend to hash each word in the dictionary and then append it to the beginning of the linked list originated by the corresponding element in the node pointer to the hashtable array."}, {"owner": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "edited": false, "score": 0, "creation_date": 1556659939, "post_id": 55928086, "comment_id": 98511407, "body": "where does <code>wnode-&gt;next</code> point?  where should it point?"}, {"owner": {"reputation": 1, "user_id": 10485778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a014952788ab25082e287527d50c7e?s=128&d=identicon&r=PG&f=1", "display_name": "Alkh", "link": "https://stackoverflow.com/users/10485778/alkh"}, "reply_to_user": {"reputation": 10217, "user_id": 471930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tds8p.png?s=128&g=1", "display_name": "Jasen", "link": "https://stackoverflow.com/users/471930/jasen"}, "edited": false, "score": 0, "creation_date": 1556662408, "post_id": 55928086, "comment_id": 98512194, "body": "@Jasen I guess I realize the problem now that I tried explaining what it does, I believe the way in which I update the node is just wrong, as it causes <b>all</b> the elements of the hashtable array to be connected as some large linked list, hence losing the intended structure. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10485778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a014952788ab25082e287527d50c7e?s=128&d=identicon&r=PG&f=1", "display_name": "Alkh", "link": "https://stackoverflow.com/users/10485778/alkh"}, "is_accepted": false, "score": 0, "last_activity_date": 1556714392, "creation_date": 1556714392, "answer_id": 55936444, "question_id": 55928086, "link": "https://stackoverflow.com/questions/55928086/cs50-speller-unload-executes-80-000-000-frees/55936444#55936444", "title": "CS50 speller: Unload executes 80,000,000+ frees", "body": "<p>In case anybody finds it helpful, the problem was within the load function. The nodes malloced were updated wrongfully so that the elements of the hashtable array weren't independent linked lists and I was unnecessarily using a head node to point to the first element of the list each time we wanted to add a node. Instead, to add a new node to its corresponding element in the hashtable array, we use the element itself as the head of the linked list and we arrange it so that it points to each node added, thus succesfully keeping track of the beginning of the linked list. Each element in the hashtable is initially pointing to NULL so that we can find the end of each linked list.</p>\n\n<pre><code>int null()\n{\n    for (int i = 0; i &lt; 264636; i++)\n    {\n        hashtable[i]-&gt;next = NULL;\n    }\n    return 0;\n}\n\nbool load(const char *dictionary)\n{\n\n    opntr = fopen(dictionary, \"r\");\n    while (fscanf(opntr, \"%s\", WORD) != EOF)\n    {\n        wnode = malloc(sizeof(node));\n        if (wnode == NULL)\n        {\n            unload();\n            return false;\n        }\n        strcpy(wnode-&gt;word, WORD);\n        unsigned long key = hash(wnode-&gt;word);\n        wnode-&gt;next = hashtable[key]; \n        hashtable[key] = wnode; \n    }\n    return true;\n}\n\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10485778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3a014952788ab25082e287527d50c7e?s=128&d=identicon&r=PG&f=1", "display_name": "Alkh", "link": "https://stackoverflow.com/users/10485778/alkh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 864, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1556714392, "creation_date": 1556655258, "last_edit_date": 1556662544, "question_id": 55928086, "link": "https://stackoverflow.com/questions/55928086/cs50-speller-unload-executes-80-000-000-frees", "title": "CS50 speller: Unload executes 80,000,000+ frees", "body": "<p>This is pset 5 in Harvard's CS50. It consists mainly of loading the dictionary, checking whether each word in the chosen text is found within the loaded dictionary and then unloading (freeing all of the allocated memory).\nAll the other functions work but when it comes to unload it just executes, as stated, 80,000,000+ frees, whilst in the program there is just 143,094 mallocs, I am a newbie so this is mindblowing for me. Below are the relevant functions for unload. </p>\n\n<p><strong>Edit (1):</strong> Here is some context regarding the variable <em>hashtable</em>.</p>\n\n<pre><code>typedef struct node\n{\n    char word[LENGTH+2];\n    struct node *next;\n}\nnode;\n\nnode *hashtable[264636] = { NULL };\n</code></pre>\n\n<p>I initialize each element to NULL so that in unload I can easily skip the index values for which no key was generated in the hash function.</p>\n\n<pre><code>//LOAD FUNCTION: Loads the dictionary into a hash table. Djb2 function used. \n\nbool load(const char *dictionary)\n{\n    head = malloc(sizeof(node));\n    head-&gt;next = NULL;\n    if (head == NULL)\n    {\n        unload();\n        return false;\n    }\n    opntr = fopen(dictionary, \"r\");\n\n    while (fscanf(opntr, \"%s\", WORD) != EOF)\n    {\n        wnode = malloc(sizeof(node));\n        if (wnode == NULL)\n        {\n            unload();\n            return false;\n        }\n        strcpy(wnode-&gt;word, WORD);\n        wnode-&gt;next = head; \n        head = wnode; \n        unsigned long key = hash(wnode-&gt;word);\n        hashtable[key] = wnode;\n        wnode = wnode-&gt;next;\n    }\n    return true;\n}\n</code></pre>\n\n<pre><code>// Checks whether the input word is somewhere within the dictionary\n\nbool check(const char *word)\n{\n    char dword[strlen(word) + 1];\n    strcpy(dword, word);\n    for (int c = 0; c &lt; strlen(dword); c++)\n    {\n        dword[c] = tolower(dword[c]);\n    }\n    int key_w;\n    key_w = hash(dword);\n    node *cursor = hashtable[key_w];\n    while (cursor != NULL)\n    {\n        if (strcmp(cursor-&gt;word, dword) == 0)\n        {\n            return true;\n        }\n        cursor = cursor-&gt;next; \n    }\n    return false;\n}\n\n</code></pre>\n\n<pre><code>// Unloads memory allocated (?) to store the dictionary\n\nbool unload(void)\n{\n    for (int in = 0; in &lt; 264636; in++)\n    {\n        node *fhead = hashtable[in];             \n        while (fhead != NULL)\n        {\n            node *fcursor = fhead-&gt;next;\n            free(fhead);\n            fhead = fcursor;\n        }\n    }\n    return true;\n}\n\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 1, "creation_date": 1556654296, "post_id": 55927873, "comment_id": 98509365, "body": "The first item in a for-loop-statement is only called one time. So y=sin(2*M_PI<i>f</i>t) doesn&#39;t change over the iterations. If you want to update y you have to do it inside the for-loop."}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 1, "creation_date": 1556654391, "post_id": 55927873, "comment_id": 98509415, "body": "And please correct your indentation."}, {"owner": {"reputation": 1, "user_id": 11434372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZDG0X.jpg?s=128&g=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/11434372/richard"}, "reply_to_user": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 0, "creation_date": 1556654627, "post_id": 55927873, "comment_id": 98509512, "body": "I tried it like this before and same result. failure!   /* write 1 seconds of time data into the file stream*/    for(i = 0; i &lt; t;i++){  //y=sin(i<i>M_PI/180); y=sin(2*M_PI</i>f<i>t);  //       fprintf (fp, &quot;%g  %g\\n&quot;,i ,y);        fprintf (fp, &quot;%g\\n&quot;,y);    }      /</i> close the file*/      fclose (fp);    return 0; }"}, {"owner": {"reputation": 1, "user_id": 11434372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZDG0X.jpg?s=128&g=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/11434372/richard"}, "reply_to_user": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 0, "creation_date": 1556654861, "post_id": 55927873, "comment_id": 98509594, "body": "Should I be able to do it with one for loop or two? Thanks."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556654878, "post_id": 55927873, "comment_id": 98509600, "body": "Please edit the question with the further code. It&#39;s unreadable in a comment."}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 0, "creation_date": 1556654885, "post_id": 55927873, "comment_id": 98509604, "body": "It is not easy to help you cause your code is wrong and doesn&#39;t compile. So please change it to a complete example of your problem which compiles and gives the error you describe. Problems: The initial value of t is missing, f is missing and I don&#39;t think you really want to have that dependency between t and i."}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 0, "creation_date": 1556654981, "post_id": 55927873, "comment_id": 98509653, "body": "&quot;Should I be able to do it with one for loop or two?&quot; Most probably yes but I&#39;m not sure if I 100% understand what you want to do..."}, {"owner": {"reputation": 1, "user_id": 11434372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZDG0X.jpg?s=128&g=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/11434372/richard"}, "edited": false, "score": 0, "creation_date": 1556655535, "post_id": 55927873, "comment_id": 98509885, "body": "I posted the full program with the problem."}], "answers": [{"comments": [{"owner": {"reputation": 4046, "user_id": 4971422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4abf51a937ddda51cc6813445605c50?s=128&d=identicon&r=PG&f=1", "display_name": "FredK", "link": "https://stackoverflow.com/users/4971422/fredk"}, "edited": false, "score": 0, "creation_date": 1556657075, "post_id": 55928257, "comment_id": 98510464, "body": "You should not use doubles as a loop index. You might end up with an iteration too few, or an iteration extra, due to truncation/roundoff errors (in the case shown, it will probably work since the doubles are actually integer values, but yo9u should never rely on that)"}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 4046, "user_id": 4971422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4abf51a937ddda51cc6813445605c50?s=128&d=identicon&r=PG&f=1", "display_name": "FredK", "link": "https://stackoverflow.com/users/4971422/fredk"}, "edited": false, "score": 0, "creation_date": 1556657119, "post_id": 55928257, "comment_id": 98510479, "body": "@FredK It is the code of he OP. But you are right. t should be an unsigned int and i should also. I change that. Even if I think it doesn&#39;t matter in this case."}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "reply_to_user": {"reputation": 1, "user_id": 11434372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZDG0X.jpg?s=128&g=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/11434372/richard"}, "edited": false, "score": 0, "creation_date": 1556657552, "post_id": 55928257, "comment_id": 98510639, "body": "@Richard FredK is right and you should care about that limitation."}, {"owner": {"reputation": 1, "user_id": 11434372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZDG0X.jpg?s=128&g=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/11434372/richard"}, "edited": false, "score": 0, "creation_date": 1556659948, "post_id": 55928257, "comment_id": 98511411, "body": "user6556709 I do care, honest."}], "tags": [], "owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "is_accepted": true, "score": 0, "last_activity_date": 1556657188, "last_edit_date": 1556657188, "creation_date": 1556656180, "answer_id": 55928257, "question_id": 55927873, "link": "https://stackoverflow.com/questions/55927873/how-to-iterate-this-sin-equation/55928257#55928257", "title": "How to iterate this sin equation?", "body": "<p>I think I understand what you really want to do:</p>\n\n<p>Your control variable is neither i nor t but i/t which is i-th sample of t samples in a second:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n\n#define LEN 256\n\nint main ()\n{\n    FILE * fp;\n    unsigned int i=0; //sample count\n    double y=0; //y values\n    double f=0; //frequency\n    unsigned int t=0; //time\n\n    /* open the file for writing*/\n    fp = fopen (\"1.dat\",\"w\");\n\n    printf(\"Enter the frequency in hertz: \");\n    scanf(\"%lg\", &amp;f);\n    printf(\"Enter the number of samples : \");\n    scanf(\"%u\", &amp;t);\n    /* write 1 seconds of time data into the file stream*/\n    for(i = 0; i &lt; t;i++){\n        y=sin(2*M_PI*f*i/t);\n        fprintf (fp, \"%g\\n\",y);\n    }\n\n    /* close the file*/  \n    fclose (fp);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11434372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZDG0X.jpg?s=128&g=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/11434372/richard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 55928257, "answer_count": 1, "score": -1, "last_activity_date": 1556657188, "creation_date": 1556654110, "last_edit_date": 1556655316, "question_id": 55927873, "link": "https://stackoverflow.com/questions/55927873/how-to-iterate-this-sin-equation", "title": "How to iterate this sin equation?", "body": "<p>I can't create the correct file. the equation in the program doesn't iterate through and it only writes the same sum at as many samples as were requested.</p>\n\n<p>for loops.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;math.h&gt;\n\n#define LEN 256\n\nint main ()\n{\n   FILE * fp;\n   double i=0; //sample count\n   double y=0; //y values\n   double f=0; //frequency\n   double t=0; //time\n\n   /* open the file for writing*/\n   fp = fopen (\"1.dat\",\"w\");\n//fprintf(fp, \"sample #\\ty-value\\n\"); \n\nprintf(\"Enter the frequency in hertz: \");\nscanf(\"%lg\", &amp;f);\nprintf(\"Enter the number of samples : \");\nscanf(\"%lg\", &amp;t);\n\n\n\n   /* write 1 seconds of time data into the file stream*/\n   for(i = 0; i &lt; t;i++){\n\n//y=sin(i*M_PI/180);\ny=sin(2*M_PI*f*t);\n\n//       fprintf (fp, \"%g  %g\\n\",i ,y);\n       fprintf (fp, \"%g\\n\",y);\n   }\n\n   /* close the file*/  \n   fclose (fp);\n   return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "struct"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1556653544, "post_id": 55927435, "comment_id": 98509070, "body": "For those that missed the earlier question: <a href=\"https://stackoverflow.com/questions/55926255/passing-values-to-char-struct-member\" title=\"passing values to char struct member\">stackoverflow.com/questions/55926255/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 6, "creation_date": 1556652294, "post_id": 55927478, "comment_id": 98508600, "body": "This is yet another illustration of why you should never <code>typedef</code> a pointer."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 1, "creation_date": 1556652378, "post_id": 55927478, "comment_id": 98508637, "body": "Of course, this means that the the code the OP presented never compiled successfully, and so could never have generated a segfault, so who knows whether this is the real issue that tripped them up."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556672549, "post_id": 55927478, "comment_id": 98514161, "body": "Don&#39;t forget to <code>free()</code> each <code>strdup()</code>."}], "tags": [], "owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "is_accepted": true, "score": 4, "last_activity_date": 1556652827, "last_edit_date": 1556652827, "creation_date": 1556652218, "answer_id": 55927478, "question_id": 55927435, "link": "https://stackoverflow.com/questions/55927435/passing-char-into-struct/55927478#55927478", "title": "Passing char * into struct", "body": "<p>Here</p>\n\n<pre><code>typedef struct Info *infoPtr;\n</code></pre>\n\n<p><code>infoPtr</code> is of <code>struct Info*</code> type, this</p>\n\n<pre><code>infoPtr* info=(infoPtr)malloc(sizeof(infoPtr)); /* info will be of struct Info** type */\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>infoPtr info = malloc(sizeof(*infoPtr)); /* typecasting is not required */\n</code></pre>\n\n<p>Side note, its not considered as good practice to <code>typedef</code> a pointer, do read <a href=\"https://stackoverflow.com/questions/3781932/is-typedefing-a-pointer-type-considered-bad-practice\">Is it a good idea to typedef pointers?</a></p>\n\n<p>Also here</p>\n\n<pre><code>info-&gt;name=strup(name);\n</code></pre>\n\n<p>you wanted to use <code>strdup()</code> instead of <code>strup()</code> for e.g</p>\n\n<pre><code>info-&gt;name=strdup(name);\n</code></pre>\n\n<p>Coming to your question <em>ALL I want is to correctly pass a char string into name ?</em> Yes the way you passed argument to <code>enter()</code> is correct except <strong>typedefing struct pointer</strong>. And passing string literal <code>google</code> like</p>\n\n<pre><code>enter(\"google\");\n</code></pre>\n\n<p>and defining <code>enter()</code> like</p>\n\n<pre><code>void enter(char *name){ /* Its correct */\n  /* play with name */\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 11418952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a58a809fcf7c54e2ea2ff70a2d1274a?s=128&d=identicon&r=PG&f=1", "display_name": "JamesTheProg", "link": "https://stackoverflow.com/users/11418952/jamestheprog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 55927478, "answer_count": 1, "score": 0, "last_activity_date": 1556653572, "creation_date": 1556652005, "question_id": 55927435, "link": "https://stackoverflow.com/questions/55927435/passing-char-into-struct", "title": "Passing char * into struct", "body": "<p>So, I have a struct member char* and I want to initialize it after allocating node memory .However,this method gets me a Seg Fault.\nNote. YES, I want a <em>infoPtr. Excuse any syntax errors, these are not the problem I am trying to solve . ALL I want is to correctly pass a char</em> string into name.</p>\n\n<pre><code>struct Info{\n    char *name;\n}\ntypedef struct Info *infoPtr;\nint main(void){\n    enter(\"google\");\n}\nvoid enter(char *name){\n    infoPtr* info=(infoPtr)malloc(sizeof(infoPtr));\n    info-&gt;name=strup(name);\n}\n</code></pre>\n"}, {"tags": ["c", "assembly", "x86-64", "reverse-engineering"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1556651433, "post_id": 55927120, "comment_id": 98508258, "body": "Your first task is figuring out the calling convention - what is <code>x</code>, what is <code>y</code>."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1556651539, "post_id": 55927120, "comment_id": 98508299, "body": "isn&#39;t the 2nd cmp supposed to be <code>cmpq %rdi, %rsi</code> too"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1556651900, "post_id": 55927120, "comment_id": 98508440, "body": "Answer: <code>for (i = 0xDEADBEEF; x &gt; y; x --) { result += x; }</code>"}, {"owner": {"reputation": 23, "user_id": 10360715, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-As9uKzhvEIc/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaO_efRmFxIVP8L5rvsALCdcdEN5cA/mo/photo.jpg?sz=128", "display_name": "Soph Kwon", "link": "https://stackoverflow.com/users/10360715/soph-kwon"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1556654064, "post_id": 55927120, "comment_id": 98509272, "body": "@AnttiHaapala May I ask why i = 0xDEADBEEF?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1556654112, "post_id": 55927120, "comment_id": 98509298, "body": "to show that the question is stupid. There is colon missing from after the label and basically <code>rsi</code> would be a variable name..."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10360715, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-As9uKzhvEIc/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaO_efRmFxIVP8L5rvsALCdcdEN5cA/mo/photo.jpg?sz=128", "display_name": "Soph Kwon", "link": "https://stackoverflow.com/users/10360715/soph-kwon"}, "edited": false, "score": 0, "creation_date": 1556654144, "post_id": 55927344, "comment_id": 98509313, "body": "Would it be possible to incorporate <code>long i</code> and keep everything in the &#39;for&#39; loop?"}, {"owner": {"reputation": 2449, "user_id": 500276, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/200bf76976f24add540182f5c3a42788?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Benningfield", "link": "https://stackoverflow.com/users/500276/mark-benningfield"}, "reply_to_user": {"reputation": 23, "user_id": 10360715, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-As9uKzhvEIc/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaO_efRmFxIVP8L5rvsALCdcdEN5cA/mo/photo.jpg?sz=128", "display_name": "Soph Kwon", "link": "https://stackoverflow.com/users/10360715/soph-kwon"}, "edited": false, "score": 0, "creation_date": 1556654563, "post_id": 55927344, "comment_id": 98509487, "body": "@Ian: The point is that your assembly code doesn&#39;t translate to a for loop using <code>long i</code>. It translates to a do-while loop."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 2449, "user_id": 500276, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/200bf76976f24add540182f5c3a42788?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Benningfield", "link": "https://stackoverflow.com/users/500276/mark-benningfield"}, "edited": false, "score": 0, "creation_date": 1556657353, "post_id": 55927344, "comment_id": 98510560, "body": "@MarkBenningfield: But that <i>is</i> how a C <code>for()</code> loop compiles to asm, as an idiomatic loop with a conditional branch at the <i>bottom</i>.  <a href=\"//stackoverflow.com/q/47783926\">Why are loops always compiled into &quot;do...while&quot; style (tail jump)?</a>.  If the compiler can&#39;t prove that the loop condition is true the first time, you get a cmp/jcc to skip over the loop entirely if it needs to run zero times.  This could well be <code>gcc -O1</code> output (except for the missing <code>%</code> on <code>rsi</code>, and the missing <code>:</code> on <code>.L2</code>)  Gcc doesn&#39;t look for the xor-zeroing peephole optimization at <code>-O1</code>, but will do normal loop stuff."}], "tags": [], "owner": {"reputation": 8038, "user_id": 304748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc0a40ced265d8fde3bd35d5689c4181?s=128&d=identicon&r=PG", "display_name": "Brian Walker", "link": "https://stackoverflow.com/users/304748/brian-walker"}, "is_accepted": false, "score": 3, "last_activity_date": 1556651771, "last_edit_date": 1556651771, "creation_date": 1556651497, "answer_id": 55927344, "question_id": 55927120, "link": "https://stackoverflow.com/questions/55927120/how-do-i-translate-an-optimized-x86-64-asm-loop-back-to-a-c-for-loop/55927344#55927344", "title": "How do I translate an optimized x86-64 asm loop back to a C for loop?", "body": "<p>Assuming this is a function taking 2 parameters. Assuming this is using the gcc amd64 calling convention, it will pass the two parameters in rdi and rsi. In your C function you call these x and y.</p>\n\n<pre><code>long foo(long x /*rdi*/, long y /*rsi*/)\n{\n    //movl $0, %eax\n    long result = 0;  /* rax */\n\n    //cmpq %rsi, %rdi\n    //jle .L2\n    if (x &gt; y) {\n        do {\n            //addq %rdi, %rax\n            result += x;\n\n            //subq $1, %rdi\n            --x;\n\n            //cmp %rdi, rsi\n            //jl .L3            \n        } while (x &gt; y);\n    }\n\n    return result;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": false, "score": 2, "last_activity_date": 1556664467, "creation_date": 1556664467, "answer_id": 55929582, "question_id": 55927120, "link": "https://stackoverflow.com/questions/55927120/how-do-i-translate-an-optimized-x86-64-asm-loop-back-to-a-c-for-loop/55929582#55929582", "title": "How do I translate an optimized x86-64 asm loop back to a C for loop?", "body": "<blockquote>\n  <p>I don't know what <code>cmpq %rsi, %rdi</code> mean</p>\n</blockquote>\n\n<p>That's AT&amp;T syntax for <code>cmp rdi, rsi</code>.  <a href=\"https://www.felixcloutier.com/x86/CMP.html\" rel=\"nofollow noreferrer\">https://www.felixcloutier.com/x86/CMP.html</a></p>\n\n<p>You can look up the details of what a single instruction does in an ISA manual.</p>\n\n<p>More importantly, <code>cmp</code>/<code>jcc</code> like <code>cmp %rsi,%rdi</code>/<code>jl</code> is like <code>jump if rdi&lt;rsi</code>. \n <a href=\"https://stackoverflow.com/questions/9617877/assembly-jg-jnle-jl-jnge-after-cmp\">Assembly - JG/JNLE/JL/JNGE after CMP</a>.  If you go through all the details of how <code>cmp</code> sets flags, and which flags each <a href=\"https://www.felixcloutier.com/x86/Jcc.html\" rel=\"nofollow noreferrer\"><code>jcc</code></a> condition checks, you can verify that it's correct, but it's <em>much</em> easier to just use the semantic meaning of JL = Jump on Less-than (assuming flags were set by a <code>cmp</code>) to remember what they do.</p>\n\n<p>(It's reversed because of AT&amp;T syntax; <code>jcc</code> predicates have the right semantic meaning for Intel syntax.  This is one of the major reasons I usually prefer Intel syntax, but you can get used to AT&amp;T syntax.)</p>\n\n<hr>\n\n<p><strong>From the use of <code>rdi</code> and <code>rsi</code> as inputs</strong> (reading them without / before writing them), they're the arg-passing registers.  So this is the x86-64 System V calling convention, where integer args are passed in RDI, RSI, RDX, RCX, R8, R9, then on the stack.  (<a href=\"https://stackoverflow.com/questions/2535989/what-are-the-calling-conventions-for-unix-linux-system-calls-on-i386-and-x86-6\">What are the calling conventions for UNIX &amp; Linux system calls on i386 and x86-64</a> covers function calls as well as system calls).  The other major x86-64 calling convention is Windows x64, which passes the first 2 args in RCX and RDX (if they're both integer types).</p>\n\n<p>So yes, x=RDI and y=RSI.  And yes, result=RAX.  (writing to EAX zero-extends into RAX).</p>\n\n<hr>\n\n<p>From the code structure (not storing/reloading every C variable to memory between statements), it's compiled with some level of optimization enabled, so <strong>the <code>for()</code> loop turned into a normal asm loop with the conditional branch at the bottom.  <a href=\"https://stackoverflow.com/q/47783926\">Why are loops always compiled into &quot;do...while&quot; style (tail jump)?</a></strong>  (@BrianWalker's answer shows the asm loop transliterated back to C, with no attempt to form it back into an idiomatic <code>for</code> loop.)</p>\n\n<p>From the cmp/jcc ahead of the loop, we can tell that the compiler can't prove the loop runs a non-zero number of iterations.  So whatever the <code>for()</code> loop condition is, it might be false the first time.  (That's unsurprising given signed integers.)</p>\n\n<p>Since <strong>we don't see a separate register being used for <code>i</code></strong>, we can conclude that <strong>optimization reused another var's register for <code>i</code></strong>.  Like probably <code>for(i=x;</code>, and then with the original value of <code>x</code>  being unused for the rest of the function, it's \"dead\" and the compiler can just use RDI as <code>i</code>, destroying the original value of <code>x</code>.</p>\n\n<p>I guessed <code>i=x</code> instead of <code>y</code> because RDI is the arg register that's modified inside the loop.  We expect that the C source modifies <code>i</code> and <code>result</code> inside the loop, and presumably doesn't modify it's input variables <code>x</code> and <code>y</code>.  It would make no sense to do <code>i=y</code> and then do stuff like <code>x--</code>, although that would be another valid way of decompiling.</p>\n\n<p><strong><code>cmp %rdi, %rsi</code> / <code>jl .L3</code> means the loop condition to (re)enter the loop is <code>rsi-rdi &lt; 0</code> (signed), or <code>i&lt;y</code>.</strong></p>\n\n<p>The cmp/jcc <em>before</em> the loop is checking the opposite condition; notice that the operands are reversed and it's checking <code>jle</code>, i.e. <code>jng</code>.  So that makes sense, it really is same loop condition peeled out of the loop and implemented differently.  Thus it's compatible with the C source being a plain <code>for()</code> loop with one condition.</p>\n\n<p><strong><code>sub $1, %rdi</code> is obviously <code>i--</code> or <code>--i</code></strong>.  We can do that inside the <code>for()</code>, or at the bottom of the loop body.  The simplest and most idiomatic place to put it is in the 3rd section of the <code>for(;;)</code> statement.</p>\n\n<p><code>addq %rdi, %rax</code> is obviously adding <code>i</code> to <code>result</code>.  We already know what RDI and RAX are in this function.</p>\n\n<p><strong>Putting the pieces together, we arrive at:</strong></p>\n\n<pre><code>long foo(long x, long y)\n{\n    long i, result = 0;\n    for (i= x    ;    i&gt;y    ;    i-- ){\n        result += i;\n    }\n\n    return result;\n}\n</code></pre>\n\n<hr>\n\n<h2>Which compiler made this code?</h2>\n\n<p><strong>From the <code>.L3:</code> label names, this looks like output from <code>gcc</code></strong>.  (Which somehow got corrupted, removing the <code>:</code> from <code>.L2</code>, and more importantly removing the <code>%</code> from <code>%rsi</code> in one cmp.  Make sure you copy/paste code into SO questions to avoid this.)</p>\n\n<p>So it may be possible with the right gcc version/options to get exactly this asm back out for some C input.  It's probably <code>gcc -O1</code>, because <code>movl $0, %eax</code> rules out <code>-O2</code> and higher (where GCC would look for the <code>xor %eax,%eax</code> peephole optimization for zeroing a register efficiently).  But it's not <code>-O0</code> because that would be storing/reloading the loop counter to memory.  And <code>-Og</code> (optimize a bit, for debugging) likes to use a <code>jmp</code> to the loop condition instead of a separate <code>cmp/jcc</code> to skip the loop.  This level of detail is basically irrelevant for simply decompiling to C that does the same thing.</p>\n\n<p>The <code>rep ret</code> is another sign of gcc; gcc7 and earlier used this in their default <code>tune=generic</code> output for <code>ret</code> that's reached as a branch target or a fall-through from a <code>jcc</code>,  because of AMD K8/K10 branch prediction.  <a href=\"https://stackoverflow.com/questions/20526361/what-does-rep-ret-mean\">What does `rep ret` mean?</a></p>\n\n<p>gcc8 and later will still use it with <code>-mtune=k8</code> or <code>-mtune=barcelona</code>.  But we can rule that out because that tuning option would use <code>dec %rdi</code> instead of <code>subq $1, %rdi</code>.  (Only a few modern CPUs have any problems with <code>inc/dec</code> leaving CF unmodified, for register operands.  <a href=\"https://stackoverflow.com/questions/36510095/inc-instruction-vs-add-1-does-it-matter\">INC instruction vs ADD 1: Does it matter?</a>)</p>\n\n<p>gcc4.8 and later put <code>rep ret</code> on the same line.  gcc4.7 and earlier print it as you've shown, with the <code>rep</code> prefix on the line before.</p>\n\n<p>gcc4.7 and later like to put the initial branch <em>before</em> the <code>mov $0, %eax</code>, which looks like a missed optimization.  It means they need a separate <code>return 0</code> path out of the function, which contains another <code>mov $0, %eax</code>.</p>\n\n<p><strong>gcc4.6.4 <code>-O1</code> reproduces your output <em>exactly</em>, for the source shown above, <a href=\"https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(j:1,lang:c%2B%2B,source:&#39;long+foo(long+x,+long+y)%0A%7B%0A++++long+i,+result+%3D+0%3B%0A++++for+(i%3D+x++++%3B++++i%3Ey++++%3B++++i--+)%7B%0A++++++++result+%2B%3D+i%3B%0A++++%7D%0A%0A++++return+result%3B%0A%7D%0A%0A//+also+the+same+asm+output,+using+i%3Dy+and+then+using+it+differently.%0Along+foo2(long+x,+long+y)%0A%7B%0A++++long+i,+result+%3D+0%3B%0A++++for+(i%3D+y++++%3B++++x%3Ei++++%3B++++x--+)%7B%0A++++++result+%2B%3D+x%3B%0A+++%7D%0A%0A+return+result%3B%0A%7D&#39;),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;C%2B%2B+source+%231&#39;,t:&#39;0&#39;)),k:50,l:&#39;4&#39;,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;),(g:!((h:compiler,i:(compiler:g464,filters:(b:&#39;0&#39;,binary:&#39;1&#39;,commentOnly:&#39;0&#39;,demangle:&#39;0&#39;,directives:&#39;0&#39;,execute:&#39;1&#39;,intel:&#39;1&#39;,libraryCode:&#39;1&#39;,trim:&#39;1&#39;),lang:c%2B%2B,libs:!(),options:&#39;-xc+-O1+-fverbose-asm&#39;,source:1),l:&#39;5&#39;,n:&#39;0&#39;,o:&#39;x86-64+gcc+4.6.4+(Editor+%231,+Compiler+%231)+C%2B%2B&#39;,t:&#39;0&#39;)),k:50,l:&#39;4&#39;,m:100,n:&#39;0&#39;,o:&#39;&#39;,s:0,t:&#39;0&#39;)),l:&#39;2&#39;,n:&#39;0&#39;,o:&#39;&#39;,t:&#39;0&#39;)),version:4\" rel=\"nofollow noreferrer\">on the Godbolt compiler explorer</a></strong></p>\n\n<pre><code># compiled with gcc4.6.4 -O1 -fverbose-asm\nfoo:\n        movl    $0, %eax        #, result\n        cmpq    %rsi, %rdi      # y, x\n        jle     .L2       #,\n.L3:\n        addq    %rdi, %rax      # i, result\n        subq    $1, %rdi        #, i\n        cmpq    %rdi, %rsi      # i, y\n        jl      .L3 #,\n.L2:\n        rep\n        ret\n</code></pre>\n\n<p>So does this other version which uses <code>i=y</code>.  Of course there are many things we could add that would optimize away, like maybe <code>i=y+1</code> and then having a loop condition like <code>x&gt;--i</code>.  (Signed overflow is undefined behaviour in C, so the compiler can assume it doesn't happen.)</p>\n\n<pre><code>// also the same asm output, using i=y but modifying x in the loop.\nlong foo2(long x, long y) {\n  long i, result = 0;\n  for (i= y    ;    x&gt;i    ;    x-- ){\n      result += x;\n   }\n   return result;\n}\n</code></pre>\n\n<hr>\n\n<h3>In practice the way I actually reversed this:</h3>\n\n<ul>\n<li>I copy/pasted the C template into Godbolt (<a href=\"https://godbolt.org/\" rel=\"nofollow noreferrer\">https://godbolt.org/</a>). I could see right away (from the <code>mov $0</code> instead of xor-zero, and from the label names) that it looked like <code>gcc -O1</code> output, so I put in that command line option and picked an old-ish version of gcc like gcc6.  (Turns out this asm was actually from a much older gcc).</li>\n<li><p>I tried an initial guess like <code>x&lt;y</code> based on the cmp/jcc, and <code>i++</code> (before I'd actually read the rest of the asm carefully <em>at all</em>), because for loops often use <code>i++</code>.  The trivial-looking infinite-loop asm output showed me that was obviously wrong :P</p></li>\n<li><p>I guessed that i=x, but after taking a wrong turn with a version that did <code>result += x</code> but <code>i--</code>, I realized that <code>i</code> was a distraction and at first simplified by not using <code>i</code> at all.  I just used <code>x--</code> while first reversing it because obviously RDI=x.  (I know the x86-64 System V calling convention well enough to see that instantly.)</p></li>\n<li><p>After looking at the loop body, the <code>result += x</code> and <code>x--</code> were totally obvious from the <code>add</code> and <code>sub</code> instructions.</p></li>\n<li><p><code>cmp/jl</code> was obviously a <code>something &lt; something</code> loop condition involving the 2 input vars.</p></li>\n<li><p>I wasn't sure I if it was <code>x&lt;y</code> or <code>y&lt;x</code>, and newer gcc versions were using <code>jne</code> as the loop condition.  I think at that point I cheated and looked at Brian's answer to check it really was <code>x &gt; y</code>, instead of taking a minute to work through the actual logic.  <strong>But once I had figured out it was <code>x--</code>, only <code>x&gt;y</code> made sense.</strong>  The other one would be true until wraparound if it entered the loop at all, but signed overflow is undefined behaviour in C.</p></li>\n<li><p>Then I looked at some older gcc versions to see if any made asm more like in the question.</p></li>\n<li><p>Then I went back and replaced <code>x</code> with <code>i</code> inside the loop.</p></li>\n</ul>\n\n<p>If this seems kind of haphazard and slapdash, that's because this loop is so tiny that I didn't expect to have any trouble figuring it out, and I was more interested in finding source + gcc version that exactly reproduced it, rather than the original problem of just reversing it at all.</p>\n\n<p>(I'm not saying beginners should find it that easy, I'm just documenting <em>my</em> thought process in case anyone's curious.)</p>\n"}], "owner": {"reputation": 23, "user_id": 10360715, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-As9uKzhvEIc/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaO_efRmFxIVP8L5rvsALCdcdEN5cA/mo/photo.jpg?sz=128", "display_name": "Soph Kwon", "link": "https://stackoverflow.com/users/10360715/soph-kwon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1556664467, "creation_date": 1556650397, "last_edit_date": 1556661944, "question_id": 55927120, "link": "https://stackoverflow.com/questions/55927120/how-do-i-translate-an-optimized-x86-64-asm-loop-back-to-a-c-for-loop", "title": "How do I translate an optimized x86-64 asm loop back to a C for loop?", "body": "<p>I have the following:</p>\n\n<pre><code>foo:\n   movl $0, %eax                      //result = 0\n   cmpq %rsi, %rdi                    // rdi = x, rsi = y?\n   jle .L2\n\n.L3:\n   addq %rdi, %rax                    //result = result + i?\n   subq $1, %rdi                      //decrement?\n   cmp %rdi, rsi\n   jl .L3\n\n.L2\n   rep\n   ret\n\n</code></pre>\n\n<p>And I'm trying to translate it to:</p>\n\n<pre><code>long foo(long x, long y)\n{\n    long i, result = 0;\n    for (i=     ;               ;         ){\n\n      //??\n\n   }\n\n return result;\n}\n\n</code></pre>\n\n<p>I don't know what cmpq %rsi, %rdi mean. \nWhy isn't there another &amp;eax for long i?</p>\n\n<p>I would love some help in figuring this out. I don't know what I'm missing - I been going through my notes, textbook, and rest of the internet and I am stuck. It's a review question, and I've been at it for hours. </p>\n"}, {"tags": ["c", "linux", "compiler-errors", "mingw", "ncurses"], "comments": [{"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1556649979, "post_id": 55926915, "comment_id": 98507654, "body": "When linking, the order of arguments matter! Put libraries <i>last</i>."}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1556650289, "post_id": 55926915, "comment_id": 98507767, "body": "Place <code>-lncursesw</code> at the end of the compile command. Also see <a href=\"https://stackoverflow.com/q/45135/608639\">Why does the order in which libraries are linked sometimes cause errors in GCC?</a> and <a href=\"https://stackoverflow.com/q/11893996/608639\">Why does the order of &#39;-l&#39; option in gcc matter?</a>"}, {"owner": {"reputation": 97, "user_id": 11390586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VGdy.jpg?s=128&g=1", "display_name": "Mr. Suklav Ghosh", "link": "https://stackoverflow.com/users/11390586/mr-suklav-ghosh"}, "edited": false, "score": 0, "creation_date": 1556694795, "post_id": 55926915, "comment_id": 98518375, "body": "compile using this command gcc filename.c  -lncursesw"}], "owner": {"reputation": 34, "user_id": 11433667, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N4ppO.png?s=128&g=1", "display_name": "Lone_Wolf", "link": "https://stackoverflow.com/users/11433667/lone-wolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 353, "favorite_count": 0, "closed_date": 1556650312, "answer_count": 0, "score": 0, "last_activity_date": 1556650394, "creation_date": 1556649366, "question_id": 55926915, "link": "https://stackoverflow.com/questions/55926915/linking-error-cross-compiling-ncurses-in-c-on-linux-for-windows-using-mingw", "closed_reason": "Duplicate", "title": "Linking error(?) cross-compiling ncurses in C on linux for windows using mingw", "body": "<p>I'm trying to compile an ncurses C program on Xubuntu 19.04 for Windows using mingw.</p>\n\n<p>My compile command:\n<code>x86_64-w64-mingw32-gcc -lncursesw -o thg.exe main.c</code></p>\n\n<p>This is how I included ncurses in my program:</p>\n\n<p><code>#include &lt;ncursesw/ncurses.h&gt;</code></p>\n\n<p>Here's the errors:</p>\n\n<pre><code>/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x127): undefined reference to `newwin'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x14b): undefined reference to `keypad'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x15d): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x17c): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x18e): undefined reference to `wrefresh'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x464): undefined reference to `wgetch'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x489): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x49b): undefined reference to `wrefresh'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x4ad): undefined reference to `delwin'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x4e6): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x531): undefined reference to `wborder'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x597): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x5c5): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x638): undefined reference to `mvwprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x692): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x6c0): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x6ee): undefined reference to `wmove'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x719): undefined reference to `whline'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x75d): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x784): undefined reference to `mvwprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x7c8): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x7e8): undefined reference to `wmove'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x813): undefined reference to `whline'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x833): undefined reference to `wmove'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x85e): undefined reference to `whline'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x882): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x8d3): undefined reference to `mvwprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x8f7): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x917): undefined reference to `wmove'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x942): undefined reference to `whline'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x964): undefined reference to `mvwprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x976): undefined reference to `wrefresh'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x9b4): undefined reference to `newwin'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x9cf): undefined reference to `keypad'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0xf3f): undefined reference to `wgetch'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x179d): undefined reference to `wgetch'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1837): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1846): undefined reference to `wrefresh'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1855): undefined reference to `delwin'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1987): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x19a4): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x19dc): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x19f9): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1a18): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1a2b): undefined reference to `wgetch'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1a46): undefined reference to `wrefresh'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1bd8): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1be4): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1c29): undefined reference to `wborder'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1c4e): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1c63): undefined reference to `wmove'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1c79): undefined reference to `waddch'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1c9e): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1d0a): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1d59): undefined reference to `wmove'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1d8e): undefined reference to `waddch'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1dc6): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1e04): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1eba): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1ef8): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1f2a): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1f69): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1f8d): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1fac): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1fd3): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1fef): undefined reference to `wrefresh'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x1ffb): undefined reference to `wrefresh'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x20b0): undefined reference to `wgetch'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x216e): undefined reference to `wgetch'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x21a3): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x21c0): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2202): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x221f): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2243): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2285): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x22a9): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x22e8): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x233a): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x235b): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x238c): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x23ab): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x23f0): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2413): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2432): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2451): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2463): undefined reference to `wrefresh'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2487): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x24a4): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x24e6): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2503): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2526): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2545): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2587): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x25aa): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x25c7): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x25e6): undefined reference to `wattr_on'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x262b): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x264e): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x266d): undefined reference to `wattr_off'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x268c): undefined reference to `mvprintw'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x269e): undefined reference to `wrefresh'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x26ca): undefined reference to `initscr'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x26cf): undefined reference to `noecho'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x26d4): undefined reference to `start_color'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x26de): undefined reference to `curs_set'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x26f5): undefined reference to `keypad'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x26fa): undefined reference to `cbreak'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x271a): undefined reference to `init_pair'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2744): undefined reference to `init_pair'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x2760): undefined reference to `getmaxy'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x277d): undefined reference to `getmaxx'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x27cb): undefined reference to `wclear'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.text+0x27d0): undefined reference to `endwin'\n/usr/bin/x86_64-w64-mingw32-ld: /tmp/ccfeYrvf.o:main.c:(.rdata$.refptr.stdscr[.refptr.stdscr]+0x0): undefined reference to `stdscr'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>I downloaded ncursesw from <a href=\"https://invisible-island.net/ncurses/#download_mingw\" rel=\"nofollow noreferrer\">https://invisible-island.net/ncurses/#download_mingw</a></p>\n\n<p>I then copied the contents to where I think they were supposed to go:</p>\n\n<p>I copied the contents of <code>bin</code> to <code>/usr/x86_64-w64-mingw32/bin/</code>,</p>\n\n<p>I copied the contents of <code>lib</code> to <code>/usr/x86_64-w64-mingw32/lib/</code>,</p>\n\n<p>and I copied the contents of <code>include</code> to <code>/usr/x86_64-w64-mingw32/include/</code></p>\n\n<p>This is my first question here, and I feel like I left something out. If you need more info please let me know</p>\n"}, {"tags": ["c", "pointers", "argv", "pointer-arithmetic"], "comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556648995, "post_id": 55926795, "comment_id": 98507254, "body": "<code>argv + 1</code> is 100% equivalent to <code>&amp;(argv[1])</code>, provided <code>argv</code> points to an array with at least two elements."}, {"owner": {"reputation": 97942, "user_id": 25324, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c812d568dcbf02b96796728be3cac626?s=128&d=identicon&r=PG", "display_name": "pmg", "link": "https://stackoverflow.com/users/25324/pmg"}, "edited": false, "score": 2, "creation_date": 1556649035, "post_id": 55926795, "comment_id": 98507273, "body": "<code>argv</code> is a pointer, not an array. You might like section 6 of the <a href=\"http://c-faq.com/\" rel=\"nofollow noreferrer\">c-faq</a>."}, {"owner": {"reputation": 45, "user_id": 7834854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a817f5e10a94cf7d67eb6475b58a477?s=128&d=identicon&r=PG&f=1", "display_name": "Y. J.", "link": "https://stackoverflow.com/users/7834854/y-j"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556653694, "post_id": 55926795, "comment_id": 98509127, "body": "@JohnBollinger So if <code>argv+1</code> is equivalent to <code>&amp;(argv[1])</code> does this mean that <code>(argv+1)[0]</code> is the same as <code>argv[1]</code>? Sorry just confused since the argv and argv+1 diagrams are the same but I thought (argv+1)[0] would change"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556655840, "post_id": 55926795, "comment_id": 98509990, "body": "Yes, <code>(argv + 1)[0]</code> is equivalent to <code>argv[1]</code>.  See also <a href=\"https://stackoverflow.com/questions/381542/with-arrays-why-is-it-the-case-that-a5-5a\">With arrays, why is it the case that <code>a[5] == 5[a]</code>?</a>"}], "owner": {"reputation": 45, "user_id": 7834854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a817f5e10a94cf7d67eb6475b58a477?s=128&d=identicon&r=PG&f=1", "display_name": "Y. J.", "link": "https://stackoverflow.com/users/7834854/y-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "closed_date": 1556649399, "answer_count": 0, "score": 0, "last_activity_date": 1556648817, "creation_date": 1556648817, "question_id": 55926795, "link": "https://stackoverflow.com/questions/55926795/when-you-increment-the-argument-array-and-use-it-with-an-index-as-an-argument-to", "closed_reason": "Duplicate", "title": "When you increment the argument array and use it with an index as an argument to a function what exactly are you doing to that array?", "body": "<p>I am learning execvp and I came across an example that is a program that just executes another program as specified on the command line. As you can see in the example, there is pointer manipulation to set up the argv array. </p>\n\n<p>The example says that at the start argv is like:</p>\n\n<pre><code>         .-----.\nargv -&gt;  |  .--+--&gt; \"./exec_other\"\n         |-----|\n         |  .--+--&gt; \"ls\"\n         |-----|\n         |  .--+--&gt; \"-l\"\n         |-----|\n         |  .--+--&gt; NULL\n         '-----'\n</code></pre>\n\n<p>Then after point manipulation</p>\n\n<pre><code>           .-----.\n           |  .--+--&gt; \"./exec_other\"\n           |-----|\nargv+1 -&gt;  |  .--+--&gt; \"ls\"\n           |-----|\n           |  .--+--&gt; \"-l\"\n           |-----|\n           |  .--+--&gt; NULL\n           '-----'\n</code></pre>\n\n<p>How are argv and argv+1 the same in terms of size and content? I thought that argv+1 would be pointing to an element past the array but that doesn't make sense in </p>\n\n<pre><code>execvp((argv+1) [0], argv+1);\n</code></pre>\n\n<pre><code>aviv@saddleback: demo $ ./exec_other ls -l\ntotal 120\n-rwxr-x--- 1 aviv scs  9890 Feb 24 14:13 exec_other\n-rw-r----- 1 aviv scs   151 Feb 24 11:43 exec_other.c\n-rwxr-x--- 1 aviv scs  9977 Feb 24 14:13 execv_ls-l\n-rw-r----- 1 aviv scs   559 Feb 24 11:42 execv_ls-l.c\n-rwxr-x--- 1 aviv scs  9979 Feb 24 14:13 execvp_ls-l\n-rw-r----- 1 aviv scs   360 Feb 24 11:59 execvp_ls-l.c\n-rw-r----- 1 aviv scs   559 Feb 24 11:58 execvp_ls-l.c~\n-rwxr-x--- 1 aviv scs 10023 Feb 24 14:13 first_fork\n-rw-r----- 1 aviv scs   532 Feb 23 08:06 first_fork.c\n-rwxr-x--- 1 aviv scs 10345 Feb 24 14:13 fork_exec_wait\n-rw-r----- 1 aviv scs  1158 Feb 23 08:06 fork_exec_wait.c\n-rwxr-x--- 1 aviv scs 10278 Feb 24 14:13 get_exitstatus\n-rw-r----- 1 aviv scs  1379 Feb 23 08:06 get_exitstatus.c\n-rwxr-x--- 1 aviv scs  9985 Feb 24 14:13 get_pid_ppid\n-rw-r----- 1 aviv scs   294 Feb 23 08:06 get_pid_ppid.c\n-rw-r----- 1 aviv scs    99 Feb 23 08:06 Makefile\naviv@saddleback: demo $ ./exec_other cat exec_oth\nexec_other    exec_other.c  \naviv@saddleback: demo $ ./exec_other cat exec_other.c \n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nint main(int argce, char * argv[]){\n\n  execvp( (argv+1)[0], argv+1);\n  perror(\"execvp\");\n}\n</code></pre>\n"}, {"tags": ["c", "binary"], "answers": [{"comments": [{"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556648691, "post_id": 55926699, "comment_id": 98507136, "body": "But they <i>don&#39;t</i> want to know (just) which bits have changed.  They want to know whether any bits that were 0 in <code>old</code> are flipped to 1 in <code>new</code>."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 2, "creation_date": 1556648746, "post_id": 55926699, "comment_id": 98507157, "body": "@JohnBollinger and for that it is sufficient to ignore the last sentence"}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556649623, "post_id": 55926699, "comment_id": 98507511, "body": "@JohnBollinger  Now it&#39;s better phrased, I hope."}], "tags": [], "owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "is_accepted": true, "score": 4, "last_activity_date": 1556669125, "last_edit_date": 1556669125, "creation_date": 1556648398, "answer_id": 55926699, "question_id": 55926612, "link": "https://stackoverflow.com/questions/55926612/how-to-test-if-zeros-have-changed-to-ones-but-not-the-other-way-around/55926699#55926699", "title": "How to test if zeros have changed to ones (but not the other way around)", "body": "<pre><code>if (~old &amp; new)\n</code></pre>\n\n<p>If you also want to know which bits changed from 0 to 1, just read each bit in <code>bits = ~old &amp; new;</code>. If you just want to know if any 0s became 1s, that first line of code will do.</p>\n"}, {"tags": [], "owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "is_accepted": false, "score": 1, "last_activity_date": 1556648978, "last_edit_date": 1556648978, "creation_date": 1556648446, "answer_id": 55926708, "question_id": 55926612, "link": "https://stackoverflow.com/questions/55926612/how-to-test-if-zeros-have-changed-to-ones-but-not-the-other-way-around/55926708#55926708", "title": "How to test if zeros have changed to ones (but not the other way around)", "body": "<p>So we have old mask and new mask, and none of the 0s of the old mask must have been set in the new mask.</p>\n\n<p>Solution is simple: invert the old mask, turning all zeroes into ones and ones into zeroes. <strong>And</strong> the result with the new mask - if result is nonzero the undesired thing has happened.</p>\n\n<p>Demonstrating this with a minimal example. We have</p>\n\n<pre><code>old = 0011\nnew = 1001\n</code></pre>\n\n<p>There are two bits that have changed, two bits are unchanged; one change is undesirable. We invert the <code>old</code>, with <code>~</code> and <strong>and</strong> it with <code>new</code>:</p>\n\n<pre><code> ~old = 1100\n  new = 1001\n&amp; ----------\n        1000\n</code></pre>\n\n<p>the result is nonzero so we know that a zero was changed to one.</p>\n\n<p>For code see <a href=\"https://stackoverflow.com/a/55926699/918959\">Cacahuete's answer</a></p>\n"}], "owner": {"reputation": 3353, "user_id": 298209, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/22dcc7ab1b47c2f014361452b5453544?s=128&d=identicon&r=PG&f=1", "display_name": "Milad", "link": "https://stackoverflow.com/users/298209/milad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 55926699, "answer_count": 2, "score": 0, "last_activity_date": 1556669125, "creation_date": 1556647994, "question_id": 55926612, "link": "https://stackoverflow.com/questions/55926612/how-to-test-if-zeros-have-changed-to-ones-but-not-the-other-way-around", "title": "How to test if zeros have changed to ones (but not the other way around)", "body": "<p>I have a binary mask which at some point I'm updating. It's ok for 1s in my old mask to become 0s but the other way around is not allowed. How can I assert using some binary operations that none of the 0s in the mask have turned into 1s? </p>\n"}, {"tags": ["c", "scanf", "input-buffer"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1556645556, "post_id": 55926022, "comment_id": 98505712, "body": "<code>%s</code> reads a <i>whitespace-delimited word</i>."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 2, "creation_date": 1556645627, "post_id": 55926022, "comment_id": 98505750, "body": "&quot;%d&quot; stops when it encounters any non-digit character. &quot;%s&quot; stops when it encounters any whitespace character. And <code>\\n</code> is a whitespace character."}, {"owner": {"reputation": 121127, "user_id": 388520, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/dd7cc06b1b1c347e172c6ba532937173?s=128&d=identicon&r=PG", "display_name": "zwol", "link": "https://stackoverflow.com/users/388520/zwol"}, "edited": false, "score": 0, "creation_date": 1556645671, "post_id": 55926022, "comment_id": 98505765, "body": "Almost all (I would argue absolutely all, but I don&#39;t want to start an argument) uses of <code>scanf</code> are better written using <code>fgets</code> and manual parsing.  For programs that take interactive input from a human, the most important reason for this is, you need to read <i>whatever the user typed</i>, even if it doesn&#39;t meet your expectations."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1556645864, "post_id": 55926022, "comment_id": 98505855, "body": "<code>scanf</code> is good for quick and dirty <i>programmer</i> interfaces... it requires that the user is a programmer who never does any mistakes."}, {"owner": {"reputation": 5, "user_id": 1588729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0irxw.jpg?s=128&g=1", "display_name": "prime_mover", "link": "https://stackoverflow.com/users/1588729/prime-mover"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1556819220, "post_id": 55926022, "comment_id": 98567039, "body": "@user3386109, Thank you. But then why is it that %s doesn&#39;t stop printing a string on console when it encounters a white-space character?"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1556820772, "post_id": 55926022, "comment_id": 98567722, "body": "Because <code>printf</code> and <code>scanf</code> are different when it comes to the behavior of <code>&quot;%s&quot;</code>. And that&#39;s not the only difference. To understand <code>printf</code>, read the documentation for <code>printf</code>. To understand <code>scanf</code>, read the documentation for <code>scanf</code>."}, {"owner": {"reputation": 5, "user_id": 1588729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0irxw.jpg?s=128&g=1", "display_name": "prime_mover", "link": "https://stackoverflow.com/users/1588729/prime-mover"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1556820985, "post_id": 55926022, "comment_id": 98567821, "body": "@user3386109 Thanks a lot! Will do."}], "owner": {"reputation": 5, "user_id": 1588729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0irxw.jpg?s=128&g=1", "display_name": "prime_mover", "link": "https://stackoverflow.com/users/1588729/prime-mover"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "closed_date": 1556645521, "answer_count": 0, "score": 0, "last_activity_date": 1556645598, "creation_date": 1556645314, "question_id": 55926022, "link": "https://stackoverflow.com/questions/55926022/why-do-we-need-to-clear-input-buffer-after-scanf-call-when-s-format-specifier", "closed_reason": "Duplicate", "title": "Why do we need to clear input buffer after scanf() call when %s format specifier is used?", "body": "<p>I understand that scanf ignores \\n at the end of input when used with format specifier %d because it encounters \\n and realises it is a non-integer value and leaves it in the input-buffer. But,  I am unable to understand why \\n is ignored by scanf even when format specifier is %s as \\n is a valid character and can be considered a part of input string.  Moreover, the input string in my code is of length 80 and my input is merely 6 characters long. So, there's no issue of buffer overflow here too.</p>\n\n<p>I looked up other questions here related to interlacing scanf and getchar. But, all of them used %d format specifiers.</p>\n\n<pre><code>int main() \n{ \n    char str[80], ch;  \n    scanf(\"%s\", str);\n    ch = getchar(); \n    printf(\"%s\\n\", str); \n    printf(\"%c\", ch); \n\n    return 0; \n}\n</code></pre>\n\n<p>my input: testin</p>\n\n<p>I expect the program to pause for input at getchar since I'm using %s and str is of length 80 while my input after hitting return is testin\\n</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556644113, "post_id": 55925728, "comment_id": 98505095, "body": "<code>getch();</code> is not inputing a digit in the numeric range <code>0</code>..<code>9</code> but in the character range <code>&#39;0&#39;</code> .. <code>&#39;9&#39;</code>. So try <code>temp = getch() - &#39;0&#39;</code>;"}, {"owner": {"reputation": 1, "user_id": 11433790, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HnB08.png?s=128&g=1", "display_name": "Ankit Kumar", "link": "https://stackoverflow.com/users/11433790/ankit-kumar"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556645010, "post_id": 55925728, "comment_id": 98505488, "body": "yup! its is working thank You, but I didn&#39;t get why you subtracted &#39;0&#39; from getch()."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1556645113, "post_id": 55925728, "comment_id": 98505536, "body": "Or <code>temp1 = &#39;0&#39; + rand() % 10;</code> looks better. And you should be using <code>int</code> not <code>char</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11433790, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HnB08.png?s=128&g=1", "display_name": "Ankit Kumar", "link": "https://stackoverflow.com/users/11433790/ankit-kumar"}, "edited": false, "score": 0, "creation_date": 1556646710, "post_id": 55925994, "comment_id": 98506235, "body": "thank you so much.I got it."}], "tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": false, "score": 0, "last_activity_date": 1556645737, "last_edit_date": 1556645737, "creation_date": 1556645123, "answer_id": 55925994, "question_id": 55925728, "link": "https://stackoverflow.com/questions/55925728/how-to-compare-randomly-generated-number-with-user-entered-number-at-run-time-in/55925994#55925994", "title": "How to compare randomly generated number with user entered number at run time in C?", "body": "<p>A digit character has a character code value <code>'0'</code> to <code>'9'</code> (in the ASCII character set 0x30 to 0x39 or 48 to 57 decimal), while <code>rand() % 10</code> has integer value 0 to 9.</p>\n\n<p>By adding the character code <code>'0'</code> (48) to the random number you will generate a random character code <code>'0'</code> to <code>'9'</code>.</p>\n\n<pre><code>int main()\n{\n    char temp1 = rand() % 10 + '0' ;\n    char temp = getch() ;\n\n    if( temp == temp1 )\n    {\n        printf(\"ok\");\n    }\n\n    return 0 ;\n}\n</code></pre>\n\n<p>Alternatively if you subtract <code>'0'</code> from the  input <em>character</em> you will transform digit characters to their corresponding 0 to 9 integer values (and other characters to some other value).</p>\n"}], "owner": {"reputation": 1, "user_id": 11433790, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HnB08.png?s=128&g=1", "display_name": "Ankit Kumar", "link": "https://stackoverflow.com/users/11433790/ankit-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "closed_date": 1556645142, "answer_count": 1, "score": -2, "last_activity_date": 1556645737, "creation_date": 1556644002, "question_id": 55925728, "link": "https://stackoverflow.com/questions/55925728/how-to-compare-randomly-generated-number-with-user-entered-number-at-run-time-in", "closed_reason": "Duplicate", "title": "How to compare randomly generated number with user entered number at run time in C?", "body": "<p>I am making Bubble game in c where randomly some numbers are generating on the console window and user need to enter that numbers appearing on the screen or console window and I need to compare that user input and random generated number and make that number invisible from the screen.</p>\n\n<p>I have used rand() function in c and for user input I have used getch() function and i have tried every type conversion but not getting the solution yet.</p>\n\n<pre><code>void main() {\nchar temp1 = 0;\nchar temp = 0;\ntemp1 = rand()%10;\n   temp = getch();\n   if(temp == temp1)\n   printf(\"ok\");\n  }\n</code></pre>\n\n<p>I want to compare randomly generated value and user input at run time and input given by the user by seeing on console's number is equal i want to exit.</p>\n"}, {"tags": ["c", "pointers", "linked-list"], "comments": [{"owner": {"reputation": 12794, "user_id": 865643, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mG7s3.jpg?s=128&g=1", "display_name": "noelicus", "link": "https://stackoverflow.com/users/865643/noelicus"}, "edited": false, "score": 0, "creation_date": 1556644427, "post_id": 55925725, "comment_id": 98505246, "body": "Your compiler will be telling you where the error is. Perhaps the malloc needs a cast? (struct cell *)malloc"}, {"owner": {"reputation": 469, "user_id": 6115246, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/1b9cf9de31bac0fcb669e25bce367588?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Siegel", "link": "https://stackoverflow.com/users/6115246/daniel-siegel"}, "reply_to_user": {"reputation": 12794, "user_id": 865643, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mG7s3.jpg?s=128&g=1", "display_name": "noelicus", "link": "https://stackoverflow.com/users/865643/noelicus"}, "edited": false, "score": 0, "creation_date": 1556644809, "post_id": 55925725, "comment_id": 98505406, "body": "@noelicus I meant the deleteLast method. Take a look at the comment at the while loop, that&#39;s the errormessage I get."}, {"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 0, "creation_date": 1556653156, "post_id": 55925725, "comment_id": 98508919, "body": "Your error is that *list-&gt;next-&gt;next  means *(list-&gt;next-&gt;next) and not (*list)-&gt;next-&gt;next."}, {"owner": {"reputation": 97, "user_id": 11390586, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VGdy.jpg?s=128&g=1", "display_name": "Mr. Suklav Ghosh", "link": "https://stackoverflow.com/users/11390586/mr-suklav-ghosh"}, "edited": false, "score": 0, "creation_date": 1556695017, "post_id": 55925725, "comment_id": 98518431, "body": "Probably you got segmentation fault, you should cast the void pointer returned by the malloc() ---            &#39; new_cell =(struct cell *) malloc(sizeof(struct cell)); &#39;"}], "answers": [{"comments": [{"owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "edited": false, "score": 0, "creation_date": 1556645184, "post_id": 55925912, "comment_id": 98505564, "body": "Your code has mutliple problems: It doesn&#39;t work with empty lists, it doesn&#39;t work with lists only having 1 element and you have to add &#39;currentcell-&gt;next = NULL&#39; after &#39;free(currentcell-&gt;next);&#39;."}], "tags": [], "owner": {"reputation": 722, "user_id": 10765327, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-1ElHGOwoSrI/AAAAAAAAAAI/AAAAAAAADEQ/Cz35ePwdjZQ/photo.jpg?sz=128", "display_name": "Andrew St P", "link": "https://stackoverflow.com/users/10765327/andrew-st-p"}, "is_accepted": false, "score": 1, "last_activity_date": 1556644714, "creation_date": 1556644714, "answer_id": 55925912, "question_id": 55925725, "link": "https://stackoverflow.com/questions/55925725/deleting-last-element-from-linked-list/55925912#55925912", "title": "deleting last element from linked list", "body": "<pre><code>void deleteLast(struct cell **list){\n    struct cell * currentcell = *list;\n    while(currentcell-&gt;next-&gt;next != NULL) {\n        currentcell = currentcell-&gt;next;\n    }\n    free(currentcell-&gt;next);\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1246, "user_id": 6556709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6389fba1f75367a547c52d9779902b20?s=128&d=identicon&r=PG&f=1", "display_name": "user6556709", "link": "https://stackoverflow.com/users/6556709/user6556709"}, "is_accepted": false, "score": 1, "last_activity_date": 1556652739, "creation_date": 1556652739, "answer_id": 55927595, "question_id": 55925725, "link": "https://stackoverflow.com/questions/55925725/deleting-last-element-from-linked-list/55927595#55927595", "title": "deleting last element from linked list", "body": "<p>Since Daniel Siegel explicitly asked me to extent the answer of Andrew St. Pierre. Here is what I wrote in the comments.</p>\n\n<p>You always have to check if your pointer is not a NULL before you dereference it and you have to assign NULL explicit after freeing something cause free will not do that for you but leave you with a pointer which looks good but points to nothing.</p>\n\n<pre><code>void deleteLast(struct cell **list){\n    //Do nothing if list is a NULL\n    if (!list){\n        return;\n    }\n    struct cell * currentcell = *list;\n    //Do nothing if list is empty\n    if (!currentcell){\n        return;\n    }\n    //Check if first element is last element\n    if (!currentcell-&gt;next){\n        free(currentcell);\n        //assign NULL to the pointer in list not to currentcell\n        //since currentcell is a local variable.\n        *list = NULL;\n        return;\n    }\n    while(currentcell-&gt;next-&gt;next != NULL) {\n        currentcell = currentcell-&gt;next;\n    }\n    free(currentcell-&gt;next);\n    //explicit set last element to NULL\n    currentcell-&gt;next = NULL;\n}\n</code></pre>\n"}], "owner": {"reputation": 469, "user_id": 6115246, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/1b9cf9de31bac0fcb669e25bce367588?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Siegel", "link": "https://stackoverflow.com/users/6115246/daniel-siegel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1556652739, "creation_date": 1556643989, "question_id": 55925725, "link": "https://stackoverflow.com/questions/55925725/deleting-last-element-from-linked-list", "title": "deleting last element from linked list", "body": "<p>For a project I need a linked list implementation in C which enables me to delete the last element.</p>\n\n<p>However, I don't know how to achieve this.\nThe idea was to create a function (deleteLast) which iterates over the list until the next of the next element is NULL (so until the second last element is reached) to then free the reference to the last element.</p>\n\n<p>However, I get an error \"expression must have pointer-to-struct-or-union type\" when trying to compile.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct cell{\n    int x_coord,y_coord;\n    struct cell *next;\n} cell;\n\nstruct cell AddToList (struct cell *list, int x,int y);\nint listlength(struct cell * list);\nvoid deleteLast(struct cell **list);\n\nstruct cell AddToList(struct cell *list,int x,int y){\n    struct cell *new_cell;\n    new_cell = malloc(sizeof(struct cell));\n    new_cell-&gt;x_coord=x;\n    new_cell-&gt;y_coord=y;\n    printf(\"Added new coordinates %i %i\",x,y);\n}\n\nint listlength(struct cell *list){\n    int i=0;\n    while(list-&gt;next != NULL){\n        i++;\n    }\n    return i;\n}\n\n//takes a pointer as reference, because in C parameters are given as values\n//see: https://stackoverflow.com/a/35021864\n//calls should look like deleteLast( &amp;list )\nvoid deleteLast(struct cell **list){\n    struct cell *currentcell = *list;\n    while(*list-&gt;next-&gt;next != NULL){ //expression must have pointer-to-struct-or-union type\n        //free list-&gt;next\n    }\n}\n</code></pre>\n\n<p>Where's the error?</p>\n"}, {"tags": ["c", "atmega"], "comments": [{"owner": {"reputation": 2449, "user_id": 500276, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/200bf76976f24add540182f5c3a42788?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Benningfield", "link": "https://stackoverflow.com/users/500276/mark-benningfield"}, "edited": false, "score": 0, "creation_date": 1556645166, "post_id": 55925678, "comment_id": 98505557, "body": "This assignment <code>string = next_node;</code> does <i>not</i> survive the return of the <code>pop</code> function."}], "answers": [{"tags": [], "owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "is_accepted": true, "score": 1, "last_activity_date": 1556646785, "creation_date": 1556646785, "answer_id": 55926348, "question_id": 55925678, "link": "https://stackoverflow.com/questions/55925678/i-can-pop-the-first-element-char-of-a-linked-list-in-the-main-code-but-i-cant/55926348#55926348", "title": "I can pop the first element (char) of a linked list in the main code, but I cant put that part of the code in a function", "body": "<p>In the function <code>pop()</code>  you assign the <code>local</code> parameter <code>string</code>:</p>\n\n<pre><code>string = next_node;\n</code></pre>\n\n<p>But here <code>string</code> is a local variable and not associated with <code>string</code> in <code>main()</code> - it is simply a copy of the <em>value</em> of <code>string</code> in <code>main()</code> - or was until you modified it.</p>\n\n<p>You need an additional level of indirection, so that you are passing a pointer to the <code>string</code> object from <code>main()</code>:</p>\n\n<pre><code>char pop(node_char** string) \n{\n    node_char* next_node = NULL;\n    char popped = (*string)-&gt;val;\n    next_node = (*string)-&gt;next;\n    free(*string);\n    *string = next_node ;\n\n    return popped;\n}\n</code></pre>\n\n<p>Then call:</p>\n\n<pre><code>char popped = pop( &amp;string ) ;\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 11433732, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9iAi_nOE3F4/AAAAAAAAAAI/AAAAAAAAAKI/wZ0EiVZBfvc/photo.jpg?sz=128", "display_name": "AGUSTIN MACAYA VALLADARES", "link": "https://stackoverflow.com/users/11433732/agustin-macaya-valladares"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 55926348, "answer_count": 1, "score": 0, "last_activity_date": 1556646785, "creation_date": 1556643808, "question_id": 55925678, "link": "https://stackoverflow.com/questions/55925678/i-can-pop-the-first-element-char-of-a-linked-list-in-the-main-code-but-i-cant", "title": "I can pop the first element (char) of a linked list in the main code, but I cant put that part of the code in a function", "body": "<p>I m working with linked lists of chars and I need to create a function that pops the first element of the linked list, that is: delete the first node, free the space and return the char that was saved in the first node.</p>\n\n<p>I created a code that does that perfectly in the main function of the program, but when I put that part of the code into a function, it stops working and I can't figure out why.</p>\n\n<p>Im working with the ATmega328p and the idea is to send  the chars to the computer (Im using minicom as terminal emulator) so the function USART_Transmit_char() sends a char to the computer.</p>\n\n<p>The code in the main function that works perfectly whith the pop in the main function is this one:</p>\n\n<pre><code>int main(void)\n{\n        //USART CONFIGURATION\n        struct USART_configuration config_57600_8N1 = {57600, 8,1,'n'};\n        USART_Init(config_57600_8N1);\n        //END USART CONFIGURATION\n\n        //CEATES THE FIRST NODE OF LINKED LIST\n        node_char * string = NULL;\n        string = malloc(sizeof(node_char));\n        string-&gt;val = 'H';\n        string-&gt;next = NULL;\n\n        //ADD ELEMENTS TO LINKED LIST\n        push(string,'O');\n        push(string,'L');\n        push(string,'A');\n\n        //COMMUNICATION WITH COMPUTER\n        USART_Transmit_String(\"I received this line: \");\n        USART_Transmit_char(string-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;next-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;next-&gt;next-&gt;val);\n        USART_Transmit_String(\".\\r\\n\\r\\n\");\n\n        //HERE I POP THE FIRST ELEMENT\n        node_char * next_node = NULL;\n        char popped = string-&gt;val;\n        next_node = string-&gt;next;\n        free(string);\n        string = next_node;\n        //HERE THE FIRST ELEMENT HAS BEEN POPPED\n\n        //COMMUNICATION WITH COMPUTER        \n        USART_Transmit_String(\"I popped this char: \");\n        USART_Transmit_char(popped);\n        USART_Transmit_String(\".\\r\\n\\r\\n\");\n        USART_Transmit_String(\"I am left with this: \");\n        USART_Transmit_char(string-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;next-&gt;val);\n        USART_Transmit_String(\".\\r\\n\\r\\n\");        \n}\n\n\n</code></pre>\n\n<p>The struct of the node and the push function are :</p>\n\n<pre><code>typedef struct node {\n        char val;\n        struct node * next;\n    } node_char;\n\nvoid push(node_char * string, char val) {\n    node_char * current = string;\n    while (current-&gt;next != NULL) {\n        current = current-&gt;next;\n    }\n    current-&gt;next = malloc(sizeof(node_char));\n    current-&gt;next-&gt;val = val;\n    current-&gt;next-&gt;next = NULL;\n}\n</code></pre>\n\n<p>The result is:</p>\n\n<pre><code>I recived this line: HOLA.\n\nI popped this char: H.\n\nI am left whit this: OLA.\n</code></pre>\n\n<p>The problem comes when I change the part of the code that pops the craracter for a function defined appart that has the exact same code.</p>\n\n<p>The new main code is:</p>\n\n<pre><code>int main(void)\n{\n        //USART CONFIGURATION\n        struct USART_configuration config_57600_8N1 = {57600, 8,1,'n'};\n        USART_Init(config_57600_8N1);\n        //END USART CONFIGURATION\n\n        //CEATES THE FIRST NODE OF LINKED LIST\n        node_char * string = NULL;\n        string = malloc(sizeof(node_char));\n        string-&gt;val = 'H';\n        string-&gt;next = NULL;\n\n        //ADD ELEMENTS TO LINKED LIST\n        push(string,'O');\n        push(string,'L');\n        push(string,'A');\n\n        //COMMUNICATION WITH COMPUTER\n        USART_Transmit_String(\"I received this line: \");\n        USART_Transmit_char(string-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;next-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;next-&gt;next-&gt;val);\n        USART_Transmit_String(\".\\r\\n\\r\\n\");\n\n        //HERE I POP THE FIRST ELEMENT\n\n        char popped = pop(string);\n\n        //HERE THE FIRST ELEMENT HAS BEEN POPPED\n\n        //COMMUNICATION WITH COMPUTER\n        USART_Transmit_String(\"I popped this char: \");\n        USART_Transmit_char(popped);\n        USART_Transmit_String(\".\\r\\n\\r\\n\");\n        USART_Transmit_String(\"I am left with this: \");\n        USART_Transmit_char(string-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;val);\n        USART_Transmit_char(string-&gt;next-&gt;next-&gt;val);\n        USART_Transmit_String(\".\\r\\n\\r\\n\");        \n}\n</code></pre>\n\n<p>The function pop is defined:</p>\n\n<pre><code>char pop(node_char * string) {\n    node_char * next_node = NULL;\n    char popped = string-&gt;val;\n    next_node = string-&gt;next;\n    free(string);\n    string = next_node;\n    return popped;\n}\n</code></pre>\n\n<p>The result is:</p>\n\n<pre><code>I recived this line: HOLA.\n\nI popped this char: H.\n\nI am left whit this: \n                      .\n</code></pre>\n\n<p>(Note that the (.) is printed in the next line)</p>\n\n<p>I cant figure out why this doesn't work when its te same code just defined in a function.</p>\n\n<p>Does anyone have an Idea why this is happening? I've tried a lot of different ways for solving the problem, with diferent results but never the desired result.</p>\n"}, {"tags": ["c"], "answers": [{"comments": [{"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 11, "user_id": 11395938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/042b7ab870c05d41752f77de23d6397e?s=128&d=identicon&r=PG&f=1", "display_name": "Amartias Aisopos", "link": "https://stackoverflow.com/users/11395938/amartias-aisopos"}, "edited": false, "score": 0, "creation_date": 1556643390, "post_id": 55925366, "comment_id": 98504768, "body": "@AmartiasAisopos warning with the overflow (I edited my answer)"}, {"owner": {"reputation": 11, "user_id": 11395938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/042b7ab870c05d41752f77de23d6397e?s=128&d=identicon&r=PG&f=1", "display_name": "Amartias Aisopos", "link": "https://stackoverflow.com/users/11395938/amartias-aisopos"}, "edited": false, "score": 0, "creation_date": 1556643651, "post_id": 55925366, "comment_id": 98504888, "body": "I am new at programming so every tip/help is accepted...thanks again"}], "tags": [], "owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "is_accepted": true, "score": 0, "last_activity_date": 1556643365, "last_edit_date": 1556643365, "creation_date": 1556642396, "answer_id": 55925366, "question_id": 55925312, "link": "https://stackoverflow.com/questions/55925312/return-values-in-c-programming/55925366#55925366", "title": "Return values in C programming", "body": "<blockquote>\n  <p>for example...option 1. dec-bin. 10=1010. after that the program keeps running and if i choose the same option i get the result..10=10101010</p>\n</blockquote>\n\n<p>you missed to reset <em>bin</em> and <em>i</em> so <em>bin</em> accumulates, the first time produces 1010 then you add ('append') again 1010 producing 10101010</p>\n\n<p>do <code>bin = 0; i = 1;</code> before the <code>while(dec!=0) ...</code></p>\n\n<p>Additional remarks :</p>\n\n<ul>\n<li>you have a risk of overflow on <em>bin</em>, you can use a string you will print in the reverse order you filled it</li>\n<li>you need to check the user enter a valid number checking <em>scanf</em> returns 1</li>\n</ul>\n"}], "owner": {"reputation": 11, "user_id": 11395938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/042b7ab870c05d41752f77de23d6397e?s=128&d=identicon&r=PG&f=1", "display_name": "Amartias Aisopos", "link": "https://stackoverflow.com/users/11395938/amartias-aisopos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 55925366, "answer_count": 1, "score": 0, "last_activity_date": 1556643365, "creation_date": 1556642127, "last_edit_date": 1556642542, "question_id": 55925312, "link": "https://stackoverflow.com/questions/55925312/return-values-in-c-programming", "title": "Return values in C programming", "body": "<ol>\n<li><p>I want the program to keep running till I choose to close it and clear the screen each time you convert a number(done)</p></li>\n<li><p>The problem i have in this current code is that..if i press the 1st option i get the correct result..but if i press the same option or any other option it keep adding things up...for example...option 1. dec-bin. 10=1010. after that the program keeps running and if i choose the same option i get the result..10=10101010</p></li>\n</ol>\n\n<pre class=\"lang-c prettyprint-override\"><code>switch(option)\n{\n   case 1: //if 1 is selected\n        printf(\"\\nEnter Decimal to convert to Binary:\"); //Prints the message between quotes\n        scanf(\"%d\",&amp;dec); //Reads the Decimal number\n        num=dec;\n\n        while(dec!=0)\n        {\n            rem=dec%2;\n            bin=bin+rem*i;\n            dec=dec/2;\n            i=i*10;\n        }\n\n        printf(\"\\nThe Binary number is: %d \\n\\n\",bin); //Prints the converted number\n\n        system(\"pause\"); //Pauses program\n        system(\"cls\"); //Clears the screen\n        return 0;\n        break;\n</code></pre>\n"}, {"tags": ["c", "c-preprocessor", "preprocessor"], "comments": [{"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 1, "creation_date": 1556646436, "post_id": 55925305, "comment_id": 98506123, "body": "You could write it in a loop and force the compiler to unroll the loop."}, {"owner": {"reputation": 10030, "user_id": 3052751, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/11564daa64a4b0252a133fe3801468a7?s=128&d=identicon&r=PG&f=1", "display_name": "VividD", "link": "https://stackoverflow.com/users/3052751/vividd"}, "reply_to_user": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556648575, "post_id": 55925305, "comment_id": 98507092, "body": "@CacahueteFrito That would be a legitimate answer - but, how do you do that?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556655077, "post_id": 55925305, "comment_id": 98509690, "body": "@CacahueteFrito I doubt you can convince a sane compiler to unroll a loop of 1000 iterations."}, {"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1556668867, "post_id": 55925305, "comment_id": 98513531, "body": "@EugeneSh. See my answer. I don&#39;t think the compiler has an option to disobey, but I don&#39;t know for sure, though."}], "answers": [{"comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1556642789, "post_id": 55925402, "comment_id": 98504457, "body": ".. or you can utilize <code>RUN_2_TIMES</code> in each one of the other macros."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1556642900, "post_id": 55925402, "comment_id": 98504514, "body": "The only problem with the <code>do..while</code> block is that the code might require a common scope."}, {"owner": {"reputation": 7825, "user_id": 3684343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bee557e309dc42d91a706c70c8c0c9f?s=128&d=identicon&r=PG&f=1", "display_name": "mch", "link": "https://stackoverflow.com/users/3684343/mch"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1556643114, "post_id": 55925402, "comment_id": 98504618, "body": "@EugeneSh. yes, depends on what <code>x</code> is."}], "tags": [], "owner": {"reputation": 7825, "user_id": 3684343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bee557e309dc42d91a706c70c8c0c9f?s=128&d=identicon&r=PG&f=1", "display_name": "mch", "link": "https://stackoverflow.com/users/3684343/mch"}, "is_accepted": true, "score": 3, "last_activity_date": 1556642992, "last_edit_date": 1556642992, "creation_date": 1556642528, "answer_id": 55925402, "question_id": 55925305, "link": "https://stackoverflow.com/questions/55925305/repeating-an-exact-same-code-segment-1000-times-without-loop/55925402#55925402", "title": "Repeating an exact same code segment 1000 times without loop", "body": "<pre><code>#define RUN_1024_TIMES(x) do {RUN_512_TIMES(x); RUN_512_TIMES(x); } while(0)\n#define RUN_512_TIMES(x) do {RUN_256_TIMES(x); RUN_256_TIMES(x); } while(0)\n#define RUN_256_TIMES(x) do {RUN_128_TIMES(x); RUN_128_TIMES(x); } while(0)\n#define RUN_128_TIMES(x) do {RUN_64_TIMES(x); RUN_64_TIMES(x); } while(0)\n#define RUN_64_TIMES(x) do {RUN_32_TIMES(x); RUN_32_TIMES(x); } while(0)\n#define RUN_32_TIMES(x) do {RUN_16_TIMES(x); RUN_16_TIMES(x); } while(0)\n#define RUN_16_TIMES(x) do {RUN_8_TIMES(x); RUN_8_TIMES(x); } while(0)\n#define RUN_8_TIMES(x) do {RUN_4_TIMES(x); RUN_4_TIMES(x); } while(0)\n#define RUN_4_TIMES(x) do {RUN_2_TIMES(x); RUN_2_TIMES(x); } while(0)\n#define RUN_2_TIMES(x) do {x; x; } while(0)\n</code></pre>\n\n<p>the <code>do{ ... } while(0)</code> is only for the case that you call it with <code>if (....) RUN_1024_TIMES(...);</code>. You can remove it when you do not need it.</p>\n\n<p>You could also do it with 3 times per macro:</p>\n\n<pre><code>#define RUN_1000_TIMES(x) do {RUN_729_TIMES(x); RUN_243_TIMES(x); RUN_27_TIMES(x); x; } while(0)\n#define RUN_729_TIMES(x) do {RUN_243_TIMES(x); RUN_243_TIMES(x); RUN_243_TIMES(x); } while(0)\n#define RUN_243_TIMES(x) do {RUN_81_TIMES(x); RUN_81_TIMES(x); RUN_81_TIMES(x); } while(0)\n#define RUN_81_TIMES(x) do {RUN_27_TIMES(x); RUN_27_TIMES(x); RUN_27_TIMES(x); } while(0)\n#define RUN_27_TIMES(x) do {RUN_9_TIMES(x); RUN_9_TIMES(x); RUN_9_TIMES(x); } while(0)\n#define RUN_9_TIMES(x) do {RUN_3_TIMES(x); RUN_3_TIMES(x); RUN_3_TIMES(x); } while(0)\n#define RUN_3_TIMES(x) do {x; x; x; } while(0)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "edited": false, "score": 0, "creation_date": 1556646279, "post_id": 55925444, "comment_id": 98506044, "body": "You can also do that in C :)"}], "tags": [], "owner": {"reputation": 4345, "user_id": 341106, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/sEaCN.png?s=128&g=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/341106/kevin"}, "is_accepted": false, "score": 1, "last_activity_date": 1556642760, "creation_date": 1556642760, "answer_id": 55925444, "question_id": 55925305, "link": "https://stackoverflow.com/questions/55925305/repeating-an-exact-same-code-segment-1000-times-without-loop/55925444#55925444", "title": "Repeating an exact same code segment 1000 times without loop", "body": "<p>in a Python file, put:</p>\n\n<pre><code>print(\"//header of the code\")\nfor i in range(1000):\n    print(\"x;\")\nprint(\"//bottom of the code\")\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>./gen.py &gt; file.c\n</code></pre>\n\n<p>that will be simpler that what ever you can do with the C preprocessor, that cannot perform things like a loop!</p>\n"}, {"tags": [], "owner": {"reputation": 2336, "user_id": 3936002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/utGjG.png?s=128&g=1", "display_name": "H Walters", "link": "https://stackoverflow.com/users/3936002/h-walters"}, "is_accepted": false, "score": 1, "last_activity_date": 1556643027, "creation_date": 1556643027, "answer_id": 55925512, "question_id": 55925305, "link": "https://stackoverflow.com/questions/55925305/repeating-an-exact-same-code-segment-1000-times-without-loop/55925512#55925512", "title": "Repeating an exact same code segment 1000 times without loop", "body": "<pre><code>#define RUN_10_TIMES(X) X X X X X X X X X X\n#define RUN_1000_TIMES(X) RUN_10_TIMES(RUN_10_TIMES(RUN_10_TIMES(X)))\n</code></pre>\n\n<p>Note that you get to recursively \"call\" a macro in \"invocation\" like syntax (so <code>FOO(FOO(FOO(X)))</code> is okay); this is because the first step of a function-like macro invocation uses <em>argument substitution</em>, which has no restrictions on recursion.  Argument substitution specifically involves evaluating any argument whose corresponding parameter appears in a replacement list (and isn't stringified or part of a paste), as if it were on a line by itself, and then using the resulting expansion to replace each such parameter.  After argument substitution (and paste/stringifications), the resulting replacement list is rescanned in a <em>rescan and further replacement</em> step; it's during <em>this</em> step that the macro is marked with \"blue paint\" (meaning, additional invocations are ignored).  Invocation-like recursion is entirely a function of argument substitution, so it's allowed.</p>\n"}, {"tags": [], "owner": {"reputation": 2823, "user_id": 6872717, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCuzs.png?s=128&g=1", "display_name": "alx", "link": "https://stackoverflow.com/users/6872717/alx"}, "is_accepted": false, "score": 1, "last_activity_date": 1556649149, "creation_date": 1556649149, "answer_id": 55926873, "question_id": 55925305, "link": "https://stackoverflow.com/questions/55925305/repeating-an-exact-same-code-segment-1000-times-without-loop/55926873#55926873", "title": "Repeating an exact same code segment 1000 times without loop", "body": "<p>You can write your loops normally, and then just tell the compiler you want the loops to be unrolled.  It's nicely written, and as optimal as if you wrote the 1000 lines.</p>\n\n<p>The way to do this depends on your compiler.  I'll write the answer for GCC which is the compiler I use normally, but other compilers should be similar.</p>\n\n<p>If you want to unroll all loops in your code, it is easier: you just need to add an option or two to the command line:</p>\n\n<pre><code>-funroll-loops\n-funroll-all-loops\n</code></pre>\n\n<p>If you want to know more about the behaviour of these options, refer to the compiler manual.  There are also questions about them here on SO.</p>\n\n<p>If you just want to unroll a specific loop, and keep all other loops, it is more difficult, but it can also be done.  Check this SO answer for that: <a href=\"https://stackoverflow.com/a/14251545/6872717\">https://stackoverflow.com/a/14251545/6872717</a></p>\n"}, {"tags": [], "owner": {"reputation": 352, "user_id": 3473433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa87ec32236bf2a31994b1067e633067?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioperez", "link": "https://stackoverflow.com/users/3473433/eugenioperez"}, "is_accepted": false, "score": 1, "last_activity_date": 1556703210, "creation_date": 1556703210, "answer_id": 55934238, "question_id": 55925305, "link": "https://stackoverflow.com/questions/55925305/repeating-an-exact-same-code-segment-1000-times-without-loop/55934238#55934238", "title": "Repeating an exact same code segment 1000 times without loop", "body": "<p>You can use P99 for that: <a href=\"http://p99.gforge.inria.fr/p99-html/group__preprocessor__for_gaec0c87b336a5fa2a8230e207af5cc1f0.html#gaec0c87b336a5fa2a8230e207af5cc1f0\" rel=\"nofollow noreferrer\">http://p99.gforge.inria.fr/p99-html/group__preprocessor__for_gaec0c87b336a5fa2a8230e207af5cc1f0.html#gaec0c87b336a5fa2a8230e207af5cc1f0</a></p>\n\n<p>The \"sad\" part is that maybe a smart enough compiler... make it a loop!</p>\n"}], "owner": {"reputation": 10030, "user_id": 3052751, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/11564daa64a4b0252a133fe3801468a7?s=128&d=identicon&r=PG&f=1", "display_name": "VividD", "link": "https://stackoverflow.com/users/3052751/vividd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 55925402, "answer_count": 5, "score": -1, "last_activity_date": 1556703210, "creation_date": 1556642070, "last_edit_date": 1556642796, "question_id": 55925305, "link": "https://stackoverflow.com/questions/55925305/repeating-an-exact-same-code-segment-1000-times-without-loop", "title": "Repeating an exact same code segment 1000 times without loop", "body": "<p>For some reason (related to performance measurements), I need to repeat a code segment 1000 times (1024 times would be OK too), but WITHOUT \"for\" or any other loop.</p>\n\n<p>Obviously, I could most likely write a macro that would look something like this:</p>\n\n<pre><code>#define RUN_1000_TIMES(x)   \\\nx                           \\\nx                           \\\nx                           \\\n...\n...  /* (999+1 times the same line) */\n...\nx                           \\\nx\n</code></pre>\n\n<p>... and than apply that macro to my code segment.</p>\n\n<p>But is there a more elegant solution than 1000 lines long macro?</p>\n"}, {"tags": ["c++", "c", "clang", "clang-static-analyzer"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 1, "creation_date": 1556642176, "post_id": 55925226, "comment_id": 98504174, "body": "I <i>think</i> you are looking for <code>-isystem</code>."}, {"owner": {"reputation": 1485, "user_id": 138264, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mZr81.png?s=128&g=1", "display_name": "natersoz", "link": "https://stackoverflow.com/users/138264/natersoz"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1557072920, "post_id": 55925226, "comment_id": 98635487, "body": "That was part of the solution, thanks. My frustration with this tool boiled over into my previous comment. If you&#39;re dedicated to using this tool some amount of 3rd part library modification or nuanced replacement will be necessary. The results are worth it. The integration is tedious."}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1557073115, "post_id": 55925226, "comment_id": 98635532, "body": "Tedious? I don&#39;t agree. I&#39;ve integrated clang-tidy into several code bases (the current one being ~500k lines of code). I&#39;ve always found it to be fairly easy to do so. But, of course, opinions and experiences differ. \ud83d\ude42"}, {"owner": {"reputation": 818, "user_id": 3688293, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/044211651200793b2656b9942e7cbe89?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/3688293/martin"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1613581603, "post_id": 55925226, "comment_id": 117121039, "body": "@JesperJuhl clang-tidy&#39;s interface is completely broken, and this kind of issues are a clear example of it."}], "owner": {"reputation": 1485, "user_id": 138264, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mZr81.png?s=128&g=1", "display_name": "natersoz", "link": "https://stackoverflow.com/users/138264/natersoz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1841, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1556641793, "creation_date": 1556641793, "question_id": 55925226, "link": "https://stackoverflow.com/questions/55925226/excluding-header-files-from-clang-tidy-analysis", "title": "Excluding header files from clang-tidy analysis", "body": "<p>I would like to exclude third party header files from being checked by <code>clang-tidy</code>.</p>\n\n<p>From what I can tell, using a negative regular expression for header file exclusion is never going to happen: <a href=\"https://reviews.llvm.org/D34654\" rel=\"nofollow noreferrer\">https://reviews.llvm.org/D34654</a></p>\n\n<p>Slapping <code>// NOLINT</code> on a header file inclusion. This does not work:</p>\n\n<pre><code>#include \"third_party.h\"    // NOLINT\n</code></pre>\n\n<p>From what I can tell, there is no line-range option that can be used to say \"Ignore all lines in this file\" (please correct me if I am wrong).</p>\n\n<p>What is the simplest method for excluding third party header files from being analyzed by <code>clang-tidy</code>?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 432, "user_id": 8183900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZOGl.png?s=128&g=1", "display_name": "ngood97", "link": "https://stackoverflow.com/users/8183900/ngood97"}, "edited": false, "score": 0, "creation_date": 1556641926, "post_id": 55924994, "comment_id": 98504063, "body": "@stefnto Could you do some digging and see if there&#39;s anywhere that you are assigning the same pointer to both objects? Or at least show us where <code>OpeningAddress</code> is set up in your code before the key piece of code?"}, {"owner": {"reputation": 75, "user_id": 10640978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/165199145f5e9abb9a49856ad6e5ec7d?s=128&d=identicon&r=PG&f=1", "display_name": "stefnto", "link": "https://stackoverflow.com/users/10640978/stefnto"}, "reply_to_user": {"reputation": 1924, "user_id": 2669042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c66a47707c3d1748c9977727ddfa4d50?s=128&d=identicon&r=PG", "display_name": "xing", "link": "https://stackoverflow.com/users/2669042/xing"}, "edited": false, "score": 0, "creation_date": 1556642892, "post_id": 55924994, "comment_id": 98504509, "body": "@xing that&#39;s what I think as well that is happening, and here comes my understanding about pointers, when I declare <code>char *OpeningAddress</code> I declare a pointer to a string which points to NULL, so the line <code>Session-&gt;OpeningAddress = OpeningAddress </code> will assign the address to the &quot;OpeningAddress&quot; of the session, thus when inserting a new opening address a new string with a different starting address is assigned to the OpeningAddress variable that has been declared in main, leaving the previous attached address to &quot;OpeningAddress&quot; of the session unchanged. Is my thinking correct or not?"}, {"owner": {"reputation": 75, "user_id": 10640978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/165199145f5e9abb9a49856ad6e5ec7d?s=128&d=identicon&r=PG&f=1", "display_name": "stefnto", "link": "https://stackoverflow.com/users/10640978/stefnto"}, "edited": false, "score": 0, "creation_date": 1556642980, "post_id": 55924994, "comment_id": 98504556, "body": "You think a quick fix would be to declare 2 <code>char *OpeningAddress1</code> and <code>char *OpeningAddress2</code> one for each session?"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1556653945, "post_id": 55924994, "comment_id": 98509233, "body": "A line like <code>char *OpeningAddress == NULL;</code> does nothing. Why are you <i>comparing</i> to <code>NULL</code>?"}, {"owner": {"reputation": 75, "user_id": 10640978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/165199145f5e9abb9a49856ad6e5ec7d?s=128&d=identicon&r=PG&f=1", "display_name": "stefnto", "link": "https://stackoverflow.com/users/10640978/stefnto"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1556658399, "post_id": 55924994, "comment_id": 98510916, "body": "@tadman it was supposed to be one &#39;=&#39;, wrote two by mistake."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1556658454, "post_id": 55924994, "comment_id": 98510930, "body": "Easy to mess up. It&#39;s just something worth fixing."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 10640978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/165199145f5e9abb9a49856ad6e5ec7d?s=128&d=identicon&r=PG&f=1", "display_name": "stefnto", "link": "https://stackoverflow.com/users/10640978/stefnto"}, "edited": false, "score": 0, "creation_date": 1556659944, "post_id": 55927800, "comment_id": 98511410, "body": "thanks for the answer, but when I make this change I get a segmentation fault when trying to run the function."}, {"owner": {"reputation": 75, "user_id": 10640978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/165199145f5e9abb9a49856ad6e5ec7d?s=128&d=identicon&r=PG&f=1", "display_name": "stefnto", "link": "https://stackoverflow.com/users/10640978/stefnto"}, "edited": false, "score": 0, "creation_date": 1556661248, "post_id": 55927800, "comment_id": 98511876, "body": "@chqrile I didn&#39;t point <code>char *OpeningAddress=NULL</code> and no segmentation fault popped, thanks for the help!"}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": true, "score": 1, "last_activity_date": 1556696099, "last_edit_date": 1556696099, "creation_date": 1556653703, "answer_id": 55927800, "question_id": 55924994, "link": "https://stackoverflow.com/questions/55924994/re-arranging-pointers-in-a-struct-doesnt-give-me-the-correct-result/55927800#55927800", "title": "Re-arranging pointers in a struct doesn&#39;t give me the correct result", "body": "<p>The problem is simple:</p>\n\n<ul>\n<li>the call <code>SessionNewOpeningAddress(CurrSession, OpeningAddress);</code> sets the <code>OpeningAddress</code> member of the <code>CurrSession</code> to point to an array in the caller's scope that gets overwritten after this call. Indeed all <code>OpeningAddress</code> fields may point to the same array in the calling function.</li>\n<li>posting code fragments as you did is not helpful, much of the context is missing and some other code might cause the problem.</li>\n<li>hiding pointers behind typedefs as in <code>TabNodePtr</code> is highly discouraged. It leads to confusing code for beginners and advanced programmers alike.</li>\n</ul>\n\n<p>To fix your problem, you could make a copy of the string:</p>\n\n<pre><code>#include &lt;string.h&gt;\n\nvoid SessionNewOpeningAddress(InfoSessionPtr Session, char *OpeningAddress1) {\n    Session-&gt;OpeningAddress = OpeningAddress1 ? strdup(OpeningAddress1) : NULL;\n}\n</code></pre>\n\n<p>You would need to free the previous value as long as the structure has been initialized properly, and also free the current <code>Session-&gt;OpeningAddress</code> when the structure is discarded.</p>\n"}], "owner": {"reputation": 75, "user_id": 10640978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/165199145f5e9abb9a49856ad6e5ec7d?s=128&d=identicon&r=PG&f=1", "display_name": "stefnto", "link": "https://stackoverflow.com/users/10640978/stefnto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 55927800, "answer_count": 1, "score": 1, "last_activity_date": 1556696099, "creation_date": 1556640789, "last_edit_date": 1556653312, "question_id": 55924994, "link": "https://stackoverflow.com/questions/55924994/re-arranging-pointers-in-a-struct-doesnt-give-me-the-correct-result", "title": "Re-arranging pointers in a struct doesn&#39;t give me the correct result", "body": "<p>I have this <code>struct</code></p>\n\n<pre><code>typedef struct InfoSession {\n    TabNodePtr FirstTab;\n    TabNodePtr LastTab;\n    TabNodePtr CurrTab;\n    TabNodePtr AuxTab;\n    char *OpeningAddress;\n} InfoSession;\n</code></pre>\n\n<p>which has to be a browser session that controls all its tabs. The <code>OpeningAddress</code> is the default address when opening a new tab.</p>\n\n<p>My <code>main</code> looks like this:</p>\n\n<pre><code>int main() {\n    InfoSessionPtr  MySession1 = NULL, MySession2 = NULL, CurrSession = NULL;\n    int option, flag, n;\n    char *OpeningAddress == NULL;\n    ...\n}\n</code></pre>\n\n<p>When I want to change the <code>OpeningAddres</code>s using this function:</p>\n\n<pre><code>void SessionNewOpeningAddress(InfoSessionPtr Session, char *OpeningAddress1) {\n    Session-&gt;OpeningAddress = OpeningAddress1;\n}\n</code></pre>\n\n<p>everything works fine and the new opening address I add is displayed correctly. But, when I have two sessions at the same time, changing the <code>OpeningAddress</code> of the second session also changes the <code>OpeningAddress</code> of the first session (When adding a second session, after I've inserted a new <code>OpeningAddress</code> to the first session, the <code>OpeningAddress</code> of the second session isn't the same as the first session).</p>\n\n<p>For example, if I change the opening address of the first session to <code>\"AA\"</code>, adding a new session after that makes the <code>OpeningAddress</code> of the second session to be <code>NULL</code>, and not <code>\"AA\"</code> (Which is what I want).</p>\n\n<p>Adding the new session(s): </p>\n\n<pre><code>            if (MySession1 == NULL &amp;&amp; MySession2 == NULL) {\n                MySession1 = SessionNew(OpeningAddress);\n                CurrSession = MySession1;\n                printf(\"\\nNew Session (first) created!\\n\");\n                printf(\"First Session assigned as 'Current' Session\\n\");\n            } else {\n                MySession2 = SessionNew(OpeningAddress);\n                CurrSession = MySession2;\n                printf(\"\\nA Session already exists, created a second one.\\n\");\n                printf(\"Second Session assigned as 'Current' Session\\n\");\n            }\n\n</code></pre>\n\n<p>Changing the opening address:</p>\n\n<pre><code>        printf(\"\\nInsert the new Opening Address:\\n\");\n        scanf(\"%s\", OpeningAddress);\n        SessionNewOpeningAddress(CurrSession, OpeningAddress);\n</code></pre>\n\n<p>Also, the code changing which session to manage:</p>\n\n<pre><code>            printf(\"\\nPress 1 to manage first Session or 2 to manage second Session:\\n\");\n            scanf(\"%d\", &amp;n);\n            getchar();\n            if (n == 1){\n                CurrSession = MySession1;\n                printf(\"\\nManaging first Session\\n\");\n            } else if (n == 2){\n                CurrSession = MySession2;\n                printf(\"\\nManaging second Session\\n\");\n            }\n</code></pre>\n\n<p>Thanks for your help.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 4, "creation_date": 1556639233, "post_id": 55924497, "comment_id": 98502712, "body": "<a href=\"https://stackoverflow.com/q/35358767/10077\"><b>Never use <code>gets()</code>!</b></a>"}, {"owner": {"reputation": 1477, "user_id": 5899776, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/64b8e28377778d1b8ad57198ba46c319?s=128&d=identicon&r=PG&f=1", "display_name": "van dench", "link": "https://stackoverflow.com/users/5899776/van-dench"}, "edited": false, "score": 2, "creation_date": 1556639247, "post_id": 55924497, "comment_id": 98502715, "body": "<code>gets</code> require a string buffer, it also doesn\u2019t accept a stream, only <code>fgets</code> accepts a file stream."}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "edited": false, "score": 2, "creation_date": 1556639272, "post_id": 55924497, "comment_id": 98502729, "body": "!) Yes, definitely. 2) <code>gets</code> <a href=\"http://www.cplusplus.com/reference/cstdio/gets/\" rel=\"nofollow noreferrer\">expects a different argument</a>."}, {"owner": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "edited": false, "score": 0, "creation_date": 1556639315, "post_id": 55924497, "comment_id": 98502766, "body": "A couple of points: 1) &quot;warning&quot; != &quot;error&quot;, 2) different compilers can emit different messages.  This can usually be controlled with a compiler switch (e.g. <code>gcc -Wall -pedantic</code>), 3) <a href=\"https://stackoverflow.com/questions/1694036/\">gets() is Evil</a>.  Don&#39;t use it :)  Prefer <a href=\"https://linux.die.net/man/3/fgets\" rel=\"nofollow noreferrer\">fgets()</a> (among other alternatives)."}, {"owner": {"reputation": 1477, "user_id": 5899776, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/64b8e28377778d1b8ad57198ba46c319?s=128&d=identicon&r=PG&f=1", "display_name": "van dench", "link": "https://stackoverflow.com/users/5899776/van-dench"}, "reply_to_user": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "edited": false, "score": 0, "creation_date": 1556639414, "post_id": 55924497, "comment_id": 98502824, "body": "@paulsm4 C is a pretty loose language so a lot of the time it will produce warnings instead of formal errors, the errors will probably start showing up in the linking stage."}, {"owner": {"reputation": 4376, "user_id": 2850543, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2bb15c1da6de8180d9adc99954f167f7?s=128&d=identicon&r=PG&f=1", "display_name": "Millie Smith", "link": "https://stackoverflow.com/users/2850543/millie-smith"}, "edited": false, "score": 3, "creation_date": 1556639772, "post_id": 55924497, "comment_id": 98503015, "body": "You need it to be <code>char new_string[length + 1];</code>. Otherwise, you write one past the end of the buffer with <code>strcpy</code>."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1556653294, "post_id": 55924497, "comment_id": 98508977, "body": "is it difficult to to see that gets gets another type parameter? Simple google &quot;gets&quot; gives the answer instantly."}], "answers": [{"comments": [{"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1556653434, "post_id": 55924578, "comment_id": 98509032, "body": "I would say one of the questions not worth answering. OP was not bothered to take look on the function prototype to see what parameter it takes. BTW on this level of the C knowlegge safety of the code is secondary - it is far too early for the production code"}], "tags": [], "owner": {"reputation": 18385, "user_id": 1773434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9HhFs.png?s=128&g=1", "display_name": "Govind Parmar", "link": "https://stackoverflow.com/users/1773434/govind-parmar"}, "is_accepted": true, "score": 4, "last_activity_date": 1556639319, "creation_date": 1556639319, "answer_id": 55924578, "question_id": 55924497, "link": "https://stackoverflow.com/questions/55924497/is-this-syntax-correct/55924578#55924578", "title": "Is this syntax correct?", "body": "<blockquote>\n  <p>1) Are there different versions of C?</p>\n</blockquote>\n\n<p>Yes, and the specific reason that the validity of this code differs across C standards is that you are using the function <code>gets</code>, which has been deprecated and later fully removed by modern C standards.  There is practically no way to use <code>gets</code> in production code without risking a buffer overflow, so it's recommended to use functions that check the length of the buffer. <code>fgets</code> is the most common with:</p>\n\n<pre><code>fgets(buffer, BUFFER_SIZE, stdin);\n</code></pre>\n\n<blockquote>\n  <p>2) Is this code still correct, or would it be better to use char * for the function parameter</p>\n</blockquote>\n\n<p>There is no difference between the function parameters: <code>char *foo</code> and <code>char foo[]</code>, since when an array is passed as an argument to a function, it decays to a pointer to its first element.  Both syntaxes are acceptable.</p>\n"}, {"comments": [{"owner": {"reputation": 1477, "user_id": 5899776, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/64b8e28377778d1b8ad57198ba46c319?s=128&d=identicon&r=PG&f=1", "display_name": "van dench", "link": "https://stackoverflow.com/users/5899776/van-dench"}, "edited": false, "score": 3, "creation_date": 1556639473, "post_id": 55924601, "comment_id": 98502858, "body": "C99 supports VLA\u2019s."}, {"owner": {"reputation": 4376, "user_id": 2850543, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/2bb15c1da6de8180d9adc99954f167f7?s=128&d=identicon&r=PG&f=1", "display_name": "Millie Smith", "link": "https://stackoverflow.com/users/2850543/millie-smith"}, "edited": false, "score": 3, "creation_date": 1556639542, "post_id": 55924601, "comment_id": 98502890, "body": "Additionally to van&#39;s comment, this is C so malloc would be used, not new"}], "tags": [], "owner": {"reputation": 681, "user_id": 3850253, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/FDHZq.jpg?s=128&g=1", "display_name": "Amr Rady", "link": "https://stackoverflow.com/users/3850253/amr-rady"}, "is_accepted": false, "score": -2, "last_activity_date": 1556639607, "last_edit_date": 1556639607, "creation_date": 1556639393, "answer_id": 55924601, "question_id": 55924497, "link": "https://stackoverflow.com/questions/55924497/is-this-syntax-correct/55924601#55924601", "title": "Is this syntax correct?", "body": "<p>This syntax is not correct because the array declaration in c/c++ must have a constant size at the compile time. </p>\n\n<pre><code>length = strlen(str);\n\nchar new_string[length];\n</code></pre>\n\n<p>the length value cannot be determined at the compile time. if you want to control the size at the run time then you have to use <strong>malloc</strong> in C or the <strong>new</strong> operator (C++).</p>\n\n<p>See <a href=\"https://stackoverflow.com/questions/2672085/static-array-vs-dynamic-array-in-c\">Static array vs. dynamic array in C++</a></p>\n"}], "owner": {"reputation": 465, "user_id": 9344206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/276d8ee7cb60f203223a407ad4a0f6e0?s=128&d=identicon&r=PG&f=1", "display_name": "RobotMan", "link": "https://stackoverflow.com/users/9344206/robotman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "closed_date": 1566706336, "accepted_answer_id": 55924578, "answer_count": 2, "score": 1, "last_activity_date": 1556652994, "creation_date": 1556639058, "last_edit_date": 1556652994, "question_id": 55924497, "link": "https://stackoverflow.com/questions/55924497/is-this-syntax-correct", "closed_reason": "Duplicate", "title": "Is this syntax correct?", "body": "<p>I have been using Coderbyte.com the last couple of days for some coding challenges in C. I normally use Codeblocks as my IDE, I have noticed that sometimes the working solution in the Coderbyte IDE will throw an error in Codeblocks.\nFor example:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nvoid AlphabetSoup(char str[]) {\n    int i, j, length;\n\n    length = strlen(str);\n\n    char new_string[length];\n    char temp;\n\n    strcpy(new_string, str);\n\n    for (i = 0; i &lt; length; i++) {\n        for (j = i + 1; j &lt; length; j++) {\n            if (new_string[i] &gt; new_string[j]) {\n                temp = new_string[i];\n                new_string[i] = new_string[j];\n                new_string[j] = temp;\n            }\n        }\n    }\n\n    // code goes here\n    printf(\"%s\", new_string);\n}\n\nint main(void) {\n    AlphabetSoup(gets(stdin));\n    return 0;\n}\n</code></pre>\n\n<p>In Codeblocks it is throwing at error in the <code>main</code> function saying:</p>\n\n<pre><code>warning: passing argument 1 of 'gets' from incompatible pointer type [enabled by default]\n</code></pre>\n\n<p>anyways I don't understand why this solution is working on one IDE and not the other. Another time some code I put in said that it would only work in C99.</p>\n\n<p>Now when I run this code in Codeblocks it crashes, but not on Coderbyte.</p>\n\n<p>My questions are:</p>\n\n<p>1) Are there different versions of C?</p>\n\n<p>2) Is this code still correct, or would it be better to use <code>char *</code> for the function parameter</p>\n\n<p>I'm still new to C</p>\n"}, {"tags": ["c", "pointers", "undefined-behavior", "fgets"], "comments": [{"owner": {"reputation": 4251, "user_id": 4605105, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh4.googleusercontent.com/-_cFfGx1khYs/AAAAAAAAAAI/AAAAAAAAGt0/vfQ_28nwAEE/photo.jpg?sz=128", "display_name": "&#212;rel", "link": "https://stackoverflow.com/users/4605105/%c3%94rel"}, "edited": false, "score": 0, "creation_date": 1556637331, "post_id": 55923967, "comment_id": 98501601, "body": "you need to allocate memory for <code>str2</code> and <code>str3</code>."}, {"owner": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "reply_to_user": {"reputation": 4251, "user_id": 4605105, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh4.googleusercontent.com/-_cFfGx1khYs/AAAAAAAAAAI/AAAAAAAAGt0/vfQ_28nwAEE/photo.jpg?sz=128", "display_name": "&#212;rel", "link": "https://stackoverflow.com/users/4605105/%c3%94rel"}, "edited": false, "score": 0, "creation_date": 1556637394, "post_id": 55923967, "comment_id": 98501631, "body": "Agreed. Why did it work for str2? That&#39;s the question I asked"}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 5, "creation_date": 1556637578, "post_id": 55923967, "comment_id": 98501738, "body": "<i>Undefined behavior</i> can sometimes seem to work."}, {"owner": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "reply_to_user": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1556639152, "post_id": 55923967, "comment_id": 98502658, "body": "@Someprogrammerdude - the <i>third</i> potential outcome :-)"}], "answers": [{"comments": [{"owner": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "edited": false, "score": 0, "creation_date": 1556637706, "post_id": 55924029, "comment_id": 98501821, "body": "str2 is a pointer to a memory location which by definition should store chars. How many chars - I am not telling the program. If I explicitly do - for instance - str2 = &#39;Some String&#39;, things are fine. What is the difference between this manual update to the variable versus the one coming from fgets especially when I am explicitly providing to the fgets the size parameter (20, in my case)? This is what I am unable to intuit properly."}, {"owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "reply_to_user": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "edited": false, "score": 5, "creation_date": 1556637807, "post_id": 55924029, "comment_id": 98501878, "body": "a statement like <code>str2 = &quot;Some String&quot;;</code> does not write into the memory pointed to by <code>str2</code>, rather, it assigns the starting address of the string literal <code>&quot;some string&quot;</code> to <code>str2</code>. That&#39;s a different story."}, {"owner": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "edited": false, "score": 0, "creation_date": 1556637875, "post_id": 55924029, "comment_id": 98501914, "body": "okay - this is a great point - something which was conceptually vague in my head. Thanks for pointing this out."}, {"owner": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "edited": false, "score": 0, "creation_date": 1556638040, "post_id": 55924029, "comment_id": 98502019, "body": "But by the same token, the starting address of the string literal I am providing to str3 should get allocated to the str3 pointer variable? Isn&#39;t it?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "edited": false, "score": 0, "creation_date": 1556638105, "post_id": 55924029, "comment_id": 98502074, "body": "You are not assigning any string literal to <code>str3</code>, @Stats_Lover."}, {"owner": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "reply_to_user": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1556638195, "post_id": 55924029, "comment_id": 98502124, "body": "@JohnBollinger I am not assigning to str2 either - it&#39;s fgets so the assignment is happening at run time via a command line input (for both str2, for which the program works and str3 where it crashes and which is what the question is about)"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "reply_to_user": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "edited": false, "score": 1, "creation_date": 1556638323, "post_id": 55924029, "comment_id": 98502188, "body": "No, @Stats_Lover.  <code>fgets</code> does not assign to the pointer, period.  It does not assign the address of a string literal.  It does not assign any other pointer value.  Instead, it writes data to the location designated by the value the pointer already has.  That&#39;s a <i>completely</i> different thing, and for the effect to be defined, that value already held by the pointer must be a valid pointer to a sufficiently-large space."}], "tags": [], "owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "is_accepted": false, "score": 5, "last_activity_date": 1556637393, "creation_date": 1556637393, "answer_id": 55924029, "question_id": 55923967, "link": "https://stackoverflow.com/questions/55923967/reading-data-into-an-uninitialized-char-pointer-variable-using-fgets-crashes-at/55924029#55924029", "title": "Reading data into an uninitialized char pointer variable using fgets crashes at the second read", "body": "<p>In your case</p>\n\n<pre><code>// Prints fine      \nprintf(\"Second String: \");\nfgets(str2, 20, stdin);\nprintf(\"%s\", str2);\n</code></pre>\n\n<p>contains the write to uninitialized pointer, which contains indeterminate value, which means, it invokes <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"noreferrer\">undefined behavior</a>.</p>\n\n<p>Once your program has UB, nothing is guaranteed. One of the side-effects of having UB is to appear as \"working (ab)normally\", and a \"crash\" or segmentation fault is not guaranteed, either. It's just that, undefined.</p>\n\n<p><em>Moral of the story:</em> Do not try to reason with the output obtained from a program containing undefined behavior.</p>\n"}, {"comments": [{"owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "edited": false, "score": 1, "creation_date": 1556637678, "post_id": 55924110, "comment_id": 98501804, "body": "<code>Undefined behavior often times results in unpredictability</code> - isn&#39;t it more like all the times?"}, {"owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "edited": false, "score": 0, "creation_date": 1556637708, "post_id": 55924110, "comment_id": 98501823, "body": "Predictably unpredictable - or something."}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1556637794, "post_id": 55924110, "comment_id": 98501873, "body": "... and it may change from execution to exsecution. Or it may start crashing after the next reboot or after you logout/login again"}, {"owner": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "reply_to_user": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "edited": false, "score": 0, "creation_date": 1556638681, "post_id": 55924110, "comment_id": 98502383, "body": "@SouravGhosh &quot;Undefined behaviour often times results in unpredictability&quot; is a perfectly valid statement. Unpredictability is one of the potential outcomes of undefined behaviour (we don&#39;t know <i>why</i> what is happening is happening OR <i>nothing</i> may happen at all in case of undefined behaviour)"}], "tags": [], "owner": {"reputation": 9367, "user_id": 4454124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c094d8979fb41b789a7c7f21d9329359?s=128&d=identicon&r=PG&f=1", "display_name": "mnistic", "link": "https://stackoverflow.com/users/4454124/mnistic"}, "is_accepted": false, "score": 1, "last_activity_date": 1556637642, "creation_date": 1556637642, "answer_id": 55924110, "question_id": 55923967, "link": "https://stackoverflow.com/questions/55923967/reading-data-into-an-uninitialized-char-pointer-variable-using-fgets-crashes-at/55924110#55924110", "title": "Reading data into an uninitialized char pointer variable using fgets crashes at the second read", "body": "<p>Just because you are using an uninitialized pointer is not a guarantee that the program will crash. Undefined behavior often times results in unpredictability. In your particular case, on your machine and with your compiler the pointer just happens to point to valid memory even if uninitialized, but this may change from compiler to compiler and from machine to machine.</p>\n"}], "owner": {"reputation": 326, "user_id": 3813621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e4f2d463b8143e0367be9a7d6b00da9?s=128&d=identicon&r=PG&f=1", "display_name": "Stats_Lover", "link": "https://stackoverflow.com/users/3813621/stats-lover"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1556637951, "creation_date": 1556637203, "last_edit_date": 1556637951, "question_id": 55923967, "link": "https://stackoverflow.com/questions/55923967/reading-data-into-an-uninitialized-char-pointer-variable-using-fgets-crashes-at", "title": "Reading data into an uninitialized char pointer variable using fgets crashes at the second read", "body": "<p>I am aware that we cannot read data into an uninitialized char pointer using fgets. There are quite a few questions relating to this very point here on stackoverflow. All the answers point to the fact that you can't load data into an uninitialized pointer variable. </p>\n\n<p>The program shown in the first code snippet is able to populate the first uninitialized char pointer (*str2) using fgets but, crashes while trying to read data into the second uninitialized char pointer (*str3). </p>\n\n<p>I can get it to work using the traditional methods like allocating memory to the pointer up-front (as shown in the second code snippet below) before populating. My question is why does it work for the first variable but not for the second?</p>\n\n<p><strong>The Problem Code</strong></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    char str1[100], *str2, *str3;\n    // Prints fine\n\n    printf(\"First String: \");\n    fgets(str1, 20, stdin);\n    printf(\"%s\", str1);\n\n    // Prints fine      \n    printf(\"Second String: \");\n    fgets(str2, 20, stdin);\n    printf(\"%s\", str2);\n\n    // Program crashes on this input\n    printf(\"Third String: \");\n    fgets(str3, 20, stdin);\n    printf(\"%s\", str3);\n\n    return 0;\n\n}\n</code></pre>\n\n<p><strong>The Working Code</strong></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    char str1[100], str2[20], str3[20];\n    printf(\"First String: \");\n    fgets(str1, 20, stdin);\n    printf(\"%s\", str1);\n\n    printf(\"Second String: \");\n    fgets(str2, 20, stdin);\n    printf(\"%s\", str2);\n\n    printf(\"Third String: \");\n    fgets(str3, 20, stdin);\n    printf(\"%s\", str3);\n\n    return 0;\n\n}\n</code></pre>\n"}, {"tags": ["c", "fork", "producer-consumer"], "comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 1, "creation_date": 1556636491, "post_id": 55923283, "comment_id": 98501090, "body": "OT: regarding: <code>char c=&#39; &#39;;</code> and <code>c = getchar();</code>  The function: <code>getchar()</code> returns an <code>int</code>, not a <code>char</code>."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556636712, "post_id": 55923283, "comment_id": 98501221, "body": "regarding: <code>int pid = fork();</code> and related references to <code>pid</code>  1) the type should be: <code>pid_t</code>, not <code>int</code>.  2) the function: <code>fork()</code> has three kinds of returns: 1) &lt;0 means an error occurred.  2) ==0 means in the child process 3) &gt;0 means in the parent process.  The code should be checking for all three conditions"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1556636730, "post_id": 55923283, "comment_id": 98501235, "body": "what is <code>wait();</code> ? where it comes from ? Of course the consumer runs as fast as possible, it never blocks contrarily to the producer waiting for an input. <code>if(c!=&#39;\\n&#39;)puts(&quot;file written to successfully&quot;);</code> is <b>very</b> strange, did you supposed to check the result of <i>fputc</i> ?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556636988, "post_id": 55923283, "comment_id": 98501387, "body": "regarding: <code>while((fp = fopen(&quot;shared.txt&quot;, &quot;rt&quot;))==NULL);</code>  How many times do you want the code to open the same file?  once is plenty.  Should be checking for errors.  Suggest:  <code>fp = fopen( &quot;shared.txt&quot;, &quot;rt&quot; );  If( !fp ) { perror( &quot;fopen for reading -shared.txt- failed&quot; );  exit( EXIT_FAILURE ); }</code>"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556637051, "post_id": 55923283, "comment_id": 98501427, "body": "@user3629249 probably it is better to usleep/sleep a little if <i>fopen</i> fails because that means the producer did not yet created the file"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556637129, "post_id": 55923283, "comment_id": 98501472, "body": "&quot;<i>Is there a way to get this to work with wait statements?</i>&quot; what kind of wait you expect / waiting on what ? the end of the producer ?"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556637153, "post_id": 55923283, "comment_id": 98501490, "body": "the child process should be terminated via a call to <code>exit()</code>, not via a <code>return;</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556637293, "post_id": 55923283, "comment_id": 98501580, "body": "the <code>wait()</code> will &#39;pause&#39; until the child process terminates before calling the <code>consumer()</code> function, so there is no need for the consumer() function to contain a call to <code>sleep()</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 0, "creation_date": 1556637397, "post_id": 55923283, "comment_id": 98501633, "body": "@bruno,  The consumer() function will not be executed until the child process has exited, so no need to have the <code>consumer()</code> function sleep"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556637432, "post_id": 55923283, "comment_id": 98501655, "body": "regarding: <code>wait()</code>:  Please read the MAN page"}, {"owner": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556637453, "post_id": 55923283, "comment_id": 98501664, "body": "@user3629249 not sure this is what the OP wants, may be OP wants programs running in concurrency the consumer being a kind of <code>tail -f</code> ? The question is unclear, and unfortunately the OP does not answer to the remarks so we lost all our time ..."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1556637760, "post_id": 55923283, "comment_id": 98501849, "body": "OT: regarding: <code>c = fgetc(fp);</code> and <code>char c;</code>  The function: <code>fgetc()</code> returns an <code>int</code>, not a <code>char</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "reply_to_user": {"reputation": 31685, "user_id": 2458991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWDzI.jpg?s=128&g=1", "display_name": "bruno", "link": "https://stackoverflow.com/users/2458991/bruno"}, "edited": false, "score": 1, "creation_date": 1556638204, "post_id": 55923283, "comment_id": 98502131, "body": "@bruno,  I agree, for the desired operation, a &#39;named pipe&#39; or &#39;fifo&#39; would be a much better implementation over using a regular file"}], "answers": [{"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 0, "last_activity_date": 1556637454, "last_edit_date": 1556637454, "creation_date": 1556637143, "answer_id": 55923945, "question_id": 55923283, "link": "https://stackoverflow.com/questions/55923283/infinite-loop-in-producer-consumer-problem/55923945#55923945", "title": "infinite loop in producer-consumer problem", "body": "<blockquote>\n  <p>the problem is in the concurrency</p>\n</blockquote>\n\n<p>I'd say the problem is in the (lack of) synchronization.  In a producer / consumer arrangement, the producer usually has a means to signal the consumer that a new item is available for consumption, and the consumer waits for that signal before trying to consume one.  Details vary from there, but they typically also include a way for the producer to signal the consumer that no more items will be forthcoming.</p>\n\n<p>Your consumer does not wait for any explicit signal, and it does not use the data available to it (file length) to determine that a new item is available.  On the other hand, it makes no effort to keep its own place among the items consumed, so it can easily miss items if the producer gets ahead of it.  Moreover, the consumer busy-loops, performing expensive I/O operations no less, which is a very costly way to go about this.</p>\n\n<blockquote>\n  <p>Is there a way to get this to work with wait statements?</p>\n</blockquote>\n\n<p>Only if you wanted the producer to run to completion before the consumer consumed anything.  That's what <code>wait()</code> does: it waits for another process to <em>terminate</em>.  In that case, you would want the consumer to just read the file from the beginning, character by character, instead of leaping straight to the end.</p>\n\n<p>If you want producer and consumer to make progress concurrently, then the easiest way to go about it would be to make use of the facilities already provided to you by the system, by using a FIFO or a pipe instead of a regular file.  Then the producer could just write character after character and the consumer could just read character after character, without any of this reopening and repositioning nonsense.</p>\n\n<p>If you must do it with a regular file, then you could use a pair of semaphores or a mutex + condition variable to make producer and consumer take turns.  Alternatively, there are various ways that the consumer could monitor the file to detect when it has changed (<code>stat</code> / <code>fstat</code>, <code>inotify</code>, etc.) to avoid needlessly trying to read from it, and you could combine that with it tracking its own position in that file, so as not to re-read data it has already consumed.  Ideally, neither program would open the file more than once, but the producer might need to <code>fflush</code> after each write.</p>\n"}], "owner": {"reputation": 289, "user_id": 8163401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/653dbb04e4c92ad5c0db6870f801a653?s=128&d=identicon&r=PG&f=1", "display_name": "P. Gillich", "link": "https://stackoverflow.com/users/8163401/p-gillich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 306, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556637454, "creation_date": 1556635024, "last_edit_date": 1556636205, "question_id": 55923283, "link": "https://stackoverflow.com/questions/55923283/infinite-loop-in-producer-consumer-problem", "title": "infinite loop in producer-consumer problem", "body": "<p>I'm trying to gain a better understanding of <code>fork()</code> and concurrency in <code>c</code> programming. I'm a novice, and I'm having trouble understanding the logic. I tried to make a simple producer-consumer program using <code>fork()</code>. basically, a <code>producer()</code> function should take a character from <code>stdin</code>, and write it to a file. At the same time, a second process runs the <code>consumer</code> code, which is supposed to read the last character in the file and echo it to the screen. The <code>producer()</code> and <code>consumer()</code> functions are working fine by themselves, i.e. they are doing what each are supposed to do, but the problem is in the concurrency. Here is my code:</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nFILE* fp;\n//char c;\n\nvoid producer(){\n        char c=' ';\n        while(c!='x'){\n                puts(\"enter a char\");\n                c = getchar();\n\n                while((fp = fopen(\"shared.txt\", \"at\"))==NULL); //while the file is in use by another program\n\n                fputc(c,fp);\n\n                if(c!='\\n')puts(\"file written to successfully\");\n                fclose(fp);\n        }\n        return;\n}\n\nchar readChar(){\n        char c;\n        while((fp = fopen(\"shared.txt\", \"rt\"))==NULL);\n        fseek(fp, -1, SEEK_END);\n        c = fgetc(fp);\n        fclose(fp);\n        return c;\n}\n\nvoid consumer(){\n        char c;\n        do{\n                c = readChar();\n                printf(\"This is the latest character supplied: %c\\n\", c);\n        }while(c!='x');\n\n}\n\nint main(){\n        int pid = fork(); //now we fork processes\n\n        if(pid ==0 ){\n                producer();  //the child process should run and create some text in the file\n        }else{\n                wait(); consumer(); \n        }\n}\n</code></pre>\n\n<p>I tried to add wait statements after the calls to <code>producer()</code> and <code>consumer()</code> in their respective branches, but basically no matter what, the program fails to do what I want . if in <code>main ()</code> I have </p>\n\n<pre><code>int main(){\n        int pid = fork(); //now we fork processes\n\n        if(pid ==0 ){\n                producer();   //the child process should run and create some text in the file\n        }else{\n                consumer(); \n        }\n}\n</code></pre>\n\n<p>I get stuck in an infinite loop. Adding <code>wait();</code> after the function call in one or both branches doesn't help, because the infinite loop occurs before control passes to either <code>wait()</code>.</p>\n\n<p>If I try this:</p>\n\n<pre><code>int main(){\n        int pid = fork(); //now we fork processes\n\n        if(pid ==0 ){\n                producer();   //the child process should run and create some text in the file\n        }else{\n               wait(); consumer(); \n        }\n}\n</code></pre>\n\n<p>I can enter text from the <code>stdin</code> until I enter <code>'x'</code>, but then as expected  the consumer reads only the last character written to the file.</p>\n\n<p>Is there a way to get this to work with wait statements?</p>\n"}, {"tags": ["c", "pointers", "string-literals", "strcat"], "comments": [{"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1556635119, "post_id": 55923281, "comment_id": 98500267, "body": "Try <code>char x[20]</code> instead of <code>char* x</code>."}], "answers": [{"tags": [], "owner": {"reputation": 127623, "user_id": 2173917, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/4dwoM.jpg?s=128&g=1", "display_name": "Sourav Ghosh", "link": "https://stackoverflow.com/users/2173917/sourav-ghosh"}, "is_accepted": false, "score": 2, "last_activity_date": 1556635561, "last_edit_date": 1556635561, "creation_date": 1556635099, "answer_id": 55923308, "question_id": 55923281, "link": "https://stackoverflow.com/questions/55923281/use-strcat-function-with-char-pointer/55923308#55923308", "title": "Use strcat function with char pointer", "body": "<p>You're essentially trying to use a string literal as the destination buffer for <a href=\"https://linux.die.net/man/3/strcat\" rel=\"nofollow noreferrer\"><code>strcat()</code></a>. This is <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">UB</a> for two reasons</p>\n\n<ul>\n<li>You're trying to modify a string literal.</li>\n<li>You're trying to write past the allocated memory.</li>\n</ul>\n\n<p><strong>Solution:</strong> You need to define an array, with sufficient length to hold the concatenated string, and use that as the destination buffer.</p>\n\n<p>One example solution by changing the code:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#define Hyphen \" - \"\n#define ARR_SIZE 32    // define a constant as array dimention\n\nint main(void)              //correct signature\n{\n  char x[ARR_SIZE]=\"Hello\";   //define an array, and initialize with \"Hello\"\n  char* y=\"'World'\";\n\n  strcat(x, Hyphen);          // the destination has enough space\n  strcat(x, y);               // now also the destination has enough space\n\n  printf(\"%s\",x);            // no problem.\n\n  return 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 0, "last_activity_date": 1556636397, "last_edit_date": 1556636397, "creation_date": 1556635457, "answer_id": 55923427, "question_id": 55923281, "link": "https://stackoverflow.com/questions/55923281/use-strcat-function-with-char-pointer/55923427#55923427", "title": "Use strcat function with char pointer", "body": "<p>String literals are immutable in C (and C++).</p>\n\n<p>To concatenate one string to another string the last string (that is a character array) shall have enough space to accomodate the first string.</p>\n\n<p>So ons of solutions using pointers is to allocate dynamically enough memory for a  (result) character array and then concatenate the strings inside the character array.</p>\n\n<p>For example</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n\n#define Hyphen \" - \"\n\nint main( void )\n{\n    const char *x = \"Hello\";\n    const char *y = \"'World'\";\n\n    size_t n = strlen( x ) + strlen( y ) + strlen( Hyphen ) + 1;\n\n    char *s = malloc( n );\n\n    strcpy( s, x );\n    strcat( s, Hyphen );\n    strcat( s, y );\n\n    puts( s );\n\n    free( s );\n\n    return 0;\n}\n</code></pre>\n\n<p>The program output is</p>\n\n<pre><code>Hello - 'World'\n</code></pre>\n\n<p>If you want to exclude the single quotes around the string <code>\"'World'\"</code> then the code can look the following way.</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n\n#define Hyphen \" - \"\n\nint main( void )\n{\n    const char *x = \"Hello\";\n    const char *y = \"'World'\";\n\n    size_t n = strlen( x ) + ( strlen( y ) - 2 ) + strlen( Hyphen ) + 2;\n\n    char *s = malloc( n );\n\n    strcpy( s, x );\n    strcat( s, Hyphen );\n    strcat( s, y + 1 );\n\n    s[strlen( s ) - 1] = '\\0';\n    // or\n    // s[n - 2] = '\\0';\n\n    puts( s );\n\n    free( s );\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 11433128, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-sDIZZz1P0rg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reDPKnJIHoVkk66_e8IdfHVu-aSfg/mo/photo.jpg?sz=128", "display_name": "Ran Marashi", "link": "https://stackoverflow.com/users/11433128/ran-marashi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1436, "favorite_count": 0, "closed_date": 1556636380, "answer_count": 2, "score": 3, "last_activity_date": 1556636397, "creation_date": 1556635021, "last_edit_date": 1556635247, "question_id": 55923281, "link": "https://stackoverflow.com/questions/55923281/use-strcat-function-with-char-pointer", "closed_reason": "Duplicate", "title": "Use strcat function with char pointer", "body": "<p>I want to print \"Hello - World\" by using two char pointers but I\nhave a \"Segmentation fault (core dumped)\" problem. </p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#define Hyphen \" - \"\nint main()\n{\n  char* x=\"Hello\";\n  char* y=\"'World'\";\n  strcat(x, Hyphen);\n  strcat(x, y);\n  printf(\"%s\",x);\n  return 0;\n}\n</code></pre>\n"}]