[{"tags": ["c", "arrays", "multidimensional-array"], "comments": [{"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 1, "creation_date": 1524093383, "post_id": 49910347, "comment_id": 86836605, "body": "Looks like you already have a few answers <a href=\"https://stackoverflow.com/questions/49909416/making-a-2d-array-from-a-text-file\">here</a>"}, {"owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "reply_to_user": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1524094240, "post_id": 49910347, "comment_id": 86836820, "body": "@MFisherKDX isn&#180;t it different? On that case i read the matrix from a text file, on this i dont and i keep adding values to a &quot;empty&quot; matrix that keeps changing size"}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1524094575, "post_id": 49910347, "comment_id": 86836915, "body": "subtlety different, yes.  but if you understand @Pablo&#39;s <a href=\"https://stackoverflow.com/a/49910132/8767209\">accepted answer</a> then you will understand how to do what you are asking.  As it stands, this question will probably get downvoted due to lack of effort (ie: no code shown)."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524097347, "post_id": 49910347, "comment_id": 86837568, "body": "Arrays can&#39;t change size in C. You need to use dynamic allocation with <code>malloc()</code> and <code>realloc()</code>."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524169995, "post_id": 49910347, "comment_id": 86875500, "body": "If you only want to store the sparse matrix without the overhead of a full matrix, then look again at my solution in your other question. The <code>struct matrix_info *info</code> is what you need. Adding a new dimension is easy, reallocate space for one more element and store the col, row and value in the new <code>info</code> list. You are not going to solve this with pure arrays, as you cannot change the size of an array. Once you declare an array, the size remains constant."}], "owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524093100, "creation_date": 1524093100, "question_id": 49910347, "link": "https://stackoverflow.com/questions/49910347/initialize-a-2d-array-that-can-change-size-and-be-added-elements-later", "title": "Initialize a 2d array that can change size and be added elements later", "body": "<p>Im making a program to manage a sparse matrix, i can add elements, print the columns or lines, etc.</p>\n\n<p>In the beggining, i can use a text file with a matrix and go from there or start with a \"empty matrix\". Basically if the first thing i do is add a 4 to the position [3] [4] now i have a matrix with 3 rows and 4 columns with the all of the elements beings 0 except for the 4.</p>\n\n<p>So basically, the matrix can change size as i add more values, if i add something to the position [5] [5] now the matrix has 5 rows and 5 columns.</p>\n\n<p>I dont know how i do this, i know i cant initialize an array with no elements so i want to know how i do it so the array can change size.</p>\n"}, {"tags": ["c", "floating-point", "binary", "hex"], "comments": [{"owner": {"reputation": 9448, "user_id": 491907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eAa3p.png?s=128&g=1", "display_name": "pinkfloydx33", "link": "https://stackoverflow.com/users/491907/pinkfloydx33"}, "edited": false, "score": 0, "creation_date": 1524093292, "post_id": 49910345, "comment_id": 86836583, "body": "Knowing nothing about C, I&#39;m going to go out on a limb and suggest that binary literals are of integral type, since that is the binary representation of the integral portion of the number your program outputs. This means your literal is of type int, which you are then casting to float."}], "answers": [{"comments": [{"owner": {"reputation": 13335, "user_id": 8204776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e6qyq.jpg?s=128&g=1", "display_name": "meowgoesthedog", "link": "https://stackoverflow.com/users/8204776/meowgoesthedog"}, "edited": false, "score": 0, "creation_date": 1524093973, "post_id": 49910415, "comment_id": 86836740, "body": "Needs to be <code>u2f.f</code> since <code>u2f</code> is not of type <code>float</code> or <code>double</code>. This currently prints <code>0.000000</code>."}, {"owner": {"reputation": 827, "user_id": 7383242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c65444c41048c45464ae10a9cafa0c41?s=128&d=identicon&r=PG&f=1", "display_name": "medalib", "link": "https://stackoverflow.com/users/7383242/medalib"}, "reply_to_user": {"reputation": 13335, "user_id": 8204776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e6qyq.jpg?s=128&g=1", "display_name": "meowgoesthedog", "link": "https://stackoverflow.com/users/8204776/meowgoesthedog"}, "edited": false, "score": 0, "creation_date": 1524094009, "post_id": 49910415, "comment_id": 86836753, "body": "@meowgoesthedog, sorry for the mistake."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1524098318, "post_id": 49910415, "comment_id": 86837809, "body": "Good yet disregards the usual suspects that can break the functionality: size of <code>unsigned</code> vs <code>float</code> (not so rare - a bit better to use <code>uint32_t</code>), mis-matched endian (rare), variant format of <code>float</code> (not so rare), padding (unheard of w/<code>unsigned</code>)."}, {"owner": {"reputation": 827, "user_id": 7383242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c65444c41048c45464ae10a9cafa0c41?s=128&d=identicon&r=PG&f=1", "display_name": "medalib", "link": "https://stackoverflow.com/users/7383242/medalib"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524098471, "post_id": 49910415, "comment_id": 86837836, "body": "@chux yes choosing <code>uint32_t</code> would be better, but I thought of keeping it simple for the OP."}, {"owner": {"reputation": 63, "user_id": 5823186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0220026a594fa47ef899eb7d92c0398?s=128&d=identicon&r=PG&f=1", "display_name": "Dylan Holmes", "link": "https://stackoverflow.com/users/5823186/dylan-holmes"}, "edited": false, "score": 0, "creation_date": 1524110242, "post_id": 49910415, "comment_id": 86840580, "body": "Thanks for the answer.  Is there anyway to make C interpret the bits as float, or at least a simple cast to make it possible? I am assuming not otherwise that would be your answer..."}], "tags": [], "owner": {"reputation": 827, "user_id": 7383242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c65444c41048c45464ae10a9cafa0c41?s=128&d=identicon&r=PG&f=1", "display_name": "medalib", "link": "https://stackoverflow.com/users/7383242/medalib"}, "is_accepted": true, "score": 3, "last_activity_date": 1524098764, "last_edit_date": 1524098764, "creation_date": 1524093658, "answer_id": 49910415, "question_id": 49910345, "link": "https://stackoverflow.com/questions/49910345/c-provide-float-with-binary-bits-produces-the-wrong-number/49910415#49910415", "title": "C Provide float with binary bits produces the wrong number", "body": "<p>The value <code>0x41C80000</code> in hex, is an integer that has the value <code>1103626240</code> in decimal. In your code, you are casting this value to a <code>float</code> which gives you this result:</p>\n\n<pre><code>x = 1103626240.000000\n</code></pre>\n\n<p>A solution for this can be made using a <code>union</code>:</p>\n\n<pre><code>union uint_to_float {\n    unsigned int u;\n    float f;\n};\n\nunion uint_to_float u2f;\nu2f.u = 0x41C80000;\nprintf(\"x = %f\\n\", u2f.f);\n</code></pre>\n\n<p><strong>EDIT:</strong>\nAs mentioned by @chux, using <code>uint32_t</code> from <code>stdint.h</code>, instead of <code>unsigned int</code> is a better solution.</p>\n"}], "owner": {"reputation": 63, "user_id": 5823186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0220026a594fa47ef899eb7d92c0398?s=128&d=identicon&r=PG&f=1", "display_name": "Dylan Holmes", "link": "https://stackoverflow.com/users/5823186/dylan-holmes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "accepted_answer_id": 49910415, "answer_count": 1, "score": 0, "last_activity_date": 1524098764, "creation_date": 1524093052, "question_id": 49910345, "link": "https://stackoverflow.com/questions/49910345/c-provide-float-with-binary-bits-produces-the-wrong-number", "title": "C Provide float with binary bits produces the wrong number", "body": "<p>So, in C I am trying to give a floating point variable a number in binary bits (or hexadecimal digits) and then print it out, however it doesn't want to print the number I have calculated by hand or with an online converter.</p>\n\n<pre><code>float x = (float) 0b01000001110010000000000000000000;\n</code></pre>\n\n<p>or </p>\n\n<pre><code>float x = (float) 0x41C80000;\n</code></pre>\n\n<p>When printed out using</p>\n\n<pre><code>printf(\"%f\", x);\n</code></pre>\n\n<p>produces results like this:</p>\n\n<blockquote>\n  <p>1103626240.000000</p>\n</blockquote>\n\n<p>Instead of the expected 25, due to a sign bit of 0, exponent bit of 131, and a fraction of 1.5625.</p>\n\n<p>Why is this, and how can I get the results I want?</p>\n"}, {"tags": ["c", "pointers", "linked-list"], "comments": [{"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "edited": false, "score": 0, "creation_date": 1524092349, "post_id": 49910201, "comment_id": 86836316, "body": "You need a <code>remove()</code> method which implements the logic to remove a single node in the list. This must take care to reconnect the previous node to the next node in the list."}, {"owner": {"reputation": 684, "user_id": 470868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KRpk2.png?s=128&g=1", "display_name": "Engineer", "link": "https://stackoverflow.com/users/470868/engineer"}, "edited": false, "score": 0, "creation_date": 1524092791, "post_id": 49910201, "comment_id": 86836445, "body": "There is too much wrong to answer your question. How are the invalid, redirect, and page_size variables set? What is current pointer for if you never move it?  Head should never be moved since it is the start of the list. Why are you even freeing the list when you can just end the program?"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1524093470, "post_id": 49910201, "comment_id": 86836636, "body": "Please provide <a href=\"http://stackoverflow.com/help/mcve\"><b>A Minimal, Complete, and Verifiable Example (MCVE)</b></a>."}, {"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 0, "creation_date": 1524094344, "post_id": 49910201, "comment_id": 86836852, "body": "You edited the struct, but now your code doesn&#39;t compile. If you provide code that isn&#39;t identical to what you&#39;re working with (which you usually should), make sure it reproduces the same problem."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1524094651, "post_id": 49910201, "comment_id": 86836942, "body": "<a href=\"http://rextester.com/JUUBPH27071\" rel=\"nofollow noreferrer\">here</a>, take a look to a good implementation exemple ;) like linus say &quot;don&#39;t talk show me the code&quot;"}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524097448, "post_id": 49910201, "comment_id": 86837608, "body": "<code>for (int i = 0; i &lt; url_size; i++)         *(new_node-&gt;url + i) = *(url + i);</code> Now, what is this? An attemp t at strcpy()?"}, {"owner": {"reputation": 5398, "user_id": 6733064, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bbad917af60dd44536450743c01872c9?s=128&d=identicon&r=PG&f=1", "display_name": "GabrielChu", "link": "https://stackoverflow.com/users/6733064/gabrielchu"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524102660, "post_id": 49910201, "comment_id": 86838872, "body": "@wildplasser. Yeah, forget we have <code>strcpy()</code>."}], "answers": [{"tags": [], "owner": {"reputation": 27279, "user_id": 857132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4fd51ed5980999c7c6ce3729d6cb2184?s=128&d=identicon&r=PG", "display_name": "John3136", "link": "https://stackoverflow.com/users/857132/john3136"}, "is_accepted": false, "score": 2, "last_activity_date": 1524094444, "last_edit_date": 1524094444, "creation_date": 1524093572, "answer_id": 49910401, "question_id": 49910201, "link": "https://stackoverflow.com/questions/49910201/how-to-free-a-linked-list-with-pointers/49910401#49910401", "title": "How to free a linked list with pointers", "body": "<p><code>head-&gt;url = \"/\";</code></p>\n\n<p>That is not malloced data so you can't free it!</p>\n\n<p>Your other problem is in <code>url_push()</code> with <code>new_node-&gt;url = malloc(url_size);</code> which does not allocate enough space for the terminating 0 in the string (nor does it copy the terminating 0 so you end up not \"stomping on memory\" but do have unterminated strings...). Try <code>new_node-&gt;url = strdup(url);</code> instead.</p>\n\n<p>Style wise: calculate <code>url_size</code> in <code>url_push()</code> instead of making each caller call <code>strlen()</code> do it once inside the function being called (note if you use <code>strdup()</code> then you don't need the <code>url_size</code> at all.</p>\n\n<p>Final note: A tool like valgrind would find both of these problems easily.</p>\n"}, {"comments": [{"owner": {"reputation": 5398, "user_id": 6733064, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bbad917af60dd44536450743c01872c9?s=128&d=identicon&r=PG&f=1", "display_name": "GabrielChu", "link": "https://stackoverflow.com/users/6733064/gabrielchu"}, "edited": false, "score": 0, "creation_date": 1524097090, "post_id": 49910744, "comment_id": 86837513, "body": "I was just wondering does char *url = &quot;www.google.com&quot; has a terminating 0? If it has one, why cannot we use strcpy? If it doesn&#39;t have one, should we also add the 0 to url?"}, {"owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "reply_to_user": {"reputation": 5398, "user_id": 6733064, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bbad917af60dd44536450743c01872c9?s=128&d=identicon&r=PG&f=1", "display_name": "GabrielChu", "link": "https://stackoverflow.com/users/6733064/gabrielchu"}, "edited": false, "score": 0, "creation_date": 1524097128, "post_id": 49910744, "comment_id": 86837523, "body": "@GabrielChu: string literals of course have a null terminator. You can use <code>strcpy</code> if you allocate the proper size: <code>strlen(url) + 1</code>, but you can use the Posix normalized function <code>strdup()</code> that does both the allocation and the copy."}], "tags": [], "owner": {"reputation": 97126, "user_id": 4593267, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/EEyLy.jpg?s=128&g=1", "display_name": "chqrlie", "link": "https://stackoverflow.com/users/4593267/chqrlie"}, "is_accepted": true, "score": 1, "last_activity_date": 1524097534, "last_edit_date": 1524097534, "creation_date": 1524096489, "answer_id": 49910744, "question_id": 49910201, "link": "https://stackoverflow.com/questions/49910201/how-to-free-a-linked-list-with-pointers/49910744#49910744", "title": "How to free a linked list with pointers", "body": "<p>There are multiple problems in your code:</p>\n\n<ul>\n<li>you do not allocate space for the null terminator for the <code>new_node-&gt;url</code> strings in <code>url_push</code>, causing <code>strcmp()</code> too have undefined behavior.</li>\n<li>the first node is not properly constructed: its <code>url</code> pointer is not allocated.</li>\n<li>you so not check for memory allocation failure</li>\n</ul>\n\n<p>You should make <code>url_push()</code> more generic: it should handle empty lists by returning the new <code>head</code> pointer.  You do not need to pass the length of the <code>url</code> string, just use <code>strdup()</code>, and you should avoid allocating a new node before checking for duplicates.</p>\n\n<p>Here is a modified version:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nstruct Node {\n    char *url;\n    struct Node *next;\n};\n\nstruct Node *url_push(struct Node *head, const char *url) {\n\n    struct Node *current = head;\n    if (current != NULL) {\n        for (;;) {\n            if (strcmp(current-&gt;url, url) == 0) {\n                printf(\"Seen page %s before!!!!!\\n\", url);\n                return head;\n            } else if (current-&gt;next == NULL) {\n                break;\n            } else {\n                current = current-&gt;next;\n            }\n        }\n    }\n    struct Node *new_node = malloc(sizeof(struct Node));\n\n    if (new_node == NULL || (new_node-&gt;url = strdup(url)) == NULL) {\n        fprintf(stderr, \"memory allocation failure\\n\");\n        exit(1);\n    }\n    new_node-&gt;next = NULL;\n\n    if (current == NULL) {\n        head = new_node;\n    } else {\n        current-&gt;next = new_node;\n    }\n    return head;\n}\n\nint main() {\n    struct Node *head = NULL;\n\n    head = url_push(head, \"/\");\n    head = url_push(head, \"www.google.com\");\n    head = url_push(head, \"www.yahoo.com\");\n    head = url_push(head, \"www.google.com\");\n    head = url_push(head, \"www.wsj.com\");\n\n    while (head != NULL) {\n        printf(\"url: %s\\n\", head-&gt;url);\n        struct Node *current = head;\n        head = head-&gt;next;\n        free(current-&gt;url);\n        free(current);\n    }\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 5398, "user_id": 6733064, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bbad917af60dd44536450743c01872c9?s=128&d=identicon&r=PG&f=1", "display_name": "GabrielChu", "link": "https://stackoverflow.com/users/6733064/gabrielchu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 0, "accepted_answer_id": 49910744, "answer_count": 2, "score": 1, "last_activity_date": 1524097534, "creation_date": 1524092080, "last_edit_date": 1524096499, "question_id": 49910201, "link": "https://stackoverflow.com/questions/49910201/how-to-free-a-linked-list-with-pointers", "title": "How to free a linked list with pointers", "body": "<p>I was trying to free memory for a linked list iteratively. The list has a struct which looks like this, and in this linked list, I don't add a url if it's in this list.</p>\n\n<pre><code>struct Node {\n    char *url;\n    struct Node *next;\n};\n</code></pre>\n\n<p>Once done working with this linked list, I tried to free it, but got segmentation fault, I'm still in the way of learning <code>c</code>, I haven't got much clue of how to debugging such error other than directly searching for related topics. Referenced a few SOs <a href=\"https://stackoverflow.com/questions/33113510/free-memory-from-linked-list-in-c\">this one</a>, <a href=\"https://stackoverflow.com/questions/6417158/c-how-to-free-nodes-in-the-linked-list\">this one</a>  and <a href=\"https://stackoverflow.com/questions/4915369/how-to-free-a-struct-that-contains-only-pointers\">this one</a>, still cannot figure out where it got crashed.</p>\n\n<p>Here's my code. Free feel to add comments if you think anything I missed in this implementation.</p>\n\n<pre><code>void url_push(struct Node *head, const char *url, size_t url_size) {\n    struct Node *new_node = (struct Node *) malloc(sizeof(struct Node));\n\n    new_node-&gt;url = malloc(url_size);\n    new_node-&gt;next = NULL;\n\n    for (int i = 0; i &lt; url_size; i++)\n        *(new_node-&gt;url + i) = *(url + i);\n\n    struct Node *current = head;\n    while(1) {\n        if (strcmp(current-&gt;url, new_node-&gt;url) == 0) {\n            printf(\"Seen page %s!!!!!\\n\", new_node-&gt;url);\n            free(new_node);\n            break;\n        } else if (current-&gt;next == NULL) {\n\n            current-&gt;next = new_node;\n            break;\n        } else {\n            current = current-&gt;next;\n        }\n    }\n}\n\nint main() {\n    struct Node *head = (struct Node*)malloc(sizeof(struct Node));\n    head-&gt;url = \"/\";\n    head-&gt;next = NULL;\n\n    char *url = \"www.google.com\";\n    url_push(head, url, strlen(url));\n\n    url = \"www.yahoo.com\";\n    url_push(head, url, strlen(url));\n\n    url = \"www.google.com\";\n    url_push(head, url, strlen(url));\n\n    url = \"www.wsj.com\";\n    url_push(head, url, strlen(url));\n\n    struct Node *current = NULL;\n\n    while ((current = head) != NULL) {\n        printf(\"url: %s\\n\", head-&gt;url);\n\n        head = head-&gt;next;\n        free(current-&gt;url);\n        free(current);\n    }\n}\n</code></pre>\n\n<p><strong>Edited:</strong>\nTo reduce the confusions, I revised the struct. The purpose of using <code>strcmp</code> is to avoid adding a url that already seen.</p>\n"}, {"tags": ["c", "assembly", "x86", "sse", "fpu"], "comments": [{"owner": {"reputation": 15898, "user_id": 1155000, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8213d9cd920e864ce8ff1fdeefe4db5?s=128&d=identicon&r=PG", "display_name": "Daniel Kamil Kozar", "link": "https://stackoverflow.com/users/1155000/daniel-kamil-kozar"}, "edited": false, "score": 0, "creation_date": 1524092533, "post_id": 49910057, "comment_id": 86836366, "body": "Just out of curiosity : why are you using x87 instuctions when you&#39;ve got arrays of floats as your input parameters? These are much better suited to SIMD operations. Are you sure that you don&#39;t want to use SSE/AVX instructions (in this case, <code>DIVPS</code> comes to mind) instead?"}, {"owner": {"reputation": 21, "user_id": 9666780, "user_type": "registered", "profile_image": "https://graph.facebook.com/1772640186085063/picture?type=large", "display_name": "\u0141ukasz Stawikowski", "link": "https://stackoverflow.com/users/9666780/%c5%81ukasz-stawikowski"}, "reply_to_user": {"reputation": 15898, "user_id": 1155000, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8213d9cd920e864ce8ff1fdeefe4db5?s=128&d=identicon&r=PG", "display_name": "Daniel Kamil Kozar", "link": "https://stackoverflow.com/users/1155000/daniel-kamil-kozar"}, "edited": false, "score": 0, "creation_date": 1524093550, "post_id": 49910057, "comment_id": 86836656, "body": "@DanielKamilKozar i&#39;m actually doing both, measuring execution time for both SIMD/SISD and then comparing them, that&#39;s my uni assignment actually (not sure if it&#39;s allowed here, though i&#39;m not asking directly for the whole thing)"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1524094046, "post_id": 49910057, "comment_id": 86836763, "body": "You can ask whatever you want as long as it&#39;s interesting / worth answering / might be useful to future readers.  <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>.  It&#39;s up to you to deal with the ethics of getting help for your homework.  See also <a href=\"//meta.stackoverflow.com/q/334822\">How do I ask and answer homework questions?</a>."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524094482, "post_id": 49910057, "comment_id": 86836885, "body": "Did you actually have to use x87 for scalar?  <code>divss %xmm0, %xmm1</code> does scalar single-precision division on the low element, leaving the rest unmodified.  You can use vector shuffles instead of loading/storing 4 elements separately, but make sure to unpack to separate registers and shuffle back together so you don&#39;t create serial dependencies between separate <code>divss</code> instructions for the same vector.  And BTW, on Haswell/Skylake <code>divss</code> and 128-bit <code>divps</code> have the same high throughput, better than <code>fdiv</code>.  But 256-bit <code>vdivps ymm</code> has worse throughput.  <a href=\"http://agner.org/optimize/\" rel=\"nofollow noreferrer\">agner.org/optimize</a>"}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1524094803, "post_id": 49910057, "comment_id": 86836975, "body": "Works for me with optimization enabled; <a href=\"https://godbolt.org/g/HsijVm\" rel=\"nofollow noreferrer\">godbolt.org/g/HsijVm</a>; probably without optimization gcc ran out of registers trying to use a different pointer register for each addressing mode.  You wouldn&#39;t have this problem if you split it into separate asm statements for each operation (e.g. in a simple wrapper function), or if you wrote the whole loop in asm yourself instead of using inline asm for the loop body by making the compiler generate the loop control instructions."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524095096, "post_id": 49910057, "comment_id": 86837052, "body": "I knew I&#39;d seen this before, turns out it was me that wrote the answer showing the with/without optimization code-gen / register-use choices by gcc in the duplicate I found with lots of <code>&quot;m&quot;</code> operands not compiling without optimization :P"}], "owner": {"reputation": 21, "user_id": 9666780, "user_type": "registered", "profile_image": "https://graph.facebook.com/1772640186085063/picture?type=large", "display_name": "\u0141ukasz Stawikowski", "link": "https://stackoverflow.com/users/9666780/%c5%81ukasz-stawikowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "closed_date": 1524095040, "answer_count": 0, "score": 2, "last_activity_date": 1524091915, "creation_date": 1524091166, "last_edit_date": 1524091915, "question_id": 49910057, "link": "https://stackoverflow.com/questions/49910057/extended-assembly-floating-point-division", "closed_reason": "Duplicate", "title": "Extended assembly, floating point division", "body": "<p>I'm trying to use extended assembly to divide an array of 32bit floats located in a 4float vector structure. </p>\n\n<p>This is the compiler error:</p>\n\n<p>sisd.c: In function \u2018divSISD\u2019:</p>\n\n<pre><code>sisd.c:182:9: error: \u2018asm\u2019 operand has impossible constraints\n     asm(\n     ^~~\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>void divSISD(Vector4f* vecA, Vector4f* vecB, Vector4f* result, int size){\n\n\n   for(int i = 0; i &lt; size; i++){\n\n    asm( \n\n        \"fld %4\\n\\t\"\n        \"fdiv %5\\n\\t\"\n        \"fstp %0\\n\\t\"\n\n        \"fld %6\\n\\t\"\n        \"fdiv %7\\n\\t\"\n        \"fstp %1\\n\\t\"\n\n        \"fld %8\\n\\t\"\n        \"fdiv %9\\n\\t\"\n        \"fstp %2\\n\\t\"\n\n        \"fld %10\\n\\t\"\n        \"fdiv %11\\n\\t\"\n        \"fstp %3\\n\\t\"\n\n:       \"=m\" (result[i].a), \n        \"=m\" (result[i].b), \n        \"=m\" (result[i].c),\n        \"=m\" (result[i].d)  \n:       \"m\" (vecA[i].a), \"m\" (vecB[i].a), \n        \"m\" (vecA[i].b), \"m\" (vecB[i].b), \n        \"m\" (vecA[i].c), \"m\" (vecB[i].c), \n        \"m\" (vecA[i].d), \"m\" (vecB[i].d) \n\n);\n}\n}\n</code></pre>\n\n<p>This appears to work fine if I use the non pointer struct type, like this:</p>\n\n<pre><code>void divSISD(Vector4f vecA, Vector4f vecB, Vector4f result, int size){\n    asm( \n\n        \"fld %4\\n\\t\"\n        \"fdiv %5\\n\\t\"\n        \"fstp %0\\n\\t\"\n\n        \"fld %6\\n\\t\"\n        \"fdiv %7\\n\\t\"\n        \"fstp %1\\n\\t\"\n\n        \"fld %8\\n\\t\"\n        \"fdiv %9\\n\\t\"\n        \"fstp %2\\n\\t\"\n\n        \"fld %10\\n\\t\"\n        \"fdiv %11\\n\\t\"\n        \"fstp %3\\n\\t\"\n\n\n :      \"=m\" (result.a), \n        \"=m\" (result.b), \n        \"=m\" (result.c),\n        \"=m\" (result.d)  \n :      \"m\" (vecA.a), \"m\" (vecB.a), \n        \"m\" (vecA.b), \"m\" (vecB.b), \n        \"m\" (vecA.c), \"m\" (vecB.c), \n        \"m\" (vecA.d), \"m\" (vecB.d) \n\n        );\n}\n</code></pre>\n\n<p>I can't understand why this wouldn't work as the \"m\" constraint should apply to both of the situations.</p>\n"}, {"tags": ["c", "arrays", "list", "dynamic", "allocation"], "comments": [{"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 2, "creation_date": 1524093430, "post_id": 49909934, "comment_id": 86836617, "body": "Once you declare an array with a dimension, you cannot change it anymore. If you need to do that, then you need to dynamically allocate memory using <code>malloc</code>/<code>calloc</code> and resize the memory with <code>realloc</code>."}, {"owner": {"reputation": 119882, "user_id": 3545273, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RDWxl.png?s=128&g=1", "display_name": "Serge Ballesta", "link": "https://stackoverflow.com/users/3545273/serge-ballesta"}, "edited": false, "score": 0, "creation_date": 1524127431, "post_id": 49909934, "comment_id": 86848455, "body": "Beware, strings are not first class objects in C: the are just null terminated char arrays. So <code>array[0] = &quot;Word&quot;;</code> is almost always wrong... The idiomatic way for a resizeable string array is <code>char **array = malloc(N * sizeof(char *)); array[0] = strdup(&quot;Word&quot;); ...</code>. But then you must not forget to free all those allocated strings!"}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 4355433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd7579e982ead7d2a818dfc5e8a502f?s=128&d=identicon&r=PG&f=1", "display_name": "JR87", "link": "https://stackoverflow.com/users/4355433/jr87"}, "edited": false, "score": 0, "creation_date": 1524147154, "post_id": 49916205, "comment_id": 86862238, "body": "Yeah, it was a first pass, I also don&#39;t professionally use C so it&#39;s sloppy at best. I&#39;m essentially trying to create a hash table. I did find a useful article that I think is also a possibility that I&#39;m reading: <a href=\"https://www.tutorialspoint.com/data_structures_algorithms/hash_table_program_in_c.htm\" rel=\"nofollow noreferrer\">tutorialspoint.com/data_structures_algorithms/&hellip;</a> it seems fairly similar to what you suggest; I&#39;m going to do some more reading on memory allocation. I&#39;m building a compiler for a graduate school project, and wanted to learn more about C. I&#39;ve got it working for the simple implementation. I&#39;ll read some more on malloc and realloc. Thank you"}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "reply_to_user": {"reputation": 95, "user_id": 4355433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd7579e982ead7d2a818dfc5e8a502f?s=128&d=identicon&r=PG&f=1", "display_name": "JR87", "link": "https://stackoverflow.com/users/4355433/jr87"}, "edited": false, "score": 0, "creation_date": 1524164531, "post_id": 49916205, "comment_id": 86872762, "body": "@JohnRinderer my personal expierience with tutorialspoint was that it is a horrible source for learning, because somethings were really harmful. Maybe that changed I don&#39;t know but I think there are better sources out there."}], "tags": [], "owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "is_accepted": true, "score": 2, "last_activity_date": 1524126320, "creation_date": 1524126320, "answer_id": 49916205, "question_id": 49909934, "link": "https://stackoverflow.com/questions/49909934/realloaction-of-memory-in-c-arrays/49916205#49916205", "title": "Realloaction of memory in C - Arrays", "body": "<p>Okay generally what you want to do is not possible with arrays. Your code is really hard to understand but I will try to give you an example on how it is done.</p>\n\n<p>This is not directly what you want, but should help you find your own solution. If you want to work with strings it gets a bit more complicated because strings are arrays in itself so you have to make sure that you always have enough memory for your current string available.</p>\n\n<pre><code>#include  &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\ntypedef struct data_container_{\n    int *mem;\n    int size;\n} data_container;\n\nvoid add_to_memory(data_container *data, int pos, int value)\n{\n    if (pos+1 &gt; data-&gt;size) //check if memory for this position is allocated\n    {\n        int *dummy = realloc(data-&gt;mem, pos+1); // call realloc to get more memory\n        if(dummy == NULL) //check if reallocation was succesful\n        {\n            puts(\"Memory reallocation failed\");\n            exit(1); //terminate program\n        }\n        else\n        {\n            data-&gt;size = pos+1; //set size to the newly allocated size\n            data-&gt;mem = dummy; //if succesful point to the new memory location\n        }\n    }\n\n    data-&gt;mem[pos] = value;\n\n}\n\nint main(void)\n{\n    data_container data; // create stuct\n\n    data.size = 2;\n    data.mem = malloc(sizeof (int) * data.size); //allocate memory, similar to an array but dynamic\n\n    if(data.mem == NULL) //check if allocation was succesful\n    {\n        puts(\"Memory allocation failed\");\n        exit(1); //terminate program\n    }\n\n    add_to_memory(&amp;data, 0, 3); //pass the address of the struct\n    add_to_memory(&amp;data, 1, 6);\n    add_to_memory(&amp;data, 2, 8); //now it uses realloc, pos would be out of the allocated range\n\n    for(int i =0; i&lt;data.size; i++)\n    {\n        printf(\"%d\\n\",data.mem[i]); //a pointer can be accessed similar to an array\n    }\n\n    free(data.mem); //free the allocated memory\n\n}\n</code></pre>\n\n<p>as Pablo said you should read about <code>malloc</code> and <code>realloc</code> especially you should keep in mind that the memory allocated is not initialized. <code>calloc</code> initializes with <code>0</code>. </p>\n\n<p>And always remember to free allocated space when it is not used anymore.</p>\n"}], "owner": {"reputation": 95, "user_id": 4355433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd7579e982ead7d2a818dfc5e8a502f?s=128&d=identicon&r=PG&f=1", "display_name": "JR87", "link": "https://stackoverflow.com/users/4355433/jr87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 49916205, "answer_count": 1, "score": 0, "last_activity_date": 1524126320, "creation_date": 1524090452, "question_id": 49909934, "link": "https://stackoverflow.com/questions/49909934/realloaction-of-memory-in-c-arrays", "title": "Realloaction of memory in C - Arrays", "body": "<p>I'm starting with an array array[0] let's say.</p>\n\n<p>As I loop through a text file and find keywords I'd like to store those words in that array.</p>\n\n<p>So the first run though I'd assing the first keyword very simply</p>\n\n<p>array[0] = \"Word\"</p>\n\n<p>However I'm not sure how to increment that array to 1, and 2, etc.</p>\n\n<p>I've read a few posts on memory allocaiton but that seemed to be specific to strings; perhaps I'm misunderstanding the concept.</p>\n\n<p>I'd like to preserve the current array's contents, and increment it.</p>\n\n<p>I've rigged it by setting my array[10], but I'd prefer to learn the correct way to do this.</p>\n\n<p>I've included the code below so far (without any memory allocation)</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;memory.h&gt;\n#include \"tables.h\"\n\n\nint main() {\n\n    insertVarbleTble(\"Name\",\"CSTRING\",1,0,\"\");\n\n    return 0;\n}\n\nint insertVarbleTble(char *ident, char *type, int local, int constVar, char *constVal){\n    int successful;\n    int sizeArry;\n\n    sizeArry = sizeof(varible)/ sizeof(varible[0]);\n\n    if(sizeArry &lt;= 0){\n        varible[sizeArry]== ident;\n    }else{\n        successful = (searchVarbleTble(ident,sizeArry)==1;\n    }\n\n    if(successful ==0){\n        varible[sizeArry+1]==ident;\n    }else{\n        printf(\"Already exists\");\n    }\n}\n\nvoid realocMem(int size){\n    varible[size];\n}\n\nint searchVarbleTble(char * ident, int arrySize){\n    int i;\n    int results = 0;\n\n    for(i=0;i&lt;arrySize;i++){\n        if(!strcmp(varible[i],ident)){\n            results= 1;\n        }\n    }\n    return results;\n}\n</code></pre>\n\n<p>Header file contains the array I'm using they are:</p>\n\n<pre><code>char varible[0];\nint insertVarbleTble(char *, char *, int, int , char *);\nint searchVarbleTble(char *, int);\n</code></pre>\n\n<p>Would a potential solution be to first count the number of keywords that exist, and then dimension the array?</p>\n"}, {"tags": ["c", "c99"], "comments": [{"owner": {"reputation": 9215, "user_id": 5212827, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7e9f9b0d7e2d571c9f8886dd54bd50f9?s=128&d=identicon&r=PG&f=1", "display_name": "DeiDei", "link": "https://stackoverflow.com/users/5212827/deidei"}, "edited": false, "score": 3, "creation_date": 1524090001, "post_id": 49909801, "comment_id": 86835637, "body": "Short answer: Perfectly safe."}, {"owner": {"reputation": 29701, "user_id": 558639, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3f4a1073df397d894cf3ae596988b687?s=128&d=identicon&r=PG", "display_name": "fearless_fool", "link": "https://stackoverflow.com/users/558639/fearless-fool"}, "reply_to_user": {"reputation": 9215, "user_id": 5212827, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7e9f9b0d7e2d571c9f8886dd54bd50f9?s=128&d=identicon&r=PG&f=1", "display_name": "DeiDei", "link": "https://stackoverflow.com/users/5212827/deidei"}, "edited": false, "score": 0, "creation_date": 1524090377, "post_id": 49909801, "comment_id": 86835762, "body": "Does this mean the copy into <code>b</code> happens before the <code>calibrate()</code> frame is unlinked?"}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 3, "creation_date": 1524090474, "post_id": 49909801, "comment_id": 86835790, "body": "@fearless_fool: Not necessarily &quot;into <code>b</code>&quot;; a dumb non-optimizing compiler would arrange to have it stored in a temp location on the caller&#39;s stack frame for the return, then copy it into <code>b</code> for the assignment. But yes, putting it in storage whose lifetime is controlled by the caller has to happen before the callee&#39;s stack frame lifetime ends."}, {"owner": {"reputation": 9215, "user_id": 5212827, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7e9f9b0d7e2d571c9f8886dd54bd50f9?s=128&d=identicon&r=PG&f=1", "display_name": "DeiDei", "link": "https://stackoverflow.com/users/5212827/deidei"}, "edited": false, "score": 0, "creation_date": 1524090589, "post_id": 49909801, "comment_id": 86835840, "body": "Best way to know for sure on your platform is to inspect the produced assembly. But in the general case you shouldn&#39;t be thinking about this as the compiler will do the best possible job."}, {"owner": {"reputation": 29701, "user_id": 558639, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3f4a1073df397d894cf3ae596988b687?s=128&d=identicon&r=PG", "display_name": "fearless_fool", "link": "https://stackoverflow.com/users/558639/fearless-fool"}, "edited": false, "score": 0, "creation_date": 1524090678, "post_id": 49909801, "comment_id": 86835870, "body": "Meh!  :)  I&#39;ll stick to passing pointers from caller-allocated memory into the callee -- this new-fangled pass-by-value stuff is weird.  And kids, get off my lawn!"}, {"owner": {"reputation": 8834, "user_id": 4696802, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/AkVoc.jpg?s=128&g=1", "display_name": "Zebrafish", "link": "https://stackoverflow.com/users/4696802/zebrafish"}, "edited": false, "score": 1, "creation_date": 1524091133, "post_id": 49909801, "comment_id": 86836003, "body": "Is returning a struct by value something unidiomatic for C? I&#39;m used to C++ and wouldn&#39;t think to question whether it was safe to return by value."}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "reply_to_user": {"reputation": 8834, "user_id": 4696802, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/AkVoc.jpg?s=128&g=1", "display_name": "Zebrafish", "link": "https://stackoverflow.com/users/4696802/zebrafish"}, "edited": false, "score": 1, "creation_date": 1524091744, "post_id": 49909801, "comment_id": 86836155, "body": "@Zebrafish: It&#39;s unidiomatic for C, and only idiomatic for C++ because modern C++ puts everything in header files &amp; templates where it gets expanded out in the caller and has &quot;no cost&quot; (except making your program 100x the size it should be and blowing away the icache)."}, {"owner": {"reputation": 8834, "user_id": 4696802, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/AkVoc.jpg?s=128&g=1", "display_name": "Zebrafish", "link": "https://stackoverflow.com/users/4696802/zebrafish"}, "reply_to_user": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1524092269, "post_id": 49909801, "comment_id": 86836289, "body": "@R.. That&#39;s strange, every recommendation I&#39;ve heard in C++ is to strictly keep definition in header and implementation in cpp unless it&#39;s a template, and only because of necessity."}, {"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 1, "creation_date": 1524092404, "post_id": 49909801, "comment_id": 86836339, "body": "@fearless_fool Based on the ABI (<a href=\"https://www.uclibc.org/docs/psABI-x86_64.pdf\" rel=\"nofollow noreferrer\">SysV ABI on amd64</a> is this way, for example; I don&#39;t know about others), that&#39;s exactly what pass-by-value does. Except that in this case the struct is small enough <a href=\"https://godbolt.org/g/WVuT54\" rel=\"nofollow noreferrer\">it will instead get returned by register</a>, which you can&#39;t do if you pass by pointer instead."}, {"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "reply_to_user": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1524093266, "post_id": 49909801, "comment_id": 86836576, "body": "@R.. That&#39;s not how template instantiation works. Instantiations with the same parameters are merged during linking so don&#39;t contribute to executable size. For the case where the same code is generated for two distinct template parameters, <a href=\"https://stackoverflow.com/q/15168924/27302\">some linkers can now combine those functions too</a>. I&#39;m sure C++ templates do lead to some amount of executable size bloat, but I&#39;m rather suspicious of the 100x figure (and especially suspicious that it matters in tight loops where icache is most relevant)."}, {"owner": {"reputation": 29701, "user_id": 558639, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3f4a1073df397d894cf3ae596988b687?s=128&d=identicon&r=PG", "display_name": "fearless_fool", "link": "https://stackoverflow.com/users/558639/fearless-fool"}, "reply_to_user": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 0, "creation_date": 1524094562, "post_id": 49909801, "comment_id": 86836911, "body": "@DanielH: Thanks for the amd64 ABI: Just as you said: <i>If the type has class MEMORY, then the caller provides space for the return value and passes the address of this storage in %rdi as if it were the first argument to the function. In effect, this address becomes a \u201chidden\u201d first argument.</i>  That totally explains it -- thank you."}, {"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 1, "creation_date": 1524095648, "post_id": 49909801, "comment_id": 86837170, "body": "@fearless_fool Yes, for larger structs. Your particular example struct is only one eightbyte and gets the type INTEGER and is returned entirely in <code>%rax</code>, though. Which is both entirely safe and faster than passing a hidden pointer."}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1524190985, "post_id": 49909801, "comment_id": 86881646, "body": "This was also correct in C89; nothing changed in this area in C99"}, {"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "reply_to_user": {"reputation": 8834, "user_id": 4696802, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/AkVoc.jpg?s=128&g=1", "display_name": "Zebrafish", "link": "https://stackoverflow.com/users/4696802/zebrafish"}, "edited": false, "score": 0, "creation_date": 1524191265, "post_id": 49909801, "comment_id": 86881714, "body": "@Zebrafish K&amp;R C didn&#39;t have passing/returning structs by value , and it seems that a large sector of the community learned from K&amp;R and did not refresh their knowledge when C89 came out (let alone later standards)"}], "answers": [{"comments": [{"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 2, "creation_date": 1524090348, "post_id": 49909868, "comment_id": 86835750, "body": "Normally the ABI for returning structures by value requires the caller to pass a hidden argument that&#39;s a pointer to where to store the return value. (Fundamentally, there&#39;s not really any other reasonable way to return an unbounded amount of data.) As such, it doesn&#39;t necessarily involve a lot of copying; a decent compiler can create the struct in-place where the caller expects to receive it, and pass the same storage pointer through multiple levels of calls if needed."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 0, "creation_date": 1524090433, "post_id": 49909868, "comment_id": 86835782, "body": "@R.. <code>if (x) { return struct1; } else { return struct2; }</code>. How can that allocate the structure in the caller&#39;s data?"}, {"owner": {"reputation": 194515, "user_id": 379897, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/73c5967cf90e62b10d34b1d2d0ad3aae?s=128&d=identicon&r=PG", "display_name": "R.. GitHub STOP HELPING ICE", "link": "https://stackoverflow.com/users/379897/r-github-stop-helping-ice"}, "edited": false, "score": 2, "creation_date": 1524090814, "post_id": 49909868, "comment_id": 86835918, "body": "It could arbitrarily (or based on analysis of relative cost of a copy in each code path) decide to build one of the two in-place in the caller&#39;s provided storage, and only copy in the other code path. It could hoist operations so that rather than the returns being conditional, the stores into individual members leading up to the returns are conditional. Etc. etc."}, {"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 0, "creation_date": 1524091565, "post_id": 49909868, "comment_id": 86836106, "body": "@Barmar Or it could fail to optimize in that case, but in a lot of cases (including the one in the question) that&#39;s possible."}], "tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": true, "score": 10, "last_activity_date": 1524153005, "last_edit_date": 1524153005, "creation_date": 1524090077, "answer_id": 49909868, "question_id": 49909801, "link": "https://stackoverflow.com/questions/49909801/is-it-safe-to-return-a-stack-allocated-structure-by-value/49909868#49909868", "title": "Is it safe to return a stack-allocated structure by value?", "body": "<p>Yes, it's perfectly safe. When you return by value it copies the members of the structure into the caller's structure. As long as the structure doesn't contain any pointers to local objects, it's valid.</p>\n\n<p>Returning structures tends to be uncommon, because if they're large it requires lots of copying. But sometimes we put arrays into structures to allow them to be passed and returned by value (arrays normally decay to pointers when used as parameters or return values) like other data types.</p>\n\n<h3>addendum by original asker</h3>\n\n<p>(I trust @Barmar won't mind...)</p>\n\n<p>As @DanielH pointed out, in the case of <a href=\"https://www.uclibc.org/docs/psABI-x86_64.pdf\" rel=\"noreferrer\">SysV ABI for amd64</a>, the compiler will make provisions for returning the struct by value.  If it's small, the entire struct can be returned in a register (read: fast).  If it's larger, the compiler allocates room in the caller's stack frame and passes a pointer to the callee.  The callee then copies the value of the struct into that upon return.  From the doc:</p>\n\n<blockquote>\n  <p>If the type has class MEMORY, then the caller provides space for the\n  return value and passes the address of this storage in %rdi as if it\n  were the first argument to the function. In effect, this address\n  becomes a \u201chidden\u201d first argument.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 129565, "user_id": 1505939, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/131c67ef492a8d8352c6cf642a52e20f?s=128&d=identicon&r=PG", "display_name": "M.M", "link": "https://stackoverflow.com/users/1505939/m-m"}, "edited": false, "score": 0, "creation_date": 1524191122, "post_id": 49909871, "comment_id": 86881687, "body": "It&#39;s correct no matter what the types are of the struct members"}], "tags": [], "owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "is_accepted": false, "score": 1, "last_activity_date": 1524090513, "last_edit_date": 1524090513, "creation_date": 1524090107, "answer_id": 49909871, "question_id": 49909801, "link": "https://stackoverflow.com/questions/49909801/is-it-safe-to-return-a-stack-allocated-structure-by-value/49909871#49909871", "title": "Is it safe to return a stack-allocated structure by value?", "body": "<pre><code>b = calibrate();\n// do stuff with b\n</code></pre>\n\n<p>is well behaved.</p>\n\n<p><code>boundaries_t</code> contains only integral types as members. Passing it by value and using the object it is assigned to in the function call is perfectly safe.</p>\n"}, {"tags": [], "owner": {"reputation": 656, "user_id": 9592917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fe6504c31f4954495f952699592361a?s=128&d=identicon&r=PG&f=1", "display_name": "Bwebb", "link": "https://stackoverflow.com/users/9592917/bwebb"}, "is_accepted": false, "score": 0, "last_activity_date": 1524090744, "creation_date": 1524090744, "answer_id": 49909985, "question_id": 49909801, "link": "https://stackoverflow.com/questions/49909801/is-it-safe-to-return-a-stack-allocated-structure-by-value/49909985#49909985", "title": "Is it safe to return a stack-allocated structure by value?", "body": "<p>I dont have a link to a C99 reference, but what caught my eye was the struct assignment.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/2302351/assign-one-struct-to-another-in-c\">Assign one struct to another in C</a></p>\n\n<p>It's basically Barmar's response.</p>\n"}], "owner": {"reputation": 29701, "user_id": 558639, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3f4a1073df397d894cf3ae596988b687?s=128&d=identicon&r=PG", "display_name": "fearless_fool", "link": "https://stackoverflow.com/users/558639/fearless-fool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "accepted_answer_id": 49909868, "answer_count": 3, "score": 10, "last_activity_date": 1524190096, "creation_date": 1524089686, "last_edit_date": 1524190096, "question_id": 49909801, "link": "https://stackoverflow.com/questions/49909801/is-it-safe-to-return-a-stack-allocated-structure-by-value", "title": "Is it safe to return a stack-allocated structure by value?", "body": "<p><em>[Note: This is reposted from <a href=\"https://softwareengineering.stackexchange.com/q/369604/126197\">https://softwareengineering.stackexchange.com/q/369604/126197</a>, where for some reason this question got immediately downvoted.  Twice.  Clearly there's more love over here!]</em></p>\n\n<p>Here's a bit of code paraphrased from a vendor's example.</p>\n\n<p>I've looked for authoritative documentation on passing stack-allocated structures by value, but haven't found the definitive word.  In a nutshell: Does C99 guarantee this to be safe?</p>\n\n<pre><code>typedef struct {\n    int32_t upper;\n    int32_t lower;\n} boundaries_t;\n\nstatic boundaries_t calibrate() {\n    boundaries_t boundaries;         // struct allocated on stack\n\n    boundaries.upper = getUpper();\n    boundaries.lower = getLower();\n    return boundaries;               // return struct by value\n}\n\nint main() {\n    boundaries_t b;\n\n    b = calibrate();\n    // do stuff with b\n    ...\n}\n</code></pre>\n\n<p>Note that <code>calibrate()</code> allocates the <code>boundaries</code> struct on the stack and then returns it by value.</p>\n\n<p>If the compiler can guarantee that the stack frame for <code>calibrate()</code> will be intact at the time of the assignment to <code>b</code>, then all is well.  Perhaps that's part of the contract in C99's pass-by-value?</p>\n\n<p><em>(Context: my world is embedded systems where pass-by-value is rarely seen.  I do know that returning a pointer from a stack-allocated structure is a recipe for disaster, but this pass-by-value stuff feels alien.)</em></p>\n"}, {"tags": ["c", "multidimensional-array", "text-files"], "comments": [{"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 1, "creation_date": 1524087829, "post_id": 49909416, "comment_id": 86834850, "body": "When you say you don&#39;t know the size, does that only applies to the rows or does it apply to the columns as well?"}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524087879, "post_id": 49909416, "comment_id": 86834869, "body": "1)allocate enough for 10000 elements 2) read the file 3) realloc to a smaller size."}, {"owner": {"reputation": 2254, "user_id": 166855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46f2c33fcee6302dd9e71ccf3d2e935?s=128&d=identicon&r=PG", "display_name": "David Harris", "link": "https://stackoverflow.com/users/166855/david-harris"}, "edited": false, "score": 0, "creation_date": 1524088001, "post_id": 49909416, "comment_id": 86834922, "body": "What do the individual lines mean. Also is the matrix square? Once you have the answer to these questions how would you start to solve the problem?"}, {"owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "edited": false, "score": 0, "creation_date": 1524088038, "post_id": 49909416, "comment_id": 86834932, "body": "Pablo i dont know the number of rows or comuns, so i cant declare values for both of them at the at the start of my code"}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524088152, "post_id": 49909416, "comment_id": 86834970, "body": "Ok, so you don&#39;t know the number of columns either. Do all rows have the same number of rows?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7853410"}, "edited": false, "score": 0, "creation_date": 1524088168, "post_id": 49909416, "comment_id": 86834980, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/15588800/reading-matrix-from-a-text-file-to-2d-integer-array-c\">Reading matrix from a text file to 2D integer array C++</a>"}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524088275, "post_id": 49909416, "comment_id": 86835038, "body": "@xorz57 this is a C question, a C++ answer is not a possible duplicate."}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 0, "creation_date": 1524088345, "post_id": 49909416, "comment_id": 86835065, "body": "read the file, figure out the size, then <code>fseek</code> back to the beginning of the file, and store the data."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7853410"}, "reply_to_user": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524088415, "post_id": 49909416, "comment_id": 86835088, "body": "@Pablo The concept is the same."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7853410"}, "reply_to_user": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524088526, "post_id": 49909416, "comment_id": 86835131, "body": "@Pablo He could use <code>strtok</code> for the tokens."}, {"owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "edited": false, "score": 0, "creation_date": 1524088649, "post_id": 49909416, "comment_id": 86835174, "body": "Im so sorry but my teacher clarified everything just now... it turns out that, for each line, the first number is the row, the second the column and the third the element.with the example i have above, 1.2 has to go in the position [0] [3]. The matrix does not have to be square"}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524088735, "post_id": 49909416, "comment_id": 86835205, "body": "That&#39;s a completely different problem. Please edit your question with this clarification."}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1524088737, "post_id": 49909416, "comment_id": 86835206, "body": "If this is truly the contents of your file, then you don&#39;t have enough information. In this case above your matrix could be 6x6, 10x6, 100x100, etc. All of these are different."}, {"owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "edited": false, "score": 0, "creation_date": 1524089821, "post_id": 49909416, "comment_id": 86835575, "body": "I edited to clarify the changes, its a little diferent from what i was asking in the first question"}, {"owner": {"reputation": 2446, "user_id": 1532454, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aNEeA.jpg?s=128&g=1", "display_name": "Jeff Learman", "link": "https://stackoverflow.com/users/1532454/jeff-learman"}, "edited": false, "score": 0, "creation_date": 1524095309, "post_id": 49909416, "comment_id": 86837096, "body": "The whole point of the topic of &quot;sparse matrices&quot; is to avoid building the whole matrix, but instead use special methods to do the manipulation.  These methods would be inefficient normally, but are much more efficient for sparse matrices.  So, it&#39;s probably a bad idea to create a 2D array from a specification of a sparse matrix, unless the teacher has explicitly said to do so as a step in the learning process."}, {"owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "reply_to_user": {"reputation": 2446, "user_id": 1532454, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aNEeA.jpg?s=128&g=1", "display_name": "Jeff Learman", "link": "https://stackoverflow.com/users/1532454/jeff-learman"}, "edited": false, "score": 0, "creation_date": 1524098558, "post_id": 49909416, "comment_id": 86837864, "body": "@JeffLearman Do you think i should create a scruct for a element of the sparse matrix thats not 0? Like int row, int column and double value. Maybe it would be better than dealing with a large matrix with a lot of zeros"}, {"owner": {"reputation": 2446, "user_id": 1532454, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aNEeA.jpg?s=128&g=1", "display_name": "Jeff Learman", "link": "https://stackoverflow.com/users/1532454/jeff-learman"}, "edited": false, "score": 0, "creation_date": 1524238673, "post_id": 49909416, "comment_id": 86906680, "body": "@MuchoG: Yes, that&#39;s usually the whole point of treating sparse matrices as a special class.  It depends on what you&#39;re supposed to do next with the matrix, and what the teacher intends to teach in this exercise.  Read the wikipedia article, which mentions several different types of data structures often used.  The input file is a Coordinate List, which is the easiest to understand"}], "answers": [{"tags": [], "owner": {"reputation": 98, "user_id": 9646023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72a04910d9ba8389d3308479e26c7999?s=128&d=identicon&r=PG&f=1", "display_name": "Panos Antoniadis", "link": "https://stackoverflow.com/users/9646023/panos-antoniadis"}, "is_accepted": false, "score": 0, "last_activity_date": 1524386837, "last_edit_date": 1524386837, "creation_date": 1524087716, "answer_id": 49909451, "question_id": 49909416, "link": "https://stackoverflow.com/questions/49909416/making-a-2d-array-from-a-text-file/49909451#49909451", "title": "Making a 2d array from a text file", "body": "<p>You can measure the number of rows and columns and then define your 2d array. Of course, this will increase the time complexity! If you don't care about the size of the memory, you can define your array with the max columns and rows! So you should choose between big time complexity and big memory size.</p>\n"}, {"comments": [{"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 1, "creation_date": 1524088919, "post_id": 49909605, "comment_id": 86835268, "body": "I don&#39;t think a sparse matrix should be represented this way.  It should be represented in such a way to conserve memory and/or processing time."}], "tags": [], "owner": {"reputation": 53, "user_id": 4263105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e2f91600753ff54eb8b77c08bbab2e6?s=128&d=identicon&r=PG&f=1", "display_name": "ReckoningReckoner", "link": "https://stackoverflow.com/users/4263105/reckoningreckoner"}, "is_accepted": false, "score": 0, "last_activity_date": 1524088558, "creation_date": 1524088558, "answer_id": 49909605, "question_id": 49909416, "link": "https://stackoverflow.com/questions/49909416/making-a-2d-array-from-a-text-file/49909605#49909605", "title": "Making a 2d array from a text file", "body": "<p>There's no real way of knowing what's in a file unless you completely read the file yourself first.</p>\n\n<p>Since you know that there will be max 10k elements, you can <em>statically</em> allocate an array of that size first, and then load the numbers into the until you parse an EOF. </p>\n\n<pre><code>float sparseMatrix[10000];\n</code></pre>\n\n<p>It just means that your program will always allocate the space for 10k elements regardless of how many elements are actually in the array. If you assume that each element takes up 4 bytes, then you'll only be using ~40kB of memory. This is probably the easiest solution.</p>\n\n<p>The other option would be to read the file fully, figure out the required size, and <em>dynamically</em> allocate that size, then read through the whole file again whilst populating the elements.</p>\n\n<pre><code>// Assume numberOfElements was determined by reading through the file first\nfloat* sparseMatrix = malloc(sizeof(float) * numberOfElements); \n</code></pre>\n\n<p>Though this method will use less memory, it requires two full reads of the file + the overhead of calling malloc.</p>\n"}, {"comments": [{"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524091670, "post_id": 49909716, "comment_id": 86836138, "body": "That would destroy the sparse matrix and the read values would be gone. You have to use <code>realloc</code> to reduce the amount of allocated memory."}], "tags": [], "owner": {"reputation": 33, "user_id": 9666695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Alban Santolaria", "link": "https://stackoverflow.com/users/9666695/alban-santolaria"}, "is_accepted": false, "score": 2, "last_activity_date": 1524089187, "creation_date": 1524089187, "answer_id": 49909716, "question_id": 49909416, "link": "https://stackoverflow.com/questions/49909416/making-a-2d-array-from-a-text-file/49909716#49909716", "title": "Making a 2d array from a text file", "body": "<p>you need use in first :</p>\n\n<pre><code>float* sparseMatrix = malloc(sizeof(float) * 10000); \n</code></pre>\n\n<p>You start read the file and after the first line read you know the nomber of colums and the number of row is the number of line read. After you can reduce the matrix if you want.</p>\n\n<pre><code>free(sparseMatrix );\nsparseMatrix = malloc(sizeof(float) * nbRow*nbColum); \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "edited": false, "score": 0, "creation_date": 1524091218, "post_id": 49910012, "comment_id": 86836021, "body": "In this case, since 2.2 is in the position [4][5] and there&#180;s no element in a bigger row or column, the matrix should have 4 rows and 5 columns. If it was an element not 0 in the position [5] [5] then the matrix should have 5 rows and 5 columns"}], "tags": [], "owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "is_accepted": false, "score": 1, "last_activity_date": 1524091298, "last_edit_date": 1524091298, "creation_date": 1524090896, "answer_id": 49910012, "question_id": 49909416, "link": "https://stackoverflow.com/questions/49909416/making-a-2d-array-from-a-text-file/49910012#49910012", "title": "Making a 2d array from a text file", "body": "<p>You simply don't have enough information to construct an appropriate matrix.  In your cited case, you know you have <strong>AT LEAST</strong> 5 rows and <strong>AT LEAST</strong> 6 columns, but you don't know exactly how many rows <code>m</code> and columns <code>n</code> are in your matrix.  So for your given input:</p>\n\n<pre>\n0 3 1.2\n2 5 3.2\n3 0 2.1\n3 5 4.2\n4 5 2.2\n0 0 5.2\n</pre>\n\n<p>You could have a 5x6 matrix as:</p>\n\n<pre>\n5.2  0.0  0.0  1.2  0.0  0.0\n0.0  0.0  0.0  0.0  0.0  0.0\n0.0  0.0  0.0  0.0  0.0  3.2\n2.1  0.0  0.0  0.0  0.0  4.2\n0.0  0.0  0.0  0.0  0.0  2.2\n</pre>\n\n<p>Or you could have a 10x6 matrix as:</p>\n\n<pre>\n5.2  0.0  0.0  1.2  0.0  0.0\n0.0  0.0  0.0  0.0  0.0  0.0\n0.0  0.0  0.0  0.0  0.0  3.2\n2.1  0.0  0.0  0.0  0.0  4.2\n0.0  0.0  0.0  0.0  0.0  2.2\n0.0  0.0  0.0  0.0  0.0  0.0\n0.0  0.0  0.0  0.0  0.0  0.0\n0.0  0.0  0.0  0.0  0.0  0.0\n0.0  0.0  0.0  0.0  0.0  0.0\n0.0  0.0  0.0  0.0  0.0  0.0\n</pre>\n\n<p>This ambiguity is a problem as the first matrix is vastly different that the second.</p>\n\n<p>Also, the point of a <a href=\"https://en.wikipedia.org/wiki/Sparse_matrix\" rel=\"nofollow noreferrer\">sparse matrix</a> is to be efficient with memory and/or processing time.  If you allocate a full array of <code>m</code> rows and <code>n</code> columns then you have a <em>dense matrix</em> representation instead.</p>\n"}, {"comments": [{"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 1, "creation_date": 1524092006, "post_id": 49910132, "comment_id": 86836222, "body": "I understand what you are doing @Pablo, but it really makes no sense to represent a sparse matrix this way -- ie: as a dense matrix.  I suspect the OP is still missing something from the assignment."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "reply_to_user": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1524092344, "post_id": 49910132, "comment_id": 86836314, "body": "@MFisherKDX without the proper specification, guesses have to be made. I decided not to make any guess as to how large the dimensions of the matrix are, so I need to read all lines before I can determine the size of the matrix. This is the more general approach. Of course, I you know that upper bound of the matrix (or other properties of the matrix), you can simplify the code. And we don&#39;t know if the OP&#39;s matrix is a sparse one. The input file might be very large and contain a value for all matrix indices, the OP might have chosen to show us only a few lines."}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1524092439, "post_id": 49910132, "comment_id": 86836346, "body": "True, but the first line of the OP&#39;s problem statement is: <i>Im working with a sparse matrix and im given a text file like this:</i>.  So I am assuming the OP indeed has a sparse matrix."}, {"owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "edited": false, "score": 0, "creation_date": 1524092485, "post_id": 49910132, "comment_id": 86836356, "body": "Thanks! In this case, i call the file from the terminal (like: /.project &lt;filename&gt;) so i think i have to read and make the matrix in the main function"}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "reply_to_user": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "edited": false, "score": 0, "creation_date": 1524092682, "post_id": 49910132, "comment_id": 86836414, "body": "@MuchoG from my code, you have to change <code>main</code> to <code>int main(int argc, char **argv)</code> and then call <code>readmatrix(argv[1], &amp;rows, &amp;cols);</code>. Of course don&#39;t forget to check that <code>argv[1]</code> is not <code>NULL</code>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524092687, "post_id": 49910132, "comment_id": 86836417, "body": "Although this obviously close to what OP wanted, it does not make a 2D array as per the title &quot;Making a 2d array from a text file&quot; but a pointer to pointers."}, {"owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "reply_to_user": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1524093068, "post_id": 49910132, "comment_id": 86836518, "body": "@MFisherKDX in my assignment it just says that a sparse matrix is a matrix where a lot of elements are 0, but it doesn&#180;t say it cant be dense. I think the goal is just learning to work with C, structs, and a little bit of pointers. The class is Introduction to Algorythms and Data Structures so its not very complex"}, {"owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524093441, "post_id": 49910132, "comment_id": 86836623, "body": "Yeah @chux my goal is to, with the requirements i said earlier, to create a 2d array from the file that i can work with"}], "tags": [], "owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "is_accepted": true, "score": 3, "last_activity_date": 1524091568, "creation_date": 1524091568, "answer_id": 49910132, "question_id": 49909416, "link": "https://stackoverflow.com/questions/49909416/making-a-2d-array-from-a-text-file/49910132#49910132", "title": "Making a 2d array from a text file", "body": "<p>OP wrote this in the comments:</p>\n\n<blockquote>\n  <p>Im so sorry but my teacher clarified everything just now... it turns out that, for each line, the first number is the row, the second the column and the third the element.with the example i have above, <code>1.2</code> has to go in the position <code>[0][3]</code>. The matrix does not have to be square.</p>\n</blockquote>\n\n<p>This makes every thing different. If you don't know the dimensions of the\nmatrix, then you have to read everything first, then calculate the matrix\ndimensions, allocate space for the matrix and then fill it with the values.</p>\n\n<p>I'd do this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define BLOCK 1024\n\nstruct matrix_info {\n    int col;\n    int row;\n    double val;\n};\n\nvoid free_matrix(double **matrix, size_t rows)\n{\n    if(matrix == NULL)\n        return;\n\n    for(size_t i = 0; i &lt; rows; ++i)\n        free(matrix[i]);\n    free(matrix);\n}\n\ndouble **readmatrix(const char *fname, size_t *rows, size_t *cols)\n{\n    if(fname == NULL || rows == NULL || cols == NULL)\n        return NULL;\n\n    double **matrix = NULL;\n    struct matrix_info *info = NULL;\n    size_t mi_idx = 0; // matrix info index\n    size_t mi_size = 0;\n\n    FILE *fp = fopen(fname, \"r\");\n    if(fp == NULL)\n    {\n        fprintf(stderr, \"Cannot open %s\\n\", fname);\n        return NULL;\n    }\n\n    *rows = 0;\n    *cols = 0;\n\n    for(;;)\n    {\n        if(mi_idx &gt;= mi_size)\n        {\n            struct matrix_info *tmp = realloc(info, (mi_size + BLOCK) * sizeof *info);\n            if(tmp == NULL)\n            {\n                fprintf(stderr, \"not enough memory\\n\");\n                free(info);\n                fclose(fp);\n                return NULL;\n            }\n\n            info = tmp;\n            mi_size += BLOCK;\n        }\n\n        int ret = fscanf(fp, \"%d %d %lf\", &amp;info[mi_idx].row, &amp;info[mi_idx].col,\n                    &amp;info[mi_idx].val);\n\n        if(ret == EOF)\n            break; // end of file reached\n\n        if(ret != 3)\n        {\n            fprintf(stderr, \"Error parsing matrix\\n\");\n            free(info);\n            fclose(fp);\n            return NULL;\n        }\n\n        if(*rows &lt; info[mi_idx].row)\n            *rows = info[mi_idx].row;\n\n        if(*cols &lt; info[mi_idx].col)\n            *cols = info[mi_idx].col;\n\n        mi_idx++;\n    }\n\n    fclose(fp);\n\n    // mi_idx is now the length of info\n    // *cols and *rows have the largest index\n    // for the matrix, hence the dimension is (rows + 1) x (cols + 1)\n    (*cols)++;\n    (*rows)++;\n\n    // allocating memory\n\n    matrix = calloc(*rows, sizeof *matrix);\n    if(matrix == NULL)\n    {\n        fprintf(stderr, \"Not enough memory\\n\");\n        free(info);\n        return NULL;\n    }\n\n    for(size_t i = 0; i &lt; *rows; ++i)\n    {\n        matrix[i] = calloc(*cols, sizeof **matrix);\n        if(matrix[i] == NULL)\n        {\n            fprintf(stderr, \"Not enough memory\\n\");\n            free(info);\n            free_matrix(matrix, *rows);\n            return NULL;\n        }\n    }\n\n    // populating matrix\n\n    for(size_t i = 0; i &lt; mi_idx; ++i)\n    {\n        int r,c;\n        r = info[i].row;\n        c = info[i].col;\n        matrix[r][c] = info[i].val;\n    }\n\n    free(info);\n    return matrix;\n}\n\nint main(void)\n{\n    const char *fn = \"/tmp/matrix.txt\";\n\n    size_t rows, cols;\n\n    double **matrix = readmatrix(fn, &amp;rows, &amp;cols);\n\n    if(matrix == NULL)\n        return 1;\n\n    for(size_t i = 0; i &lt; rows; ++i)\n    {\n        for(size_t j = 0; j &lt; cols; ++j)\n            printf(\"%0.3f \", matrix[i][j]);\n\n        puts(\"\");\n    }\n\n    free_matrix(matrix, rows);\n    return 0;\n}\n</code></pre>\n\n<p>The output is (for a file with your sample data)</p>\n\n<pre><code>5.200 0.000 0.000 1.200 0.000 0.000 \n0.000 0.000 0.000 0.000 0.000 0.000 \n0.000 0.000 0.000 0.000 0.000 3.200 \n2.100 0.000 0.000 0.000 0.000 4.200 \n0.000 0.000 0.000 0.000 0.000 2.200\n</code></pre>\n\n<p>So a quick explanation of what I'm doing:</p>\n\n<p>I read the file and store in an dynamically allocated array the information\nabout the column, the row and the value. This information is stored in the\n<code>struct matrix_info *info</code>.</p>\n\n<p>The idea is that I read every line and extract the three values. While I read\nthe file, I also store the largest index for the column and the row</p>\n\n<pre><code>    ...\n\n    if(*rows &lt; info[mi_idx].row)\n        *rows = info[mi_idx].row;\n\n    if(*cols &lt; info[mi_idx].col)\n        *cols = info[mi_idx].col;\n\n    ...\n</code></pre>\n\n<p>so when the file is read, I know the dimensions of the matrix. Now all values\nwith their row &amp; column are stored in the <code>info</code> array, so the next step is to\nallocate memory for the matrix and fill the values based based on the <code>info[i]</code>\nentries.</p>\n\n<pre><code>for(size_t i = 0; i &lt; mi_idx; ++i)\n{\n    int r,c;\n    r = info[i].row;\n    c = info[i].col;\n    matrix[r][c] = info[i].val;\n}\n</code></pre>\n\n<p>At the end I free the memory for <code>info</code> and return the matrix.</p>\n\n<p>Another interesting part is this:</p>\n\n<pre><code>    if(mi_idx &gt;= mi_size)\n    {\n        struct matrix_info *tmp = realloc(info, (mi_size + BLOCK) * sizeof *info);\n        if(tmp == NULL)\n        {\n            fprintf(stderr, \"not enough memory\\n\");\n            free(info);\n            fclose(fp);\n            return NULL;\n        }\n\n        info = tmp;\n        mi_size += BLOCK;\n    }\n</code></pre>\n\n<p>Because you mentioned that the only thing you know about the matrix is that it\nmight contain up to 10000 elements, then the input file might be very big.\nInstead of reallocating memory for the <code>info</code> elements on every loop, I allocate\nchunks of 1024 (<code>BLOCK</code>) <code>info</code> elements at a time. Thus once a block is full,\nthe next block is allocated and so on. So I call <code>realloc</code> only every 1024\niterations.</p>\n"}], "owner": {"reputation": 43, "user_id": 9666551, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iZd2e16TZ98/AAAAAAAAAAI/AAAAAAAAAG8/QHHEWXMX_Zk/photo.jpg?sz=128", "display_name": "MuchoG", "link": "https://stackoverflow.com/users/9666551/muchog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 374, "favorite_count": 0, "accepted_answer_id": 49910132, "answer_count": 5, "score": -1, "last_activity_date": 1524386837, "creation_date": 1524087499, "last_edit_date": 1524089382, "question_id": 49909416, "link": "https://stackoverflow.com/questions/49909416/making-a-2d-array-from-a-text-file", "title": "Making a 2d array from a text file", "body": "<p>Im working with a sparse matrix and im given a text file like this:</p>\n\n<pre><code>0 3 1.2\n2 5 3.2\n3 0 2.1\n3 5 4.2\n4 5 2.2\n0 0 5.2\n</code></pre>\n\n<p>Basically the way it works is the number 1.2 goes on the position [0] [3] and the elements of the matriz that are not mentioned stay at 0, so in this case it should look like this:</p>\n\n<pre><code>5.2 0 0 1.2 0 0\n0 0 0 0 0 0\n0 0 0 0 0 3.2\n2.1 0 0 0 0 4.2\n0 0 0 0 0 2.2\n</code></pre>\n"}, {"tags": ["c", "arrays", "pointers", "multidimensional-array"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524088265, "post_id": 49909386, "comment_id": 86835031, "body": "You can&#39;t initialize an array with a function call, only with a literal list of initializers."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524088383, "post_id": 49909386, "comment_id": 86835080, "body": "Declaring an array allocates space for the array, there&#39;s no need to call <code>malloc()</code>."}, {"owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524088546, "post_id": 49909386, "comment_id": 86835135, "body": "I need because the 10x10 were just an example in the real application this is dynamic and depends on the image dimension... The char[3] represent the RPG value from 0...255 for each pixel in the image"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524088661, "post_id": 49909386, "comment_id": 86835178, "body": "C allows variable-length arrays, so you can write <code>char test[height][width][3];</code>"}, {"owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524088765, "post_id": 49909386, "comment_id": 86835220, "body": "@Barmar That&#39;s true but it still doesn&#39;t solve the problem with the pointer as in the structure I cannot define a variable length array, can I?"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524089084, "post_id": 49909386, "comment_id": 86835325, "body": "Post code that looks more like what you&#39;re really trying to do, and show the code that&#39;s trying to access the array element."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524089154, "post_id": 49909386, "comment_id": 86835342, "body": "An array is not a pointer. <code>char ***ptr = test;</code> is not correct, because <code>test[0]</code> is an array, but <code>ptr[0]</code> is expected to be a pointer."}, {"owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524089275, "post_id": 49909386, "comment_id": 86835381, "body": "@Barmar hmm ok I see and how do I write it correctly? :)"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524089404, "post_id": 49909386, "comment_id": 86835428, "body": "See the answer where he uses <code>malloc()</code> to allocate the main array and arrays for each row."}, {"owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524089510, "post_id": 49909386, "comment_id": 86835457, "body": "@Barmar But then I only have a pointer to one pixel... I need to have a pointer to the entire image so I can pass it into a thread as a pointer and modify it there"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524089570, "post_id": 49909386, "comment_id": 86835480, "body": "you have a pointer to the array of pionters. Do you need all the pixels to be in contiguous memory?"}, {"owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524089913, "post_id": 49909386, "comment_id": 86835609, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/169281/discussion-between-tom1991te-and-barmar\">continue this discussion in chat</a>."}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 1, "creation_date": 1524092831, "post_id": 49909386, "comment_id": 86836457, "body": "<a href=\"http://wiki.c2.com/?ThreeStarProgrammer\" rel=\"nofollow noreferrer\">My congratulations on advancing in rank. :P</a>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524187145, "post_id": 49909386, "comment_id": 86880608, "body": "the posted code does not compile!  It is missing this statement: <code>#include &lt;string.h&gt;</code>  for the function: <code>memcpy()</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "edited": false, "score": 0, "creation_date": 1524088455, "post_id": 49909554, "comment_id": 86835099, "body": "But it is actually a 3D array? I have a 2D array of arrays of chars of size 3... The array should represent an image and the chars should represent the RPG values from 0 to 255 for each pixel in the image"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "edited": false, "score": 1, "creation_date": 1524088627, "post_id": 49909554, "comment_id": 86835161, "body": "@tom1991te How about <code>char test[10][10][3];</code>?"}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 0, "creation_date": 1524088648, "post_id": 49909554, "comment_id": 86835173, "body": "if you know that each string only has 3 characters, then you could change the declaration to <code>chat test [10][10][4];</code> adding an extra char to hold the null terminator.  If you don&#39;t need the null terminator then use 3 and not 4.  If you don&#39;t have the null terminator, you can&#39;t use standard C library string functions like <code>strcpy</code> which will want to append the null byte at the end."}, {"owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "edited": false, "score": 0, "creation_date": 1524088997, "post_id": 49909554, "comment_id": 86835295, "body": "@bruceg yes I don&#39;t need the null terminator as these aren&#39;t really strings but just values for the pixels. But still why does <code>ptr[0][0]</code> not work? I need to pass in this array to a pthread as a structure argument and I cannot use the variable length array in a structure but have to use the <code>char ***ptr</code> :)"}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 0, "creation_date": 1524089975, "post_id": 49909554, "comment_id": 86835630, "body": "I think that you&#39;re crashing because ptr is holding the address of test. But, you won&#39;t be able to iterate through your 3D array with a ptr.  Not sure what you are planning to do with ptr."}, {"owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "edited": false, "score": 0, "creation_date": 1524090103, "post_id": 49909554, "comment_id": 86835667, "body": "@bruceg Yeah actually the goal is to iterate over the 3D array with a pointer"}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 0, "creation_date": 1524090870, "post_id": 49909554, "comment_id": 86835937, "body": "If you declare ptr like this: <code>unsigned char *ptr;</code> and assign it like this: <code>ptr = test[0][0];</code> Then you can iterate over the array like this: `  for (i = 0; i &lt; 100; i++) {           f(ptr);           ptr++;   } ` But, note that since you ptr doesn&#39;t know that it&#39;s pointing to a 3 character element.  All the data in test is laid out contiguously, so ptr at the beginning looks like a 300 character unterminated string."}], "tags": [], "owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "is_accepted": false, "score": 1, "last_activity_date": 1524088310, "last_edit_date": 1524088310, "creation_date": 1524088267, "answer_id": 49909554, "question_id": 49909386, "link": "https://stackoverflow.com/questions/49909386/use-array-annotation-with-pointers/49909554#49909554", "title": "Use array annotation with pointers", "body": "<p>In C, you should allocate space for your 2D array one row at a time.  Your definition of test declares a 10 by 10 array of char pointers, so you don't need to call malloc for it.  But to store a string you need to allocate space for the string.  Your call to strcpy would crash.  Use strdup instead.  One way to write your code is as follows.</p>\n\n<pre><code>    char ***test = NULL;\n    char *ptr = NULL;\n    test = malloc(10 * sizeof(char **));\n    for (int i = 0; i &lt; 10; i++) {\n            test[i] = malloc(10 * sizeof(char *));\n    }\n    test[0][0] = strdup(\"abc\");\n    ptr = test[0][0];\n\n    printf(\"%s\\n\", ptr);\n\n    test[4][5] = strdup(\"efg\");\n    ptr = test[4][5];\n\n    printf(\"%s\\n\", ptr);\n</code></pre>\n\n<p>Alternatively, if you want to keep your 10 by 10 definition, you could code it like this:</p>\n\n<pre><code>    char *test[10][10];\n    char *ptr = NULL;\n\n    test[0][0] = strdup(\"abc\");\n    ptr = test[0][0];\n\n    printf(\"%s\\n\", ptr);\n\n    test[4][5] = strdup(\"efg\");\n    ptr = test[4][5];\n\n    printf(\"%s\\n\", ptr);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "edited": false, "score": 1, "creation_date": 1524092726, "post_id": 49910273, "comment_id": 86836431, "body": "Thanks that&#39;s what I was looking for :) I just thought too complicated but actually it is solvable with just a simple pointer :)"}, {"owner": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "reply_to_user": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "edited": false, "score": 0, "creation_date": 1524094215, "post_id": 49910273, "comment_id": 86836815, "body": "@tom1991te - You&#39;ll also save yourself a lot of headache with <code>struct pixel {byte r;byte g; byte b;}</code> or whatever C&#39;s garbage syntax for declaring structs is.  Now you have a 2-dimensional array...which is what it really is.  (Plus if the compiler can speed things up by 4/8-byte-aligning the structs, it will....)"}], "tags": [], "owner": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "is_accepted": true, "score": 1, "last_activity_date": 1524095595, "last_edit_date": 1524095595, "creation_date": 1524092565, "answer_id": 49910273, "question_id": 49909386, "link": "https://stackoverflow.com/questions/49909386/use-array-annotation-with-pointers/49910273#49910273", "title": "Use array annotation with pointers", "body": "<p>I think maybe <code>strdup</code> confuses the issue.  Pointers and arrays are <em>not</em> always equivalent.  Let me try to demonstrate.  I always avoid actual multi-dimension arrays, so I may make a mistake here, but:</p>\n\n<pre><code>int main()\n{\n  char d3Array[10][10][4]; //creates a 400-byte contiguous memory area \n  char ***d3Pointer; //a pointer to a pointer to a pointer to a char.\n  int i,j;\n  d3Pointer = malloc(sizeof(char**) * 10);\n  for (i = 0; i &lt; 10; ++i)\n  {\n    d3Pointer[i] = malloc(sizeof(char*) * 10);\n    for (j = 0; j &lt; 4; ++j)\n    {\n      d3Pointer[i][j] = malloc(sizeof(char) * 4);\n    }\n  }\n  //this\n  d3Pointer[2][3][1] = 'a';\n  //is equivalent to this\n  char **d2Pointer = d3Pointer[2];\n  char *d1Pointer = d2Pointer[3];\n  d1Pointer[1] = 'a';\n\n\n  d3Array[2][3][1] = 'a';\n  //is equivalent to \n  ((char *)d3Array)[(2 * 10 * 4) + (3 * 4) + (1)] = 'a';\n}\n</code></pre>\n\n<p>Generally, I use the layered approach.  If I want contiguous memory, I handle the math myself..like so:</p>\n\n<pre><code>  char *psuedo3dArray = malloc(sizeof(char) * 10 * 10 * 4);\n  psuedo3dArray[(2 * 10 * 4) + (3 * 4) + (1)] = 'a';\n</code></pre>\n\n<p>Better yet, I use a collection library like <code>uthash</code>.</p>\n\n<p>Note that properly encapsulating your data makes the actual code incredibly easy to read:</p>\n\n<pre><code>typedef unsigned char byte_t;\ntypedef struct\n{\n  byte_t r;\n  byte_t g;\n  byte_t b;\n}pixel_t;\n\ntypedef struct\n{\n  int width;\n  int height;\n  pixel_t * pixelArray;\n}screen_t;\n\npixel_t *getxyPixel(screen_t *pScreen, int x, int y)\n{\n  return pScreen-&gt;pixelArray + (y*pScreen-&gt;width) + x;\n}\n\nint main()\n{\n  screen_t myScreen;\n  myScreen.width = 1024;\n  myScreen.height = 768;\n  myScreen.pixelArray = (pixel_t*)malloc(sizeof(pixel_t) * myScreen.height * myScreen.width);\n  getxyPixel(&amp;myScreen, 150, 120)-&gt;r = 255;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 33597, "user_id": 2445184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0b51ece74c2314ba345a862c4b00d804?s=128&d=identicon&r=PG", "display_name": "cmaster - reinstate monica", "link": "https://stackoverflow.com/users/2445184/cmaster-reinstate-monica"}, "is_accepted": false, "score": 0, "last_activity_date": 1524098249, "creation_date": 1524098249, "answer_id": 49910953, "question_id": 49909386, "link": "https://stackoverflow.com/questions/49909386/use-array-annotation-with-pointers/49910953#49910953", "title": "Use array annotation with pointers", "body": "<p>Your problem is, that a <code>char[10][10][3]</code> is something <strong>very different</strong> from a <code>char***</code>: The first is an array of arrays of arrays, the later is a pointer to a pointer to a pointer. The confusions arises because both can be dereferenced with the same syntax. So, here is a bit of an explanation:</p>\n\n<ol>\n<li><p><strong>The syntax <code>a[b]</code> is nothing but a shorthand for <code>*(a + b)</code></strong>: First you perform pointer arithmetic, then you dereference the resulting pointer.</p>\n\n<p>But, how come you can use <code>a[b]</code> when <code>a</code> is an array instead of a pointer? Well, because...</p></li>\n<li><p><strong>Arrays decay into pointers to their first element</strong>: If you have an array declared like <code>int array[10]</code>, saying <code>array + 3</code> results in <code>array</code> decaying to a pointer of type <code>int*</code>.</p>\n\n<p>But, how does that help to evaluate <code>a[b]</code>? Well, because...</p></li>\n<li><p><strong>Pointer arithmetic takes the size of the target into account</strong>: The expression <code>array + 3</code> triggers a calculation along the lines of <code>(size_t)array + 3*sizeof(*array)</code>. In our case, the pointer that results from the array-pointer-decay points to an <code>int</code>, which has a size, say 4 bytes. So, the pointer is incremented by <code>3*4</code> bytes. The result is a pointer that points to the fourths <code>int</code> in the array, the first three elements are skipped by the pointer arithmetic.</p>\n\n<p>Note, that this works for arrays of any element type. Arrays can contain bytes, or integers, or floats, or structs, or other arrays. The pointer arithmetic is the same.</p>\n\n<p>But, how does that help us with multidimensional arrays? Well, because...</p></li>\n<li><p><strong>Multidimensional arrays are just 1D arrays that happen to contain arrays as elements</strong>: When you declare an array with <code>char image[256][512];</code> you are declaring a 1D array of 256 elements. These 256 elements are all arrays of 512 characters, each. Since the <code>sizeof(char) == 1</code>, the size of an element of the outer array is <code>512*sizeof(char) = 512</code>, and, since we have <code>256</code> such arrays, the total size of <code>image</code> is <code>256*512</code>. Now, I can declare a 3D array with <code>char animation[24][256][512];</code>...</p></li>\n</ol>\n\n<hr>\n\n<p>So, going back to your example that uses</p>\n\n<pre><code>char image[10][10][3]\n</code></pre>\n\n<p>what happens when you say <code>image[1][2][1]</code> is this: The expression is equivalent to this one:</p>\n\n<pre><code>*(*(*(image + 1) + 2) + 3)\n</code></pre>\n\n<ol>\n<li><p><code>image</code> being of type <code>char[10][10][3]</code> decays into a pointer to its first element, which is of type <code>char(*)[10][3]</code> The size of that element is <code>10*3*1 = 30</code> bytes.</p></li>\n<li><p><code>image + 1</code>: Pointer arithmetic is performed to add <code>1</code> to the resulting pointer, which increments it by <code>30</code> bytes.</p></li>\n<li><p><code>*(image + 1)</code>: The pointer is dereferenced, we are now talking directly about the element, which is of type <code>char[10][3]</code>.</p></li>\n<li><p>This array again decays into a pointer to its first element, which is of type <code>char(*)[3]</code>. The size of the element is <code>3*1 = 3</code>. <strong>This pointer points at the same byte in memory as the pointer that resulted from step 2. The only difference is, that it has a different type!</strong></p></li>\n<li><p><code>*(image + 1) + 2</code>: Pointer arithmetic is performed to add <code>2</code> to the resulting pointer, which increments it by <code>2*3 = 6</code> bytes. Together with the increment in step 2, we now have an offset of <code>36</code> bytes, total.</p></li>\n<li><p><code>*(*(image + 1) + 2)</code>: The pointer is dereferenced, we are now talking directly about the element, which is of type <code>char[3]</code>.</p></li>\n<li><p>This array again decays into a pointer to its first element, which is of type <code>char*</code>. The size of the element is now just a single byte. <strong>Again, this pointer has the same value as the pointer resulting from step 5, but a different type.</strong></p></li>\n<li><p><code>*(*(image + 1) + 2) + 1</code>: Pointer arithmetic again, adding <code>1*1 = 1</code> bytes to the total offset, which increases to <code>37</code> bytes.</p></li>\n<li><p><code>*(*(*(image + 1) + 2) + 1)</code>: The pointer is dereferenced the last time, we are now talking about the <code>char</code> at an offset of <code>37</code> bytes into the <code>image</code>.</p></li>\n</ol>\n\n<hr>\n\n<p>So, what's the difference to a <code>char***</code>? <strong>When you dereference a <code>char***</code>, you do not get any array-pointer-decay</strong>. When you try to evaluate the expression <code>pointers[1][2][1]</code> with a variable declared as</p>\n\n<pre><code>char*** pointers;\n</code></pre>\n\n<p>the expression is again equivalent to:</p>\n\n<pre><code>*(*(*(pointers + 1) + 2) + 3)\n</code></pre>\n\n<ol>\n<li><p><code>pointers</code> is a pointer, so no decay happens. Its type is <code>char***</code>, and it points to a value of type <code>char**</code>, which likely has a size of <code>8</code> bytes (assuming a 64 bit system).</p></li>\n<li><p><code>pointers + 1</code>: Pointer arithmetic is performed to add <code>1</code> to the resulting pointer, which increments it by <code>1*8 = 8</code> bytes.</p></li>\n<li><p><code>*(pointers + 1)</code>: The pointer is dereferenced, we are now talking about the pointer value <strong>that is found in memory at an offset of <code>8</code> bytes of where <code>pointers</code> points</strong>.</p></li>\n<li><p>Further steps depending on what actually happened to be stored at <code>pointers[1]</code>. These steps do not involve any array-pointer-decay, and thus load pointers from memory instead.</p></li>\n</ol>\n\n<hr>\n\n<p>You see, the difference between a <code>char[10][10][3]</code> and a <code>char***</code> is profound. In the first case, the array-pointer-decay transforms the process into a pure offset computation into a multidimensional array. In the later case, we repeatedly load pointers from memory when accessing elements, all we ever have are 1D arrays of pointers. And it's all down to the types of pointers!</p>\n"}], "owner": {"reputation": 1183, "user_id": 2372782, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ceed5b998d60e328a1a33bd6f1d5f4d1?s=128&d=identicon&r=PG", "display_name": "tzwickl", "link": "https://stackoverflow.com/users/2372782/tzwickl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 1, "accepted_answer_id": 49910273, "answer_count": 3, "score": 5, "last_activity_date": 1524098249, "creation_date": 1524087338, "last_edit_date": 1524090450, "question_id": 49909386, "link": "https://stackoverflow.com/questions/49909386/use-array-annotation-with-pointers", "title": "Use array annotation with pointers", "body": "<p>I have currently trouble understanding the following scenario: \nI have a multidimensional array of Strings and I want to address it by using pointers only but I always get a Segmentation Fault when using the array annotation on the pointer. This is just an example code I want to use the 3D array in a pthread so I want to pass it in via a structure as a pointer but it just doesn't work and I would like to know why? I thought pointers and arrays are functionally equivalent? Here is the sample code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nvoid func(unsigned char ***ptr);\n\nint main() {\n  // Image of dimension 10 times 10\n  unsigned char image[10][10][3];\n  unsigned char ***ptr = image;\n\n  memcpy(image[0][0], \"\\120\\200\\12\", 3);\n\n  // This works as expected\n  printf(\"Test: %s\", image[0][0]);\n\n  func(image);\n\n  return 0;\n}\n\nvoid func(unsigned char ***ptr) {\n  // But here I get a Segmentation Fault but why??\n  printf(\"Ptr: %s\", ptr[0][0]);\n}\n</code></pre>\n\n<p>Thanks in advance for your help :)</p>\n"}, {"tags": ["c", "pre-increment"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 5, "creation_date": 1524084223, "post_id": 49908704, "comment_id": 86833342, "body": "Short-circuiting."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524084297, "post_id": 49908704, "comment_id": 86833391, "body": "Because <code>A || B</code> evaluates to true if <code>A</code> is true or <code>B</code> is true.  If <code>A</code> is true, then you don&#39;t need to evaluate <code>B</code>, because the whole statement is true. <code>++a &amp;&amp; ++b</code> is non-zero, hence it&#39;s evaluated as true, hence <code>++c</code> doesn&#39;t need to be evaluated and it doesn&#39;t get executed."}, {"owner": {"reputation": 2663, "user_id": 6301420, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9f4693f2fcba86b5f59737b94120acc2?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Schepler", "link": "https://stackoverflow.com/users/6301420/daniel-schepler"}, "edited": false, "score": 2, "creation_date": 1524084487, "post_id": 49908704, "comment_id": 86833471, "body": "Not only do you not need to evaluate <code>B</code>, a compiler is <i>forbidden</i> to generate code executing side effects in <code>B</code> if <code>A</code> evaluates to true.  Related: for example <code>if (p == NULL || p-&gt;value == 0) ...</code> is safe even in case <code>p</code> can be <code>NULL</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2663, "user_id": 6301420, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9f4693f2fcba86b5f59737b94120acc2?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Schepler", "link": "https://stackoverflow.com/users/6301420/daniel-schepler"}, "edited": false, "score": 1, "creation_date": 1524085284, "post_id": 49908736, "comment_id": 86833830, "body": "It might be worth noting that <code>&amp;&amp;</code> also short-circuits if the first operand evaluates to <code>0</code> or <code>false</code>.  So for example, if <code>a</code> starts as <code>-1</code>, then <code>b</code> will not be incremented, only <code>a</code> and <code>c</code>."}], "tags": [], "owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "is_accepted": true, "score": 5, "last_activity_date": 1524084665, "last_edit_date": 1524084665, "creation_date": 1524084282, "answer_id": 49908736, "question_id": 49908704, "link": "https://stackoverflow.com/questions/49908704/why-the-first-two-variables-a-b-are-pre-incremented-but-the-third-one-is-not/49908736#49908736", "title": "Why the first two variables (a, b) are pre-incremented but the third one is not(c)?", "body": "<p>This is short-circuiting behavior, and a deliberate part of the C language.</p>\n\n<p>When C finds an expression of the form:</p>\n\n<pre><code>(expression A) || (expression B)\n</code></pre>\n\n<p>And expression A is evaluated to be <code>TRUE</code>, it does not matter what expression B is!<br>It could be <code>TRUE</code>, or <code>FALSE</code>, but the overall expression will still be <code>TRUE</code>, because of the <code>||</code>.</p>\n\n<p>As a result, the C language will not even bother to evaluate the second-half: expression B.  That part just gets skipped, and so the <code>++c</code> is skipped and never evaluated.</p>\n\n<hr>\n\n<p>Just for kicks, if you wanted to change this program so that <code>++c</code> does happen, set <code>b</code> equal to <code>-1</code>, so that when you have <code>++b</code>, it becomes <code>0 (false)</code>.</p>\n\n<pre><code>int a = 5, b = -1, c = 0, d;\n</code></pre>\n\n<p>Now, the expression will evaluate this way:</p>\n\n<pre><code>d = (6 &amp;&amp; 0) || [ lazy, short-circuit evaluation ];\nd =    0     || [ second expression is now required! ];\nd =    0     ||  1;\nd = 1;\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>6011\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8014034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3277babf1c16e62f5f2890f9ce699157?s=128&d=identicon&r=PG&f=1", "display_name": "M\u0103rcule\u021b Marco", "link": "https://stackoverflow.com/users/8014034/m%c4%83rcule%c8%9b-marco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 49908736, "answer_count": 1, "score": 0, "last_activity_date": 1524084665, "creation_date": 1524084142, "question_id": 49908704, "link": "https://stackoverflow.com/questions/49908704/why-the-first-two-variables-a-b-are-pre-incremented-but-the-third-one-is-not", "title": "Why the first two variables (a, b) are pre-incremented but the third one is not(c)?", "body": "<p>I am having an issue I cannot understand. The output for a is 6, b is -6 but the c remains the same no matter what variable I initialize it with.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nvoid main()\n{\nint a = 5, b = -7, c = 0, d;\nd = ++a &amp;&amp; ++b || ++c;\nprintf(\"\\n%d%d%d%d\", a, b, c, d);\n}\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1524083426, "post_id": 49908464, "comment_id": 86832959, "body": "Why the <code>fscanf</code>? Shouldn&#39;t you be using <code>sscanf(lineBuf . . .</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524083696, "post_id": 49908534, "comment_id": 86833093, "body": "@AlekMIller bear in mind that <code>fgets</code> after <code>fscanf</code> will pick up an empty line, due to the newline left in the buffer. Don&#39;t mix input methods with different behaviour."}, {"owner": {"reputation": 13, "user_id": 8691629, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tGcIyyItgac/AAAAAAAAAAI/AAAAAAAAADI/_qD3h0oKUmg/photo.jpg?sz=128", "display_name": "Alek MIller", "link": "https://stackoverflow.com/users/8691629/alek-miller"}, "edited": false, "score": 0, "creation_date": 1524084310, "post_id": 49908534, "comment_id": 86833395, "body": "for the input just the first line is three integers and the rest are one value. thank you."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "reply_to_user": {"reputation": 13, "user_id": 8691629, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tGcIyyItgac/AAAAAAAAAAI/AAAAAAAAADI/_qD3h0oKUmg/photo.jpg?sz=128", "display_name": "Alek MIller", "link": "https://stackoverflow.com/users/8691629/alek-miller"}, "edited": false, "score": 0, "creation_date": 1524084553, "post_id": 49908534, "comment_id": 86833490, "body": "@AlekMIller Why are you reading 3 numbers in a loop if that&#39;s only the first line?"}, {"owner": {"reputation": 13, "user_id": 8691629, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tGcIyyItgac/AAAAAAAAAAI/AAAAAAAAADI/_qD3h0oKUmg/photo.jpg?sz=128", "display_name": "Alek MIller", "link": "https://stackoverflow.com/users/8691629/alek-miller"}, "edited": false, "score": 0, "creation_date": 1524084733, "post_id": 49908534, "comment_id": 86833575, "body": "the first line is pages frames requests. then after that i have to store the rest in an array."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "reply_to_user": {"reputation": 13, "user_id": 8691629, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tGcIyyItgac/AAAAAAAAAAI/AAAAAAAAADI/_qD3h0oKUmg/photo.jpg?sz=128", "display_name": "Alek MIller", "link": "https://stackoverflow.com/users/8691629/alek-miller"}, "edited": false, "score": 0, "creation_date": 1524086005, "post_id": 49908534, "comment_id": 86834093, "body": "@AlekMIller I&#39;ve made an update of the answer based on your comments."}, {"owner": {"reputation": 13, "user_id": 8691629, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tGcIyyItgac/AAAAAAAAAAI/AAAAAAAAADI/_qD3h0oKUmg/photo.jpg?sz=128", "display_name": "Alek MIller", "link": "https://stackoverflow.com/users/8691629/alek-miller"}, "edited": false, "score": 0, "creation_date": 1524096243, "post_id": 49908534, "comment_id": 86837292, "body": "thank you all for the help. i was getting confused with fgets and scan function."}], "tags": [], "owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "is_accepted": true, "score": 2, "last_activity_date": 1524085987, "last_edit_date": 1524085987, "creation_date": 1524083440, "answer_id": 49908534, "question_id": 49908464, "link": "https://stackoverflow.com/questions/49908464/reading-int-from-file-store-first-line-in-variables-in-c/49908534#49908534", "title": "reading int from file store first line in variables in c", "body": "<p>It skips because you are reading the file with <code>fgets</code> as well, so <code>fgets</code> get\nthe first line, <code>fscanf</code> the second line but leaves the newline in the input\nbuffer, so <code>fgets</code> will read only an empty line, etc. It's a bad idea to mix\nboth reading function.</p>\n\n<p>The best thing would be to read all lines with <code>fgets</code> and parse each line with\n<code>sscanf</code>. Use the return value of <code>sscanf</code> to determine how many integer you've\nread. From your input it seems that a line can have 1, 2 or 3 integers. So this\nwould do:</p>\n\n<pre><code>char line[1024];\nwhile(fgets(line, sizeof line, inputFile))\n{\n    int pages, frames, requests, ret;\n\n    ret = sscanf(line, \"%d %d %d\", &amp;pages, &amp;frames, &amp;requests);\n\n    if(ret &lt; 1)\n    {\n        fprintf(stderr, \"Error parsing the line, no numbers\\n\");\n        continue;\n    }\n\n    if(ret == 1)\n    {\n        // do something with pages\n    } else if(ret == 2) {\n        // do something with pages &amp; frames\n    } else if(ret == 3) {\n        // do something with pages, frames and requests\n    }\n}\n</code></pre>\n\n<hr>\n\n<p><em>edit</em></p>\n\n<p>based on your comments, of only the first line has 3 values and the rest of the\nlines have one value each, then you can simplify the code like this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint parse_file(const char *fname, int *pages, int *frames, int *request, int *vals, size_t size)\n{\n    size_t idx = 0;\n\n    if(fname == NULL || pages == NULL || frames == NULL\n            || request == NULL || vals == NULL)\n        return -1;\n\n    FILE *fp = fopen(fname, \"r\");\n    if(fp == NULL)\n    {\n        fprintf(stderr, \"Cannot open %s\\n\", fname);\n        return -1;\n    }\n\n    if(fscanf(fp, \"%d %d %d\", pages, frames, request) != 3)\n    {\n        fprintf(stderr, \"Wrong format, expecting pages, frames and requests\\n\");\n        fclose(fp);\n        return -1;\n    }\n\n    // reading all other values and storing them in an array\n    while((idx &lt; size) &amp;&amp; (fscanf(fp, \"%d\", vals + idx) == 1)); // &lt;-- note the semicolon\n\n    fclose(fp);\n    return idx; // returning the number of values of the array\n}\n\nint main(void)\n{\n    int pages, frames, request, vals[100];\n\n    int num = parse_file(\"/your/file.txt\", &amp;pages, &amp;frames, &amp;request,\n                vals, sizeof vals / sizeof vals[0]);\n\n    if(num == -1)\n    {\n        fprintf(stderr, \"Cannot parse file\\n\");\n        return 1;\n    }\n\n    // your code\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8691629, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tGcIyyItgac/AAAAAAAAAAI/AAAAAAAAADI/_qD3h0oKUmg/photo.jpg?sz=128", "display_name": "Alek MIller", "link": "https://stackoverflow.com/users/8691629/alek-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 861, "favorite_count": 0, "accepted_answer_id": 49908534, "answer_count": 1, "score": 1, "last_activity_date": 1524088723, "creation_date": 1524083081, "last_edit_date": 1524088723, "question_id": 49908464, "link": "https://stackoverflow.com/questions/49908464/reading-int-from-file-store-first-line-in-variables-in-c", "title": "reading int from file store first line in variables in c", "body": "<p>I am trying to read ints from a txt file and store the first line into three variable and the rest into an array.</p>\n\n<pre><code> while(fgets(lineBuf, sizeof(lineBuf), inputFile) != NULL){\n\n   fscanf(inputFile, \"%d %d %d\", &amp;pages, &amp;frames, &amp;requests);\n   printf(\"\\n\\nin loop to get first line variables:\\n Pages: %d\\n frames: %d\\n requests: %d\", pages, frames, requests);\n }\n</code></pre>\n\n<p>Input file: the numbers with the first row being the first three and every row afterwards just being a single number.</p>\n\n<pre><code>8 12 4 \n4\n3\n4\n...\n</code></pre>\n\n<p>when i run the program, it skips the 12 and 4.</p>\n"}, {"tags": ["c", "algorithm", "linear-interpolation"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1524082587, "post_id": 49908218, "comment_id": 86832523, "body": "Don&#39;t use an infinite loop; use <code>while (value &lt; 100.00)</code>.  Note that if you add a small number repeatedly (0.001) to a large number (55, etc), things begin to go haywire.  &quot;Floating point numbers are like heaps of sand; every time you move one, you lose a little sand an pick up a little dirt.&quot; That&#39;s a factor in your problems, I&#39;m sure."}, {"owner": {"reputation": 357, "user_id": 6317692, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/08fc3b47488367878c7d9ad65d9a1687?s=128&d=identicon&r=PG&f=1", "display_name": "Leigh K", "link": "https://stackoverflow.com/users/6317692/leigh-k"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1524083154, "post_id": 49908218, "comment_id": 86832803, "body": "The algorithm is still diverging if I use an increment of 0.01 or even 0.1"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1524083390, "post_id": 49908218, "comment_id": 86832938, "body": "Instead of incrementing <code>value</code>, calculate it.  However, I&#39;m not sure how the interpolation through 201 points works when the variables are in a simple linear relationship.  I&#39;ve not studied it in detail, nor experimented.  I looked at Wikipedia <a href=\"https://en.wikipedia.org/wiki/Lagrange_polynomial\" rel=\"nofollow noreferrer\">Lagrange Polynomial</a> but I&#39;m not sure how what&#39;s shown there works when applied to your rather simple scenario (simple in terms of &quot;it is a straight line graph&quot; \u2014 complex in that there are a couple hundred terms to add in the formulae, unless I&#39;m misreading it all).  200 additions give problems."}, {"owner": {"reputation": 30474, "user_id": 2875563, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/umbJB.jpg?s=128&g=1", "display_name": "Reblochon Masque", "link": "https://stackoverflow.com/users/2875563/reblochon-masque"}, "edited": false, "score": 0, "creation_date": 1524102785, "post_id": 49908218, "comment_id": 86838895, "body": "You need to use the barycentric Lagrange interpolation for stability."}], "answers": [{"tags": [], "owner": {"reputation": 6882, "user_id": 3403834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpA5S.jpg?s=128&g=1", "display_name": "user58697", "link": "https://stackoverflow.com/users/3403834/user58697"}, "is_accepted": true, "score": 2, "last_activity_date": 1524096074, "creation_date": 1524096074, "answer_id": 49910698, "question_id": 49908218, "link": "https://stackoverflow.com/questions/49908218/lagrange-interpolation-algorithm-in-c-diverges-after-many-steps/49910698#49910698", "title": "Lagrange Interpolation Algorithm in C Diverges After Many Steps", "body": "<p>Given <code>N</code> samples, the Lagrange polynomial is of the degree of <code>N</code>, in your case, 200. It is a pretty large degree, and for a <code>value</code> large enough the intermediate results (i.e. <code>factor</code>) starts behaving quite erratically. I printed <code>factor</code> after each iteration of the outer loop, and this is what I have on my machine (where the code diverges at <code>value</code> 62.1):</p>\n\n<pre><code>    Input is: 62.100000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000002\n        -0.000010\n        0.000047\n        -0.000212\n        0.000916\n        -0.003834\n        0.015558\n        -0.061214\n        0.233667\n        -0.865800\n        3.115490\n        -10.892598\n        37.019453\n        -122.351630\n        393.413839\n        -1231.176112\n        3751.320027\n        -11132.603776\n        32188.920849\n        -90709.929863\n        249216.884601\n        -667734.556134\n        1745251.075381\n        -4451006.398268\n        11079451.201015\n        -26924437.939740\n        63892139.532124\n        -148088119.614110\n        335320733.480250\n        -741923910.135582\n        1604370277.576735\n        -3391407192.476863\n        7009154161.161494\n        -14165714298.372702\n        28000907070.092331\n        -54142322716.578796\n        102423636122.796417\n        -189594810732.400879\n        343460854643.929565\n        -608991796878.604858\n        1057024952593.679688\n        -1796190002106.606201\n        2988571833231.810547\n        -4869319260810.958008\n        7769844431032.450195\n        -12143392562153.164062\n        18590594785582.515625\n        -27881222667878.292969\n        40966915113033.500000\n        -58978430272092.585938\n        83200365623915.609375\n        -115016713573880.578125\n        155822462931701.031250\n        -206899948714767.906250\n        269263745978734.968750\n        -343484172924072.000000\n        429506076055356.812500\n        -526485323131795.875000\n        632668952077638.500000\n        -745344926690223.250000\n        860883054405210.375000\n        -974879663742953.625000\n        1082405867199472.750000\n        -1178344322529343.250000\n        1257784740974879.500000\n        -1316436663535827.500000\n        1351011674779421.000000\n        -1359527880018181.000000\n        1341497535715305.750000\n        -1297973187760748.750000\n        1231446261994579.000000\n        -1145611653890577.250000\n        1045029162299372.250000\n        -934724762872858.125000\n        819779917571950.250000\n        -704954924193421.250000\n        594383648437451.875000\n        -491363855983359.125000\n        398252366806871.062500\n        -316460003024013.937500\n        246529925760965.156250\n        -188275766805651.375000\n        140953330916004.437500\n        -103441104978326.546875\n        74409294797142.390625\n        -52463275136077.218750\n        36253867741005.359375\n        -24552698830046.890625\n        16295359517452.095703\n        -10597930155882.712891\n        6753701701870.307617\n        -4216931244837.877441\n        2579609371842.192871\n        -1545902253614.920410\n        907502140862.699341\n        -521815325006.697205\n        293869684950.453308\n        -162078786010.080200\n        87537719445.039368\n        -46294138480.248749\n        23970808358.990040\n        -12151499571.568396\n        6030219319.167710\n        -2929269302.567177\n        1392763710.430415\n        -648125926.103312\n        295175902.544337\n        -131559694.388017\n        57381635.324659\n        -24492187.039684\n        10230449.673919\n        -4182126.956840\n        1673313.368037\n        -655394.261464\n        251347.530884\n        -94414.677824\n        34753.964878\n        -12544.686326\n        4444.407825\n        -1547.546444\n        530.612164\n        -179.651152\n        60.317931\n        -20.218974\n        6.844738\n        -2.391284\n        0.904560\n        -0.429040\n        1.136162\n        0.029430\n        -0.003145\n        0.000450\n        -0.000070\n        0.000011\n        -0.000002\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n        0.000000\n        -0.000000\n    Output is: 67.164298\n</code></pre>\n\n<p>Sorry for the volume of paste.</p>\n\n<p>You can see that the code operates with very large <code>factor</code>s (e.g. <code>155822462931701.031250</code>) while <code>sum</code> stays around 1. This leads to loss of precision due to normalization. And the loss of precision amplifies as  <code>value</code> grows.</p>\n\n<p>Bottom line is, the naive Lagrange interpolation is numerically unstable. Check out <a href=\"https://en.wikipedia.org/wiki/Lagrange_polynomial#Notes\" rel=\"nofollow noreferrer\">Notes</a>.</p>\n"}], "owner": {"reputation": 357, "user_id": 6317692, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/08fc3b47488367878c7d9ad65d9a1687?s=128&d=identicon&r=PG&f=1", "display_name": "Leigh K", "link": "https://stackoverflow.com/users/6317692/leigh-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 49910698, "answer_count": 1, "score": 0, "last_activity_date": 1524096074, "creation_date": 1524082089, "last_edit_date": 1524082678, "question_id": 49908218, "link": "https://stackoverflow.com/questions/49908218/lagrange-interpolation-algorithm-in-c-diverges-after-many-steps", "title": "Lagrange Interpolation Algorithm in C Diverges After Many Steps", "body": "<p>I have a Lagrange interpolation algorithm that begins to diverge after many time steps and I can't seem to figure out why. As a quick review, if I had two arrays</p>\n\n<pre><code>int x[11] = {0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100}\nint y[11] = {0,  2,  4,  6,  8, 10, 12, 14, 16, 18,  20}\n</code></pre>\n\n<p>and I input an x-value of 15 into the algorithm, the output (i.e. interpolated y-value) should be 3. The following algorithm gets the interpolated value correct, but as I cycle through incremented inputs eventually the outputs begin to diverge. I am not sure what is causing the divergence. The code creates two arrays of integers going from -100 to +100 and interpolates the values based on an incremented x-input. The values begin matching as they should, but around 55 or so the interpolated y-value begins to diverge. The code is below. Any insight would be greatly appreciated.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\n#define SIZE 201\n\nint main()\n{\n    double x[SIZE], y[SIZE], value, sum, factor[SIZE];\n    for (int i = 0; i &lt; SIZE; i++)\n    {\n        x[i] = -100 + i;\n    }\n    for (int i = 0; i &lt; SIZE; i++)\n    {\n        y[i] = -100 + i;\n    }\n    value = 0.0;\n    while (1)\n    {   \n        sum = 0.0;  \n        printf(\"Input is: %lf\\n\", value);\n        for(int i = 0; i &lt; SIZE; i++)\n        {\n            factor[i] = 1.0;\n            for(int j = 0; j &lt; SIZE; j++)\n            {\n                if(i != j)\n                {\n                    factor[i] = factor[i] * (value - x[j])/(x[i] - x[j]);\n                }   \n            }\n            sum = sum + factor[i] * y[i];\n         }\n         printf(\"Output is: %lf\\n\", sum);\n//       if ((value - sum) &gt; 0.01) break;\n         if (value &lt; 100) value += 0.001;\n         else break;\n    }\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "function"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 1, "creation_date": 1524082096, "post_id": 49908185, "comment_id": 86832259, "body": "The <code>main</code> function is where the program begins execution.  That is ingrained into the language."}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 2, "creation_date": 1524082439, "post_id": 49908185, "comment_id": 86832447, "body": "<a href=\"//stackoverflow.com/q/3469955\">In C, how is the main() method initially called?</a>"}, {"owner": {"reputation": 105028, "user_id": 134554, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1894f68e0b15fd3d5b27bfcb021fa11c?s=128&d=identicon&r=PG", "display_name": "John Bode", "link": "https://stackoverflow.com/users/134554/john-bode"}, "edited": false, "score": 0, "creation_date": 1524082557, "post_id": 49908185, "comment_id": 86832509, "body": "On a hosted implementation (basically, anything with an operating system), the host environment calls <code>main</code> when you invoke the program.  On a freestanding environment (i.e., an embedded system), the program entry point doesn&#39;t have to be <code>main</code>."}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "edited": false, "score": 0, "creation_date": 1524085185, "post_id": 49908185, "comment_id": 86833786, "body": "There has to be one function not called by your code but by something else. Otherwise how would your code start executing?"}, {"owner": {"reputation": 927, "user_id": 466932, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/424347075f5b5405bfb7ca79a9aa264b?s=128&d=identicon&r=PG", "display_name": "Unmanned Player", "link": "https://stackoverflow.com/users/466932/unmanned-player"}, "edited": false, "score": 0, "creation_date": 1524117336, "post_id": 49908185, "comment_id": 86842787, "body": "main() is meant for the operating system to call. See Linux source for how it starts a program."}], "answers": [{"tags": [], "owner": {"reputation": 3420, "user_id": 1530134, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d6b1b610a6302fd94ff9f8971a4f1899?s=128&d=identicon&r=PG", "display_name": "Alyssa Haroldsen", "link": "https://stackoverflow.com/users/1530134/alyssa-haroldsen"}, "is_accepted": false, "score": 2, "last_activity_date": 1524082107, "creation_date": 1524082107, "answer_id": 49908222, "question_id": 49908185, "link": "https://stackoverflow.com/questions/49908185/why-don-t-we-have-to-call-main-function-in-c/49908222#49908222", "title": "Why don\u2019t we have to call main function in C?", "body": "<p>The <code>main</code> function is defined by the <a href=\"http://en.cppreference.com/w/c/language/main_function\" rel=\"nofollow noreferrer\">language itself</a> as the designated start of the program. You don't need to call it because, in effect, your operating system (Linux, macOS, Windows, etc.) does.</p>\n"}], "owner": {"reputation": 11, "user_id": 9666350, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Professional Noobie", "link": "https://stackoverflow.com/users/9666350/professional-noobie"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 1, "closed_date": 1524082217, "answer_count": 1, "score": -3, "last_activity_date": 1524084562, "creation_date": 1524081951, "last_edit_date": 1524084562, "question_id": 49908185, "link": "https://stackoverflow.com/questions/49908185/why-don-t-we-have-to-call-main-function-in-c", "closed_reason": "Needs details or clarity", "title": "Why don\u2019t we have to call main function in C?", "body": "<p>I just had a question that whenever I write code I  had to call all functions (predefined or user defined) in order to use or execute them. So why we don't have to call main function?</p>\n"}, {"tags": ["c", "arrays", "char", "malloc"], "comments": [{"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 1, "creation_date": 1524081278, "post_id": 49907931, "comment_id": 86831837, "body": "nchars is 0 when you do malloc()"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524081297, "post_id": 49907931, "comment_id": 86831848, "body": "this would be a good time to point out that you should check the return status of <code>malloc</code>.  In this case, it would have returned <code>NULL</code> because you tried to pass in a size of <code>0</code>."}, {"owner": {"reputation": 19, "user_id": 9454471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61d1c8ffbff94351294824ec7444bd55?s=128&d=identicon&r=PG&f=1", "display_name": "Ami", "link": "https://stackoverflow.com/users/9454471/ami"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1524081308, "post_id": 49907931, "comment_id": 86831857, "body": "@SteveSummit sorry that was my mistake when adding my code. It was originally the right way around and still not working."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524081354, "post_id": 49907931, "comment_id": 86831881, "body": "Okay, now I&#39;ll bring back my first comment.  Is the issue that you aren&#39;t taking into account that you need space for the terminating NULL character?"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 2, "creation_date": 1524081371, "post_id": 49907931, "comment_id": 86831888, "body": "@Ami Please figure out a way to copy and paste <i>exactly</i> the code you&#39;re running on your computer.  If you&#39;re retyping it, it&#39;s too easy to make a mistake which means we&#39;re not seeing what your compiler is seeing which makes it <i>impossible</i> to debug!"}, {"owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524081408, "post_id": 49907931, "comment_id": 86831912, "body": "@ChristianGibbons from the way it&#39;s printed (character by character) it looks like the null terminator isn&#39;t required."}, {"owner": {"reputation": 19, "user_id": 9454471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61d1c8ffbff94351294824ec7444bd55?s=128&d=identicon&r=PG&f=1", "display_name": "Ami", "link": "https://stackoverflow.com/users/9454471/ami"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1524081573, "post_id": 49907931, "comment_id": 86831996, "body": "@SteveSummit Yep sorry, I did that orginally but when I was showing different iteraltions I messed around with it rathar than recopying all my iterations. My mistake I will make sure to not do that again. The code I have right now is the exact code I am running to make that clear to all!"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524081940, "post_id": 49907931, "comment_id": 86832176, "body": "Ah, okay, running it in a debugger found the problem quickly.  <code>\\n</code> is the first character being read into the array."}, {"owner": {"reputation": 19, "user_id": 9454471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61d1c8ffbff94351294824ec7444bd55?s=128&d=identicon&r=PG&f=1", "display_name": "Ami", "link": "https://stackoverflow.com/users/9454471/ami"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524082324, "post_id": 49907931, "comment_id": 86832379, "body": "@ChristianGibbons if you don&#39;t mind me asking, what debugger are you using or how? I am currently at the end of a beginner level C class at my university and the prof has not mentioned debugging c code other than simply reading over lines and some simple tags in cygwin terminal"}, {"owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "edited": false, "score": 0, "creation_date": 1524082451, "post_id": 49907931, "comment_id": 86832453, "body": "gdb is the go-to debugger for C/C++ on linux (and I imagine cygwin supports it too). It has a bit of a learning curve especially for beginner programmers but it&#39;s definitely worth it. Most IDEs like visual studio come with their own built in debugger. Other than that there&#39;s also the usual method of adding lots of <code>printf</code> statements everywhere."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 1, "creation_date": 1524082496, "post_id": 49907931, "comment_id": 86832480, "body": "@ChristianGibbons <i>In this case, it would have returned <code>NULL</code> because you tried to pass in a size of <code>0</code>.</i>  No. Per <a href=\"https://port70.net/~nsz/c/c11/n1570.html#J.1\" rel=\"nofollow noreferrer\">the C standard</a>, the return value of <code>malloc()</code> when passed zero bytes is <b>unspecified</b>:  &quot;The following are unspecified: ... The amount of storage allocated by a successful call to the calloc, malloc, or realloc function when 0 bytes was requested&quot;  When passed zero, <code>malloc()</code> is free to return <code>NULL</code> or a pointer to a zero-byte buffer."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1524083640, "post_id": 49907931, "comment_id": 86833062, "body": "Sounds like the problem is resolved, but the other solution that must be mentioned is <i>don&#39;t use scanf</i>.  In this case, plain <code>getchar</code> would be easier and more straightforward in every way.  (And IMO there are virtually no uses of <code>scanf</code> that are preferable to their more reliable, non-scanf alternatives.)"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1524083642, "post_id": 49907931, "comment_id": 86833064, "body": "@AndrewHenle I see.  I was relying on the man-pages which said <code>NULL may also be returned by a successful call to malloc() with a size of zero</code>"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524083934, "post_id": 49907931, "comment_id": 86833206, "body": "@ChristianGibbons <i>I was relying on the man-pages which said ...</i> That means your implementation has specified what happens.  Different implementations are free to behave differently, and the implementation in use here isn&#39;t clearly identified, if it&#39;s identified at all."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524084104, "post_id": 49907931, "comment_id": 86833283, "body": "@Ami As Kevin mentioned, GDB is the go-to.  While starting out, you&#39;ll likely be more comfortable working in an IDE which should have built in support for debugging tools.  With a debugger you&#39;ll be able to step through code a line at a time and take a peek at the states of variables."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 9454471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61d1c8ffbff94351294824ec7444bd55?s=128&d=identicon&r=PG&f=1", "display_name": "Ami", "link": "https://stackoverflow.com/users/9454471/ami"}, "edited": false, "score": 0, "creation_date": 1524082168, "post_id": 49908188, "comment_id": 86832294, "body": "Ahhhhh, thank you good sir! I would have never thought of that."}], "tags": [], "owner": {"reputation": 5074, "user_id": 5522303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c236ba3d52af53355a4d1a44a5145b04?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5522303/kevin"}, "is_accepted": false, "score": 2, "last_activity_date": 1524081958, "creation_date": 1524081958, "answer_id": 49908188, "question_id": 49907931, "link": "https://stackoverflow.com/questions/49907931/why-is-array-of-chars-printing-one-less-char-than-needed-after-dynamically-alloc/49908188#49908188", "title": "Why is array of chars printing one less char than needed after dynamically allocating memory with malloc()?", "body": "<p>The problem is that <code>scanf(\"%d\", ...)</code> leaves the newline character in the input stream. When you get to the <code>scanf(\"%c\\n\", ...)</code> it reads the newline and the character you typed stays in the input stream, meaning you're off by one. You'll notice that in your output there's a blank line before <code>amii</code> is printed.</p>\n\n<p>The solution is to have <code>scanf</code> skip whitespace. Change your loop to this:</p>\n\n<pre><code>for (int i = 0; i &lt; nchars; ++i) {\n    scanf(\" %c\", &amp;arr[i]);\n}\n</code></pre>\n\n<p>Putting a space before the <code>%c</code> means <em>skip leading whitespace</em>.</p>\n"}], "owner": {"reputation": 19, "user_id": 9454471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61d1c8ffbff94351294824ec7444bd55?s=128&d=identicon&r=PG&f=1", "display_name": "Ami", "link": "https://stackoverflow.com/users/9454471/ami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524081958, "creation_date": 1524081045, "last_edit_date": 1524081678, "question_id": 49907931, "link": "https://stackoverflow.com/questions/49907931/why-is-array-of-chars-printing-one-less-char-than-needed-after-dynamically-alloc", "title": "Why is array of chars printing one less char than needed after dynamically allocating memory with malloc()?", "body": "<p>The problem I am facing is that if I enter in 5 characters into an array using a loop that scanf's each character separately it only prints out 4 of the characters in the array (using a loop again). This problem does not arise if I do not dynamically allocate memory to the array.</p>\n\n<pre><code> int main() {\n\n    int nchars = 0;\n    char* arr = NULL; \n\n\n    printf(\"Enter number of characters you want in string: \"); scanf(\"%d\", &amp;nchars);\n\n    arr = (char*)malloc(nchars * sizeof(char));\n\n    printf(\"Enter characters you want in the array: \\n\");\n    for (int i = 0; i &lt; nchars; ++i) {\n        scanf(\"%c\\n\", &amp;arr[i]);\n    }\n\n    for (int i = 0; i &lt; nchars; ++i) {\n        printf(\"%c\", arr[i]);\n    }\n\n    free(arr);\n    return 0;\n}\n</code></pre>\n\n<p>Terminal:</p>\n\n<pre><code>Enter number of characters you want in string: 5\nEnter characters you want in the array:\na\nm\ni\ni\ni\n\namii (output)\n</code></pre>\n\n<p>If I do not put a \\n after the %c in the scan statement it only scans two chars and outputs them on new lines like this:</p>\n\n<pre><code>Enter number of characters you want in string: 5\nEnter characters you want in the array:\na\nm\n\na\nm\n</code></pre>\n\n<p>I have tried different variations where I would create a temp array and strcpy() to the dynamically allocated char arr but still nothing. As well as: </p>\n\n<pre><code>arr = (char*)malloc((nchars + 1) * sizeof(char));\n</code></pre>\n\n<p>To see if allocating one more byte would add the last letter.</p>\n"}, {"tags": ["c", "gcc", "gstreamer", "rtsp"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 2624689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5042ce5dcb2dde953295cfd8fb5ac13?s=128&d=identicon&r=PG", "display_name": "Shalin Upadhyay", "link": "https://stackoverflow.com/users/2624689/shalin-upadhyay"}, "is_accepted": true, "score": 1, "last_activity_date": 1524083030, "creation_date": 1524083030, "answer_id": 49908453, "question_id": 49907889, "link": "https://stackoverflow.com/questions/49907889/gstreamer-compiling-with-rtsp-server/49908453#49908453", "title": "GStreamer - Compiling with RTSP Server", "body": "<p>Found the solution, apprently I was using pkg-config the wrong way. The new <code>gcc</code> command I used is:</p>\n\n<pre><code> gcc stream.c -o stream $(pkg-config --cflags --libs gstreamer-rtsp-server-1.0 gstreamer-1.0)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 2624689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5042ce5dcb2dde953295cfd8fb5ac13?s=128&d=identicon&r=PG", "display_name": "Shalin Upadhyay", "link": "https://stackoverflow.com/users/2624689/shalin-upadhyay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1392, "favorite_count": 0, "accepted_answer_id": 49908453, "answer_count": 1, "score": 1, "last_activity_date": 1524083030, "creation_date": 1524080870, "question_id": 49907889, "link": "https://stackoverflow.com/questions/49907889/gstreamer-compiling-with-rtsp-server", "title": "GStreamer - Compiling with RTSP Server", "body": "<p>I'm trying to compile a gstreamer program with rtsp-server. I've included the necessary header files and get this error after trying to compile it.</p>\n\n<pre><code>In function `main':\nstream.c:(.text+0x36): undefined reference to `gst_rtsp_server_new'\nstream.c:(.text+0x46): undefined reference to `gst_rtsp_server_get_mount_points'\nstream.c:(.text+0x4f): undefined reference to `gst_rtsp_media_factory_new'\nstream.c:(.text+0x64): undefined reference to `gst_rtsp_media_factory_set_launch'\nstream.c:(.text+0x75): undefined reference to `gst_rtsp_media_factory_set_shared'\nstream.c:(.text+0x8a): undefined reference to `gst_rtsp_mount_points_add_factory'\nstream.c:(.text+0xa7): undefined reference to `gst_rtsp_server_attach'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>I've tried compiling the program a few different ways based on:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/7143581/gst-rtsp-server-programming\">Gst RTSP server programming</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/14904246/gstreamer-rtsp-server-linking-in-qt-creator?rq=1\">Gstreamer rtsp server linking in Qt Creator</a></p>\n\n<p>The exact <code>gcc</code> commands I've used are:</p>\n\n<pre><code>gcc stream.c -o stream `pkg-config --cflags --libs gstreamer-rtsp-1.0 gstreamer-1.0`\n</code></pre>\n\n<p>and</p>\n\n<pre><code>gcc `pkg-config gstreamer-1.0 gstreamer-rtsp-1.0 --cflags` stream.c -o stream `pkg-config gstreamer-1.0 gstreamer-rtsp-1.0 --libs`\n</code></pre>\n\n<p>Any help would be great, thanks!</p>\n"}, {"tags": ["c++", "c", "macros", "c-preprocessor"], "comments": [{"owner": {"reputation": 916, "user_id": 4743979, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/30aac06a8fa100d4bd5076dbbb09ce15?s=128&d=identicon&r=PG&f=1", "display_name": "DutChen18", "link": "https://stackoverflow.com/users/4743979/dutchen18"}, "edited": false, "score": 1, "creation_date": 1524080268, "post_id": 49907716, "comment_id": 86831296, "body": "NAME##_2 might work"}], "answers": [{"comments": [{"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1524081694, "post_id": 49907739, "comment_id": 86832050, "body": "Caveat to the solution is that if <code>NAME</code> is itself a macro, it will not be expanded in the second expanded line, where as it would get expanded in the first line."}], "tags": [], "owner": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "is_accepted": true, "score": 4, "last_activity_date": 1524080236, "creation_date": 1524080236, "answer_id": 49907739, "question_id": 49907716, "link": "https://stackoverflow.com/questions/49907716/macro-variable-is-not-expanded-if-directly-followed-by-chars-that-form-a-valid-i/49907739#49907739", "title": "Macro variable is not expanded if directly followed by chars that form a valid identifier", "body": "<p>You can use <code>##</code> glue:</p>\n\n<pre><code>#define DECLARE(NAME) \\\n   int NAME;         \\\n   int NAME##_2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "is_accepted": false, "score": 3, "last_activity_date": 1524080254, "creation_date": 1524080254, "answer_id": 49907742, "question_id": 49907716, "link": "https://stackoverflow.com/questions/49907716/macro-variable-is-not-expanded-if-directly-followed-by-chars-that-form-a-valid-i/49907742#49907742", "title": "Macro variable is not expanded if directly followed by chars that form a valid identifier", "body": "<p>The final line of your macro could be</p>\n\n<pre><code>int NAME##_2\n</code></pre>\n\n<p>which would do it. <code>##</code> <em>concatenates</em> tokens. </p>\n"}], "owner": {"reputation": 7277, "user_id": 6205379, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dPsLh.png?s=128&g=1", "display_name": "Timo", "link": "https://stackoverflow.com/users/6205379/timo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 49907739, "answer_count": 2, "score": -1, "last_activity_date": 1524081284, "creation_date": 1524080142, "question_id": 49907716, "link": "https://stackoverflow.com/questions/49907716/macro-variable-is-not-expanded-if-directly-followed-by-chars-that-form-a-valid-i", "title": "Macro variable is not expanded if directly followed by chars that form a valid identifier", "body": "<p>Given a preprocessor macro like</p>\n\n<pre><code>#define DECLARE(NAME) \\\n    int NAME;         \\\n    int NAME_2\n</code></pre>\n\n<p><code>Name_2</code> denotes a new identifier. Is it possible to expand <code>Name</code>, so that </p>\n\n<pre><code>DECLARE(x);\n</code></pre>\n\n<p>becomes </p>\n\n<pre><code>int x;\nint x_2;\n</code></pre>\n"}, {"tags": ["c", "assembly"], "comments": [{"owner": {"reputation": 15569, "user_id": 2302862, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e264db339bb96e343770fa38018e00f1?s=128&d=identicon&r=PG", "display_name": "Siguza", "link": "https://stackoverflow.com/users/2302862/siguza"}, "edited": false, "score": 1, "creation_date": 1524079652, "post_id": 49907562, "comment_id": 86830974, "body": "AFAIK gcc uses AT&amp;T syntax by default, whereas nasm uses Intel."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1524079950, "post_id": 49907562, "comment_id": 86831131, "body": "Beats me why you would show the original C code rather then the generated assembler for which the error was issued.  The assembly code generated by gcc is intended to be assembled using gas rather then nasm perhaps?"}, {"owner": {"reputation": 513, "user_id": 8293226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ccfWx.png?s=128&g=1", "display_name": "mustachioed", "link": "https://stackoverflow.com/users/8293226/mustachioed"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1524080061, "post_id": 49907562, "comment_id": 86831198, "body": "Take a look at this: <a href=\"https://stackoverflow.com/questions/199966/how-do-you-use-gcc-to-generate-assembly-code-in-intel-syntax\" title=\"how do you use gcc to generate assembly code in intel syntax\">stackoverflow.com/questions/199966/&hellip;</a> as recommended by @Clifford."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 513, "user_id": 8293226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ccfWx.png?s=128&g=1", "display_name": "mustachioed", "link": "https://stackoverflow.com/users/8293226/mustachioed"}, "edited": false, "score": 0, "creation_date": 1524080241, "post_id": 49907562, "comment_id": 86831282, "body": "@MustacheMoses : Don&#39;t put words into my mouth.  I did not recommend anything.  The question is about assembling the generated assembler, the link you have given is about how to generate the assembly code in the first instance - I am assuming he has done that bit, although the evidence is not provided.  My only suggestion was that the assembly code be posted not the C.  But the answer is I am pretty certain to use gas not nasm."}, {"owner": {"reputation": 513, "user_id": 8293226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ccfWx.png?s=128&g=1", "display_name": "mustachioed", "link": "https://stackoverflow.com/users/8293226/mustachioed"}, "reply_to_user": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "edited": false, "score": 0, "creation_date": 1524080761, "post_id": 49907562, "comment_id": 86831547, "body": "@Clifford Sorry, I should have worded that differently..."}, {"owner": {"reputation": 37, "user_id": 9557460, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u05e0\u05d9\u05e8\u05d9\u05d9\u05d1 \u05e9\u05de\u05d5\u05d0\u05dc", "link": "https://stackoverflow.com/users/9557460/%d7%a0%d7%99%d7%a8%d7%99%d7%99%d7%91-%d7%a9%d7%9e%d7%95%d7%90%d7%9c"}, "reply_to_user": {"reputation": 513, "user_id": 8293226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ccfWx.png?s=128&g=1", "display_name": "mustachioed", "link": "https://stackoverflow.com/users/8293226/mustachioed"}, "edited": false, "score": 0, "creation_date": 1524081398, "post_id": 49907562, "comment_id": 86831905, "body": "@MustacheMoses when typing gcc -S -masm=intel main.c it generates an main.s file and doesnt show error but when trying to compile with the command nasm -f elf main.s it generate the same errors."}, {"owner": {"reputation": 37, "user_id": 9557460, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u05e0\u05d9\u05e8\u05d9\u05d9\u05d1 \u05e9\u05de\u05d5\u05d0\u05dc", "link": "https://stackoverflow.com/users/9557460/%d7%a0%d7%99%d7%a8%d7%99%d7%99%d7%91-%d7%a9%d7%9e%d7%95%d7%90%d7%9c"}, "edited": false, "score": 0, "creation_date": 1524116332, "post_id": 49907562, "comment_id": 86842389, "body": "help please I cant compile for some reason"}, {"owner": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "edited": false, "score": 2, "creation_date": 1524120301, "post_id": 49907562, "comment_id": 86844213, "body": "Your problem is that gcc does not output code intended to be assembled by nasm.  It&#39;s expecting you to use gas, and there are some differences.  I supposed you could try <a href=\"https://stackoverflow.com/a/20743090/2189500\">this</a>, but there might still be tweaks you&#39;d have to do."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524147883, "post_id": 49907562, "comment_id": 86862812, "body": "the posted C code does not cleanly compile.  Strongly suggest fixing the problems in the C code before trying to convert to asm.  ( for <code>gcc</code>, at a minimum use: <code>-Wall -Wextra -Wconversion -pedantic -std=gnu11</code> )"}], "owner": {"reputation": 37, "user_id": 9557460, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u05e0\u05d9\u05e8\u05d9\u05d9\u05d1 \u05e9\u05de\u05d5\u05d0\u05dc", "link": "https://stackoverflow.com/users/9557460/%d7%a0%d7%99%d7%a8%d7%99%d7%99%d7%91-%d7%a9%d7%9e%d7%95%d7%90%d7%9c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524079846, "creation_date": 1524079499, "question_id": 49907562, "link": "https://stackoverflow.com/questions/49907562/converting-code-from-c-to-assemly", "title": "Converting code from c to assemly", "body": "<p>I cant convert a c code to assembly code properly </p>\n\n<p>the code is </p>\n\n<pre><code>    #include &lt;stdio.h&gt;      /* Standard Library of Input and Output */\n   #include &lt;complex.h&gt;    /* Standard Library of Complex Numbers */\n\n\n double complex power(double complex value, int power){\n     double complex result=1;\n    for (int i=0;i&lt;power;i++){\n        result  = result * value;\n    }\n    return result;\n }\n\n  double complex function(double order,double complex * array,double complex value) // a function that calculates f(x)\n  {\n    double complex result=0;\n     for (int i = order ; i &gt;= 0 ; i--){\n      result = result + array[i]*(power(value,i));\n  }\n   //printf(\"the value of f(x) is:  = %.10f %+.10fi\\n\",creal(result), cimag(result));\n  return result;\n } \ndouble complex derivefunction(double order,double complex * array,double complex value,double complex * darray){\n  for (int i = order-1 ; i &gt;= 0 ; i--){\n       darray[i] = array[i+1]*(i+1);\n}\nreturn function(order-1,darray,value);\n\n  }\n   double abs(double m){//absolute\n    if (m&lt;0) \n        return -m;\n    return m;\n  }\n\n  int main(void) {\n\n\n   double tol,order;\n   double arrayr[100];//assuming the maximum order is 0\n   double arrayi[100];\n   double complex array[100];\n\n    printf(\"Enter the tolarence:\\n\");\n    scanf(\"%lf\", &amp;tol);\n    printf(\"the toleracnce is: %.10f\\n\",tol);\n\n\nprintf(\"Enter the order\\n\");\nscanf(\"%lf\", &amp;order);\nprintf(\"the order is: %lf\\n\",order);\n\n\nfor (int i = order ; i &gt;= 0 ; i--){\n    printf(\"Enter the %d coeficience\\n\",i);\n    scanf(\"%lf\", &amp;(arrayr[i]));//taking the real number\n    scanf(\"%lf\", &amp;(arrayi[i]));// taking the imaginary number\n    array[i] = arrayr[i] + arrayi[i] * I;//summing the complex number\n    printf(\"The %d coeficience is  = %.2f %+.2fi\\n\",i ,creal(array[i]), cimag(array[i]));\n}\n\n\ndouble initialr, initiali;\ndouble complex initial;\nprintf(\"Enter the initial value of z(the guss) \\n\");\nscanf(\"%lf\", &amp;initialr);//taking the real number\nscanf(\"%lf\", &amp;initiali);// taking the imaginary number\ninitial = initialr + initiali*I;\n\nprintf(\"The initial is  = %.2f %+.2fi\\n\", creal(initial), cimag(initial));\ndouble complex result1 = function(order,array,initial);\n\n\n\n     if (order &gt; 0) {\n\n    double complex darray[sizeof(array)];\n    double complex result2 = derivefunction(order,array,initial,darray);\n\n\n\n    //now the newton-rashford method\n      double complex m = result1/result2;//the initial\n    while (abs((double)(m)) &gt;= tol)//if it is in the range\n  {\n\n        m = function(order,array,initial) / derivefunction(order,array,initial,darray);//f(x)/f'(x)\n        initial = initial - m;\n        //printf(\"The initial is  = %.10f %+.10fi\\n\", creal(initial), cimag(initial));\n  }\n  printf(\"The root is  = %.10f %+.10fi\\n\", creal(initial), cimag(initial));\n }\n\nreturn 0;\n\n  }\n</code></pre>\n\n<p>I used the command gcc -S -O main.c to create an assembly file called main.s\nbut when I try to compile the assembly file I get many errors</p>\n\n<pre><code>    nasm -g -f elf64 -w+all -o main.o main.s\n    main.s:1: error: attempt to define a local label before any non-local labels\n    main.s:1: error: parser: instruction expected\n    main.s:2: error: attempt to define a local label before any non-local labels\n</code></pre>\n\n<p>and so on.. I think it relates to the fact that I use complex number but I am not sure how to fix this.</p>\n"}, {"tags": ["c", "linux", "pipe"], "comments": [{"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 0, "creation_date": 1524081713, "post_id": 49907432, "comment_id": 86832058, "body": "In the child, do <code>close(mypipefd[1])</code> before exiting. Also, check the return on <code>write(mypipefd[1],buf,nbytes)</code> as pipes can return partial writes (i.e. you may need an inner loop inside your while loop). Also, parent should do <code>close(mypipefd[0])</code> after the read loop it. Then, parent should do <code>waitpid(pid,NULL,0)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 9630627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a4e166f1be36452a06241d7431dba10?s=128&d=identicon&r=PG&f=1", "display_name": "Taknie", "link": "https://stackoverflow.com/users/9630627/taknie"}, "edited": false, "score": 0, "creation_date": 1524127260, "post_id": 49908717, "comment_id": 86848347, "body": "Code works, but i don&#39;t understand what does &quot;for&quot; loop do here. Also I&#39;d like to avoid &#39;fwrite()&#39; function. Instead, I want the sending information to be displayed at every loop and it&#39;s length have to be dependent on &#39;BUFSIZE&#39; defined. For example i have &quot;This is random text&quot; in my input file. Program have to display: &quot;buf: This is ra&quot; then &quot;buf: ndom text&quot;. At last, I need to implement error handling everywhere. As far as I know, I still need it in &#39;write()&#39; function between #if 0 and #else, also for &#39;close()&#39; between #if 1 #endif, and for &#39;waitpid()&#39;. Where else could I implement them?"}, {"owner": {"reputation": 109, "user_id": 9630627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a4e166f1be36452a06241d7431dba10?s=128&d=identicon&r=PG&f=1", "display_name": "Taknie", "link": "https://stackoverflow.com/users/9630627/taknie"}, "edited": false, "score": 0, "creation_date": 1524309424, "post_id": 49908717, "comment_id": 86926742, "body": "Thank you for your help. I added error handling everywhere, also I modified int main() to get argv[] and now I declare my input/output .txt files while opening program. Now I&#39;m about to modify the program to use named pipes. I have to open FIFO pipe in the program and turn on producer/consumer processes there. So I tried to do that and this is what I did: <code>int fifo; \tmkfifo(&quot;fifo.fifo&quot;, 0666);</code> then in the child process <code>fifo = open(&quot;fifo.fifo&quot;, O_WRONLY);</code> and in parent process <code>fifo = open(&quot;fifo.fifo&quot;, O_RDONLY);</code> and <code>unlink(&quot;fifo.fifo&quot;);</code> at the end. Program stops  at &quot;ERROR CLOSING PIPE&quot;"}], "tags": [], "owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "is_accepted": false, "score": 1, "last_activity_date": 1524161884, "last_edit_date": 1524161884, "creation_date": 1524084205, "answer_id": 49908717, "question_id": 49907432, "link": "https://stackoverflow.com/questions/49907432/sending-information-with-unnamed-pipes/49908717#49908717", "title": "Sending information with unnamed pipes", "body": "<p>The primary bug was that the <em>parent</em> must do <code>close(mypipefd[1])</code> <em>before</em> the parent read loop (and <em>not</em> after). This prevented the parent from seeing EOF on the pipe after the child was done writing.</p>\n\n<p>Also, you were missing a <code>waitpid</code> in the parent.</p>\n\n<p>The <code>printf</code> for <code>buf</code> in the parent was in the wrong place [after the read loop]. At that point, <code>buf</code> can't be guaranteed to have the correct data or that it's correctly zero-terminated. That's why stdout had some garbage chars at the end.</p>\n\n<p>So, In addition to outputting to the output file, the loop should output to stdout, but should use <code>fwrite</code> as <code>buf</code> can't be guaranteed to be zero terminated.</p>\n\n<p>I had missed that in my initial post, so I've corrected it.</p>\n\n<p>As per my top comments, the child should loop on a [possible] partial write to  the pipe. I coded that.</p>\n\n<p>Here's the version with the bugs annotated and fixed:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;time.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/wait.h&gt;\n#define BUFSIZE 25\n\nint main( int argc, char *argv[] ) {\n\n    srand(time(NULL));\n    pid_t pid;\n    int mypipefd[2];\n    int ret;\n    char buf[BUFSIZE];\n    int output;\n    int stream;\n    int nbytes;\n\n    ret = pipe(mypipefd);\n    if( ret == -1 ) {\n        perror( \"pipe error\");\n        exit(1);\n    }\n\n    pid = fork();\n    if( pid == -1 ) {\n        perror( \"FORK ERROR...\");\n        exit(2);\n    }\n\n    if( pid == 0 ) {\n        /* CHILD */\n        printf(\" Child process...\\n\");\n        stream = open(\"input.txt\", O_RDONLY);\n        if (close(mypipefd[0]) == -1 ) {\n            perror(\"ERROR CLOSING PIPE\");\n            exit(3);\n        }\n\n        while ( (nbytes = read(stream, buf, BUFSIZE)) &gt; 0 ) {\n            sleep(rand() %2);\n\n#if 0\n            write(mypipefd[1], buf, nbytes );\n#else\n            // NOTE: this _should_ work but adds extra at the end\n            int off;\n            int wlen;\n            for (off = 0;  nbytes &gt; 0;  off += wlen, nbytes -= wlen) {\n                wlen = write(mypipefd[1], buf + off, nbytes );\n                if (wlen &lt;= 0)\n                    break;\n            }\n#endif\n        }\n\n        if ( close(stream) == -1 ) {\n        perror(\"ERROR CLOSING STREAM\");\n        exit(4);\n        }\n\n        // NOTE/FIX: child must close it's side of the pipe\n#if 1\n        close(mypipefd[1]);\n#endif\n    }\n\n    else {\n        /* PARENT */\n        printf(\" Parent process...\\n\");\n\n        // NOTE/FIX: this must be closed _before_ the read loop -- holding it\n        // open prevents parent from seeing EOF on pipe\n#if 1\n        if (close(mypipefd[1]) == -1 ) {\n            perror(\"ERROR CLOSING PIPE\");\n            exit(6);\n        }\n#endif\n\n#if 1\n        printf(\"buf: \");\n#endif\n\n        output = open(\"output.txt\", O_CREAT | O_WRONLY, 00777);\n        while ( (nbytes = read(mypipefd[0], buf, BUFSIZE)) &gt; 0 ) {\n            write(output, buf, nbytes);\n#if 1\n            fwrite(buf,1,nbytes,stdout);\n#endif\n        }\n\n        // NOTE/BUG: the buffer at this point will only have the data from\n        // the _last_ read and may not be null terminated\n#if 0\n        printf(\"buf: %s\\n\", buf);\n#else\n        printf(\"\\n\");\n#endif\n\n        if (close(output) == -1) {\n            perror(\"ERROR CLOSING OUTPUT\");\n            exit(5);\n        }\n\n        // NOTE/BUG: this must be closed _before_ the parent's read loop\n#if 0\n        if (close(mypipefd[1]) == -1 ) {\n            perror(\"ERROR CLOSING PIPE\");\n            exit(6);\n        }\n#endif\n\n        // NOTE/FIX: this is missing (prevents orphan/zombie child process)\n#if 1\n        waitpid(pid,NULL,0);\n#endif\n    }\n\n    return 0;\n}\n</code></pre>\n\n<hr>\n\n<p><strong>UPDATE:</strong></p>\n\n<blockquote>\n  <p>but i don't understand what does \"for\" loop do here</p>\n</blockquote>\n\n<p>A write to a pipe can generate a \"short write\" (e.g. you want to write 20 but the return value (i.e. number of bytes <em>actually</em> written) comes back with 15. You have to index into the buffer and write the remaining bytes in subsequent writes.</p>\n\n<p>There is a kernel limit on how many bytes can be written in a single atomic write (e.g.) if you did <code>write(mypipefd[1],buf,10000000)</code>, the kernel doesn't have space allocated for such a large write, so it will return the value of what it could append to the pipe buffer [in the kernel].</p>\n\n<p>Also, let's say the kernel pipe buffer can hold 64 bytes. And you write buffers of size 64 to it. Maybe the reader is reading only 32 bytes. So, the first write is fine. Then reader reads out 32 bytes. So, the next write to the pipe of 64, there is only space for 32 bytes, so the write will return 32</p>\n\n<blockquote>\n  <p>Program have to display: \"buf: This is ra\" then \"buf: ndom text\"</p>\n</blockquote>\n\n<p>Okay, I've fixed that</p>\n\n<blockquote>\n  <p>At last, I need to implement error handling everywhere.</p>\n</blockquote>\n\n<p>I've annotated places where I'd add error and handling, along with some things to look for.</p>\n\n<p>Anyway, here's an updated version. I've left in the <code>// NOTE/*</code> comments but removed the <code>#if/#endif</code> pairs to make an easier read.</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;time.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/wait.h&gt;\n#define BUFSIZE 25\n\nint\nmain(int argc, char *argv[])\n{\n\n    srand(time(NULL));\n    pid_t pid;\n    int mypipefd[2];\n    int ret;\n    char buf[BUFSIZE];\n    int output;\n    int stream;\n    int nbytes;\n\n    ret = pipe(mypipefd);\n    if (ret == -1) {\n        perror(\"pipe error\");\n        exit(1);\n    }\n\n    pid = fork();\n    if (pid == -1) {\n        perror(\"FORK ERROR...\");\n        exit(2);\n    }\n\n    if (pid == 0) {\n        /* CHILD */\n        printf(\" Child process...\\n\");\n        stream = open(\"input.txt\", O_RDONLY);\n        if (close(mypipefd[0]) == -1) {\n            perror(\"ERROR CLOSING PIPE\");\n            exit(3);\n        }\n\n        while ((nbytes = read(stream, buf, BUFSIZE)) &gt; 0) {\n            sleep(rand() % 2);\n\n            // NOTE/FIX: writing to pipes _can_ generate a _short_ write. that\n            // is, (e.g.) if the length given to write is 20, the return value\n            // may be only 15. this means that the remaining 5 bytes must be\n            // sent in a second/subsequent write\n            int off;\n            int wlen;\n            for (off = 0;  nbytes &gt; 0;  off += wlen, nbytes -= wlen) {\n                wlen = write(mypipefd[1], buf + off, nbytes);\n                if (wlen &lt; 0) {\n                    perror(\"ERROR WRITING TO FILE\");\n                    exit(3);\n                }\n                if (wlen == 0)\n                    break;\n            }\n        }\n\n        if (close(stream) == -1) {\n            perror(\"ERROR CLOSING STREAM\");\n            exit(4);\n        }\n\n        // NOTE/FIX: child must close it's side of the pipe\n        // NOTE/ERRCODE: check error code here\n        close(mypipefd[1]);\n    }\n\n    else {\n        /* PARENT */\n        printf(\" Parent process...\\n\");\n\n        // NOTE/FIX: this must be closed _before_ the read loop -- holding it\n        // open prevents parent from seeing EOF on pipe\n        if (close(mypipefd[1]) == -1) {\n            perror(\"ERROR CLOSING PIPE\");\n            exit(6);\n        }\n\n        // NOTE/ERRCODE: this should be checked for -1 (i.e. output file\n        // could not be opened for file permission, etc. or other reasons\n        // similar to those for the file write below)\n        output = open(\"output.txt\", O_CREAT | O_WRONLY, 00777);\n\n        // NOTE/FIX: we read one less than buffer size to allow for adding an\n        // artificial zero byte at the end\n        while ((nbytes = read(mypipefd[0], buf, BUFSIZE - 1)) &gt; 0) {\n            // NOTE/ERRCODE: error handling _could_ be added here but it would\n            // be rare (e.g. filesystem has an I/O error because it's full or\n            // marked R/O because of an I/O error on the underlying disk)\n            write(output, buf, nbytes);\n\n            // write partial buffer to stdout\n            buf[nbytes] = 0;\n            printf(\"buf: %s\\n\",buf);\n        }\n\n        if (close(output) == -1) {\n            perror(\"ERROR CLOSING OUTPUT\");\n            exit(5);\n        }\n\n        // NOTE/FIX: this is missing (prevents orphan/zombie child process)\n        // NOTE/ERRCODE: yes, this _can_ have an error return but here it's\n        // unlikely because we _know_ that pid is valid\n        // what can be done is to do:\n        //   int status;\n        //   waitpid(pid,&amp;status,0)\n        // then process the return code from the child using the W* macros\n        // provided (e.g. WIFEXITED, WSTATUS) on status\n        waitpid(pid, NULL, 0);\n    }\n\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 9630627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a4e166f1be36452a06241d7431dba10?s=128&d=identicon&r=PG&f=1", "display_name": "Taknie", "link": "https://stackoverflow.com/users/9630627/taknie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524161884, "creation_date": 1524079006, "question_id": 49907432, "link": "https://stackoverflow.com/questions/49907432/sending-information-with-unnamed-pipes", "title": "Sending information with unnamed pipes", "body": "<p>My program have to send some bytes of information by using unnamed pipes.\nI have a txt file named \"input\" which is supposed to be read by the program and it's information have to be send and write in another file named \"output\". Also i must use read(), write(), open() functions.\nMy code look like this:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;sys/stat.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;time.h&gt;\n#include &lt;string.h&gt;\n#define BUFSIZE 25\n\nint main( int argc, char *argv[] ) {\n\n    srand(time(NULL));\n    pid_t pid;\n    int mypipefd[2];\n    int ret;\n    char buf[BUFSIZE];\n    int output;\n    int stream;\n    int nbytes;\n    ret = pipe(mypipefd);\n\n    if( ret == -1 ) {\n        perror( \"pipe error\");\n        exit(1);\n    }\n    pid = fork();\n\n    if( pid == -1 ) {\n        perror( \"FORK ERROR...\");\n        exit(2);\n    }\n    if( pid == 0 ) {\n        /* CHILD */\n        printf(\" Child process...\\n\");\n        stream = open(\"input.txt\", O_RDONLY);\n        if (close(mypipefd[0]) == -1 ) {\n            perror(\"ERROR CLOSING PIPE\");\n            exit(3);\n        }\n        while ( (nbytes = read(stream, buf, BUFSIZE)) &gt; 0 ) {\n            sleep(rand() %2);\n            write(mypipefd[1], buf, nbytes );\n        }\n        if ( close(stream) == -1 ) {\n        perror(\"ERROR CLOSING STREAM\");\n        exit(4);\n        }\n    }\n    else {\n        /* PARENT */\n        printf(\" Parent process...\\n\");\n        output = open(\"output.txt\", O_CREAT | O_WRONLY, 00777);\n        while ( (nbytes = read(mypipefd[0], buf, BUFSIZE)) &gt; 0 ) {\n            write(output, buf, nbytes);\n        }\n        printf(\"buf: %s\\n\", buf);\n        if (close(output) == -1) {\n            perror(\"ERROR CLOSING OUTPUT\");\n            exit(5);\n        }\n        if (close(mypipefd[1]) == -1 ) {\n            perror(\"ERROR CLOSING PIPE\");\n            exit(6);\n        }\n    }\n\n\n    return 0;\n\n}\n</code></pre>\n\n<p>Unfortunately the code is not working <a href=\"https://i.stack.imgur.com/L0SWn.png\" rel=\"nofollow noreferrer\">terminal screen</a></p>\n\n<p>Before I tried while loop and was sending all the information at once, it worked, but output file looked like this <a href=\"https://i.stack.imgur.com/lVljb.png\" rel=\"nofollow noreferrer\">output file</a></p>\n\n<p>while the input file look like this <a href=\"https://i.stack.imgur.com/G6PF9.png\" rel=\"nofollow noreferrer\">input file</a></p>\n"}, {"tags": ["c", "matrix"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524079093, "post_id": 49907388, "comment_id": 86830654, "body": "Explain what the mentioned line <code>guardarMatriz(int matriz[3][3]);</code> does in your opinion."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524079983, "post_id": 49907388, "comment_id": 86831156, "body": "One problem is in function <code>llenarMatriz</code> which I guess you want to return a 2D array, but actually returns a single element from a local array with <code>return matriz[3][3];</code> which sadly is out of the array bounds anyway."}, {"owner": {"reputation": 131, "user_id": 6496600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qyUgB.jpg?s=128&g=1", "display_name": "Stan Strum", "link": "https://stackoverflow.com/users/6496600/stan-strum"}, "edited": false, "score": 0, "creation_date": 1524080914, "post_id": 49907388, "comment_id": 86831625, "body": "This is windows C, right? Not POSIX or *nix? I&#39;m just guessing from the path. Also, is this written in Spanish?"}], "answers": [{"tags": [], "owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "is_accepted": false, "score": 1, "last_activity_date": 1524079259, "creation_date": 1524079259, "answer_id": 49907497, "question_id": 49907388, "link": "https://stackoverflow.com/questions/49907388/when-compiling-i-get-this-error-i-do-not-know-what-is-wrong/49907497#49907497", "title": "when compiling I get this error, I do not know what is wrong", "body": "<p>You have two problems in your code.  First you don't initialize a 2-D array correctly.  It should look like this:</p>\n\n<pre><code>int matriz[3][3]={{1,2,3},{4,5,6},{7,8,9}};\n</code></pre>\n\n<p>second, you don't pass a type name to the function call to declare your variable, so it should look like this:</p>\n\n<pre><code>    int matriz[3][3];\n    llenarMatriz();\n    guardarMatriz(matriz);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 35932, "user_id": 1606345, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/IwiIM.png?s=128&g=1", "display_name": "David Ranieri", "link": "https://stackoverflow.com/users/1606345/david-ranieri"}, "is_accepted": false, "score": 0, "last_activity_date": 1524081755, "last_edit_date": 1524081755, "creation_date": 1524080143, "answer_id": 49907717, "question_id": 49907388, "link": "https://stackoverflow.com/questions/49907388/when-compiling-i-get-this-error-i-do-not-know-what-is-wrong/49907717#49907717", "title": "when compiling I get this error, I do not know what is wrong", "body": "<pre><code>guardarMatriz(int matriz[3][3]);\n</code></pre>\n\n<p>Don't include the type and the dimensions when passing parameters to a function.</p>\n\n<p>Also, when you call a function returning something, you should use the correct type (an <code>int</code> is not able to return a 2D array of <code>int</code>), and you must store the return somewhere.</p>\n\n<p>In this case you can return a compound literal:</p>\n\n<pre><code>void *llenarMatriz(void)\n{    \n    return (int [][3]){{1,2,3},{4,5,6},{7,8,9}}; \n}\n</code></pre>\n\n<p>and in <code>main</code>:</p>\n\n<pre><code>int main(void) /* void is the correct argument for `main` */\n{\n    int (*matriz)[3] = llenarMatriz(); /* A pointer to an array of int 3 */\n\n    guardarMatriz(matriz);  \n    system(\"pause\");  \n    return 0;  \n} \n</code></pre>\n\n<p>If you don't want to declare the array inside <code>main</code> you can use the result of the first function as the argument of the second one:</p>\n\n<pre><code>guardarMatriz(llenarMatriz());  \n</code></pre>\n\n<p>or you can pass the compound literal directly:</p>\n\n<pre><code>guardarMatriz((int [][3]){{1,2,3},{4,5,6},{7,8,9}});  \n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 9666102, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Antwoord", "link": "https://stackoverflow.com/users/9666102/antwoord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1524081755, "creation_date": 1524078836, "last_edit_date": 1524080583, "question_id": 49907388, "link": "https://stackoverflow.com/questions/49907388/when-compiling-i-get-this-error-i-do-not-know-what-is-wrong", "title": "when compiling I get this error, I do not know what is wrong", "body": "<p>I'm passing a matrix to a text file</p>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>#include &lt;stdio.h&gt;  \n#include &lt;stdlib.h&gt;  \n#include &lt;string.h&gt;  \n\n\nint llenarMatriz() {   \n    int matriz[3][3]={1,2,3,4,5,6,7,8,9};   \n    return matriz[3][3]; \n}\n\n\nvoid guardarMatriz(int matriz[3][3]) {  \n    char direccion[]=\"C:\\\\Users\\\\Usuario\\\\Desktop\\\\DIBU.txt\";  \n    FILE *archivo = fopen(direccion, \"w\");  \n    if (archivo == NULL) {  \n        exit(EXIT_FAILURE);  \n    }  \n    char linea[20];  \n    sprintf(linea, \"%d %d\\n\", 3, 3);  \n    fputs(linea, archivo);  \n    for (int i = 0; i &lt; 3; i++) {  \n        linea[0] = '\\0';  \n        for (int j = 0; j &lt; 3; j++){  \n            char buffer[10];  \n            sprintf(buffer, \"%d \", matriz[3][3]);  \n            strcat(linea, buffer);  \n        }  \n        int len = strlen(linea);  \n        linea[len - 1] = '\\n';  \n        fputs(linea,archivo);  \n    }  \n    fclose(archivo);  \n}    \nint main() {  \n    llenarMatriz();  \n    guardarMatriz(int matriz[3][3]);  \n    system(\"pause\");  \n    return 0;  \n}  \n</code></pre>\n\n<p><strong>Error message;</strong></p>\n\n<pre><code>In function 'main':  \nerror: expected expression before 'int'  \n  guardarMatriz(int matriz[3][3]);\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1524077895, "post_id": 49907101, "comment_id": 86830048, "body": "-7 is not ~7, you are off by 1: 11111000"}, {"owner": {"reputation": 2784, "user_id": 8413636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8c46d1ea221e93d32a1b3d2ee354cae?s=128&d=identicon&r=PG&f=1", "display_name": "zzxyz", "link": "https://stackoverflow.com/users/8413636/zzxyz"}, "edited": false, "score": 0, "creation_date": 1524078937, "post_id": 49907101, "comment_id": 86830566, "body": "<code>calculator</code> in Windows (programmer mode), or <code>gdb</code> (<code>p&#47;t ~7</code> ...see <code>help x</code>), or <code>wcalc</code> are all good tools to use to check your assumptions."}], "answers": [{"tags": [], "owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "is_accepted": false, "score": 3, "last_activity_date": 1524078318, "last_edit_date": 1524078318, "creation_date": 1524077927, "answer_id": 49907138, "question_id": 49907101, "link": "https://stackoverflow.com/questions/49907101/bitwise-operators-decimal-and-hexa/49907138#49907138", "title": "Bitwise operators. Decimal and Hexa", "body": "<p>-7 (indeed 11111001)<br>\nis not ~7 (11111000)  </p>\n\n<p>You are off by 1.</p>\n\n<pre><code>11111000\n&amp;\n00001111\n==\n00001000\n</code></pre>\n\n<p>is true.</p>\n\n<p><em>(This answer follows the questions obvious lead, in using a simplified 8 bit model for the involved values.)</em></p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 9666085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43c3470c4abad02a1236b2d1cf7b883d?s=128&d=identicon&r=PG&f=1", "display_name": "Marco M\u0103rcule\u0163", "link": "https://stackoverflow.com/users/9666085/marco-m%c4%83rcule%c5%a3"}, "edited": false, "score": 0, "creation_date": 1524078746, "post_id": 49907223, "comment_id": 86830458, "body": "Basically, ~ is for one&#39;s complement, and - is for two&#39;s ?"}, {"owner": {"reputation": 1, "user_id": 9666085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43c3470c4abad02a1236b2d1cf7b883d?s=128&d=identicon&r=PG&f=1", "display_name": "Marco M\u0103rcule\u0163", "link": "https://stackoverflow.com/users/9666085/marco-m%c4%83rcule%c5%a3"}, "edited": false, "score": 0, "creation_date": 1524079652, "post_id": 49907223, "comment_id": 86830975, "body": "If you don&#39;t mind, can you explain why the output from here is 2? <code>int a = 2;</code> <code>if (a &gt;&gt; 1)</code> <code>printf(&quot;%d\\n&quot;, a);</code> Isn&#39;t shifting the bits one time to the right?  from 0010 to 0001?"}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "reply_to_user": {"reputation": 1, "user_id": 9666085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43c3470c4abad02a1236b2d1cf7b883d?s=128&d=identicon&r=PG&f=1", "display_name": "Marco M\u0103rcule\u0163", "link": "https://stackoverflow.com/users/9666085/marco-m%c4%83rcule%c5%a3"}, "edited": false, "score": 0, "creation_date": 1524079899, "post_id": 49907223, "comment_id": 86831112, "body": "@MarcoM\u0103rcule\u0163, If you look at the bits of the last byte for <code>2</code>, it is <code>00000010</code>. If you right shift the bits by one, you get <code>00000001</code>, which is <code>1</code>. <code>if ( a &gt;&gt; 1 )</code> translates to <code>if ( 1 )</code>. <code>a &gt;&gt; 2</code> does not change the value of <code>a</code> to <code>1</code>. It just evaluates to <code>1</code>. To change <code>a</code>, you can use <code>a &gt;&gt;= 1</code>."}, {"owner": {"reputation": 1, "user_id": 9666085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43c3470c4abad02a1236b2d1cf7b883d?s=128&d=identicon&r=PG&f=1", "display_name": "Marco M\u0103rcule\u0163", "link": "https://stackoverflow.com/users/9666085/marco-m%c4%83rcule%c5%a3"}, "edited": false, "score": 0, "creation_date": 1524080407, "post_id": 49907223, "comment_id": 86831356, "body": "That makes sense. Let me get the &quot; &gt;&gt;= &quot; part, because it&#39;s new for me. In words you can explain it like: &quot;shift it to the right one time and change the value also&quot;?"}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "reply_to_user": {"reputation": 1, "user_id": 9666085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43c3470c4abad02a1236b2d1cf7b883d?s=128&d=identicon&r=PG&f=1", "display_name": "Marco M\u0103rcule\u0163", "link": "https://stackoverflow.com/users/9666085/marco-m%c4%83rcule%c5%a3"}, "edited": false, "score": 0, "creation_date": 1524080723, "post_id": 49907223, "comment_id": 86831518, "body": "@MarcoM\u0103rcule\u0163, that&#39;s correct. it&#39;s similar to using <code>a += 10</code>."}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "reply_to_user": {"reputation": 1, "user_id": 9666085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43c3470c4abad02a1236b2d1cf7b883d?s=128&d=identicon&r=PG&f=1", "display_name": "Marco M\u0103rcule\u0163", "link": "https://stackoverflow.com/users/9666085/marco-m%c4%83rcule%c5%a3"}, "edited": false, "score": 0, "creation_date": 1524081064, "post_id": 49907223, "comment_id": 86831717, "body": "@MarcoM\u0103rcule\u0163, you are welcome. I am glad I was able to help."}, {"owner": {"reputation": 76010, "user_id": 168986, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/MqorX.jpg?s=128&g=1", "display_name": "Clifford", "link": "https://stackoverflow.com/users/168986/clifford"}, "reply_to_user": {"reputation": 1, "user_id": 9666085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43c3470c4abad02a1236b2d1cf7b883d?s=128&d=identicon&r=PG&f=1", "display_name": "Marco M\u0103rcule\u0163", "link": "https://stackoverflow.com/users/9666085/marco-m%c4%83rcule%c5%a3"}, "edited": false, "score": 0, "creation_date": 1524081088, "post_id": 49907223, "comment_id": 86831730, "body": "@MarcoM\u0103rcule\u0163 : SO is not a discussion forum, if you have more questions, post new questions, do not start a semi-private discussion in the comments.  The questions about what specific operators do can be answered using any C reference text."}], "tags": [], "owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "is_accepted": true, "score": 1, "last_activity_date": 1524078229, "creation_date": 1524078229, "answer_id": 49907223, "question_id": 49907101, "link": "https://stackoverflow.com/questions/49907101/bitwise-operators-decimal-and-hexa/49907223#49907223", "title": "Bitwise operators. Decimal and Hexa", "body": "<blockquote>\n  <p>From what I know ~7 = 11111001 and 0x000f= 00001111</p>\n</blockquote>\n\n<p>That's incorrect from two points of view.</p>\n\n<ol>\n<li><p>7 is of type <code>int</code>. If you are on a platform where <code>sizeof(int)</code> is 4, <code>7</code> in binary will be <code>00000000 00000000 00000000 0000111</code>. Hence, <code>~7</code> will be <code>1111111 11111111 11111111 1111000</code>.</p></li>\n<li><p>Even if you ignore the first 3 bytes, the bits of the last byte are also different.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 9, "user_id": 12931660, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gzabk-IjjL4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3regHYQq6HixCm5PViUcKsVXEFlONg/photo.jpg?sz=128", "display_name": "Nikita Rawool", "link": "https://stackoverflow.com/users/12931660/nikita-rawool"}, "is_accepted": false, "score": 1, "last_activity_date": 1582268137, "creation_date": 1582268137, "answer_id": 60333529, "question_id": 49907101, "link": "https://stackoverflow.com/questions/49907101/bitwise-operators-decimal-and-hexa/60333529#60333529", "title": "Bitwise operators. Decimal and Hexa", "body": "<p>here 7=00000111 1's complement of7 is 11111000 hex code of 0X0000f =00001111 bitwise and operation of 11111000 &amp; 00001111=00001000 so ans is 8 i.e non-zero value so if loop get executed it will print \"Honesty is the best policy\".</p>\n"}], "owner": {"reputation": 1, "user_id": 9666085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43c3470c4abad02a1236b2d1cf7b883d?s=128&d=identicon&r=PG&f=1", "display_name": "Marco M\u0103rcule\u0163", "link": "https://stackoverflow.com/users/9666085/marco-m%c4%83rcule%c5%a3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "accepted_answer_id": 49907223, "answer_count": 3, "score": -1, "last_activity_date": 1582268137, "creation_date": 1524077804, "last_edit_date": 1524077860, "question_id": 49907101, "link": "https://stackoverflow.com/questions/49907101/bitwise-operators-decimal-and-hexa", "title": "Bitwise operators. Decimal and Hexa", "body": "<p>Good evening.</p>\n\n<p>Can someone explain me why the following code runs the message from IF condition?</p>\n\n<pre><code>if ((~7 &amp; 0x000f) == 8)\n   printf(\"Honesty is the best policy\\n\");\n</code></pre>\n\n<p>From what I know ~7 = 11111001 and 0x000f= 00001111</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["c", "sockets"], "answers": [{"tags": [], "owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "is_accepted": true, "score": 1, "last_activity_date": 1524079538, "last_edit_date": 1524079538, "creation_date": 1524078577, "answer_id": 49907316, "question_id": 49907071, "link": "https://stackoverflow.com/questions/49907071/limiting-the-number-of-udp-packets-in-send-queue/49907316#49907316", "title": "limiting the number of udp packets in send queue", "body": "<p>To change the size of the <em>kernel</em> send socket buffer (in <em>bytes</em>), use <code>SO_SNDBUF</code>.</p>\n\n<p>The default behavior is blocking, but you can modify this so the socket is non-blocking (with the <code>SOCK_NONBLOCK</code> option on the <code>socket</code> call). Otherwise, you could set <code>O_NONBLOCK</code> with an <code>fcntl</code> call.</p>\n\n<p>Then, you'd get back an error code of <code>EAGAIN/EWOULDBLOCK</code> instead of blocking on your <code>send</code> call.</p>\n\n<p>You can also use either <code>select</code> or <code>poll</code> syscalls to control waiting.</p>\n\n<p>There are also <code>ioctl</code> calls to check the current number of bytes in the queue, such as <code>TIOCINQ</code> for the receive queue or <code>TIOCOUTQ</code> for the send queue.</p>\n\n<p>Note that, again, because you're using UDP, none of the above would guarantee delivery through the network as any other node in the path could drop the packet(s). The above only guarantees that the originating node won't drop due to buffer overflow.</p>\n\n<p>What is [usually] more useful is to increase the size of the corresponding <em>kernel</em> receive buffer with <code>SO_RCVBUF</code> to allow large bursts to be received without the kernel dropping as much. Because of UDP, this is <em>not</em> a guarantee that the local node will <em>not</em> drop anything, but it can limit the number of drops.</p>\n"}], "owner": {"reputation": 1206, "user_id": 3047822, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/RDyN1.png?s=128&g=1", "display_name": "apramc", "link": "https://stackoverflow.com/users/3047822/apramc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 49907316, "answer_count": 1, "score": 2, "last_activity_date": 1524079538, "creation_date": 1524077696, "question_id": 49907071, "link": "https://stackoverflow.com/questions/49907071/limiting-the-number-of-udp-packets-in-send-queue", "title": "limiting the number of udp packets in send queue", "body": "<p>is there a way to limit the number of UDP packets in the send queue?!</p>\n\n<p>like </p>\n\n<pre><code>setsockopt(SO_SOCK, SO_SND_QUEUE_DGRAMS, value, length)\n</code></pre>\n\n<p>if so, what would the behavior if the queue is full ?! dropping packets, or waiting for the queue to transmit the packets to network</p>\n"}, {"tags": ["c", "sorting", "unix", "pthreads"], "comments": [{"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524077197, "post_id": 49906422, "comment_id": 86829698, "body": "What&#39;s the point of having 10 worker threads when only one worker runs at a time? And you are only sorting blocks of 100 numbers, your are not sorting the whole array."}, {"owner": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "reply_to_user": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524077322, "post_id": 49906422, "comment_id": 86829762, "body": "@Pablo It seems that soring subranges of 100 items is desired behavior."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "reply_to_user": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1524077660, "post_id": 49906422, "comment_id": 86829937, "body": "@VTT yes, that may be true, but as the OP has not really specified whether this is the desired behaviour, it&#39;s still worth pointing it out."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7231246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1309509012426952/picture?type=large", "display_name": "Giorgos Diamantopoulos", "link": "https://stackoverflow.com/users/7231246/giorgos-diamantopoulos"}, "edited": false, "score": 0, "creation_date": 1524077855, "post_id": 49906904, "comment_id": 86830028, "body": "Thank you, I feel dumb now, Yeah I joined the threads in the same loop so i could see what each thread prints without it being a cluster caused by 10 threads printing in parallel.Thank you again mate."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "reply_to_user": {"reputation": 3, "user_id": 7231246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1309509012426952/picture?type=large", "display_name": "Giorgos Diamantopoulos", "link": "https://stackoverflow.com/users/7231246/giorgos-diamantopoulos"}, "edited": false, "score": 0, "creation_date": 1524077997, "post_id": 49906904, "comment_id": 86830107, "body": "@GiorgosDiamantopoulos about the threads: OK, if this was just for testing purposes. Otherwise it didn&#39;t make sense."}], "tags": [], "owner": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "is_accepted": true, "score": 2, "last_activity_date": 1524077142, "creation_date": 1524077142, "answer_id": 49906904, "question_id": 49906422, "link": "https://stackoverflow.com/questions/49906422/threads-will-only-sort-the-first-partition-of-the-array-bubble-sort-pthread/49906904#49906904", "title": "Threads will only sort the first partition of the array (Bubble sort, Pthread)", "body": "<p>Inner loop exit condition makes it immediately exit if <code>first</code> is not 0. It should be </p>\n\n<pre><code>for (j = first; j &lt; last + first - i; j++)\n</code></pre>\n\n<p>Also those 10 threads are rather pointless because they don't run in parallel. You should move join into separate loop.</p>\n"}], "owner": {"reputation": 3, "user_id": 7231246, "user_type": "registered", "profile_image": "https://graph.facebook.com/1309509012426952/picture?type=large", "display_name": "Giorgos Diamantopoulos", "link": "https://stackoverflow.com/users/7231246/giorgos-diamantopoulos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 0, "accepted_answer_id": 49906904, "answer_count": 1, "score": 0, "last_activity_date": 1524077142, "creation_date": 1524075315, "last_edit_date": 1524076074, "question_id": 49906422, "link": "https://stackoverflow.com/questions/49906422/threads-will-only-sort-the-first-partition-of-the-array-bubble-sort-pthread", "title": "Threads will only sort the first partition of the array (Bubble sort, Pthread)", "body": "<p>I am trying to sort an array with length of 1000 using 10 threads. The first thread is 0 to 99 and the second is 100 to 199.... My problem is that only the first 100 elements are sorted and the rest are left untouched even though the threads run as expected in all aspects other than sorting.</p>\n\n<pre><code>#define N 1000\nint arr[N];\nint main(int argc, char *argv[])\n{\n\n    int i;\n\n    //Filling the array with random integers\n    for(i=0;i&lt;N;i++)\n    {\n        arr[i]=1+rand()%200;\n    }\n\n    for(i=0;i&lt;N;i++)\n    {\n        printf(\"%d | \",arr[i]);\n    }\n    printf(\"\\n\");\n\n    /*      START OF THREAD SECTION    */\n\n    pthread_t sorters[10];\n\n    for(i=0;i&lt;10;i++)\n    {\n        pthread_create(&amp;sorters[i],NULL,sortArr,(void*)i);\n        pthread_join(sorters[i],NULL);\n    }\n\n    /*      END OF THREAD SECTION     */\n\n\n    return 0;\n}\n</code></pre>\n\n<p>thread:</p>\n\n<pre><code>void* sortArr(void *num)\n{\n    int i,j,temp,cast,first=0,last;\n\n    //Casting\n    cast=(intptr_t)num;\n\n    //Calculating first and last element\n    first=(cast*100);   \n    last=first+99;\n\n    printf(\"first %d , last %d \\n\",first,last);\n\n    printf(\"Not sorted:\\n\");\n    for(i=first;i&lt;last;i++)\n    {\n        printf(\"%d | \",arr[i]);\n    }   \n    printf(\"\\n\");\n\n    /*    SORTING */\n    for (i = first; i &lt; last-1; i++)\n    {  \n        for (j = first; j &lt; last-i; j++)\n        {\n            if (arr[j] &gt; arr[j+1])\n            {\n                temp=arr[j];\n                arr[j]=arr[j+1];\n                arr[j+1]=temp;\n            }\n        }\n    }\n    /*    SORTING */\n\n    printf(\"Sorted:\\n\");\n    for(i=first;i&lt;last;i++)\n    {\n        printf(\"%d | \",arr[i]);\n    }   \n    printf(\"\\n\");\n}\n</code></pre>\n\n<p>With my current knowledge I can only try so many things to figure it out and any help would be much appreciated. </p>\n"}, {"tags": ["c", "macos"], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 4750318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b145b5d7dedc367e2ab6a061c7f57f5?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/4750318/daniel"}, "edited": false, "score": 0, "creation_date": 1524078667, "post_id": 49906339, "comment_id": 86830413, "body": "it should work with a simple #include &quot;GetFrontApplication.h&quot; right? When I compile it I get a &quot;Undefined symbols for architecture x86_64&quot; should I add something to the compiling instruction, other than &quot;gcc -o front front.c &quot;?"}, {"owner": {"reputation": 15118, "user_id": 7258538, "user_type": "registered", "profile_image": "https://graph.facebook.com/10102111546405895/picture?type=large", "display_name": "Charles Srstka", "link": "https://stackoverflow.com/users/7258538/charles-srstka"}, "reply_to_user": {"reputation": 97, "user_id": 4750318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b145b5d7dedc367e2ab6a061c7f57f5?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/4750318/daniel"}, "edited": false, "score": 0, "creation_date": 1524086882, "post_id": 49906339, "comment_id": 86834444, "body": "@Daniel At the very least you will need to compile both <code>front.c</code> and <code>GetFrontApplication.m</code>. You also need to link against the Cocoa framework, but since I used <code>@import</code>, that should automatically happen as long as you use <code>-fmodules</code> in the command line. So, something like: <code>gcc -fmodules -o front front.c GetFrontApplication.m</code> should do it."}], "tags": [], "owner": {"reputation": 15118, "user_id": 7258538, "user_type": "registered", "profile_image": "https://graph.facebook.com/10102111546405895/picture?type=large", "display_name": "Charles Srstka", "link": "https://stackoverflow.com/users/7258538/charles-srstka"}, "is_accepted": true, "score": -1, "last_activity_date": 1524094175, "last_edit_date": 1524094175, "creation_date": 1524074978, "answer_id": 49906339, "question_id": 49906145, "link": "https://stackoverflow.com/questions/49906145/how-to-get-the-id-of-the-application-receiving-key-strokes-in-c-for-macos/49906339#49906339", "title": "How to get the id of the application receiving key strokes in C for macos?", "body": "<p>The UI layer on macOS is all written in Objective-C, which you can't easily call from straight C code (well, technically, you could use <code>objc_msgSend()</code>, but trust me, you don't want to do that). Fortunately, the amount of Objective-C code you'll need to do this is quite small, and you can separate it out into a separate file which you include from your C code:</p>\n\n<p>GetFrontApplication.h:</p>\n\n<pre><code>#ifndef GETFRONTAPPLICATION_H\n#define GETFRONTAPPLICATION_H\n\nchar *GetFrontmostApplication(void);\n\n#endif /* GETFRONTAPPLICATION_H */\n</code></pre>\n\n<p>GetFrontApplication.m:</p>\n\n<pre><code>@import Cocoa;\n\nchar *GetFrontmostApplication(void) {\n    @autoreleasepool {\n        NSRunningApplication *frontApp = [[NSWorkspace sharedWorkspace] frontmostApplication];\n\n        return strdup(frontApp.localizedName.UTF8String);\n    }\n}\n</code></pre>\n\n<p>Now you can just <code>#include \"GetFrontApplication.h\"</code> and call <code>GetFrontmostApplication()</code> from your C code, and you'll get a <code>char *</code> containing the name of the application. Make sure to <code>free()</code> the string after you're done with it.</p>\n"}], "owner": {"reputation": 97, "user_id": 4750318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b145b5d7dedc367e2ab6a061c7f57f5?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/4750318/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 49906339, "answer_count": 1, "score": 0, "last_activity_date": 1524094175, "creation_date": 1524074300, "question_id": 49906145, "link": "https://stackoverflow.com/questions/49906145/how-to-get-the-id-of-the-application-receiving-key-strokes-in-c-for-macos", "title": "How to get the id of the application receiving key strokes in C for macos?", "body": "<p>I'm writing a program in C for OS X (for the terminal). As mentioned in the title, just need the id and/or name of the application receiving the keystrokes i.e. the focused window. </p>\n\n<p>I've found the you can use <a href=\"https://developer.apple.com/documentation/appkit/nsworkspace/1532097-frontmostapplication\" rel=\"nofollow noreferrer\">frontmostApplication</a> but I can't use it in C or can't figure out how to do it. I'm new to writing stuff in macOS, any help much appreciated.</p>\n"}, {"tags": ["c", "http", "parsing"], "comments": [{"owner": {"reputation": 827, "user_id": 7383242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c65444c41048c45464ae10a9cafa0c41?s=128&d=identicon&r=PG&f=1", "display_name": "medalib", "link": "https://stackoverflow.com/users/7383242/medalib"}, "edited": false, "score": 0, "creation_date": 1524075052, "post_id": 49906017, "comment_id": 86828491, "body": "Your call to <code>phr_parse_request</code> is wrong."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524077419, "post_id": 49906017, "comment_id": 86829816, "body": "The third argument expects a <code>const char**</code>, you are passing an incompatible type (the error message is clear enough), because you are passing a <code>const char*</code>."}], "answers": [{"tags": [], "owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "is_accepted": false, "score": 1, "last_activity_date": 1524079939, "creation_date": 1524079939, "answer_id": 49907662, "question_id": 49906017, "link": "https://stackoverflow.com/questions/49906017/passing-a-buffer-to-picohttpparser-results-in-compile-error/49907662#49907662", "title": "Passing a buffer to picohttpparser results in compile error", "body": "<p>I went to their github page and this is what they say before the code:</p>\n\n<blockquote>\n  <p>The example below reads an HTTP request from socket <code>sock</code> using <code>read(2)</code>, parses it using <code>phr_parse_request</code>, and prints the details.</p>\n</blockquote>\n\n<p>The function <code>phr_parse_request</code> parses a request made to the server, so it need\nto write what kind of request (GET,POST,DELETE,etc), that's why the function\nexpects a <code>const char**</code>.</p>\n\n<p>The functions looks like this:</p>\n\n<pre><code>int phr_parse_request(const char *buf_start, size_t len, const char **method, size_t *method_len, const char **path,\nsize_t *path_len, int *minor_version, struct phr_header *headers, size_t *num_headers, size_t last_len)\n</code></pre>\n\n<p>The arguments are all pointers, because <code>phr_parse_request</code> will change where\nthese variables (<code>method</code>, <code>path</code>) are pointing to, that's why you don't need to\ninitialize them or allocate memory for it.</p>\n\n<p>So you have to declare the variables like they do in the example:</p>\n\n<pre><code>int main(void)\n{\n    char *method, *path;\n    size_t buflen = 0, method_len, path_len, num_headers;\n    struct phr_header headers[100];\n    int pret, minor_version;\n\n    char request[] = \"GET /tutorials/other/top-20-mysql-best-practices/ HTTP/1.1\\r\\nHost: ....\";\n\n    num_headers = sizeof(headers) / sizeof(headers[0]);\n\n    pret = phr_parse_request(request, strlen(request), &amp;method, &amp;method_len, &amp;path, &amp;path_len,\n                             &amp;minor_version, headers, &amp;num_headers, 0);\n\n    if(pret &gt; 0)\n    {\n        // success\n        // method has the request methid,\n        // method_len the length of (I presume they don't write the 0\n        // terminating byte\n        // etc.\n    }\n\n    ...\n}\n</code></pre>\n\n<p>The only thing I don't understand is the meaning of <code>prevbuflen</code>, which is used\nas the last argument in the example. Sadly there is no documentation (or at\nleast I can't find one). But judging from the <a href=\"https://github.com/h2o/picohttpparser/blob/master/bench.c\" rel=\"nofollow noreferrer\"><code>bench.c</code></a> file on the\nrepository, that value can be 0. Look at <a href=\"https://github.com/h2o/picohttpparser/blob/master/bench.c\" rel=\"nofollow noreferrer\">that file</a>, that's the \"quick &amp;\ndirty\" example without having to write the networking support. Use that file for\nyour experiments.</p>\n"}], "owner": {"reputation": 11, "user_id": 9665783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c40d6676af35d87e03cdca4c7ed9d47d?s=128&d=identicon&r=PG&f=1", "display_name": "user9665783", "link": "https://stackoverflow.com/users/9665783/user9665783"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1524079939, "creation_date": 1524073817, "question_id": 49906017, "link": "https://stackoverflow.com/questions/49906017/passing-a-buffer-to-picohttpparser-results-in-compile-error", "title": "Passing a buffer to picohttpparser results in compile error", "body": "<p>I've been attempting to get <a href=\"https://github.com/h2o/picohttpparser\" rel=\"nofollow noreferrer\">picohttpparser</a> to work yet all my exertion is futile. What I'm endeavoring to begin with is basically passing a \"manual\" buffer to picohttpparser to parse it. This is the example from the official project page:</p>\n\n<pre><code>char buf[4096], *method, *path;\nint pret, minor_version;\nstruct phr_header headers[100];\nsize_t buflen = 0, prevbuflen = 0, method_len, path_len, num_headers;\nssize_t rret;\n\nwhile (1) {\n    /* read the request */\n    while ((rret = read(sock, buf + buflen, sizeof(buf) - buflen)) == -1 &amp;&amp; errno == EINTR)\n        ;\n    if (rret &lt;= 0)\n        return IOError;\n    prevbuflen = buflen;\n    buflen += rret;\n    /* parse the request */\n    num_headers = sizeof(headers) / sizeof(headers[0]);\n    pret = phr_parse_request(buf, buflen, &amp;method, &amp;method_len, &amp;path, &amp;path_len,\n                             &amp;minor_version, headers, &amp;num_headers, prevbuflen);\n    if (pret &gt; 0)\n        break; /* successfully parsed the request */\n    else if (pret == -1)\n        return ParseError;\n    /* request is incomplete, continue the loop */\n    assert(pret == -2);\n    if (buflen == sizeof(buf))\n        return RequestIsTooLongError;\n}\n\nprintf(\"request is %d bytes long\\n\", pret);\nprintf(\"method is %.*s\\n\", (int)method_len, method);\nprintf(\"path is %.*s\\n\", (int)path_len, path);\nprintf(\"HTTP version is 1.%d\\n\", minor_version);\nprintf(\"headers:\\n\");\nfor (i = 0; i != num_headers; ++i) {\n    printf(\"%.*s: %.*s\\n\", (int)headers[i].name_len, headers[i].name,\n           (int)headers[i].value_len, headers[i].value);\n}\n</code></pre>\n\n<p>be that as it may, it's far excessively involved and I felt lost, so I started low by making a simple buffer to be passed to the parser with this code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include \"picohttpparser.h\"\n\n\n\nint main(int argc, char **argv)\n{\n    /* simple buffer */\n    char rret[58]=\"GET /tutorials/other/top-20-mysql-best-practices/ HTTP/1.1\";\n\n    /* parse the request */\n    phr_parse_request(rret, 58, \"GET\", 3);\n\n    return 0;\n}\n</code></pre>\n\n<p>issue is I keep getting this error:</p>\n\n<pre><code>parsebuf.c: In function \u2018main\u2019:\nparsebuf.c:14:33: warning: passing argument 3 of \u2018phr_parse_request\u2019 from incompatible pointer type [-Wincompatible-pointer-types]\n     phr_parse_request(rret, 58, \"GET\", 3);\n                                 ^~~~~\nIn file included from parsebuf.c:4:0:\npicohttpparser.h:53:5: note: expected \u2018const char **\u2019 but argument is of type \u2018char *\u2019\n int phr_parse_request(const char *buf, size_t len, const char **method, size_t *method_len, const char **path, size_t *path_len,\n     ^~~~~~~~~~~~~~~~~\nparsebuf.c:14:40: warning: passing argument 4 of \u2018phr_parse_request\u2019 makes pointer from integer without a cast [-Wint-conversion]\n     phr_parse_request(rret, 58, \"GET\", 3);\n                                        ^\nIn file included from parsebuf.c:4:0:\npicohttpparser.h:53:5: note: expected \u2018size_t * {aka long unsigned int *}\u2019 but argument is of type \u2018int\u2019\n int phr_parse_request(const char *buf, size_t len, const char **method, size_t *method_len, const char **path, size_t *path_len,\n     ^~~~~~~~~~~~~~~~~\nparsebuf.c:14:5: error: too few arguments to function \u2018phr_parse_request\u2019\n     phr_parse_request(rret, 58, \"GET\", 3);\n     ^~~~~~~~~~~~~~~~~\nIn file included from main.c:4:0:\npicohttpparser.h:53:5: note: declared here\n int phr_parse_request(const char *buf, size_t len, const char **method, size_t *method_len, const char **path, size_t *path_len,\n     ^~~~~~~~~~~~~~~~~\n</code></pre>\n\n<p>where could I be conceivably wrong? alternatively, are there more straightforward examples than the one on the project site?</p>\n"}, {"tags": ["android", "c", "sqlite", "android-ndk"], "comments": [{"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 1, "creation_date": 1524073715, "post_id": 49905877, "comment_id": 86827805, "body": "You will need to pass a full path to a writable location."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 8137700, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RCCd64Tk29U/AAAAAAAAAAI/AAAAAAAACFQ/QNkvLVhkWzg/photo.jpg?sz=128", "display_name": "Roman Aymaletdinov", "link": "https://stackoverflow.com/users/8137700/roman-aymaletdinov"}, "edited": false, "score": 0, "creation_date": 1524136504, "post_id": 49908868, "comment_id": 86854754, "body": "Me helped: final <code>File file = context.getFileStreamPath(&quot;myDb.db&quot;);</code>"}], "tags": [], "owner": {"reputation": 52300, "user_id": 192373, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/83a45711c4c32eeeb3826d279e50f8ab?s=128&d=identicon&r=PG", "display_name": "Alex Cohn", "link": "https://stackoverflow.com/users/192373/alex-cohn"}, "is_accepted": true, "score": 0, "last_activity_date": 1524084870, "creation_date": 1524084870, "answer_id": 49908868, "question_id": 49905877, "link": "https://stackoverflow.com/questions/49905877/connect-to-sqlite-in-android-ndk-native/49908868#49908868", "title": "Connect to SQLite in android NDK NATIVE", "body": "<p>Android app does not have its own 'home' directory. The underlying Linux-like runtime has getcwd(), and it will return <code>/</code> - i.e. the root of the filesystem. Note that the app does not own <code>/</code> and it cannot write to this directory.</p>\n\n<p>This means that you must pass the full path to any file you want to open, including <code>myDb.db</code>. You probably want to keep the database in the <a href=\"https://stackoverflow.com/a/15326498/192373\">default database location for the app</a>, such as returned by <a href=\"http://developer.android.com/reference/android/content/Context.html#getDatabasePath(java.lang.String)\" rel=\"nofollow noreferrer\">Context.getDatabasePath()</a>. The best easiest reliable way to get it in C++, is to have Java query it before calling native, and pass the path to C++. </p>\n"}], "owner": {"reputation": 143, "user_id": 8137700, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RCCd64Tk29U/AAAAAAAAAAI/AAAAAAAACFQ/QNkvLVhkWzg/photo.jpg?sz=128", "display_name": "Roman Aymaletdinov", "link": "https://stackoverflow.com/users/8137700/roman-aymaletdinov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 887, "favorite_count": 0, "accepted_answer_id": 49908868, "answer_count": 1, "score": -2, "last_activity_date": 1524084870, "creation_date": 1524073227, "last_edit_date": 1524073509, "question_id": 49905877, "link": "https://stackoverflow.com/questions/49905877/connect-to-sqlite-in-android-ndk-native", "title": "Connect to SQLite in android NDK NATIVE", "body": "<p>I'm connecting SQLite in <strong>NATIVE</strong> on android. </p>\n\n<p>I'm Got this exception: <code>unable to open database file</code></p>\n\n<p><strong>my NDK code:</strong></p>\n\n<pre><code>#include &lt;android/log.h&gt;\n#include &lt;stdint.h&gt;\n#include \"DatabaseHelper.h\"\n#include \"../sqlite/sqlite3.h\"\n\nconst char* SQL = \"CREATE TABLE IF NOT EXISTS foo(a,b,c); INSERT INTO FOO \nVALUES(1,2,3); INSERT INTO FOO SELECT * FROM FOO;\";\nconst int ERROR_STATE = -1;\nconst int SUCCESSFULLY_STATE = 0;\n\nint createDatabase() {\nchar TAG[20] = \"NATIVE_SQL\";\nsqlite3 *db = 0; // \u0445\u044d\u043d\u0434\u043b \u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043a \u0411\u0414\nchar *err = 0;\n\n// \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u0435\u043c \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0438 \u0442\u0443\u0442 \u0432\u044b\u043b\u0435\u0442\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0430! \nif(sqlite3_open(\"myDb.db\", &amp;db)) {\n    __android_log_print(ANDROID_LOG_DEBUG, TAG, \"Error opened database. \n%s\\n\",sqlite3_errmsg(db));\n    return ERROR_STATE;\n}\n...someone code\n</code></pre>\n\n<p>P.S.\nif  <code>if(sqlite3_open(\"\", &amp;db)) {..</code> database created temporary file and remove it durning close. <strong>If open(\"\",&amp;db) is work!</strong></p>\n\n<p>How will I create the db connection with \"myDb.db\" name?</p>\n\n<hr>\n\n<p>Or </p>\n\n<pre><code>if(sqlite3_open_v2(\"myDb.db\", &amp;db, SQLITE_OPEN_CREATE | SQLITE_OPEN_READWRITE, NULL)) {\n    __android_log_print(ANDROID_LOG_DEBUG, TAG, \"Error opened database2. %s\\n\",sqlite3_errmsg(db));\n    return ERROR_STATE;\n}\n</code></pre>\n\n<p><strong>Permissions in Manifest</strong></p>\n\n<pre><code>&lt;uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" /&gt;\n&lt;uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\" /&gt;\n</code></pre>\n"}, {"tags": ["c", "arrays", "pointers"], "comments": [{"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1524073294, "post_id": 49905789, "comment_id": 86827566, "body": "You have a 2D array of <code>char *</code>.  You may have thought you&#39;d be using a 2D array of <code>char</code>.  You need to allocate space to store the strings; you&#39;re using the same pointer <code>input</code> all the time, but each new input overwrites the previous value.  Look for <code>strdup()</code> \u2014 not standard C, but standard in POSIX and commonly available elsewhere.  Or use a 2D array of <code>char</code> and use <code>strcpy()</code> to copy values."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1524073852, "post_id": 49905789, "comment_id": 86827869, "body": "Depending on how and where <code>input</code> is declared, you may have a similar problem with <code>NFAtab[i][0] = input;</code>. (you can&#39;t assign strings, you must copy them with, e.g. <code>strcpy</code>) You can assign the address from a pointer, but if it is a pointer with <i>automatic</i> storage, you will be assigning the same address over and over again."}], "answers": [{"comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1524073491, "post_id": 49905883, "comment_id": 86827669, "body": "(and they also do not have automatic storage allocation - note that <code>NFAtab</code> is an array of pointers)"}, {"owner": {"reputation": 2966, "user_id": 3462681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4739059ffcecfbd166bbaf9be7549237?s=128&d=identicon&r=PG&f=1", "display_name": "Roushan", "link": "https://stackoverflow.com/users/3462681/roushan"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1524073574, "post_id": 49905883, "comment_id": 86827722, "body": "yes need malloc first to get the memory"}, {"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1524073787, "post_id": 49905883, "comment_id": 86827841, "body": "Are you going to fix your solution?"}, {"owner": {"reputation": 2966, "user_id": 3462681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4739059ffcecfbd166bbaf9be7549237?s=128&d=identicon&r=PG&f=1", "display_name": "Roushan", "link": "https://stackoverflow.com/users/3462681/roushan"}, "reply_to_user": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 0, "creation_date": 1524073968, "post_id": 49905883, "comment_id": 86827919, "body": "@PaulOgilvie edited the answer"}], "tags": [], "owner": {"reputation": 2966, "user_id": 3462681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4739059ffcecfbd166bbaf9be7549237?s=128&d=identicon&r=PG&f=1", "display_name": "Roushan", "link": "https://stackoverflow.com/users/3462681/roushan"}, "is_accepted": true, "score": 0, "last_activity_date": 1524073951, "last_edit_date": 1524073951, "creation_date": 1524073253, "answer_id": 49905883, "question_id": 49905789, "link": "https://stackoverflow.com/questions/49905789/how-to-save-strings-into-an-array-of-char-pointers-in-c/49905883#49905883", "title": "How to save strings into an array of char pointers in C?", "body": "<p>first allocate the memory using <code>malloc</code> for chat pointer array <code>NFAtab</code> then copy the string to memory using <code>strcpy</code> function as Arrays do not have the copy assignment operator</p>\n\n<p>Use strcpy for aggisning the string to array </p>\n\n<pre><code>if (strcmp(input, \".\") == 0){\n            strcpy(NFAtab[x][1],\");\n        } else {\n           strcpy( NFAtab[x][1],input);\n            printf(\"%s\\n\", NFAtab[x][1]);\n        }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 0, "last_activity_date": 1524073301, "creation_date": 1524073301, "answer_id": 49905891, "question_id": 49905789, "link": "https://stackoverflow.com/questions/49905789/how-to-save-strings-into-an-array-of-char-pointers-in-c/49905891#49905891", "title": "How to save strings into an array of char pointers in C?", "body": "<p>With <code>NFAtab[i][0] = input;</code> you assign the address of <code>input</code>to the element <code>NFAtab[i][0]</code>.</p>\n\n<p>Of course, you do not copy the input, so with every iteration, input is overwritten and the array element pointing to input shows the new value of input.</p>\n\n<p>You should use <code>malloc</code> to allocate new memory and copy the input to that memory, then assign that memory to the arrray alement.</p>\n"}], "owner": {"reputation": 23, "user_id": 9167531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2879e2bb9180bc28efeed8f54bda368d?s=128&d=identicon&r=PG&f=1", "display_name": "raultds", "link": "https://stackoverflow.com/users/9167531/raultds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "closed_date": 1524073796, "accepted_answer_id": 49905883, "answer_count": 2, "score": -4, "last_activity_date": 1524073951, "creation_date": 1524072932, "question_id": 49905789, "link": "https://stackoverflow.com/questions/49905789/how-to-save-strings-into-an-array-of-char-pointers-in-c", "closed_reason": "Needs details or clarity", "title": "How to save strings into an array of char pointers in C?", "body": "<p>I have to save Strings readen by command line and save them into a pointer array. The problem is that when I save the strings in their respective array [x][y] it seems that after every update on a [x][y] it affects the whole array.\nI used some printf to see the state of the array after each udpate and always prints the last value added instead of the previous that should be in the array.\nCan someone point me the problem please?</p>\n\n<pre><code>char *NFAtab[STATES][SYMBOLS];\nvoid init_NFA_table()\n{\n    char input[STATES+1];\n    int index;\n    int state;\n\n    DFA_states = 0;\n    N_symbols = 2;\n\n    printf(\"FUNCIONAMENT:\\n No hi ha l\u00edmit d'estats, per\u00f2 es necessari que els estats comencin per l'estat 0.\\n Nom\u00e9s s'accepten transicions amb a i b.\\n\");\n    printf(\"Introdueix nombre d'estats:\");\n    scanf(\"%d\", &amp;NFA_states);\n    printf(\"--------------------------------------------\\n\");\n\n    printf(\"Introdueix transicions per cada estat per la 'a' (forma d'introducci\u00f3: estatestat, sense espaiat; exemple: si va al estat 1 i al 2: 12 | si no hi ha transici\u00f3 '.')\\n ------------------------------------------\\n\");\n    int i;\n    for (i = 0; i &lt; NFA_states; i++){\n        printf(\"ESTAT %d: \", i);\n        scanf(\"%s\", input);\n        if (strcmp(input, \".\") == 0){\n            NFAtab[i][0] = \"\";\n        } else {\n            NFAtab[i][0] = input;\n            printf(\"%s\\n\", NFAtab[i][0]);\n        }\n\n        if (i&gt;0){\n            printf(\"%s\\n\", NFAtab[i-1][0]);\n        }\n    }\n\n    printf(\"Introdueix transicions per cada estat per la 'b' (forma d'introducci\u00f3: estatestat, sense espaiat; exemple: si va al estat 1 i al 2: 12 | si no hi ha transici\u00f3 '.')\\n ------------------------------------------\\n\");\n    int x;\n    for (x = 0; x &lt; NFA_states; x++){\n        printf(\"ESTAT %d: \", x);\n        scanf(\"%s\", input);\n        if (strcmp(input, \".\") == 0){\n            NFAtab[x][1] = \"\";\n        } else {\n            NFAtab[x][1] = input;\n            printf(\"%s\\n\", NFAtab[x][1]);\n        }\n\n        if (x &gt; 0){\n            printf(\"%s\\n\", NFAtab[x-1][1]);\n        }\n    }\n\n    for (x = 0; x &lt; NFA_states; x++){\n        for (i = 0; i &lt; N_symbols; i++){\n            printf(\"ESTAT: %d | SIMBOL: %d : %s\\n\", x, i, NFAtab[x][i]);\n        }\n    }\n</code></pre>\n"}, {"tags": ["c", "output", "logic"], "comments": [{"owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "edited": false, "score": 3, "creation_date": 1524072826, "post_id": 49905706, "comment_id": 86827310, "body": "Use a debugger to step through the code. Use pen and paper to write down intermediate values."}, {"owner": {"reputation": 10498, "user_id": 669576, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/mRhrB.jpg?s=128&g=1", "display_name": "Johnny Mopp", "link": "https://stackoverflow.com/users/669576/johnny-mopp"}, "edited": false, "score": 4, "creation_date": 1524072828, "post_id": 49905706, "comment_id": 86827312, "body": "Do you understand what <a href=\"https://en.wikipedia.org/wiki/Recursion_(computer_science)\" rel=\"nofollow noreferrer\">recursion</a> is?"}, {"owner": {"reputation": 3, "user_id": 9665747, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HJMld6ArBzI/AAAAAAAAAAI/AAAAAAAAAE4/SpBZGKrD7UI/photo.jpg?sz=128", "display_name": "shivshankar pirgonde", "link": "https://stackoverflow.com/users/9665747/shivshankar-pirgonde"}, "edited": false, "score": 0, "creation_date": 1524073019, "post_id": 49905706, "comment_id": 86827408, "body": "I do . But with ternary operator i am not able to visualise the working of code."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1524073181, "post_id": 49905706, "comment_id": 86827503, "body": "OK - rewrite it to avoid the ternary operator, (not a bad plan in any case, IMHO:).  Throw in a few temp vars for extra clarity and ease of debugging.  If you are in a position to, fire the original author:)"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 9665747, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HJMld6ArBzI/AAAAAAAAAAI/AAAAAAAAAE4/SpBZGKrD7UI/photo.jpg?sz=128", "display_name": "shivshankar pirgonde", "link": "https://stackoverflow.com/users/9665747/shivshankar-pirgonde"}, "edited": false, "score": 0, "creation_date": 1524075414, "post_id": 49905979, "comment_id": 86828677, "body": "Thank you , finally understood the logic , this was bugging me for last two hours, now I can sleep peacefully thank you again."}], "tags": [], "owner": {"reputation": 95, "user_id": 7010843, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/9ngPk.jpg?s=128&g=1", "display_name": "NyW", "link": "https://stackoverflow.com/users/7010843/nyw"}, "is_accepted": true, "score": 0, "last_activity_date": 1524073693, "creation_date": 1524073693, "answer_id": 49905979, "question_id": 49905706, "link": "https://stackoverflow.com/questions/49905706/i-dont-understand-how-following-c-language-code-gives-output-as-22/49905979#49905979", "title": "I dont understand how following C language code gives output as 22", "body": "<p>It looks like it is calculating each number mod 10 (first run is 4567 % 10 = 7). It then runs recursively (<code>rec(num/10)</code>), calling the function on 456, then on 45, then on 4.</p>\n\n<p>Since it is adding the number it comes up with to the recursive function (<code>num % 10 + rec(num / 10)</code>), your function is  just adding (4567 % 10 + 456 % 10 + 45 % 10 + 4 % 10) which is just 7 + 6 + 5 + 4 = 22.</p>\n"}], "owner": {"reputation": 3, "user_id": 9665747, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HJMld6ArBzI/AAAAAAAAAAI/AAAAAAAAAE4/SpBZGKrD7UI/photo.jpg?sz=128", "display_name": "shivshankar pirgonde", "link": "https://stackoverflow.com/users/9665747/shivshankar-pirgonde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 49905979, "answer_count": 1, "score": -2, "last_activity_date": 1524073693, "creation_date": 1524072647, "last_edit_date": 1524072921, "question_id": 49905706, "link": "https://stackoverflow.com/questions/49905706/i-dont-understand-how-following-c-language-code-gives-output-as-22", "title": "I dont understand how following C language code gives output as 22", "body": "<pre><code>#include&lt;stdio.h&gt;\n\nint rec(int num)\n{\n    return(num) ? num % 10 + rec(num / 10) : 0;\n\n}\nint main()\n{\n    printf(\"\\n%d\\n\", rec(4567));\n}\n</code></pre>\n\n<p>IDE used is visual studio 2017 64 bit.</p>\n"}, {"tags": ["c", "file"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 9665422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c550c4452119cfc1c43240f31d1e678?s=128&d=identicon&r=PG&f=1", "display_name": "Robinson Crusoe", "link": "https://stackoverflow.com/users/9665422/robinson-crusoe"}, "edited": false, "score": 0, "creation_date": 1524163264, "post_id": 49925341, "comment_id": 86872057, "body": "I ran your code and I got this: <code>File: stud.dat fopen failed: Invalid argument  The file  cannot be openPress any key to continue . . .</code>"}], "tags": [], "owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "is_accepted": false, "score": 0, "last_activity_date": 1524154214, "last_edit_date": 1524154214, "creation_date": 1524153262, "answer_id": 49925341, "question_id": 49904921, "link": "https://stackoverflow.com/questions/49904921/cant-do-the-conversion-from-binary-to-ascii-in-c-language/49925341#49925341", "title": "Can&#39;t do the conversion from binary to ascii in C language", "body": "<p>the following proposed code::</p>\n\n<ol>\n<li>assumes I understand what the OP is trying to do.</li>\n<li>cleanly compiles</li>\n<li>performs the (as understood) functionality</li>\n<li>properly checks for errors</li>\n</ol>\n\n<p>and now the proposed code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n#define MAX_FILENAME_LEN 20\n#define MAX_STUDENT_NAME_LEN 30\n#define MAX_GRADES  15\n\nstruct STUDENT\n{\n    int code;\n    char name[ MAX_STUDENT_NAME_LEN ];\n    int year;\n    int dept;\n    int number;\n    int grade[ MAX_GRADES ];\n};\ntypedef struct STUDENT Student;\n\n\nint main( void )\n{\n    FILE * f;\n    char filename[ MAX_FILE_NAME_LEN ];\n    Student s;\n    int dept;\n\n    printf( \"\\nFile: \" );\n    fflush( stdout );\n    if( !fgets( filename, sizeof( filename ), stdin ) )\n    {\n        perror( \"fgets for file name failed\" );\n        exit( EXIT_FAILURE );\n    }\n\n    // implied else, fgets successful\n\n    // remove trailing newline\n    filename[ strspn( filename, \"\\n\" ) ] = '\\0';\n\n    if( !(f = fopen( filename, \"rb+\" )))\n    {\n        perror( \"fopen failed\" );\n        fprintf( stderr, \"\\nThe file %s cannot be open\", filename );\n        exit( EXIT_FAILURE );\n    }\n\n    // implied else, fopen successful\n\n    printf( \"\\nClass: \" );  // AKA dept\n    fflush( stdout );\n    if( scanf(\"%d\",&amp;dept) != 1 )\n    {\n        fprintf( stderr, \"scanf for class failed\\n\" );\n        fclose( f ); // cleanup\n        exit( EXIT_FAILURE );\n    }\n\n    // implied else, scanf successful\n\n    int found = 0;\n\n    while( fread( &amp;s, sizeof(Student), 1, f ) == 1 )\n    {\n        if( dept == s.dept )\n        {\n            found = 1;\n            s.grade[0] =  s.grade[0] == 10 ) ? s.grade[0] : s.grade[0] + 1;\n            if( fseek(f, -(long int)(sizeof(Student)), SEEK_CUR) != 0 )\n            {\n                perror( \"fseek failed\" );\n                fclose( f );  // cleanup\n                exit( EXIT_FAILURE );\n            }\n\n            // implied else, fseek successful\n\n            if( fwrite( &amp;s, sizeof( Student ), 1, f ) != 1 )\n            {\n                perror( \"fwrite failed\" );\n                fclose( f );  // cleanup\n                exit( EXIT_FAILURE );\n            }\n\n            // implied else, fwrite successful\n        }\n    }\n\n    fclose( f );\n\n    if( !found )\n    {\n        printf( \"\\n No student found in class %d\\n\", dept );\n    }\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9665422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c550c4452119cfc1c43240f31d1e678?s=128&d=identicon&r=PG&f=1", "display_name": "Robinson Crusoe", "link": "https://stackoverflow.com/users/9665422/robinson-crusoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1524154214, "creation_date": 1524069747, "last_edit_date": 1524079193, "question_id": 49904921, "link": "https://stackoverflow.com/questions/49904921/cant-do-the-conversion-from-binary-to-ascii-in-c-language", "title": "Can&#39;t do the conversion from binary to ascii in C language", "body": "<p>I had an assignment at school in C language in working with files. I have a file with .dat extension to modify using the following code. In the .dat file there are information about students (which have the Student struct). </p>\n\n<p>With this code I have to add some points to one grade that the students have after I input a certain dept(class) number in the console.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\ntypedef struct { \n    int code; \n    char name[30]; \n    int year; \n    int dept; \n    int number; \n    int grade[15]; \n}Student;\n\nvoid main(){ \n    FILE * f; \n    char s1[20]; \n    Student s; \n    int n, i;\n    printf(\"\\nFile: \"); \n    gets_s(s1);\n\n    if(!(f = fopen(s1, \"rb+\")))  printf(\"\\nThe file %s cannot be open\", s1);\n    else{\n        printf(\"\\nClass: \"); scanf(\"%d\",&amp;n);\n        while(!feof(stdin)){\n            rewind(f);\n            fread(&amp;s, sizeof(Student), 1, f);\n            i = 0;\n            while(!feof(f)){\n                if(n == s.dept){\n                    i = 1;\n                    s.grade[0] = (s.grade[0] == 10) ? s.grade[0] : s.grade[0] + 1;\n                    fseek(f, ftell(f) - sizeof(Student), 0);\n                    fwrite(&amp;s, sizeof(Student), 1, f);\n                    fseek(f, 0, 1);\n                }\n                fread(&amp;s, sizeof(Student), 1, f);\n            }\n            if(!i) printf(\"\\n No student found in class %d\", s.dept);\n            printf(\"\\nClass: \"); scanf(\"%d\",&amp;n);\n        }\n        fclose(f);\n    }\n}\n</code></pre>\n\n<p>All good but in the console I get a strange dept number.</p>\n\n<pre><code>File: stud.dat\n\nClass: 200\n\n No student found in class -858993460\n</code></pre>\n\n<p>I think this is happening because there is no conversion from binary to ascii. I searched the internet and I didn`t find anything that can help me. Is there a function I need to insert or something like this?</p>\n\n<p>Thank you!</p>\n\n<p>stud.dat file</p>\n\n<pre><code>e   smith \u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe   1            \u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00ccf   james \u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe   ,           \u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00ccg   mike \u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe   \u00ea            \n   \u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cch   jon \u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe\u00fe   m         \n   \u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\u00cc\n</code></pre>\n"}, {"tags": ["c", "arrays", "string", "substring"], "comments": [{"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 4, "creation_date": 1524067165, "post_id": 49903992, "comment_id": 86824054, "body": "<code>int endingIndex = strstr (dest, endingText) - dest;</code> shadows a variable.and the <code>dest[endingIndex] = &#39;\\0&#39;;</code> after it can write out of bounds."}, {"owner": {"reputation": 2907, "user_id": 3019006, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/qodt7.jpg?s=128&g=1", "display_name": "Deb", "link": "https://stackoverflow.com/users/3019006/deb"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524067261, "post_id": 49903992, "comment_id": 86824110, "body": "What a silly mistake. Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1524069034, "post_id": 49904444, "comment_id": 86825220, "body": "<code>source = strstr (source, startingText);     if(!includeStart){        source+=startLen;     } ... strstr (source, endingText) - source;</code> looks iffy as <code>source</code> may be <code>NULL</code> when <code>source</code> is used again."}, {"owner": {"reputation": 21, "user_id": 5392242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41a01fad0fc261105ce50fcc8f562232?s=128&d=identicon&r=PG&f=1", "display_name": "Chris337", "link": "https://stackoverflow.com/users/5392242/chris337"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524129069, "post_id": 49904444, "comment_id": 86849471, "body": "<code>source</code> might be <code>NULL</code> if it was <code>NULL</code> in the first place, or if <code>startingText</code> is equal to <code>source</code>. Should be the precondition of the function I guess. Or am I missing something?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1524145717, "post_id": 49904444, "comment_id": 86861121, "body": "<code>source = strstr (source, startingText);</code> is missing a path to take if the pattern is not found. Code would benefit  with something like <code>char *f = strstr (source, startingText); if (f) do_this(f) else do_that;</code>"}], "tags": [], "owner": {"reputation": 21, "user_id": 5392242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41a01fad0fc261105ce50fcc8f562232?s=128&d=identicon&r=PG&f=1", "display_name": "Chris337", "link": "https://stackoverflow.com/users/5392242/chris337"}, "is_accepted": false, "score": 2, "last_activity_date": 1524068438, "last_edit_date": 1524068438, "creation_date": 1524068123, "answer_id": 49904444, "question_id": 49903992, "link": "https://stackoverflow.com/questions/49903992/extract-substring-in-c/49904444#49904444", "title": "Extract substring in C", "body": "<p>The problem comes from lifetime of variables (endingIndex here). Removing the <code>int</code> should do the trick, but I recommend not writing unnecessary chars to dest (risking an overflow). <br/>\n(Also, you should use <code>size_t</code> type for array lengths.)<br/><br/>\nYou should optimize the way the string is written this way:</p>\n\n<pre><code>void extractSubstring (char *source, char *dest, char *startingText,\n          char *endingText, bool includeStart)\n{\n    size_t sourceLen = strlen(source);\n    size_t startLen = strlen(startingText);\n    size_t endingIndex = sourceLen;\n    source = strstr (source, startingText);\n    if(!includeStart){\n       source+=startLen;\n    }\n\n    if(strlen(endingText)&gt;0){\n        endingIndex = strstr (source, endingText) - source;\n        strncpy(dest, source, endingIndex);\n    } else {\n        strcpy (dest, source);\n    }\n\n    dest[endingIndex] = '\\0';\n    printf(dest);\n}\n</code></pre>\n\n<p>Hope it helps.</p>\n\n<p>[EDIT : <a href=\"https://stackoverflow.com/users/905902/wildplasser\">wildplasser</a> comment explains it well]</p>\n"}], "owner": {"reputation": 2907, "user_id": 3019006, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/qodt7.jpg?s=128&g=1", "display_name": "Deb", "link": "https://stackoverflow.com/users/3019006/deb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1524068438, "creation_date": 1524066640, "last_edit_date": 1524066768, "question_id": 49903992, "link": "https://stackoverflow.com/questions/49903992/extract-substring-in-c", "title": "Extract substring in C", "body": "<p>I am trying to write a method in C, which will extract a substring between a starting and ending string. Based on a boolean flag it might include/exclude the starting substring.\ni.e, </p>\n\n<pre><code> char source[100] = \"Some random text with $$KEY:value$$\";\n char dest[12];\n extractSubstring (source, dest, \"KEY:\", \"$\", false);\n</code></pre>\n\n<p>this should populate dest = \"value\".</p>\n\n<p>My program is following:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\ntypedef int bool;\n#define true 1\n#define false 0\n\nint main()\n{\n    char source[100] = \"Some random text with $$KEY:value$$\";\n    char dest[12];\n    extractSubstring (source, dest, \"KEY:\", \"$\", false);\n    return 0;\n}\n\nvoid extractSubstring (char *source, char *dest, char *startingText,\n          char *endingText, bool includeStart)\n{\n    int sourceLen = strlen(source);\n    int startLen = strlen(startingText);\n    int endingIndex = sourceLen;\n    source = strstr (source, startingText);\n    if(includeStart){\n        strcpy (dest, source);\n    }\n    else{\n       source+=startLen;\n       strcpy (dest, source);\n    }\n    if(strlen(endingText)&gt;0){\n        int endingIndex = strstr (dest, endingText) - dest;\n\n    }\n    dest[endingIndex] = '\\0';\n    printf(dest);\n}\n</code></pre>\n\n<p>This is populating dest as \"value$$\" instead of \"value\". How to discard the last characters. </p>\n"}, {"tags": ["c", "file"], "comments": [{"owner": {"reputation": 188064, "user_id": 635608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oIJia.png?s=128&g=1", "display_name": "Mat", "link": "https://stackoverflow.com/users/635608/mat"}, "edited": false, "score": 4, "creation_date": 1524065408, "post_id": 49903576, "comment_id": 86822899, "body": "<a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/truncate.html\" rel=\"nofollow noreferrer\">pubs.opengroup.org/onlinepubs/9699919799/functions/&hellip;</a>"}, {"owner": {"reputation": 583, "user_id": 9475322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EU8aN.png?s=128&g=1", "display_name": "MattGeek", "link": "https://stackoverflow.com/users/9475322/mattgeek"}, "reply_to_user": {"reputation": 188064, "user_id": 635608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oIJia.png?s=128&g=1", "display_name": "Mat", "link": "https://stackoverflow.com/users/635608/mat"}, "edited": false, "score": 0, "creation_date": 1524065571, "post_id": 49903576, "comment_id": 86823020, "body": "@Mat How can that be helpful?"}, {"owner": {"reputation": 28330, "user_id": 298054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7dffcc86140441472cfb6119375a9d7?s=128&d=identicon&r=PG", "display_name": "jweyrich", "link": "https://stackoverflow.com/users/298054/jweyrich"}, "edited": false, "score": 3, "creation_date": 1524065637, "post_id": 49903576, "comment_id": 86823066, "body": "You truncate the file to be of size N - See <a href=\"https://linux.die.net/man/2/truncate\" rel=\"nofollow noreferrer\">truncate/ftruncate</a>."}, {"owner": {"reputation": 583, "user_id": 9475322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EU8aN.png?s=128&g=1", "display_name": "MattGeek", "link": "https://stackoverflow.com/users/9475322/mattgeek"}, "reply_to_user": {"reputation": 28330, "user_id": 298054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7dffcc86140441472cfb6119375a9d7?s=128&d=identicon&r=PG", "display_name": "jweyrich", "link": "https://stackoverflow.com/users/298054/jweyrich"}, "edited": false, "score": 0, "creation_date": 1524065689, "post_id": 49903576, "comment_id": 86823092, "body": "@jweyrich but will truncate create a new file?"}, {"owner": {"reputation": 28330, "user_id": 298054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7dffcc86140441472cfb6119375a9d7?s=128&d=identicon&r=PG", "display_name": "jweyrich", "link": "https://stackoverflow.com/users/298054/jweyrich"}, "edited": false, "score": 0, "creation_date": 1524065738, "post_id": 49903576, "comment_id": 86823117, "body": "Nope. Same file. Truncation will just decrease the file size to the specified size."}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 1, "creation_date": 1524065776, "post_id": 49903576, "comment_id": 86823142, "body": "The easy way is to <code>mmap</code> the entire file (i.e. not use <code>FILE *</code> functions like <code>fgets</code>). Do the elide in the mapped buffer (e.g. <code>memcpy(bufp + offset_of_line_to_elide,buf_p + offset_of_next_line,length_of_remainder_of_file)</code> and then use <code>truncate&#47;ftruncate</code> at the end. See my answer here: <a href=\"https://stackoverflow.com/questions/33616284/read-line-by-line-in-the-most-efficient-way-platform-specific/33620968#33620968\" title=\"read line by line in the most efficient way platform specific\">stackoverflow.com/questions/33616284/&hellip;</a> for some details on how to do the mapping vs <code>fgets</code>"}, {"owner": {"reputation": 583, "user_id": 9475322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EU8aN.png?s=128&g=1", "display_name": "MattGeek", "link": "https://stackoverflow.com/users/9475322/mattgeek"}, "edited": false, "score": 0, "creation_date": 1524065932, "post_id": 49903576, "comment_id": 86823242, "body": "My file is already open in r+ mode, is that alright or should close the file, reopen it in writing mode and then use that function?"}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 5, "creation_date": 1524065957, "post_id": 49903576, "comment_id": 86823257, "body": "Such operations are usually performed by writing/renaming a temp file.  One resons why that is a better option is that, with care, it is possible to ensure that the operation can be &#39;atomic&#39;, ie. no matter when it is interupted, (eg. power fail), it is always possible to recover a valid file, either the original or one with the entry successfully deleted."}, {"owner": {"reputation": 583, "user_id": 9475322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EU8aN.png?s=128&g=1", "display_name": "MattGeek", "link": "https://stackoverflow.com/users/9475322/mattgeek"}, "reply_to_user": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 0, "creation_date": 1524066015, "post_id": 49903576, "comment_id": 86823298, "body": "@CraigEstey Sorry, but I don&#39;t want to use dinamic memory."}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 0, "creation_date": 1524066358, "post_id": 49903576, "comment_id": 86823538, "body": "Mapping the file isn&#39;t using dynamic memory [as in a huge <code>malloc</code> of the entire file contents]. It&#39;s a pretty standard way to access the file. And, although you <i>can</i> do this with <code>fread&#47;fwrite</code>, it will be potentially a lot slower because you&#39;ll have to copy the file in chunks and be doing a lot of <code>fseek</code> operations. At that point, I&#39;d switch to <code>read&#47;write&#47;lseek</code> syscalls."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1524068685, "post_id": 49903576, "comment_id": 86825028, "body": "@MartinJames is right.  A more fault tolerant  solution is to create a new file, complete the operation on it, save it, rename old to temp, rename new to old, delete temp."}, {"owner": {"reputation": 4522, "user_id": 5157478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bBcym.png?s=128&g=1", "display_name": "Frankie_C", "link": "https://stackoverflow.com/users/5157478/frankie-c"}, "edited": false, "score": 2, "creation_date": 1524069308, "post_id": 49903576, "comment_id": 86825400, "body": "You can also use <code>ftruncate()</code>, see <a href=\"http://pubs.opengroup.org/onlinepubs/009604499/functions/ftruncate.html\" rel=\"nofollow noreferrer\">pubs.opengroup.org/onlinepubs/009604499/functions/&hellip;</a>, that executes same operation on a valid file open for writing. Anyway, as you have already been warned, consider that executing such operations on files can lead to loss of data in case of failure."}], "owner": {"reputation": 583, "user_id": 9475322, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EU8aN.png?s=128&g=1", "display_name": "MattGeek", "link": "https://stackoverflow.com/users/9475322/mattgeek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 249, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524065382, "creation_date": 1524065304, "last_edit_date": 1524065382, "question_id": 49903576, "link": "https://stackoverflow.com/questions/49903576/how-can-i-move-the-eof", "title": "How can I move the EOF?", "body": "<p>Well, I have a text file containing some lines. When I have to \"delete\" a line (known position from the start of the file) I read as many lines as needed until I reach the desired position; then from that position, I start to overwrite with the remaining lines after the line to be \"deleted\", now the old line is deleted. \nBut my idea is to move the EOF to the old last line, which needs to be deleted as it's now a duplicate. How I print or move the EOF (End Of File)?</p>\n"}, {"tags": ["c", "string", "strtok"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1524064965, "post_id": 49903199, "comment_id": 86822543, "body": "<i>I&#39;m strudying this code but I&#39;m not understanding how the pointer is moving inside of buffer</i> Well, first that&#39;s pretty horrible code.  <code>sizeof(char)</code> is one by definition so every use of it can be removed. And all but one of the <code>strcpy()</code> calls are unneeded. Whoever wrote that code needs an introduction to <code>strdup()</code>.  Finally, what exactly is your question?  What &quot;pointer&quot; are you referring to?"}, {"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524065134, "post_id": 49903199, "comment_id": 86822676, "body": "The code that I&#39;m studying is done by my UNI professor ...... anyway i&#39;ll edit the question for better understanding"}], "answers": [{"comments": [{"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "edited": false, "score": 0, "creation_date": 1524066064, "post_id": 49903531, "comment_id": 86823334, "body": "So if the string that i&#39;m trying to scan is all on one line (by that i mean there aren&#39;t &#39;\\n&#39;) each time that i enter in the loop i will scan only the first word?"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "edited": false, "score": 1, "creation_date": 1524066381, "post_id": 49903531, "comment_id": 86823553, "body": "@ZenoRaiser Yes.  In your original code, you will only get the first word on each line."}], "tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": true, "score": 0, "last_activity_date": 1524065828, "last_edit_date": 1524065828, "creation_date": 1524065149, "answer_id": 49903531, "question_id": 49903199, "link": "https://stackoverflow.com/questions/49903199/pointer-moving-inside-string/49903531#49903531", "title": "Pointer moving inside string", "body": "<p>Your entire first loop can be rewritten as:</p>\n\n<pre><code>while(fgets(buffer,buf_size,fp) != NULL){  \n    // note how sizeof() is used - that way if the type of\n    // record_p changes, no changes to this code are needed\n    struct record *record_p = malloc(sizeof(*record_p));   \n\n    // no need at all for temporary copies of the strings\n    record_p-&gt;string_field = strdup(strtok(buffer,\",\"));\n    record_p-&gt;integer_field = atoi(strtok(NULL,\",\"));\n\n    ordered_array_add(array, (void*)record_p);\n  }\n</code></pre>\n\n<p>There's no need to call <code>malloc()</code> and <code>strcpy()</code> so many times - and that pair can be replaced with <code>strdup()</code> - that's both <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/strdup.html\" rel=\"nofollow noreferrer\">POSIX-standard</a> and <a href=\"https://msdn.microsoft.com/en-us/library/ms235454.aspx\" rel=\"nofollow noreferrer\">supported on Windows</a> so it's pretty widely available.</p>\n\n<p>Of course, that code needs error checking and <a href=\"https://stackoverflow.com/questions/17710018/why-shouldnt-i-use-atoi\">it shouldn't be using <code>atoi()</code> at all</a>, but as posted here it will duplicate your original functionality.</p>\n\n<p>With the added benefit that you can actually tell what's going on.</p>\n\n<p>Your code</p>\n\n<pre><code>while(fgets(buffer,buf_size,fp) != NULL) {\nchar *word = strtok(buffer, \" ,.:\");\n\n    add(words_to_correct, word);\n    words_to_correct-&gt;el_num = words_to_correct-&gt;el_num+1;\n    printf(\"%s\\n\", word);\n\n}\n</code></pre>\n\n<p>will only process the first word in each line - you need to keep calling <code>strtok()</code> until it returns <code>NULL</code>, because <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/functions/strtok.html\" rel=\"nofollow noreferrer\"><code>strtok()</code> only returns one token</a>:</p>\n\n<pre><code>while(fgets(buffer,buf_size,fp) != NULL) {\n    // trick to keep loop simple - start by using\n    // buffer on the first loop iteration, then\n    // set tmp to NULL so later iterations works too\n    char *tmp = buffer;\n    // loop until strtok() returns null\n    for ( ;; )\n    {\n        // note use of tmp here\n        char *word = strtok(tmp, \" ,.:\");\n\n        // line is fully parsed - break this loop\n        // and get the next line to parse\n        if (word == NULL)\n        {\n            break;\n        }\n\n        // now set tmp to NULL so next strtok()\n        // gets a NULL first parameter\n        tmp = NULL;\n\n        add(words_to_correct, word);\n        words_to_correct-&gt;el_num = words_to_correct-&gt;el_num+1;\n        printf(\"%s\\n\", word);\n    }\n\n}\n</code></pre>\n\n<p>Note also that I'm spreading things out and not trying to stuff as much code on each line.  That's usually a lot easier to read.</p>\n"}], "owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "closed_date": 1524227292, "accepted_answer_id": 49903531, "answer_count": 1, "score": -2, "last_activity_date": 1524065889, "creation_date": 1524064136, "last_edit_date": 1524065889, "question_id": 49903199, "link": "https://stackoverflow.com/questions/49903199/pointer-moving-inside-string", "closed_reason": "Needs more focus", "title": "Pointer moving inside string", "body": "<p>I'm strudying this code but I'm not understanding how the pointer is moving inside of <code>buffer</code></p>\n\n<p>...</p>\n\n<pre><code>  while(fgets(buffer,buf_size,fp) != NULL){  \n    read_line_p = malloc((strlen(buffer)+1)*sizeof(char));   \n    strcpy(read_line_p,buffer);   \n    char *string_field_in_read_line_p = strtok(read_line_p,\",\");\n    char *integer_field_in_read_line_p = strtok(NULL,\",\");  \n\n    char *string_field_1 = malloc((strlen(string_field_in_read_line_p)+1)*sizeof(char));\n    char *string_field_2 = malloc((strlen(string_field_in_read_line_p)+1)*sizeof(char));  \n\n    strcpy(string_field_1,string_field_in_read_line_p);\n    strcpy(string_field_2,string_field_in_read_line_p);    \n    int integer_field = atoi(integer_field_in_read_line_p);  \n\n    struct record *record_p = malloc(sizeof(struct record));   \n    record_p-&gt;string_field = string_field_1;\n    record_p-&gt;integer_field = integer_field;\n\n    ordered_array_add(array, (void*)record_p);\n\n    free(read_line_p);\n  }\n</code></pre>\n\n<p>...</p>\n\n<p>The source code does this :</p>\n\n<p>reads from a <code>.csv</code> file millions of records composed by a string and an integer which are separated by <code>,</code> and every record is placed on a different line; every record is added as a singol element into a generic array that we must order. The generic array is rappresented by </p>\n\n<pre><code>typedef struct {\n  void** array; \n  unsigned long el_num; //index\n  unsigned long array_capacity; //length\n  int (*precedes)(void*,void*); //precedence relation (name of a function in main which denota which one field we're comparing)\n}OrderedArray;\n</code></pre>\n\n<p>Inside of this struct we have the   precedes  function which tells us if we have to sort the array by the string field or by the integer field.</p>\n\n<p>Example of records inside our csv file</p>\n\n<p>firstword , 10</p>\n\n<p>secondword , 9</p>\n\n<p>thirdword, 8 \necc..</p>\n\n<p>So at each execution of <code>ordered_array_add</code> we will have inserted a new element in the array.</p>\n\n<p>Follows <code>ordered_array_add</code></p>\n\n<pre><code>void ordered_array_add(OrderedArray *ordered_array, void* element){\n  if(element == NULL){\n    fprintf(stderr,\"add_ordered_array_element: element parameter cannot be NULL\");\n    exit(EXIT_FAILURE);\n  }\n\n  if(ordered_array-&gt;el_num &gt;= ordered_array-&gt;array_capacity){\n    ordered_array-&gt;array = realloc(ordered_array-&gt;array,2*(ordered_array-&gt;array_capacity)*sizeof(void*));\n    if(ordered_array-&gt;array == NULL){\n      fprintf(stderr,\"ordered_array_add: unable to reallocate memory to host the new element\");\n      exit(EXIT_FAILURE);\n    }\n    ordered_array-&gt;array_capacity = 2*ordered_array-&gt;array_capacity;\n  }\n\n  unsigned long index = get_index_to_insert(ordered_array, element);\n\n  insert_element(ordered_array,element,index);\n\n  (ordered_array-&gt;el_num)++;\n\n}\n</code></pre>\n\n<p>I don't understand how the first loop scannes through the string <code>buffer</code> because i don't see any indexes in the mentioned loop.</p>\n\n<p>I wrote a similar code to the first loop that I posted, the issue is that it stops after reading the first word from <code>buffer</code> while the code that I'm studying reads successfully the whole string</p>\n\n<pre><code>while(fgets(buffer,buf_size,fp) != NULL) {\nchar *word = strtok(buffer, \" ,.:\");\n\n    add(words_to_correct, word);\n    words_to_correct-&gt;el_num = words_to_correct-&gt;el_num+1;\n    printf(\"%s\\n\", word);\n\n}\n</code></pre>\n"}, {"tags": ["c", "malloc", "function-pointers"], "comments": [{"owner": {"reputation": 2482, "user_id": 9630756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zkdcg.png?s=128&g=1", "display_name": "Sergio Monteleone", "link": "https://stackoverflow.com/users/9630756/sergio-monteleone"}, "edited": false, "score": 3, "creation_date": 1524062691, "post_id": 49902616, "comment_id": 86820786, "body": "Please note you are leaking memory (you should call free() <b>before</b> return). Also, the code you pasted doesn&#39;t compile fine: return (void *)array; should just be just return array; ... can you please ensure the example you posted compiles fine?"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 3, "creation_date": 1524062776, "post_id": 49902616, "comment_id": 86820843, "body": "At <code>} return (void *)array; free(array); }</code> the <code>free()</code> is dead code; the <code>return</code> means the <code>free()</code> is never executed.  Ditto for <code>} return (void *)maxFactor; free(arrayOfBoolean); }</code>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1524063062, "post_id": 49902616, "comment_id": 86821066, "body": "<code>int j = 0; j &lt; argv[1][j]; j++</code> is suspicious.  I&#39;d expect <code>int j = 0; argv[1][j]; j++</code>.  Many other issues."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 1, "creation_date": 1524063145, "post_id": 49902616, "comment_id": 86821120, "body": "Among the dozens of issues, this is probably the one that causes the crashes: <code>i &lt;= arrayLength</code>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1524063407, "post_id": 49902616, "comment_id": 86821347, "body": "Note: When <code>number</code> is near <code>INT_MAX</code>, then <code>i*i &lt; number</code> is a problem as <code>i*i</code> may overflow <code>int</code> math.  <code>i &lt; number&#47;i</code> does not have this problem - yet a bit slower."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1524063710, "post_id": 49902616, "comment_id": 86821587, "body": "<code>int *findMaxPrimeFactor</code>  --&gt; Why does code return a pointer and not an <code>int</code>?"}, {"owner": {"reputation": 1, "user_id": 8947475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ba22e59329e9037448edd11d8d21dcd?s=128&d=identicon&r=PG&f=1", "display_name": "\u041b\u0438\u0437\u0430 \u041a\u043e\u0437\u043b\u043e\u0432\u0441\u043a\u0430\u044f", "link": "https://stackoverflow.com/users/8947475/%d0%9b%d0%b8%d0%b7%d0%b0-%d0%9a%d0%be%d0%b7%d0%bb%d0%be%d0%b2%d1%81%d0%ba%d0%b0%d1%8f"}, "edited": false, "score": 0, "creation_date": 1524063854, "post_id": 49902616, "comment_id": 86821693, "body": "Thank you, fixed &quot;return (void *) array&quot; to &quot;return array&quot;. Although putting &quot;return&quot;  before freeing the memory only made it worse. Now it just prints out &quot;Largest prime factor of 0 is 0&quot;"}, {"owner": {"reputation": 1, "user_id": 8947475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ba22e59329e9037448edd11d8d21dcd?s=128&d=identicon&r=PG&f=1", "display_name": "\u041b\u0438\u0437\u0430 \u041a\u043e\u0437\u043b\u043e\u0432\u0441\u043a\u0430\u044f", "link": "https://stackoverflow.com/users/8947475/%d0%9b%d0%b8%d0%b7%d0%b0-%d0%9a%d0%be%d0%b7%d0%bb%d0%be%d0%b2%d1%81%d0%ba%d0%b0%d1%8f"}, "edited": false, "score": 0, "creation_date": 1524065214, "post_id": 49902616, "comment_id": 86822742, "body": "Fixed &quot;i &lt;= arrayLength&quot; to &quot;i &lt; arrayLength&quot;, now it works much better, thanks, Art!"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524176229, "post_id": 49902616, "comment_id": 86877969, "body": "none of the proposed fixes are in the posted code.  Please post a &#39;edit&#39; to append the corrected code.  (don&#39;t change the original code"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524176317, "post_id": 49902616, "comment_id": 86877994, "body": "in general, the call to <code>srand()</code> should be performed only once, usually very early in the <code>main()</code> function."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524176428, "post_id": 49902616, "comment_id": 86878027, "body": "regarding: <code>srand(time(NULL));</code>  This will not cleanly compile, because the function: <code>srand()</code> is expecting a <code>unsigned int</code> parameter."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524176611, "post_id": 49902616, "comment_id": 86878069, "body": "regarding: <code>array = (int*)malloc(arrayLength * sizeof(*array));</code>  The returned type all of the heap allocation functions <code>malloc</code> <code>calloc</code> <code>realloc</code>  is <code>void*</code> which can be assigned to any pointer.  Casting just clutters the code, making it more difficult to understand, debug, etc."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524176748, "post_id": 49902616, "comment_id": 86878100, "body": "regarding: <code>printf(&quot;ERROR: memory allocation did not succeed\\n&quot;);</code>  Error messages should be output to <code>stderr</code>, not <code>stdout</code>.  And when the error is from a C library function, the text reason the system thinks the error occurred should also be output.  Strongly suggest using <code>perror()</code> as that will output your text and the text reason the system thinks the error occurred to <code>stderr</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524176932, "post_id": 49902616, "comment_id": 86878166, "body": "Please post the actual contents of the two &#39;home grown&#39;  header files.  And since the variables: <code>arraylength</code> and <code>number</code> are not yet defined, the result is trash"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524177201, "post_id": 49902616, "comment_id": 86878253, "body": "regarding: <code>*(arrayOfBoolean + i) </code>  this kind of notation is difficult to read.  Suggest: <code>arrayOfBoolean[  i ]</code>"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524177398, "post_id": 49902616, "comment_id": 86878308, "body": "for ease of readability and understanding: 1) follow the axiom <i>only one statement per line and (at most) one variable declaration per statement.</i>  2) separate code blocks: <code>for</code> <code>if</code> <code>else</code> <code>while</code> <code>do...while</code> <code>switch</code> <code>case</code> <code>default</code> via a single blank line  3)  consistently indent the code.  Indent after EVERY opening brace &#39;{&#39;.  Unindent before every closing brace &#39;}&#39;. Suggest each indent level be 4 spaces"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524177758, "post_id": 49902616, "comment_id": 86878397, "body": "the function: <code>int *findMaxPrimeFactor( int number )</code> is called multiple times in a loop.  However, each pass through the function is performing a new call to <code>malloc</code>.  BUT the allocated memory is not being passed to <code>free()</code>  Because after the <code>return</code> statement is executed, nothing else in that function will executed.  Strongly suggest placing the call to <code>free()</code> before the <code>return</code> statement."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524177891, "post_id": 49902616, "comment_id": 86878438, "body": "regarding: <code>arrayOfBoolean = malloc(number * sizeof(*arrayOfBoolean));</code>  all the parameter bits passed to <code>malloc()</code> need to be of type: <code>size_t</code>  However, <code>number</code> is of type <code>int</code>  so the compiler will output a warning message about the conversion to <code>size_t</code> may fail."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524178173, "post_id": 49902616, "comment_id": 86878516, "body": "Regarding: <code>for (i = 2; i*i &lt; number; i++)</code>  this has a &#39;possible&#39; logic problem in the ordering of the calculations.  Suggest using parens to force the correct ordering.  I.E. for (i = 2; (i*i) &lt; number; i++)"}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524178534, "post_id": 49902616, "comment_id": 86878610, "body": "in function: <code>findMaxPrimeFactor()</code>  the code that loops through the array <code>arrayOfBoolean</code> and set all multiples of the current value <code>i</code> to 0  has to do this again for each and every time the function is called.  That is a major waste of CPU cycles.  Suggest keeping that array, call <code>realloc()</code> if necessary, then the array only gets initialized once"}], "owner": {"reputation": 1, "user_id": 8947475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ba22e59329e9037448edd11d8d21dcd?s=128&d=identicon&r=PG&f=1", "display_name": "\u041b\u0438\u0437\u0430 \u041a\u043e\u0437\u043b\u043e\u0432\u0441\u043a\u0430\u044f", "link": "https://stackoverflow.com/users/8947475/%d0%9b%d0%b8%d0%b7%d0%b0-%d0%9a%d0%be%d0%b7%d0%bb%d0%be%d0%b2%d1%81%d0%ba%d0%b0%d1%8f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524062469, "creation_date": 1524062469, "question_id": 49902616, "link": "https://stackoverflow.com/questions/49902616/why-does-my-program-give-a-segmentation-fault-every-so-often-with-odd-integers", "title": "Why does my program give a segmentation fault every so often with odd integers, but works fine with any even integers?", "body": "<p>My program is supposed to take an integer as an array length value, then create the array of random numbers from 1 to 1000000 of that length. Then using sieve of Eratosthenes it has to find the largest prime factor of every number from the array of random numbers. Then it should print out all of the elements of the array of random numbers with their biggest prime factor.</p>\n\n<p>The problem now is that it seems to work just fine with any even integers of any size, but gives a segmentation error every once in a while with odd numbers. I suppose that something is incorrect in the *findMaxPrimeFactor function, but have no idea what exactly. </p>\n\n<p>I am compiling it in Linux.</p>\n\n<p>Function main</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include\"ArrayOfRandom.h\"\n#include\"MaxPrimeFactor.h\"\nint main(int argc, char* argv[]) {\nint arrayLength = 0;\nif (argc &lt; 3) { // checking if there are enough arguments in the input\n        for (int j = 0; j &lt; argv[1][j]; j++) { // checking every character\n            if (argv[1][j] &gt;= 48 &amp;&amp; argv[1][j] &lt;= 57) {   // ASCII codes from 48 to 57 represent characters from '0' to '9' respectively \n                arrayLength = atoi(argv[1]); // atoi function converts the command line arguments into integers. mod 10 is used to finally get the arrayLength value \n            } else {\n                printf(\"The input should be of an integer value.\\n\"); // once the invalid character is found, the error message is printed\n                exit(0); // exiting the program\n                }\n\n        }\n} else {\n    printf(\"Please input just 1 value\\n\"); // if the user tries to put values with spaces, print error message\n    exit(0);  // exit the program\n}\nint *array = arrayOfRandom(arrayLength);// calling of the function that creates the array of random integers\n\nfor (int i = 0; i &lt; arrayLength; ++i)\n{\n    printf(\"Largest prime factor of %d is %d\", *(array + i), findMaxPrimeFactor(*(array + i)));\n    printf(\"\\n\");\n}\n\nreturn 0;\n</code></pre>\n\n<p>}</p>\n\n<p>Function that is supposed to create an array of random numbers in the range of 1000000. It takes arrayLength as a parameter from the main function      </p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;time.h&gt;\n#include &lt;math.h&gt;\n#include\"ArrayOfRandom.h\"\nint *arrayOfRandom(int arrayLength) {\nsrand(time(NULL)); // seed generator for pseudo-random numbers\nint *array = NULL;\narray = (int*)malloc(arrayLength * sizeof(*array)); \nif (array == NULL) {\n    printf(\"ERROR: memory allocation did not succeed\\n\");\n} else {\n    int i; // loop counter\n    int range = 1000000;\n    for (i = 0; i &lt;= arrayLength; i++) {\n        *(array + i) = rand() % range + 1; // range of random integers from 1 to 1000000\n    }\n}\nreturn (void *)array;\nfree(array); // Freeing the reserved memory for the array\n</code></pre>\n\n<p>}</p>\n\n<p>Function that is supposed to implement sieve of Eratosthenes(I think the problem is here somewhere). I used the pseudocode from <a href=\"https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;math.h&gt;\n#include\"MaxPrimeFactor.h\"\nint *findMaxPrimeFactor(int number) { \nint *arrayOfBoolean = NULL;\nint maxFactor = 0;\narrayOfBoolean = malloc(number * sizeof(*arrayOfBoolean)); /* Length of the boolean array is supposed to be the same as the value of each number from the array of random numbers(every time it is called)*/\nif (arrayOfBoolean == NULL) {\n    printf(\"ERROR: memory allocation did not succeed\\n\");\n}\nelse {\n    int i = 0, j = 0; // loop counters\n    for (i = 2; i &lt; number; i++) { // initializing the array elements to true\n        *(arrayOfBoolean + i) = 1;\n    }\n\n    for (i = 2; i*i &lt; number; i++) { // Implementation of the Sieve\n        if (*(arrayOfBoolean + i) == 1) {\n            for (j = i * i; j &lt; number; j += i) {\n                *(arrayOfBoolean + j) = 0;\n            }\n        }\n    }\n\n    /* Finding the largest prime factor   */\n    for (i = 2; i &lt;= number; i++) { \n        if ((*(arrayOfBoolean + i) == 1) &amp;&amp; (number%i == 0) &amp;&amp; (maxFactor &lt; i)) {\n            maxFactor = i;\n        }\n        else if(maxFactor == 0){\n            maxFactor = number;\n        }\n        }\n}\nreturn (void *)maxFactor;\nfree(arrayOfBoolean);\n</code></pre>\n\n<p>}</p>\n\n<p>Headers(Supposed to be separate .h files MaxPrimeFactor.h and ArrayOfRandom.h)</p>\n\n<pre><code>int *arrayOfRandom(int arrayLength);\nint *findMaxPrimeFactor(int number);\n</code></pre>\n"}, {"tags": ["c", "string"], "comments": [{"owner": {"reputation": 5304, "user_id": 2757035, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/fade5daafd5717576b33f2e08f4f9429?s=128&d=identicon&r=PG&f=1", "display_name": "underscore_d", "link": "https://stackoverflow.com/users/2757035/underscore-d"}, "edited": false, "score": 0, "creation_date": 1524060947, "post_id": 49901969, "comment_id": 86819404, "body": "Your statement that the same string is copied to 4 elements and your example output disagree. Have you tried using a debugger to step through what is happening? If not, please learn this essential skill, which will help you understand your code, and save your and others&#39; time by letting you solve your own problems instead of asking the internet."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 1, "creation_date": 1524060969, "post_id": 49901969, "comment_id": 86819417, "body": "<code>strcpy(MsgList[i].ga_data, a_Database[i].ga_data);</code> target pointer isn&#39;t initialized."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1524060980, "post_id": 49901969, "comment_id": 86819425, "body": "Hint: What is the value of <code>MsgList[i].ga_data</code> when <code>strcpy(MsgList[i].ga_data, a_Database[i].ga_data);</code> called?  It is a pointer, but to what?"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1524061023, "post_id": 49901969, "comment_id": 86819460, "body": "You&#39;ve got (un)lucky it didn&#39;t crash right away."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 1, "creation_date": 1524061028, "post_id": 49901969, "comment_id": 86819466, "body": "@Jean-Fran&#231;oisFabre <code>MsgList[i].ga_data</code> is initialized (<code>0</code>) as it is a global - yet not to valid memory."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524061080, "post_id": 49901969, "comment_id": 86819504, "body": "@chux, that&#39;s nitpicking, but yes :)"}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 4, "creation_date": 1524061141, "post_id": 49901969, "comment_id": 86819541, "body": "I believe the downvotes are because the OP is blaming the function rather than their code?"}, {"owner": {"reputation": 1584, "user_id": 603421, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/b5cbcc7279556c0414f6a75787aec7af?s=128&d=identicon&r=PG", "display_name": "SCO", "link": "https://stackoverflow.com/users/603421/sco"}, "edited": false, "score": 0, "creation_date": 1524061632, "post_id": 49901969, "comment_id": 86819957, "body": "strcpying to MsgList[i].ga_data looks pretty bad to me, pointer is null"}, {"owner": {"reputation": 75299, "user_id": 139746, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/BhJLC.png?s=128&g=1", "display_name": "Pascal Cuoq", "link": "https://stackoverflow.com/users/139746/pascal-cuoq"}, "edited": false, "score": 1, "creation_date": 1524062322, "post_id": 49901969, "comment_id": 86820494, "body": "Providing code is nice, but correct code is nicer. <code>idx</code> and <code>i</code> are not declared in <code>main</code>."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 5810652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e68765062b3d4939b815846cb5f739?s=128&d=identicon&r=PG&f=1", "display_name": "Vladyslav Merdov", "link": "https://stackoverflow.com/users/5810652/vladyslav-merdov"}, "is_accepted": false, "score": 1, "last_activity_date": 1524063311, "creation_date": 1524063311, "answer_id": 49902936, "question_id": 49901969, "link": "https://stackoverflow.com/questions/49901969/why-strcpy-doesnt-work-properly/49902936#49902936", "title": "why strcpy doesn&#39;t work properly", "body": "<p>Well first of all you are corrupting memory in here:</p>\n\n<pre><code>strcpy(MsgList[i].ga_data, a_Database[i].ga_data);\n</code></pre>\n\n<p>since I cannot see where allocation for the MsgList[i].ga_data was done,\nI assuming it wasn't.</p>\n\n<p>Then making null terminated string by magic number '14' here:</p>\n\n<pre><code> MsgList[i].ga_data[14] = '\\0';\n</code></pre>\n\n<p>Can lead to some memory corruption as well.</p>\n\n<p>and even assuming that you making allocations somewhere, its very odd that you can observe full string in your MsgList[i].ga_data, since you making null termination at 14 it should be something like:</p>\n\n<pre><code>1235,message 2                                                            \n1236,message 3\n1238,message 5 \n1240,message 7\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 1358309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nT6qS.jpg?s=128&g=1", "display_name": "raforanz", "link": "https://stackoverflow.com/users/1358309/raforanz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "closed_date": 1524064150, "answer_count": 1, "score": -5, "last_activity_date": 1524063311, "creation_date": 1524060738, "last_edit_date": 1524060910, "question_id": 49901969, "link": "https://stackoverflow.com/questions/49901969/why-strcpy-doesnt-work-properly", "closed_reason": "Duplicate", "title": "why strcpy doesn&#39;t work properly", "body": "<p>I want to copy each element of an array of strings to another array of strings, but when I copy one string whole array is changed to that string. Following is the code set.</p>\n\n<p>This is the line of code having issue:</p>\n\n<pre><code>strcpy(MsgList[i].ga_data, a_Database[i].ga_data);\n</code></pre>\n\n<p>when I check the contents of\na_Database[i].ga_data, it is as below</p>\n\n<pre><code>\"1240,message 7:War of the worlds\"\n\n\"1238,message 5:Life of this world\"\n\n\"1236,message 3:world is not enough\"\n\n\"1235,message 2:What a world!\"\n</code></pre>\n\n<p>So instead of populating the same in <code>MsgList[i].ga_data</code>, it turns out to be just  \"1235,message 2:What a world!\"  <strong>4 times</strong>, which is the last element copied. </p>\n\n<pre><code>typedef enum\n{\n  ACK,\n  NACK,\n  DELETE\n}eMsgStatus_t;\n\ntypedef struct _Message\n{\n  eMsgStatus_t status;\n  char *ga_data;\n  uint16_t time;\n}Message_t;\nMessage_t MessageList[8]={\n  {ACK,\"1234,message 1:Hello world\",1000},\n  {NACK,\"1235,message 2:What a world!\",1011},\n  {NACK,\"1236,message 3:world is not enough\",1022},\n  {ACK,\"1237,messsge 4:Cruel world\",1033},\n  {NACK,\"1238,message 5:Life of this world\",1044},\n  {ACK,\"1239,message 6:Around the world in 80 days\",1055},\n  {NACK,\"1240,message 7:War of the worlds\",1066},\n  {ACK,\"1241,message 8:End of World\",1077}\n}; \n\nMessage_t a_Database[20];\nMessage_t MsgList[20]= {0};\n\nint main()\n{\n  for (i = 0; i &lt; idx /* total unread message */; ++i)\n  {\n      strcpy(MsgList[i].ga_data, a_Database[i].ga_data);\n      MsgList[i].ga_data[14] = '\\0';\n  }\n}\n\nuint8_t  GetMessages (Message_t *pg_Message)\n{\n  char i;uint8_t idx = 0;\n   for (i = 0; i &lt; 8 /* total message */; ++i)\n  {\n    if(NACK == MessageList[i].status)\n    {\n      pg_Message[idx].status = MessageList[i].status;\n      pg_Message[idx].ga_data = MessageList[i].ga_data;\n      pg_Message[idx].time = MessageList[i].time;\n      idx++;\n    }\n  }\n  return idx;\n}\n</code></pre>\n"}, {"tags": ["c", "fclose", "freopen"], "comments": [{"owner": {"reputation": 5304, "user_id": 2757035, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/fade5daafd5717576b33f2e08f4f9429?s=128&d=identicon&r=PG&f=1", "display_name": "underscore_d", "link": "https://stackoverflow.com/users/2757035/underscore-d"}, "edited": false, "score": 1, "creation_date": 1524061026, "post_id": 49901957, "comment_id": 86819465, "body": "Have you tried using a debugger to step through what is happening and/or get a trace back from the point of the crash? If not, please learn this essential skill, which will help you understand your code, and save your and others&#39; time by letting you solve your own problems instead of asking the internet."}, {"owner": {"reputation": 305833, "user_id": 68587, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7d9fd158e03cbde94f7e0b33b78222af?s=128&d=identicon&r=PG", "display_name": "John Kugelman", "link": "https://stackoverflow.com/users/68587/john-kugelman"}, "edited": false, "score": 1, "creation_date": 1524061129, "post_id": 49901957, "comment_id": 86819531, "body": "Please create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that demonstrates the problem so we can run the code ourselves. If the linked list code isn&#39;t directly related, leave it out. Creating a MCVE may help you identify the issue."}, {"owner": {"reputation": 19, "user_id": 9645480, "user_type": "registered", "profile_image": "https://graph.facebook.com/1582796255171148/picture?type=large", "display_name": "Martin Bartolo", "link": "https://stackoverflow.com/users/9645480/martin-bartolo"}, "reply_to_user": {"reputation": 305833, "user_id": 68587, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7d9fd158e03cbde94f7e0b33b78222af?s=128&d=identicon&r=PG", "display_name": "John Kugelman", "link": "https://stackoverflow.com/users/68587/john-kugelman"}, "edited": false, "score": 0, "creation_date": 1524061514, "post_id": 49901957, "comment_id": 86819856, "body": "@JohnKugelman when I made a MCVE just trying to use freopen, print something and fclose(stdout) it works. It&#39;s when I use this function and the linked list that it does not work."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524062607, "post_id": 49901957, "comment_id": 86820713, "body": "How many times do you call your <code>printAllVarRedir()</code> function before it crashes?  Because once you call that code, your <code>stdout</code> is closed for good."}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 1, "creation_date": 1524066028, "post_id": 49901957, "comment_id": 86823302, "body": "If you close <code>stdout</code>, where do you expect <code>TestAfterClose</code> to appear?"}, {"owner": {"reputation": 8326, "user_id": 53089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/525dac0c4812e8e8753935590b40ddb6?s=128&d=identicon&r=PG", "display_name": "Rob K", "link": "https://stackoverflow.com/users/53089/rob-k"}, "edited": false, "score": 1, "creation_date": 1524077438, "post_id": 49901957, "comment_id": 86829827, "body": "Why are you redirecting <code>stdout</code> anyway? Why not just use <code>fprintf()</code>?"}, {"owner": {"reputation": 19, "user_id": 9645480, "user_type": "registered", "profile_image": "https://graph.facebook.com/1582796255171148/picture?type=large", "display_name": "Martin Bartolo", "link": "https://stackoverflow.com/users/9645480/martin-bartolo"}, "reply_to_user": {"reputation": 8326, "user_id": 53089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/525dac0c4812e8e8753935590b40ddb6?s=128&d=identicon&r=PG", "display_name": "Rob K", "link": "https://stackoverflow.com/users/53089/rob-k"}, "edited": false, "score": 0, "creation_date": 1524152191, "post_id": 49901957, "comment_id": 86865855, "body": "@RobK I&#39;m making a simple unix shell and I need to make a system which redirects output to a file from a selection of functions which don&#39;t contain fprintf()."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 9645480, "user_type": "registered", "profile_image": "https://graph.facebook.com/1582796255171148/picture?type=large", "display_name": "Martin Bartolo", "link": "https://stackoverflow.com/users/9645480/martin-bartolo"}, "edited": false, "score": 0, "creation_date": 1524065538, "post_id": 49902450, "comment_id": 86822992, "body": "Thanks! Solved by changing the code to use dup instead of freopen"}], "tags": [], "owner": {"reputation": 8326, "user_id": 53089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/525dac0c4812e8e8753935590b40ddb6?s=128&d=identicon&r=PG", "display_name": "Rob K", "link": "https://stackoverflow.com/users/53089/rob-k"}, "is_accepted": true, "score": 5, "last_activity_date": 1524062055, "creation_date": 1524062055, "answer_id": 49902450, "question_id": 49901957, "link": "https://stackoverflow.com/questions/49901957/fclosestdout-causes-a-crash-when-using-freopen-even-after-null-check/49902450#49902450", "title": "fclose(stdout) causes a crash when using freopen even after NULL check", "body": "<p>Of course <code>printf(\"\\nTestAfterClose\\n\");</code> doesn't print. <code>printf</code> prints to <code>stdout</code> which you've just closed.</p>\n"}], "owner": {"reputation": 19, "user_id": 9645480, "user_type": "registered", "profile_image": "https://graph.facebook.com/1582796255171148/picture?type=large", "display_name": "Martin Bartolo", "link": "https://stackoverflow.com/users/9645480/martin-bartolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 356, "favorite_count": 0, "accepted_answer_id": 49902450, "answer_count": 1, "score": 1, "last_activity_date": 1524062055, "creation_date": 1524060695, "last_edit_date": 1524061180, "question_id": 49901957, "link": "https://stackoverflow.com/questions/49901957/fclosestdout-causes-a-crash-when-using-freopen-even-after-null-check", "title": "fclose(stdout) causes a crash when using freopen even after NULL check", "body": "<p>I am trying to print stdout to file using freopen and the code below crashes. I am NULL checking and I'm fairly sure I don't have a segmentation fault somewhere else in the program since I verified that all my mallocs are correct.</p>\n\n<p>The program crashes when it reaches the <code>fclose(stdout)</code> and doesn't print the error messgage I attached to check it. The <code>printf(\"\\nTestBeforeClose\");</code> line prints but the <code>printf(\"\\nTestAfterClose\");</code> does not.</p>\n\n<pre><code>int printAllVarRedir(char * filename, int redirmarker) {\n    var *current = NULL;\n\n    if (redirmarker == 1) {\n        if (freopen(filename, \"w\", stdout) == NULL) {\n            perror(\"Unable to open file\");\n            return 1;\n        } else {\n            if (head == NULL) {\n                perror(\"No Variables\");\n                fclose(stdout);\n                return 1;\n            } else {\n                current = head;\n                printf(\"%s=%s. Address is %p.Next is:%p\\n\", current-&gt;varname, current-&gt;value, current, current-&gt;next);\n                while (current-&gt;next != NULL) {\n                    current = current-&gt;next;\n                    printf(\"%s=%s. Address is %p.Next is:%p\\n\", current-&gt;varname, current-&gt;value, current,\n                           current-&gt;next);\n                }\n                printf(\"\\nTestBeforeClose\");\n                if (fclose(stdout) == EOF) {\n                    printf(\"\\nError is %s\\n\", strerror(errno));\n                }\n                printf(\"\\nTestAfterClose\\n\");\n                return 0;\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>This is the var struct I am using:</p>\n\n<pre><code>typedef struct varlist{\n    char * varname;\n    char * value;\n    struct varlist * next;\n}var;\n\nvar * head = NULL;\n</code></pre>\n"}, {"tags": ["c", "optimization"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524061686, "post_id": 49901561, "comment_id": 86820001, "body": "&quot;However, I didn&#39;t really understand his implementation of the optimization.&quot; --&gt; Then why accept the <a href=\"https://codereview.stackexchange.com/a/192326/29485\">answer</a>?"}, {"owner": {"reputation": 1717, "user_id": 9662626, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ansb.png?s=128&g=1", "display_name": "Aviv Lo", "link": "https://stackoverflow.com/users/9662626/aviv-lo"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524063329, "post_id": 49901561, "comment_id": 86821281, "body": "@chux I understand the implementation in a general sense (as stated in his comments), and it does cut the program&#39;s execution time by a factor of 6 on my side. However, the nitty-gritty of how the function works is still unclear to me."}], "answers": [{"comments": [{"owner": {"reputation": 1717, "user_id": 9662626, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ansb.png?s=128&g=1", "display_name": "Aviv Lo", "link": "https://stackoverflow.com/users/9662626/aviv-lo"}, "edited": false, "score": 0, "creation_date": 1524066459, "post_id": 49901982, "comment_id": 86823598, "body": "How about the part under the for loop? There are hex representation of a byte (upper and lower part), that&#39;s all I can get."}], "tags": [], "owner": {"reputation": 96, "user_id": 8068030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f21a75e95ec1a3aa744d4ef67e6743f?s=128&d=identicon&r=PG&f=1", "display_name": "John Stone", "link": "https://stackoverflow.com/users/8068030/john-stone"}, "is_accepted": true, "score": 1, "last_activity_date": 1524061995, "last_edit_date": 1524061995, "creation_date": 1524060786, "answer_id": 49901982, "question_id": 49901561, "link": "https://stackoverflow.com/questions/49901561/format-data-as-hexadecimal-string-to-increase-md5-hash-computation-in-c/49901982#49901982", "title": "Format Data as Hexadecimal String to Increase MD5 Hash Computation in C", "body": "<p>Simply, the custom function you mentioned is to split one byte to two byte, which is the printable hex view of the byte, so the buffer needs to be 2 * length, since the output is a string, and it needs an extra byte at the end of the buffer for the character '\\0'.</p>\n"}], "owner": {"reputation": 1717, "user_id": 9662626, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ansb.png?s=128&g=1", "display_name": "Aviv Lo", "link": "https://stackoverflow.com/users/9662626/aviv-lo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 49901982, "answer_count": 1, "score": 0, "last_activity_date": 1524061995, "creation_date": 1524059689, "question_id": 49901561, "link": "https://stackoverflow.com/questions/49901561/format-data-as-hexadecimal-string-to-increase-md5-hash-computation-in-c", "title": "Format Data as Hexadecimal String to Increase MD5 Hash Computation in C", "body": "<p>I wrote a piece of C code and asked someone on <a href=\"https://codereview.stackexchange.com/questions/192306/optimizing-md5-openssl-implementation-in-c-for-precomputed-hash/192326#192326\">codereview.stackexchange</a> to optimized it for me. However, I didn't really understand his implementation of the optimization. </p>\n\n<p>His solutions were:</p>\n\n<ol>\n<li>Write a custom function for converting the MD5 hash to a hex string.</li>\n<li>Call <code>printf</code> for the entire string instead of each single byte so reduce the number of function calls.</li>\n</ol>\n\n<p>Most of the code remain the same except for some minor changes. However, he wrote a custom function outside the main function which is really the key to the optimization. Unfortunately, I didn't really get it. May someone explain the first part of the code for me in the context of the rest of the program? </p>\n\n<p>In the comment it says that <code>// Format the data as a hexadecimal string. The buffer must have space for 2 * length + 1 characters.</code> But why does the buffer must have the space for 2 times the length plus 1 character?</p>\n\n<p><strong>The first part of the code outside the main function:</strong></p>\n\n<pre><code>    #include &lt;stdio.h&gt;\n    #include &lt;stdlib.h&gt;\n    #include &lt;string.h&gt;\n    #include &lt;openssl/md5.h&gt;\n\n    // Format the data as a hexadecimal string. The buffer must have\n    // space for `2 * length + 1` characters.\n    const char *hexString(unsigned char *data, size_t length, char *buffer) {\n        const char *hexDigits = \"0123456789abcdef\";\n        char *dest = buffer;\n        for (size_t i = 0; i &lt; length; i++) {\n            *dest++ = hexDigits[data[i] &gt;&gt; 4];\n            *dest++ = hexDigits[data[i] &amp; 0x0F];\n        }\n        *dest = 0;\n        return buffer;\n    }\n</code></pre>\n\n<hr>\n\n<p><strong>The rest of the code:</strong></p>\n\n<pre><code>int main(void) {\n                FILE *infile = fopen(\"infile\", \"r\");\n                if (infile == NULL) {\n                    perror(\"Cannot open input file\");\n                    exit(EXIT_FAILURE);\n                }\n                FILE *outfile = fopen(\"cout3\",\"w\");\n                if (outfile == NULL) {\n                    perror(\"Cannot open output file\");\n                    exit(EXIT_FAILURE);\n                }\n\n                // Read file line-by-line\n                char *line = NULL;\n                size_t linecap = 0;\n                ssize_t lineLength;\n                while ((lineLength = getline(&amp;line, &amp;linecap, infile)) != -1) {\n                    if (lineLength &gt; 0 &amp;&amp; line[lineLength - 1] == '\\n') {\n                        // Remove newline character\n                        lineLength -= 1;\n                        line[lineLength] = 0;\n                    }\n\n                    // Compute MD5 hash\n                    unsigned char md5hash[MD5_DIGEST_LENGTH];\n                    MD5((unsigned char*)line, lineLength, md5hash);\n\n                    // Print hash as hex string\n                    char hexBuffer[2 * MD5_DIGEST_LENGTH + 1];\n                    fputs(hexString(md5hash, MD5_DIGEST_LENGTH, hexBuffer), outfile);\n                    fputc('\\n', outfile);\n                }\n                free(line);\n\n                // Close output files\n                fclose(infile);\n                fclose(outfile);\n            }\n</code></pre>\n\n<p><strong>Any help will be greatly appreciated.</strong></p>\n"}, {"tags": ["c", "gcc", "stm32", "bootloader", "hex-file"], "comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1524062742, "post_id": 49901363, "comment_id": 86820822, "body": "Perhaps instead fix the boot-loader/function call to accept <code>:08018000B9BC0C08B9BC0C0865</code> (8 bytes at address 0180).   I  think the goal of &quot;make hex file in contiguous&quot; is not the best approach."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524064316, "post_id": 49901363, "comment_id": 86822033, "body": "The line length isn&#39;t specified, it can be anything."}, {"owner": {"reputation": 329, "user_id": 3953693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397c0cf2bb470b47adae9afa27d31cbb?s=128&d=identicon&r=PG&f=1", "display_name": "Dheeraj Kumar", "link": "https://stackoverflow.com/users/3953693/dheeraj-kumar"}, "edited": false, "score": 0, "creation_date": 1524071492, "post_id": 49901363, "comment_id": 86826594, "body": "Well then whenever I change the hex file ..I might need to change the bootloader. Version 4.6 and 4.8 behaves correctly."}], "answers": [{"comments": [{"owner": {"reputation": 329, "user_id": 3953693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397c0cf2bb470b47adae9afa27d31cbb?s=128&d=identicon&r=PG&f=1", "display_name": "Dheeraj Kumar", "link": "https://stackoverflow.com/users/3953693/dheeraj-kumar"}, "edited": false, "score": 0, "creation_date": 1524071699, "post_id": 49901528, "comment_id": 86826703, "body": "I think that might not be the best idea as Hex file might have jump institution to specific address. If we move the bytes without considering the address change then application would fail. I don&#39;t want to do any post processing. I want GCC to behave consistently"}, {"owner": {"reputation": 15409, "user_id": 2877364, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a101160e41fd7fd75f5fc701f8acb1c?s=128&d=identicon&r=PG", "display_name": "cxw", "link": "https://stackoverflow.com/users/2877364/cxw"}, "reply_to_user": {"reputation": 329, "user_id": 3953693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397c0cf2bb470b47adae9afa27d31cbb?s=128&d=identicon&r=PG&f=1", "display_name": "Dheeraj Kumar", "link": "https://stackoverflow.com/users/3953693/dheeraj-kumar"}, "edited": false, "score": 0, "creation_date": 1524080442, "post_id": 49901528, "comment_id": 86831373, "body": "@DheerajKumar Fair enough.  Then, for clarification: In the testcase in your question, the <code>ff</code> bytes are omitted, but the addressing is still consistent.  There are eight bytes at 0x0180, eight omitted bytes, then bytes starting at 0x190 (16 bytes after 0x180).  Are there other situations in which, say, one record is at 0x180 and the next is at 0x1a0 (or something else other than 16 bytes later)?  If not, the postprocessing should work."}, {"owner": {"reputation": 329, "user_id": 3953693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397c0cf2bb470b47adae9afa27d31cbb?s=128&d=identicon&r=PG&f=1", "display_name": "Dheeraj Kumar", "link": "https://stackoverflow.com/users/3953693/dheeraj-kumar"}, "edited": false, "score": 0, "creation_date": 1524110131, "post_id": 49901528, "comment_id": 86840550, "body": "Other case is not there .. this is the only case. I will try and see if app still works. Thanks for your support though :)"}], "tags": [], "owner": {"reputation": 15409, "user_id": 2877364, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a101160e41fd7fd75f5fc701f8acb1c?s=128&d=identicon&r=PG", "display_name": "cxw", "link": "https://stackoverflow.com/users/2877364/cxw"}, "is_accepted": false, "score": 1, "last_activity_date": 1524059593, "creation_date": 1524059593, "answer_id": 49901528, "question_id": 49901363, "link": "https://stackoverflow.com/questions/49901363/contiguous-hex-file-generation-using-gcc/49901528#49901528", "title": "Contiguous Hex file generation using GCC", "body": "<p>One of many possible ways:</p>\n\n<ul>\n<li>Make your hex file with v6.2, e.g., <code>foo.hex</code>.</li>\n<li><p>Postprocess it with this Perl oneliner:</p>\n\n<pre><code>perl -pe 'if(m/^:(..)(.*)$/) { my $rest=16-hex($1); $_ = \":10\" . $2 . (\"FF\" x $rest) . \"\\n\"; }' foo.hex &gt; foo2.hex\n</code></pre></li>\n</ul>\n\n<p>Now <code>foo2.hex</code> will have all 16-byte lines</p>\n\n<p>Note: <em>all this does</em> is FF-pad to 0x10 bytes.  It doesn't check addresses or anything else.</p>\n\n<p><strong>Explanation</strong></p>\n\n<p><code>perl -pe '&lt;some script&gt;' &lt;input file&gt;</code> runs <code>&lt;some script&gt;</code> for each line of <code>&lt;input file&gt;</code>, and prints the result.  The script is:</p>\n\n<pre class=\"lang-perl prettyprint-override\"><code>if(m/^:(..)(.*)$/) {         # grab the existing byte count into $1\n    my $rest=16 - hex($1);   # how many bytes of 0xFF we need\n    $_ = \":10\" . $2 . (\"FF\" x $rest) . \"\\n\";  # make the new 16-byte line\n# existing bytes-^^   ^^^^^^^^^^^^^^-pad bytes\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 329, "user_id": 3953693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397c0cf2bb470b47adae9afa27d31cbb?s=128&d=identicon&r=PG&f=1", "display_name": "Dheeraj Kumar", "link": "https://stackoverflow.com/users/3953693/dheeraj-kumar"}, "edited": false, "score": 0, "creation_date": 1524110169, "post_id": 49910149, "comment_id": 86840565, "body": "I think that might not be the best idea as Hex file might have jump institution to specific address. If we move the bytes without considering the address change then application would fail. I don&#39;t want to do any post processing. I want GCC to behave consistently"}, {"owner": {"reputation": 1083, "user_id": 5147212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd0948323093255d680801e7fcbc7965?s=128&d=identicon&r=PG&f=1", "display_name": "Sigve Kolbeinson", "link": "https://stackoverflow.com/users/5147212/sigve-kolbeinson"}, "reply_to_user": {"reputation": 329, "user_id": 3953693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397c0cf2bb470b47adae9afa27d31cbb?s=128&d=identicon&r=PG&f=1", "display_name": "Dheeraj Kumar", "link": "https://stackoverflow.com/users/3953693/dheeraj-kumar"}, "edited": false, "score": 0, "creation_date": 1524125526, "post_id": 49910149, "comment_id": 86847370, "body": "Existing bytes aren&#39;t moved. The bytes in the that are defined are untouched - same value, same address. Padding is inserted where no data is defined"}], "tags": [], "owner": {"reputation": 1083, "user_id": 5147212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd0948323093255d680801e7fcbc7965?s=128&d=identicon&r=PG&f=1", "display_name": "Sigve Kolbeinson", "link": "https://stackoverflow.com/users/5147212/sigve-kolbeinson"}, "is_accepted": true, "score": 2, "last_activity_date": 1524125323, "last_edit_date": 1524125323, "creation_date": 1524091663, "answer_id": 49910149, "question_id": 49901363, "link": "https://stackoverflow.com/questions/49901363/contiguous-hex-file-generation-using-gcc/49910149#49910149", "title": "Contiguous Hex file generation using GCC", "body": "<p>If post-processing the hex file is an option, you can consider using the <a href=\"https://pypi.org/project/IntelHex/\" rel=\"nofollow noreferrer\">IntelHex</a> python library. This lets you manipulate hex file data (i.e. ignoring the 'markup'; record type, address, checksum etc) rather than as lines, will for instance create output with the correct line checksum.</p>\n\n<p>A fast way to get this up and running could be to use the bundled convenience scripts <a href=\"http://python-intelhex.readthedocs.io/en/latest/part3-1.html\" rel=\"nofollow noreferrer\">hex2bin.py</a> and <a href=\"http://python-intelhex.readthedocs.io/en/latest/part3-2.html\" rel=\"nofollow noreferrer\">bin2hex.py</a>:</p>\n\n<pre><code>python hex2bin.py --pad=FF noncontiguous.hex tmp.bin\npython bin2hex.py tmp.bin contiguous.hex\n</code></pre>\n\n<p>The first line converts the input file <code>noncontiguous.hex</code> to a binary file, padding it with <code>FF</code> where there is no data. The second line  converts it the binary file back to a hex file.</p>\n\n<p>The result would be</p>\n\n<pre><code>:08018000B9BC0C08B9BC0C0865\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>:10018000B9BC0C08B9BC0C08FFFFFFFFFFFFFFFF65\n</code></pre>\n\n<p>As you can see, padding bytes are added where the input doesn't have any data, equivalent to writing the input file to the device and reading it back out. Bytes that are in the input file are kept the same - and at the same address.\nThe checksum is also correct as changing the length byte from <code>0x08</code> to <code>0x10</code> compensates for the extra <code>0xFF</code> bytes. If you padded with something else, IntelHex would output the correct checksum</p>\n\n<p>You can skip the the creation of a temporary file by piping these: omit <code>tmp.bin</code> in the first line and replacing it with <code>-</code> in the second line:</p>\n\n<pre><code>python hex2bin.py --pad=FF noncontiguous.hex | python bin2hex.py - contiguous.hex\n</code></pre>\n\n<p>An alternative way could be to have a base file with all <code>FF</code> and use the <code>hexmerge.py</code> convenience script to merge gcc's output onto it with <code>--overlap=replace</code></p>\n\n<p>The longer, more flexible way, would be to implement your own tool using the IntelHex API. I've used this to good effect in situations similar to yours - tweak hex files to satisfy tools that are costly to change, but only handle hex files the way they were when the tool was written.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11764726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cd9efbd077b372c3dff558856122a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Tajs Brandt", "link": "https://stackoverflow.com/users/11764726/tajs-brandt"}, "is_accepted": false, "score": 1, "last_activity_date": 1562758968, "creation_date": 1562758968, "answer_id": 56970012, "question_id": 49901363, "link": "https://stackoverflow.com/questions/49901363/contiguous-hex-file-generation-using-gcc/56970012#56970012", "title": "Contiguous Hex file generation using GCC", "body": "<p>Another solution is to change the linker script to ensure the preceding .isr_vector section ends on a 16 byte alignment, as the mapfile reveals that the following .text section is 16 byte aligned.\nThis will ensure there is no unprogrammed flash bytes between the two sections</p>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 6766890, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153846528819135/picture?type=large", "display_name": "Erik Moqvist", "link": "https://stackoverflow.com/users/6766890/erik-moqvist"}, "is_accepted": false, "score": 1, "last_activity_date": 1596834421, "creation_date": 1596834421, "answer_id": 63309147, "question_id": 49901363, "link": "https://stackoverflow.com/questions/49901363/contiguous-hex-file-generation-using-gcc/63309147#63309147", "title": "Contiguous Hex file generation using GCC", "body": "<p>You can use <a href=\"https://github.com/eerimoq/bincopy\" rel=\"nofollow noreferrer\">bincopy</a> to fill all empty space with 0xff.</p>\n<pre><code>$ pip install bincopy\n$ bincopy fill foo.hex\n</code></pre>\n"}], "owner": {"reputation": 329, "user_id": 3953693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397c0cf2bb470b47adae9afa27d31cbb?s=128&d=identicon&r=PG&f=1", "display_name": "Dheeraj Kumar", "link": "https://stackoverflow.com/users/3953693/dheeraj-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1030, "favorite_count": 0, "accepted_answer_id": 49910149, "answer_count": 4, "score": 3, "last_activity_date": 1596834421, "creation_date": 1524059118, "question_id": 49901363, "link": "https://stackoverflow.com/questions/49901363/contiguous-hex-file-generation-using-gcc", "title": "Contiguous Hex file generation using GCC", "body": "<p>I have a Hex file for STM32F427 that was built using GCC(gcc-arm-none-eabi) version 4.6 that had contiguous memory addresses. I wrote boot loader for loading that hex file and also added checksum capability to make sure Hex file is correct before starting the application. \nSnippet of Hex file: </p>\n\n<p>:10<strong>05C8</strong>0018460AF02FFE07F5A64202F1D00207F5F9\n:10<strong>05D8</strong>008E4303F1A803104640F6C821C2F2000179\n:10<strong>05E8</strong>001A460BF053F907F5A64303F1D003184652\n:10<strong>05F8</strong>000BF068F907F5A64303F1E80340F6FC1091\n:10<strong>0608</strong>00C2F2000019463BF087FF07F5A64303F145\n:10<strong>0618</strong>00E80318464FF47A710EF092FC07F5A643EA\n:10<strong>0628</strong>0003F1E80318460EF03DFC034607F5A64221\n:10<strong>0638</strong>0002F1E0021046194601F0F2FC07F56A5390</p>\n\n<p>As you can see all the addresses are sequential. Then we changed the compiler to version 4.8 and i got the same type of Hex file. </p>\n\n<p>But now we used compiler version 6.2 and the Hex file generated is not contiguous. It is somewhat like this: </p>\n\n<pre><code>:10016000B9BC0C08B9BC0C08B9BC0C08B9BC0C086B\n:10017000B9BC0C08B9BC0C08B9BC0C08B9BC0C085B\n:08018000B9BC0C08B9BC0C0865\n:1001900081F0004102E000BF83F0004330B54FEA38\n:1001A00041044FEA430594EA050F08BF90EA020FA5\n</code></pre>\n\n<p>As you can see after 0188 it is starting at 0190 means rest of 8 bytes(0189 to 018F) are 0xFF as they are not flashed. </p>\n\n<p>Now boot loader is kind of dumb where we just pass the starting address and no of bytes to calculate the checksum. </p>\n\n<p>Is there a way to make hex file in contiguous way as compiler 4.6 and compiler 4.8? the code is same in all the three times. </p>\n"}, {"tags": ["c++", "c"], "comments": [{"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 5, "creation_date": 1524057790, "post_id": 49900866, "comment_id": 86817119, "body": "UB\u034f\u034f\u034f\u034f\u034f\u034f\u034f\u034f\u034f\u034f\u034f\u034f\u034f"}, {"owner": {"reputation": 4328, "user_id": 920069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd39f0db1f22e1314746491df063602a?s=128&d=identicon&r=PG", "display_name": "Retired Ninja", "link": "https://stackoverflow.com/users/920069/retired-ninja"}, "edited": false, "score": 3, "creation_date": 1524057870, "post_id": 49900866, "comment_id": 86817170, "body": "Array indices in C or C++ (You should choose one) begin at 0, not 1."}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "reply_to_user": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 2, "creation_date": 1524057883, "post_id": 49900866, "comment_id": 86817179, "body": "@Bathsheba how were you able to add a comment with less than 15 characters? o.O"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1524057940, "post_id": 49900866, "comment_id": 86817229, "body": "Accessing an array out of bounds is <i>undefined behaviour</i> (google that term)."}, {"owner": {"reputation": 40276, "user_id": 432358, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/D931H.png?s=128&g=1", "display_name": "Slava", "link": "https://stackoverflow.com/users/432358/slava"}, "edited": false, "score": 0, "creation_date": 1524058123, "post_id": 49900866, "comment_id": 86817358, "body": "&quot; Why It allows to write where you are not allocated to.&quot;  because it is not obligated to validate your access."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1524058326, "post_id": 49900866, "comment_id": 86817496, "body": "@tkausl: You have to be very rich."}, {"owner": {"reputation": 9301, "user_id": 4944425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05592a58619d128e2eee1c3c17801e76?s=128&d=identicon&r=PG&f=1", "display_name": "Bob__", "link": "https://stackoverflow.com/users/4944425/bob"}, "edited": false, "score": 0, "creation_date": 1524058894, "post_id": 49900866, "comment_id": 86817908, "body": "<i>&quot;My logic is that if we have 20 elements then we have elements of array from index 0 till index 19, and 20 index was written by machine with &#39;\\0&#39; automatically.&quot;</i> The compiler adds the NULL terminator  (and reserve enough space in memory for it) only when you initialize a <b>char</b> array with a string literal: <code>char str[] = &quot;Hello&quot;;</code> --&gt; <code>{&#39;H&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;, &#39;\\0&#39;}</code>, because the string literal itself is null-terminated, but you have arrays of <code>int</code>s"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 9459136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8af2cd2fda1dd12f2e40903a79127ca4?s=128&d=identicon&r=PG&f=1", "display_name": "Guilherme Simas", "link": "https://stackoverflow.com/users/9459136/guilherme-simas"}, "is_accepted": true, "score": 1, "last_activity_date": 1524058517, "creation_date": 1524058517, "answer_id": 49901154, "question_id": 49900866, "link": "https://stackoverflow.com/questions/49900866/stack-smashing-detected-segmentation-fault/49901154#49901154", "title": "Stack smashing detected/segmentation fault", "body": "<p>Notice you are writing from index 1 up to and including n.\nSo if you input X (let's say, 20), your last element will be written to the X+1th index of your array.</p>\n\n<p>That being said, accessing indexes out of your array boundaries renders undefined behavior (as already mentioned by @Bathsheba).</p>\n\n<p>The reason a segmentation fault does not occur when accessing the 21th index, in your case, is probably that since your array was allocated in the stack, is is accessing allocated memory (which could be n, i, or even the program or stack counter).</p>\n\n<p>This has already been asked in other questions, such as <a href=\"https://stackoverflow.com/questions/10051782/array-overflow-why-does-this-work\">this one</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 6580551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/954ecb9e861e153fe5fccebc0df8fdb4?s=128&d=identicon&r=PG&f=1", "display_name": "salt en", "link": "https://stackoverflow.com/users/6580551/salt-en"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "closed_date": 1524058505, "accepted_answer_id": 49901154, "answer_count": 1, "score": -1, "last_activity_date": 1524058626, "creation_date": 1524057767, "question_id": 49900866, "link": "https://stackoverflow.com/questions/49900866/stack-smashing-detected-segmentation-fault", "closed_reason": "Duplicate", "title": "Stack smashing detected/segmentation fault", "body": "<p>Why I input 21 elements and it works fine? and If I input 22 it appears segmentation fault/stack smashing.(OS Linux). If I allocated only 20 elements.\nI've tried some sort of online compilers and there I could even write more elements.</p>\n\n<p>My logic is that if we have 20 elements then we have elements of array from index 0 till index 19, and 20 index was written by machine with '\\0' automatically.</p>\n\n<p>Could you please explain to me how it works. Why It allows to write where you are not allocated to. And why stack smashing/segmentation fault appears on 22 elements rather than 21 elements.</p>\n\n<p>Or could you please let me know what books do I have to use to find information about.</p>\n\n<p>There is a piece of code below.</p>\n\n<pre><code>int n, i;\nint a[20];\n\nprintf(\"Enter no of emelents of array\\n\");\nscanf(\"%d\", &amp;n);\nprintf(\"\\nEnter %d elements: \", n);\nfor(i = 1; i &lt;= n; i++)\n{\n    scanf(\"%d\", &amp;a[i]);\n}\n</code></pre>\n"}, {"tags": ["c", "linux-device-driver", "deadlock", "spinlock", "block-device"], "comments": [{"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 1, "creation_date": 1524056484, "post_id": 49899888, "comment_id": 86816206, "body": "Please post [at least] your module load function. I have a suspicion but would need to see more"}, {"owner": {"reputation": 490, "user_id": 7602674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/193276783eb09a4a1b8c7f18b74a731a?s=128&d=identicon&r=PG&f=1", "display_name": "jjh", "link": "https://stackoverflow.com/users/7602674/jjh"}, "edited": false, "score": 1, "creation_date": 1524056519, "post_id": 49899888, "comment_id": 86816217, "body": "I&#39;m not sure exactly the cause, but the line <code>blk_mod_t *self = request-&gt;rq_disk-&gt;private_data;</code> looks suspicious in any case."}, {"owner": {"reputation": 773, "user_id": 7991581, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f0ffccced69419766694f1774f275a3a?s=128&d=identicon&r=PG&f=1", "display_name": "Arkaik", "link": "https://stackoverflow.com/users/7991581/arkaik"}, "reply_to_user": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 1, "creation_date": 1524057466, "post_id": 49899888, "comment_id": 86816870, "body": "@CraigEstey I have added both init and exit functions. Don&#39;t hesitate if you need more (almost everything is here tough)."}, {"owner": {"reputation": 773, "user_id": 7991581, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f0ffccced69419766694f1774f275a3a?s=128&d=identicon&r=PG&f=1", "display_name": "Arkaik", "link": "https://stackoverflow.com/users/7991581/arkaik"}, "reply_to_user": {"reputation": 490, "user_id": 7602674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/193276783eb09a4a1b8c7f18b74a731a?s=128&d=identicon&r=PG&f=1", "display_name": "jjh", "link": "https://stackoverflow.com/users/7602674/jjh"}, "edited": false, "score": 1, "creation_date": 1524057558, "post_id": 49899888, "comment_id": 86816938, "body": "@JoshuaHannah I never use this field of the request queue. I think I have added this to match tutorials I have seen but I never use it"}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 0, "creation_date": 1524061642, "post_id": 49899888, "comment_id": 86819967, "body": "What are your values for (e.g.) <code>DEVICE_HARD_SECTOR_SIZE</code> et. al? I&#39;m still looking at your driver. While you&#39;re waiting, here&#39;s a decent refererence/tutorial: <a href=\"https://static.lwn.net/images/pdf/LDD3/ch16.pdf\" rel=\"nofollow noreferrer\">static.lwn.net/images/pdf/LDD3/ch16.pdf</a> Based on the traces, a quick guess is that it&#39;s <i>not</i> the spinlock, but the <code>memcpy</code> [silently freezes system] and this happens before the trace message comes out. Add a debug msg after spinlock but <i>before</i> <code>memcpy</code> to further narrow. Also, try commenting out the <code>memcpy</code>s to see if you survive"}, {"owner": {"reputation": 773, "user_id": 7991581, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f0ffccced69419766694f1774f275a3a?s=128&d=identicon&r=PG&f=1", "display_name": "Arkaik", "link": "https://stackoverflow.com/users/7991581/arkaik"}, "reply_to_user": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 0, "creation_date": 1524063015, "post_id": 49899888, "comment_id": 86821034, "body": "@CraigEstey I do have messages before <code>memcpy</code> (i.e. <code>NOTICE(...)</code>). I&#39;ve tried with <code>memcpy</code> commented out and a message just after the call to <code>spin_lock()</code> but still the same behaviour. And btw LDD3 is the book I&#39;m currently using ;) (I have only read chapters 5 and 16 yet)."}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 2, "creation_date": 1524065101, "post_id": 49899888, "comment_id": 86822649, "body": "The request function <i>may</i> be being called from interrupt context. Use <code>spin_trylock</code> to verify (if it comes back false), you are stacking on the same cpu. Also, look at the return from <code>in_interrupt()</code>. If so, you&#39;ll need to replace <code>spin_lock</code> in [at least] the other two places with <code>unsigned long flags = spin_lock_irqsave(...)</code> [and replace the unlocks with the <code>*_irqrestore</code> versions]. Using the irq versions can&#39;t hurt [just a little less performance if they&#39;re not necessary]"}, {"owner": {"reputation": 773, "user_id": 7991581, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f0ffccced69419766694f1774f275a3a?s=128&d=identicon&r=PG&f=1", "display_name": "Arkaik", "link": "https://stackoverflow.com/users/7991581/arkaik"}, "edited": false, "score": 0, "creation_date": 1524069146, "post_id": 49899888, "comment_id": 86825293, "body": "I have tried using <code>in_interrupt()</code> macro and I&#39;m never in interrupt context (always returns 0). However trying to take the lock with <code>spin_trylock</code> into <code>block_mod_transfer</code> function always fails but succeed into <code>block_mod_open</code> and <code>block_mod_release</code> functions. Btw thanks for your help I&#39;m would not have checked it by myself"}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 0, "creation_date": 1524075324, "post_id": 49899888, "comment_id": 86828629, "body": "<code>blk_fetch_request</code> expects that the queue&#39;s lock is held. It has an assert for that [which may be disabled due to the kernel taint re. lock debug]. See <code>lockdep.h</code> and do your own check in your request function before entering."}, {"owner": {"reputation": 773, "user_id": 7991581, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f0ffccced69419766694f1774f275a3a?s=128&d=identicon&r=PG&f=1", "display_name": "Arkaik", "link": "https://stackoverflow.com/users/7991581/arkaik"}, "reply_to_user": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 0, "creation_date": 1524836446, "post_id": 49899888, "comment_id": 87143957, "body": "@CraigEstey I have checked using <code>spin_is_locked(queue-&gt;queue_lock)</code> and it seems that the losk is already held before entering <code>blk_fetch_request</code> as the function returns 1"}], "answers": [{"tags": [], "owner": {"reputation": 773, "user_id": 7991581, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f0ffccced69419766694f1774f275a3a?s=128&d=identicon&r=PG&f=1", "display_name": "Arkaik", "link": "https://stackoverflow.com/users/7991581/arkaik"}, "is_accepted": true, "score": 1, "last_activity_date": 1524843250, "creation_date": 1524843250, "answer_id": 50065779, "question_id": 49899888, "link": "https://stackoverflow.com/questions/49899888/kernel-block-device-falling-in-deadlock-using-spinlock/50065779#50065779", "title": "Kernel block device - Falling in deadlock using spinlock", "body": "<p>Thanks to @CraigEstey's comments I have finally found that the problem came from the fact that the request queue was initialized with the same spinlock than my device structure.</p>\n\n<pre><code>// Allocate the request queue\nif(NULL == (self.queue = blk_init_queue(block_mod_request, &amp;self.device_lock)))\n{\n    ERROR(\"Unable to initialize request queue for '%s'\\n\", MODULE_NAME);\n    vfree(self.data);\n    unregister_blkdev(self.major, MODULE_NAME);\n    return -3;\n}\n</code></pre>\n\n<p>So when the request queue's callback function (i.e. <code>block_mod_request</code>) is called, the spinlock is already held and I'm falling in deadlock.</p>\n"}], "owner": {"reputation": 773, "user_id": 7991581, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f0ffccced69419766694f1774f275a3a?s=128&d=identicon&r=PG&f=1", "display_name": "Arkaik", "link": "https://stackoverflow.com/users/7991581/arkaik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 1, "accepted_answer_id": 50065779, "answer_count": 1, "score": 4, "last_activity_date": 1524843250, "creation_date": 1524054972, "last_edit_date": 1524062577, "question_id": 49899888, "link": "https://stackoverflow.com/questions/49899888/kernel-block-device-falling-in-deadlock-using-spinlock", "title": "Kernel block device - Falling in deadlock using spinlock", "body": "<p>I just implemented a virtual block device and I would like to play with it in order to explore how linux kernel handles block devices.</p>\n\n<p>My device is just a memory zone divided in two 512 bytes sectors.</p>\n\n<p>I'm using a global structure to store device informations:</p>\n\n<pre><code>typedef struct\n{\n    uint32_t hard_sector_size;        // Size of a device sector\n    uint32_t sector_number;           // Number of sector on device\n    uint32_t size;                    // Total size of virtual device in bytes\n    uint8_t* data;                    // Device memory buffer\n    spinlock_t device_lock;           // Device structure access spinlock\n    struct request_queue *queue;      // Device request queue\n    struct gendisk *gendisk;          // Device \"disk\" representation\n    int major;                        // Device major number attributed by kernel\n    int minor;                        // Device minor number fixed at initialization\n    uint32_t r_users;                 // Number of read access\n    uint32_t w_users;                 // Number of write access\n}blk_mod_t;\n\nblk_mod_t self;\n\n[...]\n</code></pre>\n\n<p>Now I would like to protect this structure against concurrent access. To do so I'm using the <code>device_lock</code> field.<br>\nIf the lock is taken, the structure is being updated so I should wait until finished.<br>\nIf it's not taken, I can access the structure fields.</p>\n\n<p>Right now I'm using this spinlock only into the three following functions</p>\n\n<pre><code>static int block_mod_open(struct block_device *bdev, fmode_t mode)\n{\n    access_mode_t access_mode;\n    DEBUG(\"Entering open function\\n\");\n\n    if((mode &amp; FMODE_READ) &amp;&amp; (mode &amp; FMODE_WRITE))\n    {\n        NOTICE(\"Oppened in read/write mode\\n\");\n        mode = ACCESS_RW;\n    }\n    else if(mode &amp; FMODE_READ)\n    {\n        NOTICE(\"Oppened in read only mode\\n\");\n        mode = ACCESS_RONLY;\n    }\n    else if(mode &amp; FMODE_WRITE)\n    {\n        NOTICE(\"Oppened in write only mode\\n\");\n        mode = ACCESS_WONLY;\n    }\n\n    DEBUG(\"&lt;--\\n\");\n    spin_lock(&amp;self.device_lock);\n\n    if(ACCESS_RW == access_mode)\n    {\n        self.r_users++;\n        self.w_users++;\n    }\n    else if(ACCESS_RONLY == access_mode)\n    {\n        self.r_users++;\n    }\n    else\n    {\n        self.w_users++;\n    }\n    NOTICE(\"Read access: %d\\tWrite access: %d\\n\", self.r_users, self.w_users);\n\n    DEBUG(\"--&gt;\\n\");\n    spin_unlock(&amp;self.device_lock);\n\n    DEBUG(\"Exiting open function\\n\");\n    return 0;\n}\n\nstatic void block_mod_release(struct gendisk *disk, fmode_t mode)\n{\n    access_mode_t access_mode;\n    DEBUG(\"Entering release function\\n\");\n\n    if((mode &amp; FMODE_READ) &amp;&amp; (mode &amp; FMODE_WRITE))\n    {\n        NOTICE(\"Closed read/write mode\\n\");\n        mode = ACCESS_RW;\n    }\n    else if(mode &amp; FMODE_READ)\n    {\n        NOTICE(\"Closed read only mode\\n\");\n        mode = ACCESS_RONLY;\n    }\n    else if(mode &amp; FMODE_WRITE)\n    {\n        NOTICE(\"Closed write only mode\\n\");\n        mode = ACCESS_WONLY;\n    }\n\n    DEBUG(\"&lt;--\\n\");\n    spin_lock(&amp;self.device_lock);\n\n    if(ACCESS_RW == access_mode)\n    {\n        self.r_users--;\n        self.w_users--;\n    }\n    else if(ACCESS_RONLY == access_mode)\n    {\n        self.r_users--;\n    }\n    else\n    {\n        self.w_users--;\n    }\n    NOTICE(\"Read access: %d\\tWrite access: %d\\n\", self.r_users, self.w_users);\n\n    DEBUG(\"--&gt;\\n\");\n    spin_unlock(&amp;self.device_lock);\n\n    DEBUG(\"Exiting release function\\n\");\n    return;\n}\n\nstatic void block_mod_transfer(unsigned long sector, unsigned long nsect, char *buffer, int write)\n{\n    unsigned long offset = sector*KERNEL_SECTOR_SIZE;\n    unsigned long nbytes = nsect*KERNEL_SECTOR_SIZE;\n    DEBUG(\"Entering transfer function\\n\");\n    DEBUG(\"&lt;--\\n\");\n    spin_lock(&amp;self.device_lock);\n\n    if((offset + nbytes) &gt; self.size) {\n        WARNING(\"Beyond-end write (%ld %ld)\\n\", offset, nbytes);\n        spin_unlock(&amp;self.device_lock);\n        return;\n    }\n    if(write)\n    {\n        NOTICE(\"Writing to device\\n\");\n        memcpy(self.data + offset, buffer, nbytes);\n    }\n    else\n    {\n        NOTICE(\"Reading from device\\n\");\n        memcpy(buffer, self.data + offset, nbytes);\n    }\n\n    DEBUG(\"--&gt;\\n\");\n    spin_unlock(&amp;self.device_lock);\n    DEBUG(\"Exiting transfer function\\n\");\n}\n</code></pre>\n\n<p>I'm treating requests with the following function</p>\n\n<pre><code>static void block_mod_request(struct request_queue *queue)\n{\n    DEBUG(\"Entering request function\\n\");\n    struct request *request;\n\n    while(NULL != (request = blk_fetch_request(queue)))\n    {\n        blk_mod_t *self = request-&gt;rq_disk-&gt;private_data;\n        // Check if request is a filesystem request (i.e. moves block of data)\n        if(REQ_TYPE_FS != request-&gt;cmd_type)\n        {\n            // Close request with unsuccessful status\n            WARNING(\"Skip non-fs request\\n\");\n            __blk_end_request_cur(request, -EIO);\n            continue;\n        }\n        // Treat request\n        block_mod_transfer(blk_rq_pos(request), blk_rq_cur_sectors(request), bio_data(request-&gt;bio), rq_data_dir(request));\n        // Close request with successful status\n        __blk_end_request_cur(request, 0);\n    }\n\n    DEBUG(\"Exiting request function\\n\");\n    return;\n}\n</code></pre>\n\n<p>When I load the module nothing special happens. However if I try to read from it I'm falling in deadlock as my system doesn't answer anymore and I have to reboot.</p>\n\n<p>Here is the output:</p>\n\n<pre><code>root@PC325:~# echo 8 &gt; /proc/sys/kernel/printk\nroot@PC325:~# insmod block_mod.ko \n[   64.546791] block_mod: loading out-of-tree module taints kernel.\n[   64.548197] block_mod: module license '(c) Test license' taints kernel.\n[   64.549951] Disabling lock debugging due to kernel taint\n[   64.552816] Inserting module 'blk_mod_test'\n[   64.554085] Got major number : '254'\n[   64.554940] Data allocated (size = 1024)\n[   64.557378] Request queue initialized\n[   64.558178] Sent hard sector size to request queue\n[   64.559188] Gendisk allocated\n[   64.559817] Gendisk filled\n[   64.560416] Gendisk capacity set\n[   64.563285] Gendisk added\nroot@PC325:~# [   64.565280] Entering open function\n[   64.566035] Oppened in read only mode\n[   64.566773] &lt;--\n[   64.567138] Read access: 1   Write access: 0\n[   64.567977] --&gt;\n[   64.568342] Exiting open function\n[   64.571080] Entering release function\n[   64.571855] Closed read only mode\n[   64.572531] &lt;--\n[   64.572924] Read access: 0   Write access: 0\n[   64.573749] --&gt;\n[   64.574116] Exiting release function\nroot@PC325:~# cat /dev/blkmodtest \n[   78.488228] Entering open function\n[   78.488988] Oppened in read only mode\n[   78.489733] &lt;--\n[   78.490100] Read access: 1   Write access: 0\n[   78.490925] --&gt;\n[   78.491290] Exiting open function\n[   78.492026] Entering request function\n[   78.492743] Entering transfer function\n[   78.493469] &lt;--\n-------------- DEADLOCK HERE --------------\n</code></pre>\n\n<p><strong><em>UPDATE:</em></strong> Add init and exit functions</p>\n\n<pre><code>static int __init block_mod_init(void)\n{\n    char* message = \"abcdefghijklmnopqrstuvwxyz\";\n    int i;\n\n    INFO(\"Inserting module '%s'\\n\", MODULE_NAME);\n\n    // Initialize driver data structure\n    memset(&amp;self, 0, sizeof(blk_mod_t));\n    self.hard_sector_size = DEVICE_HARD_SECTOR_SIZE;\n    self.sector_number = DEVICE_SECTOR_NUMBER;\n    self.size = self.sector_number*self.hard_sector_size;\n    self.minor = 1;\n\n    // Get a major number from kernel\n    if(0 &gt; (self.major = register_blkdev(self.major, MODULE_NAME)))\n    {\n        ERROR(\"Unable to get major number for '%s'\\n\", MODULE_NAME);\n        unregister_blkdev(self.major, MODULE_NAME);\n        return -1;\n    }\n    DEBUG(\"Got major number : '%d'\\n\", self.major);\n\n    // Allocate data space\n    if(NULL == (self.data = vmalloc(self.size)))\n    {\n        ERROR(\"Unable to allocate memory for '%s'\\n\", MODULE_NAME);\n        unregister_blkdev(self.major, MODULE_NAME);\n        return -2;\n    }\n    for(i=0;i&lt;self.size;i++)\n    {\n        self.data[i] = message[i%strlen(message)];\n    }\n    spin_lock_init(&amp;self.device_lock);\n    DEBUG(\"Data allocated (size = %d)\\n\", self.size);\n\n    // Allocate the request queue\n    if(NULL == (self.queue = blk_init_queue(block_mod_request, &amp;self.device_lock)))\n    {\n        ERROR(\"Unable to initialize request queue for '%s'\\n\", MODULE_NAME);\n        vfree(self.data);\n        unregister_blkdev(self.major, MODULE_NAME);\n        return -3;\n    }\n    DEBUG(\"Request queue initialized\\n\");\n\n    // Send device hard sector size to request queue\n    blk_queue_logical_block_size(self.queue, self.hard_sector_size);\n    self.queue-&gt;queuedata = &amp;self;\n    DEBUG(\"Sent hard sector size to request queue\\n\");\n\n    // Allocate the gendisk structure\n    if(NULL == (self.gendisk = alloc_disk(self.minor)))\n    {\n        ERROR(\"Unable to initialize gendisk for '%s'\\n\", MODULE_NAME);\n        blk_cleanup_queue(self.queue);\n        vfree(self.data);\n        unregister_blkdev(self.major, MODULE_NAME);\n        return -4;\n    }\n    DEBUG(\"Gendisk allocated\\n\");\n\n    // Fill gendisk structure\n    self.gendisk-&gt;major = self.major;\n    self.gendisk-&gt;first_minor = self.minor;\n    self.gendisk-&gt;fops = &amp;self_ops;\n    self.gendisk-&gt;queue = self.queue;\n    self.gendisk-&gt;private_data = &amp;self;\n    snprintf(self.gendisk-&gt;disk_name, 32, \"blkmodtest\");\n    DEBUG(\"Gendisk filled\\n\");\n    set_capacity(self.gendisk, self.sector_number*(self.hard_sector_size/KERNEL_SECTOR_SIZE));\n    DEBUG(\"Gendisk capacity set\\n\");\n    add_disk(self.gendisk);\n    DEBUG(\"Gendisk added\\n\");\n\n    return 0;\n}\n\nstatic void __exit block_mod_cleanup(void)\n{\n    del_gendisk(self.gendisk);\n    put_disk(self.gendisk);\n    blk_cleanup_queue(self.queue);\n    vfree(self.data);\n    unregister_blkdev(self.major, MODULE_NAME);\n\n    INFO(\"Removing module '%s'\\n\", MODULE_NAME);\n    return;\n}\n</code></pre>\n\n<p><strong><em>UPDATE:</em></strong> Add macro and enum definitions</p>\n\n<pre><code>#define MODULE_NAME                    \"blk_mod_test\"\n#define KERNEL_SECTOR_SIZE             512\n#define DEVICE_HARD_SECTOR_SIZE        512\n#define DEVICE_SECTOR_NUMBER           2\n\ntypedef enum\n{\n    ACCESS_RONLY = 0,\n    ACCESS_WONLY = 1,\n    ACCESS_RW    = 2,\n}access_mode_t;\n</code></pre>\n\n<p>What I don't understand is that the spinlock has been released (at end of <code>block_mod_open</code>) before I try to lock it into <code>block_mod_transfer</code>.</p>\n\n<p>So I don't understand why kernel is falling in deadlock when the spinlock seems to be available to be taken.</p>\n\n<p><strong>Why am I falling in deadlock in this case? What am I doing wrong?</strong></p>\n"}, {"tags": ["c", "for-loop", "macros", "int", "concatenation"], "comments": [{"owner": {"reputation": 44454, "user_id": 3219613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b01a7cc73ab19f844bdbcd951876ecb5?s=128&d=identicon&r=PG", "display_name": "P\u1d07\u029c", "link": "https://stackoverflow.com/users/3219613/p%e1%b4%87%ca%9c"}, "edited": false, "score": 1, "creation_date": 1524126239, "post_id": 49899861, "comment_id": 86847799, "body": "you might want specify in your tags which language you are coding in. So the question pops up in this category too."}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1524204130, "post_id": 49899861, "comment_id": 86885422, "body": "No; the preprocessor runs before the main compilation, so the strings it produces are decided before the compiler proper looks at the code."}], "answers": [{"tags": [], "owner": {"reputation": 767708, "user_id": 14860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vXG1F.png?s=128&g=1", "display_name": "paxdiablo", "link": "https://stackoverflow.com/users/14860/paxdiablo"}, "is_accepted": true, "score": 2, "last_activity_date": 1524204692, "creation_date": 1524204692, "answer_id": 49935105, "question_id": 49899861, "link": "https://stackoverflow.com/questions/49899861/can-an-integer-variable-be-substituted-in-a-concatenation-macro/49935105#49935105", "title": "Can an integer variable be substituted in a concatenation ## macro?", "body": "<p>The ISO C standards defines the translation process as being comprised of distinct <em>phases,</em> as per (for example) <code>C11 5.1.1.2</code>. In that section, the pre-processor finishes in phase 4 and syntactic/semantic analysis doesn't begin until phase 7.</p>\n\n<p>That means the expansion of your macro has <em>zero</em> knowledge about the C tokens<sup>(a)</sup> and what objects they refer to. It <em>specifically</em> doesn't know what <em>values</em> those variables will have since pre-processing is a compile-time activity while assignment and evaluation of your variables happens at runtime.</p>\n\n<hr>\n\n<p>In this <em>particular</em> case, you would be better off having an array which you could index into at runtime, something like:</p>\n\n<pre><code>struct wall {\n    int brick_hollow[2];\n    int brick_solid[2];\n} mywall;\n\nfor (int i = 0; i &lt; 2; i++)\n{  \n    mywall.brick_hollow[i] = 20;\n    mywall.brick_solid[i] = 10;\n}\n</code></pre>\n\n<hr>\n\n<p><sup>(a)</sup> It understands <em>pre-processing</em> tokens but they're a different beast.</p>\n"}], "owner": {"reputation": 83, "user_id": 1410471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a9b7ea648abf577f0f684da3080fed2?s=128&d=identicon&r=PG", "display_name": "Vendetta V", "link": "https://stackoverflow.com/users/1410471/vendetta-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 1, "accepted_answer_id": 49935105, "answer_count": 1, "score": 1, "last_activity_date": 1524204692, "creation_date": 1524054890, "last_edit_date": 1524203604, "question_id": 49899861, "link": "https://stackoverflow.com/questions/49899861/can-an-integer-variable-be-substituted-in-a-concatenation-macro", "title": "Can an integer variable be substituted in a concatenation ## macro?", "body": "<pre><code>#define BRICK_HOLLOW(I) brick_ ## I ## _hollow\n#define BRICK_SOLID(I)  brick_ ## I ## _solid\n\n\nstruct wall {\n    int brick_0_hollow;\n    int brick_0_solid;\n    int brick_1_hollow;\n    int brick_1_solid;\n}mywall;\n\n\nfor (int i = 0; i &lt; 2; i++)\n{  \n    mywall.BRICK_HOLLOW(i) = 20;\n    mywall.BRICK_SOLID(i) = 10;\n}\n</code></pre>\n\n<p>Expected output:</p>\n\n<p>The above for loop must expand to</p>\n\n<pre><code>mywall.brick_0_hollow = 20\nmywall.brick_0_solid = 10\nmywall.brick_1_hollow = 20\nmywall.brick_1_solid = 10\n</code></pre>\n\n<p>But the code just substitutes the int as a string. So I get</p>\n\n<pre><code>mywall.brick_i_hollow = 20\n</code></pre>\n\n<p>Which is not defined in the struct declaration and throws a compile error.\nIs there a way to substitute the variable \"int i\" with integer values instead of a string using double indirection? </p>\n"}, {"tags": ["c", "glib", "b-tree"], "comments": [{"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1524060167, "post_id": 49899817, "comment_id": 86818831, "body": "Probably not the answer you want, but if you&#39;re having to do this, it suggests that a tree may not be the data structure you want to be using in the first place."}, {"owner": {"reputation": 7127, "user_id": 186347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41faca9cd29ae1ff1e10ffd01eb15e52?s=128&d=identicon&r=PG", "display_name": "ntd", "link": "https://stackoverflow.com/users/186347/ntd"}, "edited": false, "score": 0, "creation_date": 1525076689, "post_id": 49899817, "comment_id": 87209369, "body": "Duplicate of <a href=\"https://stackoverflow.com/questions/49863758/how-can-i-search-effectively-in-a-btree-on-glib-without-use-foreach\" title=\"how can i search effectively in a btree on glib without use foreach\">stackoverflow.com/questions/49863758/&hellip;</a> (but cannot be marked as such)."}], "owner": {"reputation": 1, "user_id": 7686367, "user_type": "registered", "profile_image": "https://graph.facebook.com/827931124013655/picture?type=large", "display_name": "Ricardo Canela", "link": "https://stackoverflow.com/users/7686367/ricardo-canela"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524056513, "creation_date": 1524054762, "last_edit_date": 1524056513, "question_id": 49899817, "link": "https://stackoverflow.com/questions/49899817/how-to-traverse-a-tree-between-two-keys", "title": "How to traverse a tree between two keys", "body": "<p>I want to traverse a tree using glib. But <code>g_tree_transverse()</code> has been deprecated, and <code>g_tree_foreach()</code> will use all elements and it will be inefficient.</p>\n\n<p>How can I traverse the tree between two keys without going through all the elements, and without using the <code>g_tree_transverse()</code> or <code>g_tree_foreach()</code>?</p>\n"}, {"tags": ["c", "arrays", "struct", "malloc"], "comments": [{"owner": {"reputation": 85822, "user_id": 597607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jCzJi.png?s=128&g=1", "display_name": "Bo Persson", "link": "https://stackoverflow.com/users/597607/bo-persson"}, "edited": false, "score": 4, "creation_date": 1524055384, "post_id": 49899770, "comment_id": 86815424, "body": "To compare two strings you use <a href=\"http://en.cppreference.com/w/c/string/byte/strcmp\" rel=\"nofollow noreferrer\">the <code>strcmp</code> function</a>, not <code>==</code>."}, {"owner": {"reputation": 58292, "user_id": 34824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ri8DI.jpg?s=128&g=1", "display_name": "abelenky", "link": "https://stackoverflow.com/users/34824/abelenky"}, "edited": false, "score": 4, "creation_date": 1524055549, "post_id": 49899770, "comment_id": 86815515, "body": "What problems are you having?  What question are you asking?"}, {"owner": {"reputation": 27, "user_id": 9529088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcb986ab7411eb9dd3c3050f71273e71?s=128&d=identicon&r=PG&f=1", "display_name": "MirEso", "link": "https://stackoverflow.com/users/9529088/mireso"}, "edited": false, "score": 0, "creation_date": 1524055640, "post_id": 49899770, "comment_id": 86815577, "body": "i know thanks :) I just simlified to show my intension of mallocing array"}, {"owner": {"reputation": 27, "user_id": 9529088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcb986ab7411eb9dd3c3050f71273e71?s=128&d=identicon&r=PG&f=1", "display_name": "MirEso", "link": "https://stackoverflow.com/users/9529088/mireso"}, "edited": false, "score": 0, "creation_date": 1524055693, "post_id": 49899770, "comment_id": 86815622, "body": "Ablenky: I&#39;m having problem with creating some sort of array which i can browse with for cycle and compare strings"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1524055831, "post_id": 49899770, "comment_id": 86815737, "body": "&quot;I want to scan another txt &quot;,  I suspect <code>char* old;     char* new;</code> lacking allocated memory to hold the strings is will cause trouble."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 9529088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcb986ab7411eb9dd3c3050f71273e71?s=128&d=identicon&r=PG&f=1", "display_name": "MirEso", "link": "https://stackoverflow.com/users/9529088/mireso"}, "edited": false, "score": 0, "creation_date": 1524058318, "post_id": 49900436, "comment_id": 86817491, "body": "Thank you! Now i tried for cycle under my malloc command and wrote:(for length of rules){dictionary[i].old = &#39;try&#39;; printf(&quot;%s&quot;, dictioanry[i].old);} program stopped working, can you help me? i&#39;m desperate now, i&#39;ts been hours EDIT: haha i got it, i should have used &quot;&quot; instead of &#39; &#39; i&#39;m piece of #... haha thanks mate! you saved me!"}, {"owner": {"reputation": 27, "user_id": 9529088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcb986ab7411eb9dd3c3050f71273e71?s=128&d=identicon&r=PG&f=1", "display_name": "MirEso", "link": "https://stackoverflow.com/users/9529088/mireso"}, "edited": false, "score": 0, "creation_date": 1524059943, "post_id": 49900436, "comment_id": 86818666, "body": "Again me, what if i want to add char instead of string into my dictionary[i].old? this makes my program stop working:(for length of rules){dictionary[i].old[i] = &#39;c&#39;; printf(&quot;%c&quot;, dictioanry[i].old[i]);}"}, {"owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "reply_to_user": {"reputation": 27, "user_id": 9529088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcb986ab7411eb9dd3c3050f71273e71?s=128&d=identicon&r=PG&f=1", "display_name": "MirEso", "link": "https://stackoverflow.com/users/9529088/mireso"}, "edited": false, "score": 0, "creation_date": 1524085850, "post_id": 49900436, "comment_id": 86834026, "body": "@MirEso I think you should ask a new question so that you can post your code as it is now. I&#39;m sure you get help."}], "tags": [], "owner": {"reputation": 32303, "user_id": 4386427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d2d2716ce8bcf5967e7b3c00bd0095b5?s=128&d=identicon&r=PG&f=1", "display_name": "4386427", "link": "https://stackoverflow.com/users/4386427/4386427"}, "is_accepted": false, "score": 1, "last_activity_date": 1524056530, "creation_date": 1524056530, "answer_id": 49900436, "question_id": 49899770, "link": "https://stackoverflow.com/questions/49899770/c-array-of-structures/49900436#49900436", "title": "C - Array of structures", "body": "<p>Your <code>malloc</code> seems to be fine. It allocates an array of <code>Rule</code> with <code>ammount_rules</code> elements. </p>\n\n<p>However, the way you use <code>dictionary</code> seems wrong.</p>\n\n<pre><code>dictionary.old[i]  // wrong\n\ndictionary[i].old  // correct\n\ndictionary.new[i]  // wrong\n\ndictionary[i].new  // correct\n</code></pre>\n\n<p>BTW: Notice that you are comparing pointers - not strings. Use <code>strcmp</code> for comparing strings.</p>\n"}], "owner": {"reputation": 27, "user_id": 9529088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcb986ab7411eb9dd3c3050f71273e71?s=128&d=identicon&r=PG&f=1", "display_name": "MirEso", "link": "https://stackoverflow.com/users/9529088/mireso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "closed_date": 1524071683, "answer_count": 1, "score": -1, "last_activity_date": 1524056530, "creation_date": 1524054605, "question_id": 49899770, "link": "https://stackoverflow.com/questions/49899770/c-array-of-structures", "closed_reason": "Needs details or clarity", "title": "C - Array of structures", "body": "<p>im having a txt file </p>\n\n<blockquote>\n  <p>abc=123  def=456  ...</p>\n</blockquote>\n\n<p>I have defined my struct like this:</p>\n\n<pre><code> typedef struct rule {\n    char* old;\n    char* new;\n }Rule;\n</code></pre>\n\n<p>I have counted the ammount of these rules via function </p>\n\n<blockquote>\n  <p>int count_rules();</p>\n</blockquote>\n\n<p>Now I'm calling this function in another, while making dictionary of rules</p>\n\n<pre><code>void make_dic(){\n ammount_rules = count_rules();\n //here goes the problem\n Rule *dictionary = malloc(ammount_rules * sizeof(Rule));\n}\n</code></pre>\n\n<p>I want to scan another txt and replace old with new so I'd like to acces every twin with simple command</p>\n\n<pre><code>for (i=0; i&lt;ammount_rules;i++){\n  if ( (string_in_text) == (dictionary.old[i]) )\n  {\n  printf(\"%s\" dictionary.new[i]);\n  }\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1524051842, "post_id": 49898776, "comment_id": 86813147, "body": "Please edit your question and fix the indention."}, {"owner": {"reputation": 219167, "user_id": 2380830, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5qiYa.jpg?s=128&g=1", "display_name": "Bathsheba", "link": "https://stackoverflow.com/users/2380830/bathsheba"}, "edited": false, "score": 1, "creation_date": 1524051909, "post_id": 49898776, "comment_id": 86813189, "body": "<code>floor(log10(l)&#47;log10(b[m]));</code> is a big ask for floating point calculations. You&#39;ll realise why if you study the (tenuous) duplicate carefully."}], "owner": {"reputation": 11, "user_id": 9663880, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FDyxHJe2kUw/AAAAAAAAAAI/AAAAAAAAAI8/AAvJL7eXz1c/photo.jpg?sz=128", "display_name": "Pratik Sedhain", "link": "https://stackoverflow.com/users/9663880/pratik-sedhain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "closed_date": 1524051941, "answer_count": 0, "score": 0, "last_activity_date": 1524056205, "creation_date": 1524051503, "last_edit_date": 1524056205, "question_id": 49898776, "link": "https://stackoverflow.com/questions/49898776/can-anyone-help-me-determining-the-flaws-in-my-code", "closed_reason": "Duplicate", "title": "Can anyone help me determining the flaws in my code?", "body": "<p>I want to calulate the lcm of 1 to 20. This code works perfectly for 1 to<br>\n    10, but when I use the same code for 1 to 20 the output is 232792237.\n    The correct output is 232792560. I'm stuck.</p>\n\n<p>C program to determine the lcm of 1 to 20 </p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;math.h&gt;\n#define MAX 1000\nint main()\n{\n   int a,z,i,j,b[MAX],k=0,count=0,l,p,n=1,limit,m=0;\n   printf(\"Enter two numbers\");\n   scanf(\"%d%d\",&amp;a,&amp;z);\n   l=z;\n   /*Storing prime numbers in array*/\n   for(i=a+1;i&lt;=z-1;i++)\n   {\n       for(j=2;j&lt;i;j++)\n       {\n          if(i%j==0)\n          break;\n       }\n\n       if(j==i)\n       {\n          b[k]=i;\n          k++;\n          count++;\n       }  \n    }\n    limit=sqrt(l);\n\n    /*Determining the smallest multiple*/\n    while(b[m]&lt;=l)\n    {\n       p=1;\n       if(b[m]&lt;=limit)\n          p=floor(log10(l)/log10(b[m]));\n       n=n*pow(b[m],p);\n       m++;\n       printf(\"%d\\n\",n);\n   }\n   return(0);\n}\n</code></pre>\n"}, {"tags": ["c", "static", "mocking", "cmocka"], "answers": [{"tags": [], "owner": {"reputation": 23946, "user_id": 3100312, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/486be6e961e6c8a2e4705058600e666f?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Ogilvie", "link": "https://stackoverflow.com/users/3100312/paul-ogilvie"}, "is_accepted": false, "score": 2, "last_activity_date": 1524052474, "creation_date": 1524052474, "answer_id": 49899098, "question_id": 49898454, "link": "https://stackoverflow.com/questions/49898454/mock-wrap-static-functions-called-by-a-non-static-function-under-test/49899098#49899098", "title": "Mock/Wrap static functions called by a non-static function under test", "body": "<p>If you have a .c file with a public function and two static functions, and the public function calls the static functions, then you cannot prevent the static functions being called. After all, they are one compilation unit.</p>\n\n<p>You can:</p>\n\n<ul>\n<li><p>test them as a whole</p></li>\n<li><p>use <code>#ifdef</code> conditional compilation to replace the static functions with simplified, non-hardware calling static functions to test the public function</p></li>\n<li><p>use <code>#ifdef</code> conditional compilation to replace the public function with a specialised public function to test the static functions.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 309, "user_id": 5567817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e546330d9d1e879b77caceb096f55282?s=128&d=identicon&r=PG&f=1", "display_name": "Iniesta8", "link": "https://stackoverflow.com/users/5567817/iniesta8"}, "edited": false, "score": 0, "creation_date": 1524724320, "post_id": 49901081, "comment_id": 87088451, "body": "Thanks Groo. I&#39;ve solved the problem by creating a separate layer (HAL). Now the functions are non static and I can mock them easily."}], "tags": [], "owner": {"reputation": 45685, "user_id": 69809, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/yCVF0.jpg?s=128&g=1", "display_name": "Groo", "link": "https://stackoverflow.com/users/69809/groo"}, "is_accepted": true, "score": 3, "last_activity_date": 1524058321, "creation_date": 1524058321, "answer_id": 49901081, "question_id": 49898454, "link": "https://stackoverflow.com/questions/49898454/mock-wrap-static-functions-called-by-a-non-static-function-under-test/49901081#49901081", "title": "Mock/Wrap static functions called by a non-static function under test", "body": "<p>As @Paul wrote, this is simply how <code>--wrap</code> works, the functions need to be in a different compilation unit if you want gcc to wrap them. Generally, static methods are private implementation details which you don't want to expose for testing. </p>\n\n<p>So to add some more options to the other answer:</p>\n\n<ol>\n<li><p>Obviously, the simplest way to mock these functions without polluting the original code with conditionals is to extract them into a separate layer (in this case, a HAL).</p></li>\n<li><p>You can make the <code>static</code> modifier conditional, which will allow wrapping with cmocka. This does less polluting to the original code than a bunch of <code>#ifdef</code>s:</p>\n\n<pre><code>#ifndef UNIT_TESTING\n#  define mockable_static static\n#else\n#  define mockable_static\n#endif\n\n// then, replace 'static' with 'mockable_static'\nmockable_static void some_static_method(void) {\n   ... \n}\n</code></pre></li>\n<li><p>Use objcopy to globalize and weaken selected static functions, as explained in <a href=\"https://stackoverflow.com/a/46103766/69809\">this answer</a>.</p></li>\n</ol>\n"}], "owner": {"reputation": 309, "user_id": 5567817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e546330d9d1e879b77caceb096f55282?s=128&d=identicon&r=PG&f=1", "display_name": "Iniesta8", "link": "https://stackoverflow.com/users/5567817/iniesta8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1052, "favorite_count": 1, "accepted_answer_id": 49901081, "answer_count": 2, "score": 1, "last_activity_date": 1524058321, "creation_date": 1524050469, "question_id": 49898454, "link": "https://stackoverflow.com/questions/49898454/mock-wrap-static-functions-called-by-a-non-static-function-under-test", "title": "Mock/Wrap static functions called by a non-static function under test", "body": "<p>I would like to test some functions by implementing unit tests with cmocka framework.</p>\n\n<p>For example I have a non-static function under test which calls two static functions. Because of the fact that these static functions interact with hardware I want to mock/wrap them and use a wrap function instead of the real function when testing.</p>\n\n<p>Like described in the cmocka documentation I've used the --wrap=myfunction linker flags when building/linking my tests.</p>\n\n<p>The tests compile but when I run them the real static functions will be called instead of the wraps.</p>\n\n<p>When I declare the static functions non-static it doesn't work either and also the real functions are called. The only solution I've found is to outsource the functions in an extra .c-file...but that's a really bad workaround because it manipulates the code very much.</p>\n"}, {"tags": ["c", "linux", "linker", "gnu", "ld"], "comments": [{"owner": {"reputation": 75299, "user_id": 139746, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/BhJLC.png?s=128&g=1", "display_name": "Pascal Cuoq", "link": "https://stackoverflow.com/users/139746/pascal-cuoq"}, "edited": false, "score": 1, "creation_date": 1524054709, "post_id": 49898012, "comment_id": 86814962, "body": "Hello, sorry but StackOverflow is really not intended for this kind of very broad question. There is a C_Programming subreddit which I think is not limited in scope the way StackOverflow is. It is possible you may get advice there: <a href=\"https://www.reddit.com/r/C_Programming/\" rel=\"nofollow noreferrer\">reddit.com/r/C_Programming</a>"}, {"owner": {"reputation": 3510, "user_id": 2162550, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f74689baa9af8a44163fa395c457212f?s=128&d=identicon&r=PG", "display_name": "user2162550", "link": "https://stackoverflow.com/users/2162550/user2162550"}, "edited": false, "score": 1, "creation_date": 1524123697, "post_id": 49898012, "comment_id": 86846305, "body": "Though this question is marked as <code>too broad</code>, I believe that the low-level coders community will dramatically benefit from an answer to this question."}, {"owner": {"reputation": 39, "user_id": 5758588, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fS8m12NH0ts/AAAAAAAAAAI/AAAAAAAAABY/Ocm0iEWnD5U/photo.jpg?sz=128", "display_name": "uma sraz", "link": "https://stackoverflow.com/users/5758588/uma-sraz"}, "edited": false, "score": 0, "creation_date": 1524232241, "post_id": 49898012, "comment_id": 86902516, "body": "i understand the question is too broad, but so is the code for GNUlinker :D, i am not able to understand where to start, just a little information as where to start for x86_64 would help me BIG"}], "owner": {"reputation": 39, "user_id": 5758588, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fS8m12NH0ts/AAAAAAAAAAI/AAAAAAAAABY/Ocm0iEWnD5U/photo.jpg?sz=128", "display_name": "uma sraz", "link": "https://stackoverflow.com/users/5758588/uma-sraz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 378, "favorite_count": 5, "closed_date": 1524054535, "answer_count": 0, "score": 2, "last_activity_date": 1524050017, "creation_date": 1524049102, "last_edit_date": 1524050017, "question_id": 49898012, "link": "https://stackoverflow.com/questions/49898012/how-can-i-start-understanding-the-source-code-of-gnu-linker", "closed_reason": "Needs more focus", "title": "how can i start understanding the source code of GNU-linker", "body": "<p>Iam an engineer working with GNU tools for over an year,\nIam fairly good at using almost all the gnu-tools (readelf, gcc, gdb, nm objcopy, objdump ..), and very strongly biased towards C language.</p>\n\n<p>I started reading John R Levine's Linkers&amp;Loaders.\nSo far so good but i always wanted to understand deeply how linker does what it does.</p>\n\n<p>so i choose to understand the linker source code x64_64 architecture, i have downloaded source of gnu-binutils but i am unable to understand where to start, so if somebody can give me a head's up or kickstart i will start reading the code.</p>\n\n<p>please do explain the source code of gnulinker at very base level and point me to right direction.</p>\n\n<p>I have also worked on a project where i got to edit few linker scripts, so i am good with linker scripts (GNU) at basic level</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["c", "arrays", "string", "text", "char"], "comments": [{"owner": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 3, "creation_date": 1524048332, "post_id": 49897690, "comment_id": 86810722, "body": "You forgot to add the final &#39;\\0&#39; in each of <code>a</code>&#39;s line. And your algorithm have many flaw (like how you increment j each time a non-letter appear. What if you have &quot;, &quot; ? you increment two time instead of one). I advise you to see &quot;strtok&quot;"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 2, "creation_date": 1524048615, "post_id": 49897690, "comment_id": 86810905, "body": "And using a debugger may help here too."}], "answers": [{"comments": [{"owner": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 1, "creation_date": 1524049509, "post_id": 49897886, "comment_id": 86811524, "body": "No, strtok does not skip automatically blank space (since when ?). Futhermore, your code is false (missing &#39;)&#39; at the end of for loop)."}, {"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "reply_to_user": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 0, "creation_date": 1524051293, "post_id": 49897886, "comment_id": 86812749, "body": "@Tom&#39;s how could i skip blank space if strtok doesn&#39;t do it?"}, {"owner": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 0, "creation_date": 1524051999, "post_id": 49897886, "comment_id": 86813251, "body": "By adding &#39; &#39; in strtok delimitator."}], "tags": [], "owner": {"reputation": 33821, "user_id": 45685, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y4RJr.jpg?s=128&g=1", "display_name": "AndersK", "link": "https://stackoverflow.com/users/45685/andersk"}, "is_accepted": false, "score": 1, "last_activity_date": 1524121340, "last_edit_date": 1524121340, "creation_date": 1524048747, "answer_id": 49897886, "question_id": 49897690, "link": "https://stackoverflow.com/questions/49897690/c-extract-words-from-a-txt-file-except-spaces-and-punctuations/49897886#49897886", "title": "C extract words from a txt file except spaces and punctuations", "body": "<p>you could instead try to use <code>strtok</code></p>\n\n<pre><code>fgets(buffer,buf_size,fp);\nfor (char* tok = strtok(buffer,\".,: \"); *tok; tok = strtok(NULL,\".,: \"))\n{\n   printf(\"%s\\n\", tok);\n}\n</code></pre>\n\n<p><strong>Note</strong> that if you want to store what <code>strtok</code> returns you need to either copy the contents of what <code>tok</code> points to or allocate a copy using strdup/malloc+strcpy since <code>strtok</code> modifies its copy of the first argument as it parses the string.</p>\n"}, {"tags": [], "owner": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "is_accepted": false, "score": 0, "last_activity_date": 1524064613, "last_edit_date": 1524064613, "creation_date": 1524051936, "answer_id": 49898908, "question_id": 49897690, "link": "https://stackoverflow.com/questions/49897690/c-extract-words-from-a-txt-file-except-spaces-and-punctuations/49898908#49898908", "title": "C extract words from a txt file except spaces and punctuations", "body": "<p>You forgot to add the final <code>'\\0'</code> in each of <code>a</code>'s line, and your algorithm have many flaw (like how you increment <code>j</code> each time a non-letter appear. What if you have <code>\", \"</code> ? you increment two time instead of one).</p>\n\n<p>One \"easy\" way is to use \"strtok\", as Anders K. show you.</p>\n\n<pre><code>fgets(buffer,buf_size,fp);\nfor (char* tok = strtok(buffer,\".,:\"); *tok; tok = strtok(NULL,\".,:\")) {\n   printf(\"%s\\n\", tok);\n}\n</code></pre>\n\n<p>The \"problem\" of that function, is that you have to specify all the delimiter, so you have to add <code>' '</code> (space), <code>'\\t'</code> (tabulation) etc etc.</p>\n\n<p>Since you only want \"word\" as described by \"contain only letter, minuscule or majuscule\", then you can do the following:</p>\n\n<pre><code>int main(void)\n{\n    char line[] = \"Hello ! What a beautiful day, isn't it ?\";\n\n    char *beginWord = NULL;\n\n    for (size_t i = 0; line[i]; ++i) {\n        if (isalpha(line[i])) { // upper or lower letter ==&gt; valid character for a word\n            if (!beginWord) {\n                // We found the beginning of a word\n                beginWord = line + i;\n            }\n        } else {\n            if (beginWord) {\n                // We found the end of a word\n                char tmp = line[i];\n                line[i] = '\\0';\n                printf(\"'%s'\\n\", beginWord);\n                line[i] = tmp;\n                beginWord = NULL;\n            }\n        }\n    }\n\n    return (0);\n}\n</code></pre>\n\n<p>Note that how \"isn't\" is splitted in \"isn\" and \"t\", since <code>'</code> is not an accpeted character for your word.</p>\n\n<p>The algo is pretty simple: we just loop the string, and if it's a valid letter and <code>beginWord == NULL</code>, then it's the beginning of the word. If it's not a valid letter and <code>beginWord != NULL</code>, then it's the end of a word. Then you can have every number of letter between two word, you still can detect cleanly the word.</p>\n"}], "owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1524121340, "creation_date": 1524048152, "last_edit_date": 1524064485, "question_id": 49897690, "link": "https://stackoverflow.com/questions/49897690/c-extract-words-from-a-txt-file-except-spaces-and-punctuations", "title": "C extract words from a txt file except spaces and punctuations", "body": "<p>I'm trying to extract the words from a .txt file which contains the following sentence</p>\n\n<blockquote>\n  <p>Quando avevo cinqve anni, mia made mi perpeteva sempre che la felicita e la chiave della vita. Quando andai a squola mi domandrono come vuolessi essere da grande. Io scrissi: selice. Mi dissero che non avevo capito il corpito, e io dissi loro che non avevano capito la wita.</p>\n</blockquote>\n\n<p>The problem is that in the array that I use to store the words, it stores also empty words <code>' '</code> which come always after one of the following <code>','</code> <code>'.'</code> <code>':'</code></p>\n\n<p>I know that things like \"empty words\" or \"empty chars\" don't make sense but please try the code with the text that I've passed and you'll understand.</p>\n\n<p>Meanwhile I'm trying to understand the use of <code>sscanf</code> with this modifier <code>sscanf(buffer, \"%[^.,:]\");</code> that should allow me to store strings ignoring the <code>.</code> and <code>,</code> and <code>:</code> characters however I don't know what should <code>i</code> write in <code>%[^]</code> to ignore the empty character <code>' '</code> which always gets saved.</p>\n\n<p>The code is the following</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nstatic void load_array(const char* file_name){\n  char buffer[2048];\n  char a[100][100];\n  int buf_size = 2048;\n  FILE *fp;\n  int j = 0, c = 0;\n\n  printf(\"\\nLoading data from file...\\n\");\n\n  fp = fopen(file_name,\"r\"); \n\n  if(fp == NULL){\n    fprintf(stderr,\"main: unable to open the file\");\n    exit(EXIT_FAILURE);\n  }\n\n  fgets(buffer,buf_size,fp);\n\n  //here i store each word in an array of strings when I encounter \n  //an unwanted char I save the word into the next element of the \n  //array    \n  for(int i = 0; i &lt; strlen(buffer); i++) {    \n\n    if((buffer[i] &gt;= 'a' &amp;&amp; buffer[i] &lt;= 'z') || (buffer[i] &gt;= 'A' &amp;&amp; buffer[i] &lt;= 'Z')) {\n        a[j][c++] = buffer[i];  \n    } else {\n        j++;\n        c = 0;\n        continue;\n    }\n  }\n\n  //this print is used only to see the words in the array of strings\n  for(int i = 0; i &lt; 100; i++) \n    printf(\"%s  %d\\n\", a[i], i);\n\n  fclose(fp);\n  printf(\"\\nData loaded\\n\");\n}\n\n//Here I pass the file_name from command line\nint main(int argc, char const *argv[]) {\n  if(argc &lt; 2) {\n    printf(\"Usage: ordered_array_main &lt;file_name&gt;\\n\");\n    exit(EXIT_FAILURE);\n  }\n\n  load_array(argv[1]);\n\n}\n</code></pre>\n\n<p>I know that I should store only the necessary number and words and not 100 everytime, I want to think about that later on, right now I want to fix the issue with the empty words.</p>\n\n<p>Compilation and execution</p>\n\n<pre><code>gcc -o testloadfile testloadfile.c\n\n./testloadfile \"correctme.txt\"\n</code></pre>\n"}, {"tags": ["python", "c", "api", "pointers"], "comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1524049965, "post_id": 49896808, "comment_id": 86811816, "body": "how did you import it into Python?! Read about Ctypes and <a href=\"https://docs.scipy.org/doc/numpy-1.12.0/reference/generated/numpy.ndarray.ctypes.html\" rel=\"nofollow noreferrer\">docs.scipy.org/doc/numpy-1.12.0/reference/generated/&hellip;</a>"}, {"owner": {"reputation": 21, "user_id": 9663348, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heS3Q.jpg?s=128&g=1", "display_name": "Maron", "link": "https://stackoverflow.com/users/9663348/maron"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1524120849, "post_id": 49896808, "comment_id": 86844545, "body": "Thank you! I found out that you got to access the PyArrayObject which is a struct that conatins the data as I want it."}], "owner": {"reputation": 21, "user_id": 9663348, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/heS3Q.jpg?s=128&g=1", "display_name": "Maron", "link": "https://stackoverflow.com/users/9663348/maron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 28, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524045734, "creation_date": 1524045734, "question_id": 49896808, "link": "https://stackoverflow.com/questions/49896808/how-to-pass-array-from-python-to-c-using-numpy", "title": "how to pass array from python to c using numpy", "body": "<p>Let's say I have the following function written in C:</p>\n\n<pre><code>/* C-Code for calculating the average for a given dataset */\n\n#define NOE 16\n\nint calcAvg(float *data, float *avg)\n{\n    float sum; sum = 0;     \n\n    int i;\n    for (i = 0; i &lt; NOE; i++) \n    {\n        data[i] = i;\n        sum += data[i];\n    }\n    avg = sum/n;\n\n    return 0;\n}\n</code></pre>\n\n<p>Now I want to pass the data from an np.array to that C function \"calAvg\". Also, I want the result to be stored in \"result\" which I defined in python. </p>\n\n<pre><code># Python Code\nresult = float(0)\n\na = np.array([1, 2, 3, 4])\n\nmyCfuncion.calc(a, result) \n</code></pre>\n\n<p>I have already created a C module and imported it into python. The problem I have is that I do not know how to pass pointers in such a way I showed. </p>\n\n<p>Anybody does have an idea? </p>\n"}, {"tags": ["c", "arduino", "avr", "usart"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 4117674, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZsMuiya99UE/AAAAAAAAAAI/AAAAAAAAAO8/8CbTgT_b_FU/photo.jpg?sz=128", "display_name": "fordp", "link": "https://stackoverflow.com/users/4117674/fordp"}, "is_accepted": false, "score": 1, "last_activity_date": 1524102239, "last_edit_date": 1524102239, "creation_date": 1524052127, "answer_id": 49898966, "question_id": 49896716, "link": "https://stackoverflow.com/questions/49896716/avr-usart-communication/49898966#49898966", "title": "AVR USART communication", "body": "<p><code>strlen(string)</code> in your code does not make sense. How can you get the length of a string that has not been sent yet?</p>\n\n<p>Change that to <code>len = 55</code> or <code>len = sizeof(string)</code>.</p>\n\n<p>In C, <code>strlen</code> counts the number of characters before finding the zero terminator.</p>\n"}], "owner": {"reputation": 11, "user_id": 9146544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2becbba1b91b876d0b71bf03ffd7820c?s=128&d=identicon&r=PG&f=1", "display_name": "Rufusy", "link": "https://stackoverflow.com/users/9146544/rufusy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1524102239, "creation_date": 1524045473, "last_edit_date": 1524102190, "question_id": 49896716, "link": "https://stackoverflow.com/questions/49896716/avr-usart-communication", "title": "AVR USART communication", "body": "<p>I am implementing USART communication on an AVR micro-controller. Below is my code. At the moment, I can send a character, send a string and receive a character. I have a method to receive a string.</p>\n\n<p>The method is called <code>char* receive_string()</code> and returns the address of the string that I am receiving. This is the 55 element char array to hold the string, <code>char string[55]</code>. However, for example, when I send the word <code>hello</code> to the micro-controller, this method returns only the first character <code>h</code>. What is it that I am doing wrong?</p>\n\n<pre><code>#include &lt;avr/io.h&gt;\n#include &lt;util/delay.h&gt;\n#include &lt;string.h&gt;\n#include &lt;avr/interrupt.h&gt;\n\n// macro definition\n#define bit(n) (1 &lt;&lt; n) // bit\n#define sbit(v, n) v |= (1 &lt;&lt; n)    // set bit\n#define cbit(v, n) v &amp;= !(1 &lt;&lt; n)   // clear bit\n#ifndef F_CPU\n#define F_CPU 16000000\n#endif\n#define BAUD 9600   // baud rate\n#define M_UBRR ((F_CPU/16/BAUD)-1)  //contents of UBRRnH and UBRRnL registers\n\n// function prototypes\nvoid usart_init();\nvoid send_char(char);\nvoid send_string(char*);\nchar receive_char();\nchar* receive_string();\nchar string[55];\n\nint main() {\n  usart_init();\n  char* msg = receive_string();\n  sei();\n  while (1) {\n    send_string(msg);\n    _delay_ms(1000);\n  }\n  return 0;\n}\n\nvoid usart_init() {\n  UBRR0H = (M_UBRR &gt;&gt; 8);    // setting baud rate\n  UBRR0L = M_UBRR;\n  UCSR0B = (1 &lt;&lt; TXEN0) | (1 &lt;&lt; RXEN0) | (1 &lt;&lt; RXCIE0); // enable transmitter and receiver\n  UCSR0C = (1 &lt;&lt; USBS0); // 2 stop bit\n  UCSR0C = (1 &lt;&lt; UCSZ00) | (1 &lt;&lt; UCSZ01);\n}\n\nvoid send_char(char byte) {\n  while (!(UCSR0A &amp; (1 &lt;&lt; UDRE0)));  // wait until the register is empty\n  UDR0 = byte;   // put a char in the UDR0 register\n}\n\nvoid send_string(char* string) {\n  int i;\n  int len = strlen(string);\n  for (i = 0; i &lt; len; i++) {\n    send_char(string[i]);\n  }\n}\n\nchar receive_char() {\n  while (!(UCSR0A &amp; (1 &lt;&lt; RXC0))); // wait until all data in receive buffer is read\n  return UDR0;\n}\n\nchar* receive_string() {\n  char x;\n  int len = strlen(string);\n  int i = 0;\n  while (i &lt; len) {\n    x = receive_char();\n    string[i++] = x;\n  }\n  string[len] = '\\0';\n  return (string);\n}\n</code></pre>\n"}, {"tags": ["c", "while-loop", "scanf", "eof"], "comments": [{"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "reply_to_user": {"reputation": 6975, "user_id": 3121023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f52448806175b9aa66c86d40cf0829f1?s=128&d=identicon&r=PG&f=1", "display_name": "user3121023", "link": "https://stackoverflow.com/users/3121023/user3121023"}, "edited": false, "score": 0, "creation_date": 1524046386, "post_id": 49896674, "comment_id": 86809373, "body": "@user3121023 I get a compiler error. Maybe I understood it wrong? Could you show me in whole what you mean?"}], "answers": [{"comments": [{"owner": {"reputation": 66625, "user_id": 229602, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/50063ac5c0d377349bb613953cf61be4?s=128&d=identicon&r=PG", "display_name": "Noufal Ibrahim", "link": "https://stackoverflow.com/users/229602/noufal-ibrahim"}, "edited": false, "score": 1, "creation_date": 1524046109, "post_id": 49896872, "comment_id": 86809180, "body": "As expected. <code>scanf</code> will read once and <code>getchar</code> a second time. You need to get rid of <code>getchar</code> if you want to read only once."}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "reply_to_user": {"reputation": 66625, "user_id": 229602, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/50063ac5c0d377349bb613953cf61be4?s=128&d=identicon&r=PG", "display_name": "Noufal Ibrahim", "link": "https://stackoverflow.com/users/229602/noufal-ibrahim"}, "edited": false, "score": 0, "creation_date": 1524046235, "post_id": 49896872, "comment_id": 86809288, "body": "@NoufalIbrahim If I get rid of getchar how can I detect EOF?"}, {"owner": {"reputation": 66625, "user_id": 229602, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/50063ac5c0d377349bb613953cf61be4?s=128&d=identicon&r=PG", "display_name": "Noufal Ibrahim", "link": "https://stackoverflow.com/users/229602/noufal-ibrahim"}, "edited": false, "score": 0, "creation_date": 1524046297, "post_id": 49896872, "comment_id": 86809322, "body": "Check my answer and the first comment to your question. <code>scanf</code> itself will return <code>EOF</code> it if encounters the end of input."}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "reply_to_user": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524046666, "post_id": 49896872, "comment_id": 86809556, "body": "I modified  my answer @ZoeyMalkov check. As told by Noufal <code>Scanf()</code> itself will return <code>EOF</code> if it encounters end of input."}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524046857, "post_id": 49896872, "comment_id": 86809674, "body": "@achal I can&#39;t use the function do. I also don&#39;t know what it is. Is there a way to do it using an if statement or something?"}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1524046984, "post_id": 49896872, "comment_id": 86809766, "body": "<code>do</code> is not a <code>function</code>, its a <code>loop</code> called <code>do..while</code> loop &amp; you can use, its best suitable for this scenario."}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1524047058, "post_id": 49896872, "comment_id": 86809813, "body": "<i>Is there a way to do it using an if statement ?</i> I shown above right ? check the return value of <code>scanf()</code>"}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524047396, "post_id": 49896872, "comment_id": 86810054, "body": "@achal I don&#39;t quiet understand do, I can&#39;t use <code>do</code> either. Is do like a while loop within a while loop? Or is do, just saying do this when its in the loop? if its like this, couldn&#39;t I remove <code>do</code>  and place its conents within the while loop and the program will do the same thing?"}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1524048112, "post_id": 49896872, "comment_id": 86810556, "body": "<code>do..while</code> is one of iterative control statement, you can&#39;t separate <code>do</code> from <code>while</code> . just check the syntax of here <a href=\"https://en.wikipedia.org/wiki/Do_while_loop\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Do_while_loop</a>"}], "tags": [], "owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "is_accepted": false, "score": 1, "last_activity_date": 1524049492, "last_edit_date": 1524049492, "creation_date": 1524045860, "answer_id": 49896872, "question_id": 49896674, "link": "https://stackoverflow.com/questions/49896674/stopping-user-input-after-ctrld-requires-2-presses-why/49896872#49896872", "title": "Stopping user input after Ctrl+D requires 2 presses; why?", "body": "<p>you no need to use <code>getchar()</code> separately before loop &amp; inside loop. use <code>getchar()</code> in condition &amp; also <code>scanf()</code> will return <code>EOF</code> if it encounters <em>end of input</em> so check the <em>return value</em> of <code>scanf()</code>. Do like this</p>\n\n<pre><code>int main() {\n        int input_array[MAX_NUMBERS] = {0};\n        int i = 0,ret;\n\n        do {\n                ret = scanf(\"%d\", &amp;input_array[i]);/* if you pressed\n                                              CTRL+D, scanf return EOF */\n                if(ret == EOF)/* if ctrl+d pressed,condition becomes true */\n                        break;\n                i++;\n        }while ((i &lt; 5000) &amp;&amp; (getchar() != EOF));/* it won't check this\n                                             bcz of break statement if CTRL+d pressed */\n        return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524046126, "post_id": 49896889, "comment_id": 86809199, "body": "Sorry, I&#39;m sort of new to programming. What value does scanf return or show when it fails (so I can do the if statement for it). Also I can&#39;t use feof(stdin) because we haven&#39;t learnt it in class. We can only use things we learnt, which is like if statements"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524046339, "post_id": 49896889, "comment_id": 86809350, "body": "@ZoeyMalkov scanf returns EOF on error/EOF. It&#39;s in the manpage (or the standard). I&#39;ve added the details to the answer."}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524046557, "post_id": 49896889, "comment_id": 86809479, "body": "Thanks for the help but I can&#39;t use things like feof or break since I haven&#39;t learnt them. Is there any other way?"}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524046756, "post_id": 49896889, "comment_id": 86809599, "body": "If Scanf returns EOF too, how can I write an if statement for that? would it be like <code>if (input_array[i] != EOF)</code>?"}], "tags": [], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "is_accepted": false, "score": 1, "last_activity_date": 1524046157, "last_edit_date": 1524046157, "creation_date": 1524045904, "answer_id": 49896889, "question_id": 49896674, "link": "https://stackoverflow.com/questions/49896674/stopping-user-input-after-ctrld-requires-2-presses-why/49896889#49896889", "title": "Stopping user input after Ctrl+D requires 2 presses; why?", "body": "<p>You're likely to encounter the <code>EOF</code> while in <code>scanf</code>, so what you should do is test the return value of <code>scanf</code> and when it fails call <code>feof(stdin)</code> to see whether the failure was due to an <code>EOF</code> or an error.</p>\n\n<pre><code>for(i=1;i&lt;4999;i++){\n   if(EOF==scanf(\"%d\", &amp;input_array[i])){\n      if(feof(stdin)) /*EOF*/; else /*error*/;\n      break;\n   }\n}\n</code></pre>\n\n<p>As the <a href=\"https://linux.die.net/man/3/scanf\" rel=\"nofollow noreferrer\">scanf(3)</a> manpage indicates, scanf returns <code>EOF</code> on either an error (in which case <code>errno</code> is set to one of the values listed in the manpage) or <code>EOF</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524046638, "post_id": 49896940, "comment_id": 86809537, "body": "I can&#39;t use functions like do. I don&#39;t know if ret is a function or not, but I can&#39;t use it. I can use things like if statements?"}, {"owner": {"reputation": 66625, "user_id": 229602, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/50063ac5c0d377349bb613953cf61be4?s=128&d=identicon&r=PG", "display_name": "Noufal Ibrahim", "link": "https://stackoverflow.com/users/229602/noufal-ibrahim"}, "reply_to_user": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524046803, "post_id": 49896940, "comment_id": 86809635, "body": "<code>ret</code> is an <code>int</code> variable. <code>do</code> is not a function. It&#39;s part of <code>C</code> and is a variant of <code>while</code> with the test at the end rather than the beginning. You can do this like you&#39;ve done as well. Put one extra <code>scanf</code> and <code>if</code> test outside the loop. Then you can use a <code>while</code> instead."}, {"owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524047114, "post_id": 49896940, "comment_id": 86809855, "body": "if I use fgets, can fgets read integers as integers? Then somehow use atoi function?"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524049839, "post_id": 49896940, "comment_id": 86811742, "body": "@ZoeyMalkov <a href=\"https://stackoverflow.com/questions/17710018/why-shouldnt-i-use-atoi?noredirect=1&amp;lq=1\">Don&#39;t use <code>atoi()</code></a>."}, {"owner": {"reputation": 66625, "user_id": 229602, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/50063ac5c0d377349bb613953cf61be4?s=128&d=identicon&r=PG", "display_name": "Noufal Ibrahim", "link": "https://stackoverflow.com/users/229602/noufal-ibrahim"}, "reply_to_user": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "edited": false, "score": 0, "creation_date": 1524120451, "post_id": 49896940, "comment_id": 86844296, "body": "@ZoeyMalkov The bottom line is to avoid using <code>getchar</code> and to rely on the return value of <code>scanf</code>. The rest is upto you."}], "tags": [], "owner": {"reputation": 66625, "user_id": 229602, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/50063ac5c0d377349bb613953cf61be4?s=128&d=identicon&r=PG", "display_name": "Noufal Ibrahim", "link": "https://stackoverflow.com/users/229602/noufal-ibrahim"}, "is_accepted": false, "score": 1, "last_activity_date": 1524046039, "creation_date": 1524046039, "answer_id": 49896940, "question_id": 49896674, "link": "https://stackoverflow.com/questions/49896674/stopping-user-input-after-ctrld-requires-2-presses-why/49896940#49896940", "title": "Stopping user input after Ctrl+D requires 2 presses; why?", "body": "<p>You don't need the <code>getchar</code> separately to check whether EOF has been reached. <code>scanf</code> will itself return an <code>EOF</code> if it encounters the end of data. Your loop will work like so</p>\n\n<pre><code>  do {\n      ret = scanf(\"%d\", &amp;input_array[i]);\n      i++;\n     } while ((i &lt; 5000) &amp;&amp; (ret != EOF));\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 449, "user_id": 9897919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4315a79d0d04da3596dfa08d8d9d8f24?s=128&d=identicon&r=PG&f=1", "display_name": "Aniket", "link": "https://stackoverflow.com/users/9897919/aniket"}, "is_accepted": true, "score": 2, "last_activity_date": 1529134984, "creation_date": 1529134984, "answer_id": 50885972, "question_id": 49896674, "link": "https://stackoverflow.com/questions/49896674/stopping-user-input-after-ctrld-requires-2-presses-why/50885972#50885972", "title": "Stopping user input after Ctrl+D requires 2 presses; why?", "body": "<p>Here's a more simpler solution.</p>\n\n<pre><code>// When the person presses CTRL+D, scanf will return EOF.\n// Since the return value is EOF and not 1, it will break\n// out of the scanning while loop.\n// Also note, you can scan numbers as a while loop\n// condition.\nint input_array[MAX_NUMBERS] = {0};\n\nint i = 0;\nwhile (\n       (scanf(\"%d\", &amp;input_array[0]) == 1) &amp;&amp;\n       (i &lt; MAX_NUMBERS)\n      ) {\n    i++;\n}\n</code></pre>\n"}], "owner": {"reputation": 434, "user_id": 9547778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c69e098ba8f12c4b7879e5b240442055?s=128&d=identicon&r=PG&f=1", "display_name": "Zoey Malkov", "link": "https://stackoverflow.com/users/9547778/zoey-malkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 50885972, "answer_count": 4, "score": 2, "last_activity_date": 1529134984, "creation_date": 1524045377, "last_edit_date": 1524065211, "question_id": 49896674, "link": "https://stackoverflow.com/questions/49896674/stopping-user-input-after-ctrld-requires-2-presses-why", "title": "Stopping user input after Ctrl+D requires 2 presses; why?", "body": "<p>A user can enter various different amounts of numbers (as long as they don't enter over 5000 numbers). However, when the user presses <kbd>CTRL</kbd>+<kbd>D</kbd>, the program should stop requesting user input. I've done this so far. However, I have to press <kbd>CTRL</kbd>+<kbd>D</kbd> twice before it stops. Could someone help me to fix it?</p>\n\n<pre><code>int input_array[MAX_NUMBERS] = {0};\n\nscanf(\"%d\", &amp;input_array[0]);\n\nint eof_detector = getchar();\n\nint i = 0;\nwhile ((i &lt; 5000) &amp;&amp; (eof_detector != EOF)) {\n    i++;\n    scanf(\"%d\", &amp;input_array[i]);\n    eof_detector = getchar();\n}\n</code></pre>\n"}, {"tags": ["c", "linux"], "comments": [{"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524045255, "post_id": 49896578, "comment_id": 86808559, "body": "I understand acquiring a lock on the memory and using <code>munmap</code>/<code>mmap</code> is a potential solution. But I want to avoid doing that if possible."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1524045498, "post_id": 49896578, "comment_id": 86808756, "body": "Perhaps: <a href=\"https://stackoverflow.com/questions/24171602/mmap-resetting-old-memory-to-a-zerod-non-resident-state\" title=\"mmap resetting old memory to a zerod non resident state\">stackoverflow.com/questions/24171602/&hellip;</a>"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1524045665, "post_id": 49896578, "comment_id": 86808878, "body": "also <a href=\"https://stackoverflow.com/questions/18595123/zero-a-large-memory-mapping-with-madvise\" title=\"zero a large memory mapping with madvise\">stackoverflow.com/questions/18595123/&hellip;</a>"}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 3, "creation_date": 1524045741, "post_id": 49896578, "comment_id": 86808922, "body": "Note:the <code>mmap()</code> doesn&#39;t actually <i>clear</i> the memory. It only clones the pages from <code>&#47;dev&#47;zero</code>, with COW set. The cost will come later, once (if!) the pages are referenced."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1524045785, "post_id": 49896578, "comment_id": 86808955, "body": "@AnttiHaapala I am precisely trying to solve the same problem (of writing a custom <code>mmap&#47;munmap</code>). I use similar bookkeeping bits and use <code>MAP_NORESERVE</code> with <code>PROTO_NONE</code> for initial <code>mmap</code> followed by calls to <code>mprotect</code> as I simulate the <code>mmap&#47;munmap</code>. I guess, <code>madvice</code> on <code>munmap</code> should solve the problem. Thanks I will try it out."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524045851, "post_id": 49896578, "comment_id": 86809001, "body": "@wildplasser I agree, but the cost might be removed (even for later) if the os has some zero&#39;d out physical pages. Which is what I think I am observing."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524046061, "post_id": 49896578, "comment_id": 86809150, "body": "Are you talking about page-deduplication? IIRC this is only used in VM-supervisors. (and it can introduce side-channels)"}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524046138, "post_id": 49896578, "comment_id": 86809203, "body": "@wildplasser I am not sure what page-deduplication is, what I meant is that when the write eventually happens, the OS doesn&#39;t really have to write zero on the pages because already zero&#39;d out physical pages might be available."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524046430, "post_id": 49896578, "comment_id": 86809396, "body": "I don&#39;t think the OS can find free physical pages based on their <i>content</i> ."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 1, "creation_date": 1524046597, "post_id": 49896578, "comment_id": 86809505, "body": "@wildplasser that&#39;s not what Ajay suggested - instead, that if it is unmapped, chances are that by the time it needs to be mapped again, the idle process has zeroed some page frames already..."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524046858, "post_id": 49896578, "comment_id": 86809675, "body": "@wildplasser yes, like @AntiHaapala said, the idle process clearing some pages is what I meant. And also in Linux, I think there is a separate linked list of zero free physical pages maintained (again, added to by the idle process). Thus the OS doesn&#39;t have to <i>find</i> physical page with all 0 but just pop one from the list when needed. I think this is what is used to map the <code>.bss</code> section on load too."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524050133, "post_id": 49896578, "comment_id": 86811934, "body": "<i>Use munmap/mmap - I called munmap on the address range then mmap&#39;d the same address again with the same permissions. Since MAP_ANONYMOUS is passed, the pages are cleared.</i>  Those new page mappings might not actually be mapped to real physical pages yet.  You need to add actually accessing at least one byte per page of the mapping to ensure you&#39;re including the time needed to actually recreate physical page mappings if necessary."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1524051768, "post_id": 49896578, "comment_id": 86813097, "body": "@AndrewHenle That&#39;s what I said an hour ago, but the OP doesn&#39;t really seem to understand what COW on a cloned /dev/zero does @ OP: see for instance  <a href=\"https://stackoverflow.com/a/8507066/905902\">stackoverflow.com/a/8507066/905902</a>"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524052134, "post_id": 49896578, "comment_id": 86813333, "body": "@wildplasser I agree - OP seems to think all the work is done when <code>mmap()</code> returns. For all readers:  it&#39;s not done yet. Just because you now have a logical mapping to a page in your process&#39;s address space doesn&#39;t mean that there&#39;s an actual physical page of memory behind that logical mapping.  Those logical-to-physical mappings only get created when they need to be created, and it&#39;s one <i>very</i> expensive process. OP almost certainly failed to benchmark that."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524052644, "post_id": 49896578, "comment_id": 86813669, "body": "@AndrewHenle I am not assuming that the physical mappings are created immediately. I think I understand what COW on /dev/zero does. What I just meant is that the cost of actually zeroing the pages (whenever it is done - when it is actually written to) would be saved by idle-zeroing. Art in his answer seems to suggest that it is not very significant."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524069476, "post_id": 49896578, "comment_id": 86825489, "body": "@AndrewHenle can you see the comment I posted on wildplasser&#39;s answer below. I think that might clear the disagreement we have."}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1524069994, "post_id": 49896578, "comment_id": 86825772, "body": "related: <a href=\"https://stackoverflow.com/q/2688466/995714\">Why malloc+memset is slower than calloc?</a>"}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1524071042, "post_id": 49896578, "comment_id": 86826338, "body": "@AjayBrahmakshatriya The code you posted doesn&#39;t measure just the time difference between <code>memset()</code>, <code>madvise()</code>, and <code>mmap()</code> to clear existing pages.  It counts the time for all the initial <code>mmap()</code> and final <code>munmaps()</code> plus extraneous loops to write <code>&#39;A&#39;</code> or <code>&#39;B&#39;</code> to the entire mapped page.  None of that is applicable to the performance differences between <code>memset()</code>,<code>madvise()</code>, and <code>mmap()</code> to zero out memory.  FWIW, a quick test I ran showed that a simple, single-threaded call to <code>memset()</code> is somewhere between five and ten times faster than redoing <code>mmap()</code>."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524071193, "post_id": 49896578, "comment_id": 86826425, "body": "@AndrewHenle I think counting the time for the loop for writing &#39;B&#39; is essential to the clearing out of memory because of COW like you yourself mentioned."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524071385, "post_id": 49896578, "comment_id": 86826537, "body": "@AndrewHenle coming to your test, how many pages did you use? Because mmap has a fixed system call cost which is pretty high. Maybe mmap might become better for bigger allocation sizes."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524077284, "post_id": 49896578, "comment_id": 86829740, "body": "rewriting the silly loops to <code>memset (buffer, &#39;A&#39;, length);</code> (same for B) reduces the total running time from ~50 to ~30 seconds."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "reply_to_user": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524077442, "post_id": 49896578, "comment_id": 86829830, "body": "@wildplasser yes that is true. But the purpose is to compare memset approach to mmap approach. The rest of the overheads should be the same for both the cases I believe."}], "answers": [{"comments": [{"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524050303, "post_id": 49898229, "comment_id": 86812054, "body": "Yes, I read that madvise is not portable. The portable posix_madvise doesn&#39;t have the behaviour of clearing."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524050388, "post_id": 49898229, "comment_id": 86812107, "body": "And I didn&#39;t know that mmap would throw away the old mapping. That seems like a better solution then. Shouldn&#39;t the second mmap fail though? Because MAP_FIXED is passed and the area is already in use?"}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524050483, "post_id": 49898229, "comment_id": 86812191, "body": "If the behaviour is defined for direct mmap to work. I will just use that. Can I also change the permissions of the page in the second mmap? This way I can do away with the call to mprotect in my allocator."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524050507, "post_id": 49898229, "comment_id": 86812210, "body": "@AjayBrahmakshatriya <code>mmap( ... MAP_FIXED)</code> overwrites whatever was there before, no errors if there are previous mappings."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 2, "creation_date": 1524050640, "post_id": 49898229, "comment_id": 86812298, "body": "@AjayBrahmakshatriya It&#39;s pretty much equivalent to creating a whole new mapping and replacing whatever used to be there. So you can change permissions. But... before you do that read that last paragraph I edited in, I&#39;m not sure if you&#39;re benchmarking the right thing. The fact that your benchmark of munmap/mmap is faster than memset smells wrong to me from what I know about memory management (and I&#39;ve worked a lot on a vm system in a kernel)."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1524050641, "post_id": 49898229, "comment_id": 86812299, "body": "<i>nor the ones I suggested here will actually be faster than just a dumb memset.</i>  Not only that, you can use multiple threads to do parallel <code>memset()</code> calls.  You can&#39;t do parallel <code>mmap()</code> calls because they will have to be serialized since there&#39;s only one process address space."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 3, "creation_date": 1524051982, "post_id": 49898229, "comment_id": 86813236, "body": "On the other hand, the last paper I read about the cost of mapping new pages vs. zeroing/copying had a date that started with &quot;199&quot;. On the third hand if your kernel is patched for Meltdown/Spectre I can&#39;t possibly see how taking a fault for each page could be more efficient than a properly implemented memset. On the fourth hand, you could try using <code>MAP_POPULATE</code> on Linux and that could do the trick. On the fifth hand, relying on idle loop zeroing leads to a system with positive feedback where performance degrades under high load which increases load."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524052293, "post_id": 49898229, "comment_id": 86813441, "body": "I will re-evaluate the benchmark for <code>memset</code> and double <code>mmap</code>. I don&#39;t really want to pre-fault using <code>MAP_POPULATE</code> because my access patterns are such that only a few of the pages would be touched in the beginning. Others might be touched very late. I will keep all the points (only so many hands) you mentioned above and test it thoroughly."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524052332, "post_id": 49898229, "comment_id": 86813474, "body": "Can&#39;t get back to you with all the evaluations right away. Have to finish some other work right now. But thanks for the insight."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524052408, "post_id": 49898229, "comment_id": 86813517, "body": "@AjayBrahmakshatriya I&#39;m actually very curious, so let me know here if you get some results."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524054592, "post_id": 49898229, "comment_id": 86814874, "body": "@Art I ran <a href=\"https://ideone.com/NzSo9H\" rel=\"nofollow noreferrer\">this</a> just to check the time for 1. clearing -&gt; 2. reading 3. Rewriting. And as you suspected, <code>memset</code> was the fastest (2m24s), then <code>mmap</code> (2m31s) and finally <code>madvise</code> (2m35s). This is according to what you predicted."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524054698, "post_id": 49898229, "comment_id": 86814956, "body": "My question is this - Does Linux maintain a list of zero physical pages? Not idle zeroing <b>after</b> mapping, but zero&#39;d out before being mapped anywhere? If it maintains such a pool, I think that would be faster than <code>memset</code> too."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524055156, "post_id": 49898229, "comment_id": 86815262, "body": "The above results are for the code I posted. But for real benchmark <code>memset</code>(45.01s) is slower than <code>mmap</code>ing again(38.35s). I think that is because in case of <code>memset</code> I also need to call <code>mprotect</code>. This benchmark is a test case where I have implemented <code>mmap</code> which is being used by <code>dlmalloc</code> and that is used by <code>gcc</code>. I am not sure how the access patterns are after clearing the pages."}], "tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": false, "score": 2, "last_activity_date": 1524050385, "last_edit_date": 1524050385, "creation_date": 1524049848, "answer_id": 49898229, "question_id": 49896578, "link": "https://stackoverflow.com/questions/49896578/fastest-way-to-zero-pages-in-linux/49898229#49898229", "title": "Fastest way to zero pages in Linux", "body": "<p><code>madvise(..., MADV_DOTNEED)</code> should be equivalent to munmap/mmap on anonymous mappings on Linux. It's a bit weird because that's not how I understand what the semantics of \"don't need\" should be, but it does throw away the page(s) on Linux. </p>\n\n<pre><code>$ cat &gt; foo.c\n#include &lt;sys/types.h&gt;\n#include &lt;sys/mman.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\nint\nmain(int argc, char **argv)\n{\n    int *foo = mmap(NULL, getpagesize(), PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);\n    *foo = 42;\n    printf(\"%d\\n\", *foo);\n    madvise(foo, getpagesize(), MADV_DONTNEED);\n    printf(\"%d\\n\", *foo);\n    return 0;\n}\n$ cc -o foo foo.c &amp;&amp; ./foo\n42\n0\n$ uname -sr\nLinux 3.10.0-693.11.6.el7.x86_64\n</code></pre>\n\n<p><code>MADV_DONTNEED</code> does not do that on other operating systems so this is definitely not portable. For example:</p>\n\n<pre><code>$ cc -o foo foo.c &amp;&amp; ./foo\n42\n42\n$ uname -sr\nDarwin 17.5.0\n</code></pre>\n\n<p>But, you don't need to unmap, you can just overwrite the mapping. As a bonus this is much more portable:</p>\n\n<pre><code>$ cat foo.c\n#include &lt;sys/types.h&gt;\n#include &lt;sys/mman.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\nint\nmain(int argc, char **argv)\n{\n    int *foo = mmap(NULL, getpagesize(), PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);\n    *foo = 42;\n    printf(\"%d\\n\", *foo);\n    mmap(foo, getpagesize(), PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS|MAP_FIXED, -1, 0);\n    printf(\"%d\\n\", *foo);\n    return 0;\n}\n$ cc -o foo foo.c &amp;&amp; ./foo\n42\n0\n$\n</code></pre>\n\n<p>Also, I'm not actually sure if you benchmarked things properly. Creating and dropping mappings can be quite expensive and I don't think idle zeroing would help that much. Newly mmap:ed pages are not actually mapped until they are used for the first time and on Linux this means written and not read because Linux does silly things with copy-on-write zero pages if the first access to a page is a read instead of a write. So unless you benchmark writes to the newly mmap:ed pages I suspect that neither your previous solution, nor the ones I suggested here will actually be faster than just a dumb memset.</p>\n"}, {"comments": [{"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524069394, "post_id": 49904612, "comment_id": 86825446, "body": "I think I understand the matter for confusion blin our disagreement. I want to add that in my benchmarking I am not just including the time to munmap and mmap. But I am measuring time for the entire application. So like you said, the pages may be actually mapped cleared later on write, I agree. I am also counting that time essentially."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524070019, "post_id": 49904612, "comment_id": 86825788, "body": "First show us some code. We don&#39;t know your program , we don&#39;t know the way you measure/benchmark ."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524070205, "post_id": 49904612, "comment_id": 86825884, "body": "<a href=\"https://ideone.com/NzSo9H\" rel=\"nofollow noreferrer\">this</a> is a small test example. My real benchmark is actually a implementation of mmap (mmap requires the zeroing of virtual address returned) which has dlmalloc running on top of it. This dlmalloc implementation is being used by gcc. (gcc from spec_cpu_2006)."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524070340, "post_id": 49904612, "comment_id": 86825968, "body": "The time is measured for the entire program run."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524073945, "post_id": 49904612, "comment_id": 86827910, "body": "Your test program wastes too many cycles on system calls. (bymalling/unmapping  per cycle) I was able to reduce the time spent in system calls from over 5 seconds to below 0.5 seconds"}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524074495, "post_id": 49904612, "comment_id": 86828191, "body": "Oh, that&#39;s great. How does memset vs mmap compare for you? Which one takes more time?"}], "tags": [], "owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "is_accepted": false, "score": 1, "last_activity_date": 1524068699, "creation_date": 1524068699, "answer_id": 49904612, "question_id": 49896578, "link": "https://stackoverflow.com/questions/49896578/fastest-way-to-zero-pages-in-linux/49904612#49904612", "title": "Fastest way to zero pages in Linux", "body": "<p>Note: this is <strong>not</strong> an answer,I just needed the formatting feature.</p>\n\n<hr>\n\n<p>BTW: it is possible that the <code>/dev/zero</code> all-zeros page doesn't even exist, and that the <code>.read()</code> <em>method</em> is implemented as follows (a similar thing happens for <code>dev/null</code>, which just returns the length argument):</p>\n\n<hr>\n\n<pre><code>struct file_operations {\n        ...\n        ssize_t (*read) (struct file *, char __user *, size_t, loff_t *);\n        ...\n        };\n\nstatic ssize_t zero_read (struct file *not_needed_here, char __user * buff, size_t len, loff_t * ignored)\n{\nmemset (buff, 0, len);\nreturn len;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524112396, "post_id": 49909183, "comment_id": 86841167, "body": "First of all, thanks a lot for the detailed analysis and for specifically profiling each step in the program. I think the time for the actual <code>mmap</code> call can be ignored because in my case like I said I have around 200 continuous pages. So there will be a single <code>mmap</code> call. But yes there is a significant cost to set a 0 in the page. This I think is because of the page faults (which won&#39;t be there in memset)."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524112507, "post_id": 49909183, "comment_id": 86841201, "body": "I should have probably mentioned in the question that I have to do <code>mprotect</code> before the <code>memset</code> (because I am implementing a allocator). I think in that case the cost of just a single <code>mmap</code> would be less than <code>mprotect</code> + <code>memset</code>. Notice that the cost of <code>memset</code> would be high if it is after a <code>mprotect</code> (because it might also have a page fault because of lazy allocation)."}, {"owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 0, "creation_date": 1524112573, "post_id": 49909183, "comment_id": 86841216, "body": "Anyway, this clears most of my doubts, in general case <code>memset</code> is faster than <code>mmap</code>. But for my specific case since I also have to change permissions (from <code>PROT_NONE</code> to <code>PROT_READ | PROT_WRITE</code>), I think a single call to <code>mmap</code> should work better."}, {"owner": {"reputation": 3854, "user_id": 2235885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d0d6a08639ef79ef960a52bd013e02?s=128&d=identicon&r=PG", "display_name": "joop", "link": "https://stackoverflow.com/users/2235885/joop"}, "reply_to_user": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "edited": false, "score": 2, "creation_date": 1524128920, "post_id": 49909183, "comment_id": 86849378, "body": "@AjayBrahmakshatriya <code>the time for the actual mmap call can be ignored ...</code> You are wrong. You are torturing the memory subsystem by allocating/deallocating 200 pages on every loop. This will cause a lot of work <i>for the kernel</i> to update the page tables, the free lists and the lru-cache. Plus: the kernel will need to aquire locks on these resource-lists, which could affect other processes, too."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1524131874, "post_id": 49909183, "comment_id": 86851680, "body": "<i>Anyway, this clears most of my doubts, in general case memset is faster than mmap. But for my specific case since I also have to change permissions (from <code>PROT_NONE</code> to <code>PROT_READ | PROT_WRITE</code>), I think a single call to <code>mmap</code> should work better.</i>  <b>Why</b> would you even begin to think flipping a few bits in a page table entry is slower than completely tearing down and redoing an entire page mapping?  Did you even bother benchmarking and testing that assumption?"}], "tags": [], "owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "is_accepted": false, "score": 5, "last_activity_date": 1524131580, "last_edit_date": 1524131580, "creation_date": 1524086434, "answer_id": 49909183, "question_id": 49896578, "link": "https://stackoverflow.com/questions/49896578/fastest-way-to-zero-pages-in-linux/49909183#49909183", "title": "Fastest way to zero pages in Linux", "body": "<p><code>memset()</code> appears to be about an order of magnitude faster than <code>mmap()</code> to get a new zero-filled page, at least on the Solaris 11 server I have access to right now.  I strongly suspect that Linux will produce similar results.</p>\n\n<p>I wrote a small benchmark program:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;sys/mman.h&gt;\n#include &lt;string.h&gt;\n#include &lt;strings.h&gt;\n\n#include &lt;sys/time.h&gt;\n\n#define NUM_BLOCKS ( 512 * 1024 )\n#define BLOCKSIZE ( 4 * 1024 )\n\nint main( int argc, char **argv )\n{\n    int ii;\n\n    char *blocks[ NUM_BLOCKS ];\n\n    hrtime_t start = gethrtime();\n\n    for ( ii = 0; ii &lt; NUM_BLOCKS; ii++ )\n    {\n        blocks[ ii ] = mmap( NULL, BLOCKSIZE,\n            PROT_READ | PROT_WRITE,\n            MAP_ANONYMOUS | MAP_PRIVATE, -1, 0 );\n        // force the creation of the mapping\n        blocks[ ii ][ ii % BLOCKSIZE ] = ii;\n    }\n\n    printf( \"setup time:    %lf sec\\n\",\n        ( gethrtime() - start ) / 1000000000.0 );\n\n    for ( int jj = 0; jj &lt; 4; jj++ )\n    {\n        start = gethrtime();\n\n        for ( ii = 0; ii &lt; NUM_BLOCKS; ii++ )\n        {\n            blocks[ ii ] = mmap( blocks[ ii ],\n                BLOCKSIZE, PROT_READ | PROT_WRITE,\n                MAP_FIXED | MAP_ANONYMOUS | MAP_PRIVATE, -1, 0 );\n            blocks[ ii ][ ii % BLOCKSIZE ] = 0;\n        }\n\n        printf( \"mmap() time:   %lf sec\\n\",\n            ( gethrtime() - start ) / 1000000000.0 );\n        start = gethrtime();\n\n        for ( ii = 0; ii &lt; NUM_BLOCKS; ii++ )\n        {\n            memset( blocks[ ii ], 0, BLOCKSIZE );\n        }\n\n        printf( \"memset() time: %lf sec\\n\",\n            ( gethrtime() - start ) / 1000000000.0 );\n    }\n\n    return( 0 );\n}\n</code></pre>\n\n<p>Note that writing a single byte anywhere in the page is all that's needed to force the creation of the physical page.</p>\n\n<p>I ran it on my Solaris 11 file server (the only POSIX-style system I have running on bare metal right now).  I didn't test <code>madvise()</code> on my Solaris system because Solaris, unlike Linux, doesn't guarantee that the mapping will be repopulated with zero-filled pages, only that \"the system starts to free the resources\".</p>\n\n<p>The results:</p>\n\n<pre><code>setup time:    11.144852 sec\nmmap() time:   15.159650 sec\nmemset() time: 1.817739 sec\nmmap() time:   15.029283 sec\nmemset() time: 1.788925 sec\nmmap() time:   15.083473 sec\nmemset() time: 1.780283 sec\nmmap() time:   15.201085 sec\nmemset() time: 1.771827 sec\n</code></pre>\n\n<p><code>memset()</code> is almost an order of magnitude faster.  When I get a chance, I'll rerun that benchmark on Linux, but it'll likely have to be on a VM (AWS etc.)</p>\n\n<p>That's <em>not</em> surprising - <code>mmap()</code> is expensive, and the kernel still needs to zero the pages at some time.</p>\n\n<p>Interestingly, commenting out one line </p>\n\n<pre><code>        for ( ii = 0; ii &lt; NUM_BLOCKS; ii++ )\n        {\n            blocks[ ii ] = mmap( blocks[ ii ],\n                BLOCKSIZE, PROT_READ | PROT_WRITE,\n                MAP_FIXED | MAP_ANONYMOUS | MAP_PRIVATE, -1, 0 );\n            //blocks[ ii ][ ii % BLOCKSIZE ] = 0;\n        }\n</code></pre>\n\n<p>produces these results:</p>\n\n<pre><code>setup time:    10.962788 sec\nmmap() time:   7.524939 sec\nmemset() time: 10.418480 sec\nmmap() time:   7.512086 sec\nmemset() time: 10.406675 sec\nmmap() time:   7.457512 sec\nmemset() time: 10.296231 sec\nmmap() time:   7.420942 sec\nmemset() time: 10.414861 sec\n</code></pre>\n\n<p>The burden of forcing the creation of the physical mapping has shifted to the <code>memset()</code> call, leaving only the implicit <code>munmap()</code> in the test loops, where the mappings are destroyed when the <code>MAP_FIXED</code> <code>mmap()</code> call replaces them.  Note that the just the <code>munmap()</code> takes about 3-4 times longer than keeping the pages in the address space and <code>memset()</code>'ing them to zeros.</p>\n\n<p>The cost of <code>mmap()</code> isn't really the <code>mmap()</code>/<code>munmap()</code> system call itself, it's that the new page requires a lot of behind-the-scenes CPU cycles to create the actual physical mapping, and that doesn't happen in the <code>mmap()</code> system call itself - it happens <em>afterwards</em>, when the process accesses the memory page.</p>\n\n<p>If you doubt the results, note <a href=\"https://marc.info/?l=linux-kernel&amp;m=95496636207616&amp;w=2\" rel=\"nofollow noreferrer\">this LMKL post from Linus Torvalds himself</a>:</p>\n\n<blockquote>\n  <p>...</p>\n  \n  <p>HOWEVER, playing games with the virtual memory mapping is very\n  expensive in itself.  It has a number of quite real disadvantages that\n  people tend to ignore because memory copying is seen as something very\n  slow, and sometimes optimizing that copy away is seen as an obvious\n  improvment. </p>\n  \n  <p>Downsides to mmap:</p>\n  \n  <ul>\n  <li>quite noticeable setup and teardown costs. And I mean <em>noticeable</em>. It's things like following the page tables to unmap everything cleanly. It's the book-keeping for maintaining a list of all the mappings. It's The TLB flush needed after unmapping stuff.</li>\n  <li>...</li>\n  </ul>\n</blockquote>\n\n<p>Profiling the code using <a href=\"https://docs.oracle.com/cd/E37069_01/html/E54439/collect-1.html\" rel=\"nofollow noreferrer\">Solaris Studio's collect</a> and <a href=\"https://docs.oracle.com/cd/E37069_01/html/E54439/analyzer-1.html#scrolltoc\" rel=\"nofollow noreferrer\">analyzer tools</a> produced the following output:</p>\n\n<pre><code>Source File: mm.c\n\nInclusive        Inclusive        Inclusive         \nTotal CPU Time   Sync Wait Time   Sync Wait Count   Name\nsec.             sec.                               \n                                                      1. #include &lt;stdio.h&gt;\n                                                      2. #include &lt;sys/mman.h&gt;\n                                                      3. #include &lt;string.h&gt;\n                                                      4. #include &lt;strings.h&gt;\n                                                      5. \n                                                      6. #include &lt;sys/time.h&gt;\n                                                      7. \n                                                      8. #define NUM_BLOCKS ( 512 * 1024 )\n                                                      9. #define BLOCKSIZE ( 4 * 1024 )\n                                                     10. \n                                                     11. int main( int argc, char **argv )\n                                                         &lt;Function: main&gt;\n 0.011           0.               0                  12. {\n                                                     13.     int ii;\n                                                     14. \n                                                     15.     char *blocks[ NUM_BLOCKS ];\n                                                     16. \n 0.              0.               0                  17.     hrtime_t start = gethrtime();\n                                                     18. \n 0.129           0.               0                  19.     for ( ii = 0; ii &lt; NUM_BLOCKS; ii++ )\n                                                     20.     {\n                                                     21.         blocks[ ii ] = mmap( NULL, BLOCKSIZE,\n                                                     22.             PROT_READ | PROT_WRITE,\n 3.874           0.               0                  23.             MAP_ANONYMOUS | MAP_PRIVATE, -1, 0 );\n                                                     24.         // force the creation of the mapping\n 7.928           0.               0                  25.         blocks[ ii ][ ii % BLOCKSIZE ] = ii;\n                                                     26.     }\n                                                     27. \n                                                     28.     printf( \"setup time:    %lf sec\\n\",\n 0.              0.               0                  29.         ( gethrtime() - start ) / 1000000000.0 );\n                                                     30. \n 0.              0.               0                  31.     for ( int jj = 0; jj &lt; 4; jj++ )\n                                                     32.     {\n 0.              0.               0                  33.         start = gethrtime();\n                                                     34. \n 0.560           0.               0                  35.         for ( ii = 0; ii &lt; NUM_BLOCKS; ii++ )\n                                                     36.         {\n                                                     37.             blocks[ ii ] = mmap( blocks[ ii ],\n                                                     38.                 BLOCKSIZE, PROT_READ | PROT_WRITE,\n33.432           0.               0                  39.                 MAP_FIXED | MAP_ANONYMOUS | MAP_PRIVATE, -1, 0 );\n29.535           0.               0                  40.             blocks[ ii ][ ii % BLOCKSIZE ] = 0;\n                                                     41.         }\n                                                     42. \n                                                     43.         printf( \"mmap() time:   %lf sec\\n\",\n 0.              0.               0                  44.             ( gethrtime() - start ) / 1000000000.0 );\n 0.              0.               0                  45.         start = gethrtime();\n                                                     46. \n 0.101           0.               0                  47.         for ( ii = 0; ii &lt; NUM_BLOCKS; ii++ )\n                                                     48.         {\n 7.362           0.               0                  49.             memset( blocks[ ii ], 0, BLOCKSIZE );\n                                                     50.         }\n                                                     51. \n                                                     52.         printf( \"memset() time: %lf sec\\n\",\n 0.              0.               0                  53.             ( gethrtime() - start ) / 1000000000.0 );\n                                                     54.     }\n                                                     55. \n 0.              0.               0                  56.     return( 0 );\n 0.              0.               0                  57. }\n\n                                                    Compile flags:  /opt/SUNWspro/bin/cc -g -m64  mm.c -W0,-xp.XAAjaAFbs71a00k.\n</code></pre>\n\n<p>Note the large amount of time spent in <code>mmap()</code>, and also in the setting of a single byte in each newly-mapped page.</p>\n\n<p>This is an overview from the <code>analyzer</code> tool.  Note the large amount of system time:</p>\n\n<p><a href=\"https://i.stack.imgur.com/ivzTz.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ivzTz.jpg\" alt=\"Profile overview\"></a></p>\n\n<p>The large amount of system time consumed is the time taken to map and unmap the physical pages.</p>\n\n<p>This timeline shows <em>when</em> all that time was consumed:</p>\n\n<p><a href=\"https://i.stack.imgur.com/A1xHj.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/A1xHj.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>The light green is system time - that's all in the <code>mmap()</code> loops.  You can see that switch over to dark-green user time when the <code>memset()</code> loops run.  I've highlighted one of those instances so you can see what's going on at that time.</p>\n\n<p><strong>Updated results from a Linux VM:</strong></p>\n\n<pre><code>setup time:    2.567396 sec\nmmap() time:   2.971756 sec\nmemset() time: 0.654947 sec\nmmap() time:   3.149629 sec\nmemset() time: 0.658858 sec\nmmap() time:   2.800389 sec\nmemset() time: 0.647367 sec\nmmap() time:   2.915774 sec\nmemset() time: 0.646539 sec\n</code></pre>\n\n<p>This tracks exactly with what I stated in my comment yesterday:  <em>FWIW, a quick test I ran showed that a simple, single-threaded call to <code>memset()</code> is somewhere between five and ten times faster than redoing <code>mmap()</code></em></p>\n\n<p>I simply do not understand this fascination with <code>mmap()</code>.  <code>mmap()</code> is one <em>hugely</em> expensive call, and it's a forced single-threaded operation - there's only one set of physical memory on the machine.  <code>mmap()</code> is not only <strong>S-L-O-W</strong>, it impacts both the entire process address space and the VM system on the entire host.</p>\n\n<p>Using any form of <code>mmap()</code> just to zero out memory pages is counterproductive.  First, the pages don't get zeroed for free - something has to <code>memset()</code> them to clear them.  It just doesn't make any sense to add tearing down and recreating a memory mapping to that <code>memset()</code> just to clear a page of RAM.</p>\n\n<p><code>memset()</code> also has the advantage that <em>more than one thread can be clearing memory at any one time</em>.  Making changes to memory mappings is a single-threaded process.</p>\n"}], "owner": {"reputation": 8204, "user_id": 2858773, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5iGps.jpg?s=128&g=1", "display_name": "Ajay Brahmakshatriya", "link": "https://stackoverflow.com/users/2858773/ajay-brahmakshatriya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1648, "favorite_count": 2, "answer_count": 3, "score": 6, "last_activity_date": 1524131580, "creation_date": 1524045116, "question_id": 49896578, "link": "https://stackoverflow.com/questions/49896578/fastest-way-to-zero-pages-in-linux", "title": "Fastest way to zero pages in Linux", "body": "<p>I need to clear large address ranges (order of 200 pages at a time) in Linux. There are two approaches I tried -</p>\n\n<ol>\n<li><p>Use <code>memset</code> - The simplest way to clear the address range. Performed a bit slower than method 2. </p></li>\n<li><p>Use <code>munmap</code>/<code>mmap</code> - I called <code>munmap</code> on the address range then <code>mmap</code>'d the same address again with the same permissions. Since <code>MAP_ANONYMOUS</code> is passed, the pages are cleared. </p></li>\n</ol>\n\n<p>The second method makes a benchmark run 5-10% faster. The benchmark ofcourse does a lot more than just clearing the pages. \nIf I understand correctly, this is because the operating system has a pool of zero'd pages which it maps to the address range. </p>\n\n<p>But I don't like this way because the <code>munmap</code> and <code>mmap</code> is not atomic. In the sense that another <code>mmap</code> (with NULL as first argument) done simultaneously could render my address range un-usable. </p>\n\n<p>So my question is does Linux provide a system call that can swap out the physical pages for an address range with zero-pages?</p>\n\n<p>I tried to look at the source of glibc (specifically <code>memset</code>) to see if they use any technique to do this efficiently. But I couldn't find anything. </p>\n"}, {"tags": ["c++", "c", "visual-studio", "compiler-errors", "extern"], "comments": [{"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524145811, "post_id": 49896474, "comment_id": 86861193, "body": "please list the steps you took which you refereed to as: <code>extract and so on...</code>"}, {"owner": {"reputation": 469, "user_id": 4824854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SPhK8fI7Ih8/AAAAAAAAAAI/AAAAAAAACnc/0BBhoF9bSXg/photo.jpg?sz=128", "display_name": "Sandburg", "link": "https://stackoverflow.com/users/4824854/sandburg"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524148150, "post_id": 49896474, "comment_id": 86863022, "body": "I have added a shortend dump of my tree after uncompressing sources side by side. I have used 7zip to do so, but I guess it is equivalent to classical <code>tar -xvf ...</code>"}, {"owner": {"reputation": 469, "user_id": 4824854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SPhK8fI7Ih8/AAAAAAAAAAI/AAAAAAAACnc/0BBhoF9bSXg/photo.jpg?sz=128", "display_name": "Sandburg", "link": "https://stackoverflow.com/users/4824854/sandburg"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524167839, "post_id": 49896474, "comment_id": 86874427, "body": "The solution seems to compile freetype normaly (no change at all, take it as it is) but modify harfbuzz&#39;s CMakeFiles.txt (or CMakeCache already built) to activate the link freetype &lt;- harfbuzz (but not in the other direction)."}, {"owner": {"reputation": 469, "user_id": 4824854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SPhK8fI7Ih8/AAAAAAAAAAI/AAAAAAAACnc/0BBhoF9bSXg/photo.jpg?sz=128", "display_name": "Sandburg", "link": "https://stackoverflow.com/users/4824854/sandburg"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 1, "creation_date": 1524648179, "post_id": 49896474, "comment_id": 87053127, "body": "I am able to obtain what I want : compile freetype from sln or from cmake. And activate in harfbuzz freetype usage (line <code>option(HB_HAVE_FREETYPE &quot;Enable freetype interop helpers&quot; ON)</code> ). But I also use a hack, adding in harfbuzz <code>FREETYPE_INCLUDE_DIR_freetype2</code>, <code>FREETYPE_INCLUDE_DIR_ft2build</code>, <code>FREETYPE_LIBRARY_DEBUG</code> and <code>FREETYPE_LIBRARY_RELEASE</code>  Normaly, I should not do that... how can I configure freetype and/or harfbuzz to use this &quot;LIBRARY&quot; stuff normaly ? Cmake is so confusing in its notions."}, {"owner": {"reputation": 49960, "user_id": 32453, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/bec38d63650c8912b6ba9b557fb953b9?s=128&d=identicon&r=PG", "display_name": "rogerdpack", "link": "https://stackoverflow.com/users/32453/rogerdpack"}, "edited": false, "score": 1, "creation_date": 1548831791, "post_id": 49896474, "comment_id": 95679219, "body": "cyclical! <a href=\"https://gist.github.com/roxlu/0108d45308a0434e27d4320396399153\" rel=\"nofollow noreferrer\">gist.github.com/roxlu/0108d45308a0434e27d4320396399153</a>"}], "answers": [{"comments": [{"owner": {"reputation": 469, "user_id": 4824854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SPhK8fI7Ih8/AAAAAAAAAAI/AAAAAAAACnc/0BBhoF9bSXg/photo.jpg?sz=128", "display_name": "Sandburg", "link": "https://stackoverflow.com/users/4824854/sandburg"}, "edited": false, "score": 0, "creation_date": 1524648548, "post_id": 49948284, "comment_id": 87053346, "body": "Thank you, I am reading about <code>vcpkg</code>... looks great, but it is another Microsoft only technology. I use to dream harfbuzz and freetype (open libs), very related projects have provided some tech to compile as I want... Sadly, it is not well documented. vcpkg will be my next option for now. I always try to be FULL plateform supportive in my first approch."}, {"owner": {"reputation": 469, "user_id": 4824854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SPhK8fI7Ih8/AAAAAAAAAAI/AAAAAAAACnc/0BBhoF9bSXg/photo.jpg?sz=128", "display_name": "Sandburg", "link": "https://stackoverflow.com/users/4824854/sandburg"}, "edited": false, "score": 0, "creation_date": 1524649101, "post_id": 49948284, "comment_id": 87053730, "body": "My dependency is from HarfBuzz to FreeType, not in the other way. (Harfbuzz loads objects prepared by Freetype.) I have forsake my first approch to have a cyclic dependency (which looks also possible and needed for some projects)."}, {"owner": {"reputation": 8032, "user_id": 1414809, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/63e622128f1f2b74858a10c1a60707fb?s=128&d=identicon&r=PG", "display_name": "Ebrahim Byagowi", "link": "https://stackoverflow.com/users/1414809/ebrahim-byagowi"}, "reply_to_user": {"reputation": 469, "user_id": 4824854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SPhK8fI7Ih8/AAAAAAAAAAI/AAAAAAAACnc/0BBhoF9bSXg/photo.jpg?sz=128", "display_name": "Sandburg", "link": "https://stackoverflow.com/users/4824854/sandburg"}, "edited": false, "score": 0, "creation_date": 1524771732, "post_id": 49948284, "comment_id": 87117765, "body": "Yes, as I said. Even Chrome don&#39;t have FreeType to HarfBuzz dependency, <a href=\"https://bugs.chromium.org/p/chromium/issues/detail?id=694137\" rel=\"nofollow noreferrer\">bugs.chromium.org/p/chromium/issues/detail?id=694137</a> so as just said use vcpkg :) But if you don&#39;t like to use vcpkg, use cmake project file of both projects, this is outdated but used to work <a href=\"https://github.com/ebraminio/glcourse/blob/master/CMakeLists.txt\" rel=\"nofollow noreferrer\">github.com/ebraminio/glcourse/blob/master/CMakeLists.txt</a>"}, {"owner": {"reputation": 639, "user_id": 2024042, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1edc065434a67b2917629cd070cb1ecb?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Yin", "link": "https://stackoverflow.com/users/2024042/kevin-yin"}, "edited": false, "score": 0, "creation_date": 1610872603, "post_id": 49948284, "comment_id": 116265005, "body": "This is not viable. Freetype requires extensive configuration in ftoption.h when built."}], "tags": [], "owner": {"reputation": 8032, "user_id": 1414809, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/63e622128f1f2b74858a10c1a60707fb?s=128&d=identicon&r=PG", "display_name": "Ebrahim Byagowi", "link": "https://stackoverflow.com/users/1414809/ebrahim-byagowi"}, "is_accepted": false, "score": 2, "last_activity_date": 1524251476, "creation_date": 1524251476, "answer_id": 49948284, "question_id": 49896474, "link": "https://stackoverflow.com/questions/49896474/how-to-compile-freetype-2-and-harfbuzz-with-visual-studio-to-make-them-work/49948284#49948284", "title": "How to compile Freetype (2) and Harfbuzz (with visual studio) to make them work together?", "body": "<p>Just use <a href=\"https://github.com/Microsoft/vcpkg/\" rel=\"nofollow noreferrer\">https://github.com/Microsoft/vcpkg/</a> to install both and don't look back :) Both HarfBuzz and Freetype have a port there and are well supported.</p>\n\n<p>About the cyclic dependency, FreeType to HarfBuzz dependency is not a must think to have. <code>vcpkg</code> handles HarfBuzz to FreeType dependency and that is what most project will need.</p>\n"}, {"tags": [], "owner": {"reputation": 49960, "user_id": 32453, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/bec38d63650c8912b6ba9b557fb953b9?s=128&d=identicon&r=PG", "display_name": "rogerdpack", "link": "https://stackoverflow.com/users/32453/rogerdpack"}, "is_accepted": false, "score": 2, "last_activity_date": 1548831907, "creation_date": 1548831907, "answer_id": 54434988, "question_id": 49896474, "link": "https://stackoverflow.com/questions/49896474/how-to-compile-freetype-2-and-harfbuzz-with-visual-studio-to-make-them-work/54434988#54434988", "title": "How to compile Freetype (2) and Harfbuzz (with visual studio) to make them work together?", "body": "<p>Or configure harfbuzz like <code>--with-freetype=no --with-fontconfig=no</code> to avoid circular deps...I think so anyway...</p>\n"}], "owner": {"reputation": 469, "user_id": 4824854, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SPhK8fI7Ih8/AAAAAAAAAAI/AAAAAAAACnc/0BBhoF9bSXg/photo.jpg?sz=128", "display_name": "Sandburg", "link": "https://stackoverflow.com/users/4824854/sandburg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2261, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1573811338, "creation_date": 1524044835, "last_edit_date": 1573811338, "question_id": 49896474, "link": "https://stackoverflow.com/questions/49896474/how-to-compile-freetype-2-and-harfbuzz-with-visual-studio-to-make-them-work", "title": "How to compile Freetype (2) and Harfbuzz (with visual studio) to make them work together?", "body": "<p>I have found good documentations on this known problem of compiling Freetype related to Harfbuzz: <a href=\"http://www.gregwessels.com/dev/2017/05/02/freetype-harfbuzz.html\" rel=\"nofollow noreferrer\">http://www.gregwessels.com/dev/2017/05/02/freetype-harfbuzz.html</a> and here <a href=\"https://stackoverflow.com/questions/44184890/compiling-freetype/49782391#49782391\">44184890</a></p>\n\n<p>But they seem obsolet nowadays: freetype-2.9 with harfbuzz-1.7.6</p>\n\n<p>Here is my way compiling:</p>\n\n<ul>\n<li>download <a href=\"https://download.savannah.gnu.org/releases/freetype/freetype-2.9.tar.bz2\" rel=\"nofollow noreferrer\">Freetype tarball</a></li>\n<li>extract the tarball...</li>\n<li>open builds\\windows\\vc2010\\freetype.sln</li>\n<li>it should already Generate well (as a dll)</li>\n<li>download <a href=\"https://www.freedesktop.org/software/harfbuzz/release/harfbuzz-1.7.6.tar.bz2\" rel=\"nofollow noreferrer\">Harfbuzz</a></li>\n<li>extract the tarball next to freetype...</li>\n<li>run <code>cmake ./</code> at root level to obtain a <code>.sln</code></li>\n<li>it must already Generate well (as lib)</li>\n</ul>\n\n<p>At this point you have 2 separate libs not working together which means:</p>\n\n<p><strong>Freetype will not open GSUB scripts of your fonts.</strong> (or maybe I am wrong)</p>\n\n<p>To do so, I need help! I also need confirmations!!!</p>\n\n<p>Is seems to be needed to enable the use of Harfbuzz in Freetype at compile time; I  have found a precompiler directive called <code>FT_CONFIG_OPTION_USE_HARFBUZZ</code></p>\n\n<p>But when activating it, I have some compile link errors when using both libs in a third project:</p>\n\n<pre><code>autofit.obj : error LNK2019: external symbol not found _hb_ft_font_create referenced in function _af_face_globals_new\n</code></pre>\n\n<p>Good to know, <code>hb_ft_font_create</code> is an extern function in harfbuzz.</p>\n\n<p>So it seems to be a cyclic extern problem... I certainly don't have the good config at a point, but I have browsed many docs and helps, found nothing...</p>\n\n<p>-- edit --\nAfter both pojects decompression, you have normaly to obtain such a tree:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 freetype-2.9\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 autogen.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 builds\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ...\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 windows\n\u2502   \u2502       \u2514\u2500\u2500 vc2010    &lt;&lt;&lt;&lt; The .sln to use is in here\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 CMakeLists.txt    &lt;&lt;&lt;&lt; It is also good to obtain proper sln\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 configure\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 devel\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 ft2build.h\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ftoption.h\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 include\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 freetype\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ft2build.h\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ...\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 objs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 freetype.dll\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 freetype.lib\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 README\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 Win32\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 README\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 README.git\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2514\u2500\u2500 harfbuzz-1.7.6\n \u00a0\u00a0 \u251c\u2500\u2500 ...\n \u00a0\u00a0 \u251c\u2500\u2500 cmake_install.cmake\n \u00a0\u00a0 \u251c\u2500\u2500 CMakeLists.txt   &lt;&lt;&lt;&lt; The cmake project to obtain proper sln is this one\n \u00a0\u00a0 \u251c\u2500\u2500 compile\n \u00a0\u00a0 \u251c\u2500\u2500 ...\n \u00a0\u00a0 \u251c\u2500\u2500 COPYING\n \u00a0\u00a0 \u251c\u2500\u2500 CTestTestfile.cmake\n \u00a0\u00a0 \u251c\u2500\u2500 Debug\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 harfbuzz.lib\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 harfbuzz-subset.lib\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ...\n \u00a0\u00a0 \u251c\u2500\u2500 depcomp\n \u00a0\u00a0 \u251c\u2500\u2500 docs\n \u00a0\u00a0 \u251c\u2500\u2500 gtk-doc.make\n \u00a0\u00a0 \u251c\u2500\u2500 harfbuzz.sln\n \u00a0\u00a0 \u251c\u2500\u2500 harfbuzz.vcxproj\n \u00a0\u00a0 \u251c\u2500\u2500 ...\n \u00a0\u00a0 \u251c\u2500\u2500 main.dir\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 Debug\n \u00a0\u00a0 \u251c\u2500\u2500 NEWS\n \u00a0\u00a0 \u251c\u2500\u2500 README\n \u00a0\u00a0 \u251c\u2500\u2500 README.python\n \u00a0\u00a0 \u251c\u2500\u2500 RELEASING.md\n \u00a0\u00a0 \u251c\u2500\u2500 replace-enum-strings.cmake\n \u00a0\u00a0 \u251c\u2500\u2500 RUN_TESTS.vcxproj\n \u00a0\u00a0 \u251c\u2500\u2500 RUN_TESTS.vcxproj.filters\n \u00a0\u00a0 \u251c\u2500\u2500 src\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 *.hh\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 *.cc\n \u00a0\u00a0 \u251c\u2500\u2500 test\n \u00a0\u00a0 \u251c\u2500\u2500 THANKS\n \u00a0\u00a0 \u251c\u2500\u2500 TODO\n \u00a0\u00a0 \u251c\u2500\u2500 util\n \u00a0\u00a0 \u2514\u2500\u2500 Win32\n \u00a0\u00a0  \u00a0\u00a0 \u2514\u2500\u2500 Debug\n</code></pre>\n"}, {"tags": ["c", "stdin", "eof", "standard-library"], "answers": [{"tags": [], "owner": {"reputation": 2357, "user_id": 4074081, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/emDh4.png?s=128&g=1", "display_name": "dewaffled", "link": "https://stackoverflow.com/users/4074081/dewaffled"}, "is_accepted": true, "score": 2, "last_activity_date": 1524078508, "creation_date": 1524078508, "answer_id": 49907292, "question_id": 49896165, "link": "https://stackoverflow.com/questions/49896165/stdin-allows-to-read-with-the-eof-flag-set/49907292#49907292", "title": "stdin allows to read with the EOF flag set", "body": "<p>On Linux this is indeed a known <code>glibc</code> bug in stdio implementation: <a href=\"https://sourceware.org/bugzilla/show_bug.cgi?id=1190\" rel=\"nofollow noreferrer\">#1190 - from 2005</a>, <a href=\"https://sourceware.org/bugzilla/show_bug.cgi?id=19476\" rel=\"nofollow noreferrer\">#19476 - duplicate from 2016</a> which got fixed only in recent 2.28 build.</p>\n"}], "owner": {"reputation": 2703, "user_id": 1202636, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1f7c2a72eb456f76d736235e3f860803?s=128&d=identicon&r=PG", "display_name": "effeffe", "link": "https://stackoverflow.com/users/1202636/effeffe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "accepted_answer_id": 49907292, "answer_count": 1, "score": 1, "last_activity_date": 1524078508, "creation_date": 1524044000, "last_edit_date": 1524074981, "question_id": 49896165, "link": "https://stackoverflow.com/questions/49896165/stdin-allows-to-read-with-the-eof-flag-set", "title": "stdin allows to read with the EOF flag set", "body": "<p>On my platform, the following code allows me to successfully read from <code>stdin</code> even if its end-of-file flag is set, which also remains set after the read. To reproduce the behavior, first type the end-of-file shortcut (<kbd>Ctrl</kbd>+<kbd>D</kbd> on Unix, <kbd>Ctrl</kbd>+<kbd>Z</kbd> on Windows) and then type a normal character.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n\n// first type the shortcut for EOF, then a single character\n\nint main(void) {\n    getchar();\n    printf(\"feof(stdin): %s\\n\", feof(stdin) ? \"true\" : \"false\");\n    int ch = getchar();\n    if (ch == EOF) return 0;\n    printf(\"%c\\n\", (char) ch);\n    printf(\"feof(stdin): %s\\n\", feof(stdin) ? \"true\" : \"false\");\n}\n</code></pre>\n\n<p>The output I get (after typing the letter <code>f</code>):</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>feof(stdin): true\nf\nfeof(stdin): true\n</code></pre>\n\n<p>From C11 standard (7.21.7.1, <em>The <code>fgetc</code> function</em>, 3):</p>\n\n<blockquote>\n  <p><strong>Returns</strong></p>\n  \n  <p>If the end-of-file indicator for the stream is set, or if the stream is at end-of-file, the end-of-file indicator for the stream is set and the <code>fgetc</code> function returns <code>EOF</code></p>\n</blockquote>\n\n<p><code>getchar()</code> is equivalent to <code>getc(stdin)</code> (7.21.7.6), which in turn is a macro for <code>fgetc(stdin)</code> (7.21.7.5). So <code>getchar()</code> should behave exactly like <code>fgetc(stdin)</code>.</p>\n\n<p>It seems to me that this is is not standard compliant. Am I missing something?</p>\n\n<hr>\n\n<p>This question previously referred to C++ (thus the long discussion in comments), but the problem can be narrowed to the C standard library, thus I edited. Still the following information may be relevant:</p>\n\n<p>The behavior is not consistent among platforms:</p>\n\n<ul>\n<li>Arch Linux, GCC 7.3.1: <em>can</em> read after EOF;</li>\n<li>Windows 7, GCC (Rev1, Built by MSYS2 project) 7.2.0: <em>can</em> read after EOF;</li>\n<li>MacOS High Sierra, Apple LLVM version 9.0.0 (clang-900.0.39.2): <em>cannot</em> read after EOF;</li>\n<li>FreeBSD 10.3, both clang 3.4.1 and GCC 5.4.0: <em>cannot</em> read after EOF.</li>\n</ul>\n\n<p>This question is a follow-up of <a href=\"https://stackoverflow.com/q/49880746/1202636\">this one</a>, which is about the fact the <code>cin.clear()</code> does not seem to unset the end-of-file flag of <code>stdin</code>, after some useful comments and chat discussion.</p>\n"}, {"tags": ["c", "binary", "posix"], "comments": [{"owner": {"reputation": 2244, "user_id": 5520680, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C1jQH.png?s=128&g=1", "display_name": "Tom&#39;s", "link": "https://stackoverflow.com/users/5520680/toms"}, "edited": false, "score": 1, "creation_date": 1524044041, "post_id": 49896132, "comment_id": 86807593, "body": "what&#39;s sizeof(struct a) ?"}, {"owner": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "edited": false, "score": 0, "creation_date": 1524044078, "post_id": 49896132, "comment_id": 86807622, "body": "That&#39;s because struct fields are aligned on their natural size boundary. Your <code>y</code>, being 2 bytes long must start at an offset that divides by 2, so there&#39;s a padding byte after <code>x</code>."}], "answers": [{"comments": [{"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 3, "creation_date": 1524044921, "post_id": 49896199, "comment_id": 86808263, "body": "I would caution that <code>((packed))</code> isn&#39;t being recommended, but rather provided for informational purposes."}, {"owner": {"reputation": 3003, "user_id": 132162, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7e05ab5ffe3b7b0bc5a9f4aeaa847564?s=128&d=identicon&r=PG", "display_name": "raupach", "link": "https://stackoverflow.com/users/132162/raupach"}, "edited": false, "score": 0, "creation_date": 1524045050, "post_id": 49896199, "comment_id": 86808363, "body": "Added __attribute__((packed)) to the struct. Now it works."}], "tags": [], "owner": {"reputation": 1014, "user_id": 2551956, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ba34ab655eaf76dc5486c0677aad24f9?s=128&d=identicon&r=PG", "display_name": "user234461", "link": "https://stackoverflow.com/users/2551956/user234461"}, "is_accepted": true, "score": 0, "last_activity_date": 1524044094, "creation_date": 1524044094, "answer_id": 49896199, "question_id": 49896132, "link": "https://stackoverflow.com/questions/49896132/why-does-fwrite-write-two-bytes-for-an-uint8-t/49896199#49896199", "title": "Why does fwrite write two bytes for an uint8_t?", "body": "<p>Structs are often padded by the compiler - empty space has been inserted after <code>x</code> so that <code>y</code> is aligned to a 16-bit boundary.</p>\n\n<p>GCC offers <code>__attribute__((packed))</code> to disable this behaviour; see <a href=\"https://gcc.gnu.org/onlinedocs/gcc-3.3/gcc/Type-Attributes.html\" rel=\"nofollow noreferrer\">these docs</a></p>\n"}, {"comments": [{"owner": {"reputation": 3003, "user_id": 132162, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7e05ab5ffe3b7b0bc5a9f4aeaa847564?s=128&d=identicon&r=PG", "display_name": "raupach", "link": "https://stackoverflow.com/users/132162/raupach"}, "edited": false, "score": 0, "creation_date": 1524049202, "post_id": 49896380, "comment_id": 86811319, "body": "Thanks, now I know a litte bit more about data alignment."}, {"owner": {"reputation": 106438, "user_id": 1275169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4c6dbda4e65af6d2ceaabdfad538b319?s=128&d=identicon&r=PG&f=1", "display_name": "P.P", "link": "https://stackoverflow.com/users/1275169/p-p"}, "reply_to_user": {"reputation": 3003, "user_id": 132162, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7e05ab5ffe3b7b0bc5a9f4aeaa847564?s=128&d=identicon&r=PG", "display_name": "raupach", "link": "https://stackoverflow.com/users/132162/raupach"}, "edited": false, "score": 0, "creation_date": 1524050903, "post_id": 49896380, "comment_id": 86812484, "body": "Just a note about <code>__attribute__((packed))</code>: It <i>can be</i> useful under some circumstances but generally it should be avoided. If an architecture doesn&#39;t support unaligned accesses, packed structs would fail (typically bus error) or frequent faults might affect performance."}, {"owner": {"reputation": 3003, "user_id": 132162, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7e05ab5ffe3b7b0bc5a9f4aeaa847564?s=128&d=identicon&r=PG", "display_name": "raupach", "link": "https://stackoverflow.com/users/132162/raupach"}, "edited": false, "score": 0, "creation_date": 1524052439, "post_id": 49896380, "comment_id": 86813540, "body": "What are the options on architectures with unaligned accesses? Lets say I am stuck with reading and writing these kind of structs?"}, {"owner": {"reputation": 106438, "user_id": 1275169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4c6dbda4e65af6d2ceaabdfad538b319?s=128&d=identicon&r=PG&f=1", "display_name": "P.P", "link": "https://stackoverflow.com/users/1275169/p-p"}, "reply_to_user": {"reputation": 3003, "user_id": 132162, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7e05ab5ffe3b7b0bc5a9f4aeaa847564?s=128&d=identicon&r=PG", "display_name": "raupach", "link": "https://stackoverflow.com/users/132162/raupach"}, "edited": false, "score": 1, "creation_date": 1524052637, "post_id": 49896380, "comment_id": 86813664, "body": "You can &quot;manually&quot; pack it by rearranging the members appropriately or using only fixed size variables (so that compiler won&#39;t introduce padding). Or insert padding yourself so that you know the precise size of the struct on all archs. Might be useful to read: <a href=\"http://www.catb.org/esr/structure-packing/\" rel=\"nofollow noreferrer\">catb.org/esr/structure-packing</a>"}], "tags": [], "owner": {"reputation": 106438, "user_id": 1275169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4c6dbda4e65af6d2ceaabdfad538b319?s=128&d=identicon&r=PG&f=1", "display_name": "P.P", "link": "https://stackoverflow.com/users/1275169/p-p"}, "is_accepted": false, "score": 5, "last_activity_date": 1524044574, "creation_date": 1524044574, "answer_id": 49896380, "question_id": 49896132, "link": "https://stackoverflow.com/questions/49896132/why-does-fwrite-write-two-bytes-for-an-uint8-t/49896380#49896380", "title": "Why does fwrite write two bytes for an uint8_t?", "body": "<blockquote>\n  <p>I am trying to write 3 bytes to file, but end up with 4.</p>\n</blockquote>\n\n<p>You might be <em>aiming</em> to write to 3 bytes but are actually writing <code>sizeof(struct a)</code>, which is likely to 4 because compiler inserted a byte of padding for alignment. Perhaps you are assuming size of a structure is equal to the sum of sizes of its members and failed to account for possible padding.</p>\n\n<p>In general, compiler is free to insert padding in a way for alignment purposes (except there can't be any padding <em>before</em> the first member of the struct).</p>\n\n<p>If you write the individual members, you'd see the expected output:</p>\n\n<pre><code>  fwrite(&amp;record.x, sizeof record.x, 1, fp);\n  fwrite(&amp;record.y, sizeof record.y, 1, fp);\n</code></pre>\n\n<p>P.S.: Make sure you error check all the functions that could fail (fopen, fwrite, etc).</p>\n"}], "owner": {"reputation": 3003, "user_id": 132162, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7e05ab5ffe3b7b0bc5a9f4aeaa847564?s=128&d=identicon&r=PG", "display_name": "raupach", "link": "https://stackoverflow.com/users/132162/raupach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "closed_date": 1524060899, "accepted_answer_id": 49896199, "answer_count": 2, "score": 2, "last_activity_date": 1524044574, "creation_date": 1524043910, "question_id": 49896132, "link": "https://stackoverflow.com/questions/49896132/why-does-fwrite-write-two-bytes-for-an-uint8-t", "closed_reason": "Duplicate", "title": "Why does fwrite write two bytes for an uint8_t?", "body": "<p>Not very skilled in C. This might be just a newbie question.</p>\n\n<p>I am trying to write 3 bytes to file, but end up with 4. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct a {\n  uint8_t x;\n  uint16_t y;\n};\n\nint main()\n{\n  struct a record = { 1, 2 };\n  FILE *fp = fopen(\"example.bin\", \"w\");\n  fwrite(&amp;record, sizeof(struct a), 1, fp);\n  fclose(fp);\n}\n</code></pre>\n\n<p>For some reason I end up with:</p>\n\n<pre><code>$ hexdump -C example.bin\n00000000  01 00 02 00                                       |....|\n00000004\n</code></pre>\n\n<p>I was expecting: <code>01 02 00</code>.</p>\n\n<p>Here is the version of my c compiler in case this is hardware/compiler related.</p>\n\n<pre><code>$ cc --version\nApple LLVM version 9.1.0 (clang-902.0.39.1)\nTarget: x86_64-apple-darwin17.5.0\nThread model: posix\n</code></pre>\n"}, {"tags": ["c", "multithreading", "shared-libraries", "libxml2"], "comments": [{"owner": {"reputation": 628, "user_id": 8939165, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0gchW.jpg?s=128&g=1", "display_name": "Fabio_MO", "link": "https://stackoverflow.com/users/8939165/fabio-mo"}, "edited": false, "score": 0, "creation_date": 1524063131, "post_id": 49896108, "comment_id": 86821109, "body": "Read this: <a href=\"http://xmlsoft.org/threads.html\" rel=\"nofollow noreferrer\">xmlsoft.org/threads.html</a>"}, {"owner": {"reputation": 152, "user_id": 6232305, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O9iwz.jpg?s=128&g=1", "display_name": "lnksz", "link": "https://stackoverflow.com/users/6232305/lnksz"}, "reply_to_user": {"reputation": 628, "user_id": 8939165, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0gchW.jpg?s=128&g=1", "display_name": "Fabio_MO", "link": "https://stackoverflow.com/users/8939165/fabio-mo"}, "edited": false, "score": 0, "creation_date": 1528993647, "post_id": 49896108, "comment_id": 88726583, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/41689764/how-to-check-if-libxml2-is-initialized\">How to check if libxml2 is initialized</a>"}], "answers": [{"tags": [], "owner": {"reputation": 28131, "user_id": 1956010, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bfdcb4596e9da98cccbf9a0069fdff6c?s=128&d=identicon&r=PG", "display_name": "nwellnhof", "link": "https://stackoverflow.com/users/1956010/nwellnhof"}, "is_accepted": true, "score": 0, "last_activity_date": 1528021135, "creation_date": 1528021135, "answer_id": 50665314, "question_id": 49896108, "link": "https://stackoverflow.com/questions/49896108/libxml2-so-init-cleanupparser-usage-for-multiple-processes-with-threads/50665314#50665314", "title": "libxml2.so Init/CleanupParser usage for multiple processes with threads", "body": "<p><code>xmlInitParser</code> is not thread-safe. It's best to call this function once from the main thread before spawning other threads, for example, at the beginning of <code>main</code>.</p>\n\n<p><code>xmlCleanupParser</code> must never be called if any thread of the process invokes any other libxml2 functions afterwards. So <code>xmlInitParser() ... xmlCleanupParser()</code> on a thread level is not OK. You normally don't have to call <code>xmlCleanupParser</code> at all, but you'll need it to avoid false positives when checking for memory leaks with tools like valgrind or ASan. In this case, it's best to call it right before the process exits, for example at the end of <code>main</code>.</p>\n"}], "owner": {"reputation": 152, "user_id": 6232305, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O9iwz.jpg?s=128&g=1", "display_name": "lnksz", "link": "https://stackoverflow.com/users/6232305/lnksz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "accepted_answer_id": 50665314, "answer_count": 1, "score": 0, "last_activity_date": 1528021135, "creation_date": 1524043839, "question_id": 49896108, "link": "https://stackoverflow.com/questions/49896108/libxml2-so-init-cleanupparser-usage-for-multiple-processes-with-threads", "title": "libxml2.so Init/CleanupParser usage for multiple processes with threads", "body": "<p>I am using <strong>libxml2</strong> as a <strong>shared library</strong> from different paralelly running processes on an <strong>arm/linux</strong> environment. The offical examples are one-off processes where the handling of <a href=\"http://xmlsoft.org/html/libxml-parser.html#xmlInitParser\" rel=\"nofollow noreferrer\"><code>InitParser()</code></a> and <a href=\"http://xmlsoft.org/html/libxml-parser.html#xmlCleanupParser\" rel=\"nofollow noreferrer\"><code>CleanupParser()</code></a> are trivial.</p>\n\n<p>In a setup where multiple processes use libxml2 I am not sure how to use it.</p>\n\n<pre><code>proc1 -thread1-&gt; work -&gt; libxml2.so -&gt; ...\n      -thread2-&gt; work -&gt; ...\n      -thread3-&gt; work -&gt; work -&gt; libxml2.so -&gt; work -&gt; ...\nproc2 -thread1-&gt; wrapper.so -&gt; libxml2.so -&gt; work -&gt; ...\n      -thread2-&gt; work -&gt; ...\n      -thread3-&gt; wrapper.so -&gt; libxml2.so -&gt; ...\n</code></pre>\n\n<h2>Problems</h2>\n\n<ul>\n<li><p>Being an embedded device, the processes run normally 'forever', so I cannot afford any memory-leak. (I test the code with unittest+valgrind and live-run+memory monitor).</p></li>\n<li><p><code>InitParser()</code> is not reentrent, so as I understang the <code>InitParser()</code> => ... => <code>CleanupParser()</code> on a thread level is not ok? (e.g. proc1::thr1 vs. proc1::thr3)</p>\n\n<ul>\n<li><strong>That is why I am thinking about a process level house-keeping.<br>\nBut would a <code>CleanupParser()</code> call in <code>proc1</code> interact with <code>proc2's</code> libxml2 calls?</strong><br>\n(Is it \"tunneled-through\" the shared-lib?)</li>\n</ul></li>\n</ul>\n\n<hr>\n\n<h3><code>InitParser()</code></h3>\n\n<blockquote>\n  <p>Initialization function for the XML parser. This is <strong>not reentrant</strong>. Call once <strong>before</strong> processing in case of use in <strong>multithreaded programs</strong></p>\n</blockquote>\n\n<h3><code>CleanupParser()</code></h3>\n\n<blockquote>\n  <p>it cleans up memory allocated by the library itself. It is a cleanup\n  function for the XML library. It tries to reclaim all related global\n  memory allocated for the library processing. It doesn't deallocate any\n  document related memory. One should call xmlCleanupParser() only when\n  <strong>the process has finished</strong> using the library and all XML/HTML documents\n  built with it. See also xmlInitParser() which has the opposite\n  function of preparing the library for operations. WARNING: if your\n  application is multithreaded or has plugin support calling this may\n  crash the application if another thread or a plugin is still using\n  libxml2</p>\n</blockquote>\n\n<p>I guess, the question reveals my limited knowledge of the inner-workings of shared-libs... Thanks for any help!</p>\n"}, {"tags": ["c", "makefile"], "comments": [{"owner": {"reputation": 2375, "user_id": 3985859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34af6d164c53c629e625c11a3d11bbcc?s=128&d=identicon&r=PG&f=1", "display_name": "Karsten Koop", "link": "https://stackoverflow.com/users/3985859/karsten-koop"}, "edited": false, "score": 0, "creation_date": 1524045133, "post_id": 49896101, "comment_id": 86808437, "body": "AFAIK, <code>-lpthread</code> should not be in <code>CFLAGS</code>, but in <code>LDFLAGS</code> or <code>LDLIBS</code>"}, {"owner": {"reputation": 199, "user_id": 9663390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d995050ef3649a918a4dfd4ff15fe905?s=128&d=identicon&r=PG&f=1", "display_name": "compsciman", "link": "https://stackoverflow.com/users/9663390/compsciman"}, "reply_to_user": {"reputation": 2375, "user_id": 3985859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34af6d164c53c629e625c11a3d11bbcc?s=128&d=identicon&r=PG&f=1", "display_name": "Karsten Koop", "link": "https://stackoverflow.com/users/3985859/karsten-koop"}, "edited": false, "score": 1, "creation_date": 1524045399, "post_id": 49896101, "comment_id": 86808685, "body": "i changed <code>CFLAGS</code> to <code>LDLIBS</code> and now it works. Post it as the answer."}], "answers": [{"tags": [], "owner": {"reputation": 2375, "user_id": 3985859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34af6d164c53c629e625c11a3d11bbcc?s=128&d=identicon&r=PG&f=1", "display_name": "Karsten Koop", "link": "https://stackoverflow.com/users/3985859/karsten-koop"}, "is_accepted": true, "score": 2, "last_activity_date": 1524048884, "last_edit_date": 1592644375, "creation_date": 1524048884, "answer_id": 49897934, "question_id": 49896101, "link": "https://stackoverflow.com/questions/49896101/makefile-change-lpthread-argument-position/49897934#49897934", "title": "Makefile change -lpthread argument position?", "body": "<p>The list of libraries should go to <code>LDLIBS</code>, not <code>CFLAGS</code>. From the <a href=\"https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html\" rel=\"nofollow noreferrer\">manual</a>:</p>\n<blockquote>\n<p>LDLIBS</p>\n<p>Library flags or names given to compilers when they are supposed to invoke the linker, \u2018ld\u2019. LOADLIBES is a deprecated (but still supported) alternative to LDLIBS. Non-library linker flags, such as -L, should go in the LDFLAGS variable.</p>\n</blockquote>\n<p>By using <code>LDLIBS</code>, the arguments should be at the correct position in the call to the compiler, after the input files.</p>\n"}, {"tags": [], "owner": {"reputation": 119228, "user_id": 412080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/239e18525e4c29872d85b2b553b2e4d2?s=128&d=identicon&r=PG", "display_name": "Maxim Egorushkin", "link": "https://stackoverflow.com/users/412080/maxim-egorushkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1524053372, "last_edit_date": 1524053372, "creation_date": 1524053027, "answer_id": 49899282, "question_id": 49896101, "link": "https://stackoverflow.com/questions/49896101/makefile-change-lpthread-argument-position/49899282#49899282", "title": "Makefile change -lpthread argument position?", "body": "<p><a href=\"https://gcc.gnu.org/onlinedocs/gcc-7.3.0/gcc/Preprocessor-Options.html#index-pthread\" rel=\"nofollow noreferrer\">You need to use <code>-pthread</code> command line option for both compiling and linking</a>. <code>-lpthread</code> is both insufficient and unnecessary:</p>\n\n<pre><code>CFLAGS := -pthread\nLDFLAGS := -pthread\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 9663390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d995050ef3649a918a4dfd4ff15fe905?s=128&d=identicon&r=PG&f=1", "display_name": "compsciman", "link": "https://stackoverflow.com/users/9663390/compsciman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 49897934, "answer_count": 2, "score": 1, "last_activity_date": 1524053372, "creation_date": 1524043820, "question_id": 49896101, "link": "https://stackoverflow.com/questions/49896101/makefile-change-lpthread-argument-position", "title": "Makefile change -lpthread argument position?", "body": "<p>I have a server that only compiles when I do <code>gcc server.c -o server -lpthread</code> but my makefile does it as <code>gcc -lpthread server.c -o server</code> and just hands me undefined reference errors. How can I change the <code>-lpthread</code> position?</p>\n\n<p>Here's the file:</p>\n\n<pre><code>CC=gcc\nCFLAGS=-lpthread\n\nall: server\nserver: server.c\n\nclean:\n    rm -f server\n\nrun:\n    server\n    ./server\n</code></pre>\n"}, {"tags": ["c", "bitwise-operators", "byte-shifting"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 2, "creation_date": 1524039894, "post_id": 49894712, "comment_id": 86804777, "body": "it&#39;s just testing the 7th bit of the value."}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 2, "creation_date": 1524039919, "post_id": 49894712, "comment_id": 86804793, "body": "Odd or even would be bit 0, not bit 7. This is simply extracting bit #7 from the state, nothing more, nothing less."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "edited": false, "score": 2, "creation_date": 1524040076, "post_id": 49894712, "comment_id": 86804880, "body": "Yes this extracts bit 7 of state. If bit 7 is 1, returns 1. Else 0."}, {"owner": {"reputation": 37954, "user_id": 905902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a18869332564b1c3dfad9586d37095b2?s=128&d=identicon&r=PG", "display_name": "wildplasser", "link": "https://stackoverflow.com/users/905902/wildplasser"}, "edited": false, "score": 0, "creation_date": 1524044029, "post_id": 49894712, "comment_id": 86807571, "body": "You don&#39;t shift an <i>object</i>. You take its <i>value</i>, and shift that <i>value</i>, and bitwise-AND the resulting <i>value</i> with <code>1</code>. Then you treat the resulting <i>value</i> as a boolean and assign it to an integer <i>object</i>."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524072477, "post_id": 49894712, "comment_id": 86827134, "body": "the_naive, if code was <code>int bitValue = (state &#47;128) %2;</code>, would that be easier to understand?"}], "answers": [{"comments": [{"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 2, "creation_date": 1524042889, "post_id": 49894808, "comment_id": 86806726, "body": "1 byte is always 8 bits on modern <i>general-purpose</i> CPUs. There are lots of <a href=\"https://stackoverflow.com/questions/44755034/md5-implementation-for-non-byte-addressable-arch\">modern stuff where it need not be true</a>."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 0, "creation_date": 1524042929, "post_id": 49894808, "comment_id": 86806761, "body": "I may delete that last bit, that&#39;s overanswering, just to say: &quot;don&#39;t do it&quot;. I had that 1 byte wasn&#39;t always 8 bits but couldn&#39;t find that reference. Well, adding &amp; 0x1 doesn&#39;t hurt."}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 1, "creation_date": 1524043103, "post_id": 49894808, "comment_id": 86806883, "body": "well, you could add that generally this is the MSB (not the LSB as OP thought) ;)"}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1524044580, "post_id": 49894808, "comment_id": 86808007, "body": "Wouldn&#39;t <code>bitvalue = state &gt; 127 ? 1 : 0;</code> be a lot more readable -- and let the compiler decide how to optimize?"}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1524052576, "post_id": 49894808, "comment_id": 86813621, "body": "or <code>!!(state &gt; 127)</code> :) in that particular case yes. I don&#39;t like ternary that yield bools that much :)"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1524055542, "post_id": 49894808, "comment_id": 86815509, "body": "@DavidC.Rankin <code>state &gt; 127 ? 1 : 0</code> differs in functionality from <code>(state &gt;&gt; 7) &amp; 0x1</code> on exceptionally cases when <code>CHAR_BIT &gt; 8</code>."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524057681, "post_id": 49894808, "comment_id": 86817036, "body": "@chux: oh yes, that&#39;s why I had removed my edit on <code>state &gt;&gt; 7</code> (without masking). I&#39;m not touching those formulas again."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524072185, "post_id": 49894808, "comment_id": 86826966, "body": "@chux If <code>CHAR_BIT</code> was not <i>defined</i> as <code>8</code>, then <code>(state &gt;&gt; 7)</code> and <code>(state &amp; 0x80)</code> would no longer work either? No?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1524072265, "post_id": 49894808, "comment_id": 86827019, "body": "@DavidC.Rankin Why not?  If <code>CHAR_BIT == 9</code>, then <code>(state &gt;&gt; 7) &amp; 0x1;</code> would still report bit 7.  It would not be the <i>most significant bit</i>, yet that was not OP&#39;s posted goal."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524072437, "post_id": 49894808, "comment_id": 86827101, "body": "@chux If <code>CHAR_BIT = 9</code>, the <code>unsigned char</code> would have <code>9</code> bytes and neither of the tests would fill their intended purposes of testing the MSB (incorrectly written as LSB in the question)."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "reply_to_user": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 0, "creation_date": 1524072761, "post_id": 49894808, "comment_id": 86827285, "body": "@DavidC.Rankin OP post does not appear to seek the MSB to me.  It looks like OP thought (incorrectly) the code was testing for odd/evenness by testing the LSB.  IAC, OP title seeks to understand want is happening - well answered <a href=\"https://stackoverflow.com/a/49894808/2410359\">here</a>."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524073123, "post_id": 49894808, "comment_id": 86827468, "body": "@chux If that be the case, and he just be wanting bit-7 irrespective of the size of <i>unsigned char</i>, then ye be right -- otherwise a change in <code>CHAR_BIT</code> would render any fixed-bit number test wrong as well. But <code>CHAR_BIT != 8</code> be not sticking with the code..."}], "tags": [], "owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "is_accepted": false, "score": 5, "last_activity_date": 1524057648, "last_edit_date": 1524057648, "creation_date": 1524040166, "answer_id": 49894808, "question_id": 49894712, "link": "https://stackoverflow.com/questions/49894712/what-does-using-bit-wise-and-operator-on-a-unsigned-char-object-after-right-shif/49894808#49894808", "title": "What does using bit wise AND operator on a unsigned char object after right shifting it mean?", "body": "<pre><code>int bitValue = (state &gt;&gt; 7) &amp; 0x1;\n</code></pre>\n\n<p>just shifts <code>state</code> by 7 bits. Then it removes all other bits than the first one.</p>\n\n<p>So converts the 7th bit (<em>most significant bit</em> in most systems where <code>unsigned char</code> is 8 bits) of your value to 0 or 1 value. It could be written as a boolean expression (using the idiomatic double negation):</p>\n\n<pre><code>int bitValue = !!(state &amp; 0x80);\n</code></pre>\n\n<p>but the shifting and masking directly gives the 0 or 1 value without converting to bool.</p>\n"}, {"comments": [{"owner": {"reputation": 95, "user_id": 4339067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/558312ef2dcbab85c93d6385c58eeb30?s=128&d=identicon&r=PG&f=1", "display_name": "Priyank Palod", "link": "https://stackoverflow.com/users/4339067/priyank-palod"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524061763, "post_id": 49895047, "comment_id": 86820047, "body": "Right, Chux! Edited the answer."}], "tags": [], "owner": {"reputation": 95, "user_id": 4339067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/558312ef2dcbab85c93d6385c58eeb30?s=128&d=identicon&r=PG&f=1", "display_name": "Priyank Palod", "link": "https://stackoverflow.com/users/4339067/priyank-palod"}, "is_accepted": false, "score": 1, "last_activity_date": 1524061709, "last_edit_date": 1524061709, "creation_date": 1524040951, "answer_id": 49895047, "question_id": 49894712, "link": "https://stackoverflow.com/questions/49894712/what-does-using-bit-wise-and-operator-on-a-unsigned-char-object-after-right-shif/49895047#49895047", "title": "What does using bit wise AND operator on a unsigned char object after right shifting it mean?", "body": "<p>(state>>7) returns the value generated by shifting the unsigned char \"state\" by 7 bits, adding leading zeros. Performing the and operation with one now gives the value of seventh bit in state. </p>\n\n<p>That is, bitValue is 1 iff the seventh bit of state (from the right) is 1, or in other words bitValue is 1 iff state >= 128.</p>\n"}], "owner": {"reputation": 2676, "user_id": 1193350, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/585e008945adc54ef63ac2c4116eeaa6?s=128&d=identicon&r=PG", "display_name": "the_naive", "link": "https://stackoverflow.com/users/1193350/the-naive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1524061709, "creation_date": 1524039848, "question_id": 49894712, "link": "https://stackoverflow.com/questions/49894712/what-does-using-bit-wise-and-operator-on-a-unsigned-char-object-after-right-shif", "title": "What does using bit wise AND operator on a unsigned char object after right shifting it mean?", "body": "<p>I'm trying to understand a snippet of code which is the following:</p>\n\n<pre><code>unsigned char state = portStates[portNumber];\nint bitValue = (state &gt;&gt; 7) &amp; 0x1;\n</code></pre>\n\n<p>It's doing a bitwise AND on the least-significant bit of\n<code>state</code>, right? If it returns true (ie, that bit is set), then the\nnumber is odd. Otherwise, it's even. Am I correct?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["c++", "c", "multithreading"], "comments": [{"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 1, "creation_date": 1524038722, "post_id": 49894336, "comment_id": 86804046, "body": "Please format your code correctly"}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1524038761, "post_id": 49894336, "comment_id": 86804081, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4856255/the-difference-between-fork-vfork-exec-and-clone\">The difference between fork(), vfork(), exec() and clone()</a>"}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1524039291, "post_id": 49894336, "comment_id": 86804416, "body": "&quot;That&#39;s why I don&#39;t understand why in #2 code the else branch is also being executed?&quot; What do you expect happens to the calling process?"}, {"owner": {"reputation": 25, "user_id": 9529055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee234c35869854a0604c674fdf73703f?s=128&d=identicon&r=PG&f=1", "display_name": "ponikoli", "link": "https://stackoverflow.com/users/9529055/ponikoli"}, "edited": false, "score": 0, "creation_date": 1524039702, "post_id": 49894336, "comment_id": 86804662, "body": "Because I expect fork() to return 0, so when does it go the else branch. I&#39;ve edited my question to clarify"}, {"owner": {"reputation": 5304, "user_id": 2757035, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/fade5daafd5717576b33f2e08f4f9429?s=128&d=identicon&r=PG&f=1", "display_name": "underscore_d", "link": "https://stackoverflow.com/users/2757035/underscore-d"}, "edited": false, "score": 0, "creation_date": 1524039808, "post_id": 49894336, "comment_id": 86804722, "body": "<i>&quot;I&#39;m trying to understand how many processes are created as well as why and how long the code will sleep?&quot;</i> so run it? or read enough documentation that you can step through the code in your mind and figure it out? IMO, just as SO is not a code-writing service, it should not be a code-explaining service either."}, {"owner": {"reputation": 159, "user_id": 9603417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aJfoP.png?s=128&g=1", "display_name": "Volont&#233; du Peuple", "link": "https://stackoverflow.com/users/9603417/volont%c3%a9-du-peuple"}, "edited": false, "score": 0, "creation_date": 1524040543, "post_id": 49894336, "comment_id": 86805164, "body": "You should do your execlp into your if (when the pid is equal to 0), and not in the if (parent process, when pid &gt; 0)."}, {"owner": {"reputation": 7421, "user_id": 6782754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99008d0e4c4c15ab03d77938ad9e345b?s=128&d=identicon&r=PG", "display_name": "Gerhardh", "link": "https://stackoverflow.com/users/6782754/gerhardh"}, "edited": false, "score": 0, "creation_date": 1524041015, "post_id": 49894336, "comment_id": 86805473, "body": "You correctly mentioned that <code>fork</code> returns &quot;zero to a newly created child process&quot;. The caller is not a newly created child process. The caller also returns from <code>fork</code> and does not get a zero returned. That is the way to determine if your code that follows <code>fork</code> is executed in parent or child process."}], "answers": [{"tags": [], "owner": {"reputation": 96, "user_id": 8068030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f21a75e95ec1a3aa744d4ef67e6743f?s=128&d=identicon&r=PG&f=1", "display_name": "John Stone", "link": "https://stackoverflow.com/users/8068030/john-stone"}, "is_accepted": false, "score": 2, "last_activity_date": 1524039591, "creation_date": 1524039591, "answer_id": 49894637, "question_id": 49894336, "link": "https://stackoverflow.com/questions/49894336/creating-new-processes-with-fork-vs-exec/49894637#49894637", "title": "Creating new processes with fork() vs exec()", "body": "<p>fork will return two times, one in the original process, with the return value of the pid of the child process, the other in the child process, with the return value of zero</p>\n"}, {"tags": [], "owner": {"reputation": 159, "user_id": 9603417, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aJfoP.png?s=128&g=1", "display_name": "Volont&#233; du Peuple", "link": "https://stackoverflow.com/users/9603417/volont%c3%a9-du-peuple"}, "is_accepted": true, "score": 0, "last_activity_date": 1524040492, "creation_date": 1524040492, "answer_id": 49894914, "question_id": 49894336, "link": "https://stackoverflow.com/questions/49894336/creating-new-processes-with-fork-vs-exec/49894914#49894914", "title": "Creating new processes with fork() vs exec()", "body": "<blockquote>\n  <p>DESCRIPTION</p>\n  \n  <p>fork() creates a new process by duplicating the calling process.  The new process is referred to as the child process.  The calling process is referred to as the parent process.</p>\n</blockquote>\n\n<p>and:</p>\n\n<blockquote>\n  <p>RETURN VALUE</p>\n  \n  <p>On success, the PID of the child process is returned in the parent, and 0 is returned in the child.  On failure, -1 is returned in the parent, no child process is created, and errno is  set  appropriately.</p>\n</blockquote>\n\n<p>So, after to fork(), you have your newly created process, so you have <strong>2 process</strong>, the child (the new process) and the parent (the initial process).</p>\n\n<p>So, what your child (pid == 0) is going into the sleep when you parent (pid > 0) is executing your sleep.</p>\n\n<p>After doing an exec* (execl, execlp, execv, execve, etc...) your process is terminated (try to place a printf or whatever AFTER your execlp, you will see it will never print it (except in case of error (execlp's return value == -1)).</p>\n\n<p><strong>To answer to your initial question:</strong>\nYes, your program pass in your if <strong>AND</strong> in your else (put printf to see clearer), because you have in fact 2 process, and you can even try to put a printf after the else statement, at the very end of your program, and you will see that the child pass (print his pid, it should be equal to 0).</p>\n"}], "owner": {"reputation": 25, "user_id": 9529055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee234c35869854a0604c674fdf73703f?s=128&d=identicon&r=PG&f=1", "display_name": "ponikoli", "link": "https://stackoverflow.com/users/9529055/ponikoli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 398, "favorite_count": 0, "accepted_answer_id": 49894914, "answer_count": 2, "score": -3, "last_activity_date": 1524040492, "creation_date": 1524038662, "last_edit_date": 1524039615, "question_id": 49894336, "link": "https://stackoverflow.com/questions/49894336/creating-new-processes-with-fork-vs-exec", "title": "Creating new processes with fork() vs exec()", "body": "<pre><code>#1 code\n    int child_pid;\n    for (int i = 0; i &lt; 3; i++)\n    {\n    child_pid = fork();\n    if (child_pid == 0) \n    { sleep(10); }\n    else\n    { wait(&amp;status); }\n    }\n    execlp(\"sleep\",\"sleep\",\"20\",(char*)NULL);\n\n#2 code\n    int child_pid;\n    for (int i = 0; i &lt; 5; i++)\n    {\n    child_pid = fork();\n    if (child_pid == 0) \n    { sleep(1); }\n    else\n    { wait(&amp;status);\n      execlp(\"sleep\",\"sleep\",\"20\",(char*)NULL); }\n    }\n</code></pre>\n\n<p>Can someone explain to me what is happening in these codes?\nI understand fork() returns a zero to a newly created child process. That's why I don't understand why in #2 code the else branch is also being executed? Execlp replaces the calling process image with a new process image, but what does this really mean?</p>\n\n<p>EDIT:\nThe answer is that the first code will create 8 processes, but I'm not able to understand how? And why will the first code finish 230 seconds? How does exec affect this?</p>\n\n<p>The second code will create 5 processes, but it will finish after (5*2sec+5*20sec). In the second code why does it go to the else branch?</p>\n\n<p>I'm trying to understand how many processes are created as well as why and how long the code will sleep?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["c", "stm32", "spi", "stm32f4"], "comments": [{"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1524039726, "post_id": 49893739, "comment_id": 86804674, "body": "Did you read the RM? Or maybe you believe in the &quot;magic&quot; HAL functions."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1524043509, "post_id": 49893739, "comment_id": 86807184, "body": "Before you eve touch any hardware abstraction library - learn oyur hardware. Try use registers first and learn how this peripheral works"}, {"owner": {"reputation": 23378, "user_id": 4850040, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/acYd0.png?s=128&g=1", "display_name": "Toby Speight", "link": "https://stackoverflow.com/users/4850040/toby-speight"}, "edited": false, "score": 0, "creation_date": 1524067686, "post_id": 49893739, "comment_id": 86824392, "body": "Your code is incomplete; in particular, it seems to be missing a <code>main()</code> function and at least one <code>#include</code>. Please <a href=\"https://stackoverflow.com/posts/49893739/edit\">edit</a> your code so it&#39;s a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> of your problem (including any necessary inputs, but preferably not needing any), then we can try to reproduce and solve it. You should also read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>."}, {"owner": {"reputation": 9, "user_id": 7991337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/324839de0eb44c47f957a6aac7cc4af4?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis Hergaarden", "link": "https://stackoverflow.com/users/7991337/dennis-hergaarden"}, "edited": false, "score": 0, "creation_date": 1524124625, "post_id": 49893739, "comment_id": 86846857, "body": "I am sorry. My scope wasn&#39;t configured well. It works now."}], "owner": {"reputation": 9, "user_id": 7991337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/324839de0eb44c47f957a6aac7cc4af4?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis Hergaarden", "link": "https://stackoverflow.com/users/7991337/dennis-hergaarden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 472, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1564834946, "creation_date": 1524036758, "last_edit_date": 1564834946, "question_id": 49893739, "link": "https://stackoverflow.com/questions/49893739/stm32f4-discovery-spi", "title": "STM32F4-Discovery SPI", "body": "<p>I have to make SPI communication working on a STM32F4 Discovery board. I have configured it with CubeMX. The following code is generated to configure the SPI device: </p>\n\n<pre><code>hspi2.Instance = SPI2;\nhspi2.Init.Mode = SPI_MODE_MASTER;\nhspi2.Init.Direction = SPI_DIRECTION_2LINES;\nhspi2.Init.DataSize = SPI_DATASIZE_8BIT;\nhspi2.Init.CLKPolarity = SPI_POLARITY_LOW;\nhspi2.Init.CLKPhase = SPI_PHASE_1EDGE;\nhspi2.Init.NSS = SPI_NSS_SOFT;\nhspi2.Init.BaudRatePrescaler = SPI_BAUDRATEPRESCALER_4;\nhspi2.Init.FirstBit = SPI_FIRSTBIT_MSB;\nhspi2.Init.TIMode = SPI_TIMODE_DISABLE;\nhspi2.Init.CRCCalculation = SPI_CRCCALCULATION_DISABLE;\nhspi2.Init.CRCPolynomial = 10;\n</code></pre>\n\n<p>I created an array to send over SPI and send it using the HAL_SPI_Transmit_DMA function. </p>\n\n<pre><code>uint8_t test[25] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0,0, 0xED};\nHAL_SPI_Transmit_DMA(&amp;hspi2, test, sizeof(test));\n</code></pre>\n\n<p>The problem is, I don't get the right output out of it. I connected a scope to it and I see only 16 bytes. </p>\n\n<p><a href=\"https://i.stack.imgur.com/9P8uI.png\" rel=\"nofollow noreferrer\">Screenshot of the output from the scope</a></p>\n\n<p>This is the first time I work with a stm32f4. It's hard for me to figure out why it's not working. I searched on the internet and saw there were more problems with SPI on the STM32. I haven't found a solution yet.</p>\n"}, {"tags": ["c", "arrays", "fibonacci"], "comments": [{"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 2, "creation_date": 1524035524, "post_id": 49893357, "comment_id": 86802207, "body": "I don&#39;t know why you say the <i>if loop</i>, what exactly is that?"}, {"owner": {"reputation": 116557, "user_id": 918959, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b9051b2917c3d55d55b3d7042fa49f6c?s=128&d=identicon&r=PG", "display_name": "Antti Haapala", "link": "https://stackoverflow.com/users/918959/antti-haapala"}, "edited": false, "score": 3, "creation_date": 1524035618, "post_id": 49893357, "comment_id": 86802250, "body": "what is an &quot;if loop&quot;!?"}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 0, "creation_date": 1524035772, "post_id": 49893357, "comment_id": 86802338, "body": "Also, your code uses an ancient <code>main()</code> signature which is no longer acceptable, change it to <code>int main(void)</code>."}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 0, "creation_date": 1524035887, "post_id": 49893357, "comment_id": 86802418, "body": "Your code style is also very inconsistent, so it looks like you either copied and pasted parts of it from somewhere else or there is more than one programmer writting it."}], "answers": [{"comments": [{"owner": {"reputation": 1311, "user_id": 4178713, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PYjXH.jpg?s=128&g=1", "display_name": "crack_iT", "link": "https://stackoverflow.com/users/4178713/crack-it"}, "reply_to_user": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 0, "creation_date": 1524035959, "post_id": 49893457, "comment_id": 86802457, "body": "He have to compare to all Fibonacci numbers, so inner loop is required"}, {"owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "edited": false, "score": 2, "creation_date": 1524036191, "post_id": 49893457, "comment_id": 86802569, "body": "This seems like a reasonable approach given the structure of the OP&#39;s code."}, {"owner": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 1, "creation_date": 1524036229, "post_id": 49893457, "comment_id": 86802595, "body": "Ok, that&#39;s better. But now you only wrote 5 lines of code and yet you have inconsistencies in your choice of style and the indentation is terrible!"}, {"owner": {"reputation": 1311, "user_id": 4178713, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PYjXH.jpg?s=128&g=1", "display_name": "crack_iT", "link": "https://stackoverflow.com/users/4178713/crack-it"}, "reply_to_user": {"reputation": 50953, "user_id": 1983495, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/aMDiK.jpg?s=128&g=1", "display_name": "Iharob Al Asimi", "link": "https://stackoverflow.com/users/1983495/iharob-al-asimi"}, "edited": false, "score": 1, "creation_date": 1524036335, "post_id": 49893457, "comment_id": 86802651, "body": "@Iharob atleast try to see logic before downvoting, I only corrected broken part of code"}], "tags": [], "owner": {"reputation": 1311, "user_id": 4178713, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PYjXH.jpg?s=128&g=1", "display_name": "crack_iT", "link": "https://stackoverflow.com/users/4178713/crack-it"}, "is_accepted": true, "score": 2, "last_activity_date": 1524037599, "last_edit_date": 1524037599, "creation_date": 1524035803, "answer_id": 49893457, "question_id": 49893357, "link": "https://stackoverflow.com/questions/49893357/how-to-stop-if-loop-once-array-has-a-number/49893457#49893457", "title": "how to stop if loop once array has a number", "body": "<p>Add <code>break</code> statement because once you found required value, you don't have to keep looping for <code>j</code></p>\n\n<pre><code>for (i=0; i&lt;3; i++)\n{\n  for (j=0; j&lt;20; j++)\n  { \n    if(a[j] &gt; inputarray[i])\n    {\n        outputarray[i] = a[j]; \n        break;\n    }\n  } \n} \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "is_accepted": false, "score": 1, "last_activity_date": 1524038123, "creation_date": 1524038123, "answer_id": 49894179, "question_id": 49893357, "link": "https://stackoverflow.com/questions/49893357/how-to-stop-if-loop-once-array-has-a-number/49894179#49894179", "title": "how to stop if loop once array has a number", "body": "<p>I would be much easier if you did not use a <code>for</code> loop (because you don't want to iterate over a given amount of values). If your loop depends on a condition use a <code>do-while</code>/<code>while</code> loop.</p>\n\n<pre><code>for (i = 0; i &lt; 3; i++) {\n    while (a[j] &lt;= inputarray[i])\n    {\n        j++;\n    }\n    outputarray[i] = a[j];\n}\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 9662687, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "user99", "link": "https://stackoverflow.com/users/9662687/user99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 49893457, "answer_count": 2, "score": -2, "last_activity_date": 1524038127, "creation_date": 1524035453, "last_edit_date": 1524035690, "question_id": 49893357, "link": "https://stackoverflow.com/questions/49893357/how-to-stop-if-loop-once-array-has-a-number", "title": "how to stop if loop once array has a number", "body": "<p>I need to create a program where user will input a number of integers and the program will output the fibonacci sequence number having the next larger number than the user input.\nfibonacci sequence as follows: </p>\n\n<pre><code>0,1,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1597,2584,4181,6765\n</code></pre>\n\n<p>Example:</p>\n\n<p>user inputs: <code>[1, 9, 22]</code>\noutput should be: <code>2, 13, 34</code></p>\n\n<p>I cant seem to make the if loop stop once it has already acquired a value because the output will always display 4181, 4181, 4181.\nMy code is as follows below:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;conio.h&gt;\n\nvoid main()\n{\n    int i, n, a[100];\n    int inputarray[3], j;\n    int outputarray[3];\n\n    a[0] = 0;\n    a[1] = 1;\n    for (i = 2; i &lt; 20; i++) {\n        a[i] = a[i-1] + a[i-2];\n    }\n\n    for (i = 0; i &lt; 20; i++) {\n        printf(\"%5d\",a[i]);\n    }\n\n    for (j = 0; j &lt; 3; j++) {\n        printf (\"\\nEnter numbers of input array:\");\n        scanf (\"%d\", &amp;inputarray[j]);\n    }\n\n    for (i = 0; i &lt; 3; i++) {\n        for (j = 0; j &lt; 20; j++) {\n            if (a[j] &gt; inputarray[i])\n                outputarray[i] = a[j];\n        }\n    }\n\n    for (i = 0; i &lt; 3; i++) {\n        printf(\"%5d\", outputarray[i]);\n    }\n    getch();\n}\n</code></pre>\n"}, {"tags": ["c", "arrays", "loops", "for-loop"], "comments": [{"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1524033476, "post_id": 49892745, "comment_id": 86800997, "body": "Check return value of input function calls <code>scanf()</code>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1524033485, "post_id": 49892745, "comment_id": 86801002, "body": "A good compiler should shout warnings or even errors at you with that code. The <a href=\"http://en.cppreference.com/w/c/io/fgets\" rel=\"nofollow noreferrer\"><code>fgets</code></a> function expects a pointer to the first element of an array of <i>characters</i> as the first argument, not a pointer to an <i>array</i> of characters."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 1, "creation_date": 1524033563, "post_id": 49892745, "comment_id": 86801058, "body": "Furthermore, what is the initial value of <code>e</code>? Hint: You <i>don&#39;t know</i>, because it&#39;s <i>indeterminate</i> (and seemingly random). Therefore using it as an array index will lead to <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\"><i>undefined behavior</i></a>, which makes any discussion or guessing about behavior useless."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 1, "creation_date": 1524033615, "post_id": 49892745, "comment_id": 86801089, "body": "Please upgrade to a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 361156, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1524033626, "post_id": 49892745, "comment_id": 86801097, "body": "Lastly, what is the range of valid indexes of an array of e.g. <code>40</code> elements? The top index is <i>not</i> <code>40</code>. Which makes the loop condition in the second loop wrong, if you&#39;re supposed to use <code>l</code> as an index into any of your arrays. Note that the initialization of <code>l</code> is, well, not initializing anything. Perhaps you should get a few beginners books, and start over from the beginning?"}], "answers": [{"tags": [], "owner": {"reputation": 33645, "user_id": 2630032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hQF09.jpg?s=128&g=1", "display_name": "Stephan Lechner", "link": "https://stackoverflow.com/users/2630032/stephan-lechner"}, "is_accepted": false, "score": 1, "last_activity_date": 1524034840, "last_edit_date": 1524034840, "creation_date": 1524034386, "answer_id": 49893059, "question_id": 49892745, "link": "https://stackoverflow.com/questions/49892745/printing-line-by-line-using-a-for-loop-then-scanning-to-another-in-c/49893059#49893059", "title": "Printing line by line using a for loop then scanning to another in c", "body": "<p>There are several issues like uninitialized variables (e.g. <code>e</code>, <code>l</code>),  reading in into a wrong data structure (<code>fgets(b,...</code> instead of <code>fgets(b[x],...</code>).</p>\n\n<p>See the following code fragment which probably helps you a step further.\nNote that I used <code>fgets</code> for reading in the answer; this allows you - in contrast to <code>scanf(\"%s\")</code>-  to enter more than one word as an answer (i.e. until you press \"enter\"):</p>\n\n<p>Hope it helps.</p>\n\n<pre><code> char b [40][250];\n char a1[40][250];\n\n FILE *fp;\n fp = fopen(\"quest.txt\", \"r\");\n\nint nrOfQuestions = 0;\nwhile (nrOfQuestions &lt; 40 &amp;&amp; fgets(b[nrOfQuestions], sizeof(b[0]), fp)) {\n    printf(\"%s\", b[nrOfQuestions]);\n    fgets(a1[nrOfQuestions],sizeof(b[0]), stdin);\n    nrOfQuestions++;\n}\n\nfor (int i=0;  i&lt;nrOfQuestions; i++) {\n    printf(\"q:%s a:%s\\n\", b[i], a1[i]);\n}\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 9595867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3adffe0e00fac75d6066142e5b44236c?s=128&d=identicon&r=PG&f=1", "display_name": "point5", "link": "https://stackoverflow.com/users/9595867/point5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1524034840, "creation_date": 1524033317, "last_edit_date": 1524034470, "question_id": 49892745, "link": "https://stackoverflow.com/questions/49892745/printing-line-by-line-using-a-for-loop-then-scanning-to-another-in-c", "title": "Printing line by line using a for loop then scanning to another in c", "body": "<p>In the array below i have 11 questions stored. I want each question to be asked one by one and then the answer copied to arrray ans1. Currently the while loop prints the whole file off at the same time. Can someone shed light on how i can use the for loop below the while loop to complete this? </p>\n\n<pre><code>  typedef struct{\n  char q[40][250];\n  char a[40][250];\n  } qa;\n\n  int main()\n  {   \n\n     char *b [40][250];\n     int w, e, r, t, k, l;\n     char a1[40][250];\n\n     FILE *fp;\n     fp = fopen(\"quest.txt\", \"r\");\n\n     while (fgets(b, sizeof(b), fp)) {\n           printf(\"%s\", b);\n           scanf(\"%s\",a1[1+]);\n     }\n\n     for(l&gt;=0;l&lt;=40;l++){\n     ;}\n</code></pre>\n"}, {"tags": ["c++", "c", "git", "cmake", "libgit2"], "comments": [{"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 1, "creation_date": 1524038535, "post_id": 49892597, "comment_id": 86803942, "body": "<code>How correctly to build and include library libgit2 in my project?</code> - Why do not read the project&#39;s <a href=\"https://github.com/libgit2/libgit2/blob/master/README.md#building-libgit2---using-cmake\" rel=\"nofollow noreferrer\">README</a> and follow it when building <code>libgit2</code>? As for using the package, link with installed <code>git2</code> library and include corresponded directories. Or, because <code>libgit2</code> provides <code>.pc</code> file, use <code>pkg_check_modules</code>, like <a href=\"https://stackoverflow.com/a/35476270/3440745\">my answer</a> describes."}, {"owner": {"reputation": 3860, "user_id": 5251059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93c9c608467b21bce1d709b56bf6d39d?s=128&d=identicon&r=PG&f=1", "display_name": "vre", "link": "https://stackoverflow.com/users/5251059/vre"}, "edited": false, "score": 0, "creation_date": 1524260895, "post_id": 49892597, "comment_id": 86916998, "body": "According to your last edits. Please try using absolute path names for libraries and include directories first. Later you can try to find out how to solve using other means. Second, does a library named git2.lib exists in the Debug folder? And if yes, when adding a <code>message(STATUS &quot;${CMAKE_CURRENT_BINARY_DIR}&quot;)</code> can its output + relative path to the library be resolved?"}, {"owner": {"reputation": 119, "user_id": 9662389, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cebf319b146a78022adee421c8e779b7?s=128&d=identicon&r=PG&f=1", "display_name": "igdev", "link": "https://stackoverflow.com/users/9662389/igdev"}, "reply_to_user": {"reputation": 3860, "user_id": 5251059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93c9c608467b21bce1d709b56bf6d39d?s=128&d=identicon&r=PG&f=1", "display_name": "vre", "link": "https://stackoverflow.com/users/5251059/vre"}, "edited": false, "score": 0, "creation_date": 1524300384, "post_id": 49892597, "comment_id": 86924470, "body": "@vre Thank you! :) The problem was that path to the library was incorrect."}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 9662389, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cebf319b146a78022adee421c8e779b7?s=128&d=identicon&r=PG&f=1", "display_name": "igdev", "link": "https://stackoverflow.com/users/9662389/igdev"}, "edited": false, "score": 0, "creation_date": 1524036706, "post_id": 49892710, "comment_id": 86802867, "body": "I&#39;ve made first way because in src folder are located many *.c files. This method removed the error about which I wrote above, but emerged were many new mistakes. For example: <code>Error C1083 Cannot open include file: &#39;git2&#47;sys&#47;features.h&#39;: No such file or directory\t Error C1083 Cannot open include file: &#39;common.h&#39;: No such file or directory\t</code> P.S. libgit2 is an opensource library. Her code can look <a href=\"https://github.com/libgit2/libgit2\" rel=\"nofollow noreferrer\">here</a>. I hope this can help resolve my problem."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 1, "creation_date": 1524038883, "post_id": 49892710, "comment_id": 86804167, "body": "Header <code>git2&#47;sys&#47;features.h</code> is generated when <code>libgit2</code> is configured by its <code>CMakeLists.txt</code>. Building the project from the <b>plain sources</b> isn&#39;t a wise choose. Instead, use CMake for build it, as described in its README."}, {"owner": {"reputation": 3860, "user_id": 5251059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93c9c608467b21bce1d709b56bf6d39d?s=128&d=identicon&r=PG&f=1", "display_name": "vre", "link": "https://stackoverflow.com/users/5251059/vre"}, "reply_to_user": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "edited": false, "score": 0, "creation_date": 1524039623, "post_id": 49892710, "comment_id": 86804616, "body": "@Tsyvarev Ah, now I see. I was mislead by the OPs first solution."}, {"owner": {"reputation": 119, "user_id": 9662389, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cebf319b146a78022adee421c8e779b7?s=128&d=identicon&r=PG&f=1", "display_name": "igdev", "link": "https://stackoverflow.com/users/9662389/igdev"}, "edited": false, "score": 0, "creation_date": 1524067108, "post_id": 49892710, "comment_id": 86824030, "body": "@vre I&#39;ve updated information about the problem. Please take a look."}, {"owner": {"reputation": 119, "user_id": 9662389, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cebf319b146a78022adee421c8e779b7?s=128&d=identicon&r=PG&f=1", "display_name": "igdev", "link": "https://stackoverflow.com/users/9662389/igdev"}, "edited": false, "score": 0, "creation_date": 1524254887, "post_id": 49892710, "comment_id": 86914565, "body": "@vre Today I&#39;ve fixed some problems, but emerged a new problem. Please take a look."}], "tags": [], "owner": {"reputation": 3860, "user_id": 5251059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93c9c608467b21bce1d709b56bf6d39d?s=128&d=identicon&r=PG&f=1", "display_name": "vre", "link": "https://stackoverflow.com/users/5251059/vre"}, "is_accepted": true, "score": 0, "last_activity_date": 1524088138, "last_edit_date": 1524088138, "creation_date": 1524033192, "answer_id": 49892710, "question_id": 49892597, "link": "https://stackoverflow.com/questions/49892597/build-libgit2-in-cmake-project/49892710#49892710", "title": "Build libgit2 in cmake project", "body": "<p>For CMake to correctly determine the linker language you need to add at least one source file to your <code>add_library</code> call not only the source directory.</p>\n\n<p>Adding souce files can be done either by calling</p>\n\n<pre><code>file(GLOB_RECURSE libgit2_src ../libgit2/src/*.cpp)\n</code></pre>\n\n<p>or </p>\n\n<pre><code>set(libgit2_src ../libgit2/src/file1.cpp ../libgit2/src/file2.cpp)\n</code></pre>\n\n<p>in your CMakeLists.txt while the latter is preferred (for reasons see <a href=\"https://stackoverflow.com/questions/1027247/is-it-better-to-specify-source-files-with-glob-or-each-file-individually-in-cmak\">here</a>).</p>\n\n<p><strong>Edit</strong>: I was somewhat mislead by the OPs initial solution. I was under the impression <code>libgit2</code> was his own library.</p>\n\n<p>You should <strong>not</strong> try to include the <code>libgit2</code> sources into your project.\nInstead build <code>libgit2</code> by the following sequence (you might need to adapt the path to <code>OpenSSL</code> and <code>ZLib</code> libraries or omit that) in <code>&lt;libgit2downloaddir&gt;</code>:</p>\n\n<pre><code>mkdir build\ncd build\ncmake .. -DCMAKE_INSTALL_PREFIX=/install/prefix -DZLIB_LIBRARY=/installed/zlib -DOPENSSL_SSL_LIBRARY=/install/libssl.a -DOPENSSL_CRYPRO_LIBRARY=installed/libcrypto.a\nmake install\n</code></pre>\n\n<p>As <code>libgit2</code> does not provide package config modules (git2-config.cmake or git2Config.cmake) in your project you need to do a</p>\n\n<pre><code>target_include_directories(younameit &lt;pathtoinstalledlibgit2includes&gt;)\ntarget_link_library(younameit &lt;fullpathto&gt;/libgit2.a)\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 9662389, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cebf319b146a78022adee421c8e779b7?s=128&d=identicon&r=PG&f=1", "display_name": "igdev", "link": "https://stackoverflow.com/users/9662389/igdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "accepted_answer_id": 49892710, "answer_count": 1, "score": 0, "last_activity_date": 1524254758, "creation_date": 1524032781, "last_edit_date": 1524254758, "question_id": 49892597, "link": "https://stackoverflow.com/questions/49892597/build-libgit2-in-cmake-project", "title": "Build libgit2 in cmake project", "body": "<p>I've next project tree:</p>\n\n<pre><code>&gt;googletest\n&gt;libgit2\n&gt;src\n&gt;tests\n</code></pre>\n\n<p>The code in main CMakeLists.txt:</p>\n\n<pre><code>cmake_minimum_required(VERSION 2.8)\nproject(project_name)\nadd_subdirectory(src)\nadd_subdirectory(tests)\n</code></pre>\n\n<p>The code CMakeLists.txt in src folder:</p>\n\n<pre><code>cmake_minimum_required(VERSION 2.8)\nproject(project_name)\n\nset(libgit2_src ../libgit2/src)\ninclude_directories(../libgit2 ../libgit2/include)\n\nadd_library(gitlib STATIC ${libgit2_src})\n\nadd_executable(project_name main.cpp)\ntarget_link_libraries(project_name gitlib)\n</code></pre>\n\n<p>When I attempting to generate the project, I'm getting next error:</p>\n\n<pre><code>CMake Error: CMake can not determine linker language for target: gitlib\n</code></pre>\n\n<p>How correctly to build and include library libgit2 in my project?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>In main CMakeLists.txt I've added next command:</p>\n\n<pre><code>cmake_minimum_required(VERSION 2.8)\n\nproject(project_name)\n\nadd_subdirectory(libgit2)\nadd_subdirectory(src)\nadd_subdirectory(tests)\n</code></pre>\n\n<p>After, I've changed the code CMakeLists.txt in src folder:</p>\n\n<pre><code>cmake_minimum_required(VERSION 2.8)\n\nproject(project_name)\n\npkg_check_modules(LIBGIT2 REQUIRED libgit2)\n\nset(LIBGIT2_LIBS_ABSOLUTE)\nforeach(lib ${LIBGIT2_LIBRARIES})\n    # Choose name of variable, which will contain result of `find_library`\n    # for specific library.\n    set(var_name LIBGIT2_${lib}_ABS)\n    # Search library under dirs, returned by pkg-config.\n    find_library(${var_name} ${lib} ${LIBGIT2_LIBRARY_DIR})\n    list(APPEND LIBGIT2_LIBS_ABSOLUTE ${${var_name}})\nendforeach()\n\ninclude_directories(${LIBGIT2_INCLUDE_DIRS})\n\nadd_executable(project_name main.cpp)\ntarget_link_libraries(project_name ${LIBGIT2_LIBS_ABSOLUTE}) \n</code></pre>\n\n<p>But when I configuring the project, I'm getting the error:</p>\n\n<pre><code>CMake Error at D:/Program/CMake/share/cmake-3.10/Modules/FindPkgConfig.cmake:590 (if):\n  if given arguments:\n\n    \"NOT\" \"DEFINED\" \"__pkg_config_checked_LIBGIT2\" \"OR\" \"__pkg_config_checked_LIBGIT2\" \"LESS\" \"OR\" \"NOT\" \"LIBGIT2_FOUND\" \"OR\" \"(\" \"NOT\" \"libgit2\" \"STREQUAL\" \"\" \"AND\" \"NOT\" \"\" \"STREQUAL\" \"REQUIRED;libgit2\" \")\" \"OR\" \"(\" \"libgit2\" \"STREQUAL\" \"\" \"AND\" \"NOT\" \"\" \"STREQUAL\" \"REQUIRED\" \")\"\n\n  Unknown arguments specified\nCall Stack (most recent call first):\n  src/CMakeLists.txt:5 (pkg_check_modules)\n</code></pre>\n\n<p>I do not understand how correctly to link and build this library to my project.</p>\n\n<p><strong>EDIT2</strong>\nI've built library libgit2 separately.\nAfter, I've changed the main CMakeLists.txt:</p>\n\n<pre><code>cmake_minimum_required(VERSION 3.10)\n\nproject(project_name)\n\nadd_subdirectory(src)\nadd_subdirectory(tests)\n</code></pre>\n\n<p>Also, I've changed CMakeLists.txt in src folder:</p>\n\n<pre><code>cmake_minimum_required(VERSION 3.10)\n\nproject(project_name)\n\nadd_executable(project_namemain.cpp)\n\ntarget_include_directories(project_name PUBLIC ../libgit2/include)\ntarget_link_libraries(project_name ../libgit2/build/Debug/git2)\n</code></pre>\n\n<p>I'm getting the project that configures and generate normally. \nBut when I starting build project I get the error: </p>\n\n<pre><code>fatal error LNK1104: cannot open file 'libgit2/build/Debug/git2.lib'\n</code></pre>\n\n<p>How to fix this error? I've tried different ways fix this error, but nothing succeeded.</p>\n"}, {"tags": ["c", "zig"], "comments": [{"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1524032239, "post_id": 49892119, "comment_id": 86800384, "body": "Did you create the tag <code>zig</code>? If so you might want to give it a short desciption in the wiki."}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1524032322, "post_id": 49892119, "comment_id": 86800412, "body": "I don&#39;t know about zig. But return 1 seems like the compiler would just replace the function call with 1."}, {"owner": {"reputation": 5469, "user_id": 7083401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eA15o.png?s=128&g=1", "display_name": "ice1000", "link": "https://stackoverflow.com/users/7083401/ice1000"}, "reply_to_user": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 1, "creation_date": 1524032630, "post_id": 49892119, "comment_id": 86800566, "body": "@KamiKaze Yes I did and the wiki edit is awaiting peer review."}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 1, "creation_date": 1524033295, "post_id": 49892119, "comment_id": 86800892, "body": "have you tried replacing the main function with something that is not deterministic at compile time?"}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1524033791, "post_id": 49892119, "comment_id": 86801182, "body": "...e.g. <code>int main() { int a; scanf(&quot;%d&quot;, a); return a;</code>. Now, the compiler cannot forsee/optimize the result of <code>main()</code>."}, {"owner": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1524034147, "post_id": 49892119, "comment_id": 86801420, "body": "Is it this <a href=\"https://ziglang.org/\" rel=\"nofollow noreferrer\">zig</a>?"}, {"owner": {"reputation": 5469, "user_id": 7083401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eA15o.png?s=128&g=1", "display_name": "ice1000", "link": "https://stackoverflow.com/users/7083401/ice1000"}, "reply_to_user": {"reputation": 16265, "user_id": 7478597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yBOIj.jpg?s=128&g=1", "display_name": "Scheff", "link": "https://stackoverflow.com/users/7478597/scheff"}, "edited": false, "score": 0, "creation_date": 1524034310, "post_id": 49892119, "comment_id": 86801527, "body": "Yes @Scheff, My edit to the tag wiki is awaiting review"}, {"owner": {"reputation": 5469, "user_id": 7083401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eA15o.png?s=128&g=1", "display_name": "ice1000", "link": "https://stackoverflow.com/users/7083401/ice1000"}, "reply_to_user": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "edited": false, "score": 0, "creation_date": 1524034372, "post_id": 49892119, "comment_id": 86801561, "body": "@KamiKaze Yes, I&#39;ve found this! The &quot;constexpr&quot; like functions are optimized! Thanks guys."}, {"owner": {"reputation": 26832, "user_id": 432, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c641a026e20b5457fdc69a1d9f256cc5?s=128&d=identicon&r=PG", "display_name": "andrewrk", "link": "https://stackoverflow.com/users/432/andrewrk"}, "edited": false, "score": 2, "creation_date": 1550606281, "post_id": 49892119, "comment_id": 96328019, "body": "Zig now supports this example and I&#39;ve updated my answer to reflect that."}], "answers": [{"tags": [], "owner": {"reputation": 26832, "user_id": 432, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c641a026e20b5457fdc69a1d9f256cc5?s=128&d=identicon&r=PG", "display_name": "andrewrk", "link": "https://stackoverflow.com/users/432/andrewrk"}, "is_accepted": true, "score": 9, "last_activity_date": 1550606247, "last_edit_date": 1550606247, "creation_date": 1533743932, "answer_id": 51751038, "question_id": 49892119, "link": "https://stackoverflow.com/questions/49892119/zig-translate-c-doesnt-translate-main-function/51751038#51751038", "title": "Zig &quot;translate c&quot; doesn&#39;t translate main function", "body": "<p>When this question was asked, translate-c did not yet support functions with unspecified parameters. This was visible by using <code>--verbose-cimport</code>:</p>\n\n<pre><code>test.c:1:5: warning: unsupported type: 'FunctionNoProto'\ntest.c:1:5: warning: unable to resolve prototype of function 'main'\n</code></pre>\n\n<p>In C, if you leave the parameters empty, it's not actually zero parameters, it's unspecified. You have to use <code>void</code> to mean \"no parameters\".</p>\n\n<p>So that's why the second example worked - because the parameter list was not empty.</p>\n\n<p>However as of <a href=\"https://github.com/ziglang/zig/commit/e280dce30f7a5d5cf6fc2001bac5e3918f8b5a39\" rel=\"noreferrer\">e280dce3</a>, Zig supports translating C functions with unspecified parameters, and the example from the question turns into this Zig code:</p>\n\n<pre><code>pub export fn main() c_int {\n    return 1;\n}\n</code></pre>\n"}], "owner": {"reputation": 5469, "user_id": 7083401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eA15o.png?s=128&g=1", "display_name": "ice1000", "link": "https://stackoverflow.com/users/7083401/ice1000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 752, "favorite_count": 0, "accepted_answer_id": 51751038, "answer_count": 1, "score": 3, "last_activity_date": 1550606247, "creation_date": 1524030647, "last_edit_date": 1524031227, "question_id": 49892119, "link": "https://stackoverflow.com/questions/49892119/zig-translate-c-doesnt-translate-main-function", "title": "Zig &quot;translate c&quot; doesn&#39;t translate main function", "body": "<p>I created a C file:</p>\n\n<pre><code>int main() {\n  return 1;\n}\n</code></pre>\n\n<p>I used Zig's <code>translate-c</code> command line option to generate a zig file, and I only get some global variable declarations like</p>\n\n<pre><code>pub const __GCC_ATOMIC_TEST_AND_SET_TRUEVAL = 1;\npub const __FLT16_MAX_EXP__ = 15;\npub const __BIGGEST_ALIGNMENT__ = 16;\npub const __SIZEOF_FLOAT__ = 4;\npub const __INT64_FMTd__ = c\"ld\";\npub const __STDC_VERSION__ = c_long(201112);\n... // and many\n</code></pre>\n\n<p>And no <code>main</code> function is found. But if I change the function name to <code>myFunction</code> like this:</p>\n\n<pre><code>int myFunction(int a) {\n  return a;\n}\n</code></pre>\n\n<p>A function appears when I re-generate it:</p>\n\n<pre><code>pub export fn myFunction(a: c_int) c_int {\n    return a;\n}\n</code></pre>\n\n<p>Am I missing something? What's the rule of zig's <code>translate-c</code> function?</p>\n"}, {"tags": ["c", "pic", "gpio", "led"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524032092, "post_id": 49892149, "comment_id": 86800308, "body": "Thanks for your answer. But I solved the problem. Here I add            <b>if(buttonState==1)            count++;</b>"}], "tags": [], "owner": {"reputation": 59, "user_id": 2765418, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001085962444/picture?type=large", "display_name": "Dominic Gibson", "link": "https://stackoverflow.com/users/2765418/dominic-gibson"}, "is_accepted": false, "score": 1, "last_activity_date": 1524030828, "creation_date": 1524030828, "answer_id": 49892149, "question_id": 49892035, "link": "https://stackoverflow.com/questions/49892035/using-ccs-toggle-led-with-button/49892149#49892149", "title": "Using CCS Toggle LED With Button", "body": "<p>There is a problem in your logic. You have two changes while pressing the button. The first change is from 0 to 1 (pressing) and the second change is from 1 to 0 (releasing the button).</p>\n\n<p>Try something like:</p>\n\n<pre><code>if(lastButtonState == 0 &amp;&amp; buttonState == 1)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524038516, "post_id": 49892638, "comment_id": 86803923, "body": "Actually I checked the code on my controller. It end up with same result :D. Now initially it is high, after I press the button it goes low. And only I press to the button it goes high."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "reply_to_user": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524039877, "post_id": 49892638, "comment_id": 86804763, "body": "@iraquois Can you describe active-low or high of button and LED?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "reply_to_user": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524039966, "post_id": 49892638, "comment_id": 86804816, "body": "@iraquois If the code is initially high and then becomes working normally, then perhaps you didn&#39;t initialize the values buttonState and lastButtonState  as 0 starting your program. If you don&#39;t initialize, they may have arbitrary values."}, {"owner": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524040123, "post_id": 49892638, "comment_id": 86804916, "body": "my button is connected to 5v dc source and it is connected to the ground with 10k. I took the input from between button and 10k. and output from controller."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "reply_to_user": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524040250, "post_id": 49892638, "comment_id": 86804995, "body": "So when you press the button, buttonState = 1?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "reply_to_user": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524040508, "post_id": 49892638, "comment_id": 86805144, "body": "For a moment it is 1 and then it goes 0 ?"}, {"owner": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524040526, "post_id": 49892638, "comment_id": 86805152, "body": "what i didnt understand is it shouldn&#39;t execute first if statement. Because initially buttonState and lastButtonState are equal."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "reply_to_user": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524040709, "post_id": 49892638, "comment_id": 86805267, "body": "This could be because mechanical buttons have debounce. So when you press a button, you see the voltage jumping from 1 to 0 over and over a couple times. Then it settles on 1. Is that what you are seeing? If you see it settle to 0, then you have a hardware problem. (Or software in reading button input)"}, {"owner": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "edited": false, "score": 0, "creation_date": 1524040936, "post_id": 49892638, "comment_id": 86805416, "body": "Yes I think there is no problem with your code. Then I will handle with it mechanically. :) Thanks again. Discussion was very helpful."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "is_accepted": true, "score": 0, "last_activity_date": 1524032942, "creation_date": 1524032942, "answer_id": 49892638, "question_id": 49892035, "link": "https://stackoverflow.com/questions/49892035/using-ccs-toggle-led-with-button/49892638#49892638", "title": "Using CCS Toggle LED With Button", "body": "<p>Is your button active-high or active-low ? Is your LED powered active-high or active-low? You need to give that information. \nI'll give an explanation assuming LED is powered when output is low. Then what follows is, assuming button is active-low, when your button is not pressed, </p>\n\n<pre><code>buttonState = 1;\n</code></pre>\n\n<p>So, since </p>\n\n<pre><code>lastButtonState = 0;\n</code></pre>\n\n<p>(at the start of the program, I'm assuming)</p>\n\n<p>You will enter the if clause:</p>\n\n<pre><code>if(buttonState != lastButtonState){\n...\n}\n</code></pre>\n\n<p>This will increase your counter by one and make <code>lastButtonState = buttonState;</code></p>\n\n<p>Since <code>count%2</code> will be <code>1</code>, your pin will be <code>output_low(pin_b0);</code>... So, at the start of your program, your LED will be ON.</p>\n\n<p>If you then press the button, </p>\n\n<pre><code>buttonState=0;\n</code></pre>\n\n<p>will happen and you will enter the if() clause, again. This will increase your counter by one. And then:</p>\n\n<pre><code>count%2 = 0;\n</code></pre>\n\n<p>Will happen. So, you will have</p>\n\n<pre><code>output_high(pin_b0);\n</code></pre>\n\n<p>As you can see, when you press the button, your LED will go off. And on when you release the button, your LED will go on Try this:</p>\n\n<pre><code>while(1){\n   int buttonState=input_state(pin_a0);\n\n   if(buttonState != lastButtonState){\n   lastButtonState=buttonState;\n\n      if(buttonState == 1){\n          output_high(pin_b0); // LED is off\n      }\n      else\n          output_low(pin_b0); // LED is on\n   }\ndelay_ms(50);\n}\n</code></pre>\n\n<p>You don't need the counter.</p>\n\n<p>EDIT:</p>\n\n<p>I see you have made this addition to your code:</p>\n\n<pre><code>if(buttonState==1) \n   count++;\n</code></pre>\n\n<p>This works. Yet is harder to understand. Try writing something easier to read.</p>\n"}], "owner": {"reputation": 1, "user_id": 9662321, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "iraquois", "link": "https://stackoverflow.com/users/9662321/iraquois"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 688, "favorite_count": 0, "accepted_answer_id": 49892638, "answer_count": 2, "score": -1, "last_activity_date": 1612576855, "creation_date": 1524030287, "last_edit_date": 1612576855, "question_id": 49892035, "link": "https://stackoverflow.com/questions/49892035/using-ccs-toggle-led-with-button", "title": "Using CCS Toggle LED With Button", "body": "<p>I didn't understand what is wrong with my code. Here what I am trying to do is toggle a led when I press button. And I count my button hits with <code>int count;</code>.\nIf the count number is even LED is high and else LED is low. But when I upload this program, LED stays on. And off only while I hold the button.</p>\n<pre><code>while(1){\nint buttonState=input_state(pin_a0);\n\n   if(buttonState != lastButtonState){\n   count++;\n   lastButtonState=buttonState;\n     \n      if(count%2==0){\n      output_high(pin_b0);\n      }\n      else\n      output_low(pin_b0);\n}\ndelay_ms(50);\n}\n</code></pre>\n"}, {"tags": ["c", "signals"], "comments": [{"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 1, "creation_date": 1524024980, "post_id": 49891076, "comment_id": 86797777, "body": "<code>exit(0);</code> in the handler caused the process to terminate there itself, remove it if not required."}, {"owner": {"reputation": 968, "user_id": 484560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1226dc0cb4aeb50e8b9922c0931bedd3?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/484560/mark"}, "edited": false, "score": 0, "creation_date": 1524025042, "post_id": 49891076, "comment_id": 86797795, "body": "The Linux and FreeBSD projects have expended a great amount of effort towards documenting many standard platform calls.  I would recommend you check out their <code>man</code> pages.  <code>man 2 signal</code>  <a href=\"https://www.systutorials.com/docs/linux/man/2-signal/\" rel=\"nofollow noreferrer\">systutorials.com/docs/linux/man/2-signal</a>"}, {"owner": {"reputation": 648, "user_id": 5694959, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TN18H3fTni4/AAAAAAAAAAI/AAAAAAAAAA8/HH8MErbPvAI/photo.jpg?sz=128", "display_name": "Monk", "link": "https://stackoverflow.com/users/5694959/monk"}, "edited": false, "score": 1, "creation_date": 1524027574, "post_id": 49891076, "comment_id": 86798514, "body": "ctrl + D is not SIGINT, SIGINT is Ctrl +c."}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 2, "creation_date": 1524030273, "post_id": 49891076, "comment_id": 86799497, "body": "By default Ctrl+D is an end-of-file indicator when reading from terminal. It has nothing to do with signals."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1524035534, "post_id": 49891076, "comment_id": 86802214, "body": "If you want to change the interrupt character, use termios, not signals."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524026093, "post_id": 49891156, "comment_id": 86798070, "body": "I tried your proposed solution, but now all that has changed is that it takes two attempts of CTRL+D to exit the program, and CTRL+C still has no functionality, even outside of the program."}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "reply_to_user": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524026527, "post_id": 49891156, "comment_id": 86798209, "body": "The Handler is set for signal no <code>2</code> or <code>SIGINT</code> i.e when you pressed <code>CTRL+C</code> key, it goes to <code>ctrlD</code> function &amp; there if you press once again <code>CTRL+C</code> it should terminate and its terminating because default action(<code>SIG_DFL</code>) of SIGINT is terminate the process, as you can see in <code>man 7 signal</code> . Which part you didn&#39;t get ?"}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "reply_to_user": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524026855, "post_id": 49891156, "comment_id": 86798298, "body": "I added one statement in <code>ctrlD</code> function, check how many times that <code>printf</code> statement gets printed."}, {"owner": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524027300, "post_id": 49891156, "comment_id": 86798420, "body": "This doesn&#39;t seem to be doing the trick. Upon hitting CTRL+C, it simply prints ^C among the lines of Hello, and the CTRL+D needs to be pressed twice to stop the program. Then upon calling other programs I have written, I must use CTRL+D to terminate them while CTRL+C has no effects. I&#39;m sorry if I&#39;m missing something here, but I just want to be sure you/others know precisely what is happening on my end."}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "reply_to_user": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524027505, "post_id": 49891156, "comment_id": 86798488, "body": "<i>I must use <code>CTRL+D</code> to terminate them ?</i> <code>CTRl+D</code> is not any <code>signal</code> &amp; you set the handler for <code>CTRl+C</code> not for <code>CTRL+D</code>"}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "reply_to_user": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524027661, "post_id": 49891156, "comment_id": 86798542, "body": "pressing <code>CRL+D</code> means you are indicating its <code>EOF(End of File)</code>, its not any signal.  Run <code>kill -l</code> on command prompt, it will list all possible signals."}, {"owner": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524027705, "post_id": 49891156, "comment_id": 86798552, "body": "Yes, that is correct. The assignment ask that upon user typing CTRL+D, the program will terminate. How do I go about approaching this? And how can I restore my CTRL+C to the way it should be?"}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "reply_to_user": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524028251, "post_id": 49891156, "comment_id": 86798744, "body": "your second question <i>how can I restore my CTRL+C to the way it should be?</i> I answered above already. About your first question, <i>until <code>CTRL+D</code> is not pressed what you want to do ?</i>"}, {"owner": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524028401, "post_id": 49891156, "comment_id": 86798799, "body": "The answer you&#39;ve provided is not working for me. Both with this program specifically and outside of it, CTRL+C no longer works and I am unsure why. I must use CTRL+D to terminate any of my programs."}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "reply_to_user": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "edited": false, "score": 0, "creation_date": 1524028816, "post_id": 49891156, "comment_id": 86798952, "body": "I edited my answer regarding your last point @jmglynn It might helps you, read the comments in the code properly."}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1524032121, "post_id": 49891156, "comment_id": 86800318, "body": "<code>getchar()</code> returns <code>int</code> (not <code>char</code>) by intention!"}, {"owner": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1524032333, "post_id": 49891156, "comment_id": 86800420, "body": "As you now changed <code>ch</code> to be an <code>int</code>, you need to also adjust the call to <code>printf()</code> <code>ch</code>."}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "reply_to_user": {"reputation": 66473, "user_id": 694576, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/PpOGj.jpg?s=128&g=1", "display_name": "alk", "link": "https://stackoverflow.com/users/694576/alk"}, "edited": false, "score": 0, "creation_date": 1524032523, "post_id": 49891156, "comment_id": 86800512, "body": "ohh.. my bad @alk"}], "tags": [], "owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "is_accepted": false, "score": 0, "last_activity_date": 1524032492, "last_edit_date": 1524032492, "creation_date": 1524025438, "answer_id": 49891156, "question_id": 49891076, "link": "https://stackoverflow.com/questions/49891076/how-to-restore-original-signal-handling-properties-in-c/49891156#49891156", "title": "How to restore original signal handling properties in C", "body": "<p>Its because of <code>exit(0)</code> statement in the handler, when <code>SIGINT</code> is raised, handler <code>strlD</code> gets called and you might thinking why <code>signal(SIGINT,SIG_DFL)</code> didn't work ?  Actually it works. But your main process <code>a.out</code> get terminated successfully there itself by calling <code>exit(0)</code>. remove <code>exit(0)</code> if you want to restore the behavior of <code>SIGINT</code>.</p>\n\n<pre><code>#include &lt;unistd.h&gt; \n#include &lt;stdio.h&gt; \n#include &lt;termios.h&gt; \n#include &lt;signal.h&gt; \n#include &lt;stdlib.h&gt;\nvoid ctrlD(int sig){ \n        //printf(\"CTRL+C pressed\\n\");/* just to observe I added one printf\n                   statement, Ideally there shouldn't be any printf here */\n        signal(SIGINT, SIG_DFL);/*restoring back to original action */\n}\nint main(){\n        signal(SIGINT, ctrlD);/*1st time when CTRL+C pressed, handler ctrlD gets called */\n        while(1) {\n                printf(\"Hello\\n\");\n                sleep(5);\n        }\n        return 0;\n}\n</code></pre>\n\n<p>Also its advisable to use <code>sigaction()</code> instead of <code>signal()</code> as told here  <a href=\"https://stackoverflow.com/questions/231912/what-is-the-difference-between-sigaction-and-signal\">What is the difference between sigaction and signal?</a> . Read <code>man 2 sigaction</code> and <code>man 2 exit</code> to check what <code>exit(0)</code> means.</p>\n\n<p>Also this <a href=\"https://stackoverflow.com/questions/16891019/how-to-avoid-using-printf-in-a-signal-handler\">How to avoid using printf in a signal handler?</a></p>\n\n<p><strong>Edit</strong> :</p>\n\n<pre><code>void ctrlD(int sig){\n        /* printf(\"CTRL+C pressed \\n\"); */\n        signal(SIGINT, SIG_DFL); /* only one time CTRL+C works\n                               after that SIG_DFL will terminate whole process */\n}\nint main(){\n        signal(SIGINT, ctrlD); /* if you press CTRL+C then it will go to handler\n                                and terminate */\n        int ch;\n        while( ((ch = getchar())!=EOF) ) { /* wait or read char until CTrl+D is not pressed  */\n                printf(\"Hello : %d \\n\",ch);/* ASCII equivalent of char */\n        }\n        return 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34566, "user_id": 1475978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CUdQt.png?s=128&g=1", "display_name": "Nominal Animal", "link": "https://stackoverflow.com/users/1475978/nominal-animal"}, "is_accepted": false, "score": 0, "last_activity_date": 1524028939, "creation_date": 1524028939, "answer_id": 49891733, "question_id": 49891076, "link": "https://stackoverflow.com/questions/49891076/how-to-restore-original-signal-handling-properties-in-c/49891733#49891733", "title": "How to restore original signal handling properties in C", "body": "<p>If you write a program to explore signals, it is much better to write it <em>carefully</em>, using proper POSIX interfaces (<a href=\"http://man7.org/linux/man-pages/man2/sigaction.2.html\" rel=\"nofollow noreferrer\"><code>sigaction()</code></a> instead of <code>signal()</code>), and avoiding undefined behaviour (using non-<a href=\"http://man7.org/linux/man-pages/man7/signal-safety.7.html\" rel=\"nofollow noreferrer\">async-signal safe functions</a> in a signal handler).</p>\n\n<p>Consider, for example, the following program:</p>\n\n<pre><code>#define _POSIX_C_SOURCE 200809L\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;time.h&gt;\n#include &lt;errno.h&gt;\n\nstatic volatile sig_atomic_t  sigint_count = 0;\n\nstatic void catch_sigint(int signum)\n{\n    if (signum == SIGINT)\n        sigint_count++;\n}\n\nstatic int install_sigint(void)\n{\n    struct sigaction  act;\n\n    memset(&amp;act, 0, sizeof act);\n    sigemptyset(&amp;act.sa_mask);\n\n    act.sa_handler = catch_sigint;\n    act.sa_flags = 0;\n\n    if (sigaction(SIGINT, &amp;act, NULL) == -1)\n        return errno;\n\n    return 0;\n}\n\nstatic int install_default(const int signum)\n{\n    struct sigaction  act;\n\n    memset(&amp;act, 0, sizeof act);\n    sigemptyset(&amp;act.sa_mask);\n\n    act.sa_handler = SIG_DFL;\n    act.sa_flags = 0;\n\n    if (sigaction(signum, &amp;act, NULL) == -1)\n        return errno;\n\n    return 0;\n}\n\nint main(void)\n{\n    struct timespec  duration;\n    int              result;\n\n    if (install_sigint()) {\n        fprintf(stderr, \"Cannot install SIGINT handler: %s.\\n\", strerror(errno));\n        return EXIT_FAILURE;\n    }\n\n    duration.tv_sec = 5;\n    duration.tv_nsec = 0; /* 1/1000000000ths of a second. Nine zeroes. */\n\n    printf(\"Sleeping for %d seconds.\\n\", (int)duration.tv_sec);\n    fflush(stdout);\n    while (1) {\n\n        result = nanosleep(&amp;duration, &amp;duration);\n        if (!result)\n            break;\n\n        if (errno != EINTR) {\n            fprintf(stderr, \"nanosleep() failed: %s.\\n\", strerror(errno));\n            return EXIT_FAILURE;\n        }\n\n        /* nanosleep was interrupted by a delivery of a signal. */\n\n        if (sigint_count &gt;= 3) {\n            /* Ctrl+C pressed three or more times. */\n\n            if (install_default(SIGINT) == -1) {\n                fprintf(stderr, \"Cannot revert SIGINT to the default handler: %s.\\n\", strerror(errno));\n                return EXIT_FAILURE;\n            }\n\n            printf(\"SIGINT has been reverted to the default handler.\\n\");\n            fflush(stderr);\n        }\n    }\n\n    if (sigint_count &gt; 0)\n        printf(\"You pressed Ctrl+C %d time%s.\\n\", (int)sigint_count, (sigint_count &gt; 1) ? \"s\" : \"\");\n    else\n        printf(\"You did not press Ctrl+C at all.\\n\");\n\n    return EXIT_SUCCESS;\n}\n</code></pre>\n\n<p>The <code>#define</code> tells your C library (glibc in particular) that you want POSIX.1-2008 (and later) features from it.</p>\n\n<p>The <code>INT</code> signal handler only increments a <code>volatile sig_atomic_t</code> counter. Note that this type may have a very small range it can represent; 0 to 127, inclusive, should be safe.</p>\n\n<p>The main program waits using the POSIX <a href=\"http://man7.org/linux/man-pages/man2/nanosleep.2.html\" rel=\"nofollow noreferrer\"><code>nanosleep()</code></a> function. On some systems, <code>sleep()</code> may be implemented via the <code>SIGALRM</code> function, so it is better avoided when using signals otherwise; <code>nanosleep()</code> does not interfere with signals like that at all. Plus, <code>nanosleep()</code> can return the amount of time remaining, if it is interrupted by a signal delivery.</p>\n\n<p>In the main loop, <code>nanosleep()</code> will return 0, if it has slept the entire interval (but note that it may not update the remaining time to 0 in this case). If it is interrupted by the delivery of a signal, it will return <code>-1</code> with <code>errno == EINTR</code>, and the remaining time updated. (The first pointer is to the duration of the sleep, and the second is to where the remaining time should be stored. You can use the same structure for both.)</p>\n\n<p>Normally, the main loop does only one iteration. It can do more than one iteration, if it is interrupted by the delivery of a signal.</p>\n\n<p>When the main loop detects that <code>sigint_count</code> is at least three, i.e. it has received at least three <code>INT</code> signals, it resets the signal handler back to default.</p>\n\n<p>(Note that both the <code>memset()</code> and the <code>sigemptyset()</code> are important when clearing the <code>struct sigaction</code> structure. The <code>memset()</code> ensures that future code is backwards compatible with older code, by ensuring even padding fields are cleared. And <code>sigemptyset()</code> is the safe way to clear the signal mask (set of signals blocked while the handler runs).)</p>\n\n<p>(In theory, <code>memset()</code> is not async-signal-safe, while both <code>sigemptyset()</code> and <code>sigaction()</code> are. This is why I reset the signal handler in the main program, and not in the signal handler.)</p>\n\n<p>If you want to print from a signal handler, you need to use low-level I/O, because <code>&lt;stdio.h&gt;</code> functions are not async-signal safe. For example, you can use the following function to print strings to standard output:</p>\n\n<pre><code>static int wrerr(const char *p)\n{\n    const int  saved_errno = errno;\n    int        retval = 0;\n\n    if (p) {\n        const char *q = p;\n        ssize_t     n;\n\n        while (*q)\n            q++;\n\n        while (p &lt; q) {\n            n = write(STDERR_FILENO, p, (size_t)(q - p));\n            if (n &gt; 0)\n                p += n;\n            else\n            if (n != -1) {\n                retval = EIO;\n                break;\n            } else\n            if (errno != EINTR) {\n                retval = errno;\n                break;\n            }\n        }\n    }\n\n    errno = saved_errno;\n    return retval;\n}\n</code></pre>\n\n<p>The above <code>wrerr()</code> function is async-signal safe (because it only uses async-signal safe functions itself), and it even keeps <code>errno</code> unchanged. (Many guides forget to mention that it is quite important for a signal handler to keep <code>errno</code> unchanged. Otherwise, when a function is interrupted by a signal handler, and that signal handler modifies <code>errno</code>, the original function will return <code>-1</code> to indicate an error, but then <code>errno</code> is no longer <code>EINTR</code>!)</p>\n\n<p>You can just use <code>wrerr(\"INT signal!\\n\")</code> if you want. The return value from <code>wrerr()</code> is zero if the write was successful, and an errno error code otherwise. It ignores interrupts itself.</p>\n\n<p>Do note that you should not mix <code>stderr</code> output via <code>fprintf()</code> or other <code>&lt;stdio.h&gt;</code> functions with the above (except perhaps for printing error messages when the program aborts). Mixing them is not undefined behaviour, it just may yield surprising results, like <code>wrerr()</code> output appearing in the midst of a <code>fprintf(stderr,...)</code> output.</p>\n"}, {"comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1524047806, "post_id": 49897306, "comment_id": 86810339, "body": "Your answer could be improved by also setting <code>sa_handler</code> or <code>sa_sigaction</code> in the <code>struct sigaction</code> you&#39;re using."}], "tags": [], "owner": {"reputation": 648, "user_id": 5694959, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TN18H3fTni4/AAAAAAAAAAI/AAAAAAAAAA8/HH8MErbPvAI/photo.jpg?sz=128", "display_name": "Monk", "link": "https://stackoverflow.com/users/5694959/monk"}, "is_accepted": false, "score": 3, "last_activity_date": 1524052071, "last_edit_date": 1524052071, "creation_date": 1524047051, "answer_id": 49897306, "question_id": 49891076, "link": "https://stackoverflow.com/questions/49891076/how-to-restore-original-signal-handling-properties-in-c/49897306#49897306", "title": "How to restore original signal handling properties in C", "body": "<p>If your intention is to restore signal's default behavior after executing handler then, pass SA_RESETHAND flag to sa_flags while registering signal action. For example.</p>\n\n<pre><code>struct sigaction act;\nmemset(&amp;act, 0, sizeof(struct sigaction));\nact.sa_flags = SA_RESETHAND;\nact.sa_handler = some_handler;\nsigaction(SIGINT, &amp;act, NULL);\n</code></pre>\n\n<p>From <a href=\"http://man7.org/linux/man-pages/man2/sigaction.2.html\" rel=\"nofollow noreferrer\">sigaction()</a> man</p>\n\n<blockquote>\n  <p>SA_RESETHAND</p>\n  \n  <p>Restore the signal action to the default upon entry to the signal handler.  This flag is  meaningful  only  when\n  establishing a signal handler.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "is_accepted": true, "score": 0, "last_activity_date": 1524100062, "creation_date": 1524100062, "answer_id": 49911160, "question_id": 49891076, "link": "https://stackoverflow.com/questions/49891076/how-to-restore-original-signal-handling-properties-in-c/49911160#49911160", "title": "How to restore original signal handling properties in C", "body": "<p>Thank you everyone who contributed to this question. The resources provided/linked were tremendously helpful in learning more about signals (and that EOF isn't a signal), among the other wealth of information provided. </p>\n\n<p>After some more research, I found out that somehow, either through some accidental bash command gone awry, or perhaps the program posted in my original question itself, I had altered the key mappings for my terminal's stty settings. If anyone finds themselves in this oddly specific situation in the future, I hope this can be of help, as it is what fixed my problem:</p>\n\n<p>Enter the command <code>$ stty -a</code> to see all of your terminals settings, specifically the \"cchars\" section.</p>\n\n<p>I then saw the reversal, and fixed it like so:</p>\n\n<pre><code>$ stty intr ^C\n$ stty eof ^D\n</code></pre>\n\n<p>Then you can run <code>$ stty -a</code> once again to see that the changes have properly taken effect. Once again, thanks everyone.</p>\n"}], "owner": {"reputation": 21, "user_id": 7670105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3016bea7ce72f58796fe8e5517c511d1?s=128&d=identicon&r=PG&f=1", "display_name": "jmglynn", "link": "https://stackoverflow.com/users/7670105/jmglynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1490, "favorite_count": 0, "accepted_answer_id": 49911160, "answer_count": 4, "score": 1, "last_activity_date": 1524100062, "creation_date": 1524024842, "last_edit_date": 1524063057, "question_id": 49891076, "link": "https://stackoverflow.com/questions/49891076/how-to-restore-original-signal-handling-properties-in-c", "title": "How to restore original signal handling properties in C", "body": "<p>Tried my best to figure this out on my own, but I really do not want to continue tampering with things that I do not fully understand. So for a programming assignment I have to do in C, I need to terminate a program upon the user entering <kbd>CTRL</kbd>+<kbd>D</kbd> key stroke via a terminal. I tried to isolate that functionality in a smaller test function, but now my <kbd>CTRL</kbd>+<kbd>D</kbd> behaves as my <kbd>CTRL</kbd>+<kbd>C</kbd> and <kbd>CTRL</kbd>+<kbd>C</kbd> does not have any effect, even outside of the program when it finishes executing. This is the program that caused this change:</p>\n\n<pre><code>#include &lt;unistd.h&gt; \n#include &lt;stdio.h&gt; \n#include &lt;termios.h&gt; \n#include &lt;signal.h&gt; \n#include &lt;stdlib.h&gt;\n\nvoid ctrlD(int sig){ \n  printf(\"\\n\");\n  signal(SIGINT, SIG_DFL);\n  exit(0); \n}\n\nint main(){\n  signal(SIGINT, ctrlD);\n  while(1) {\n    printf(\"Hello\\n\");\n    sleep(5);\n  }\n}\n</code></pre>\n\n<p>The line <code>signal(SIGINT, SIG_DFL);</code> was added afterward upon realizing my <kbd>CTRL</kbd>+<kbd>C</kbd> no longer worked. I thought it would return the keystrokes to their original functionalities, but to no avail. What do I do to get back the original functionalities while also making this program work with <kbd>CTRL</kbd>+<kbd>D</kbd>?</p>\n\n<p>***EDIT: This question seems to have gone off the rails a bit. I get now that <kbd>Ctrl</kbd>+<kbd>D</kbd> is not a signal. Nonetheless, I no longer have the functionality of <kbd>Ctrl</kbd>+<kbd>C</kbd> anymore when attempting to use it in my MAC OS terminal, and instead <kbd>Ctrl</kbd>+<kbd>D</kbd> seems to have that exact functionality. HOW exactly can I return each to have the functionality that they had before I went on this haphazard journey? </p>\n"}, {"tags": ["c", "http", "curl", "libcurl", "getopt"], "comments": [{"owner": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1524021833, "post_id": 49890560, "comment_id": 86796986, "body": "Does <code>get()</code> work if you just call it with a hard-coded URL string?  If so, then people just need to look at the <code>getopt</code> code.  If not, then the <code>getopt</code> stuff is unnecessary clutter (for the problem you&#39;re having).  Note that you pass in a <code>res</code> and a <code>curl*</code>, but updating those within the function doesn&#39;t help with getting them out of the <code>get()</code> function since C passes arguments by value. In other words, those arguments are useless to <code>get()</code>."}, {"owner": {"reputation": 13, "user_id": 7595103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1da6f75fcbf650b332aec245ba6ead9?s=128&d=identicon&r=PG&f=1", "display_name": "pkitsos", "link": "https://stackoverflow.com/users/7595103/pkitsos"}, "reply_to_user": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1524022406, "post_id": 49890560, "comment_id": 86797118, "body": "@MichaelBurr Yes, if I hard code the url string under case &#39;g&#39; the HTTP GET request works properly."}, {"owner": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1524022431, "post_id": 49890560, "comment_id": 86797124, "body": "What is the command line you&#39;re testing?"}, {"owner": {"reputation": 13, "user_id": 7595103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1da6f75fcbf650b332aec245ba6ead9?s=128&d=identicon&r=PG&f=1", "display_name": "pkitsos", "link": "https://stackoverflow.com/users/7595103/pkitsos"}, "reply_to_user": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1524022617, "post_id": 49890560, "comment_id": 86797175, "body": "@MichaelBurr <b>./test -g</b> works with hardcoded url. When I pass the url I use <b>./test -g --url &#39;<a href=\"http://localhost:8000\" rel=\"nofollow noreferrer\">localhost:8000</a>&#39;</b> and <b>./test -g --url &quot;<a href=\"http://localhost:8000\" rel=\"nofollow noreferrer\">localhost:8000</a>&quot;</b>"}, {"owner": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1524022717, "post_id": 49890560, "comment_id": 86797205, "body": "What is the command line you&#39;re using to test with a URL on it?"}, {"owner": {"reputation": 13, "user_id": 7595103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1da6f75fcbf650b332aec245ba6ead9?s=128&d=identicon&r=PG&f=1", "display_name": "pkitsos", "link": "https://stackoverflow.com/users/7595103/pkitsos"}, "reply_to_user": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1524022896, "post_id": 49890560, "comment_id": 86797251, "body": "@MichaelBurr I put http:// before localhost but stack overflow is dropping it off. Not sure if that&#39;s what it does in my program too but the print statement shows the correct url entry under case &#39;u&#39;"}, {"owner": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 3, "creation_date": 1524024155, "post_id": 49890560, "comment_id": 86797560, "body": "The problem is that you put the <code>-g</code> option before the <code>--url</code> option so <code>get()</code> is called before the url is obtained.  Try: <code>.&#47;test --url &quot;whatever&quot; -g</code>"}, {"owner": {"reputation": 13, "user_id": 7595103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1da6f75fcbf650b332aec245ba6ead9?s=128&d=identicon&r=PG&f=1", "display_name": "pkitsos", "link": "https://stackoverflow.com/users/7595103/pkitsos"}, "reply_to_user": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1524024469, "post_id": 49890560, "comment_id": 86797638, "body": "@MichaelBurr When I use that format I get &#39;Could not connect to server&#39;"}, {"owner": {"reputation": 310760, "user_id": 12711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c330bdee507c95c603a93ca91d9145a9?s=128&d=identicon&r=PG", "display_name": "Michael Burr", "link": "https://stackoverflow.com/users/12711/michael-burr"}, "edited": false, "score": 0, "creation_date": 1524024847, "post_id": 49890560, "comment_id": 86797738, "body": "You&#39;re saying that:  <code>.&#47;test --url &quot;hxxp:&#47;&#47;localshot:8000&quot; -g</code> returns the error &#39;Could not connect to server&#39;, but if you hard-code the <code>get()</code> call as <code>get(&quot;hxxp:&#47;&#47;localhost:8000&quot;, curl, res);</code> it works (where &quot;hxxp&quot; is really &quot;http&quot; in both cases)?  If that&#39;s the case I&#39;m not sure what&#39;s going on - I&#39;m not at a system that will build a Curl app at the moment, so someone else might need to help with this part."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7595103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1da6f75fcbf650b332aec245ba6ead9?s=128&d=identicon&r=PG&f=1", "display_name": "pkitsos", "link": "https://stackoverflow.com/users/7595103/pkitsos"}, "edited": false, "score": 0, "creation_date": 1524190573, "post_id": 49896246, "comment_id": 86881536, "body": "Thanks for the response, I ended up getting it to work that way as well. Could you explain why that is or how I could make it accept the URL after the verb flag?"}, {"owner": {"reputation": 57, "user_id": 8939186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ihHaV.png?s=128&g=1", "display_name": "nakarthikeya", "link": "https://stackoverflow.com/users/8939186/nakarthikeya"}, "reply_to_user": {"reputation": 13, "user_id": 7595103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1da6f75fcbf650b332aec245ba6ead9?s=128&d=identicon&r=PG&f=1", "display_name": "pkitsos", "link": "https://stackoverflow.com/users/7595103/pkitsos"}, "edited": false, "score": 0, "creation_date": 1525424824, "post_id": 49896246, "comment_id": 87359666, "body": "in case &#39;g&#39;:, you are calling get() function which ignores rest of arguments (after get() call, rest of arguments will be processed). Solution: process all arguments passed before you call get/post/put."}], "tags": [], "owner": {"reputation": 57, "user_id": 8939186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ihHaV.png?s=128&g=1", "display_name": "nakarthikeya", "link": "https://stackoverflow.com/users/8939186/nakarthikeya"}, "is_accepted": false, "score": 0, "last_activity_date": 1524044211, "creation_date": 1524044211, "answer_id": 49896246, "question_id": 49890560, "link": "https://stackoverflow.com/questions/49890560/c-program-using-getopt-cant-resolve-url-parameter/49896246#49896246", "title": "C program using getopt can&#39;t resolve url parameter", "body": "<p>as @MichaelBurr points out, -g should be given after --url /-u according to this code. I tried ./test --url \"hxxp://google.com\" -g and is working.\nYou may need to check the localhost:8000</p>\n"}], "owner": {"reputation": 13, "user_id": 7595103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1da6f75fcbf650b332aec245ba6ead9?s=128&d=identicon&r=PG&f=1", "display_name": "pkitsos", "link": "https://stackoverflow.com/users/7595103/pkitsos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524044211, "creation_date": 1524021157, "last_edit_date": 1524021771, "question_id": 49890560, "link": "https://stackoverflow.com/questions/49890560/c-program-using-getopt-cant-resolve-url-parameter", "title": "C program using getopt can&#39;t resolve url parameter", "body": "<p>I'm trying to use getopt to enter a url from the command line to be used with HTTP get, post, put, and delete. HTTP GET was working earlier but for some reason I can't figure out how to resolve the url so that HTTP GET is successful now. When I print the url, it shows that it's in the expected format but curl complains saying the hostname could not be resolved. Can someone explain to me how to go about solving this issue and how to make it so only the first url entered in the command line gets accepted? Thanks!</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;getopt.h&gt;\n#include&lt;curl/curl.h&gt;\n#include&lt;stdlib.h&gt;\n\n#define OK 0\n#define INIT_ERR 1\n#define REQ_ERR 2\n\n// function for HTTP GET\nvoid get(char* url, CURL *curl, CURLcode res) {\n    long http_code = 0;\n    curl = curl_easy_init();\n    if(curl) {\n        curl_easy_setopt(curl, CURLOPT_URL, url);\n        curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);\n        res = curl_easy_perform(curl);\n        if(res != CURLE_OK) {\n            fprintf(stderr, \"[CURL] Could not execute HTTP GET: %s\\n\", curl_easy_strerror(res));\n            //return REQ_ERR;\n        }\n        curl_easy_getinfo(curl, CURLINFO_RESPONSE_CODE, &amp;http_code);\n        printf(\"[HTTP CODE]: %ld\\n\", http_code);\n        curl_easy_cleanup(curl);\n    }\n}\n\n// function for HTTP PUT\nvoid put() {\n\n}\n\n// function for HTTP POST\nvoid post() {\n\n}\n\n// function for HTTP delete\nvoid delete() {\n\n}\n\n\nint main(int argc, char **argv) {\n\n    int c;\n    char *content, *url; \n    CURL *curl;\n    CURLcode res;\n\n    while(1) {\n        static struct option long_options[] = \n        {\n            {\"help\", no_argument, 0, 'h'},\n            {\"get\", no_argument, 0, 'g'},\n            {\"url \", required_argument, 0 , 'u'},\n            {\"post\", required_argument, 0, 'o'},\n            {\"put\", required_argument, 0, 'p'},\n            {\"delete\", required_argument, 0, 'd'},\n            {0,0,0,0}\n        };\n\n        // getopt stores option index here\n        int long_index = 0;\n\n        c = getopt_long_only(argc, argv, \"hgo:p:d:u:\", \\\n            long_options, &amp;long_index);\n\n        // detect end of options    \n        if(c == -1)\n            break;\n\n        switch(c) {\n            case 'h':\n                printf(\"\\n[HELP] Usage: ./test [VERB] 'content' [URL] &lt;url&gt;\\n\\n\");\n                printf(\"----------------------- HELP OPTIONS -----------------------------------------\\n\\n\");\n                printf(\" FLAGS      ARGUMENTS   EXAMPLE ARG FORMAT      SUMMARY\\n\");\n                printf(\"------------------------------------------------------------------------------\\n\");\n                printf(\"-h/--help   N/A     N/A             help options\\n\");\n                printf(\"-g/--get    N/A     N/A             [VERB] http get option\\n\");\n                printf(\"-o/--post   'content'   'Post this stuff.'      [VERB] http post option\\n\");\n                printf(\"-p/--put    'content'   'Put this stuff.'       [VERB] http put option\\n\");\n                printf(\"-d/--delete 'content'   'Delete this stuff/'        [VERB] http delete option\\n\");\n                printf(\"-u/--url    'url'       'http://www.cnn.com'        [URL] http url of server\\n\");\n                printf(\"                'http://localhost:PORT' \\n\");\n                printf(\"                'http://IPADDRESS:PORT'\\n\\n\");\n                printf(\"------------------------------------------------------------------------------\\n\");\n                printf(\"            Example USAGE\\n\");\n                printf(\"------------------------------------------------------------------------------\\n\");\n                printf(\"HTTP GET -  ./test --get --url 'http://www.cnn.com\\n\");\n                printf(\"HTTP POST - ./test --post 'Post this content.' --url 'http://localhost:8080\\n\");\n                printf(\"HTTP PUT -  ./test --put 'Put this content.' --url 'http://localhost:8080\\n\");\n                printf(\"HTTP DELETE -   ./test --delete 'Delete this content.' --url 'http://localhost:8080'\\n\\n\");\n                break;\n            case 'g':\n                printf(\"[HTTP GET]\\n\");\n                url;\n                get(url, curl, res);\n                break;\n            case 'u':\n                url = optarg;\n                printf(\"[HTTP URL] url: %s\\n\", url);\n                break;\n            case 'o':\n                content = optarg;\n                printf(\"[HTTP POST] content: %s\\n\", content);\n                break;\n            case 'p':\n                content = optarg;\n                printf(\"[HTTP PUT] content: %s\\n\", content);\n                break;\n            case 'd':\n                content = optarg;\n                printf(\"[HTTP DELETE] content: %s\\n\", content);\n                break;\n            case '?':\n                //getopt_long already printed error message\n                break;\n            default:\n                abort();\n        }\n    //get(url, curl, res);\n    }\n\n    return OK;\n}\n</code></pre>\n"}, {"tags": ["c", "linux", "arm", "snmp", "net-snmp"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 6078541, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209259432029489/picture?type=large", "display_name": "Furynolo", "link": "https://stackoverflow.com/users/6078541/furynolo"}, "edited": false, "score": 0, "creation_date": 1532474713, "post_id": 51452143, "comment_id": 89986721, "body": "Thank you, I had already accepted the fact that no-one would ever answer this question, so I appreciate your response."}], "tags": [], "owner": {"reputation": 46, "user_id": 8459319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb9d30bef5188dccf6b1cde782cb7d97?s=128&d=identicon&r=PG&f=1", "display_name": "TST", "link": "https://stackoverflow.com/users/8459319/tst"}, "is_accepted": true, "score": 1, "last_activity_date": 1532139081, "last_edit_date": 1532139081, "creation_date": 1532137800, "answer_id": 51452143, "question_id": 49890553, "link": "https://stackoverflow.com/questions/49890553/c-net-snmp-get-and-set-specifically-via-mib-name-not-oid/51452143#51452143", "title": "C NET-SNMP Get and Set specifically via MIB Name, Not OID", "body": "<p>When I call MIB variables by their string name I use the following net-snmp functions. </p>\n\n<pre><code>read_objid(OID, anOID, &amp;anOID_len);\nsnmp_add_null_var(pdu, anOID, anOID_len);\n</code></pre>\n\n<p>Where:</p>\n\n<pre><code>oid anOID[MAX_OID_LEN];\nsize_t anOID_len = MAX_OID_LEN;\n</code></pre>\n\n<p>In my program I pack this all into a single function call.</p>\n\n<pre><code>void packSingleGetOID(const char *OID, struct snmp_pdu *pdu){\n    // OID in / PDU out\n    oid anOID[MAX_OID_LEN];\n    size_t anOID_len = MAX_OID_LEN;\n\n    read_objid(OID, anOID, &amp;anOID_len);\n    snmp_add_null_var(pdu, anOID, anOID_len);\n}\n</code></pre>\n\n<p>I pass in the MIB OID string and the pointer to session pdu. Remember the OID string is <code>MIB_Name::variable</code>. </p>\n"}], "owner": {"reputation": 41, "user_id": 6078541, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209259432029489/picture?type=large", "display_name": "Furynolo", "link": "https://stackoverflow.com/users/6078541/furynolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1006, "favorite_count": 0, "accepted_answer_id": 51452143, "answer_count": 1, "score": 2, "last_activity_date": 1532139081, "creation_date": 1524021103, "last_edit_date": 1524157298, "question_id": 49890553, "link": "https://stackoverflow.com/questions/49890553/c-net-snmp-get-and-set-specifically-via-mib-name-not-oid", "title": "C NET-SNMP Get and Set specifically via MIB Name, Not OID", "body": "<p>I have written and am testing software for a generic SNMP client module in C as well as an implementation using this generic module.  I am having trouble getting a get request to work by passing in a MIB name(e.g. sysDescr) instead of an OID(e.g. 1.3.6.1.2.1.1.1).</p>\n\n<p>I am successful when I pass in a character array containing the OID to _snmp_parse_oid()_ but not the name.</p>\n\n<p>I have checked the MIB file to make sure I am using the correct name. When I run the command line SNMP translate on the name it gives me the OID listed above:</p>\n\n<pre><code>$ snmptranslate -m +&lt;MIB File&gt; -IR -On &lt;MIB Name&gt;\n.#.#.#.#.#.#.#####.#.#.#.#.#.#\n</code></pre>\n\n<p><em>(In the above command I replaced my actual mib file with <code>&lt;MIB File&gt;</code>, mib name with <code>&lt;MIB Name&gt;</code>, and OID numbers returned from the command with <code>#</code> characters)</em></p>\n\n<p>The following is my code for my generic SNMP get function, assume returned values are #define numbers and I have removed some error handling for brevity:</p>\n\n<pre><code>/// @Synopsis        Function to send out get request since the \n///                  SNMPOidData object has been setup\n///\n/// @Param oid_name  String containing the OID to set\n/// @Param value     Value to set\n///\n/// @Returns         Error\nint snmpGet(SNMPAgent *this, char const * const oid_name, SNMPOidData * value)\n{\n    netsnmp_pdu           *pdu;\n    netsnmp_pdu           *response;\n    netsnmp_variable_list *vars;\n    oid                   *retrieved_oid;\n    oidStruct             oid_to_get;\n    int                   status   = 0;\n    int                   result   = ERROR_SUCCESS;\n\n    // Create the PDU for the data for our request\n    pdu = snmp_pdu_create(SNMP_MSG_GET);\n\n    oid_to_get.OidLen = MAX_OID_LEN; // Set max length\n\n    // Send out the request(s)\n    retrieved_oid = snmp_parse_oid(oid_name, oid_to_get.Oid, &amp;oid_to_get.OidLen);\n\n    // Set the data\n    snmp_add_null_var(pdu, oid_to_get.Oid, oid_to_get.OidLen))\n\n    // Send the request out\n    status = snmp_synch_response(this-&gt;port.snmp_session_handle, pdu, &amp;response);\n    if (STAT_SUCCESS == status)\n    {\n        if (SNMP_ERR_NOERROR == response-&gt;errstat)\n        {\n            vars = response-&gt;variables;\n            value-&gt;type = vars-&gt;type;\n\n            if (vars-&gt;next_variable != NULL)\n            {\n                // There are more values, set return type to null\n                value-&gt;type = ASN_NULL;\n            }\n            else if (!(CHECK_END(vars-&gt;type))) // Exception\n            {\n                result = ERROR_NOT_PRESENT;\n                fprintf(stderr, \"Warning: OID=%s gets snmp exception %d \\n\",\n                    oid_name, vars-&gt;type);\n            }\n            else if ((vars-&gt;type == ASN_INTEGER)\n                  || (vars-&gt;type == ASN_COUNTER)\n                  || (vars-&gt;type == ASN_UNSIGNED))\n            {\n                value-&gt;integer = *(vars-&gt;val.integer);\n                value-&gt;str_len = sizeof(value-&gt;integer);\n            }\n            else\n            {\n                value-&gt;str_len = vars-&gt;val_len;\n\n                if (value-&gt;str_len &gt;= MAX_ASN_STR_LEN)\n                    value-&gt;str_len = MAX_ASN_STR_LEN;\n\n                if (value-&gt;str_len &gt; 0)\n                    memcpy(value-&gt;string, vars-&gt;val.string, value-&gt;str_len);\n\n                // guarantee NULL terminated string\n                value-&gt;string[value-&gt;str_len] = '\\0';\n            }\n        }\n    }\n\n    this-&gt;freePDU(response); // Clean up: free the response\n\n    return result;\n}\n</code></pre>\n\n<p>The error I am getting:</p>\n\n<pre><code>oid_name: Unknown Object Identifier (Sub-id not found: (top) -&gt; &lt;MIB Name&gt;)\n</code></pre>\n\n<p>Which comes from the following call:</p>\n\n<pre><code>retrieved_oid = snmp_parse_oid(oid_name, oid_to_get.Oid, &amp;oid_to_get.OidLen);\n</code></pre>\n\n<p>I have made sure that the MIB files are on the machine in the configured place (snmptranslate wouldn't work if this weren't the case).</p>\n\n<p>I have spent a good amount of time on Google results as well as directly searching here on Stack Overflow.\nThe following is a good tutorial but does not address my issue (they directly reference the OID they want to get the value of):\n<a href=\"http://www.net-snmp.org/wiki/index.php/TUT:Simple_Application\" rel=\"nofollow noreferrer\">http://www.net-snmp.org/wiki/index.php/TUT:Simple_Application</a></p>\n\n<p>Any help or insight would be much appreciated.</p>\n\n<p>Some other info I can think of is that this is being compiled to run on an armv5tejl target running Linux communicating with an external device via ethernet.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["c++", "c", "string", "file", "loops"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1524019279, "post_id": 49890293, "comment_id": 86796406, "body": "<code>char words[MAX_WORD_COUNT][MAX_WORD_LENGTH]</code> would be a good place to start, with <code>MAX_WORD_COUNT</code> defined as 10."}, {"owner": {"reputation": 68403, "user_id": 3422102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Tg0Gt.png?s=128&g=1", "display_name": "David C. Rankin", "link": "https://stackoverflow.com/users/3422102/david-c-rankin"}, "edited": false, "score": 1, "creation_date": 1524020333, "post_id": 49890293, "comment_id": 86796643, "body": "Or better yet <code>typedef struct { char word[MAX_WORD_LEN]; int len } wstats;</code> and then declare an array <code>wstats mystats[10] = {{ .word = &quot;&quot; }};</code> and you can simply iterate over your array, checking <code>mystats[i].len</code> and adding/exchanging words as you read through the file."}, {"owner": {"reputation": 17298, "user_id": 1540468, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2f7d0c7668a2f3b53cf22c01ae63f32b?s=128&d=identicon&r=PG", "display_name": "Paul Rooney", "link": "https://stackoverflow.com/users/1540468/paul-rooney"}, "edited": false, "score": 1, "creation_date": 1524025660, "post_id": 49890293, "comment_id": 86797960, "body": "How is your file structured? Is it just a file with one word per line?"}, {"owner": {"reputation": 27, "user_id": 5428926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f98fcae113f95b1b58f6220fd560fb9?s=128&d=identicon&r=PG&f=1", "display_name": "Exiler", "link": "https://stackoverflow.com/users/5428926/exiler"}, "edited": false, "score": 0, "creation_date": 1524026352, "post_id": 49890293, "comment_id": 86798156, "body": "Yes it is one word per line."}, {"owner": {"reputation": 17298, "user_id": 1540468, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2f7d0c7668a2f3b53cf22c01ae63f32b?s=128&d=identicon&r=PG", "display_name": "Paul Rooney", "link": "https://stackoverflow.com/users/1540468/paul-rooney"}, "edited": false, "score": 1, "creation_date": 1524028499, "post_id": 49890293, "comment_id": 86798837, "body": "Have an array of 10 words (could be array of arrays or could be an array of pointers if you can&#39;t guarantee a max size) and an int holding the min size the string would need to be to be allowed into the array (unless the array wasnt full it would be 1 larger than the shortest string). Then whenever you encounter a longer string find the shortest string and replace it with the longer one and update your int variable. If you maintain the array in sorted order, it will be quick to find the element to remove, although that may not be the place to insert the new string to maintain order."}, {"owner": {"reputation": 17298, "user_id": 1540468, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2f7d0c7668a2f3b53cf22c01ae63f32b?s=128&d=identicon&r=PG", "display_name": "Paul Rooney", "link": "https://stackoverflow.com/users/1540468/paul-rooney"}, "edited": false, "score": 2, "creation_date": 1524028695, "post_id": 49890293, "comment_id": 86798908, "body": "Also look at the heap data structure."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 5428926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f98fcae113f95b1b58f6220fd560fb9?s=128&d=identicon&r=PG&f=1", "display_name": "Exiler", "link": "https://stackoverflow.com/users/5428926/exiler"}, "edited": false, "score": 0, "creation_date": 1524025300, "post_id": 49891015, "comment_id": 86797860, "body": "Would you mind explaining your advice in C/C++ with a simple code?"}, {"owner": {"reputation": 260120, "user_id": 103167, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "Ben Voigt", "link": "https://stackoverflow.com/users/103167/ben-voigt"}, "edited": false, "score": 1, "creation_date": 1524029293, "post_id": 49891015, "comment_id": 86799140, "body": "That&#39;s a lot less efficient though, it has to sort and store the entire array instead of just the longest entires."}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 0, "creation_date": 1524032201, "post_id": 49891015, "comment_id": 86800359, "body": "Yep, try that shell one liner with a 40 GB file and we&#39;ll see how it fares against the most trivial solution which just compares each new line with the current top 10 (even without using a max-heap)."}, {"owner": {"reputation": 16, "user_id": 9661740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db3b3483e6cb82daedb7ae56ed700658?s=128&d=identicon&r=PG&f=1", "display_name": "cowile", "link": "https://stackoverflow.com/users/9661740/cowile"}, "edited": false, "score": 0, "creation_date": 1527574822, "post_id": 49891015, "comment_id": 88164122, "body": "Tell me more about the 40 GB text files you happen to have laying around. There aren&#39;t that many words in the English language. But taking you hypothetically, I could scale the shell idea to 40 GB faster than you could implement the &quot;trivial&quot; C solution."}], "tags": [], "owner": {"reputation": 16, "user_id": 9661740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db3b3483e6cb82daedb7ae56ed700658?s=128&d=identicon&r=PG&f=1", "display_name": "cowile", "link": "https://stackoverflow.com/users/9661740/cowile"}, "is_accepted": false, "score": 0, "last_activity_date": 1524024697, "last_edit_date": 1524024697, "creation_date": 1524024376, "answer_id": 49891015, "question_id": 49890293, "link": "https://stackoverflow.com/questions/49890293/find-10-longest-words-in-a-file/49891015#49891015", "title": "Find 10 longest words in a file", "body": "<p>You didn't explicitly state so, but I will assume the file is one word per line based on your sample code.</p>\n\n<p>First, this task is a fairly straightforward one-liner in shell.</p>\n\n<p><code>awk '{print length($0), $0}' words.txt | sort -rn | head | awk '{print $2}'</code></p>\n\n<p>That will be much faster to write and more robust than rolling your own program. The pipeline prints each word prefixed by its length and a space, sorts the resulting lines numerically in reverse order, takes the first 10, and prints the words without their lengths.</p>\n\n<p>Assuming you do need to write C, here is some advice:</p>\n\n<ul>\n<li><p>Unless you have a really strong reason to avoid dynamic allocation, learn how to use <a href=\"https://linux.die.net/man/3/getline\" rel=\"nofollow noreferrer\"><code>getline()</code></a>. It handles dynamic allocation for you, which prevents you from needing to choose the size of an array.</p></li>\n<li><p>There is no reason to use <code>strtok()</code> to remove the newline. A newline will just add one to every length, not changing the result, and you will need to print newlines to report your results anyway.</p></li>\n<li><p>Keep you results in an array <code>char *longwords[10];</code>. Every time you get a new word, check against everything in <code>longwords</code>. If the new word is long enough, replace the shortest word in <code>longwords</code> with the new word. <a href=\"https://linux.die.net/man/3/strdup\" rel=\"nofollow noreferrer\"><code>strdup()</code></a> the new word and <a href=\"https://linux.die.net/man/3/free\" rel=\"nofollow noreferrer\"><code>free()</code></a> the existing one as needed.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 5428926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f98fcae113f95b1b58f6220fd560fb9?s=128&d=identicon&r=PG&f=1", "display_name": "Exiler", "link": "https://stackoverflow.com/users/5428926/exiler"}, "edited": false, "score": 0, "creation_date": 1524068863, "post_id": 49892047, "comment_id": 86825118, "body": "This seem to be printing the same word ten times."}], "tags": [], "owner": {"reputation": 1, "user_id": 8514724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45c29626656dc4860e802f68cedba677?s=128&d=identicon&r=PG&f=1", "display_name": "uubs", "link": "https://stackoverflow.com/users/8514724/uubs"}, "is_accepted": false, "score": 0, "last_activity_date": 1524178568, "last_edit_date": 1524178568, "creation_date": 1524030338, "answer_id": 49892047, "question_id": 49890293, "link": "https://stackoverflow.com/questions/49890293/find-10-longest-words-in-a-file/49892047#49892047", "title": "Find 10 longest words in a file", "body": "<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define MAX_WORD_LENGTH 200\n\nint main () {\nFILE *fp = fopen(\"words.txt\",\"r\");\nchar str[60];\nchar *largest = (char*) malloc (MAX_WORD_LENGTH);\nint smallest_len = MAX_WORD_LENGTH, largest_len = 0;\nint len_temp = MAX_WORD_LENGTH;  // new added code\n\n\nfor (int cnt = 1; cnt &lt;= 10; cnt ++) // new added code\n{\n\n    while (fgets (str, 60, fp) != NULL)\n    {\n        char *temp = strtok(str, \"\\n\");\n        while (temp != NULL)\n        {\n            if (strlen(temp) &gt; largest_len &amp;&amp; strlen(temp) &lt; len_temp)\n            { // here len_temp is for remember the last biggest one length\n                strcpy(largest, temp);\n                largest_len = strlen(largest);\n            }\n            temp = strtok(NULL, \"\\n\");\n        }\n    }\n    // new added code\n    printf(\"The %dst word in the file is: %s\\n, length is %d\", cnt, largest, largest_len);\n    len_temp = largest_len;  // remember last largest length\n    rewind(fp); // new added code\n    largest_len = 0; // new added code\n}\n\nfclose(fp);\n\nreturn 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 5428926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f98fcae113f95b1b58f6220fd560fb9?s=128&d=identicon&r=PG&f=1", "display_name": "Exiler", "link": "https://stackoverflow.com/users/5428926/exiler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 745, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1524192283, "creation_date": 1524019126, "last_edit_date": 1524192283, "question_id": 49890293, "link": "https://stackoverflow.com/questions/49890293/find-10-longest-words-in-a-file", "title": "Find 10 longest words in a file", "body": "<p>Working on to print the 10 longest words from a file (one word per line).  Words can be printed in any order, and if there are multiple words tied for 10th longest we can decide what to do. The following prints top 1, appreciate any suggestions to build a loop that can iterate and print the next 9.  Assumptions made here, the longest word in the file can be 200 letters and 60 spaces in b/w them. I'm looking to exclude both the assumptions and make it to work more dynamically. Though the following is C like to hear any to write in C++ as well but need to avoid using STL.    </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define MAX_WORD_LENGTH 200\n\nint main () {\nFILE *fp = fopen(\"words.txt\",\"r\");\nchar str[60];\nchar *largest = (char*) malloc (MAX_WORD_LENGTH);\nint smallest_len = MAX_WORD_LENGTH, largest_len = 0;\n\nwhile (fgets (str, 60, fp) != NULL) \n{\n    char *temp = strtok(str, \"\\n\");\n    while (temp != NULL) \n    {\n        if (strlen(temp) &gt; largest_len) \n        {\n            strcpy(largest, temp);\n            largest_len = strlen(largest);\n        }\n        temp = strtok(NULL, \"\\n\");\n    }\n}\n\nprintf(\"The largest word in the file is: %s\\n\", largest);\n\nfclose(fp);\n\nreturn 0;\n}\n</code></pre>\n"}, {"tags": ["c", "assembly", "cpu"], "comments": [{"owner": {"reputation": 6093, "user_id": 2189500, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/109f747845a9ce762a1fff72eb8cf6f3?s=128&d=identicon&r=PG", "display_name": "David Wohlferd", "link": "https://stackoverflow.com/users/2189500/david-wohlferd"}, "edited": false, "score": 0, "creation_date": 1524019262, "post_id": 49890211, "comment_id": 86796399, "body": "Depending on what compiler you use (which you don&#39;t specify), there are ways to have it output the assembly it generates.  My expectation is that the compiler is able to optimizes this pretty heavily.  The generated assembly doesn&#39;t necessarily have to have specified locations for each C variable.  They might be joined together, or optimized away completely."}, {"owner": {"reputation": 21426, "user_id": 2495283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ef72b32709062aa479476844515073?s=128&d=identicon&r=PG", "display_name": "Claies", "link": "https://stackoverflow.com/users/2495283/claies"}, "edited": false, "score": 0, "creation_date": 1524019280, "post_id": 49890211, "comment_id": 86796407, "body": "pretty sure this has all the answers you are looking for:  <a href=\"https://stackoverflow.com/a/4955297/2495283\">stackoverflow.com/a/4955297/2495283</a>"}, {"owner": {"reputation": 15145, "user_id": 4271923, "user_type": "registered", "profile_image": "https://graph.facebook.com/543414580/picture?type=large", "display_name": "Ped7g", "link": "https://stackoverflow.com/users/4271923/ped7g"}, "edited": false, "score": 0, "creation_date": 1524042372, "post_id": 49890211, "comment_id": 86806361, "body": "JFYI: <code>*p</code> and <code>*A</code> in the later examples refer to the <code>A[0]</code> element, not <code>A[1]</code>, in C the array indexing starts from zero. Which makes sense when you think about it as memory address, if <code>A</code> is memory address of the very first byte of the array content, then <code>A+0</code> is still first element, but <code>A+1</code> is adjusted by compiler to machine code <code>A+1*size_of_array_element</code>, i.e. it points at second element of array = one element after beginning."}], "answers": [{"comments": [{"owner": {"reputation": 1404, "user_id": 6395770, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a1dd74e2bc23bea3918a139070114d23?s=128&d=identicon&r=PG&f=1", "display_name": "information_interchange", "link": "https://stackoverflow.com/users/6395770/information-interchange"}, "edited": false, "score": 0, "creation_date": 1524019422, "post_id": 49890316, "comment_id": 86796440, "body": "<a href=\"https://stackoverflow.com/questions/4622461/difference-between-pointer-index-and-pointer?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa\" title=\"difference between pointer index and pointer\">stackoverflow.com/questions/4622461/&hellip;</a>"}, {"owner": {"reputation": 359, "user_id": 7839690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/277446997e35bd19b67a21bd7e10d641?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Lin", "link": "https://stackoverflow.com/users/7839690/andy-lin"}, "edited": false, "score": 0, "creation_date": 1524021552, "post_id": 49890316, "comment_id": 86796926, "body": "What I want to know in Q1 is: Does the &amp; operator need a space in memory? No matter the var1 is global or local."}, {"owner": {"reputation": 42446, "user_id": 902497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff13ece6277497484bfa2911c6183a30?s=128&d=identicon&r=PG", "display_name": "Raymond Chen", "link": "https://stackoverflow.com/users/902497/raymond-chen"}, "reply_to_user": {"reputation": 359, "user_id": 7839690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/277446997e35bd19b67a21bd7e10d641?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Lin", "link": "https://stackoverflow.com/users/7839690/andy-lin"}, "edited": false, "score": 1, "creation_date": 1524022431, "post_id": 49890316, "comment_id": 86797123, "body": "@AndyLin The language doesn&#39;t specify what happens. It is up to each implementation to decide when to allocate memory. The answer may even change depending on the optimization level."}, {"owner": {"reputation": 155, "user_id": 2694959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a082b77878ef3fa77e3641d1d4cbd961?s=128&d=identicon&r=PG&f=1", "display_name": "dillonh2", "link": "https://stackoverflow.com/users/2694959/dillonh2"}, "edited": false, "score": 0, "creation_date": 1524023829, "post_id": 49890316, "comment_id": 86797485, "body": "@information_interchange Q1: If you have a primitive like an int and you never take the address of it, its possible that it will only ever exist in registers and never in the actual stack."}, {"owner": {"reputation": 9461, "user_id": 8422330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0f90445d03447c587d1e595d531f69?s=128&d=identicon&r=PG&f=1", "display_name": "prl", "link": "https://stackoverflow.com/users/8422330/prl"}, "edited": false, "score": 1, "creation_date": 1524032229, "post_id": 49890316, "comment_id": 86800378, "body": "The &amp; operator doesn\u2019t need space in memory any more than the + operator does."}], "tags": [], "owner": {"reputation": 1404, "user_id": 6395770, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a1dd74e2bc23bea3918a139070114d23?s=128&d=identicon&r=PG&f=1", "display_name": "information_interchange", "link": "https://stackoverflow.com/users/6395770/information-interchange"}, "is_accepted": false, "score": 0, "last_activity_date": 1524019313, "creation_date": 1524019313, "answer_id": 49890316, "question_id": 49890211, "link": "https://stackoverflow.com/questions/49890211/address-operator-and-array-in-assembly-level/49890316#49890316", "title": "address operator and array in assembly level", "body": "<p>Q1: No, the address operator is not the reason why <code>var1</code> has space on the stack. Whenever you declare any variable \"locally\", the \"computer\" allocates memory on the stack for that variable. </p>\n\n<p>Q2: Yes. Note that in <em>certain</em> conditions, you can interchange an array and a pointer. That is, for <code>int [] my_array</code> and <code>int * ptr</code>, <code>*my_array</code> and <code>*ptr</code> will both give you the first element of the array</p>\n"}, {"tags": [], "owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": false, "score": 3, "last_activity_date": 1524023852, "creation_date": 1524023852, "answer_id": 49890946, "question_id": 49890211, "link": "https://stackoverflow.com/questions/49890211/address-operator-and-array-in-assembly-level/49890946#49890946", "title": "address operator and array in assembly level", "body": "<p>The CPU doesn't \"create variables\".  You could say the <em>compiler</em> creates space on the stack for variables through the choice of instructions it uses, or in static storage with assembler directives to reserve space in the <code>.data</code>, <code>.rodata</code>, or <code>.bss</code> sections.</p>\n\n<p>You'll see more or less what you expect if you put that code on <a href=\"http://godbolt.org/\" rel=\"nofollow noreferrer\">http://godbolt.org/</a> with optimization disabled (<code>-O0</code>), i.e. the actual asm for x86, ARM, or whatever, will reserve space for every variable that exists in the C abstract machine, and actually store the values there.</p>\n\n<p>But in real code compiled normally (<code>-O2</code> or <code>-O3</code>) the compiler takes advantage of the \"as if\" rule, which lets it emit whatever asm instructions it decides will produce the same observable behaviour as the C source, including optimizing away <code>int *p</code> entirely and doing the equivalent of <code>printf(\"%d\\n\", 2);</code>.  Passing the address <code>A</code> to an external function like <code>printf</code> will probably cause the compiler to actually create that array on the stack, though.  But you never take the address of <code>p</code> itself, so there's no reason for <code>p</code> to exist in memory.</p>\n"}, {"tags": [], "owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "is_accepted": true, "score": 2, "last_activity_date": 1524050621, "creation_date": 1524050621, "answer_id": 49898502, "question_id": 49890211, "link": "https://stackoverflow.com/questions/49890211/address-operator-and-array-in-assembly-level/49898502#49898502", "title": "address operator and array in assembly level", "body": "<p>I'm afraid you are mistaking two things here:</p>\n\n<ul>\n<li>the use of address operator <code>&amp;</code>.</li>\n<li>the use of arrays in C.</li>\n</ul>\n\n<p>The address of <code>&amp;</code> operator allows you to construct a pointer to value from a variable of same type as value.  That means that, when you write:</p>\n\n<pre><code>p = &amp;var1;\n</code></pre>\n\n<p>C gets the address of variable <code>var1</code> and stores <em>that value</em> into pointer variable <code>p</code>.</p>\n\n<p>When you refer to an array by name, the value you get is the address of the first element, so</p>\n\n<pre><code>int *p = A;\n</code></pre>\n\n<p>is the same as <em>take the address of the first element of A and assign that value to the pointer to <code>int</code> variable <code>p</code></em>.</p>\n\n<p>When you do:</p>\n\n<pre><code>int *p = &amp;A;\n</code></pre>\n\n<p>you are doing an assignment from a pointer to array of <code>int</code> into a variable of type array of <code>int</code>, which is a different type.  Historically, the compiler automatically converted the type and didn't give any indication, but as it is incorrect, it can confuse more than one.  It gives a warning on my compiler, although:</p>\n\n<pre><code>$ make pru2.o\ncc -O -pipe -c pru2.c -o pru2.o\npru2.c:5:6: warning: incompatible pointer types initializing 'int *' with an expression of type 'int (*)[20]'\n      [-Wincompatible-pointer-types]\nint *q = &amp;A;\n     ^   ~~\n1 warning generated.\n</code></pre>\n\n<p>This is manifested in the code you post later:</p>\n\n<pre><code>printf(\"%d\\n\", A); /* this is the same ass &amp;A[0] */\nprintf(\"%d\\n\", *A); /* dereference that, as *(&amp;A[0]) == A[0] */\n</code></pre>\n\n<p>Here, it is important (when using arrays) to differentiate clearly that</p>\n\n<pre><code>&amp;A\n</code></pre>\n\n<p>and</p>\n\n<pre><code>A\n</code></pre>\n\n<p>Are different expressions, that give (normally, as thinking otherwise is Undefined Behaviour) the same address value, but as a pointer to different type.  </p>\n\n<pre><code>&amp;A  \n</code></pre>\n\n<p>is the address of array <code>A</code>, and as such is defined as type </p>\n\n<pre><code>int (*)[sizeof A / sizeof A[0]]\n</code></pre>\n\n<p>while</p>\n\n<pre><code>A\n</code></pre>\n\n<p>represents the address of the first element of <code>A</code>, and as such it is defined as type</p>\n\n<pre><code>int *\n</code></pre>\n\n<p>(pointer to <code>int</code>)  This can be shown, by simply printing the sizes of the <em>pointed to</em> dereferences, as in:</p>\n\n<pre><code>int A[20];\n\n...\n\nprintf(\"sizeof *(&amp;A) == %z\\n\", sizeof *(&amp;A));\n</code></pre>\n\n<p>and</p>\n\n<pre><code>printf(\"sizeof *A == %z\\n\", sizeof *A);\n</code></pre>\n\n<p>(the first will give you the size of the complete array, demonstrating that the address of an array <code>A</code> is a pointer to an array of 20 <code>int</code>s, while the second will give you the size of the first element of <code>A</code>, demonstrating that it points to a single <code>int</code> element)</p>\n\n<p>In general, arrays are used in a very limited way in C, as they are assimilated to pointers in many situations, they cannot be passed <em>by value</em> ---using the array name as a parameter to a function passes a pointer to the first element, using the address of the array makes the compiler to pass the same value, but as a pointer to array of n elements--- this will be treated as a simple pointer value by the called function, as the unspecified array suffix <code>[]</code> will be converted into a pointer definition by the compiler. </p>\n"}], "owner": {"reputation": 359, "user_id": 7839690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/277446997e35bd19b67a21bd7e10d641?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Lin", "link": "https://stackoverflow.com/users/7839690/andy-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 776, "favorite_count": 0, "accepted_answer_id": 49898502, "answer_count": 3, "score": 0, "last_activity_date": 1524050621, "creation_date": 1524018516, "last_edit_date": 1524021401, "question_id": 49890211, "link": "https://stackoverflow.com/questions/49890211/address-operator-and-array-in-assembly-level", "title": "address operator and array in assembly level", "body": "<p>Q1: The address operator takes the address of that variable. for example:</p>\n\n<pre><code>int var1;\nint *p;\np = &amp;var1;\n</code></pre>\n\n<p>Program takes the address of var1 to variable p at line 3.</p>\n\n<p>Does it mean that CPU creates a space for putting address of var1(due to address operator), and then gives it to p?</p>\n\n<p>Q2: the code below:</p>\n\n<pre><code>int A[3]= {2, 4, 6};\n\nint *p = A;\n\nprintf(\"%d\\n\", p);\nprintf(\"%d\\n\", *p);\n</code></pre>\n\n<p>prints value of p and dereferencing value of p(value of A[1]),\nand is equivalent to:</p>\n\n<pre><code>int A[3]= {2, 4, 6};\n\nprintf(\"%d\\n\", A);\nprintf(\"%d\\n\", *A);\n</code></pre>\n\n<p>The first example in Q2 is very clear to see that CPU creates another variable p to store address of A.</p>\n\n<p>Does the second example do the same thing in CPU except creating one more variable p?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["c", "string"], "comments": [{"owner": {"reputation": 773, "user_id": 5265558, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a0n94.jpg?s=128&g=1", "display_name": "Perette", "link": "https://stackoverflow.com/users/5265558/perette"}, "edited": false, "score": 1, "creation_date": 1524017514, "post_id": 49889997, "comment_id": 86796060, "body": "A char is a byte in memory, that&#39;s all.  A string is a series of bytes terminated by a zero byte.  So, using %s on the address of your character prints the character, and whatever junk is in memory up until a null byte (or until a memory fault occurs and the program dumps core).  You want %c."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9661698, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dnaed0IfuC4/AAAAAAAAAAI/AAAAAAAAACk/nP4fYJzgc94/photo.jpg?sz=128", "display_name": "xiao liu", "link": "https://stackoverflow.com/users/9661698/xiao-liu"}, "edited": false, "score": 0, "creation_date": 1524018909, "post_id": 49890013, "comment_id": 86796339, "body": "Thanks a lot! You solved the problem which takes me 3 hours to think where things go wrong."}], "tags": [], "owner": {"reputation": 123967, "user_id": 251153, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4b25144c09555e7d5b5e288469e011ef?s=128&d=identicon&r=PG", "display_name": "zneak", "link": "https://stackoverflow.com/users/251153/zneak"}, "is_accepted": true, "score": 4, "last_activity_date": 1524017272, "last_edit_date": 1524017272, "creation_date": 1524016929, "answer_id": 49890013, "question_id": 49889997, "link": "https://stackoverflow.com/questions/49889997/how-to-get-each-elements-from-char-string-in-c/49890013#49890013", "title": "How to get each elements from char string in c?", "body": "<p>Use <code>%c</code> and <code>A</code>-<code>G</code> instead of <code>%s</code> and <code>&amp;A</code>-<code>&amp;G</code>.</p>\n\n<p><code>%s</code> is the printf format for strings, and <code>%c</code> is the printf format for characters.</p>\n\n<p>A C string is the memory address of a sequence of characters that is terminated by the special character <code>'\\0'</code>. <code>buf</code> is a string, but A through G are just one character each and their address can't be treated as a string.</p>\n"}], "owner": {"reputation": 13, "user_id": 9661698, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dnaed0IfuC4/AAAAAAAAAAI/AAAAAAAAACk/nP4fYJzgc94/photo.jpg?sz=128", "display_name": "xiao liu", "link": "https://stackoverflow.com/users/9661698/xiao-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 1, "accepted_answer_id": 49890013, "answer_count": 1, "score": 1, "last_activity_date": 1524017272, "creation_date": 1524016757, "question_id": 49889997, "link": "https://stackoverflow.com/questions/49889997/how-to-get-each-elements-from-char-string-in-c", "title": "How to get each elements from char string in c?", "body": "<p>I would like to put first 7 elements of buf[20] into char A to G. I expect the result could be <code>1 H, 2 e, 3 l, 4 l,5 o, 6 ,7 W</code>, but what I got is <code>1 H,2 e olWH,3 lWH,4 le olWH,5 olWH,6  olWH,7 WH</code>. Could anyone explain this, please?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n     char buf[20]=\"Hello World\";\n     char A,B,C,D,E,F,G;\n    int main()\n    {\n\n        A=buf[0];\n        B=buf[1];\n        C=buf[2];\n        D=buf[3];\n        E=buf[4];\n        F=buf[5];\n        G=buf[6];\n        printf(\"1 %s,2 %s,3 %s,4 %s,5 %s,6 %s,7 %s\",&amp;A,&amp;B,&amp;C,&amp;D,&amp;E,&amp;F,&amp;G);\n        return 0;\n    }\n</code></pre>\n"}, {"tags": ["c", "fgets"], "comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1524015060, "post_id": 49889730, "comment_id": 86795575, "body": "You missed the <code>feof</code>, <a href=\"https://stackoverflow.com/questions/5431941\">which is always wrong</a>. But you are correct that the second argument to <code>fgets</code> needs to be less than or equal to the buffer size."}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 2, "creation_date": 1524015823, "post_id": 49889730, "comment_id": 86795746, "body": "It works <i>only</i> because the <i>actual</i> length of the lines read is 79 [or less]. The <code>200</code> is the maximum (wrong), but if all lines are 79, you squeak by. (e.g.) If you had a line that is 90, the program will have undefined behavior [and will probably segfault]. You&#39;d overwrite the return address of the function and may destroy the value of <code>fi</code> while reading."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 1, "creation_date": 1524016003, "post_id": 49889730, "comment_id": 86795773, "body": "Please don&#39;t post pictures of code, copy &amp; paste code in your question."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 1, "creation_date": 1524016124, "post_id": 49889730, "comment_id": 86795802, "body": "Undefined behaviour is undefined behaviour. The fact that the other code &quot;works&quot; doesn&#39;t mean anything, it might run without crashing but it doesn&#39;t mean that it is running correctly. You just got lucky that you didn&#39;t see a segfault right away."}], "answers": [{"comments": [{"owner": {"reputation": 139, "user_id": 7746979, "user_type": "registered", "profile_image": "https://graph.facebook.com/1423539634344249/picture?type=large", "display_name": "Daycopo", "link": "https://stackoverflow.com/users/7746979/daycopo"}, "edited": false, "score": 0, "creation_date": 1524015365, "post_id": 49889793, "comment_id": 86795643, "body": "Yes I know that and I understand it, but I have a code under my eyes where there is pretty much the code I wrote and it works, that&#39;s what I dont understand. Is there any way?"}], "tags": [], "owner": {"reputation": 86, "user_id": 4644657, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h6yo6.jpg?s=128&g=1", "display_name": "jat", "link": "https://stackoverflow.com/users/4644657/jat"}, "is_accepted": false, "score": 2, "last_activity_date": 1524016093, "last_edit_date": 1524016093, "creation_date": 1524015173, "answer_id": 49889793, "question_id": 49889730, "link": "https://stackoverflow.com/questions/49889730/fgets-where-the-number-of-char-read-is-bigger-than-the-size-of-the-storage/49889793#49889793", "title": "fgets where the number of char read is bigger than the size of the storage", "body": "<p>In your code you are defining a character array with size of 80 characters</p>\n\n<pre><code>char str[80];\n</code></pre>\n\n<p><br></p>\n\n<pre><code>fgets(str, 200, fi);\n</code></pre>\n\n<p>Above statement means that it is reading <strong>200</strong> characters from file \"<strong>fi</strong>\" in the character array \"<strong>str</strong>\" of size <strong>80</strong>.\nYou cannot copy 200 characters in an array of size 80.</p>\n\n<p>Either make character array bigger or read 80 or less characters at a time from the file.</p>\n\n<p>EDIT: The reason program crashes is because it is accessing <strong>illegal memory locations</strong>. This does not mean it will necessary crash if you index a location which is greater than size of array, It just means it can crash if it is not allowed to access that memory location.\nSo that is the reason, the code you mentioned is probably working(purely on chance), although that 200 part is wrong. If it ran then run it multiple times it will probably crash atleast once.</p>\n"}, {"comments": [{"owner": {"reputation": 139, "user_id": 7746979, "user_type": "registered", "profile_image": "https://graph.facebook.com/1423539634344249/picture?type=large", "display_name": "Daycopo", "link": "https://stackoverflow.com/users/7746979/daycopo"}, "edited": false, "score": 0, "creation_date": 1524016202, "post_id": 49889815, "comment_id": 86795821, "body": "First, thanks for all those explanations. Actually I was trying to figure out why the &#39;wrong&#39; code I wrote was working, because yes I understand how the code <b>should</b> work"}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "reply_to_user": {"reputation": 139, "user_id": 7746979, "user_type": "registered", "profile_image": "https://graph.facebook.com/1423539634344249/picture?type=large", "display_name": "Daycopo", "link": "https://stackoverflow.com/users/7746979/daycopo"}, "edited": false, "score": 1, "creation_date": 1524016334, "post_id": 49889815, "comment_id": 86795849, "body": "@PaulMonties classic undefined behaviour. You just got lucky that it didn&#39;t crash right away. But it could have."}], "tags": [], "owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "is_accepted": true, "score": 3, "last_activity_date": 1524015391, "creation_date": 1524015391, "answer_id": 49889815, "question_id": 49889730, "link": "https://stackoverflow.com/questions/49889730/fgets-where-the-number-of-char-read-is-bigger-than-the-size-of-the-storage/49889815#49889815", "title": "fgets where the number of char read is bigger than the size of the storage", "body": "<p><code>fgets(str, 200, fi);</code> is indeed wrong, because it is telling <code>fgets</code> to read up\nto 199 characters when in reality <code>str</code> can store up to 79 characters (not\nincluding the <code>'\\0'</code>-terminating byte), that's why it \"works\"<sup>1</sup> with <code>fgets(str, 80, fi);</code>.</p>\n\n<p>In general it's a good idea to use <code>sizeof</code> like this<sup>2</sup>:</p>\n\n<pre><code>char str[80];\nfgets(str, sizeof str, fi);\n</code></pre>\n\n<p>With <code>sizeof</code> you will get the correct size, even if you later decide to change\nthe size of <code>str</code>.</p>\n\n<p>One thing that is <a href=\"https://stackoverflow.com/questions/5431941/why-is-while-feof-file-always-wrong\">really wrong</a> is:</p>\n\n<pre><code>while(!feof(fi))\n{\n    ...\n}\n</code></pre>\n\n<p>What the code should do is:</p>\n\n<pre><code>while(fgets(str, sizeof str, fi))\n{\n    // do things\n}\n</code></pre>\n\n<p>that's the proper way to read the whole file.</p>\n\n<hr>\n\n<p><strong>Fotenotes</strong></p>\n\n<p><sup>1</sup>I put works in quotes because the way the code checks when to stop\nreading is incorrect. However <code>fgets(str, 80, fi)</code> is the correct call.</p>\n\n<p><sup>2</sup>Note that <code>sizeof</code> will give the correct size only if <code>str</code> is an\narray. If it is a pointer and you allocated memory for it, then you cannot use\n<code>sizeof</code>, for example:</p>\n\n<pre><code>size_t len = 80;\nchar *str = malloc(len);\nif(str == NULL)\n{\n    // error handling\n}\n\nfgets(str, len, fi); // &lt;-- do not use sizeof here, but the variable\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 7746979, "user_type": "registered", "profile_image": "https://graph.facebook.com/1423539634344249/picture?type=large", "display_name": "Daycopo", "link": "https://stackoverflow.com/users/7746979/daycopo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 0, "accepted_answer_id": 49889815, "answer_count": 2, "score": 0, "last_activity_date": 1524016093, "creation_date": 1524014722, "last_edit_date": 1524015735, "question_id": 49889730, "link": "https://stackoverflow.com/questions/49889730/fgets-where-the-number-of-char-read-is-bigger-than-the-size-of-the-storage", "title": "fgets where the number of char read is bigger than the size of the storage", "body": "<p>I'm looking at a code to learn things and I saw something like this :</p>\n\n<pre><code>void funRead(){\n     char str[80];\n     FILE *fi;\n     fi = fopen(\"file\",\"r\");\n     while(!feof(fi)){\n        fgets(str, 200, fi);\n        // do things\n     }\n     fclose(fi);\n}\n</code></pre>\n\n<p>And it works! (It's quite a big code) I didn't understand why it was working so I tried to reproduce it (just this part, pretty much just the code above) and my program crashes (I'm doing it on <strong>Eclipse</strong>). It only works when I write </p>\n\n<pre><code>fgets(str, 80, fi);\n</code></pre>\n\n<p>Or another number &lt; 80, otherwise it won't work.</p>\n\n<p>Did I miss something?</p>\n\n<p><strong>EDIT</strong> : Screen capture of the part of the program I'm talking about\n<a href=\"https://gyazo.com/c8847ccc36bbbe7a406a3260db8dd358\" rel=\"nofollow noreferrer\">https://gyazo.com/c8847ccc36bbbe7a406a3260db8dd358</a>\n<strong>Lines 4 &amp; 26</strong></p>\n"}, {"tags": ["c", "data-structures", "struct", "fifo"], "comments": [{"owner": {"reputation": 12194, "user_id": 4474419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ce27f0ebe4713b51911cd8475c3b42?s=128&d=identicon&r=PG", "display_name": "Davislor", "link": "https://stackoverflow.com/users/4474419/davislor"}, "edited": false, "score": 1, "creation_date": 1524012360, "post_id": 49889361, "comment_id": 86794966, "body": "There are numerous issues with this code, including that <code>Possoas</code> and <code>pessoas</code> are different identifiers. Your FIFO implementation is probably not what you want, either; were you trying for a circular buffer? You&#39;d get that by taking the index modulo the array size. And if your FIFO is an array of structures, you would want to copy each structure to it with <code>memcpy()</code>. You might want to be sure you&#39;re using the data structure you meant to."}, {"owner": {"reputation": 588, "user_id": 7067224, "user_type": "registered", "profile_image": "https://graph.facebook.com/1307022785978070/picture?type=large", "display_name": "Gabriel Pellegrino", "link": "https://stackoverflow.com/users/7067224/gabriel-pellegrino"}, "edited": false, "score": 0, "creation_date": 1524013714, "post_id": 49889361, "comment_id": 86795239, "body": "Note that pessoas is global, so you dont need to pass it as a parameter in your main function! Also, observe that pinicial is a local variable and you&#39;re losing it&#39;s value every time you return from qstore."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524019026, "post_id": 49889361, "comment_id": 86796349, "body": "I applied the <code>gcc</code> compiler to the posted code.  The result was LOTS of warning and some error messages.  When compiling, always enable the warning, then fix those warnings.  ( for <code>gcc</code>, at a minimum use: <code>-Wall -Wextra -Wconversion -pedantic -std=gnu11</code> )"}, {"owner": {"reputation": 2048, "user_id": 4961259, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/9b82c25cbde4d52888e6eccc44764b80?s=128&d=identicon&r=PG&f=1", "display_name": "Kami Kaze", "link": "https://stackoverflow.com/users/4961259/kami-kaze"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1524030781, "post_id": 49889361, "comment_id": 86799713, "body": "@user3629249 I would recommend to use -std=C99 or some other C standard else you might lose portability."}], "answers": [{"tags": [], "owner": {"reputation": 57, "user_id": 8939186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ihHaV.png?s=128&g=1", "display_name": "nakarthikeya", "link": "https://stackoverflow.com/users/8939186/nakarthikeya"}, "is_accepted": false, "score": 0, "last_activity_date": 1524043498, "creation_date": 1524043498, "answer_id": 49895979, "question_id": 49889361, "link": "https://stackoverflow.com/questions/49889361/how-to-use-struct-with-fifo/49895979#49895979", "title": "How to use STRUCT with FIFO", "body": "<p>assume that pessoas is fifo memory.</p>\n\n<p>In cadastroPretendentes(), you are getting names and store into fifo memory and in qstore(), you are writing pessoas[0] with pessoas[0].</p>\n\n<p>if qstore is called another 2 times, 1st and 2nd elements in array will be replaced with pessoas[0].</p>\n\n<p>In this code, qstore is not required as cadastroPretendentes() gets name and stores in pessoas (fifo memory)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9466449"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 332, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524043498, "creation_date": 1524011486, "last_edit_date": 1524016491, "question_id": 49889361, "link": "https://stackoverflow.com/questions/49889361/how-to-use-struct-with-fifo", "title": "How to use STRUCT with FIFO", "body": "<p>I'm learning \"FIFO\" in C this is my first code trying to pass an struct by argument to FIFO function but it's not working as expected... And I can't figure why. Someone could please give me hand an explain what am I doing wrong?</p>\n\n<p>I wrote my code in portuguese if it's hard to you guys understand let me know I'll translate to english. </p>\n\n<pre><code>#define TAMANHO 3\n\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;locale.h&gt;\n\n\ntypedef struct\n{\n    char Nome[20];\n} pretendentes; \n\n\n\npretendentes // nome da estrutura\npessoas[10]; // vetor de estrutura\n\n\n\nint main(void)\n{\n    setlocale(LC_ALL, \"\");\n\n\n    cadastroPretendentes(pessoas);\n    qstore(pessoas);\n}\n\nvoid qstore(pretendentes *Pessoas)\n{\n    int pfinal   = 0;\n    int pinicial = 0;\n\n    if(pinicial == TAMANHO)\n    {\n        printf(\"A fila est\u00e1 cheia.\");\n        return;\n    }\n\n    pessoas[pinicial] = Pessoas.Nome;\n    pinicial++;\n}\n\nvoid cadastroPretendentes(pretendentes *Pessoas)\n{\n    int i;\n\n    for(i = 0; i &lt; TAMANHO; i++)\n    {\n        printf(\"Insira o nome do pretendente %d: \", i+1);\n        scanf(\"%s\", (*(Pessoas + i)).nome);\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "process", "signals", "fork"], "comments": [{"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524011102, "post_id": 49889300, "comment_id": 86794693, "body": "Why do you have there ridiculous constrains?"}, {"owner": {"reputation": 31, "user_id": 8706163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0952aff31444d08494836991fa89ef56?s=128&d=identicon&r=PG&f=1", "display_name": "ElizabethC", "link": "https://stackoverflow.com/users/8706163/elizabethc"}, "reply_to_user": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524011147, "post_id": 49889300, "comment_id": 86794702, "body": "My professor is crazy. haha!"}, {"owner": {"reputation": 673, "user_id": 2051953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00ad063b5c79e2eda7ed0bb429bedb73?s=128&d=identicon&r=PG", "display_name": "agbinfo", "link": "https://stackoverflow.com/users/2051953/agbinfo"}, "edited": false, "score": 0, "creation_date": 1524013405, "post_id": 49889300, "comment_id": 86795192, "body": "This might help : <a href=\"http://www.gnu.org/software/libc/manual/html_node/Signaling-Another-Process.html#Signaling-Another-Process\" rel=\"nofollow noreferrer\">gnu.org/software/libc/manual/html_node/&hellip;</a> If you&#39;re wondering how to send values, just use two different signals and send binary values"}, {"owner": {"reputation": 767708, "user_id": 14860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vXG1F.png?s=128&g=1", "display_name": "paxdiablo", "link": "https://stackoverflow.com/users/14860/paxdiablo"}, "edited": false, "score": 0, "creation_date": 1524014665, "post_id": 49889300, "comment_id": 86795475, "body": "I&#39;m tempted to close-vote but I can&#39;t find the &quot;this is a damn stupid idea&quot; reason :-)"}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524052537, "post_id": 49889300, "comment_id": 86813599, "body": "well, if the only means to pass is using signals, then passing values as exit codes is not affordable, as <code>exit(2)</code> system call doesn&#39;t use the signal passing way.  PLEASE, EDIT YOUR QUESTION AND WRITE A PROPER REQUIREMENT, AS THE ONE USED IS AMBIGUOUS AND UNCLEAR. Voted for close, as unclear question."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524052997, "post_id": 49889300, "comment_id": 86813887, "body": "@ElizabethC, the problem you are posting is far more difficult to solve, exclusively with signals, than required from a beginners course on unix.  Probably you have missed something or your teacher has not expressed correctly the exercise.   Please, ask him for a clarification."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524054017, "post_id": 49889300, "comment_id": 86814488, "body": "@Pablo, constraints are far from ridiculous.  The problem, that can be solved in several ways, with just only one signal type (better with a minimum of two different signal types) is a quite complex one, as it requires to develop a comms protocol to do sender synchronization and the like.  I think this is a homework for a unix beginners course, and so, it&#39;s far out of scope."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 767708, "user_id": 14860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vXG1F.png?s=128&g=1", "display_name": "paxdiablo", "link": "https://stackoverflow.com/users/14860/paxdiablo"}, "edited": false, "score": 0, "creation_date": 1524054506, "post_id": 49889300, "comment_id": 86814805, "body": "@paxdiablo, I agree on the <i>stupid idea</i>, anyway :)"}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "reply_to_user": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524075898, "post_id": 49889300, "comment_id": 86828928, "body": "@LuisColorado <i>... is a quite complex one, as it requires to develop a comms protocol to do sender synchronization and the like. I think this is a homework for a unix beginners course, and so, it&#39;s far out of scope.</i> That&#39;s why I say it&#39;s a ridiculous constrain, when you can easily write the program using shared memory or pipes."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "reply_to_user": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1524078655, "post_id": 49889300, "comment_id": 86830405, "body": "@Pablo, indeed to learn, the constraint is not ridiculous.... indeed is quite amazing to solve a problem like this.  But it&#39;s far out of scope for a unix beginner&#39;s class."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524079330, "post_id": 49889300, "comment_id": 86830792, "body": "@ElizabethC, when is your deadline? so I can guess if I can be able to work a solution to comply with it."}, {"owner": {"reputation": 31, "user_id": 8706163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0952aff31444d08494836991fa89ef56?s=128&d=identicon&r=PG&f=1", "display_name": "ElizabethC", "link": "https://stackoverflow.com/users/8706163/elizabethc"}, "edited": false, "score": 0, "creation_date": 1524095498, "post_id": 49889300, "comment_id": 86837138, "body": "Deadline is this Saturday! This is a continuation of our first project. The first project we had to use shared memory which I did so easily. But now the next part of the project is to replace shared memory and only use signals. Which I am completely stuck on !"}, {"owner": {"reputation": 31, "user_id": 8706163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0952aff31444d08494836991fa89ef56?s=128&d=identicon&r=PG&f=1", "display_name": "ElizabethC", "link": "https://stackoverflow.com/users/8706163/elizabethc"}, "edited": false, "score": 0, "creation_date": 1524095529, "post_id": 49889300, "comment_id": 86837144, "body": "This is for my intro to Operating Systems course at my University. My professor is pretty difficult and likes to challenge us I guess.."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524142989, "post_id": 49889300, "comment_id": 86859208, "body": "You&#39;ll get the answer on sunday then... sorry, but being a scholar work, challenges have their value, and I don&#39;t want to break your teacher intentions.  I have already written the code, but I&#39;m afraid this is not the way your teacher wants the problem solved.  My apologies for the delay."}], "answers": [{"comments": [{"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524053316, "post_id": 49889865, "comment_id": 86814084, "body": "while the <code>rt_sigqueueinfo()</code> is a linux (specific???) syscall that allows the target process to identify the pid of the sinding process, the coding of a solution using those syscalls is far out of scope, as those syscalls don&#39;t have C bindings in glibc (this is noted in the man page you posted in your comment) so a workaround should be made in assembler to use them.  IMHO the teacher has different requirements or the poster has not understood the exact requirements."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524053501, "post_id": 49889865, "comment_id": 86814188, "body": "the example you post to illustrate uses shared memory segments to pass the information to the parent.  I assume this is out of scope from the message posted."}, {"owner": {"reputation": 648, "user_id": 5694959, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TN18H3fTni4/AAAAAAAAAAI/AAAAAAAAAA8/HH8MErbPvAI/photo.jpg?sz=128", "display_name": "Monk", "link": "https://stackoverflow.com/users/5694959/monk"}, "reply_to_user": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524054424, "post_id": 49889865, "comment_id": 86814746, "body": "Can you specifically tell where example that i posted uses shared memory segments."}, {"owner": {"reputation": 648, "user_id": 5694959, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TN18H3fTni4/AAAAAAAAAAI/AAAAAAAAAA8/HH8MErbPvAI/photo.jpg?sz=128", "display_name": "Monk", "link": "https://stackoverflow.com/users/5694959/monk"}, "reply_to_user": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524054508, "post_id": 49889865, "comment_id": 86814807, "body": "yes, rt_sigqueueinfo() is linux specific, we can use sigqueue() as substitute for that. I also mentioned sigqueue()."}, {"owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "edited": false, "score": 0, "creation_date": 1524054632, "post_id": 49889865, "comment_id": 86814906, "body": "Nope, just <code>sigaction(2)</code> in POSIX mode, allows you to identify the sender of the signal, so no bus reservation protocol has to be implemented to differentiate.... but anyway, the problem is far out of scope in a unix beginners course."}], "tags": [], "owner": {"reputation": 648, "user_id": 5694959, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TN18H3fTni4/AAAAAAAAAAI/AAAAAAAAAA8/HH8MErbPvAI/photo.jpg?sz=128", "display_name": "Monk", "link": "https://stackoverflow.com/users/5694959/monk"}, "is_accepted": false, "score": 0, "last_activity_date": 1524016087, "last_edit_date": 1524016087, "creation_date": 1524015745, "answer_id": 49889865, "question_id": 49889300, "link": "https://stackoverflow.com/questions/49889300/how-to-pass-multiple-values-from-child-to-parent-process-using-signals-in-c/49889865#49889865", "title": "How to pass multiple values from child to parent process using signals in C?", "body": "<p>Send signal from child to parent using <a href=\"http://man7.org/linux/man-pages/man2/rt_sigqueueinfo.2.html\" rel=\"nofollow noreferrer\">rt_sigqueueinfo()</a>. You can use <a href=\"http://man7.org/linux/man-pages/man3/sigqueue.3.html\" rel=\"nofollow noreferrer\">sigqueue()</a> as well.</p>\n\n<p>Please refer this example\n<a href=\"https://github.com/aditya723/system-programming/blob/master/send_data_using_signal.c\" rel=\"nofollow noreferrer\">send signal to parent with data</a></p>\n"}, {"tags": [], "owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "is_accepted": false, "score": 0, "last_activity_date": 1524396481, "last_edit_date": 1592644375, "creation_date": 1524396120, "answer_id": 49965333, "question_id": 49889300, "link": "https://stackoverflow.com/questions/49889300/how-to-pass-multiple-values-from-child-to-parent-process-using-signals-in-c/49965333#49965333", "title": "How to pass multiple values from child to parent process using signals in C?", "body": "<p>Well, as I promised in one of the comments, here's a solution to the problem.  The first thing to say is that this solution does not work properly in Linux, as linux makes no warrant of signal delivery on high number of signals sent (when the target process doesn't get scheduled enough to handle them) so a BSD version has been used (also should run, but not tested on Mac OS/X and other unices).  I'll explain the solution achieved in four steps, as the first probably is enough to pass the homework, but not enough to consider it a proper working way of passing information from child to parent. Also, due to limited space to post code, I've posted only the first version of the code and all the others must be downloaded from github (links provided).</p>\n<p>The implementation has been made on a raspberry pi with freebsd 11.0 which makes delivery of signals reliable.  The failing system was a Debian 9.4 with kernel version 4.9.0-6-amd64</p>\n<h1>FIRST VERSION</h1>\n<p>As the homework problem states, the only thing the parent is to do is to add the numbers and print the result.  Then, a good plan is to encode a number, <code>N</code>, to the parent, as sending <code>n</code> signals of type <code>SIGUSR1</code>.  The parent has only to count the signals and print the number when the child finishes (we determine this on a succesful return from the <code>wait(2)</code> system call)</p>\n<h1>child.c</h1>\n<pre><code>/* 00001 */ #include &lt;sys/types.h&gt;\n/* 00002 */ #include &lt;sys/time.h&gt;\n/* 00003 */ #include &lt;signal.h&gt;\n/* 00004 */ #include &lt;stdio.h&gt;\n/* 00005 */ #include &lt;stdlib.h&gt;\n/* 00006 */ #include &lt;unistd.h&gt;\n/* 00007 */ #include &lt;time.h&gt;\n\n/* 00008 */ #define F(fmt) &quot;&lt;%d&gt;:&quot;__FILE__&quot;:%d:%s: &quot; fmt, my_pid, __LINE__, __func__\n\n/* 00009 */ pid_t my_pid;\n\n/* 00010 */ int main()\n/* 00011 */ {\n/* 00012 */         pid_t parent_pid = getppid();\n/* 00013 */         struct timeval now;\n/* 00014 */         gettimeofday(&amp;now, NULL);\n/* 00015 */         srand((int)now.tv_sec ^ (int)now.tv_usec);\n/* 00016 */         my_pid = getpid();\n/* 00017 */         int sum = 0;\n\n/* 00018 */         int n = rand() % 3 + 1;\n/* 00019 */         int i;\n/* 00020 */         for (i = 0; i &lt; n; i++) {\n/* 00021 */                 int number = rand() % 10 + 10;\n/* 00022 */                 printf(F(&quot;Sending %d\\n&quot;), number);\n/* 00023 */                 int j;\n/* 00024 */                 for (j = 0; j &lt; number; j++) {\n/* 00025 */                         printf(F(&quot;kill(%d, SIGUSR1);\\n&quot;), parent_pid);\n/* 00026 */                         kill(parent_pid, SIGUSR1);\n/* 00027 */                 }\n/* 00028 */                 sum += number;\n/* 00029 */         }\n/* 00030 */         printf(F(&quot;my sum = %d\\n&quot;), sum);\n/* 00031 */ }\n</code></pre>\n<p>(each child selects at random a number between 1 and 4 numbers, randomly in the range 10...19, and sends that number of <code>SIGUSR1</code> signals to the parent)</p>\n<p>The parent is so:</p>\n<h1>parent.c</h1>\n<pre><code>/* 00001 */ #include &lt;errno.h&gt;\n/* 00002 */ #include &lt;signal.h&gt;\n/* 00003 */ #include &lt;stdio.h&gt;\n/* 00004 */ #include &lt;stdlib.h&gt;\n/* 00005 */ #include &lt;string.h&gt;\n/* 00006 */ #include &lt;sys/time.h&gt;\n/* 00007 */ #include &lt;sys/types.h&gt;\n/* 00008 */ #include &lt;sys/wait.h&gt;\n/* 00009 */ #include &lt;time.h&gt;\n/* 00010 */ #include &lt;unistd.h&gt;\n\n/* 00011 */ #define F(fmt) &quot;[%d]:&quot;__FILE__&quot;:%d:%s: &quot; fmt, my_pid, __LINE__, __func__\n\n/* 00012 */ #define NCHILDREN 8\n\n/* 00013 */ char child[] = &quot;child&quot;;\n\n/* 00014 */ pid_t my_pid;\n\n/* 00015 */ int sum = 0; /* here's where the number of signals is accumulated */\n\n/* 00016 */ void handler(int sig, siginfo_t *info, void *unused)\n/* 00017 */ {\n/* 00018 */         switch (sig) {\n/* 00019 */         case SIGUSR1: sum++; break;\n/* 00020 */         }\n/* 00021 */ }\n\n/* 00022 */ int main()\n/* 00023 */ {\n/* 00024 */         int i;\n\n/* 00025 */         my_pid = getpid();\n\n/* 00026 */         struct sigaction sa, oldsa; \n/* 00027 */         sa.sa_sigaction = handler;\n/* 00028 */         sa.sa_flags = SA_RESTART; /* restart the wait(2) syscall below */\n/* 00029 */         sigemptyset(&amp;sa.sa_mask);\n/* 00030 */         sigaddset(&amp;sa.sa_mask, SIGUSR1);\n/* 00031 */         sigaction(SIGUSR1, &amp;sa, &amp;oldsa);\n\n/* 00032 */         pid_t res;\n\n/* 00033 */         for (i = 0; i &lt; NCHILDREN; i++) {\n/* 00034 */                 res = fork();\n/* 00035 */                 if (res &gt; 0) /* parent */\n/* 00036 */                         continue;\n/* 00037 */                 else if (res &lt; 0) {\n/* 00038 */                         fprintf(stderr,\n/* 00039 */                                 F(&quot;ERROR: fork: %s (errno = %d)\\n&quot;),\n/* 00040 */                                 strerror(errno), errno);\n/* 00041 */                         exit(EXIT_FAILURE);\n/* 00042 */                 } else { /* child */\n/* 00043 */                         execlp(child, child, NULL);\n/* 00044 */                         fprintf(stderr,\n/* 00045 */                                 F(&quot;ERROR: exec: %s: %s (errno = %d)\\n&quot;),\n/* 00046 */                                 child, strerror(errno), errno);\n/* 00047 */                         exit(EXIT_FAILURE);\n/* 00048 */                 }\n/* 00049 */         }\n\n/* 00050 */         while (wait(NULL) &gt;= 0); /* wait for children until no more */\n\n/* 00051 */         sigaction(SIGUSR1, &amp;oldsa, NULL);\n\n/* 00052 */         printf(F(&quot;sum = %d\\n&quot;), sum);\n/* 00053 */ }\n</code></pre>\n<p>This example will make the parent to print the correct sum, as you can probe (linux fails dramatically printing in some cases just <code>sum = 1</code>, because it is only capable of processing the first signal of each type, leading to a single number of value 1)  The problem with linux is that linux cannot ensure and deliver several signals if the receiver has not been scheduled enough for the system to be able to the signals and allow the handler to be called. Just inserting a <code>sleep(1)</code> in <code>child.c</code> after the <code>kill(2)</code> syscall of line <code>60</code> will do.</p>\n<p>Many readers will complaint about the way the solution is implemented, as this is not a good way to pass info to the parent (no form of delimiting the numbers themselves to allow the parent to separate and identify them), and some way to differentiate the different numbers passed and someway to identify the sender to be included.  So the parent not only wants to print the sum, but also which number comes from which child or a way to separate the different numbers for each child.</p>\n<h1>SECOND VERSION(first attempt)</h1>\n<p>In this version, we introduce the <code>sigaction(2)</code> syscall and its possibility of getting in the signal handler a way to identify the sender of such signal (<code>SA_SIGINFO</code> POSIX option).  I refer the reader to the manual page, as it is well documented there (even for linux, that continues to handle signals without warrant the signal delivery) and <a href=\"https://github.com/mojadita/signals/tree/V2\" rel=\"nofollow noreferrer\">files can be downloaded from here</a></p>\n<p>Parent is far more complicated.  It has a table for each child and a handler that extracts the signal's sender pid, searches for the child slot, and stores in it the accumulated number of signals received, and handling the <code>SIGUSR2</code> signal as an end of data marker, that allows us to store the accumulated value.</p>\n<p>The parent now prints the numbers received from each child and, if you try this example, <strong>you'll see another issue</strong>:  The kernel does not warrant the order in which signals are delivered.  This means that some <code>SIGUSR1</code> signals belonging to a next number are handled before the <code>SIGUSR2</code> signal finishing the previous number.  So we cannot send new <code>SIGUSR1</code> signals until the last <code>SIGUSR2</code> signal has been sent <em>and handled</em>.  We correct this introducing a delay <code>sleep(1)</code> in the next version:</p>\n<h1>THIRD VERSION (with delays)</h1>\n<p>On this version we introduce delays into the child program, so no number is sent until we have given time to the parent to handle all the pending signals.  In this way, no <code>SIGUSR2</code> corresponding to a next number is sent to the parent process before it has had time to process it.  <a href=\"https://github.com/mojadita/signals/tree/V3_delays/\" rel=\"nofollow noreferrer\">These are the files for this version</a></p>\n<p>In this case, you'll observe the output is delayed at several points to allow for the parent to have the time to deliver pending signals before sending new ones.</p>\n<h1>VERSION FOUR (final version)</h1>\n<p>Our final approach tries to eliminate the delays, making the parent to send a signal to the child as soon as he has received a <code>SIGUSR2</code>, indicating the end of a number, to acknowledge the reception of the number and to allow the child to continue.  I'll comment at the end some race condition, that can be saved with some code already included on it (As i'm limited in post space, I'll publish it on github and <a href=\"https://github.com/mojadita/signals\" rel=\"nofollow noreferrer\">allow you to download it from there</a>)</p>\n<h1>COMMENT ON THE RACE CONDITION</h1>\n<p>On final version, there's an unavoidable race condition in the child, as we cannot enable interrupts while in <code>pause(2)</code> syscall, so we cannot enter in the <code>pause(2)</code> system call with interrupts blocked, to unblock them inside and listen for the next interrupt. The lines in <code>child.c</code>:</p>\n<pre><code>00061:      printf(F(&quot;kill(%d, SIGUSR2);\\n&quot;), parent_pid);\n00062:      sigprocmask(SIG_BLOCK, &amp;sa.sa_mask, NULL);\n00063:      yet_unacknowledged = 1;\n00064:      kill(parent_pid, SIGUSR2);\n00065:      sigprocmask(SIG_UNBLOCK, &amp;sa.sa_mask, NULL);\n00066:      while (yet_unacknowledged) sleep(1);\n</code></pre>\n<p>allow for the parent to be scheduled, send the ack signal, and the signal be handled between the check for <code>yet_unacknowledged</code> in the while loop and the <code>sleep(1)</code> statement.  These lines where written initially as:</p>\n<pre><code>00066:      pause();  /* wait for an interrupt */\n</code></pre>\n<p>but this way, sometimes the child gets blocked as the acknowledge signal has been delivered (and handled) between the <code>kill</code> from the child to the parent and the <code>pause(2)</code> syscall.</p>\n<p>But after checking that there's no way to enable <code>SIGUSR2</code> interrupts while executing <code>pause()</code> the only way to proceed is to consider that the handler has executed in between and execute just single <code>sleep(1)</code> once.  Next loop pass, the check will fail and, at most we execute only one <code>sleep</code> call.</p>\n<h1>How to implement all of this in linux</h1>\n<p>Well, I have extended far more from my original target, and I will not show a complete working solution in linux.  As linux cannot ensure that more of one signal is warranted to be delivered to a process, the only way to implement is to install a mechanism for the parent to acknowledge each received signal, and the child not to send the next signal until it has received the acknowledge of the previous.  This is completeley out of scope for a beginners course on introduction to system calls (better on a course of networking protocols), so if you are interested, you'll have to ask your teacher for more info on this.</p>\n"}], "owner": {"reputation": 31, "user_id": 8706163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0952aff31444d08494836991fa89ef56?s=128&d=identicon&r=PG&f=1", "display_name": "ElizabethC", "link": "https://stackoverflow.com/users/8706163/elizabethc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 833, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1524396481, "creation_date": 1524010995, "last_edit_date": 1524011230, "question_id": 49889300, "link": "https://stackoverflow.com/questions/49889300/how-to-pass-multiple-values-from-child-to-parent-process-using-signals-in-c", "title": "How to pass multiple values from child to parent process using signals in C?", "body": "<p>I have to pass 3 separate values, say \"10\", \"15\", \"20\" that are stored in a child process to a parent process. I cannot use shared memory or pipes, only signals and handlers. How do I pass these values from a child to parent only using signals? I tried passing exit codes but you can only have one exit value. I need to pass 3 separate values. Any suggestions? In addition, my parent has two children. Both of these children have to pass 3 separate values of their own to the parent, so that the parent can add them in the end. </p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1524009636, "post_id": 49889145, "comment_id": 86794387, "body": "The first would produce wrong results if the line is longer than <code>BUFSIZ</code>"}, {"owner": {"reputation": 4328, "user_id": 920069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd39f0db1f22e1314746491df063602a?s=128&d=identicon&r=PG", "display_name": "Retired Ninja", "link": "https://stackoverflow.com/users/920069/retired-ninja"}, "edited": false, "score": 1, "creation_date": 1524009650, "post_id": 49889145, "comment_id": 86794389, "body": "What happens when <code>i &gt; 1023</code> and you write outside the bounds of your array?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1524009763, "post_id": 49889145, "comment_id": 86794419, "body": "And yep, why do you even need a <code>filearray</code> in the #2?"}, {"owner": {"reputation": 673, "user_id": 2051953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00ad063b5c79e2eda7ed0bb429bedb73?s=128&d=identicon&r=PG", "display_name": "agbinfo", "link": "https://stackoverflow.com/users/2051953/agbinfo"}, "edited": false, "score": 0, "creation_date": 1524009829, "post_id": 49889145, "comment_id": 86794435, "body": "So you want us to do your homework?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8753900"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1524009882, "post_id": 49889145, "comment_id": 86794443, "body": "@zerkms Where would I store the characters read if I do not have a file array?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8753900"}, "edited": false, "score": 0, "creation_date": 1524009910, "post_id": 49889145, "comment_id": 86794449, "body": "@abginfo No, this is not homework. I am only curious."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1524009925, "post_id": 49889145, "comment_id": 86794452, "body": "@AMD you have the current character in <code>c</code>, why do you need to keep all the characters?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8753900"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1524009970, "post_id": 49889145, "comment_id": 86794465, "body": "@zerkms Thank You for pointing it out. I did not realize that."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1524010000, "post_id": 49889145, "comment_id": 86794471, "body": "@AMD the thing that should have made you concerned is that <code>filearray</code> is not used anywhere (in #2)."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 1, "creation_date": 1524010553, "post_id": 49889145, "comment_id": 86794574, "body": "You&#39;ll have to define &quot;better&quot;. Faster? Less memory? Less chance of bugs?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8753900"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1524010991, "post_id": 49889145, "comment_id": 86794678, "body": "@Schwern Less chance of bugs"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524027096, "post_id": 49889145, "comment_id": 86798368, "body": "AMD, Should the last &quot;line&quot; in a file not end with a <code>&#39;\\n&#39;</code>, there is not wide agreement if this counts as a line. In C, &quot;Whether the last line requires a terminating new-line character is  implementation-defined.&quot;  C11 &#167;7.21.2 2.  For your purpose, you can defined that case any way you want, but since it is a not-so-uncommon case, best to document your choice."}, {"owner": {"reputation": 10753, "user_id": 1371329, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/oqbUC.png?s=128&g=1", "display_name": "jaco0646", "link": "https://stackoverflow.com/users/1371329/jaco0646"}, "edited": false, "score": 0, "creation_date": 1524096794, "post_id": 49889145, "comment_id": 86837440, "body": "This question belongs on <a href=\"https://codereview.stackexchange.com\">codereview.stackexchange.com</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4319, "user_id": 2027237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6457db0676be7f14f63e0f45aec333d?s=128&d=identicon&r=PG", "display_name": "anneb", "link": "https://stackoverflow.com/users/2027237/anneb"}, "is_accepted": false, "score": 0, "last_activity_date": 1524010949, "creation_date": 1524010949, "answer_id": 49889292, "question_id": 49889145, "link": "https://stackoverflow.com/questions/49889145/out-of-the-two-which-would-be-considered-better-code-less-chance-of-bugs-for-c/49889292#49889292", "title": "Out of the two which would be considered better code (less chance of bugs) for counting the number of lines in a text file?", "body": "<p>The first code example is a simple line reader, but it assumes that lines will always contain less than 1024 characters. If lines larger than 1024 characters exist, then they will be counted as multiple lines.</p>\n\n<p>The second code example has a dangerous bug. If the file contains more than 1024 characters, it will try to store the line data in unallocated memory. This will produce undefined behavior of your program (crashing, unexpected results, etc).</p>\n\n<p>If you really only need to count lines and nothing else, the second code is better, but you should remove the array. You don't need to remember the line information, thus discard those unneeded characters immediately.</p>\n"}, {"comments": [{"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1524011759, "post_id": 49889360, "comment_id": 86794824, "body": "Did you get the same answer from both?"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1524011800, "post_id": 49889360, "comment_id": 86794835, "body": "@user3386109 Yes. Good question. :)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8753900"}, "edited": false, "score": 0, "creation_date": 1524012709, "post_id": 49889360, "comment_id": 86795049, "body": "@Schwern What unit is ms?"}, {"owner": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "edited": false, "score": 1, "creation_date": 1524013241, "post_id": 49889360, "comment_id": 86795156, "body": "@AMD: &quot;ms&quot; is milliseconds."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1524021149, "post_id": 49889360, "comment_id": 86796827, "body": "Try <a href=\"http://man7.org/linux/man-pages/man3/getc_unlocked.3p.html\" rel=\"nofollow noreferrer\">getc_unlocked</a>. You can easily fix the <code>fgets</code> solution by only counting a line read if its last character is really a newline (or it&#39;s the last line in the file). That will slow it down a bit, though."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1524025306, "post_id": 49889360, "comment_id": 86797861, "body": "@rici <code>getc_unlocked</code> is indeed significantly faster, ~25ms, but that&#39;s a lot of caveats that I wouldn&#39;t feel safe using it. As for <code>fgets</code>, I thought about that. It that would require scanning each line for a newline twice; once inside <code>fgets</code> and again to look for the last character. Instead I looked at how <code>wc</code> does it. Similar idea, but instead of using <code>fgets</code> just use <code>fread</code> and count the newlines in each buffer. See the updated answer."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524026681, "post_id": 49889360, "comment_id": 86798263, "body": "@Schwern Parsing the buffer from <code>fgets()</code> is a problem should <i>null characters</i> get read.  Sticking with <code>fread()</code> is easier."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524026955, "post_id": 49889360, "comment_id": 86798327, "body": "@chux A good point! And I <i>finally</i> solved the no-final-newline problem efficiently. Geez, even <code>wc -l</code> doesn&#39;t handle this."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524028213, "post_id": 49889360, "comment_id": 86798731, "body": "@chux Thanks, fixed."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1524028244, "post_id": 49889360, "comment_id": 86798742, "body": "@schwern: <code>getc_unlocked</code> is perfectly safe in unthreaded code. It&#39;s also safe if only one thread is using that <code>FILE*</code>. Or, finally, you could use <code>flockfile</code>.  But one or both of the first two conditions is almost certainly true in the context of this question."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 2, "last_activity_date": 1524067768, "last_edit_date": 1524067768, "creation_date": 1524011471, "answer_id": 49889360, "question_id": 49889145, "link": "https://stackoverflow.com/questions/49889145/out-of-the-two-which-would-be-considered-better-code-less-chance-of-bugs-for-c/49889360#49889360", "title": "Out of the two which would be considered better code (less chance of bugs) for counting the number of lines in a text file?", "body": "<p>For the least chance of bugs, use <code>wc -l</code>. :) That's what I used to make sure I got this right. (Don't actually shell out to <code>wc -l</code> in a C program, shelling out to utilities is fraught with peril).</p>\n\n<p>Otherwise, <strong><em>if used properly</em></strong> they're both quite simple pieces of C code. <code>fgets</code> is maybe a bit simpler and <code>while( (c = getc(fp)) != EOF )</code> is quite easy to get wrong, but they're both very familiar C idioms.</p>\n\n<p>But <code>fgets</code> is clearly much faster.</p>\n\n<pre><code>int count_fgets( FILE *fp ) {\n    int count = 0;\n    char buf[1024];\n\n    while(fgets(buf, sizeof(buf), fp)) {\n        count++;\n    }\n\n    return count;\n}\n\nint count_getc( FILE *fp ) {\n    int count = 0;\n    int c;\n\n    while( (c = getc(fp)) != EOF ) {\n        if( c == '\\n' ) {\n            count++;\n        }\n    }\n\n    return count;\n}\n</code></pre>\n\n<p>Running this over the <a href=\"https://www.gutenberg.org/files/2600/2600-0.txt\" rel=\"nofollow noreferrer\">Gutenburg text edition of War and Peace</a> (which is technically UTF-8, and this is only for ASCII, but it doesn't matter for our purposes) I get...</p>\n\n<ul>\n<li><code>wc -l</code>: ~15ms</li>\n<li><code>count_getc</code>: ~190ms</li>\n<li><code>count_fgets</code>: ~15ms</li>\n</ul>\n\n<p>I'm a bit surprised there's such a large difference and I'm not sure why.</p>\n\n<hr>\n\n<p><strong><em>UPDATE</em></strong></p>\n\n<p>After seeing <a href=\"https://stackoverflow.com/a/49889774/14660\">@chux's answer</a> and edge cases, I decided to see <a href=\"https://github.com/coreutils/coreutils/blob/master/src/wc.c#L298\" rel=\"nofollow noreferrer\">how <code>wc</code> does it</a>. It goes something like this.</p>\n\n<pre><code>int count_wc( FILE *fp ) {\n    char buf[BUF_SIZ];\n    size_t bytes_read;\n    int count = 0;\n\n    while( (bytes_read = fread( buf, sizeof(char), sizeof(buf), fp )) &gt; 0 ) {\n        char *p = buf;\n        char *end = p + bytes_read;\n        while (p != end) {\n            if( *p++ == '\\n' ) {\n                count++;\n            }\n        }\n    }\n\n    return count;\n}\n</code></pre>\n\n<p>Read a chunk, look for newlines, repeat. Pretty simple once you see it. But it <em>still</em> only counts newlines. If you want to catch that last line, you can remember the last character in each buffer and look at it outside the loop. This will be the last character in the stream.</p>\n\n<pre><code>int count_wc( FILE *fp ) {\n    char buf[BUFSIZ];\n    size_t bytes_read;\n    int count = 0;\n\n    char last = '\\n';\n\n    // Count all the newlines.\n    while( (bytes_read = fread( buf, sizeof(char), sizeof(buf), fp )) &gt; 0 ) {\n        char *p = buf;\n        char *end = p + bytes_read;\n\n        while (p != end) {\n            if( *p++ == '\\n' ) {\n                count++;\n            }\n        }\n\n        last = *(end-1);\n    }\n\n    // If the last character in the file isn't a newline,\n    // count that last line.\n    if( last != '\\n' ) {\n        count++;\n    }\n\n    return count;\n}\n</code></pre>\n\n<p>This is the fastest, usually about 11ms, and I believe most correct.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8753900"}, "edited": false, "score": 0, "creation_date": 1524017832, "post_id": 49889774, "comment_id": 86796127, "body": "What is address performance?"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 1, "creation_date": 1524021052, "post_id": 49889774, "comment_id": 86796797, "body": "@AMD The phrase <i>&quot;then address performance&quot;</i> is short for <i>&quot;then think about how to improve the performance of the code&quot;</i>. As Schwern found out, the <code>fgets</code> solution is much faster than the <code>fgetc</code> solution. So solution #4, which uses <code>fgets</code>, but correctly handles line truncation, is the best solution (it&#39;s correct <i>and</i> fast)."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1524024981, "post_id": 49889774, "comment_id": 86797779, "body": "@chux After reading your answer I looked at how <code>wc</code> does it as it&#39;s both correct and fast. <a href=\"https://stackoverflow.com/a/49889360/14660\">Read a buffer, count the newlines, repeat</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8753900"}, "edited": false, "score": 0, "creation_date": 1524087322, "post_id": 49889774, "comment_id": 86834645, "body": "@chux: If a file is one long line why does fgets reports as 2 and getc as 1?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 1, "creation_date": 1524088168, "post_id": 49889774, "comment_id": 86834979, "body": "@AMD 1st, <code>char filearray[1024]; ... fgets(filearray, BUFSIZ, infile)</code> is poorly coded.  It should be <code>fgets(filearray, sizeof filearray, infile)</code>.  That reads up to 1023 characters and counts that as a line.  It then reads (2000-1023 per this answer&#39;s long line example) on the second iteration.   Net result: <code>count++;</code> called twice.  <code>getc()</code> only sees 1 <code>&#39;\\n&#39;</code>."}], "tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": false, "score": 3, "last_activity_date": 1524015468, "last_edit_date": 1524015468, "creation_date": 1524015034, "answer_id": 49889774, "question_id": 49889145, "link": "https://stackoverflow.com/questions/49889145/out-of-the-two-which-would-be-considered-better-code-less-chance-of-bugs-for-c/49889774#49889774", "title": "Out of the two which would be considered better code (less chance of bugs) for counting the number of lines in a text file?", "body": "<blockquote>\n  <p>I was wondering which is a better option and why or are they both the same and why?</p>\n</blockquote>\n\n<p>They are not the same.</p>\n\n<p>The first approach (<code>fgets()</code>) reports 1 if the file was <code>\"abc\"</code>.  The second  approach (<code>getc()</code>) reports 0.</p>\n\n<p>If the file is one long line (2000 characters `\"xxx..xxx\\n\"), the first reports 2, the second reports 1.</p>\n\n<hr>\n\n<p>Instead consider a 3rd approach that counts the number of times the beginning of a line was seen which reports 1 for both cases mentioned above.</p>\n\n<pre><code>int c;\nint previous = '\\n';\nfor ((c = getc(infile)) != EOF) {\n  if (previous == '\\n') count++;\n  previous = c;\n}\n</code></pre>\n\n<p>In terms of \"better\", the first consideration is getting the correct functionality, then address performance.  I'd choose <a href=\"https://blog.codinghorror.com/monty-hall-monty-fall-monty-crawl/\" rel=\"noreferrer\">door #3</a></p>\n\n<hr>\n\n<p>BTW, the line count can exceed <code>INT_MAX</code>.  Go for a wide type</p>\n\n<pre><code>unsigned long long count = 0;\n...\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8753900"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "closed_date": 1524152283, "answer_count": 3, "score": 0, "last_activity_date": 1524087657, "creation_date": 1524009527, "last_edit_date": 1524087657, "question_id": 49889145, "link": "https://stackoverflow.com/questions/49889145/out-of-the-two-which-would-be-considered-better-code-less-chance-of-bugs-for-c", "closed_reason": "Opinion-based", "title": "Out of the two which would be considered better code (less chance of bugs) for counting the number of lines in a text file?", "body": "<p>I want to count the number of lines in a text file, I was able to do that using two different ways. I was wondering which is a better option and why or are they both the same and why?</p>\n\n<p>Code Snippet #1:</p>\n\n<pre><code>{\n FILE *infile;\n int count=0;\n char filearray[1024];\n\n infile=fopen(filename,\"r\");\n\n if(infile==NULL)\n   {\n    perror(\"Could not open file\");\n    exit(EXIT_FAILURE);\n   }\n\n   while(fgets(filearray, BUFSIZ, infile) != NULL) \n   {\n      count++;\n   }\n\n}\n</code></pre>\n\n<p>Code Snipppet #2</p>\n\n<pre><code>{\n  FILE *infile;\n  int c,count=0;\n\n  infile=fopen(filename,\"r\");\n\n  if(infile==NULL)\n   {\n     perror(\"Could not open file\");\n     exit(EXIT_FAILURE);\n    }\n\n   for (c = getc(infile); c != EOF; c = getc(infile))\n    {\n     if(c=='\\n')\n     count++;\n   }\n\n }\n</code></pre>\n"}, {"tags": ["c", "wav"], "comments": [{"owner": {"reputation": 13984, "user_id": 501126, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/839de8a602b21abf36e020bcb32959fe?s=128&d=identicon&r=PG", "display_name": "nemequ", "link": "https://stackoverflow.com/users/501126/nemequ"}, "edited": false, "score": 0, "creation_date": 1524009313, "post_id": 49889045, "comment_id": 86794318, "body": "Perhaps the struct needs to be packed? Take a look at sizeof(struct HEADER) and see if it matches what you expect. What compiler are you using (they pretty much all support packed struct, but the syntax differs)? Also maybe the data is stored in big endian? Are you sure the data isn&#39;t corrupt? Do media players have any trouble with it? It&#39;s really hard to tell what might be wrong unless you post the file in question somewhere\u2026"}, {"owner": {"reputation": 421, "user_id": 7530306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b20f6a2dbb1858071e0473c6bebee5d?s=128&d=identicon&r=PG&f=1", "display_name": "sf8193", "link": "https://stackoverflow.com/users/7530306/sf8193"}, "reply_to_user": {"reputation": 13984, "user_id": 501126, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/839de8a602b21abf36e020bcb32959fe?s=128&d=identicon&r=PG", "display_name": "nemequ", "link": "https://stackoverflow.com/users/501126/nemequ"}, "edited": false, "score": 0, "creation_date": 1524010608, "post_id": 49889045, "comment_id": 86794586, "body": "@nemequ I know the struct doesn&#39;t need to be packed because I have tried this code on numerous other files and it has worked. I am using gcc version 4.8.5. In my code I make sure to change the endianness when necesarry. I can play the data and it works fine, but maybe I have corrupted the header somehow?"}, {"owner": {"reputation": 13984, "user_id": 501126, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/839de8a602b21abf36e020bcb32959fe?s=128&d=identicon&r=PG", "display_name": "nemequ", "link": "https://stackoverflow.com/users/501126/nemequ"}, "edited": false, "score": 0, "creation_date": 1524010918, "post_id": 49889045, "comment_id": 86794668, "body": "Hard to tell without an MCVE."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2404501"}, "edited": false, "score": 1, "creation_date": 1524011507, "post_id": 49889045, "comment_id": 86794779, "body": "The first 4 bytes aren&#39;t even &quot;RIFF&quot;. This doesn&#39;t look like a wav at all. Actually it looks like an mp4, for which &quot;isom&quot; is a known type tag meaning &quot;ISO media&quot;."}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "reply_to_user": {"reputation": 13984, "user_id": 501126, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/839de8a602b21abf36e020bcb32959fe?s=128&d=identicon&r=PG", "display_name": "nemequ", "link": "https://stackoverflow.com/users/501126/nemequ"}, "edited": false, "score": 0, "creation_date": 1524016272, "post_id": 49889045, "comment_id": 86795841, "body": "@nemequ It doesn&#39;t need to be packed because all fields in wav header are designed to provide natural alignment (e.g. all <code>int</code> fields are at offsets that are a multiple of 4). The wav header predates the existence of packed structs, so it handled it with careful design."}, {"owner": {"reputation": 22495, "user_id": 5382650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/THfCr.png?s=128&g=1", "display_name": "Craig Estey", "link": "https://stackoverflow.com/users/5382650/craig-estey"}, "edited": false, "score": 0, "creation_date": 1524016858, "post_id": 49889045, "comment_id": 86795939, "body": "You should do your <code>fread</code> on the <i>entire</i> <code>struct HEADER header</code> vs just the <code>riff</code> part--it&#39;s a fixed size/invariant struct that is the same length regardless of the length of the sub-sections that follow. Then, do endian reverse on the individual <code>int</code> fields [<i>if</i> necessary]. IIRC [and I could be wrong], wav headers are little-endian to begin with."}, {"owner": {"reputation": 1595, "user_id": 1119161, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/4941b50fab94bddbe63b102f2c79d2da?s=128&d=identicon&r=PG", "display_name": "dsp_user", "link": "https://stackoverflow.com/users/1119161/dsp-user"}, "edited": false, "score": 0, "creation_date": 1524039740, "post_id": 49889045, "comment_id": 86804683, "body": "This isn&#39;t (always) going to work even if it were a wav file. You shouldn&#39;t assume that the format (fmt) chunk starts at offset 12 (HEADER.fmt_chunk_marker). &#39;fmt&#39; and &#39;data` chunks are mandatory but you should parse the file to find them and not rely on fixed offsets."}, {"owner": {"reputation": 421, "user_id": 7530306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b20f6a2dbb1858071e0473c6bebee5d?s=128&d=identicon&r=PG&f=1", "display_name": "sf8193", "link": "https://stackoverflow.com/users/7530306/sf8193"}, "edited": false, "score": 0, "creation_date": 1524067970, "post_id": 49889045, "comment_id": 86824563, "body": "update: I realized the file was getting converted to a jpg and that&#39;s why the data was becoming misaligned. Thanks for the help!"}], "answers": [{"tags": [], "owner": {"reputation": 421, "user_id": 7530306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b20f6a2dbb1858071e0473c6bebee5d?s=128&d=identicon&r=PG&f=1", "display_name": "sf8193", "link": "https://stackoverflow.com/users/7530306/sf8193"}, "is_accepted": true, "score": 0, "last_activity_date": 1529166230, "last_edit_date": 1529166230, "creation_date": 1529164894, "answer_id": 50889495, "question_id": 49889045, "link": "https://stackoverflow.com/questions/49889045/reading-wav-file-with-possibly-misaligned-data/50889495#50889495", "title": "Reading WAV file with possibly misaligned data", "body": "<p>To anyone facing this issue, I realized the data was getting converted upon download, automatically by my computer. When downloading the files they were getting converted to a .png file for some reason I am not aware of. To circumvent this, if you are getting the same issue I was, make sure to check the type of the file you are inputting, even if it ends in a .wav ending. </p>\n"}], "owner": {"reputation": 421, "user_id": 7530306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b20f6a2dbb1858071e0473c6bebee5d?s=128&d=identicon&r=PG&f=1", "display_name": "sf8193", "link": "https://stackoverflow.com/users/7530306/sf8193"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 50889495, "answer_count": 1, "score": 0, "last_activity_date": 1529166230, "creation_date": 1524008563, "question_id": 49889045, "link": "https://stackoverflow.com/questions/49889045/reading-wav-file-with-possibly-misaligned-data", "title": "Reading WAV file with possibly misaligned data", "body": "<p>I am trying to read an audio wave file from a database of wave files. My code for reading the wave file looks like so</p>\n\n<pre><code>    /**\n * Read and parse a wave file\n *\n **/\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"wave.h\"\n#define TRUE 1 \n#define FALSE 0\n\n// WAVE header structure\n\nunsigned char buffer4[4];\nunsigned char buffer2[2];\n\nchar* seconds_to_time(float seconds);\n\n\n FILE *ptr;\n char *filename;\n struct HEADER header;\n\nint main(int argc, char **argv) {\n\n filename = (char*) malloc(sizeof(char) * 1024);\n if (filename == NULL) {\n   printf(\"Error in malloc\\n\");\n   exit(1);\n }\n\n // get file path\n char cwd[1024];\n if (getcwd(cwd, sizeof(cwd)) != NULL) {\n\n    strcpy(filename, cwd);\n\n    // get filename from command line\n    if (argc &lt; 2) {\n      printf(\"No wave file specified\\n\");\n      return;\n    }\n\n    strcat(filename, \"/\");\n    strcat(filename, argv[1]);\n    printf(\"%s\\n\", filename);\n }\n\n // open file\n printf(\"Opening  file..\\n\");\n ptr = fopen(filename, \"rb\");\n if (ptr == NULL) {\n    printf(\"Error opening file\\n\");\n    exit(1);\n }\n\n int read = 0;\n\n // read header parts\n\n read = fread(header.riff, sizeof(header.riff), 1, ptr);\n printf(\"(1-4): %s \\n\", header.riff); \n\n read = fread(buffer4, sizeof(buffer4), 1, ptr);\n printf(\"%u %u %u %u\\n\", buffer4[0], buffer4[1], buffer4[2], buffer4[3]);\n\n // convert little endian to big endian 4 byte int\n header.overall_size  = buffer4[0] | \n                        (buffer4[1]&lt;&lt;8) | \n                        (buffer4[2]&lt;&lt;16) | \n                        (buffer4[3]&lt;&lt;24);\n\n printf(\"(5-8) Overall size: bytes:%u, Kb:%u \\n\", header.overall_size, header.overall_size/1024);\n\n read = fread(header.wave, sizeof(header.wave), 1, ptr);\n printf(\"(9-12) Wave marker: %s\\n\", header.wave);\n\n read = fread(header.fmt_chunk_marker, sizeof(header.fmt_chunk_marker), 1, ptr);\n printf(\"(13-16) Fmt marker: %s\\n\", header.fmt_chunk_marker);\n\n read = fread(buffer4, sizeof(buffer4), 1, ptr);\n printf(\"%u %u %u %u\\n\", buffer4[0], buffer4[1], buffer4[2], buffer4[3]);\n\n // convert little endian to big endian 4 byte integer\n header.length_of_fmt = buffer4[0] |\n                            (buffer4[1] &lt;&lt; 8) |\n                            (buffer4[2] &lt;&lt; 16) |\n                            (buffer4[3] &lt;&lt; 24);\n printf(\"(17-20) Length of Fmt header: %u \\n\", header.length_of_fmt);\n\n read = fread(buffer2, sizeof(buffer2), 1, ptr); printf(\"%u %u \\n\", buffer2[0], buffer2[1]);\n\n header.format_type = buffer2[0] | (buffer2[1] &lt;&lt; 8);\n char format_name[10] = \"\";\n if (header.format_type == 1)\n   strcpy(format_name,\"PCM\"); \n else if (header.format_type == 6)\n  strcpy(format_name, \"A-law\");\n else if (header.format_type == 7)\n  strcpy(format_name, \"Mu-law\");\n\n printf(\"(21-22) Format type: %u %s \\n\", header.format_type, format_name);\n\n read = fread(buffer2, sizeof(buffer2), 1, ptr);\n printf(\"%u %u \\n\", buffer2[0], buffer2[1]);\n\n header.channels = buffer2[0] | (buffer2[1] &lt;&lt; 8);\n printf(\"(23-24) Channels: %u \\n\", header.channels);\n\n read = fread(buffer4, sizeof(buffer4), 1, ptr);\n printf(\"%u %u %u %u\\n\", buffer4[0], buffer4[1], buffer4[2], buffer4[3]);\n\n header.sample_rate = buffer4[0] |\n                        (buffer4[1] &lt;&lt; 8) |\n                        (buffer4[2] &lt;&lt; 16) |\n                        (buffer4[3] &lt;&lt; 24);\n\n printf(\"(25-28) Sample rate: %u\\n\", header.sample_rate);\n\n read = fread(buffer4, sizeof(buffer4), 1, ptr);\n printf(\"%u %u %u %u\\n\", buffer4[0], buffer4[1], buffer4[2], buffer4[3]);\n\n header.byterate  = buffer4[0] |\n                        (buffer4[1] &lt;&lt; 8) |\n                        (buffer4[2] &lt;&lt; 16) |\n                        (buffer4[3] &lt;&lt; 24);\n printf(\"(29-32) Byte Rate: %u , Bit Rate:%u\\n\", header.byterate, header.byterate*8);\n\n read = fread(buffer2, sizeof(buffer2), 1, ptr);\n printf(\"%u %u \\n\", buffer2[0], buffer2[1]);\n\n header.block_align = buffer2[0] |\n                    (buffer2[1] &lt;&lt; 8);\n printf(\"(33-34) Block Alignment: %u \\n\", header.block_align);\n\n read = fread(buffer2, sizeof(buffer2), 1, ptr);\n printf(\"%u %u \\n\", buffer2[0], buffer2[1]);\n\n header.bits_per_sample = buffer2[0] |\n                    (buffer2[1] &lt;&lt; 8);\n printf(\"(35-36) Bits per sample: %u \\n\", header.bits_per_sample);\n\n read = fread(header.data_chunk_header, sizeof(header.data_chunk_header), 1, ptr);\n printf(\"(37-40) Data Marker: %s \\n\", header.data_chunk_header);\n\n read = fread(buffer4, sizeof(buffer4), 1, ptr);\n printf(\"%u %u %u %u\\n\", buffer4[0], buffer4[1], buffer4[2], buffer4[3]);\n\n header.data_size = buffer4[0] |\n                (buffer4[1] &lt;&lt; 8) |\n                (buffer4[2] &lt;&lt; 16) | \n                (buffer4[3] &lt;&lt; 24 );\n printf(\"(41-44) Size of data chunk: %u \\n\", header.data_size);\n\n\n // calculate no.of samples\n long num_samples = (8 * header.data_size) / (header.channels * header.bits_per_sample);\n printf(\"Number of samples:%lu \\n\", num_samples);\n\n long size_of_each_sample = (header.channels * header.bits_per_sample) / 8;\n printf(\"Size of each sample:%ld bytes\\n\", size_of_each_sample);\n\n // calculate duration of file\n float duration_in_seconds = (float) header.overall_size / header.byterate;\n printf(\"Approx.Duration in seconds=%f\\n\", duration_in_seconds);\n printf(\"Approx.Duration in h:m:s=%s\\n\", seconds_to_time(duration_in_seconds));\n\n\n\n // read each sample from data chunk if PCM\n if (header.format_type == 1) { // PCM\n    printf(\"Dump sample data? Y/N?\");\n    char c = 'n';\n    scanf(\"%c\", &amp;c);\n    if (c == 'Y' || c == 'y') { \n        long i =0;\n        char data_buffer[size_of_each_sample];\n        int  size_is_correct = TRUE;\n\n        // make sure that the bytes-per-sample is completely divisible by num.of channels\n        long bytes_in_each_channel = (size_of_each_sample / header.channels);\n        if ((bytes_in_each_channel  * header.channels) != size_of_each_sample) {\n            printf(\"Error: %ld x %ud &lt;&gt; %ld\\n\", bytes_in_each_channel, header.channels, size_of_each_sample);\n            size_is_correct = FALSE;\n        }\n\n        if (size_is_correct) { \n                    // the valid amplitude range for values based on the bits per sample\n            long low_limit = 0l;\n            long high_limit = 0l;\n\n            switch (header.bits_per_sample) {\n                case 8:\n                    low_limit = -128;\n                    high_limit = 127;\n                    break;\n                case 16:\n                    low_limit = -32768;\n                    high_limit = 32767;\n                    break;\n                case 32:\n                    low_limit = -2147483648;\n                    high_limit = 2147483647;\n                    break;\n            }                   \n\n            printf(\"\\n\\n.Valid range for data values : %ld to %ld \\n\", low_limit, high_limit);\n            for (i =1; i &lt;= num_samples; i++) {\n                printf(\"==========Sample %ld / %ld=============\\n\", i, num_samples);\n                read = fread(data_buffer, sizeof(data_buffer), 1, ptr);\n                if (read == 1) {\n\n                    // dump the data read\n                    unsigned int  xchannels = 0;\n                    int data_in_channel = 0;\n\n                    for (xchannels = 0; xchannels &lt; header.channels; xchannels ++ ) {\n                        printf(\"Channel#%d : \", (xchannels+1));\n                        // convert data from little endian to big endian based on bytes in each channel sample\n                        if (bytes_in_each_channel == 4) {\n                            data_in_channel =   data_buffer[0] | \n                                                (data_buffer[1]&lt;&lt;8) | \n                                                (data_buffer[2]&lt;&lt;16) | \n                                                (data_buffer[3]&lt;&lt;24);\n                        }\n                        else if (bytes_in_each_channel == 2) {\n                            data_in_channel = data_buffer[0] |\n                                                (data_buffer[1] &lt;&lt; 8);\n                        }\n                        else if (bytes_in_each_channel == 1) {\n                            data_in_channel = data_buffer[0];\n                        }\n\n                        printf(\"%d \", data_in_channel);\n\n                        // check if value was in range\n                        if (data_in_channel &lt; low_limit || data_in_channel &gt; high_limit)\n                            printf(\"**value out of range\\n\");\n\n                        printf(\" | \");\n                    }\n\n                    printf(\"\\n\");\n                }\n                else {\n                    printf(\"Error reading file. %d bytes\\n\", read);\n                    break;\n                }\n\n            } //    for (i =1; i &lt;= num_samples; i++) {\n\n        } //    if (size_is_correct) { \n\n     } // if (c == 'Y' || c == 'y') { \n } //  if (header.format_type == 1) { \n\n printf(\"Closing file..\\n\");\n fclose(ptr);\n\n  // cleanup before quitting\n free(filename);\n return 0;\n\n}\n\n/**\n * Convert seconds into hh:mm:ss format\n * Params:\n *  seconds - seconds value\n * Returns: hms - formatted string\n **/\n char* seconds_to_time(float raw_seconds) {\n  char *hms;\n  int hours, hours_residue, minutes, seconds, milliseconds;\n  hms = (char*) malloc(100);\n\n  sprintf(hms, \"%f\", raw_seconds);\n\n  hours = (int) raw_seconds/3600;\n  hours_residue = (int) raw_seconds % 3600;\n  minutes = hours_residue/60;\n  seconds = hours_residue % 60;\n  milliseconds = 0;\n\n  // get the decimal part of raw_seconds to get milliseconds\n  char *pos;\n  pos = strchr(hms, '.');\n  int ipos = (int) (pos - hms);\n  char decimalpart[15];\n  memset(decimalpart, ' ', sizeof(decimalpart));\n  strncpy(decimalpart, &amp;hms[ipos+1], 3);\n  milliseconds = atoi(decimalpart); \n\n\n  sprintf(hms, \"%d:%d:%d.%d\", hours, minutes, seconds, milliseconds);\n  return hms;\n}\n</code></pre>\n\n<p>the wave.h that is included looks like this </p>\n\n<pre><code>// WAVE file header format\nstruct HEADER {\n    unsigned char riff[4];                      // RIFF string\n    unsigned int overall_size   ;               // overall size of file in bytes\n    unsigned char wave[4];                      // WAVE string\n    unsigned char fmt_chunk_marker[4];          // fmt string with trailing null char\n    unsigned int length_of_fmt;                 // length of the format data\n    unsigned int format_type;                   // format type. 1-PCM, 3- IEEE float, 6 - 8bit A law, 7 - 8bit mu law\n    unsigned int channels;                      // no.of channels\n    unsigned int sample_rate;                   // sampling rate (blocks per second)\n    unsigned int byterate;                      // SampleRate * NumChannels * BitsPerSample/8\n    unsigned int block_align;                   // NumChannels * BitsPerSample/8\n    unsigned int bits_per_sample;               // bits per sample, 8- 8bits, 16- 16 bits etc\n    unsigned char data_chunk_header [4];        // DATA string or FLLR string\n    unsigned int data_size;                     // NumSamples * NumChannels * BitsPerSample/8 - size of the next chunk that will be read\n};\n</code></pre>\n\n<p>. I have tried with other wav files and seem to get the correct output (i.e. \"RIFF\" and \"WAVE\" from the header). However, with the one I care about this is the output</p>\n\n<pre><code>    ________________________________________________________________________________~/Downloads/libmfcc-master $: ./a.out audioclip-1523814201.wav \n/home/sfelde2/Downloads/libmfcc-master/audioclip-1523814201.wav\nOpening  file..\n(1-4):  \n102 116 121 112\n(5-8) Overall size: bytes:1887007846, Kb:1842781 \n(9-12) Wave marker: isom\n(13-16) Fmt marker: \n105 115 111 109\n(17-20) Length of Fmt header: 1836020585 \n105 115 \n(21-22) Format type: 29545  \n111 50 \n(23-24) Channels: 12911 \n109 112 52 49\n(25-28) Sample rate: 825520237\n0 0 0 8\n(29-32) Byte Rate: 134217728 , Bit Rate:1073741824\n102 114 \n(33-34) Block Alignment: 29286 \n101 101 \n(35-36) Bits per sample: 25957 \n(37-40) Data Marker:  \n109 100 97 116\n(41-44) Size of data chunk: 1952539757 \nNumber of samples:8 \nSize of each sample:41891353 bytes\nApprox.Duration in seconds=14.059304\nApprox.Duration in h:m:s=0:0:14.59\nClosing file..\n</code></pre>\n\n<p>I have started to wonder if the wave field where it says \"isom\" might signify it is aligned differently but I haven't been able to find anything on ISOM. Thiiis along with the fact that it is not printing the RIFF string and spitting out the wrong values for the data makes me wonder if there is anyway I can figure out where the data starts. Any ideas on what could be the issue or if theres anyway I can debug this so that I can use the wav file would be greatly appreciated.</p>\n"}, {"tags": ["c", "time", "struct", "hex", "socketcan"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524003815, "post_id": 49888265, "comment_id": 86792800, "body": "In the function <code>long usec()</code> your <code>mtime = start.tv_sec + start.tv_usec;</code> ignores the diffent time units."}, {"owner": {"reputation": 55516, "user_id": 892256, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/15FJW.png?s=128&g=1", "display_name": "Ed Heal", "link": "https://stackoverflow.com/users/892256/ed-heal"}, "edited": false, "score": 3, "creation_date": 1524003932, "post_id": 49888265, "comment_id": 86792840, "body": "<code>bin.time_str</code> - Where have you given this a value - it is a pointer that has not been initialised"}, {"owner": {"reputation": 55516, "user_id": 892256, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/15FJW.png?s=128&g=1", "display_name": "Ed Heal", "link": "https://stackoverflow.com/users/892256/ed-heal"}, "edited": false, "score": 0, "creation_date": 1524004398, "post_id": 49888265, "comment_id": 86792996, "body": "<code>fwrite</code> - Please check the return value"}, {"owner": {"reputation": 55516, "user_id": 892256, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/15FJW.png?s=128&g=1", "display_name": "Ed Heal", "link": "https://stackoverflow.com/users/892256/ed-heal"}, "edited": false, "score": 0, "creation_date": 1524004510, "post_id": 49888265, "comment_id": 86793031, "body": "Why are you using global variables - e.g. <code>fPtr</code>"}, {"owner": {"reputation": 143, "user_id": 8540390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3d8fc1dec42ea6332e7ab53e73102b4?s=128&d=identicon&r=PG", "display_name": "user8540390", "link": "https://stackoverflow.com/users/8540390/user8540390"}, "edited": false, "score": 0, "creation_date": 1524005487, "post_id": 49888265, "comment_id": 86793320, "body": "Using sprintf i have stored a value in <code>bin.time_str</code> in the first program i.e., time in hex format. Yes <code>bin.str</code> has my times value in hexa format I am able to see when executed using <code>puts</code>"}, {"owner": {"reputation": 55516, "user_id": 892256, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/15FJW.png?s=128&g=1", "display_name": "Ed Heal", "link": "https://stackoverflow.com/users/892256/ed-heal"}, "edited": false, "score": 1, "creation_date": 1524005593, "post_id": 49888265, "comment_id": 86793353, "body": "You have not allocated any memory for <code>bin.time_str</code> - it does not have a value."}, {"owner": {"reputation": 143, "user_id": 8540390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3d8fc1dec42ea6332e7ab53e73102b4?s=128&d=identicon&r=PG", "display_name": "user8540390", "link": "https://stackoverflow.com/users/8540390/user8540390"}, "edited": false, "score": 0, "creation_date": 1524006428, "post_id": 49888265, "comment_id": 86793564, "body": "How can I allocate memory for <code>bin.time_str</code>? Thanks in advance"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524008844, "post_id": 49888265, "comment_id": 86794196, "body": "<code>fwrite(&amp;bin,sizeof(bin),1,fPtr);</code> will write the pointer value of member <code>.time_str</code>. That is not useful on later reading.  Instead try <code>char *time_str;</code> --&gt; <code>char time_str[100];</code>  (an array instead of a pointer)."}, {"owner": {"reputation": 143, "user_id": 8540390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3d8fc1dec42ea6332e7ab53e73102b4?s=128&d=identicon&r=PG", "display_name": "user8540390", "link": "https://stackoverflow.com/users/8540390/user8540390"}, "edited": false, "score": 0, "creation_date": 1524022647, "post_id": 49888265, "comment_id": 86797184, "body": "Yeah, understood. Thankyou so much, now the program is not crashing while writing hex values of times into the binary file. :)"}], "owner": {"reputation": 143, "user_id": 8540390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3d8fc1dec42ea6332e7ab53e73102b4?s=128&d=identicon&r=PG", "display_name": "user8540390", "link": "https://stackoverflow.com/users/8540390/user8540390"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524003261, "creation_date": 1524003261, "question_id": 49888265, "link": "https://stackoverflow.com/questions/49888265/how-to-write-structure-with-members-of-the-structure-storing-binary-data-into-a", "title": "How to write structure with members of the structure storing binary data into a file using C", "body": "<p>In the following programs, there is my structure as</p>\n\n<pre><code>struct binary\n{  \n  char *time_str;\n  uint16_t id;\n  uint8_t data[8];  \n};\n\nlong usec()\n{\n struct timeval start;\n long mtime;\n gettimeofday(&amp;start,NULL);\n mtime = start.tv_sec + start.tv_usec;\n return mtime;\n}\n\nvoid data_log(struct can_frame *frame_rd)\n{\n int i;\n time_t t = time(NULL);\n struct tm *tm = localtime(&amp;t);\n\n struct binary bin;\n sprintf(bin.time_str,\"%#X.%#X.%#X %#X:%#X:%#X:%#lX\",tm-&gt;tm_mday,tm- \n &gt;tm_mon+1,((tm-&gt;tm_year)%100),tm-&gt;tm_hour,tm-&gt;tm_min,tm-&gt;tm_sec,usec());\n\n puts(bin.time_str);\n\n bin.id = frame_rd-&gt;can_id;\n for(i=0;i&lt;8;i++)\n {\n  bin.data[i] = frame_rd-&gt;data[i];\n }\n fwrite(&amp;bin,sizeof(bin),1,fPtr);\n}\n\nint main()\n{\n struct can_frame frame_rd;\n while(1)\n{\n open_file();\n data_log(&amp;frame_rd);\n close_file();\n}\n return 0;\n}\n</code></pre>\n\n<p>Everything works fine if structure in <code>fwrite</code> function is replaced by other data but for the above structure with time_str (in hex format) while writing into a file in <code>wb</code> mode, the program crashes. I am sure the problem is near time_stri and <code>fwrite</code> . Because I tried with other ways and this program works correctly if the program is as follows:</p>\n\n<pre><code>struct binary\n{  \n  uint8_t time_yr;\n  uint8_t time_mon;\n  uint8_t time_day;\n  uint8_t time_hr;\n  uint8_t time_min;\n  uint8_t time_sec;\n  uint32_t time_usec;\n  uint16_t id;\n  uint8_t data[8];  \n};\n\nlong usec()\n{\n struct timeval start;\n long mtime;\n gettimeofday(&amp;start,NULL);\n mtime = start.tv_sec + start.tv_usec;\n return mtime;\n}\n\nvoid data_log(struct can_frame *frame_rd)\n{\n int i;\n time_t t = time(NULL);\n struct tm *tm = localtime(&amp;t);\n\n struct binary bin;\n bin.time_day = tm-&gt;tm_mday;\n bin.time_mon = tm-&gt;tm_mon+1;\n bin.time_yr  = ((tm-&gt;tm_year)%100);\n bin.time_hr  = tm-&gt;tm_hour;\n bin.time_min = tm-&gt;tm_min;\n bin.time_sec = tm-&gt;tm_sec;\n bin.time_usec= usec();\n\n bin.id = frame_rd-&gt;can_id;\n for(i=0;i&lt;8;i++)\n {\n  bin.data[i] = frame_rd-&gt;data[i];\n }\n fwrite(&amp;bin,sizeof(bin),1,fPtr);\n}\n\nint main()\n{\n struct can_frame frame_rd;\n while(1)\n{\n open_file();\n data_log(&amp;frame_rd);\n close_file();\n}\n return 0;\n}\n</code></pre>\n\n<p>The second program works well, with out any crash and writes the data into a file in hex format. But in the second program the times are not written in hex format and to write times in the hex format, the first program is correct and when I use <code>puts</code> to see the hex values of the time, it shows time in hex format but the program crashes when it executes while writing data into file.\nHow can I solve this, how can I write times in hex format to the binary file using the structure bin.</p>\n\n<p>In both programs, open_file() and close_file() are two functions to open file in binary mode and to close the file and these are not included inside the programs under this post as most of us know to open a file and close file. It would be great if someone helps in this. Thanks in advance.</p>\n"}, {"tags": ["c", "arrays", "sorting", "struct", "bubble-sort"], "comments": [{"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1524003447, "post_id": 49888251, "comment_id": 86792682, "body": "<code>if(dog[y].weight &gt; dog[y].weight){</code> I think you have a typo here.  You are comparing the same dog against itself (both indices are <code>y</code>). What kind of sort are you trying to write?  Also, mind your array bounds."}, {"owner": {"reputation": 115, "user_id": 9535762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d97bb97a00c04040652d3e8caec81675?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Brefeld", "link": "https://stackoverflow.com/users/9535762/thomas-brefeld"}, "reply_to_user": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1524003788, "post_id": 49888251, "comment_id": 86792790, "body": "thank you for the feedback, yes I did find a typo in that line. The line should read <code>if(dog[y].weight &gt; dog[y+1].weight){</code>. But according to my research for bubble sort, it still should be <code>y</code>."}, {"owner": {"reputation": 1046, "user_id": 1335511, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/95lkV.jpg?s=128&g=1", "display_name": "Henrique Jung", "link": "https://stackoverflow.com/users/1335511/henrique-jung"}, "edited": false, "score": 0, "creation_date": 1524004396, "post_id": 49888251, "comment_id": 86792995, "body": "Please provide us with a sample input and write the whole code in a single block. Also we don&#39;t have access to the <code>calc</code> function, only a prototype."}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1524004407, "post_id": 49888251, "comment_id": 86793000, "body": "<code>temp</code> is an <code>int</code>, and <code>dog[y]</code> is a struct, so <code>temp = dog[y]</code> should give you an error."}, {"owner": {"reputation": 54864, "user_id": 404970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o6X94.jpg?s=128&g=1", "display_name": "molbdnilo", "link": "https://stackoverflow.com/users/404970/molbdnilo"}, "edited": false, "score": 0, "creation_date": 1524005073, "post_id": 49888251, "comment_id": 86793196, "body": "Check your indexing again."}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1524007827, "post_id": 49888251, "comment_id": 86793931, "body": "Use <code>qsort()</code>  ."}], "answers": [{"tags": [], "owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "is_accepted": true, "score": 0, "last_activity_date": 1524052280, "creation_date": 1524052280, "answer_id": 49899021, "question_id": 49888251, "link": "https://stackoverflow.com/questions/49888251/sorting-an-array-of-structs-in-c-with-pointers/49899021#49899021", "title": "Sorting an array of structs in C with pointers", "body": "<p>In my opinion, your error resides (despite of other comments I'll do below) in specifying <code>%c</code> as format descriptor to pass a pointer to <code>int</code> to match.  You have to pass a pointer to <code>char</code> to make <code>scanf(3)</code> to select the proper place to put the character into.  You probably are not getting the right character or no character at all (this leads to Undefined Behaviour in your program)</p>\n\n<p>Some other problems are that you are using the <code>weight</code> field of the structure when requested to sort by name (on <code>n</code> input char) and other errors like this.  This includes that you use <code>y &lt; (numDogs)</code> in the inner loop limit condition (it must be <code>y &lt; (numDogs - 1)</code>, or you'll compare the <code>y</code>-esim with the <code>y+1</code>-esim element (out of array bounds)</p>\n\n<p>Also, as you are using <em>the same algorithm</em> for both sorting options, I should include the <code>switch</code> statement inside the inner loop (where you do the comparison) as doing otherwise will force you to copy the same sorting code twice (for the overall sorting algorithm), as in:</p>\n\n<pre><code>for(i = 0; i &lt; numDogs; ++i){\n    for(y = 0; y &lt; (numDogs - 1); ++y){\n        int sortResultGreater;\n        switch (sortType) {\n        case 'n': case 'N':\n             sortResultGreater = strcmp(dog[y].name, dog[y+1].name) &gt; 0; \n             break;\n        default: {  /* this should be done as soon as you know the sorting type, not here inside the loop, of course */\n             static int not_already_printed = 1;\n             if (not_already_printed) {\n                 printf(\"Error, sortType must be [nNsS], defaulting to n\\n\");\n                 not_already_printed = 0; /* so we don't get here again */\n             }\n        } /* scope of not_already_printed finishes here */\n        /* no break used here to fallback to the next case */\n        case 's': case 'S':\n             sortResultGreater = dog[y].weight &gt; dog[y+1].weight; \n             break;\n        } /* switch */\n        if(sortResultGreater){\n            temp = dog[y];\n            dog[y] = dog[y + 1];\n            dog[y + 1] = temp;\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 9535762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d97bb97a00c04040652d3e8caec81675?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Brefeld", "link": "https://stackoverflow.com/users/9535762/thomas-brefeld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 49899021, "answer_count": 1, "score": 0, "last_activity_date": 1524052280, "creation_date": 1524003170, "last_edit_date": 1524004766, "question_id": 49888251, "link": "https://stackoverflow.com/questions/49888251/sorting-an-array-of-structs-in-c-with-pointers", "title": "Sorting an array of structs in C with pointers", "body": "<p>I have a coding assignment for my CIS class. The assignment is to write a program the will create an array of structures that will hold information on at max 10 dogs. At the end of the program, you are supposed to sort the array of dogs by either name or size. But I am unable to code the sorting of the array of dog. <p> I was wondering how to sort the array of dogs for later use in the main function.\n<p>\n<strong>Code</strong>\n<p></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nstruct Dog{\n    char name[20];\n    int weight;\n    int age;\n    int ageDogYears;\n    char size[7];\n};\n\ntypedef struct Dog DG;\n\nvoid calc(DG[], int);\nvoid sort(DG[], int);\nvoid display();\n\nint main(){\n    DG dArray[10];\n    int x = 0;\n    char str[80], *i;\n\n    FILE *inFile;\n\n    inFile = fopen(\"dogfile.txt\", \"r\");\n    if (inFile == NULL){\n        printf(\"Error opening file\");\n        exit(1);\n    }\n\n    while(fgets(str, 80,inFile) != NULL){\n        i = strtok(str, \", \");\n        strcpy(dArray[x].name, i);\n        puts(dArray[x].name);\n\n        i = strtok(NULL, \", \");\n        dArray[x].weight = atoi(i);\n        printf(\"%d\\n\", dArray[x].weight);\n\n        i = strtok(NULL, \", \");\n        dArray[x].age = atoi(i);\n        printf(\"%d\\n\", dArray[x].age);\n\n        x++;\n    }\n\n    calc(dArray, x);\n\n    sort(dArray, x);\n\n    return 0;\n}\n\nvoid calc(DG dog[], int numDogs){\n    int y, i, total;\n    for(i = 0; i &lt; numDogs; ++i){\n        if(dog[i].weight &lt;= 20){\n            //sets the dog size to small\n            strcpy(dog[i].size, \"Small\");\n\n            for(y = 0; y &lt; dog[i].age; ++y){\n                if(y == 0)\n                    total += 15;\n                else if(y == 1)\n                    total += 8;\n                else if(y == 2)\n                    total += 5;\n                else\n                    total += 4;\n            }\n        }\n        else if(dog[i].weight &lt;= 50){\n            //sets the dog size to medium\n            strcpy(dog[i].size, \"Medium\");\n\n            for(y = 0; y &lt; dog[i].age; ++y){\n                if(y == 0)\n                    total += 14;\n                else if(y == 1)\n                    total += 9;\n                else if(y == 2)\n                    total += 7;\n                else\n                    total += 5;\n            }\n        }\n        else{\n            //sets the dog size to Large\n            strcpy(dog[i].size, \"Large\");\n\n            for(y = 0; y &lt; dog[i].age; ++y){\n                if(y == 0)\n                    total += 12;\n                else if(y == 1)\n                    total += 9;\n                else if(y == 2)\n                    total += 8;\n                else\n                    total += 7;\n            }\n        }\n\n        dog[i].ageDogYears = total;\n        total = 0;\n    }\n}\n\nvoid sort(DG dog[], int numDogs){\n    int sortType, i, y, temp;\n\n    printf(\"\\n wlould you like to sort by name(N) or size(S): \");\n    scanf(\"%c\", &amp;sortType);\n\n    switch(sortType){\n        case 'N': case 'n':\n            for(i = 0; i &lt; numDogs; ++i){\n                for(y = 0; y &lt; (numDogs); ++y){\n                    if(dog[y].weight &gt; dog[y+1].weight){\n                        temp = dog[y];\n                        dog[y] = dog[y + 1];\n                        dog[y + 1] = temp;\n                    }\n                }\n            }\n            break;\n        default:\n            if((sortType != 's') &amp;&amp; (sortType != 'S'))\n                printf(\"\\n invalid input! Setting sort type to size.\");\n        //sorting of dog names\n    }\n}\n</code></pre>\n\n<p><p>\n<strong>Sample Input</strong>\n<p>\n<code>Fluffy,23,6\nFido,65,7\nPepper,44,5\nBowser,75,10\nVictor,10,2\nSassy,51,1</code></p>\n\n<p>Any help would be much appretated! Thanks.</p>\n"}, {"tags": ["c", "time-complexity"], "comments": [{"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "edited": false, "score": 0, "creation_date": 1524002850, "post_id": 49888109, "comment_id": 86792464, "body": "Perhaps observing the difference between the calls <code>recursion(2)</code> and <code>recursion(3)</code> will help you."}, {"owner": {"reputation": 1404, "user_id": 6395770, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a1dd74e2bc23bea3918a139070114d23?s=128&d=identicon&r=PG&f=1", "display_name": "information_interchange", "link": "https://stackoverflow.com/users/6395770/information-interchange"}, "edited": false, "score": 0, "creation_date": 1524003700, "post_id": 49888109, "comment_id": 86792759, "body": "Isn&#39;t the recursion unbounded here?"}, {"owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "reply_to_user": {"reputation": 1404, "user_id": 6395770, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a1dd74e2bc23bea3918a139070114d23?s=128&d=identicon&r=PG&f=1", "display_name": "information_interchange", "link": "https://stackoverflow.com/users/6395770/information-interchange"}, "edited": false, "score": 2, "creation_date": 1524004463, "post_id": 49888109, "comment_id": 86793017, "body": "@information_interchange: No. Each recursive call within a call to <code>recursion(n)</code> is passed a parameter less than <code>n</code>."}, {"owner": {"reputation": 1404, "user_id": 6395770, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a1dd74e2bc23bea3918a139070114d23?s=128&d=identicon&r=PG&f=1", "display_name": "information_interchange", "link": "https://stackoverflow.com/users/6395770/information-interchange"}, "edited": false, "score": 0, "creation_date": 1524005438, "post_id": 49888109, "comment_id": 86793302, "body": "Ah yes, I see now; the <code>i&lt;n</code> is almost  like an <code>n-1</code>. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 64283, "user_id": 315052, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/AB5ST.png?s=128&g=1", "display_name": "jxh", "link": "https://stackoverflow.com/users/315052/jxh"}, "is_accepted": false, "score": 2, "last_activity_date": 1524040822, "last_edit_date": 1524040822, "creation_date": 1524003313, "answer_id": 49888277, "question_id": 49888109, "link": "https://stackoverflow.com/questions/49888109/determining-time-complexity-of-a-specific-function/49888277#49888277", "title": "Determining time complexity of a specific function", "body": "<p>Since this smells like a homework question, this answer is incomplete by design.</p>\n\n<p>The usual trick behind these kind of problems is to create a recurrence equation. That is, the time complexity of <code>recursion(k+1)</code> is somehow related to the complexity of <code>recursion(k)</code>. Just writing down the recurrence itself is not sufficient to prove the complexity, you have to demonstrate why the recurrence is true. But, for 2<sup>n</sup>, this suggests that <code>recursion(k+1)</code> takes twice as long as <code>recursion(k)</code>.</p>\n\n<blockquote class=\"spoiler\">\n  <p> Let T(k) denote the time complexity of <code>recursion(k)</code>. Since <code>recursion(0)</code> returns immediately, let T(0) = 1. For k &gt; 0, given the iterative implementation of <code>recursion</code><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src=\"https://chart.googleapis.com/chart?cht=tx&amp;chl=T%28k%29%3D%5Csum_%7Bi%3D0%7D%5E%7Bk-1%7DT%28i%29\" alt=\"T(k) = &Sigma; T(i) for 0 &leq; i &lt; k\"><br>Thus<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src=\"https://chart.googleapis.com/chart?cht=tx&amp;chl=T%28k%2B1%29%3D%5Csum_%7Bi%3D0%7D%5E%7Bk%7DT%28i%29\" alt=\"T(k+1) = &Sigma; T(i) for 0 &leq; i &lt; k+1\"><br><img src=\"https://chart.googleapis.com/chart?cht=tx&amp;chl=%5Crightarrow%20T%28k%2B1%29%3DT%28k%29%2B%5Csum_%7Bi%3D0%7D%5E%7Bk-1%7DT%28i%29\" alt=\"&rarr; T(k+1) = T(k) + &Sigma; T(i) for 0 &leq; i &lt; k\"><br><img src=\"https://chart.googleapis.com/chart?cht=tx&amp;chl=%5Crightarrow%20T%28k%2B1%29%3DT%28k%29%2BT%28k%29%3D2%5Ctimes%20T%28k%29\" alt=\"&rarr; T(k+1) = T(k) + T(k) = 2 &times; T(k)\"><br>You can inductively prove that T(k) = 2<sup>k</sup>.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 17175, "user_id": 1756636, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/92f14a1f21e57ba761c7163b2d00a78a?s=128&d=identicon&r=PG&f=1", "display_name": "SomeWittyUsername", "link": "https://stackoverflow.com/users/1756636/somewittyusername"}, "is_accepted": false, "score": 2, "last_activity_date": 1524004482, "last_edit_date": 1524004482, "creation_date": 1524003795, "answer_id": 49888352, "question_id": 49888109, "link": "https://stackoverflow.com/questions/49888109/determining-time-complexity-of-a-specific-function/49888352#49888352", "title": "Determining time complexity of a specific function", "body": "<p>Let's denote the total runtime as <code>f(n)</code>. Due to the loop in the function the <code>f(n)</code> is actually a sum of <code>f(i)</code> for <code>i</code> between 0 and n-1. That's a sum of <code>n</code> items. Let's try to simplify the expression. A standard trick in such situations is to find a complimentary equation. Let's see what is the value of <code>f(n-1)</code>. Similary to the previous case, it's a sum of <code>f(i)</code> for <code>i</code> between 0 and n-2. So now we have 2 equations:</p>\n\n<pre><code>f(n)=f(1)+...+f(n-1)\nf(n-1)=f(1)+...+f(n-2)\n</code></pre>\n\n<p>Let's subtract second from the first:</p>\n\n<pre><code>f(n)-f(n-1)=f(n-1)\n--&gt; f(n)=2f(n-1)\n</code></pre>\n\n<p>Now this is a <a href=\"https://en.wikipedia.org/wiki/Recurrence_relation#Solving_homogeneous_linear_recurrence_relations_with_constant_coefficients\" rel=\"nofollow noreferrer\">homogeneous linear recurrence relation with constant coefficients</a>.\nThe solution is immediate (see the link for more details):</p>\n\n<p><strong>f(n)=f(1)*2<sup>n</sup>=2<sup>n</sup></strong></p>\n"}, {"comments": [{"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1524020253, "post_id": 49888387, "comment_id": 86796621, "body": "The naive recursive computation of Fibonacci is not \u03a6(2^n). It&#39;s \u03a6(\u03c8^n) where \u03c8 is (sqrt(5)+1)/2, approximately 1.618. In other words, it&#39;s \u03a6(fib(n)), which is clear from the recursion itself. OP&#39;s recursion really is \u03a6(2^n), but your answer skirts around a sumple proof of this fact."}], "tags": [], "owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "is_accepted": true, "score": 2, "last_activity_date": 1524021931, "last_edit_date": 1524021931, "creation_date": 1524003918, "answer_id": 49888387, "question_id": 49888109, "link": "https://stackoverflow.com/questions/49888109/determining-time-complexity-of-a-specific-function/49888387#49888387", "title": "Determining time complexity of a specific function", "body": "<p>Let's look at a simpler recursion which is known to be O(2^n)</p>\n\n<pre><code>void fib(int n) {\n    if (n &lt; 3) {\n        return 1;\n    } else {\n        return fib(n - 1) + fib(n - 2);\n    }\n}\n</code></pre>\n\n<p>Here you can see, for the non-trivial case of n > 2, this will result in 2^(n-2) calls to itself.  For example, if n = 5:</p>\n\n<pre><code>n = 5\n    n = 4\n        n = 3\n            n = 2\n            n = 1\n        n = 2\n    n = 3\n        n = 2\n        n = 1\n</code></pre>\n\n<p>There are 8 (2^3) recursive calls, because each call with n > 2 spawns two more recursive calls, so fib(n+1) has twice as many recursive calls as fib(n).</p>\n\n<p>So for your example:</p>\n\n<pre><code>n = 3\n    n = 2\n        n = 1\n            n = 0\n        n = 0\n    n = 1\n        n = 0\n    n = 0\n</code></pre>\n\n<p>so we get 7 recursive calls when n = 3</p>\n\n<p>for n = 4</p>\n\n<pre><code>n = 4\n    n = 3\n        n = 2\n            n = 1\n                n = 0\n            n = 0\n        n = 1\n            n = 0\n        n = 0\n    n = 2\n        n = 1\n            n = 0\n        n = 0\n    n = 1\n        n = 0\n    n = 0\n</code></pre>\n\n<p>Here, we have 15 calls.  Looking at the execution tree above, you can see that recusrsion(4) is basically recursion(3) + recursion(3) + 1</p>\n\n<pre><code>n = 4\n    n = 3          // + 1\n        n = 2                //\n            n = 1            //\n                n = 0        // recursion(3)\n            n = 0            //\n        n = 1                //\n            n = 0            //\n        n = 0                //\n    n = 2           //\n        n = 1       //\n            n = 0   // recursion(3)\n        n = 0       //\n    n = 1           //\n        n = 0       //\n    n = 0           //\n</code></pre>\n\n<p>So in general, recursion(n + 1) will have one more recursive calls than 2 * recursion(n)....which is basically doubling for every +1 to n....which is O(2^n)</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "is_accepted": false, "score": 1, "last_activity_date": 1524034444, "creation_date": 1524034444, "answer_id": 49893080, "question_id": 49888109, "link": "https://stackoverflow.com/questions/49888109/determining-time-complexity-of-a-specific-function/49893080#49893080", "title": "Determining time complexity of a specific function", "body": "<pre><code>r(n)   = r(n-1)+r(n-2)+...+r(0) // n calls.\nr(n-1) = r(n-2)+r(n-3)+...+r(0) // n-1 calls.\nr(n-2) = r(n-3)+r(n-4)+...+r(0) // n-2 calls.\n.\n.\n.\nr(1)   = r(0)                   // 1 call.\nr(0)   = return;                // 0 call.\n</code></pre>\n\n<p>So,</p>\n\n<pre><code>r(n)   = r(n-1)+r(n-2)+...+r(0)         // n calls.\n       = 2 * (r(n-2)+...+r(0))          // 2 * (n - 1) calls.\n       = 2 * ( 2 * (r(n-3)+...+r(0)) )  // 2 * 2 * (n - 2) calls.\n.\n.\n.\n</code></pre>\n\n<p>This follows that =></p>\n\n<pre><code>2^(n-1) * (n - (n-1))\n</code></pre>\n\n<p>And that would be</p>\n\n<pre><code>2^n calls...\n</code></pre>\n"}], "owner": {"reputation": 190, "user_id": 8629179, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c37c16ec5b9320be80d4fa9bf64b4c82?s=128&d=identicon&r=PG&f=1", "display_name": "frostpad", "link": "https://stackoverflow.com/users/8629179/frostpad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 1, "accepted_answer_id": 49888387, "answer_count": 4, "score": 2, "last_activity_date": 1524040822, "creation_date": 1524002268, "last_edit_date": 1524004931, "question_id": 49888109, "link": "https://stackoverflow.com/questions/49888109/determining-time-complexity-of-a-specific-function", "title": "Determining time complexity of a specific function", "body": "<p>This is a question from one of the old exams from algorithms and data structure that I recently came upon. I'm having a hard time understanding the solution.\nI need to find <code>big-O</code>, <code>big-\u03f4</code> and <code>big-\u03a9</code> bounds of a function:</p>\n\n<pre><code>void recursion(int n) {\n int i;\n if (n == 0) {\n return;\n }\n for (i = 0; i &lt; n; i++) {\n recursion(i);\n }\n}\n</code></pre>\n\n<p>The solution is <code>2^n</code> for all three and I can't understand why. I've tried writing things down and I can't even get close to the solution. I would appreciate if anyone would explain where the <code>2^n</code> comes from here.</p>\n"}, {"tags": ["c", "linux", "haskell", "x11", "xlib"], "comments": [{"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1524003527, "post_id": 49887999, "comment_id": 86792712, "body": "I&#39;d guess that <code>w</code> is the input focus window, which is typically a sub-sub-sub...window of the one you want, e.g. it is a single text entry widget. Perhaps you could try to access the parent, then the grandparent, and so on until you find a window having a title."}, {"owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "reply_to_user": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 0, "creation_date": 1524004143, "post_id": 49887999, "comment_id": 86792910, "body": "@chi You are most probably right about that. The irony is that all the programs I was testing against did not have a title."}], "answers": [{"tags": [], "owner": {"reputation": 41648, "user_id": 108359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8a34d29224f05cd8bd1f480c89cf112?s=128&d=identicon&r=PG", "display_name": "Brian McKenna", "link": "https://stackoverflow.com/users/108359/brian-mckenna"}, "is_accepted": true, "score": 5, "last_activity_date": 1524003871, "creation_date": 1524003871, "answer_id": 49888373, "question_id": 49887999, "link": "https://stackoverflow.com/questions/49887999/haskell-fetchname-from-x11-library-does-not-return-the-name-of-the-window/49888373#49888373", "title": "Haskell fetchName from X11 library does not return the name of the window", "body": "<p>It looks like <code>fetchName</code> isn't always filled in. Instead you need to use the <code>_NET_WM_NAME</code> property:</p>\n\n<pre><code>import           Control.Concurrent\nimport           Data.Time.Clock\nimport           Debug.Trace\nimport           Graphics.X11\nimport           Graphics.X11.Xlib.Extras\n\nmain :: IO ()\nmain = do\n  d &lt;- openDisplay \"\"\n  loop d\n\nloop :: Display -&gt; IO ()\nloop d = do\n  time &lt;- getCurrentTime\n  (w, _) &lt;- getInputFocus d\n  a &lt;- internAtom d \"_NET_WM_NAME\" False\n  p &lt;- getTextProperty d w a\n  ps &lt;- wcTextPropertyToTextList d p\n  windowAttrs &lt;- getWindowAttributes d w\n  print $ show time ++ \" Name: \" ++ show ps ++ \" Width: \" ++ show (wa_width windowAttrs)\n  threadDelay 1000000\n  loop d\n</code></pre>\n\n<p>This is what XMonad does:</p>\n\n<p><a href=\"https://github.com/xmonad/xmonad/blob/8b055621e92e7ade127043e968f50713c15a00a0/src/XMonad/ManageHook.hs#L71-L80\" rel=\"noreferrer\">https://github.com/xmonad/xmonad/blob/8b055621e92e7ade127043e968f50713c15a00a0/src/XMonad/ManageHook.hs#L71-L80</a></p>\n"}, {"tags": [], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "is_accepted": false, "score": 1, "last_activity_date": 1524261455, "creation_date": 1524261455, "answer_id": 49950256, "question_id": 49887999, "link": "https://stackoverflow.com/questions/49887999/haskell-fetchname-from-x11-library-does-not-return-the-name-of-the-window/49950256#49950256", "title": "Haskell fetchName from X11 library does not return the name of the window", "body": "<p>In the end I had to adapt Brian's answer to the more complete definition from XMonad (because of exceptions being thrown by some windows):</p>\n\n<pre><code>import           Control.Exception.Extensible          (SomeException (..),\n                                                        bracket)\nimport qualified Control.Exception.Extensible          as E\nimport           Graphics.X11\nimport           Graphics.X11.Xlib.Extras\n\ngetWindowTitle :: Display -&gt; IO String\ngetWindowTitle d = do\n  (w, _) &lt;- getInputFocus d\n  let getProp =\n          (internAtom d \"_NET_WM_NAME\" False &gt;&gt;= getTextProperty d w)\n              `E.catch` \\(SomeException _) -&gt; getTextProperty d w wM_NAME\n      extract prop = do l &lt;- wcTextPropertyToTextList d prop\n                        return $ if null l then \"\" else head l\n  bracket getProp (xFree . tp_value) extract `E.catch` \\(SomeException _) -&gt; return \"\"\n</code></pre>\n"}], "owner": {"reputation": 20326, "user_id": 750216, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/974fb481d985024715a6816dfbb9cebf?s=128&d=identicon&r=PG", "display_name": "R\u0103zvan Flavius Panda", "link": "https://stackoverflow.com/users/750216/r%c4%83zvan-flavius-panda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 49888373, "answer_count": 2, "score": 1, "last_activity_date": 1524261455, "creation_date": 1524001684, "question_id": 49887999, "link": "https://stackoverflow.com/questions/49887999/haskell-fetchname-from-x11-library-does-not-return-the-name-of-the-window", "title": "Haskell fetchName from X11 library does not return the name of the window", "body": "<p>Having the following Haskell code:</p>\n\n<pre><code>import           Control.Concurrent\nimport           Data.Time.Clock\nimport           Debug.Trace\nimport           Graphics.X11\nimport           Graphics.X11.Xlib.Extras\n\nmain :: IO ()\nmain = do\n  d &lt;- openDisplay \"\"\n  loop d\n\nloop :: Display -&gt; IO ()\nloop d = do\n  time &lt;- getCurrentTime\n  (w, _) &lt;- getInputFocus d\n  maybeName &lt;- fetchName d w\n  windowAttrs &lt;- getWindowAttributes d w\n  print $ show time ++ \" Name: \" ++ show maybeName ++ \" Width: \" ++ show (wa_width windowAttrs)\n  threadDelay 1000000\n  loop d\n</code></pre>\n\n<p>The window title returned by <a href=\"http://hackage.haskell.org/package/X11-1.8/docs/Graphics-X11-Xlib-Extras.html#v:fetchName\" rel=\"nofollow noreferrer\">fetchName</a> is always <code>Nothing</code>.</p>\n\n<p>Haskell <a href=\"http://hackage.haskell.org/package/X11-1.8\" rel=\"nofollow noreferrer\">X11</a> library is a wrapper around <a href=\"https://tronche.com/gui/x/xlib/\" rel=\"nofollow noreferrer\">Xlib</a></p>\n\n<p>Possibly related issues:</p>\n\n<ul>\n<li>The width of the window is either correct or it has the value <code>1</code>.</li>\n<li><a href=\"https://stackoverflow.com/q/8825661/750216\">XFetchName always returns 0</a></li>\n</ul>\n"}, {"tags": ["c", "segmentation-fault"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 4, "creation_date": 1524001745, "post_id": 49887979, "comment_id": 86792043, "body": "<code>max_len = 0;</code> should be <code>*max_len = 0;</code>"}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524001792, "post_id": 49887979, "comment_id": 86792067, "body": "You get a segfault because you&#39;re changing <code>max_len</code> to a null pointer, and then trying to dereference it, which is undefined behavior."}, {"owner": {"reputation": 151, "user_id": 8105367, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ALtu4kramFs/AAAAAAAAAAI/AAAAAAAAABM/UL64PmGeL5E/photo.jpg?sz=128", "display_name": "dumbitdownjr", "link": "https://stackoverflow.com/users/8105367/dumbitdownjr"}, "reply_to_user": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 0, "creation_date": 1524002120, "post_id": 49887979, "comment_id": 86792193, "body": "@Barmar thanks, that solved it! But I don&#39;t understand when I did &quot;p *max_len&quot; in gdb why didn&#39;t it give me the cannot access that memory location message like it usually does?"}], "answers": [{"tags": [], "owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "is_accepted": true, "score": 2, "last_activity_date": 1524001932, "creation_date": 1524001932, "answer_id": 49888045, "question_id": 49887979, "link": "https://stackoverflow.com/questions/49887979/unsure-why-if-statement-causes-segfault/49888045#49888045", "title": "Unsure why if statement causes segfault", "body": "<pre><code>int read_file(FILE *in, T_node *root, int *max_len)\n</code></pre>\n\n<p><code>max_len</code> is a pointer</p>\n\n<pre><code>max_len = 0;\n</code></pre>\n\n<p>This line makes <code>max_len</code> a null pointer.</p>\n\n<pre><code>*max_len = len;\n</code></pre>\n\n<p>Here you try to dereference a null pointer.</p>\n\n<p>Change the iniitialization of <code>max_len</code> to</p>\n\n<pre><code>*max_len = 0;\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 8105367, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ALtu4kramFs/AAAAAAAAAAI/AAAAAAAAABM/UL64PmGeL5E/photo.jpg?sz=128", "display_name": "dumbitdownjr", "link": "https://stackoverflow.com/users/8105367/dumbitdownjr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 49888045, "answer_count": 1, "score": 0, "last_activity_date": 1524004546, "creation_date": 1524001579, "last_edit_date": 1524004546, "question_id": 49887979, "link": "https://stackoverflow.com/questions/49887979/unsure-why-if-statement-causes-segfault", "title": "Unsure why if statement causes segfault", "body": "<p>I have this <code>if</code> statement in one of my functions that seems to return a valid result when I query it with <code>gdb</code>, but it still ends up giving me a <code>segfault</code>.</p>\n\n<p>Here is the function in question:</p>\n\n<pre><code>/* reads the file and adds each word to the trie\n   returns the number of unique words in the file */\nint read_file(FILE *in, T_node *root, int *max_len)\n{\n   char *word = NULL;\n   int num_unique = 0;\n   int len;\n   max_len = 0;\n\n   if(root == NULL)\n   {\n      perror(\"Bad root\");\n      exit(3);\n   }\n\n   while ((word = read_long_word(in)) != NULL)\n   {\n      len = strlen(word);\n      /************ segfault here ***********/\n      if (len &gt; *max_len)\n      {\n         *max_len = len;\n      }\n      num_unique += add_word(root, word);\n   }\n\n   return num_unique;\n}\n</code></pre>\n\n<p>Here is where I am running it from:</p>\n\n<pre><code>/* tests file with some repeated words */\nvoid test_read_file2(void)\n{\n   FILE *in = fopen(\"repeated.txt\", \"r\");\n   T_node *root = create_T_node();\n   int max_len = 0;\n   /****** segfault caused by this call *****/\n   checkit_int(read_file(in, root, &amp;max_len), 8);\n   checkit_int(max_len, 19);\n   free_trie(root);\n   fclose(in);\n}\n</code></pre>\n\n<p>And here is what I get from <code>gdb</code>:</p>\n\n<pre><code>27            if (len &gt; *max_len)\n(gdb) p len\n$4 = 5\n(gdb) p *max_len\n$5 = 0\n(gdb) s\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x0000000000402035 in read_file (in=0x605010, root=0x605250, \n    max_len=0x7fffffffe0dc) at fw.c:27\n27            if (len &gt; *max_len)\n(gdb) p *max_len\n$6 = 0\n(gdb) p len &gt; *max_len\n$7 = 1\n</code></pre>\n\n<p>As you can see just above, when I print the <code>if</code> condition it returns <code>true</code> just fine, but I get a segmentation fault on that line (27) anyway. What am I missing?</p>\n"}, {"tags": ["c", "assembly", "floating-point", "segmentation-fault", "printf"], "comments": [{"owner": {"reputation": 330, "user_id": 4454877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0129832b19e0227f7085a5782b34b85?s=128&d=identicon&r=PG&f=1", "display_name": "Retr0id", "link": "https://stackoverflow.com/users/4454877/retr0id"}, "edited": false, "score": 0, "creation_date": 1523999487, "post_id": 49887467, "comment_id": 86791073, "body": "Have you tried using <code>gdb</code> to isolate the issue?"}, {"owner": {"reputation": 330, "user_id": 4454877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0129832b19e0227f7085a5782b34b85?s=128&d=identicon&r=PG&f=1", "display_name": "Retr0id", "link": "https://stackoverflow.com/users/4454877/retr0id"}, "edited": false, "score": 1, "creation_date": 1523999606, "post_id": 49887467, "comment_id": 86791127, "body": "55 is not aligned. The stack pointer needs to be aligned to a word boundary, I believe."}, {"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 3, "creation_date": 1523999686, "post_id": 49887467, "comment_id": 86791164, "body": "It actually needs to be 16 byte aligned."}, {"owner": {"reputation": 330, "user_id": 4454877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0129832b19e0227f7085a5782b34b85?s=128&d=identicon&r=PG&f=1", "display_name": "Retr0id", "link": "https://stackoverflow.com/users/4454877/retr0id"}, "reply_to_user": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 0, "creation_date": 1523999758, "post_id": 49887467, "comment_id": 86791200, "body": "@Jester that&#39;s an ABI thing, not a hardware thing, right?"}, {"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 1, "creation_date": 1523999817, "post_id": 49887467, "comment_id": 86791220, "body": "Yes, ABI. The hardware comes into play because there are instructions which expect alignment and <code>printf</code> happens to use those relative to the stack pointer which is assumed aligned."}, {"owner": {"reputation": 49, "user_id": 5553929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06fa11b08404a5bebf28a04a786106d0?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Jensen", "link": "https://stackoverflow.com/users/5553929/adam-jensen"}, "edited": false, "score": 0, "creation_date": 1524001297, "post_id": 49887467, "comment_id": 86791869, "body": "Thx for the quick answers. i did use gdb to find the source, its this line: &lt;__printf+36&gt;    movaps XMMWORD PTR [rsp+0x50],xmm0. that the seg fault occurs. i guess i need to use specific subtraction of rsp in order to work with printf correctly then. Thank a lot."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524024054, "post_id": 49887467, "comment_id": 86797540, "body": "Yep, after one <code>push</code>, you need to <code>sub rsp, n*16</code>, where <code>n</code> is any whole number.  Because RSP is 16-byte aligned before <code>call</code> pushes a return address, and <code>push rbp</code> pushes another 8, bringing you back to aligned.  If you don&#39;t need to save/restore anything, or have an even number of pushes, then <code>sub rsp, n*16 + 8</code>  Also don&#39;t forget to set <code>al=1</code> if you&#39;re passing the <code>double</code> in xmm0, not on the stack."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524024412, "post_id": 49887467, "comment_id": 86797620, "body": "The format for printing a double with <code>printf</code> is <code>%f</code>, not <code>%lf</code>.  (Although glibc accepts <code>%lf</code> as also meaning <code>double</code>.)  <a href=\"//stackoverflow.com/q/37082784\">How to print a single-precision float with printf</a>"}, {"owner": {"reputation": 49, "user_id": 5553929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06fa11b08404a5bebf28a04a786106d0?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Jensen", "link": "https://stackoverflow.com/users/5553929/adam-jensen"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524068097, "post_id": 49887467, "comment_id": 86824651, "body": "@PeterCordes thx for the answer, i wrote float as meaning to floating point number, i&#39;m actually working with double so i used %lf and not %f."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524081432, "post_id": 49887467, "comment_id": 86831927, "body": "Read my last comment again: the format for <code>double</code> is <code>%f</code>, with <code>printf</code> but not <code>scanf</code>.  If you tried to use <code>printf %f</code> for <code>float</code> from asm, it would fail."}, {"owner": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524083467, "post_id": 49887467, "comment_id": 86832987, "body": "Update: <code>%lf</code> is also correct for <code>double</code>, in C99/C11, so you don&#39;t need to change now.  But if you do ever want to <code>printf</code> a <code>float</code>, <code>%f</code> won&#39;t work."}, {"owner": {"reputation": 49, "user_id": 5553929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06fa11b08404a5bebf28a04a786106d0?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Jensen", "link": "https://stackoverflow.com/users/5553929/adam-jensen"}, "reply_to_user": {"reputation": 240639, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1524103875, "post_id": 49887467, "comment_id": 86839119, "body": "@PeterCordes ok, thx for the info."}], "owner": {"reputation": 49, "user_id": 5553929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06fa11b08404a5bebf28a04a786106d0?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Jensen", "link": "https://stackoverflow.com/users/5553929/adam-jensen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 357, "favorite_count": 0, "closed_date": 1524024533, "answer_count": 0, "score": 1, "last_activity_date": 1524024554, "creation_date": 1523999073, "question_id": 49887467, "link": "https://stackoverflow.com/questions/49887467/segmentation-fault-when-using-printf-from-assembly-to-print-float-number", "closed_reason": "Duplicate", "title": "Segmentation fault when using printf from assembly to print float number", "body": "<p>assembly code:</p>\n\n<pre><code>section .text\nglobal calculateRoot\nextern printFloat\n\ncalculateRoot:\n    push    rbp                       ; save Base Pointer (bp) original value\n    mov     rbp, rsp                  ; use base pointer to access stack contents\n    sub rsp, 55                        ; allocating bytes in stack for local variables\n\n    call printFloat\n\n    mov     rsp, rbp                        ; closing stack\n    pop     rbp                             ; resotre rbp\n    ret\n</code></pre>\n\n<p>c code:</p>\n\n<pre><code>#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nvoid printFloat();\n\nextern void calculateRoot(double num);\n\nint main(){\n    double num  = 43432432.23532534534543534;\n    calculateRoot(num);\n\n    printFloat(num);\n    return 0;\n}\n\nvoid printFloat(){\n    double h = 4332432525.324324;\n    printf(\"\\nFloating Point Number %lf\\n\",h);\n}\n</code></pre>\n\n<p>The above code produces a segmentation fault. i'm trying to understand why. As i tried to reproduce the problem in different ways, i found out that the seg fault only occurres when i try to print a float. It does not happen with int for example. Furthermore, i found out that different amount in the instruction \"sub rsp,55\" can fix the problem, i.e if it put 48 or 16 for example there will be no seg fault. Is there something i'm missing here ? \nThanks a lot for every answer.</p>\n\n<p>n.p - this code is not meant for anything. i created it when i found out strange things happen in my program. So this code was meant to found my mistake in my real program.\nAnd another thing i noticed, when i use 8 in \"sub rsp,55\" it creates a seg fault, so i created another function in assembly and called it from calculateRoot, in this function i made another \"sub rsp,8\" and it eliminated the seg fault(16 works when it is used in \"sub rsp, 55\").</p>\n"}, {"tags": ["c", "r", "linux", "ubuntu", "gcc"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 1, "creation_date": 1523998275, "post_id": 49887196, "comment_id": 86790579, "body": "It is apparently looking for some header called <code>matrix.h</code> that isn&#39;t there."}, {"owner": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523998792, "post_id": 49887196, "comment_id": 86790790, "body": "i tried locating it, and found the ccpmat library (<a href=\"http://cppmat.geus.me/en/latest/\" rel=\"nofollow noreferrer\">link</a> containing such a file but installing it gave just more errors of the same kind: <code>fatal error: algorithm: No such file or directory</code>"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 1, "creation_date": 1523999176, "post_id": 49887196, "comment_id": 86790939, "body": "Just some file named <code>matrix.h</code> won&#39;t do.  You&#39;ll need to use the one your project is expecting.  You&#39;d have to ask the people responsible for the software about that."}, {"owner": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523999527, "post_id": 49887196, "comment_id": 86791087, "body": "I think I found the correct library as mentioned above, it should be cppmat. My problem now is to correctly install the library so that gcc includes it properly. at least i think it is some openly available library otherwise the author would have mentioned it."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523999883, "post_id": 49887196, "comment_id": 86791244, "body": "If that is indeed the correct one, you can tell gcc where to look for headers with something like <code>-Ipath&#47;to&#47;header</code>"}, {"owner": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524000442, "post_id": 49887196, "comment_id": 86791464, "body": "I did just that via <code>$gcc -I meschach&#47; -c cppmat&#47;matrix.h -c cppmat&#47;cppmat.h -c circulant.c</code> and got the ominous error: <code>cppmat&#47;cppmat.h:12:21: fatal error: algorithm: No such file or directory compilation terminated. cppmat&#47;cppmat.h:12:21: fatal error: algorithm: No such file or directory compilation terminated. In file included from circulant.c:25:0: circulant.h:11:20: fatal error: matrix.h: No such file or directory compilation terminated.</code>  which makes no sense to me &#39;algorithm&#39; just sounds like a standard library to me"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524001043, "post_id": 49887196, "comment_id": 86791769, "body": "That&#39;s definitely not right.  You should not be passing in the headers to the compiler directly like that, and certainly not with the <code>-c</code> flag.  You just need to pass the path to the header files it should be searching.  like <code>-Icppmat</code> since that appears to be the directory where the header file exists."}, {"owner": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524001549, "post_id": 49887196, "comment_id": 86791970, "body": "I followed your advice and used<code>$gcc -Icppmat -Imeschach circulant.c</code>. the error now is shorter and the compiler only demands the &#39;algorithm&#39; header. <code>In file included from cppmat&#47;matrix.h:12:0,                  from circulant.h:11,                  from circulant.c:25: cppmat&#47;cppmat.h:12:21: fatal error: algorithm: No such file or directory compilation terminated.</code>"}, {"owner": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524002490, "post_id": 49887196, "comment_id": 86792341, "body": "in <code>&#47;usr&#47;include$ find . -name algorithm</code> I found some candidates. <code>gcc -Icppmat -Imeschach -I&#47;usr&#47;include&#47;c++&#47;5 circulant.c</code> now produces <code>&#47;usr&#47;include&#47;c++&#47;5&#47;utility:68:28: fatal error: bits&#47;c++config.h: No such file or directory compilation terminated.</code> this is a somehow tedious procedure. is there no easier way doing this?"}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "edited": false, "score": 0, "creation_date": 1524003020, "post_id": 49887196, "comment_id": 86792521, "body": "You are using the wrong library.  <code>cppmat</code> has nothing to do with this.  It just happens to have a filed named <code>matrix.h</code>.  You need to follow the installation steps for <a href=\"http://www.netlib.org/c/meschach/\" rel=\"nofollow noreferrer\">meschach</a> from the <a href=\"http://www.netlib.org/c/meschach/readme\" rel=\"nofollow noreferrer\">README</a>. See my posted answer.  Good luck."}, {"owner": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "edited": false, "score": 0, "creation_date": 1524005550, "post_id": 49887196, "comment_id": 86793338, "body": "You are absolutely right. I responded to your answer."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "edited": false, "score": 0, "creation_date": 1524005426, "post_id": 49888010, "comment_id": 86793298, "body": "Thank you. This was the correct approach. <code>$ gcc -Imeschach -c -Iranlib -c circulant.c In file included from circulant.h:11:0,                  from circulant.c:25: meschach&#47;matrix.h:181:8: warning: type defaults to \u2018int\u2019 in declaration of \u2018m_free\u2019 [-Wimplicit-int]...</code> seems to be working with just some warnings. Now I get for the second command however <code>$gcc -shared -fPIC -Imeschach -o circulant.so circulant.o &#47;meschach&#47;meschach.a -lm gcc: error: &#47;meschach&#47;meschach.a: No such file or directory</code>."}, {"owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "reply_to_user": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "edited": false, "score": 0, "creation_date": 1524005750, "post_id": 49888010, "comment_id": 86793393, "body": "probably needs to be <code>.... circulant.o meschach&#47;meschach.a -lm</code> -- ie: no &quot;/&quot; at the front of the path -- because you don&#39;t have a &quot;/&quot; on the path at <code>-Imeschach</code>"}, {"owner": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "edited": false, "score": 0, "creation_date": 1524040416, "post_id": 49888010, "comment_id": 86805093, "body": "<code>gcc -shared -fPIC -Imeschach -o circulant.so circulant.o meschach&#47;meschach.a -lm</code> gives <code>&#47;usr&#47;bin&#47;ld: circulant.o: relocation R_X86_64_32 against </code>.rodata&#39; can not be used when making a shared object; recompile with -fPIC circulant.o: error adding symbols: Bad value collect2: error: ld returned 1 exit status` and <code>gcc -fPIC -Imeschach -o circulant.so circulant.o meschach&#47;meschach.a -lm</code> yields a myriad of other undefined references. at this point I&#39;m probably better of quitting"}], "tags": [], "owner": {"reputation": 2721, "user_id": 8767209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f22597b536b07b41525099a8c16e23ce?s=128&d=identicon&r=PG&f=1", "display_name": "MFisherKDX", "link": "https://stackoverflow.com/users/8767209/mfisherkdx"}, "is_accepted": true, "score": 0, "last_activity_date": 1524002767, "last_edit_date": 1524002767, "creation_date": 1524001746, "answer_id": 49888010, "question_id": 49887196, "link": "https://stackoverflow.com/questions/49887196/using-gcc-for-compiling-converting-matrix-h-no-such-file-or-directory/49888010#49888010", "title": "Using gcc for compiling/converting, matrix.h: No such file or directory", "body": "<p>You aren't using the right header files.</p>\n\n<p>You have some dependency issues you need to take care of first.  From the comment header block of <a href=\"http://www.columbia.edu/~ad3217/fbm/circulant.c\" rel=\"nofollow noreferrer\">circulant.c</a>:</p>\n\n<pre><code>/*  This program simulates fractional Gaussian noise or fractional          */\n/*  Brownian motion using the Wood and Chan algorithm.                      */\n/*  The C-packages Ranlib and Meschach are used, both available             */\n/*  via Netlib (http://www.netlib.org).                                     */\n</code></pre>\n\n<p>Looks to me like the missing <code>matrix.h</code> and <code>matrix2.h</code> files are from the <a href=\"http://www.netlib.org/c/meschach/\" rel=\"nofollow noreferrer\">meschach</a> library.  </p>\n\n<p><strong>You can't just copy the <code>.shar</code> files into a directory.</strong>  </p>\n\n<p>You need to read the <a href=\"http://www.netlib.org/c/meschach/readme\" rel=\"nofollow noreferrer\">README</a> file and follow the installation instructions. So I would recommend installing the <a href=\"http://www.netlib.org/random/\" rel=\"nofollow noreferrer\">ranlib</a> and <a href=\"http://www.netlib.org/c/meschach/\" rel=\"nofollow noreferrer\">meschach</a> dependencies first.</p>\n"}], "owner": {"reputation": 13, "user_id": 9660845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfb892145c7587c7a20789c7746d29?s=128&d=identicon&r=PG&f=1", "display_name": "user103787", "link": "https://stackoverflow.com/users/9660845/user103787"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 983, "favorite_count": 0, "accepted_answer_id": 49888010, "answer_count": 1, "score": 1, "last_activity_date": 1524005600, "creation_date": 1523997844, "last_edit_date": 1524005600, "question_id": 49887196, "link": "https://stackoverflow.com/questions/49887196/using-gcc-for-compiling-converting-matrix-h-no-such-file-or-directory", "title": "Using gcc for compiling/converting, matrix.h: No such file or directory", "body": "<p>I'm trying to convert some .c files to R files using gcc.\nThe files im talking about are circulant.c and circulant.h files located at:</p>\n\n<p><a href=\"http://www.columbia.edu/~ad3217/fbm.html\" rel=\"nofollow noreferrer\">http://www.columbia.edu/~ad3217/fbm.html</a></p>\n\n<p>There the author also provided short instructions how to do it with gcc.\nThings I did so far:</p>\n\n<ol>\n<li>installed Ubuntu via the Win10 Linux Subsystem</li>\n<li>installed build essentials </li>\n<li>installed gcc </li>\n<li><p>downloaded all meschach files from</p>\n\n<p><a href=\"http://www.netlib.org/c/meschach/\" rel=\"nofollow noreferrer\">http://www.netlib.org/c/meschach/</a></p></li>\n<li><p>putting the meschach folder and circulant.x files into one folder and running the command </p>\n\n<p><code>$gcc -I meschach/ -c circulant.c</code></p></li>\n</ol>\n\n<p>gives the error:</p>\n\n<pre><code>In file included from circulant.c:25:0:\ncirculant.h:11:20: fatal error: matrix.h: No such file or directory\ncompilation terminated.\n</code></pre>\n\n<p>I hope that someone with more knowledge with gcc can help me out and point me to a solution.</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 3, "creation_date": 1523997708, "post_id": 49887073, "comment_id": 86790337, "body": "We&#39;ll need to see some code."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1523998098, "post_id": 49887073, "comment_id": 86790508, "body": "Note: Be sure the quote marks in <code>&quot;%s&quot;</code> are not <a href=\"https://en.wikipedia.org/wiki/Quotation_marks_in_English#Smart_quotes\" rel=\"nofollow noreferrer\">smart quotes</a>.  Post looks OK, but true code may differ."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8414403"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523999446, "post_id": 49887073, "comment_id": 86791051, "body": "I included the code @ChristianGibbons"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 1, "creation_date": 1523999792, "post_id": 49887073, "comment_id": 86791210, "body": "<code>accounts</code> is just the definition of your struct.  You need to create a variable of type <code>accounts</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8414403"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524001981, "post_id": 49887073, "comment_id": 86792134, "body": "@ChristianGibbons so if i declared a variable of type accounts = t; Then for my issues with compiler it&#39;d be something like t.accountNum = tempAccNum ??"}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1524013056, "post_id": 49887073, "comment_id": 86795117, "body": "you&#39;d declare <code>t</code> as type accounts the same way you might an int: <code>accounts t;</code>  And then, yes, you&#39;d assign to <code>t</code> such as <code>t.accountNum = 5;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 451, "user_id": 6828765, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/9076a033d487e81eb8a5db8935117714?s=128&d=identicon&r=PG&f=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/6828765/anonymous"}, "is_accepted": false, "score": 0, "last_activity_date": 1523999145, "creation_date": 1523999145, "answer_id": 49887479, "question_id": 49887073, "link": "https://stackoverflow.com/questions/49887073/struct-dot-issue/49887479#49887479", "title": "Struct Dot Issue", "body": "<p>The compiler obviously doesn't think <code>accounts</code> and <code>(accounts)</code> are expressions, which leads me to suspect that there's a type called <code>accounts</code>. If that's the case, all you need to do is rename either the type or the variable.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8414403"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523999421, "creation_date": 1523997362, "last_edit_date": 1523999421, "question_id": 49887073, "link": "https://stackoverflow.com/questions/49887073/struct-dot-issue", "title": "Struct Dot Issue", "body": "<p>I have a struct variable \"accounts\" and when reading in user input I come across these similar issues, which I feel as if the fix would be the same for each. However, I can't put my finger on what \"expression\" goes before \"accounts\" or \".\". Any ideas as to what the issue is and how to fix it?</p>\n\n<pre><code>&gt;main.c: In function \u00e2main\u00e2:\n&gt;main.c:143:18: error: expected expression before \u00e2accounts\u00e2\n scanf(\"%s\", &amp;accounts.first[0]);\n&gt;main.c:146:18: error: expected expression before \u00e2accounts\u00e2\n scanf(\"%s\", &amp;accounts.middle[0]);\n              ^\n&gt;main.c:149:18: error: expected expression before \u00e2accounts\u00e2\n scanf(\"%s\", &amp;accounts.last[0]);\n              ^\n&gt;main.c:179:28: error: expected expression before \u00e2.\u00e2 token\n scanf(\"%d\", &amp;(accounts).accountBalance);\n                        ^\n&gt;main.c:180:13: error: expected identifier or \u00e2(\u00e2 before \u00e2.\u00e2 token\n accounts.accountNum = tempAccNum;\n         ^\n&gt;main.c:182:28: error: expected expression before \u00e2accounts\u00e2\n accList[numAccounts] = accounts;\n</code></pre>\n\n<p>Here is where I declared the struct if this will help:</p>\n\n<pre><code>typedef struct accounts\n{\n    char first[20];\n    char middle[2];\n    char last[20];\n    int accountNum;\n    int accountBalance;\n} accounts;\n</code></pre>\n"}, {"tags": ["c", "arm", "keil", "cortex-a", "nxp-microcontroller"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 3, "creation_date": 1523998357, "post_id": 49887061, "comment_id": 86790613, "body": "If you really have experience with Cortex-M, you should have all of the knowledge to start with. But phrases like <i>processors will come with linux in it</i> are telling me that you might need a bit more background of what a processor is and how it works."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1523999289, "post_id": 49887061, "comment_id": 86790981, "body": "+1 @EugeneSh. I think exactly the same. Probably the C&amp;P &quot;programming&quot;. If you do not need the I/O you just need a computer. Maybe Raspberry Pi is the answer. Massive power, OS, video and the small size."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1524011793, "post_id": 49887061, "comment_id": 86794833, "body": "Cortex-A is a really big step, expect that pretty much none of your NXP code will work at all on Linux.  Your own code adding numbers shifting, whatever generic C code that will work.  Your processor may be faster but timing on the peripherals might be much slower and less accurate and predictable.  You may be better off looking at the Cortex-M4 or Cortex-M7, dont knwo what cortex-m you are using now."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1524011902, "post_id": 49887061, "comment_id": 86794864, "body": "you should probably start with an armv6 rather than jumping to an armv7 or god forbid an armv8.  Now saying that if all you plan to do is run off the shelf libraries (are there such things other than for the raspberry pi?) to wiggle the peripherals and do whatever you think you need to do at that speed and power and cost, then sure anything with any processor on it that you can write C code will work ARM is not relevant at that point, mips, x86, powerpc, whatever."}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1524011954, "post_id": 49887061, "comment_id": 86794876, "body": "How is the IDE relevant?"}, {"owner": {"reputation": 62072, "user_id": 16007, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e859640aaeb4b305e163a990be827cf9?s=128&d=identicon&r=PG&f=1", "display_name": "old_timer", "link": "https://stackoverflow.com/users/16007/old-timer"}, "edited": false, "score": 0, "creation_date": 1524012079, "post_id": 49887061, "comment_id": 86794903, "body": "you can do bare metal on these higher end processors, the raspberry pi has a very strong baremetal community, have not seen its equal outside the avr folks.  The beaglebone family is spotty.  but based on your questions I dont think you are ready for any of these steps, you need to work your way up to this..."}, {"owner": {"reputation": 3123, "user_id": 2097041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8L21m.jpg?s=128&g=1", "display_name": "Colin", "link": "https://stackoverflow.com/users/2097041/colin"}, "edited": false, "score": 0, "creation_date": 1524040907, "post_id": 49887061, "comment_id": 86805394, "body": "If you don&#39;t need IO pins, what is the point of having a processor? You must have some IO for it to do anything useful."}], "answers": [{"comments": [{"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1523999337, "post_id": 49887328, "comment_id": 86791001, "body": "It is not the answer as OP did not ask any  questions. He just expressed his dreams."}, {"owner": {"reputation": 74, "user_id": 9268852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36302006e349f51fafa620bada427e98?s=128&d=identicon&r=PG", "display_name": "user9268852", "link": "https://stackoverflow.com/users/9268852/user9268852"}, "edited": false, "score": 0, "creation_date": 1524063962, "post_id": 49887328, "comment_id": 86821768, "body": "Here is my brief requirement.  Currently I&#39;m using LPC4357(Cortex M4 and M0) to capture images from a 5MP omnivision camera and send it through GPRS to the server. Now i want to send the some portion of the picture(5%) which will be selected by some image proccesing algorithm. i rewritten a python algorthm in C and imported it to my application. Since the complexity of algorbm is high it is further slowing down my application. The reason i want to use bare program without os is, I want to avoid boot up time required by linux. I can implement camera and usb drivers on my own."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "edited": false, "score": 0, "creation_date": 1524066052, "post_id": 49887328, "comment_id": 86823327, "body": "It&#39;s not trivial, but for beagle bone, have a look at this. <a href=\"https://stackoverflow.com/questions/6870712/beagleboard-bare-metal-programming\" title=\"beagleboard bare metal programming\">stackoverflow.com/questions/6870712/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "edited": false, "score": 0, "creation_date": 1524066092, "post_id": 49887328, "comment_id": 86823351, "body": "Raspbery Pi also has a lot of bare metal programming guides. You can check one of those. E.g. <a href=\"http://www.valvers.com/open-software/raspberry-pi/step01-bare-metal-programming-in-cpt1/\" rel=\"nofollow noreferrer\">valvers.com/open-software/raspberry-pi/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "edited": false, "score": 0, "creation_date": 1524066208, "post_id": 49887328, "comment_id": 86823421, "body": "I don&#39;t have both of those hardware available for me at the moment, so I can&#39;t be of further help. However, you can do bare metal in both of them, albeit it&#39;s not trivial. (I suggest using raspberry pi for visual processing, according to my and my colleagues experiences.)"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "is_accepted": false, "score": 2, "last_activity_date": 1523998409, "creation_date": 1523998409, "answer_id": 49887328, "question_id": 49887061, "link": "https://stackoverflow.com/questions/49887061/where-to-start-arm-cortex-a-programming/49887328#49887328", "title": "Where to start ARM Cortex-A programming", "body": "<p>By Cortex-M series, I suppose you have experience with M0 and M3. Right?</p>\n\n<p>If you plan on using A-Series, you should know that they are more designed to run operating systems (than M-Series). (For example they have virtual memory management units...) That's why you may not find much bare-metal programming guides with these processors.</p>\n\n<p>Also, these devices don't usually have on-board ROMs. So, you don't have an embedded flash... Therefore, you basically use an SD-Card or eMMC to boot them.</p>\n\n<p>You may use Linux (Easier for you but won't be real-time), or an RTOS (also easier). If that doesn't suit you, you may use \"UBoot\" from SD-Card or eMMC and do a couple non-trivial steps (dependent on architecture) to run your bare-metal software (which is loaded from SD-Card or eMMC).</p>\n\n<p>I suggest you buy a beagle bone and start from there.</p>\n"}, {"tags": [], "owner": {"reputation": 188, "user_id": 7383437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6d91187498bdb798e42e29eda5f0259?s=128&d=identicon&r=PG&f=1", "display_name": "dhokar.w", "link": "https://stackoverflow.com/users/7383437/dhokar-w"}, "is_accepted": false, "score": 0, "last_activity_date": 1613575082, "creation_date": 1613575082, "answer_id": 66244846, "question_id": 49887061, "link": "https://stackoverflow.com/questions/49887061/where-to-start-arm-cortex-a-programming/66244846#66244846", "title": "Where to start ARM Cortex-A programming", "body": "<p>You can still use Cortex-A for normal bare metal application adn with this way you will have something similair to what to what you had with application running on cortex-m\nHowever it really depends from what you want:</p>\n<ul>\n<li>if you want to understand how cortex-a is working or you are bringing\nup a custom platform which is not that stable so bare metal coding is\nyour answer and with it you will be able learn a lot bout cortex-a\nfunctionality</li>\n<li>If you want to use Cortex-A from user point of view so you need to\ncompile your linux kernel for your cortex-a based board and start\nusing developing on top of your running kernel</li>\n</ul>\n"}], "owner": {"reputation": 74, "user_id": 9268852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36302006e349f51fafa620bada427e98?s=128&d=identicon&r=PG", "display_name": "user9268852", "link": "https://stackoverflow.com/users/9268852/user9268852"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1430, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1613575082, "creation_date": 1523997328, "question_id": 49887061, "link": "https://stackoverflow.com/questions/49887061/where-to-start-arm-cortex-a-programming", "title": "Where to start ARM Cortex-A programming", "body": "<p>I have experience with Cortex-M  controllers (LPC series from NXP) and Keil.\nI want to move for cortex-A because my logic needs some better speed.</p>\n\n<p>I found from internet that these processors will come with linux in it.\nHow can i use my code directly rather than using linux?? </p>\n\n<p>I don't need IO pins.</p>\n\n<p>Where should i start?? What IDE should i use??\nAnd i found debugging of Cortex-A controllers is tough because it is involving OS. is it true?\nAnd is there any way without going for cortex A but achieving higher speeds (around Giga Hz)</p>\n"}, {"tags": ["c", "string", "strcpy"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 4189537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34703f6ad8f883966461fa0a034f8f1b?s=128&d=identicon&r=PG&f=1", "display_name": "Saultyevil", "link": "https://stackoverflow.com/users/4189537/saultyevil"}, "edited": false, "score": 0, "creation_date": 1523997665, "post_id": 49887098, "comment_id": 86790312, "body": "ah, I see. <code>STRING_NO_PAR_CONST = &#39;\\0&#39;</code>. I was using something similar in another function as a check to see if the variable was found. It fixed my issue though, thanks very much!"}], "tags": [], "owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "is_accepted": true, "score": 1, "last_activity_date": 1523998023, "last_edit_date": 1523998023, "creation_date": 1523997437, "answer_id": 49887098, "question_id": 49887014, "link": "https://stackoverflow.com/questions/49887014/strcpy-segmentation-fault/49887098#49887098", "title": "Strcpy() Segmentation Fault", "body": "<p>what is this line doing?</p>\n\n<pre><code>parameter = STRING_NO_PAR_CONST;\n</code></pre>\n\n<p>If it is assigning <code>parameter</code> to point to a string literal, that is likely your problem, you cannot modify the contents of a string literal.</p>\n\n<p>If <code>STRING_NO_PAR_CONST</code> is <code>'\\0'</code>, that is just a <code>char</code>, not a <code>string</code>.  As long as <code>parameter</code> has correctly been allocated some memory prior to calling <code>read_string()</code>, you can just</p>\n\n<pre><code>parameter[0] = STRING_NO_PAR_CONST\n</code></pre>\n\n<p>and the same when you check to see if it has changed</p>\n\n<pre><code>if (parameter[0] == STRING_NO_PAR_CONST)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1806, "user_id": 4146351, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2WTdU1bWVaQ/AAAAAAAAAAI/AAAAAAAABeg/yvJBsxf1slM/photo.jpg?sz=128", "display_name": "Eric Yang", "link": "https://stackoverflow.com/users/4146351/eric-yang"}, "is_accepted": false, "score": 0, "last_activity_date": 1523997661, "creation_date": 1523997661, "answer_id": 49887153, "question_id": 49887014, "link": "https://stackoverflow.com/questions/49887014/strcpy-segmentation-fault/49887153#49887153", "title": "Strcpy() Segmentation Fault", "body": "<p>A few things</p>\n\n<p>strcpy is called as the following -> strcpy(destination, source). You are using parameter as the destination.</p>\n\n<p>That being said, the amount of space you allocate should be the maximum size of the string you want. I don't think that it should equal the maximum number of lines in a given file (though I could be wrong)</p>\n"}], "owner": {"reputation": 45, "user_id": 4189537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34703f6ad8f883966461fa0a034f8f1b?s=128&d=identicon&r=PG&f=1", "display_name": "Saultyevil", "link": "https://stackoverflow.com/users/4189537/saultyevil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 49887098, "answer_count": 2, "score": 1, "last_activity_date": 1523998354, "creation_date": 1523997129, "last_edit_date": 1523998354, "question_id": 49887014, "link": "https://stackoverflow.com/questions/49887014/strcpy-segmentation-fault", "title": "Strcpy() Segmentation Fault", "body": "<p>I have created a function which searches each line of a file and tries to match the parameter <code>par_string</code> with a string in the file. I have variants of the function working for doubles and ints, but I can't seem to modify the function to read in strings from file. </p>\n\n<p>Currently I am using <code>sscanf()</code> to read in a line and my current effort is to use <code>strcpy()</code> to copy the string in the file to the string parameter <code>parameter</code> defined in the function argument. However, my function is seg faulting once I reach <code>strcpy()</code>, and I can't quite figure out why.</p>\n\n<p>I'm hoping to be able to call the function as <code>read_string(\"FILENAME\", filename);</code> in my main function to be able to pass in a parameter to the function and have the filename returned to the variable <code>filename</code>. I've tried defining <code>filename</code> using</p>\n\n<pre><code>char filename[MAXLINE]\n</code></pre>\n\n<p>and</p>\n\n<pre><code>char *filename = malloc(sizeof(*filename) * MAXLINE);\n</code></pre>\n\n<p>but both have the same problem.</p>\n\n<p>Below is the function I've written. Is there anything obvious I'm missing or is there a better way to do this?</p>\n\n<p>Thanks!</p>\n\n<pre><code>int \nread_string(char par_string[], char *parameter)\n{\n    char line[MAX_LINE], ini_par_name[MAX_LINE], par_separator[MAX_LINE];\n    char par_value[MAX_LINE];\n\n    FILE *par_file;\n\n    if ((par_file = fopen(INI_FILE, \"r\")) == NULL)\n    {\n        printf(\"Cannot open parameter file 'plane.ini'.\\n\");\n        exit(-1);\n    }\n\n    int linenum = 0;\n    parameter = STRING_NO_PAR_CONST;\n\n    while(fgets(line, MAX_LINE, par_file) != NULL)\n    {        \n        linenum++;\n\n        /* \n        * If the line is a comment, skip that line. Note: There is a bug here\n        * which will cause the script to crash if there is a blank line.\n        */\n        if (line[0] == '#' || line[0] == ' ')\n        {\n            continue;\n        }\n\n        /* \n        * Check a normal line is in the correct format\n        */\n        if (sscanf(line, \"%s %s %s\", ini_par_name, par_separator, par_value) \\\n            != 3)\n        {\n            printf(\"Syntax error, line %d for parameter %s\\n\", linenum,\n                par_string);\n            exit(-1);\n        }\n\n        /* \n        * Use strcmp to compare the difference between two strings. If it's\n        * the same parameter, then strcmp will return 0. \n        */\n        if (strcmp(par_string, ini_par_name) == 0)\n        {\n            strcpy(parameter, par_value);\n        }\n    }\n\n    /* \n    * If parameter wasn't updated, the parameter was not found. Return an\n    * error. \n    */\n    if (parameter == STRING_NO_PAR_CONST)\n    {\n        printf(\"Parameter %s could not be found.\\nExiting simulation.\\n\",\n            par_string);\n        exit(-1);\n    }\n\n    if (fclose(par_file) != 0)\n    {\n        printf(\"File could not be closed.\\n\");\n        exit(-1);\n    }\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "openssl"], "comments": [{"owner": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1523997418, "post_id": 49886926, "comment_id": 86790192, "body": "It doesn&#39;t look like you are incrementing <code>i</code> in the <code>match()</code> function."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1523997425, "post_id": 49886926, "comment_id": 86790199, "body": "How exactly is <code>buffer</code> populated?  A <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> would be helpful."}, {"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "reply_to_user": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1523997487, "post_id": 49886926, "comment_id": 86790225, "body": "I&#39;m sorry I forgot to write that down, <code>i</code> isn&#39;t the problem @David Bowling"}, {"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "reply_to_user": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1523997528, "post_id": 49886926, "comment_id": 86790238, "body": "@dbush the link I provided gives a complete example"}, {"owner": {"reputation": 15451, "user_id": 6879826, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/WzqBC.png?s=128&g=1", "display_name": "ad absurdum", "link": "https://stackoverflow.com/users/6879826/ad-absurdum"}, "edited": false, "score": 0, "creation_date": 1523997535, "post_id": 49886926, "comment_id": 86790241, "body": "A good reason to include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> for us to work from...."}, {"owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "edited": false, "score": 0, "creation_date": 1523997778, "post_id": 49886926, "comment_id": 86790372, "body": "@thestateofmay The OpenSSL example doesn&#39;t help us.  We need to see the code <b>you wrote</b>, copy and pasted verbatim into the question (not retyped), to know what you did wrong."}, {"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1523998134, "post_id": 49886926, "comment_id": 86790523, "body": "I updated my complete code."}], "owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523998123, "creation_date": 1523996847, "last_edit_date": 1523998123, "question_id": 49886926, "link": "https://stackoverflow.com/questions/49886926/comparing-bits-to-unsigned-character-arrays-in-c", "title": "comparing bits to unsigned character arrays in C", "body": "<p>I have a function that tests for partial collision in <em>sha256</em> hashing. After compiling to a file named <code>sha256</code>, a call in the terminally looks like this:</p>\n\n<pre><code>./sha256 2612c7\n</code></pre>\n\n<p>The function <code>sha256</code> repeatedly generate random bytes to a <code>unsigned char *</code> variable, lets just call it <code>buffer</code> in this case, and compare the first <code>k</code> bits to the argument given. The hash in <code>buffer</code> is generated by <em>OpenSSL</em>'s <a href=\"https://wiki.openssl.org/index.php/EVP_Message_Digests\" rel=\"nofollow noreferrer\">EVP library</a>.</p>\n\n<p>In this case, the argument given is <code>2612c7</code>, and it exists in <code>argv[1]</code>. <code>k = 24</code>, because <code>2612c7</code> is 24 bits. I need to repeated compare the randomly hashed value in <code>buffer</code> to <code>argv[1]</code> and see if they're the same, which indicates collision in the first <code>k</code> bits.</p>\n\n<hr>\n\n<p>I'm kind of confused as to what form <code>argv[1]</code> exist as? Or just how to compare this in general?</p>\n\n<p>I wrote this function:</p>\n\n<pre><code>int match(unsigned char * buffer, unsigned char * hash_value) {\n    int i = 0;\n\n    while(hash_value[i] != '\\0') {\n        if(hash_value[i] != buffer[i]) {\n            return 0;\n        }\n        i++;\n    }\n\n    return 1;\n}\n</code></pre>\n\n<p>and I'm calling <code>match</code> with <code>match(buffer, (unsigned char *) argv[2])</code>, but no collision is being found even with extremely small <code>k</code> values (e.g. <code>./sha256 2</code>).</p>\n\n<hr>\n\n<p>Here's the complete code:</p>\n\n<pre><code>#define _GNU_SOURCE\n\n#include &lt;unistd.h&gt;\n#include &lt;sys/syscall.h&gt;\n#include &lt;linux/random.h&gt;\n\n#include &lt;openssl/conf.h&gt;\n#include &lt;openssl/evp.h&gt;\n#include &lt;openssl/err.h&gt;\n#include &lt;openssl/rand.h&gt;\n\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n/* utitlity function to help matching */\nint match(unsigned char * md_value, unsigned char * hash_value) {\n    int i = 0;\n\n    while(hash_value[i] != '\\0') {\n        if(hash_value[i] != md_value[i]) {\n            return 0;\n        }\n        i++;\n    }\n\n    return 1;\n}\n\n/* ./this.o &lt;digest method&gt; &lt;hash value&gt; */\nint main(int argc, char *argv[]) {  \n    /* hash function initiation */\n    EVP_MD_CTX *mdctx;\n    const EVP_MD *md;\n    unsigned char md_value[EVP_MAX_MD_SIZE];\n    int md_len;\n\n    /* seeding for random number generator */\n    void *seed = NULL;\n    int rseed;\n\n    /* random generator initiation */\n    unsigned char buffer[128];\n\n    /* utility variables for counting */\n    int i = 0;\n\n    /* parameter checking */\n    if (argv[2] == NULL) {\n        printf(\"No hash value given\\n\");\n        exit(1);\n    } else if (argv[1] == NULL) {\n        printf(\"No digest method given\\n\");\n        exit(1);\n    }\n\n    /* get hash method */\n    OpenSSL_add_all_algorithms();\n    md = EVP_get_digestbyname(argv[1]);\n    if (md == NULL) {\n        printf(\"Unknown message digest %s\\n\", argv[1]);\n        exit(1);\n    }\n\n    /* random generator initialization */\n    if(RAND_load_file(\"/dev/random\", 32) != 32) {\n        printf(\"random initialization failed\");\n        exit(1);\n    }\n\n    do {\n\n        /* generate random text */\n        if(RAND_bytes(buffer, sizeof(buffer)) != 1) {\n            printf(\"failed generating random text\");\n            exit(1);\n        } \n\n        /* hash the random text */\n        mdctx = EVP_MD_CTX_create();\n        EVP_DigestInit_ex(mdctx, md, NULL);\n        EVP_DigestUpdate(mdctx, buffer, strlen(buffer));\n        EVP_DigestFinal_ex(mdctx, md_value, &amp;md_len);\n        EVP_MD_CTX_destroy(mdctx);\n\n        /* reseed random */\n        rseed = syscall(SYS_getrandom, seed, (size_t) 128, (unsigned int) 1);\n        RAND_seed(seed, rseed);\n\n        i++;\n    } while(match(md_value, (unsigned char *) argv[2]) == 0);\n\n    printf(\"collision found: %d tries\\n\", i);\n\n    return 0;\n}\n</code></pre>\n\n<p>note that the function in actuality is being called with <code>./a.out sha256 2612c7</code>, I simplified the example above for simplicity.</p>\n"}, {"tags": ["c", "segmentation-fault", "fopen"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 4, "creation_date": 1523997166, "post_id": 49886904, "comment_id": 86790076, "body": "Can&#39;t reproduce a crash at the place you state, whether or not the input file exists. However a few lines further down you are overwriting the memory allocation pointer <code>read_sentence</code> with <code>buffer</code> (or <code>NULL</code>) the return value from <code>fgets</code>. Later <code>free(read_sentence);</code> will fail, because it was not the pointer obtained from <code>malloc</code>."}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 1, "creation_date": 1523998248, "post_id": 49886904, "comment_id": 86790568, "body": "As an aside: I definitely don&#39;t recommend using <code>sudo</code> for this!  (1) Don&#39;t use <code>sudo</code> unless you absolutely have to. (2) Don&#39;t use <code>sudo</code> on unknown programs that might not work correctly! (Is there any reason you thought you had to use <code>sudo</code>?)"}, {"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1523998420, "post_id": 49886904, "comment_id": 86790634, "body": "@Steve Summit yes I thought that it may be because I didn&#39;t have some permissions for using the file, it was just some random guessing"}, {"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1523999128, "post_id": 49886904, "comment_id": 86790915, "body": "@WeatherVane I&#39;ll fix that, as for my seg.fault are you saying that you have tried the code on your machine and it works the fopen?"}, {"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "reply_to_user": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 0, "creation_date": 1524000150, "post_id": 49886904, "comment_id": 86791346, "body": "@SteveSummit question edited, if i double click on correctme.txt it opens with his content (which is a sentence)"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 1, "creation_date": 1524000843, "post_id": 49886904, "comment_id": 86791675, "body": "@ZenoRaiser yes it responds correctly to no filename provided, an existing filename, and one that doesn&#39;t exist. I didn&#39;t run the code further, but noticed the error in my first comment, about trashing the memory pointer returned by <code>malloc</code> (your code has since changed: please don&#39;t do that in in response to fault reports - the comment trail will not make sense. Am tempted to downvote the question for that reason, but did not)."}, {"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524001191, "post_id": 49886904, "comment_id": 86791819, "body": "@WeatherVane sorry i don&#39;t know this mechanics, i&#39;ll put it again as before"}, {"owner": {"reputation": 40834, "user_id": 297323, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/97e8a3c4945a8a898cbf216ce912fd46?s=128&d=identicon&r=PG", "display_name": "Fredrik Pihl", "link": "https://stackoverflow.com/users/297323/fredrik-pihl"}, "edited": false, "score": 1, "creation_date": 1524002018, "post_id": 49886904, "comment_id": 86792153, "body": "have you investigated the core-dump? You cannot rely on the printouts to determine what line causes the crash. Compile with <code>gcc -g</code> then do <code>ulimit -c unlimited</code> then run program to generate core dump, then <code>gdb .&#47;binary core</code>"}, {"owner": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 0, "creation_date": 1524002852, "post_id": 49886904, "comment_id": 86792466, "body": "Note that because <code>printf(&quot;a&quot;)</code> does not end with a newline and you do not include <code>fflush(stdout);</code> after it, you are not guaranteed to see that printed.  Add newlines at the end of diagnostic output \u2014 and consider printing it to <code>stderr</code> instead of <code>stdout</code>."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 663663, "user_id": 15168, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WtEI9.png?s=128&g=1", "display_name": "Jonathan Leffler", "link": "https://stackoverflow.com/users/15168/jonathan-leffler"}, "edited": false, "score": 1, "creation_date": 1524003414, "post_id": 49886904, "comment_id": 86792664, "body": "@JonathanLeffler the original code had <code>printf(&quot;this line won&#39;t be printed\\n&quot;);</code> with a newline although that may not be guaranteed to flush the output. To Zeno Raiser: see what you caused by changing the question?"}, {"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1524028307, "post_id": 49886904, "comment_id": 86798761, "body": "@WeatherVane not changing them it will be a lesson for the next time, later i&#39;ll try the suggestions above"}, {"owner": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "edited": false, "score": 1, "creation_date": 1524031990, "post_id": 49886904, "comment_id": 86800246, "body": "@ZenoRaiser please put <code>LANG= </code> in front of the commands to get error messages etc in English"}, {"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "reply_to_user": {"reputation": 15165, "user_id": 1116364, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b67dfca0caba03083330d39a304b1766?s=128&d=identicon&r=PG", "display_name": "Daniel Jour", "link": "https://stackoverflow.com/users/1116364/daniel-jour"}, "edited": false, "score": 0, "creation_date": 1524032346, "post_id": 49886904, "comment_id": 86800427, "body": "@DanielJour thanks that could be my next search on google"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1524034534, "post_id": 49886904, "comment_id": 86801639, "body": "&quot;gcc -g testloadfile testloadfile.c&quot; this command doesn&#39;t make a lot of sense. You don&#39;t normally compile an executable. You probably want to stick a <code>-o</code> flag before <code>testloadfile</code>."}, {"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "reply_to_user": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1524034787, "post_id": 49886904, "comment_id": 86801776, "body": "I did it on a user suggestion, which i could have misunderstood @n.m."}], "answers": [{"comments": [{"owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "edited": false, "score": 0, "creation_date": 1524034309, "post_id": 49892766, "comment_id": 86801526, "body": "Thanks, i&#39;ll try, by &quot;additional note, that memory you allocated originally for read_sentence, is now leaked and you won&#39;t be able to free it.&quot; this you mean that everytime i tried to run the program there was a memory leak and that now i have some mempry filled but unused  which can&#39;t be free-ed because i don&#39;t know the addresses of those mempry leaks?"}, {"owner": {"reputation": 862, "user_id": 890897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7846a21f6ef5adf0d5bd0375b04428e?s=128&d=identicon&r=PG", "display_name": "tdk001", "link": "https://stackoverflow.com/users/890897/tdk001"}, "reply_to_user": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "edited": false, "score": 1, "creation_date": 1524035275, "post_id": 49892766, "comment_id": 86802051, "body": "30 years ago, that would have been the case, but these days, our OS&#39;s can usually clean up a process&#39;s leaked memory when it exits. It&#39;s just during your program&#39;s execution that the memory is leaked."}], "tags": [], "owner": {"reputation": 862, "user_id": 890897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7846a21f6ef5adf0d5bd0375b04428e?s=128&d=identicon&r=PG", "display_name": "tdk001", "link": "https://stackoverflow.com/users/890897/tdk001"}, "is_accepted": true, "score": 3, "last_activity_date": 1524033384, "creation_date": 1524033384, "answer_id": 49892766, "question_id": 49886904, "link": "https://stackoverflow.com/questions/49886904/segfault-on-fopen-c/49892766#49892766", "title": "Segfault on fopen c", "body": "<p>The actual seg fault is likely on this line:</p>\n\n<pre><code> free(read_sentence);\n</code></pre>\n\n<p>It is important to remember that <code>printf()</code> sends output to <code>stdout</code>, which is buffered. As such, things you send to it will not necessarily get printed if a seg fault occurs.</p>\n\n<p>As for the seg fault itself, let's look at these lines here:</p>\n\n<pre><code>read_sentence = malloc((2048+1)*sizeof(char));\n\nread_sentence = fgets(buffer,buf_size,fp);\n</code></pre>\n\n<p>It looks like you think you are allocating <code>read_sentence</code> and then putting the data read from <code>fp</code> into it (and indeed the code will act like this happened), but this is not true.</p>\n\n<p>Instead, you read the data into <code>buffer</code> and then set <code>read_sentence</code> to <em>the address of</em> <code>buffer</code>.</p>\n\n<p>You then do your operations and we come back to the first line I pointed out:</p>\n\n<pre><code>free(read_sentence);\n</code></pre>\n\n<p>This is not freeing the memory allocated in your <code>malloc()</code> call above, but rather <code>buffer</code> which is on the stack, and thus cannot be <code>free()</code>-ed. As an additional note, that memory you allocated originally for <code>read_sentence</code>, is now leaked and you won't be able to free it.</p>\n\n<p>The best solution to this would be to drop <code>read_sentence</code> (along with the <code>malloc()</code> and <code>free()</code> pair) all together and just do your operations inside <code>buffer</code> instead.</p>\n"}], "owner": {"reputation": 197, "user_id": 8727379, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-1CIQH1Odgd4/AAAAAAAAAAI/AAAAAAAAADs/rsewUiShkr0/photo.jpg?sz=128", "display_name": "Zeno Raiser", "link": "https://stackoverflow.com/users/8727379/zeno-raiser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 1, "accepted_answer_id": 49892766, "answer_count": 1, "score": 2, "last_activity_date": 1524033384, "creation_date": 1523996759, "last_edit_date": 1524032298, "question_id": 49886904, "link": "https://stackoverflow.com/questions/49886904/segfault-on-fopen-c", "title": "Segfault on fopen c", "body": "<p>In the following code I get a seg.fault, I don't know why this happens since I think that I'm passing the correct parameters to <code>fopen</code></p>\n\n<p>Compiling :</p>\n\n<pre><code>gcc -o testloadfile testloadfile.c\n</code></pre>\n\n<p>Running attempts :</p>\n\n<p>First attempt</p>\n\n<pre><code>./testloadfile \"correctme.txt\"\n</code></pre>\n\n<p>Second attempt</p>\n\n<pre><code> sudo ./testloadfile correctme.txt \n</code></pre>\n\n<p>In the same folder of <code>testloadfile.c</code> I have a <code>.txt</code> called <code>correctme.txt</code> </p>\n\n<p>The code is the following</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nstatic void load_array(const char* file_name){\n  char *read_sentence;\n  char buffer[2048];\n  char a[100][100];\n  int buf_size = 2048;\n  FILE *fp;\n  int j = 0, c = 0;\n\n  printf(\"\\nLoading data from file...\\n\");\n  printf(\"%s \\n\", file_name); //prints correctme.txt  \n  fp = fopen(file_name,\"r\"); //error happens here\n  printf(\"This line won't be printed \\n\"); \n  if(fp == NULL){\n    fprintf(stderr,\"main: unable to open the file\");\n    exit(EXIT_FAILURE);\n  }\n\n read_sentence = malloc((2048+1)*sizeof(char));\n\n read_sentence = fgets(buffer,buf_size,fp);\n\n  for(int i = 0; i &lt; strlen(read_sentence); i++) {\n    a[j][c++] = read_sentence[i];\n    if(read_sentence[i] == ' ' || read_sentence[i] == '.' || read_sentence[i] == ',') {\n        j++;\n        c = 0;\n        continue;\n    }   \n  }\n\n  free(read_sentence);\n\n  for(int i = 0; i &lt; 100; i++) \n    printf(\"%s\\n\", a[i]);\n\n  fclose(fp);\n  printf(\"\\nData loaded\\n\");\n}\n\nint main(int argc, char const *argv[]) {\n  if(argc &lt; 2) {\n    printf(\"Usage: ordered_array_main &lt;file_name&gt;\\n\");\n    exit(EXIT_FAILURE);\n  }\n\n  load_array(argv[1]);\n\n}\n</code></pre>\n\n<p>This is the mentioned folder <a href=\"https://i.stack.imgur.com/98RmU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/98RmU.png\" alt=\"enter image description here\"></a></p>\n\n<p>This is the output for <code>gcc -g testloadfile testloadfile.c</code> </p>\n\n<pre><code>testloadfile: In function `_fini':\n(.fini+0x0): multiple definition of `_fini'\n/usr/lib/gcc/x86_64-linux-gnu/5/../../../x86_64-linux-gnu/crti.o:(.fini+0x0): first defined here\ntestloadfile: In function `data_start':\n(.data+0x0): multiple definition of `__data_start'\n/usr/lib/gcc/x86_64-linux-gnu/5/../../../x86_64-linux-gnu/crt1.o:(.data+0x0): first defined here\ntestloadfile: In function `data_start':\n(.data+0x8): multiple definition of `__dso_handle'\n/usr/lib/gcc/x86_64-linux-gnu/5/crtbegin.o:(.data+0x0): first defined here\ntestloadfile:(.rodata+0x0): multiple definition of `_IO_stdin_used'\n/usr/lib/gcc/x86_64-linux-gnu/5/../../../x86_64-linux-gnu/crt1.o:(.rodata.cst4+0x0): first defined here\ntestloadfile: In function `_start':\n(.text+0x0): multiple definition of `_start'\n/usr/lib/gcc/x86_64-linux-gnu/5/../../../x86_64-linux-gnu/crt1.o:(.text+0x0): first defined here\ntestloadfile: In function `_init':\n(.init+0x0): multiple definition of `_init'\n/usr/lib/gcc/x86_64-linux-gnu/5/../../../x86_64-linux-gnu/crti.o:(.init+0x0): first defined here\n/tmp/cc0ye2Ms.o: In function `main':\n/home/zenoraiser/Scrivania/Universit\u00e0/Secondo Anno/Algoritmi/1718/LAB/Progetto/Esercizio2/testloadfile.c:42: multiple definition of `main'\ntestloadfile:(.text+0x346): first defined here\n/usr/lib/gcc/x86_64-linux-gnu/5/crtend.o:(.tm_clone_table+0x0): multiple definition of `__TMC_END__'\ntestloadfile:(.data+0x10): first defined here\n/usr/bin/ld: error in testloadfile(.eh_frame); no .eh_frame_hdr table will be created.\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>Then i did <code>ulimit -c unlimited</code></p>\n\n<p>After that i run the program with <code>./testloadfile \"correctme.txt\"</code></p>\n\n<p>In the end I used <code>gdb ./bynary core</code>, this is it's output</p>\n\n<pre><code>GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1\nCopyright (C) 2016 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n&lt;http://www.gnu.org/software/gdb/bugs/&gt;.\nFind the GDB manual and other documentation resources online at:\n&lt;http://www.gnu.org/software/gdb/documentation/&gt;.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\n./bynary: No such file or directory.\n/home/zenoraiser/Scrivania/Universit\u00e0/Secondo Anno/Algoritmi/1718/LAB/Progetto/Esercizio2/core: No such file or directory.\n</code></pre>\n\n<p>(sorry later i'll try to understand how to use the last command)</p>\n"}, {"tags": ["c", "optimization", "backtracking", "knights-tour"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523997076, "post_id": 49886871, "comment_id": 86790033, "body": "See this answer: <a href=\"https://stackoverflow.com/a/18074034/8513665\">stackoverflow.com/a/18074034/8513665</a> and also this Wiki link to &quot;warnsdorf&#39;s rule&quot; about taking the path of fewest options: <a href=\"https://en.wikipedia.org/wiki/Knight&#39;s_tour#Warnsdorf%27s_rule\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Knight&#39;s_tour#Warnsdorf%27s_rule</a>"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524000381, "post_id": 49886871, "comment_id": 86791435, "body": "&quot;output for 7*7 grid after 2 minutes. For 8*8 grid i waited for around 15 minutes&quot; --&gt; Consider using a different <code>n</code> for rows and columns, then code could try a 7*8 board before attempting the 8*8."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1524002062, "post_id": 49886871, "comment_id": 86792169, "body": "Tip: Add <code>static int depth = 0;if (number &gt; depth) {      printf(&quot;Depth %d\\n&quot;, depth);      depth = number;      print();    }</code> to the beginning of <code>solve(int x, int y, int number)</code> to see how well code is progressing."}], "owner": {"reputation": 99, "user_id": 8772273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a29d847391a7ecad4b8f7339da5f0b3?s=128&d=identicon&r=PG&f=1", "display_name": "Mukul", "link": "https://stackoverflow.com/users/8772273/mukul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 437, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1523996635, "creation_date": 1523996635, "question_id": 49886871, "link": "https://stackoverflow.com/questions/49886871/implementation-of-knight-tour-in-c-for-knight-at-any-random-position-on-board", "title": "Implementation of knight tour in c for knight at any random position on board", "body": "<p>I am very new to the algorithm. I just came to know about backtracking algorithm and saw a video for knight tour problem on youtube. The video solve the problem with knight starting from initial position as (0,0). I tried to implement it for any random position. This worked perfectly for 6*6 grid and i got output for 7*7 grid after 2 minutes. For 8*8 grid i waited for around 15 minutes but i didn't get any output. I tried to debug it using <code>printf</code> before calling <code>solve</code> function recursively.But i could not figure out anything. I don't know any optimization technique. I have just finished with my basic programming course in c.</p>\n\n<p>Given code works perfectly if n is 8 and knight start from (0,0) position.In the place of <code>solve(0,0,1)</code> if i use <code>solve(3,4,1)</code> it does not give any output.        </p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\n\n#define n 8\n\nint solve(int,int,int);\nint nextx(int ,int);\nint nexty(int,int);\nvoid print(void);\n\n\nint grid[n][n]={0};\n\nint main()\n{\nprint();\nprintf(\"\\n\\n\");\nsolve(3,2,1);\nprint();\n\nreturn 0;\n}\nint solve(int x,int y,int number)\n{\n  if(number&gt;(n*n)) return 1;\n  int  move=0;\n\n  if(grid[x][y]==0)\n  {\n        while(move&lt;8)\n        {\n            if((nextx(x,move)!=-1)&amp;&amp;(nexty(y,move)!=-1))\n               {\n                 grid[x][y]=number;\n\n                  if(solve(nextx(x,move),nexty(y,move),number+1))\n                       return 1;\n\n              }\n              move++;\n        }\n        grid[x][y]=0;\n  }\n\n   return 0;\n\n}\n\nint nextx(int x,int move)\n{\nif(move==0) x=x+1;\nelse if(move==1) x=x+2;\nelse if(move==2) x=x+2;\nelse if(move==3) x=x+1;\nelse if(move==4) x=x-1;\nelse if(move==5) x=x-2;\nelse if(move==6) x=x-2;\nelse if(move==7) x=x-1;\n\nif(x&lt;0||x&gt;(n-1))\n    return (-1);\nelse\n\n   return(x);\n\n}\nint nexty(int y,int move)\n{\nif(move==0) y=y-2;\nelse if(move==1) y=y-1;\nelse if(move==2) y=y+1;\nelse if(move==3) y=y+2;\nelse if(move==4) y=y+2;\nelse if(move==5) y=y+1;\nelse if(move==6) y=y-1;\nelse if(move==7) y=y-2;\n\nif(y&lt;0||y&gt;(n-1))\n    return (-1);\nelse\nreturn(y);\n\n}\n\nvoid print(void)\n{\nint i,j;\nfor(i=0;i&lt;n;i++)\n{\n for(j=0;j&lt;n;j++)\n printf(\"%3d \",grid[j][i]);\n printf(\"\\n\");\n }\n\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 4598, "user_id": 9264702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mHczh.jpg?s=128&g=1", "display_name": "Stephen Docy", "link": "https://stackoverflow.com/users/9264702/stephen-docy"}, "edited": false, "score": 2, "creation_date": 1523996758, "post_id": 49886830, "comment_id": 86789856, "body": "you should always check the return value from <code>fopen()</code>, don&#39;t assume it was successful."}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1523996771, "post_id": 49886830, "comment_id": 86789866, "body": "&quot;Everytime time i try to run the program and with other attempts it will not run&quot; --&gt; When a program has trouble and uses <code>fscanf()</code> and family, a very good first debugging step is to code a check of the return value of <code>fscanf().</code> and <code>fopen()</code>. Perhaps: <code>if   (fscanf( water, &quot;%d&quot;, &amp;monthly_water_arr[num_months]) != 1) {puts(&quot;Error&quot;); exit(-1);}</code>"}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1524005413, "post_id": 49886830, "comment_id": 86793296, "body": "inside of your for loop avoid putting the data directly into the array until you confirm its reading and printing the data correctly ... classic case of divide and conquer a problem ... sure once confirmed the read is OK then directly store into the array however that is not the initial approach"}], "answers": [{"comments": [{"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1523996914, "post_id": 49886907, "comment_id": 86789945, "body": "That&#39;s not what&#39;s being asked."}], "tags": [], "owner": {"reputation": 121, "user_id": 5563909, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-zXs2WYwbe34/AAAAAAAAAAI/AAAAAAAABFg/VZebYmmZyI4/photo.jpg?sz=128", "display_name": "Akhil Sharma", "link": "https://stackoverflow.com/users/5563909/akhil-sharma"}, "is_accepted": false, "score": 0, "last_activity_date": 1523996762, "creation_date": 1523996762, "answer_id": 49886907, "question_id": 49886830, "link": "https://stackoverflow.com/questions/49886830/how-to-write-code-in-c-to-read-integers-from-a-file/49886907#49886907", "title": "how to write code in c to read integers from a file", "body": "<p>You need to run the loop to print the data as well. Same way you are doing for reading it.</p>\n"}], "owner": {"reputation": 11, "user_id": 9660843, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "John McKinnon", "link": "https://stackoverflow.com/users/9660843/john-mckinnon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 27, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523996762, "creation_date": 1523996471, "question_id": 49886830, "link": "https://stackoverflow.com/questions/49886830/how-to-write-code-in-c-to-read-integers-from-a-file", "title": "how to write code in c to read integers from a file", "body": "<p>I am new to c programming and trying to write code to read from a file a handful of integers into a one dimensional array.  Where the integers are the number of millions of gallons of water provided to a major city over the period of one month and the number of months is the counter variable in the loop. Everytime time i try to run the program and with other attempts it will not run, saying \"Thread 1: EXC_BAD_ACCESS (code=1, address=0x68)\".\nhere is the data:\n123 134 122 128 111 110 98 99 78 98\n100 120 122 110 111 123 134 122 128 111 110 98 99 78 98 100 120 122 110 111</p>\n\n<p>thank you in advance.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#define size 50\n\nint main()\n{\n    int monthly_water_arr[size];\n    int num_months;\n    FILE *water;\n\n    water=fopen(\"water.data.txt\",\"r\");\n\n\n    for(num_months=0;num_months&lt;size;num_months++)\n    {\n        fscanf(water,\"%d\",&amp;monthly_water_arr[num_months]);\n    }\n    printf(\"the number of months is %d\\n\",num_months);\n\n    fclose(water);\n    return(0);\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 3, "creation_date": 1523994613, "post_id": 49886359, "comment_id": 86788807, "body": "<code>int main(void);</code> --&gt; <code>int main(void)</code>"}, {"owner": {"reputation": 31, "user_id": 9660701, "user_type": "registered", "profile_image": "https://graph.facebook.com/1673337149412069/picture?type=large", "display_name": "Marcus Gilchrist", "link": "https://stackoverflow.com/users/9660701/marcus-gilchrist"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523994754, "post_id": 49886359, "comment_id": 86788886, "body": "already tried that, it doesn&#39;t fix the issue."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 3, "creation_date": 1523995200, "post_id": 49886359, "comment_id": 86789086, "body": "@MarcusGilchrist Does the error still point to the same line, or does it now point to the other place where you made that mistake?"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1523995252, "post_id": 49886359, "comment_id": 86789114, "body": "<code>return</code> is not a function. <code>(0)</code> is just a funny way to write <code>0</code>."}, {"owner": {"reputation": 31, "user_id": 9660701, "user_type": "registered", "profile_image": "https://graph.facebook.com/1673337149412069/picture?type=large", "display_name": "Marcus Gilchrist", "link": "https://stackoverflow.com/users/9660701/marcus-gilchrist"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523995839, "post_id": 49886359, "comment_id": 86789393, "body": "I&#39;m new to c code so pardon my lack of strength in the subject, but @ChristianGibbons but it actually says neither, it gave me a new error instead saying expected &#39;=&#39;, &#39;,&#39;, &#39;;&#39;, &#39;asm&#39; or &#39;<b>attribute</b>&#39; before &#39;{&#39; token."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 1, "creation_date": 1523996029, "post_id": 49886359, "comment_id": 86789499, "body": "<a href=\"https://ideone.com/tQ8vt2\" rel=\"nofollow noreferrer\">Can&#39;t reproduce</a>."}, {"owner": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "edited": false, "score": 0, "creation_date": 1524004633, "post_id": 49886359, "comment_id": 86793071, "body": "In addition to what Christian said, you don&#39;t set the return value by assigning to the function name. You declare a local variable, assign to that, and then do return varname;  (or just return the characters immediately)"}, {"owner": {"reputation": 31, "user_id": 9660701, "user_type": "registered", "profile_image": "https://graph.facebook.com/1673337149412069/picture?type=large", "display_name": "Marcus Gilchrist", "link": "https://stackoverflow.com/users/9660701/marcus-gilchrist"}, "reply_to_user": {"reputation": 1439, "user_id": 5196093, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ovj7.png?s=128&g=1", "display_name": "Ray", "link": "https://stackoverflow.com/users/5196093/ray"}, "edited": false, "score": 0, "creation_date": 1524006492, "post_id": 49886359, "comment_id": 86793584, "body": "@Ray yeah i realized the error now, was just confused as to what i was doing wrong but thank you for your insight."}], "answers": [{"tags": [], "owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "is_accepted": false, "score": 2, "last_activity_date": 1523994765, "creation_date": 1523994765, "answer_id": 49886405, "question_id": 49886359, "link": "https://stackoverflow.com/questions/49886359/main-c71-error-expected-identifier-or-before-token/49886405#49886405", "title": "main.c:7:1 error: expected identifier or &#39;(&#39; before &#39;{&#39; token", "body": "<pre><code>int main(void);\n</code></pre>\n\n<p>^ Function declaration.</p>\n\n<pre><code>int main(void) { ... }\n</code></pre>\n\n<p>^ Function definition; function body goes between <code>{</code> <code>}</code>.</p>\n\n<pre><code>int main(void); { ... }\n</code></pre>\n\n<p>^ Syntax error; can't have both <code>;</code> and <code>{</code> <code>}</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1523995145, "post_id": 49886433, "comment_id": 86789054, "body": "Yes <code>return tmp;</code> but you have no default value. The conditionals can be simplified by the use of <code>else</code> because each grade value is being tested twice."}, {"owner": {"reputation": 31, "user_id": 9660701, "user_type": "registered", "profile_image": "https://graph.facebook.com/1673337149412069/picture?type=large", "display_name": "Marcus Gilchrist", "link": "https://stackoverflow.com/users/9660701/marcus-gilchrist"}, "edited": false, "score": 0, "creation_date": 1523995487, "post_id": 49886433, "comment_id": 86789235, "body": "i see now what you mean by the redundancy of always returning 0 but im confused by what you mean there is no default value?"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1523995487, "post_id": 49886433, "comment_id": 86789236, "body": "<code>if (numgrade &lt; 50) { tmp = &#39;D&#39;; } else if (numgrade &lt; 65) { tmp = &#39;C&#39;; } else if (numgrade &lt; 80) { tmp = &#39;B&#39;; } else { tmp = &#39;A&#39;; }</code> . Note that some of your conditionals were the wrong sense, for example <code>numgrade &lt;= 50</code> should have been <code>numgrade &gt;= 50</code>, but I have side-stepped that."}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "reply_to_user": {"reputation": 31, "user_id": 9660701, "user_type": "registered", "profile_image": "https://graph.facebook.com/1673337149412069/picture?type=large", "display_name": "Marcus Gilchrist", "link": "https://stackoverflow.com/users/9660701/marcus-gilchrist"}, "edited": false, "score": 0, "creation_date": 1523996315, "post_id": 49886433, "comment_id": 86789639, "body": "@MarcusGilchrist yes (to the deleted &quot;any glaring errors?&quot;): not checking the return value from <code>scanf(&quot;%f&quot;, &amp;numgrade);</code> which is the number of items successfully converted. <code>float numgrade;</code> was <i>uninitialised</i> so if <code>scanf</code> fails you will pass garbage to the function."}, {"owner": {"reputation": 10050, "user_id": 3512538, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6Om7A.png?s=128&g=1", "display_name": "CIsForCookies", "link": "https://stackoverflow.com/users/3512538/cisforcookies"}, "reply_to_user": {"reputation": 31, "user_id": 9660701, "user_type": "registered", "profile_image": "https://graph.facebook.com/1673337149412069/picture?type=large", "display_name": "Marcus Gilchrist", "link": "https://stackoverflow.com/users/9660701/marcus-gilchrist"}, "edited": false, "score": 0, "creation_date": 1523996521, "post_id": 49886433, "comment_id": 86789757, "body": "@MarcusGilchrist not sure what you mean. Do you want to add a default value in case all of your condition are false? If so just add another else, and assign <code>tmp</code> with your default value, and then return it. If this is not what you mean, please explain"}, {"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1523996584, "post_id": 49886433, "comment_id": 86789778, "body": "Sorry, I think that that was because of my first comment ;) I realise this is your answer so I gave UV."}, {"owner": {"reputation": 31, "user_id": 9660701, "user_type": "registered", "profile_image": "https://graph.facebook.com/1673337149412069/picture?type=large", "display_name": "Marcus Gilchrist", "link": "https://stackoverflow.com/users/9660701/marcus-gilchrist"}, "edited": false, "score": 1, "creation_date": 1523997007, "post_id": 49886433, "comment_id": 86789993, "body": "@CIsForCookies yes that was what i was asking, thank you. Weather Vane merely trying to save the embarrassment actually;) but thanks for the help guys, its greatly appreciated."}], "tags": [], "owner": {"reputation": 10050, "user_id": 3512538, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6Om7A.png?s=128&g=1", "display_name": "CIsForCookies", "link": "https://stackoverflow.com/users/3512538/cisforcookies"}, "is_accepted": true, "score": 3, "last_activity_date": 1524034801, "last_edit_date": 1524034801, "creation_date": 1523994885, "answer_id": 49886433, "question_id": 49886359, "link": "https://stackoverflow.com/questions/49886359/main-c71-error-expected-identifier-or-before-token/49886433#49886433", "title": "main.c:7:1 error: expected identifier or &#39;(&#39; before &#39;{&#39; token", "body": "<p>You have the same mistake twice:</p>\n\n<ol>\n<li><code>char lettergrade(float numgrade);...</code>--><code>char lettergrade(float numgrade)...{}</code></li>\n<li><code>int main(void); ...</code>--><code>int main(void) ...{}</code></li>\n</ol>\n\n<p>But beside that, you code has other errors these two masked :-(</p>\n\n<p><code>lettergrade = 'D';</code> is not legal since <code>lettergrade</code>  is the function name (and therefore is not an <em>\"lvalue\"</em> which means you can't assign a value to it), and it should be a variable in this context. change to something like:</p>\n\n<pre><code>char lettergrade(float numgrade)\n{\n    char tmp;\n    if (numgrade &lt; 50)\n    {\n        tmp = 'D';\n    }\n    if (numgrade &lt;= 50 &amp;&amp; numgrade &lt; 65) // also, this probably should be if (numgrade &gt;= 50 &amp;&amp; ...\n    {\n        tmp = 'C';\n    }\n    if (numgrade &lt;= 65 &amp;&amp; numgrade &lt; 80) // same goes here\n    {\n        tmp = 'B';\n    }\n    if (numgrade &gt;= 80)\n    {\n        tmp = 'A';\n    }\n\n    // return tmp \n    /* consider returning tmp, since always returning (0) \n       makes this whole function redundant (your current \n       function just returns 0, no matter what the input is) */\n    return(0);\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 9660701, "user_type": "registered", "profile_image": "https://graph.facebook.com/1673337149412069/picture?type=large", "display_name": "Marcus Gilchrist", "link": "https://stackoverflow.com/users/9660701/marcus-gilchrist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 491, "favorite_count": 0, "accepted_answer_id": 49886433, "answer_count": 2, "score": 2, "last_activity_date": 1524034801, "creation_date": 1523994577, "last_edit_date": 1523994917, "question_id": 49886359, "link": "https://stackoverflow.com/questions/49886359/main-c71-error-expected-identifier-or-before-token", "title": "main.c:7:1 error: expected identifier or &#39;(&#39; before &#39;{&#39; token", "body": "<p>i am writing a program in c code that is designed to return a letter grade based on the numerical value you enter but it returns the same error every time, which i can't seem to figure out.   </p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nchar lettergrade(float numgrade);\n\nint main(void);\n{\n    float numgrade;\n    char grade;\n\n    printf(\" what is your numerical grade? \");\n    scanf(\"%f\", &amp;numgrade);\n\n    grade = lettergrade (numgrade);\n\n    printf(\"here is your letter grade: %c \", grade);\n\n    system(\"pause\");\n    return(0);\n}\n\nchar lettergrade(float numgrade);\n{\n    if (numgrade &lt; 50)\n    {\n        lettergrade = 'D';\n    }\n    if (numgrade &lt;= 50 &amp;&amp; numgrade &lt; 65)\n    {\n        lettergrade = 'C';\n    }\n    if (numgrade &lt;= 65 &amp;&amp; numgrade &lt; 80)\n    {\n        lettergrade = 'B';\n    }\n    if (numgrade &gt;= 80)\n    {\n        lettergrade = 'A';\n    }\n\n    return(0);\n}\n</code></pre>\n"}, {"tags": ["c", "multithreading", "operating-system"], "comments": [{"owner": {"reputation": 71860, "user_id": 366377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863018588657c38d29f22e72dc81325e?s=128&d=identicon&r=PG", "display_name": "Jens Gustedt", "link": "https://stackoverflow.com/users/366377/jens-gustedt"}, "edited": false, "score": 1, "creation_date": 1523993873, "post_id": 49886096, "comment_id": 86788453, "body": "Please indent your code properly (this unreadable) and try to reduce it to a minimal example."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1524008440, "post_id": 49886096, "comment_id": 86794102, "body": "To be clear, you have one thread sorting the fist half, another sorting the second half.  While that is going on, what is the third thread doing?"}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1524009161, "post_id": 49886096, "comment_id": 86794274, "body": "I&#39;m not sure what is going on here at all. Should not the last merge not wait until the two halves are sorted?"}, {"owner": {"reputation": 49, "user_id": 7300599, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f59230043e14296594183b687c47b3a?s=128&d=identicon&r=PG&f=1", "display_name": "Maaz Azeem", "link": "https://stackoverflow.com/users/7300599/maaz-azeem"}, "reply_to_user": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1524236411, "post_id": 49886096, "comment_id": 86905317, "body": "@MartinJames the third thread combines the two threads together. The first thread partitions the left side of the array and sorts it and the second thread partitions the right side of the array and sorts it"}], "answers": [{"tags": [], "owner": {"reputation": 10842, "user_id": 2164365, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/RKSgV.png?s=128&g=1", "display_name": "Abra", "link": "https://stackoverflow.com/users/2164365/abra"}, "is_accepted": false, "score": 1, "last_activity_date": 1523994072, "creation_date": 1523994072, "answer_id": 49886253, "question_id": 49886096, "link": "https://stackoverflow.com/questions/49886096/multithreading-vs-singlethreading-process-runtimes/49886253#49886253", "title": "Multithreading vs Singlethreading process runtimes", "body": "<p>Threads take time to set up and launch. The larger the amount of work to be done, the more chance that multiple threads will reduce the overall time taken to complete the task.</p>\n\n<p>In your example, I'm guessing that file <em>soulfoodinput.txt</em> is not very large, so I would suggest making it larger, if possible it should contain hundreds or even thousands of lines. Then see if the multi-thread code runs quicker than the single-thread.</p>\n"}, {"comments": [{"owner": {"reputation": 49, "user_id": 7300599, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f59230043e14296594183b687c47b3a?s=128&d=identicon&r=PG&f=1", "display_name": "Maaz Azeem", "link": "https://stackoverflow.com/users/7300599/maaz-azeem"}, "edited": false, "score": 0, "creation_date": 1523995611, "post_id": 49886257, "comment_id": 86789295, "body": "even after using a larger dataset in this case an array of 1000 integers im getting a faster single thread computing time compared to multi thread"}, {"owner": {"reputation": 5000, "user_id": 8405835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sN3eq.png?s=128&g=1", "display_name": "Abhijit Pritam Dutta", "link": "https://stackoverflow.com/users/8405835/abhijit-pritam-dutta"}, "reply_to_user": {"reputation": 49, "user_id": 7300599, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f59230043e14296594183b687c47b3a?s=128&d=identicon&r=PG&f=1", "display_name": "Maaz Azeem", "link": "https://stackoverflow.com/users/7300599/maaz-azeem"}, "edited": false, "score": 0, "creation_date": 1523996588, "post_id": 49886257, "comment_id": 86789782, "body": "That is not large. If you consider your system hardware that is very tiny actually."}], "tags": [], "owner": {"reputation": 5000, "user_id": 8405835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sN3eq.png?s=128&g=1", "display_name": "Abhijit Pritam Dutta", "link": "https://stackoverflow.com/users/8405835/abhijit-pritam-dutta"}, "is_accepted": true, "score": 2, "last_activity_date": 1523994080, "last_edit_date": 1592644375, "creation_date": 1523994080, "answer_id": 49886257, "question_id": 49886096, "link": "https://stackoverflow.com/questions/49886096/multithreading-vs-singlethreading-process-runtimes/49886257#49886257", "title": "Multithreading vs Singlethreading process runtimes", "body": "<p>Multi threading's performance can be measured with large volume of data. With very small volume of data you cannot measure the performance of multithreaded application. The reasons:-</p>\n<blockquote>\n<p>1.To create a thread O/S need to allocation of memory to each thread which take time (even though it is tiny bit.)</p>\n<p>2.When you create multi threads it needs context switching which also take time.</p>\n<p>3.Need to release memory allocated to threads which also take time.</p>\n<p>4.It depends on number of processor and total memory (RAM) in your machine</p>\n</blockquote>\n<p>So when you try with small operation with multi threads it's performance will be as same as single thread or even less. So your outcome is perfect in this case. To Measure the performance of multithread architecture use large amount of data with complex operation then only you can see the differences.</p>\n"}], "owner": {"reputation": 49, "user_id": 7300599, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f59230043e14296594183b687c47b3a?s=128&d=identicon&r=PG&f=1", "display_name": "Maaz Azeem", "link": "https://stackoverflow.com/users/7300599/maaz-azeem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "accepted_answer_id": 49886257, "answer_count": 2, "score": 0, "last_activity_date": 1523994335, "creation_date": 1523993386, "last_edit_date": 1523994335, "question_id": 49886096, "link": "https://stackoverflow.com/questions/49886096/multithreading-vs-singlethreading-process-runtimes", "title": "Multithreading vs Singlethreading process runtimes", "body": "<p>I'm currently working on a multithreading mergesort program.\nI'm comparing the different run times between multithread vs single thread.\nIve came up with an average of .022279s (multi) vs .00249s (single)</p>\n\n<p>My question is why is the single thread application faster than my multithread?</p>\n\n<p>Isn't multithread supposed to be more efficient compared to single thread?</p>\n\n<p>Multi Thread code</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n\n\n\nvoid *run(void *parameters); /* threads call this function */\nint alength, flength;\nint *array_whole;\n\nFILE *input_file;\nint *read_file(char *file_name) {\n    input_file = fopen(\"soulfoodinput.txt\", \"rt\"); // open file\n    int arraysize = flength;\n    char line[80];\n    int integer;\n    int index = 0;\n    int *input = malloc(arraysize * sizeof(int));\n\n\n    while (fgets(line, 80, input_file) != NULL) \n{\n        sscanf(line, \"%d\", &amp;integer); // read the integer value\n        input[index] = integer;\n        //printf(line);\n        ++index;\n        ++alength;\n    }\n    fclose(input_file); // close the file    \n    return input;\n}\n\n\nint read_length(char *file_name) {\n    input_file = fopen(file_name, \"rt\"); // open file\n    char line[80];\n    int file_length = 0;\n\n    while (fgets(line, 80, input_file) != NULL) {\n        file_length += 1;\n    }\n\n    return file_length;\n}\n\nvoid merge(int arr[], int left, int middle, int right) //function to sort unsorted array\n{  \n    int i, j, k;\n    //create array partition\n    int left_partition = middle - left + 1;\n    int right_partition = right - middle;\n\n    int first[left_partition], second[right_partition]; //set up temporary arrays\n\n    //move left side of array to temp array\n    for (i = 0; i &lt; left_partition; i++)\n    {\n        first[i] = arr[left + i];\n    }\n    //move right side of array to temp array\n    for (j = 0; j &lt; right_partition; j++)\n    {\n        second[j] = arr[middle + 1 + j];\n    }\n\n    i = 0;\n    j = 0;\n    k = left;\n\n    while (i &lt; left_partition &amp;&amp; j &lt; right_partition)\n    {\n        //sort the array into one array\n        if (first[i] &lt;= second[j])\n        {\n            arr[k] = first[i];\n            ++i;\n        }\n        else\n        {\n            arr[k] = second[j];\n            j++;\n        }\n        k++;\n    }\n\n    while (i &lt; left_partition)\n    {\n        arr[k] = first[i];\n        i++;\n        k++;\n    }\n\n    while (j &lt; right_partition)\n    {\n        arr[k] = second[j];\n        j++;\n        k++;\n    }\n}\n\nvoid merge_sort(int arr[], int left, int right) //splits array in half, calls self on both halves, then merges the halves\n{\n    if (left &lt; right)\n    {\n        int middle = (left + (right-1))/ 2;\n        merge_sort(arr, left, middle); //split left half\n        merge_sort(arr, middle+1, right); //split right half\n        merge(arr, left, middle, right); //merge both halves\n    }\n}\n\n\nint main(int argc, char *argv[])\n{\n    /*WILL CREATES THREAD ID 1, 2, 3 */\n    pthread_t thread_id1; // creates first thread id\n    pthread_attr_t attr_1; // creates thread attributes\n    pthread_t thread_id2; // creates second thread id\n    pthread_attr_t attr_2; // second thread attributes\n    pthread_t thread_id3; // creates third thread id\n    pthread_attr_t attr_3;// third thread attributes\n\n    /* WILL READ IN FILE WITH UNSORTED ARRAY*/\n    char *file_name = argv[1];\n    flength = read_length(file_name);\n    array_whole = read_file(file_name);\n\n  clock_t t;\n\n    int m;\n    printf(\"UNSORTED: \");\n    for (m = 0; m &lt; alength; m++) {\n        if (m == alength - 1) {\n            printf(\"%d \\n\", array_whole[m]);\n        }\n        else {\n            printf(\"%d, \", array_whole[m]);\n        }\n    }\n\n  t=clock();\n    /*WILL CREATE THREAD 1,2,3 */\n    char *thread_1 = \"first\"; // creates first thread\n    pthread_attr_init(&amp;attr_1); //finds attributes\n    pthread_create(&amp;thread_id1, &amp;attr_1, run, thread_1); // create 1st thread\n    char *thread_2 = \"second\";\n    pthread_attr_init(&amp;attr_2);\n    pthread_create(&amp;thread_id2, &amp;attr_2, run, thread_2);  // create 2nd thread\n    char *thread_3 = \"third\";\n    pthread_attr_init(&amp;attr_3);\n    pthread_create(&amp;thread_id3, &amp;attr_2, run, thread_3);  // create 3rd thread\n\n    /*WILL JOIN ALL THE THREADS TOGETHER*/\n    pthread_join(thread_id1, NULL); \n    pthread_join(thread_id2, NULL);\n    pthread_join(thread_id3, NULL);\n\n  t=clock() - t;\n  double time_taken = ((double)t)/CLOCKS_PER_SEC;\n\n\n    /* WILL PRINT ALL SORTED VALUES */\n    int i;\n    printf(\"SORTED: \");\n    for (i = 0; i &lt; alength; i++) {\n        if (i == alength - 1) {\n            printf(\"%d \\n\", array_whole[i]);\n        }\n        else {\n            printf(\"%d, \", array_whole[i]);\n        }\n    }\n  printf(\"elapsed time = %f seconds to execute \\n\", time_taken);\n\n    pthread_exit(0);\n\n    return 0;\n}\n\n\nvoid *run(void *parameters)\n{\n    int centerspot = alength / 2;\n    if (strcmp(parameters, \"first\") == 0) {\n        merge_sort(array_whole, 0, centerspot);\n    }\n\n    if (strcmp(parameters, \"second\") == 0) {\n        merge_sort(array_whole, centerspot + 1, alength - 1);\n    }\n\n    if (strcmp(parameters, \"third\") == 0) {\n        merge_sort(array_whole, 0, alength - 1);\n    }\n\n    pthread_exit(0);\n}\n</code></pre>\n\n<p>Single thread code</p>\n\n<pre><code>#include &lt;pthread.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n\n\n\nvoid *run(void *parameters); /* threads call this function */\nint alength, flength;\nint *array_whole;\n\nFILE *input_file;\nint *read_file(char *file_name) {\n    input_file = fopen(\"soulfoodinput.txt\", \"rt\"); // open file\n    int arraysize = flength;\n    char line[80];\n    int integer;\n    int index = 0;\n    int *input = malloc(arraysize * sizeof(int));\n\n\n    while (fgets(line, 80, input_file) != NULL) \n{\n        sscanf(line, \"%d\", &amp;integer); // read the integer value\n        input[index] = integer;\n        //printf(line);\n        ++index;\n        ++alength;\n    }\n    fclose(input_file); // close the file    \n    return input;\n}\n\n\nint read_length(char *file_name) {\n    input_file = fopen(file_name, \"rt\"); // open file\n    char line[80];\n    int file_length = 0;\n\n    while (fgets(line, 80, input_file) != NULL) {\n        file_length += 1;\n    }\n\n    return file_length;\n}\n\nvoid merge(int arr[], int left, int middle, int right) //function to sort unsorted array\n{  \n    int i, j, k;\n    //create array partition\n    int left_partition = middle - left + 1;\n    int right_partition = right - middle;\n\n    int first[left_partition], second[right_partition]; //set up temporary arrays\n\n    //move left side of array to temp array\n    for (i = 0; i &lt; left_partition; i++)\n    {\n        first[i] = arr[left + i];\n    }\n    //move right side of array to temp array\n    for (j = 0; j &lt; right_partition; j++)\n    {\n        second[j] = arr[middle + 1 + j];\n    }\n\n    i = 0;\n    j = 0;\n    k = left;\n\n    while (i &lt; left_partition &amp;&amp; j &lt; right_partition)\n    {\n        //sort the array into one array\n        if (first[i] &lt;= second[j])\n        {\n            arr[k] = first[i];\n            ++i;\n        }\n        else\n        {\n            arr[k] = second[j];\n            j++;\n        }\n        k++;\n    }\n\n    while (i &lt; left_partition)\n    {\n        arr[k] = first[i];\n        i++;\n        k++;\n    }\n\n    while (j &lt; right_partition)\n    {\n        arr[k] = second[j];\n        j++;\n        k++;\n    }\n}\n\nvoid merge_sort(int arr[], int left, int right) //splits array in half, calls self on both halves, then merges the halves\n{\n    if (left &lt; right)\n    {\n        int middle = (left + (right-1))/ 2;\n        merge_sort(arr, left, middle); //split left half\n        merge_sort(arr, middle+1, right); //split right half\n        merge(arr, left, middle, right); //merge both halves\n    }\n}\n\n\nint main(int argc, char *argv[])\n{\n    /*WILL CREATES THREAD ID */\n    pthread_t thread_id1; // creates first thread id\n    pthread_attr_t attr_1; // creates thread attributes\n\n    /* WILL READ IN FILE WITH UNSORTED ARRAY*/\n    char *file_name = argv[1];\n    flength = read_length(file_name);\n    array_whole = read_file(file_name);\n\n  clock_t t;\n\n    int m;\n    printf(\"UNSORTED: \");\n    for (m = 0; m &lt; alength; m++) {\n        if (m == alength - 1) {\n            printf(\"%d \\n\", array_whole[m]);\n        }\n        else {\n            printf(\"%d, \", array_whole[m]);\n        }\n    }\n\n  t=clock();\n    /*WILL CREATE THREAD 1,2,3 */\n    char *thread_1 = \"first\"; // creates first thread\n    pthread_attr_init(&amp;attr_1); //finds attributes\n    pthread_create(&amp;thread_id1, &amp;attr_1, run, thread_1); // create 1st thread\n\n    /*WILL JOIN ALL THE THREADS TOGETHER*/\n    pthread_join(thread_id1, NULL); \n\n\n  t=clock() - t;\n  double time_taken = ((double)t)/CLOCKS_PER_SEC;\n\n\n    /* WILL PRINT ALL SORTED VALUES */\n    int i;\n    printf(\"SORTED: \");\n    for (i = 0; i &lt; alength; i++) {\n        if (i == alength - 1) {\n            printf(\"%d \\n\", array_whole[i]);\n        }\n        else {\n            printf(\"%d, \", array_whole[i]);\n        }\n    }\n  printf(\"elapsed time = %f seconds to execute \\n\", time_taken);\n\n    pthread_exit(0);\n\n    return 0;\n}\n\n\nvoid *run(void *parameters)\n{\n    int centerspot = alength / 2;\n\n        merge_sort(array_whole, 0, centerspot);\n\n        merge_sort(array_whole, centerspot + 1, alength - 1);\n\n        merge_sort(array_whole, 0, alength - 1);\n\n\n    pthread_exit(0);\n}\n</code></pre>\n"}, {"tags": ["c", "getopt", "integer-division", "atoi"], "comments": [{"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1523992149, "post_id": 49885657, "comment_id": 86787522, "body": "<code>1&#47;2</code> is equals to 0, so the whole multiplication is 0. Same for <code>tran</code>. You have to use the proper types, in this case <code>float</code> or <code>double</code> and <code>1&#47;2.0</code> to get a floating point result."}, {"owner": {"reputation": 21147, "user_id": 7733418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b08876b87c096cd006f66820ffc67f27?s=128&d=identicon&r=PG", "display_name": "Yunnosch", "link": "https://stackoverflow.com/users/7733418/yunnosch"}, "edited": false, "score": 0, "creation_date": 1523992152, "post_id": 49885657, "comment_id": 86787523, "body": "Int being assigned something &lt; 1 stays 0."}], "answers": [{"tags": [], "owner": {"reputation": 158911, "user_id": 1687119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f9c3036c1979d65847da3bdc271bb5b9?s=128&d=identicon&r=PG", "display_name": "dbush", "link": "https://stackoverflow.com/users/1687119/dbush"}, "is_accepted": false, "score": 3, "last_activity_date": 1523992242, "creation_date": 1523992242, "answer_id": 49885784, "question_id": 49885657, "link": "https://stackoverflow.com/questions/49885657/c-expression-not-giving-the-proper-output/49885784#49885784", "title": "c expression not giving the proper output", "body": "<p>All of your arithmetic operations are done on integer values, so the result of each subexpression is also a integer, and you assign the result to an integer.  You're experiencing truncation of the resulting values.</p>\n\n<p>Change <code>arotate</code>, <code>tran</code>, and <code>acc</code> to <code>double</code>, change the corresponding output specifiers from <code>%d</code> to <code>%f</code>, and change the constants in your expressions to floating point constants (i.e. include a fractional component).</p>\n\n<pre><code> double arotate = -1;\n double tran = -1;\n double acc;\n\n ...\n\narotate = ((1.0/2.0) * (60.0/aflag))* 1000.0;\n  tran = ((60.0/aflag) * (1.0/cvalue)) * 1000.0;\n  acc = bflag + arotate + tran;\n\n\nprintf (\"aflag = %d, bflag = %d, cvalue = %d\\n, arotate = %f\\n, tran = %f\\n, acc = %f\\n\", \n         aflag, bflag, cvalue, arotate, tran, acc);\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 6896655, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c68fbccde96ce9b03e611f9b356e51f8?s=128&d=identicon&r=PG&f=1", "display_name": "Rawsick", "link": "https://stackoverflow.com/users/6896655/rawsick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "closed_date": 1523994145, "answer_count": 1, "score": 0, "last_activity_date": 1523993742, "creation_date": 1523991757, "last_edit_date": 1523992384, "question_id": 49885657, "link": "https://stackoverflow.com/questions/49885657/c-expression-not-giving-the-proper-output", "closed_reason": "Duplicate", "title": "c expression not giving the proper output", "body": "<pre><code>int main (int argc, char **argv)\n{\n    int aflag = -1;\n    int bflag = -1;\n    int cvalue = -1;\n    int index;\n    int c;\n    int arotate = -1;\n    int tran = -1;\n    int acc;\n\n\n    opterr = 0;\n    printf(\"top of the program\\n\");\n\n    while ((c = getopt (argc, argv, \"r:t:s:\")) != -1) {\n        printf(\"top of the loop\\n\");\n        switch (c)\n        {\n        case 'r':\n            printf(\"here under r\\n\");\n            aflag = atoi(optarg);\n            break;\n        case 't':\n            printf(\"here under t\\n\");\n            bflag = atoi(optarg);\n            break;\n        case 's':\n            printf(\"here under s\\n\");\n            cvalue = atoi(optarg);\n            break;\n        default:\n            abort ();\n        }\n    }\n    arotate = ((1/2) * (60/aflag))* 1000;\n    tran = ((60/aflag) * (1/cvalue)) * 1000;\n    acc = bflag + arotate + tran;\n\n    printf(\"aflag = %d, bflag = %d, cvalue = %d\\n, arotate = %d\\n, tran = \"\n        \"%d\\n, acc = %d\\n\",aflag, bflag, cvalue, arotate, tran, acc);\n    return 0;\n}\n</code></pre>\n\n<p>When I run everything works but arotate and tran are always = 0. I am looking to check that ./a.out -r 15000 -t 4 -s 800 answers 6.005ms. It has to be something I'm doing wrong here</p>\n\n<pre><code>arotate = ((1/2) * (60/aflag))* 1000;\ntran = ((60/aflag) * (1/cvalue)) * 1000;\nacc = bflag + arotate + tran;\n</code></pre>\n\n<p><code>arotate = 0</code> and <code>tran = 0</code> which they should be 2 and .005. but <code>acc</code> seems to be working as I get 4.</p>\n"}, {"tags": ["c", "parsing"], "comments": [{"owner": {"reputation": 15898, "user_id": 1155000, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8213d9cd920e864ce8ff1fdeefe4db5?s=128&d=identicon&r=PG", "display_name": "Daniel Kamil Kozar", "link": "https://stackoverflow.com/users/1155000/daniel-kamil-kozar"}, "edited": false, "score": 0, "creation_date": 1523991968, "post_id": 49885621, "comment_id": 86787429, "body": "<code>c = getc(file)</code> won&#39;t do what you want. Either call <code>strtol</code> (but this would require having an actual C string to pass) or change <code>case 5:</code> to <code>case &#39;5&#39;:</code> - but that won&#39;t work for two-digit numbers."}, {"owner": {"reputation": 21426, "user_id": 2495283, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ef72b32709062aa479476844515073?s=128&d=identicon&r=PG", "display_name": "Claies", "link": "https://stackoverflow.com/users/2495283/claies"}, "edited": false, "score": 0, "creation_date": 1523992088, "post_id": 49885621, "comment_id": 86787496, "body": "my guess is, you are going to have to do multiple reads for each line.  First, you read for the operation.  Second, you&#39;re going to read a space (ignored), followed by an address.  Lastly, you&#39;ll read (in a loop, probably) a bunch of spaces and other non relevant characters that will be ignored, looking for a <code>\\n</code> (newline).  Once the newline is found, then you start the process over on the next line.  Note that this entire process is <b>extremely dependent on the file remaining this same structure.</b>"}, {"owner": {"reputation": 29251, "user_id": 3923896, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4139ee1298ce4b0690a788cb97d47569?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Summit", "link": "https://stackoverflow.com/users/3923896/steve-summit"}, "edited": false, "score": 2, "creation_date": 1523993035, "post_id": 49885621, "comment_id": 86788006, "body": "One way would be to read whole lines using <code>fgets</code>, then call <code>strstr</code> to look for the <code>&#47;&#47;</code>, and if you find it, overwrite the first character with <code>&#39;\\0&#39;</code> (that is, modifying your input line buffer) to truncate the string before proceeding."}], "answers": [{"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1523997369, "post_id": 49886281, "comment_id": 86790174, "body": "<code>strtok(buf, &quot;&#47;&#47;&quot;);</code> will perform like <code>strtok(buf, &quot;&#47;&quot;);</code>"}], "tags": [], "owner": {"reputation": 3588, "user_id": 5462551, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/647be55cadd0e8edac86c55a337b264c?s=128&d=identicon&r=PG&f=1", "display_name": "noamgot", "link": "https://stackoverflow.com/users/5462551/noamgot"}, "is_accepted": false, "score": 0, "last_activity_date": 1523994181, "creation_date": 1523994181, "answer_id": 49886281, "question_id": 49885621, "link": "https://stackoverflow.com/questions/49885621/reading-a-text-file-and-ignoring-commented-lines-in-c/49886281#49886281", "title": "Reading a text file and ignoring commented lines in C", "body": "<p>By using <code>fgets</code> and <code>strtok</code> you can read line by line and split the string acording to the <code>//</code> delimiter. Here's an example (it is not fully checked, but it's the main idea):</p>\n\n<pre><code>FILE *f = fopen(\"file.txt\", \"r\");\n    if (f== NULL)\n    {\n        printf(\"opening file failed\\n\");\n        return 1;\n    }\n    char buf[256] = { 0 };\n    while (fgets(buf, 256, f))\n    {\n        char *s = strtok(buf, \"//\");\n        if (s == NULL)\n        {\n            printf(\"s == NULL\\n\");\n        }\n        else\n        {\n            printf(\"%s\\n\", s);\n        }\n        memset(buf, 0, 256);\n    }\n    fclose(f);\n</code></pre>\n\n<p><strong>EDIT:</strong> I just realized that this is not exactly what you were looking for. However, you can still use it in order to first ignore the comment, and then break the given string into operation and address, or whatever that is...</p>\n"}, {"tags": [], "owner": {"reputation": 30540, "user_id": 719263, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7feab598abfc27783641fe2b796a0155?s=128&d=identicon&r=PG", "display_name": "Jean-Baptiste Yun&#232;s", "link": "https://stackoverflow.com/users/719263/jean-baptiste-yun%c3%a8s"}, "is_accepted": false, "score": 3, "last_activity_date": 1523995887, "creation_date": 1523995887, "answer_id": 49886694, "question_id": 49885621, "link": "https://stackoverflow.com/questions/49885621/reading-a-text-file-and-ignoring-commented-lines-in-c/49886694#49886694", "title": "Reading a text file and ignoring commented lines in C", "body": "<p>Call fgets to get a full line:</p>\n\n<pre><code>fgets(buffer, 100, file);\n</code></pre>\n\n<p>and then extract the two numbers from the line:</p>\n\n<pre><code>sscanf(buffer, \"%d%d\", &amp;instruction, &amp;address);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "is_accepted": true, "score": 1, "last_activity_date": 1523997750, "creation_date": 1523997750, "answer_id": 49887175, "question_id": 49885621, "link": "https://stackoverflow.com/questions/49885621/reading-a-text-file-and-ignoring-commented-lines-in-c/49887175#49887175", "title": "Reading a text file and ignoring commented lines in C", "body": "<blockquote>\n  <p>how to correctly ignore comments in a text file that I'm reading in<br>\n  How can I ignore the // on each line and skip to the next line in the file?</p>\n</blockquote>\n\n<p>Read the <em>line</em> using <code>fgets()</code></p>\n\n<pre><code>char buf[80];\nif (fgets(buf, sizeof buf, file)) {\n</code></pre>\n\n<p>Look for the <code>//</code> with <code>strstr()</code> <a href=\"https://stackoverflow.com/questions/49885621/reading-a-text-file-and-ignoring-commented-lines-in-c#comment86788006_49885621\">@Steve Summit</a> and lop off the string at that point.</p>\n\n<pre><code>  char *slash_slash = strstr(buf, \"//\");\n  if (slash_slash) {\n    *slash_slash = '\\0';\n  }\n</code></pre>\n\n<p>Continue processing the line as desired.</p>\n\n<pre><code>  ...\n}\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 5844807, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204419689687361/picture?type=large", "display_name": "Kris Valas", "link": "https://stackoverflow.com/users/5844807/kris-valas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 815, "favorite_count": 0, "accepted_answer_id": 49887175, "answer_count": 3, "score": 2, "last_activity_date": 1524019606, "creation_date": 1523991595, "last_edit_date": 1524019606, "question_id": 49885621, "link": "https://stackoverflow.com/questions/49885621/reading-a-text-file-and-ignoring-commented-lines-in-c", "title": "Reading a text file and ignoring commented lines in C", "body": "<p>I'm currently working on making a tiny computer in C for a programming assignment and I'm stuck on one part. </p>\n\n<p>I'm stuck on how to correctly ignore comments in a text file that I'm reading in. (Example of file input below).</p>\n\n<pre><code>Input File\n5 5     //IN 5\n6 7     //OUT 7\n3 0     //STORE 0\n5 5     //IN 5\n6 7     //OUT 7\n3 1     //STORE 1\n1 0     //LOAD 0\n4 1     //SUB 1\n3 0     //STORE 0\n6 7     //OUT 7\n1 1     //LOAD 1\n6 7     //OUT 7\n7 0     //END\n</code></pre>\n\n<p>The first input on each new line is an operation, the 2nd input being an address. I am planning to have a switch statement for each op and then calling the appropriate function.  This is my current layout for reading in the file: </p>\n\n<pre><code>//file handling\nint c;\nFILE * file;\nfile = fopen(name, \"r\");\nif (file){\n    printf(\"Run.\\n\");\n    while ((c = getc(file)) != EOF){\n        op = c;\n        switch (op){\n            case 5:\n                print(\"Inside case 5\\n\");\n        }\n    }\n    fclose(file);\n}\n</code></pre>\n\n<p>How can I ignore the // on each line and skip to the next line in the file?</p>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 55871, "user_id": 10077, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/be4e820c7af6f3b79cf055d984cda7ff?s=128&d=identicon&r=PG", "display_name": "Fred Larson", "link": "https://stackoverflow.com/users/10077/fred-larson"}, "edited": false, "score": 0, "creation_date": 1523991656, "post_id": 49885595, "comment_id": 86787269, "body": "What is your question?"}, {"owner": {"reputation": 1178, "user_id": 1406668, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/T4b1f.jpg?s=128&g=1", "display_name": "Dave M.", "link": "https://stackoverflow.com/users/1406668/dave-m"}, "edited": false, "score": 0, "creation_date": 1523991674, "post_id": 49885595, "comment_id": 86787274, "body": "Well, for one thing, you&#39;re returning the number itself (rather than 1) when the number is less than 10.  That&#39;s simply wrong, according to your problem statement."}, {"owner": {"reputation": 12179, "user_id": 1480131, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WZPm4.jpg?s=128&g=1", "display_name": "Pablo", "link": "https://stackoverflow.com/users/1480131/pablo"}, "edited": false, "score": 0, "creation_date": 1523991686, "post_id": 49885595, "comment_id": 86787286, "body": "By your own definition, the persistence of number &lt; 10 is 1. So <code>if(x&lt;10) return 1; else { ... }</code>"}], "answers": [{"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 1, "last_activity_date": 1523992851, "creation_date": 1523992851, "answer_id": 49885945, "question_id": 49885595, "link": "https://stackoverflow.com/questions/49885595/recursive-persistence-of-a-number/49885945#49885945", "title": "Recursive Persistence of a number", "body": "<p>The function <code>persistence</code> itself should return the value of the multiplicative persistence.</p>\n\n<p>It can be defined the following way as it is shown in the demonstrative program.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nsize_t persistence( unsigned int x )\n{\n    const unsigned int Base = 10;\n\n    if ( ! ( x &lt; Base ) )\n    {\n        unsigned int n = 1;\n        do { n *= x % Base; } while ( x /= Base );\n        return 1 + persistence( n );\n    }\n    else\n    {\n        return 0;\n    }       \n}\n\nint main(void) \n{\n    unsigned int x = 39;\n\n    printf( \"persistence( %u ) = %zu\\n\", x, persistence( x ) );\n\n    return 0;\n}\n</code></pre>\n\n<p>The program output is</p>\n\n<pre><code>persistence( 39 ) = 3\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9536768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dbed57fc285ff840e59b279e6329ad2?s=128&d=identicon&r=PG&f=1", "display_name": "briduss", "link": "https://stackoverflow.com/users/9536768/briduss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 464, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1523992851, "creation_date": 1523991502, "last_edit_date": 1523991682, "question_id": 49885595, "link": "https://stackoverflow.com/questions/49885595/recursive-persistence-of-a-number", "title": "Recursive Persistence of a number", "body": "<p>I am trying to find the persistence of a number. When you multiply the digits of a number together, eventually you will arrive at a single digit number. Persistence is the number of cycles that takes. I am trying to find that using a recursive Function. Here is my code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint persistence(int x);\n\nint main(int argc, char *argv[])\n{\n  int x, per = 0, t;\n  char c;\n  while((c = getchar())!= EOF)\n    {\n      printf(\"Enter a number:\\n\");\n      scanf(\"%d\", &amp;x);\n      while(x&gt;10)\n        {\n           t = persistence(x);\n           printf(\"\\n%d\", persistence(t));\n           per++;\n         }\n      printf(\"\\n%d\\n\\n\", per);\n\n    }\n  return 0;\n}\n\nint persistence(int x)\n{\n  if(x&lt;10)\n    {\n      return x;\n    }\n  else\n    {\n\n      return (x%10 * persistence(x/10));\n    }\n}\n</code></pre>\n"}, {"tags": ["c"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1523988751, "post_id": 49884686, "comment_id": 86785705, "body": "Assigning <code>file</code> inside the function is not going to be reflected outside of it. Not speaking of this program not doing anything useful at all..."}, {"owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "edited": false, "score": 0, "creation_date": 1523988834, "post_id": 49884686, "comment_id": 86785748, "body": "you mentioned only one error, but there are lot of other error exists ? read <code>man 2 open</code> &amp; check how you use <code>open()</code>."}, {"owner": {"reputation": 757, "user_id": 824501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gQCRZ.png?s=128&g=1", "display_name": "Stan", "link": "https://stackoverflow.com/users/824501/stan"}, "edited": false, "score": 0, "creation_date": 1523988978, "post_id": 49884686, "comment_id": 86785810, "body": "In C, when calling a function, you only copy and pass the values of arguments. So, when you want to modify <code>r</code>, you have to pass <code>&amp;r</code>. So nothing is different for a pointer variable <code>x</code> ... you can imagine, still you need to pass an <code>&amp;x</code> if you want to modify it."}], "answers": [{"tags": [], "owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "is_accepted": false, "score": 1, "last_activity_date": 1523994321, "last_edit_date": 1523994321, "creation_date": 1523989042, "answer_id": 49884915, "question_id": 49884686, "link": "https://stackoverflow.com/questions/49884686/how-to-assign-a-pointer-value-to-a-const-char-after-it-is-declared-and-passed/49884915#49884915", "title": "How to assign a pointer value to a const char** after it is declared and passed as an argument to a function", "body": "<p>assuming that the rest of the functions are correct and <code>readfiles-&gt;readf-&gt;d_name</code> points to the C string</p>\n\n<pre><code>int read_files(readfiles *r, char** file){\n   if(readfiles-&gt;readf = readdir(readfiles-&gt;path)) != NULL){\n     strcpy(*file, readfiles-&gt;readf-&gt;d_name);  // &lt;-- copy \n   }\n return 0;\n}\n}\n\nint main(){\n char fbuff[MAXFILENAME];\n char *filename = fbuff;\n readfiles r;\n read_files(&amp;r, &amp;filename);\n getfile(&amp;r, *filename);\n return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 1461, "user_id": 5641188, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9bab5cda330ff2a8e1f909f3c2ac7700?s=128&d=identicon&r=PG&f=1", "display_name": "pavikirthi", "link": "https://stackoverflow.com/users/5641188/pavikirthi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523994321, "creation_date": 1523988165, "last_edit_date": 1523988970, "question_id": 49884686, "link": "https://stackoverflow.com/questions/49884686/how-to-assign-a-pointer-value-to-a-const-char-after-it-is-declared-and-passed", "title": "How to assign a pointer value to a const char** after it is declared and passed as an argument to a function", "body": "<p>Here is the program where I have to use <code>readdir()</code> to get file from the directory and after that I need to return back the filename in the <code>read_files()</code> function through <code>const char**</code> and later I need to use the filename to read it using <code>getfile()</code>- here I need to pass it as <code>const char*</code> in the argument, don't know how to do it?</p>\n\n<p>I am getting this error <code>warning: assignment from incompatible pointer type [enabled by default]</code></p>\n\n<pre><code>typedef struct{\n  DIR* path;\n  struct dirent* readf;\n} readfiles;\n\nint read_files(readfiles *r, const char** file){\n   if(readfiles-&gt;readf = readdir(readfiles-&gt;path)) != NULL){\n     file = &amp;(readfiles-&gt;readf-&gt;d_name);\n   }\n return 0;\n}\n\nint getfile(readfiles *r, const char* filename){\n  int fd = open(filename, O_RDONLY);\n  close(fd);\n  return 0;\n}\n\nint main(){\n const char** filename;\n readfiles r;\n read_files(&amp;r, filename);\n getfile(&amp;r, *filename);\n return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "visual-studio"], "comments": [{"owner": {"reputation": 2653, "user_id": 3515931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c0edddc6a265a0a22058bb2343328d?s=128&d=identicon&r=PG&f=1", "display_name": "JohnH", "link": "https://stackoverflow.com/users/3515931/johnh"}, "edited": false, "score": 0, "creation_date": 1523995050, "post_id": 49884562, "comment_id": 86789014, "body": "Link flags in that Makefile include libcrypto and libssl, so you&#39;d need a windows port of openssl (libeay32.dll and .lib and libssl32.dll and .lib plus header files) first to be able to try to compile this with Visual Studio.  After that, load all the .c into a VC project, set project properties on the linker option to point to the libeay32 and libssl32 .lib files, make sure the .dlls are in your path, and then build."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7340499"}, "reply_to_user": {"reputation": 2653, "user_id": 3515931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c0edddc6a265a0a22058bb2343328d?s=128&d=identicon&r=PG&f=1", "display_name": "JohnH", "link": "https://stackoverflow.com/users/3515931/johnh"}, "edited": false, "score": 0, "creation_date": 1523998797, "post_id": 49884562, "comment_id": 86790792, "body": "@JohnH I agree..."}, {"owner": {"reputation": 31, "user_id": 9541081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d974a6c4914659dfecaac2fd21d8ff35?s=128&d=identicon&r=PG&f=1", "display_name": "ChanBan", "link": "https://stackoverflow.com/users/9541081/chanban"}, "edited": false, "score": 0, "creation_date": 1524010638, "post_id": 49884562, "comment_id": 86794597, "body": "I see. Thank you all"}], "owner": {"reputation": 31, "user_id": 9541081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d974a6c4914659dfecaac2fd21d8ff35?s=128&d=identicon&r=PG&f=1", "display_name": "ChanBan", "link": "https://stackoverflow.com/users/9541081/chanban"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 352, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523987655, "creation_date": 1523987655, "question_id": 49884562, "link": "https://stackoverflow.com/questions/49884562/how-to-execute-makefiles-on-visual-studio", "title": "How to execute MakeFiles on Visual Studio", "body": "<p>I'm almost new to this platform. I couldn't find any related question to what I'm asking over here. In case its there, please provide me the link to the answer. \nSo, what I'm trying to do is on this website I could find many code submissions (<a href=\"https://csrc.nist.gov/Projects/Post-Quantum-Cryptography/Round-1-Submissions\" rel=\"nofollow noreferrer\">https://csrc.nist.gov/Projects/Post-Quantum-Cryptography/Round-1-Submissions</a>)\nI wanted to learn a little more about them, by executing them on my machine. But I don't have Ubuntu, is there any way to execute them on Visual Studio 2015? (For example lets consider the first submission BIG QUAKE, after downloading and extracting, what should be my steps to execute it on Visual Studio?) If someone knows, please help me. \nThanks for your patience</p>\n"}, {"tags": ["c", "linux", "netfilter"], "comments": [{"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1523985382, "post_id": 49883855, "comment_id": 86783874, "body": "Is binary such a good way to present an IP address? The usual format is a sequence of four small decimal integers."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 2, "creation_date": 1523985470, "post_id": 49883855, "comment_id": 86783910, "body": "And of course you can&#39;t fit a 32-bit number into 32 bits if you want to use only 0 and 1 in the printed representation. If you do want binary, handle it as a string instead."}, {"owner": {"reputation": 513, "user_id": 8293226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ccfWx.png?s=128&g=1", "display_name": "mustachioed", "link": "https://stackoverflow.com/users/8293226/mustachioed"}, "edited": false, "score": 0, "creation_date": 1523985483, "post_id": 49883855, "comment_id": 86783917, "body": "The reason you are getting a negative value is because of <a href=\"https://en.m.wikipedia.org/wiki/Two&#39;s_complement\" rel=\"nofollow noreferrer\">two&#39;s complement</a>. If you want to print it out as binary to the user you&#39;ll want to create a function for that."}, {"owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1523985667, "post_id": 49883855, "comment_id": 86783996, "body": "Thanks for all the responses! Yes, @ArndtJonasson, it needs to be in binary as I&#39;m &amp; it with a binary mask to test if it&#39;s the subnet range I want to drop. I will look into the string method though and see if it better fits the needs and solution. I&#39;ll also look into this two&#39;s complement to see if I can solve the negative value"}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 1, "creation_date": 1523985754, "post_id": 49883855, "comment_id": 86784038, "body": "@Crumblez If you know the exact size you can <a href=\"https://ideone.com/cXY5Zm\" rel=\"nofollow noreferrer\">do something like this</a>"}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1523985762, "post_id": 49883855, "comment_id": 86784048, "body": "just change your <code>int</code> to <code>unsigned int</code> or better <code>uint32_t</code>. BTW the convering function is an absurd. What is the decimal number? Is it a BCD number?"}, {"owner": {"reputation": 20968, "user_id": 2564301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a6b5734cdcb5ce19598ccf9a7d8cc1ff?s=128&d=identicon&r=PG&f=1", "display_name": "Jongware", "link": "https://stackoverflow.com/users/2564301/jongware"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1523986618, "post_id": 49883855, "comment_id": 86784553, "body": "@PeterJ_01: that won&#39;t be enough. An unsigned int can only represent, what, 10 decimals? Then you are still short of another 22."}, {"owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1523986722, "post_id": 49883855, "comment_id": 86784606, "body": "@PeterJ_01 I got this converting function from another answer on Stackoverflow. How would you change this to still use ints and spit out the proper 32bit binary form?"}, {"owner": {"reputation": 20968, "user_id": 2564301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a6b5734cdcb5ce19598ccf9a7d8cc1ff?s=128&d=identicon&r=PG&f=1", "display_name": "Jongware", "link": "https://stackoverflow.com/users/2564301/jongware"}, "edited": false, "score": 1, "creation_date": 1523987668, "post_id": 49883855, "comment_id": 86785139, "body": "Is it possible you are misunderstanding binary <i>numbers</i> and their <i>representations</i>? <code>21211328</code> is the decimal representation of a binary number (which is because that is how it is stored in memory). Other possible representations are hexadecimal, trinary, sexagesemal, and \u2013 indeed \u2013 binary. But the <i>number</i> does not change."}, {"owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "edited": false, "score": 0, "creation_date": 1523987954, "post_id": 49883855, "comment_id": 86785313, "body": "@usr2564301I think you are misunderstanding my problem. I need this number in binary. The fact that this is its decimal representation does not matter for the sake of this problem outside of converting the representation back to binary."}, {"owner": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 1, "creation_date": 1523988412, "post_id": 49883855, "comment_id": 86785555, "body": "@Crumblez I think you do not understand the numbers in computers. Your function is the complete absurd. it tries to convert (binary)10101010101010101010101010101010 to (decimal)10101010101010101010101010101010 which is (binary)11111110 11111100 00111111 01110010 00001101 01010001 01001110 11100101 01100101 00001100 11101101 11100110 0010010 which is uint104_t :)"}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1523989716, "post_id": 49883855, "comment_id": 86786205, "body": "This is meant to run in the kernel? We&#39;d better get this right. What&#39;s the type of <code>iph-&gt;saddr</code>?"}, {"owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1523989925, "post_id": 49883855, "comment_id": 86786302, "body": "@ArndtJonasson Yes, this is running in the kernel. From what I can tell, iph-&gt;saddr returns an integer value with the decimal notation removed."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1523990657, "post_id": 49883855, "comment_id": 86786712, "body": "The answer should be something like <code>int</code> or <code>long</code> or <code>char *</code>. &quot;Integer value with the decimal notation removed&quot; is not a phrase that has meaning in the C language."}, {"owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "edited": false, "score": 0, "creation_date": 1523991201, "post_id": 49883855, "comment_id": 86787015, "body": "I&#39;ll be more specific. It&#39;s an int. This is an int because the decimal notation normally found in IP addresses has been removed. So it&#39;s not a char array or something else that would still have the decimals found."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1523994418, "post_id": 49883855, "comment_id": 86788720, "body": "Dotted notation is not decimals. OK, so it&#39;s an int. Then you just do <code>if ((iph-&gt;saddr &amp; mask_array) == masked_sub)</code>."}, {"owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1523995492, "post_id": 49883855, "comment_id": 86789240, "body": "@ArndtJonasson That doesn&#39;t work. I&#39;m &amp; with a binary mask array then comparing the output with the binary subnet I want to block. I tested it to double check"}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1523996235, "post_id": 49883855, "comment_id": 86789605, "body": "There is some conversion you need to make from network byte order to native. Your example 21211328 = 0x143a8c0 = 1.67.168.192, which most likely corresponds to the IP address 192.168.67.1. I think it&#39;s best if you take some existing device driver or module and study it thoroughly."}, {"owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "reply_to_user": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524009605, "post_id": 49883855, "comment_id": 86794380, "body": "@ArndtJonasson where are you getting the conversion of 143a8c0 to 192.168.67.1?"}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524044723, "post_id": 49883855, "comment_id": 86808126, "body": "One byte at a time. 0x1 = 1, 0x43 = 67 and so on."}, {"owner": {"reputation": 811, "user_id": 9493582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfI3b.jpg?s=128&g=1", "display_name": "Arndt Jonasson", "link": "https://stackoverflow.com/users/9493582/arndt-jonasson"}, "edited": false, "score": 0, "creation_date": 1524045157, "post_id": 49883855, "comment_id": 86808466, "body": "See the very good answer by Luis Colorado further down."}, {"owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "edited": false, "score": 0, "creation_date": 1524056311, "post_id": 49883855, "comment_id": 86816073, "body": "Thanks for your patience with this! All helpful information"}], "answers": [{"comments": [{"owner": {"reputation": 20968, "user_id": 2564301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a6b5734cdcb5ce19598ccf9a7d8cc1ff?s=128&d=identicon&r=PG&f=1", "display_name": "Jongware", "link": "https://stackoverflow.com/users/2564301/jongware"}, "edited": false, "score": 0, "creation_date": 1523987492, "post_id": 49884197, "comment_id": 86785053, "body": "?? The &quot; ended up in that URL \u2013 weird. <a href=\"https://stackoverflow.com/a/7911777\">stackoverflow.com/a/7911777</a>"}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1523987554, "post_id": 49884197, "comment_id": 86785087, "body": "@lonejack What happens if you call this Function more than Once?"}, {"owner": {"reputation": 17, "user_id": 3141310, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G5q2J.png?s=128&g=1", "display_name": "lonejack", "link": "https://stackoverflow.com/users/3141310/lonejack"}, "reply_to_user": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1523988267, "post_id": 49884197, "comment_id": 86785480, "body": "@Michi the function store the value on a static register. If you call this two (or more) times the value will be overwritten. it is possible to modify it passing a destination: char * getBin( char * dest, uint32_t val){}"}, {"owner": {"reputation": 17, "user_id": 3141310, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G5q2J.png?s=128&g=1", "display_name": "lonejack", "link": "https://stackoverflow.com/users/3141310/lonejack"}, "reply_to_user": {"reputation": 20968, "user_id": 2564301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a6b5734cdcb5ce19598ccf9a7d8cc1ff?s=128&d=identicon&r=PG&f=1", "display_name": "Jongware", "link": "https://stackoverflow.com/users/2564301/jongware"}, "edited": false, "score": 0, "creation_date": 1523988313, "post_id": 49884197, "comment_id": 86785504, "body": "@usr2564301 I didn&#39;t copy"}, {"owner": {"reputation": 17, "user_id": 3141310, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G5q2J.png?s=128&g=1", "display_name": "lonejack", "link": "https://stackoverflow.com/users/3141310/lonejack"}, "reply_to_user": {"reputation": 33488, "user_id": 6110094, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wozpD.png?s=128&g=1", "display_name": "0___________", "link": "https://stackoverflow.com/users/6110094/0"}, "edited": false, "score": 0, "creation_date": 1523989201, "post_id": 49884197, "comment_id": 86785928, "body": "@PeterJ_01 I checked it, two examples:  ip:80e2d301, bin:10000000111000101101001100000001B,  ip:00000006, bin:00000000000000000000000000000110B"}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1523990053, "post_id": 49884197, "comment_id": 86786369, "body": "@lonejack That is good. Now that you know, What&#39;s the story here (what is the benefit) with <code>static</code> ? (Hope is not to help return buf). Why not <a href=\"https://pastebin.com/raw/WK5figLc\" rel=\"nofollow noreferrer\">Something likeThis</a> ?"}, {"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 2, "creation_date": 1523990727, "post_id": 49884197, "comment_id": 86786761, "body": "<code>%08x</code> is not certainly the matching specifier for <code>uint32_t</code>.  Research <code>&lt;inttypes.h&gt;</code> and <code>PRIx32</code>"}, {"owner": {"reputation": 17, "user_id": 3141310, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G5q2J.png?s=128&g=1", "display_name": "lonejack", "link": "https://stackoverflow.com/users/3141310/lonejack"}, "reply_to_user": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1523990873, "post_id": 49884197, "comment_id": 86786847, "body": "@Michi static means that the buffer will remain available also when we exit from function. If you remove &quot;static&quot; for sure you&#39;ll obtain an error: this because the buffer becomes local and the &quot;return buf&quot; will return the pointer to a variable that no longer exist."}, {"owner": {"reputation": 4739, "user_id": 4745612, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1b8f0eb3ff209075ac07aabc64d2bde4?s=128&d=identicon&r=PG&f=1", "display_name": "Michi", "link": "https://stackoverflow.com/users/4745612/michi"}, "edited": false, "score": 0, "creation_date": 1524005204, "post_id": 49884197, "comment_id": 86793233, "body": "@loneejack You did not understood my Point. But thank you for your Explanation:)."}], "tags": [], "owner": {"reputation": 17, "user_id": 3141310, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G5q2J.png?s=128&g=1", "display_name": "lonejack", "link": "https://stackoverflow.com/users/3141310/lonejack"}, "is_accepted": false, "score": 0, "last_activity_date": 1523993269, "last_edit_date": 1523993269, "creation_date": 1523986386, "answer_id": 49884197, "question_id": 49883855, "link": "https://stackoverflow.com/questions/49883855/c-convert-large-integer-to-binary/49884197#49884197", "title": "C Convert Large Integer To Binary", "body": "<p>Try this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nchar *getBin( unsigned long val) {\n    static char buf[33];\n    int i;\n\n    buf[32]='\\0';\n    for(i=31; i&gt;=0; i--){\n        buf[i] = val &amp; 1?'1':'0';\n        val/=2;\n    }\n    return buf;\n}\n\nint main()\n{\n    unsigned long ip=0x80e2d301;    \n    printf( \" ip:%08lx, bin:%sB\\n\", (unsigned long)ip, getBin(ip) );\n    return 0;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "edited": false, "score": 0, "creation_date": 1524056421, "post_id": 49894276, "comment_id": 86816160, "body": "Thank you for the very in-depth answer! This helped a lot in my understanding of these principals, appreciate it a lot."}], "tags": [], "owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "is_accepted": true, "score": 2, "last_activity_date": 1524038439, "last_edit_date": 1592644375, "creation_date": 1524038439, "answer_id": 49894276, "question_id": 49883855, "link": "https://stackoverflow.com/questions/49883855/c-convert-large-integer-to-binary/49894276#49894276", "title": "C Convert Large Integer To Binary", "body": "<p>First, ip addresses are normally represented (for human consumption) as quartets of individual bytes (four numbers separated by dots in network byte order) and not as binary sequences.</p>\n<p>The address you post (21211328) represents the address <code>1.67.168.192</code> (which I guess is a wrong representation ---you need to consider that all ip addresses are in network byte order, most signifiant byte first--- of address <code>192.168.67.1</code>)</p>\n<p>to successfully decode an ip address, you have first to consider if you machine will treat it in the correct endianness or you will have to switch bytes to be able to interpret it as a number.  The correct integer (in decimal) for the address <code>192.168.67.1</code> would be <code>3,232,252,673</code>.  This number cannot be represented as a <code>signed int</code>, because it has the most signifiant bit on, so it would be represented as a negative number.</p>\n<p>To decode an IP address, you first have to convert the number you get from the socket interface to host byte order (endianness) by use of the <code>ntohl(3)</code> function.  Once you have the address in host byte order, then you have to convert the number to base 256.  This is quite easy, and you can do it with the following snippet of code:</p>\n<pre><code>unsigned long ip_address = ntohl(server_address.sin_addr.s_addr);\nint i;\n\nfor (i = 24; i &gt;= 0; i -= 8) {\n    if (i &lt; 24) printf(&quot;.&quot;); /* print the dot between the numbers */\n    printf(&quot;%d&quot;,\n        (ip_address &gt;&gt; i) &amp; 0xff);\n}\n</code></pre>\n<p>which I'll explain below:</p>\n<p>The expression <code>(ip_address &gt;&gt; i) &amp; 0xff</code> means to right shift the bits 24 to 31, by <code>i</code> places (or <code>24</code> places, <code>16</code> places, <code>8</code> places and <code>0</code> places) to the right.  So first we will put the 8 most signifiant bits in the place 0 to 7 (<code>24..31 =&gt; 0..7</code>), next we will do that for the bits next to them (<code>16..23 =&gt; 0..7</code>), and so on until the least signifiant bits, which are not shifted at all (<code>0..7 =&gt; 0..7</code>).  Once we have the bits we are interested in positions <code>0..7</code>, we mask them with <code>0xff</code> (which is a value with <code>1</code>s in bit positions <code>0..7</code> and <code>0</code>s elsewhere) so the and bit operator <code>&amp;</code> will leave only the bits we have moved to the fixed positions <code>0..7</code> and will mask out all the others.  So we got a number between 0 and 255 finally, which is what we are printing.</p>\n<p>In the case you indeed want to represent them in binary form, you can do it by slightly modifying the above code, just considering that instead of having eight bit numbers as digits you have one bit numbers as digits:</p>\n<pre><code>unsigned long ip_address = ntohl(server_address.sin_addr.s_addr);\n\nfor (i = 31; i &gt;= 0; i--) {\n    /* In this case, we don't print the dot between the numbers */\n    printf(&quot;%d&quot;,\n        (ip_address &gt;&gt; i) &amp; 0x1);\n}\n</code></pre>\n<p>The mask this time is <code>0x01</code> which only masks the least signifiant bit of the number.</p>\n<p>Finally, I wrote a complete program to illustrate both ways of decoding, showing in addition the use of the <code>ntohl(3)</code> function:</p>\n<h1>ipaddr.c</h1>\n<pre><code>/* 00001 */ #include &lt;arpa/inet.h&gt;\n/* 00002 */ #include &lt;stdio.h&gt;\n\n/* 00003 */ #ifndef DOTTED_DECIMAL\n/* 00004 */ #define DOTTED_DECIMAL  1\n/* 00005 */ #endif\n\n/* 00006 */ #if DOTTED_DECIMAL\n/* 00007 */ #   define NBITS    8\n/* 00008 */ #   define SEP      &quot;.&quot;\n/* 00009 */ #else /* BINARY */\n/* 00010 */ #   define NBITS 1\n/* 00011 */ #   define SEP      &quot;&quot;\n/* 00012 */ #endif\n\n/* 00013 */ #define MASK    ((1 &lt;&lt; NBITS) - 1)   /* 100..00 - 1 = 011..11, with NBITS `1` bits */\n\n/* 00014 */ char *ip_formatted(long ip, char *sep, char *buff, size_t buffsz);\n\n/* 00015 */ int main()\n/* 00016 */ {\n/* 00017 */     char line[1024];\n/* 00018 */     unsigned long ip_netfmt = 21211328; /* this was the ip you posted (in network byte order) */\n/* 00019 */     unsigned long ip_hostfmt = ntohl(ip_netfmt); /* this is the ip in host byte order */\n/* 00020 */     printf(&quot;%lu =&gt; [%s]\\n&quot;, ip_netfmt, ip_formatted(ip_netfmt, SEP, line, sizeof line));\n/* 00021 */     printf(&quot;%lu =&gt; [%s]\\n&quot;, ip_hostfmt, ip_formatted(ip_hostfmt, SEP, line, sizeof line));\n/* 00022 */ }\n\n/* 00023 */ char *ip_formatted(long ip, char *sep, char *buff, size_t buffsz)\n/* 00024 */ {\n/* 00025 */     size_t n;\n/* 00026 */     char *s = buff;\n/* 00027 */     int i;\n/* 00028 */     for (i = 32 - NBITS; i &gt;= 0; i -= NBITS) {\n/* 00029 */         int digit = (ip &gt;&gt; i) &amp; MASK;\n/* 00030 */         n = snprintf(s, buffsz,\n/* 00031 */             &quot;%s%d&quot;,\n/* 00032 */             i == 32 - NBITS ? &quot;&quot; : sep,\n/* 00033 */             digit);\n/* 00034 */         s += n; buffsz -= n;\n/* 00035 */     }\n/* 00036 */     return buff;\n/* 00037 */ }\n</code></pre>\n<p>compile this code with the following commands:</p>\n<pre><code>$ cc -o ipaddr -DDOTTED_DECIMAL=1 ipaddr.c\n</code></pre>\n<p>to see output in dotted decimal, and</p>\n<pre><code>$ cc -o ipaddr -DDOTTED_DECIMAL=0 ipaddr.c\n</code></pre>\n<p>to see output in binary digits.</p>\n<p>(I included line numbers, so references to the code can be used, and commented, so you can directly compile the code by cut and paste it)</p>\n"}], "owner": {"reputation": 77, "user_id": 9329272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638a025af9206ac7d1e9b02099ef69ee?s=128&d=identicon&r=PG&f=1", "display_name": "Crumblez", "link": "https://stackoverflow.com/users/9329272/crumblez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 49894276, "answer_count": 2, "score": 0, "last_activity_date": 1524038439, "creation_date": 1523985106, "question_id": 49883855, "link": "https://stackoverflow.com/questions/49883855/c-convert-large-integer-to-binary", "title": "C Convert Large Integer To Binary", "body": "<p>I have IP addresses coming into a box in the form of, for example, 21211328.</p>\n\n<p>I want to take this integer and convert it to its binary form.</p>\n\n<p>The problem I'm getting right now is that my function spits out, based off of the example, -62674752.</p>\n\n<p>This is obviously wrong, as it can't be negative and this isn't in binary. </p>\n\n<p>The function I am using looks like this:</p>\n\n<pre><code>int toBinary(int decimalNo){\n    if (decimalNo == 0) return 0;\n    if (decimalNo == 1) return 1;                       /* optional */\n    return (decimalNo % 2) + 10 * toBinary(decimalNo / 2);\n}\n</code></pre>\n\n<p>I am using it as follows:</p>\n\n<pre><code>int num_converted = toBinary(iph-&gt;saddr); // convert it to binary\nprintk(KERN_INFO \"BSADDR: %d\", num_converted); // print the binary conversion to kernel for debugging\nif ((num_converted &amp; mask_array) == masked_sub){\n        return NF_DROP;\n}\n</code></pre>\n\n<p>And this is returning the incorrect output in my kernel logs as seen above.</p>\n\n<p>iph->saddr returns the 21211328, and int num_converted = toBinary(iph->saddr); returns -62674752.</p>\n"}, {"tags": ["c", "gcc", "clang", "gcc-extensions"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1523986059, "post_id": 49883849, "comment_id": 86784224, "body": "Sorry, I think I miss understood your question. Can you give the use case code, your description is not clear for me."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1523986206, "post_id": 49883849, "comment_id": 86784305, "body": "Just include a statement like <code>P[0];</code> and it will fail compilation for not a pointer (but might trigger UB is <code>P</code> is not pointing anywhere)."}, {"owner": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1523986243, "post_id": 49883849, "comment_id": 86784331, "body": "@EugeneSh. It seems that compilation should fail if <code>P</code> is not a single indirection pointer."}, {"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "reply_to_user": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1523986274, "post_id": 49883849, "comment_id": 86784352, "body": "@VTT Oh. Now that&#39;s complicated."}, {"owner": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1523986415, "post_id": 49883849, "comment_id": 86784430, "body": "I think it is only possible when passing target type as macro parameter. Then it can be checked with <code>__builtin_types_compatible_p(typeof(P), TARGET *)</code>"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 1, "creation_date": 1523986936, "post_id": 49883849, "comment_id": 86784711, "body": "@VTT Exactly. <code>ISPTR(*(P))</code> should statically evaluate to false iff <code>*(P)</code> is a nonpointer type. I don&#39;t think it&#39;s a duplicate with the suggestion cuz differentiating ptr and arrays is a different matter (not to mention if C++ is allowed too)."}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 32078, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1523987213, "post_id": 49883849, "comment_id": 86784894, "body": "@VTT It should be a type-generic macro. I can&#39;t think of a solution either, hence the question."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1523988773, "post_id": 49883849, "comment_id": 86785720, "body": "I think we got a xy problem, I don&#39;t see why in the word you need that, please again give real use case. The code inside your macro should not compile or at least produce warning itself with a double pointer. And why use macro ??? Don&#39;t you like function ?"}, {"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "edited": false, "score": 0, "creation_date": 1523990097, "post_id": 49883849, "comment_id": 86786393, "body": "<code>Is there a better way...</code> Indeed there is a better way. It is called &quot;test&quot;. You implement a separate program that run your code and check whether or not the output is legit according to your specification. The method is cross platform and tool independent, compatible with every version of every programming language ever. (Please stop undermining proper testing by &quot;clever&quot; compiler hacks. No offence)"}, {"owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "edited": false, "score": 0, "creation_date": 1538137387, "post_id": 49883849, "comment_id": 92049050, "body": "@PSkocik Do you know the expected pointer type, or is it unknown (i.e. <code>T *</code> for some arbitrary <code>T</code>)?"}, {"owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "reply_to_user": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "edited": false, "score": 0, "creation_date": 1538141249, "post_id": 49883849, "comment_id": 92051321, "body": "@FlorianWeimer unknown"}, {"owner": {"reputation": 856, "user_id": 4250150, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-KLzePzmbqTs/AAAAAAAAAAI/AAAAAAAAAD8/henWhVuLqE4/photo.jpg?sz=128", "display_name": "sudo rm -rf slash", "link": "https://stackoverflow.com/users/4250150/sudo-rm-rf-slash"}, "edited": false, "score": 0, "creation_date": 1542574684, "post_id": 49883849, "comment_id": 93607312, "body": "You could do something like <code>#define WARN_IF_NOT_PTR(X) { void * make_uniq_name = X; }</code> or even define a function taking a ptr arg... basically you just want to invoke the type checker, right?"}], "owner": {"reputation": 51929, "user_id": 1084774, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/13403db744d8aa130bb317576cc1df30?s=128&d=identicon&r=PG", "display_name": "PSkocik", "link": "https://stackoverflow.com/users/1084774/pskocik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1523987104, "creation_date": 1523985091, "last_edit_date": 1523987104, "question_id": 49883849, "link": "https://stackoverflow.com/questions/49883849/using-gcc-clang-c-extensions-to-test-if-a-macro-argument-is-a-pointer", "title": "Using gcc/clang C extensions to test if a macro argument is a pointer", "body": "<p>Using gcc/tcc/clang's extensions to the C language (C11), is it possible to detect whether\na macro argument has a pointer type?</p>\n\n<p>Details:\nI'm using a macro that should take a singly-indirect pointer, but it's tempting to pass a pointer to that pointer because that's what the corresponsing \"constructor\" macro takes, but doing so would be an error, so I'm currently currently using something like:</p>\n\n<pre><code>  #define ISPTR(X) (sizeof(X)==sizeof(void*)&amp;&amp;_Alignof(X)==_Alignof(void*)) /*inaccurate*/\n\n   #define TAKE_SINGLY_INDIRECT(P) do{ _Static_assert(!ISPTR(*(P)), \"pass a singly indirect pointer\"); /*...*/ }while(0)\n</code></pre>\n\n<p>to protect myself from myself. Is there a better way to implement <code>ISPTR()</code>?</p>\n"}, {"tags": ["c", "string", "pointers", "printf"], "comments": [{"owner": {"reputation": 3852, "user_id": 5321363, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10153640801268875/picture?type=large", "display_name": "Rann Lifshitz", "link": "https://stackoverflow.com/users/5321363/rann-lifshitz"}, "edited": false, "score": 0, "creation_date": 1523986030, "post_id": 49883829, "comment_id": 86784209, "body": "I have to point out - this interview is a sad joke. The company that you interviewed at is hiring compilers, not SW engineers."}, {"owner": {"reputation": 29, "user_id": 9659927, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rami", "link": "https://stackoverflow.com/users/9659927/rami"}, "edited": false, "score": 0, "creation_date": 1523988380, "post_id": 49883829, "comment_id": 86785537, "body": "This was one of the basic questions to see if I understsnd the basics of printf and different types and calls."}, {"owner": {"reputation": 3852, "user_id": 5321363, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10153640801268875/picture?type=large", "display_name": "Rann Lifshitz", "link": "https://stackoverflow.com/users/5321363/rann-lifshitz"}, "edited": false, "score": 2, "creation_date": 1523990091, "post_id": 49883829, "comment_id": 86786391, "body": "I would recommend you try another working place buddy. I&#39;d be happy to explain why in detail off SO."}], "answers": [{"tags": [], "owner": {"reputation": 879, "user_id": 449081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1dfd890598212092385eea64a5ea91?s=128&d=identicon&r=PG", "display_name": "Owen", "link": "https://stackoverflow.com/users/449081/owen"}, "is_accepted": false, "score": 1, "last_activity_date": 1527666225, "last_edit_date": 1527666225, "creation_date": 1523985356, "answer_id": 49883922, "question_id": 49883829, "link": "https://stackoverflow.com/questions/49883829/printf-output-of-pointer-string-explanation-from-an-interview/49883922#49883922", "title": "Printf output of pointer string explanation from an interview", "body": "<p>The 7'th line is failing because a C style string is expected as an input, and you are placing a character instead. </p>\n\n<p>Take a look at:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/9026980/what-does-s-and-d-mean-in-printf-in-the-c-language\">What does %s and %d mean in printf in the C language</a></li>\n<li><a href=\"http://www.learncpp.com/cpp-tutorial/66-c-style-strings/\" rel=\"nofollow noreferrer\">C style strings guide</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1527617103, "post_id": 49883951, "comment_id": 88190093, "body": "Even assuming &quot;32-bit system&quot;, code such as <code>char *s = &quot;12345&quot;; printf(&quot;Pointer to character array: %08x\\n&quot;, s);</code> remains <i>undefined behavior</i> and not a reliable legitimate ASCII character output.  Such code lacks future correctness &amp; maintainability even if it initial &quot;works&quot; as desired.  It should be clearly identified as UB - especially in an interview Q&amp;A.  IOWs, detailed explanation of how the UB could occur takes away from the emphasis, during the interview, the importance that the code is fundamentally deficient."}, {"owner": {"reputation": 3852, "user_id": 5321363, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10153640801268875/picture?type=large", "display_name": "Rann Lifshitz", "link": "https://stackoverflow.com/users/5321363/rann-lifshitz"}, "reply_to_user": {"reputation": 112912, "user_id": 2410359, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/pIl9T.png?s=128&g=1", "display_name": "chux - Reinstate Monica", "link": "https://stackoverflow.com/users/2410359/chux-reinstate-monica"}, "edited": false, "score": 0, "creation_date": 1527619106, "post_id": 49883951, "comment_id": 88191099, "body": "@chux : The core principle is simple - do not code UB. Never code anything that derives from UB. I&#39;ve seen horrible bugs/side effects caused by UB and always tried to fight it. Period. New Line. During a job interview, if asked on a certain behavior, after making it absolutely clear that it is, indeed, UB - one can show a deeper understanding by explaining what the UB has caused."}], "tags": [], "owner": {"reputation": 3852, "user_id": 5321363, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10153640801268875/picture?type=large", "display_name": "Rann Lifshitz", "link": "https://stackoverflow.com/users/5321363/rann-lifshitz"}, "is_accepted": true, "score": 0, "last_activity_date": 1524919248, "last_edit_date": 1524919248, "creation_date": 1523985457, "answer_id": 49883951, "question_id": 49883829, "link": "https://stackoverflow.com/questions/49883829/printf-output-of-pointer-string-explanation-from-an-interview/49883951#49883951", "title": "Printf output of pointer string explanation from an interview", "body": "<p>I used the following <a href=\"https://www.onlinegdb.com/online_c_compiler\" rel=\"nofollow noreferrer\">online C compiler</a> in order to run your code,\nand here are the results:</p>\n\n<pre><code>1. 4195988            - undefined behaviour (UB), manifesting here as the address\n                        of the char array as you stated (for a 64 bit address you might or\n                        might not get truncation)\n2. 49                 - ASCII value of '1'\n3. \ufffd                  - undefined behaviour, manifesting here as unsupported ASCII value\n                        for a truncation of the address of the array of chars\n                        (placing 32-bit address into a char - assuming a 32-bit system)\n4. 1                  - obvious\n5. 2                  - obvious\n6. 12345              - obvious\n7. Segmentation fault - undefined behaviour, trying to place the first char\n                        of a char array into a string reserved position\n                        (placing char into a string)\n</code></pre>\n\n<p>Note on point number 3: we can deduce what took place during run-time.\nIn the specific example provided in the question -</p>\n\n<pre><code>printf(\"%c\\n\", s);      // 3.Outputs \"\\237\". What is this value?\n</code></pre>\n\n<p>This is a hardware/compiler/OS related behavior when handling the UB.</p>\n\n<p>Why? Due to the output \"\\237\" -> this implies truncation <em>under the specific hardware system executing this code</em>!</p>\n\n<p>Please see the explanation below (assumption - 32-bit system):</p>\n\n<pre><code>char *s = \"12345\"; // Declaring a char pointer pointing to a char array\nchar c = s; // Placement of the pointer into a char - our UB\nprintf(\"Pointer to character array: %08x\\n\", s); // Get the raw bytes\nprintf(\"Pointer to character: %08x\\n\", c); // Get the raw bytes\nprintf(\"%c\\n\", s); // place the pointer as a character\n                   // display is dependent on the ASCII value and the OS\n                   // definitions for 128-255 ASCII values\n</code></pre>\n\n<p>The outputs:</p>\n\n<pre><code>Pointer to character array: 004006e4  // Classic 32-bit pointer\nPointer to character: ffffffe4        // Truncation to a signed char\n                                      // (Note signed MSB padding to 32 bit display)\n\ufffd                                     // ASCII value E4 = 228 is not displayed properly\n</code></pre>\n\n<p>The final printf command is equivalent to <code>char c = s; printf(\"%c\\n\", c);</code>.\nWhy? Thanks to truncation.</p>\n\n<p>An additional example with a legitimate ASCII character output:</p>\n\n<pre><code>    char *fixedPointer = 0xABCD61; // Declaring a char pointer pointing to a dummy address\n    char c = fixedPointer; // Placement of the pointer into a char - our UB\n    printf(\"Pointer to 32-bit address: %08x\\n\", fixedPointer); // Get the raw bytes\n    printf(\"Pointer to character: %08x\\n\", c); // Get the raw bytes\n    printf(\"%c\\n\", fixedPointer);\n</code></pre>\n\n<p>And the actual outputs:</p>\n\n<pre><code>Pointer to 32-bit address: 00abcd61\nPointer to character: 00000061\na\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 5, "last_activity_date": 1527666175, "last_edit_date": 1527666175, "creation_date": 1523987308, "answer_id": 49884467, "question_id": 49883829, "link": "https://stackoverflow.com/questions/49883829/printf-output-of-pointer-string-explanation-from-an-interview/49884467#49884467", "title": "Printf output of pointer string explanation from an interview", "body": "<p>This call</p>\n\n<pre><code>printf(\"%d\\n\", s); \n</code></pre>\n\n<p>has undefined behavior because an invalid format specifier is used with a pointer.</p>\n\n<p>This call</p>\n\n<pre><code>printf(\"%d\\n\", *s);\n</code></pre>\n\n<p>outputs the internal code (for example ASCII code) of the character <code>'1'</code>.</p>\n\n<p>This call</p>\n\n<pre><code>printf(\"%c\\n\", s);\n</code></pre>\n\n<p>has undefined behavior due to using an invalid format specifier with a pointer.</p>\n\n<p>These calls</p>\n\n<pre><code>printf(\"%c\\n\", *s);\nprintf(\"%c\\n\", *(s+1));\n</code></pre>\n\n<p>are valid. The first one outputs the character <code>'1'</code> and the second one outputs the character <code>'2'</code>.</p>\n\n<p>This call</p>\n\n<pre><code>printf(\"%s\\n\", s);\n</code></pre>\n\n<p>is correct and outputs the string <code>\"12345\"</code>.</p>\n\n<p>This call</p>\n\n<pre><code>printf(\"%s\\n\", *s);\n</code></pre>\n\n<p>is invalid because an invalid format specifier is used with an object of the type <code>char</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 7824, "user_id": 3899431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeEzu.jpg?s=128&g=1", "display_name": "Luis Colorado", "link": "https://stackoverflow.com/users/3899431/luis-colorado"}, "is_accepted": false, "score": 1, "last_activity_date": 1524919450, "last_edit_date": 1524919450, "creation_date": 1524121551, "answer_id": 49914759, "question_id": 49883829, "link": "https://stackoverflow.com/questions/49883829/printf-output-of-pointer-string-explanation-from-an-interview/49914759#49914759", "title": "Printf output of pointer string explanation from an interview", "body": "<ol>\n<li><p>This code is undefined behaviour (UB). You are passing a pointer, where the function requires an <code>int</code> value. For example, in a 64-bit architecture, a pointer is 64 bit, and an <code>int</code> is 32 bit.  You can be printing a truncated value.</p></li>\n<li><p>You are passing the first <code>char</code> value (automatically converted to an <code>int</code> by the compiler) and print it in decimal. Probably you got <code>49</code> (the ASCII code for <code>'1'</code>. This is legal use, but be careful about surprises, as you can get negative values if your platform <code>char</code> implementation is <code>signed</code>.</p></li>\n<li><p>You are printing the passed pointer reinterpreted as a <code>char</code> value.  Undefined behaviour, as you cannot convert a pointer to a <code>char</code> value.</p></li>\n<li><p>You are printing the pointed value of <code>s</code> as a <code>char</code> so you get the first character of string <code>\"12345\"</code> (<code>'1'</code>).</p></li>\n<li><p>You are printing the next to first <code>char</code> pointed to by <code>s</code>, so you get the second character of string (<code>'2'</code>).</p></li>\n<li><p>You are printing the string pointed to by <code>s</code>, so you get the whole string. This is legal and indeed, the common way to print a string.</p></li>\n<li><p>You are passing the first character of string to be interpreted as a pointer to a null terminated string to be printed (which it isn't). This is undefined behaviour again. You are reinterpreting a <code>char</code> value as a pointer to a null terminated string. A <code>SIGSEGV</code> is common in this case, (but not warranted :) )  The signal is sent when the program tries to access unallocated memory before reaching the supposed null character that terminates the string (but it could find a <code>'\\0'</code> in the way and just print rubbish).</p></li>\n</ol>\n"}], "owner": {"reputation": 29, "user_id": 9659927, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Rami", "link": "https://stackoverflow.com/users/9659927/rami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 2, "accepted_answer_id": 49883951, "answer_count": 4, "score": 1, "last_activity_date": 1527666225, "creation_date": 1523985011, "last_edit_date": 1523985203, "question_id": 49883829, "link": "https://stackoverflow.com/questions/49883829/printf-output-of-pointer-string-explanation-from-an-interview", "title": "Printf output of pointer string explanation from an interview", "body": "<p>I had an interview and I was given this code and asked what is the output for each one of these printf statements. </p>\n\n<p>I have my answers as comments, but I am not sure about the rest. </p>\n\n<p>Can anyone explain the different outputs for statements 1, 3 and 7 and why?</p>\n\n<p>Thank you!</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(int argc, const char * argv[]) {\n\n    char *s = \"12345\";\n\n    printf(\"%d\\n\", s);      // 1.Outputs \"3999\" is this the address of the first pointer?\n    printf(\"%d\\n\", *s);     // 2.The decimal value of the first character\n    printf(\"%c\\n\", s);      // 3.Outputs \"\\237\" What is this value?\n    printf(\"%c\\n\", *s);     // 4.Outputs \"1\"\n    printf(\"%c\\n\", *(s+1)); // 5.Outputs \"2\"\n    printf(\"%s\\n\", s);      // 6.Outputs \"12345\"\n    printf(\"%s\\n\", *s);     // 7.I get an error, why?\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["c", "signals"], "comments": [{"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523985128, "post_id": 49883823, "comment_id": 86783732, "body": "what is your intended functionality of the line <code>system(&quot;^C&quot;);</code>?"}, {"owner": {"reputation": 37, "user_id": 5591491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cLzsJ.jpg?s=128&g=1", "display_name": "Davide Ambrosi", "link": "https://stackoverflow.com/users/5591491/davide-ambrosi"}, "reply_to_user": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523985491, "post_id": 49883823, "comment_id": 86783919, "body": "that line is only for test, the purpose was to execute CTRL+C and after open again the application"}, {"owner": {"reputation": 39539, "user_id": 153430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a446e1fd338fb334fa68b3f7470cd65b?s=128&d=identicon&r=PG", "display_name": "Jim Lewis", "link": "https://stackoverflow.com/users/153430/jim-lewis"}, "edited": false, "score": 1, "creation_date": 1523985851, "post_id": 49883823, "comment_id": 86784097, "body": "In a Unix-like environment, job control commands like control-c are interpreted by the shell; they are not commands you can pass directly to system(), so &quot;execute CTRL-C&quot; doesn&#39;t really make sense in that context."}, {"owner": {"reputation": 3975, "user_id": 8513665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39368317b0749f5d8f09735796c470e?s=128&d=identicon&r=PG&f=1", "display_name": "Christian Gibbons", "link": "https://stackoverflow.com/users/8513665/christian-gibbons"}, "edited": false, "score": 0, "creation_date": 1523985860, "post_id": 49883823, "comment_id": 86784104, "body": "That doesn&#39;t really make sense.  This is a function to handle SIGINT, and you want it to send a SIGINT?  If you did manage to send a SIGINT out it would be handled by your handler function and you could be stuck in an eternal loop of handling SIGINT.  If you just want your program to keep running, you don&#39;t need to really do anything in your handler.  By handling SIGINT, it overrides the default action of killing the process."}, {"owner": {"reputation": 37, "user_id": 5591491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cLzsJ.jpg?s=128&g=1", "display_name": "Davide Ambrosi", "link": "https://stackoverflow.com/users/5591491/davide-ambrosi"}, "edited": false, "score": 0, "creation_date": 1523985965, "post_id": 49883823, "comment_id": 86784171, "body": "oh yeah I didn&#39;t realize that, thanks. Let me modify the question"}], "answers": [{"tags": [], "owner": {"reputation": 11619, "user_id": 5346306, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BsACH.jpg?s=128&g=1", "display_name": "Achal", "link": "https://stackoverflow.com/users/5346306/achal"}, "is_accepted": true, "score": 0, "last_activity_date": 1523986480, "creation_date": 1523986480, "answer_id": 49884226, "question_id": 49883823, "link": "https://stackoverflow.com/questions/49883823/ctrlc-from-system-in-c-not-recognized/49884226#49884226", "title": "CTRL+C from system() in C not recognized", "body": "<p><em>I'm trying to make a C program that can continue running also after a CTRL+C. ?</em> when the process receives CTRL+C you set the handler for that using <code>sigaction()</code> and in that handler you can specify whether to continue or ignore or whatever you want.</p>\n\n<p>May be you want like this </p>\n\n<pre><code>void sighandle_int(int sign) {\n            /*when process receives SIGINT this isr will be called,\n            here you can specify whether you want to continue or ignore,\n            by signal handler again */\n            signal(SIGINT,SIG_IGN);\n            //or\n            signal(SIGINT,sighandle_int);\n    }\n</code></pre>\n\n<p>Meanwhile use <code>sigaction()</code> instead of <code>signal()</code> as told here <a href=\"https://stackoverflow.com/questions/231912/what-is-the-difference-between-sigaction-and-signal\">What is the difference between sigaction and signal?</a></p>\n"}], "owner": {"reputation": 37, "user_id": 5591491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cLzsJ.jpg?s=128&g=1", "display_name": "Davide Ambrosi", "link": "https://stackoverflow.com/users/5591491/davide-ambrosi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 49884226, "answer_count": 1, "score": 0, "last_activity_date": 1523986480, "creation_date": 1523984997, "last_edit_date": 1523986200, "question_id": 49883823, "link": "https://stackoverflow.com/questions/49883823/ctrlc-from-system-in-c-not-recognized", "title": "CTRL+C from system() in C not recognized", "body": "<p>I'm trying to make a C program that can continue running also after a CTRL+C.</p>\n\n<p>I wrote this:</p>\n\n<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid acceptCommands();\n\nvoid sighandle_int(int sign)\n{\n    //system(\"^C;./a.out\");   *out:* ^Csh: ^C: command not found\n</code></pre>\n\n<blockquote>\n  <p>// how to protect here the app from being killed?</p>\n</blockquote>\n\n<pre><code>}\n\nint main(int argc, char **argv)\n{\n    signal(SIGINT, sighandle_int);\n\n    acceptCommands();   \n\n    return 0;\n}\n</code></pre>\n\n<p>how can i do? \nThank you</p>\n"}, {"tags": ["c", "file", "encryption", "stdin", "xor"], "comments": [{"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 1, "creation_date": 1523984961, "post_id": 49883727, "comment_id": 86783642, "body": "1. Use a loop. 2. Why does it matter, just go back to the beginning of the key. 3. Yes, XOR is its own inverse."}, {"owner": {"reputation": 513, "user_id": 8293226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ccfWx.png?s=128&g=1", "display_name": "mustachioed", "link": "https://stackoverflow.com/users/8293226/mustachioed"}, "edited": false, "score": 0, "creation_date": 1523985021, "post_id": 49883727, "comment_id": 86783680, "body": "You can always just wrap the XOR key if the plaintext file is longer than the key."}, {"owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "edited": false, "score": 3, "creation_date": 1523985035, "post_id": 49883727, "comment_id": 86783688, "body": "<code>k = fgetc(k);</code>. You&#39;re using the same variable for the file and the value you read from it."}, {"owner": {"reputation": 1893, "user_id": 1787434, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f5a5c15e84e4a9aec84dc8be822010?s=128&d=identicon&r=PG", "display_name": "the_storyteller", "link": "https://stackoverflow.com/users/1787434/the-storyteller"}, "edited": false, "score": 0, "creation_date": 1523985122, "post_id": 49883727, "comment_id": 86783727, "body": "Specifically, you&#39;ll want a <code>int d;</code> which you can read into. <code>d = fgetc(k);</code>"}, {"owner": {"reputation": 31945, "user_id": 3386109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zt9UL.png?s=128&g=1", "display_name": "user3386109", "link": "https://stackoverflow.com/users/3386109/user3386109"}, "edited": false, "score": 0, "creation_date": 1523985146, "post_id": 49883727, "comment_id": 86783737, "body": "2. If you read <code>EOF</code> from the key file before reading <code>EOF</code> from the input file, then the key file was too short."}], "answers": [{"tags": [], "owner": {"reputation": 589605, "user_id": 1491895, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/82f9e178a16364bf561d0ed4da09a35d?s=128&d=identicon&r=PG", "display_name": "Barmar", "link": "https://stackoverflow.com/users/1491895/barmar"}, "is_accepted": false, "score": 1, "last_activity_date": 1523985292, "creation_date": 1523985292, "answer_id": 49883906, "question_id": 49883727, "link": "https://stackoverflow.com/questions/49883727/c-one-time-pad-encryption-via-a-bit-by-bit-process-using-stdin-and-stdout/49883906#49883906", "title": "C - One-time pad encryption via a bit-by-bit process using StdIn and StdOut", "body": "<p>When you get to the end of the key file, rewind back to the beginning.</p>\n\n<p>You also need to use a different variable for the character you read from the key file, instead of reusing <code>k</code>.</p>\n\n<pre><code>while ((c = fgetc(in)) != EOF) {\n    int kc = fgetc(k);\n    if (kc == EOF) {\n        rewind(k);\n        kc = fgetc(k);\n    }\n    fputc(c ^ kc, out);\n}\n</code></pre>\n\n<p>This same technique will work for decrypting, since XOR is symmetric. <code>(c ^ kc) ^ kc == c</code></p>\n"}], "owner": {"reputation": 13, "user_id": 5090642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/389df04a7c076503aa4d51d35cc6e48c?s=128&d=identicon&r=PG&f=1", "display_name": "user", "link": "https://stackoverflow.com/users/5090642/user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524518152, "creation_date": 1523984640, "last_edit_date": 1524518152, "question_id": 49883727, "link": "https://stackoverflow.com/questions/49883727/c-one-time-pad-encryption-via-a-bit-by-bit-process-using-stdin-and-stdout", "title": "C - One-time pad encryption via a bit-by-bit process using StdIn and StdOut", "body": "<p>I would like to find out how may I use a key file for XOR encryption as opposed to only using a single number for k. What I am finding challenging with this problem is:</p>\n\n<ol>\n<li>How would we be able to encrypt the input file with the key file on a byte by byte basis?</li>\n<li>How would we check that the key is longer than the message?</li>\n<li>Would we be able to recover the original message using the same XOR operation?</li>\n</ol>\n\n<p>My code are included below:</p>\n\n<pre><code>    while ((c = fgetc(in)) != EOF) { //problem lies here\n\n        k = fgetc(k); // &lt;- ERROR:  incompatible integer to pointer conversion assigning to 'FILE *\n\n        fputc(c ^ k, out);\n    }\n</code></pre>\n"}, {"tags": ["c", "malloc", "free"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1523984894, "post_id": 49883725, "comment_id": 86783608, "body": "<code>tmp = (65+rand()%26);</code>?  Only the digits <code>0</code>-<code>9</code> are guaranteed to be represented consecutively.  <code>A</code>-<code>Z</code> and <code>a</code>-<code>z</code> do not have to have consecutive values in the execution character set."}, {"owner": {"reputation": 360, "user_id": 5875805, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S4zBy.jpg?s=128&g=1", "display_name": "Tormund Giantsbane", "link": "https://stackoverflow.com/users/5875805/tormund-giantsbane"}, "edited": false, "score": 1, "creation_date": 1523984970, "post_id": 49883725, "comment_id": 86783651, "body": "<code>char* name = (char*) malloc(10*sizeof(char));</code> only allocates space for 10 characters"}], "answers": [{"comments": [{"owner": {"reputation": 360, "user_id": 5875805, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S4zBy.jpg?s=128&g=1", "display_name": "Tormund Giantsbane", "link": "https://stackoverflow.com/users/5875805/tormund-giantsbane"}, "edited": false, "score": 1, "creation_date": 1523985112, "post_id": 49883810, "comment_id": 86783717, "body": "There is also <code>strcat(name, temp);</code> in the default case"}], "tags": [], "owner": {"reputation": 35932, "user_id": 1606345, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/IwiIM.png?s=128&g=1", "display_name": "David Ranieri", "link": "https://stackoverflow.com/users/1606345/david-ranieri"}, "is_accepted": true, "score": 1, "last_activity_date": 1523985595, "last_edit_date": 1523985595, "creation_date": 1523984966, "answer_id": 49883810, "question_id": 49883725, "link": "https://stackoverflow.com/questions/49883725/free-of-a-char-passed-in-an-execve-as-parameter/49883810#49883810", "title": "free() of a char* passed in an execve as parameter", "body": "<pre><code>char* name = (char*) malloc(10*sizeof(char));\n...\nstrcpy(name,\"ABCDEFGHIL\");\n</code></pre>\n\n<p>You need space for the trailing NUL character (<code>'\\0'</code>)</p>\n\n<p>Change to</p>\n\n<pre><code>char *name = malloc(11); /* Don't cast malloc, and char is always 1 byte */\n</code></pre>\n\n<p>And as pointed out by @ TormundGiantsbane in comments, you also need more space for this concat in <code>strcat(name, temp);</code></p>\n"}], "owner": {"reputation": 3, "user_id": 9655938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39f82169c8725fd3b98dd57b8c631f86?s=128&d=identicon&r=PG", "display_name": "user9655938", "link": "https://stackoverflow.com/users/9655938/user9655938"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 49883810, "answer_count": 1, "score": 0, "last_activity_date": 1523985595, "creation_date": 1523984638, "question_id": 49883725, "link": "https://stackoverflow.com/questions/49883725/free-of-a-char-passed-in-an-execve-as-parameter", "title": "free() of a char* passed in an execve as parameter", "body": "<p>Good evening, I'm getting mad with this. My program shows me \"free(): invalid next size (fast)\" at the end of the execution. How can I handle this? I think it's because at some point the variable name is not enough large to contain the name. Could it be?</p>\n\n<p>This is the code: \nmamt.c</p>\n\n<pre><code>#include &lt;fcntl.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;string.h&gt;\n#include &lt;time.h&gt;\n\nint main(int argc, char *argv[]){\n   srand((unsigned)time(NULL));\n   char tmp;\n   char** args=(char**)malloc(3*sizeof(char*));\n   for(int i =0;i&lt;3;i++){\n       args[i]=(char*)malloc(10*sizeof(char));\n   }\n   char* name = (char*) malloc(10*sizeof(char));\n   char* temp = (char*) malloc(10*sizeof(char));\n   strcpy(name,\"ABCDEFGHIL\");\n\n   register int i;\n   for(i=0;i&lt;20;i++){\n       switch(fork()){     \n          case -1:\n            perror(\"Fork failed\");\n            exit(1);\n          case 0:\n            strcpy(args[0],\"child_process\");\n            strcpy(args[1],name);\n            args[2]=NULL;\n            execve(\"./child_process\",args,NULL);\n            fprintf(stderr, \"%s: %d. Error #%03d: %s\\n\", __FILE__, \n            __LINE__, errno, strerror(errno));\n            exit(EXIT_FAILURE);\n          default:\n            tmp = (65+rand()%26);\n            sprintf(temp, \"%c\", tmp);\n            strcat(name,temp);\n            sleep(1); \n       }\n   }\n  free(name);\n  free(temp);\n}\n</code></pre>\n\n<p>child_process.c</p>\n\n<pre><code>  #include &lt;fcntl.h&gt;\n  #include &lt;unistd.h&gt;\n  #include &lt;stdio.h&gt;\n  #include &lt;stdlib.h&gt;\n  #include &lt;errno.h&gt;\n  #include &lt;string.h&gt;\n\n\nint main(int argc, char *argv[]){\n   char * name=(char*)malloc(100*sizeof(char));\n\n   if(argc==2){\n       strcpy(name,argv[1]);\n       printf(\"My name is : %s\\n\",name);\n   }else{\n       exit(1);\n   }\n\n   free(name);\n   exit(0);\n\n }\n</code></pre>\n"}, {"tags": ["c", "arrays", "pointers", "struct", "segmentation-fault"], "comments": [{"owner": {"reputation": 827, "user_id": 7383242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c65444c41048c45464ae10a9cafa0c41?s=128&d=identicon&r=PG&f=1", "display_name": "medalib", "link": "https://stackoverflow.com/users/7383242/medalib"}, "edited": false, "score": 2, "creation_date": 1523983584, "post_id": 49883415, "comment_id": 86782870, "body": "<code>k</code> is local to <code>DoubleCapacity</code>"}, {"owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "edited": false, "score": 2, "creation_date": 1523984219, "post_id": 49883415, "comment_id": 86783222, "body": "note that you dont need a new struct, just a new buffer"}], "answers": [{"comments": [{"owner": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "edited": false, "score": 2, "creation_date": 1523984297, "post_id": 49883614, "comment_id": 86783280, "body": "memcpy rather than loop?"}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "reply_to_user": {"reputation": 32321, "user_id": 173397, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pqKT8.jpg?s=128&g=1", "display_name": "pm100", "link": "https://stackoverflow.com/users/173397/pm100"}, "edited": false, "score": 0, "creation_date": 1523984384, "post_id": 49883614, "comment_id": 86783335, "body": "@pm100, that&#39;s definitely better."}, {"owner": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 4, "creation_date": 1523984552, "post_id": 49883614, "comment_id": 86783427, "body": "And not <code>realloc</code>?"}, {"owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "reply_to_user": {"reputation": 6440, "user_id": 27302, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ee0b2f006682f28d5a6ba5634ade513?s=128&d=identicon&r=PG", "display_name": "Daniel H", "link": "https://stackoverflow.com/users/27302/daniel-h"}, "edited": false, "score": 0, "creation_date": 1523984617, "post_id": 49883614, "comment_id": 86783459, "body": "@DanielH, :) I was trying to minimize the number of changes to the OP&#39;s code."}], "tags": [], "owner": {"reputation": 196207, "user_id": 434551, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/8Wzl8.png?s=128&g=1", "display_name": "R Sahu", "link": "https://stackoverflow.com/users/434551/r-sahu"}, "is_accepted": true, "score": 3, "last_activity_date": 1523984690, "last_edit_date": 1523984690, "creation_date": 1523984182, "answer_id": 49883614, "question_id": 49883415, "link": "https://stackoverflow.com/questions/49883415/memory-allocation-and-copying-to-a-new-struct/49883614#49883614", "title": "Memory Allocation and Copying to a new struct", "body": "<p>This line</p>\n\n<pre><code>s=&amp;k;\n</code></pre>\n\n<p>changes where <code>s</code> points to but the change is local to the function. It does not change the contents of the object in the calling function.</p>\n\n<ol>\n<li>You don't need to create a new object of type <code>String</code>.</li>\n<li>You need to change <code>s-&gt;ptr</code> to point to the newly allocated memory.</li>\n<li>You need to deallocate the old memory that <code>s-&gt;ptr</code> points to.</li>\n<li>You need to update the capacity of <code>s</code>.</li>\n</ol>\n\n<hr>\n\n<pre><code>void DoubleCapacity(String *s) {\n\n    int newCapa = (s-&gt;capa) * 2;\n    char* ptr = malloc(newCapa);\n\n    if (ptr == NULL) {\n        printf(\"Error occurs when allocating memory\\n\");\n        exit(1);\n    }\n\n    // Copy the data from old memory to new memory\n    memcpy(ptr, s-&gt;ptr, len);\n\n    free(s-&gt;ptr);\n    s-&gt;ptr = ptr;\n    s-&gt;capa = newCapa;\n}\n</code></pre>\n\n<p>A better version, by using <code>realloc</code>.</p>\n\n<pre><code>void DoubleCapacity(String *s) {\n\n    int newCapa = (s-&gt;capa) * 2;\n    char* ptr = realloc(s-&gt;ptr, newCapa);\n\n    if (ptr == NULL) {\n        printf(\"Error occurs when allocating memory\\n\");\n        exit(1);\n    }\n\n    s-&gt;ptr = ptr;\n    s-&gt;capa = newCapa;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 219634, "user_id": 2877241, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/63d17ecdadc8917254be4fb70e86246b?s=128&d=identicon&r=PG&f=1", "display_name": "Vlad from Moscow", "link": "https://stackoverflow.com/users/2877241/vlad-from-moscow"}, "is_accepted": false, "score": 0, "last_activity_date": 1523986555, "creation_date": 1523986555, "answer_id": 49884250, "question_id": 49883415, "link": "https://stackoverflow.com/questions/49883415/memory-allocation-and-copying-to-a-new-struct/49884250#49884250", "title": "Memory Allocation and Copying to a new struct", "body": "<p>For starters the structure should be defined the following way</p>\n\n<pre><code>typedef struct \n{\n    char* ptr;\n    size_t len;\n    size_t capa;\n} String;\n</code></pre>\n\n<p>The function itself should be declared like</p>\n\n<pre><code>int DoubleCapacity(String *s);\n</code></pre>\n\n<p>That is the function should report whether doubling of the capacity was successfull.</p>\n\n<p>This statement</p>\n\n<pre><code>s=&amp;k;\n</code></pre>\n\n<p>does not make sense. First of all the poinrer <code>s</code> is paased by value and as result the original pointer will not be changed. The function deals with a copy of the original pointer. Secondly you have to free early allocated memory pointed to by the data member <code>ptr</code> or you should <code>realloc</code> the memory.</p>\n\n<p>The function can be defined the following way as it is shown in the demonstrative program.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\ntypedef struct \n{\n    char *ptr;\n    size_t len;\n    size_t capa;\n} String;\n\nint DoubleCapacity(String *s)\n{\n    char *tmp = realloc( s-&gt;ptr, 2 * s-&gt;capa );\n    int success = tmp != NULL;\n\n    if ( success )\n    {\n        s-&gt;ptr = tmp;\n        s-&gt;capa *= 2;\n    }\n\n    return success;\n}\n\nint main(void) \n{\n    const char *hello = \"Hello Doe\";\n    String s = { 0 };\n\n    size_t n = strlen( hello );\n    s.ptr = malloc( n + 1 );\n\n    if ( s.ptr )\n    {\n        s.len = n;\n        s.capa = n + 1;\n        strcpy( s.ptr, hello );\n    }\n\n    printf( \"s.len = %zu\\n\", s.len );\n    printf( \"s.capa = %zu\\n\", s.capa );\n    printf( \"s.ptr = \\\"%s\\\"\\n\\n\", s.ptr );\n\n    DoubleCapacity( &amp;s );\n\n    printf( \"s.len = %zu\\n\", s.len );\n    printf( \"s.capa = %zu\\n\", s.capa );\n    printf( \"s.ptr = \\\"%s\\\"\\n\\n\", s.ptr );\n\n    free( s.ptr );\n\n    return 0;\n}\n</code></pre>\n\n<p>Its output</p>\n\n<pre><code>s.len = 9\ns.capa = 10\ns.ptr = \"Hello Doe\"\n\ns.len = 9\ns.capa = 20\ns.ptr = \"Hello Doe\"\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9659728"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 0, "accepted_answer_id": 49883614, "answer_count": 2, "score": 0, "last_activity_date": 1523986555, "creation_date": 1523983397, "question_id": 49883415, "link": "https://stackoverflow.com/questions/49883415/memory-allocation-and-copying-to-a-new-struct", "title": "Memory Allocation and Copying to a new struct", "body": "<p>I have a struct like this:</p>\n\n<pre><code>typedef struct {\n    char* ptr;\n    int len;\n    int capa;\n} String;\n</code></pre>\n\n<p>And I would like to double the memory allocated to an object of this struct. So in the following function I pass a pointer to the struct object; I create another struct object which is double the memory. I copy the information to the new struct and make the pointer point at this struct. Even though there is no error, the memory allocation does not work correctly as output indicates. What might be wrong about the fuction:</p>\n\n<pre><code>void DoubleCapacity(String *s){\n\nString k;\nk.len=s-&gt;len;\nk.capa=(s-&gt;capa) * 2;\nprintf(\"s-&gt;capa is %d\\n\", s-&gt;capa );\nk.ptr=(char*) malloc(s-&gt;capa * 2);\n\nprintf(\"k.capa is %d\\n\", s-&gt;capa*2 );\n//printf(\"%d\\n\", s-&gt;capa);\n//printf(\"%d\\n\", s-&gt;capa *2);\nif (k.ptr == NULL) {\n    printf(\"Error occurs when allocating memory\\n\");\n    exit(1);\n}\n\n\nfor(int i=0; i &lt; s-&gt;len; i++){\n    k.ptr[i]=s-&gt;ptr[i];\n\n}\n\ns=&amp;k;\n\n}\n</code></pre>\n"}]